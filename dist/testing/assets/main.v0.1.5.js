function nEe(n,e){for(var i=0;i<e.length;i++){const o=e[i];if(typeof o!="string"&&!Array.isArray(o)){for(const l in o)if(l!=="default"&&!(l in n)){const d=Object.getOwnPropertyDescriptor(o,l);d&&Object.defineProperty(n,l,d.get?d:{enumerable:!0,get:()=>o[l]})}}}return Object.freeze(Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}))}var Sy=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Ug(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var hM={exports:{}},pw={},fM={exports:{}},Er={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var TK;function rEe(){if(TK)return Er;TK=1;var n=Symbol.for("react.element"),e=Symbol.for("react.portal"),i=Symbol.for("react.fragment"),o=Symbol.for("react.strict_mode"),l=Symbol.for("react.profiler"),d=Symbol.for("react.provider"),p=Symbol.for("react.context"),_=Symbol.for("react.forward_ref"),E=Symbol.for("react.suspense"),b=Symbol.for("react.memo"),C=Symbol.for("react.lazy"),I=Symbol.iterator;function O(we){return we===null||typeof we!="object"?null:(we=I&&we[I]||we["@@iterator"],typeof we=="function"?we:null)}var L={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},V=Object.assign,B={};function W(we,be,Ie){this.props=we,this.context=be,this.refs=B,this.updater=Ie||L}W.prototype.isReactComponent={},W.prototype.setState=function(we,be){if(typeof we!="object"&&typeof we!="function"&&we!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,we,be,"setState")},W.prototype.forceUpdate=function(we){this.updater.enqueueForceUpdate(this,we,"forceUpdate")};function Z(){}Z.prototype=W.prototype;function $(we,be,Ie){this.props=we,this.context=be,this.refs=B,this.updater=Ie||L}var se=$.prototype=new Z;se.constructor=$,V(se,W.prototype),se.isPureReactComponent=!0;var ue=Array.isArray,re=Object.prototype.hasOwnProperty,pe={current:null},q={key:!0,ref:!0,__self:!0,__source:!0};function Q(we,be,Ie){var Me,ze={},Je=null,tt=null;if(be!=null)for(Me in be.ref!==void 0&&(tt=be.ref),be.key!==void 0&&(Je=""+be.key),be)re.call(be,Me)&&!q.hasOwnProperty(Me)&&(ze[Me]=be[Me]);var ut=arguments.length-2;if(ut===1)ze.children=Ie;else if(1<ut){for(var Ze=Array(ut),bt=0;bt<ut;bt++)Ze[bt]=arguments[bt+2];ze.children=Ze}if(we&&we.defaultProps)for(Me in ut=we.defaultProps,ut)ze[Me]===void 0&&(ze[Me]=ut[Me]);return{$$typeof:n,type:we,key:Je,ref:tt,props:ze,_owner:pe.current}}function J(we,be){return{$$typeof:n,type:we.type,key:be,ref:we.ref,props:we.props,_owner:we._owner}}function ie(we){return typeof we=="object"&&we!==null&&we.$$typeof===n}function me(we){var be={"=":"=0",":":"=2"};return"$"+we.replace(/[=:]/g,function(Ie){return be[Ie]})}var de=/\/+/g;function le(we,be){return typeof we=="object"&&we!==null&&we.key!=null?me(""+we.key):be.toString(36)}function xe(we,be,Ie,Me,ze){var Je=typeof we;(Je==="undefined"||Je==="boolean")&&(we=null);var tt=!1;if(we===null)tt=!0;else switch(Je){case"string":case"number":tt=!0;break;case"object":switch(we.$$typeof){case n:case e:tt=!0}}if(tt)return tt=we,ze=ze(tt),we=Me===""?"."+le(tt,0):Me,ue(ze)?(Ie="",we!=null&&(Ie=we.replace(de,"$&/")+"/"),xe(ze,be,Ie,"",function(bt){return bt})):ze!=null&&(ie(ze)&&(ze=J(ze,Ie+(!ze.key||tt&&tt.key===ze.key?"":(""+ze.key).replace(de,"$&/")+"/")+we)),be.push(ze)),1;if(tt=0,Me=Me===""?".":Me+":",ue(we))for(var ut=0;ut<we.length;ut++){Je=we[ut];var Ze=Me+le(Je,ut);tt+=xe(Je,be,Ie,Ze,ze)}else if(Ze=O(we),typeof Ze=="function")for(we=Ze.call(we),ut=0;!(Je=we.next()).done;)Je=Je.value,Ze=Me+le(Je,ut++),tt+=xe(Je,be,Ie,Ze,ze);else if(Je==="object")throw be=String(we),Error("Objects are not valid as a React child (found: "+(be==="[object Object]"?"object with keys {"+Object.keys(we).join(", ")+"}":be)+"). If you meant to render a collection of children, use an array instead.");return tt}function We(we,be,Ie){if(we==null)return we;var Me=[],ze=0;return xe(we,Me,"","",function(Je){return be.call(Ie,Je,ze++)}),Me}function $e(we){if(we._status===-1){var be=we._result;be=be(),be.then(function(Ie){(we._status===0||we._status===-1)&&(we._status=1,we._result=Ie)},function(Ie){(we._status===0||we._status===-1)&&(we._status=2,we._result=Ie)}),we._status===-1&&(we._status=0,we._result=be)}if(we._status===1)return we._result.default;throw we._result}var ve={current:null},_e={transition:null},Ee={ReactCurrentDispatcher:ve,ReactCurrentBatchConfig:_e,ReactCurrentOwner:pe};function ke(){throw Error("act(...) is not supported in production builds of React.")}return Er.Children={map:We,forEach:function(we,be,Ie){We(we,function(){be.apply(this,arguments)},Ie)},count:function(we){var be=0;return We(we,function(){be++}),be},toArray:function(we){return We(we,function(be){return be})||[]},only:function(we){if(!ie(we))throw Error("React.Children.only expected to receive a single React element child.");return we}},Er.Component=W,Er.Fragment=i,Er.Profiler=l,Er.PureComponent=$,Er.StrictMode=o,Er.Suspense=E,Er.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Ee,Er.act=ke,Er.cloneElement=function(we,be,Ie){if(we==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+we+".");var Me=V({},we.props),ze=we.key,Je=we.ref,tt=we._owner;if(be!=null){if(be.ref!==void 0&&(Je=be.ref,tt=pe.current),be.key!==void 0&&(ze=""+be.key),we.type&&we.type.defaultProps)var ut=we.type.defaultProps;for(Ze in be)re.call(be,Ze)&&!q.hasOwnProperty(Ze)&&(Me[Ze]=be[Ze]===void 0&&ut!==void 0?ut[Ze]:be[Ze])}var Ze=arguments.length-2;if(Ze===1)Me.children=Ie;else if(1<Ze){ut=Array(Ze);for(var bt=0;bt<Ze;bt++)ut[bt]=arguments[bt+2];Me.children=ut}return{$$typeof:n,type:we.type,key:ze,ref:Je,props:Me,_owner:tt}},Er.createContext=function(we){return we={$$typeof:p,_currentValue:we,_currentValue2:we,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},we.Provider={$$typeof:d,_context:we},we.Consumer=we},Er.createElement=Q,Er.createFactory=function(we){var be=Q.bind(null,we);return be.type=we,be},Er.createRef=function(){return{current:null}},Er.forwardRef=function(we){return{$$typeof:_,render:we}},Er.isValidElement=ie,Er.lazy=function(we){return{$$typeof:C,_payload:{_status:-1,_result:we},_init:$e}},Er.memo=function(we,be){return{$$typeof:b,type:we,compare:be===void 0?null:be}},Er.startTransition=function(we){var be=_e.transition;_e.transition={};try{we()}finally{_e.transition=be}},Er.unstable_act=ke,Er.useCallback=function(we,be){return ve.current.useCallback(we,be)},Er.useContext=function(we){return ve.current.useContext(we)},Er.useDebugValue=function(){},Er.useDeferredValue=function(we){return ve.current.useDeferredValue(we)},Er.useEffect=function(we,be){return ve.current.useEffect(we,be)},Er.useId=function(){return ve.current.useId()},Er.useImperativeHandle=function(we,be,Ie){return ve.current.useImperativeHandle(we,be,Ie)},Er.useInsertionEffect=function(we,be){return ve.current.useInsertionEffect(we,be)},Er.useLayoutEffect=function(we,be){return ve.current.useLayoutEffect(we,be)},Er.useMemo=function(we,be){return ve.current.useMemo(we,be)},Er.useReducer=function(we,be,Ie){return ve.current.useReducer(we,be,Ie)},Er.useRef=function(we){return ve.current.useRef(we)},Er.useState=function(we){return ve.current.useState(we)},Er.useSyncExternalStore=function(we,be,Ie){return ve.current.useSyncExternalStore(we,be,Ie)},Er.useTransition=function(){return ve.current.useTransition()},Er.version="18.3.1",Er}var wK;function Mu(){return wK||(wK=1,fM.exports=rEe()),fM.exports}/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var CK;function iEe(){if(CK)return pw;CK=1;var n=Mu(),e=Symbol.for("react.element"),i=Symbol.for("react.fragment"),o=Object.prototype.hasOwnProperty,l=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,d={key:!0,ref:!0,__self:!0,__source:!0};function p(_,E,b){var C,I={},O=null,L=null;b!==void 0&&(O=""+b),E.key!==void 0&&(O=""+E.key),E.ref!==void 0&&(L=E.ref);for(C in E)o.call(E,C)&&!d.hasOwnProperty(C)&&(I[C]=E[C]);if(_&&_.defaultProps)for(C in E=_.defaultProps,E)I[C]===void 0&&(I[C]=E[C]);return{$$typeof:e,type:_,key:O,ref:L,props:I,_owner:l.current}}return pw.Fragment=i,pw.jsx=p,pw.jsxs=p,pw}var RK;function sEe(){return RK||(RK=1,hM.exports=iEe()),hM.exports}var w=sEe(),D=Mu();const fi=Ug(D),IK=nEe({__proto__:null,default:fi},[D]);var pO={},pM={exports:{}},nl={},mM={exports:{}},gM={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var AK;function oEe(){return AK||(AK=1,function(n){function e(_e,Ee){var ke=_e.length;_e.push(Ee);e:for(;0<ke;){var we=ke-1>>>1,be=_e[we];if(0<l(be,Ee))_e[we]=Ee,_e[ke]=be,ke=we;else break e}}function i(_e){return _e.length===0?null:_e[0]}function o(_e){if(_e.length===0)return null;var Ee=_e[0],ke=_e.pop();if(ke!==Ee){_e[0]=ke;e:for(var we=0,be=_e.length,Ie=be>>>1;we<Ie;){var Me=2*(we+1)-1,ze=_e[Me],Je=Me+1,tt=_e[Je];if(0>l(ze,ke))Je<be&&0>l(tt,ze)?(_e[we]=tt,_e[Je]=ke,we=Je):(_e[we]=ze,_e[Me]=ke,we=Me);else if(Je<be&&0>l(tt,ke))_e[we]=tt,_e[Je]=ke,we=Je;else break e}}return Ee}function l(_e,Ee){var ke=_e.sortIndex-Ee.sortIndex;return ke!==0?ke:_e.id-Ee.id}if(typeof performance=="object"&&typeof performance.now=="function"){var d=performance;n.unstable_now=function(){return d.now()}}else{var p=Date,_=p.now();n.unstable_now=function(){return p.now()-_}}var E=[],b=[],C=1,I=null,O=3,L=!1,V=!1,B=!1,W=typeof setTimeout=="function"?setTimeout:null,Z=typeof clearTimeout=="function"?clearTimeout:null,$=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function se(_e){for(var Ee=i(b);Ee!==null;){if(Ee.callback===null)o(b);else if(Ee.startTime<=_e)o(b),Ee.sortIndex=Ee.expirationTime,e(E,Ee);else break;Ee=i(b)}}function ue(_e){if(B=!1,se(_e),!V)if(i(E)!==null)V=!0,$e(re);else{var Ee=i(b);Ee!==null&&ve(ue,Ee.startTime-_e)}}function re(_e,Ee){V=!1,B&&(B=!1,Z(Q),Q=-1),L=!0;var ke=O;try{for(se(Ee),I=i(E);I!==null&&(!(I.expirationTime>Ee)||_e&&!me());){var we=I.callback;if(typeof we=="function"){I.callback=null,O=I.priorityLevel;var be=we(I.expirationTime<=Ee);Ee=n.unstable_now(),typeof be=="function"?I.callback=be:I===i(E)&&o(E),se(Ee)}else o(E);I=i(E)}if(I!==null)var Ie=!0;else{var Me=i(b);Me!==null&&ve(ue,Me.startTime-Ee),Ie=!1}return Ie}finally{I=null,O=ke,L=!1}}var pe=!1,q=null,Q=-1,J=5,ie=-1;function me(){return!(n.unstable_now()-ie<J)}function de(){if(q!==null){var _e=n.unstable_now();ie=_e;var Ee=!0;try{Ee=q(!0,_e)}finally{Ee?le():(pe=!1,q=null)}}else pe=!1}var le;if(typeof $=="function")le=function(){$(de)};else if(typeof MessageChannel<"u"){var xe=new MessageChannel,We=xe.port2;xe.port1.onmessage=de,le=function(){We.postMessage(null)}}else le=function(){W(de,0)};function $e(_e){q=_e,pe||(pe=!0,le())}function ve(_e,Ee){Q=W(function(){_e(n.unstable_now())},Ee)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(_e){_e.callback=null},n.unstable_continueExecution=function(){V||L||(V=!0,$e(re))},n.unstable_forceFrameRate=function(_e){0>_e||125<_e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):J=0<_e?Math.floor(1e3/_e):5},n.unstable_getCurrentPriorityLevel=function(){return O},n.unstable_getFirstCallbackNode=function(){return i(E)},n.unstable_next=function(_e){switch(O){case 1:case 2:case 3:var Ee=3;break;default:Ee=O}var ke=O;O=Ee;try{return _e()}finally{O=ke}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=function(){},n.unstable_runWithPriority=function(_e,Ee){switch(_e){case 1:case 2:case 3:case 4:case 5:break;default:_e=3}var ke=O;O=_e;try{return Ee()}finally{O=ke}},n.unstable_scheduleCallback=function(_e,Ee,ke){var we=n.unstable_now();switch(typeof ke=="object"&&ke!==null?(ke=ke.delay,ke=typeof ke=="number"&&0<ke?we+ke:we):ke=we,_e){case 1:var be=-1;break;case 2:be=250;break;case 5:be=1073741823;break;case 4:be=1e4;break;default:be=5e3}return be=ke+be,_e={id:C++,callback:Ee,priorityLevel:_e,startTime:ke,expirationTime:be,sortIndex:-1},ke>we?(_e.sortIndex=ke,e(b,_e),i(E)===null&&_e===i(b)&&(B?(Z(Q),Q=-1):B=!0,ve(ue,ke-we))):(_e.sortIndex=be,e(E,_e),V||L||(V=!0,$e(re))),_e},n.unstable_shouldYield=me,n.unstable_wrapCallback=function(_e){var Ee=O;return function(){var ke=O;O=Ee;try{return _e.apply(this,arguments)}finally{O=ke}}}}(gM)),gM}var PK;function aEe(){return PK||(PK=1,mM.exports=oEe()),mM.exports}/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var OK;function cEe(){if(OK)return nl;OK=1;var n=Mu(),e=aEe();function i(f){for(var g="https://reactjs.org/docs/error-decoder.html?invariant="+f,T=1;T<arguments.length;T++)g+="&args[]="+encodeURIComponent(arguments[T]);return"Minified React error #"+f+"; visit "+g+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var o=new Set,l={};function d(f,g){p(f,g),p(f+"Capture",g)}function p(f,g){for(l[f]=g,f=0;f<g.length;f++)o.add(g[f])}var _=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),E=Object.prototype.hasOwnProperty,b=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,C={},I={};function O(f){return E.call(I,f)?!0:E.call(C,f)?!1:b.test(f)?I[f]=!0:(C[f]=!0,!1)}function L(f,g,T,k){if(T!==null&&T.type===0)return!1;switch(typeof g){case"function":case"symbol":return!0;case"boolean":return k?!1:T!==null?!T.acceptsBooleans:(f=f.toLowerCase().slice(0,5),f!=="data-"&&f!=="aria-");default:return!1}}function V(f,g,T,k){if(g===null||typeof g>"u"||L(f,g,T,k))return!0;if(k)return!1;if(T!==null)switch(T.type){case 3:return!g;case 4:return g===!1;case 5:return isNaN(g);case 6:return isNaN(g)||1>g}return!1}function B(f,g,T,k,U,H,ce){this.acceptsBooleans=g===2||g===3||g===4,this.attributeName=k,this.attributeNamespace=U,this.mustUseProperty=T,this.propertyName=f,this.type=g,this.sanitizeURL=H,this.removeEmptyString=ce}var W={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(f){W[f]=new B(f,0,!1,f,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(f){var g=f[0];W[g]=new B(g,1,!1,f[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(f){W[f]=new B(f,2,!1,f.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(f){W[f]=new B(f,2,!1,f,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(f){W[f]=new B(f,3,!1,f.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(f){W[f]=new B(f,3,!0,f,null,!1,!1)}),["capture","download"].forEach(function(f){W[f]=new B(f,4,!1,f,null,!1,!1)}),["cols","rows","size","span"].forEach(function(f){W[f]=new B(f,6,!1,f,null,!1,!1)}),["rowSpan","start"].forEach(function(f){W[f]=new B(f,5,!1,f.toLowerCase(),null,!1,!1)});var Z=/[\-:]([a-z])/g;function $(f){return f[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(f){var g=f.replace(Z,$);W[g]=new B(g,1,!1,f,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(f){var g=f.replace(Z,$);W[g]=new B(g,1,!1,f,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(f){var g=f.replace(Z,$);W[g]=new B(g,1,!1,f,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(f){W[f]=new B(f,1,!1,f.toLowerCase(),null,!1,!1)}),W.xlinkHref=new B("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(f){W[f]=new B(f,1,!1,f.toLowerCase(),null,!0,!0)});function se(f,g,T,k){var U=W.hasOwnProperty(g)?W[g]:null;(U!==null?U.type!==0:k||!(2<g.length)||g[0]!=="o"&&g[0]!=="O"||g[1]!=="n"&&g[1]!=="N")&&(V(g,T,U,k)&&(T=null),k||U===null?O(g)&&(T===null?f.removeAttribute(g):f.setAttribute(g,""+T)):U.mustUseProperty?f[U.propertyName]=T===null?U.type===3?!1:"":T:(g=U.attributeName,k=U.attributeNamespace,T===null?f.removeAttribute(g):(U=U.type,T=U===3||U===4&&T===!0?"":""+T,k?f.setAttributeNS(k,g,T):f.setAttribute(g,T))))}var ue=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,re=Symbol.for("react.element"),pe=Symbol.for("react.portal"),q=Symbol.for("react.fragment"),Q=Symbol.for("react.strict_mode"),J=Symbol.for("react.profiler"),ie=Symbol.for("react.provider"),me=Symbol.for("react.context"),de=Symbol.for("react.forward_ref"),le=Symbol.for("react.suspense"),xe=Symbol.for("react.suspense_list"),We=Symbol.for("react.memo"),$e=Symbol.for("react.lazy"),ve=Symbol.for("react.offscreen"),_e=Symbol.iterator;function Ee(f){return f===null||typeof f!="object"?null:(f=_e&&f[_e]||f["@@iterator"],typeof f=="function"?f:null)}var ke=Object.assign,we;function be(f){if(we===void 0)try{throw Error()}catch(T){var g=T.stack.trim().match(/\n( *(at )?)/);we=g&&g[1]||""}return`
`+we+f}var Ie=!1;function Me(f,g){if(!f||Ie)return"";Ie=!0;var T=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(g)if(g=function(){throw Error()},Object.defineProperty(g.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(g,[])}catch(it){var k=it}Reflect.construct(f,[],g)}else{try{g.call()}catch(it){k=it}f.call(g.prototype)}else{try{throw Error()}catch(it){k=it}f()}}catch(it){if(it&&k&&typeof it.stack=="string"){for(var U=it.stack.split(`
`),H=k.stack.split(`
`),ce=U.length-1,Ae=H.length-1;1<=ce&&0<=Ae&&U[ce]!==H[Ae];)Ae--;for(;1<=ce&&0<=Ae;ce--,Ae--)if(U[ce]!==H[Ae]){if(ce!==1||Ae!==1)do if(ce--,Ae--,0>Ae||U[ce]!==H[Ae]){var Ue=`
`+U[ce].replace(" at new "," at ");return f.displayName&&Ue.includes("<anonymous>")&&(Ue=Ue.replace("<anonymous>",f.displayName)),Ue}while(1<=ce&&0<=Ae);break}}}finally{Ie=!1,Error.prepareStackTrace=T}return(f=f?f.displayName||f.name:"")?be(f):""}function ze(f){switch(f.tag){case 5:return be(f.type);case 16:return be("Lazy");case 13:return be("Suspense");case 19:return be("SuspenseList");case 0:case 2:case 15:return f=Me(f.type,!1),f;case 11:return f=Me(f.type.render,!1),f;case 1:return f=Me(f.type,!0),f;default:return""}}function Je(f){if(f==null)return null;if(typeof f=="function")return f.displayName||f.name||null;if(typeof f=="string")return f;switch(f){case q:return"Fragment";case pe:return"Portal";case J:return"Profiler";case Q:return"StrictMode";case le:return"Suspense";case xe:return"SuspenseList"}if(typeof f=="object")switch(f.$$typeof){case me:return(f.displayName||"Context")+".Consumer";case ie:return(f._context.displayName||"Context")+".Provider";case de:var g=f.render;return f=f.displayName,f||(f=g.displayName||g.name||"",f=f!==""?"ForwardRef("+f+")":"ForwardRef"),f;case We:return g=f.displayName||null,g!==null?g:Je(f.type)||"Memo";case $e:g=f._payload,f=f._init;try{return Je(f(g))}catch{}}return null}function tt(f){var g=f.type;switch(f.tag){case 24:return"Cache";case 9:return(g.displayName||"Context")+".Consumer";case 10:return(g._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return f=g.render,f=f.displayName||f.name||"",g.displayName||(f!==""?"ForwardRef("+f+")":"ForwardRef");case 7:return"Fragment";case 5:return g;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Je(g);case 8:return g===Q?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof g=="function")return g.displayName||g.name||null;if(typeof g=="string")return g}return null}function ut(f){switch(typeof f){case"boolean":case"number":case"string":case"undefined":return f;case"object":return f;default:return""}}function Ze(f){var g=f.type;return(f=f.nodeName)&&f.toLowerCase()==="input"&&(g==="checkbox"||g==="radio")}function bt(f){var g=Ze(f)?"checked":"value",T=Object.getOwnPropertyDescriptor(f.constructor.prototype,g),k=""+f[g];if(!f.hasOwnProperty(g)&&typeof T<"u"&&typeof T.get=="function"&&typeof T.set=="function"){var U=T.get,H=T.set;return Object.defineProperty(f,g,{configurable:!0,get:function(){return U.call(this)},set:function(ce){k=""+ce,H.call(this,ce)}}),Object.defineProperty(f,g,{enumerable:T.enumerable}),{getValue:function(){return k},setValue:function(ce){k=""+ce},stopTracking:function(){f._valueTracker=null,delete f[g]}}}}function on(f){f._valueTracker||(f._valueTracker=bt(f))}function Mt(f){if(!f)return!1;var g=f._valueTracker;if(!g)return!0;var T=g.getValue(),k="";return f&&(k=Ze(f)?f.checked?"true":"false":f.value),f=k,f!==T?(g.setValue(f),!0):!1}function Zt(f){if(f=f||(typeof document<"u"?document:void 0),typeof f>"u")return null;try{return f.activeElement||f.body}catch{return f.body}}function an(f,g){var T=g.checked;return ke({},g,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:T??f._wrapperState.initialChecked})}function Ht(f,g){var T=g.defaultValue==null?"":g.defaultValue,k=g.checked!=null?g.checked:g.defaultChecked;T=ut(g.value!=null?g.value:T),f._wrapperState={initialChecked:k,initialValue:T,controlled:g.type==="checkbox"||g.type==="radio"?g.checked!=null:g.value!=null}}function jn(f,g){g=g.checked,g!=null&&se(f,"checked",g,!1)}function Wt(f,g){jn(f,g);var T=ut(g.value),k=g.type;if(T!=null)k==="number"?(T===0&&f.value===""||f.value!=T)&&(f.value=""+T):f.value!==""+T&&(f.value=""+T);else if(k==="submit"||k==="reset"){f.removeAttribute("value");return}g.hasOwnProperty("value")?Fe(f,g.type,T):g.hasOwnProperty("defaultValue")&&Fe(f,g.type,ut(g.defaultValue)),g.checked==null&&g.defaultChecked!=null&&(f.defaultChecked=!!g.defaultChecked)}function Re(f,g,T){if(g.hasOwnProperty("value")||g.hasOwnProperty("defaultValue")){var k=g.type;if(!(k!=="submit"&&k!=="reset"||g.value!==void 0&&g.value!==null))return;g=""+f._wrapperState.initialValue,T||g===f.value||(f.value=g),f.defaultValue=g}T=f.name,T!==""&&(f.name=""),f.defaultChecked=!!f._wrapperState.initialChecked,T!==""&&(f.name=T)}function Fe(f,g,T){(g!=="number"||Zt(f.ownerDocument)!==f)&&(T==null?f.defaultValue=""+f._wrapperState.initialValue:f.defaultValue!==""+T&&(f.defaultValue=""+T))}var Ge=Array.isArray;function at(f,g,T,k){if(f=f.options,g){g={};for(var U=0;U<T.length;U++)g["$"+T[U]]=!0;for(T=0;T<f.length;T++)U=g.hasOwnProperty("$"+f[T].value),f[T].selected!==U&&(f[T].selected=U),U&&k&&(f[T].defaultSelected=!0)}else{for(T=""+ut(T),g=null,U=0;U<f.length;U++){if(f[U].value===T){f[U].selected=!0,k&&(f[U].defaultSelected=!0);return}g!==null||f[U].disabled||(g=f[U])}g!==null&&(g.selected=!0)}}function yt(f,g){if(g.dangerouslySetInnerHTML!=null)throw Error(i(91));return ke({},g,{value:void 0,defaultValue:void 0,children:""+f._wrapperState.initialValue})}function vt(f,g){var T=g.value;if(T==null){if(T=g.children,g=g.defaultValue,T!=null){if(g!=null)throw Error(i(92));if(Ge(T)){if(1<T.length)throw Error(i(93));T=T[0]}g=T}g==null&&(g=""),T=g}f._wrapperState={initialValue:ut(T)}}function Gt(f,g){var T=ut(g.value),k=ut(g.defaultValue);T!=null&&(T=""+T,T!==f.value&&(f.value=T),g.defaultValue==null&&f.defaultValue!==T&&(f.defaultValue=T)),k!=null&&(f.defaultValue=""+k)}function gn(f){var g=f.textContent;g===f._wrapperState.initialValue&&g!==""&&g!==null&&(f.value=g)}function Pn(f){switch(f){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function un(f,g){return f==null||f==="http://www.w3.org/1999/xhtml"?Pn(g):f==="http://www.w3.org/2000/svg"&&g==="foreignObject"?"http://www.w3.org/1999/xhtml":f}var wt,lr=function(f){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(g,T,k,U){MSApp.execUnsafeLocalFunction(function(){return f(g,T,k,U)})}:f}(function(f,g){if(f.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in f)f.innerHTML=g;else{for(wt=wt||document.createElement("div"),wt.innerHTML="<svg>"+g.valueOf().toString()+"</svg>",g=wt.firstChild;f.firstChild;)f.removeChild(f.firstChild);for(;g.firstChild;)f.appendChild(g.firstChild)}});function Dt(f,g){if(g){var T=f.firstChild;if(T&&T===f.lastChild&&T.nodeType===3){T.nodeValue=g;return}}f.textContent=g}var qt={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Qr=["Webkit","ms","Moz","O"];Object.keys(qt).forEach(function(f){Qr.forEach(function(g){g=g+f.charAt(0).toUpperCase()+f.substring(1),qt[g]=qt[f]})});function Hi(f,g,T){return g==null||typeof g=="boolean"||g===""?"":T||typeof g!="number"||g===0||qt.hasOwnProperty(f)&&qt[f]?(""+g).trim():g+"px"}function Vs(f,g){f=f.style;for(var T in g)if(g.hasOwnProperty(T)){var k=T.indexOf("--")===0,U=Hi(T,g[T],k);T==="float"&&(T="cssFloat"),k?f.setProperty(T,U):f[T]=U}}var ai=ke({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Ot(f,g){if(g){if(ai[f]&&(g.children!=null||g.dangerouslySetInnerHTML!=null))throw Error(i(137,f));if(g.dangerouslySetInnerHTML!=null){if(g.children!=null)throw Error(i(60));if(typeof g.dangerouslySetInnerHTML!="object"||!("__html"in g.dangerouslySetInnerHTML))throw Error(i(61))}if(g.style!=null&&typeof g.style!="object")throw Error(i(62))}}function On(f,g){if(f.indexOf("-")===-1)return typeof g.is=="string";switch(f){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var or=null;function Fi(f){return f=f.target||f.srcElement||window,f.correspondingUseElement&&(f=f.correspondingUseElement),f.nodeType===3?f.parentNode:f}var Cc=null,us=null,Ta=null;function Io(f){if(f=pm(f)){if(typeof Cc!="function")throw Error(i(280));var g=f.stateNode;g&&(g=mm(g),Cc(f.stateNode,f.type,g))}}function wa(f){us?Ta?Ta.push(f):Ta=[f]:us=f}function Ca(){if(us){var f=us,g=Ta;if(Ta=us=null,Io(f),g)for(f=0;f<g.length;f++)Io(g[f])}}function co(f,g){return f(g)}function Es(){}var ds=!1;function Ho(f,g,T){if(ds)return f(g,T);ds=!0;try{return co(f,g,T)}finally{ds=!1,(us!==null||Ta!==null)&&(Es(),Ca())}}function $i(f,g){var T=f.stateNode;if(T===null)return null;var k=mm(T);if(k===null)return null;T=k[g];e:switch(g){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(k=!k.disabled)||(f=f.type,k=!(f==="button"||f==="input"||f==="select"||f==="textarea")),f=!k;break e;default:f=!1}if(f)return null;if(T&&typeof T!="function")throw Error(i(231,g,typeof T));return T}var vs=!1;if(_)try{var rc={};Object.defineProperty(rc,"passive",{get:function(){vs=!0}}),window.addEventListener("test",rc,rc),window.removeEventListener("test",rc,rc)}catch{vs=!1}function ju(f,g,T,k,U,H,ce,Ae,Ue){var it=Array.prototype.slice.call(arguments,3);try{g.apply(T,it)}catch(Pt){this.onError(Pt)}}var Rc=!1,Ra=null,Ia=!1,zd=null,Gg={onError:function(f){Rc=!0,Ra=f}};function Bu(f,g,T,k,U,H,ce,Ae,Ue){Rc=!1,Ra=null,ju.apply(Gg,arguments)}function Sf(f,g,T,k,U,H,ce,Ae,Ue){if(Bu.apply(this,arguments),Rc){if(Rc){var it=Ra;Rc=!1,Ra=null}else throw Error(i(198));Ia||(Ia=!0,zd=it)}}function Xs(f){var g=f,T=f;if(f.alternate)for(;g.return;)g=g.return;else{f=g;do g=f,(g.flags&4098)!==0&&(T=g.return),f=g.return;while(f)}return g.tag===3?T:null}function Wu(f){if(f.tag===13){var g=f.memoizedState;if(g===null&&(f=f.alternate,f!==null&&(g=f.memoizedState)),g!==null)return g.dehydrated}return null}function Aa(f){if(Xs(f)!==f)throw Error(i(188))}function Gd(f){var g=f.alternate;if(!g){if(g=Xs(f),g===null)throw Error(i(188));return g!==f?null:f}for(var T=f,k=g;;){var U=T.return;if(U===null)break;var H=U.alternate;if(H===null){if(k=U.return,k!==null){T=k;continue}break}if(U.child===H.child){for(H=U.child;H;){if(H===T)return Aa(U),f;if(H===k)return Aa(U),g;H=H.sibling}throw Error(i(188))}if(T.return!==k.return)T=U,k=H;else{for(var ce=!1,Ae=U.child;Ae;){if(Ae===T){ce=!0,T=U,k=H;break}if(Ae===k){ce=!0,k=U,T=H;break}Ae=Ae.sibling}if(!ce){for(Ae=H.child;Ae;){if(Ae===T){ce=!0,T=H,k=U;break}if(Ae===k){ce=!0,k=H,T=U;break}Ae=Ae.sibling}if(!ce)throw Error(i(189))}}if(T.alternate!==k)throw Error(i(190))}if(T.tag!==3)throw Error(i(188));return T.stateNode.current===T?f:g}function Hd(f){return f=Gd(f),f!==null?ic(f):null}function ic(f){if(f.tag===5||f.tag===6)return f;for(f=f.child;f!==null;){var g=ic(f);if(g!==null)return g;f=f.sibling}return null}var $d=e.unstable_scheduleCallback,zu=e.unstable_cancelCallback,$o=e.unstable_shouldYield,Kd=e.unstable_requestPaint,Kr=e.unstable_now,Ci=e.unstable_getCurrentPriorityLevel,Ic=e.unstable_ImmediatePriority,fl=e.unstable_UserBlockingPriority,Pa=e.unstable_NormalPriority,bf=e.unstable_LowPriority,qd=e.unstable_IdlePriority,Kl=null,Ao=null;function Zp(f){if(Ao&&typeof Ao.onCommitFiberRoot=="function")try{Ao.onCommitFiberRoot(Kl,f,void 0,(f.current.flags&128)===128)}catch{}}var lo=Math.clz32?Math.clz32:Yd,Tf=Math.log,pl=Math.LN2;function Yd(f){return f>>>=0,f===0?32:31-(Tf(f)/pl|0)|0}var Xd=64,_r=4194304;function ql(f){switch(f&-f){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return f&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return f&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return f}}function Yl(f,g){var T=f.pendingLanes;if(T===0)return 0;var k=0,U=f.suspendedLanes,H=f.pingedLanes,ce=T&268435455;if(ce!==0){var Ae=ce&~U;Ae!==0?k=ql(Ae):(H&=ce,H!==0&&(k=ql(H)))}else ce=T&~U,ce!==0?k=ql(ce):H!==0&&(k=ql(H));if(k===0)return 0;if(g!==0&&g!==k&&(g&U)===0&&(U=k&-k,H=g&-g,U>=H||U===16&&(H&4194240)!==0))return g;if((k&4)!==0&&(k|=T&16),g=f.entangledLanes,g!==0)for(f=f.entanglements,g&=k;0<g;)T=31-lo(g),U=1<<T,k|=f[T],g&=~U;return k}function Gu(f,g){switch(f){case 1:case 2:case 4:return g+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return g+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function sc(f,g){for(var T=f.suspendedLanes,k=f.pingedLanes,U=f.expirationTimes,H=f.pendingLanes;0<H;){var ce=31-lo(H),Ae=1<<ce,Ue=U[ce];Ue===-1?((Ae&T)===0||(Ae&k)!==0)&&(U[ce]=Gu(Ae,g)):Ue<=g&&(f.expiredLanes|=Ae),H&=~Ae}}function Ko(f){return f=f.pendingLanes&-1073741825,f!==0?f:f&1073741824?1073741824:0}function Hu(){var f=Xd;return Xd<<=1,(Xd&4194240)===0&&(Xd=64),f}function ml(f){for(var g=[],T=0;31>T;T++)g.push(f);return g}function Xl(f,g,T){f.pendingLanes|=g,g!==536870912&&(f.suspendedLanes=0,f.pingedLanes=0),f=f.eventTimes,g=31-lo(g),f[g]=T}function Zr(f,g){var T=f.pendingLanes&~g;f.pendingLanes=g,f.suspendedLanes=0,f.pingedLanes=0,f.expiredLanes&=g,f.mutableReadLanes&=g,f.entangledLanes&=g,g=f.entanglements;var k=f.eventTimes;for(f=f.expirationTimes;0<T;){var U=31-lo(T),H=1<<U;g[U]=0,k[U]=-1,f[U]=-1,T&=~H}}function oc(f,g){var T=f.entangledLanes|=g;for(f=f.entanglements;T;){var k=31-lo(T),U=1<<k;U&g|f[k]&g&&(f[k]|=g),T&=~U}}var ar=0;function Ac(f){return f&=-f,1<f?4<f?(f&268435455)!==0?16:536870912:4:1}var em,Jl,Jd,wf,tm,Cf=!1,qo=[],hs=null,Yo=null,Xo=null,Ql=new Map,Jo=new Map,Qo=[],nm="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Pc(f,g){switch(f){case"focusin":case"focusout":hs=null;break;case"dragenter":case"dragleave":Yo=null;break;case"mouseover":case"mouseout":Xo=null;break;case"pointerover":case"pointerout":Ql.delete(g.pointerId);break;case"gotpointercapture":case"lostpointercapture":Jo.delete(g.pointerId)}}function Ss(f,g,T,k,U,H){return f===null||f.nativeEvent!==H?(f={blockedOn:g,domEventName:T,eventSystemFlags:k,nativeEvent:H,targetContainers:[U]},g!==null&&(g=pm(g),g!==null&&Jl(g)),f):(f.eventSystemFlags|=k,g=f.targetContainers,U!==null&&g.indexOf(U)===-1&&g.push(U),f)}function $u(f,g,T,k,U){switch(g){case"focusin":return hs=Ss(hs,f,g,T,k,U),!0;case"dragenter":return Yo=Ss(Yo,f,g,T,k,U),!0;case"mouseover":return Xo=Ss(Xo,f,g,T,k,U),!0;case"pointerover":var H=U.pointerId;return Ql.set(H,Ss(Ql.get(H)||null,f,g,T,k,U)),!0;case"gotpointercapture":return H=U.pointerId,Jo.set(H,Ss(Jo.get(H)||null,f,g,T,k,U)),!0}return!1}function Rf(f){var g=xf(f.target);if(g!==null){var T=Xs(g);if(T!==null){if(g=T.tag,g===13){if(g=Wu(T),g!==null){f.blockedOn=g,tm(f.priority,function(){Jd(T)});return}}else if(g===3&&T.stateNode.current.memoizedState.isDehydrated){f.blockedOn=T.tag===3?T.stateNode.containerInfo:null;return}}}f.blockedOn=null}function gl(f){if(f.blockedOn!==null)return!1;for(var g=f.targetContainers;0<g.length;){var T=Tr(f.domEventName,f.eventSystemFlags,g[0],f.nativeEvent);if(T===null){T=f.nativeEvent;var k=new T.constructor(T.type,T);or=k,T.target.dispatchEvent(k),or=null}else return g=pm(T),g!==null&&Jl(g),f.blockedOn=T,!1;g.shift()}return!0}function Zl(f,g,T){gl(f)&&T.delete(g)}function rm(){Cf=!1,hs!==null&&gl(hs)&&(hs=null),Yo!==null&&gl(Yo)&&(Yo=null),Xo!==null&&gl(Xo)&&(Xo=null),Ql.forEach(Zl),Jo.forEach(Zl)}function Oa(f,g){f.blockedOn===g&&(f.blockedOn=null,Cf||(Cf=!0,e.unstable_scheduleCallback(e.unstable_NormalPriority,rm)))}function ka(f){function g(U){return Oa(U,f)}if(0<qo.length){Oa(qo[0],f);for(var T=1;T<qo.length;T++){var k=qo[T];k.blockedOn===f&&(k.blockedOn=null)}}for(hs!==null&&Oa(hs,f),Yo!==null&&Oa(Yo,f),Xo!==null&&Oa(Xo,f),Ql.forEach(g),Jo.forEach(g),T=0;T<Qo.length;T++)k=Qo[T],k.blockedOn===f&&(k.blockedOn=null);for(;0<Qo.length&&(T=Qo[0],T.blockedOn===null);)Rf(T),T.blockedOn===null&&Qo.shift()}var _l=ue.ReactCurrentBatchConfig,Ce=!0;function De(f,g,T,k){var U=ar,H=_l.transition;_l.transition=null;try{ar=1,Qt(f,g,T,k)}finally{ar=U,_l.transition=H}}function rt(f,g,T,k){var U=ar,H=_l.transition;_l.transition=null;try{ar=4,Qt(f,g,T,k)}finally{ar=U,_l.transition=H}}function Qt(f,g,T,k){if(Ce){var U=Tr(f,g,T,k);if(U===null)fE(f,g,k,Jn,T),Pc(f,k);else if($u(U,f,g,T,k))k.stopPropagation();else if(Pc(f,k),g&4&&-1<nm.indexOf(f)){for(;U!==null;){var H=pm(U);if(H!==null&&em(H),H=Tr(f,g,T,k),H===null&&fE(f,g,k,Jn,T),H===U)break;U=H}U!==null&&k.stopPropagation()}else fE(f,g,k,null,T)}}var Jn=null;function Tr(f,g,T,k){if(Jn=null,f=Fi(k),f=xf(f),f!==null)if(g=Xs(f),g===null)f=null;else if(T=g.tag,T===13){if(f=Wu(g),f!==null)return f;f=null}else if(T===3){if(g.stateNode.current.memoizedState.isDehydrated)return g.tag===3?g.stateNode.containerInfo:null;f=null}else g!==f&&(f=null);return Jn=f,null}function qr(f){switch(f){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Ci()){case Ic:return 1;case fl:return 4;case Pa:case bf:return 16;case qd:return 536870912;default:return 16}default:return 16}}var fn=null,jr=null,Ri=null;function Fs(){if(Ri)return Ri;var f,g=jr,T=g.length,k,U="value"in fn?fn.value:fn.textContent,H=U.length;for(f=0;f<T&&g[f]===U[f];f++);var ce=T-f;for(k=1;k<=ce&&g[T-k]===U[H-k];k++);return Ri=U.slice(f,1<k?1-k:void 0)}function Zo(f){var g=f.keyCode;return"charCode"in f?(f=f.charCode,f===0&&g===13&&(f=13)):f=g,f===10&&(f=13),32<=f||f===13?f:0}function ea(){return!0}function Ku(){return!1}function is(f){function g(T,k,U,H,ce){this._reactName=T,this._targetInst=U,this.type=k,this.nativeEvent=H,this.target=ce,this.currentTarget=null;for(var Ae in f)f.hasOwnProperty(Ae)&&(T=f[Ae],this[Ae]=T?T(H):H[Ae]);return this.isDefaultPrevented=(H.defaultPrevented!=null?H.defaultPrevented:H.returnValue===!1)?ea:Ku,this.isPropagationStopped=Ku,this}return ke(g.prototype,{preventDefault:function(){this.defaultPrevented=!0;var T=this.nativeEvent;T&&(T.preventDefault?T.preventDefault():typeof T.returnValue!="unknown"&&(T.returnValue=!1),this.isDefaultPrevented=ea)},stopPropagation:function(){var T=this.nativeEvent;T&&(T.stopPropagation?T.stopPropagation():typeof T.cancelBubble!="unknown"&&(T.cancelBubble=!0),this.isPropagationStopped=ea)},persist:function(){},isPersistent:ea}),g}var yl={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(f){return f.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Qd=is(yl),Oc=ke({},yl,{view:0,detail:0}),Hg=is(Oc),im,qu,ta,eu=ke({},Oc,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:kc,button:0,buttons:0,relatedTarget:function(f){return f.relatedTarget===void 0?f.fromElement===f.srcElement?f.toElement:f.fromElement:f.relatedTarget},movementX:function(f){return"movementX"in f?f.movementX:(f!==ta&&(ta&&f.type==="mousemove"?(im=f.screenX-ta.screenX,qu=f.screenY-ta.screenY):qu=im=0,ta=f),im)},movementY:function(f){return"movementY"in f?f.movementY:qu}}),sm=is(eu),$g=ke({},eu,{dataTransfer:0}),sE=is($g),om=ke({},Oc,{relatedTarget:0}),am=is(om),Yu=ke({},yl,{animationName:0,elapsedTime:0,pseudoElement:0}),Xu=is(Yu),Ju=ke({},yl,{clipboardData:function(f){return"clipboardData"in f?f.clipboardData:window.clipboardData}}),Kg=is(Ju),oE=ke({},yl,{data:0}),Wn=is(oE),cm={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},na={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},aE={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function cE(f){var g=this.nativeEvent;return g.getModifierState?g.getModifierState(f):(f=aE[f])?!!g[f]:!1}function kc(){return cE}var A=ke({},Oc,{key:function(f){if(f.key){var g=cm[f.key]||f.key;if(g!=="Unidentified")return g}return f.type==="keypress"?(f=Zo(f),f===13?"Enter":String.fromCharCode(f)):f.type==="keydown"||f.type==="keyup"?na[f.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:kc,charCode:function(f){return f.type==="keypress"?Zo(f):0},keyCode:function(f){return f.type==="keydown"||f.type==="keyup"?f.keyCode:0},which:function(f){return f.type==="keypress"?Zo(f):f.type==="keydown"||f.type==="keyup"?f.keyCode:0}}),z=is(A),ne=ke({},eu,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),ge=is(ne),qe=ke({},Oc,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:kc}),ct=is(qe),Vt=ke({},yl,{propertyName:0,elapsedTime:0,pseudoElement:0}),ei=is(Vt),gi=ke({},eu,{deltaX:function(f){return"deltaX"in f?f.deltaX:"wheelDeltaX"in f?-f.wheelDeltaX:0},deltaY:function(f){return"deltaY"in f?f.deltaY:"wheelDeltaY"in f?-f.wheelDeltaY:"wheelDelta"in f?-f.wheelDelta:0},deltaZ:0,deltaMode:0}),wr=is(gi),Js=[9,13,27,32],bs=_&&"CompositionEvent"in window,ac=null;_&&"documentMode"in document&&(ac=document.documentMode);var ra=_&&"TextEvent"in window&&!ac,If=_&&(!bs||ac&&8<ac&&11>=ac),lm=" ",cc=!1;function PR(f,g){switch(f){case"keyup":return Js.indexOf(g.keyCode)!==-1;case"keydown":return g.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function OR(f){return f=f.detail,typeof f=="object"&&"data"in f?f.data:null}var um=!1;function BN(f,g){switch(f){case"compositionend":return OR(g);case"keypress":return g.which!==32?null:(cc=!0,lm);case"textInput":return f=g.data,f===lm&&cc?null:f;default:return null}}function kR(f,g){if(um)return f==="compositionend"||!bs&&PR(f,g)?(f=Fs(),Ri=jr=fn=null,um=!1,f):null;switch(f){case"paste":return null;case"keypress":if(!(g.ctrlKey||g.altKey||g.metaKey)||g.ctrlKey&&g.altKey){if(g.char&&1<g.char.length)return g.char;if(g.which)return String.fromCharCode(g.which)}return null;case"compositionend":return If&&g.locale!=="ko"?null:g.data;default:return null}}var WN={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function NR(f){var g=f&&f.nodeName&&f.nodeName.toLowerCase();return g==="input"?!!WN[f.type]:g==="textarea"}function Q0(f,g,T,k){wa(k),g=pE(g,"onChange"),0<g.length&&(T=new Qd("onChange","change",null,T,k),f.push({event:T,listeners:g}))}var Af=null,qg=null;function zN(f){sb(f,0)}function Pf(f){var g=Lf(f);if(Mt(g))return f}function GN(f,g){if(f==="change")return g}var DR=!1;if(_){var Z0;if(_){var Nc="oninput"in document;if(!Nc){var xR=document.createElement("div");xR.setAttribute("oninput","return;"),Nc=typeof xR.oninput=="function"}Z0=Nc}else Z0=!1;DR=Z0&&(!document.documentMode||9<document.documentMode)}function LR(){Af&&(Af.detachEvent("onpropertychange",Na),qg=Af=null)}function Na(f){if(f.propertyName==="value"&&Pf(qg)){var g=[];Q0(g,qg,f,Fi(f)),Ho(zN,g)}}function HN(f,g,T){f==="focusin"?(LR(),Af=g,qg=T,Af.attachEvent("onpropertychange",Na)):f==="focusout"&&LR()}function $N(f){if(f==="selectionchange"||f==="keyup"||f==="keydown")return Pf(qg)}function KN(f,g){if(f==="click")return Pf(g)}function qN(f,g){if(f==="input"||f==="change")return Pf(g)}function MR(f,g){return f===g&&(f!==0||1/f===1/g)||f!==f&&g!==g}var El=typeof Object.is=="function"?Object.is:MR;function Yg(f,g){if(El(f,g))return!0;if(typeof f!="object"||f===null||typeof g!="object"||g===null)return!1;var T=Object.keys(f),k=Object.keys(g);if(T.length!==k.length)return!1;for(k=0;k<T.length;k++){var U=T[k];if(!E.call(g,U)||!El(f[U],g[U]))return!1}return!0}function UR(f){for(;f&&f.firstChild;)f=f.firstChild;return f}function eb(f,g){var T=UR(f);f=0;for(var k;T;){if(T.nodeType===3){if(k=f+T.textContent.length,f<=g&&k>=g)return{node:T,offset:g-f};f=k}e:{for(;T;){if(T.nextSibling){T=T.nextSibling;break e}T=T.parentNode}T=void 0}T=UR(T)}}function VR(f,g){return f&&g?f===g?!0:f&&f.nodeType===3?!1:g&&g.nodeType===3?VR(f,g.parentNode):"contains"in f?f.contains(g):f.compareDocumentPosition?!!(f.compareDocumentPosition(g)&16):!1:!1}function FR(){for(var f=window,g=Zt();g instanceof f.HTMLIFrameElement;){try{var T=typeof g.contentWindow.location.href=="string"}catch{T=!1}if(T)f=g.contentWindow;else break;g=Zt(f.document)}return g}function Xg(f){var g=f&&f.nodeName&&f.nodeName.toLowerCase();return g&&(g==="input"&&(f.type==="text"||f.type==="search"||f.type==="tel"||f.type==="url"||f.type==="password")||g==="textarea"||f.contentEditable==="true")}function tb(f){var g=FR(),T=f.focusedElem,k=f.selectionRange;if(g!==T&&T&&T.ownerDocument&&VR(T.ownerDocument.documentElement,T)){if(k!==null&&Xg(T)){if(g=k.start,f=k.end,f===void 0&&(f=g),"selectionStart"in T)T.selectionStart=g,T.selectionEnd=Math.min(f,T.value.length);else if(f=(g=T.ownerDocument||document)&&g.defaultView||window,f.getSelection){f=f.getSelection();var U=T.textContent.length,H=Math.min(k.start,U);k=k.end===void 0?H:Math.min(k.end,U),!f.extend&&H>k&&(U=k,k=H,H=U),U=eb(T,H);var ce=eb(T,k);U&&ce&&(f.rangeCount!==1||f.anchorNode!==U.node||f.anchorOffset!==U.offset||f.focusNode!==ce.node||f.focusOffset!==ce.offset)&&(g=g.createRange(),g.setStart(U.node,U.offset),f.removeAllRanges(),H>k?(f.addRange(g),f.extend(ce.node,ce.offset)):(g.setEnd(ce.node,ce.offset),f.addRange(g)))}}for(g=[],f=T;f=f.parentNode;)f.nodeType===1&&g.push({element:f,left:f.scrollLeft,top:f.scrollTop});for(typeof T.focus=="function"&&T.focus(),T=0;T<g.length;T++)f=g[T],f.element.scrollLeft=f.left,f.element.scrollTop=f.top}}var YN=_&&"documentMode"in document&&11>=document.documentMode,ot=null,nb=null,Jg=null,rb=!1;function jR(f,g,T){var k=T.window===T?T.document:T.nodeType===9?T:T.ownerDocument;rb||ot==null||ot!==Zt(k)||(k=ot,"selectionStart"in k&&Xg(k)?k={start:k.selectionStart,end:k.selectionEnd}:(k=(k.ownerDocument&&k.ownerDocument.defaultView||window).getSelection(),k={anchorNode:k.anchorNode,anchorOffset:k.anchorOffset,focusNode:k.focusNode,focusOffset:k.focusOffset}),Jg&&Yg(Jg,k)||(Jg=k,k=pE(nb,"onSelect"),0<k.length&&(g=new Qd("onSelect","select",null,g,T),f.push({event:g,listeners:k}),g.target=ot)))}function lE(f,g){var T={};return T[f.toLowerCase()]=g.toLowerCase(),T["Webkit"+f]="webkit"+g,T["Moz"+f]="moz"+g,T}var dm={animationend:lE("Animation","AnimationEnd"),animationiteration:lE("Animation","AnimationIteration"),animationstart:lE("Animation","AnimationStart"),transitionend:lE("Transition","TransitionEnd")},ib={},BR={};_&&(BR=document.createElement("div").style,"AnimationEvent"in window||(delete dm.animationend.animation,delete dm.animationiteration.animation,delete dm.animationstart.animation),"TransitionEvent"in window||delete dm.transitionend.transition);function Of(f){if(ib[f])return ib[f];if(!dm[f])return f;var g=dm[f],T;for(T in g)if(g.hasOwnProperty(T)&&T in BR)return ib[f]=g[T];return f}var kf=Of("animationend"),WR=Of("animationiteration"),zR=Of("animationstart"),GR=Of("transitionend"),HR=new Map,uE="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Zd(f,g){HR.set(f,g),d(g,[f])}for(var dE=0;dE<uE.length;dE++){var lc=uE[dE],XN=lc.toLowerCase(),Qg=lc[0].toUpperCase()+lc.slice(1);Zd(XN,"on"+Qg)}Zd(kf,"onAnimationEnd"),Zd(WR,"onAnimationIteration"),Zd(zR,"onAnimationStart"),Zd("dblclick","onDoubleClick"),Zd("focusin","onFocus"),Zd("focusout","onBlur"),Zd(GR,"onTransitionEnd"),p("onMouseEnter",["mouseout","mouseover"]),p("onMouseLeave",["mouseout","mouseover"]),p("onPointerEnter",["pointerout","pointerover"]),p("onPointerLeave",["pointerout","pointerover"]),d("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),d("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),d("onBeforeInput",["compositionend","keypress","textInput","paste"]),d("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),d("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),d("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Zg="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),JN=new Set("cancel close invalid load scroll toggle".split(" ").concat(Zg));function $R(f,g,T){var k=f.type||"unknown-event";f.currentTarget=T,Sf(k,g,void 0,f),f.currentTarget=null}function sb(f,g){g=(g&4)!==0;for(var T=0;T<f.length;T++){var k=f[T],U=k.event;k=k.listeners;e:{var H=void 0;if(g)for(var ce=k.length-1;0<=ce;ce--){var Ae=k[ce],Ue=Ae.instance,it=Ae.currentTarget;if(Ae=Ae.listener,Ue!==H&&U.isPropagationStopped())break e;$R(U,Ae,it),H=Ue}else for(ce=0;ce<k.length;ce++){if(Ae=k[ce],Ue=Ae.instance,it=Ae.currentTarget,Ae=Ae.listener,Ue!==H&&U.isPropagationStopped())break e;$R(U,Ae,it),H=Ue}}}if(Ia)throw f=zd,Ia=!1,zd=null,f}function Di(f,g){var T=g[r_];T===void 0&&(T=g[r_]=new Set);var k=f+"__bubble";T.has(k)||(KR(g,f,2,!1),T.add(k))}function ob(f,g,T){var k=0;g&&(k|=4),KR(T,f,k,g)}var hE="_reactListening"+Math.random().toString(36).slice(2);function Nf(f){if(!f[hE]){f[hE]=!0,o.forEach(function(T){T!=="selectionchange"&&(JN.has(T)||ob(T,!1,f),ob(T,!0,f))});var g=f.nodeType===9?f:f.ownerDocument;g===null||g[hE]||(g[hE]=!0,ob("selectionchange",!1,g))}}function KR(f,g,T,k){switch(qr(g)){case 1:var U=De;break;case 4:U=rt;break;default:U=Qt}T=U.bind(null,g,T,f),U=void 0,!vs||g!=="touchstart"&&g!=="touchmove"&&g!=="wheel"||(U=!0),k?U!==void 0?f.addEventListener(g,T,{capture:!0,passive:U}):f.addEventListener(g,T,!0):U!==void 0?f.addEventListener(g,T,{passive:U}):f.addEventListener(g,T,!1)}function fE(f,g,T,k,U){var H=k;if((g&1)===0&&(g&2)===0&&k!==null)e:for(;;){if(k===null)return;var ce=k.tag;if(ce===3||ce===4){var Ae=k.stateNode.containerInfo;if(Ae===U||Ae.nodeType===8&&Ae.parentNode===U)break;if(ce===4)for(ce=k.return;ce!==null;){var Ue=ce.tag;if((Ue===3||Ue===4)&&(Ue=ce.stateNode.containerInfo,Ue===U||Ue.nodeType===8&&Ue.parentNode===U))return;ce=ce.return}for(;Ae!==null;){if(ce=xf(Ae),ce===null)return;if(Ue=ce.tag,Ue===5||Ue===6){k=H=ce;continue e}Ae=Ae.parentNode}}k=k.return}Ho(function(){var it=H,Pt=Fi(T),kt=[];e:{var At=HR.get(f);if(At!==void 0){var Xt=Qd,rn=f;switch(f){case"keypress":if(Zo(T)===0)break e;case"keydown":case"keyup":Xt=z;break;case"focusin":rn="focus",Xt=am;break;case"focusout":rn="blur",Xt=am;break;case"beforeblur":case"afterblur":Xt=am;break;case"click":if(T.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Xt=sm;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Xt=sE;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Xt=ct;break;case kf:case WR:case zR:Xt=Xu;break;case GR:Xt=ei;break;case"scroll":Xt=Hg;break;case"wheel":Xt=wr;break;case"copy":case"cut":case"paste":Xt=Kg;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Xt=ge}var sn=(g&4)!==0,os=!sn&&f==="scroll",Xe=sn?At!==null?At+"Capture":null:At;sn=[];for(var Ve=it,et;Ve!==null;){et=Ve;var Lt=et.stateNode;if(et.tag===5&&Lt!==null&&(et=Lt,Xe!==null&&(Lt=$i(Ve,Xe),Lt!=null&&sn.push(hm(Ve,Lt,et)))),os)break;Ve=Ve.return}0<sn.length&&(At=new Xt(At,rn,null,T,Pt),kt.push({event:At,listeners:sn}))}}if((g&7)===0){e:{if(At=f==="mouseover"||f==="pointerover",Xt=f==="mouseout"||f==="pointerout",At&&T!==or&&(rn=T.relatedTarget||T.fromElement)&&(xf(rn)||rn[Dc]))break e;if((Xt||At)&&(At=Pt.window===Pt?Pt:(At=Pt.ownerDocument)?At.defaultView||At.parentWindow:window,Xt?(rn=T.relatedTarget||T.toElement,Xt=it,rn=rn?xf(rn):null,rn!==null&&(os=Xs(rn),rn!==os||rn.tag!==5&&rn.tag!==6)&&(rn=null)):(Xt=null,rn=it),Xt!==rn)){if(sn=sm,Lt="onMouseLeave",Xe="onMouseEnter",Ve="mouse",(f==="pointerout"||f==="pointerover")&&(sn=ge,Lt="onPointerLeave",Xe="onPointerEnter",Ve="pointer"),os=Xt==null?At:Lf(Xt),et=rn==null?At:Lf(rn),At=new sn(Lt,Ve+"leave",Xt,T,Pt),At.target=os,At.relatedTarget=et,Lt=null,xf(Pt)===it&&(sn=new sn(Xe,Ve+"enter",rn,T,Pt),sn.target=et,sn.relatedTarget=os,Lt=sn),os=Lt,Xt&&rn)t:{for(sn=Xt,Xe=rn,Ve=0,et=sn;et;et=Df(et))Ve++;for(et=0,Lt=Xe;Lt;Lt=Df(Lt))et++;for(;0<Ve-et;)sn=Df(sn),Ve--;for(;0<et-Ve;)Xe=Df(Xe),et--;for(;Ve--;){if(sn===Xe||Xe!==null&&sn===Xe.alternate)break t;sn=Df(sn),Xe=Df(Xe)}sn=null}else sn=null;Xt!==null&&e_(kt,At,Xt,sn,!1),rn!==null&&os!==null&&e_(kt,os,rn,sn,!0)}}e:{if(At=it?Lf(it):window,Xt=At.nodeName&&At.nodeName.toLowerCase(),Xt==="select"||Xt==="input"&&At.type==="file")var cn=GN;else if(NR(At))if(DR)cn=qN;else{cn=$N;var _n=HN}else(Xt=At.nodeName)&&Xt.toLowerCase()==="input"&&(At.type==="checkbox"||At.type==="radio")&&(cn=KN);if(cn&&(cn=cn(f,it))){Q0(kt,cn,T,Pt);break e}_n&&_n(f,At,it),f==="focusout"&&(_n=At._wrapperState)&&_n.controlled&&At.type==="number"&&Fe(At,"number",At.value)}switch(_n=it?Lf(it):window,f){case"focusin":(NR(_n)||_n.contentEditable==="true")&&(ot=_n,nb=it,Jg=null);break;case"focusout":Jg=nb=ot=null;break;case"mousedown":rb=!0;break;case"contextmenu":case"mouseup":case"dragend":rb=!1,jR(kt,T,Pt);break;case"selectionchange":if(YN)break;case"keydown":case"keyup":jR(kt,T,Pt)}var bn;if(bs)e:{switch(f){case"compositionstart":var Un="onCompositionStart";break e;case"compositionend":Un="onCompositionEnd";break e;case"compositionupdate":Un="onCompositionUpdate";break e}Un=void 0}else um?PR(f,T)&&(Un="onCompositionEnd"):f==="keydown"&&T.keyCode===229&&(Un="onCompositionStart");Un&&(If&&T.locale!=="ko"&&(um||Un!=="onCompositionStart"?Un==="onCompositionEnd"&&um&&(bn=Fs()):(fn=Pt,jr="value"in fn?fn.value:fn.textContent,um=!0)),_n=pE(it,Un),0<_n.length&&(Un=new Wn(Un,f,null,T,Pt),kt.push({event:Un,listeners:_n}),bn?Un.data=bn:(bn=OR(T),bn!==null&&(Un.data=bn)))),(bn=ra?BN(f,T):kR(f,T))&&(it=pE(it,"onBeforeInput"),0<it.length&&(Pt=new Wn("onBeforeInput","beforeinput",null,T,Pt),kt.push({event:Pt,listeners:it}),Pt.data=bn))}sb(kt,g)})}function hm(f,g,T){return{instance:f,listener:g,currentTarget:T}}function pE(f,g){for(var T=g+"Capture",k=[];f!==null;){var U=f,H=U.stateNode;U.tag===5&&H!==null&&(U=H,H=$i(f,T),H!=null&&k.unshift(hm(f,H,U)),H=$i(f,g),H!=null&&k.push(hm(f,H,U))),f=f.return}return k}function Df(f){if(f===null)return null;do f=f.return;while(f&&f.tag!==5);return f||null}function e_(f,g,T,k,U){for(var H=g._reactName,ce=[];T!==null&&T!==k;){var Ae=T,Ue=Ae.alternate,it=Ae.stateNode;if(Ue!==null&&Ue===k)break;Ae.tag===5&&it!==null&&(Ae=it,U?(Ue=$i(T,H),Ue!=null&&ce.unshift(hm(T,Ue,Ae))):U||(Ue=$i(T,H),Ue!=null&&ce.push(hm(T,Ue,Ae)))),T=T.return}ce.length!==0&&f.push({event:g,listeners:ce})}var QN=/\r\n?/g,ZN=/\u0000|\uFFFD/g;function qR(f){return(typeof f=="string"?f:""+f).replace(QN,`
`).replace(ZN,"")}function mE(f,g,T){if(g=qR(g),qR(f)!==g&&T)throw Error(i(425))}function gE(){}var _E=null,t_=null;function ab(f,g){return f==="textarea"||f==="noscript"||typeof g.children=="string"||typeof g.children=="number"||typeof g.dangerouslySetInnerHTML=="object"&&g.dangerouslySetInnerHTML!==null&&g.dangerouslySetInnerHTML.__html!=null}var n_=typeof setTimeout=="function"?setTimeout:void 0,eD=typeof clearTimeout=="function"?clearTimeout:void 0,YR=typeof Promise=="function"?Promise:void 0,tD=typeof queueMicrotask=="function"?queueMicrotask:typeof YR<"u"?function(f){return YR.resolve(null).then(f).catch(nD)}:n_;function nD(f){setTimeout(function(){throw f})}function cb(f,g){var T=g,k=0;do{var U=T.nextSibling;if(f.removeChild(T),U&&U.nodeType===8)if(T=U.data,T==="/$"){if(k===0){f.removeChild(U),ka(g);return}k--}else T!=="$"&&T!=="$?"&&T!=="$!"||k++;T=U}while(T);ka(g)}function eh(f){for(;f!=null;f=f.nextSibling){var g=f.nodeType;if(g===1||g===3)break;if(g===8){if(g=f.data,g==="$"||g==="$!"||g==="$?")break;if(g==="/$")return null}}return f}function XR(f){f=f.previousSibling;for(var g=0;f;){if(f.nodeType===8){var T=f.data;if(T==="$"||T==="$!"||T==="$?"){if(g===0)return f;g--}else T==="/$"&&g++}f=f.previousSibling}return null}var fm=Math.random().toString(36).slice(2),tu="__reactFiber$"+fm,th="__reactProps$"+fm,Dc="__reactContainer$"+fm,r_="__reactEvents$"+fm,rD="__reactListeners$"+fm,iD="__reactHandles$"+fm;function xf(f){var g=f[tu];if(g)return g;for(var T=f.parentNode;T;){if(g=T[Dc]||T[tu]){if(T=g.alternate,g.child!==null||T!==null&&T.child!==null)for(f=XR(f);f!==null;){if(T=f[tu])return T;f=XR(f)}return g}f=T,T=f.parentNode}return null}function pm(f){return f=f[tu]||f[Dc],!f||f.tag!==5&&f.tag!==6&&f.tag!==13&&f.tag!==3?null:f}function Lf(f){if(f.tag===5||f.tag===6)return f.stateNode;throw Error(i(33))}function mm(f){return f[th]||null}var lb=[],gm=-1;function xc(f){return{current:f}}function xi(f){0>gm||(f.current=lb[gm],lb[gm]=null,gm--)}function Ii(f,g){gm++,lb[gm]=f.current,f.current=g}var nh={},Po=xc(nh),Da=xc(!1),Mf=nh;function Uf(f,g){var T=f.type.contextTypes;if(!T)return nh;var k=f.stateNode;if(k&&k.__reactInternalMemoizedUnmaskedChildContext===g)return k.__reactInternalMemoizedMaskedChildContext;var U={},H;for(H in T)U[H]=g[H];return k&&(f=f.stateNode,f.__reactInternalMemoizedUnmaskedChildContext=g,f.__reactInternalMemoizedMaskedChildContext=U),U}function xa(f){return f=f.childContextTypes,f!=null}function yE(){xi(Da),xi(Po)}function JR(f,g,T){if(Po.current!==nh)throw Error(i(168));Ii(Po,g),Ii(Da,T)}function EE(f,g,T){var k=f.stateNode;if(g=g.childContextTypes,typeof k.getChildContext!="function")return T;k=k.getChildContext();for(var U in k)if(!(U in g))throw Error(i(108,tt(f)||"Unknown",U));return ke({},T,k)}function vE(f){return f=(f=f.stateNode)&&f.__reactInternalMemoizedMergedChildContext||nh,Mf=Po.current,Ii(Po,f),Ii(Da,Da.current),!0}function QR(f,g,T){var k=f.stateNode;if(!k)throw Error(i(169));T?(f=EE(f,g,Mf),k.__reactInternalMemoizedMergedChildContext=f,xi(Da),xi(Po),Ii(Po,f)):xi(Da),Ii(Da,T)}var Lc=null,SE=!1,ub=!1;function ZR(f){Lc===null?Lc=[f]:Lc.push(f)}function sD(f){SE=!0,ZR(f)}function rh(){if(!ub&&Lc!==null){ub=!0;var f=0,g=ar;try{var T=Lc;for(ar=1;f<T.length;f++){var k=T[f];do k=k(!0);while(k!==null)}Lc=null,SE=!1}catch(U){throw Lc!==null&&(Lc=Lc.slice(f+1)),$d(Ic,rh),U}finally{ar=g,ub=!1}}return null}var _m=[],Qu=0,i_=null,bE=0,Mc=[],uc=0,Vf=null,Zu=1,ed="";function td(f,g){_m[Qu++]=bE,_m[Qu++]=i_,i_=f,bE=g}function TE(f,g,T){Mc[uc++]=Zu,Mc[uc++]=ed,Mc[uc++]=Vf,Vf=f;var k=Zu;f=ed;var U=32-lo(k)-1;k&=~(1<<U),T+=1;var H=32-lo(g)+U;if(30<H){var ce=U-U%5;H=(k&(1<<ce)-1).toString(32),k>>=ce,U-=ce,Zu=1<<32-lo(g)+U|T<<U|k,ed=H+f}else Zu=1<<H|T<<U|k,ed=f}function wE(f){f.return!==null&&(td(f,1),TE(f,1,0))}function s_(f){for(;f===i_;)i_=_m[--Qu],_m[Qu]=null,bE=_m[--Qu],_m[Qu]=null;for(;f===Vf;)Vf=Mc[--uc],Mc[uc]=null,ed=Mc[--uc],Mc[uc]=null,Zu=Mc[--uc],Mc[uc]=null}var La=null,Ma=null,_i=!1,ia=null;function eI(f,g){var T=fc(5,null,null,0);T.elementType="DELETED",T.stateNode=g,T.return=f,g=f.deletions,g===null?(f.deletions=[T],f.flags|=16):g.push(T)}function tI(f,g){switch(f.tag){case 5:var T=f.type;return g=g.nodeType!==1||T.toLowerCase()!==g.nodeName.toLowerCase()?null:g,g!==null?(f.stateNode=g,La=f,Ma=eh(g.firstChild),!0):!1;case 6:return g=f.pendingProps===""||g.nodeType!==3?null:g,g!==null?(f.stateNode=g,La=f,Ma=null,!0):!1;case 13:return g=g.nodeType!==8?null:g,g!==null?(T=Vf!==null?{id:Zu,overflow:ed}:null,f.memoizedState={dehydrated:g,treeContext:T,retryLane:1073741824},T=fc(18,null,null,0),T.stateNode=g,T.return=f,f.child=T,La=f,Ma=null,!0):!1;default:return!1}}function CE(f){return(f.mode&1)!==0&&(f.flags&128)===0}function db(f){if(_i){var g=Ma;if(g){var T=g;if(!tI(f,g)){if(CE(f))throw Error(i(418));g=eh(T.nextSibling);var k=La;g&&tI(f,g)?eI(k,T):(f.flags=f.flags&-4097|2,_i=!1,La=f)}}else{if(CE(f))throw Error(i(418));f.flags=f.flags&-4097|2,_i=!1,La=f}}}function nI(f){for(f=f.return;f!==null&&f.tag!==5&&f.tag!==3&&f.tag!==13;)f=f.return;La=f}function o_(f){if(f!==La)return!1;if(!_i)return nI(f),_i=!0,!1;var g;if((g=f.tag!==3)&&!(g=f.tag!==5)&&(g=f.type,g=g!=="head"&&g!=="body"&&!ab(f.type,f.memoizedProps)),g&&(g=Ma)){if(CE(f))throw rI(),Error(i(418));for(;g;)eI(f,g),g=eh(g.nextSibling)}if(nI(f),f.tag===13){if(f=f.memoizedState,f=f!==null?f.dehydrated:null,!f)throw Error(i(317));e:{for(f=f.nextSibling,g=0;f;){if(f.nodeType===8){var T=f.data;if(T==="/$"){if(g===0){Ma=eh(f.nextSibling);break e}g--}else T!=="$"&&T!=="$!"&&T!=="$?"||g++}f=f.nextSibling}Ma=null}}else Ma=La?eh(f.stateNode.nextSibling):null;return!0}function rI(){for(var f=Ma;f;)f=eh(f.nextSibling)}function ym(){Ma=La=null,_i=!1}function hb(f){ia===null?ia=[f]:ia.push(f)}var oD=ue.ReactCurrentBatchConfig;function a_(f,g,T){if(f=T.ref,f!==null&&typeof f!="function"&&typeof f!="object"){if(T._owner){if(T=T._owner,T){if(T.tag!==1)throw Error(i(309));var k=T.stateNode}if(!k)throw Error(i(147,f));var U=k,H=""+f;return g!==null&&g.ref!==null&&typeof g.ref=="function"&&g.ref._stringRef===H?g.ref:(g=function(ce){var Ae=U.refs;ce===null?delete Ae[H]:Ae[H]=ce},g._stringRef=H,g)}if(typeof f!="string")throw Error(i(284));if(!T._owner)throw Error(i(290,f))}return f}function RE(f,g){throw f=Object.prototype.toString.call(g),Error(i(31,f==="[object Object]"?"object with keys {"+Object.keys(g).join(", ")+"}":f))}function fb(f){var g=f._init;return g(f._payload)}function ih(f){function g(Xe,Ve){if(f){var et=Xe.deletions;et===null?(Xe.deletions=[Ve],Xe.flags|=16):et.push(Ve)}}function T(Xe,Ve){if(!f)return null;for(;Ve!==null;)g(Xe,Ve),Ve=Ve.sibling;return null}function k(Xe,Ve){for(Xe=new Map;Ve!==null;)Ve.key!==null?Xe.set(Ve.key,Ve):Xe.set(Ve.index,Ve),Ve=Ve.sibling;return Xe}function U(Xe,Ve){return Xe=ld(Xe,Ve),Xe.index=0,Xe.sibling=null,Xe}function H(Xe,Ve,et){return Xe.index=et,f?(et=Xe.alternate,et!==null?(et=et.index,et<Ve?(Xe.flags|=2,Ve):et):(Xe.flags|=2,Ve)):(Xe.flags|=1048576,Ve)}function ce(Xe){return f&&Xe.alternate===null&&(Xe.flags|=2),Xe}function Ae(Xe,Ve,et,Lt){return Ve===null||Ve.tag!==6?(Ve=Xb(et,Xe.mode,Lt),Ve.return=Xe,Ve):(Ve=U(Ve,et),Ve.return=Xe,Ve)}function Ue(Xe,Ve,et,Lt){var cn=et.type;return cn===q?Pt(Xe,Ve,et.props.children,Lt,et.key):Ve!==null&&(Ve.elementType===cn||typeof cn=="object"&&cn!==null&&cn.$$typeof===$e&&fb(cn)===Ve.type)?(Lt=U(Ve,et.props),Lt.ref=a_(Xe,Ve,et),Lt.return=Xe,Lt):(Lt=hv(et.type,et.key,et.props,null,Xe.mode,Lt),Lt.ref=a_(Xe,Ve,et),Lt.return=Xe,Lt)}function it(Xe,Ve,et,Lt){return Ve===null||Ve.tag!==4||Ve.stateNode.containerInfo!==et.containerInfo||Ve.stateNode.implementation!==et.implementation?(Ve=Jb(et,Xe.mode,Lt),Ve.return=Xe,Ve):(Ve=U(Ve,et.children||[]),Ve.return=Xe,Ve)}function Pt(Xe,Ve,et,Lt,cn){return Ve===null||Ve.tag!==7?(Ve=Xf(et,Xe.mode,Lt,cn),Ve.return=Xe,Ve):(Ve=U(Ve,et),Ve.return=Xe,Ve)}function kt(Xe,Ve,et){if(typeof Ve=="string"&&Ve!==""||typeof Ve=="number")return Ve=Xb(""+Ve,Xe.mode,et),Ve.return=Xe,Ve;if(typeof Ve=="object"&&Ve!==null){switch(Ve.$$typeof){case re:return et=hv(Ve.type,Ve.key,Ve.props,null,Xe.mode,et),et.ref=a_(Xe,null,Ve),et.return=Xe,et;case pe:return Ve=Jb(Ve,Xe.mode,et),Ve.return=Xe,Ve;case $e:var Lt=Ve._init;return kt(Xe,Lt(Ve._payload),et)}if(Ge(Ve)||Ee(Ve))return Ve=Xf(Ve,Xe.mode,et,null),Ve.return=Xe,Ve;RE(Xe,Ve)}return null}function At(Xe,Ve,et,Lt){var cn=Ve!==null?Ve.key:null;if(typeof et=="string"&&et!==""||typeof et=="number")return cn!==null?null:Ae(Xe,Ve,""+et,Lt);if(typeof et=="object"&&et!==null){switch(et.$$typeof){case re:return et.key===cn?Ue(Xe,Ve,et,Lt):null;case pe:return et.key===cn?it(Xe,Ve,et,Lt):null;case $e:return cn=et._init,At(Xe,Ve,cn(et._payload),Lt)}if(Ge(et)||Ee(et))return cn!==null?null:Pt(Xe,Ve,et,Lt,null);RE(Xe,et)}return null}function Xt(Xe,Ve,et,Lt,cn){if(typeof Lt=="string"&&Lt!==""||typeof Lt=="number")return Xe=Xe.get(et)||null,Ae(Ve,Xe,""+Lt,cn);if(typeof Lt=="object"&&Lt!==null){switch(Lt.$$typeof){case re:return Xe=Xe.get(Lt.key===null?et:Lt.key)||null,Ue(Ve,Xe,Lt,cn);case pe:return Xe=Xe.get(Lt.key===null?et:Lt.key)||null,it(Ve,Xe,Lt,cn);case $e:var _n=Lt._init;return Xt(Xe,Ve,et,_n(Lt._payload),cn)}if(Ge(Lt)||Ee(Lt))return Xe=Xe.get(et)||null,Pt(Ve,Xe,Lt,cn,null);RE(Ve,Lt)}return null}function rn(Xe,Ve,et,Lt){for(var cn=null,_n=null,bn=Ve,Un=Ve=0,Is=null;bn!==null&&Un<et.length;Un++){bn.index>Un?(Is=bn,bn=null):Is=bn.sibling;var Cr=At(Xe,bn,et[Un],Lt);if(Cr===null){bn===null&&(bn=Is);break}f&&bn&&Cr.alternate===null&&g(Xe,bn),Ve=H(Cr,Ve,Un),_n===null?cn=Cr:_n.sibling=Cr,_n=Cr,bn=Is}if(Un===et.length)return T(Xe,bn),_i&&td(Xe,Un),cn;if(bn===null){for(;Un<et.length;Un++)bn=kt(Xe,et[Un],Lt),bn!==null&&(Ve=H(bn,Ve,Un),_n===null?cn=bn:_n.sibling=bn,_n=bn);return _i&&td(Xe,Un),cn}for(bn=k(Xe,bn);Un<et.length;Un++)Is=Xt(bn,Xe,Un,et[Un],Lt),Is!==null&&(f&&Is.alternate!==null&&bn.delete(Is.key===null?Un:Is.key),Ve=H(Is,Ve,Un),_n===null?cn=Is:_n.sibling=Is,_n=Is);return f&&bn.forEach(function(mh){return g(Xe,mh)}),_i&&td(Xe,Un),cn}function sn(Xe,Ve,et,Lt){var cn=Ee(et);if(typeof cn!="function")throw Error(i(150));if(et=cn.call(et),et==null)throw Error(i(151));for(var _n=cn=null,bn=Ve,Un=Ve=0,Is=null,Cr=et.next();bn!==null&&!Cr.done;Un++,Cr=et.next()){bn.index>Un?(Is=bn,bn=null):Is=bn.sibling;var mh=At(Xe,bn,Cr.value,Lt);if(mh===null){bn===null&&(bn=Is);break}f&&bn&&mh.alternate===null&&g(Xe,bn),Ve=H(mh,Ve,Un),_n===null?cn=mh:_n.sibling=mh,_n=mh,bn=Is}if(Cr.done)return T(Xe,bn),_i&&td(Xe,Un),cn;if(bn===null){for(;!Cr.done;Un++,Cr=et.next())Cr=kt(Xe,Cr.value,Lt),Cr!==null&&(Ve=H(Cr,Ve,Un),_n===null?cn=Cr:_n.sibling=Cr,_n=Cr);return _i&&td(Xe,Un),cn}for(bn=k(Xe,bn);!Cr.done;Un++,Cr=et.next())Cr=Xt(bn,Xe,Un,Cr.value,Lt),Cr!==null&&(f&&Cr.alternate!==null&&bn.delete(Cr.key===null?Un:Cr.key),Ve=H(Cr,Ve,Un),_n===null?cn=Cr:_n.sibling=Cr,_n=Cr);return f&&bn.forEach(function(bD){return g(Xe,bD)}),_i&&td(Xe,Un),cn}function os(Xe,Ve,et,Lt){if(typeof et=="object"&&et!==null&&et.type===q&&et.key===null&&(et=et.props.children),typeof et=="object"&&et!==null){switch(et.$$typeof){case re:e:{for(var cn=et.key,_n=Ve;_n!==null;){if(_n.key===cn){if(cn=et.type,cn===q){if(_n.tag===7){T(Xe,_n.sibling),Ve=U(_n,et.props.children),Ve.return=Xe,Xe=Ve;break e}}else if(_n.elementType===cn||typeof cn=="object"&&cn!==null&&cn.$$typeof===$e&&fb(cn)===_n.type){T(Xe,_n.sibling),Ve=U(_n,et.props),Ve.ref=a_(Xe,_n,et),Ve.return=Xe,Xe=Ve;break e}T(Xe,_n);break}else g(Xe,_n);_n=_n.sibling}et.type===q?(Ve=Xf(et.props.children,Xe.mode,Lt,et.key),Ve.return=Xe,Xe=Ve):(Lt=hv(et.type,et.key,et.props,null,Xe.mode,Lt),Lt.ref=a_(Xe,Ve,et),Lt.return=Xe,Xe=Lt)}return ce(Xe);case pe:e:{for(_n=et.key;Ve!==null;){if(Ve.key===_n)if(Ve.tag===4&&Ve.stateNode.containerInfo===et.containerInfo&&Ve.stateNode.implementation===et.implementation){T(Xe,Ve.sibling),Ve=U(Ve,et.children||[]),Ve.return=Xe,Xe=Ve;break e}else{T(Xe,Ve);break}else g(Xe,Ve);Ve=Ve.sibling}Ve=Jb(et,Xe.mode,Lt),Ve.return=Xe,Xe=Ve}return ce(Xe);case $e:return _n=et._init,os(Xe,Ve,_n(et._payload),Lt)}if(Ge(et))return rn(Xe,Ve,et,Lt);if(Ee(et))return sn(Xe,Ve,et,Lt);RE(Xe,et)}return typeof et=="string"&&et!==""||typeof et=="number"?(et=""+et,Ve!==null&&Ve.tag===6?(T(Xe,Ve.sibling),Ve=U(Ve,et),Ve.return=Xe,Xe=Ve):(T(Xe,Ve),Ve=Xb(et,Xe.mode,Lt),Ve.return=Xe,Xe=Ve),ce(Xe)):T(Xe,Ve)}return os}var Em=ih(!0),iI=ih(!1),IE=xc(null),c_=null,vm=null,AE=null;function pb(){AE=vm=c_=null}function mb(f){var g=IE.current;xi(IE),f._currentValue=g}function gb(f,g,T){for(;f!==null;){var k=f.alternate;if((f.childLanes&g)!==g?(f.childLanes|=g,k!==null&&(k.childLanes|=g)):k!==null&&(k.childLanes&g)!==g&&(k.childLanes|=g),f===T)break;f=f.return}}function nd(f,g){c_=f,AE=vm=null,f=f.dependencies,f!==null&&f.firstContext!==null&&((f.lanes&g)!==0&&(Va=!0),f.firstContext=null)}function Uc(f){var g=f._currentValue;if(AE!==f)if(f={context:f,memoizedValue:g,next:null},vm===null){if(c_===null)throw Error(i(308));vm=f,c_.dependencies={lanes:0,firstContext:f}}else vm=vm.next=f;return g}var Ff=null;function _b(f){Ff===null?Ff=[f]:Ff.push(f)}function sI(f,g,T,k){var U=g.interleaved;return U===null?(T.next=T,_b(g)):(T.next=U.next,U.next=T),g.interleaved=T,rd(f,k)}function rd(f,g){f.lanes|=g;var T=f.alternate;for(T!==null&&(T.lanes|=g),T=f,f=f.return;f!==null;)f.childLanes|=g,T=f.alternate,T!==null&&(T.childLanes|=g),T=f,f=f.return;return T.tag===3?T.stateNode:null}var sh=!1;function l_(f){f.updateQueue={baseState:f.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function oI(f,g){f=f.updateQueue,g.updateQueue===f&&(g.updateQueue={baseState:f.baseState,firstBaseUpdate:f.firstBaseUpdate,lastBaseUpdate:f.lastBaseUpdate,shared:f.shared,effects:f.effects})}function nu(f,g){return{eventTime:f,lane:g,tag:0,payload:null,callback:null,next:null}}function oh(f,g,T){var k=f.updateQueue;if(k===null)return null;if(k=k.shared,(kr&2)!==0){var U=k.pending;return U===null?g.next=g:(g.next=U.next,U.next=g),k.pending=g,rd(f,T)}return U=k.interleaved,U===null?(g.next=g,_b(k)):(g.next=U.next,U.next=g),k.interleaved=g,rd(f,T)}function u_(f,g,T){if(g=g.updateQueue,g!==null&&(g=g.shared,(T&4194240)!==0)){var k=g.lanes;k&=f.pendingLanes,T|=k,g.lanes=T,oc(f,T)}}function aI(f,g){var T=f.updateQueue,k=f.alternate;if(k!==null&&(k=k.updateQueue,T===k)){var U=null,H=null;if(T=T.firstBaseUpdate,T!==null){do{var ce={eventTime:T.eventTime,lane:T.lane,tag:T.tag,payload:T.payload,callback:T.callback,next:null};H===null?U=H=ce:H=H.next=ce,T=T.next}while(T!==null);H===null?U=H=g:H=H.next=g}else U=H=g;T={baseState:k.baseState,firstBaseUpdate:U,lastBaseUpdate:H,shared:k.shared,effects:k.effects},f.updateQueue=T;return}f=T.lastBaseUpdate,f===null?T.firstBaseUpdate=g:f.next=g,T.lastBaseUpdate=g}function PE(f,g,T,k){var U=f.updateQueue;sh=!1;var H=U.firstBaseUpdate,ce=U.lastBaseUpdate,Ae=U.shared.pending;if(Ae!==null){U.shared.pending=null;var Ue=Ae,it=Ue.next;Ue.next=null,ce===null?H=it:ce.next=it,ce=Ue;var Pt=f.alternate;Pt!==null&&(Pt=Pt.updateQueue,Ae=Pt.lastBaseUpdate,Ae!==ce&&(Ae===null?Pt.firstBaseUpdate=it:Ae.next=it,Pt.lastBaseUpdate=Ue))}if(H!==null){var kt=U.baseState;ce=0,Pt=it=Ue=null,Ae=H;do{var At=Ae.lane,Xt=Ae.eventTime;if((k&At)===At){Pt!==null&&(Pt=Pt.next={eventTime:Xt,lane:0,tag:Ae.tag,payload:Ae.payload,callback:Ae.callback,next:null});e:{var rn=f,sn=Ae;switch(At=g,Xt=T,sn.tag){case 1:if(rn=sn.payload,typeof rn=="function"){kt=rn.call(Xt,kt,At);break e}kt=rn;break e;case 3:rn.flags=rn.flags&-65537|128;case 0:if(rn=sn.payload,At=typeof rn=="function"?rn.call(Xt,kt,At):rn,At==null)break e;kt=ke({},kt,At);break e;case 2:sh=!0}}Ae.callback!==null&&Ae.lane!==0&&(f.flags|=64,At=U.effects,At===null?U.effects=[Ae]:At.push(Ae))}else Xt={eventTime:Xt,lane:At,tag:Ae.tag,payload:Ae.payload,callback:Ae.callback,next:null},Pt===null?(it=Pt=Xt,Ue=kt):Pt=Pt.next=Xt,ce|=At;if(Ae=Ae.next,Ae===null){if(Ae=U.shared.pending,Ae===null)break;At=Ae,Ae=At.next,At.next=null,U.lastBaseUpdate=At,U.shared.pending=null}}while(!0);if(Pt===null&&(Ue=kt),U.baseState=Ue,U.firstBaseUpdate=it,U.lastBaseUpdate=Pt,g=U.shared.interleaved,g!==null){U=g;do ce|=U.lane,U=U.next;while(U!==g)}else H===null&&(U.shared.lanes=0);Hf|=ce,f.lanes=ce,f.memoizedState=kt}}function cI(f,g,T){if(f=g.effects,g.effects=null,f!==null)for(g=0;g<f.length;g++){var k=f[g],U=k.callback;if(U!==null){if(k.callback=null,k=T,typeof U!="function")throw Error(i(191,U));U.call(k)}}}var d_={},ru=xc(d_),h_=xc(d_),Sm=xc(d_);function jf(f){if(f===d_)throw Error(i(174));return f}function yb(f,g){switch(Ii(Sm,g),Ii(h_,f),Ii(ru,d_),f=g.nodeType,f){case 9:case 11:g=(g=g.documentElement)?g.namespaceURI:un(null,"");break;default:f=f===8?g.parentNode:g,g=f.namespaceURI||null,f=f.tagName,g=un(g,f)}xi(ru),Ii(ru,g)}function Bf(){xi(ru),xi(h_),xi(Sm)}function lI(f){jf(Sm.current);var g=jf(ru.current),T=un(g,f.type);g!==T&&(Ii(h_,f),Ii(ru,T))}function bm(f){h_.current===f&&(xi(ru),xi(h_))}var ji=xc(0);function ah(f){for(var g=f;g!==null;){if(g.tag===13){var T=g.memoizedState;if(T!==null&&(T=T.dehydrated,T===null||T.data==="$?"||T.data==="$!"))return g}else if(g.tag===19&&g.memoizedProps.revealOrder!==void 0){if((g.flags&128)!==0)return g}else if(g.child!==null){g.child.return=g,g=g.child;continue}if(g===f)break;for(;g.sibling===null;){if(g.return===null||g.return===f)return null;g=g.return}g.sibling.return=g.return,g=g.sibling}return null}var Eb=[];function vb(){for(var f=0;f<Eb.length;f++)Eb[f]._workInProgressVersionPrimary=null;Eb.length=0}var OE=ue.ReactCurrentDispatcher,Sb=ue.ReactCurrentBatchConfig,iu=0,Ki=null,Ts=null,ws=null,Tm=!1,f_=!1,p_=0,aD=0;function Oo(){throw Error(i(321))}function bb(f,g){if(g===null)return!1;for(var T=0;T<g.length&&T<f.length;T++)if(!El(f[T],g[T]))return!1;return!0}function wm(f,g,T,k,U,H){if(iu=H,Ki=g,g.memoizedState=null,g.updateQueue=null,g.lanes=0,OE.current=f===null||f.memoizedState===null?uD:vI,f=T(k,U),f_){H=0;do{if(f_=!1,p_=0,25<=H)throw Error(i(301));H+=1,ws=Ts=null,g.updateQueue=null,OE.current=dD,f=T(k,U)}while(f_)}if(OE.current=xE,g=Ts!==null&&Ts.next!==null,iu=0,ws=Ts=Ki=null,Tm=!1,g)throw Error(i(300));return f}function Tb(){var f=p_!==0;return p_=0,f}function sa(){var f={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return ws===null?Ki.memoizedState=ws=f:ws=ws.next=f,ws}function Ua(){if(Ts===null){var f=Ki.alternate;f=f!==null?f.memoizedState:null}else f=Ts.next;var g=ws===null?Ki.memoizedState:ws.next;if(g!==null)ws=g,Ts=f;else{if(f===null)throw Error(i(310));Ts=f,f={memoizedState:Ts.memoizedState,baseState:Ts.baseState,baseQueue:Ts.baseQueue,queue:Ts.queue,next:null},ws===null?Ki.memoizedState=ws=f:ws=ws.next=f}return ws}function ch(f,g){return typeof g=="function"?g(f):g}function Wf(f){var g=Ua(),T=g.queue;if(T===null)throw Error(i(311));T.lastRenderedReducer=f;var k=Ts,U=k.baseQueue,H=T.pending;if(H!==null){if(U!==null){var ce=U.next;U.next=H.next,H.next=ce}k.baseQueue=U=H,T.pending=null}if(U!==null){H=U.next,k=k.baseState;var Ae=ce=null,Ue=null,it=H;do{var Pt=it.lane;if((iu&Pt)===Pt)Ue!==null&&(Ue=Ue.next={lane:0,action:it.action,hasEagerState:it.hasEagerState,eagerState:it.eagerState,next:null}),k=it.hasEagerState?it.eagerState:f(k,it.action);else{var kt={lane:Pt,action:it.action,hasEagerState:it.hasEagerState,eagerState:it.eagerState,next:null};Ue===null?(Ae=Ue=kt,ce=k):Ue=Ue.next=kt,Ki.lanes|=Pt,Hf|=Pt}it=it.next}while(it!==null&&it!==H);Ue===null?ce=k:Ue.next=Ae,El(k,g.memoizedState)||(Va=!0),g.memoizedState=k,g.baseState=ce,g.baseQueue=Ue,T.lastRenderedState=k}if(f=T.interleaved,f!==null){U=f;do H=U.lane,Ki.lanes|=H,Hf|=H,U=U.next;while(U!==f)}else U===null&&(T.lanes=0);return[g.memoizedState,T.dispatch]}function Cm(f){var g=Ua(),T=g.queue;if(T===null)throw Error(i(311));T.lastRenderedReducer=f;var k=T.dispatch,U=T.pending,H=g.memoizedState;if(U!==null){T.pending=null;var ce=U=U.next;do H=f(H,ce.action),ce=ce.next;while(ce!==U);El(H,g.memoizedState)||(Va=!0),g.memoizedState=H,g.baseQueue===null&&(g.baseState=H),T.lastRenderedState=H}return[H,k]}function uI(){}function wb(f,g){var T=Ki,k=Ua(),U=g(),H=!El(k.memoizedState,U);if(H&&(k.memoizedState=U,Va=!0),k=k.queue,Vc(hI.bind(null,T,k,f),[f]),k.getSnapshot!==g||H||ws!==null&&ws.memoizedState.tag&1){if(T.flags|=2048,m_(9,Cb.bind(null,T,k,U,g),void 0,null),Qs===null)throw Error(i(349));(iu&30)!==0||dI(T,g,U)}return U}function dI(f,g,T){f.flags|=16384,f={getSnapshot:g,value:T},g=Ki.updateQueue,g===null?(g={lastEffect:null,stores:null},Ki.updateQueue=g,g.stores=[f]):(T=g.stores,T===null?g.stores=[f]:T.push(f))}function Cb(f,g,T,k){g.value=T,g.getSnapshot=k,fI(g)&&kE(f)}function hI(f,g,T){return T(function(){fI(g)&&kE(f)})}function fI(f){var g=f.getSnapshot;f=f.value;try{var T=g();return!El(f,T)}catch{return!0}}function kE(f){var g=rd(f,1);g!==null&&Wc(g,f,1,-1)}function NE(f){var g=sa();return typeof f=="function"&&(f=f()),g.memoizedState=g.baseState=f,f={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:ch,lastRenderedState:f},g.queue=f,f=f.dispatch=lD.bind(null,Ki,f),[g.memoizedState,f]}function m_(f,g,T,k){return f={tag:f,create:g,destroy:T,deps:k,next:null},g=Ki.updateQueue,g===null?(g={lastEffect:null,stores:null},Ki.updateQueue=g,g.lastEffect=f.next=f):(T=g.lastEffect,T===null?g.lastEffect=f.next=f:(k=T.next,T.next=f,f.next=k,g.lastEffect=f)),f}function pI(){return Ua().memoizedState}function g_(f,g,T,k){var U=sa();Ki.flags|=f,U.memoizedState=m_(1|g,T,void 0,k===void 0?null:k)}function Rm(f,g,T,k){var U=Ua();k=k===void 0?null:k;var H=void 0;if(Ts!==null){var ce=Ts.memoizedState;if(H=ce.destroy,k!==null&&bb(k,ce.deps)){U.memoizedState=m_(g,T,H,k);return}}Ki.flags|=f,U.memoizedState=m_(1|g,T,H,k)}function mI(f,g){return g_(8390656,8,f,g)}function Vc(f,g){return Rm(2048,8,f,g)}function zf(f,g){return Rm(4,2,f,g)}function lh(f,g){return Rm(4,4,f,g)}function Rb(f,g){if(typeof g=="function")return f=f(),g(f),function(){g(null)};if(g!=null)return f=f(),g.current=f,function(){g.current=null}}function Ib(f,g,T){return T=T!=null?T.concat([f]):null,Rm(4,4,Rb.bind(null,g,f),T)}function id(){}function DE(f,g){var T=Ua();g=g===void 0?null:g;var k=T.memoizedState;return k!==null&&g!==null&&bb(g,k[1])?k[0]:(T.memoizedState=[f,g],f)}function gI(f,g){var T=Ua();g=g===void 0?null:g;var k=T.memoizedState;return k!==null&&g!==null&&bb(g,k[1])?k[0]:(f=f(),T.memoizedState=[f,g],f)}function Ab(f,g,T){return(iu&21)===0?(f.baseState&&(f.baseState=!1,Va=!0),f.memoizedState=T):(El(T,g)||(T=Hu(),Ki.lanes|=T,Hf|=T,f.baseState=!0),g)}function cD(f,g){var T=ar;ar=T!==0&&4>T?T:4,f(!0);var k=Sb.transition;Sb.transition={};try{f(!1),g()}finally{ar=T,Sb.transition=k}}function Pb(){return Ua().memoizedState}function _I(f,g,T){var k=Bc(f);if(T={lane:k,action:T,hasEagerState:!1,eagerState:null,next:null},sd(f))yI(g,T);else if(T=sI(f,g,T,k),T!==null){var U=fo();Wc(T,f,k,U),EI(T,g,k)}}function lD(f,g,T){var k=Bc(f),U={lane:k,action:T,hasEagerState:!1,eagerState:null,next:null};if(sd(f))yI(g,U);else{var H=f.alternate;if(f.lanes===0&&(H===null||H.lanes===0)&&(H=g.lastRenderedReducer,H!==null))try{var ce=g.lastRenderedState,Ae=H(ce,T);if(U.hasEagerState=!0,U.eagerState=Ae,El(Ae,ce)){var Ue=g.interleaved;Ue===null?(U.next=U,_b(g)):(U.next=Ue.next,Ue.next=U),g.interleaved=U;return}}catch{}finally{}T=sI(f,g,U,k),T!==null&&(U=fo(),Wc(T,f,k,U),EI(T,g,k))}}function sd(f){var g=f.alternate;return f===Ki||g!==null&&g===Ki}function yI(f,g){f_=Tm=!0;var T=f.pending;T===null?g.next=g:(g.next=T.next,T.next=g),f.pending=g}function EI(f,g,T){if((T&4194240)!==0){var k=g.lanes;k&=f.pendingLanes,T|=k,g.lanes=T,oc(f,T)}}var xE={readContext:Uc,useCallback:Oo,useContext:Oo,useEffect:Oo,useImperativeHandle:Oo,useInsertionEffect:Oo,useLayoutEffect:Oo,useMemo:Oo,useReducer:Oo,useRef:Oo,useState:Oo,useDebugValue:Oo,useDeferredValue:Oo,useTransition:Oo,useMutableSource:Oo,useSyncExternalStore:Oo,useId:Oo,unstable_isNewReconciler:!1},uD={readContext:Uc,useCallback:function(f,g){return sa().memoizedState=[f,g===void 0?null:g],f},useContext:Uc,useEffect:mI,useImperativeHandle:function(f,g,T){return T=T!=null?T.concat([f]):null,g_(4194308,4,Rb.bind(null,g,f),T)},useLayoutEffect:function(f,g){return g_(4194308,4,f,g)},useInsertionEffect:function(f,g){return g_(4,2,f,g)},useMemo:function(f,g){var T=sa();return g=g===void 0?null:g,f=f(),T.memoizedState=[f,g],f},useReducer:function(f,g,T){var k=sa();return g=T!==void 0?T(g):g,k.memoizedState=k.baseState=g,f={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:f,lastRenderedState:g},k.queue=f,f=f.dispatch=_I.bind(null,Ki,f),[k.memoizedState,f]},useRef:function(f){var g=sa();return f={current:f},g.memoizedState=f},useState:NE,useDebugValue:id,useDeferredValue:function(f){return sa().memoizedState=f},useTransition:function(){var f=NE(!1),g=f[0];return f=cD.bind(null,f[1]),sa().memoizedState=f,[g,f]},useMutableSource:function(){},useSyncExternalStore:function(f,g,T){var k=Ki,U=sa();if(_i){if(T===void 0)throw Error(i(407));T=T()}else{if(T=g(),Qs===null)throw Error(i(349));(iu&30)!==0||dI(k,g,T)}U.memoizedState=T;var H={value:T,getSnapshot:g};return U.queue=H,mI(hI.bind(null,k,H,f),[f]),k.flags|=2048,m_(9,Cb.bind(null,k,H,T,g),void 0,null),T},useId:function(){var f=sa(),g=Qs.identifierPrefix;if(_i){var T=ed,k=Zu;T=(k&~(1<<32-lo(k)-1)).toString(32)+T,g=":"+g+"R"+T,T=p_++,0<T&&(g+="H"+T.toString(32)),g+=":"}else T=aD++,g=":"+g+"r"+T.toString(32)+":";return f.memoizedState=g},unstable_isNewReconciler:!1},vI={readContext:Uc,useCallback:DE,useContext:Uc,useEffect:Vc,useImperativeHandle:Ib,useInsertionEffect:zf,useLayoutEffect:lh,useMemo:gI,useReducer:Wf,useRef:pI,useState:function(){return Wf(ch)},useDebugValue:id,useDeferredValue:function(f){var g=Ua();return Ab(g,Ts.memoizedState,f)},useTransition:function(){var f=Wf(ch)[0],g=Ua().memoizedState;return[f,g]},useMutableSource:uI,useSyncExternalStore:wb,useId:Pb,unstable_isNewReconciler:!1},dD={readContext:Uc,useCallback:DE,useContext:Uc,useEffect:Vc,useImperativeHandle:Ib,useInsertionEffect:zf,useLayoutEffect:lh,useMemo:gI,useReducer:Cm,useRef:pI,useState:function(){return Cm(ch)},useDebugValue:id,useDeferredValue:function(f){var g=Ua();return Ts===null?g.memoizedState=f:Ab(g,Ts.memoizedState,f)},useTransition:function(){var f=Cm(ch)[0],g=Ua().memoizedState;return[f,g]},useMutableSource:uI,useSyncExternalStore:wb,useId:Pb,unstable_isNewReconciler:!1};function dc(f,g){if(f&&f.defaultProps){g=ke({},g),f=f.defaultProps;for(var T in f)g[T]===void 0&&(g[T]=f[T]);return g}return g}function LE(f,g,T,k){g=f.memoizedState,T=T(k,g),T=T==null?g:ke({},g,T),f.memoizedState=T,f.lanes===0&&(f.updateQueue.baseState=T)}var ME={isMounted:function(f){return(f=f._reactInternals)?Xs(f)===f:!1},enqueueSetState:function(f,g,T){f=f._reactInternals;var k=fo(),U=Bc(f),H=nu(k,U);H.payload=g,T!=null&&(H.callback=T),g=oh(f,H,U),g!==null&&(Wc(g,f,U,k),u_(g,f,U))},enqueueReplaceState:function(f,g,T){f=f._reactInternals;var k=fo(),U=Bc(f),H=nu(k,U);H.tag=1,H.payload=g,T!=null&&(H.callback=T),g=oh(f,H,U),g!==null&&(Wc(g,f,U,k),u_(g,f,U))},enqueueForceUpdate:function(f,g){f=f._reactInternals;var T=fo(),k=Bc(f),U=nu(T,k);U.tag=2,g!=null&&(U.callback=g),g=oh(f,U,k),g!==null&&(Wc(g,f,k,T),u_(g,f,k))}};function Ob(f,g,T,k,U,H,ce){return f=f.stateNode,typeof f.shouldComponentUpdate=="function"?f.shouldComponentUpdate(k,H,ce):g.prototype&&g.prototype.isPureReactComponent?!Yg(T,k)||!Yg(U,H):!0}function SI(f,g,T){var k=!1,U=nh,H=g.contextType;return typeof H=="object"&&H!==null?H=Uc(H):(U=xa(g)?Mf:Po.current,k=g.contextTypes,H=(k=k!=null)?Uf(f,U):nh),g=new g(T,H),f.memoizedState=g.state!==null&&g.state!==void 0?g.state:null,g.updater=ME,f.stateNode=g,g._reactInternals=f,k&&(f=f.stateNode,f.__reactInternalMemoizedUnmaskedChildContext=U,f.__reactInternalMemoizedMaskedChildContext=H),g}function bI(f,g,T,k){f=g.state,typeof g.componentWillReceiveProps=="function"&&g.componentWillReceiveProps(T,k),typeof g.UNSAFE_componentWillReceiveProps=="function"&&g.UNSAFE_componentWillReceiveProps(T,k),g.state!==f&&ME.enqueueReplaceState(g,g.state,null)}function kb(f,g,T,k){var U=f.stateNode;U.props=T,U.state=f.memoizedState,U.refs={},l_(f);var H=g.contextType;typeof H=="object"&&H!==null?U.context=Uc(H):(H=xa(g)?Mf:Po.current,U.context=Uf(f,H)),U.state=f.memoizedState,H=g.getDerivedStateFromProps,typeof H=="function"&&(LE(f,g,H,T),U.state=f.memoizedState),typeof g.getDerivedStateFromProps=="function"||typeof U.getSnapshotBeforeUpdate=="function"||typeof U.UNSAFE_componentWillMount!="function"&&typeof U.componentWillMount!="function"||(g=U.state,typeof U.componentWillMount=="function"&&U.componentWillMount(),typeof U.UNSAFE_componentWillMount=="function"&&U.UNSAFE_componentWillMount(),g!==U.state&&ME.enqueueReplaceState(U,U.state,null),PE(f,T,U,k),U.state=f.memoizedState),typeof U.componentDidMount=="function"&&(f.flags|=4194308)}function Im(f,g){try{var T="",k=g;do T+=ze(k),k=k.return;while(k);var U=T}catch(H){U=`
Error generating stack: `+H.message+`
`+H.stack}return{value:f,source:g,stack:U,digest:null}}function Nb(f,g,T){return{value:f,source:null,stack:T??null,digest:g??null}}function Db(f,g){try{console.error(g.value)}catch(T){setTimeout(function(){throw T})}}var hD=typeof WeakMap=="function"?WeakMap:Map;function xb(f,g,T){T=nu(-1,T),T.tag=3,T.payload={element:null};var k=g.value;return T.callback=function(){ev||(ev=!0,Hb=k),Db(f,g)},T}function od(f,g,T){T=nu(-1,T),T.tag=3;var k=f.type.getDerivedStateFromError;if(typeof k=="function"){var U=g.value;T.payload=function(){return k(U)},T.callback=function(){Db(f,g)}}var H=f.stateNode;return H!==null&&typeof H.componentDidCatch=="function"&&(T.callback=function(){Db(f,g),typeof k!="function"&&(uh===null?uh=new Set([this]):uh.add(this));var ce=g.stack;this.componentDidCatch(g.value,{componentStack:ce!==null?ce:""})}),T}function TI(f,g,T){var k=f.pingCache;if(k===null){k=f.pingCache=new hD;var U=new Set;k.set(g,U)}else U=k.get(g),U===void 0&&(U=new Set,k.set(g,U));U.has(T)||(U.add(T),f=KI.bind(null,f,g,T),g.then(f,f))}function wI(f){do{var g;if((g=f.tag===13)&&(g=f.memoizedState,g=g!==null?g.dehydrated!==null:!0),g)return f;f=f.return}while(f!==null);return null}function CI(f,g,T,k,U){return(f.mode&1)===0?(f===g?f.flags|=65536:(f.flags|=128,T.flags|=131072,T.flags&=-52805,T.tag===1&&(T.alternate===null?T.tag=17:(g=nu(-1,1),g.tag=2,oh(T,g,1))),T.lanes|=1),f):(f.flags|=65536,f.lanes=U,f)}var fD=ue.ReactCurrentOwner,Va=!1;function oa(f,g,T,k){g.child=f===null?iI(g,null,T,k):Em(g,f.child,T,k)}function UE(f,g,T,k,U){T=T.render;var H=g.ref;return nd(g,U),k=wm(f,g,T,k,H,U),T=Tb(),f!==null&&!Va?(g.updateQueue=f.updateQueue,g.flags&=-2053,f.lanes&=~U,su(f,g,U)):(_i&&T&&wE(g),g.flags|=1,oa(f,g,k,U),g.child)}function RI(f,g,T,k,U){if(f===null){var H=T.type;return typeof H=="function"&&!hh(H)&&H.defaultProps===void 0&&T.compare===null&&T.defaultProps===void 0?(g.tag=15,g.type=H,II(f,g,H,k,U)):(f=hv(T.type,null,k,g,g.mode,U),f.ref=g.ref,f.return=g,g.child=f)}if(H=f.child,(f.lanes&U)===0){var ce=H.memoizedProps;if(T=T.compare,T=T!==null?T:Yg,T(ce,k)&&f.ref===g.ref)return su(f,g,U)}return g.flags|=1,f=ld(H,k),f.ref=g.ref,f.return=g,g.child=f}function II(f,g,T,k,U){if(f!==null){var H=f.memoizedProps;if(Yg(H,k)&&f.ref===g.ref)if(Va=!1,g.pendingProps=k=H,(f.lanes&U)!==0)(f.flags&131072)!==0&&(Va=!0);else return g.lanes=f.lanes,su(f,g,U)}return Lb(f,g,T,k,U)}function AI(f,g,T){var k=g.pendingProps,U=k.children,H=f!==null?f.memoizedState:null;if(k.mode==="hidden")if((g.mode&1)===0)g.memoizedState={baseLanes:0,cachePool:null,transitions:null},Ii(vl,hc),hc|=T;else{if((T&1073741824)===0)return f=H!==null?H.baseLanes|T:T,g.lanes=g.childLanes=1073741824,g.memoizedState={baseLanes:f,cachePool:null,transitions:null},g.updateQueue=null,Ii(vl,hc),hc|=f,null;g.memoizedState={baseLanes:0,cachePool:null,transitions:null},k=H!==null?H.baseLanes:T,Ii(vl,hc),hc|=k}else H!==null?(k=H.baseLanes|T,g.memoizedState=null):k=T,Ii(vl,hc),hc|=k;return oa(f,g,U,T),g.child}function PI(f,g){var T=g.ref;(f===null&&T!==null||f!==null&&f.ref!==T)&&(g.flags|=512,g.flags|=2097152)}function Lb(f,g,T,k,U){var H=xa(T)?Mf:Po.current;return H=Uf(g,H),nd(g,U),T=wm(f,g,T,k,H,U),k=Tb(),f!==null&&!Va?(g.updateQueue=f.updateQueue,g.flags&=-2053,f.lanes&=~U,su(f,g,U)):(_i&&k&&wE(g),g.flags|=1,oa(f,g,T,U),g.child)}function OI(f,g,T,k,U){if(xa(T)){var H=!0;vE(g)}else H=!1;if(nd(g,U),g.stateNode===null)zE(f,g),SI(g,T,k),kb(g,T,k,U),k=!0;else if(f===null){var ce=g.stateNode,Ae=g.memoizedProps;ce.props=Ae;var Ue=ce.context,it=T.contextType;typeof it=="object"&&it!==null?it=Uc(it):(it=xa(T)?Mf:Po.current,it=Uf(g,it));var Pt=T.getDerivedStateFromProps,kt=typeof Pt=="function"||typeof ce.getSnapshotBeforeUpdate=="function";kt||typeof ce.UNSAFE_componentWillReceiveProps!="function"&&typeof ce.componentWillReceiveProps!="function"||(Ae!==k||Ue!==it)&&bI(g,ce,k,it),sh=!1;var At=g.memoizedState;ce.state=At,PE(g,k,ce,U),Ue=g.memoizedState,Ae!==k||At!==Ue||Da.current||sh?(typeof Pt=="function"&&(LE(g,T,Pt,k),Ue=g.memoizedState),(Ae=sh||Ob(g,T,Ae,k,At,Ue,it))?(kt||typeof ce.UNSAFE_componentWillMount!="function"&&typeof ce.componentWillMount!="function"||(typeof ce.componentWillMount=="function"&&ce.componentWillMount(),typeof ce.UNSAFE_componentWillMount=="function"&&ce.UNSAFE_componentWillMount()),typeof ce.componentDidMount=="function"&&(g.flags|=4194308)):(typeof ce.componentDidMount=="function"&&(g.flags|=4194308),g.memoizedProps=k,g.memoizedState=Ue),ce.props=k,ce.state=Ue,ce.context=it,k=Ae):(typeof ce.componentDidMount=="function"&&(g.flags|=4194308),k=!1)}else{ce=g.stateNode,oI(f,g),Ae=g.memoizedProps,it=g.type===g.elementType?Ae:dc(g.type,Ae),ce.props=it,kt=g.pendingProps,At=ce.context,Ue=T.contextType,typeof Ue=="object"&&Ue!==null?Ue=Uc(Ue):(Ue=xa(T)?Mf:Po.current,Ue=Uf(g,Ue));var Xt=T.getDerivedStateFromProps;(Pt=typeof Xt=="function"||typeof ce.getSnapshotBeforeUpdate=="function")||typeof ce.UNSAFE_componentWillReceiveProps!="function"&&typeof ce.componentWillReceiveProps!="function"||(Ae!==kt||At!==Ue)&&bI(g,ce,k,Ue),sh=!1,At=g.memoizedState,ce.state=At,PE(g,k,ce,U);var rn=g.memoizedState;Ae!==kt||At!==rn||Da.current||sh?(typeof Xt=="function"&&(LE(g,T,Xt,k),rn=g.memoizedState),(it=sh||Ob(g,T,it,k,At,rn,Ue)||!1)?(Pt||typeof ce.UNSAFE_componentWillUpdate!="function"&&typeof ce.componentWillUpdate!="function"||(typeof ce.componentWillUpdate=="function"&&ce.componentWillUpdate(k,rn,Ue),typeof ce.UNSAFE_componentWillUpdate=="function"&&ce.UNSAFE_componentWillUpdate(k,rn,Ue)),typeof ce.componentDidUpdate=="function"&&(g.flags|=4),typeof ce.getSnapshotBeforeUpdate=="function"&&(g.flags|=1024)):(typeof ce.componentDidUpdate!="function"||Ae===f.memoizedProps&&At===f.memoizedState||(g.flags|=4),typeof ce.getSnapshotBeforeUpdate!="function"||Ae===f.memoizedProps&&At===f.memoizedState||(g.flags|=1024),g.memoizedProps=k,g.memoizedState=rn),ce.props=k,ce.state=rn,ce.context=Ue,k=it):(typeof ce.componentDidUpdate!="function"||Ae===f.memoizedProps&&At===f.memoizedState||(g.flags|=4),typeof ce.getSnapshotBeforeUpdate!="function"||Ae===f.memoizedProps&&At===f.memoizedState||(g.flags|=1024),k=!1)}return VE(f,g,T,k,H,U)}function VE(f,g,T,k,U,H){PI(f,g);var ce=(g.flags&128)!==0;if(!k&&!ce)return U&&QR(g,T,!1),su(f,g,H);k=g.stateNode,fD.current=g;var Ae=ce&&typeof T.getDerivedStateFromError!="function"?null:k.render();return g.flags|=1,f!==null&&ce?(g.child=Em(g,f.child,null,H),g.child=Em(g,null,Ae,H)):oa(f,g,Ae,H),g.memoizedState=k.state,U&&QR(g,T,!0),g.child}function Mb(f){var g=f.stateNode;g.pendingContext?JR(f,g.pendingContext,g.pendingContext!==g.context):g.context&&JR(f,g.context,!1),yb(f,g.containerInfo)}function kI(f,g,T,k,U){return ym(),hb(U),g.flags|=256,oa(f,g,T,k),g.child}var Ub={dehydrated:null,treeContext:null,retryLane:0};function Am(f){return{baseLanes:f,cachePool:null,transitions:null}}function FE(f,g,T){var k=g.pendingProps,U=ji.current,H=!1,ce=(g.flags&128)!==0,Ae;if((Ae=ce)||(Ae=f!==null&&f.memoizedState===null?!1:(U&2)!==0),Ae?(H=!0,g.flags&=-129):(f===null||f.memoizedState!==null)&&(U|=1),Ii(ji,U&1),f===null)return db(g),f=g.memoizedState,f!==null&&(f=f.dehydrated,f!==null)?((g.mode&1)===0?g.lanes=1:f.data==="$!"?g.lanes=8:g.lanes=1073741824,null):(ce=k.children,f=k.fallback,H?(k=g.mode,H=g.child,ce={mode:"hidden",children:ce},(k&1)===0&&H!==null?(H.childLanes=0,H.pendingProps=ce):H=fh(ce,k,0,null),f=Xf(f,k,T,null),H.return=g,f.return=g,H.sibling=f,g.child=H,g.child.memoizedState=Am(T),g.memoizedState=Ub,f):jE(g,ce));if(U=f.memoizedState,U!==null&&(Ae=U.dehydrated,Ae!==null))return NI(f,g,ce,k,Ae,U,T);if(H){H=k.fallback,ce=g.mode,U=f.child,Ae=U.sibling;var Ue={mode:"hidden",children:k.children};return(ce&1)===0&&g.child!==U?(k=g.child,k.childLanes=0,k.pendingProps=Ue,g.deletions=null):(k=ld(U,Ue),k.subtreeFlags=U.subtreeFlags&14680064),Ae!==null?H=ld(Ae,H):(H=Xf(H,ce,T,null),H.flags|=2),H.return=g,k.return=g,k.sibling=H,g.child=k,k=H,H=g.child,ce=f.child.memoizedState,ce=ce===null?Am(T):{baseLanes:ce.baseLanes|T,cachePool:null,transitions:ce.transitions},H.memoizedState=ce,H.childLanes=f.childLanes&~T,g.memoizedState=Ub,k}return H=f.child,f=H.sibling,k=ld(H,{mode:"visible",children:k.children}),(g.mode&1)===0&&(k.lanes=T),k.return=g,k.sibling=null,f!==null&&(T=g.deletions,T===null?(g.deletions=[f],g.flags|=16):T.push(f)),g.child=k,g.memoizedState=null,k}function jE(f,g){return g=fh({mode:"visible",children:g},f.mode,0,null),g.return=f,f.child=g}function Gf(f,g,T,k){return k!==null&&hb(k),Em(g,f.child,null,T),f=jE(g,g.pendingProps.children),f.flags|=2,g.memoizedState=null,f}function NI(f,g,T,k,U,H,ce){if(T)return g.flags&256?(g.flags&=-257,k=Nb(Error(i(422))),Gf(f,g,ce,k)):g.memoizedState!==null?(g.child=f.child,g.flags|=128,null):(H=k.fallback,U=g.mode,k=fh({mode:"visible",children:k.children},U,0,null),H=Xf(H,U,ce,null),H.flags|=2,k.return=g,H.return=g,k.sibling=H,g.child=k,(g.mode&1)!==0&&Em(g,f.child,null,ce),g.child.memoizedState=Am(ce),g.memoizedState=Ub,H);if((g.mode&1)===0)return Gf(f,g,ce,null);if(U.data==="$!"){if(k=U.nextSibling&&U.nextSibling.dataset,k)var Ae=k.dgst;return k=Ae,H=Error(i(419)),k=Nb(H,k,void 0),Gf(f,g,ce,k)}if(Ae=(ce&f.childLanes)!==0,Va||Ae){if(k=Qs,k!==null){switch(ce&-ce){case 4:U=2;break;case 16:U=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:U=32;break;case 536870912:U=268435456;break;default:U=0}U=(U&(k.suspendedLanes|ce))!==0?0:U,U!==0&&U!==H.retryLane&&(H.retryLane=U,rd(f,U),Wc(k,f,U,-1))}return qb(),k=Nb(Error(i(421))),Gf(f,g,ce,k)}return U.data==="$?"?(g.flags|=128,g.child=f.child,g=lv.bind(null,f),U._reactRetry=g,null):(f=H.treeContext,Ma=eh(U.nextSibling),La=g,_i=!0,ia=null,f!==null&&(Mc[uc++]=Zu,Mc[uc++]=ed,Mc[uc++]=Vf,Zu=f.id,ed=f.overflow,Vf=g),g=jE(g,k.children),g.flags|=4096,g)}function DI(f,g,T){f.lanes|=g;var k=f.alternate;k!==null&&(k.lanes|=g),gb(f.return,g,T)}function BE(f,g,T,k,U){var H=f.memoizedState;H===null?f.memoizedState={isBackwards:g,rendering:null,renderingStartTime:0,last:k,tail:T,tailMode:U}:(H.isBackwards=g,H.rendering=null,H.renderingStartTime=0,H.last=k,H.tail=T,H.tailMode=U)}function WE(f,g,T){var k=g.pendingProps,U=k.revealOrder,H=k.tail;if(oa(f,g,k.children,T),k=ji.current,(k&2)!==0)k=k&1|2,g.flags|=128;else{if(f!==null&&(f.flags&128)!==0)e:for(f=g.child;f!==null;){if(f.tag===13)f.memoizedState!==null&&DI(f,T,g);else if(f.tag===19)DI(f,T,g);else if(f.child!==null){f.child.return=f,f=f.child;continue}if(f===g)break e;for(;f.sibling===null;){if(f.return===null||f.return===g)break e;f=f.return}f.sibling.return=f.return,f=f.sibling}k&=1}if(Ii(ji,k),(g.mode&1)===0)g.memoizedState=null;else switch(U){case"forwards":for(T=g.child,U=null;T!==null;)f=T.alternate,f!==null&&ah(f)===null&&(U=T),T=T.sibling;T=U,T===null?(U=g.child,g.child=null):(U=T.sibling,T.sibling=null),BE(g,!1,U,T,H);break;case"backwards":for(T=null,U=g.child,g.child=null;U!==null;){if(f=U.alternate,f!==null&&ah(f)===null){g.child=U;break}f=U.sibling,U.sibling=T,T=U,U=f}BE(g,!0,T,null,H);break;case"together":BE(g,!1,null,null,void 0);break;default:g.memoizedState=null}return g.child}function zE(f,g){(g.mode&1)===0&&f!==null&&(f.alternate=null,g.alternate=null,g.flags|=2)}function su(f,g,T){if(f!==null&&(g.dependencies=f.dependencies),Hf|=g.lanes,(T&g.childLanes)===0)return null;if(f!==null&&g.child!==f.child)throw Error(i(153));if(g.child!==null){for(f=g.child,T=ld(f,f.pendingProps),g.child=T,T.return=g;f.sibling!==null;)f=f.sibling,T=T.sibling=ld(f,f.pendingProps),T.return=g;T.sibling=null}return g.child}function xI(f,g,T){switch(g.tag){case 3:Mb(g),ym();break;case 5:lI(g);break;case 1:xa(g.type)&&vE(g);break;case 4:yb(g,g.stateNode.containerInfo);break;case 10:var k=g.type._context,U=g.memoizedProps.value;Ii(IE,k._currentValue),k._currentValue=U;break;case 13:if(k=g.memoizedState,k!==null)return k.dehydrated!==null?(Ii(ji,ji.current&1),g.flags|=128,null):(T&g.child.childLanes)!==0?FE(f,g,T):(Ii(ji,ji.current&1),f=su(f,g,T),f!==null?f.sibling:null);Ii(ji,ji.current&1);break;case 19:if(k=(T&g.childLanes)!==0,(f.flags&128)!==0){if(k)return WE(f,g,T);g.flags|=128}if(U=g.memoizedState,U!==null&&(U.rendering=null,U.tail=null,U.lastEffect=null),Ii(ji,ji.current),k)break;return null;case 22:case 23:return g.lanes=0,AI(f,g,T)}return su(f,g,T)}var LI,GE,Vb,MI;LI=function(f,g){for(var T=g.child;T!==null;){if(T.tag===5||T.tag===6)f.appendChild(T.stateNode);else if(T.tag!==4&&T.child!==null){T.child.return=T,T=T.child;continue}if(T===g)break;for(;T.sibling===null;){if(T.return===null||T.return===g)return;T=T.return}T.sibling.return=T.return,T=T.sibling}},GE=function(){},Vb=function(f,g,T,k){var U=f.memoizedProps;if(U!==k){f=g.stateNode,jf(ru.current);var H=null;switch(T){case"input":U=an(f,U),k=an(f,k),H=[];break;case"select":U=ke({},U,{value:void 0}),k=ke({},k,{value:void 0}),H=[];break;case"textarea":U=yt(f,U),k=yt(f,k),H=[];break;default:typeof U.onClick!="function"&&typeof k.onClick=="function"&&(f.onclick=gE)}Ot(T,k);var ce;T=null;for(it in U)if(!k.hasOwnProperty(it)&&U.hasOwnProperty(it)&&U[it]!=null)if(it==="style"){var Ae=U[it];for(ce in Ae)Ae.hasOwnProperty(ce)&&(T||(T={}),T[ce]="")}else it!=="dangerouslySetInnerHTML"&&it!=="children"&&it!=="suppressContentEditableWarning"&&it!=="suppressHydrationWarning"&&it!=="autoFocus"&&(l.hasOwnProperty(it)?H||(H=[]):(H=H||[]).push(it,null));for(it in k){var Ue=k[it];if(Ae=U!=null?U[it]:void 0,k.hasOwnProperty(it)&&Ue!==Ae&&(Ue!=null||Ae!=null))if(it==="style")if(Ae){for(ce in Ae)!Ae.hasOwnProperty(ce)||Ue&&Ue.hasOwnProperty(ce)||(T||(T={}),T[ce]="");for(ce in Ue)Ue.hasOwnProperty(ce)&&Ae[ce]!==Ue[ce]&&(T||(T={}),T[ce]=Ue[ce])}else T||(H||(H=[]),H.push(it,T)),T=Ue;else it==="dangerouslySetInnerHTML"?(Ue=Ue?Ue.__html:void 0,Ae=Ae?Ae.__html:void 0,Ue!=null&&Ae!==Ue&&(H=H||[]).push(it,Ue)):it==="children"?typeof Ue!="string"&&typeof Ue!="number"||(H=H||[]).push(it,""+Ue):it!=="suppressContentEditableWarning"&&it!=="suppressHydrationWarning"&&(l.hasOwnProperty(it)?(Ue!=null&&it==="onScroll"&&Di("scroll",f),H||Ae===Ue||(H=[])):(H=H||[]).push(it,Ue))}T&&(H=H||[]).push("style",T);var it=H;(g.updateQueue=it)&&(g.flags|=4)}},MI=function(f,g,T,k){T!==k&&(g.flags|=4)};function __(f,g){if(!_i)switch(f.tailMode){case"hidden":g=f.tail;for(var T=null;g!==null;)g.alternate!==null&&(T=g),g=g.sibling;T===null?f.tail=null:T.sibling=null;break;case"collapsed":T=f.tail;for(var k=null;T!==null;)T.alternate!==null&&(k=T),T=T.sibling;k===null?g||f.tail===null?f.tail=null:f.tail.sibling=null:k.sibling=null}}function ko(f){var g=f.alternate!==null&&f.alternate.child===f.child,T=0,k=0;if(g)for(var U=f.child;U!==null;)T|=U.lanes|U.childLanes,k|=U.subtreeFlags&14680064,k|=U.flags&14680064,U.return=f,U=U.sibling;else for(U=f.child;U!==null;)T|=U.lanes|U.childLanes,k|=U.subtreeFlags,k|=U.flags,U.return=f,U=U.sibling;return f.subtreeFlags|=k,f.childLanes=T,g}function HE(f,g,T){var k=g.pendingProps;switch(s_(g),g.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return ko(g),null;case 1:return xa(g.type)&&yE(),ko(g),null;case 3:return k=g.stateNode,Bf(),xi(Da),xi(Po),vb(),k.pendingContext&&(k.context=k.pendingContext,k.pendingContext=null),(f===null||f.child===null)&&(o_(g)?g.flags|=4:f===null||f.memoizedState.isDehydrated&&(g.flags&256)===0||(g.flags|=1024,ia!==null&&(sv(ia),ia=null))),GE(f,g),ko(g),null;case 5:bm(g);var U=jf(Sm.current);if(T=g.type,f!==null&&g.stateNode!=null)Vb(f,g,T,k,U),f.ref!==g.ref&&(g.flags|=512,g.flags|=2097152);else{if(!k){if(g.stateNode===null)throw Error(i(166));return ko(g),null}if(f=jf(ru.current),o_(g)){k=g.stateNode,T=g.type;var H=g.memoizedProps;switch(k[tu]=g,k[th]=H,f=(g.mode&1)!==0,T){case"dialog":Di("cancel",k),Di("close",k);break;case"iframe":case"object":case"embed":Di("load",k);break;case"video":case"audio":for(U=0;U<Zg.length;U++)Di(Zg[U],k);break;case"source":Di("error",k);break;case"img":case"image":case"link":Di("error",k),Di("load",k);break;case"details":Di("toggle",k);break;case"input":Ht(k,H),Di("invalid",k);break;case"select":k._wrapperState={wasMultiple:!!H.multiple},Di("invalid",k);break;case"textarea":vt(k,H),Di("invalid",k)}Ot(T,H),U=null;for(var ce in H)if(H.hasOwnProperty(ce)){var Ae=H[ce];ce==="children"?typeof Ae=="string"?k.textContent!==Ae&&(H.suppressHydrationWarning!==!0&&mE(k.textContent,Ae,f),U=["children",Ae]):typeof Ae=="number"&&k.textContent!==""+Ae&&(H.suppressHydrationWarning!==!0&&mE(k.textContent,Ae,f),U=["children",""+Ae]):l.hasOwnProperty(ce)&&Ae!=null&&ce==="onScroll"&&Di("scroll",k)}switch(T){case"input":on(k),Re(k,H,!0);break;case"textarea":on(k),gn(k);break;case"select":case"option":break;default:typeof H.onClick=="function"&&(k.onclick=gE)}k=U,g.updateQueue=k,k!==null&&(g.flags|=4)}else{ce=U.nodeType===9?U:U.ownerDocument,f==="http://www.w3.org/1999/xhtml"&&(f=Pn(T)),f==="http://www.w3.org/1999/xhtml"?T==="script"?(f=ce.createElement("div"),f.innerHTML="<script><\/script>",f=f.removeChild(f.firstChild)):typeof k.is=="string"?f=ce.createElement(T,{is:k.is}):(f=ce.createElement(T),T==="select"&&(ce=f,k.multiple?ce.multiple=!0:k.size&&(ce.size=k.size))):f=ce.createElementNS(f,T),f[tu]=g,f[th]=k,LI(f,g,!1,!1),g.stateNode=f;e:{switch(ce=On(T,k),T){case"dialog":Di("cancel",f),Di("close",f),U=k;break;case"iframe":case"object":case"embed":Di("load",f),U=k;break;case"video":case"audio":for(U=0;U<Zg.length;U++)Di(Zg[U],f);U=k;break;case"source":Di("error",f),U=k;break;case"img":case"image":case"link":Di("error",f),Di("load",f),U=k;break;case"details":Di("toggle",f),U=k;break;case"input":Ht(f,k),U=an(f,k),Di("invalid",f);break;case"option":U=k;break;case"select":f._wrapperState={wasMultiple:!!k.multiple},U=ke({},k,{value:void 0}),Di("invalid",f);break;case"textarea":vt(f,k),U=yt(f,k),Di("invalid",f);break;default:U=k}Ot(T,U),Ae=U;for(H in Ae)if(Ae.hasOwnProperty(H)){var Ue=Ae[H];H==="style"?Vs(f,Ue):H==="dangerouslySetInnerHTML"?(Ue=Ue?Ue.__html:void 0,Ue!=null&&lr(f,Ue)):H==="children"?typeof Ue=="string"?(T!=="textarea"||Ue!=="")&&Dt(f,Ue):typeof Ue=="number"&&Dt(f,""+Ue):H!=="suppressContentEditableWarning"&&H!=="suppressHydrationWarning"&&H!=="autoFocus"&&(l.hasOwnProperty(H)?Ue!=null&&H==="onScroll"&&Di("scroll",f):Ue!=null&&se(f,H,Ue,ce))}switch(T){case"input":on(f),Re(f,k,!1);break;case"textarea":on(f),gn(f);break;case"option":k.value!=null&&f.setAttribute("value",""+ut(k.value));break;case"select":f.multiple=!!k.multiple,H=k.value,H!=null?at(f,!!k.multiple,H,!1):k.defaultValue!=null&&at(f,!!k.multiple,k.defaultValue,!0);break;default:typeof U.onClick=="function"&&(f.onclick=gE)}switch(T){case"button":case"input":case"select":case"textarea":k=!!k.autoFocus;break e;case"img":k=!0;break e;default:k=!1}}k&&(g.flags|=4)}g.ref!==null&&(g.flags|=512,g.flags|=2097152)}return ko(g),null;case 6:if(f&&g.stateNode!=null)MI(f,g,f.memoizedProps,k);else{if(typeof k!="string"&&g.stateNode===null)throw Error(i(166));if(T=jf(Sm.current),jf(ru.current),o_(g)){if(k=g.stateNode,T=g.memoizedProps,k[tu]=g,(H=k.nodeValue!==T)&&(f=La,f!==null))switch(f.tag){case 3:mE(k.nodeValue,T,(f.mode&1)!==0);break;case 5:f.memoizedProps.suppressHydrationWarning!==!0&&mE(k.nodeValue,T,(f.mode&1)!==0)}H&&(g.flags|=4)}else k=(T.nodeType===9?T:T.ownerDocument).createTextNode(k),k[tu]=g,g.stateNode=k}return ko(g),null;case 13:if(xi(ji),k=g.memoizedState,f===null||f.memoizedState!==null&&f.memoizedState.dehydrated!==null){if(_i&&Ma!==null&&(g.mode&1)!==0&&(g.flags&128)===0)rI(),ym(),g.flags|=98560,H=!1;else if(H=o_(g),k!==null&&k.dehydrated!==null){if(f===null){if(!H)throw Error(i(318));if(H=g.memoizedState,H=H!==null?H.dehydrated:null,!H)throw Error(i(317));H[tu]=g}else ym(),(g.flags&128)===0&&(g.memoizedState=null),g.flags|=4;ko(g),H=!1}else ia!==null&&(sv(ia),ia=null),H=!0;if(!H)return g.flags&65536?g:null}return(g.flags&128)!==0?(g.lanes=T,g):(k=k!==null,k!==(f!==null&&f.memoizedState!==null)&&k&&(g.child.flags|=8192,(g.mode&1)!==0&&(f===null||(ji.current&1)!==0?Rs===0&&(Rs=3):qb())),g.updateQueue!==null&&(g.flags|=4),ko(g),null);case 4:return Bf(),GE(f,g),f===null&&Nf(g.stateNode.containerInfo),ko(g),null;case 10:return mb(g.type._context),ko(g),null;case 17:return xa(g.type)&&yE(),ko(g),null;case 19:if(xi(ji),H=g.memoizedState,H===null)return ko(g),null;if(k=(g.flags&128)!==0,ce=H.rendering,ce===null)if(k)__(H,!1);else{if(Rs!==0||f!==null&&(f.flags&128)!==0)for(f=g.child;f!==null;){if(ce=ah(f),ce!==null){for(g.flags|=128,__(H,!1),k=ce.updateQueue,k!==null&&(g.updateQueue=k,g.flags|=4),g.subtreeFlags=0,k=T,T=g.child;T!==null;)H=T,f=k,H.flags&=14680066,ce=H.alternate,ce===null?(H.childLanes=0,H.lanes=f,H.child=null,H.subtreeFlags=0,H.memoizedProps=null,H.memoizedState=null,H.updateQueue=null,H.dependencies=null,H.stateNode=null):(H.childLanes=ce.childLanes,H.lanes=ce.lanes,H.child=ce.child,H.subtreeFlags=0,H.deletions=null,H.memoizedProps=ce.memoizedProps,H.memoizedState=ce.memoizedState,H.updateQueue=ce.updateQueue,H.type=ce.type,f=ce.dependencies,H.dependencies=f===null?null:{lanes:f.lanes,firstContext:f.firstContext}),T=T.sibling;return Ii(ji,ji.current&1|2),g.child}f=f.sibling}H.tail!==null&&Kr()>km&&(g.flags|=128,k=!0,__(H,!1),g.lanes=4194304)}else{if(!k)if(f=ah(ce),f!==null){if(g.flags|=128,k=!0,T=f.updateQueue,T!==null&&(g.updateQueue=T,g.flags|=4),__(H,!0),H.tail===null&&H.tailMode==="hidden"&&!ce.alternate&&!_i)return ko(g),null}else 2*Kr()-H.renderingStartTime>km&&T!==1073741824&&(g.flags|=128,k=!0,__(H,!1),g.lanes=4194304);H.isBackwards?(ce.sibling=g.child,g.child=ce):(T=H.last,T!==null?T.sibling=ce:g.child=ce,H.last=ce)}return H.tail!==null?(g=H.tail,H.rendering=g,H.tail=g.sibling,H.renderingStartTime=Kr(),g.sibling=null,T=ji.current,Ii(ji,k?T&1|2:T&1),g):(ko(g),null);case 22:case 23:return C_(),k=g.memoizedState!==null,f!==null&&f.memoizedState!==null!==k&&(g.flags|=8192),k&&(g.mode&1)!==0?(hc&1073741824)!==0&&(ko(g),g.subtreeFlags&6&&(g.flags|=8192)):ko(g),null;case 24:return null;case 25:return null}throw Error(i(156,g.tag))}function pD(f,g){switch(s_(g),g.tag){case 1:return xa(g.type)&&yE(),f=g.flags,f&65536?(g.flags=f&-65537|128,g):null;case 3:return Bf(),xi(Da),xi(Po),vb(),f=g.flags,(f&65536)!==0&&(f&128)===0?(g.flags=f&-65537|128,g):null;case 5:return bm(g),null;case 13:if(xi(ji),f=g.memoizedState,f!==null&&f.dehydrated!==null){if(g.alternate===null)throw Error(i(340));ym()}return f=g.flags,f&65536?(g.flags=f&-65537|128,g):null;case 19:return xi(ji),null;case 4:return Bf(),null;case 10:return mb(g.type._context),null;case 22:case 23:return C_(),null;case 24:return null;default:return null}}var $E=!1,No=!1,UI=typeof WeakSet=="function"?WeakSet:Set,tn=null;function Pm(f,g){var T=f.ref;if(T!==null)if(typeof T=="function")try{T(null)}catch(k){qi(f,g,k)}else T.current=null}function y_(f,g,T){try{T()}catch(k){qi(f,g,k)}}var VI=!1;function Fb(f,g){if(_E=Ce,f=FR(),Xg(f)){if("selectionStart"in f)var T={start:f.selectionStart,end:f.selectionEnd};else e:{T=(T=f.ownerDocument)&&T.defaultView||window;var k=T.getSelection&&T.getSelection();if(k&&k.rangeCount!==0){T=k.anchorNode;var U=k.anchorOffset,H=k.focusNode;k=k.focusOffset;try{T.nodeType,H.nodeType}catch{T=null;break e}var ce=0,Ae=-1,Ue=-1,it=0,Pt=0,kt=f,At=null;t:for(;;){for(var Xt;kt!==T||U!==0&&kt.nodeType!==3||(Ae=ce+U),kt!==H||k!==0&&kt.nodeType!==3||(Ue=ce+k),kt.nodeType===3&&(ce+=kt.nodeValue.length),(Xt=kt.firstChild)!==null;)At=kt,kt=Xt;for(;;){if(kt===f)break t;if(At===T&&++it===U&&(Ae=ce),At===H&&++Pt===k&&(Ue=ce),(Xt=kt.nextSibling)!==null)break;kt=At,At=kt.parentNode}kt=Xt}T=Ae===-1||Ue===-1?null:{start:Ae,end:Ue}}else T=null}T=T||{start:0,end:0}}else T=null;for(t_={focusedElem:f,selectionRange:T},Ce=!1,tn=g;tn!==null;)if(g=tn,f=g.child,(g.subtreeFlags&1028)!==0&&f!==null)f.return=g,tn=f;else for(;tn!==null;){g=tn;try{var rn=g.alternate;if((g.flags&1024)!==0)switch(g.tag){case 0:case 11:case 15:break;case 1:if(rn!==null){var sn=rn.memoizedProps,os=rn.memoizedState,Xe=g.stateNode,Ve=Xe.getSnapshotBeforeUpdate(g.elementType===g.type?sn:dc(g.type,sn),os);Xe.__reactInternalSnapshotBeforeUpdate=Ve}break;case 3:var et=g.stateNode.containerInfo;et.nodeType===1?et.textContent="":et.nodeType===9&&et.documentElement&&et.removeChild(et.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(i(163))}}catch(Lt){qi(g,g.return,Lt)}if(f=g.sibling,f!==null){f.return=g.return,tn=f;break}tn=g.return}return rn=VI,VI=!1,rn}function E_(f,g,T){var k=g.updateQueue;if(k=k!==null?k.lastEffect:null,k!==null){var U=k=k.next;do{if((U.tag&f)===f){var H=U.destroy;U.destroy=void 0,H!==void 0&&y_(g,T,H)}U=U.next}while(U!==k)}}function v_(f,g){if(g=g.updateQueue,g=g!==null?g.lastEffect:null,g!==null){var T=g=g.next;do{if((T.tag&f)===f){var k=T.create;T.destroy=k()}T=T.next}while(T!==g)}}function jb(f){var g=f.ref;if(g!==null){var T=f.stateNode;switch(f.tag){case 5:f=T;break;default:f=T}typeof g=="function"?g(f):g.current=f}}function FI(f){var g=f.alternate;g!==null&&(f.alternate=null,FI(g)),f.child=null,f.deletions=null,f.sibling=null,f.tag===5&&(g=f.stateNode,g!==null&&(delete g[tu],delete g[th],delete g[r_],delete g[rD],delete g[iD])),f.stateNode=null,f.return=null,f.dependencies=null,f.memoizedProps=null,f.memoizedState=null,f.pendingProps=null,f.stateNode=null,f.updateQueue=null}function Bb(f){return f.tag===5||f.tag===3||f.tag===4}function jI(f){e:for(;;){for(;f.sibling===null;){if(f.return===null||Bb(f.return))return null;f=f.return}for(f.sibling.return=f.return,f=f.sibling;f.tag!==5&&f.tag!==6&&f.tag!==18;){if(f.flags&2||f.child===null||f.tag===4)continue e;f.child.return=f,f=f.child}if(!(f.flags&2))return f.stateNode}}function Wb(f,g,T){var k=f.tag;if(k===5||k===6)f=f.stateNode,g?T.nodeType===8?T.parentNode.insertBefore(f,g):T.insertBefore(f,g):(T.nodeType===8?(g=T.parentNode,g.insertBefore(f,T)):(g=T,g.appendChild(f)),T=T._reactRootContainer,T!=null||g.onclick!==null||(g.onclick=gE));else if(k!==4&&(f=f.child,f!==null))for(Wb(f,g,T),f=f.sibling;f!==null;)Wb(f,g,T),f=f.sibling}function KE(f,g,T){var k=f.tag;if(k===5||k===6)f=f.stateNode,g?T.insertBefore(f,g):T.appendChild(f);else if(k!==4&&(f=f.child,f!==null))for(KE(f,g,T),f=f.sibling;f!==null;)KE(f,g,T),f=f.sibling}var uo=null,Fc=!1;function ou(f,g,T){for(T=T.child;T!==null;)BI(f,g,T),T=T.sibling}function BI(f,g,T){if(Ao&&typeof Ao.onCommitFiberUnmount=="function")try{Ao.onCommitFiberUnmount(Kl,T)}catch{}switch(T.tag){case 5:No||Pm(T,g);case 6:var k=uo,U=Fc;uo=null,ou(f,g,T),uo=k,Fc=U,uo!==null&&(Fc?(f=uo,T=T.stateNode,f.nodeType===8?f.parentNode.removeChild(T):f.removeChild(T)):uo.removeChild(T.stateNode));break;case 18:uo!==null&&(Fc?(f=uo,T=T.stateNode,f.nodeType===8?cb(f.parentNode,T):f.nodeType===1&&cb(f,T),ka(f)):cb(uo,T.stateNode));break;case 4:k=uo,U=Fc,uo=T.stateNode.containerInfo,Fc=!0,ou(f,g,T),uo=k,Fc=U;break;case 0:case 11:case 14:case 15:if(!No&&(k=T.updateQueue,k!==null&&(k=k.lastEffect,k!==null))){U=k=k.next;do{var H=U,ce=H.destroy;H=H.tag,ce!==void 0&&((H&2)!==0||(H&4)!==0)&&y_(T,g,ce),U=U.next}while(U!==k)}ou(f,g,T);break;case 1:if(!No&&(Pm(T,g),k=T.stateNode,typeof k.componentWillUnmount=="function"))try{k.props=T.memoizedProps,k.state=T.memoizedState,k.componentWillUnmount()}catch(Ae){qi(T,g,Ae)}ou(f,g,T);break;case 21:ou(f,g,T);break;case 22:T.mode&1?(No=(k=No)||T.memoizedState!==null,ou(f,g,T),No=k):ou(f,g,T);break;default:ou(f,g,T)}}function WI(f){var g=f.updateQueue;if(g!==null){f.updateQueue=null;var T=f.stateNode;T===null&&(T=f.stateNode=new UI),g.forEach(function(k){var U=qI.bind(null,f,k);T.has(k)||(T.add(k),k.then(U,U))})}}function aa(f,g){var T=g.deletions;if(T!==null)for(var k=0;k<T.length;k++){var U=T[k];try{var H=f,ce=g,Ae=ce;e:for(;Ae!==null;){switch(Ae.tag){case 5:uo=Ae.stateNode,Fc=!1;break e;case 3:uo=Ae.stateNode.containerInfo,Fc=!0;break e;case 4:uo=Ae.stateNode.containerInfo,Fc=!0;break e}Ae=Ae.return}if(uo===null)throw Error(i(160));BI(H,ce,U),uo=null,Fc=!1;var Ue=U.alternate;Ue!==null&&(Ue.return=null),U.return=null}catch(it){qi(U,g,it)}}if(g.subtreeFlags&12854)for(g=g.child;g!==null;)zb(g,f),g=g.sibling}function zb(f,g){var T=f.alternate,k=f.flags;switch(f.tag){case 0:case 11:case 14:case 15:if(aa(g,f),Fa(f),k&4){try{E_(3,f,f.return),v_(3,f)}catch(sn){qi(f,f.return,sn)}try{E_(5,f,f.return)}catch(sn){qi(f,f.return,sn)}}break;case 1:aa(g,f),Fa(f),k&512&&T!==null&&Pm(T,T.return);break;case 5:if(aa(g,f),Fa(f),k&512&&T!==null&&Pm(T,T.return),f.flags&32){var U=f.stateNode;try{Dt(U,"")}catch(sn){qi(f,f.return,sn)}}if(k&4&&(U=f.stateNode,U!=null)){var H=f.memoizedProps,ce=T!==null?T.memoizedProps:H,Ae=f.type,Ue=f.updateQueue;if(f.updateQueue=null,Ue!==null)try{Ae==="input"&&H.type==="radio"&&H.name!=null&&jn(U,H),On(Ae,ce);var it=On(Ae,H);for(ce=0;ce<Ue.length;ce+=2){var Pt=Ue[ce],kt=Ue[ce+1];Pt==="style"?Vs(U,kt):Pt==="dangerouslySetInnerHTML"?lr(U,kt):Pt==="children"?Dt(U,kt):se(U,Pt,kt,it)}switch(Ae){case"input":Wt(U,H);break;case"textarea":Gt(U,H);break;case"select":var At=U._wrapperState.wasMultiple;U._wrapperState.wasMultiple=!!H.multiple;var Xt=H.value;Xt!=null?at(U,!!H.multiple,Xt,!1):At!==!!H.multiple&&(H.defaultValue!=null?at(U,!!H.multiple,H.defaultValue,!0):at(U,!!H.multiple,H.multiple?[]:"",!1))}U[th]=H}catch(sn){qi(f,f.return,sn)}}break;case 6:if(aa(g,f),Fa(f),k&4){if(f.stateNode===null)throw Error(i(162));U=f.stateNode,H=f.memoizedProps;try{U.nodeValue=H}catch(sn){qi(f,f.return,sn)}}break;case 3:if(aa(g,f),Fa(f),k&4&&T!==null&&T.memoizedState.isDehydrated)try{ka(g.containerInfo)}catch(sn){qi(f,f.return,sn)}break;case 4:aa(g,f),Fa(f);break;case 13:aa(g,f),Fa(f),U=f.child,U.flags&8192&&(H=U.memoizedState!==null,U.stateNode.isHidden=H,!H||U.alternate!==null&&U.alternate.memoizedState!==null||(ZE=Kr())),k&4&&WI(f);break;case 22:if(Pt=T!==null&&T.memoizedState!==null,f.mode&1?(No=(it=No)||Pt,aa(g,f),No=it):aa(g,f),Fa(f),k&8192){if(it=f.memoizedState!==null,(f.stateNode.isHidden=it)&&!Pt&&(f.mode&1)!==0)for(tn=f,Pt=f.child;Pt!==null;){for(kt=tn=Pt;tn!==null;){switch(At=tn,Xt=At.child,At.tag){case 0:case 11:case 14:case 15:E_(4,At,At.return);break;case 1:Pm(At,At.return);var rn=At.stateNode;if(typeof rn.componentWillUnmount=="function"){k=At,T=At.return;try{g=k,rn.props=g.memoizedProps,rn.state=g.memoizedState,rn.componentWillUnmount()}catch(sn){qi(k,T,sn)}}break;case 5:Pm(At,At.return);break;case 22:if(At.memoizedState!==null){S_(kt);continue}}Xt!==null?(Xt.return=At,tn=Xt):S_(kt)}Pt=Pt.sibling}e:for(Pt=null,kt=f;;){if(kt.tag===5){if(Pt===null){Pt=kt;try{U=kt.stateNode,it?(H=U.style,typeof H.setProperty=="function"?H.setProperty("display","none","important"):H.display="none"):(Ae=kt.stateNode,Ue=kt.memoizedProps.style,ce=Ue!=null&&Ue.hasOwnProperty("display")?Ue.display:null,Ae.style.display=Hi("display",ce))}catch(sn){qi(f,f.return,sn)}}}else if(kt.tag===6){if(Pt===null)try{kt.stateNode.nodeValue=it?"":kt.memoizedProps}catch(sn){qi(f,f.return,sn)}}else if((kt.tag!==22&&kt.tag!==23||kt.memoizedState===null||kt===f)&&kt.child!==null){kt.child.return=kt,kt=kt.child;continue}if(kt===f)break e;for(;kt.sibling===null;){if(kt.return===null||kt.return===f)break e;Pt===kt&&(Pt=null),kt=kt.return}Pt===kt&&(Pt=null),kt.sibling.return=kt.return,kt=kt.sibling}}break;case 19:aa(g,f),Fa(f),k&4&&WI(f);break;case 21:break;default:aa(g,f),Fa(f)}}function Fa(f){var g=f.flags;if(g&2){try{e:{for(var T=f.return;T!==null;){if(Bb(T)){var k=T;break e}T=T.return}throw Error(i(160))}switch(k.tag){case 5:var U=k.stateNode;k.flags&32&&(Dt(U,""),k.flags&=-33);var H=jI(f);KE(f,H,U);break;case 3:case 4:var ce=k.stateNode.containerInfo,Ae=jI(f);Wb(f,Ae,ce);break;default:throw Error(i(161))}}catch(Ue){qi(f,f.return,Ue)}f.flags&=-3}g&4096&&(f.flags&=-4097)}function Om(f,g,T){tn=f,Gb(f)}function Gb(f,g,T){for(var k=(f.mode&1)!==0;tn!==null;){var U=tn,H=U.child;if(U.tag===22&&k){var ce=U.memoizedState!==null||$E;if(!ce){var Ae=U.alternate,Ue=Ae!==null&&Ae.memoizedState!==null||No;Ae=$E;var it=No;if($E=ce,(No=Ue)&&!it)for(tn=U;tn!==null;)ce=tn,Ue=ce.child,ce.tag===22&&ce.memoizedState!==null?zI(U):Ue!==null?(Ue.return=ce,tn=Ue):zI(U);for(;H!==null;)tn=H,Gb(H),H=H.sibling;tn=U,$E=Ae,No=it}qE(f)}else(U.subtreeFlags&8772)!==0&&H!==null?(H.return=U,tn=H):qE(f)}}function qE(f){for(;tn!==null;){var g=tn;if((g.flags&8772)!==0){var T=g.alternate;try{if((g.flags&8772)!==0)switch(g.tag){case 0:case 11:case 15:No||v_(5,g);break;case 1:var k=g.stateNode;if(g.flags&4&&!No)if(T===null)k.componentDidMount();else{var U=g.elementType===g.type?T.memoizedProps:dc(g.type,T.memoizedProps);k.componentDidUpdate(U,T.memoizedState,k.__reactInternalSnapshotBeforeUpdate)}var H=g.updateQueue;H!==null&&cI(g,H,k);break;case 3:var ce=g.updateQueue;if(ce!==null){if(T=null,g.child!==null)switch(g.child.tag){case 5:T=g.child.stateNode;break;case 1:T=g.child.stateNode}cI(g,ce,T)}break;case 5:var Ae=g.stateNode;if(T===null&&g.flags&4){T=Ae;var Ue=g.memoizedProps;switch(g.type){case"button":case"input":case"select":case"textarea":Ue.autoFocus&&T.focus();break;case"img":Ue.src&&(T.src=Ue.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(g.memoizedState===null){var it=g.alternate;if(it!==null){var Pt=it.memoizedState;if(Pt!==null){var kt=Pt.dehydrated;kt!==null&&ka(kt)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(i(163))}No||g.flags&512&&jb(g)}catch(At){qi(g,g.return,At)}}if(g===f){tn=null;break}if(T=g.sibling,T!==null){T.return=g.return,tn=T;break}tn=g.return}}function S_(f){for(;tn!==null;){var g=tn;if(g===f){tn=null;break}var T=g.sibling;if(T!==null){T.return=g.return,tn=T;break}tn=g.return}}function zI(f){for(;tn!==null;){var g=tn;try{switch(g.tag){case 0:case 11:case 15:var T=g.return;try{v_(4,g)}catch(Ue){qi(g,T,Ue)}break;case 1:var k=g.stateNode;if(typeof k.componentDidMount=="function"){var U=g.return;try{k.componentDidMount()}catch(Ue){qi(g,U,Ue)}}var H=g.return;try{jb(g)}catch(Ue){qi(g,H,Ue)}break;case 5:var ce=g.return;try{jb(g)}catch(Ue){qi(g,ce,Ue)}}}catch(Ue){qi(g,g.return,Ue)}if(g===f){tn=null;break}var Ae=g.sibling;if(Ae!==null){Ae.return=g.return,tn=Ae;break}tn=g.return}}var mD=Math.ceil,YE=ue.ReactCurrentDispatcher,XE=ue.ReactCurrentOwner,jc=ue.ReactCurrentBatchConfig,kr=0,Qs=null,ss=null,Cs=0,hc=0,vl=xc(0),Rs=0,ho=null,Hf=0,JE=0,QE=0,b_=null,ca=null,ZE=0,km=1/0,au=null,ev=!1,Hb=null,uh=null,Nm=!1,cu=null,tv=0,$f=0,$b=null,T_=-1,nv=0;function fo(){return(kr&6)!==0?Kr():T_!==-1?T_:T_=Kr()}function Bc(f){return(f.mode&1)===0?1:(kr&2)!==0&&Cs!==0?Cs&-Cs:oD.transition!==null?(nv===0&&(nv=Hu()),nv):(f=ar,f!==0||(f=window.event,f=f===void 0?16:qr(f.type)),f)}function Wc(f,g,T,k){if(50<$f)throw $f=0,$b=null,Error(i(185));Xl(f,T,k),((kr&2)===0||f!==Qs)&&(f===Qs&&((kr&2)===0&&(JE|=T),Rs===4&&ad(f,Cs)),Do(f,k),T===1&&kr===0&&(g.mode&1)===0&&(km=Kr()+500,SE&&rh()))}function Do(f,g){var T=f.callbackNode;sc(f,g);var k=Yl(f,f===Qs?Cs:0);if(k===0)T!==null&&zu(T),f.callbackNode=null,f.callbackPriority=0;else if(g=k&-k,f.callbackPriority!==g){if(T!=null&&zu(T),g===1)f.tag===0?sD(Kf.bind(null,f)):ZR(Kf.bind(null,f)),tD(function(){(kr&6)===0&&rh()}),T=null;else{switch(Ac(k)){case 1:T=Ic;break;case 4:T=fl;break;case 16:T=Pa;break;case 536870912:T=qd;break;default:T=Pa}T=R_(T,rv.bind(null,f))}f.callbackPriority=g,f.callbackNode=T}}function rv(f,g){if(T_=-1,nv=0,(kr&6)!==0)throw Error(i(327));var T=f.callbackNode;if(Dm()&&f.callbackNode!==T)return null;var k=Yl(f,f===Qs?Cs:0);if(k===0)return null;if((k&30)!==0||(k&f.expiredLanes)!==0||g)g=lu(f,k);else{g=k;var U=kr;kr|=2;var H=GI();(Qs!==f||Cs!==g)&&(au=null,km=Kr()+500,dh(f,g));do try{gD();break}catch(Ae){Kb(f,Ae)}while(!0);pb(),YE.current=H,kr=U,ss!==null?g=0:(Qs=null,Cs=0,g=Rs)}if(g!==0){if(g===2&&(U=Ko(f),U!==0&&(k=U,g=iv(f,U))),g===1)throw T=ho,dh(f,0),ad(f,k),Do(f,Kr()),T;if(g===6)ad(f,k);else{if(U=f.current.alternate,(k&30)===0&&!ov(U)&&(g=lu(f,k),g===2&&(H=Ko(f),H!==0&&(k=H,g=iv(f,H))),g===1))throw T=ho,dh(f,0),ad(f,k),Do(f,Kr()),T;switch(f.finishedWork=U,f.finishedLanes=k,g){case 0:case 1:throw Error(i(345));case 2:qf(f,ca,au);break;case 3:if(ad(f,k),(k&130023424)===k&&(g=ZE+500-Kr(),10<g)){if(Yl(f,0)!==0)break;if(U=f.suspendedLanes,(U&k)!==k){fo(),f.pingedLanes|=f.suspendedLanes&U;break}f.timeoutHandle=n_(qf.bind(null,f,ca,au),g);break}qf(f,ca,au);break;case 4:if(ad(f,k),(k&4194240)===k)break;for(g=f.eventTimes,U=-1;0<k;){var ce=31-lo(k);H=1<<ce,ce=g[ce],ce>U&&(U=ce),k&=~H}if(k=U,k=Kr()-k,k=(120>k?120:480>k?480:1080>k?1080:1920>k?1920:3e3>k?3e3:4320>k?4320:1960*mD(k/1960))-k,10<k){f.timeoutHandle=n_(qf.bind(null,f,ca,au),k);break}qf(f,ca,au);break;case 5:qf(f,ca,au);break;default:throw Error(i(329))}}}return Do(f,Kr()),f.callbackNode===T?rv.bind(null,f):null}function iv(f,g){var T=b_;return f.current.memoizedState.isDehydrated&&(dh(f,g).flags|=256),f=lu(f,g),f!==2&&(g=ca,ca=T,g!==null&&sv(g)),f}function sv(f){ca===null?ca=f:ca.push.apply(ca,f)}function ov(f){for(var g=f;;){if(g.flags&16384){var T=g.updateQueue;if(T!==null&&(T=T.stores,T!==null))for(var k=0;k<T.length;k++){var U=T[k],H=U.getSnapshot;U=U.value;try{if(!El(H(),U))return!1}catch{return!1}}}if(T=g.child,g.subtreeFlags&16384&&T!==null)T.return=g,g=T;else{if(g===f)break;for(;g.sibling===null;){if(g.return===null||g.return===f)return!0;g=g.return}g.sibling.return=g.return,g=g.sibling}}return!0}function ad(f,g){for(g&=~QE,g&=~JE,f.suspendedLanes|=g,f.pingedLanes&=~g,f=f.expirationTimes;0<g;){var T=31-lo(g),k=1<<T;f[T]=-1,g&=~k}}function Kf(f){if((kr&6)!==0)throw Error(i(327));Dm();var g=Yl(f,0);if((g&1)===0)return Do(f,Kr()),null;var T=lu(f,g);if(f.tag!==0&&T===2){var k=Ko(f);k!==0&&(g=k,T=iv(f,k))}if(T===1)throw T=ho,dh(f,0),ad(f,g),Do(f,Kr()),T;if(T===6)throw Error(i(345));return f.finishedWork=f.current.alternate,f.finishedLanes=g,qf(f,ca,au),Do(f,Kr()),null}function w_(f,g){var T=kr;kr|=1;try{return f(g)}finally{kr=T,kr===0&&(km=Kr()+500,SE&&rh())}}function cd(f){cu!==null&&cu.tag===0&&(kr&6)===0&&Dm();var g=kr;kr|=1;var T=jc.transition,k=ar;try{if(jc.transition=null,ar=1,f)return f()}finally{ar=k,jc.transition=T,kr=g,(kr&6)===0&&rh()}}function C_(){hc=vl.current,xi(vl)}function dh(f,g){f.finishedWork=null,f.finishedLanes=0;var T=f.timeoutHandle;if(T!==-1&&(f.timeoutHandle=-1,eD(T)),ss!==null)for(T=ss.return;T!==null;){var k=T;switch(s_(k),k.tag){case 1:k=k.type.childContextTypes,k!=null&&yE();break;case 3:Bf(),xi(Da),xi(Po),vb();break;case 5:bm(k);break;case 4:Bf();break;case 13:xi(ji);break;case 19:xi(ji);break;case 10:mb(k.type._context);break;case 22:case 23:C_()}T=T.return}if(Qs=f,ss=f=ld(f.current,null),Cs=hc=g,Rs=0,ho=null,QE=JE=Hf=0,ca=b_=null,Ff!==null){for(g=0;g<Ff.length;g++)if(T=Ff[g],k=T.interleaved,k!==null){T.interleaved=null;var U=k.next,H=T.pending;if(H!==null){var ce=H.next;H.next=U,k.next=ce}T.pending=k}Ff=null}return f}function Kb(f,g){do{var T=ss;try{if(pb(),OE.current=xE,Tm){for(var k=Ki.memoizedState;k!==null;){var U=k.queue;U!==null&&(U.pending=null),k=k.next}Tm=!1}if(iu=0,ws=Ts=Ki=null,f_=!1,p_=0,XE.current=null,T===null||T.return===null){Rs=1,ho=g,ss=null;break}e:{var H=f,ce=T.return,Ae=T,Ue=g;if(g=Cs,Ae.flags|=32768,Ue!==null&&typeof Ue=="object"&&typeof Ue.then=="function"){var it=Ue,Pt=Ae,kt=Pt.tag;if((Pt.mode&1)===0&&(kt===0||kt===11||kt===15)){var At=Pt.alternate;At?(Pt.updateQueue=At.updateQueue,Pt.memoizedState=At.memoizedState,Pt.lanes=At.lanes):(Pt.updateQueue=null,Pt.memoizedState=null)}var Xt=wI(ce);if(Xt!==null){Xt.flags&=-257,CI(Xt,ce,Ae,H,g),Xt.mode&1&&TI(H,it,g),g=Xt,Ue=it;var rn=g.updateQueue;if(rn===null){var sn=new Set;sn.add(Ue),g.updateQueue=sn}else rn.add(Ue);break e}else{if((g&1)===0){TI(H,it,g),qb();break e}Ue=Error(i(426))}}else if(_i&&Ae.mode&1){var os=wI(ce);if(os!==null){(os.flags&65536)===0&&(os.flags|=256),CI(os,ce,Ae,H,g),hb(Im(Ue,Ae));break e}}H=Ue=Im(Ue,Ae),Rs!==4&&(Rs=2),b_===null?b_=[H]:b_.push(H),H=ce;do{switch(H.tag){case 3:H.flags|=65536,g&=-g,H.lanes|=g;var Xe=xb(H,Ue,g);aI(H,Xe);break e;case 1:Ae=Ue;var Ve=H.type,et=H.stateNode;if((H.flags&128)===0&&(typeof Ve.getDerivedStateFromError=="function"||et!==null&&typeof et.componentDidCatch=="function"&&(uh===null||!uh.has(et)))){H.flags|=65536,g&=-g,H.lanes|=g;var Lt=od(H,Ae,g);aI(H,Lt);break e}}H=H.return}while(H!==null)}$I(T)}catch(cn){g=cn,ss===T&&T!==null&&(ss=T=T.return);continue}break}while(!0)}function GI(){var f=YE.current;return YE.current=xE,f===null?xE:f}function qb(){(Rs===0||Rs===3||Rs===2)&&(Rs=4),Qs===null||(Hf&268435455)===0&&(JE&268435455)===0||ad(Qs,Cs)}function lu(f,g){var T=kr;kr|=2;var k=GI();(Qs!==f||Cs!==g)&&(au=null,dh(f,g));do try{HI();break}catch(U){Kb(f,U)}while(!0);if(pb(),kr=T,YE.current=k,ss!==null)throw Error(i(261));return Qs=null,Cs=0,Rs}function HI(){for(;ss!==null;)av(ss)}function gD(){for(;ss!==null&&!$o();)av(ss)}function av(f){var g=uv(f.alternate,f,hc);f.memoizedProps=f.pendingProps,g===null?$I(f):ss=g,XE.current=null}function $I(f){var g=f;do{var T=g.alternate;if(f=g.return,(g.flags&32768)===0){if(T=HE(T,g,hc),T!==null){ss=T;return}}else{if(T=pD(T,g),T!==null){T.flags&=32767,ss=T;return}if(f!==null)f.flags|=32768,f.subtreeFlags=0,f.deletions=null;else{Rs=6,ss=null;return}}if(g=g.sibling,g!==null){ss=g;return}ss=g=f}while(g!==null);Rs===0&&(Rs=5)}function qf(f,g,T){var k=ar,U=jc.transition;try{jc.transition=null,ar=1,_D(f,g,T,k)}finally{jc.transition=U,ar=k}return null}function _D(f,g,T,k){do Dm();while(cu!==null);if((kr&6)!==0)throw Error(i(327));T=f.finishedWork;var U=f.finishedLanes;if(T===null)return null;if(f.finishedWork=null,f.finishedLanes=0,T===f.current)throw Error(i(177));f.callbackNode=null,f.callbackPriority=0;var H=T.lanes|T.childLanes;if(Zr(f,H),f===Qs&&(ss=Qs=null,Cs=0),(T.subtreeFlags&2064)===0&&(T.flags&2064)===0||Nm||(Nm=!0,R_(Pa,function(){return Dm(),null})),H=(T.flags&15990)!==0,(T.subtreeFlags&15990)!==0||H){H=jc.transition,jc.transition=null;var ce=ar;ar=1;var Ae=kr;kr|=4,XE.current=null,Fb(f,T),zb(T,f),tb(t_),Ce=!!_E,t_=_E=null,f.current=T,Om(T),Kd(),kr=Ae,ar=ce,jc.transition=H}else f.current=T;if(Nm&&(Nm=!1,cu=f,tv=U),H=f.pendingLanes,H===0&&(uh=null),Zp(T.stateNode),Do(f,Kr()),g!==null)for(k=f.onRecoverableError,T=0;T<g.length;T++)U=g[T],k(U.value,{componentStack:U.stack,digest:U.digest});if(ev)throw ev=!1,f=Hb,Hb=null,f;return(tv&1)!==0&&f.tag!==0&&Dm(),H=f.pendingLanes,(H&1)!==0?f===$b?$f++:($f=0,$b=f):$f=0,rh(),null}function Dm(){if(cu!==null){var f=Ac(tv),g=jc.transition,T=ar;try{if(jc.transition=null,ar=16>f?16:f,cu===null)var k=!1;else{if(f=cu,cu=null,tv=0,(kr&6)!==0)throw Error(i(331));var U=kr;for(kr|=4,tn=f.current;tn!==null;){var H=tn,ce=H.child;if((tn.flags&16)!==0){var Ae=H.deletions;if(Ae!==null){for(var Ue=0;Ue<Ae.length;Ue++){var it=Ae[Ue];for(tn=it;tn!==null;){var Pt=tn;switch(Pt.tag){case 0:case 11:case 15:E_(8,Pt,H)}var kt=Pt.child;if(kt!==null)kt.return=Pt,tn=kt;else for(;tn!==null;){Pt=tn;var At=Pt.sibling,Xt=Pt.return;if(FI(Pt),Pt===it){tn=null;break}if(At!==null){At.return=Xt,tn=At;break}tn=Xt}}}var rn=H.alternate;if(rn!==null){var sn=rn.child;if(sn!==null){rn.child=null;do{var os=sn.sibling;sn.sibling=null,sn=os}while(sn!==null)}}tn=H}}if((H.subtreeFlags&2064)!==0&&ce!==null)ce.return=H,tn=ce;else e:for(;tn!==null;){if(H=tn,(H.flags&2048)!==0)switch(H.tag){case 0:case 11:case 15:E_(9,H,H.return)}var Xe=H.sibling;if(Xe!==null){Xe.return=H.return,tn=Xe;break e}tn=H.return}}var Ve=f.current;for(tn=Ve;tn!==null;){ce=tn;var et=ce.child;if((ce.subtreeFlags&2064)!==0&&et!==null)et.return=ce,tn=et;else e:for(ce=Ve;tn!==null;){if(Ae=tn,(Ae.flags&2048)!==0)try{switch(Ae.tag){case 0:case 11:case 15:v_(9,Ae)}}catch(cn){qi(Ae,Ae.return,cn)}if(Ae===ce){tn=null;break e}var Lt=Ae.sibling;if(Lt!==null){Lt.return=Ae.return,tn=Lt;break e}tn=Ae.return}}if(kr=U,rh(),Ao&&typeof Ao.onPostCommitFiberRoot=="function")try{Ao.onPostCommitFiberRoot(Kl,f)}catch{}k=!0}return k}finally{ar=T,jc.transition=g}}return!1}function cv(f,g,T){g=Im(T,g),g=xb(f,g,1),f=oh(f,g,1),g=fo(),f!==null&&(Xl(f,1,g),Do(f,g))}function qi(f,g,T){if(f.tag===3)cv(f,f,T);else for(;g!==null;){if(g.tag===3){cv(g,f,T);break}else if(g.tag===1){var k=g.stateNode;if(typeof g.type.getDerivedStateFromError=="function"||typeof k.componentDidCatch=="function"&&(uh===null||!uh.has(k))){f=Im(T,f),f=od(g,f,1),g=oh(g,f,1),f=fo(),g!==null&&(Xl(g,1,f),Do(g,f));break}}g=g.return}}function KI(f,g,T){var k=f.pingCache;k!==null&&k.delete(g),g=fo(),f.pingedLanes|=f.suspendedLanes&T,Qs===f&&(Cs&T)===T&&(Rs===4||Rs===3&&(Cs&130023424)===Cs&&500>Kr()-ZE?dh(f,0):QE|=T),Do(f,g)}function Yb(f,g){g===0&&((f.mode&1)===0?g=1:(g=_r,_r<<=1,(_r&130023424)===0&&(_r=4194304)));var T=fo();f=rd(f,g),f!==null&&(Xl(f,g,T),Do(f,T))}function lv(f){var g=f.memoizedState,T=0;g!==null&&(T=g.retryLane),Yb(f,T)}function qI(f,g){var T=0;switch(f.tag){case 13:var k=f.stateNode,U=f.memoizedState;U!==null&&(T=U.retryLane);break;case 19:k=f.stateNode;break;default:throw Error(i(314))}k!==null&&k.delete(g),Yb(f,T)}var uv;uv=function(f,g,T){if(f!==null)if(f.memoizedProps!==g.pendingProps||Da.current)Va=!0;else{if((f.lanes&T)===0&&(g.flags&128)===0)return Va=!1,xI(f,g,T);Va=(f.flags&131072)!==0}else Va=!1,_i&&(g.flags&1048576)!==0&&TE(g,bE,g.index);switch(g.lanes=0,g.tag){case 2:var k=g.type;zE(f,g),f=g.pendingProps;var U=Uf(g,Po.current);nd(g,T),U=wm(null,g,k,f,U,T);var H=Tb();return g.flags|=1,typeof U=="object"&&U!==null&&typeof U.render=="function"&&U.$$typeof===void 0?(g.tag=1,g.memoizedState=null,g.updateQueue=null,xa(k)?(H=!0,vE(g)):H=!1,g.memoizedState=U.state!==null&&U.state!==void 0?U.state:null,l_(g),U.updater=ME,g.stateNode=U,U._reactInternals=g,kb(g,k,f,T),g=VE(null,g,k,!0,H,T)):(g.tag=0,_i&&H&&wE(g),oa(null,g,U,T),g=g.child),g;case 16:k=g.elementType;e:{switch(zE(f,g),f=g.pendingProps,U=k._init,k=U(k._payload),g.type=k,U=g.tag=Yf(k),f=dc(k,f),U){case 0:g=Lb(null,g,k,f,T);break e;case 1:g=OI(null,g,k,f,T);break e;case 11:g=UE(null,g,k,f,T);break e;case 14:g=RI(null,g,k,dc(k.type,f),T);break e}throw Error(i(306,k,""))}return g;case 0:return k=g.type,U=g.pendingProps,U=g.elementType===k?U:dc(k,U),Lb(f,g,k,U,T);case 1:return k=g.type,U=g.pendingProps,U=g.elementType===k?U:dc(k,U),OI(f,g,k,U,T);case 3:e:{if(Mb(g),f===null)throw Error(i(387));k=g.pendingProps,H=g.memoizedState,U=H.element,oI(f,g),PE(g,k,null,T);var ce=g.memoizedState;if(k=ce.element,H.isDehydrated)if(H={element:k,isDehydrated:!1,cache:ce.cache,pendingSuspenseBoundaries:ce.pendingSuspenseBoundaries,transitions:ce.transitions},g.updateQueue.baseState=H,g.memoizedState=H,g.flags&256){U=Im(Error(i(423)),g),g=kI(f,g,k,T,U);break e}else if(k!==U){U=Im(Error(i(424)),g),g=kI(f,g,k,T,U);break e}else for(Ma=eh(g.stateNode.containerInfo.firstChild),La=g,_i=!0,ia=null,T=iI(g,null,k,T),g.child=T;T;)T.flags=T.flags&-3|4096,T=T.sibling;else{if(ym(),k===U){g=su(f,g,T);break e}oa(f,g,k,T)}g=g.child}return g;case 5:return lI(g),f===null&&db(g),k=g.type,U=g.pendingProps,H=f!==null?f.memoizedProps:null,ce=U.children,ab(k,U)?ce=null:H!==null&&ab(k,H)&&(g.flags|=32),PI(f,g),oa(f,g,ce,T),g.child;case 6:return f===null&&db(g),null;case 13:return FE(f,g,T);case 4:return yb(g,g.stateNode.containerInfo),k=g.pendingProps,f===null?g.child=Em(g,null,k,T):oa(f,g,k,T),g.child;case 11:return k=g.type,U=g.pendingProps,U=g.elementType===k?U:dc(k,U),UE(f,g,k,U,T);case 7:return oa(f,g,g.pendingProps,T),g.child;case 8:return oa(f,g,g.pendingProps.children,T),g.child;case 12:return oa(f,g,g.pendingProps.children,T),g.child;case 10:e:{if(k=g.type._context,U=g.pendingProps,H=g.memoizedProps,ce=U.value,Ii(IE,k._currentValue),k._currentValue=ce,H!==null)if(El(H.value,ce)){if(H.children===U.children&&!Da.current){g=su(f,g,T);break e}}else for(H=g.child,H!==null&&(H.return=g);H!==null;){var Ae=H.dependencies;if(Ae!==null){ce=H.child;for(var Ue=Ae.firstContext;Ue!==null;){if(Ue.context===k){if(H.tag===1){Ue=nu(-1,T&-T),Ue.tag=2;var it=H.updateQueue;if(it!==null){it=it.shared;var Pt=it.pending;Pt===null?Ue.next=Ue:(Ue.next=Pt.next,Pt.next=Ue),it.pending=Ue}}H.lanes|=T,Ue=H.alternate,Ue!==null&&(Ue.lanes|=T),gb(H.return,T,g),Ae.lanes|=T;break}Ue=Ue.next}}else if(H.tag===10)ce=H.type===g.type?null:H.child;else if(H.tag===18){if(ce=H.return,ce===null)throw Error(i(341));ce.lanes|=T,Ae=ce.alternate,Ae!==null&&(Ae.lanes|=T),gb(ce,T,g),ce=H.sibling}else ce=H.child;if(ce!==null)ce.return=H;else for(ce=H;ce!==null;){if(ce===g){ce=null;break}if(H=ce.sibling,H!==null){H.return=ce.return,ce=H;break}ce=ce.return}H=ce}oa(f,g,U.children,T),g=g.child}return g;case 9:return U=g.type,k=g.pendingProps.children,nd(g,T),U=Uc(U),k=k(U),g.flags|=1,oa(f,g,k,T),g.child;case 14:return k=g.type,U=dc(k,g.pendingProps),U=dc(k.type,U),RI(f,g,k,U,T);case 15:return II(f,g,g.type,g.pendingProps,T);case 17:return k=g.type,U=g.pendingProps,U=g.elementType===k?U:dc(k,U),zE(f,g),g.tag=1,xa(k)?(f=!0,vE(g)):f=!1,nd(g,T),SI(g,k,U),kb(g,k,U,T),VE(null,g,k,!0,f,T);case 19:return WE(f,g,T);case 22:return AI(f,g,T)}throw Error(i(156,g.tag))};function R_(f,g){return $d(f,g)}function dv(f,g,T,k){this.tag=f,this.key=T,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=g,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=k,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function fc(f,g,T,k){return new dv(f,g,T,k)}function hh(f){return f=f.prototype,!(!f||!f.isReactComponent)}function Yf(f){if(typeof f=="function")return hh(f)?1:0;if(f!=null){if(f=f.$$typeof,f===de)return 11;if(f===We)return 14}return 2}function ld(f,g){var T=f.alternate;return T===null?(T=fc(f.tag,g,f.key,f.mode),T.elementType=f.elementType,T.type=f.type,T.stateNode=f.stateNode,T.alternate=f,f.alternate=T):(T.pendingProps=g,T.type=f.type,T.flags=0,T.subtreeFlags=0,T.deletions=null),T.flags=f.flags&14680064,T.childLanes=f.childLanes,T.lanes=f.lanes,T.child=f.child,T.memoizedProps=f.memoizedProps,T.memoizedState=f.memoizedState,T.updateQueue=f.updateQueue,g=f.dependencies,T.dependencies=g===null?null:{lanes:g.lanes,firstContext:g.firstContext},T.sibling=f.sibling,T.index=f.index,T.ref=f.ref,T}function hv(f,g,T,k,U,H){var ce=2;if(k=f,typeof f=="function")hh(f)&&(ce=1);else if(typeof f=="string")ce=5;else e:switch(f){case q:return Xf(T.children,U,H,g);case Q:ce=8,U|=8;break;case J:return f=fc(12,T,g,U|2),f.elementType=J,f.lanes=H,f;case le:return f=fc(13,T,g,U),f.elementType=le,f.lanes=H,f;case xe:return f=fc(19,T,g,U),f.elementType=xe,f.lanes=H,f;case ve:return fh(T,U,H,g);default:if(typeof f=="object"&&f!==null)switch(f.$$typeof){case ie:ce=10;break e;case me:ce=9;break e;case de:ce=11;break e;case We:ce=14;break e;case $e:ce=16,k=null;break e}throw Error(i(130,f==null?f:typeof f,""))}return g=fc(ce,T,g,U),g.elementType=f,g.type=k,g.lanes=H,g}function Xf(f,g,T,k){return f=fc(7,f,k,g),f.lanes=T,f}function fh(f,g,T,k){return f=fc(22,f,k,g),f.elementType=ve,f.lanes=T,f.stateNode={isHidden:!1},f}function Xb(f,g,T){return f=fc(6,f,null,g),f.lanes=T,f}function Jb(f,g,T){return g=fc(4,f.children!==null?f.children:[],f.key,g),g.lanes=T,g.stateNode={containerInfo:f.containerInfo,pendingChildren:null,implementation:f.implementation},g}function yD(f,g,T,k,U){this.tag=g,this.containerInfo=f,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=ml(0),this.expirationTimes=ml(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=ml(0),this.identifierPrefix=k,this.onRecoverableError=U,this.mutableSourceEagerHydrationData=null}function Qb(f,g,T,k,U,H,ce,Ae,Ue){return f=new yD(f,g,T,Ae,Ue),g===1?(g=1,H===!0&&(g|=8)):g=0,H=fc(3,null,null,g),f.current=H,H.stateNode=f,H.memoizedState={element:k,isDehydrated:T,cache:null,transitions:null,pendingSuspenseBoundaries:null},l_(H),f}function ED(f,g,T){var k=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:pe,key:k==null?null:""+k,children:f,containerInfo:g,implementation:T}}function YI(f){if(!f)return nh;f=f._reactInternals;e:{if(Xs(f)!==f||f.tag!==1)throw Error(i(170));var g=f;do{switch(g.tag){case 3:g=g.stateNode.context;break e;case 1:if(xa(g.type)){g=g.stateNode.__reactInternalMemoizedMergedChildContext;break e}}g=g.return}while(g!==null);throw Error(i(171))}if(f.tag===1){var T=f.type;if(xa(T))return EE(f,T,g)}return g}function fv(f,g,T,k,U,H,ce,Ae,Ue){return f=Qb(T,k,!0,f,U,H,ce,Ae,Ue),f.context=YI(null),T=f.current,k=fo(),U=Bc(T),H=nu(k,U),H.callback=g??null,oh(T,H,U),f.current.lanes=U,Xl(f,U,k),Do(f,k),f}function I_(f,g,T,k){var U=g.current,H=fo(),ce=Bc(U);return T=YI(T),g.context===null?g.context=T:g.pendingContext=T,g=nu(H,ce),g.payload={element:f},k=k===void 0?null:k,k!==null&&(g.callback=k),f=oh(U,g,ce),f!==null&&(Wc(f,U,ce,H),u_(f,U,ce)),ce}function pv(f){if(f=f.current,!f.child)return null;switch(f.child.tag){case 5:return f.child.stateNode;default:return f.child.stateNode}}function Zb(f,g){if(f=f.memoizedState,f!==null&&f.dehydrated!==null){var T=f.retryLane;f.retryLane=T!==0&&T<g?T:g}}function eT(f,g){Zb(f,g),(f=f.alternate)&&Zb(f,g)}function A_(){return null}var Sl=typeof reportError=="function"?reportError:function(f){console.error(f)};function mv(f){this._internalRoot=f}gv.prototype.render=mv.prototype.render=function(f){var g=this._internalRoot;if(g===null)throw Error(i(409));I_(f,g,null,null)},gv.prototype.unmount=mv.prototype.unmount=function(){var f=this._internalRoot;if(f!==null){this._internalRoot=null;var g=f.containerInfo;cd(function(){I_(null,f,null,null)}),g[Dc]=null}};function gv(f){this._internalRoot=f}gv.prototype.unstable_scheduleHydration=function(f){if(f){var g=wf();f={blockedOn:null,target:f,priority:g};for(var T=0;T<Qo.length&&g!==0&&g<Qo[T].priority;T++);Qo.splice(T,0,f),T===0&&Rf(f)}};function tT(f){return!(!f||f.nodeType!==1&&f.nodeType!==9&&f.nodeType!==11)}function xm(f){return!(!f||f.nodeType!==1&&f.nodeType!==9&&f.nodeType!==11&&(f.nodeType!==8||f.nodeValue!==" react-mount-point-unstable "))}function nT(){}function vD(f,g,T,k,U){if(U){if(typeof k=="function"){var H=k;k=function(){var it=pv(ce);H.call(it)}}var ce=fv(g,k,f,0,null,!1,!1,"",nT);return f._reactRootContainer=ce,f[Dc]=ce.current,Nf(f.nodeType===8?f.parentNode:f),cd(),ce}for(;U=f.lastChild;)f.removeChild(U);if(typeof k=="function"){var Ae=k;k=function(){var it=pv(Ue);Ae.call(it)}}var Ue=Qb(f,0,!1,null,null,!1,!1,"",nT);return f._reactRootContainer=Ue,f[Dc]=Ue.current,Nf(f.nodeType===8?f.parentNode:f),cd(function(){I_(g,Ue,T,k)}),Ue}function Jf(f,g,T,k,U){var H=T._reactRootContainer;if(H){var ce=H;if(typeof U=="function"){var Ae=U;U=function(){var Ue=pv(ce);Ae.call(Ue)}}I_(g,ce,f,U)}else ce=vD(T,g,f,U,k);return pv(ce)}em=function(f){switch(f.tag){case 3:var g=f.stateNode;if(g.current.memoizedState.isDehydrated){var T=ql(g.pendingLanes);T!==0&&(oc(g,T|1),Do(g,Kr()),(kr&6)===0&&(km=Kr()+500,rh()))}break;case 13:cd(function(){var k=rd(f,1);if(k!==null){var U=fo();Wc(k,f,1,U)}}),eT(f,1)}},Jl=function(f){if(f.tag===13){var g=rd(f,134217728);if(g!==null){var T=fo();Wc(g,f,134217728,T)}eT(f,134217728)}},Jd=function(f){if(f.tag===13){var g=Bc(f),T=rd(f,g);if(T!==null){var k=fo();Wc(T,f,g,k)}eT(f,g)}},wf=function(){return ar},tm=function(f,g){var T=ar;try{return ar=f,g()}finally{ar=T}},Cc=function(f,g,T){switch(g){case"input":if(Wt(f,T),g=T.name,T.type==="radio"&&g!=null){for(T=f;T.parentNode;)T=T.parentNode;for(T=T.querySelectorAll("input[name="+JSON.stringify(""+g)+'][type="radio"]'),g=0;g<T.length;g++){var k=T[g];if(k!==f&&k.form===f.form){var U=mm(k);if(!U)throw Error(i(90));Mt(k),Wt(k,U)}}}break;case"textarea":Gt(f,T);break;case"select":g=T.value,g!=null&&at(f,!!T.multiple,g,!1)}},co=w_,Es=cd;var ph={usingClientEntryPoint:!1,Events:[pm,Lf,mm,wa,Ca,w_]},ud={findFiberByHostInstance:xf,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},SD={bundleType:ud.bundleType,version:ud.version,rendererPackageName:ud.rendererPackageName,rendererConfig:ud.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:ue.ReactCurrentDispatcher,findHostInstanceByFiber:function(f){return f=Hd(f),f===null?null:f.stateNode},findFiberByHostInstance:ud.findFiberByHostInstance||A_,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var _v=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!_v.isDisabled&&_v.supportsFiber)try{Kl=_v.inject(SD),Ao=_v}catch{}}return nl.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=ph,nl.createPortal=function(f,g){var T=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!tT(g))throw Error(i(200));return ED(f,g,null,T)},nl.createRoot=function(f,g){if(!tT(f))throw Error(i(299));var T=!1,k="",U=Sl;return g!=null&&(g.unstable_strictMode===!0&&(T=!0),g.identifierPrefix!==void 0&&(k=g.identifierPrefix),g.onRecoverableError!==void 0&&(U=g.onRecoverableError)),g=Qb(f,1,!1,null,null,T,!1,k,U),f[Dc]=g.current,Nf(f.nodeType===8?f.parentNode:f),new mv(g)},nl.findDOMNode=function(f){if(f==null)return null;if(f.nodeType===1)return f;var g=f._reactInternals;if(g===void 0)throw typeof f.render=="function"?Error(i(188)):(f=Object.keys(f).join(","),Error(i(268,f)));return f=Hd(g),f=f===null?null:f.stateNode,f},nl.flushSync=function(f){return cd(f)},nl.hydrate=function(f,g,T){if(!xm(g))throw Error(i(200));return Jf(null,f,g,!0,T)},nl.hydrateRoot=function(f,g,T){if(!tT(f))throw Error(i(405));var k=T!=null&&T.hydratedSources||null,U=!1,H="",ce=Sl;if(T!=null&&(T.unstable_strictMode===!0&&(U=!0),T.identifierPrefix!==void 0&&(H=T.identifierPrefix),T.onRecoverableError!==void 0&&(ce=T.onRecoverableError)),g=fv(g,null,f,1,T??null,U,!1,H,ce),f[Dc]=g.current,Nf(f),k)for(f=0;f<k.length;f++)T=k[f],U=T._getVersion,U=U(T._source),g.mutableSourceEagerHydrationData==null?g.mutableSourceEagerHydrationData=[T,U]:g.mutableSourceEagerHydrationData.push(T,U);return new gv(g)},nl.render=function(f,g,T){if(!xm(g))throw Error(i(200));return Jf(null,f,g,!1,T)},nl.unmountComponentAtNode=function(f){if(!xm(f))throw Error(i(40));return f._reactRootContainer?(cd(function(){Jf(null,null,f,!1,function(){f._reactRootContainer=null,f[Dc]=null})}),!0):!1},nl.unstable_batchedUpdates=w_,nl.unstable_renderSubtreeIntoContainer=function(f,g,T,k){if(!xm(T))throw Error(i(200));if(f==null||f._reactInternals===void 0)throw Error(i(38));return Jf(f,g,T,!1,k)},nl.version="18.3.1-next-f1338f8080-20240426",nl}var kK;function gZ(){if(kK)return pM.exports;kK=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(e){console.error(e)}}return n(),pM.exports=cEe(),pM.exports}var NK;function lEe(){if(NK)return pO;NK=1;var n=gZ();return pO.createRoot=n.createRoot,pO.hydrateRoot=n.hydrateRoot,pO}var uEe=lEe();const w1=Ug(uEe);function dEe(n,e,i,o){return n.addEventListener(e,i,o),()=>{n.removeEventListener(e,i,o)}}function C1(n){return n!=null&&typeof n=="object"&&"nodeType"in n&&n.nodeType===Node.ELEMENT_NODE}function hEe(){return!!(globalThis!=null&&globalThis.document)}function _Z(n){return n.parentElement&&_Z(n.parentElement)?!0:n.hidden}function fEe(n){const e=n.getAttribute("contenteditable");return e!=="false"&&e!=null}function pEe(n){return!!n.getAttribute("disabled")||!!n.getAttribute("aria-disabled")}function mEe(n){var e;return((e=yZ(n))==null?void 0:e.defaultView)??window}function yZ(n){return C1(n)?n.ownerDocument:document}function gEe(n){return n.view??window}function _Ee(n){return yZ(n).activeElement}function yEe(n){const e=gEe(n);return typeof e.PointerEvent<"u"&&n instanceof e.PointerEvent?n.pointerType==="mouse":n instanceof e.MouseEvent}function EZ(n){return!!n.touches}function EEe(n){return EZ(n)&&n.touches.length>1}function vEe(n,e="page"){const i=n.touches[0]||n.changedTouches[0];return{x:i[`${e}X`],y:i[`${e}Y`]}}function SEe(n,e="page"){return{x:n[`${e}X`],y:n[`${e}Y`]}}function vZ(n,e="page"){return EZ(n)?vEe(n,e):SEe(n,e)}function bEe(n){return e=>{const i=yEe(e);(!i||i&&e.button===0)&&n(e)}}function TEe(n,e=!1){function i(l){n(l,{point:vZ(l)})}return e?bEe(i):i}function qO(n,e,i,o){return dEe(n,e,TEe(i,e==="pointerdown"),o)}function wEe(n,...e){if(n==null)throw new TypeError("Cannot convert undefined or null to object");const i={...n};for(const o of e)if(o!=null)for(const l in o)Object.prototype.hasOwnProperty.call(o,l)&&(l in i&&delete i[l],i[l]=o[l]);return i}const Zn=n=>n?"":void 0,Np=n=>n?!0:void 0;function CEe(n){return Array.isArray(n)}function Du(n){const e=typeof n;return n!=null&&(e==="object"||e==="function")&&!CEe(n)}function REe(n){const e=n==null?0:n.length;return e?n[e-1]:void 0}function IEe(n){const e=parseFloat(n.toString()),i=n.toString().replace(String(e),"");return{unitless:!i,value:e,unit:i}}function WU(n){if(n==null)return n;const{unitless:e}=IEe(n);return e||typeof n=="number"?`${n}px`:n}const SZ=(n,e)=>parseInt(n[1],10)>parseInt(e[1],10)?1:-1,OF=n=>Object.fromEntries(Object.entries(n).sort(SZ));function DK(n){const e=OF(n);return Object.assign(Object.values(e),e)}function AEe(n){const e=Object.keys(OF(n));return new Set(e)}function xK(n){if(!n)return n;n=WU(n)??n;const e=-.02;return typeof n=="number"?`${n+e}`:n.replace(/(\d+\.?\d*)/u,i=>`${parseFloat(i)+e}`)}function Mw(n,e){const i=["@media screen"];return n&&i.push("and",`(min-width: ${WU(n)})`),e&&i.push("and",`(max-width: ${WU(e)})`),i.join(" ")}function PEe(n){if(!n)return null;n.base=n.base??"0px";const e=DK(n),i=Object.entries(n).sort(SZ).map(([d,p],_,E)=>{let[,b]=E[_+1]??[];return b=parseFloat(b)>0?xK(b):void 0,{_minW:xK(p),breakpoint:d,minW:p,maxW:b,maxWQuery:Mw(null,b),minWQuery:Mw(p),minMaxQuery:Mw(p,b)}}),o=AEe(n),l=Array.from(o.values());return{keys:o,normalized:e,isResponsive(d){const p=Object.keys(d);return p.length>0&&p.every(_=>o.has(_))},asObject:OF(n),asArray:DK(n),details:i,get(d){return i.find(p=>p.breakpoint===d)},media:[null,...e.map(d=>Mw(d)).slice(1)],toArrayValue(d){if(!Du(d))throw new Error("toArrayValue: value must be an object");const p=l.map(_=>d[_]??null);for(;REe(p)===null;)p.pop();return p},toObjectValue(d){if(!Array.isArray(d))throw new Error("toObjectValue: value must be an array");return d.reduce((p,_,E)=>{const b=l[E];return b!=null&&_!=null&&(p[b]=_),p},{})}}}function bZ(...n){return function(...i){n.forEach(o=>o==null?void 0:o(...i))}}function An(...n){return function(i){n.some(o=>(o==null||o(i),i==null?void 0:i.defaultPrevented))}}function kF(n){return D.Children.toArray(n).filter(e=>D.isValidElement(e))}function R1(n){const e=Object.assign({},n);for(let i in e)e[i]===void 0&&delete e[i];return e}function OEe(n,e){return`${n} returned \`undefined\`. Seems you forgot to wrap component within ${e}`}function Ni(n={}){const{name:e,strict:i=!0,hookName:o="useContext",providerName:l="Provider",errorMessage:d,defaultValue:p}=n,_=D.createContext(p);_.displayName=e;function E(){var C;const b=D.useContext(_);if(!b&&i){const I=new Error(d??OEe(o,l));throw I.name="ContextError",(C=Error.captureStackTrace)==null||C.call(Error,I,E),I}return b}return[_.Provider,E,_]}const hn=(...n)=>n.filter(Boolean).join(" "),TZ=n=>n.hasAttribute("tabindex"),kEe=n=>TZ(n)&&n.tabIndex===-1;function xk(n){if(!C1(n)||_Z(n)||pEe(n))return!1;const{localName:e}=n;if(["input","select","textarea","button"].indexOf(e)>=0)return!0;const o={a:()=>n.hasAttribute("href"),audio:()=>n.hasAttribute("controls"),video:()=>n.hasAttribute("controls")};return e in o?o[e]():fEe(n)?!0:TZ(n)}function NEe(n){return n?C1(n)&&xk(n)&&!kEe(n):!1}const DEe=["input:not(:disabled):not([disabled])","select:not(:disabled):not([disabled])","textarea:not(:disabled):not([disabled])","embed","iframe","object","a[href]","area[href]","button:not(:disabled):not([disabled])","[tabindex]","audio[controls]","video[controls]","*[tabindex]:not([aria-disabled])","*[contenteditable]"],xEe=DEe.join(),LEe=n=>n.offsetWidth>0&&n.offsetHeight>0;function wZ(n){const e=Array.from(n.querySelectorAll(xEe));return e.unshift(n),e.filter(i=>xk(i)&&LEe(i))}function MEe(n,e,i,o){const l=typeof e=="string"?e.split("."):[e];for(o=0;o<l.length&&n;o+=1)n=n[l[o]];return n===void 0?i:n}const UEe=n=>{const e=new WeakMap;return(o,l,d,p)=>{if(typeof o>"u")return n(o,l,d);e.has(o)||e.set(o,new Map);const _=e.get(o);if(_.has(l))return _.get(l);const E=n(o,l,d,p);return _.set(l,E),E}},CZ=UEe(MEe),VEe=n=>n.default||n;function NF(n){const{wasSelected:e,enabled:i,isSelected:o,mode:l="unmount"}=n;return!!(!i||o||l==="keepMounted"&&e)}function FEe(n){const e=parseFloat(n);return typeof e!="number"||Number.isNaN(e)?0:e}function DF(n,e){let i=FEe(n);const o=10**(e??10);return i=Math.round(i*o)/o,e?i.toFixed(e):i.toString()}function zU(n){if(!Number.isFinite(n))return 0;let e=1,i=0;for(;Math.round(n*e)/e!==n;)e*=10,i+=1;return i}function LK(n,e,i){return(n-e)*100/(i-e)}function jEe(n,e,i){return(i-e)*n+e}function MK(n,e,i){const o=Math.round((n-e)/i)*i+e,l=zU(i);return DF(o,l)}function YO(n,e,i){return n==null?n:(i<e&&console.warn("clamp: max cannot be less than min"),Math.min(Math.max(n,e),i))}function V0(n,e=[]){const i=Object.assign({},n);for(const o of e)o in i&&delete i[o];return i}function RZ(n,e){const i={};for(const o of e)o in n&&(i[o]=n[o]);return i}function I1(n,e){return Array.isArray(n)?n.map(i=>i===null?null:e(i)):Du(n)?Object.keys(n).reduce((i,o)=>(i[o]=e(n[o]),i),{}):n!=null?e(n):null}const BEe=n=>typeof n=="function";function cl(n,...e){return BEe(n)?n(...e):n}function WEe(n){const e=n.ownerDocument.defaultView||window,{overflow:i,overflowX:o,overflowY:l}=e.getComputedStyle(n);return/auto|scroll|overlay|hidden/.test(i+l+o)}function zEe(n){return n.localName==="html"?n:n.assignedSlot||n.parentElement||n.ownerDocument.documentElement}function IZ(n){return["html","body","#document"].includes(n.localName)?n.ownerDocument.body:C1(n)&&WEe(n)?n:IZ(zEe(n))}function GEe(n,e){const i={},o={};for(const[l,d]of Object.entries(n))e.includes(l)?i[l]=d:o[l]=d;return[i,o]}function HEe(n,...e){const i=Object.getOwnPropertyDescriptors(n),o=Object.keys(i),l=p=>{const _={};for(let E=0;E<p.length;E++){const b=p[E];i[b]&&(Object.defineProperty(_,b,i[b]),delete i[b])}return _},d=p=>l(Array.isArray(p)?p:o.filter(p));return e.map(d).concat(l(o))}function UK(n,e,i={}){const{stop:o,getKey:l}=i;function d(p,_=[]){if(Du(p)||Array.isArray(p)){const E={};for(const[b,C]of Object.entries(p)){const I=(l==null?void 0:l(b))??b,O=[..._,I];if(o!=null&&o(p,O))return e(p,_);E[I]=d(C,O)}return E}return e(p,_)}return d(n)}var Uw={exports:{}};Uw.exports;var VK;function $Ee(){return VK||(VK=1,function(n,e){var i=200,o="__lodash_hash_undefined__",l=800,d=16,p=9007199254740991,_="[object Arguments]",E="[object Array]",b="[object AsyncFunction]",C="[object Boolean]",I="[object Date]",O="[object Error]",L="[object Function]",V="[object GeneratorFunction]",B="[object Map]",W="[object Number]",Z="[object Null]",$="[object Object]",se="[object Proxy]",ue="[object RegExp]",re="[object Set]",pe="[object String]",q="[object Undefined]",Q="[object WeakMap]",J="[object ArrayBuffer]",ie="[object DataView]",me="[object Float32Array]",de="[object Float64Array]",le="[object Int8Array]",xe="[object Int16Array]",We="[object Int32Array]",$e="[object Uint8Array]",ve="[object Uint8ClampedArray]",_e="[object Uint16Array]",Ee="[object Uint32Array]",ke=/[\\^$.*+?()[\]{}|]/g,we=/^\[object .+?Constructor\]$/,be=/^(?:0|[1-9]\d*)$/,Ie={};Ie[me]=Ie[de]=Ie[le]=Ie[xe]=Ie[We]=Ie[$e]=Ie[ve]=Ie[_e]=Ie[Ee]=!0,Ie[_]=Ie[E]=Ie[J]=Ie[C]=Ie[ie]=Ie[I]=Ie[O]=Ie[L]=Ie[B]=Ie[W]=Ie[$]=Ie[ue]=Ie[re]=Ie[pe]=Ie[Q]=!1;var Me=typeof Sy=="object"&&Sy&&Sy.Object===Object&&Sy,ze=typeof self=="object"&&self&&self.Object===Object&&self,Je=Me||ze||Function("return this")(),tt=e&&!e.nodeType&&e,ut=tt&&!0&&n&&!n.nodeType&&n,Ze=ut&&ut.exports===tt,bt=Ze&&Me.process,on=function(){try{var Ce=ut&&ut.require&&ut.require("util").types;return Ce||bt&&bt.binding&&bt.binding("util")}catch{}}(),Mt=on&&on.isTypedArray;function Zt(Ce,De,rt){switch(rt.length){case 0:return Ce.call(De);case 1:return Ce.call(De,rt[0]);case 2:return Ce.call(De,rt[0],rt[1]);case 3:return Ce.call(De,rt[0],rt[1],rt[2])}return Ce.apply(De,rt)}function an(Ce,De){for(var rt=-1,Qt=Array(Ce);++rt<Ce;)Qt[rt]=De(rt);return Qt}function Ht(Ce){return function(De){return Ce(De)}}function jn(Ce,De){return Ce==null?void 0:Ce[De]}function Wt(Ce,De){return function(rt){return Ce(De(rt))}}var Re=Array.prototype,Fe=Function.prototype,Ge=Object.prototype,at=Je["__core-js_shared__"],yt=Fe.toString,vt=Ge.hasOwnProperty,Gt=function(){var Ce=/[^.]+$/.exec(at&&at.keys&&at.keys.IE_PROTO||"");return Ce?"Symbol(src)_1."+Ce:""}(),gn=Ge.toString,Pn=yt.call(Object),un=RegExp("^"+yt.call(vt).replace(ke,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),wt=Ze?Je.Buffer:void 0,lr=Je.Symbol,Dt=Je.Uint8Array;wt&&wt.allocUnsafe;var qt=Wt(Object.getPrototypeOf,Object),Qr=Object.create,Hi=Ge.propertyIsEnumerable,Vs=Re.splice,ai=lr?lr.toStringTag:void 0,Ot=function(){try{var Ce=sc(Object,"defineProperty");return Ce({},"",{}),Ce}catch{}}(),On=wt?wt.isBuffer:void 0,or=Math.max,Fi=Date.now,Cc=sc(Je,"Map"),us=sc(Object,"create"),Ta=function(){function Ce(){}return function(De){if(!Pc(De))return{};if(Qr)return Qr(De);Ce.prototype=De;var rt=new Ce;return Ce.prototype=void 0,rt}}();function Io(Ce){var De=-1,rt=Ce==null?0:Ce.length;for(this.clear();++De<rt;){var Qt=Ce[De];this.set(Qt[0],Qt[1])}}function wa(){this.__data__=us?us(null):{},this.size=0}function Ca(Ce){var De=this.has(Ce)&&delete this.__data__[Ce];return this.size-=De?1:0,De}function co(Ce){var De=this.__data__;if(us){var rt=De[Ce];return rt===o?void 0:rt}return vt.call(De,Ce)?De[Ce]:void 0}function Es(Ce){var De=this.__data__;return us?De[Ce]!==void 0:vt.call(De,Ce)}function ds(Ce,De){var rt=this.__data__;return this.size+=this.has(Ce)?0:1,rt[Ce]=us&&De===void 0?o:De,this}Io.prototype.clear=wa,Io.prototype.delete=Ca,Io.prototype.get=co,Io.prototype.has=Es,Io.prototype.set=ds;function Ho(Ce){var De=-1,rt=Ce==null?0:Ce.length;for(this.clear();++De<rt;){var Qt=Ce[De];this.set(Qt[0],Qt[1])}}function $i(){this.__data__=[],this.size=0}function vs(Ce){var De=this.__data__,rt=Kd(De,Ce);if(rt<0)return!1;var Qt=De.length-1;return rt==Qt?De.pop():Vs.call(De,rt,1),--this.size,!0}function rc(Ce){var De=this.__data__,rt=Kd(De,Ce);return rt<0?void 0:De[rt][1]}function ju(Ce){return Kd(this.__data__,Ce)>-1}function Rc(Ce,De){var rt=this.__data__,Qt=Kd(rt,Ce);return Qt<0?(++this.size,rt.push([Ce,De])):rt[Qt][1]=De,this}Ho.prototype.clear=$i,Ho.prototype.delete=vs,Ho.prototype.get=rc,Ho.prototype.has=ju,Ho.prototype.set=Rc;function Ra(Ce){var De=-1,rt=Ce==null?0:Ce.length;for(this.clear();++De<rt;){var Qt=Ce[De];this.set(Qt[0],Qt[1])}}function Ia(){this.size=0,this.__data__={hash:new Io,map:new(Cc||Ho),string:new Io}}function zd(Ce){var De=Gu(this,Ce).delete(Ce);return this.size-=De?1:0,De}function Gg(Ce){return Gu(this,Ce).get(Ce)}function Bu(Ce){return Gu(this,Ce).has(Ce)}function Sf(Ce,De){var rt=Gu(this,Ce),Qt=rt.size;return rt.set(Ce,De),this.size+=rt.size==Qt?0:1,this}Ra.prototype.clear=Ia,Ra.prototype.delete=zd,Ra.prototype.get=Gg,Ra.prototype.has=Bu,Ra.prototype.set=Sf;function Xs(Ce){var De=this.__data__=new Ho(Ce);this.size=De.size}function Wu(){this.__data__=new Ho,this.size=0}function Aa(Ce){var De=this.__data__,rt=De.delete(Ce);return this.size=De.size,rt}function Gd(Ce){return this.__data__.get(Ce)}function Hd(Ce){return this.__data__.has(Ce)}function ic(Ce,De){var rt=this.__data__;if(rt instanceof Ho){var Qt=rt.__data__;if(!Cc||Qt.length<i-1)return Qt.push([Ce,De]),this.size=++rt.size,this;rt=this.__data__=new Ra(Qt)}return rt.set(Ce,De),this.size=rt.size,this}Xs.prototype.clear=Wu,Xs.prototype.delete=Aa,Xs.prototype.get=Gd,Xs.prototype.has=Hd,Xs.prototype.set=ic;function $d(Ce,De){var rt=Yo(Ce),Qt=!rt&&hs(Ce),Jn=!rt&&!Qt&&Jo(Ce),Tr=!rt&&!Qt&&!Jn&&Rf(Ce),qr=rt||Qt||Jn||Tr,fn=qr?an(Ce.length,String):[],jr=fn.length;for(var Ri in Ce)qr&&(Ri=="length"||Jn&&(Ri=="offset"||Ri=="parent")||Tr&&(Ri=="buffer"||Ri=="byteLength"||Ri=="byteOffset")||ml(Ri,jr))||fn.push(Ri);return fn}function zu(Ce,De,rt){(rt!==void 0&&!qo(Ce[De],rt)||rt===void 0&&!(De in Ce))&&Kr(Ce,De,rt)}function $o(Ce,De,rt){var Qt=Ce[De];(!(vt.call(Ce,De)&&qo(Qt,rt))||rt===void 0&&!(De in Ce))&&Kr(Ce,De,rt)}function Kd(Ce,De){for(var rt=Ce.length;rt--;)if(qo(Ce[rt][0],De))return rt;return-1}function Kr(Ce,De,rt){De=="__proto__"&&Ot?Ot(Ce,De,{configurable:!0,enumerable:!0,value:rt,writable:!0}):Ce[De]=rt}var Ci=Yl();function Ic(Ce){return Ce==null?Ce===void 0?q:Z:ai&&ai in Object(Ce)?Ko(Ce):em(Ce)}function fl(Ce){return Ss(Ce)&&Ic(Ce)==_}function Pa(Ce){if(!Pc(Ce)||oc(Ce))return!1;var De=Qo(Ce)?un:we;return De.test(Cf(Ce))}function bf(Ce){return Ss(Ce)&&nm(Ce.length)&&!!Ie[Ic(Ce)]}function qd(Ce){if(!Pc(Ce))return Ac(Ce);var De=ar(Ce),rt=[];for(var Qt in Ce)Qt=="constructor"&&(De||!vt.call(Ce,Qt))||rt.push(Qt);return rt}function Kl(Ce,De,rt,Qt,Jn){Ce!==De&&Ci(De,function(Tr,qr){if(Jn||(Jn=new Xs),Pc(Tr))Ao(Ce,De,qr,rt,Kl,Qt,Jn);else{var fn=Qt?Qt(Jd(Ce,qr),Tr,qr+"",Ce,De,Jn):void 0;fn===void 0&&(fn=Tr),zu(Ce,qr,fn)}},Zl)}function Ao(Ce,De,rt,Qt,Jn,Tr,qr){var fn=Jd(Ce,rt),jr=Jd(De,rt),Ri=qr.get(jr);if(Ri){zu(Ce,rt,Ri);return}var Fs=Tr?Tr(fn,jr,rt+"",Ce,De,qr):void 0,Zo=Fs===void 0;if(Zo){var ea=Yo(jr),Ku=!ea&&Jo(jr),is=!ea&&!Ku&&Rf(jr);Fs=jr,ea||Ku||is?Yo(fn)?Fs=fn:Ql(fn)?Fs=Xd(fn):Ku?(Zo=!1,Fs=Tf(jr)):is?(Zo=!1,Fs=Yd(jr)):Fs=[]:$u(jr)||hs(jr)?(Fs=fn,hs(fn)?Fs=gl(fn):(!Pc(fn)||Qo(fn))&&(Fs=Hu(jr))):Zo=!1}Zo&&(qr.set(jr,Fs),Jn(Fs,jr,Qt,Tr,qr),qr.delete(jr)),zu(Ce,rt,Fs)}function Zp(Ce,De){return wf(Jl(Ce,De,ka),Ce+"")}var lo=Ot?function(Ce,De){return Ot(Ce,"toString",{configurable:!0,enumerable:!1,value:Oa(De),writable:!0})}:ka;function Tf(Ce,De){return Ce.slice()}function pl(Ce){var De=new Ce.constructor(Ce.byteLength);return new Dt(De).set(new Dt(Ce)),De}function Yd(Ce,De){var rt=pl(Ce.buffer);return new Ce.constructor(rt,Ce.byteOffset,Ce.length)}function Xd(Ce,De){var rt=-1,Qt=Ce.length;for(De||(De=Array(Qt));++rt<Qt;)De[rt]=Ce[rt];return De}function _r(Ce,De,rt,Qt){var Jn=!rt;rt||(rt={});for(var Tr=-1,qr=De.length;++Tr<qr;){var fn=De[Tr],jr=void 0;jr===void 0&&(jr=Ce[fn]),Jn?Kr(rt,fn,jr):$o(rt,fn,jr)}return rt}function ql(Ce){return Zp(function(De,rt){var Qt=-1,Jn=rt.length,Tr=Jn>1?rt[Jn-1]:void 0,qr=Jn>2?rt[2]:void 0;for(Tr=Ce.length>3&&typeof Tr=="function"?(Jn--,Tr):void 0,qr&&Xl(rt[0],rt[1],qr)&&(Tr=Jn<3?void 0:Tr,Jn=1),De=Object(De);++Qt<Jn;){var fn=rt[Qt];fn&&Ce(De,fn,Qt,Tr)}return De})}function Yl(Ce){return function(De,rt,Qt){for(var Jn=-1,Tr=Object(De),qr=Qt(De),fn=qr.length;fn--;){var jr=qr[++Jn];if(rt(Tr[jr],jr,Tr)===!1)break}return De}}function Gu(Ce,De){var rt=Ce.__data__;return Zr(De)?rt[typeof De=="string"?"string":"hash"]:rt.map}function sc(Ce,De){var rt=jn(Ce,De);return Pa(rt)?rt:void 0}function Ko(Ce){var De=vt.call(Ce,ai),rt=Ce[ai];try{Ce[ai]=void 0;var Qt=!0}catch{}var Jn=gn.call(Ce);return Qt&&(De?Ce[ai]=rt:delete Ce[ai]),Jn}function Hu(Ce){return typeof Ce.constructor=="function"&&!ar(Ce)?Ta(qt(Ce)):{}}function ml(Ce,De){var rt=typeof Ce;return De=De??p,!!De&&(rt=="number"||rt!="symbol"&&be.test(Ce))&&Ce>-1&&Ce%1==0&&Ce<De}function Xl(Ce,De,rt){if(!Pc(rt))return!1;var Qt=typeof De;return(Qt=="number"?Xo(rt)&&ml(De,rt.length):Qt=="string"&&De in rt)?qo(rt[De],Ce):!1}function Zr(Ce){var De=typeof Ce;return De=="string"||De=="number"||De=="symbol"||De=="boolean"?Ce!=="__proto__":Ce===null}function oc(Ce){return!!Gt&&Gt in Ce}function ar(Ce){var De=Ce&&Ce.constructor,rt=typeof De=="function"&&De.prototype||Ge;return Ce===rt}function Ac(Ce){var De=[];if(Ce!=null)for(var rt in Object(Ce))De.push(rt);return De}function em(Ce){return gn.call(Ce)}function Jl(Ce,De,rt){return De=or(De===void 0?Ce.length-1:De,0),function(){for(var Qt=arguments,Jn=-1,Tr=or(Qt.length-De,0),qr=Array(Tr);++Jn<Tr;)qr[Jn]=Qt[De+Jn];Jn=-1;for(var fn=Array(De+1);++Jn<De;)fn[Jn]=Qt[Jn];return fn[De]=rt(qr),Zt(Ce,this,fn)}}function Jd(Ce,De){if(!(De==="constructor"&&typeof Ce[De]=="function")&&De!="__proto__")return Ce[De]}var wf=tm(lo);function tm(Ce){var De=0,rt=0;return function(){var Qt=Fi(),Jn=d-(Qt-rt);if(rt=Qt,Jn>0){if(++De>=l)return arguments[0]}else De=0;return Ce.apply(void 0,arguments)}}function Cf(Ce){if(Ce!=null){try{return yt.call(Ce)}catch{}try{return Ce+""}catch{}}return""}function qo(Ce,De){return Ce===De||Ce!==Ce&&De!==De}var hs=fl(function(){return arguments}())?fl:function(Ce){return Ss(Ce)&&vt.call(Ce,"callee")&&!Hi.call(Ce,"callee")},Yo=Array.isArray;function Xo(Ce){return Ce!=null&&nm(Ce.length)&&!Qo(Ce)}function Ql(Ce){return Ss(Ce)&&Xo(Ce)}var Jo=On||_l;function Qo(Ce){if(!Pc(Ce))return!1;var De=Ic(Ce);return De==L||De==V||De==b||De==se}function nm(Ce){return typeof Ce=="number"&&Ce>-1&&Ce%1==0&&Ce<=p}function Pc(Ce){var De=typeof Ce;return Ce!=null&&(De=="object"||De=="function")}function Ss(Ce){return Ce!=null&&typeof Ce=="object"}function $u(Ce){if(!Ss(Ce)||Ic(Ce)!=$)return!1;var De=qt(Ce);if(De===null)return!0;var rt=vt.call(De,"constructor")&&De.constructor;return typeof rt=="function"&&rt instanceof rt&&yt.call(rt)==Pn}var Rf=Mt?Ht(Mt):bf;function gl(Ce){return _r(Ce,Zl(Ce))}function Zl(Ce){return Xo(Ce)?$d(Ce):qd(Ce)}var rm=ql(function(Ce,De,rt,Qt){Kl(Ce,De,rt,Qt)});function Oa(Ce){return function(){return Ce}}function ka(Ce){return Ce}function _l(){return!1}n.exports=rm}(Uw,Uw.exports)),Uw.exports}var KEe=$Ee();const qh=Ug(KEe);function Ks(n,e=[]){const i=D.useRef(n);return D.useEffect(()=>{i.current=n}),D.useCallback((...o)=>{var l;return(l=i.current)==null?void 0:l.call(i,...o)},e)}function Ry(n,e,i,o){const l=Ks(i);return D.useEffect(()=>{const d=typeof n=="function"?n():n??document;if(!(!i||!d))return d.addEventListener(e,l,o),()=>{d.removeEventListener(e,l,o)}},[e,n,o,l,i]),()=>{const d=typeof n=="function"?n():n??document;d==null||d.removeEventListener(e,l,o)}}function AZ(n){const{isOpen:e,ref:i}=n,[o,l]=D.useState(e),[d,p]=D.useState(!1);return D.useEffect(()=>{d||(l(e),p(!0))},[e,d,o]),Ry(()=>i.current,"animationend",()=>{l(e)}),{present:!(e?!1:!o),onComplete(){var C;const E=mEe(i.current),b=new E.CustomEvent("animationend",{bubbles:!0});(C=i.current)==null||C.dispatchEvent(b)}}}var _M,FK;function qEe(){return FK||(FK=1,_M=function(){var n=document.getSelection();if(!n.rangeCount)return function(){};for(var e=document.activeElement,i=[],o=0;o<n.rangeCount;o++)i.push(n.getRangeAt(o));switch(e.tagName.toUpperCase()){case"INPUT":case"TEXTAREA":e.blur();break;default:e=null;break}return n.removeAllRanges(),function(){n.type==="Caret"&&n.removeAllRanges(),n.rangeCount||i.forEach(function(l){n.addRange(l)}),e&&e.focus()}}),_M}var yM,jK;function YEe(){if(jK)return yM;jK=1;var n=qEe(),e={"text/plain":"Text","text/html":"Url",default:"Text"},i="Copy to clipboard: #{key}, Enter";function o(d){var p=(/mac os x/i.test(navigator.userAgent)?"":"Ctrl")+"+C";return d.replace(/#{\s*key\s*}/g,p)}function l(d,p){var _,E,b,C,I,O,L=!1;p||(p={}),_=p.debug||!1;try{b=n(),C=document.createRange(),I=document.getSelection(),O=document.createElement("span"),O.textContent=d,O.ariaHidden="true",O.style.all="unset",O.style.position="fixed",O.style.top=0,O.style.clip="rect(0, 0, 0, 0)",O.style.whiteSpace="pre",O.style.webkitUserSelect="text",O.style.MozUserSelect="text",O.style.msUserSelect="text",O.style.userSelect="text",O.addEventListener("copy",function(B){if(B.stopPropagation(),p.format)if(B.preventDefault(),typeof B.clipboardData>"u"){_&&console.warn("unable to use e.clipboardData"),_&&console.warn("trying IE specific stuff"),window.clipboardData.clearData();var W=e[p.format]||e.default;window.clipboardData.setData(W,d)}else B.clipboardData.clearData(),B.clipboardData.setData(p.format,d);p.onCopy&&(B.preventDefault(),p.onCopy(B.clipboardData))}),document.body.appendChild(O),C.selectNodeContents(O),I.addRange(C);var V=document.execCommand("copy");if(!V)throw new Error("copy command was unsuccessful");L=!0}catch(B){_&&console.error("unable to copy using execCommand: ",B),_&&console.warn("trying IE specific stuff");try{window.clipboardData.setData(p.format||"text",d),p.onCopy&&p.onCopy(window.clipboardData),L=!0}catch(W){_&&console.error("unable to copy using clipboardData: ",W),_&&console.error("falling back to prompt"),E=o("message"in p?p.message:i),window.prompt(E,d)}}finally{I&&(typeof I.removeRange=="function"?I.removeRange(C):I.removeAllRanges()),O&&document.body.removeChild(O),b()}return L}return yM=l,yM}var XEe=YEe();const BK=Ug(XEe);function WK(n,e={}){const[i,o]=D.useState(!1),[l,d]=D.useState(n);D.useEffect(()=>d(n),[n]);const{timeout:p=1500,..._}=typeof e=="number"?{timeout:e}:e,E=D.useCallback(b=>{const C=typeof b=="string"?b:l;"clipboard"in navigator?navigator.clipboard.writeText(C).then(()=>o(!0)).catch(()=>o(BK(C,_))):o(BK(C,_))},[l,_]);return D.useEffect(()=>{let b=null;return i&&(b=window.setTimeout(()=>{o(!1)},p)),()=>{b&&window.clearTimeout(b)}},[p,i]),{value:l,setValue:d,onCopy:E,hasCopied:i}}function PZ(n){const{value:e,defaultValue:i,onChange:o,shouldUpdate:l=(O,L)=>O!==L}=n,d=Ks(o),p=Ks(l),[_,E]=D.useState(i),b=e!==void 0,C=b?e:_,I=Ks(O=>{const V=typeof O=="function"?O(C):O;p(C,V)&&(b||E(V),d(V))},[b,d,C,p]);return[C,I]}function JEe(n={}){const{onChange:e,precision:i,defaultValue:o,value:l,step:d=1,min:p=Number.MIN_SAFE_INTEGER,max:_=Number.MAX_SAFE_INTEGER,keepWithinRange:E=!0}=n,b=Ks(e),[C,I]=D.useState(()=>o==null?"":EM(o,d,i)??""),O=typeof l<"u",L=O?l:C,V=OZ(ug(L),d),B=i??V,W=D.useCallback(ie=>{ie!==L&&(O||I(ie.toString()),b==null||b(ie.toString(),ug(ie)))},[b,O,L]),Z=D.useCallback(ie=>{let me=ie;return E&&(me=YO(me,p,_)),DF(me,B)},[B,E,_,p]),$=D.useCallback((ie=d)=>{let me;L===""?me=ug(ie):me=ug(L)+ie,me=Z(me),W(me)},[Z,d,W,L]),se=D.useCallback((ie=d)=>{let me;L===""?me=ug(-ie):me=ug(L)-ie,me=Z(me),W(me)},[Z,d,W,L]),ue=D.useCallback(()=>{let ie;o==null?ie="":ie=EM(o,d,i)??p,W(ie)},[o,i,d,W,p]),re=D.useCallback(ie=>{const me=EM(ie,d,B)??p;W(me)},[B,d,W,p]),pe=ug(L);return{isOutOfRange:pe>_||pe<p,isAtMax:pe===_,isAtMin:pe===p,precision:B,value:L,valueAsNumber:pe,update:W,reset:ue,increment:$,decrement:se,clamp:Z,cast:re,setValue:I}}function ug(n){return parseFloat(n.toString().replace(/[^\w.-]+/g,""))}function OZ(n,e){return Math.max(zU(e),zU(n))}function EM(n,e,i){const o=ug(n);if(Number.isNaN(o))return;const l=OZ(o,e);return DF(o,i??l)}function hf(n={}){const{onClose:e,onOpen:i,isOpen:o,id:l}=n,d=Ks(i),p=Ks(e),[_,E]=D.useState(n.defaultIsOpen||!1),b=o!==void 0?o:_,C=o!==void 0,I=D.useId(),O=l??`disclosure-${I}`,L=D.useCallback(()=>{C||E(!1),p==null||p()},[C,p]),V=D.useCallback(()=>{C||E(!0),d==null||d()},[C,d]),B=D.useCallback(()=>{b?L():V()},[b,V,L]);function W($={}){return{...$,"aria-expanded":b,"aria-controls":O,onClick(se){var ue;(ue=$.onClick)==null||ue.call($,se),B()}}}function Z($={}){return{...$,hidden:!b,id:O}}return{isOpen:b,onOpen:V,onClose:L,onToggle:B,isControlled:C,getButtonProps:W,getDisclosureProps:Z}}const Qh=globalThis!=null&&globalThis.document?D.useLayoutEffect:D.useEffect,Fp=(n,e)=>{const i=D.useRef(!1),o=D.useRef(!1);D.useEffect(()=>{if(i.current&&o.current)return n();o.current=!0},e),D.useEffect(()=>(i.current=!0,()=>{i.current=!1}),[])};function QEe(n){const e=n.current;if(!e)return!1;const i=_Ee(e);return!i||e.contains(i)?!1:!!NEe(i)}function kZ(n,e){const{shouldFocus:i,visible:o,focusRef:l}=e,d=i&&!o;Fp(()=>{if(!d||QEe(n))return;const p=(l==null?void 0:l.current)||n.current;let _;if(p)return _=requestAnimationFrame(()=>{p.focus({preventScroll:!0})}),()=>{cancelAnimationFrame(_)}},[d,n,l])}const ZEe={preventScroll:!0,shouldFocus:!1};function eve(n,e=ZEe){const{focusRef:i,preventScroll:o,shouldFocus:l,visible:d}=e,p=tve(n)?n.current:n,_=l&&d,E=D.useRef(_),b=D.useRef(d);Qh(()=>{!b.current&&d&&(E.current=_),b.current=d},[d,_]);const C=D.useCallback(()=>{if(!(!d||!p||!E.current)&&(E.current=!1,!p.contains(document.activeElement)))if(i!=null&&i.current)requestAnimationFrame(()=>{var I;(I=i.current)==null||I.focus({preventScroll:o})});else{const I=wZ(p);I.length>0&&requestAnimationFrame(()=>{I[0].focus({preventScroll:o})})}},[d,o,p,i]);Fp(()=>{C()},[C]),Ry(p,"transitionend",C)}function tve(n){return"current"in n}function nve(n){return"current"in n}const NZ=()=>typeof window<"u";function rve(){const n=navigator.userAgentData;return(n==null?void 0:n.platform)??navigator.platform}const ive=n=>NZ()&&n.test(navigator.vendor),sve=n=>NZ()&&n.test(rve()),ove=()=>sve(/mac|iphone|ipad|ipod/i),ave=()=>ove()&&ive(/apple/i);function cve(n){const{ref:e,elements:i,enabled:o}=n,l=()=>{var d;return((d=e.current)==null?void 0:d.ownerDocument)??document};Ry(l,"pointerdown",d=>{var b,C;if(!ave()||!o)return;const p=((C=(b=d.composedPath)==null?void 0:b.call(d))==null?void 0:C[0])??d.target,E=(i??[e]).some(I=>{const O=nve(I)?I.current:I;return(O==null?void 0:O.contains(p))||O===p});l().activeElement!==p&&E&&(d.preventDefault(),p.focus())})}function lve(n,e){const i=D.useId();return D.useMemo(()=>n||[e,i].filter(Boolean).join("-"),[n,e,i])}function uve(n,...e){const i=lve(n);return D.useMemo(()=>e.map(o=>`${o}-${i}`),[i,e])}function dve(n,e){const i=Ks(n);D.useEffect(()=>{let o=null;const l=()=>i();return e!==null&&(o=window.setInterval(l,e)),()=>{o&&window.clearInterval(o)}},[e,i])}function DZ(n){const e=D.useRef(null);return e.current=n,e}function hve(n,e){if(n!=null){if(typeof n=="function"){n(e);return}try{n.current=e}catch{throw new Error(`Cannot assign value '${e}' to ref '${n}'`)}}}function Ui(...n){return e=>{n.forEach(i=>{hve(i,e)})}}function fve(...n){return D.useMemo(()=>Ui(...n),n)}function xZ(n){const{ref:e,handler:i,enabled:o=!0}=n,l=Ks(i),p=D.useRef({isPointerDown:!1,ignoreEmulatedMouseEvents:!1}).current;D.useEffect(()=>{if(!o)return;const _=I=>{vM(I,e)&&(p.isPointerDown=!0)},E=I=>{if(p.ignoreEmulatedMouseEvents){p.ignoreEmulatedMouseEvents=!1;return}p.isPointerDown&&i&&vM(I,e)&&(p.isPointerDown=!1,l(I))},b=I=>{p.ignoreEmulatedMouseEvents=!0,i&&p.isPointerDown&&vM(I,e)&&(p.isPointerDown=!1,l(I))},C=LZ(e.current);return C.addEventListener("mousedown",_,!0),C.addEventListener("mouseup",E,!0),C.addEventListener("touchstart",_,!0),C.addEventListener("touchend",b,!0),()=>{C.removeEventListener("mousedown",_,!0),C.removeEventListener("mouseup",E,!0),C.removeEventListener("touchstart",_,!0),C.removeEventListener("touchend",b,!0)}},[i,e,l,p,o])}function vM(n,e){var o,l;const i=((o=n.composedPath)==null?void 0:o.call(n)[0])??n.target;return i&&!LZ(i).contains(i)?!1:!((l=e.current)!=null&&l.contains(i))}function LZ(n){return(n==null?void 0:n.ownerDocument)??document}function pve(n,e){const i=Ks(n);D.useEffect(()=>{if(e==null)return;let o=null;return o=window.setTimeout(()=>{i()},e),()=>{o&&window.clearTimeout(o)}},[e,i])}const MZ=1/60*1e3,mve=typeof performance<"u"?()=>performance.now():()=>Date.now(),UZ=typeof window<"u"?n=>window.requestAnimationFrame(n):n=>setTimeout(()=>n(mve()),MZ);function gve(n){let e=[],i=[],o=0,l=!1,d=!1;const p=new WeakSet,_={schedule:(E,b=!1,C=!1)=>{const I=C&&l,O=I?e:i;return b&&p.add(E),O.indexOf(E)===-1&&(O.push(E),I&&l&&(o=e.length)),E},cancel:E=>{const b=i.indexOf(E);b!==-1&&i.splice(b,1),p.delete(E)},process:E=>{if(l){d=!0;return}if(l=!0,[e,i]=[i,e],i.length=0,o=e.length,o)for(let b=0;b<o;b++){const C=e[b];C(E),p.has(C)&&(_.schedule(C),n())}l=!1,d&&(d=!1,_.process(E))}};return _}const _ve=40;let GU=!0,vC=!1,HU=!1;const XS={delta:0,timestamp:0},JC=["read","update","preRender","render","postRender"],A1=JC.reduce((n,e)=>(n[e]=gve(()=>vC=!0),n),{}),yve=JC.reduce((n,e)=>{const i=A1[e];return n[e]=(o,l=!1,d=!1)=>(vC||Sve(),i.schedule(o,l,d)),n},{}),Eve=JC.reduce((n,e)=>(n[e]=A1[e].cancel,n),{});JC.reduce((n,e)=>(n[e]=()=>A1[e].process(XS),n),{});const vve=n=>A1[n].process(XS),VZ=n=>{vC=!1,XS.delta=GU?MZ:Math.max(Math.min(n-XS.timestamp,_ve),1),XS.timestamp=n,HU=!0,JC.forEach(vve),HU=!1,vC&&(GU=!1,UZ(VZ))},Sve=()=>{vC=!0,GU=!0,HU||UZ(VZ)},zK=()=>XS;var bve=Object.defineProperty,Tve=(n,e,i)=>e in n?bve(n,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):n[e]=i,Id=(n,e,i)=>(Tve(n,typeof e!="symbol"?e+"":e,i),i);class wve{constructor(e,i,o){if(Id(this,"history",[]),Id(this,"startEvent",null),Id(this,"lastEvent",null),Id(this,"lastEventInfo",null),Id(this,"handlers",{}),Id(this,"removeListeners",()=>{}),Id(this,"threshold",3),Id(this,"win"),Id(this,"updatePoint",()=>{if(!(this.lastEvent&&this.lastEventInfo))return;const _=SM(this.lastEventInfo,this.history),E=this.startEvent!==null,b=Ave(_.offset,{x:0,y:0})>=this.threshold;if(!E&&!b)return;const{timestamp:C}=zK();this.history.push({..._.point,timestamp:C});const{onStart:I,onMove:O}=this.handlers;E||(I==null||I(this.lastEvent,_),this.startEvent=this.lastEvent),O==null||O(this.lastEvent,_)}),Id(this,"onPointerMove",(_,E)=>{this.lastEvent=_,this.lastEventInfo=E,yve.update(this.updatePoint,!0)}),Id(this,"onPointerUp",(_,E)=>{const b=SM(E,this.history),{onEnd:C,onSessionEnd:I}=this.handlers;I==null||I(_,b),this.end(),!(!C||!this.startEvent)&&(C==null||C(_,b))}),this.win=e.view??window,EEe(e))return;this.handlers=i,o&&(this.threshold=o),e.stopPropagation(),e.preventDefault();const l={point:vZ(e)},{timestamp:d}=zK();this.history=[{...l.point,timestamp:d}];const{onSessionStart:p}=i;p==null||p(e,SM(l,this.history)),this.removeListeners=Ive(qO(this.win,"pointermove",this.onPointerMove),qO(this.win,"pointerup",this.onPointerUp),qO(this.win,"pointercancel",this.onPointerUp))}updateHandlers(e){this.handlers=e}end(){var e;(e=this.removeListeners)==null||e.call(this),Eve.update(this.updatePoint)}}function GK(n,e){return{x:n.x-e.x,y:n.y-e.y}}function SM(n,e){return{point:n.point,delta:GK(n.point,e[e.length-1]),offset:GK(n.point,e[0]),velocity:Rve(e,.1)}}const Cve=n=>n*1e3;function Rve(n,e){if(n.length<2)return{x:0,y:0};let i=n.length-1,o=null;const l=n[n.length-1];for(;i>=0&&(o=n[i],!(l.timestamp-o.timestamp>Cve(e)));)i--;if(!o)return{x:0,y:0};const d=(l.timestamp-o.timestamp)/1e3;if(d===0)return{x:0,y:0};const p={x:(l.x-o.x)/d,y:(l.y-o.y)/d};return p.x===1/0&&(p.x=0),p.y===1/0&&(p.y=0),p}function Ive(...n){return e=>n.reduce((i,o)=>o(i),e)}function bM(n,e){return Math.abs(n-e)}function HK(n){return"x"in n&&"y"in n}function Ave(n,e){if(typeof n=="number"&&typeof e=="number")return bM(n,e);if(HK(n)&&HK(e)){const i=bM(n.x,e.x),o=bM(n.y,e.y);return Math.sqrt(i**2+o**2)}return 0}function Pve(n,e){const{onPan:i,onPanStart:o,onPanEnd:l,onPanSessionStart:d,onPanSessionEnd:p,threshold:_}=e,E=!!(i||o||l||d||p),b=D.useRef(null),C=DZ({onSessionStart:d,onSessionEnd:p,onStart:o,onMove:i,onEnd(I,O){b.current=null,l==null||l(I,O)}});D.useEffect(()=>{var I;(I=b.current)==null||I.updateHandlers(C.current)}),D.useEffect(()=>{const I=n.current;if(!I||!E)return;function O(L){b.current=new wve(L,C.current,_)}return qO(I,"pointerdown",O)},[n,E,C,_]),D.useEffect(()=>()=>{var I;(I=b.current)==null||I.end(),b.current=null},[])}const Eo={open:(n,e)=>`${n}[data-open], ${n}[open], ${n}[data-state=open] ${e}`,closed:(n,e)=>`${n}[data-closed], ${n}[data-state=closed] ${e}`,hover:(n,e)=>`${n}:hover ${e}, ${n}[data-hover] ${e}`,focus:(n,e)=>`${n}:focus ${e}, ${n}[data-focus] ${e}`,focusVisible:(n,e)=>`${n}:focus-visible ${e}`,focusWithin:(n,e)=>`${n}:focus-within ${e}`,active:(n,e)=>`${n}:active ${e}, ${n}[data-active] ${e}`,disabled:(n,e)=>`${n}:disabled ${e}, ${n}[data-disabled] ${e}`,invalid:(n,e)=>`${n}:invalid ${e}, ${n}[data-invalid] ${e}`,checked:(n,e)=>`${n}:checked ${e}, ${n}[data-checked] ${e}`,placeholderShown:(n,e)=>`${n}:placeholder-shown ${e}`},Uh=n=>FZ(e=>n(e,"&"),"[role=group]","[data-group]",".group"),_p=n=>FZ(e=>n(e,"~ &"),"[data-peer]",".peer"),FZ=(n,...e)=>e.map(n).join(", "),JS={_hover:"&:hover, &[data-hover]",_active:"&:active, &[data-active]",_focus:"&:focus, &[data-focus]",_highlighted:"&[data-highlighted]",_focusWithin:"&:focus-within, &[data-focus-within]",_focusVisible:"&:focus-visible, &[data-focus-visible]",_disabled:"&:disabled, &[disabled], &[aria-disabled=true], &[data-disabled]",_readOnly:"&[aria-readonly=true], &[readonly], &[data-readonly]",_before:"&::before",_after:"&::after",_empty:"&:empty, &[data-empty]",_expanded:"&[aria-expanded=true], &[data-expanded], &[data-state=expanded]",_checked:"&[aria-checked=true], &[data-checked], &[data-state=checked]",_grabbed:"&[aria-grabbed=true], &[data-grabbed]",_pressed:"&[aria-pressed=true], &[data-pressed]",_invalid:"&[aria-invalid=true], &[data-invalid]",_valid:"&[data-valid], &[data-state=valid]",_loading:"&[data-loading], &[aria-busy=true]",_selected:"&[aria-selected=true], &[data-selected]",_hidden:"&[hidden], &[data-hidden]",_autofill:"&:-webkit-autofill",_even:"&:nth-of-type(even)",_odd:"&:nth-of-type(odd)",_first:"&:first-of-type",_firstLetter:"&::first-letter",_last:"&:last-of-type",_notFirst:"&:not(:first-of-type)",_notLast:"&:not(:last-of-type)",_visited:"&:visited",_activeLink:"&[aria-current=page]",_activeStep:"&[aria-current=step]",_indeterminate:"&:indeterminate, &[aria-checked=mixed], &[data-indeterminate], &[data-state=indeterminate]",_groupOpen:Uh(Eo.open),_groupClosed:Uh(Eo.closed),_groupHover:Uh(Eo.hover),_peerHover:_p(Eo.hover),_groupFocus:Uh(Eo.focus),_peerFocus:_p(Eo.focus),_groupFocusVisible:Uh(Eo.focusVisible),_peerFocusVisible:_p(Eo.focusVisible),_groupActive:Uh(Eo.active),_peerActive:_p(Eo.active),_groupDisabled:Uh(Eo.disabled),_peerDisabled:_p(Eo.disabled),_groupInvalid:Uh(Eo.invalid),_peerInvalid:_p(Eo.invalid),_groupChecked:Uh(Eo.checked),_peerChecked:_p(Eo.checked),_groupFocusWithin:Uh(Eo.focusWithin),_peerFocusWithin:_p(Eo.focusWithin),_peerPlaceholderShown:_p(Eo.placeholderShown),_placeholder:"&::placeholder, &[data-placeholder]",_placeholderShown:"&:placeholder-shown, &[data-placeholder-shown]",_fullScreen:"&:fullscreen, &[data-fullscreen]",_selection:"&::selection",_rtl:"[dir=rtl] &, &[dir=rtl]",_ltr:"[dir=ltr] &, &[dir=ltr]",_mediaDark:"@media (prefers-color-scheme: dark)",_mediaReduceMotion:"@media (prefers-reduced-motion: reduce)",_dark:".chakra-ui-dark &:not([data-theme]),[data-theme=dark] &:not([data-theme]),&[data-theme=dark]",_light:".chakra-ui-light &:not([data-theme]),[data-theme=light] &:not([data-theme]),&[data-theme=light]",_horizontal:"&[data-orientation=horizontal]",_vertical:"&[data-orientation=vertical]",_open:"&[data-open], &[open], &[data-state=open]",_closed:"&[data-closed], &[data-state=closed]",_complete:"&[data-complete]",_incomplete:"&[data-incomplete]",_current:"&[data-current]"},jZ=Object.keys(JS),Ove=n=>/!(important)?$/.test(n),$K=n=>typeof n=="string"?n.replace(/!(important)?$/,"").trim():n,kve=(n,e)=>i=>{const o=String(e),l=Ove(o),d=$K(o),p=n?`${n}.${d}`:d;let _=Du(i.__cssMap)&&p in i.__cssMap?i.__cssMap[p].varRef:e;return _=$K(_),l?`${_} !important`:_};function xF(n){const{scale:e,transform:i,compose:o}=n;return(d,p)=>{const _=kve(e,d)(p);let E=(i==null?void 0:i(_,p))??_;return o&&(E=o(E,p)),E}}const mO=(...n)=>e=>n.reduce((i,o)=>o(i),e);function Au(n,e){return i=>{const o={property:i,scale:n};return o.transform=xF({scale:n,transform:e}),o}}const Nve=({rtl:n,ltr:e})=>i=>i.direction==="rtl"?n:e;function Dve(n){const{property:e,scale:i,transform:o}=n;return{scale:i,property:Nve(e),transform:i?xF({scale:i,compose:o}):o}}const BZ=["rotate(var(--chakra-rotate, 0))","scaleX(var(--chakra-scale-x, 1))","scaleY(var(--chakra-scale-y, 1))","skewX(var(--chakra-skew-x, 0))","skewY(var(--chakra-skew-y, 0))"];function xve(){return["translateX(var(--chakra-translate-x, 0))","translateY(var(--chakra-translate-y, 0))",...BZ].join(" ")}function Lve(){return["translate3d(var(--chakra-translate-x, 0), var(--chakra-translate-y, 0), 0)",...BZ].join(" ")}const Mve={"--chakra-blur":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-brightness":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-contrast":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-grayscale":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-hue-rotate":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-invert":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-saturate":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-sepia":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-drop-shadow":"var(--chakra-empty,/*!*/ /*!*/)",filter:["var(--chakra-blur)","var(--chakra-brightness)","var(--chakra-contrast)","var(--chakra-grayscale)","var(--chakra-hue-rotate)","var(--chakra-invert)","var(--chakra-saturate)","var(--chakra-sepia)","var(--chakra-drop-shadow)"].join(" ")},Uve={backdropFilter:["var(--chakra-backdrop-blur)","var(--chakra-backdrop-brightness)","var(--chakra-backdrop-contrast)","var(--chakra-backdrop-grayscale)","var(--chakra-backdrop-hue-rotate)","var(--chakra-backdrop-invert)","var(--chakra-backdrop-opacity)","var(--chakra-backdrop-saturate)","var(--chakra-backdrop-sepia)"].join(" "),"--chakra-backdrop-blur":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-brightness":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-contrast":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-grayscale":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-hue-rotate":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-invert":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-opacity":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-saturate":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-sepia":"var(--chakra-empty,/*!*/ /*!*/)"};function Vve(n){return{"--chakra-ring-offset-shadow":"var(--chakra-ring-inset) 0 0 0 var(--chakra-ring-offset-width) var(--chakra-ring-offset-color)","--chakra-ring-shadow":"var(--chakra-ring-inset) 0 0 0 calc(var(--chakra-ring-width) + var(--chakra-ring-offset-width)) var(--chakra-ring-color)","--chakra-ring-width":n,boxShadow:["var(--chakra-ring-offset-shadow)","var(--chakra-ring-shadow)","var(--chakra-shadow, 0 0 #0000)"].join(", ")}}const Fve={"row-reverse":{space:"--chakra-space-x-reverse",divide:"--chakra-divide-x-reverse"},"column-reverse":{space:"--chakra-space-y-reverse",divide:"--chakra-divide-y-reverse"}},$U={"to-t":"to top","to-tr":"to top right","to-r":"to right","to-br":"to bottom right","to-b":"to bottom","to-bl":"to bottom left","to-l":"to left","to-tl":"to top left"},jve=new Set(Object.values($U)),KU=new Set(["none","-moz-initial","inherit","initial","revert","unset"]),Bve=n=>n.trim();function Wve(n,e){if(n==null||KU.has(n))return n;if(!(qU(n)||KU.has(n)))return`url('${n}')`;const l=/(^[a-z-A-Z]+)\((.*)\)/g.exec(n),d=l==null?void 0:l[1],p=l==null?void 0:l[2];if(!d||!p)return n;const _=d.includes("-gradient")?d:`${d}-gradient`,[E,...b]=p.split(",").map(Bve).filter(Boolean);if((b==null?void 0:b.length)===0)return n;const C=E in $U?$U[E]:E;b.unshift(C);const I=b.map(O=>{if(jve.has(O))return O;const L=O.indexOf(" "),[V,B]=L!==-1?[O.substr(0,L),O.substr(L+1)]:[O],W=qU(B)?B:B&&B.split(" "),Z=`colors.${V}`,$=Z in e.__cssMap?e.__cssMap[Z].varRef:V;return W?[$,...Array.isArray(W)?W:[W]].join(" "):$});return`${_}(${I.join(", ")})`}const qU=n=>typeof n=="string"&&n.includes("(")&&n.includes(")"),zve=(n,e)=>Wve(n,e??{});function Gve(n){return/^var\(--.+\)$/.test(n)}const Hve=n=>{const e=parseFloat(n.toString()),i=n.toString().replace(String(e),"");return{unitless:!i,value:e,unit:i}},Vh=n=>e=>`${n}(${e})`,Lr={filter(n){return n!=="auto"?n:Mve},backdropFilter(n){return n!=="auto"?n:Uve},ring(n){return Vve(Lr.px(n))},bgClip(n){return n==="text"?{color:"transparent",backgroundClip:"text"}:{backgroundClip:n}},transform(n){return n==="auto"?xve():n==="auto-gpu"?Lve():n},vh(n){return n==="$100vh"?"var(--chakra-vh)":n},px(n){if(n==null)return n;const{unitless:e}=Hve(n);return e||typeof n=="number"?`${n}px`:n},fraction(n){return typeof n!="number"||n>1?n:`${n*100}%`},float(n,e){const i={left:"right",right:"left"};return e.direction==="rtl"?i[n]:n},degree(n){if(Gve(n)||n==null)return n;const e=typeof n=="string"&&!n.endsWith("deg");return typeof n=="number"||e?`${n}deg`:n},gradient:zve,blur:Vh("blur"),opacity:Vh("opacity"),brightness:Vh("brightness"),contrast:Vh("contrast"),dropShadow:Vh("drop-shadow"),grayscale:Vh("grayscale"),hueRotate:n=>Vh("hue-rotate")(Lr.degree(n)),invert:Vh("invert"),saturate:Vh("saturate"),sepia:Vh("sepia"),bgImage(n){return n==null||qU(n)||KU.has(n)?n:`url(${n})`},outline(n){const e=String(n)==="0"||String(n)==="none";return n!==null&&e?{outline:"2px solid transparent",outlineOffset:"2px"}:{outline:n}},flexDirection(n){const{space:e,divide:i}=Fve[n]??{},o={flexDirection:n};return e&&(o[e]=1),i&&(o[i]=1),o}},Be={borderWidths:Au("borderWidths"),borderStyles:Au("borderStyles"),colors:Au("colors"),borders:Au("borders"),gradients:Au("gradients",Lr.gradient),radii:Au("radii",Lr.px),space:Au("space",mO(Lr.vh,Lr.px)),spaceT:Au("space",mO(Lr.vh,Lr.px)),degreeT(n){return{property:n,transform:Lr.degree}},prop(n,e,i){return{property:n,scale:e,...e&&{transform:xF({scale:e,transform:i})}}},propT(n,e){return{property:n,transform:e}},sizes:Au("sizes",mO(Lr.vh,Lr.px)),sizesT:Au("sizes",mO(Lr.vh,Lr.fraction)),shadows:Au("shadows"),logical:Dve,blur:Au("blur",Lr.blur)},XO={background:Be.colors("background"),backgroundColor:Be.colors("backgroundColor"),backgroundImage:Be.gradients("backgroundImage"),backgroundSize:!0,backgroundPosition:!0,backgroundRepeat:!0,backgroundAttachment:!0,backgroundClip:{transform:Lr.bgClip},bgSize:Be.prop("backgroundSize"),bgPosition:Be.prop("backgroundPosition"),bg:Be.colors("background"),bgColor:Be.colors("backgroundColor"),bgPos:Be.prop("backgroundPosition"),bgRepeat:Be.prop("backgroundRepeat"),bgAttachment:Be.prop("backgroundAttachment"),bgGradient:Be.gradients("backgroundImage"),bgClip:{transform:Lr.bgClip}};Object.assign(XO,{bgImage:XO.backgroundImage,bgImg:XO.backgroundImage});const ni={border:Be.borders("border"),borderWidth:Be.borderWidths("borderWidth"),borderStyle:Be.borderStyles("borderStyle"),borderColor:Be.colors("borderColor"),borderRadius:Be.radii("borderRadius"),borderTop:Be.borders("borderTop"),borderBlockStart:Be.borders("borderBlockStart"),borderTopLeftRadius:Be.radii("borderTopLeftRadius"),borderStartStartRadius:Be.logical({scale:"radii",property:{ltr:"borderTopLeftRadius",rtl:"borderTopRightRadius"}}),borderEndStartRadius:Be.logical({scale:"radii",property:{ltr:"borderBottomLeftRadius",rtl:"borderBottomRightRadius"}}),borderTopRightRadius:Be.radii("borderTopRightRadius"),borderStartEndRadius:Be.logical({scale:"radii",property:{ltr:"borderTopRightRadius",rtl:"borderTopLeftRadius"}}),borderEndEndRadius:Be.logical({scale:"radii",property:{ltr:"borderBottomRightRadius",rtl:"borderBottomLeftRadius"}}),borderRight:Be.borders("borderRight"),borderInlineEnd:Be.borders("borderInlineEnd"),borderBottom:Be.borders("borderBottom"),borderBlockEnd:Be.borders("borderBlockEnd"),borderBottomLeftRadius:Be.radii("borderBottomLeftRadius"),borderBottomRightRadius:Be.radii("borderBottomRightRadius"),borderLeft:Be.borders("borderLeft"),borderInlineStart:{property:"borderInlineStart",scale:"borders"},borderInlineStartRadius:Be.logical({scale:"radii",property:{ltr:["borderTopLeftRadius","borderBottomLeftRadius"],rtl:["borderTopRightRadius","borderBottomRightRadius"]}}),borderInlineEndRadius:Be.logical({scale:"radii",property:{ltr:["borderTopRightRadius","borderBottomRightRadius"],rtl:["borderTopLeftRadius","borderBottomLeftRadius"]}}),borderX:Be.borders(["borderLeft","borderRight"]),borderInline:Be.borders("borderInline"),borderY:Be.borders(["borderTop","borderBottom"]),borderBlock:Be.borders("borderBlock"),borderTopWidth:Be.borderWidths("borderTopWidth"),borderBlockStartWidth:Be.borderWidths("borderBlockStartWidth"),borderTopColor:Be.colors("borderTopColor"),borderBlockStartColor:Be.colors("borderBlockStartColor"),borderTopStyle:Be.borderStyles("borderTopStyle"),borderBlockStartStyle:Be.borderStyles("borderBlockStartStyle"),borderBottomWidth:Be.borderWidths("borderBottomWidth"),borderBlockEndWidth:Be.borderWidths("borderBlockEndWidth"),borderBottomColor:Be.colors("borderBottomColor"),borderBlockEndColor:Be.colors("borderBlockEndColor"),borderBottomStyle:Be.borderStyles("borderBottomStyle"),borderBlockEndStyle:Be.borderStyles("borderBlockEndStyle"),borderLeftWidth:Be.borderWidths("borderLeftWidth"),borderInlineStartWidth:Be.borderWidths("borderInlineStartWidth"),borderLeftColor:Be.colors("borderLeftColor"),borderInlineStartColor:Be.colors("borderInlineStartColor"),borderLeftStyle:Be.borderStyles("borderLeftStyle"),borderInlineStartStyle:Be.borderStyles("borderInlineStartStyle"),borderRightWidth:Be.borderWidths("borderRightWidth"),borderInlineEndWidth:Be.borderWidths("borderInlineEndWidth"),borderRightColor:Be.colors("borderRightColor"),borderInlineEndColor:Be.colors("borderInlineEndColor"),borderRightStyle:Be.borderStyles("borderRightStyle"),borderInlineEndStyle:Be.borderStyles("borderInlineEndStyle"),borderTopRadius:Be.radii(["borderTopLeftRadius","borderTopRightRadius"]),borderBottomRadius:Be.radii(["borderBottomLeftRadius","borderBottomRightRadius"]),borderLeftRadius:Be.radii(["borderTopLeftRadius","borderBottomLeftRadius"]),borderRightRadius:Be.radii(["borderTopRightRadius","borderBottomRightRadius"])};Object.assign(ni,{rounded:ni.borderRadius,roundedTop:ni.borderTopRadius,roundedTopLeft:ni.borderTopLeftRadius,roundedTopRight:ni.borderTopRightRadius,roundedTopStart:ni.borderStartStartRadius,roundedTopEnd:ni.borderStartEndRadius,roundedBottom:ni.borderBottomRadius,roundedBottomLeft:ni.borderBottomLeftRadius,roundedBottomRight:ni.borderBottomRightRadius,roundedBottomStart:ni.borderEndStartRadius,roundedBottomEnd:ni.borderEndEndRadius,roundedLeft:ni.borderLeftRadius,roundedRight:ni.borderRightRadius,roundedStart:ni.borderInlineStartRadius,roundedEnd:ni.borderInlineEndRadius,borderStart:ni.borderInlineStart,borderEnd:ni.borderInlineEnd,borderTopStartRadius:ni.borderStartStartRadius,borderTopEndRadius:ni.borderStartEndRadius,borderBottomStartRadius:ni.borderEndStartRadius,borderBottomEndRadius:ni.borderEndEndRadius,borderStartRadius:ni.borderInlineStartRadius,borderEndRadius:ni.borderInlineEndRadius,borderStartWidth:ni.borderInlineStartWidth,borderEndWidth:ni.borderInlineEndWidth,borderStartColor:ni.borderInlineStartColor,borderEndColor:ni.borderInlineEndColor,borderStartStyle:ni.borderInlineStartStyle,borderEndStyle:ni.borderInlineEndStyle});const $ve={color:Be.colors("color"),textColor:Be.colors("color"),fill:Be.colors("fill"),stroke:Be.colors("stroke"),accentColor:Be.colors("accentColor"),textFillColor:Be.colors("textFillColor")},Lk={alignItems:!0,alignContent:!0,justifyItems:!0,justifyContent:!0,flexWrap:!0,flexDirection:{transform:Lr.flexDirection},flex:!0,flexFlow:!0,flexGrow:!0,flexShrink:!0,flexBasis:Be.sizes("flexBasis"),justifySelf:!0,alignSelf:!0,order:!0,placeItems:!0,placeContent:!0,placeSelf:!0,gap:Be.space("gap"),rowGap:Be.space("rowGap"),columnGap:Be.space("columnGap")};Object.assign(Lk,{flexDir:Lk.flexDirection});const ku={width:Be.sizesT("width"),inlineSize:Be.sizesT("inlineSize"),height:Be.sizes("height"),blockSize:Be.sizes("blockSize"),boxSize:Be.sizes(["width","height"]),minWidth:Be.sizes("minWidth"),minInlineSize:Be.sizes("minInlineSize"),minHeight:Be.sizes("minHeight"),minBlockSize:Be.sizes("minBlockSize"),maxWidth:Be.sizes("maxWidth"),maxInlineSize:Be.sizes("maxInlineSize"),maxHeight:Be.sizes("maxHeight"),maxBlockSize:Be.sizes("maxBlockSize"),overflow:!0,overflowX:!0,overflowY:!0,overscrollBehavior:!0,overscrollBehaviorX:!0,overscrollBehaviorY:!0,display:!0,aspectRatio:!0,hideFrom:{scale:"breakpoints",transform:(n,e)=>{var l,d;return{[`@media screen and (min-width: ${((d=(l=e.__breakpoints)==null?void 0:l.get(n))==null?void 0:d.minW)??n})`]:{display:"none"}}}},hideBelow:{scale:"breakpoints",transform:(n,e)=>{var l,d;return{[`@media screen and (max-width: ${((d=(l=e.__breakpoints)==null?void 0:l.get(n))==null?void 0:d._minW)??n})`]:{display:"none"}}}},verticalAlign:!0,boxSizing:!0,boxDecorationBreak:!0,float:Be.propT("float",Lr.float),objectFit:!0,objectPosition:!0,visibility:!0,isolation:!0};Object.assign(ku,{w:ku.width,h:ku.height,minW:ku.minWidth,maxW:ku.maxWidth,minH:ku.minHeight,maxH:ku.maxHeight,overscroll:ku.overscrollBehavior,overscrollX:ku.overscrollBehaviorX,overscrollY:ku.overscrollBehaviorY});const Kve={filter:{transform:Lr.filter},blur:Be.blur("--chakra-blur"),brightness:Be.propT("--chakra-brightness",Lr.brightness),contrast:Be.propT("--chakra-contrast",Lr.contrast),hueRotate:Be.propT("--chakra-hue-rotate",Lr.hueRotate),invert:Be.propT("--chakra-invert",Lr.invert),saturate:Be.propT("--chakra-saturate",Lr.saturate),dropShadow:Be.propT("--chakra-drop-shadow",Lr.dropShadow),backdropFilter:{transform:Lr.backdropFilter},backdropBlur:Be.blur("--chakra-backdrop-blur"),backdropBrightness:Be.propT("--chakra-backdrop-brightness",Lr.brightness),backdropContrast:Be.propT("--chakra-backdrop-contrast",Lr.contrast),backdropHueRotate:Be.propT("--chakra-backdrop-hue-rotate",Lr.hueRotate),backdropInvert:Be.propT("--chakra-backdrop-invert",Lr.invert),backdropSaturate:Be.propT("--chakra-backdrop-saturate",Lr.saturate)},qve={ring:{transform:Lr.ring},ringColor:Be.colors("--chakra-ring-color"),ringOffset:Be.prop("--chakra-ring-offset-width"),ringOffsetColor:Be.colors("--chakra-ring-offset-color"),ringInset:Be.prop("--chakra-ring-inset")},Yve={appearance:!0,cursor:!0,resize:!0,userSelect:!0,pointerEvents:!0,outline:{transform:Lr.outline},outlineOffset:!0,outlineColor:Be.colors("outlineColor")},WZ={gridGap:Be.space("gridGap"),gridColumnGap:Be.space("gridColumnGap"),gridRowGap:Be.space("gridRowGap"),gridColumn:!0,gridRow:!0,gridAutoFlow:!0,gridAutoColumns:!0,gridColumnStart:!0,gridColumnEnd:!0,gridRowStart:!0,gridRowEnd:!0,gridAutoRows:!0,gridTemplate:!0,gridTemplateColumns:!0,gridTemplateRows:!0,gridTemplateAreas:!0,gridArea:!0};function Xve(n,e,i,o){const l=typeof e=="string"?e.split("."):[e];for(o=0;o<l.length&&n;o+=1)n=n[l[o]];return n===void 0?i:n}const Jve=n=>{const e=new WeakMap;return(o,l,d,p)=>{if(typeof o>"u")return n(o,l,d);e.has(o)||e.set(o,new Map);const _=e.get(o);if(_.has(l))return _.get(l);const E=n(o,l,d,p);return _.set(l,E),E}},Qve=Jve(Xve),Zve={border:"0px",clip:"rect(0, 0, 0, 0)",width:"1px",height:"1px",margin:"-1px",padding:"0px",overflow:"hidden",whiteSpace:"nowrap",position:"absolute"},eSe={position:"static",width:"auto",height:"auto",clip:"auto",padding:"0",margin:"0",overflow:"visible",whiteSpace:"normal"},TM=(n,e,i)=>{const o={},l=Qve(n,e,{});for(const d in l)d in i&&i[d]!=null||(o[d]=l[d]);return o},tSe={srOnly:{transform(n){return n===!0?Zve:n==="focusable"?eSe:{}}},layerStyle:{processResult:!0,transform:(n,e,i)=>TM(e,`layerStyles.${n}`,i)},textStyle:{processResult:!0,transform:(n,e,i)=>TM(e,`textStyles.${n}`,i)},apply:{processResult:!0,transform:(n,e,i)=>TM(e,n,i)}},eC={position:!0,pos:Be.prop("position"),zIndex:Be.prop("zIndex","zIndices"),inset:Be.spaceT("inset"),insetX:Be.spaceT(["left","right"]),insetInline:Be.spaceT("insetInline"),insetY:Be.spaceT(["top","bottom"]),insetBlock:Be.spaceT("insetBlock"),top:Be.spaceT("top"),insetBlockStart:Be.spaceT("insetBlockStart"),bottom:Be.spaceT("bottom"),insetBlockEnd:Be.spaceT("insetBlockEnd"),left:Be.spaceT("left"),insetInlineStart:Be.logical({scale:"space",property:{ltr:"left",rtl:"right"}}),right:Be.spaceT("right"),insetInlineEnd:Be.logical({scale:"space",property:{ltr:"right",rtl:"left"}})};Object.assign(eC,{insetStart:eC.insetInlineStart,insetEnd:eC.insetInlineEnd});const YU={boxShadow:Be.shadows("boxShadow"),mixBlendMode:!0,blendMode:Be.prop("mixBlendMode"),backgroundBlendMode:!0,bgBlendMode:Be.prop("backgroundBlendMode"),opacity:!0};Object.assign(YU,{shadow:YU.boxShadow});const es={margin:Be.spaceT("margin"),marginTop:Be.spaceT("marginTop"),marginBlockStart:Be.spaceT("marginBlockStart"),marginRight:Be.spaceT("marginRight"),marginInlineEnd:Be.spaceT("marginInlineEnd"),marginBottom:Be.spaceT("marginBottom"),marginBlockEnd:Be.spaceT("marginBlockEnd"),marginLeft:Be.spaceT("marginLeft"),marginInlineStart:Be.spaceT("marginInlineStart"),marginX:Be.spaceT(["marginInlineStart","marginInlineEnd"]),marginInline:Be.spaceT("marginInline"),marginY:Be.spaceT(["marginTop","marginBottom"]),marginBlock:Be.spaceT("marginBlock"),padding:Be.space("padding"),paddingTop:Be.space("paddingTop"),paddingBlockStart:Be.space("paddingBlockStart"),paddingRight:Be.space("paddingRight"),paddingBottom:Be.space("paddingBottom"),paddingBlockEnd:Be.space("paddingBlockEnd"),paddingLeft:Be.space("paddingLeft"),paddingInlineStart:Be.space("paddingInlineStart"),paddingInlineEnd:Be.space("paddingInlineEnd"),paddingX:Be.space(["paddingInlineStart","paddingInlineEnd"]),paddingInline:Be.space("paddingInline"),paddingY:Be.space(["paddingTop","paddingBottom"]),paddingBlock:Be.space("paddingBlock")};Object.assign(es,{m:es.margin,mt:es.marginTop,mr:es.marginRight,me:es.marginInlineEnd,marginEnd:es.marginInlineEnd,mb:es.marginBottom,ml:es.marginLeft,ms:es.marginInlineStart,marginStart:es.marginInlineStart,mx:es.marginX,my:es.marginY,p:es.padding,pt:es.paddingTop,py:es.paddingY,px:es.paddingX,pb:es.paddingBottom,pl:es.paddingLeft,ps:es.paddingInlineStart,paddingStart:es.paddingInlineStart,pr:es.paddingRight,pe:es.paddingInlineEnd,paddingEnd:es.paddingInlineEnd});const nSe={scrollBehavior:!0,scrollSnapAlign:!0,scrollSnapStop:!0,scrollSnapType:!0,scrollMargin:Be.spaceT("scrollMargin"),scrollMarginTop:Be.spaceT("scrollMarginTop"),scrollMarginBottom:Be.spaceT("scrollMarginBottom"),scrollMarginLeft:Be.spaceT("scrollMarginLeft"),scrollMarginRight:Be.spaceT("scrollMarginRight"),scrollMarginX:Be.spaceT(["scrollMarginLeft","scrollMarginRight"]),scrollMarginY:Be.spaceT(["scrollMarginTop","scrollMarginBottom"]),scrollPadding:Be.spaceT("scrollPadding"),scrollPaddingTop:Be.spaceT("scrollPaddingTop"),scrollPaddingBottom:Be.spaceT("scrollPaddingBottom"),scrollPaddingLeft:Be.spaceT("scrollPaddingLeft"),scrollPaddingRight:Be.spaceT("scrollPaddingRight"),scrollPaddingX:Be.spaceT(["scrollPaddingLeft","scrollPaddingRight"]),scrollPaddingY:Be.spaceT(["scrollPaddingTop","scrollPaddingBottom"])},rSe={fontFamily:Be.prop("fontFamily","fonts"),fontSize:Be.prop("fontSize","fontSizes",Lr.px),fontWeight:Be.prop("fontWeight","fontWeights"),lineHeight:Be.prop("lineHeight","lineHeights"),letterSpacing:Be.prop("letterSpacing","letterSpacings"),textAlign:!0,fontStyle:!0,textIndent:!0,wordBreak:!0,overflowWrap:!0,textOverflow:!0,textTransform:!0,whiteSpace:!0,isTruncated:{transform(n){if(n===!0)return{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}}},noOfLines:{static:{overflow:"hidden",textOverflow:"ellipsis",display:"-webkit-box",WebkitBoxOrient:"vertical",WebkitLineClamp:"var(--chakra-line-clamp)"},property:"--chakra-line-clamp"}},iSe={textDecorationColor:Be.colors("textDecorationColor"),textDecoration:!0,textDecor:{property:"textDecoration"},textDecorationLine:!0,textDecorationStyle:!0,textDecorationThickness:!0,textUnderlineOffset:!0,textShadow:Be.shadows("textShadow")},sSe={clipPath:!0,transform:Be.propT("transform",Lr.transform),transformOrigin:!0,translateX:Be.spaceT("--chakra-translate-x"),translateY:Be.spaceT("--chakra-translate-y"),skewX:Be.degreeT("--chakra-skew-x"),skewY:Be.degreeT("--chakra-skew-y"),scaleX:Be.prop("--chakra-scale-x"),scaleY:Be.prop("--chakra-scale-y"),scale:Be.prop(["--chakra-scale-x","--chakra-scale-y"]),rotate:Be.degreeT("--chakra-rotate")},oSe={listStyleType:!0,listStylePosition:!0,listStylePos:Be.prop("listStylePosition"),listStyleImage:!0,listStyleImg:Be.prop("listStyleImage")},aSe={transition:!0,transitionDelay:!0,animation:!0,willChange:!0,transitionDuration:Be.prop("transitionDuration","transition.duration"),transitionProperty:Be.prop("transitionProperty","transition.property"),transitionTimingFunction:Be.prop("transitionTimingFunction","transition.easing")},LF=qh({},XO,ni,$ve,Lk,ku,Kve,qve,Yve,WZ,tSe,eC,YU,es,nSe,rSe,iSe,sSe,oSe,aSe),cSe=Object.assign({},es,ku,Lk,WZ,eC),lSe=Object.keys(cSe),uSe=[...Object.keys(LF),...jZ],dSe={...LF,...JS},hSe=n=>n in dSe,fSe=n=>e=>{if(!e.__breakpoints)return n;const{isResponsive:i,toArrayValue:o,media:l}=e.__breakpoints,d={};for(const p in n){let _=cl(n[p],e);if(_==null)continue;if(_=Du(_)&&i(_)?o(_):_,!Array.isArray(_)){d[p]=_;continue}const E=_.slice(0,l.length).length;for(let b=0;b<E;b+=1){const C=l==null?void 0:l[b];if(!C){d[p]=_[b];continue}d[C]=d[C]||{},_[b]!=null&&(d[C][p]=_[b])}}return d};function pSe(n){const e=[];let i="",o=!1;for(let l=0;l<n.length;l++){const d=n[l];d==="("?(o=!0,i+=d):d===")"?(o=!1,i+=d):d===","&&!o?(e.push(i),i=""):i+=d}return i=i.trim(),i&&e.push(i),e}function mSe(n){return/^var\(--.+\)$/.test(n)}const gSe=(n,e)=>n.startsWith("--")&&typeof e=="string"&&!mSe(e),_Se=(n,e)=>{if(e==null)return e;const i=p=>{var _,E;return(E=(_=n.__cssMap)==null?void 0:_[p])==null?void 0:E.varRef},o=p=>i(p)??p,[l,d]=pSe(e);return e=i(l)??o(d)??o(e),e};function ySe(n){const{configs:e={},pseudos:i={},theme:o}=n,l=(d,p=!1)=>{var C;const _=cl(d,o),E=fSe(_)(o);let b={};for(let I in E){const O=E[I];let L=cl(O,o);I in i&&(I=i[I]),gSe(I,L)&&(L=_Se(o,L));let V=e[I];if(V===!0&&(V={property:I}),Du(L)){b[I]=b[I]??{},b[I]=qh({},b[I],l(L,!0));continue}let B=((C=V==null?void 0:V.transform)==null?void 0:C.call(V,L,o,_))??L;B=V!=null&&V.processResult?l(B,!0):B;const W=cl(V==null?void 0:V.property,o);if(!p&&(V!=null&&V.static)){const Z=cl(V.static,o);b=qh({},b,Z)}if(W&&Array.isArray(W)){for(const Z of W)b[Z]=B;continue}if(W){W==="&"&&Du(B)?b=qh({},b,B):b[W]=B;continue}if(Du(B)){b=qh({},b,B);continue}b[I]=B}return b};return l}const zZ=n=>e=>ySe({theme:e,pseudos:JS,configs:LF})(n);function qGe(n){return n}function YGe(n){return n}function Gi(n){return{definePartsStyle(e){return e},defineMultiStyleConfig(e){return{parts:n,...e}}}}function ESe(n,e,i){var o,l;return((l=(o=n.__cssMap)==null?void 0:o[`${e}.${i}`])==null?void 0:l.varRef)??i}function vSe(n,e){if(Array.isArray(n))return n;if(Du(n))return e(n);if(n!=null)return[n]}function SSe(n,e){for(let i=e+1;i<n.length;i++)if(n[i]!=null)return i;return-1}function bSe(n){const e=n.__breakpoints;return function(o,l,d,p){var O,L;if(!e)return;const _={},E=vSe(d,e.toArrayValue);if(!E)return _;const b=E.length,C=b===1,I=!!o.parts;for(let V=0;V<b;V++){const B=e.details[V],W=e.details[SSe(E,V)],Z=Mw(B.minW,W==null?void 0:W._minW),$=cl((O=o[l])==null?void 0:O[E[V]],p);if($){if(I){(L=o.parts)==null||L.forEach(se=>{qh(_,{[se]:C?$[se]:{[Z]:$[se]}})});continue}if(!I){C?qh(_,$):_[Z]=$;continue}_[Z]=$}}return _}}function TSe(n){return e=>{const{variant:i,size:o,theme:l}=e,d=bSe(l);return qh({},cl(n.baseStyle??{},e),d(n,"sizes",o,e),d(n,"variants",i,e))}}function Vi(n){return V0(n,["styleConfig","size","variant","colorScheme"])}function GZ(n){return Du(n)&&n.reference?n.reference:String(n)}const P1=(n,...e)=>e.map(GZ).join(` ${n} `).replace(/calc/g,""),KK=(...n)=>`calc(${P1("+",...n)})`,qK=(...n)=>`calc(${P1("-",...n)})`,XU=(...n)=>`calc(${P1("*",...n)})`,YK=(...n)=>`calc(${P1("/",...n)})`,XK=n=>{const e=GZ(n);return e!=null&&!Number.isNaN(parseFloat(e))?String(e).startsWith("-")?String(e).slice(1):`-${e}`:XU(e,-1)},Sp=Object.assign(n=>({add:(...e)=>Sp(KK(n,...e)),subtract:(...e)=>Sp(qK(n,...e)),multiply:(...e)=>Sp(XU(n,...e)),divide:(...e)=>Sp(YK(n,...e)),negate:()=>Sp(XK(n)),toString:()=>n.toString()}),{add:KK,subtract:qK,multiply:XU,divide:YK,negate:XK});function wSe(n,e="-"){return n.replace(/\s+/g,e)}function CSe(n){const e=wSe(n.toString());return ISe(RSe(e))}function RSe(n){return n.includes("\\.")?n:!Number.isInteger(parseFloat(n.toString()))?n.replace(".","\\."):n}function ISe(n){return n.replace(/[!-,/:-@[-^`{-~]/g,"\\$&")}function ASe(n,e=""){return[e,n].filter(Boolean).join("-")}function PSe(n,e){return`var(${n}${e?`, ${e}`:""})`}function OSe(n,e=""){return CSe(`--${ASe(n,e)}`)}function Mn(n,e,i){const o=OSe(n,i);return{variable:o,reference:PSe(o,e)}}function kSe(n,e){const i={};for(const o of e){if(Array.isArray(o)){const[l,d]=o;i[l]=Mn(`${n}-${l}`,d);continue}i[o]=Mn(`${n}-${o}`)}return i}const NSe=["colors","borders","borderWidths","borderStyles","fonts","fontSizes","fontWeights","gradients","letterSpacings","lineHeights","radii","space","shadows","sizes","zIndices","transition","blur","breakpoints"];function DSe(n){return RZ(n,NSe)}function xSe(n){return n.semanticTokens}function LSe(n){const{__cssMap:e,__cssVars:i,__breakpoints:o,...l}=n;return l}function MSe(n){const e=DSe(n),i=xSe(n),o=d=>jZ.includes(d)||d==="default",l={};return UK(e,(d,p)=>{d!=null&&(l[p.join(".")]={isSemantic:!1,value:d})}),UK(i,(d,p)=>{d!=null&&(l[p.join(".")]={isSemantic:!0,value:d})},{stop:d=>Object.keys(d).every(o)}),l}function JK(n,e){return Mn(String(n).replace(/\./g,"-"),void 0,e)}function USe(n){var p;const e=MSe(n),i=(p=n.config)==null?void 0:p.cssVarPrefix;let o={};const l={};function d(_,E){const C=[String(_).split(".")[0],E].join(".");if(!e[C])return E;const{reference:O}=JK(C,i);return O}for(const[_,E]of Object.entries(e)){const{isSemantic:b,value:C}=E,{variable:I,reference:O}=JK(_,i);if(!b){if(_.startsWith("space")){const V=_.split("."),[B,...W]=V,Z=`${B}.-${W.join(".")}`,$=Sp.negate(C),se=Sp.negate(O);l[Z]={value:$,var:I,varRef:se}}o[I]=C,l[_]={value:C,var:I,varRef:O};continue}const L=Du(C)?C:{default:C};o=qh(o,Object.entries(L).reduce((V,[B,W])=>{if(!W)return V;const Z=d(_,`${W}`);if(B==="default")return V[I]=Z,V;const $=(JS==null?void 0:JS[B])??B;return V[$]={[I]:Z},V},{})),l[_]={value:O,var:I,varRef:O}}return{cssVars:o,cssMap:l}}function VSe(n){const e=LSe(n),{cssMap:i,cssVars:o}=USe(e);return Object.assign(e,{__cssVars:{...{"--chakra-ring-inset":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-ring-offset-width":"0px","--chakra-ring-offset-color":"#fff","--chakra-ring-color":"rgba(66, 153, 225, 0.6)","--chakra-ring-offset-shadow":"0 0 #0000","--chakra-ring-shadow":"0 0 #0000","--chakra-space-x-reverse":"0","--chakra-space-y-reverse":"0"},...o},__cssMap:i,__breakpoints:PEe(e.breakpoints)}),e}function oi(n,e={}){let i=!1;function o(){if(!i){i=!0;return}throw new Error("[anatomy] .part(...) should only be called once. Did you mean to use .extend(...) ?")}function l(...C){o();for(const I of C)e[I]=E(I);return oi(n,e)}function d(...C){for(const I of C)I in e||(e[I]=E(I));return oi(n,e)}function p(){return Object.fromEntries(Object.entries(e).map(([I,O])=>[I,O.selector]))}function _(){return Object.fromEntries(Object.entries(e).map(([I,O])=>[I,O.className]))}function E(C){const L=`chakra-${(["container","root"].includes(C??"")?[n]:[n,C]).filter(Boolean).join("__")}`;return{className:L,selector:`.${L}`,toString:()=>C}}return{parts:l,toPart:E,extend:d,selectors:p,classnames:_,get keys(){return Object.keys(e)},__type:{}}}const FSe=oi("accordion").parts("root","container","button","panel","icon"),jSe=oi("alert").parts("title","description","container","icon","spinner"),BSe=oi("avatar").parts("label","badge","container","excessLabel","group"),WSe=oi("breadcrumb").parts("link","item","container","separator");oi("button").parts();const zSe=oi("checkbox").parts("control","icon","container","label");oi("progress").parts("track","filledTrack","label");const GSe=oi("drawer").parts("overlay","dialogContainer","dialog","header","closeButton","body","footer"),HSe=oi("editable").parts("preview","input","textarea"),$Se=oi("form").parts("container","requiredIndicator","helperText"),KSe=oi("formError").parts("text","icon"),qSe=oi("input").parts("addon","field","element","group"),YSe=oi("list").parts("container","item","icon"),XSe=oi("menu").parts("button","list","item","groupTitle","icon","command","divider"),JSe=oi("modal").parts("overlay","dialogContainer","dialog","header","closeButton","body","footer"),QSe=oi("numberinput").parts("root","field","stepperGroup","stepper");oi("pininput").parts("field");const ZSe=oi("popover").parts("content","header","body","footer","popper","arrow","closeButton"),e0e=oi("progress").parts("label","filledTrack","track"),t0e=oi("radio").parts("container","control","label"),n0e=oi("select").parts("field","icon"),r0e=oi("slider").parts("container","track","thumb","filledTrack","mark"),i0e=oi("stat").parts("container","label","helpText","number","icon"),s0e=oi("switch").parts("container","track","thumb","label"),o0e=oi("table").parts("table","thead","tbody","tr","th","td","tfoot","caption"),a0e=oi("tabs").parts("root","tab","tablist","tabpanel","tabpanels","indicator"),c0e=oi("tag").parts("container","label","closeButton"),l0e=oi("card").parts("container","header","body","footer");oi("stepper").parts("stepper","step","title","description","indicator","separator","icon","number");const{definePartsStyle:u0e,defineMultiStyleConfig:d0e}=Gi(FSe.keys),h0e={borderTopWidth:"1px",borderColor:"inherit",_last:{borderBottomWidth:"1px"}},f0e={transitionProperty:"common",transitionDuration:"normal",fontSize:"md",_focusVisible:{boxShadow:"outline"},_hover:{bg:"blackAlpha.50"},_disabled:{opacity:.4,cursor:"not-allowed"},px:"4",py:"2"},p0e={pt:"2",px:"4",pb:"5"},m0e={fontSize:"1.25em"},g0e=u0e({container:h0e,button:f0e,panel:p0e,icon:m0e}),_0e=d0e({baseStyle:g0e});function by(n,e,i){return Math.min(Math.max(n,i),e)}class y0e extends Error{constructor(e){super(`Failed to parse color: "${e}"`)}}var Vw=y0e;function MF(n){if(typeof n!="string")throw new Vw(n);if(n.trim().toLowerCase()==="transparent")return[0,0,0,0];let e=n.trim();e=R0e.test(n)?S0e(n):n;const i=b0e.exec(e);if(i){const p=Array.from(i).slice(1);return[...p.slice(0,3).map(_=>parseInt(SC(_,2),16)),parseInt(SC(p[3]||"f",2),16)/255]}const o=T0e.exec(e);if(o){const p=Array.from(o).slice(1);return[...p.slice(0,3).map(_=>parseInt(_,16)),parseInt(p[3]||"ff",16)/255]}const l=w0e.exec(e);if(l){const p=Array.from(l).slice(1);return[...p.slice(0,3).map(_=>parseInt(_,10)),parseFloat(p[3]||"1")]}const d=C0e.exec(e);if(d){const[p,_,E,b]=Array.from(d).slice(1).map(parseFloat);if(by(0,100,_)!==_)throw new Vw(n);if(by(0,100,E)!==E)throw new Vw(n);return[...I0e(p,_,E),Number.isNaN(b)?1:b]}throw new Vw(n)}function E0e(n){let e=5381,i=n.length;for(;i;)e=e*33^n.charCodeAt(--i);return(e>>>0)%2341}const QK=n=>parseInt(n.replace(/_/g,""),36),v0e="1q29ehhb 1n09sgk7 1kl1ekf_ _yl4zsno 16z9eiv3 1p29lhp8 _bd9zg04 17u0____ _iw9zhe5 _to73___ _r45e31e _7l6g016 _jh8ouiv _zn3qba8 1jy4zshs 11u87k0u 1ro9yvyo 1aj3xael 1gz9zjz0 _3w8l4xo 1bf1ekf_ _ke3v___ _4rrkb__ 13j776yz _646mbhl _nrjr4__ _le6mbhl 1n37ehkb _m75f91n _qj3bzfz 1939yygw 11i5z6x8 _1k5f8xs 1509441m 15t5lwgf _ae2th1n _tg1ugcv 1lp1ugcv 16e14up_ _h55rw7n _ny9yavn _7a11xb_ 1ih442g9 _pv442g9 1mv16xof 14e6y7tu 1oo9zkds 17d1cisi _4v9y70f _y98m8kc 1019pq0v 12o9zda8 _348j4f4 1et50i2o _8epa8__ _ts6senj 1o350i2o 1mi9eiuo 1259yrp0 1ln80gnw _632xcoy 1cn9zldc _f29edu4 1n490c8q _9f9ziet 1b94vk74 _m49zkct 1kz6s73a 1eu9dtog _q58s1rz 1dy9sjiq __u89jo3 _aj5nkwg _ld89jo3 13h9z6wx _qa9z2ii _l119xgq _bs5arju 1hj4nwk9 1qt4nwk9 1ge6wau6 14j9zlcw 11p1edc_ _ms1zcxe _439shk6 _jt9y70f _754zsow 1la40eju _oq5p___ _x279qkz 1fa5r3rv _yd2d9ip _424tcku _8y1di2_ _zi2uabw _yy7rn9h 12yz980_ __39ljp6 1b59zg0x _n39zfzp 1fy9zest _b33k___ _hp9wq92 1il50hz4 _io472ub _lj9z3eo 19z9ykg0 _8t8iu3a 12b9bl4a 1ak5yw0o _896v4ku _tb8k8lv _s59zi6t _c09ze0p 1lg80oqn 1id9z8wb _238nba5 1kq6wgdi _154zssg _tn3zk49 _da9y6tc 1sg7cv4f _r12jvtt 1gq5fmkz 1cs9rvci _lp9jn1c _xw1tdnb 13f9zje6 16f6973h _vo7ir40 _bt5arjf _rc45e4t _hr4e100 10v4e100 _hc9zke2 _w91egv_ _sj2r1kk 13c87yx8 _vqpds__ _ni8ggk8 _tj9yqfb 1ia2j4r4 _7x9b10u 1fc9ld4j 1eq9zldr _5j9lhpx _ez9zl6o _md61fzm".split(" ").reduce((n,e)=>{const i=QK(e.substring(0,3)),o=QK(e.substring(3)).toString(16);let l="";for(let d=0;d<6-o.length;d++)l+="0";return n[i]=`${l}${o}`,n},{});function S0e(n){const e=n.toLowerCase().trim(),i=v0e[E0e(e)];if(!i)throw new Vw(n);return`#${i}`}const SC=(n,e)=>Array.from(Array(e)).map(()=>n).join(""),b0e=new RegExp(`^#${SC("([a-f0-9])",3)}([a-f0-9])?$`,"i"),T0e=new RegExp(`^#${SC("([a-f0-9]{2})",3)}([a-f0-9]{2})?$`,"i"),w0e=new RegExp(`^rgba?\\(\\s*(\\d+)\\s*${SC(",\\s*(\\d+)\\s*",2)}(?:,\\s*([\\d.]+))?\\s*\\)$`,"i"),C0e=/^hsla?\(\s*([\d.]+)\s*,\s*([\d.]+)%\s*,\s*([\d.]+)%(?:\s*,\s*([\d.]+))?\s*\)$/i,R0e=/^[a-z]+$/i,ZK=n=>Math.round(n*255),I0e=(n,e,i)=>{let o=i/100;if(e===0)return[o,o,o].map(ZK);const l=(n%360+360)%360/60,d=(1-Math.abs(2*o-1))*(e/100),p=d*(1-Math.abs(l%2-1));let _=0,E=0,b=0;l>=0&&l<1?(_=d,E=p):l>=1&&l<2?(_=p,E=d):l>=2&&l<3?(E=d,b=p):l>=3&&l<4?(E=p,b=d):l>=4&&l<5?(_=p,b=d):l>=5&&l<6&&(_=d,b=p);const C=o-d/2,I=_+C,O=E+C,L=b+C;return[I,O,L].map(ZK)};function A0e(n,e,i,o){return`rgba(${by(0,255,n).toFixed()}, ${by(0,255,e).toFixed()}, ${by(0,255,i).toFixed()}, ${parseFloat(by(0,1,o).toFixed(3))})`}function P0e(n,e){const[i,o,l,d]=MF(n);return A0e(i,o,l,d-e)}function O0e(n){const[e,i,o,l]=MF(n);let d=p=>{const _=by(0,255,p).toString(16);return _.length===1?`0${_}`:_};return`#${d(e)}${d(i)}${d(o)}${l<1?d(Math.round(l*255)):""}`}const k0e=n=>Object.keys(n).length===0;function N0e(n,e,i,o,l){for(e=e.split?e.split("."):e,o=0;o<e.length;o++)n=n?n[e[o]]:l;return n===l?i:n}const bc=(n,e,i)=>{const o=N0e(n,`colors.${e}`,e);try{return O0e(o),o}catch{return i??"#000000"}},D0e=n=>{const[e,i,o]=MF(n);return(e*299+i*587+o*114)/1e3},x0e=n=>e=>{const i=bc(e,n);return D0e(i)<128?"dark":"light"},L0e=n=>e=>x0e(n)(e)==="dark",h0=(n,e)=>i=>{const o=bc(i,n);return P0e(o,1-e)};function eq(n="1rem",e="rgba(255, 255, 255, 0.15)"){return{backgroundImage:`linear-gradient(
    45deg,
    ${e} 25%,
    transparent 25%,
    transparent 50%,
    ${e} 50%,
    ${e} 75%,
    transparent 75%,
    transparent
  )`,backgroundSize:`${n} ${n}`}}const M0e=()=>`#${Math.floor(Math.random()*16777215).toString(16).padEnd(6,"0")}`;function U0e(n){const e=M0e();return!n||k0e(n)?e:n.string&&n.colors?F0e(n.string,n.colors):n.string&&!n.colors?V0e(n.string):n.colors&&!n.string?j0e(n.colors):e}function V0e(n){let e=0;if(n.length===0)return e.toString();for(let o=0;o<n.length;o+=1)e=n.charCodeAt(o)+((e<<5)-e),e=e&e;let i="#";for(let o=0;o<3;o+=1){const l=e>>o*8&255;i+=`00${l.toString(16)}`.substr(-2)}return i}function F0e(n,e){let i=0;if(n.length===0)return e[0];for(let o=0;o<n.length;o+=1)i=n.charCodeAt(o)+((i<<5)-i),i=i&i;return i=(i%e.length+e.length)%e.length,e[i]}function j0e(n){return n[Math.floor(Math.random()*n.length)]}function Ln(n,e){return i=>i.colorMode==="dark"?e:n}function UF(n){const{orientation:e,vertical:i,horizontal:o}=n;return e?e==="vertical"?i:o:{}}function HZ(n){return Du(n)&&n.reference?n.reference:String(n)}const O1=(n,...e)=>e.map(HZ).join(` ${n} `).replace(/calc/g,""),tq=(...n)=>`calc(${O1("+",...n)})`,nq=(...n)=>`calc(${O1("-",...n)})`,JU=(...n)=>`calc(${O1("*",...n)})`,rq=(...n)=>`calc(${O1("/",...n)})`,iq=n=>{const e=HZ(n);return e!=null&&!Number.isNaN(parseFloat(e))?String(e).startsWith("-")?String(e).slice(1):`-${e}`:JU(e,-1)},bp=Object.assign(n=>({add:(...e)=>bp(tq(n,...e)),subtract:(...e)=>bp(nq(n,...e)),multiply:(...e)=>bp(JU(n,...e)),divide:(...e)=>bp(rq(n,...e)),negate:()=>bp(iq(n)),toString:()=>n.toString()}),{add:tq,subtract:nq,multiply:JU,divide:rq,negate:iq});function B0e(n){return!Number.isInteger(parseFloat(n.toString()))}function W0e(n,e="-"){return n.replace(/\s+/g,e)}function $Z(n){const e=W0e(n.toString());return e.includes("\\.")?n:B0e(n)?e.replace(".","\\."):n}function z0e(n,e=""){return[e,$Z(n)].filter(Boolean).join("-")}function G0e(n,e){return`var(${$Z(n)}${e?`, ${e}`:""})`}function H0e(n,e=""){return`--${z0e(n,e)}`}function Ro(n,e){const i=H0e(n,e==null?void 0:e.prefix);return{variable:i,reference:G0e(i,$0e(e==null?void 0:e.fallback))}}function $0e(n){return n==null?void 0:n.reference}const{definePartsStyle:QC,defineMultiStyleConfig:K0e}=Gi(jSe.keys),Fl=Mn("alert-fg"),jp=Mn("alert-bg"),q0e=QC({container:{bg:jp.reference,px:"4",py:"3"},title:{fontWeight:"bold",lineHeight:"6",marginEnd:"2"},description:{lineHeight:"6"},icon:{color:Fl.reference,flexShrink:0,marginEnd:"3",w:"5",h:"6"},spinner:{color:Fl.reference,flexShrink:0,marginEnd:"3",w:"5",h:"5"}});function VF(n){const{theme:e,colorScheme:i}=n,o=h0(`${i}.200`,.16)(e);return{light:`colors.${i}.100`,dark:o}}const Y0e=QC(n=>{const{colorScheme:e}=n,i=VF(n);return{container:{[Fl.variable]:`colors.${e}.600`,[jp.variable]:i.light,_dark:{[Fl.variable]:`colors.${e}.200`,[jp.variable]:i.dark}}}}),X0e=QC(n=>{const{colorScheme:e}=n,i=VF(n);return{container:{[Fl.variable]:`colors.${e}.600`,[jp.variable]:i.light,_dark:{[Fl.variable]:`colors.${e}.200`,[jp.variable]:i.dark},paddingStart:"3",borderStartWidth:"4px",borderStartColor:Fl.reference}}}),J0e=QC(n=>{const{colorScheme:e}=n,i=VF(n);return{container:{[Fl.variable]:`colors.${e}.600`,[jp.variable]:i.light,_dark:{[Fl.variable]:`colors.${e}.200`,[jp.variable]:i.dark},pt:"2",borderTopWidth:"4px",borderTopColor:Fl.reference}}}),Q0e=QC(n=>{const{colorScheme:e}=n;return{container:{[Fl.variable]:"colors.white",[jp.variable]:`colors.${e}.600`,_dark:{[Fl.variable]:"colors.gray.900",[jp.variable]:`colors.${e}.200`},color:Fl.reference}}}),Z0e={subtle:Y0e,"left-accent":X0e,"top-accent":J0e,solid:Q0e},ebe=K0e({baseStyle:q0e,variants:Z0e,defaultProps:{variant:"subtle",colorScheme:"blue"}}),KZ={px:"1px",.5:"0.125rem",1:"0.25rem",1.5:"0.375rem",2:"0.5rem",2.5:"0.625rem",3:"0.75rem",3.5:"0.875rem",4:"1rem",5:"1.25rem",6:"1.5rem",7:"1.75rem",8:"2rem",9:"2.25rem",10:"2.5rem",12:"3rem",14:"3.5rem",16:"4rem",20:"5rem",24:"6rem",28:"7rem",32:"8rem",36:"9rem",40:"10rem",44:"11rem",48:"12rem",52:"13rem",56:"14rem",60:"15rem",64:"16rem",72:"18rem",80:"20rem",96:"24rem"},tbe={max:"max-content",min:"min-content",full:"100%","3xs":"14rem","2xs":"16rem",xs:"20rem",sm:"24rem",md:"28rem",lg:"32rem",xl:"36rem","2xl":"42rem","3xl":"48rem","4xl":"56rem","5xl":"64rem","6xl":"72rem","7xl":"80rem","8xl":"90rem",prose:"60ch"},nbe={sm:"640px",md:"768px",lg:"1024px",xl:"1280px"},qZ={...KZ,...tbe,container:nbe},rbe=n=>typeof n=="function";function Tc(n,...e){return rbe(n)?n(...e):n}const{definePartsStyle:YZ,defineMultiStyleConfig:ibe}=Gi(BSe.keys),QS=Mn("avatar-border-color"),tC=Mn("avatar-bg"),bC=Mn("avatar-font-size"),f0=Mn("avatar-size"),sbe={borderRadius:"full",border:"0.2em solid",borderColor:QS.reference,[QS.variable]:"white",_dark:{[QS.variable]:"colors.gray.800"}},obe={bg:tC.reference,fontSize:bC.reference,width:f0.reference,height:f0.reference,lineHeight:"1",[tC.variable]:"colors.gray.200",_dark:{[tC.variable]:"colors.whiteAlpha.400"}},abe=n=>{const{name:e,theme:i}=n,o=e?U0e({string:e}):"colors.gray.400",l=L0e(o)(i);let d="white";return l||(d="gray.800"),{bg:tC.reference,fontSize:bC.reference,color:d,borderColor:QS.reference,verticalAlign:"top",width:f0.reference,height:f0.reference,"&:not([data-loaded])":{[tC.variable]:o},[QS.variable]:"colors.white",_dark:{[QS.variable]:"colors.gray.800"}}},cbe={fontSize:bC.reference,lineHeight:"1"},lbe=YZ(n=>({badge:Tc(sbe,n),excessLabel:Tc(obe,n),container:Tc(abe,n),label:cbe}));function og(n){const e=n!=="100%"?qZ[n]:void 0;return YZ({container:{[f0.variable]:e??n,[bC.variable]:`calc(${e??n} / 2.5)`},excessLabel:{[f0.variable]:e??n,[bC.variable]:`calc(${e??n} / 2.5)`}})}const ube={"2xs":og(4),xs:og(6),sm:og(8),md:og(12),lg:og(16),xl:og(24),"2xl":og(32),full:og("100%")},dbe=ibe({baseStyle:lbe,sizes:ube,defaultProps:{size:"md"}}),qs=kSe("badge",["bg","color","shadow"]),hbe={px:1,textTransform:"uppercase",fontSize:"xs",borderRadius:"sm",fontWeight:"bold",bg:qs.bg.reference,color:qs.color.reference,boxShadow:qs.shadow.reference},fbe=n=>{const{colorScheme:e,theme:i}=n,o=h0(`${e}.500`,.6)(i);return{[qs.bg.variable]:`colors.${e}.500`,[qs.color.variable]:"colors.white",_dark:{[qs.bg.variable]:o,[qs.color.variable]:"colors.whiteAlpha.800"}}},pbe=n=>{const{colorScheme:e,theme:i}=n,o=h0(`${e}.200`,.16)(i);return{[qs.bg.variable]:`colors.${e}.100`,[qs.color.variable]:`colors.${e}.800`,_dark:{[qs.bg.variable]:o,[qs.color.variable]:`colors.${e}.200`}}},mbe=n=>{const{colorScheme:e,theme:i}=n,o=h0(`${e}.200`,.8)(i);return{[qs.color.variable]:`colors.${e}.500`,_dark:{[qs.color.variable]:o},[qs.shadow.variable]:`inset 0 0 0px 1px ${qs.color.reference}`}},gbe={solid:fbe,subtle:pbe,outline:mbe},nC={baseStyle:hbe,variants:gbe,defaultProps:{variant:"subtle",colorScheme:"gray"}},{defineMultiStyleConfig:_be,definePartsStyle:ybe}=Gi(WSe.keys),wM=Mn("breadcrumb-link-decor"),Ebe={transitionProperty:"common",transitionDuration:"fast",transitionTimingFunction:"ease-out",outline:"none",color:"inherit",textDecoration:wM.reference,[wM.variable]:"none","&:not([aria-current=page])":{cursor:"pointer",_hover:{[wM.variable]:"underline"},_focusVisible:{boxShadow:"outline"}}},vbe=ybe({link:Ebe}),Sbe=_be({baseStyle:vbe}),bbe={lineHeight:"1.2",borderRadius:"md",fontWeight:"semibold",transitionProperty:"common",transitionDuration:"normal",_focusVisible:{boxShadow:"outline"},_disabled:{opacity:.4,cursor:"not-allowed",boxShadow:"none"},_hover:{_disabled:{bg:"initial"}}},XZ=n=>{const{colorScheme:e,theme:i}=n;if(e==="gray")return{color:Ln("gray.800","whiteAlpha.900")(n),_hover:{bg:Ln("gray.100","whiteAlpha.200")(n)},_active:{bg:Ln("gray.200","whiteAlpha.300")(n)}};const o=h0(`${e}.200`,.12)(i),l=h0(`${e}.200`,.24)(i);return{color:Ln(`${e}.600`,`${e}.200`)(n),bg:"transparent",_hover:{bg:Ln(`${e}.50`,o)(n)},_active:{bg:Ln(`${e}.100`,l)(n)}}},Tbe=n=>{const{colorScheme:e}=n,i=Ln("gray.200","whiteAlpha.300")(n);return{border:"1px solid",borderColor:e==="gray"?i:"currentColor",".chakra-button__group[data-attached][data-orientation=horizontal] > &:not(:last-of-type)":{marginEnd:"-1px"},".chakra-button__group[data-attached][data-orientation=vertical] > &:not(:last-of-type)":{marginBottom:"-1px"},...Tc(XZ,n)}},wbe={yellow:{bg:"yellow.400",color:"black",hoverBg:"yellow.500",activeBg:"yellow.600"},cyan:{bg:"cyan.400",color:"black",hoverBg:"cyan.500",activeBg:"cyan.600"}},Cbe=n=>{const{colorScheme:e}=n;if(e==="gray"){const _=Ln("gray.100","whiteAlpha.200")(n);return{bg:_,color:Ln("gray.800","whiteAlpha.900")(n),_hover:{bg:Ln("gray.200","whiteAlpha.300")(n),_disabled:{bg:_}},_active:{bg:Ln("gray.300","whiteAlpha.400")(n)}}}const{bg:i=`${e}.500`,color:o="white",hoverBg:l=`${e}.600`,activeBg:d=`${e}.700`}=wbe[e]??{},p=Ln(i,`${e}.200`)(n);return{bg:p,color:Ln(o,"gray.800")(n),_hover:{bg:Ln(l,`${e}.300`)(n),_disabled:{bg:p}},_active:{bg:Ln(d,`${e}.400`)(n)}}},Rbe=n=>{const{colorScheme:e}=n;return{padding:0,height:"auto",lineHeight:"normal",verticalAlign:"baseline",color:Ln(`${e}.500`,`${e}.200`)(n),_hover:{textDecoration:"underline",_disabled:{textDecoration:"none"}},_active:{color:Ln(`${e}.700`,`${e}.500`)(n)}}},Ibe={bg:"none",color:"inherit",display:"inline",lineHeight:"inherit",m:"0",p:"0"},Abe={ghost:XZ,outline:Tbe,solid:Cbe,link:Rbe,unstyled:Ibe},Pbe={lg:{h:"12",minW:"12",fontSize:"lg",px:"6"},md:{h:"10",minW:"10",fontSize:"md",px:"4"},sm:{h:"8",minW:"8",fontSize:"sm",px:"3"},xs:{h:"6",minW:"6",fontSize:"xs",px:"2"}},Obe={baseStyle:bbe,variants:Abe,sizes:Pbe,defaultProps:{variant:"solid",size:"md",colorScheme:"gray"}},{definePartsStyle:Iy,defineMultiStyleConfig:kbe}=Gi(l0e.keys),Mk=Mn("card-bg"),Dp=Mn("card-padding"),JZ=Mn("card-shadow"),JO=Mn("card-radius"),QZ=Mn("card-border-width","0"),ZZ=Mn("card-border-color"),Nbe=Iy({container:{[Mk.variable]:"colors.chakra-body-bg",backgroundColor:Mk.reference,boxShadow:JZ.reference,borderRadius:JO.reference,color:"chakra-body-text",borderWidth:QZ.reference,borderColor:ZZ.reference},body:{padding:Dp.reference,flex:"1 1 0%"},header:{padding:Dp.reference},footer:{padding:Dp.reference}}),Dbe={sm:Iy({container:{[JO.variable]:"radii.base",[Dp.variable]:"space.3"}}),md:Iy({container:{[JO.variable]:"radii.md",[Dp.variable]:"space.5"}}),lg:Iy({container:{[JO.variable]:"radii.xl",[Dp.variable]:"space.7"}})},xbe={elevated:Iy({container:{[JZ.variable]:"shadows.base",_dark:{[Mk.variable]:"colors.gray.700"}}}),outline:Iy({container:{[QZ.variable]:"1px",[ZZ.variable]:"colors.chakra-border-color"}}),filled:Iy({container:{[Mk.variable]:"colors.chakra-subtle-bg"}}),unstyled:{body:{[Dp.variable]:0},header:{[Dp.variable]:0},footer:{[Dp.variable]:0}}},Lbe=kbe({baseStyle:Nbe,variants:xbe,sizes:Dbe,defaultProps:{variant:"elevated",size:"md"}}),{definePartsStyle:QO,defineMultiStyleConfig:Mbe}=Gi(zSe.keys),rC=Mn("checkbox-size"),Ube=n=>{const{colorScheme:e}=n;return{w:rC.reference,h:rC.reference,transitionProperty:"box-shadow",transitionDuration:"normal",border:"2px solid",borderRadius:"sm",borderColor:"inherit",color:"white",_checked:{bg:Ln(`${e}.500`,`${e}.200`)(n),borderColor:Ln(`${e}.500`,`${e}.200`)(n),color:Ln("white","gray.900")(n),_hover:{bg:Ln(`${e}.600`,`${e}.300`)(n),borderColor:Ln(`${e}.600`,`${e}.300`)(n)},_disabled:{borderColor:Ln("gray.200","transparent")(n),bg:Ln("gray.200","whiteAlpha.300")(n),color:Ln("gray.500","whiteAlpha.500")(n)}},_indeterminate:{bg:Ln(`${e}.500`,`${e}.200`)(n),borderColor:Ln(`${e}.500`,`${e}.200`)(n),color:Ln("white","gray.900")(n)},_disabled:{bg:Ln("gray.100","whiteAlpha.100")(n),borderColor:Ln("gray.100","transparent")(n)},_focusVisible:{boxShadow:"outline"},_invalid:{borderColor:Ln("red.500","red.300")(n)}}},Vbe={_disabled:{cursor:"not-allowed"}},Fbe={userSelect:"none",_disabled:{opacity:.4}},jbe={transitionProperty:"transform",transitionDuration:"normal"},Bbe=QO(n=>({icon:jbe,container:Vbe,control:Tc(Ube,n),label:Fbe})),Wbe={sm:QO({control:{[rC.variable]:"sizes.3"},label:{fontSize:"sm"},icon:{fontSize:"3xs"}}),md:QO({control:{[rC.variable]:"sizes.4"},label:{fontSize:"md"},icon:{fontSize:"2xs"}}),lg:QO({control:{[rC.variable]:"sizes.5"},label:{fontSize:"lg"},icon:{fontSize:"2xs"}})},hg=Mbe({baseStyle:Bbe,sizes:Wbe,defaultProps:{size:"md",colorScheme:"blue"}}),iC=Ro("close-button-size"),mw=Ro("close-button-bg"),zbe={w:[iC.reference],h:[iC.reference],borderRadius:"md",transitionProperty:"common",transitionDuration:"normal",_disabled:{opacity:.4,cursor:"not-allowed",boxShadow:"none"},_hover:{[mw.variable]:"colors.blackAlpha.100",_dark:{[mw.variable]:"colors.whiteAlpha.100"}},_active:{[mw.variable]:"colors.blackAlpha.200",_dark:{[mw.variable]:"colors.whiteAlpha.200"}},_focusVisible:{boxShadow:"outline"},bg:mw.reference},Gbe={lg:{[iC.variable]:"sizes.10",fontSize:"md"},md:{[iC.variable]:"sizes.8",fontSize:"xs"},sm:{[iC.variable]:"sizes.6",fontSize:"2xs"}},Hbe={baseStyle:zbe,sizes:Gbe,defaultProps:{size:"md"}},{variants:$be,defaultProps:Kbe}=nC,qbe={fontFamily:"mono",fontSize:"sm",px:"0.2em",borderRadius:"sm",bg:qs.bg.reference,color:qs.color.reference,boxShadow:qs.shadow.reference},Ybe={baseStyle:qbe,variants:$be,defaultProps:Kbe},Xbe={w:"100%",mx:"auto",maxW:"prose",px:"4"},Jbe={baseStyle:Xbe},Qbe={opacity:.6,borderColor:"inherit"},Zbe={borderStyle:"solid"},eTe={borderStyle:"dashed"},tTe={solid:Zbe,dashed:eTe},nTe={baseStyle:Qbe,variants:tTe,defaultProps:{variant:"solid"}},{definePartsStyle:QU,defineMultiStyleConfig:rTe}=Gi(GSe.keys),CM=Mn("drawer-bg"),RM=Mn("drawer-box-shadow");function SS(n){return QU(n==="full"?{dialog:{maxW:"100vw",h:"100vh"}}:{dialog:{maxW:n}})}const iTe={bg:"blackAlpha.600",zIndex:"modal"},sTe={display:"flex",zIndex:"modal",justifyContent:"center"},oTe=n=>{const{isFullHeight:e}=n;return{...e&&{height:"100vh"},zIndex:"modal",maxH:"100vh",color:"inherit",[CM.variable]:"colors.white",[RM.variable]:"shadows.lg",_dark:{[CM.variable]:"colors.gray.700",[RM.variable]:"shadows.dark-lg"},bg:CM.reference,boxShadow:RM.reference}},aTe={px:"6",py:"4",fontSize:"xl",fontWeight:"semibold"},cTe={position:"absolute",top:"2",insetEnd:"3"},lTe={px:"6",py:"2",flex:"1",overflow:"auto"},uTe={px:"6",py:"4"},dTe=QU(n=>({overlay:iTe,dialogContainer:sTe,dialog:Tc(oTe,n),header:aTe,closeButton:cTe,body:lTe,footer:uTe})),hTe={xs:SS("xs"),sm:SS("md"),md:SS("lg"),lg:SS("2xl"),xl:SS("4xl"),full:SS("full")},fTe=rTe({baseStyle:dTe,sizes:hTe,defaultProps:{size:"xs"}}),{definePartsStyle:pTe,defineMultiStyleConfig:mTe}=Gi(HSe.keys),gTe={borderRadius:"md",py:"1",transitionProperty:"common",transitionDuration:"normal"},_Te={borderRadius:"md",py:"1",transitionProperty:"common",transitionDuration:"normal",width:"full",_focusVisible:{boxShadow:"outline"},_placeholder:{opacity:.6}},yTe={borderRadius:"md",py:"1",transitionProperty:"common",transitionDuration:"normal",width:"full",_focusVisible:{boxShadow:"outline"},_placeholder:{opacity:.6}},ETe=pTe({preview:gTe,input:_Te,textarea:yTe}),vTe=mTe({baseStyle:ETe}),{definePartsStyle:STe,defineMultiStyleConfig:bTe}=Gi($Se.keys),ZS=Mn("form-control-color"),TTe={marginStart:"1",[ZS.variable]:"colors.red.500",_dark:{[ZS.variable]:"colors.red.300"},color:ZS.reference},wTe={mt:"2",[ZS.variable]:"colors.gray.600",_dark:{[ZS.variable]:"colors.whiteAlpha.600"},color:ZS.reference,lineHeight:"normal",fontSize:"sm"},CTe=STe({container:{width:"100%",position:"relative"},requiredIndicator:TTe,helperText:wTe}),RTe=bTe({baseStyle:CTe}),{definePartsStyle:ITe,defineMultiStyleConfig:ATe}=Gi(KSe.keys),e0=Mn("form-error-color"),PTe={[e0.variable]:"colors.red.500",_dark:{[e0.variable]:"colors.red.300"},color:e0.reference,mt:"2",fontSize:"sm",lineHeight:"normal"},OTe={marginEnd:"0.5em",[e0.variable]:"colors.red.500",_dark:{[e0.variable]:"colors.red.300"},color:e0.reference},kTe=ITe({text:PTe,icon:OTe}),NTe=ATe({baseStyle:kTe}),DTe={fontSize:"md",marginEnd:"3",mb:"2",fontWeight:"medium",transitionProperty:"common",transitionDuration:"normal",opacity:1,_disabled:{opacity:.4}},xTe={baseStyle:DTe},LTe={fontFamily:"heading",fontWeight:"bold"},MTe={"4xl":{fontSize:["6xl",null,"7xl"],lineHeight:1},"3xl":{fontSize:["5xl",null,"6xl"],lineHeight:1},"2xl":{fontSize:["4xl",null,"5xl"],lineHeight:[1.2,null,1]},xl:{fontSize:["3xl",null,"4xl"],lineHeight:[1.33,null,1.2]},lg:{fontSize:["2xl",null,"3xl"],lineHeight:[1.33,null,1.2]},md:{fontSize:"xl",lineHeight:1.2},sm:{fontSize:"md",lineHeight:1.2},xs:{fontSize:"sm",lineHeight:1.2}},UTe={baseStyle:LTe,sizes:MTe,defaultProps:{size:"xl"}},{definePartsStyle:wp,defineMultiStyleConfig:VTe}=Gi(qSe.keys),LS=Mn("input-height"),MS=Mn("input-font-size"),US=Mn("input-padding"),VS=Mn("input-border-radius"),FTe=wp({addon:{height:LS.reference,fontSize:MS.reference,px:US.reference,borderRadius:VS.reference},field:{width:"100%",height:LS.reference,fontSize:MS.reference,px:US.reference,borderRadius:VS.reference,minWidth:0,outline:0,position:"relative",appearance:"none",transitionProperty:"common",transitionDuration:"normal",_disabled:{opacity:.4,cursor:"not-allowed"}}}),ag={lg:{[MS.variable]:"fontSizes.lg",[US.variable]:"space.4",[VS.variable]:"radii.md",[LS.variable]:"sizes.12"},md:{[MS.variable]:"fontSizes.md",[US.variable]:"space.4",[VS.variable]:"radii.md",[LS.variable]:"sizes.10"},sm:{[MS.variable]:"fontSizes.sm",[US.variable]:"space.3",[VS.variable]:"radii.sm",[LS.variable]:"sizes.8"},xs:{[MS.variable]:"fontSizes.xs",[US.variable]:"space.2",[VS.variable]:"radii.sm",[LS.variable]:"sizes.6"}},jTe={lg:wp({field:ag.lg,group:ag.lg}),md:wp({field:ag.md,group:ag.md}),sm:wp({field:ag.sm,group:ag.sm}),xs:wp({field:ag.xs,group:ag.xs})};function FF(n){const{focusBorderColor:e,errorBorderColor:i}=n;return{focusBorderColor:e||Ln("blue.500","blue.300")(n),errorBorderColor:i||Ln("red.500","red.300")(n)}}const BTe=wp(n=>{const{theme:e}=n,{focusBorderColor:i,errorBorderColor:o}=FF(n);return{field:{border:"1px solid",borderColor:"inherit",bg:"inherit",_hover:{borderColor:Ln("gray.300","whiteAlpha.400")(n)},_readOnly:{boxShadow:"none !important",userSelect:"all"},_invalid:{borderColor:bc(e,o),boxShadow:`0 0 0 1px ${bc(e,o)}`},_focusVisible:{zIndex:1,borderColor:bc(e,i),boxShadow:`0 0 0 1px ${bc(e,i)}`}},addon:{border:"1px solid",borderColor:Ln("inherit","whiteAlpha.50")(n),bg:Ln("gray.100","whiteAlpha.300")(n)}}}),WTe=wp(n=>{const{theme:e}=n,{focusBorderColor:i,errorBorderColor:o}=FF(n);return{field:{border:"2px solid",borderColor:"transparent",bg:Ln("gray.100","whiteAlpha.50")(n),_hover:{bg:Ln("gray.200","whiteAlpha.100")(n)},_readOnly:{boxShadow:"none !important",userSelect:"all"},_invalid:{borderColor:bc(e,o)},_focusVisible:{bg:"transparent",borderColor:bc(e,i)}},addon:{border:"2px solid",borderColor:"transparent",bg:Ln("gray.100","whiteAlpha.50")(n)}}}),zTe=wp(n=>{const{theme:e}=n,{focusBorderColor:i,errorBorderColor:o}=FF(n);return{field:{borderBottom:"1px solid",borderColor:"inherit",borderRadius:"0",px:"0",bg:"transparent",_readOnly:{boxShadow:"none !important",userSelect:"all"},_invalid:{borderColor:bc(e,o),boxShadow:`0px 1px 0px 0px ${bc(e,o)}`},_focusVisible:{borderColor:bc(e,i),boxShadow:`0px 1px 0px 0px ${bc(e,i)}`}},addon:{borderBottom:"2px solid",borderColor:"inherit",borderRadius:"0",px:"0",bg:"transparent"}}}),GTe=wp({field:{bg:"transparent",px:"0",height:"auto"},addon:{bg:"transparent",px:"0",height:"auto"}}),HTe={outline:BTe,filled:WTe,flushed:zTe,unstyled:GTe},si=VTe({baseStyle:FTe,sizes:jTe,variants:HTe,defaultProps:{size:"md",variant:"outline"}}),IM=Mn("kbd-bg"),$Te={[IM.variable]:"colors.gray.100",_dark:{[IM.variable]:"colors.whiteAlpha.100"},bg:IM.reference,borderRadius:"md",borderWidth:"1px",borderBottomWidth:"3px",fontSize:"0.8em",fontWeight:"bold",lineHeight:"normal",px:"0.4em",whiteSpace:"nowrap"},KTe={baseStyle:$Te},qTe={transitionProperty:"common",transitionDuration:"fast",transitionTimingFunction:"ease-out",cursor:"pointer",textDecoration:"none",outline:"none",color:"inherit",_hover:{textDecoration:"underline"},_focusVisible:{boxShadow:"outline"}},YTe={baseStyle:qTe},{defineMultiStyleConfig:XTe,definePartsStyle:JTe}=Gi(YSe.keys),QTe={marginEnd:"2",display:"inline",verticalAlign:"text-bottom"},ZTe=JTe({icon:QTe}),ewe=XTe({baseStyle:ZTe}),{defineMultiStyleConfig:twe,definePartsStyle:nwe}=Gi(XSe.keys),Fh=Mn("menu-bg"),AM=Mn("menu-shadow"),rwe={[Fh.variable]:"#fff",[AM.variable]:"shadows.sm",_dark:{[Fh.variable]:"colors.gray.700",[AM.variable]:"shadows.dark-lg"},color:"inherit",minW:"3xs",py:"2",zIndex:"dropdown",borderRadius:"md",borderWidth:"1px",bg:Fh.reference,boxShadow:AM.reference},iwe={py:"1.5",px:"3",transitionProperty:"background",transitionDuration:"ultra-fast",transitionTimingFunction:"ease-in",_focus:{[Fh.variable]:"colors.gray.100",_dark:{[Fh.variable]:"colors.whiteAlpha.100"}},_active:{[Fh.variable]:"colors.gray.200",_dark:{[Fh.variable]:"colors.whiteAlpha.200"}},_expanded:{[Fh.variable]:"colors.gray.100",_dark:{[Fh.variable]:"colors.whiteAlpha.100"}},_disabled:{opacity:.4,cursor:"not-allowed"},bg:Fh.reference},swe={mx:4,my:2,fontWeight:"semibold",fontSize:"sm"},owe={display:"inline-flex",alignItems:"center",justifyContent:"center",flexShrink:0},awe={opacity:.6},cwe={border:0,borderBottom:"1px solid",borderColor:"inherit",my:"2",opacity:.6},lwe={transitionProperty:"common",transitionDuration:"normal"},uwe=nwe({button:lwe,list:rwe,item:iwe,groupTitle:swe,icon:owe,command:awe,divider:cwe}),dwe=twe({baseStyle:uwe}),{defineMultiStyleConfig:hwe,definePartsStyle:ZU}=Gi(JSe.keys),PM=Mn("modal-bg"),OM=Mn("modal-shadow"),fwe={bg:"blackAlpha.600",zIndex:"modal"},pwe=n=>{const{isCentered:e,scrollBehavior:i}=n;return{display:"flex",zIndex:"modal",justifyContent:"center",alignItems:e?"center":"flex-start",overflow:i==="inside"?"hidden":"auto",overscrollBehaviorY:"none"}},mwe=n=>{const{isCentered:e,scrollBehavior:i}=n;return{borderRadius:"md",color:"inherit",my:e?"auto":"16",mx:e?"auto":void 0,zIndex:"modal",maxH:i==="inside"?"calc(100% - 7.5rem)":void 0,[PM.variable]:"colors.white",[OM.variable]:"shadows.lg",_dark:{[PM.variable]:"colors.gray.700",[OM.variable]:"shadows.dark-lg"},bg:PM.reference,boxShadow:OM.reference}},gwe={px:"6",py:"4",fontSize:"xl",fontWeight:"semibold"},_we={position:"absolute",top:"2",insetEnd:"3"},ywe=n=>{const{scrollBehavior:e}=n;return{px:"6",py:"2",flex:"1",overflow:e==="inside"?"auto":void 0}},Ewe={px:"6",py:"4"},vwe=ZU(n=>({overlay:fwe,dialogContainer:Tc(pwe,n),dialog:Tc(mwe,n),header:gwe,closeButton:_we,body:Tc(ywe,n),footer:Ewe}));function Ad(n){return ZU(n==="full"?{dialog:{maxW:"100vw",minH:"$100vh",my:"0",borderRadius:"0"}}:{dialog:{maxW:n}})}const Swe={xs:Ad("xs"),sm:Ad("sm"),md:Ad("md"),lg:Ad("lg"),xl:Ad("xl"),"2xl":Ad("2xl"),"3xl":Ad("3xl"),"4xl":Ad("4xl"),"5xl":Ad("5xl"),"6xl":Ad("6xl"),full:Ad("full")},bwe=hwe({baseStyle:vwe,sizes:Swe,defaultProps:{size:"md"}}),eee={letterSpacings:{tighter:"-0.05em",tight:"-0.025em",normal:"0",wide:"0.025em",wider:"0.05em",widest:"0.1em"},lineHeights:{normal:"normal",none:1,shorter:1.25,short:1.375,base:1.5,tall:1.625,taller:"2",3:".75rem",4:"1rem",5:"1.25rem",6:"1.5rem",7:"1.75rem",8:"2rem",9:"2.25rem",10:"2.5rem"},fontWeights:{hairline:100,thin:200,light:300,normal:400,medium:500,semibold:600,bold:700,extrabold:800,black:900},fonts:{heading:'-apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"',body:'-apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"',mono:'SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace'},fontSizes:{"3xs":"0.45rem","2xs":"0.625rem",xs:"0.75rem",sm:"0.875rem",md:"1rem",lg:"1.125rem",xl:"1.25rem","2xl":"1.5rem","3xl":"1.875rem","4xl":"2.25rem","5xl":"3rem","6xl":"3.75rem","7xl":"4.5rem","8xl":"6rem","9xl":"8rem"}},{defineMultiStyleConfig:Twe,definePartsStyle:tee}=Gi(QSe.keys),jF=Ro("number-input-stepper-width"),nee=Ro("number-input-input-padding"),wwe=bp(jF).add("0.5rem").toString(),kM=Ro("number-input-bg"),NM=Ro("number-input-color"),DM=Ro("number-input-border-color"),Cwe={[jF.variable]:"sizes.6",[nee.variable]:wwe},Rwe=n=>{var e;return((e=Tc(si.baseStyle,n))==null?void 0:e.field)??{}},Iwe={width:jF.reference},Awe={borderStart:"1px solid",borderStartColor:DM.reference,color:NM.reference,bg:kM.reference,[NM.variable]:"colors.chakra-body-text",[DM.variable]:"colors.chakra-border-color",_dark:{[NM.variable]:"colors.whiteAlpha.800",[DM.variable]:"colors.whiteAlpha.300"},_active:{[kM.variable]:"colors.gray.200",_dark:{[kM.variable]:"colors.whiteAlpha.300"}},_disabled:{opacity:.4,cursor:"not-allowed"}},Pwe=tee(n=>({root:Cwe,field:Tc(Rwe,n)??{},stepperGroup:Iwe,stepper:Awe}));function gO(n){var d,p;const e=(d=si.sizes)==null?void 0:d[n],i={lg:"md",md:"md",sm:"sm",xs:"sm"},o=((p=e.field)==null?void 0:p.fontSize)??"md",l=eee.fontSizes[o];return tee({field:{...e.field,paddingInlineEnd:nee.reference,verticalAlign:"top"},stepper:{fontSize:bp(l).multiply(.75).toString(),_first:{borderTopEndRadius:i[n]},_last:{borderBottomEndRadius:i[n],mt:"-1px",borderTopWidth:1}}})}const Owe={xs:gO("xs"),sm:gO("sm"),md:gO("md"),lg:gO("lg")},kwe=Twe({baseStyle:Pwe,sizes:Owe,variants:si.variants,defaultProps:si.defaultProps});var ZQ;const Nwe={...(ZQ=si.baseStyle)==null?void 0:ZQ.field,textAlign:"center"},Dwe={lg:{fontSize:"lg",w:12,h:12,borderRadius:"md"},md:{fontSize:"md",w:10,h:10,borderRadius:"md"},sm:{fontSize:"sm",w:8,h:8,borderRadius:"sm"},xs:{fontSize:"xs",w:6,h:6,borderRadius:"sm"}};var eZ;const xwe={outline:n=>{var e,i;return((i=Tc((e=si.variants)==null?void 0:e.outline,n))==null?void 0:i.field)??{}},flushed:n=>{var e,i;return((i=Tc((e=si.variants)==null?void 0:e.flushed,n))==null?void 0:i.field)??{}},filled:n=>{var e,i;return((i=Tc((e=si.variants)==null?void 0:e.filled,n))==null?void 0:i.field)??{}},unstyled:((eZ=si.variants)==null?void 0:eZ.unstyled.field)??{}},Lwe={baseStyle:Nwe,sizes:Dwe,variants:xwe,defaultProps:si.defaultProps},{defineMultiStyleConfig:Mwe,definePartsStyle:Uwe}=Gi(ZSe.keys),_O=Ro("popper-bg"),Vwe=Ro("popper-arrow-bg"),sq=Ro("popper-arrow-shadow-color"),Fwe={zIndex:"popover"},jwe={[_O.variable]:"colors.white",bg:_O.reference,[Vwe.variable]:_O.reference,[sq.variable]:"colors.gray.200",_dark:{[_O.variable]:"colors.gray.700",[sq.variable]:"colors.whiteAlpha.300"},width:"xs",border:"1px solid",borderColor:"inherit",borderRadius:"md",boxShadow:"sm",zIndex:"inherit",_focusVisible:{outline:0,boxShadow:"outline"}},Bwe={px:3,py:2,borderBottomWidth:"1px"},Wwe={px:3,py:2},zwe={px:3,py:2,borderTopWidth:"1px"},Gwe={position:"absolute",borderRadius:"md",top:1,insetEnd:2,padding:2},Hwe=Uwe({popper:Fwe,content:jwe,header:Bwe,body:Wwe,footer:zwe,closeButton:Gwe}),$we=Mwe({baseStyle:Hwe}),{defineMultiStyleConfig:Kwe,definePartsStyle:Fw}=Gi(e0e.keys),qwe=n=>{const{colorScheme:e,theme:i,isIndeterminate:o,hasStripe:l}=n,d=Ln(eq(),eq("1rem","rgba(0,0,0,0.1)"))(n),p=Ln(`${e}.500`,`${e}.200`)(n),_=`linear-gradient(
    to right,
    transparent 0%,
    ${bc(i,p)} 50%,
    transparent 100%
  )`;return{...!o&&l&&d,...o?{bgImage:_}:{bgColor:p}}},Ywe={lineHeight:"1",fontSize:"0.25em",fontWeight:"bold",color:"white"},Xwe=n=>({bg:Ln("gray.100","whiteAlpha.300")(n)}),Jwe=n=>({transitionProperty:"common",transitionDuration:"slow",...qwe(n)}),Qwe=Fw(n=>({label:Ywe,filledTrack:Jwe(n),track:Xwe(n)})),Zwe={xs:Fw({track:{h:"1"}}),sm:Fw({track:{h:"2"}}),md:Fw({track:{h:"3"}}),lg:Fw({track:{h:"4"}})},eCe=Kwe({sizes:Zwe,baseStyle:Qwe,defaultProps:{size:"md",colorScheme:"blue"}}),{defineMultiStyleConfig:tCe,definePartsStyle:ZO}=Gi(t0e.keys),nCe=n=>{var i;const e=(i=Tc(hg.baseStyle,n))==null?void 0:i.control;return{...e,borderRadius:"full",_checked:{...e==null?void 0:e._checked,_before:{content:'""',display:"inline-block",pos:"relative",w:"50%",h:"50%",borderRadius:"50%",bg:"currentColor"}}}},rCe=ZO(n=>{var e,i;return{label:(e=hg.baseStyle)==null?void 0:e.call(hg,n).label,container:(i=hg.baseStyle)==null?void 0:i.call(hg,n).container,control:nCe(n)}}),iCe={md:ZO({control:{w:"4",h:"4"},label:{fontSize:"md"}}),lg:ZO({control:{w:"5",h:"5"},label:{fontSize:"lg"}}),sm:ZO({control:{width:"3",height:"3"},label:{fontSize:"sm"}})},sCe=tCe({baseStyle:rCe,sizes:iCe,defaultProps:{size:"md",colorScheme:"blue"}}),{defineMultiStyleConfig:oCe,definePartsStyle:aCe}=Gi(n0e.keys),yO=Mn("select-bg");var tZ;const cCe={...(tZ=si.baseStyle)==null?void 0:tZ.field,appearance:"none",paddingBottom:"1px",lineHeight:"normal",bg:yO.reference,[yO.variable]:"colors.white",_dark:{[yO.variable]:"colors.gray.700"},"> option, > optgroup":{bg:yO.reference}},lCe={width:"6",height:"100%",insetEnd:"2",position:"relative",color:"currentColor",fontSize:"xl",_disabled:{opacity:.5}},uCe=aCe({field:cCe,icon:lCe}),EO={paddingInlineEnd:"8"};var nZ,rZ,iZ,sZ,oZ,aZ,cZ,lZ;const dCe={lg:{...(nZ=si.sizes)==null?void 0:nZ.lg,field:{...(rZ=si.sizes)==null?void 0:rZ.lg.field,...EO}},md:{...(iZ=si.sizes)==null?void 0:iZ.md,field:{...(sZ=si.sizes)==null?void 0:sZ.md.field,...EO}},sm:{...(oZ=si.sizes)==null?void 0:oZ.sm,field:{...(aZ=si.sizes)==null?void 0:aZ.sm.field,...EO}},xs:{...(cZ=si.sizes)==null?void 0:cZ.xs,field:{...(lZ=si.sizes)==null?void 0:lZ.xs.field,...EO},icon:{insetEnd:"1"}}},hCe=oCe({baseStyle:uCe,sizes:dCe,variants:si.variants,defaultProps:si.defaultProps}),xM=Mn("skeleton-start-color"),LM=Mn("skeleton-end-color"),fCe={[xM.variable]:"colors.gray.100",[LM.variable]:"colors.gray.400",_dark:{[xM.variable]:"colors.gray.800",[LM.variable]:"colors.gray.600"},background:xM.reference,borderColor:LM.reference,opacity:.7,borderRadius:"sm"},pCe={baseStyle:fCe},MM=Mn("skip-link-bg"),mCe={borderRadius:"md",fontWeight:"semibold",_focusVisible:{boxShadow:"outline",padding:"4",position:"fixed",top:"6",insetStart:"6",[MM.variable]:"colors.white",_dark:{[MM.variable]:"colors.gray.700"},bg:MM.reference}},gCe={baseStyle:mCe},{defineMultiStyleConfig:_Ce,definePartsStyle:k1}=Gi(r0e.keys),My=Mn("slider-thumb-size"),TC=Mn("slider-track-size"),fg=Mn("slider-bg"),yCe=n=>{const{orientation:e}=n;return{display:"inline-block",position:"relative",cursor:"pointer",_disabled:{opacity:.6,cursor:"default",pointerEvents:"none"},...UF({orientation:e,vertical:{h:"100%",px:Sp(My.reference).divide(2).toString()},horizontal:{w:"100%",py:Sp(My.reference).divide(2).toString()}})}},ECe=n=>({...UF({orientation:n.orientation,horizontal:{h:TC.reference},vertical:{w:TC.reference}}),overflow:"hidden",borderRadius:"sm",[fg.variable]:"colors.gray.200",_dark:{[fg.variable]:"colors.whiteAlpha.200"},_disabled:{[fg.variable]:"colors.gray.300",_dark:{[fg.variable]:"colors.whiteAlpha.300"}},bg:fg.reference}),vCe=n=>{const{orientation:e}=n;return{...UF({orientation:e,vertical:{left:"50%",transform:"translateX(-50%)",_active:{transform:"translateX(-50%) scale(1.15)"}},horizontal:{top:"50%",transform:"translateY(-50%)",_active:{transform:"translateY(-50%) scale(1.15)"}}}),w:My.reference,h:My.reference,display:"flex",alignItems:"center",justifyContent:"center",position:"absolute",outline:0,zIndex:1,borderRadius:"full",bg:"white",boxShadow:"base",border:"1px solid",borderColor:"transparent",transitionProperty:"transform",transitionDuration:"normal",_focusVisible:{boxShadow:"outline"},_disabled:{bg:"gray.300"}}},SCe=n=>{const{colorScheme:e}=n;return{width:"inherit",height:"inherit",[fg.variable]:`colors.${e}.500`,_dark:{[fg.variable]:`colors.${e}.200`},bg:fg.reference}},bCe=k1(n=>({container:yCe(n),track:ECe(n),thumb:vCe(n),filledTrack:SCe(n)})),TCe=k1({container:{[My.variable]:"sizes.4",[TC.variable]:"sizes.1"}}),wCe=k1({container:{[My.variable]:"sizes.3.5",[TC.variable]:"sizes.1"}}),CCe=k1({container:{[My.variable]:"sizes.2.5",[TC.variable]:"sizes.0.5"}}),RCe={lg:TCe,md:wCe,sm:CCe},ICe=_Ce({baseStyle:bCe,sizes:RCe,defaultProps:{size:"md",colorScheme:"blue"}}),Ey=Ro("spinner-size"),ACe={width:[Ey.reference],height:[Ey.reference]},PCe={xs:{[Ey.variable]:"sizes.3"},sm:{[Ey.variable]:"sizes.4"},md:{[Ey.variable]:"sizes.6"},lg:{[Ey.variable]:"sizes.8"},xl:{[Ey.variable]:"sizes.12"}},OCe={baseStyle:ACe,sizes:PCe,defaultProps:{size:"md"}},{defineMultiStyleConfig:kCe,definePartsStyle:ree}=Gi(i0e.keys),NCe={fontWeight:"medium"},DCe={opacity:.8,marginBottom:"2"},xCe={verticalAlign:"baseline",fontWeight:"semibold"},LCe={marginEnd:1,w:"3.5",h:"3.5",verticalAlign:"middle"},MCe=ree({container:{},label:NCe,helpText:DCe,number:xCe,icon:LCe}),UCe={md:ree({label:{fontSize:"sm"},helpText:{fontSize:"sm"},number:{fontSize:"2xl"}})},VCe=kCe({baseStyle:MCe,sizes:UCe,defaultProps:{size:"md"}}),{defineMultiStyleConfig:FCe,definePartsStyle:jw}=Gi(["stepper","step","title","description","indicator","separator","icon","number"]),Tp=Mn("stepper-indicator-size"),FS=Mn("stepper-icon-size"),jS=Mn("stepper-title-font-size"),Bw=Mn("stepper-description-font-size"),gw=Mn("stepper-accent-color"),jCe=jw(({colorScheme:n})=>({stepper:{display:"flex",justifyContent:"space-between",gap:"4","&[data-orientation=vertical]":{flexDirection:"column",alignItems:"flex-start"},"&[data-orientation=horizontal]":{flexDirection:"row",alignItems:"center"},[gw.variable]:`colors.${n}.500`,_dark:{[gw.variable]:`colors.${n}.200`}},title:{fontSize:jS.reference,fontWeight:"medium"},description:{fontSize:Bw.reference,color:"chakra-subtle-text"},number:{fontSize:jS.reference},step:{flexShrink:0,position:"relative",display:"flex",gap:"2","&[data-orientation=horizontal]":{alignItems:"center"},flex:"1","&:last-of-type:not([data-stretch])":{flex:"initial"}},icon:{flexShrink:0,width:FS.reference,height:FS.reference},indicator:{flexShrink:0,borderRadius:"full",width:Tp.reference,height:Tp.reference,display:"flex",justifyContent:"center",alignItems:"center","&[data-status=active]":{borderWidth:"2px",borderColor:gw.reference},"&[data-status=complete]":{bg:gw.reference,color:"chakra-inverse-text"},"&[data-status=incomplete]":{borderWidth:"2px"}},separator:{bg:"chakra-border-color",flex:"1","&[data-status=complete]":{bg:gw.reference},"&[data-orientation=horizontal]":{width:"100%",height:"2px",marginStart:"2"},"&[data-orientation=vertical]":{width:"2px",position:"absolute",height:"100%",maxHeight:`calc(100% - ${Tp.reference} - 8px)`,top:`calc(${Tp.reference} + 4px)`,insetStart:`calc(${Tp.reference} / 2 - 1px)`}}})),BCe=FCe({baseStyle:jCe,sizes:{xs:jw({stepper:{[Tp.variable]:"sizes.4",[FS.variable]:"sizes.3",[jS.variable]:"fontSizes.xs",[Bw.variable]:"fontSizes.xs"}}),sm:jw({stepper:{[Tp.variable]:"sizes.6",[FS.variable]:"sizes.4",[jS.variable]:"fontSizes.sm",[Bw.variable]:"fontSizes.xs"}}),md:jw({stepper:{[Tp.variable]:"sizes.8",[FS.variable]:"sizes.5",[jS.variable]:"fontSizes.md",[Bw.variable]:"fontSizes.sm"}}),lg:jw({stepper:{[Tp.variable]:"sizes.10",[FS.variable]:"sizes.6",[jS.variable]:"fontSizes.lg",[Bw.variable]:"fontSizes.md"}})},defaultProps:{size:"md",colorScheme:"blue"}}),{defineMultiStyleConfig:WCe,definePartsStyle:ek}=Gi(s0e.keys),sC=Ro("switch-track-width"),Ay=Ro("switch-track-height"),UM=Ro("switch-track-diff"),zCe=bp.subtract(sC,Ay),eV=Ro("switch-thumb-x"),_w=Ro("switch-bg"),GCe=n=>{const{colorScheme:e}=n;return{borderRadius:"full",p:"0.5",width:[sC.reference],height:[Ay.reference],transitionProperty:"common",transitionDuration:"fast",[_w.variable]:"colors.gray.300",_dark:{[_w.variable]:"colors.whiteAlpha.400"},_focusVisible:{boxShadow:"outline"},_disabled:{opacity:.4,cursor:"not-allowed"},_checked:{[_w.variable]:`colors.${e}.500`,_dark:{[_w.variable]:`colors.${e}.200`}},bg:_w.reference}},HCe={bg:"white",transitionProperty:"transform",transitionDuration:"normal",borderRadius:"inherit",width:[Ay.reference],height:[Ay.reference],_checked:{transform:`translateX(${eV.reference})`}},$Ce=ek(n=>({container:{[UM.variable]:zCe,[eV.variable]:UM.reference,_rtl:{[eV.variable]:bp(UM).negate().toString()}},track:GCe(n),thumb:HCe})),KCe={sm:ek({container:{[sC.variable]:"1.375rem",[Ay.variable]:"sizes.3"}}),md:ek({container:{[sC.variable]:"1.875rem",[Ay.variable]:"sizes.4"}}),lg:ek({container:{[sC.variable]:"2.875rem",[Ay.variable]:"sizes.6"}})},qCe=WCe({baseStyle:$Ce,sizes:KCe,defaultProps:{size:"md",colorScheme:"blue"}}),{defineMultiStyleConfig:YCe,definePartsStyle:t0}=Gi(o0e.keys),XCe=t0({table:{fontVariantNumeric:"lining-nums tabular-nums",borderCollapse:"collapse",width:"full"},th:{fontFamily:"heading",fontWeight:"bold",textTransform:"uppercase",letterSpacing:"wider",textAlign:"start"},td:{textAlign:"start"},caption:{mt:4,fontFamily:"heading",textAlign:"center",fontWeight:"medium"}}),Uk={"&[data-is-numeric=true]":{textAlign:"end"}},JCe=t0(n=>{const{colorScheme:e}=n;return{th:{color:Ln("gray.600","gray.400")(n),borderBottom:"1px",borderColor:Ln(`${e}.100`,`${e}.700`)(n),...Uk},td:{borderBottom:"1px",borderColor:Ln(`${e}.100`,`${e}.700`)(n),...Uk},caption:{color:Ln("gray.600","gray.100")(n)},tfoot:{tr:{"&:last-of-type":{th:{borderBottomWidth:0}}}}}}),QCe=t0(n=>{const{colorScheme:e}=n;return{th:{color:Ln("gray.600","gray.400")(n),borderBottom:"1px",borderColor:Ln(`${e}.100`,`${e}.700`)(n),...Uk},td:{borderBottom:"1px",borderColor:Ln(`${e}.100`,`${e}.700`)(n),...Uk},caption:{color:Ln("gray.600","gray.100")(n)},tbody:{tr:{"&:nth-of-type(odd)":{"th, td":{borderBottomWidth:"1px",borderColor:Ln(`${e}.100`,`${e}.700`)(n)},td:{background:Ln(`${e}.100`,`${e}.700`)(n)}}}},tfoot:{tr:{"&:last-of-type":{th:{borderBottomWidth:0}}}}}}),ZCe={simple:JCe,striped:QCe,unstyled:{}},eRe={sm:t0({th:{px:"4",py:"1",lineHeight:"4",fontSize:"xs"},td:{px:"4",py:"2",fontSize:"sm",lineHeight:"4"},caption:{px:"4",py:"2",fontSize:"xs"}}),md:t0({th:{px:"6",py:"3",lineHeight:"4",fontSize:"xs"},td:{px:"6",py:"4",lineHeight:"5"},caption:{px:"6",py:"2",fontSize:"sm"}}),lg:t0({th:{px:"8",py:"4",lineHeight:"5",fontSize:"sm"},td:{px:"8",py:"5",lineHeight:"6"},caption:{px:"6",py:"2",fontSize:"md"}})},tRe=YCe({baseStyle:XCe,variants:ZCe,sizes:eRe,defaultProps:{variant:"simple",size:"md",colorScheme:"gray"}}),ol=Mn("tabs-color"),Nd=Mn("tabs-bg"),vO=Mn("tabs-border-color"),{defineMultiStyleConfig:nRe,definePartsStyle:Zh}=Gi(a0e.keys),rRe=n=>{const{orientation:e}=n;return{display:e==="vertical"?"flex":"block"}},iRe=n=>{const{isFitted:e}=n;return{flex:e?1:void 0,transitionProperty:"common",transitionDuration:"normal",_focusVisible:{zIndex:1,boxShadow:"outline"},_disabled:{cursor:"not-allowed",opacity:.4}}},sRe=n=>{const{align:e="start",orientation:i}=n;return{justifyContent:{end:"flex-end",center:"center",start:"flex-start"}[e],flexDirection:i==="vertical"?"column":"row"}},oRe={p:4},aRe=Zh(n=>({root:rRe(n),tab:iRe(n),tablist:sRe(n),tabpanel:oRe})),cRe={sm:Zh({tab:{py:1,px:4,fontSize:"sm"}}),md:Zh({tab:{fontSize:"md",py:2,px:4}}),lg:Zh({tab:{fontSize:"lg",py:3,px:4}})},lRe=Zh(n=>{const{colorScheme:e,orientation:i}=n,o=i==="vertical",l=o?"borderStart":"borderBottom",d=o?"marginStart":"marginBottom";return{tablist:{[l]:"2px solid",borderColor:"inherit"},tab:{[l]:"2px solid",borderColor:"transparent",[d]:"-2px",_selected:{[ol.variable]:`colors.${e}.600`,_dark:{[ol.variable]:`colors.${e}.300`},borderColor:"currentColor"},_active:{[Nd.variable]:"colors.gray.200",_dark:{[Nd.variable]:"colors.whiteAlpha.300"}},_disabled:{_active:{bg:"none"}},color:ol.reference,bg:Nd.reference}}}),uRe=Zh(n=>{const{colorScheme:e}=n;return{tab:{borderTopRadius:"md",border:"1px solid",borderColor:"transparent",mb:"-1px",[vO.variable]:"transparent",_selected:{[ol.variable]:`colors.${e}.600`,[vO.variable]:"colors.white",_dark:{[ol.variable]:`colors.${e}.300`,[vO.variable]:"colors.gray.800"},borderColor:"inherit",borderBottomColor:vO.reference},color:ol.reference},tablist:{mb:"-1px",borderBottom:"1px solid",borderColor:"inherit"}}}),dRe=Zh(n=>{const{colorScheme:e}=n;return{tab:{border:"1px solid",borderColor:"inherit",[Nd.variable]:"colors.gray.50",_dark:{[Nd.variable]:"colors.whiteAlpha.50"},mb:"-1px",_notLast:{marginEnd:"-1px"},_selected:{[Nd.variable]:"colors.white",[ol.variable]:`colors.${e}.600`,_dark:{[Nd.variable]:"colors.gray.800",[ol.variable]:`colors.${e}.300`},borderColor:"inherit",borderTopColor:"currentColor",borderBottomColor:"transparent"},color:ol.reference,bg:Nd.reference},tablist:{mb:"-1px",borderBottom:"1px solid",borderColor:"inherit"}}}),hRe=Zh(n=>{const{colorScheme:e,theme:i}=n;return{tab:{borderRadius:"full",fontWeight:"semibold",color:"gray.600",_selected:{color:bc(i,`${e}.700`),bg:bc(i,`${e}.100`)}}}}),fRe=Zh(n=>{const{colorScheme:e}=n;return{tab:{borderRadius:"full",fontWeight:"semibold",[ol.variable]:"colors.gray.600",_dark:{[ol.variable]:"inherit"},_selected:{[ol.variable]:"colors.white",[Nd.variable]:`colors.${e}.600`,_dark:{[ol.variable]:"colors.gray.800",[Nd.variable]:`colors.${e}.300`}},color:ol.reference,bg:Nd.reference}}}),pRe=Zh({}),mRe={line:lRe,enclosed:uRe,"enclosed-colored":dRe,"soft-rounded":hRe,"solid-rounded":fRe,unstyled:pRe},gRe=nRe({baseStyle:aRe,sizes:cRe,variants:mRe,defaultProps:{size:"md",variant:"line",colorScheme:"blue"}}),{defineMultiStyleConfig:_Re,definePartsStyle:Py}=Gi(c0e.keys),oq=Mn("tag-bg"),aq=Mn("tag-color"),VM=Mn("tag-shadow"),tk=Mn("tag-min-height"),nk=Mn("tag-min-width"),rk=Mn("tag-font-size"),ik=Mn("tag-padding-inline"),yRe={fontWeight:"medium",lineHeight:1.2,outline:0,[aq.variable]:qs.color.reference,[oq.variable]:qs.bg.reference,[VM.variable]:qs.shadow.reference,color:aq.reference,bg:oq.reference,boxShadow:VM.reference,borderRadius:"md",minH:tk.reference,minW:nk.reference,fontSize:rk.reference,px:ik.reference,_focusVisible:{[VM.variable]:"shadows.outline"}},ERe={lineHeight:1.2,overflow:"visible"},vRe={fontSize:"lg",w:"5",h:"5",transitionProperty:"common",transitionDuration:"normal",borderRadius:"full",marginStart:"1.5",marginEnd:"-1",opacity:.5,_disabled:{opacity:.4},_focusVisible:{boxShadow:"outline",bg:"rgba(0, 0, 0, 0.14)"},_hover:{opacity:.8},_active:{opacity:1}},SRe=Py({container:yRe,label:ERe,closeButton:vRe}),bRe={sm:Py({container:{[tk.variable]:"sizes.5",[nk.variable]:"sizes.5",[rk.variable]:"fontSizes.xs",[ik.variable]:"space.2"},closeButton:{marginEnd:"-2px",marginStart:"0.35rem"}}),md:Py({container:{[tk.variable]:"sizes.6",[nk.variable]:"sizes.6",[rk.variable]:"fontSizes.sm",[ik.variable]:"space.2"}}),lg:Py({container:{[tk.variable]:"sizes.8",[nk.variable]:"sizes.8",[rk.variable]:"fontSizes.md",[ik.variable]:"space.3"}})},TRe={subtle:Py(n=>{var e;return{container:(e=nC.variants)==null?void 0:e.subtle(n)}}),solid:Py(n=>{var e;return{container:(e=nC.variants)==null?void 0:e.solid(n)}}),outline:Py(n=>{var e;return{container:(e=nC.variants)==null?void 0:e.outline(n)}})},wRe=_Re({variants:TRe,baseStyle:SRe,sizes:bRe,defaultProps:{size:"md",variant:"subtle",colorScheme:"gray"}});var uZ;const CRe={...(uZ=si.baseStyle)==null?void 0:uZ.field,paddingY:"2",minHeight:"20",lineHeight:"short",verticalAlign:"top"};var dZ;const RRe={outline:n=>{var e;return((e=si.variants)==null?void 0:e.outline(n).field)??{}},flushed:n=>{var e;return((e=si.variants)==null?void 0:e.flushed(n).field)??{}},filled:n=>{var e;return((e=si.variants)==null?void 0:e.filled(n).field)??{}},unstyled:((dZ=si.variants)==null?void 0:dZ.unstyled.field)??{}};var hZ,fZ,pZ,mZ;const IRe={xs:((hZ=si.sizes)==null?void 0:hZ.xs.field)??{},sm:((fZ=si.sizes)==null?void 0:fZ.sm.field)??{},md:((pZ=si.sizes)==null?void 0:pZ.md.field)??{},lg:((mZ=si.sizes)==null?void 0:mZ.lg.field)??{}},ARe={baseStyle:CRe,sizes:IRe,variants:RRe,defaultProps:{size:"md",variant:"outline"}},SO=Ro("tooltip-bg"),FM=Ro("tooltip-fg"),PRe=Ro("popper-arrow-bg"),ORe={bg:SO.reference,color:FM.reference,[SO.variable]:"colors.gray.700",[FM.variable]:"colors.whiteAlpha.900",_dark:{[SO.variable]:"colors.gray.300",[FM.variable]:"colors.gray.900"},[PRe.variable]:SO.reference,px:"2",py:"0.5",borderRadius:"sm",fontWeight:"medium",fontSize:"sm",boxShadow:"md",maxW:"xs",zIndex:"tooltip"},kRe={baseStyle:ORe},NRe={Accordion:_0e,Alert:ebe,Avatar:dbe,Badge:nC,Breadcrumb:Sbe,Button:Obe,Checkbox:hg,CloseButton:Hbe,Code:Ybe,Container:Jbe,Divider:nTe,Drawer:fTe,Editable:vTe,Form:RTe,FormError:NTe,FormLabel:xTe,Heading:UTe,Input:si,Kbd:KTe,Link:YTe,List:ewe,Menu:dwe,Modal:bwe,NumberInput:kwe,PinInput:Lwe,Popover:$we,Progress:eCe,Radio:sCe,Select:hCe,Skeleton:pCe,SkipLink:gCe,Slider:ICe,Spinner:OCe,Stat:VCe,Switch:qCe,Table:tRe,Tabs:gRe,Tag:wRe,Textarea:ARe,Tooltip:kRe,Card:Lbe,Stepper:BCe},DRe={none:0,"1px":"1px solid","2px":"2px solid","4px":"4px solid","8px":"8px solid"},xRe={base:"0em",sm:"30em",md:"48em",lg:"62em",xl:"80em","2xl":"96em"},LRe={transparent:"transparent",current:"currentColor",black:"#000000",white:"#FFFFFF",whiteAlpha:{50:"rgba(255, 255, 255, 0.04)",100:"rgba(255, 255, 255, 0.06)",200:"rgba(255, 255, 255, 0.08)",300:"rgba(255, 255, 255, 0.16)",400:"rgba(255, 255, 255, 0.24)",500:"rgba(255, 255, 255, 0.36)",600:"rgba(255, 255, 255, 0.48)",700:"rgba(255, 255, 255, 0.64)",800:"rgba(255, 255, 255, 0.80)",900:"rgba(255, 255, 255, 0.92)"},blackAlpha:{50:"rgba(0, 0, 0, 0.04)",100:"rgba(0, 0, 0, 0.06)",200:"rgba(0, 0, 0, 0.08)",300:"rgba(0, 0, 0, 0.16)",400:"rgba(0, 0, 0, 0.24)",500:"rgba(0, 0, 0, 0.36)",600:"rgba(0, 0, 0, 0.48)",700:"rgba(0, 0, 0, 0.64)",800:"rgba(0, 0, 0, 0.80)",900:"rgba(0, 0, 0, 0.92)"},gray:{50:"#F7FAFC",100:"#EDF2F7",200:"#E2E8F0",300:"#CBD5E0",400:"#A0AEC0",500:"#718096",600:"#4A5568",700:"#2D3748",800:"#1A202C",900:"#171923"},red:{50:"#FFF5F5",100:"#FED7D7",200:"#FEB2B2",300:"#FC8181",400:"#F56565",500:"#E53E3E",600:"#C53030",700:"#9B2C2C",800:"#822727",900:"#63171B"},orange:{50:"#FFFAF0",100:"#FEEBC8",200:"#FBD38D",300:"#F6AD55",400:"#ED8936",500:"#DD6B20",600:"#C05621",700:"#9C4221",800:"#7B341E",900:"#652B19"},yellow:{50:"#FFFFF0",100:"#FEFCBF",200:"#FAF089",300:"#F6E05E",400:"#ECC94B",500:"#D69E2E",600:"#B7791F",700:"#975A16",800:"#744210",900:"#5F370E"},green:{50:"#F0FFF4",100:"#C6F6D5",200:"#9AE6B4",300:"#68D391",400:"#48BB78",500:"#38A169",600:"#2F855A",700:"#276749",800:"#22543D",900:"#1C4532"},teal:{50:"#E6FFFA",100:"#B2F5EA",200:"#81E6D9",300:"#4FD1C5",400:"#38B2AC",500:"#319795",600:"#2C7A7B",700:"#285E61",800:"#234E52",900:"#1D4044"},blue:{50:"#ebf8ff",100:"#bee3f8",200:"#90cdf4",300:"#63b3ed",400:"#4299e1",500:"#3182ce",600:"#2b6cb0",700:"#2c5282",800:"#2a4365",900:"#1A365D"},cyan:{50:"#EDFDFD",100:"#C4F1F9",200:"#9DECF9",300:"#76E4F7",400:"#0BC5EA",500:"#00B5D8",600:"#00A3C4",700:"#0987A0",800:"#086F83",900:"#065666"},purple:{50:"#FAF5FF",100:"#E9D8FD",200:"#D6BCFA",300:"#B794F4",400:"#9F7AEA",500:"#805AD5",600:"#6B46C1",700:"#553C9A",800:"#44337A",900:"#322659"},pink:{50:"#FFF5F7",100:"#FED7E2",200:"#FBB6CE",300:"#F687B3",400:"#ED64A6",500:"#D53F8C",600:"#B83280",700:"#97266D",800:"#702459",900:"#521B41"}},MRe={none:"0",sm:"0.125rem",base:"0.25rem",md:"0.375rem",lg:"0.5rem",xl:"0.75rem","2xl":"1rem","3xl":"1.5rem",full:"9999px"},URe={xs:"0 0 0 1px rgba(0, 0, 0, 0.05)",sm:"0 1px 2px 0 rgba(0, 0, 0, 0.05)",base:"0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06)",md:"0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)",lg:"0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05)",xl:"0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04)","2xl":"0 25px 50px -12px rgba(0, 0, 0, 0.25)",outline:"0 0 0 3px rgba(66, 153, 225, 0.6)",inner:"inset 0 2px 4px 0 rgba(0,0,0,0.06)",none:"none","dark-lg":"rgba(0, 0, 0, 0.1) 0px 0px 0px 1px, rgba(0, 0, 0, 0.2) 0px 5px 10px, rgba(0, 0, 0, 0.4) 0px 15px 40px"},VRe={common:"background-color, border-color, color, fill, stroke, opacity, box-shadow, transform",colors:"background-color, border-color, color, fill, stroke",dimensions:"width, height",position:"left, right, top, bottom",background:"background-color, background-image, background-position"},FRe={"ease-in":"cubic-bezier(0.4, 0, 1, 1)","ease-out":"cubic-bezier(0, 0, 0.2, 1)","ease-in-out":"cubic-bezier(0.4, 0, 0.2, 1)"},jRe={"ultra-fast":"50ms",faster:"100ms",fast:"150ms",normal:"200ms",slow:"300ms",slower:"400ms","ultra-slow":"500ms"},BRe={property:VRe,easing:FRe,duration:jRe},WRe={hide:-1,auto:"auto",base:0,docked:10,dropdown:1e3,sticky:1100,banner:1200,overlay:1300,modal:1400,popover:1500,skipLink:1600,toast:1700,tooltip:1800},zRe={none:0,sm:"4px",base:"8px",md:"12px",lg:"16px",xl:"24px","2xl":"40px","3xl":"64px"},GRe={breakpoints:xRe,zIndices:WRe,radii:MRe,blur:zRe,colors:LRe,...eee,sizes:qZ,shadows:URe,space:KZ,borders:DRe,transition:BRe},HRe={colors:{"chakra-body-text":{_light:"gray.800",_dark:"whiteAlpha.900"},"chakra-body-bg":{_light:"white",_dark:"gray.800"},"chakra-border-color":{_light:"gray.200",_dark:"whiteAlpha.300"},"chakra-inverse-text":{_light:"white",_dark:"gray.800"},"chakra-subtle-bg":{_light:"gray.100",_dark:"gray.700"},"chakra-subtle-text":{_light:"gray.600",_dark:"gray.400"},"chakra-placeholder-color":{_light:"gray.500",_dark:"whiteAlpha.400"}}},$Re={global:{body:{fontFamily:"body",color:"chakra-body-text",bg:"chakra-body-bg",transitionProperty:"background-color",transitionDuration:"normal",lineHeight:"base"},"*::placeholder":{color:"chakra-placeholder-color"},"*, *::before, &::after":{borderColor:"chakra-border-color"}}},KRe="ltr",qRe={useSystemColorMode:!1,initialColorMode:"light",cssVarPrefix:"chakra"},YRe={semanticTokens:HRe,direction:KRe,...GRe,components:NRe,styles:$Re,config:qRe};function XRe(n){if(n.sheet)return n.sheet;for(var e=0;e<document.styleSheets.length;e++)if(document.styleSheets[e].ownerNode===n)return document.styleSheets[e]}function JRe(n){var e=document.createElement("style");return e.setAttribute("data-emotion",n.key),n.nonce!==void 0&&e.setAttribute("nonce",n.nonce),e.appendChild(document.createTextNode("")),e.setAttribute("data-s",""),e}var QRe=function(){function n(i){var o=this;this._insertTag=function(l){var d;o.tags.length===0?o.insertionPoint?d=o.insertionPoint.nextSibling:o.prepend?d=o.container.firstChild:d=o.before:d=o.tags[o.tags.length-1].nextSibling,o.container.insertBefore(l,d),o.tags.push(l)},this.isSpeedy=i.speedy===void 0?!0:i.speedy,this.tags=[],this.ctr=0,this.nonce=i.nonce,this.key=i.key,this.container=i.container,this.prepend=i.prepend,this.insertionPoint=i.insertionPoint,this.before=null}var e=n.prototype;return e.hydrate=function(o){o.forEach(this._insertTag)},e.insert=function(o){this.ctr%(this.isSpeedy?65e3:1)===0&&this._insertTag(JRe(this));var l=this.tags[this.tags.length-1];if(this.isSpeedy){var d=XRe(l);try{d.insertRule(o,d.cssRules.length)}catch{}}else l.appendChild(document.createTextNode(o));this.ctr++},e.flush=function(){this.tags.forEach(function(o){var l;return(l=o.parentNode)==null?void 0:l.removeChild(o)}),this.tags=[],this.ctr=0},n}(),qa="-ms-",Vk="-moz-",ri="-webkit-",iee="comm",BF="rule",WF="decl",ZRe="@import",see="@keyframes",eIe="@layer",tIe=Math.abs,N1=String.fromCharCode,nIe=Object.assign;function rIe(n,e){return Ea(n,0)^45?(((e<<2^Ea(n,0))<<2^Ea(n,1))<<2^Ea(n,2))<<2^Ea(n,3):0}function oee(n){return n.trim()}function iIe(n,e){return(n=e.exec(n))?n[0]:n}function ii(n,e,i){return n.replace(e,i)}function tV(n,e){return n.indexOf(e)}function Ea(n,e){return n.charCodeAt(e)|0}function wC(n,e,i){return n.slice(e,i)}function Wh(n){return n.length}function zF(n){return n.length}function bO(n,e){return e.push(n),n}function sIe(n,e){return n.map(e).join("")}var D1=1,p0=1,aee=0,hl=0,no=0,F0="";function x1(n,e,i,o,l,d,p){return{value:n,root:e,parent:i,type:o,props:l,children:d,line:D1,column:p0,length:p,return:""}}function yw(n,e){return nIe(x1("",null,null,"",null,null,0),n,{length:-n.length},e)}function oIe(){return no}function aIe(){return no=hl>0?Ea(F0,--hl):0,p0--,no===10&&(p0=1,D1--),no}function jl(){return no=hl<aee?Ea(F0,hl++):0,p0++,no===10&&(p0=1,D1++),no}function ef(){return Ea(F0,hl)}function sk(){return hl}function ZC(n,e){return wC(F0,n,e)}function CC(n){switch(n){case 0:case 9:case 10:case 13:case 32:return 5;case 33:case 43:case 44:case 47:case 62:case 64:case 126:case 59:case 123:case 125:return 4;case 58:return 3;case 34:case 39:case 40:case 91:return 2;case 41:case 93:return 1}return 0}function cee(n){return D1=p0=1,aee=Wh(F0=n),hl=0,[]}function lee(n){return F0="",n}function ok(n){return oee(ZC(hl-1,nV(n===91?n+2:n===40?n+1:n)))}function cIe(n){for(;(no=ef())&&no<33;)jl();return CC(n)>2||CC(no)>3?"":" "}function lIe(n,e){for(;--e&&jl()&&!(no<48||no>102||no>57&&no<65||no>70&&no<97););return ZC(n,sk()+(e<6&&ef()==32&&jl()==32))}function nV(n){for(;jl();)switch(no){case n:return hl;case 34:case 39:n!==34&&n!==39&&nV(no);break;case 40:n===41&&nV(n);break;case 92:jl();break}return hl}function uIe(n,e){for(;jl()&&n+no!==57;)if(n+no===84&&ef()===47)break;return"/*"+ZC(e,hl-1)+"*"+N1(n===47?n:jl())}function dIe(n){for(;!CC(ef());)jl();return ZC(n,hl)}function hIe(n){return lee(ak("",null,null,null,[""],n=cee(n),0,[0],n))}function ak(n,e,i,o,l,d,p,_,E){for(var b=0,C=0,I=p,O=0,L=0,V=0,B=1,W=1,Z=1,$=0,se="",ue=l,re=d,pe=o,q=se;W;)switch(V=$,$=jl()){case 40:if(V!=108&&Ea(q,I-1)==58){tV(q+=ii(ok($),"&","&\f"),"&\f")!=-1&&(Z=-1);break}case 34:case 39:case 91:q+=ok($);break;case 9:case 10:case 13:case 32:q+=cIe(V);break;case 92:q+=lIe(sk()-1,7);continue;case 47:switch(ef()){case 42:case 47:bO(fIe(uIe(jl(),sk()),e,i),E);break;default:q+="/"}break;case 123*B:_[b++]=Wh(q)*Z;case 125*B:case 59:case 0:switch($){case 0:case 125:W=0;case 59+C:Z==-1&&(q=ii(q,/\f/g,"")),L>0&&Wh(q)-I&&bO(L>32?lq(q+";",o,i,I-1):lq(ii(q," ","")+";",o,i,I-2),E);break;case 59:q+=";";default:if(bO(pe=cq(q,e,i,b,C,l,_,se,ue=[],re=[],I),d),$===123)if(C===0)ak(q,e,pe,pe,ue,d,I,_,re);else switch(O===99&&Ea(q,3)===110?100:O){case 100:case 108:case 109:case 115:ak(n,pe,pe,o&&bO(cq(n,pe,pe,0,0,l,_,se,l,ue=[],I),re),l,re,I,_,o?ue:re);break;default:ak(q,pe,pe,pe,[""],re,0,_,re)}}b=C=L=0,B=Z=1,se=q="",I=p;break;case 58:I=1+Wh(q),L=V;default:if(B<1){if($==123)--B;else if($==125&&B++==0&&aIe()==125)continue}switch(q+=N1($),$*B){case 38:Z=C>0?1:(q+="\f",-1);break;case 44:_[b++]=(Wh(q)-1)*Z,Z=1;break;case 64:ef()===45&&(q+=ok(jl())),O=ef(),C=I=Wh(se=q+=dIe(sk())),$++;break;case 45:V===45&&Wh(q)==2&&(B=0)}}return d}function cq(n,e,i,o,l,d,p,_,E,b,C){for(var I=l-1,O=l===0?d:[""],L=zF(O),V=0,B=0,W=0;V<o;++V)for(var Z=0,$=wC(n,I+1,I=tIe(B=p[V])),se=n;Z<L;++Z)(se=oee(B>0?O[Z]+" "+$:ii($,/&\f/g,O[Z])))&&(E[W++]=se);return x1(n,e,i,l===0?BF:_,E,b,C)}function fIe(n,e,i){return x1(n,e,i,iee,N1(oIe()),wC(n,2,-2),0)}function lq(n,e,i,o){return x1(n,e,i,WF,wC(n,0,o),wC(n,o+1,-1),o)}function n0(n,e){for(var i="",o=zF(n),l=0;l<o;l++)i+=e(n[l],l,n,e)||"";return i}function pIe(n,e,i,o){switch(n.type){case eIe:if(n.children.length)break;case ZRe:case WF:return n.return=n.return||n.value;case iee:return"";case see:return n.return=n.value+"{"+n0(n.children,o)+"}";case BF:n.value=n.props.join(",")}return Wh(i=n0(n.children,o))?n.return=n.value+"{"+i+"}":""}function mIe(n){var e=zF(n);return function(i,o,l,d){for(var p="",_=0;_<e;_++)p+=n[_](i,o,l,d)||"";return p}}function gIe(n){return function(e){e.root||(e=e.return)&&n(e)}}var uq=function(e){var i=new WeakMap;return function(o){if(i.has(o))return i.get(o);var l=e(o);return i.set(o,l),l}};function uee(n){var e=Object.create(null);return function(i){return e[i]===void 0&&(e[i]=n(i)),e[i]}}var _Ie=function(e,i,o){for(var l=0,d=0;l=d,d=ef(),l===38&&d===12&&(i[o]=1),!CC(d);)jl();return ZC(e,hl)},yIe=function(e,i){var o=-1,l=44;do switch(CC(l)){case 0:l===38&&ef()===12&&(i[o]=1),e[o]+=_Ie(hl-1,i,o);break;case 2:e[o]+=ok(l);break;case 4:if(l===44){e[++o]=ef()===58?"&\f":"",i[o]=e[o].length;break}default:e[o]+=N1(l)}while(l=jl());return e},EIe=function(e,i){return lee(yIe(cee(e),i))},dq=new WeakMap,vIe=function(e){if(!(e.type!=="rule"||!e.parent||e.length<1)){for(var i=e.value,o=e.parent,l=e.column===o.column&&e.line===o.line;o.type!=="rule";)if(o=o.parent,!o)return;if(!(e.props.length===1&&i.charCodeAt(0)!==58&&!dq.get(o))&&!l){dq.set(e,!0);for(var d=[],p=EIe(i,d),_=o.props,E=0,b=0;E<p.length;E++)for(var C=0;C<_.length;C++,b++)e.props[b]=d[E]?p[E].replace(/&\f/g,_[C]):_[C]+" "+p[E]}}},SIe=function(e){if(e.type==="decl"){var i=e.value;i.charCodeAt(0)===108&&i.charCodeAt(2)===98&&(e.return="",e.value="")}};function dee(n,e){switch(rIe(n,e)){case 5103:return ri+"print-"+n+n;case 5737:case 4201:case 3177:case 3433:case 1641:case 4457:case 2921:case 5572:case 6356:case 5844:case 3191:case 6645:case 3005:case 6391:case 5879:case 5623:case 6135:case 4599:case 4855:case 4215:case 6389:case 5109:case 5365:case 5621:case 3829:return ri+n+n;case 5349:case 4246:case 4810:case 6968:case 2756:return ri+n+Vk+n+qa+n+n;case 6828:case 4268:return ri+n+qa+n+n;case 6165:return ri+n+qa+"flex-"+n+n;case 5187:return ri+n+ii(n,/(\w+).+(:[^]+)/,ri+"box-$1$2"+qa+"flex-$1$2")+n;case 5443:return ri+n+qa+"flex-item-"+ii(n,/flex-|-self/,"")+n;case 4675:return ri+n+qa+"flex-line-pack"+ii(n,/align-content|flex-|-self/,"")+n;case 5548:return ri+n+qa+ii(n,"shrink","negative")+n;case 5292:return ri+n+qa+ii(n,"basis","preferred-size")+n;case 6060:return ri+"box-"+ii(n,"-grow","")+ri+n+qa+ii(n,"grow","positive")+n;case 4554:return ri+ii(n,/([^-])(transform)/g,"$1"+ri+"$2")+n;case 6187:return ii(ii(ii(n,/(zoom-|grab)/,ri+"$1"),/(image-set)/,ri+"$1"),n,"")+n;case 5495:case 3959:return ii(n,/(image-set\([^]*)/,ri+"$1$`$1");case 4968:return ii(ii(n,/(.+:)(flex-)?(.*)/,ri+"box-pack:$3"+qa+"flex-pack:$3"),/s.+-b[^;]+/,"justify")+ri+n+n;case 4095:case 3583:case 4068:case 2532:return ii(n,/(.+)-inline(.+)/,ri+"$1$2")+n;case 8116:case 7059:case 5753:case 5535:case 5445:case 5701:case 4933:case 4677:case 5533:case 5789:case 5021:case 4765:if(Wh(n)-1-e>6)switch(Ea(n,e+1)){case 109:if(Ea(n,e+4)!==45)break;case 102:return ii(n,/(.+:)(.+)-([^]+)/,"$1"+ri+"$2-$3$1"+Vk+(Ea(n,e+3)==108?"$3":"$2-$3"))+n;case 115:return~tV(n,"stretch")?dee(ii(n,"stretch","fill-available"),e)+n:n}break;case 4949:if(Ea(n,e+1)!==115)break;case 6444:switch(Ea(n,Wh(n)-3-(~tV(n,"!important")&&10))){case 107:return ii(n,":",":"+ri)+n;case 101:return ii(n,/(.+:)([^;!]+)(;|!.+)?/,"$1"+ri+(Ea(n,14)===45?"inline-":"")+"box$3$1"+ri+"$2$3$1"+qa+"$2box$3")+n}break;case 5936:switch(Ea(n,e+11)){case 114:return ri+n+qa+ii(n,/[svh]\w+-[tblr]{2}/,"tb")+n;case 108:return ri+n+qa+ii(n,/[svh]\w+-[tblr]{2}/,"tb-rl")+n;case 45:return ri+n+qa+ii(n,/[svh]\w+-[tblr]{2}/,"lr")+n}return ri+n+qa+n+n}return n}var bIe=function(e,i,o,l){if(e.length>-1&&!e.return)switch(e.type){case WF:e.return=dee(e.value,e.length);break;case see:return n0([yw(e,{value:ii(e.value,"@","@"+ri)})],l);case BF:if(e.length)return sIe(e.props,function(d){switch(iIe(d,/(::plac\w+|:read-\w+)/)){case":read-only":case":read-write":return n0([yw(e,{props:[ii(d,/:(read-\w+)/,":"+Vk+"$1")]})],l);case"::placeholder":return n0([yw(e,{props:[ii(d,/:(plac\w+)/,":"+ri+"input-$1")]}),yw(e,{props:[ii(d,/:(plac\w+)/,":"+Vk+"$1")]}),yw(e,{props:[ii(d,/:(plac\w+)/,qa+"input-$1")]})],l)}return""})}},TIe=[bIe],wIe=function(e){var i=e.key;if(i==="css"){var o=document.querySelectorAll("style[data-emotion]:not([data-s])");Array.prototype.forEach.call(o,function(B){var W=B.getAttribute("data-emotion");W.indexOf(" ")!==-1&&(document.head.appendChild(B),B.setAttribute("data-s",""))})}var l=e.stylisPlugins||TIe,d={},p,_=[];p=e.container||document.head,Array.prototype.forEach.call(document.querySelectorAll('style[data-emotion^="'+i+' "]'),function(B){for(var W=B.getAttribute("data-emotion").split(" "),Z=1;Z<W.length;Z++)d[W[Z]]=!0;_.push(B)});var E,b=[vIe,SIe];{var C,I=[pIe,gIe(function(B){C.insert(B)})],O=mIe(b.concat(l,I)),L=function(W){return n0(hIe(W),O)};E=function(W,Z,$,se){C=$,L(W?W+"{"+Z.styles+"}":Z.styles),se&&(V.inserted[Z.name]=!0)}}var V={key:i,sheet:new QRe({key:i,container:p,nonce:e.nonce,speedy:e.speedy,prepend:e.prepend,insertionPoint:e.insertionPoint}),nonce:e.nonce,inserted:d,registered:{},insert:E};return V.sheet.hydrate(_),V};function Uy(){return Uy=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var o in i)({}).hasOwnProperty.call(i,o)&&(n[o]=i[o])}return n},Uy.apply(null,arguments)}var jM={exports:{}},hi={};/** @license React v16.13.1
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var hq;function CIe(){if(hq)return hi;hq=1;var n=typeof Symbol=="function"&&Symbol.for,e=n?Symbol.for("react.element"):60103,i=n?Symbol.for("react.portal"):60106,o=n?Symbol.for("react.fragment"):60107,l=n?Symbol.for("react.strict_mode"):60108,d=n?Symbol.for("react.profiler"):60114,p=n?Symbol.for("react.provider"):60109,_=n?Symbol.for("react.context"):60110,E=n?Symbol.for("react.async_mode"):60111,b=n?Symbol.for("react.concurrent_mode"):60111,C=n?Symbol.for("react.forward_ref"):60112,I=n?Symbol.for("react.suspense"):60113,O=n?Symbol.for("react.suspense_list"):60120,L=n?Symbol.for("react.memo"):60115,V=n?Symbol.for("react.lazy"):60116,B=n?Symbol.for("react.block"):60121,W=n?Symbol.for("react.fundamental"):60117,Z=n?Symbol.for("react.responder"):60118,$=n?Symbol.for("react.scope"):60119;function se(re){if(typeof re=="object"&&re!==null){var pe=re.$$typeof;switch(pe){case e:switch(re=re.type,re){case E:case b:case o:case d:case l:case I:return re;default:switch(re=re&&re.$$typeof,re){case _:case C:case V:case L:case p:return re;default:return pe}}case i:return pe}}}function ue(re){return se(re)===b}return hi.AsyncMode=E,hi.ConcurrentMode=b,hi.ContextConsumer=_,hi.ContextProvider=p,hi.Element=e,hi.ForwardRef=C,hi.Fragment=o,hi.Lazy=V,hi.Memo=L,hi.Portal=i,hi.Profiler=d,hi.StrictMode=l,hi.Suspense=I,hi.isAsyncMode=function(re){return ue(re)||se(re)===E},hi.isConcurrentMode=ue,hi.isContextConsumer=function(re){return se(re)===_},hi.isContextProvider=function(re){return se(re)===p},hi.isElement=function(re){return typeof re=="object"&&re!==null&&re.$$typeof===e},hi.isForwardRef=function(re){return se(re)===C},hi.isFragment=function(re){return se(re)===o},hi.isLazy=function(re){return se(re)===V},hi.isMemo=function(re){return se(re)===L},hi.isPortal=function(re){return se(re)===i},hi.isProfiler=function(re){return se(re)===d},hi.isStrictMode=function(re){return se(re)===l},hi.isSuspense=function(re){return se(re)===I},hi.isValidElementType=function(re){return typeof re=="string"||typeof re=="function"||re===o||re===b||re===d||re===l||re===I||re===O||typeof re=="object"&&re!==null&&(re.$$typeof===V||re.$$typeof===L||re.$$typeof===p||re.$$typeof===_||re.$$typeof===C||re.$$typeof===W||re.$$typeof===Z||re.$$typeof===$||re.$$typeof===B)},hi.typeOf=se,hi}var fq;function RIe(){return fq||(fq=1,jM.exports=CIe()),jM.exports}var BM,pq;function IIe(){if(pq)return BM;pq=1;var n=RIe(),e={childContextTypes:!0,contextType:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromError:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},i={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},o={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},l={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},d={};d[n.ForwardRef]=o,d[n.Memo]=l;function p(V){return n.isMemo(V)?l:d[V.$$typeof]||e}var _=Object.defineProperty,E=Object.getOwnPropertyNames,b=Object.getOwnPropertySymbols,C=Object.getOwnPropertyDescriptor,I=Object.getPrototypeOf,O=Object.prototype;function L(V,B,W){if(typeof B!="string"){if(O){var Z=I(B);Z&&Z!==O&&L(V,Z,W)}var $=E(B);b&&($=$.concat(b(B)));for(var se=p(V),ue=p(B),re=0;re<$.length;++re){var pe=$[re];if(!i[pe]&&!(W&&W[pe])&&!(ue&&ue[pe])&&!(se&&se[pe])){var q=C(B,pe);try{_(V,pe,q)}catch{}}}}return V}return BM=L,BM}var AIe=IIe();const PIe=Ug(AIe);var OIe=!0;function hee(n,e,i){var o="";return i.split(" ").forEach(function(l){n[l]!==void 0?e.push(n[l]+";"):l&&(o+=l+" ")}),o}var GF=function(e,i,o){var l=e.key+"-"+i.name;(o===!1||OIe===!1)&&e.registered[l]===void 0&&(e.registered[l]=i.styles)},HF=function(e,i,o){GF(e,i,o);var l=e.key+"-"+i.name;if(e.inserted[i.name]===void 0){var d=i;do e.insert(i===d?"."+l:"",d,e.sheet,!0),d=d.next;while(d!==void 0)}};function kIe(n){for(var e=0,i,o=0,l=n.length;l>=4;++o,l-=4)i=n.charCodeAt(o)&255|(n.charCodeAt(++o)&255)<<8|(n.charCodeAt(++o)&255)<<16|(n.charCodeAt(++o)&255)<<24,i=(i&65535)*1540483477+((i>>>16)*59797<<16),i^=i>>>24,e=(i&65535)*1540483477+((i>>>16)*59797<<16)^(e&65535)*1540483477+((e>>>16)*59797<<16);switch(l){case 3:e^=(n.charCodeAt(o+2)&255)<<16;case 2:e^=(n.charCodeAt(o+1)&255)<<8;case 1:e^=n.charCodeAt(o)&255,e=(e&65535)*1540483477+((e>>>16)*59797<<16)}return e^=e>>>13,e=(e&65535)*1540483477+((e>>>16)*59797<<16),((e^e>>>15)>>>0).toString(36)}var NIe={animationIterationCount:1,aspectRatio:1,borderImageOutset:1,borderImageSlice:1,borderImageWidth:1,boxFlex:1,boxFlexGroup:1,boxOrdinalGroup:1,columnCount:1,columns:1,flex:1,flexGrow:1,flexPositive:1,flexShrink:1,flexNegative:1,flexOrder:1,gridRow:1,gridRowEnd:1,gridRowSpan:1,gridRowStart:1,gridColumn:1,gridColumnEnd:1,gridColumnSpan:1,gridColumnStart:1,msGridRow:1,msGridRowSpan:1,msGridColumn:1,msGridColumnSpan:1,fontWeight:1,lineHeight:1,opacity:1,order:1,orphans:1,scale:1,tabSize:1,widows:1,zIndex:1,zoom:1,WebkitLineClamp:1,fillOpacity:1,floodOpacity:1,stopOpacity:1,strokeDasharray:1,strokeDashoffset:1,strokeMiterlimit:1,strokeOpacity:1,strokeWidth:1},DIe=/[A-Z]|^ms/g,xIe=/_EMO_([^_]+?)_([^]*?)_EMO_/g,fee=function(e){return e.charCodeAt(1)===45},mq=function(e){return e!=null&&typeof e!="boolean"},WM=uee(function(n){return fee(n)?n:n.replace(DIe,"-$&").toLowerCase()}),gq=function(e,i){switch(e){case"animation":case"animationName":if(typeof i=="string")return i.replace(xIe,function(o,l,d){return zh={name:l,styles:d,next:zh},l})}return NIe[e]!==1&&!fee(e)&&typeof i=="number"&&i!==0?i+"px":i};function RC(n,e,i){if(i==null)return"";var o=i;if(o.__emotion_styles!==void 0)return o;switch(typeof i){case"boolean":return"";case"object":{var l=i;if(l.anim===1)return zh={name:l.name,styles:l.styles,next:zh},l.name;var d=i;if(d.styles!==void 0){var p=d.next;if(p!==void 0)for(;p!==void 0;)zh={name:p.name,styles:p.styles,next:zh},p=p.next;var _=d.styles+";";return _}return LIe(n,e,i)}case"function":{if(n!==void 0){var E=zh,b=i(n);return zh=E,RC(n,e,b)}break}}var C=i;if(e==null)return C;var I=e[C];return I!==void 0?I:C}function LIe(n,e,i){var o="";if(Array.isArray(i))for(var l=0;l<i.length;l++)o+=RC(n,e,i[l])+";";else for(var d in i){var p=i[d];if(typeof p!="object"){var _=p;e!=null&&e[_]!==void 0?o+=d+"{"+e[_]+"}":mq(_)&&(o+=WM(d)+":"+gq(d,_)+";")}else if(Array.isArray(p)&&typeof p[0]=="string"&&(e==null||e[p[0]]===void 0))for(var E=0;E<p.length;E++)mq(p[E])&&(o+=WM(d)+":"+gq(d,p[E])+";");else{var b=RC(n,e,p);switch(d){case"animation":case"animationName":{o+=WM(d)+":"+b+";";break}default:o+=d+"{"+b+"}"}}}return o}var _q=/label:\s*([^\s;{]+)\s*(;|$)/g,zh;function L1(n,e,i){if(n.length===1&&typeof n[0]=="object"&&n[0]!==null&&n[0].styles!==void 0)return n[0];var o=!0,l="";zh=void 0;var d=n[0];if(d==null||d.raw===void 0)o=!1,l+=RC(i,e,d);else{var p=d;l+=p[0]}for(var _=1;_<n.length;_++)if(l+=RC(i,e,n[_]),o){var E=d;l+=E[_]}_q.lastIndex=0;for(var b="",C;(C=_q.exec(l))!==null;)b+="-"+C[1];var I=kIe(l)+b;return{name:I,styles:l,next:zh}}var MIe=function(e){return e()},pee=IK.useInsertionEffect?IK.useInsertionEffect:!1,mee=pee||MIe,yq=pee||D.useLayoutEffect,$F=D.createContext(typeof HTMLElement<"u"?wIe({key:"css"}):null);$F.Provider;var UIe=function(){return D.useContext($F)},KF=function(e){return D.forwardRef(function(i,o){var l=D.useContext($F);return e(i,l,o)})},m0=D.createContext({}),VIe=function(e,i){if(typeof i=="function"){var o=i(e);return o}return Uy({},e,i)},FIe=uq(function(n){return uq(function(e){return VIe(n,e)})}),jIe=function(e){var i=D.useContext(m0);return e.theme!==i&&(i=FIe(i)(e.theme)),D.createElement(m0.Provider,{value:i},e.children)},qF={}.hasOwnProperty,rV="__EMOTION_TYPE_PLEASE_DO_NOT_USE__",BIe=function(e,i){var o={};for(var l in i)qF.call(i,l)&&(o[l]=i[l]);return o[rV]=e,o},WIe=function(e){var i=e.cache,o=e.serialized,l=e.isStringTag;return GF(i,o,l),mee(function(){return HF(i,o,l)}),null},zIe=KF(function(n,e,i){var o=n.css;typeof o=="string"&&e.registered[o]!==void 0&&(o=e.registered[o]);var l=n[rV],d=[o],p="";typeof n.className=="string"?p=hee(e.registered,d,n.className):n.className!=null&&(p=n.className+" ");var _=L1(d,void 0,D.useContext(m0));p+=e.key+"-"+_.name;var E={};for(var b in n)qF.call(n,b)&&b!=="css"&&b!==rV&&(E[b]=n[b]);return E.className=p,i&&(E.ref=i),D.createElement(D.Fragment,null,D.createElement(WIe,{cache:e,serialized:_,isStringTag:typeof l=="string"}),D.createElement(l,E))}),GIe=zIe,Eq=function(e,i){var o=arguments;if(i==null||!qF.call(i,"css"))return D.createElement.apply(void 0,o);var l=o.length,d=new Array(l);d[0]=GIe,d[1]=BIe(e,i);for(var p=2;p<l;p++)d[p]=o[p];return D.createElement.apply(null,d)};(function(n){var e;e||(e=n.JSX||(n.JSX={}))})(Eq||(Eq={}));var M1=KF(function(n,e){var i=n.styles,o=L1([i],void 0,D.useContext(m0)),l=D.useRef();return yq(function(){var d=e.key+"-global",p=new e.sheet.constructor({key:d,nonce:e.sheet.nonce,container:e.sheet.container,speedy:e.sheet.isSpeedy}),_=!1,E=document.querySelector('style[data-emotion="'+d+" "+o.name+'"]');return e.sheet.tags.length&&(p.before=e.sheet.tags[0]),E!==null&&(_=!0,E.setAttribute("data-emotion",d),p.hydrate([E])),l.current=[p,_],function(){p.flush()}},[e]),yq(function(){var d=l.current,p=d[0],_=d[1];if(_){d[1]=!1;return}if(o.next!==void 0&&HF(e,o.next,!0),p.tags.length){var E=p.tags[p.tags.length-1].nextElementSibling;p.before=E,p.flush()}e.insert("",o,p,!1)},[e,o.name]),null});function HIe(){for(var n=arguments.length,e=new Array(n),i=0;i<n;i++)e[i]=arguments[i];return L1(e)}function eR(){var n=HIe.apply(void 0,arguments),e="animation-"+n.name;return{name:e,styles:"@keyframes "+e+"{"+n.styles+"}",anim:1,toString:function(){return"_EMO_"+this.name+"_"+this.styles+"_EMO_"}}}const YF=D.createContext({});YF.displayName="ColorModeContext";function U1(){const n=D.useContext(YF);if(n===void 0)throw new Error("useColorMode must be used within a ColorModeProvider");return n}function $Ie(n,e){const{colorMode:i}=U1();return i==="dark"?e:n}const TO={light:"chakra-ui-light",dark:"chakra-ui-dark"};function KIe(n={}){const{preventTransition:e=!0,nonce:i}=n,o={setDataset:l=>{const d=e?o.preventTransition():void 0;document.documentElement.dataset.theme=l,document.documentElement.style.colorScheme=l,d==null||d()},setClassName(l){document.body.classList.add(l?TO.dark:TO.light),document.body.classList.remove(l?TO.light:TO.dark)},query(){return window.matchMedia("(prefers-color-scheme: dark)")},getSystemTheme(l){return o.query().matches??l==="dark"?"dark":"light"},addListener(l){const d=o.query(),p=_=>{l(_.matches?"dark":"light")};return typeof d.addListener=="function"?d.addListener(p):d.addEventListener("change",p),()=>{typeof d.removeListener=="function"?d.removeListener(p):d.removeEventListener("change",p)}},preventTransition(){const l=document.createElement("style");return l.appendChild(document.createTextNode("*{-webkit-transition:none!important;-moz-transition:none!important;-o-transition:none!important;-ms-transition:none!important;transition:none!important}")),i!==void 0&&(l.nonce=i),document.head.appendChild(l),()=>{window.getComputedStyle(document.body),requestAnimationFrame(()=>{requestAnimationFrame(()=>{document.head.removeChild(l)})})}}};return o}const qIe="chakra-ui-color-mode";function YIe(n){return{ssr:!1,type:"localStorage",get(e){if(!(globalThis!=null&&globalThis.document))return e;let i;try{i=localStorage.getItem(n)||e}catch{}return i||e},set(e){try{localStorage.setItem(n,e)}catch{}}}}const XIe=YIe(qIe),vq=()=>{},JIe=hEe()?D.useLayoutEffect:D.useEffect;function Sq(n,e){return n.type==="cookie"&&n.ssr?n.get(e):e}const gee=function(e){const{value:i,children:o,options:{useSystemColorMode:l,initialColorMode:d,disableTransitionOnChange:p}={},colorModeManager:_=XIe}=e,E=UIe(),b=d==="dark"?"dark":"light",[C,I]=D.useState(()=>Sq(_,b)),[O,L]=D.useState(()=>Sq(_)),{getSystemTheme:V,setClassName:B,setDataset:W,addListener:Z}=D.useMemo(()=>KIe({preventTransition:p,nonce:E==null?void 0:E.nonce}),[p,E==null?void 0:E.nonce]),$=d==="system"&&!C?O:C,se=D.useCallback(pe=>{const q=pe==="system"?V():pe;I(q),B(q==="dark"),W(q),_.set(q)},[_,V,B,W]);JIe(()=>{d==="system"&&L(V())},[]),D.useEffect(()=>{const pe=_.get();if(pe){se(pe);return}if(d==="system"){se("system");return}se(b)},[_,b,d,se]);const ue=D.useCallback(()=>{se($==="dark"?"light":"dark")},[$,se]);D.useEffect(()=>{if(l)return Z(se)},[l,Z,se]);const re=D.useMemo(()=>({colorMode:i??$,toggleColorMode:i?vq:ue,setColorMode:i?vq:se,forced:i!==void 0}),[$,ue,se,i]);return w.jsx(YF.Provider,{value:re,children:o})};gee.displayName="ColorModeProvider";const _ee=String.raw,yee=_ee`
  :root,
  :host {
    --chakra-vh: 100vh;
  }

  @supports (height: -webkit-fill-available) {
    :root,
    :host {
      --chakra-vh: -webkit-fill-available;
    }
  }

  @supports (height: -moz-fill-available) {
    :root,
    :host {
      --chakra-vh: -moz-fill-available;
    }
  }

  @supports (height: 100dvh) {
    :root,
    :host {
      --chakra-vh: 100dvh;
    }
  }
`,QIe=()=>w.jsx(M1,{styles:yee}),ZIe=({scope:n=""})=>w.jsx(M1,{styles:_ee`
      html {
        line-height: 1.5;
        -webkit-text-size-adjust: 100%;
        font-family: system-ui, sans-serif;
        -webkit-font-smoothing: antialiased;
        text-rendering: optimizeLegibility;
        -moz-osx-font-smoothing: grayscale;
        touch-action: manipulation;
      }

      body {
        position: relative;
        min-height: 100%;
        margin: 0;
        font-feature-settings: "kern";
      }

      ${n} :where(*, *::before, *::after) {
        border-width: 0;
        border-style: solid;
        box-sizing: border-box;
        word-wrap: break-word;
      }

      main {
        display: block;
      }

      ${n} hr {
        border-top-width: 1px;
        box-sizing: content-box;
        height: 0;
        overflow: visible;
      }

      ${n} :where(pre, code, kbd,samp) {
        font-family: SFMono-Regular, Menlo, Monaco, Consolas, monospace;
        font-size: 1em;
      }

      ${n} a {
        background-color: transparent;
        color: inherit;
        text-decoration: inherit;
      }

      ${n} abbr[title] {
        border-bottom: none;
        text-decoration: underline;
        -webkit-text-decoration: underline dotted;
        text-decoration: underline dotted;
      }

      ${n} :where(b, strong) {
        font-weight: bold;
      }

      ${n} small {
        font-size: 80%;
      }

      ${n} :where(sub,sup) {
        font-size: 75%;
        line-height: 0;
        position: relative;
        vertical-align: baseline;
      }

      ${n} sub {
        bottom: -0.25em;
      }

      ${n} sup {
        top: -0.5em;
      }

      ${n} img {
        border-style: none;
      }

      ${n} :where(button, input, optgroup, select, textarea) {
        font-family: inherit;
        font-size: 100%;
        line-height: 1.15;
        margin: 0;
      }

      ${n} :where(button, input) {
        overflow: visible;
      }

      ${n} :where(button, select) {
        text-transform: none;
      }

      ${n} :where(
          button::-moz-focus-inner,
          [type="button"]::-moz-focus-inner,
          [type="reset"]::-moz-focus-inner,
          [type="submit"]::-moz-focus-inner
        ) {
        border-style: none;
        padding: 0;
      }

      ${n} fieldset {
        padding: 0.35em 0.75em 0.625em;
      }

      ${n} legend {
        box-sizing: border-box;
        color: inherit;
        display: table;
        max-width: 100%;
        padding: 0;
        white-space: normal;
      }

      ${n} progress {
        vertical-align: baseline;
      }

      ${n} textarea {
        overflow: auto;
      }

      ${n} :where([type="checkbox"], [type="radio"]) {
        box-sizing: border-box;
        padding: 0;
      }

      ${n} input[type="number"]::-webkit-inner-spin-button,
      ${n} input[type="number"]::-webkit-outer-spin-button {
        -webkit-appearance: none !important;
      }

      ${n} input[type="number"] {
        -moz-appearance: textfield;
      }

      ${n} input[type="search"] {
        -webkit-appearance: textfield;
        outline-offset: -2px;
      }

      ${n} input[type="search"]::-webkit-search-decoration {
        -webkit-appearance: none !important;
      }

      ${n} ::-webkit-file-upload-button {
        -webkit-appearance: button;
        font: inherit;
      }

      ${n} details {
        display: block;
      }

      ${n} summary {
        display: list-item;
      }

      template {
        display: none;
      }

      [hidden] {
        display: none !important;
      }

      ${n} :where(
          blockquote,
          dl,
          dd,
          h1,
          h2,
          h3,
          h4,
          h5,
          h6,
          hr,
          figure,
          p,
          pre
        ) {
        margin: 0;
      }

      ${n} button {
        background: transparent;
        padding: 0;
      }

      ${n} fieldset {
        margin: 0;
        padding: 0;
      }

      ${n} :where(ol, ul) {
        margin: 0;
        padding: 0;
      }

      ${n} textarea {
        resize: vertical;
      }

      ${n} :where(button, [role="button"]) {
        cursor: pointer;
      }

      ${n} button::-moz-focus-inner {
        border: 0 !important;
      }

      ${n} table {
        border-collapse: collapse;
      }

      ${n} :where(h1, h2, h3, h4, h5, h6) {
        font-size: inherit;
        font-weight: inherit;
      }

      ${n} :where(button, input, optgroup, select, textarea) {
        padding: 0;
        line-height: inherit;
        color: inherit;
      }

      ${n} :where(img, svg, video, canvas, audio, iframe, embed, object) {
        display: block;
      }

      ${n} :where(img, video) {
        max-width: 100%;
        height: auto;
      }

      [data-js-focus-visible]
        :focus:not([data-focus-visible-added]):not(
          [data-focus-visible-disabled]
        ) {
        outline: none;
        box-shadow: none;
      }

      ${n} select::-ms-expand {
        display: none;
      }

      ${yee}
    `});function eAe(n){const{cssVarsRoot:e,theme:i,children:o}=n,l=D.useMemo(()=>VSe(i),[i]);return w.jsxs(jIe,{theme:l,children:[w.jsx(tAe,{root:e}),o]})}function tAe({root:n=":host, :root"}){const e=[n,"[data-theme]"].join(",");return w.jsx(M1,{styles:i=>({[e]:i.__cssVars})})}Ni({name:"StylesContext",errorMessage:"useStyles: `styles` is undefined. Seems you forgot to wrap the components in `<StylesProvider />` "});function nAe(){const{colorMode:n}=U1();return w.jsx(M1,{styles:e=>{const i=CZ(e,"styles.global"),o=cl(i,{theme:e,colorMode:n});return o?zZ(o)(e):void 0}})}const[rAe,iAe]=Ni({strict:!1,name:"PortalManagerContext"});function XF(n){const{children:e,zIndex:i}=n;return w.jsx(rAe,{value:{zIndex:i},children:e})}XF.displayName="PortalManager";const JF=D.createContext({getDocument(){return document},getWindow(){return window}});JF.displayName="EnvironmentContext";function sAe({defer:n}={}){const[,e]=D.useReducer(i=>i+1,0);return Qh(()=>{n&&e()},[n]),D.useContext(JF)}function Eee(n){const{children:e,environment:i,disabled:o}=n,l=D.useRef(null),d=D.useMemo(()=>i||{getDocument:()=>{var _;return((_=l.current)==null?void 0:_.ownerDocument)??document},getWindow:()=>{var _;return((_=l.current)==null?void 0:_.ownerDocument.defaultView)??window}},[i]),p=!o||!i;return w.jsxs(JF.Provider,{value:d,children:[e,p&&w.jsx("span",{id:"__chakra_env",hidden:!0,ref:l})]})}Eee.displayName="EnvironmentProvider";const oAe=n=>{const{children:e,colorModeManager:i,portalZIndex:o,resetScope:l,resetCSS:d=!0,theme:p={},environment:_,cssVarsRoot:E,disableEnvironment:b,disableGlobalStyle:C}=n,I=w.jsx(Eee,{environment:_,disabled:b,children:e});return w.jsx(eAe,{theme:p,cssVarsRoot:E,children:w.jsxs(gee,{colorModeManager:i,options:p.config,children:[d?w.jsx(ZIe,{scope:l}):w.jsx(QIe,{}),!C&&w.jsx(nAe,{}),o?w.jsx(XF,{zIndex:o,children:I}):I]})})},QF=D.createContext({});function ZF(n){const e=D.useRef(null);return e.current===null&&(e.current=n()),e.current}const tR=D.createContext(null),ej=D.createContext({transformPagePoint:n=>n,isStatic:!1,reducedMotion:"never"});class aAe extends D.Component{getSnapshotBeforeUpdate(e){const i=this.props.childRef.current;if(i&&e.isPresent&&!this.props.isPresent){const o=this.props.sizeRef.current;o.height=i.offsetHeight||0,o.width=i.offsetWidth||0,o.top=i.offsetTop,o.left=i.offsetLeft}return null}componentDidUpdate(){}render(){return this.props.children}}function cAe({children:n,isPresent:e}){const i=D.useId(),o=D.useRef(null),l=D.useRef({width:0,height:0,top:0,left:0}),{nonce:d}=D.useContext(ej);return D.useInsertionEffect(()=>{const{width:p,height:_,top:E,left:b}=l.current;if(e||!o.current||!p||!_)return;o.current.dataset.motionPopId=i;const C=document.createElement("style");return d&&(C.nonce=d),document.head.appendChild(C),C.sheet&&C.sheet.insertRule(`
          [data-motion-pop-id="${i}"] {
            position: absolute !important;
            width: ${p}px !important;
            height: ${_}px !important;
            top: ${E}px !important;
            left: ${b}px !important;
          }
        `),()=>{document.head.removeChild(C)}},[e]),w.jsx(aAe,{isPresent:e,childRef:o,sizeRef:l,children:D.cloneElement(n,{ref:o})})}const lAe=({children:n,initial:e,isPresent:i,onExitComplete:o,custom:l,presenceAffectsLayout:d,mode:p})=>{const _=ZF(uAe),E=D.useId(),b=D.useCallback(I=>{_.set(I,!0);for(const O of _.values())if(!O)return;o&&o()},[_,o]),C=D.useMemo(()=>({id:E,initial:e,isPresent:i,custom:l,onExitComplete:b,register:I=>(_.set(I,!1),()=>_.delete(I))}),d?[Math.random(),b]:[i,b]);return D.useMemo(()=>{_.forEach((I,O)=>_.set(O,!1))},[i]),D.useEffect(()=>{!i&&!_.size&&o&&o()},[i]),p==="popLayout"&&(n=w.jsx(cAe,{isPresent:i,children:n})),w.jsx(tR.Provider,{value:C,children:n})};function uAe(){return new Map}function tj(n=!0){const e=D.useContext(tR);if(e===null)return[!0,null];const{isPresent:i,onExitComplete:o,register:l}=e,d=D.useId();D.useEffect(()=>{n&&l(d)},[n]);const p=D.useCallback(()=>n&&o&&o(d),[d,o,n]);return!i&&o?[!1,p]:[!0]}function dAe(){return hAe(D.useContext(tR))}function hAe(n){return n===null?!0:n.isPresent}const wO=n=>n.key||"";function bq(n){const e=[];return D.Children.forEach(n,i=>{D.isValidElement(i)&&e.push(i)}),e}const nj=typeof window<"u",vee=nj?D.useLayoutEffect:D.useEffect,j0=({children:n,custom:e,initial:i=!0,onExitComplete:o,presenceAffectsLayout:l=!0,mode:d="sync",propagate:p=!1})=>{const[_,E]=tj(p),b=D.useMemo(()=>bq(n),[n]),C=p&&!_?[]:b.map(wO),I=D.useRef(!0),O=D.useRef(b),L=ZF(()=>new Map),[V,B]=D.useState(b),[W,Z]=D.useState(b);vee(()=>{I.current=!1,O.current=b;for(let ue=0;ue<W.length;ue++){const re=wO(W[ue]);C.includes(re)?L.delete(re):L.get(re)!==!0&&L.set(re,!1)}},[W,C.length,C.join("-")]);const $=[];if(b!==V){let ue=[...b];for(let re=0;re<W.length;re++){const pe=W[re],q=wO(pe);C.includes(q)||(ue.splice(re,0,pe),$.push(pe))}d==="wait"&&$.length&&(ue=$),Z(bq(ue)),B(b);return}const{forceRender:se}=D.useContext(QF);return w.jsx(w.Fragment,{children:W.map(ue=>{const re=wO(ue),pe=p&&!_?!1:b===W||C.includes(re),q=()=>{if(L.has(re))L.set(re,!0);else return;let Q=!0;L.forEach(J=>{J||(Q=!1)}),Q&&(se==null||se(),Z(O.current),p&&(E==null||E()),o&&o())};return w.jsx(lAe,{isPresent:pe,initial:!I.current||i?void 0:!1,custom:pe?void 0:e,presenceAffectsLayout:l,mode:d,onExitComplete:pe?void 0:q,children:ue},re)})})},Bl=n=>n;let See=Bl;function rj(n){let e;return()=>(e===void 0&&(e=n()),e)}const g0=(n,e,i)=>{const o=e-n;return o===0?1:(i-n)/o},xp=n=>n*1e3,Lp=n=>n/1e3,fAe={useManualTiming:!1};function pAe(n){let e=new Set,i=new Set,o=!1,l=!1;const d=new WeakSet;let p={delta:0,timestamp:0,isProcessing:!1};function _(b){d.has(b)&&(E.schedule(b),n()),b(p)}const E={schedule:(b,C=!1,I=!1)=>{const L=I&&o?e:i;return C&&d.add(b),L.has(b)||L.add(b),b},cancel:b=>{i.delete(b),d.delete(b)},process:b=>{if(p=b,o){l=!0;return}o=!0,[e,i]=[i,e],e.forEach(_),e.clear(),o=!1,l&&(l=!1,E.process(b))}};return E}const CO=["read","resolveKeyframes","update","preRender","render","postRender"],mAe=40;function bee(n,e){let i=!1,o=!0;const l={delta:0,timestamp:0,isProcessing:!1},d=()=>i=!0,p=CO.reduce((Z,$)=>(Z[$]=pAe(d),Z),{}),{read:_,resolveKeyframes:E,update:b,preRender:C,render:I,postRender:O}=p,L=()=>{const Z=performance.now();i=!1,l.delta=o?1e3/60:Math.max(Math.min(Z-l.timestamp,mAe),1),l.timestamp=Z,l.isProcessing=!0,_.process(l),E.process(l),b.process(l),C.process(l),I.process(l),O.process(l),l.isProcessing=!1,i&&e&&(o=!1,n(L))},V=()=>{i=!0,o=!0,l.isProcessing||n(L)};return{schedule:CO.reduce((Z,$)=>{const se=p[$];return Z[$]=(ue,re=!1,pe=!1)=>(i||V(),se.schedule(ue,re,pe)),Z},{}),cancel:Z=>{for(let $=0;$<CO.length;$++)p[CO[$]].cancel(Z)},state:l,steps:p}}const{schedule:rs,cancel:Ag,state:_a,steps:zM}=bee(typeof requestAnimationFrame<"u"?requestAnimationFrame:Bl,!0),Tee=D.createContext({strict:!1}),Tq={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},_0={};for(const n in Tq)_0[n]={isEnabled:e=>Tq[n].some(i=>!!e[i])};function gAe(n){for(const e in n)_0[e]={..._0[e],...n[e]}}const _Ae=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function Fk(n){return n.startsWith("while")||n.startsWith("drag")&&n!=="draggable"||n.startsWith("layout")||n.startsWith("onTap")||n.startsWith("onPan")||n.startsWith("onLayout")||_Ae.has(n)}let wee=n=>!Fk(n);function yAe(n){n&&(wee=e=>e.startsWith("on")?!Fk(e):n(e))}try{yAe(require("@emotion/is-prop-valid").default)}catch{}function EAe(n,e,i){const o={};for(const l in n)l==="values"&&typeof n.values=="object"||(wee(l)||i===!0&&Fk(l)||!e&&!Fk(l)||n.draggable&&l.startsWith("onDrag"))&&(o[l]=n[l]);return o}function vAe(n){if(typeof Proxy>"u")return n;const e=new Map,i=(...o)=>n(...o);return new Proxy(i,{get:(o,l)=>l==="create"?n:(e.has(l)||e.set(l,n(l)),e.get(l))})}const V1=D.createContext({});function IC(n){return typeof n=="string"||Array.isArray(n)}function F1(n){return n!==null&&typeof n=="object"&&typeof n.start=="function"}const ij=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],sj=["initial",...ij];function j1(n){return F1(n.animate)||sj.some(e=>IC(n[e]))}function Cee(n){return!!(j1(n)||n.variants)}function SAe(n,e){if(j1(n)){const{initial:i,animate:o}=n;return{initial:i===!1||IC(i)?i:void 0,animate:IC(o)?o:void 0}}return n.inherit!==!1?e:{}}function bAe(n){const{initial:e,animate:i}=SAe(n,D.useContext(V1));return D.useMemo(()=>({initial:e,animate:i}),[wq(e),wq(i)])}function wq(n){return Array.isArray(n)?n.join(" "):n}const TAe=Symbol.for("motionComponentSymbol");function BS(n){return n&&typeof n=="object"&&Object.prototype.hasOwnProperty.call(n,"current")}function wAe(n,e,i){return D.useCallback(o=>{o&&n.onMount&&n.onMount(o),e&&(o?e.mount(o):e.unmount()),i&&(typeof i=="function"?i(o):BS(i)&&(i.current=o))},[e])}const oj=n=>n.replace(/([a-z])([A-Z])/gu,"$1-$2").toLowerCase(),CAe="framerAppearId",Ree="data-"+oj(CAe),{schedule:aj}=bee(queueMicrotask,!1),Iee=D.createContext({});function RAe(n,e,i,o,l){var d,p;const{visualElement:_}=D.useContext(V1),E=D.useContext(Tee),b=D.useContext(tR),C=D.useContext(ej).reducedMotion,I=D.useRef(null);o=o||E.renderer,!I.current&&o&&(I.current=o(n,{visualState:e,parent:_,props:i,presenceContext:b,blockInitialAnimation:b?b.initial===!1:!1,reducedMotionConfig:C}));const O=I.current,L=D.useContext(Iee);O&&!O.projection&&l&&(O.type==="html"||O.type==="svg")&&IAe(I.current,i,l,L);const V=D.useRef(!1);D.useInsertionEffect(()=>{O&&V.current&&O.update(i,b)});const B=i[Ree],W=D.useRef(!!B&&!(!((d=window.MotionHandoffIsComplete)===null||d===void 0)&&d.call(window,B))&&((p=window.MotionHasOptimisedAnimation)===null||p===void 0?void 0:p.call(window,B)));return vee(()=>{O&&(V.current=!0,window.MotionIsMounted=!0,O.updateFeatures(),aj.render(O.render),W.current&&O.animationState&&O.animationState.animateChanges())}),D.useEffect(()=>{O&&(!W.current&&O.animationState&&O.animationState.animateChanges(),W.current&&(queueMicrotask(()=>{var Z;(Z=window.MotionHandoffMarkAsComplete)===null||Z===void 0||Z.call(window,B)}),W.current=!1))}),O}function IAe(n,e,i,o){const{layoutId:l,layout:d,drag:p,dragConstraints:_,layoutScroll:E,layoutRoot:b}=e;n.projection=new i(n.latestValues,e["data-framer-portal-id"]?void 0:Aee(n.parent)),n.projection.setOptions({layoutId:l,layout:d,alwaysMeasureLayout:!!p||_&&BS(_),visualElement:n,animationType:typeof d=="string"?d:"both",initialPromotionConfig:o,layoutScroll:E,layoutRoot:b})}function Aee(n){if(n)return n.options.allowProjection!==!1?n.projection:Aee(n.parent)}function AAe({preloadedFeatures:n,createVisualElement:e,useRender:i,useVisualState:o,Component:l}){var d,p;n&&gAe(n);function _(b,C){let I;const O={...D.useContext(ej),...b,layoutId:PAe(b)},{isStatic:L}=O,V=bAe(b),B=o(b,L);if(!L&&nj){OAe();const W=kAe(O);I=W.MeasureLayout,V.visualElement=RAe(l,B,O,e,W.ProjectionNode)}return w.jsxs(V1.Provider,{value:V,children:[I&&V.visualElement?w.jsx(I,{visualElement:V.visualElement,...O}):null,i(l,b,wAe(B,V.visualElement,C),B,L,V.visualElement)]})}_.displayName=`motion.${typeof l=="string"?l:`create(${(p=(d=l.displayName)!==null&&d!==void 0?d:l.name)!==null&&p!==void 0?p:""})`}`;const E=D.forwardRef(_);return E[TAe]=l,E}function PAe({layoutId:n}){const e=D.useContext(QF).id;return e&&n!==void 0?e+"-"+n:n}function OAe(n,e){D.useContext(Tee).strict}function kAe(n){const{drag:e,layout:i}=_0;if(!e&&!i)return{};const o={...e,...i};return{MeasureLayout:e!=null&&e.isEnabled(n)||i!=null&&i.isEnabled(n)?o.MeasureLayout:void 0,ProjectionNode:o.ProjectionNode}}const NAe=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function cj(n){return typeof n!="string"||n.includes("-")?!1:!!(NAe.indexOf(n)>-1||/[A-Z]/u.test(n))}function Cq(n){const e=[{},{}];return n==null||n.values.forEach((i,o)=>{e[0][o]=i.get(),e[1][o]=i.getVelocity()}),e}function lj(n,e,i,o){if(typeof e=="function"){const[l,d]=Cq(o);e=e(i!==void 0?i:n.custom,l,d)}if(typeof e=="string"&&(e=n.variants&&n.variants[e]),typeof e=="function"){const[l,d]=Cq(o);e=e(i!==void 0?i:n.custom,l,d)}return e}const iV=n=>Array.isArray(n),DAe=n=>!!(n&&typeof n=="object"&&n.mix&&n.toValue),xAe=n=>iV(n)?n[n.length-1]||0:n,Qa=n=>!!(n&&n.getVelocity);function ck(n){const e=Qa(n)?n.get():n;return DAe(e)?e.toValue():e}function LAe({scrapeMotionValuesFromProps:n,createRenderState:e,onUpdate:i},o,l,d){const p={latestValues:MAe(o,l,d,n),renderState:e()};return i&&(p.onMount=_=>i({props:o,current:_,...p}),p.onUpdate=_=>i(_)),p}const Pee=n=>(e,i)=>{const o=D.useContext(V1),l=D.useContext(tR),d=()=>LAe(n,e,o,l);return i?d():ZF(d)};function MAe(n,e,i,o){const l={},d=o(n,{});for(const O in d)l[O]=ck(d[O]);let{initial:p,animate:_}=n;const E=j1(n),b=Cee(n);e&&b&&!E&&n.inherit!==!1&&(p===void 0&&(p=e.initial),_===void 0&&(_=e.animate));let C=i?i.initial===!1:!1;C=C||p===!1;const I=C?_:p;if(I&&typeof I!="boolean"&&!F1(I)){const O=Array.isArray(I)?I:[I];for(let L=0;L<O.length;L++){const V=lj(n,O[L]);if(V){const{transitionEnd:B,transition:W,...Z}=V;for(const $ in Z){let se=Z[$];if(Array.isArray(se)){const ue=C?se.length-1:0;se=se[ue]}se!==null&&(l[$]=se)}for(const $ in B)l[$]=B[$]}}}return l}const B0=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],Jy=new Set(B0),Oee=n=>e=>typeof e=="string"&&e.startsWith(n),kee=Oee("--"),UAe=Oee("var(--"),uj=n=>UAe(n)?VAe.test(n.split("/*")[0].trim()):!1,VAe=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu,Nee=(n,e)=>e&&typeof n=="number"?e.transform(n):n,Bp=(n,e,i)=>i>e?e:i<n?n:i,W0={test:n=>typeof n=="number",parse:parseFloat,transform:n=>n},AC={...W0,transform:n=>Bp(0,1,n)},RO={...W0,default:1},nR=n=>({test:e=>typeof e=="string"&&e.endsWith(n)&&e.split(" ").length===1,parse:parseFloat,transform:e=>`${e}${n}`}),dg=nR("deg"),tf=nR("%"),Fn=nR("px"),FAe=nR("vh"),jAe=nR("vw"),Rq={...tf,parse:n=>tf.parse(n)/100,transform:n=>tf.transform(n*100)},BAe={borderWidth:Fn,borderTopWidth:Fn,borderRightWidth:Fn,borderBottomWidth:Fn,borderLeftWidth:Fn,borderRadius:Fn,radius:Fn,borderTopLeftRadius:Fn,borderTopRightRadius:Fn,borderBottomRightRadius:Fn,borderBottomLeftRadius:Fn,width:Fn,maxWidth:Fn,height:Fn,maxHeight:Fn,top:Fn,right:Fn,bottom:Fn,left:Fn,padding:Fn,paddingTop:Fn,paddingRight:Fn,paddingBottom:Fn,paddingLeft:Fn,margin:Fn,marginTop:Fn,marginRight:Fn,marginBottom:Fn,marginLeft:Fn,backgroundPositionX:Fn,backgroundPositionY:Fn},WAe={rotate:dg,rotateX:dg,rotateY:dg,rotateZ:dg,scale:RO,scaleX:RO,scaleY:RO,scaleZ:RO,skew:dg,skewX:dg,skewY:dg,distance:Fn,translateX:Fn,translateY:Fn,translateZ:Fn,x:Fn,y:Fn,z:Fn,perspective:Fn,transformPerspective:Fn,opacity:AC,originX:Rq,originY:Rq,originZ:Fn},Iq={...W0,transform:Math.round},dj={...BAe,...WAe,zIndex:Iq,size:Fn,fillOpacity:AC,strokeOpacity:AC,numOctaves:Iq},zAe={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},GAe=B0.length;function HAe(n,e,i){let o="",l=!0;for(let d=0;d<GAe;d++){const p=B0[d],_=n[p];if(_===void 0)continue;let E=!0;if(typeof _=="number"?E=_===(p.startsWith("scale")?1:0):E=parseFloat(_)===0,!E||i){const b=Nee(_,dj[p]);if(!E){l=!1;const C=zAe[p]||p;o+=`${C}(${b}) `}i&&(e[p]=b)}}return o=o.trim(),i?o=i(e,l?"":o):l&&(o="none"),o}function hj(n,e,i){const{style:o,vars:l,transformOrigin:d}=n;let p=!1,_=!1;for(const E in e){const b=e[E];if(Jy.has(E)){p=!0;continue}else if(kee(E)){l[E]=b;continue}else{const C=Nee(b,dj[E]);E.startsWith("origin")?(_=!0,d[E]=C):o[E]=C}}if(e.transform||(p||i?o.transform=HAe(e,n.transform,i):o.transform&&(o.transform="none")),_){const{originX:E="50%",originY:b="50%",originZ:C=0}=d;o.transformOrigin=`${E} ${b} ${C}`}}const $Ae={offset:"stroke-dashoffset",array:"stroke-dasharray"},KAe={offset:"strokeDashoffset",array:"strokeDasharray"};function qAe(n,e,i=1,o=0,l=!0){n.pathLength=1;const d=l?$Ae:KAe;n[d.offset]=Fn.transform(-o);const p=Fn.transform(e),_=Fn.transform(i);n[d.array]=`${p} ${_}`}function Aq(n,e,i){return typeof n=="string"?n:Fn.transform(e+i*n)}function YAe(n,e,i){const o=Aq(e,n.x,n.width),l=Aq(i,n.y,n.height);return`${o} ${l}`}function fj(n,{attrX:e,attrY:i,attrScale:o,originX:l,originY:d,pathLength:p,pathSpacing:_=1,pathOffset:E=0,...b},C,I){if(hj(n,b,I),C){n.style.viewBox&&(n.attrs.viewBox=n.style.viewBox);return}n.attrs=n.style,n.style={};const{attrs:O,style:L,dimensions:V}=n;O.transform&&(V&&(L.transform=O.transform),delete O.transform),V&&(l!==void 0||d!==void 0||L.transform)&&(L.transformOrigin=YAe(V,l!==void 0?l:.5,d!==void 0?d:.5)),e!==void 0&&(O.x=e),i!==void 0&&(O.y=i),o!==void 0&&(O.scale=o),p!==void 0&&qAe(O,p,_,E,!1)}const pj=()=>({style:{},transform:{},transformOrigin:{},vars:{}}),Dee=()=>({...pj(),attrs:{}}),mj=n=>typeof n=="string"&&n.toLowerCase()==="svg";function xee(n,{style:e,vars:i},o,l){Object.assign(n.style,e,l&&l.getProjectionStyles(o));for(const d in i)n.style.setProperty(d,i[d])}const Lee=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);function Mee(n,e,i,o){xee(n,e,void 0,o);for(const l in e.attrs)n.setAttribute(Lee.has(l)?l:oj(l),e.attrs[l])}const jk={};function XAe(n){Object.assign(jk,n)}function Uee(n,{layout:e,layoutId:i}){return Jy.has(n)||n.startsWith("origin")||(e||i!==void 0)&&(!!jk[n]||n==="opacity")}function gj(n,e,i){var o;const{style:l}=n,d={};for(const p in l)(Qa(l[p])||e.style&&Qa(e.style[p])||Uee(p,n)||((o=i==null?void 0:i.getValue(p))===null||o===void 0?void 0:o.liveStyle)!==void 0)&&(d[p]=l[p]);return d}function Vee(n,e,i){const o=gj(n,e,i);for(const l in n)if(Qa(n[l])||Qa(e[l])){const d=B0.indexOf(l)!==-1?"attr"+l.charAt(0).toUpperCase()+l.substring(1):l;o[d]=n[l]}return o}function JAe(n,e){try{e.dimensions=typeof n.getBBox=="function"?n.getBBox():n.getBoundingClientRect()}catch{e.dimensions={x:0,y:0,width:0,height:0}}}const Pq=["x","y","width","height","cx","cy","r"],QAe={useVisualState:Pee({scrapeMotionValuesFromProps:Vee,createRenderState:Dee,onUpdate:({props:n,prevProps:e,current:i,renderState:o,latestValues:l})=>{if(!i)return;let d=!!n.drag;if(!d){for(const _ in l)if(Jy.has(_)){d=!0;break}}if(!d)return;let p=!e;if(e)for(let _=0;_<Pq.length;_++){const E=Pq[_];n[E]!==e[E]&&(p=!0)}p&&rs.read(()=>{JAe(i,o),rs.render(()=>{fj(o,l,mj(i.tagName),n.transformTemplate),Mee(i,o)})})}})},ZAe={useVisualState:Pee({scrapeMotionValuesFromProps:gj,createRenderState:pj})};function Fee(n,e,i){for(const o in e)!Qa(e[o])&&!Uee(o,i)&&(n[o]=e[o])}function ePe({transformTemplate:n},e){return D.useMemo(()=>{const i=pj();return hj(i,e,n),Object.assign({},i.vars,i.style)},[e])}function tPe(n,e){const i=n.style||{},o={};return Fee(o,i,n),Object.assign(o,ePe(n,e)),o}function nPe(n,e){const i={},o=tPe(n,e);return n.drag&&n.dragListener!==!1&&(i.draggable=!1,o.userSelect=o.WebkitUserSelect=o.WebkitTouchCallout="none",o.touchAction=n.drag===!0?"none":`pan-${n.drag==="x"?"y":"x"}`),n.tabIndex===void 0&&(n.onTap||n.onTapStart||n.whileTap)&&(i.tabIndex=0),i.style=o,i}function rPe(n,e,i,o){const l=D.useMemo(()=>{const d=Dee();return fj(d,e,mj(o),n.transformTemplate),{...d.attrs,style:{...d.style}}},[e]);if(n.style){const d={};Fee(d,n.style,n),l.style={...d,...l.style}}return l}function iPe(n=!1){return(i,o,l,{latestValues:d},p)=>{const E=(cj(i)?rPe:nPe)(o,d,p,i),b=EAe(o,typeof i=="string",n),C=i!==D.Fragment?{...b,...E,ref:l}:{},{children:I}=o,O=D.useMemo(()=>Qa(I)?I.get():I,[I]);return D.createElement(i,{...C,children:O})}}function sPe(n,e){return function(o,{forwardMotionProps:l}={forwardMotionProps:!1}){const p={...cj(o)?QAe:ZAe,preloadedFeatures:n,useRender:iPe(l),createVisualElement:e,Component:o};return AAe(p)}}function jee(n,e){if(!Array.isArray(e))return!1;const i=e.length;if(i!==n.length)return!1;for(let o=0;o<i;o++)if(e[o]!==n[o])return!1;return!0}function B1(n,e,i){const o=n.getProps();return lj(o,e,i!==void 0?i:o.custom,n)}const oPe=rj(()=>window.ScrollTimeline!==void 0);class aPe{constructor(e){this.stop=()=>this.runAll("stop"),this.animations=e.filter(Boolean)}get finished(){return Promise.all(this.animations.map(e=>"finished"in e?e.finished:e))}getAll(e){return this.animations[0][e]}setAll(e,i){for(let o=0;o<this.animations.length;o++)this.animations[o][e]=i}attachTimeline(e,i){const o=this.animations.map(l=>{if(oPe()&&l.attachTimeline)return l.attachTimeline(e);if(typeof i=="function")return i(l)});return()=>{o.forEach((l,d)=>{l&&l(),this.animations[d].stop()})}}get time(){return this.getAll("time")}set time(e){this.setAll("time",e)}get speed(){return this.getAll("speed")}set speed(e){this.setAll("speed",e)}get startTime(){return this.getAll("startTime")}get duration(){let e=0;for(let i=0;i<this.animations.length;i++)e=Math.max(e,this.animations[i].duration);return e}runAll(e){this.animations.forEach(i=>i[e]())}flatten(){this.runAll("flatten")}play(){this.runAll("play")}pause(){this.runAll("pause")}cancel(){this.runAll("cancel")}complete(){this.runAll("complete")}}class cPe extends aPe{then(e,i){return Promise.all(this.animations).then(e).catch(i)}}function _j(n,e){return n?n[e]||n.default||n:void 0}const sV=2e4;function Bee(n){let e=0;const i=50;let o=n.next(e);for(;!o.done&&e<sV;)e+=i,o=n.next(e);return e>=sV?1/0:e}function yj(n){return typeof n=="function"}function Oq(n,e){n.timeline=e,n.onfinish=null}const Ej=n=>Array.isArray(n)&&typeof n[0]=="number",lPe={linearEasing:void 0};function uPe(n,e){const i=rj(n);return()=>{var o;return(o=lPe[e])!==null&&o!==void 0?o:i()}}const Bk=uPe(()=>{try{document.createElement("div").animate({opacity:0},{easing:"linear(0, 1)"})}catch{return!1}return!0},"linearEasing"),Wee=(n,e,i=10)=>{let o="";const l=Math.max(Math.round(e/i),2);for(let d=0;d<l;d++)o+=n(g0(0,l-1,d))+", ";return`linear(${o.substring(0,o.length-2)})`};function zee(n){return!!(typeof n=="function"&&Bk()||!n||typeof n=="string"&&(n in oV||Bk())||Ej(n)||Array.isArray(n)&&n.every(zee))}const Ww=([n,e,i,o])=>`cubic-bezier(${n}, ${e}, ${i}, ${o})`,oV={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:Ww([0,.65,.55,1]),circOut:Ww([.55,0,1,.45]),backIn:Ww([.31,.01,.66,-.59]),backOut:Ww([.33,1.53,.69,.99])};function Gee(n,e){if(n)return typeof n=="function"&&Bk()?Wee(n,e):Ej(n)?Ww(n):Array.isArray(n)?n.map(i=>Gee(i,e)||oV.easeOut):oV[n]}const kd={x:!1,y:!1};function Hee(){return kd.x||kd.y}function dPe(n,e,i){var o;if(n instanceof Element)return[n];if(typeof n=="string"){let l=document;const d=(o=void 0)!==null&&o!==void 0?o:l.querySelectorAll(n);return d?Array.from(d):[]}return Array.from(n)}function $ee(n,e){const i=dPe(n),o=new AbortController,l={passive:!0,...e,signal:o.signal};return[i,l,()=>o.abort()]}function kq(n){return e=>{e.pointerType==="touch"||Hee()||n(e)}}function hPe(n,e,i={}){const[o,l,d]=$ee(n,i),p=kq(_=>{const{target:E}=_,b=e(_);if(typeof b!="function"||!E)return;const C=kq(I=>{b(I),E.removeEventListener("pointerleave",C)});E.addEventListener("pointerleave",C,l)});return o.forEach(_=>{_.addEventListener("pointerenter",p,l)}),d}const Kee=(n,e)=>e?n===e?!0:Kee(n,e.parentElement):!1,vj=n=>n.pointerType==="mouse"?typeof n.button!="number"||n.button<=0:n.isPrimary!==!1,fPe=new Set(["BUTTON","INPUT","SELECT","TEXTAREA","A"]);function pPe(n){return fPe.has(n.tagName)||n.tabIndex!==-1}const zw=new WeakSet;function Nq(n){return e=>{e.key==="Enter"&&n(e)}}function GM(n,e){n.dispatchEvent(new PointerEvent("pointer"+e,{isPrimary:!0,bubbles:!0}))}const mPe=(n,e)=>{const i=n.currentTarget;if(!i)return;const o=Nq(()=>{if(zw.has(i))return;GM(i,"down");const l=Nq(()=>{GM(i,"up")}),d=()=>GM(i,"cancel");i.addEventListener("keyup",l,e),i.addEventListener("blur",d,e)});i.addEventListener("keydown",o,e),i.addEventListener("blur",()=>i.removeEventListener("keydown",o),e)};function Dq(n){return vj(n)&&!Hee()}function gPe(n,e,i={}){const[o,l,d]=$ee(n,i),p=_=>{const E=_.currentTarget;if(!Dq(_)||zw.has(E))return;zw.add(E);const b=e(_),C=(L,V)=>{window.removeEventListener("pointerup",I),window.removeEventListener("pointercancel",O),!(!Dq(L)||!zw.has(E))&&(zw.delete(E),typeof b=="function"&&b(L,{success:V}))},I=L=>{C(L,i.useGlobalTarget||Kee(E,L.target))},O=L=>{C(L,!1)};window.addEventListener("pointerup",I,l),window.addEventListener("pointercancel",O,l)};return o.forEach(_=>{!pPe(_)&&_.getAttribute("tabindex")===null&&(_.tabIndex=0),(i.useGlobalTarget?window:_).addEventListener("pointerdown",p,l),_.addEventListener("focus",b=>mPe(b,l),l)}),d}function _Pe(n){return n==="x"||n==="y"?kd[n]?null:(kd[n]=!0,()=>{kd[n]=!1}):kd.x||kd.y?null:(kd.x=kd.y=!0,()=>{kd.x=kd.y=!1})}const qee=new Set(["width","height","top","left","right","bottom",...B0]);let lk;function yPe(){lk=void 0}const nf={now:()=>(lk===void 0&&nf.set(_a.isProcessing||fAe.useManualTiming?_a.timestamp:performance.now()),lk),set:n=>{lk=n,queueMicrotask(yPe)}};function Sj(n,e){n.indexOf(e)===-1&&n.push(e)}function bj(n,e){const i=n.indexOf(e);i>-1&&n.splice(i,1)}class Tj{constructor(){this.subscriptions=[]}add(e){return Sj(this.subscriptions,e),()=>bj(this.subscriptions,e)}notify(e,i,o){const l=this.subscriptions.length;if(l)if(l===1)this.subscriptions[0](e,i,o);else for(let d=0;d<l;d++){const p=this.subscriptions[d];p&&p(e,i,o)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}function Yee(n,e){return e?n*(1e3/e):0}const xq=30,EPe=n=>!isNaN(parseFloat(n));class vPe{constructor(e,i={}){this.version="11.18.2",this.canTrackVelocity=null,this.events={},this.updateAndNotify=(o,l=!0)=>{const d=nf.now();this.updatedAt!==d&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(o),this.current!==this.prev&&this.events.change&&this.events.change.notify(this.current),l&&this.events.renderRequest&&this.events.renderRequest.notify(this.current)},this.hasAnimated=!1,this.setCurrent(e),this.owner=i.owner}setCurrent(e){this.current=e,this.updatedAt=nf.now(),this.canTrackVelocity===null&&e!==void 0&&(this.canTrackVelocity=EPe(this.current))}setPrevFrameValue(e=this.current){this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt}onChange(e){return this.on("change",e)}on(e,i){this.events[e]||(this.events[e]=new Tj);const o=this.events[e].add(i);return e==="change"?()=>{o(),rs.read(()=>{this.events.change.getSize()||this.stop()})}:o}clearListeners(){for(const e in this.events)this.events[e].clear()}attach(e,i){this.passiveEffect=e,this.stopPassiveEffect=i}set(e,i=!0){!i||!this.passiveEffect?this.updateAndNotify(e,i):this.passiveEffect(e,this.updateAndNotify)}setWithVelocity(e,i,o){this.set(i),this.prev=void 0,this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt-o}jump(e,i=!0){this.updateAndNotify(e),this.prev=e,this.prevUpdatedAt=this.prevFrameValue=void 0,i&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}get(){return this.current}getPrevious(){return this.prev}getVelocity(){const e=nf.now();if(!this.canTrackVelocity||this.prevFrameValue===void 0||e-this.updatedAt>xq)return 0;const i=Math.min(this.updatedAt-this.prevUpdatedAt,xq);return Yee(parseFloat(this.current)-parseFloat(this.prevFrameValue),i)}start(e){return this.stop(),new Promise(i=>{this.hasAnimated=!0,this.animation=e(i),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function PC(n,e){return new vPe(n,e)}function SPe(n,e,i){n.hasValue(e)?n.getValue(e).set(i):n.addValue(e,PC(i))}function bPe(n,e){const i=B1(n,e);let{transitionEnd:o={},transition:l={},...d}=i||{};d={...d,...o};for(const p in d){const _=xAe(d[p]);SPe(n,p,_)}}function TPe(n){return!!(Qa(n)&&n.add)}function aV(n,e){const i=n.getValue("willChange");if(TPe(i))return i.add(e)}function Xee(n){return n.props[Ree]}const Jee=(n,e,i)=>(((1-3*i+3*e)*n+(3*i-6*e))*n+3*e)*n,wPe=1e-7,CPe=12;function RPe(n,e,i,o,l){let d,p,_=0;do p=e+(i-e)/2,d=Jee(p,o,l)-n,d>0?i=p:e=p;while(Math.abs(d)>wPe&&++_<CPe);return p}function rR(n,e,i,o){if(n===e&&i===o)return Bl;const l=d=>RPe(d,0,1,n,i);return d=>d===0||d===1?d:Jee(l(d),e,o)}const Qee=n=>e=>e<=.5?n(2*e)/2:(2-n(2*(1-e)))/2,Zee=n=>e=>1-n(1-e),ete=rR(.33,1.53,.69,.99),wj=Zee(ete),tte=Qee(wj),nte=n=>(n*=2)<1?.5*wj(n):.5*(2-Math.pow(2,-10*(n-1))),Cj=n=>1-Math.sin(Math.acos(n)),rte=Zee(Cj),ite=Qee(Cj),ste=n=>/^0[^.\s]+$/u.test(n);function IPe(n){return typeof n=="number"?n===0:n!==null?n==="none"||n==="0"||ste(n):!0}const oC=n=>Math.round(n*1e5)/1e5,Rj=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu;function APe(n){return n==null}const PPe=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu,Ij=(n,e)=>i=>!!(typeof i=="string"&&PPe.test(i)&&i.startsWith(n)||e&&!APe(i)&&Object.prototype.hasOwnProperty.call(i,e)),ote=(n,e,i)=>o=>{if(typeof o!="string")return o;const[l,d,p,_]=o.match(Rj);return{[n]:parseFloat(l),[e]:parseFloat(d),[i]:parseFloat(p),alpha:_!==void 0?parseFloat(_):1}},OPe=n=>Bp(0,255,n),HM={...W0,transform:n=>Math.round(OPe(n))},Ty={test:Ij("rgb","red"),parse:ote("red","green","blue"),transform:({red:n,green:e,blue:i,alpha:o=1})=>"rgba("+HM.transform(n)+", "+HM.transform(e)+", "+HM.transform(i)+", "+oC(AC.transform(o))+")"};function kPe(n){let e="",i="",o="",l="";return n.length>5?(e=n.substring(1,3),i=n.substring(3,5),o=n.substring(5,7),l=n.substring(7,9)):(e=n.substring(1,2),i=n.substring(2,3),o=n.substring(3,4),l=n.substring(4,5),e+=e,i+=i,o+=o,l+=l),{red:parseInt(e,16),green:parseInt(i,16),blue:parseInt(o,16),alpha:l?parseInt(l,16)/255:1}}const cV={test:Ij("#"),parse:kPe,transform:Ty.transform},WS={test:Ij("hsl","hue"),parse:ote("hue","saturation","lightness"),transform:({hue:n,saturation:e,lightness:i,alpha:o=1})=>"hsla("+Math.round(n)+", "+tf.transform(oC(e))+", "+tf.transform(oC(i))+", "+oC(AC.transform(o))+")"},Ya={test:n=>Ty.test(n)||cV.test(n)||WS.test(n),parse:n=>Ty.test(n)?Ty.parse(n):WS.test(n)?WS.parse(n):cV.parse(n),transform:n=>typeof n=="string"?n:n.hasOwnProperty("red")?Ty.transform(n):WS.transform(n)},NPe=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu;function DPe(n){var e,i;return isNaN(n)&&typeof n=="string"&&(((e=n.match(Rj))===null||e===void 0?void 0:e.length)||0)+(((i=n.match(NPe))===null||i===void 0?void 0:i.length)||0)>0}const ate="number",cte="color",xPe="var",LPe="var(",Lq="${}",MPe=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function OC(n){const e=n.toString(),i=[],o={color:[],number:[],var:[]},l=[];let d=0;const _=e.replace(MPe,E=>(Ya.test(E)?(o.color.push(d),l.push(cte),i.push(Ya.parse(E))):E.startsWith(LPe)?(o.var.push(d),l.push(xPe),i.push(E)):(o.number.push(d),l.push(ate),i.push(parseFloat(E))),++d,Lq)).split(Lq);return{values:i,split:_,indexes:o,types:l}}function lte(n){return OC(n).values}function ute(n){const{split:e,types:i}=OC(n),o=e.length;return l=>{let d="";for(let p=0;p<o;p++)if(d+=e[p],l[p]!==void 0){const _=i[p];_===ate?d+=oC(l[p]):_===cte?d+=Ya.transform(l[p]):d+=l[p]}return d}}const UPe=n=>typeof n=="number"?0:n;function VPe(n){const e=lte(n);return ute(n)(e.map(UPe))}const Pg={test:DPe,parse:lte,createTransformer:ute,getAnimatableNone:VPe},FPe=new Set(["brightness","contrast","saturate","opacity"]);function jPe(n){const[e,i]=n.slice(0,-1).split("(");if(e==="drop-shadow")return n;const[o]=i.match(Rj)||[];if(!o)return n;const l=i.replace(o,"");let d=FPe.has(e)?1:0;return o!==i&&(d*=100),e+"("+d+l+")"}const BPe=/\b([a-z-]*)\(.*?\)/gu,lV={...Pg,getAnimatableNone:n=>{const e=n.match(BPe);return e?e.map(jPe).join(" "):n}},WPe={...dj,color:Ya,backgroundColor:Ya,outlineColor:Ya,fill:Ya,stroke:Ya,borderColor:Ya,borderTopColor:Ya,borderRightColor:Ya,borderBottomColor:Ya,borderLeftColor:Ya,filter:lV,WebkitFilter:lV},Aj=n=>WPe[n];function dte(n,e){let i=Aj(n);return i!==lV&&(i=Pg),i.getAnimatableNone?i.getAnimatableNone(e):void 0}const zPe=new Set(["auto","none","0"]);function GPe(n,e,i){let o=0,l;for(;o<n.length&&!l;){const d=n[o];typeof d=="string"&&!zPe.has(d)&&OC(d).values.length&&(l=n[o]),o++}if(l&&i)for(const d of e)n[d]=dte(i,l)}const Mq=n=>n===W0||n===Fn,Uq=(n,e)=>parseFloat(n.split(", ")[e]),Vq=(n,e)=>(i,{transform:o})=>{if(o==="none"||!o)return 0;const l=o.match(/^matrix3d\((.+)\)$/u);if(l)return Uq(l[1],e);{const d=o.match(/^matrix\((.+)\)$/u);return d?Uq(d[1],n):0}},HPe=new Set(["x","y","z"]),$Pe=B0.filter(n=>!HPe.has(n));function KPe(n){const e=[];return $Pe.forEach(i=>{const o=n.getValue(i);o!==void 0&&(e.push([i,o.get()]),o.set(i.startsWith("scale")?1:0))}),e}const y0={width:({x:n},{paddingLeft:e="0",paddingRight:i="0"})=>n.max-n.min-parseFloat(e)-parseFloat(i),height:({y:n},{paddingTop:e="0",paddingBottom:i="0"})=>n.max-n.min-parseFloat(e)-parseFloat(i),top:(n,{top:e})=>parseFloat(e),left:(n,{left:e})=>parseFloat(e),bottom:({y:n},{top:e})=>parseFloat(e)+(n.max-n.min),right:({x:n},{left:e})=>parseFloat(e)+(n.max-n.min),x:Vq(4,13),y:Vq(5,14)};y0.translateX=y0.x;y0.translateY=y0.y;const Oy=new Set;let uV=!1,dV=!1;function hte(){if(dV){const n=Array.from(Oy).filter(o=>o.needsMeasurement),e=new Set(n.map(o=>o.element)),i=new Map;e.forEach(o=>{const l=KPe(o);l.length&&(i.set(o,l),o.render())}),n.forEach(o=>o.measureInitialState()),e.forEach(o=>{o.render();const l=i.get(o);l&&l.forEach(([d,p])=>{var _;(_=o.getValue(d))===null||_===void 0||_.set(p)})}),n.forEach(o=>o.measureEndState()),n.forEach(o=>{o.suspendedScrollY!==void 0&&window.scrollTo(0,o.suspendedScrollY)})}dV=!1,uV=!1,Oy.forEach(n=>n.complete()),Oy.clear()}function fte(){Oy.forEach(n=>{n.readKeyframes(),n.needsMeasurement&&(dV=!0)})}function qPe(){fte(),hte()}class Pj{constructor(e,i,o,l,d,p=!1){this.isComplete=!1,this.isAsync=!1,this.needsMeasurement=!1,this.isScheduled=!1,this.unresolvedKeyframes=[...e],this.onComplete=i,this.name=o,this.motionValue=l,this.element=d,this.isAsync=p}scheduleResolve(){this.isScheduled=!0,this.isAsync?(Oy.add(this),uV||(uV=!0,rs.read(fte),rs.resolveKeyframes(hte))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:e,name:i,element:o,motionValue:l}=this;for(let d=0;d<e.length;d++)if(e[d]===null)if(d===0){const p=l==null?void 0:l.get(),_=e[e.length-1];if(p!==void 0)e[0]=p;else if(o&&i){const E=o.readValue(i,_);E!=null&&(e[0]=E)}e[0]===void 0&&(e[0]=_),l&&p===void 0&&l.set(e[0])}else e[d]=e[d-1]}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(){this.isComplete=!0,this.onComplete(this.unresolvedKeyframes,this.finalKeyframe),Oy.delete(this)}cancel(){this.isComplete||(this.isScheduled=!1,Oy.delete(this))}resume(){this.isComplete||this.scheduleResolve()}}const pte=n=>/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(n),YPe=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u;function XPe(n){const e=YPe.exec(n);if(!e)return[,];const[,i,o,l]=e;return[`--${i??o}`,l]}function mte(n,e,i=1){const[o,l]=XPe(n);if(!o)return;const d=window.getComputedStyle(e).getPropertyValue(o);if(d){const p=d.trim();return pte(p)?parseFloat(p):p}return uj(l)?mte(l,e,i+1):l}const gte=n=>e=>e.test(n),JPe={test:n=>n==="auto",parse:n=>n},_te=[W0,Fn,tf,dg,jAe,FAe,JPe],Fq=n=>_te.find(gte(n));class yte extends Pj{constructor(e,i,o,l,d){super(e,i,o,l,d,!0)}readKeyframes(){const{unresolvedKeyframes:e,element:i,name:o}=this;if(!i||!i.current)return;super.readKeyframes();for(let E=0;E<e.length;E++){let b=e[E];if(typeof b=="string"&&(b=b.trim(),uj(b))){const C=mte(b,i.current);C!==void 0&&(e[E]=C),E===e.length-1&&(this.finalKeyframe=b)}}if(this.resolveNoneKeyframes(),!qee.has(o)||e.length!==2)return;const[l,d]=e,p=Fq(l),_=Fq(d);if(p!==_)if(Mq(p)&&Mq(_))for(let E=0;E<e.length;E++){const b=e[E];typeof b=="string"&&(e[E]=parseFloat(b))}else this.needsMeasurement=!0}resolveNoneKeyframes(){const{unresolvedKeyframes:e,name:i}=this,o=[];for(let l=0;l<e.length;l++)IPe(e[l])&&o.push(l);o.length&&GPe(e,o,i)}measureInitialState(){const{element:e,unresolvedKeyframes:i,name:o}=this;if(!e||!e.current)return;o==="height"&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=y0[o](e.measureViewportBox(),window.getComputedStyle(e.current)),i[0]=this.measuredOrigin;const l=i[i.length-1];l!==void 0&&e.getValue(o,l).jump(l,!1)}measureEndState(){var e;const{element:i,name:o,unresolvedKeyframes:l}=this;if(!i||!i.current)return;const d=i.getValue(o);d&&d.jump(this.measuredOrigin,!1);const p=l.length-1,_=l[p];l[p]=y0[o](i.measureViewportBox(),window.getComputedStyle(i.current)),_!==null&&this.finalKeyframe===void 0&&(this.finalKeyframe=_),!((e=this.removedTransforms)===null||e===void 0)&&e.length&&this.removedTransforms.forEach(([E,b])=>{i.getValue(E).set(b)}),this.resolveNoneKeyframes()}}const jq=(n,e)=>e==="zIndex"?!1:!!(typeof n=="number"||Array.isArray(n)||typeof n=="string"&&(Pg.test(n)||n==="0")&&!n.startsWith("url("));function QPe(n){const e=n[0];if(n.length===1)return!0;for(let i=0;i<n.length;i++)if(n[i]!==e)return!0}function ZPe(n,e,i,o){const l=n[0];if(l===null)return!1;if(e==="display"||e==="visibility")return!0;const d=n[n.length-1],p=jq(l,e),_=jq(d,e);return!p||!_?!1:QPe(n)||(i==="spring"||yj(i))&&o}const eOe=n=>n!==null;function W1(n,{repeat:e,repeatType:i="loop"},o){const l=n.filter(eOe),d=e&&i!=="loop"&&e%2===1?0:l.length-1;return!d||o===void 0?l[d]:o}const tOe=40;class Ete{constructor({autoplay:e=!0,delay:i=0,type:o="keyframes",repeat:l=0,repeatDelay:d=0,repeatType:p="loop",..._}){this.isStopped=!1,this.hasAttemptedResolve=!1,this.createdAt=nf.now(),this.options={autoplay:e,delay:i,type:o,repeat:l,repeatDelay:d,repeatType:p,..._},this.updateFinishedPromise()}calcStartTime(){return this.resolvedAt?this.resolvedAt-this.createdAt>tOe?this.resolvedAt:this.createdAt:this.createdAt}get resolved(){return!this._resolved&&!this.hasAttemptedResolve&&qPe(),this._resolved}onKeyframesResolved(e,i){this.resolvedAt=nf.now(),this.hasAttemptedResolve=!0;const{name:o,type:l,velocity:d,delay:p,onComplete:_,onUpdate:E,isGenerator:b}=this.options;if(!b&&!ZPe(e,o,l,d))if(p)this.options.duration=0;else{E&&E(W1(e,this.options,i)),_&&_(),this.resolveFinishedPromise();return}const C=this.initPlayback(e,i);C!==!1&&(this._resolved={keyframes:e,finalKeyframe:i,...C},this.onPostResolved())}onPostResolved(){}then(e,i){return this.currentFinishedPromise.then(e,i)}flatten(){this.options.type="keyframes",this.options.ease="linear"}updateFinishedPromise(){this.currentFinishedPromise=new Promise(e=>{this.resolveFinishedPromise=e})}}const _s=(n,e,i)=>n+(e-n)*i;function $M(n,e,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?n+(e-n)*6*i:i<1/2?e:i<2/3?n+(e-n)*(2/3-i)*6:n}function nOe({hue:n,saturation:e,lightness:i,alpha:o}){n/=360,e/=100,i/=100;let l=0,d=0,p=0;if(!e)l=d=p=i;else{const _=i<.5?i*(1+e):i+e-i*e,E=2*i-_;l=$M(E,_,n+1/3),d=$M(E,_,n),p=$M(E,_,n-1/3)}return{red:Math.round(l*255),green:Math.round(d*255),blue:Math.round(p*255),alpha:o}}function Wk(n,e){return i=>i>0?e:n}const KM=(n,e,i)=>{const o=n*n,l=i*(e*e-o)+o;return l<0?0:Math.sqrt(l)},rOe=[cV,Ty,WS],iOe=n=>rOe.find(e=>e.test(n));function Bq(n){const e=iOe(n);if(!e)return!1;let i=e.parse(n);return e===WS&&(i=nOe(i)),i}const Wq=(n,e)=>{const i=Bq(n),o=Bq(e);if(!i||!o)return Wk(n,e);const l={...i};return d=>(l.red=KM(i.red,o.red,d),l.green=KM(i.green,o.green,d),l.blue=KM(i.blue,o.blue,d),l.alpha=_s(i.alpha,o.alpha,d),Ty.transform(l))},sOe=(n,e)=>i=>e(n(i)),iR=(...n)=>n.reduce(sOe),hV=new Set(["none","hidden"]);function oOe(n,e){return hV.has(n)?i=>i<=0?n:e:i=>i>=1?e:n}function aOe(n,e){return i=>_s(n,e,i)}function Oj(n){return typeof n=="number"?aOe:typeof n=="string"?uj(n)?Wk:Ya.test(n)?Wq:uOe:Array.isArray(n)?vte:typeof n=="object"?Ya.test(n)?Wq:cOe:Wk}function vte(n,e){const i=[...n],o=i.length,l=n.map((d,p)=>Oj(d)(d,e[p]));return d=>{for(let p=0;p<o;p++)i[p]=l[p](d);return i}}function cOe(n,e){const i={...n,...e},o={};for(const l in i)n[l]!==void 0&&e[l]!==void 0&&(o[l]=Oj(n[l])(n[l],e[l]));return l=>{for(const d in o)i[d]=o[d](l);return i}}function lOe(n,e){var i;const o=[],l={color:0,var:0,number:0};for(let d=0;d<e.values.length;d++){const p=e.types[d],_=n.indexes[p][l[p]],E=(i=n.values[_])!==null&&i!==void 0?i:0;o[d]=E,l[p]++}return o}const uOe=(n,e)=>{const i=Pg.createTransformer(e),o=OC(n),l=OC(e);return o.indexes.var.length===l.indexes.var.length&&o.indexes.color.length===l.indexes.color.length&&o.indexes.number.length>=l.indexes.number.length?hV.has(n)&&!l.values.length||hV.has(e)&&!o.values.length?oOe(n,e):iR(vte(lOe(o,l),l.values),i):Wk(n,e)};function Ste(n,e,i){return typeof n=="number"&&typeof e=="number"&&typeof i=="number"?_s(n,e,i):Oj(n)(n,e)}const dOe=5;function bte(n,e,i){const o=Math.max(e-dOe,0);return Yee(i-n(o),e-o)}const Ls={stiffness:100,damping:10,mass:1,velocity:0,duration:800,bounce:.3,visualDuration:.3,restSpeed:{granular:.01,default:2},restDelta:{granular:.005,default:.5},minDuration:.01,maxDuration:10,minDamping:.05,maxDamping:1},zq=.001;function hOe({duration:n=Ls.duration,bounce:e=Ls.bounce,velocity:i=Ls.velocity,mass:o=Ls.mass}){let l,d,p=1-e;p=Bp(Ls.minDamping,Ls.maxDamping,p),n=Bp(Ls.minDuration,Ls.maxDuration,Lp(n)),p<1?(l=b=>{const C=b*p,I=C*n,O=C-i,L=fV(b,p),V=Math.exp(-I);return zq-O/L*V},d=b=>{const I=b*p*n,O=I*i+i,L=Math.pow(p,2)*Math.pow(b,2)*n,V=Math.exp(-I),B=fV(Math.pow(b,2),p);return(-l(b)+zq>0?-1:1)*((O-L)*V)/B}):(l=b=>{const C=Math.exp(-b*n),I=(b-i)*n+1;return-.001+C*I},d=b=>{const C=Math.exp(-b*n),I=(i-b)*(n*n);return C*I});const _=5/n,E=pOe(l,d,_);if(n=xp(n),isNaN(E))return{stiffness:Ls.stiffness,damping:Ls.damping,duration:n};{const b=Math.pow(E,2)*o;return{stiffness:b,damping:p*2*Math.sqrt(o*b),duration:n}}}const fOe=12;function pOe(n,e,i){let o=i;for(let l=1;l<fOe;l++)o=o-n(o)/e(o);return o}function fV(n,e){return n*Math.sqrt(1-e*e)}const mOe=["duration","bounce"],gOe=["stiffness","damping","mass"];function Gq(n,e){return e.some(i=>n[i]!==void 0)}function _Oe(n){let e={velocity:Ls.velocity,stiffness:Ls.stiffness,damping:Ls.damping,mass:Ls.mass,isResolvedFromDuration:!1,...n};if(!Gq(n,gOe)&&Gq(n,mOe))if(n.visualDuration){const i=n.visualDuration,o=2*Math.PI/(i*1.2),l=o*o,d=2*Bp(.05,1,1-(n.bounce||0))*Math.sqrt(l);e={...e,mass:Ls.mass,stiffness:l,damping:d}}else{const i=hOe(n);e={...e,...i,mass:Ls.mass},e.isResolvedFromDuration=!0}return e}function Tte(n=Ls.visualDuration,e=Ls.bounce){const i=typeof n!="object"?{visualDuration:n,keyframes:[0,1],bounce:e}:n;let{restSpeed:o,restDelta:l}=i;const d=i.keyframes[0],p=i.keyframes[i.keyframes.length-1],_={done:!1,value:d},{stiffness:E,damping:b,mass:C,duration:I,velocity:O,isResolvedFromDuration:L}=_Oe({...i,velocity:-Lp(i.velocity||0)}),V=O||0,B=b/(2*Math.sqrt(E*C)),W=p-d,Z=Lp(Math.sqrt(E/C)),$=Math.abs(W)<5;o||(o=$?Ls.restSpeed.granular:Ls.restSpeed.default),l||(l=$?Ls.restDelta.granular:Ls.restDelta.default);let se;if(B<1){const re=fV(Z,B);se=pe=>{const q=Math.exp(-B*Z*pe);return p-q*((V+B*Z*W)/re*Math.sin(re*pe)+W*Math.cos(re*pe))}}else if(B===1)se=re=>p-Math.exp(-Z*re)*(W+(V+Z*W)*re);else{const re=Z*Math.sqrt(B*B-1);se=pe=>{const q=Math.exp(-B*Z*pe),Q=Math.min(re*pe,300);return p-q*((V+B*Z*W)*Math.sinh(Q)+re*W*Math.cosh(Q))/re}}const ue={calculatedDuration:L&&I||null,next:re=>{const pe=se(re);if(L)_.done=re>=I;else{let q=0;B<1&&(q=re===0?xp(V):bte(se,re,pe));const Q=Math.abs(q)<=o,J=Math.abs(p-pe)<=l;_.done=Q&&J}return _.value=_.done?p:pe,_},toString:()=>{const re=Math.min(Bee(ue),sV),pe=Wee(q=>ue.next(re*q).value,re,30);return re+"ms "+pe}};return ue}function Hq({keyframes:n,velocity:e=0,power:i=.8,timeConstant:o=325,bounceDamping:l=10,bounceStiffness:d=500,modifyTarget:p,min:_,max:E,restDelta:b=.5,restSpeed:C}){const I=n[0],O={done:!1,value:I},L=Q=>_!==void 0&&Q<_||E!==void 0&&Q>E,V=Q=>_===void 0?E:E===void 0||Math.abs(_-Q)<Math.abs(E-Q)?_:E;let B=i*e;const W=I+B,Z=p===void 0?W:p(W);Z!==W&&(B=Z-I);const $=Q=>-B*Math.exp(-Q/o),se=Q=>Z+$(Q),ue=Q=>{const J=$(Q),ie=se(Q);O.done=Math.abs(J)<=b,O.value=O.done?Z:ie};let re,pe;const q=Q=>{L(O.value)&&(re=Q,pe=Tte({keyframes:[O.value,V(O.value)],velocity:bte(se,Q,O.value),damping:l,stiffness:d,restDelta:b,restSpeed:C}))};return q(0),{calculatedDuration:null,next:Q=>{let J=!1;return!pe&&re===void 0&&(J=!0,ue(Q),q(Q)),re!==void 0&&Q>=re?pe.next(Q-re):(!J&&ue(Q),O)}}}const yOe=rR(.42,0,1,1),EOe=rR(0,0,.58,1),wte=rR(.42,0,.58,1),vOe=n=>Array.isArray(n)&&typeof n[0]!="number",SOe={linear:Bl,easeIn:yOe,easeInOut:wte,easeOut:EOe,circIn:Cj,circInOut:ite,circOut:rte,backIn:wj,backInOut:tte,backOut:ete,anticipate:nte},$q=n=>{if(Ej(n)){See(n.length===4);const[e,i,o,l]=n;return rR(e,i,o,l)}else if(typeof n=="string")return SOe[n];return n};function bOe(n,e,i){const o=[],l=i||Ste,d=n.length-1;for(let p=0;p<d;p++){let _=l(n[p],n[p+1]);if(e){const E=Array.isArray(e)?e[p]||Bl:e;_=iR(E,_)}o.push(_)}return o}function TOe(n,e,{clamp:i=!0,ease:o,mixer:l}={}){const d=n.length;if(See(d===e.length),d===1)return()=>e[0];if(d===2&&e[0]===e[1])return()=>e[1];const p=n[0]===n[1];n[0]>n[d-1]&&(n=[...n].reverse(),e=[...e].reverse());const _=bOe(e,o,l),E=_.length,b=C=>{if(p&&C<n[0])return e[0];let I=0;if(E>1)for(;I<n.length-2&&!(C<n[I+1]);I++);const O=g0(n[I],n[I+1],C);return _[I](O)};return i?C=>b(Bp(n[0],n[d-1],C)):b}function wOe(n,e){const i=n[n.length-1];for(let o=1;o<=e;o++){const l=g0(0,e,o);n.push(_s(i,1,l))}}function COe(n){const e=[0];return wOe(e,n.length-1),e}function ROe(n,e){return n.map(i=>i*e)}function IOe(n,e){return n.map(()=>e||wte).splice(0,n.length-1)}function zk({duration:n=300,keyframes:e,times:i,ease:o="easeInOut"}){const l=vOe(o)?o.map($q):$q(o),d={done:!1,value:e[0]},p=ROe(i&&i.length===e.length?i:COe(e),n),_=TOe(p,e,{ease:Array.isArray(l)?l:IOe(e,l)});return{calculatedDuration:n,next:E=>(d.value=_(E),d.done=E>=n,d)}}const AOe=n=>{const e=({timestamp:i})=>n(i);return{start:()=>rs.update(e,!0),stop:()=>Ag(e),now:()=>_a.isProcessing?_a.timestamp:nf.now()}},POe={decay:Hq,inertia:Hq,tween:zk,keyframes:zk,spring:Tte},OOe=n=>n/100;class kj extends Ete{constructor(e){super(e),this.holdTime=null,this.cancelTime=null,this.currentTime=0,this.playbackSpeed=1,this.pendingPlayState="running",this.startTime=null,this.state="idle",this.stop=()=>{if(this.resolver.cancel(),this.isStopped=!0,this.state==="idle")return;this.teardown();const{onStop:E}=this.options;E&&E()};const{name:i,motionValue:o,element:l,keyframes:d}=this.options,p=(l==null?void 0:l.KeyframeResolver)||Pj,_=(E,b)=>this.onKeyframesResolved(E,b);this.resolver=new p(d,_,i,o,l),this.resolver.scheduleResolve()}flatten(){super.flatten(),this._resolved&&Object.assign(this._resolved,this.initPlayback(this._resolved.keyframes))}initPlayback(e){const{type:i="keyframes",repeat:o=0,repeatDelay:l=0,repeatType:d,velocity:p=0}=this.options,_=yj(i)?i:POe[i]||zk;let E,b;_!==zk&&typeof e[0]!="number"&&(E=iR(OOe,Ste(e[0],e[1])),e=[0,100]);const C=_({...this.options,keyframes:e});d==="mirror"&&(b=_({...this.options,keyframes:[...e].reverse(),velocity:-p})),C.calculatedDuration===null&&(C.calculatedDuration=Bee(C));const{calculatedDuration:I}=C,O=I+l,L=O*(o+1)-l;return{generator:C,mirroredGenerator:b,mapPercentToKeyframes:E,calculatedDuration:I,resolvedDuration:O,totalDuration:L}}onPostResolved(){const{autoplay:e=!0}=this.options;this.play(),this.pendingPlayState==="paused"||!e?this.pause():this.state=this.pendingPlayState}tick(e,i=!1){const{resolved:o}=this;if(!o){const{keyframes:Q}=this.options;return{done:!0,value:Q[Q.length-1]}}const{finalKeyframe:l,generator:d,mirroredGenerator:p,mapPercentToKeyframes:_,keyframes:E,calculatedDuration:b,totalDuration:C,resolvedDuration:I}=o;if(this.startTime===null)return d.next(0);const{delay:O,repeat:L,repeatType:V,repeatDelay:B,onUpdate:W}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,e):this.speed<0&&(this.startTime=Math.min(e-C/this.speed,this.startTime)),i?this.currentTime=e:this.holdTime!==null?this.currentTime=this.holdTime:this.currentTime=Math.round(e-this.startTime)*this.speed;const Z=this.currentTime-O*(this.speed>=0?1:-1),$=this.speed>=0?Z<0:Z>C;this.currentTime=Math.max(Z,0),this.state==="finished"&&this.holdTime===null&&(this.currentTime=C);let se=this.currentTime,ue=d;if(L){const Q=Math.min(this.currentTime,C)/I;let J=Math.floor(Q),ie=Q%1;!ie&&Q>=1&&(ie=1),ie===1&&J--,J=Math.min(J,L+1),!!(J%2)&&(V==="reverse"?(ie=1-ie,B&&(ie-=B/I)):V==="mirror"&&(ue=p)),se=Bp(0,1,ie)*I}const re=$?{done:!1,value:E[0]}:ue.next(se);_&&(re.value=_(re.value));let{done:pe}=re;!$&&b!==null&&(pe=this.speed>=0?this.currentTime>=C:this.currentTime<=0);const q=this.holdTime===null&&(this.state==="finished"||this.state==="running"&&pe);return q&&l!==void 0&&(re.value=W1(E,this.options,l)),W&&W(re.value),q&&this.finish(),re}get duration(){const{resolved:e}=this;return e?Lp(e.calculatedDuration):0}get time(){return Lp(this.currentTime)}set time(e){e=xp(e),this.currentTime=e,this.holdTime!==null||this.speed===0?this.holdTime=e:this.driver&&(this.startTime=this.driver.now()-e/this.speed)}get speed(){return this.playbackSpeed}set speed(e){const i=this.playbackSpeed!==e;this.playbackSpeed=e,i&&(this.time=Lp(this.currentTime))}play(){if(this.resolver.isScheduled||this.resolver.resume(),!this._resolved){this.pendingPlayState="running";return}if(this.isStopped)return;const{driver:e=AOe,onPlay:i,startTime:o}=this.options;this.driver||(this.driver=e(d=>this.tick(d))),i&&i();const l=this.driver.now();this.holdTime!==null?this.startTime=l-this.holdTime:this.startTime?this.state==="finished"&&(this.startTime=l):this.startTime=o??this.calcStartTime(),this.state==="finished"&&this.updateFinishedPromise(),this.cancelTime=this.startTime,this.holdTime=null,this.state="running",this.driver.start()}pause(){var e;if(!this._resolved){this.pendingPlayState="paused";return}this.state="paused",this.holdTime=(e=this.currentTime)!==null&&e!==void 0?e:0}complete(){this.state!=="running"&&this.play(),this.pendingPlayState=this.state="finished",this.holdTime=null}finish(){this.teardown(),this.state="finished";const{onComplete:e}=this.options;e&&e()}cancel(){this.cancelTime!==null&&this.tick(this.cancelTime),this.teardown(),this.updateFinishedPromise()}teardown(){this.state="idle",this.stopDriver(),this.resolveFinishedPromise(),this.updateFinishedPromise(),this.startTime=this.cancelTime=null,this.resolver.cancel()}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(e){return this.startTime=0,this.tick(e,!0)}}const kOe=new Set(["opacity","clipPath","filter","transform"]);function NOe(n,e,i,{delay:o=0,duration:l=300,repeat:d=0,repeatType:p="loop",ease:_="easeInOut",times:E}={}){const b={[e]:i};E&&(b.offset=E);const C=Gee(_,l);return Array.isArray(C)&&(b.easing=C),n.animate(b,{delay:o,duration:l,easing:Array.isArray(C)?"linear":C,fill:"both",iterations:d+1,direction:p==="reverse"?"alternate":"normal"})}const DOe=rj(()=>Object.hasOwnProperty.call(Element.prototype,"animate")),Gk=10,xOe=2e4;function LOe(n){return yj(n.type)||n.type==="spring"||!zee(n.ease)}function MOe(n,e){const i=new kj({...e,keyframes:n,repeat:0,delay:0,isGenerator:!0});let o={done:!1,value:n[0]};const l=[];let d=0;for(;!o.done&&d<xOe;)o=i.sample(d),l.push(o.value),d+=Gk;return{times:void 0,keyframes:l,duration:d-Gk,ease:"linear"}}const Cte={anticipate:nte,backInOut:tte,circInOut:ite};function UOe(n){return n in Cte}class Kq extends Ete{constructor(e){super(e);const{name:i,motionValue:o,element:l,keyframes:d}=this.options;this.resolver=new yte(d,(p,_)=>this.onKeyframesResolved(p,_),i,o,l),this.resolver.scheduleResolve()}initPlayback(e,i){let{duration:o=300,times:l,ease:d,type:p,motionValue:_,name:E,startTime:b}=this.options;if(!_.owner||!_.owner.current)return!1;if(typeof d=="string"&&Bk()&&UOe(d)&&(d=Cte[d]),LOe(this.options)){const{onComplete:I,onUpdate:O,motionValue:L,element:V,...B}=this.options,W=MOe(e,B);e=W.keyframes,e.length===1&&(e[1]=e[0]),o=W.duration,l=W.times,d=W.ease,p="keyframes"}const C=NOe(_.owner.current,E,e,{...this.options,duration:o,times:l,ease:d});return C.startTime=b??this.calcStartTime(),this.pendingTimeline?(Oq(C,this.pendingTimeline),this.pendingTimeline=void 0):C.onfinish=()=>{const{onComplete:I}=this.options;_.set(W1(e,this.options,i)),I&&I(),this.cancel(),this.resolveFinishedPromise()},{animation:C,duration:o,times:l,type:p,ease:d,keyframes:e}}get duration(){const{resolved:e}=this;if(!e)return 0;const{duration:i}=e;return Lp(i)}get time(){const{resolved:e}=this;if(!e)return 0;const{animation:i}=e;return Lp(i.currentTime||0)}set time(e){const{resolved:i}=this;if(!i)return;const{animation:o}=i;o.currentTime=xp(e)}get speed(){const{resolved:e}=this;if(!e)return 1;const{animation:i}=e;return i.playbackRate}set speed(e){const{resolved:i}=this;if(!i)return;const{animation:o}=i;o.playbackRate=e}get state(){const{resolved:e}=this;if(!e)return"idle";const{animation:i}=e;return i.playState}get startTime(){const{resolved:e}=this;if(!e)return null;const{animation:i}=e;return i.startTime}attachTimeline(e){if(!this._resolved)this.pendingTimeline=e;else{const{resolved:i}=this;if(!i)return Bl;const{animation:o}=i;Oq(o,e)}return Bl}play(){if(this.isStopped)return;const{resolved:e}=this;if(!e)return;const{animation:i}=e;i.playState==="finished"&&this.updateFinishedPromise(),i.play()}pause(){const{resolved:e}=this;if(!e)return;const{animation:i}=e;i.pause()}stop(){if(this.resolver.cancel(),this.isStopped=!0,this.state==="idle")return;this.resolveFinishedPromise(),this.updateFinishedPromise();const{resolved:e}=this;if(!e)return;const{animation:i,keyframes:o,duration:l,type:d,ease:p,times:_}=e;if(i.playState==="idle"||i.playState==="finished")return;if(this.time){const{motionValue:b,onUpdate:C,onComplete:I,element:O,...L}=this.options,V=new kj({...L,keyframes:o,duration:l,type:d,ease:p,times:_,isGenerator:!0}),B=xp(this.time);b.setWithVelocity(V.sample(B-Gk).value,V.sample(B).value,Gk)}const{onStop:E}=this.options;E&&E(),this.cancel()}complete(){const{resolved:e}=this;e&&e.animation.finish()}cancel(){const{resolved:e}=this;e&&e.animation.cancel()}static supports(e){const{motionValue:i,name:o,repeatDelay:l,repeatType:d,damping:p,type:_}=e;if(!i||!i.owner||!(i.owner.current instanceof HTMLElement))return!1;const{onUpdate:E,transformTemplate:b}=i.owner.getProps();return DOe()&&o&&kOe.has(o)&&!E&&!b&&!l&&d!=="mirror"&&p!==0&&_!=="inertia"}}const VOe={type:"spring",stiffness:500,damping:25,restSpeed:10},FOe=n=>({type:"spring",stiffness:550,damping:n===0?2*Math.sqrt(550):30,restSpeed:10}),jOe={type:"keyframes",duration:.8},BOe={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},WOe=(n,{keyframes:e})=>e.length>2?jOe:Jy.has(n)?n.startsWith("scale")?FOe(e[1]):VOe:BOe;function zOe({when:n,delay:e,delayChildren:i,staggerChildren:o,staggerDirection:l,repeat:d,repeatType:p,repeatDelay:_,from:E,elapsed:b,...C}){return!!Object.keys(C).length}const Nj=(n,e,i,o={},l,d)=>p=>{const _=_j(o,n)||{},E=_.delay||o.delay||0;let{elapsed:b=0}=o;b=b-xp(E);let C={keyframes:Array.isArray(i)?i:[null,i],ease:"easeOut",velocity:e.getVelocity(),..._,delay:-b,onUpdate:O=>{e.set(O),_.onUpdate&&_.onUpdate(O)},onComplete:()=>{p(),_.onComplete&&_.onComplete()},name:n,motionValue:e,element:d?void 0:l};zOe(_)||(C={...C,...WOe(n,C)}),C.duration&&(C.duration=xp(C.duration)),C.repeatDelay&&(C.repeatDelay=xp(C.repeatDelay)),C.from!==void 0&&(C.keyframes[0]=C.from);let I=!1;if((C.type===!1||C.duration===0&&!C.repeatDelay)&&(C.duration=0,C.delay===0&&(I=!0)),I&&!d&&e.get()!==void 0){const O=W1(C.keyframes,_);if(O!==void 0)return rs.update(()=>{C.onUpdate(O),C.onComplete()}),new cPe([])}return!d&&Kq.supports(C)?new Kq(C):new kj(C)};function GOe({protectedKeys:n,needsAnimating:e},i){const o=n.hasOwnProperty(i)&&e[i]!==!0;return e[i]=!1,o}function Rte(n,e,{delay:i=0,transitionOverride:o,type:l}={}){var d;let{transition:p=n.getDefaultTransition(),transitionEnd:_,...E}=e;o&&(p=o);const b=[],C=l&&n.animationState&&n.animationState.getState()[l];for(const I in E){const O=n.getValue(I,(d=n.latestValues[I])!==null&&d!==void 0?d:null),L=E[I];if(L===void 0||C&&GOe(C,I))continue;const V={delay:i,..._j(p||{},I)};let B=!1;if(window.MotionHandoffAnimation){const Z=Xee(n);if(Z){const $=window.MotionHandoffAnimation(Z,I,rs);$!==null&&(V.startTime=$,B=!0)}}aV(n,I),O.start(Nj(I,O,L,n.shouldReduceMotion&&qee.has(I)?{type:!1}:V,n,B));const W=O.animation;W&&b.push(W)}return _&&Promise.all(b).then(()=>{rs.update(()=>{_&&bPe(n,_)})}),b}function pV(n,e,i={}){var o;const l=B1(n,e,i.type==="exit"?(o=n.presenceContext)===null||o===void 0?void 0:o.custom:void 0);let{transition:d=n.getDefaultTransition()||{}}=l||{};i.transitionOverride&&(d=i.transitionOverride);const p=l?()=>Promise.all(Rte(n,l,i)):()=>Promise.resolve(),_=n.variantChildren&&n.variantChildren.size?(b=0)=>{const{delayChildren:C=0,staggerChildren:I,staggerDirection:O}=d;return HOe(n,e,C+b,I,O,i)}:()=>Promise.resolve(),{when:E}=d;if(E){const[b,C]=E==="beforeChildren"?[p,_]:[_,p];return b().then(()=>C())}else return Promise.all([p(),_(i.delay)])}function HOe(n,e,i=0,o=0,l=1,d){const p=[],_=(n.variantChildren.size-1)*o,E=l===1?(b=0)=>b*o:(b=0)=>_-b*o;return Array.from(n.variantChildren).sort($Oe).forEach((b,C)=>{b.notify("AnimationStart",e),p.push(pV(b,e,{...d,delay:i+E(C)}).then(()=>b.notify("AnimationComplete",e)))}),Promise.all(p)}function $Oe(n,e){return n.sortNodePosition(e)}function KOe(n,e,i={}){n.notify("AnimationStart",e);let o;if(Array.isArray(e)){const l=e.map(d=>pV(n,d,i));o=Promise.all(l)}else if(typeof e=="string")o=pV(n,e,i);else{const l=typeof e=="function"?B1(n,e,i.custom):e;o=Promise.all(Rte(n,l,i))}return o.then(()=>{n.notify("AnimationComplete",e)})}const qOe=sj.length;function Ite(n){if(!n)return;if(!n.isControllingVariants){const i=n.parent?Ite(n.parent)||{}:{};return n.props.initial!==void 0&&(i.initial=n.props.initial),i}const e={};for(let i=0;i<qOe;i++){const o=sj[i],l=n.props[o];(IC(l)||l===!1)&&(e[o]=l)}return e}const YOe=[...ij].reverse(),XOe=ij.length;function JOe(n){return e=>Promise.all(e.map(({animation:i,options:o})=>KOe(n,i,o)))}function QOe(n){let e=JOe(n),i=qq(),o=!0;const l=E=>(b,C)=>{var I;const O=B1(n,C,E==="exit"?(I=n.presenceContext)===null||I===void 0?void 0:I.custom:void 0);if(O){const{transition:L,transitionEnd:V,...B}=O;b={...b,...B,...V}}return b};function d(E){e=E(n)}function p(E){const{props:b}=n,C=Ite(n.parent)||{},I=[],O=new Set;let L={},V=1/0;for(let W=0;W<XOe;W++){const Z=YOe[W],$=i[Z],se=b[Z]!==void 0?b[Z]:C[Z],ue=IC(se),re=Z===E?$.isActive:null;re===!1&&(V=W);let pe=se===C[Z]&&se!==b[Z]&&ue;if(pe&&o&&n.manuallyAnimateOnMount&&(pe=!1),$.protectedKeys={...L},!$.isActive&&re===null||!se&&!$.prevProp||F1(se)||typeof se=="boolean")continue;const q=ZOe($.prevProp,se);let Q=q||Z===E&&$.isActive&&!pe&&ue||W>V&&ue,J=!1;const ie=Array.isArray(se)?se:[se];let me=ie.reduce(l(Z),{});re===!1&&(me={});const{prevResolvedValues:de={}}=$,le={...de,...me},xe=ve=>{Q=!0,O.has(ve)&&(J=!0,O.delete(ve)),$.needsAnimating[ve]=!0;const _e=n.getValue(ve);_e&&(_e.liveStyle=!1)};for(const ve in le){const _e=me[ve],Ee=de[ve];if(L.hasOwnProperty(ve))continue;let ke=!1;iV(_e)&&iV(Ee)?ke=!jee(_e,Ee):ke=_e!==Ee,ke?_e!=null?xe(ve):O.add(ve):_e!==void 0&&O.has(ve)?xe(ve):$.protectedKeys[ve]=!0}$.prevProp=se,$.prevResolvedValues=me,$.isActive&&(L={...L,...me}),o&&n.blockInitialAnimation&&(Q=!1),Q&&(!(pe&&q)||J)&&I.push(...ie.map(ve=>({animation:ve,options:{type:Z}})))}if(O.size){const W={};O.forEach(Z=>{const $=n.getBaseTarget(Z),se=n.getValue(Z);se&&(se.liveStyle=!0),W[Z]=$??null}),I.push({animation:W})}let B=!!I.length;return o&&(b.initial===!1||b.initial===b.animate)&&!n.manuallyAnimateOnMount&&(B=!1),o=!1,B?e(I):Promise.resolve()}function _(E,b){var C;if(i[E].isActive===b)return Promise.resolve();(C=n.variantChildren)===null||C===void 0||C.forEach(O=>{var L;return(L=O.animationState)===null||L===void 0?void 0:L.setActive(E,b)}),i[E].isActive=b;const I=p(E);for(const O in i)i[O].protectedKeys={};return I}return{animateChanges:p,setActive:_,setAnimateFunction:d,getState:()=>i,reset:()=>{i=qq(),o=!0}}}function ZOe(n,e){return typeof e=="string"?e!==n:Array.isArray(e)?!jee(e,n):!1}function hy(n=!1){return{isActive:n,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function qq(){return{animate:hy(!0),whileInView:hy(),whileHover:hy(),whileTap:hy(),whileDrag:hy(),whileFocus:hy(),exit:hy()}}class Vg{constructor(e){this.isMounted=!1,this.node=e}update(){}}class eke extends Vg{constructor(e){super(e),e.animationState||(e.animationState=QOe(e))}updateAnimationControlsSubscription(){const{animate:e}=this.node.getProps();F1(e)&&(this.unmountControls=e.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:e}=this.node.getProps(),{animate:i}=this.node.prevProps||{};e!==i&&this.updateAnimationControlsSubscription()}unmount(){var e;this.node.animationState.reset(),(e=this.unmountControls)===null||e===void 0||e.call(this)}}let tke=0;class nke extends Vg{constructor(){super(...arguments),this.id=tke++}update(){if(!this.node.presenceContext)return;const{isPresent:e,onExitComplete:i}=this.node.presenceContext,{isPresent:o}=this.node.prevPresenceContext||{};if(!this.node.animationState||e===o)return;const l=this.node.animationState.setActive("exit",!e);i&&!e&&l.then(()=>i(this.id))}mount(){const{register:e}=this.node.presenceContext||{};e&&(this.unmount=e(this.id))}unmount(){}}const rke={animation:{Feature:eke},exit:{Feature:nke}};function kC(n,e,i,o={passive:!0}){return n.addEventListener(e,i,o),()=>n.removeEventListener(e,i)}function sR(n){return{point:{x:n.pageX,y:n.pageY}}}const ike=n=>e=>vj(e)&&n(e,sR(e));function aC(n,e,i,o){return kC(n,e,ike(i),o)}const Yq=(n,e)=>Math.abs(n-e);function ske(n,e){const i=Yq(n.x,e.x),o=Yq(n.y,e.y);return Math.sqrt(i**2+o**2)}class Ate{constructor(e,i,{transformPagePoint:o,contextWindow:l,dragSnapToOrigin:d=!1}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const I=YM(this.lastMoveEventInfo,this.history),O=this.startEvent!==null,L=ske(I.offset,{x:0,y:0})>=3;if(!O&&!L)return;const{point:V}=I,{timestamp:B}=_a;this.history.push({...V,timestamp:B});const{onStart:W,onMove:Z}=this.handlers;O||(W&&W(this.lastMoveEvent,I),this.startEvent=this.lastMoveEvent),Z&&Z(this.lastMoveEvent,I)},this.handlePointerMove=(I,O)=>{this.lastMoveEvent=I,this.lastMoveEventInfo=qM(O,this.transformPagePoint),rs.update(this.updatePoint,!0)},this.handlePointerUp=(I,O)=>{this.end();const{onEnd:L,onSessionEnd:V,resumeAnimation:B}=this.handlers;if(this.dragSnapToOrigin&&B&&B(),!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const W=YM(I.type==="pointercancel"?this.lastMoveEventInfo:qM(O,this.transformPagePoint),this.history);this.startEvent&&L&&L(I,W),V&&V(I,W)},!vj(e))return;this.dragSnapToOrigin=d,this.handlers=i,this.transformPagePoint=o,this.contextWindow=l||window;const p=sR(e),_=qM(p,this.transformPagePoint),{point:E}=_,{timestamp:b}=_a;this.history=[{...E,timestamp:b}];const{onSessionStart:C}=i;C&&C(e,YM(_,this.history)),this.removeListeners=iR(aC(this.contextWindow,"pointermove",this.handlePointerMove),aC(this.contextWindow,"pointerup",this.handlePointerUp),aC(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(e){this.handlers=e}end(){this.removeListeners&&this.removeListeners(),Ag(this.updatePoint)}}function qM(n,e){return e?{point:e(n.point)}:n}function Xq(n,e){return{x:n.x-e.x,y:n.y-e.y}}function YM({point:n},e){return{point:n,delta:Xq(n,Pte(e)),offset:Xq(n,oke(e)),velocity:ake(e,.1)}}function oke(n){return n[0]}function Pte(n){return n[n.length-1]}function ake(n,e){if(n.length<2)return{x:0,y:0};let i=n.length-1,o=null;const l=Pte(n);for(;i>=0&&(o=n[i],!(l.timestamp-o.timestamp>xp(e)));)i--;if(!o)return{x:0,y:0};const d=Lp(l.timestamp-o.timestamp);if(d===0)return{x:0,y:0};const p={x:(l.x-o.x)/d,y:(l.y-o.y)/d};return p.x===1/0&&(p.x=0),p.y===1/0&&(p.y=0),p}const Ote=1e-4,cke=1-Ote,lke=1+Ote,kte=.01,uke=0-kte,dke=0+kte;function Wl(n){return n.max-n.min}function hke(n,e,i){return Math.abs(n-e)<=i}function Jq(n,e,i,o=.5){n.origin=o,n.originPoint=_s(e.min,e.max,n.origin),n.scale=Wl(i)/Wl(e),n.translate=_s(i.min,i.max,n.origin)-n.originPoint,(n.scale>=cke&&n.scale<=lke||isNaN(n.scale))&&(n.scale=1),(n.translate>=uke&&n.translate<=dke||isNaN(n.translate))&&(n.translate=0)}function cC(n,e,i,o){Jq(n.x,e.x,i.x,o?o.originX:void 0),Jq(n.y,e.y,i.y,o?o.originY:void 0)}function Qq(n,e,i){n.min=i.min+e.min,n.max=n.min+Wl(e)}function fke(n,e,i){Qq(n.x,e.x,i.x),Qq(n.y,e.y,i.y)}function Zq(n,e,i){n.min=e.min-i.min,n.max=n.min+Wl(e)}function lC(n,e,i){Zq(n.x,e.x,i.x),Zq(n.y,e.y,i.y)}function pke(n,{min:e,max:i},o){return e!==void 0&&n<e?n=o?_s(e,n,o.min):Math.max(n,e):i!==void 0&&n>i&&(n=o?_s(i,n,o.max):Math.min(n,i)),n}function eY(n,e,i){return{min:e!==void 0?n.min+e:void 0,max:i!==void 0?n.max+i-(n.max-n.min):void 0}}function mke(n,{top:e,left:i,bottom:o,right:l}){return{x:eY(n.x,i,l),y:eY(n.y,e,o)}}function tY(n,e){let i=e.min-n.min,o=e.max-n.max;return e.max-e.min<n.max-n.min&&([i,o]=[o,i]),{min:i,max:o}}function gke(n,e){return{x:tY(n.x,e.x),y:tY(n.y,e.y)}}function _ke(n,e){let i=.5;const o=Wl(n),l=Wl(e);return l>o?i=g0(e.min,e.max-o,n.min):o>l&&(i=g0(n.min,n.max-l,e.min)),Bp(0,1,i)}function yke(n,e){const i={};return e.min!==void 0&&(i.min=e.min-n.min),e.max!==void 0&&(i.max=e.max-n.min),i}const mV=.35;function Eke(n=mV){return n===!1?n=0:n===!0&&(n=mV),{x:nY(n,"left","right"),y:nY(n,"top","bottom")}}function nY(n,e,i){return{min:rY(n,e),max:rY(n,i)}}function rY(n,e){return typeof n=="number"?n:n[e]||0}const iY=()=>({translate:0,scale:1,origin:0,originPoint:0}),zS=()=>({x:iY(),y:iY()}),sY=()=>({min:0,max:0}),Hs=()=>({x:sY(),y:sY()});function Nu(n){return[n("x"),n("y")]}function Nte({top:n,left:e,right:i,bottom:o}){return{x:{min:e,max:i},y:{min:n,max:o}}}function vke({x:n,y:e}){return{top:e.min,right:n.max,bottom:e.max,left:n.min}}function Ske(n,e){if(!e)return n;const i=e({x:n.left,y:n.top}),o=e({x:n.right,y:n.bottom});return{top:i.y,left:i.x,bottom:o.y,right:o.x}}function XM(n){return n===void 0||n===1}function gV({scale:n,scaleX:e,scaleY:i}){return!XM(n)||!XM(e)||!XM(i)}function py(n){return gV(n)||Dte(n)||n.z||n.rotate||n.rotateX||n.rotateY||n.skewX||n.skewY}function Dte(n){return oY(n.x)||oY(n.y)}function oY(n){return n&&n!=="0%"}function Hk(n,e,i){const o=n-i,l=e*o;return i+l}function aY(n,e,i,o,l){return l!==void 0&&(n=Hk(n,l,o)),Hk(n,i,o)+e}function _V(n,e=0,i=1,o,l){n.min=aY(n.min,e,i,o,l),n.max=aY(n.max,e,i,o,l)}function xte(n,{x:e,y:i}){_V(n.x,e.translate,e.scale,e.originPoint),_V(n.y,i.translate,i.scale,i.originPoint)}const cY=.999999999999,lY=1.0000000000001;function bke(n,e,i,o=!1){const l=i.length;if(!l)return;e.x=e.y=1;let d,p;for(let _=0;_<l;_++){d=i[_],p=d.projectionDelta;const{visualElement:E}=d.options;E&&E.props.style&&E.props.style.display==="contents"||(o&&d.options.layoutScroll&&d.scroll&&d!==d.root&&HS(n,{x:-d.scroll.offset.x,y:-d.scroll.offset.y}),p&&(e.x*=p.x.scale,e.y*=p.y.scale,xte(n,p)),o&&py(d.latestValues)&&HS(n,d.latestValues))}e.x<lY&&e.x>cY&&(e.x=1),e.y<lY&&e.y>cY&&(e.y=1)}function GS(n,e){n.min=n.min+e,n.max=n.max+e}function uY(n,e,i,o,l=.5){const d=_s(n.min,n.max,l);_V(n,e,i,d,o)}function HS(n,e){uY(n.x,e.x,e.scaleX,e.scale,e.originX),uY(n.y,e.y,e.scaleY,e.scale,e.originY)}function Lte(n,e){return Nte(Ske(n.getBoundingClientRect(),e))}function Tke(n,e,i){const o=Lte(n,i),{scroll:l}=e;return l&&(GS(o.x,l.offset.x),GS(o.y,l.offset.y)),o}const Mte=({current:n})=>n?n.ownerDocument.defaultView:null,wke=new WeakMap;class Cke{constructor(e){this.openDragLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=Hs(),this.visualElement=e}start(e,{snapToCursor:i=!1}={}){const{presenceContext:o}=this.visualElement;if(o&&o.isPresent===!1)return;const l=C=>{const{dragSnapToOrigin:I}=this.getProps();I?this.pauseAnimation():this.stopAnimation(),i&&this.snapToCursor(sR(C).point)},d=(C,I)=>{const{drag:O,dragPropagation:L,onDragStart:V}=this.getProps();if(O&&!L&&(this.openDragLock&&this.openDragLock(),this.openDragLock=_Pe(O),!this.openDragLock))return;this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),Nu(W=>{let Z=this.getAxisMotionValue(W).get()||0;if(tf.test(Z)){const{projection:$}=this.visualElement;if($&&$.layout){const se=$.layout.layoutBox[W];se&&(Z=Wl(se)*(parseFloat(Z)/100))}}this.originPoint[W]=Z}),V&&rs.postRender(()=>V(C,I)),aV(this.visualElement,"transform");const{animationState:B}=this.visualElement;B&&B.setActive("whileDrag",!0)},p=(C,I)=>{const{dragPropagation:O,dragDirectionLock:L,onDirectionLock:V,onDrag:B}=this.getProps();if(!O&&!this.openDragLock)return;const{offset:W}=I;if(L&&this.currentDirection===null){this.currentDirection=Rke(W),this.currentDirection!==null&&V&&V(this.currentDirection);return}this.updateAxis("x",I.point,W),this.updateAxis("y",I.point,W),this.visualElement.render(),B&&B(C,I)},_=(C,I)=>this.stop(C,I),E=()=>Nu(C=>{var I;return this.getAnimationState(C)==="paused"&&((I=this.getAxisMotionValue(C).animation)===null||I===void 0?void 0:I.play())}),{dragSnapToOrigin:b}=this.getProps();this.panSession=new Ate(e,{onSessionStart:l,onStart:d,onMove:p,onSessionEnd:_,resumeAnimation:E},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:b,contextWindow:Mte(this.visualElement)})}stop(e,i){const o=this.isDragging;if(this.cancel(),!o)return;const{velocity:l}=i;this.startAnimation(l);const{onDragEnd:d}=this.getProps();d&&rs.postRender(()=>d(e,i))}cancel(){this.isDragging=!1;const{projection:e,animationState:i}=this.visualElement;e&&(e.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:o}=this.getProps();!o&&this.openDragLock&&(this.openDragLock(),this.openDragLock=null),i&&i.setActive("whileDrag",!1)}updateAxis(e,i,o){const{drag:l}=this.getProps();if(!o||!IO(e,l,this.currentDirection))return;const d=this.getAxisMotionValue(e);let p=this.originPoint[e]+o[e];this.constraints&&this.constraints[e]&&(p=pke(p,this.constraints[e],this.elastic[e])),d.set(p)}resolveConstraints(){var e;const{dragConstraints:i,dragElastic:o}=this.getProps(),l=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):(e=this.visualElement.projection)===null||e===void 0?void 0:e.layout,d=this.constraints;i&&BS(i)?this.constraints||(this.constraints=this.resolveRefConstraints()):i&&l?this.constraints=mke(l.layoutBox,i):this.constraints=!1,this.elastic=Eke(o),d!==this.constraints&&l&&this.constraints&&!this.hasMutatedConstraints&&Nu(p=>{this.constraints!==!1&&this.getAxisMotionValue(p)&&(this.constraints[p]=yke(l.layoutBox[p],this.constraints[p]))})}resolveRefConstraints(){const{dragConstraints:e,onMeasureDragConstraints:i}=this.getProps();if(!e||!BS(e))return!1;const o=e.current,{projection:l}=this.visualElement;if(!l||!l.layout)return!1;const d=Tke(o,l.root,this.visualElement.getTransformPagePoint());let p=gke(l.layout.layoutBox,d);if(i){const _=i(vke(p));this.hasMutatedConstraints=!!_,_&&(p=Nte(_))}return p}startAnimation(e){const{drag:i,dragMomentum:o,dragElastic:l,dragTransition:d,dragSnapToOrigin:p,onDragTransitionEnd:_}=this.getProps(),E=this.constraints||{},b=Nu(C=>{if(!IO(C,i,this.currentDirection))return;let I=E&&E[C]||{};p&&(I={min:0,max:0});const O=l?200:1e6,L=l?40:1e7,V={type:"inertia",velocity:o?e[C]:0,bounceStiffness:O,bounceDamping:L,timeConstant:750,restDelta:1,restSpeed:10,...d,...I};return this.startAxisValueAnimation(C,V)});return Promise.all(b).then(_)}startAxisValueAnimation(e,i){const o=this.getAxisMotionValue(e);return aV(this.visualElement,e),o.start(Nj(e,o,0,i,this.visualElement,!1))}stopAnimation(){Nu(e=>this.getAxisMotionValue(e).stop())}pauseAnimation(){Nu(e=>{var i;return(i=this.getAxisMotionValue(e).animation)===null||i===void 0?void 0:i.pause()})}getAnimationState(e){var i;return(i=this.getAxisMotionValue(e).animation)===null||i===void 0?void 0:i.state}getAxisMotionValue(e){const i=`_drag${e.toUpperCase()}`,o=this.visualElement.getProps(),l=o[i];return l||this.visualElement.getValue(e,(o.initial?o.initial[e]:void 0)||0)}snapToCursor(e){Nu(i=>{const{drag:o}=this.getProps();if(!IO(i,o,this.currentDirection))return;const{projection:l}=this.visualElement,d=this.getAxisMotionValue(i);if(l&&l.layout){const{min:p,max:_}=l.layout.layoutBox[i];d.set(e[i]-_s(p,_,.5))}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:e,dragConstraints:i}=this.getProps(),{projection:o}=this.visualElement;if(!BS(i)||!o||!this.constraints)return;this.stopAnimation();const l={x:0,y:0};Nu(p=>{const _=this.getAxisMotionValue(p);if(_&&this.constraints!==!1){const E=_.get();l[p]=_ke({min:E,max:E},this.constraints[p])}});const{transformTemplate:d}=this.visualElement.getProps();this.visualElement.current.style.transform=d?d({},""):"none",o.root&&o.root.updateScroll(),o.updateLayout(),this.resolveConstraints(),Nu(p=>{if(!IO(p,e,null))return;const _=this.getAxisMotionValue(p),{min:E,max:b}=this.constraints[p];_.set(_s(E,b,l[p]))})}addListeners(){if(!this.visualElement.current)return;wke.set(this.visualElement,this);const e=this.visualElement.current,i=aC(e,"pointerdown",E=>{const{drag:b,dragListener:C=!0}=this.getProps();b&&C&&this.start(E)}),o=()=>{const{dragConstraints:E}=this.getProps();BS(E)&&E.current&&(this.constraints=this.resolveRefConstraints())},{projection:l}=this.visualElement,d=l.addEventListener("measure",o);l&&!l.layout&&(l.root&&l.root.updateScroll(),l.updateLayout()),rs.read(o);const p=kC(window,"resize",()=>this.scalePositionWithinConstraints()),_=l.addEventListener("didUpdate",({delta:E,hasLayoutChanged:b})=>{this.isDragging&&b&&(Nu(C=>{const I=this.getAxisMotionValue(C);I&&(this.originPoint[C]+=E[C].translate,I.set(I.get()+E[C].translate))}),this.visualElement.render())});return()=>{p(),i(),d(),_&&_()}}getProps(){const e=this.visualElement.getProps(),{drag:i=!1,dragDirectionLock:o=!1,dragPropagation:l=!1,dragConstraints:d=!1,dragElastic:p=mV,dragMomentum:_=!0}=e;return{...e,drag:i,dragDirectionLock:o,dragPropagation:l,dragConstraints:d,dragElastic:p,dragMomentum:_}}}function IO(n,e,i){return(e===!0||e===n)&&(i===null||i===n)}function Rke(n,e=10){let i=null;return Math.abs(n.y)>e?i="y":Math.abs(n.x)>e&&(i="x"),i}class Ike extends Vg{constructor(e){super(e),this.removeGroupControls=Bl,this.removeListeners=Bl,this.controls=new Cke(e)}mount(){const{dragControls:e}=this.node.getProps();e&&(this.removeGroupControls=e.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||Bl}unmount(){this.removeGroupControls(),this.removeListeners()}}const dY=n=>(e,i)=>{n&&rs.postRender(()=>n(e,i))};class Ake extends Vg{constructor(){super(...arguments),this.removePointerDownListener=Bl}onPointerDown(e){this.session=new Ate(e,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:Mte(this.node)})}createPanHandlers(){const{onPanSessionStart:e,onPanStart:i,onPan:o,onPanEnd:l}=this.node.getProps();return{onSessionStart:dY(e),onStart:dY(i),onMove:o,onEnd:(d,p)=>{delete this.session,l&&rs.postRender(()=>l(d,p))}}}mount(){this.removePointerDownListener=aC(this.node.current,"pointerdown",e=>this.onPointerDown(e))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}const uk={hasAnimatedSinceResize:!0,hasEverUpdated:!1};function hY(n,e){return e.max===e.min?0:n/(e.max-e.min)*100}const Ew={correct:(n,e)=>{if(!e.target)return n;if(typeof n=="string")if(Fn.test(n))n=parseFloat(n);else return n;const i=hY(n,e.target.x),o=hY(n,e.target.y);return`${i}% ${o}%`}},Pke={correct:(n,{treeScale:e,projectionDelta:i})=>{const o=n,l=Pg.parse(n);if(l.length>5)return o;const d=Pg.createTransformer(n),p=typeof l[0]!="number"?1:0,_=i.x.scale*e.x,E=i.y.scale*e.y;l[0+p]/=_,l[1+p]/=E;const b=_s(_,E,.5);return typeof l[2+p]=="number"&&(l[2+p]/=b),typeof l[3+p]=="number"&&(l[3+p]/=b),d(l)}};class Oke extends D.Component{componentDidMount(){const{visualElement:e,layoutGroup:i,switchLayoutGroup:o,layoutId:l}=this.props,{projection:d}=e;XAe(kke),d&&(i.group&&i.group.add(d),o&&o.register&&l&&o.register(d),d.root.didUpdate(),d.addEventListener("animationComplete",()=>{this.safeToRemove()}),d.setOptions({...d.options,onExitComplete:()=>this.safeToRemove()})),uk.hasEverUpdated=!0}getSnapshotBeforeUpdate(e){const{layoutDependency:i,visualElement:o,drag:l,isPresent:d}=this.props,p=o.projection;return p&&(p.isPresent=d,l||e.layoutDependency!==i||i===void 0?p.willUpdate():this.safeToRemove(),e.isPresent!==d&&(d?p.promote():p.relegate()||rs.postRender(()=>{const _=p.getStack();(!_||!_.members.length)&&this.safeToRemove()}))),null}componentDidUpdate(){const{projection:e}=this.props.visualElement;e&&(e.root.didUpdate(),aj.postRender(()=>{!e.currentAnimation&&e.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:e,layoutGroup:i,switchLayoutGroup:o}=this.props,{projection:l}=e;l&&(l.scheduleCheckAfterUnmount(),i&&i.group&&i.group.remove(l),o&&o.deregister&&o.deregister(l))}safeToRemove(){const{safeToRemove:e}=this.props;e&&e()}render(){return null}}function Ute(n){const[e,i]=tj(),o=D.useContext(QF);return w.jsx(Oke,{...n,layoutGroup:o,switchLayoutGroup:D.useContext(Iee),isPresent:e,safeToRemove:i})}const kke={borderRadius:{...Ew,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:Ew,borderTopRightRadius:Ew,borderBottomLeftRadius:Ew,borderBottomRightRadius:Ew,boxShadow:Pke};function Nke(n,e,i){const o=Qa(n)?n:PC(n);return o.start(Nj("",o,e,i)),o.animation}function Dke(n){return n instanceof SVGElement&&n.tagName!=="svg"}const xke=(n,e)=>n.depth-e.depth;class Lke{constructor(){this.children=[],this.isDirty=!1}add(e){Sj(this.children,e),this.isDirty=!0}remove(e){bj(this.children,e),this.isDirty=!0}forEach(e){this.isDirty&&this.children.sort(xke),this.isDirty=!1,this.children.forEach(e)}}function Mke(n,e){const i=nf.now(),o=({timestamp:l})=>{const d=l-i;d>=e&&(Ag(o),n(d-e))};return rs.read(o,!0),()=>Ag(o)}const Vte=["TopLeft","TopRight","BottomLeft","BottomRight"],Uke=Vte.length,fY=n=>typeof n=="string"?parseFloat(n):n,pY=n=>typeof n=="number"||Fn.test(n);function Vke(n,e,i,o,l,d){l?(n.opacity=_s(0,i.opacity!==void 0?i.opacity:1,Fke(o)),n.opacityExit=_s(e.opacity!==void 0?e.opacity:1,0,jke(o))):d&&(n.opacity=_s(e.opacity!==void 0?e.opacity:1,i.opacity!==void 0?i.opacity:1,o));for(let p=0;p<Uke;p++){const _=`border${Vte[p]}Radius`;let E=mY(e,_),b=mY(i,_);if(E===void 0&&b===void 0)continue;E||(E=0),b||(b=0),E===0||b===0||pY(E)===pY(b)?(n[_]=Math.max(_s(fY(E),fY(b),o),0),(tf.test(b)||tf.test(E))&&(n[_]+="%")):n[_]=b}(e.rotate||i.rotate)&&(n.rotate=_s(e.rotate||0,i.rotate||0,o))}function mY(n,e){return n[e]!==void 0?n[e]:n.borderRadius}const Fke=Fte(0,.5,rte),jke=Fte(.5,.95,Bl);function Fte(n,e,i){return o=>o<n?0:o>e?1:i(g0(n,e,o))}function gY(n,e){n.min=e.min,n.max=e.max}function Pu(n,e){gY(n.x,e.x),gY(n.y,e.y)}function _Y(n,e){n.translate=e.translate,n.scale=e.scale,n.originPoint=e.originPoint,n.origin=e.origin}function yY(n,e,i,o,l){return n-=e,n=Hk(n,1/i,o),l!==void 0&&(n=Hk(n,1/l,o)),n}function Bke(n,e=0,i=1,o=.5,l,d=n,p=n){if(tf.test(e)&&(e=parseFloat(e),e=_s(p.min,p.max,e/100)-p.min),typeof e!="number")return;let _=_s(d.min,d.max,o);n===d&&(_-=e),n.min=yY(n.min,e,i,_,l),n.max=yY(n.max,e,i,_,l)}function EY(n,e,[i,o,l],d,p){Bke(n,e[i],e[o],e[l],e.scale,d,p)}const Wke=["x","scaleX","originX"],zke=["y","scaleY","originY"];function vY(n,e,i,o){EY(n.x,e,Wke,i?i.x:void 0,o?o.x:void 0),EY(n.y,e,zke,i?i.y:void 0,o?o.y:void 0)}function SY(n){return n.translate===0&&n.scale===1}function jte(n){return SY(n.x)&&SY(n.y)}function bY(n,e){return n.min===e.min&&n.max===e.max}function Gke(n,e){return bY(n.x,e.x)&&bY(n.y,e.y)}function TY(n,e){return Math.round(n.min)===Math.round(e.min)&&Math.round(n.max)===Math.round(e.max)}function Bte(n,e){return TY(n.x,e.x)&&TY(n.y,e.y)}function wY(n){return Wl(n.x)/Wl(n.y)}function CY(n,e){return n.translate===e.translate&&n.scale===e.scale&&n.originPoint===e.originPoint}class Hke{constructor(){this.members=[]}add(e){Sj(this.members,e),e.scheduleRender()}remove(e){if(bj(this.members,e),e===this.prevLead&&(this.prevLead=void 0),e===this.lead){const i=this.members[this.members.length-1];i&&this.promote(i)}}relegate(e){const i=this.members.findIndex(l=>e===l);if(i===0)return!1;let o;for(let l=i;l>=0;l--){const d=this.members[l];if(d.isPresent!==!1){o=d;break}}return o?(this.promote(o),!0):!1}promote(e,i){const o=this.lead;if(e!==o&&(this.prevLead=o,this.lead=e,e.show(),o)){o.instance&&o.scheduleRender(),e.scheduleRender(),e.resumeFrom=o,i&&(e.resumeFrom.preserveOpacity=!0),o.snapshot&&(e.snapshot=o.snapshot,e.snapshot.latestValues=o.animationValues||o.latestValues),e.root&&e.root.isUpdating&&(e.isLayoutDirty=!0);const{crossfade:l}=e.options;l===!1&&o.hide()}}exitAnimationComplete(){this.members.forEach(e=>{const{options:i,resumingFrom:o}=e;i.onExitComplete&&i.onExitComplete(),o&&o.options.onExitComplete&&o.options.onExitComplete()})}scheduleRender(){this.members.forEach(e=>{e.instance&&e.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}function $ke(n,e,i){let o="";const l=n.x.translate/e.x,d=n.y.translate/e.y,p=(i==null?void 0:i.z)||0;if((l||d||p)&&(o=`translate3d(${l}px, ${d}px, ${p}px) `),(e.x!==1||e.y!==1)&&(o+=`scale(${1/e.x}, ${1/e.y}) `),i){const{transformPerspective:b,rotate:C,rotateX:I,rotateY:O,skewX:L,skewY:V}=i;b&&(o=`perspective(${b}px) ${o}`),C&&(o+=`rotate(${C}deg) `),I&&(o+=`rotateX(${I}deg) `),O&&(o+=`rotateY(${O}deg) `),L&&(o+=`skewX(${L}deg) `),V&&(o+=`skewY(${V}deg) `)}const _=n.x.scale*e.x,E=n.y.scale*e.y;return(_!==1||E!==1)&&(o+=`scale(${_}, ${E})`),o||"none"}const my={type:"projectionFrame",totalNodes:0,resolvedTargetDeltas:0,recalculatedProjection:0},Gw=typeof window<"u"&&window.MotionDebug!==void 0,JM=["","X","Y","Z"],Kke={visibility:"hidden"},RY=1e3;let qke=0;function QM(n,e,i,o){const{latestValues:l}=e;l[n]&&(i[n]=l[n],e.setStaticValue(n,0),o&&(o[n]=0))}function Wte(n){if(n.hasCheckedOptimisedAppear=!0,n.root===n)return;const{visualElement:e}=n.options;if(!e)return;const i=Xee(e);if(window.MotionHasOptimisedAnimation(i,"transform")){const{layout:l,layoutId:d}=n.options;window.MotionCancelOptimisedAnimation(i,"transform",rs,!(l||d))}const{parent:o}=n;o&&!o.hasCheckedOptimisedAppear&&Wte(o)}function zte({attachResizeListener:n,defaultParent:e,measureScroll:i,checkIsScrollRoot:o,resetTransform:l}){return class{constructor(p={},_=e==null?void 0:e()){this.id=qke++,this.animationId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.hasCheckedOptimisedAppear=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.updateScheduled=!1,this.scheduleUpdate=()=>this.update(),this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,Gw&&(my.totalNodes=my.resolvedTargetDeltas=my.recalculatedProjection=0),this.nodes.forEach(Jke),this.nodes.forEach(n1e),this.nodes.forEach(r1e),this.nodes.forEach(Qke),Gw&&window.MotionDebug.record(my)},this.resolvedRelativeTargetAt=0,this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=p,this.root=_?_.root||_:this,this.path=_?[..._.path,_]:[],this.parent=_,this.depth=_?_.depth+1:0;for(let E=0;E<this.path.length;E++)this.path[E].shouldResetTransform=!0;this.root===this&&(this.nodes=new Lke)}addEventListener(p,_){return this.eventHandlers.has(p)||this.eventHandlers.set(p,new Tj),this.eventHandlers.get(p).add(_)}notifyListeners(p,..._){const E=this.eventHandlers.get(p);E&&E.notify(..._)}hasListeners(p){return this.eventHandlers.has(p)}mount(p,_=this.root.hasTreeAnimated){if(this.instance)return;this.isSVG=Dke(p),this.instance=p;const{layoutId:E,layout:b,visualElement:C}=this.options;if(C&&!C.current&&C.mount(p),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),_&&(b||E)&&(this.isLayoutDirty=!0),n){let I;const O=()=>this.root.updateBlockedByResize=!1;n(p,()=>{this.root.updateBlockedByResize=!0,I&&I(),I=Mke(O,250),uk.hasAnimatedSinceResize&&(uk.hasAnimatedSinceResize=!1,this.nodes.forEach(AY))})}E&&this.root.registerSharedNode(E,this),this.options.animate!==!1&&C&&(E||b)&&this.addEventListener("didUpdate",({delta:I,hasLayoutChanged:O,hasRelativeTargetChanged:L,layout:V})=>{if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}const B=this.options.transition||C.getDefaultTransition()||c1e,{onLayoutAnimationStart:W,onLayoutAnimationComplete:Z}=C.getProps(),$=!this.targetLayout||!Bte(this.targetLayout,V)||L,se=!O&&L;if(this.options.layoutRoot||this.resumeFrom&&this.resumeFrom.instance||se||O&&($||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0),this.setAnimationOrigin(I,se);const ue={..._j(B,"layout"),onPlay:W,onComplete:Z};(C.shouldReduceMotion||this.options.layoutRoot)&&(ue.delay=0,ue.type=!1),this.startAnimation(ue)}else O||AY(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=V})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const p=this.getStack();p&&p.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,Ag(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(i1e),this.animationId++)}getTransformTemplate(){const{visualElement:p}=this.options;return p&&p.getProps().transformTemplate}willUpdate(p=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked()){this.options.onExitComplete&&this.options.onExitComplete();return}if(window.MotionCancelOptimisedAnimation&&!this.hasCheckedOptimisedAppear&&Wte(this),!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let C=0;C<this.path.length;C++){const I=this.path[C];I.shouldResetTransform=!0,I.updateScroll("snapshot"),I.options.layoutRoot&&I.willUpdate(!1)}const{layoutId:_,layout:E}=this.options;if(_===void 0&&!E)return;const b=this.getTransformTemplate();this.prevTransformTemplateValue=b?b(this.latestValues,""):void 0,this.updateSnapshot(),p&&this.notifyListeners("willUpdate")}update(){if(this.updateScheduled=!1,this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach(IY);return}this.isUpdating||this.nodes.forEach(e1e),this.isUpdating=!1,this.nodes.forEach(t1e),this.nodes.forEach(Yke),this.nodes.forEach(Xke),this.clearAllSnapshots();const _=nf.now();_a.delta=Bp(0,1e3/60,_-_a.timestamp),_a.timestamp=_,_a.isProcessing=!0,zM.update.process(_a),zM.preRender.process(_a),zM.render.process(_a),_a.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,aj.read(this.scheduleUpdate))}clearAllSnapshots(){this.nodes.forEach(Zke),this.sharedNodes.forEach(s1e)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,rs.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){rs.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){this.snapshot||!this.instance||(this.snapshot=this.measure())}updateLayout(){if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let E=0;E<this.path.length;E++)this.path[E].updateScroll();const p=this.layout;this.layout=this.measure(!1),this.layoutCorrected=Hs(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:_}=this.options;_&&_.notify("LayoutMeasure",this.layout.layoutBox,p?p.layoutBox:void 0)}updateScroll(p="measure"){let _=!!(this.options.layoutScroll&&this.instance);if(this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===p&&(_=!1),_){const E=o(this.instance);this.scroll={animationId:this.root.animationId,phase:p,isRoot:E,offset:i(this.instance),wasRoot:this.scroll?this.scroll.isRoot:E}}}resetTransform(){if(!l)return;const p=this.isLayoutDirty||this.shouldResetTransform||this.options.alwaysMeasureLayout,_=this.projectionDelta&&!jte(this.projectionDelta),E=this.getTransformTemplate(),b=E?E(this.latestValues,""):void 0,C=b!==this.prevTransformTemplateValue;p&&(_||py(this.latestValues)||C)&&(l(this.instance,b),this.shouldResetTransform=!1,this.scheduleRender())}measure(p=!0){const _=this.measurePageBox();let E=this.removeElementScroll(_);return p&&(E=this.removeTransform(E)),l1e(E),{animationId:this.root.animationId,measuredBox:_,layoutBox:E,latestValues:{},source:this.id}}measurePageBox(){var p;const{visualElement:_}=this.options;if(!_)return Hs();const E=_.measureViewportBox();if(!(((p=this.scroll)===null||p===void 0?void 0:p.wasRoot)||this.path.some(u1e))){const{scroll:C}=this.root;C&&(GS(E.x,C.offset.x),GS(E.y,C.offset.y))}return E}removeElementScroll(p){var _;const E=Hs();if(Pu(E,p),!((_=this.scroll)===null||_===void 0)&&_.wasRoot)return E;for(let b=0;b<this.path.length;b++){const C=this.path[b],{scroll:I,options:O}=C;C!==this.root&&I&&O.layoutScroll&&(I.wasRoot&&Pu(E,p),GS(E.x,I.offset.x),GS(E.y,I.offset.y))}return E}applyTransform(p,_=!1){const E=Hs();Pu(E,p);for(let b=0;b<this.path.length;b++){const C=this.path[b];!_&&C.options.layoutScroll&&C.scroll&&C!==C.root&&HS(E,{x:-C.scroll.offset.x,y:-C.scroll.offset.y}),py(C.latestValues)&&HS(E,C.latestValues)}return py(this.latestValues)&&HS(E,this.latestValues),E}removeTransform(p){const _=Hs();Pu(_,p);for(let E=0;E<this.path.length;E++){const b=this.path[E];if(!b.instance||!py(b.latestValues))continue;gV(b.latestValues)&&b.updateSnapshot();const C=Hs(),I=b.measurePageBox();Pu(C,I),vY(_,b.latestValues,b.snapshot?b.snapshot.layoutBox:void 0,C)}return py(this.latestValues)&&vY(_,this.latestValues),_}setTargetDelta(p){this.targetDelta=p,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(p){this.options={...this.options,...p,crossfade:p.crossfade!==void 0?p.crossfade:!0}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==_a.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(p=!1){var _;const E=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=E.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=E.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=E.isSharedProjectionDirty);const b=!!this.resumingFrom||this!==E;if(!(p||b&&this.isSharedProjectionDirty||this.isProjectionDirty||!((_=this.parent)===null||_===void 0)&&_.isProjectionDirty||this.attemptToResolveRelativeTarget||this.root.updateBlockedByResize))return;const{layout:I,layoutId:O}=this.options;if(!(!this.layout||!(I||O))){if(this.resolvedRelativeTargetAt=_a.timestamp,!this.targetDelta&&!this.relativeTarget){const L=this.getClosestProjectingParent();L&&L.layout&&this.animationProgress!==1?(this.relativeParent=L,this.forceRelativeParentToResolveTarget(),this.relativeTarget=Hs(),this.relativeTargetOrigin=Hs(),lC(this.relativeTargetOrigin,this.layout.layoutBox,L.layout.layoutBox),Pu(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}if(!(!this.relativeTarget&&!this.targetDelta)){if(this.target||(this.target=Hs(),this.targetWithTransforms=Hs()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),fke(this.target,this.relativeTarget,this.relativeParent.target)):this.targetDelta?(this.resumingFrom?this.target=this.applyTransform(this.layout.layoutBox):Pu(this.target,this.layout.layoutBox),xte(this.target,this.targetDelta)):Pu(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget){this.attemptToResolveRelativeTarget=!1;const L=this.getClosestProjectingParent();L&&!!L.resumingFrom==!!this.resumingFrom&&!L.options.layoutScroll&&L.target&&this.animationProgress!==1?(this.relativeParent=L,this.forceRelativeParentToResolveTarget(),this.relativeTarget=Hs(),this.relativeTargetOrigin=Hs(),lC(this.relativeTargetOrigin,this.target,L.target),Pu(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}Gw&&my.resolvedTargetDeltas++}}}getClosestProjectingParent(){if(!(!this.parent||gV(this.parent.latestValues)||Dte(this.parent.latestValues)))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return!!((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}calcProjection(){var p;const _=this.getLead(),E=!!this.resumingFrom||this!==_;let b=!0;if((this.isProjectionDirty||!((p=this.parent)===null||p===void 0)&&p.isProjectionDirty)&&(b=!1),E&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(b=!1),this.resolvedRelativeTargetAt===_a.timestamp&&(b=!1),b)return;const{layout:C,layoutId:I}=this.options;if(this.isTreeAnimating=!!(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!(C||I))return;Pu(this.layoutCorrected,this.layout.layoutBox);const O=this.treeScale.x,L=this.treeScale.y;bke(this.layoutCorrected,this.treeScale,this.path,E),_.layout&&!_.target&&(this.treeScale.x!==1||this.treeScale.y!==1)&&(_.target=_.layout.layoutBox,_.targetWithTransforms=Hs());const{target:V}=_;if(!V){this.prevProjectionDelta&&(this.createProjectionDeltas(),this.scheduleRender());return}!this.projectionDelta||!this.prevProjectionDelta?this.createProjectionDeltas():(_Y(this.prevProjectionDelta.x,this.projectionDelta.x),_Y(this.prevProjectionDelta.y,this.projectionDelta.y)),cC(this.projectionDelta,this.layoutCorrected,V,this.latestValues),(this.treeScale.x!==O||this.treeScale.y!==L||!CY(this.projectionDelta.x,this.prevProjectionDelta.x)||!CY(this.projectionDelta.y,this.prevProjectionDelta.y))&&(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",V)),Gw&&my.recalculatedProjection++}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(p=!0){var _;if((_=this.options.visualElement)===null||_===void 0||_.scheduleRender(),p){const E=this.getStack();E&&E.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}createProjectionDeltas(){this.prevProjectionDelta=zS(),this.projectionDelta=zS(),this.projectionDeltaWithTransform=zS()}setAnimationOrigin(p,_=!1){const E=this.snapshot,b=E?E.latestValues:{},C={...this.latestValues},I=zS();(!this.relativeParent||!this.relativeParent.options.layoutRoot)&&(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!_;const O=Hs(),L=E?E.source:void 0,V=this.layout?this.layout.source:void 0,B=L!==V,W=this.getStack(),Z=!W||W.members.length<=1,$=!!(B&&!Z&&this.options.crossfade===!0&&!this.path.some(a1e));this.animationProgress=0;let se;this.mixTargetDelta=ue=>{const re=ue/1e3;PY(I.x,p.x,re),PY(I.y,p.y,re),this.setTargetDelta(I),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(lC(O,this.layout.layoutBox,this.relativeParent.layout.layoutBox),o1e(this.relativeTarget,this.relativeTargetOrigin,O,re),se&&Gke(this.relativeTarget,se)&&(this.isProjectionDirty=!1),se||(se=Hs()),Pu(se,this.relativeTarget)),B&&(this.animationValues=C,Vke(C,b,this.latestValues,re,$,Z)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=re},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(p){this.notifyListeners("animationStart"),this.currentAnimation&&this.currentAnimation.stop(),this.resumingFrom&&this.resumingFrom.currentAnimation&&this.resumingFrom.currentAnimation.stop(),this.pendingAnimation&&(Ag(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=rs.update(()=>{uk.hasAnimatedSinceResize=!0,this.currentAnimation=Nke(0,RY,{...p,onUpdate:_=>{this.mixTargetDelta(_),p.onUpdate&&p.onUpdate(_)},onComplete:()=>{p.onComplete&&p.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const p=this.getStack();p&&p.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(RY),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const p=this.getLead();let{targetWithTransforms:_,target:E,layout:b,latestValues:C}=p;if(!(!_||!E||!b)){if(this!==p&&this.layout&&b&&Gte(this.options.animationType,this.layout.layoutBox,b.layoutBox)){E=this.target||Hs();const I=Wl(this.layout.layoutBox.x);E.x.min=p.target.x.min,E.x.max=E.x.min+I;const O=Wl(this.layout.layoutBox.y);E.y.min=p.target.y.min,E.y.max=E.y.min+O}Pu(_,E),HS(_,C),cC(this.projectionDeltaWithTransform,this.layoutCorrected,_,C)}}registerSharedNode(p,_){this.sharedNodes.has(p)||this.sharedNodes.set(p,new Hke),this.sharedNodes.get(p).add(_);const b=_.options.initialPromotionConfig;_.promote({transition:b?b.transition:void 0,preserveFollowOpacity:b&&b.shouldPreserveFollowOpacity?b.shouldPreserveFollowOpacity(_):void 0})}isLead(){const p=this.getStack();return p?p.lead===this:!0}getLead(){var p;const{layoutId:_}=this.options;return _?((p=this.getStack())===null||p===void 0?void 0:p.lead)||this:this}getPrevLead(){var p;const{layoutId:_}=this.options;return _?(p=this.getStack())===null||p===void 0?void 0:p.prevLead:void 0}getStack(){const{layoutId:p}=this.options;if(p)return this.root.sharedNodes.get(p)}promote({needsReset:p,transition:_,preserveFollowOpacity:E}={}){const b=this.getStack();b&&b.promote(this,E),p&&(this.projectionDelta=void 0,this.needsReset=!0),_&&this.setOptions({transition:_})}relegate(){const p=this.getStack();return p?p.relegate(this):!1}resetSkewAndRotation(){const{visualElement:p}=this.options;if(!p)return;let _=!1;const{latestValues:E}=p;if((E.z||E.rotate||E.rotateX||E.rotateY||E.rotateZ||E.skewX||E.skewY)&&(_=!0),!_)return;const b={};E.z&&QM("z",p,b,this.animationValues);for(let C=0;C<JM.length;C++)QM(`rotate${JM[C]}`,p,b,this.animationValues),QM(`skew${JM[C]}`,p,b,this.animationValues);p.render();for(const C in b)p.setStaticValue(C,b[C]),this.animationValues&&(this.animationValues[C]=b[C]);p.scheduleRender()}getProjectionStyles(p){var _,E;if(!this.instance||this.isSVG)return;if(!this.isVisible)return Kke;const b={visibility:""},C=this.getTransformTemplate();if(this.needsReset)return this.needsReset=!1,b.opacity="",b.pointerEvents=ck(p==null?void 0:p.pointerEvents)||"",b.transform=C?C(this.latestValues,""):"none",b;const I=this.getLead();if(!this.projectionDelta||!this.layout||!I.target){const B={};return this.options.layoutId&&(B.opacity=this.latestValues.opacity!==void 0?this.latestValues.opacity:1,B.pointerEvents=ck(p==null?void 0:p.pointerEvents)||""),this.hasProjected&&!py(this.latestValues)&&(B.transform=C?C({},""):"none",this.hasProjected=!1),B}const O=I.animationValues||I.latestValues;this.applyTransformsToTarget(),b.transform=$ke(this.projectionDeltaWithTransform,this.treeScale,O),C&&(b.transform=C(O,b.transform));const{x:L,y:V}=this.projectionDelta;b.transformOrigin=`${L.origin*100}% ${V.origin*100}% 0`,I.animationValues?b.opacity=I===this?(E=(_=O.opacity)!==null&&_!==void 0?_:this.latestValues.opacity)!==null&&E!==void 0?E:1:this.preserveOpacity?this.latestValues.opacity:O.opacityExit:b.opacity=I===this?O.opacity!==void 0?O.opacity:"":O.opacityExit!==void 0?O.opacityExit:0;for(const B in jk){if(O[B]===void 0)continue;const{correct:W,applyTo:Z}=jk[B],$=b.transform==="none"?O[B]:W(O[B],I);if(Z){const se=Z.length;for(let ue=0;ue<se;ue++)b[Z[ue]]=$}else b[B]=$}return this.options.layoutId&&(b.pointerEvents=I===this?ck(p==null?void 0:p.pointerEvents)||"":"none"),b}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(p=>{var _;return(_=p.currentAnimation)===null||_===void 0?void 0:_.stop()}),this.root.nodes.forEach(IY),this.root.sharedNodes.clear()}}}function Yke(n){n.updateLayout()}function Xke(n){var e;const i=((e=n.resumeFrom)===null||e===void 0?void 0:e.snapshot)||n.snapshot;if(n.isLead()&&n.layout&&i&&n.hasListeners("didUpdate")){const{layoutBox:o,measuredBox:l}=n.layout,{animationType:d}=n.options,p=i.source!==n.layout.source;d==="size"?Nu(I=>{const O=p?i.measuredBox[I]:i.layoutBox[I],L=Wl(O);O.min=o[I].min,O.max=O.min+L}):Gte(d,i.layoutBox,o)&&Nu(I=>{const O=p?i.measuredBox[I]:i.layoutBox[I],L=Wl(o[I]);O.max=O.min+L,n.relativeTarget&&!n.currentAnimation&&(n.isProjectionDirty=!0,n.relativeTarget[I].max=n.relativeTarget[I].min+L)});const _=zS();cC(_,o,i.layoutBox);const E=zS();p?cC(E,n.applyTransform(l,!0),i.measuredBox):cC(E,o,i.layoutBox);const b=!jte(_);let C=!1;if(!n.resumeFrom){const I=n.getClosestProjectingParent();if(I&&!I.resumeFrom){const{snapshot:O,layout:L}=I;if(O&&L){const V=Hs();lC(V,i.layoutBox,O.layoutBox);const B=Hs();lC(B,o,L.layoutBox),Bte(V,B)||(C=!0),I.options.layoutRoot&&(n.relativeTarget=B,n.relativeTargetOrigin=V,n.relativeParent=I)}}}n.notifyListeners("didUpdate",{layout:o,snapshot:i,delta:E,layoutDelta:_,hasLayoutChanged:b,hasRelativeTargetChanged:C})}else if(n.isLead()){const{onExitComplete:o}=n.options;o&&o()}n.options.transition=void 0}function Jke(n){Gw&&my.totalNodes++,n.parent&&(n.isProjecting()||(n.isProjectionDirty=n.parent.isProjectionDirty),n.isSharedProjectionDirty||(n.isSharedProjectionDirty=!!(n.isProjectionDirty||n.parent.isProjectionDirty||n.parent.isSharedProjectionDirty)),n.isTransformDirty||(n.isTransformDirty=n.parent.isTransformDirty))}function Qke(n){n.isProjectionDirty=n.isSharedProjectionDirty=n.isTransformDirty=!1}function Zke(n){n.clearSnapshot()}function IY(n){n.clearMeasurements()}function e1e(n){n.isLayoutDirty=!1}function t1e(n){const{visualElement:e}=n.options;e&&e.getProps().onBeforeLayoutMeasure&&e.notify("BeforeLayoutMeasure"),n.resetTransform()}function AY(n){n.finishAnimation(),n.targetDelta=n.relativeTarget=n.target=void 0,n.isProjectionDirty=!0}function n1e(n){n.resolveTargetDelta()}function r1e(n){n.calcProjection()}function i1e(n){n.resetSkewAndRotation()}function s1e(n){n.removeLeadSnapshot()}function PY(n,e,i){n.translate=_s(e.translate,0,i),n.scale=_s(e.scale,1,i),n.origin=e.origin,n.originPoint=e.originPoint}function OY(n,e,i,o){n.min=_s(e.min,i.min,o),n.max=_s(e.max,i.max,o)}function o1e(n,e,i,o){OY(n.x,e.x,i.x,o),OY(n.y,e.y,i.y,o)}function a1e(n){return n.animationValues&&n.animationValues.opacityExit!==void 0}const c1e={duration:.45,ease:[.4,0,.1,1]},kY=n=>typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(n),NY=kY("applewebkit/")&&!kY("chrome/")?Math.round:Bl;function DY(n){n.min=NY(n.min),n.max=NY(n.max)}function l1e(n){DY(n.x),DY(n.y)}function Gte(n,e,i){return n==="position"||n==="preserve-aspect"&&!hke(wY(e),wY(i),.2)}function u1e(n){var e;return n!==n.root&&((e=n.scroll)===null||e===void 0?void 0:e.wasRoot)}const d1e=zte({attachResizeListener:(n,e)=>kC(n,"resize",e),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),ZM={current:void 0},Hte=zte({measureScroll:n=>({x:n.scrollLeft,y:n.scrollTop}),defaultParent:()=>{if(!ZM.current){const n=new d1e({});n.mount(window),n.setOptions({layoutScroll:!0}),ZM.current=n}return ZM.current},resetTransform:(n,e)=>{n.style.transform=e!==void 0?e:"none"},checkIsScrollRoot:n=>window.getComputedStyle(n).position==="fixed"}),h1e={pan:{Feature:Ake},drag:{Feature:Ike,ProjectionNode:Hte,MeasureLayout:Ute}};function xY(n,e,i){const{props:o}=n;n.animationState&&o.whileHover&&n.animationState.setActive("whileHover",i==="Start");const l="onHover"+i,d=o[l];d&&rs.postRender(()=>d(e,sR(e)))}class f1e extends Vg{mount(){const{current:e}=this.node;e&&(this.unmount=hPe(e,i=>(xY(this.node,i,"Start"),o=>xY(this.node,o,"End"))))}unmount(){}}class p1e extends Vg{constructor(){super(...arguments),this.isActive=!1}onFocus(){let e=!1;try{e=this.node.current.matches(":focus-visible")}catch{e=!0}!e||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){!this.isActive||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=iR(kC(this.node.current,"focus",()=>this.onFocus()),kC(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}function LY(n,e,i){const{props:o}=n;n.animationState&&o.whileTap&&n.animationState.setActive("whileTap",i==="Start");const l="onTap"+(i==="End"?"":i),d=o[l];d&&rs.postRender(()=>d(e,sR(e)))}class m1e extends Vg{mount(){const{current:e}=this.node;e&&(this.unmount=gPe(e,i=>(LY(this.node,i,"Start"),(o,{success:l})=>LY(this.node,o,l?"End":"Cancel")),{useGlobalTarget:this.node.props.globalTapTarget}))}unmount(){}}const yV=new WeakMap,eU=new WeakMap,g1e=n=>{const e=yV.get(n.target);e&&e(n)},_1e=n=>{n.forEach(g1e)};function y1e({root:n,...e}){const i=n||document;eU.has(i)||eU.set(i,{});const o=eU.get(i),l=JSON.stringify(e);return o[l]||(o[l]=new IntersectionObserver(_1e,{root:n,...e})),o[l]}function E1e(n,e,i){const o=y1e(e);return yV.set(n,i),o.observe(n),()=>{yV.delete(n),o.unobserve(n)}}const v1e={some:0,all:1};class S1e extends Vg{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:e={}}=this.node.getProps(),{root:i,margin:o,amount:l="some",once:d}=e,p={root:i?i.current:void 0,rootMargin:o,threshold:typeof l=="number"?l:v1e[l]},_=E=>{const{isIntersecting:b}=E;if(this.isInView===b||(this.isInView=b,d&&!b&&this.hasEnteredView))return;b&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",b);const{onViewportEnter:C,onViewportLeave:I}=this.node.getProps(),O=b?C:I;O&&O(E)};return E1e(this.node.current,p,_)}mount(){this.startObserver()}update(){if(typeof IntersectionObserver>"u")return;const{props:e,prevProps:i}=this.node;["amount","margin","root"].some(b1e(e,i))&&this.startObserver()}unmount(){}}function b1e({viewport:n={}},{viewport:e={}}={}){return i=>n[i]!==e[i]}const T1e={inView:{Feature:S1e},tap:{Feature:m1e},focus:{Feature:p1e},hover:{Feature:f1e}},w1e={layout:{ProjectionNode:Hte,MeasureLayout:Ute}},EV={current:null},$te={current:!1};function C1e(){if($te.current=!0,!!nj)if(window.matchMedia){const n=window.matchMedia("(prefers-reduced-motion)"),e=()=>EV.current=n.matches;n.addListener(e),e()}else EV.current=!1}const R1e=[..._te,Ya,Pg],I1e=n=>R1e.find(gte(n)),MY=new WeakMap;function A1e(n,e,i){for(const o in e){const l=e[o],d=i[o];if(Qa(l))n.addValue(o,l);else if(Qa(d))n.addValue(o,PC(l,{owner:n}));else if(d!==l)if(n.hasValue(o)){const p=n.getValue(o);p.liveStyle===!0?p.jump(l):p.hasAnimated||p.set(l)}else{const p=n.getStaticValue(o);n.addValue(o,PC(p!==void 0?p:l,{owner:n}))}}for(const o in i)e[o]===void 0&&n.removeValue(o);return e}const UY=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"];class P1e{scrapeMotionValuesFromProps(e,i,o){return{}}constructor({parent:e,props:i,presenceContext:o,reducedMotionConfig:l,blockInitialAnimation:d,visualState:p},_={}){this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.KeyframeResolver=Pj,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.renderScheduledAt=0,this.scheduleRender=()=>{const L=nf.now();this.renderScheduledAt<L&&(this.renderScheduledAt=L,rs.render(this.render,!1,!0))};const{latestValues:E,renderState:b,onUpdate:C}=p;this.onUpdate=C,this.latestValues=E,this.baseTarget={...E},this.initialValues=i.initial?{...E}:{},this.renderState=b,this.parent=e,this.props=i,this.presenceContext=o,this.depth=e?e.depth+1:0,this.reducedMotionConfig=l,this.options=_,this.blockInitialAnimation=!!d,this.isControllingVariants=j1(i),this.isVariantNode=Cee(i),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=!!(e&&e.current);const{willChange:I,...O}=this.scrapeMotionValuesFromProps(i,{},this);for(const L in O){const V=O[L];E[L]!==void 0&&Qa(V)&&V.set(E[L],!1)}}mount(e){this.current=e,MY.set(e,this),this.projection&&!this.projection.instance&&this.projection.mount(e),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((i,o)=>this.bindToMotionValue(o,i)),$te.current||C1e(),this.shouldReduceMotion=this.reducedMotionConfig==="never"?!1:this.reducedMotionConfig==="always"?!0:EV.current,this.parent&&this.parent.children.add(this),this.update(this.props,this.presenceContext)}unmount(){MY.delete(this.current),this.projection&&this.projection.unmount(),Ag(this.notifyUpdate),Ag(this.render),this.valueSubscriptions.forEach(e=>e()),this.valueSubscriptions.clear(),this.removeFromVariantTree&&this.removeFromVariantTree(),this.parent&&this.parent.children.delete(this);for(const e in this.events)this.events[e].clear();for(const e in this.features){const i=this.features[e];i&&(i.unmount(),i.isMounted=!1)}this.current=null}bindToMotionValue(e,i){this.valueSubscriptions.has(e)&&this.valueSubscriptions.get(e)();const o=Jy.has(e),l=i.on("change",_=>{this.latestValues[e]=_,this.props.onUpdate&&rs.preRender(this.notifyUpdate),o&&this.projection&&(this.projection.isTransformDirty=!0)}),d=i.on("renderRequest",this.scheduleRender);let p;window.MotionCheckAppearSync&&(p=window.MotionCheckAppearSync(this,e,i)),this.valueSubscriptions.set(e,()=>{l(),d(),p&&p(),i.owner&&i.stop()})}sortNodePosition(e){return!this.current||!this.sortInstanceNodePosition||this.type!==e.type?0:this.sortInstanceNodePosition(this.current,e.current)}updateFeatures(){let e="animation";for(e in _0){const i=_0[e];if(!i)continue;const{isEnabled:o,Feature:l}=i;if(!this.features[e]&&l&&o(this.props)&&(this.features[e]=new l(this)),this.features[e]){const d=this.features[e];d.isMounted?d.update():(d.mount(),d.isMounted=!0)}}}triggerBuild(){this.build(this.renderState,this.latestValues,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):Hs()}getStaticValue(e){return this.latestValues[e]}setStaticValue(e,i){this.latestValues[e]=i}update(e,i){(e.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=e,this.prevPresenceContext=this.presenceContext,this.presenceContext=i;for(let o=0;o<UY.length;o++){const l=UY[o];this.propEventSubscriptions[l]&&(this.propEventSubscriptions[l](),delete this.propEventSubscriptions[l]);const d="on"+l,p=e[d];p&&(this.propEventSubscriptions[l]=this.on(l,p))}this.prevMotionValues=A1e(this,this.scrapeMotionValuesFromProps(e,this.prevProps,this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue(),this.onUpdate&&this.onUpdate(this)}getProps(){return this.props}getVariant(e){return this.props.variants?this.props.variants[e]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}addVariantChild(e){const i=this.getClosestVariantNode();if(i)return i.variantChildren&&i.variantChildren.add(e),()=>i.variantChildren.delete(e)}addValue(e,i){const o=this.values.get(e);i!==o&&(o&&this.removeValue(e),this.bindToMotionValue(e,i),this.values.set(e,i),this.latestValues[e]=i.get())}removeValue(e){this.values.delete(e);const i=this.valueSubscriptions.get(e);i&&(i(),this.valueSubscriptions.delete(e)),delete this.latestValues[e],this.removeValueFromRenderState(e,this.renderState)}hasValue(e){return this.values.has(e)}getValue(e,i){if(this.props.values&&this.props.values[e])return this.props.values[e];let o=this.values.get(e);return o===void 0&&i!==void 0&&(o=PC(i===null?void 0:i,{owner:this}),this.addValue(e,o)),o}readValue(e,i){var o;let l=this.latestValues[e]!==void 0||!this.current?this.latestValues[e]:(o=this.getBaseTargetFromProps(this.props,e))!==null&&o!==void 0?o:this.readValueFromInstance(this.current,e,this.options);return l!=null&&(typeof l=="string"&&(pte(l)||ste(l))?l=parseFloat(l):!I1e(l)&&Pg.test(i)&&(l=dte(e,i)),this.setBaseTarget(e,Qa(l)?l.get():l)),Qa(l)?l.get():l}setBaseTarget(e,i){this.baseTarget[e]=i}getBaseTarget(e){var i;const{initial:o}=this.props;let l;if(typeof o=="string"||typeof o=="object"){const p=lj(this.props,o,(i=this.presenceContext)===null||i===void 0?void 0:i.custom);p&&(l=p[e])}if(o&&l!==void 0)return l;const d=this.getBaseTargetFromProps(this.props,e);return d!==void 0&&!Qa(d)?d:this.initialValues[e]!==void 0&&l===void 0?void 0:this.baseTarget[e]}on(e,i){return this.events[e]||(this.events[e]=new Tj),this.events[e].add(i)}notify(e,...i){this.events[e]&&this.events[e].notify(...i)}}class Kte extends P1e{constructor(){super(...arguments),this.KeyframeResolver=yte}sortInstanceNodePosition(e,i){return e.compareDocumentPosition(i)&2?1:-1}getBaseTargetFromProps(e,i){return e.style?e.style[i]:void 0}removeValueFromRenderState(e,{vars:i,style:o}){delete i[e],delete o[e]}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:e}=this.props;Qa(e)&&(this.childSubscription=e.on("change",i=>{this.current&&(this.current.textContent=`${i}`)}))}}function O1e(n){return window.getComputedStyle(n)}class k1e extends Kte{constructor(){super(...arguments),this.type="html",this.renderInstance=xee}readValueFromInstance(e,i){if(Jy.has(i)){const o=Aj(i);return o&&o.default||0}else{const o=O1e(e),l=(kee(i)?o.getPropertyValue(i):o[i])||0;return typeof l=="string"?l.trim():l}}measureInstanceViewportBox(e,{transformPagePoint:i}){return Lte(e,i)}build(e,i,o){hj(e,i,o.transformTemplate)}scrapeMotionValuesFromProps(e,i,o){return gj(e,i,o)}}class N1e extends Kte{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1,this.measureInstanceViewportBox=Hs}getBaseTargetFromProps(e,i){return e[i]}readValueFromInstance(e,i){if(Jy.has(i)){const o=Aj(i);return o&&o.default||0}return i=Lee.has(i)?i:oj(i),e.getAttribute(i)}scrapeMotionValuesFromProps(e,i,o){return Vee(e,i,o)}build(e,i,o){fj(e,i,this.isSVGTag,o.transformTemplate)}renderInstance(e,i,o,l){Mee(e,i,o,l)}mount(e){this.isSVGTag=mj(e.tagName),super.mount(e)}}const D1e=(n,e)=>cj(n)?new N1e(e):new k1e(e,{allowProjection:n!==D.Fragment}),x1e=sPe({...rke,...T1e,...h1e,...w1e},D1e),mf=vAe(x1e),L1e=(n,e)=>n.find(i=>i.id===e);function VY(n,e){const i=qte(n,e),o=i?n[i].findIndex(l=>l.id===e):-1;return{position:i,index:o}}function qte(n,e){for(const[i,o]of Object.entries(n))if(L1e(o,e))return i}function M1e(n){const e=n.includes("right"),i=n.includes("left");let o="center";return e&&(o="flex-end"),i&&(o="flex-start"),{display:"flex",flexDirection:"column",alignItems:o}}function U1e(n){const i=n==="top"||n==="bottom"?"0 auto":void 0,o=n.includes("top")?"env(safe-area-inset-top, 0px)":void 0,l=n.includes("bottom")?"env(safe-area-inset-bottom, 0px)":void 0,d=n.includes("left")?void 0:"env(safe-area-inset-right, 0px)",p=n.includes("right")?void 0:"env(safe-area-inset-left, 0px)";return{position:"fixed",zIndex:"var(--toast-z-index, 5500)",pointerEvents:"none",display:"flex",flexDirection:"column",margin:i,top:o,bottom:l,right:d,left:p}}var V1e=/^((children|dangerouslySetInnerHTML|key|ref|autoFocus|defaultValue|defaultChecked|innerHTML|suppressContentEditableWarning|suppressHydrationWarning|valueLink|abbr|accept|acceptCharset|accessKey|action|allow|allowUserMedia|allowPaymentRequest|allowFullScreen|allowTransparency|alt|async|autoComplete|autoPlay|capture|cellPadding|cellSpacing|challenge|charSet|checked|cite|classID|className|cols|colSpan|content|contentEditable|contextMenu|controls|controlsList|coords|crossOrigin|data|dateTime|decoding|default|defer|dir|disabled|disablePictureInPicture|disableRemotePlayback|download|draggable|encType|enterKeyHint|fetchpriority|fetchPriority|form|formAction|formEncType|formMethod|formNoValidate|formTarget|frameBorder|headers|height|hidden|high|href|hrefLang|htmlFor|httpEquiv|id|inputMode|integrity|is|keyParams|keyType|kind|label|lang|list|loading|loop|low|marginHeight|marginWidth|max|maxLength|media|mediaGroup|method|min|minLength|multiple|muted|name|nonce|noValidate|open|optimum|pattern|placeholder|playsInline|poster|preload|profile|radioGroup|readOnly|referrerPolicy|rel|required|reversed|role|rows|rowSpan|sandbox|scope|scoped|scrolling|seamless|selected|shape|size|sizes|slot|span|spellCheck|src|srcDoc|srcLang|srcSet|start|step|style|summary|tabIndex|target|title|translate|type|useMap|value|width|wmode|wrap|about|datatype|inlist|prefix|property|resource|typeof|vocab|autoCapitalize|autoCorrect|autoSave|color|incremental|fallback|inert|itemProp|itemScope|itemType|itemID|itemRef|on|option|results|security|unselectable|accentHeight|accumulate|additive|alignmentBaseline|allowReorder|alphabetic|amplitude|arabicForm|ascent|attributeName|attributeType|autoReverse|azimuth|baseFrequency|baselineShift|baseProfile|bbox|begin|bias|by|calcMode|capHeight|clip|clipPathUnits|clipPath|clipRule|colorInterpolation|colorInterpolationFilters|colorProfile|colorRendering|contentScriptType|contentStyleType|cursor|cx|cy|d|decelerate|descent|diffuseConstant|direction|display|divisor|dominantBaseline|dur|dx|dy|edgeMode|elevation|enableBackground|end|exponent|externalResourcesRequired|fill|fillOpacity|fillRule|filter|filterRes|filterUnits|floodColor|floodOpacity|focusable|fontFamily|fontSize|fontSizeAdjust|fontStretch|fontStyle|fontVariant|fontWeight|format|from|fr|fx|fy|g1|g2|glyphName|glyphOrientationHorizontal|glyphOrientationVertical|glyphRef|gradientTransform|gradientUnits|hanging|horizAdvX|horizOriginX|ideographic|imageRendering|in|in2|intercept|k|k1|k2|k3|k4|kernelMatrix|kernelUnitLength|kerning|keyPoints|keySplines|keyTimes|lengthAdjust|letterSpacing|lightingColor|limitingConeAngle|local|markerEnd|markerMid|markerStart|markerHeight|markerUnits|markerWidth|mask|maskContentUnits|maskUnits|mathematical|mode|numOctaves|offset|opacity|operator|order|orient|orientation|origin|overflow|overlinePosition|overlineThickness|panose1|paintOrder|pathLength|patternContentUnits|patternTransform|patternUnits|pointerEvents|points|pointsAtX|pointsAtY|pointsAtZ|preserveAlpha|preserveAspectRatio|primitiveUnits|r|radius|refX|refY|renderingIntent|repeatCount|repeatDur|requiredExtensions|requiredFeatures|restart|result|rotate|rx|ry|scale|seed|shapeRendering|slope|spacing|specularConstant|specularExponent|speed|spreadMethod|startOffset|stdDeviation|stemh|stemv|stitchTiles|stopColor|stopOpacity|strikethroughPosition|strikethroughThickness|string|stroke|strokeDasharray|strokeDashoffset|strokeLinecap|strokeLinejoin|strokeMiterlimit|strokeOpacity|strokeWidth|surfaceScale|systemLanguage|tableValues|targetX|targetY|textAnchor|textDecoration|textRendering|textLength|to|transform|u1|u2|underlinePosition|underlineThickness|unicode|unicodeBidi|unicodeRange|unitsPerEm|vAlphabetic|vHanging|vIdeographic|vMathematical|values|vectorEffect|version|vertAdvY|vertOriginX|vertOriginY|viewBox|viewTarget|visibility|widths|wordSpacing|writingMode|x|xHeight|x1|x2|xChannelSelector|xlinkActuate|xlinkArcrole|xlinkHref|xlinkRole|xlinkShow|xlinkTitle|xlinkType|xmlBase|xmlns|xmlnsXlink|xmlLang|xmlSpace|y|y1|y2|yChannelSelector|z|zoomAndPan|for|class|autofocus)|(([Dd][Aa][Tt][Aa]|[Aa][Rr][Ii][Aa]|x)-.*))$/,F1e=uee(function(n){return V1e.test(n)||n.charCodeAt(0)===111&&n.charCodeAt(1)===110&&n.charCodeAt(2)<91}),j1e=F1e,B1e=function(e){return e!=="theme"},FY=function(e){return typeof e=="string"&&e.charCodeAt(0)>96?j1e:B1e},jY=function(e,i,o){var l;if(i){var d=i.shouldForwardProp;l=e.__emotion_forwardProp&&d?function(p){return e.__emotion_forwardProp(p)&&d(p)}:d}return typeof l!="function"&&o&&(l=e.__emotion_forwardProp),l},W1e=function(e){var i=e.cache,o=e.serialized,l=e.isStringTag;return GF(i,o,l),mee(function(){return HF(i,o,l)}),null},z1e=function n(e,i){var o=e.__emotion_real===e,l=o&&e.__emotion_base||e,d,p;i!==void 0&&(d=i.label,p=i.target);var _=jY(e,i,o),E=_||FY(l),b=!E("as");return function(){var C=arguments,I=o&&e.__emotion_styles!==void 0?e.__emotion_styles.slice(0):[];if(d!==void 0&&I.push("label:"+d+";"),C[0]==null||C[0].raw===void 0)I.push.apply(I,C);else{var O=C[0];I.push(O[0]);for(var L=C.length,V=1;V<L;V++)I.push(C[V],O[V])}var B=KF(function(W,Z,$){var se=b&&W.as||l,ue="",re=[],pe=W;if(W.theme==null){pe={};for(var q in W)pe[q]=W[q];pe.theme=D.useContext(m0)}typeof W.className=="string"?ue=hee(Z.registered,re,W.className):W.className!=null&&(ue=W.className+" ");var Q=L1(I.concat(re),Z.registered,pe);ue+=Z.key+"-"+Q.name,p!==void 0&&(ue+=" "+p);var J=b&&_===void 0?FY(se):E,ie={};for(var me in W)b&&me==="as"||J(me)&&(ie[me]=W[me]);return ie.className=ue,$&&(ie.ref=$),D.createElement(D.Fragment,null,D.createElement(W1e,{cache:Z,serialized:Q,isStringTag:typeof se=="string"}),D.createElement(se,ie))});return B.displayName=d!==void 0?d:"Styled("+(typeof l=="string"?l:l.displayName||l.name||"Component")+")",B.defaultProps=e.defaultProps,B.__emotion_real=B,B.__emotion_base=l,B.__emotion_styles=I,B.__emotion_forwardProp=_,Object.defineProperty(B,"toString",{value:function(){return"."+p}}),B.withComponent=function(W,Z){var $=n(W,Uy({},i,Z,{shouldForwardProp:jY(B,Z,!0)}));return $.apply(void 0,I)},B}},G1e=["a","abbr","address","area","article","aside","audio","b","base","bdi","bdo","big","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","data","datalist","dd","del","details","dfn","dialog","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","iframe","img","input","ins","kbd","keygen","label","legend","li","link","main","map","mark","marquee","menu","menuitem","meta","meter","nav","noscript","object","ol","optgroup","option","output","p","param","picture","pre","progress","q","rp","rt","ruby","s","samp","script","section","select","small","source","span","strong","style","sub","summary","sup","table","tbody","td","textarea","tfoot","th","thead","time","title","tr","track","u","ul","var","video","wbr","circle","clipPath","defs","ellipse","foreignObject","g","image","line","linearGradient","mask","path","pattern","polygon","polyline","radialGradient","rect","stop","svg","text","tspan"],vV=z1e.bind(null);G1e.forEach(function(n){vV[n]=vV(n)});const H1e=new Set([...uSe,"textStyle","layerStyle","apply","noOfLines","focusBorderColor","errorBorderColor","as","__css","css","sx"]),$1e=new Set(["htmlWidth","htmlHeight","htmlSize","htmlTranslate"]);function K1e(n){return($1e.has(n)||!H1e.has(n))&&n[0]!=="_"}const q1e=VEe(vV),Y1e=({baseStyle:n})=>e=>{const{theme:i,css:o,__css:l,sx:d,...p}=e,[_]=HEe(p,hSe),E=cl(n,e),b=wEe({},l,E,R1(_),d),C=zZ(b)(e.theme);return o?[C,o]:C};function tU(n,e){const{baseStyle:i,...o}=e??{};o.shouldForwardProp||(o.shouldForwardProp=K1e);const l=Y1e({baseStyle:i}),d=q1e(n,o)(l);return D.forwardRef(function(E,b){const{children:C,...I}=E,{colorMode:O,forced:L}=U1(),V=L?O:void 0;return D.createElement(d,{ref:b,"data-theme":V,...I},C)})}function X1e(){const n=new Map;return new Proxy(tU,{apply(e,i,o){return tU(...o)},get(e,i){return n.has(i)||n.set(i,tU(i)),n.get(i)}})}const Nt=X1e(),J1e={initial:n=>{const{position:e}=n,i=["top","bottom"].includes(e)?"y":"x";let o=["top-right","bottom-right"].includes(e)?1:-1;return e==="bottom"&&(o=1),{opacity:0,[i]:o*24}},animate:{opacity:1,y:0,x:0,scale:1,transition:{duration:.4,ease:[.4,0,.2,1]}},exit:{opacity:0,scale:.85,transition:{duration:.2,ease:[.4,0,1,1]}}},Yte=D.memo(n=>{const{id:e,message:i,onCloseComplete:o,onRequestRemove:l,requestClose:d=!1,position:p="bottom",duration:_=5e3,containerStyle:E,motionVariants:b=J1e,toastSpacing:C="0.5rem"}=n,[I,O]=D.useState(_),L=dAe();Fp(()=>{L||o==null||o()},[L]),Fp(()=>{O(_)},[_]);const V=()=>O(null),B=()=>O(_),W=()=>{L&&l()};D.useEffect(()=>{L&&d&&l()},[L,d,l]),pve(W,I);const Z=D.useMemo(()=>({pointerEvents:"auto",maxWidth:560,minWidth:300,margin:C,...E}),[E,C]),$=D.useMemo(()=>M1e(p),[p]);return w.jsx(mf.div,{layout:!0,className:"chakra-toast",variants:b,initial:"initial",animate:"animate",exit:"exit",onHoverStart:V,onHoverEnd:B,custom:{position:p},style:$,children:w.jsx(Nt.div,{role:"status","aria-atomic":"true",className:"chakra-toast__inner",__css:Z,children:cl(i,{id:e,onClose:W})})})});Yte.displayName="ToastComponent";function jt(n){return D.forwardRef(n)}var nU,BY;function Q1e(){if(BY)return nU;BY=1;var n=typeof Element<"u",e=typeof Map=="function",i=typeof Set=="function",o=typeof ArrayBuffer=="function"&&!!ArrayBuffer.isView;function l(d,p){if(d===p)return!0;if(d&&p&&typeof d=="object"&&typeof p=="object"){if(d.constructor!==p.constructor)return!1;var _,E,b;if(Array.isArray(d)){if(_=d.length,_!=p.length)return!1;for(E=_;E--!==0;)if(!l(d[E],p[E]))return!1;return!0}var C;if(e&&d instanceof Map&&p instanceof Map){if(d.size!==p.size)return!1;for(C=d.entries();!(E=C.next()).done;)if(!p.has(E.value[0]))return!1;for(C=d.entries();!(E=C.next()).done;)if(!l(E.value[1],p.get(E.value[0])))return!1;return!0}if(i&&d instanceof Set&&p instanceof Set){if(d.size!==p.size)return!1;for(C=d.entries();!(E=C.next()).done;)if(!p.has(E.value[0]))return!1;return!0}if(o&&ArrayBuffer.isView(d)&&ArrayBuffer.isView(p)){if(_=d.length,_!=p.length)return!1;for(E=_;E--!==0;)if(d[E]!==p[E])return!1;return!0}if(d.constructor===RegExp)return d.source===p.source&&d.flags===p.flags;if(d.valueOf!==Object.prototype.valueOf&&typeof d.valueOf=="function"&&typeof p.valueOf=="function")return d.valueOf()===p.valueOf();if(d.toString!==Object.prototype.toString&&typeof d.toString=="function"&&typeof p.toString=="function")return d.toString()===p.toString();if(b=Object.keys(d),_=b.length,_!==Object.keys(p).length)return!1;for(E=_;E--!==0;)if(!Object.prototype.hasOwnProperty.call(p,b[E]))return!1;if(n&&d instanceof Element)return!1;for(E=_;E--!==0;)if(!((b[E]==="_owner"||b[E]==="__v"||b[E]==="__o")&&d.$$typeof)&&!l(d[b[E]],p[b[E]]))return!1;return!0}return d!==d&&p!==p}return nU=function(p,_){try{return l(p,_)}catch(E){if((E.message||"").match(/stack|recursion/i))return console.warn("react-fast-compare cannot handle circular refs"),!1;throw E}},nU}var Z1e=Q1e();const eNe=Ug(Z1e);function z0(){const n=D.useContext(m0);if(!n)throw Error("useTheme: `theme` is undefined. Seems you forgot to wrap your app in `<ChakraProvider />` or `<ThemeProvider />`");return n}function Xte(){const n=U1(),e=z0();return{...n,theme:e}}function tNe(n,e,i){if(e==null)return e;const o=l=>{var d,p;return(p=(d=n.__cssMap)==null?void 0:d[l])==null?void 0:p.value};return o(e)??o(i)??i}function nNe(n,e,i){const o=Array.isArray(e)?e:[e],l=Array.isArray(i)?i:[i];return d=>{const p=l.filter(Boolean),_=o.map((E,b)=>{const C=`${n}.${E}`;return tNe(d,C,p[b]??E)});return Array.isArray(e)?_:_[0]}}function Jte(n,e={}){const{styleConfig:i,...o}=e,{theme:l,colorMode:d}=Xte(),p=n?CZ(l,`components.${n}`):void 0,_=i||p,E=qh({theme:l,colorMode:d},(_==null?void 0:_.defaultProps)??{},R1(V0(o,["children"])),(C,I)=>C?void 0:I),b=D.useRef({});if(_){const I=TSe(_)(E);eNe(b.current,I)||(b.current=I)}return b.current}function Hl(n,e={}){return Jte(n,e)}function nc(n,e={}){return Jte(n,e)}const WY={path:w.jsxs("g",{stroke:"currentColor",strokeWidth:"1.5",children:[w.jsx("path",{strokeLinecap:"round",fill:"none",d:"M9,9a3,3,0,1,1,4,2.829,1.5,1.5,0,0,0-1,1.415V14.25"}),w.jsx("path",{fill:"currentColor",strokeLinecap:"round",d:"M12,17.25a.375.375,0,1,0,.375.375A.375.375,0,0,0,12,17.25h0"}),w.jsx("circle",{fill:"none",strokeMiterlimit:"10",cx:"12",cy:"12",r:"11.25"})]}),viewBox:"0 0 24 24"},In=jt((n,e)=>{const{as:i,viewBox:o,color:l="currentColor",focusable:d=!1,children:p,className:_,__css:E,...b}=n,C=hn("chakra-icon",_),I=Hl("Icon",n),O={w:"1em",h:"1em",display:"inline-block",lineHeight:"1em",flexShrink:0,color:l,...E,...I},L={ref:e,focusable:d,className:C,__css:O},V=o??WY.viewBox;if(i&&typeof i!="string")return w.jsx(Nt.svg,{as:i,...L,...b});const B=p??WY.path;return w.jsx(Nt.svg,{verticalAlign:"middle",viewBox:V,...L,...b,children:B})});In.displayName="Icon";function rNe(n){return w.jsx(In,{viewBox:"0 0 24 24",...n,children:w.jsx("path",{fill:"currentColor",d:"M12,0A12,12,0,1,0,24,12,12.014,12.014,0,0,0,12,0Zm6.927,8.2-6.845,9.289a1.011,1.011,0,0,1-1.43.188L5.764,13.769a1,1,0,1,1,1.25-1.562l4.076,3.261,6.227-8.451A1,1,0,1,1,18.927,8.2Z"})})}function iNe(n){return w.jsx(In,{viewBox:"0 0 24 24",...n,children:w.jsx("path",{fill:"currentColor",d:"M12,0A12,12,0,1,0,24,12,12.013,12.013,0,0,0,12,0Zm.25,5a1.5,1.5,0,1,1-1.5,1.5A1.5,1.5,0,0,1,12.25,5ZM14.5,18.5h-4a1,1,0,0,1,0-2h.75a.25.25,0,0,0,.25-.25v-4.5a.25.25,0,0,0-.25-.25H10.5a1,1,0,0,1,0-2h1a2,2,0,0,1,2,2v4.75a.25.25,0,0,0,.25.25h.75a1,1,0,1,1,0,2Z"})})}function zY(n){return w.jsx(In,{viewBox:"0 0 24 24",...n,children:w.jsx("path",{fill:"currentColor",d:"M11.983,0a12.206,12.206,0,0,0-8.51,3.653A11.8,11.8,0,0,0,0,12.207,11.779,11.779,0,0,0,11.8,24h.214A12.111,12.111,0,0,0,24,11.791h0A11.766,11.766,0,0,0,11.983,0ZM10.5,16.542a1.476,1.476,0,0,1,1.449-1.53h.027a1.527,1.527,0,0,1,1.523,1.47,1.475,1.475,0,0,1-1.449,1.53h-.027A1.529,1.529,0,0,1,10.5,16.542ZM11,12.5v-6a1,1,0,0,1,2,0v6a1,1,0,1,1-2,0Z"})})}const sNe=eR({"0%":{transform:"rotate(0deg)"},"100%":{transform:"rotate(360deg)"}}),jd=jt((n,e)=>{const i=Hl("Spinner",n),{label:o="Loading...",thickness:l="2px",speed:d="0.45s",emptyColor:p="transparent",className:_,...E}=Vi(n),b=hn("chakra-spinner",_),C={display:"inline-block",borderColor:"currentColor",borderStyle:"solid",borderRadius:"99999px",borderWidth:l,borderBottomColor:p,borderLeftColor:p,animation:`${sNe} ${d} linear infinite`,...i};return w.jsx(Nt.div,{ref:e,__css:C,className:b,...E,children:o&&w.jsx(Nt.span,{srOnly:!0,children:o})})});jd.displayName="Spinner";const[oNe,Dj]=Ni({name:"AlertContext",hookName:"useAlertContext",providerName:"<Alert />"}),[aNe,xj]=Ni({name:"AlertStylesContext",hookName:"useAlertStyles",providerName:"<Alert />"}),Qte={info:{icon:iNe,colorScheme:"blue"},warning:{icon:zY,colorScheme:"orange"},success:{icon:rNe,colorScheme:"green"},error:{icon:zY,colorScheme:"red"},loading:{icon:jd,colorScheme:"blue"}};function cNe(n){return Qte[n].colorScheme}function lNe(n){return Qte[n].icon}const Cp=jt(function(e,i){const{status:o="info",addRole:l=!0,...d}=Vi(e),p=e.colorScheme??cNe(o),_=nc("Alert",{...e,colorScheme:p}),E={width:"100%",display:"flex",alignItems:"center",position:"relative",overflow:"hidden",..._.container};return w.jsx(oNe,{value:{status:o},children:w.jsx(aNe,{value:_,children:w.jsx(Nt.div,{"data-status":o,role:l?"alert":void 0,ref:i,...d,className:hn("chakra-alert",e.className),__css:E})})})});Cp.displayName="Alert";function Rp(n){const{status:e}=Dj(),i=lNe(e),o=xj(),l=e==="loading"?o.spinner:o.icon;return w.jsx(Nt.span,{display:"inherit","data-status":e,...n,className:hn("chakra-alert__icon",n.className),__css:l,children:n.children||w.jsx(i,{h:"100%",w:"100%"})})}Rp.displayName="AlertIcon";const $S=jt(function(e,i){const o=xj(),{status:l}=Dj();return w.jsx(Nt.div,{ref:i,"data-status":l,...e,className:hn("chakra-alert__title",e.className),__css:o.title})});$S.displayName="AlertTitle";const KS=jt(function(e,i){const{status:o}=Dj(),l=xj(),d={display:"inline",...l.description};return w.jsx(Nt.div,{ref:i,"data-status":o,...e,className:hn("chakra-alert__desc",e.className),__css:d})});KS.displayName="AlertDescription";function uNe(n){return w.jsx(In,{focusable:"false","aria-hidden":!0,...n,children:w.jsx("path",{fill:"currentColor",d:"M.439,21.44a1.5,1.5,0,0,0,2.122,2.121L11.823,14.3a.25.25,0,0,1,.354,0l9.262,9.263a1.5,1.5,0,1,0,2.122-2.121L14.3,12.177a.25.25,0,0,1,0-.354l9.263-9.262A1.5,1.5,0,0,0,21.439.44L12.177,9.7a.25.25,0,0,1-.354,0L2.561.44A1.5,1.5,0,0,0,.439,2.561L9.7,11.823a.25.25,0,0,1,0,.354Z"})})}const Lj=jt(function(e,i){const o=Hl("CloseButton",e),{children:l,isDisabled:d,__css:p,..._}=Vi(e),E={outline:0,display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0};return w.jsx(Nt.button,{type:"button","aria-label":"Close",ref:i,disabled:d,__css:{...E,...o,...p},..._,children:l||w.jsx(uNe,{width:"1em",height:"1em"})})});Lj.displayName="CloseButton";const dNe=n=>{const{status:e,variant:i="solid",id:o,title:l,isClosable:d,onClose:p,description:_,colorScheme:E,icon:b}=n,C=o?{root:`toast-${o}`,title:`toast-${o}-title`,description:`toast-${o}-description`}:void 0;return w.jsxs(Cp,{addRole:!1,status:e,variant:i,id:C==null?void 0:C.root,alignItems:"start",borderRadius:"md",boxShadow:"lg",paddingEnd:8,textAlign:"start",width:"auto",colorScheme:E,children:[w.jsx(Rp,{children:b}),w.jsxs(Nt.div,{flex:"1",maxWidth:"100%",children:[l&&w.jsx($S,{id:C==null?void 0:C.title,children:l}),_&&w.jsx(KS,{id:C==null?void 0:C.description,display:"block",children:_})]}),d&&w.jsx(Lj,{size:"sm",onClick:p,position:"absolute",insetEnd:1,top:1})]})};function Zte(n={}){const{render:e,toastComponent:i=dNe}=n;return l=>typeof e=="function"?e({...l,...n}):w.jsx(i,{...l,...n})}const hNe={top:[],"top-left":[],"top-right":[],"bottom-left":[],bottom:[],"bottom-right":[]},Hh=fNe(hNe);function fNe(n){let e=n;const i=new Set,o=l=>{e=l(e),i.forEach(d=>d())};return{getState:()=>e,subscribe:l=>(i.add(l),()=>{o(()=>n),i.delete(l)}),removeToast:(l,d)=>{o(p=>({...p,[d]:p[d].filter(_=>_.id!=l)}))},notify:(l,d)=>{const p=pNe(l,d),{position:_,id:E}=p;return o(b=>{const I=_.includes("top")?[p,...b[_]??[]]:[...b[_]??[],p];return{...b,[_]:I}}),E},update:(l,d)=>{l&&o(p=>{const _={...p},{position:E,index:b}=VY(_,l);return E&&b!==-1&&(_[E][b]={..._[E][b],...d,message:Zte(d)}),_})},closeAll:({positions:l}={})=>{o(d=>(l??["bottom","bottom-right","bottom-left","top","top-left","top-right"]).reduce((E,b)=>(E[b]=d[b].map(C=>({...C,requestClose:!0})),E),{...d}))},close:l=>{o(d=>{const p=qte(d,l);return p?{...d,[p]:d[p].map(_=>_.id==l?{..._,requestClose:!0}:_)}:d})},isActive:l=>!!VY(Hh.getState(),l).position}}let GY=0;function pNe(n,e={}){GY+=1;const i=e.id??GY,o=e.position??"bottom";return{id:i,message:n,position:o,duration:e.duration,onCloseComplete:e.onCloseComplete,onRequestRemove:()=>Hh.removeToast(String(i),o),status:e.status,requestClose:!1,containerStyle:e.containerStyle}}var ene=gZ();const[tne,mNe]=Ni({strict:!1,name:"PortalContext"}),Mj="chakra-portal",gNe=".chakra-portal",_Ne=n=>w.jsx("div",{className:"chakra-portal-zIndex",style:{position:"absolute",zIndex:n.zIndex,top:0,left:0,right:0},children:n.children}),yNe=n=>{const{appendToParentPortal:e,children:i}=n,[o,l]=D.useState(null),d=D.useRef(null),[,p]=D.useState({});D.useEffect(()=>p({}),[]);const _=mNe(),E=iAe();Qh(()=>{if(!o)return;const C=o.ownerDocument,I=e?_??C.body:C.body;if(!I)return;d.current=C.createElement("div"),d.current.className=Mj,I.appendChild(d.current),p({});const O=d.current;return()=>{I.contains(O)&&I.removeChild(O)}},[o]);const b=E!=null&&E.zIndex?w.jsx(_Ne,{zIndex:E==null?void 0:E.zIndex,children:i}):i;return d.current?ene.createPortal(w.jsx(tne,{value:d.current,children:b}),d.current):w.jsx("span",{ref:C=>{C&&l(C)}})},ENe=n=>{const{children:e,containerRef:i,appendToParentPortal:o}=n,l=i.current,d=l??(typeof window<"u"?document.body:void 0),p=D.useMemo(()=>{const E=l==null?void 0:l.ownerDocument.createElement("div");return E&&(E.className=Mj),E},[l]),[,_]=D.useState({});return Qh(()=>_({}),[]),Qh(()=>{if(!(!p||!d))return d.appendChild(p),()=>{d.removeChild(p)}},[p,d]),d&&p?ene.createPortal(w.jsx(tne,{value:o?p:null,children:e}),p):null};function $l(n){const e={appendToParentPortal:!0,...n},{containerRef:i,...o}=e;return i?w.jsx(ENe,{containerRef:i,...o}):w.jsx(yNe,{...o})}$l.className=Mj;$l.selector=gNe;$l.displayName="Portal";const[vNe,SNe]=Ni({name:"ToastOptionsContext",strict:!1}),bNe=n=>{const e=D.useSyncExternalStore(Hh.subscribe,Hh.getState,Hh.getState),{motionVariants:i,component:o=Yte,portalProps:l,animatePresenceProps:d}=n,_=Object.keys(e).map(E=>{const b=e[E];return w.jsx("div",{role:"region","aria-live":"polite","aria-label":`Notifications-${E}`,id:`chakra-toast-manager-${E}`,style:U1e(E),children:w.jsx(j0,{...d,initial:!1,children:b.map(C=>w.jsx(o,{motionVariants:i,...C},C.id))})},E)});return w.jsx($l,{...l,children:_})},TNe=n=>function({children:i,theme:o=n,toastOptions:l,...d}){return w.jsxs(oAe,{theme:o,...d,children:[w.jsx(vNe,{value:l==null?void 0:l.defaultOptions,children:i}),w.jsx(bNe,{...l})]})},z1=TNe(YRe);function HY(n){return n.sort((e,i)=>{const o=e.compareDocumentPosition(i);if(o&Node.DOCUMENT_POSITION_FOLLOWING||o&Node.DOCUMENT_POSITION_CONTAINED_BY)return-1;if(o&Node.DOCUMENT_POSITION_PRECEDING||o&Node.DOCUMENT_POSITION_CONTAINS)return 1;if(o&Node.DOCUMENT_POSITION_DISCONNECTED||o&Node.DOCUMENT_POSITION_IMPLEMENTATION_SPECIFIC)throw Error("Cannot sort the given nodes.");return 0})}const wNe=n=>typeof n=="object"&&"nodeType"in n&&n.nodeType===Node.ELEMENT_NODE;function $Y(n,e,i){let o=n+1;return i&&o>=e&&(o=0),o}function KY(n,e,i){let o=n-1;return i&&o<0&&(o=e),o}const rU=typeof window<"u"?D.useLayoutEffect:D.useEffect,qY=n=>n;var CNe=Object.defineProperty,RNe=(n,e,i)=>e in n?CNe(n,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):n[e]=i,xs=(n,e,i)=>(RNe(n,typeof e!="symbol"?e+"":e,i),i);class INe{constructor(){xs(this,"descendants",new Map),xs(this,"register",e=>{if(e!=null)return wNe(e)?this.registerNode(e):i=>{this.registerNode(i,e)}}),xs(this,"unregister",e=>{this.descendants.delete(e);const i=HY(Array.from(this.descendants.keys()));this.assignIndex(i)}),xs(this,"destroy",()=>{this.descendants.clear()}),xs(this,"assignIndex",e=>{this.descendants.forEach(i=>{const o=e.indexOf(i.node);i.index=o,i.node.dataset.index=i.index.toString()})}),xs(this,"count",()=>this.descendants.size),xs(this,"enabledCount",()=>this.enabledValues().length),xs(this,"values",()=>Array.from(this.descendants.values()).sort((i,o)=>i.index-o.index)),xs(this,"enabledValues",()=>this.values().filter(e=>!e.disabled)),xs(this,"item",e=>{if(this.count()!==0)return this.values()[e]}),xs(this,"enabledItem",e=>{if(this.enabledCount()!==0)return this.enabledValues()[e]}),xs(this,"first",()=>this.item(0)),xs(this,"firstEnabled",()=>this.enabledItem(0)),xs(this,"last",()=>this.item(this.descendants.size-1)),xs(this,"lastEnabled",()=>{const e=this.enabledValues().length-1;return this.enabledItem(e)}),xs(this,"indexOf",e=>{var i;return e?((i=this.descendants.get(e))==null?void 0:i.index)??-1:-1}),xs(this,"enabledIndexOf",e=>e==null?-1:this.enabledValues().findIndex(i=>i.node.isSameNode(e))),xs(this,"next",(e,i=!0)=>{const o=$Y(e,this.count(),i);return this.item(o)}),xs(this,"nextEnabled",(e,i=!0)=>{const o=this.item(e);if(!o)return;const l=this.enabledIndexOf(o.node),d=$Y(l,this.enabledCount(),i);return this.enabledItem(d)}),xs(this,"prev",(e,i=!0)=>{const o=KY(e,this.count()-1,i);return this.item(o)}),xs(this,"prevEnabled",(e,i=!0)=>{const o=this.item(e);if(!o)return;const l=this.enabledIndexOf(o.node),d=KY(l,this.enabledCount()-1,i);return this.enabledItem(d)}),xs(this,"registerNode",(e,i)=>{if(!e||this.descendants.has(e))return;const o=Array.from(this.descendants.keys()).concat(e),l=HY(o);i!=null&&i.disabled&&(i.disabled=!!i.disabled);const d={node:e,index:-1,...i};this.descendants.set(e,d),this.assignIndex(l)})}}function nne(){const[n,e]=Ni({name:"DescendantsProvider",errorMessage:"useDescendantsContext must be used within DescendantsProvider"});return[n,e,()=>{const l=D.useRef(new INe);return rU(()=>()=>l.current.destroy()),l.current},l=>{const d=e(),[p,_]=D.useState(-1),E=D.useRef(null);rU(()=>()=>{E.current&&d.unregister(E.current)},[]),rU(()=>{if(!E.current)return;const C=Number(E.current.dataset.index);p!=C&&!Number.isNaN(C)&&_(C)});const b=qY(l?d.register(l):d.register);return{descendants:d,index:p,enabledIndex:d.enabledIndexOf(E.current),register:Ui(b,E)}}]}const YY={easeIn:[.4,0,1,1],easeOut:[0,0,.2,1]},ky={enter:{duration:.2,ease:YY.easeOut},exit:{duration:.1,ease:YY.easeIn}},Ny={enter:(n,e)=>({...n,delay:typeof e=="number"?e:e==null?void 0:e.enter}),exit:(n,e)=>({...n,delay:typeof e=="number"?e:e==null?void 0:e.exit})},rne=jt(function(n,e){const{ratio:i=4/3,children:o,className:l,...d}=n,p=D.Children.only(o),_=hn("chakra-aspect-ratio",l);return w.jsx(Nt.div,{ref:e,position:"relative",className:_,_before:{height:0,content:'""',display:"block",paddingBottom:I1(i,E=>`${1/E*100}%`)},__css:{"& > *:not(style)":{overflow:"hidden",position:"absolute",top:"0",right:"0",bottom:"0",left:"0",display:"flex",justifyContent:"center",alignItems:"center",width:"100%",height:"100%"},"& > img, & > video":{objectFit:"cover"}},...d,children:p})});rne.displayName="AspectRatio";const[ANe,PNe]=Ni({name:"AvatarStylesContext",hookName:"useAvatarStyles",providerName:"<Avatar/>"});function ONe(n){const e=n.trim().split(" "),i=e[0]??"",o=e.length>1?e[e.length-1]:"";return i&&o?`${i.charAt(0)}${o.charAt(0)}`:i.charAt(0)}function ine(n){const{name:e,getInitials:i,...o}=n,l=PNe();return w.jsx(Nt.div,{role:"img","aria-label":e,...o,__css:l.label,children:e?i==null?void 0:i(e):null})}ine.displayName="AvatarName";const sne=n=>w.jsxs(Nt.svg,{viewBox:"0 0 128 128",color:"#fff",width:"100%",height:"100%",className:"chakra-avatar__svg",...n,children:[w.jsx("path",{fill:"currentColor",d:"M103,102.1388 C93.094,111.92 79.3504,118 64.1638,118 C48.8056,118 34.9294,111.768 25,101.7892 L25,95.2 C25,86.8096 31.981,80 40.6,80 L87.4,80 C96.019,80 103,86.8096 103,95.2 L103,102.1388 Z"}),w.jsx("path",{fill:"currentColor",d:"M63.9961647,24 C51.2938136,24 41,34.2938136 41,46.9961647 C41,59.7061864 51.2938136,70 63.9961647,70 C76.6985159,70 87,59.7061864 87,46.9961647 C87,34.2938136 76.6985159,24 63.9961647,24"})]});function one(n){const{loading:e,src:i,srcSet:o,onLoad:l,onError:d,crossOrigin:p,sizes:_,ignoreFallback:E}=n,[b,C]=D.useState("pending");D.useEffect(()=>{C(i?"loading":"pending")},[i]);const I=D.useRef(null),O=D.useCallback(()=>{if(!i)return;L();const V=new Image;V.src=i,p&&(V.crossOrigin=p),o&&(V.srcset=o),_&&(V.sizes=_),e&&(V.loading=e),V.onload=B=>{L(),C("loaded"),l==null||l(B)},V.onerror=B=>{L(),C("failed"),d==null||d(B)},I.current=V},[i,p,o,_,l,d,e]),L=()=>{I.current&&(I.current.onload=null,I.current.onerror=null,I.current=null)};return Qh(()=>{if(!E)return b==="loading"&&O(),()=>{L()}},[b,O,E]),E?"loaded":b}const kNe=(n,e)=>n!=="loaded"&&e==="beforeLoadOrError"||n==="failed"&&e==="onError";function ane(n){const{src:e,srcSet:i,onError:o,onLoad:l,getInitials:d,name:p,borderRadius:_,loading:E,iconLabel:b,icon:C=w.jsx(sne,{}),ignoreFallback:I,referrerPolicy:O,crossOrigin:L}=n,B=one({src:e,onError:o,crossOrigin:L,ignoreFallback:I})==="loaded";return!e||!B?p?w.jsx(ine,{className:"chakra-avatar__initials",getInitials:d,name:p}):D.cloneElement(C,{role:"img","aria-label":b}):w.jsx(Nt.img,{src:e,srcSet:i,alt:p??b,onLoad:l,referrerPolicy:O,crossOrigin:L??void 0,className:"chakra-avatar__img",loading:E,__css:{width:"100%",height:"100%",objectFit:"cover",borderRadius:_}})}ane.displayName="AvatarImage";const NNe={display:"inline-flex",alignItems:"center",justifyContent:"center",textAlign:"center",textTransform:"uppercase",fontWeight:"medium",position:"relative",flexShrink:0},zl=jt((n,e)=>{const i=nc("Avatar",n),[o,l]=D.useState(!1),{src:d,srcSet:p,name:_,showBorder:E,borderRadius:b="full",onError:C,onLoad:I,getInitials:O=ONe,icon:L=w.jsx(sne,{}),iconLabel:V=" avatar",loading:B,children:W,borderColor:Z,ignoreFallback:$,crossOrigin:se,referrerPolicy:ue,...re}=Vi(n),pe={borderRadius:b,borderWidth:E?"2px":void 0,...NNe,...i.container};return Z&&(pe.borderColor=Z),w.jsx(Nt.span,{ref:e,...re,className:hn("chakra-avatar",n.className),"data-loaded":Zn(o),__css:pe,children:w.jsxs(ANe,{value:i,children:[w.jsx(ane,{src:d,srcSet:p,loading:B,onLoad:An(I,()=>{l(!0)}),onError:C,getInitials:O,name:_,borderRadius:b,icon:L,iconLabel:V,ignoreFallback:$,crossOrigin:se,referrerPolicy:ue}),W]})})});zl.displayName="Avatar";const Ip=jt(function(e,i){const o=Hl("Badge",e),{className:l,...d}=Vi(e);return w.jsx(Nt.span,{ref:i,className:hn("chakra-badge",e.className),...d,__css:{display:"inline-block",whiteSpace:"nowrap",verticalAlign:"middle",...o}})});Ip.displayName="Badge";const ft=Nt("div");ft.displayName="Box";const[JGe,DNe]=Ni({strict:!1,name:"ButtonGroupContext"});function Hw(n){const{children:e,className:i,...o}=n,l=D.isValidElement(e)?D.cloneElement(e,{"aria-hidden":!0,focusable:!1}):e,d=hn("chakra-button__icon",i);return w.jsx(Nt.span,{display:"inline-flex",alignSelf:"center",flexShrink:0,...o,className:d,children:l})}Hw.displayName="ButtonIcon";function SV(n){const{label:e,placement:i,spacing:o="0.5rem",children:l=w.jsx(jd,{color:"currentColor",width:"1em",height:"1em"}),className:d,__css:p,..._}=n,E=hn("chakra-button__spinner",d),b=i==="start"?"marginEnd":"marginStart",C=D.useMemo(()=>({display:"flex",alignItems:"center",position:e?"relative":"absolute",[b]:e?o:0,fontSize:"1em",lineHeight:"normal",...p}),[p,e,b,o]);return w.jsx(Nt.div,{className:E,..._,__css:C,children:l})}SV.displayName="ButtonSpinner";function xNe(n){const[e,i]=D.useState(!n);return{ref:D.useCallback(d=>{d&&i(d.tagName==="BUTTON")},[]),type:e?"button":void 0}}const br=jt((n,e)=>{const i=DNe(),o=Hl("Button",{...i,...n}),{isDisabled:l=i==null?void 0:i.isDisabled,isLoading:d,isActive:p,children:_,leftIcon:E,rightIcon:b,loadingText:C,iconSpacing:I="0.5rem",type:O,spinner:L,spinnerPlacement:V="start",className:B,as:W,shouldWrapChildren:Z,...$}=Vi(n),se=D.useMemo(()=>{const q={...o==null?void 0:o._focus,zIndex:1};return{display:"inline-flex",appearance:"none",alignItems:"center",justifyContent:"center",userSelect:"none",position:"relative",whiteSpace:"nowrap",verticalAlign:"middle",outline:"none",...o,...!!i&&{_focus:q}}},[o,i]),{ref:ue,type:re}=xNe(W),pe={rightIcon:b,leftIcon:E,iconSpacing:I,children:_,shouldWrapChildren:Z};return w.jsxs(Nt.button,{disabled:l||d,ref:fve(e,ue),as:W,type:O??re,"data-active":Zn(p),"data-loading":Zn(d),__css:se,className:hn("chakra-button",B),...$,children:[d&&V==="start"&&w.jsx(SV,{className:"chakra-button__spinner--start",label:C,placement:"start",spacing:I,children:L}),d?C||w.jsx(Nt.span,{opacity:0,children:w.jsx(XY,{...pe})}):w.jsx(XY,{...pe}),d&&V==="end"&&w.jsx(SV,{className:"chakra-button__spinner--end",label:C,placement:"end",spacing:I,children:L})]})});br.displayName="Button";function XY(n){const{leftIcon:e,rightIcon:i,children:o,iconSpacing:l,shouldWrapChildren:d}=n;return d?w.jsxs("span",{style:{display:"contents"},children:[e&&w.jsx(Hw,{marginEnd:l,children:e}),o,i&&w.jsx(Hw,{marginStart:l,children:i})]}):w.jsxs(w.Fragment,{children:[e&&w.jsx(Hw,{marginEnd:l,children:e}),o,i&&w.jsx(Hw,{marginStart:l,children:i})]})}const Wo=jt((n,e)=>{const{icon:i,children:o,isRound:l,"aria-label":d,...p}=n,_=i||o,E=D.isValidElement(_)?D.cloneElement(_,{"aria-hidden":!0,focusable:!1}):null;return w.jsx(br,{px:"0",py:"0",borderRadius:l?"full":void 0,ref:e,"aria-label":d,...p,children:E})});Wo.displayName="IconButton";const cne=Nt("div",{baseStyle:{display:"flex",alignItems:"center",justifyContent:"center"}});cne.displayName="Center";const LNe={horizontal:{insetStart:"50%",transform:"translateX(-50%)"},vertical:{top:"50%",transform:"translateY(-50%)"},both:{insetStart:"50%",top:"50%",transform:"translate(-50%, -50%)"}};jt(function(e,i){const{axis:o="both",...l}=e;return w.jsx(Nt.div,{ref:i,__css:LNe[o],...l,position:"absolute"})});var MNe=()=>typeof document<"u",JY=!1,oR=null,Vy=!1,bV=!1,TV=new Set;function Uj(n,e){TV.forEach(i=>i(n,e))}var UNe=typeof window<"u"&&window.navigator!=null?/^Mac/.test(window.navigator.platform):!1;function VNe(n){return!(n.metaKey||!UNe&&n.altKey||n.ctrlKey||n.key==="Control"||n.key==="Shift"||n.key==="Meta")}function QY(n){Vy=!0,VNe(n)&&(oR="keyboard",Uj("keyboard",n))}function bS(n){if(oR="pointer",n.type==="mousedown"||n.type==="pointerdown"){Vy=!0;const e=n.composedPath?n.composedPath()[0]:n.target;let i=!1;try{i=e.matches(":focus-visible")}catch{}if(i)return;Uj("pointer",n)}}function FNe(n){return n.mozInputSource===0&&n.isTrusted?!0:n.detail===0&&!n.pointerType}function jNe(n){FNe(n)&&(Vy=!0,oR="virtual")}function BNe(n){n.target===window||n.target===document||n.target instanceof Element&&n.target.hasAttribute("tabindex")||(!Vy&&!bV&&(oR="virtual",Uj("virtual",n)),Vy=!1,bV=!1)}function WNe(){Vy=!1,bV=!0}function ZY(){return oR!=="pointer"}function zNe(){if(!MNe()||JY)return;const{focus:n}=HTMLElement.prototype;HTMLElement.prototype.focus=function(...i){Vy=!0,n.apply(this,i)},document.addEventListener("keydown",QY,!0),document.addEventListener("keyup",QY,!0),document.addEventListener("click",jNe,!0),window.addEventListener("focus",BNe,!0),window.addEventListener("blur",WNe,!1),typeof PointerEvent<"u"?(document.addEventListener("pointerdown",bS,!0),document.addEventListener("pointermove",bS,!0),document.addEventListener("pointerup",bS,!0)):(document.addEventListener("mousedown",bS,!0),document.addEventListener("mousemove",bS,!0),document.addEventListener("mouseup",bS,!0)),JY=!0}function GNe(n){zNe(),n(ZY());const e=()=>n(ZY());return TV.add(e),()=>{TV.delete(e)}}const[HNe,lne]=Ni({name:"FormControlStylesContext",errorMessage:`useFormControlStyles returned is 'undefined'. Seems you forgot to wrap the components in "<FormControl />" `}),[$Ne,G0]=Ni({strict:!1,name:"FormControlContext"});function KNe(n){const{id:e,isRequired:i,isInvalid:o,isDisabled:l,isReadOnly:d,...p}=n,_=D.useId(),E=e||`field-${_}`,b=`${E}-label`,C=`${E}-feedback`,I=`${E}-helptext`,[O,L]=D.useState(!1),[V,B]=D.useState(!1),[W,Z]=D.useState(!1),$=D.useCallback((q={},Q=null)=>({id:I,...q,ref:Ui(Q,J=>{J&&B(!0)})}),[I]),se=D.useCallback((q={},Q=null)=>({...q,ref:Q,"data-focus":Zn(W),"data-disabled":Zn(l),"data-invalid":Zn(o),"data-readonly":Zn(d),id:q.id!==void 0?q.id:b,htmlFor:q.htmlFor!==void 0?q.htmlFor:E}),[E,l,W,o,d,b]),ue=D.useCallback((q={},Q=null)=>({id:C,...q,ref:Ui(Q,J=>{J&&L(!0)}),"aria-live":"polite"}),[C]),re=D.useCallback((q={},Q=null)=>({...q,...p,ref:Q,role:"group","data-focus":Zn(W),"data-disabled":Zn(l),"data-invalid":Zn(o),"data-readonly":Zn(d)}),[p,l,W,o,d]),pe=D.useCallback((q={},Q=null)=>({...q,ref:Q,role:"presentation","aria-hidden":!0,children:q.children||"*"}),[]);return{isRequired:!!i,isInvalid:!!o,isReadOnly:!!d,isDisabled:!!l,isFocused:!!W,onFocus:()=>Z(!0),onBlur:()=>Z(!1),hasFeedbackText:O,setHasFeedbackText:L,hasHelpText:V,setHasHelpText:B,id:E,labelId:b,feedbackId:C,helpTextId:I,htmlProps:p,getHelpTextProps:$,getErrorMessageProps:ue,getRootProps:re,getLabelProps:se,getRequiredIndicatorProps:pe}}const Mr=jt(function(e,i){const o=nc("Form",e),l=Vi(e),{getRootProps:d,htmlProps:p,..._}=KNe(l),E=hn("chakra-form-control",e.className);return w.jsx($Ne,{value:_,children:w.jsx(HNe,{value:o,children:w.jsx(Nt.div,{...d({},i),className:E,__css:o.container})})})});Mr.displayName="FormControl";const E0=jt(function(e,i){const o=G0(),l=lne(),d=hn("chakra-form__helper-text",e.className);return w.jsx(Nt.div,{...o==null?void 0:o.getHelpTextProps(e,i),__css:l.helperText,className:d})});E0.displayName="FormHelperText";function Vj(n){const{isDisabled:e,isInvalid:i,isReadOnly:o,isRequired:l,...d}=Fj(n);return{...d,disabled:e,readOnly:o,required:l,"aria-invalid":Np(i),"aria-required":Np(l),"aria-readonly":Np(o)}}function Fj(n){const e=G0(),{id:i,disabled:o,readOnly:l,required:d,isRequired:p,isInvalid:_,isReadOnly:E,isDisabled:b,onFocus:C,onBlur:I,...O}=n,L=n["aria-describedby"]?[n["aria-describedby"]]:[];return e!=null&&e.hasFeedbackText&&(e!=null&&e.isInvalid)&&L.push(e.feedbackId),e!=null&&e.hasHelpText&&L.push(e.helpTextId),{...O,"aria-describedby":L.join(" ")||void 0,id:i??(e==null?void 0:e.id),isDisabled:o??b??(e==null?void 0:e.isDisabled),isReadOnly:l??E??(e==null?void 0:e.isReadOnly),isRequired:d??p??(e==null?void 0:e.isRequired),isInvalid:_??(e==null?void 0:e.isInvalid),onFocus:An(e==null?void 0:e.onFocus,C),onBlur:An(e==null?void 0:e.onBlur,I)}}const qNe={border:"0",clip:"rect(0, 0, 0, 0)",height:"1px",width:"1px",margin:"-1px",padding:"0",overflow:"hidden",whiteSpace:"nowrap",position:"absolute"};function YNe(n={}){const e=Fj(n),{isDisabled:i,isReadOnly:o,isRequired:l,isInvalid:d,id:p,onBlur:_,onFocus:E,"aria-describedby":b}=e,{defaultChecked:C,isChecked:I,isFocusable:O,onChange:L,isIndeterminate:V,name:B,value:W,tabIndex:Z=void 0,"aria-label":$,"aria-labelledby":se,"aria-invalid":ue,...re}=n,pe=V0(re,["isDisabled","isReadOnly","isRequired","isInvalid","id","onBlur","onFocus","aria-describedby"]),q=Ks(L),Q=Ks(_),J=Ks(E),[ie,me]=D.useState(!1),[de,le]=D.useState(!1),[xe,We]=D.useState(!1),[$e,ve]=D.useState(!1);D.useEffect(()=>GNe(me),[]);const _e=D.useRef(null),[Ee,ke]=D.useState(!0),[we,be]=D.useState(!!C),Ie=I!==void 0,Me=Ie?I:we,ze=D.useCallback(Ht=>{if(o||i){Ht.preventDefault();return}Ie||be(Me?Ht.currentTarget.checked:V?!0:Ht.currentTarget.checked),q==null||q(Ht)},[o,i,Me,Ie,V,q]);Qh(()=>{_e.current&&(_e.current.indeterminate=!!V)},[V]),Fp(()=>{i&&le(!1)},[i,le]),Qh(()=>{const Ht=_e.current;if(!(Ht!=null&&Ht.form))return;const jn=()=>{be(!!C)};return Ht.form.addEventListener("reset",jn),()=>{var Wt;return(Wt=Ht.form)==null?void 0:Wt.removeEventListener("reset",jn)}},[]);const Je=i&&!O,tt=D.useCallback(Ht=>{Ht.key===" "&&ve(!0)},[ve]),ut=D.useCallback(Ht=>{Ht.key===" "&&ve(!1)},[ve]);Qh(()=>{if(!_e.current)return;_e.current.checked!==Me&&be(_e.current.checked)},[_e.current]);const Ze=D.useCallback((Ht={},jn=null)=>{const Wt=Re=>{de&&Re.preventDefault(),ve(!0)};return{...Ht,ref:jn,"data-active":Zn($e),"data-hover":Zn(xe),"data-checked":Zn(Me),"data-focus":Zn(de),"data-focus-visible":Zn(de&&ie),"data-indeterminate":Zn(V),"data-disabled":Zn(i),"data-invalid":Zn(d),"data-readonly":Zn(o),"aria-hidden":!0,onMouseDown:An(Ht.onMouseDown,Wt),onMouseUp:An(Ht.onMouseUp,()=>ve(!1)),onMouseEnter:An(Ht.onMouseEnter,()=>We(!0)),onMouseLeave:An(Ht.onMouseLeave,()=>We(!1))}},[$e,Me,i,de,ie,xe,V,d,o]),bt=D.useCallback((Ht={},jn=null)=>({...Ht,ref:jn,"data-active":Zn($e),"data-hover":Zn(xe),"data-checked":Zn(Me),"data-focus":Zn(de),"data-focus-visible":Zn(de&&ie),"data-indeterminate":Zn(V),"data-disabled":Zn(i),"data-invalid":Zn(d),"data-readonly":Zn(o)}),[$e,Me,i,de,ie,xe,V,d,o]),on=D.useCallback((Ht={},jn=null)=>({...pe,htmlFor:Ee?p:void 0,...Ht,ref:Ui(jn,Wt=>{Wt&&ke(Wt.tagName==="LABEL")}),onClick:An(Ht.onClick,()=>{var Wt;Ee||((Wt=_e.current)==null||Wt.click(),requestAnimationFrame(()=>{var Re;(Re=_e.current)==null||Re.focus({preventScroll:!0})}))}),"data-disabled":Zn(i),"data-checked":Zn(Me),"data-invalid":Zn(d)}),[pe,i,Me,d,Ee,p]),Mt=D.useCallback((Ht={},jn=null)=>({...Ht,ref:Ui(_e,jn),type:"checkbox",name:B,value:W,id:p,tabIndex:Z,onChange:An(Ht.onChange,ze),onBlur:An(Ht.onBlur,Q,()=>le(!1)),onFocus:An(Ht.onFocus,J,()=>le(!0)),onKeyDown:An(Ht.onKeyDown,tt),onKeyUp:An(Ht.onKeyUp,ut),required:l,checked:Me,disabled:Je,readOnly:o,"aria-label":$,"aria-labelledby":se,"aria-invalid":ue?!!ue:d,"aria-describedby":b,"aria-disabled":i,"aria-checked":V?"mixed":Me,style:qNe}),[B,W,p,Z,ze,Q,J,tt,ut,l,Me,Je,o,$,se,ue,d,b,i,V]),Zt=D.useCallback((Ht={},jn=null)=>({...Ht,ref:jn,onMouseDown:An(Ht.onMouseDown,XNe),"data-disabled":Zn(i),"data-checked":Zn(Me),"data-invalid":Zn(d)}),[Me,i,d]);return{state:{isInvalid:d,isFocused:de,isChecked:Me,isActive:$e,isHovered:xe,isIndeterminate:V,isDisabled:i,isReadOnly:o,isRequired:l},getRootProps:on,getCheckboxProps:Ze,getIndicatorProps:bt,getInputProps:Mt,getLabelProps:Zt,htmlProps:pe}}function XNe(n){n.preventDefault(),n.stopPropagation()}const wV=jt(function(e,i){const{className:o,centerContent:l,...d}=Vi(e),p=Hl("Container",e);return w.jsx(Nt.div,{ref:i,className:hn("chakra-container",o),...d,__css:{...p,...l&&{display:"flex",flexDirection:"column",alignItems:"center"}}})});wV.displayName="Container";const rf=jt(function(e,i){const{borderLeftWidth:o,borderBottomWidth:l,borderTopWidth:d,borderRightWidth:p,borderWidth:_,borderStyle:E,borderColor:b,...C}=Hl("Divider",e),{className:I,orientation:O="horizontal",__css:L,...V}=Vi(e),B={vertical:{borderLeftWidth:o||p||_||"1px",height:"100%"},horizontal:{borderBottomWidth:l||d||_||"1px",width:"100%"}};return w.jsx(Nt.hr,{ref:i,"aria-orientation":O,...V,__css:{...C,border:"0",borderColor:b,borderStyle:E,...B[O],...L},className:hn("chakra-divider",I)})});rf.displayName="Divider";const Ar=jt(function(e,i){const{direction:o,align:l,justify:d,wrap:p,basis:_,grow:E,shrink:b,...C}=e,I={display:"flex",flexDirection:o,alignItems:l,justifyContent:d,flexWrap:p,flexBasis:_,flexGrow:E,flexShrink:b};return w.jsx(Nt.div,{ref:i,__css:I,...C})});Ar.displayName="Flex";function JNe(n,e){if(n==null)return{};var i={};for(var o in n)if({}.hasOwnProperty.call(n,o)){if(e.indexOf(o)!==-1)continue;i[o]=n[o]}return i}var iU={exports:{}},sU,eX;function QNe(){if(eX)return sU;eX=1;var n="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";return sU=n,sU}var oU,tX;function ZNe(){if(tX)return oU;tX=1;var n=QNe();function e(){}function i(){}return i.resetWarningCache=e,oU=function(){function o(p,_,E,b,C,I){if(I!==n){var O=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw O.name="Invariant Violation",O}}o.isRequired=o;function l(){return o}var d={array:o,bigint:o,bool:o,func:o,number:o,object:o,string:o,symbol:o,any:o,arrayOf:l,element:o,elementType:o,instanceOf:l,node:o,objectOf:l,oneOf:l,oneOfType:l,shape:l,exact:l,checkPropTypes:i,resetWarningCache:e};return d.PropTypes=d,d},oU}var nX;function eDe(){return nX||(nX=1,iU.exports=ZNe()()),iU.exports}var tDe=eDe();const mn=Ug(tDe);var CV="data-focus-lock",une="data-focus-lock-disabled",nDe="data-no-focus-lock",rDe="data-autofocus-inside",iDe="data-no-autofocus";function aU(n,e){return typeof n=="function"?n(e):n&&(n.current=e),n}function sDe(n,e){var i=D.useState(function(){return{value:n,callback:e,facade:{get current(){return i.value},set current(o){var l=i.value;l!==o&&(i.value=o,i.callback(o,l))}}}})[0];return i.callback=e,i.facade}var oDe=typeof window<"u"?D.useLayoutEffect:D.useEffect,rX=new WeakMap;function dne(n,e){var i=sDe(null,function(o){return n.forEach(function(l){return aU(l,o)})});return oDe(function(){var o=rX.get(i);if(o){var l=new Set(o),d=new Set(n),p=i.current;l.forEach(function(_){d.has(_)||aU(_,null)}),d.forEach(function(_){l.has(_)||aU(_,p)})}rX.set(i,n)},[n]),i}var cU={width:"1px",height:"0px",padding:0,overflow:"hidden",position:"fixed",top:"1px",left:"1px"},$h=function(){return $h=Object.assign||function(e){for(var i,o=1,l=arguments.length;o<l;o++){i=arguments[o];for(var d in i)Object.prototype.hasOwnProperty.call(i,d)&&(e[d]=i[d])}return e},$h.apply(this,arguments)};function aR(n,e){var i={};for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&e.indexOf(o)<0&&(i[o]=n[o]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var l=0,o=Object.getOwnPropertySymbols(n);l<o.length;l++)e.indexOf(o[l])<0&&Object.prototype.propertyIsEnumerable.call(n,o[l])&&(i[o[l]]=n[o[l]]);return i}function aDe(n,e,i){if(i||arguments.length===2)for(var o=0,l=e.length,d;o<l;o++)(d||!(o in e))&&(d||(d=Array.prototype.slice.call(e,0,o)),d[o]=e[o]);return n.concat(d||Array.prototype.slice.call(e))}function hne(n){return n}function fne(n,e){e===void 0&&(e=hne);var i=[],o=!1,l={read:function(){if(o)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return i.length?i[i.length-1]:n},useMedium:function(d){var p=e(d,o);return i.push(p),function(){i=i.filter(function(_){return _!==p})}},assignSyncMedium:function(d){for(o=!0;i.length;){var p=i;i=[],p.forEach(d)}i={push:function(_){return d(_)},filter:function(){return i}}},assignMedium:function(d){o=!0;var p=[];if(i.length){var _=i;i=[],_.forEach(d),p=i}var E=function(){var C=p;p=[],C.forEach(d)},b=function(){return Promise.resolve().then(E)};b(),i={push:function(C){p.push(C),b()},filter:function(C){return p=p.filter(C),i}}}};return l}function jj(n,e){return e===void 0&&(e=hne),fne(n,e)}function pne(n){n===void 0&&(n={});var e=fne(null);return e.options=$h({async:!0,ssr:!1},n),e}var mne=function(n){var e=n.sideCar,i=aR(n,["sideCar"]);if(!e)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var o=e.read();if(!o)throw new Error("Sidecar medium not found");return D.createElement(o,$h({},i))};mne.isSideCarExport=!0;function cDe(n,e){return n.useMedium(e),mne}var gne=jj({},function(n){var e=n.target,i=n.currentTarget;return{target:e,currentTarget:i}}),_ne=jj(),lDe=jj(),uDe=pne({async:!0,ssr:typeof document<"u"}),dDe=D.createContext(void 0),hDe=[],Bj=D.forwardRef(function(e,i){var o,l=D.useState(),d=l[0],p=l[1],_=D.useRef(),E=D.useRef(!1),b=D.useRef(null),C=D.useState({}),I=C[1],O=e.children,L=e.disabled,V=L===void 0?!1:L,B=e.noFocusGuards,W=B===void 0?!1:B,Z=e.persistentFocus,$=Z===void 0?!1:Z,se=e.crossFrame,ue=se===void 0?!0:se,re=e.autoFocus,pe=re===void 0?!0:re;e.allowTextSelection;var q=e.group,Q=e.className,J=e.whiteList,ie=e.hasPositiveIndices,me=e.shards,de=me===void 0?hDe:me,le=e.as,xe=le===void 0?"div":le,We=e.lockProps,$e=We===void 0?{}:We,ve=e.sideCar,_e=e.returnFocus,Ee=_e===void 0?!1:_e,ke=e.focusOptions,we=e.onActivation,be=e.onDeactivation,Ie=D.useState({}),Me=Ie[0],ze=D.useCallback(function(jn){var Wt=jn.captureFocusRestore;if(!b.current){var Re,Fe=(Re=document)==null?void 0:Re.activeElement;b.current=Fe,Fe!==document.body&&(b.current=Wt(Fe))}_.current&&we&&we(_.current),E.current=!0,I()},[we]),Je=D.useCallback(function(){E.current=!1,be&&be(_.current),I()},[be]),tt=D.useCallback(function(jn){var Wt=b.current;if(Wt){var Re=(typeof Wt=="function"?Wt():Wt)||document.body,Fe=typeof Ee=="function"?Ee(Re):Ee;if(Fe){var Ge=typeof Fe=="object"?Fe:void 0;b.current=null,jn?Promise.resolve().then(function(){return Re.focus(Ge)}):Re.focus(Ge)}}},[Ee]),ut=D.useCallback(function(jn){E.current&&gne.useMedium(jn)},[]),Ze=_ne.useMedium,bt=D.useCallback(function(jn){_.current!==jn&&(_.current=jn,p(jn))},[]),on=Uy((o={},o[une]=V&&"disabled",o[CV]=q,o),$e),Mt=W!==!0,Zt=Mt&&W!=="tail",an=dne([i,bt]),Ht=D.useMemo(function(){return{observed:_,shards:de,enabled:!V,active:E.current}},[V,E.current,de,d]);return fi.createElement(D.Fragment,null,Mt&&[fi.createElement("div",{key:"guard-first","data-focus-guard":!0,tabIndex:V?-1:0,style:cU}),ie?fi.createElement("div",{key:"guard-nearest","data-focus-guard":!0,tabIndex:V?-1:1,style:cU}):null],!V&&fi.createElement(ve,{id:Me,sideCar:uDe,observed:d,disabled:V,persistentFocus:$,crossFrame:ue,autoFocus:pe,whiteList:J,shards:de,onActivation:ze,onDeactivation:Je,returnFocus:tt,focusOptions:ke,noFocusGuards:W}),fi.createElement(xe,Uy({ref:an},on,{className:Q,onBlur:Ze,onFocus:ut}),fi.createElement(dDe.Provider,{value:Ht},O)),Zt&&fi.createElement("div",{"data-focus-guard":!0,tabIndex:V?-1:0,style:cU}))});Bj.propTypes={};function RV(n,e){return RV=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(i,o){return i.__proto__=o,i},RV(n,e)}function fDe(n,e){n.prototype=Object.create(e.prototype),n.prototype.constructor=n,RV(n,e)}function NC(n){"@babel/helpers - typeof";return NC=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},NC(n)}function pDe(n,e){if(NC(n)!="object"||!n)return n;var i=n[Symbol.toPrimitive];if(i!==void 0){var o=i.call(n,e);if(NC(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(n)}function mDe(n){var e=pDe(n,"string");return NC(e)=="symbol"?e:e+""}function gDe(n,e,i){return(e=mDe(e))in n?Object.defineProperty(n,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):n[e]=i,n}function _De(n,e){function i(o){return o.displayName||o.name||"Component"}return function(l){var d=[],p;function _(){p=n(d.map(function(b){return b.props})),e(p)}var E=function(b){fDe(C,b);function C(){return b.apply(this,arguments)||this}C.peek=function(){return p};var I=C.prototype;return I.componentDidMount=function(){d.push(this),_()},I.componentDidUpdate=function(){_()},I.componentWillUnmount=function(){var L=d.indexOf(this);d.splice(L,1),_()},I.render=function(){return fi.createElement(l,this.props)},C}(D.PureComponent);return gDe(E,"displayName","SideEffect("+i(l)+")"),E}}var gf=function(n){for(var e=Array(n.length),i=0;i<n.length;++i)e[i]=n[i];return e},Fy=function(n){return Array.isArray(n)?n:[n]},yne=function(n){return Array.isArray(n)?n[0]:n},yDe=function(n){if(n.nodeType!==Node.ELEMENT_NODE)return!1;var e=window.getComputedStyle(n,null);return!e||!e.getPropertyValue?!1:e.getPropertyValue("display")==="none"||e.getPropertyValue("visibility")==="hidden"},Ene=function(n){return n.parentNode&&n.parentNode.nodeType===Node.DOCUMENT_FRAGMENT_NODE?n.parentNode.host:n.parentNode},vne=function(n){return n===document||n&&n.nodeType===Node.DOCUMENT_NODE},EDe=function(n){return n.hasAttribute("inert")},vDe=function(n,e){return!n||vne(n)||!yDe(n)&&!EDe(n)&&e(Ene(n))},Sne=function(n,e){var i=n.get(e);if(i!==void 0)return i;var o=vDe(e,Sne.bind(void 0,n));return n.set(e,o),o},SDe=function(n,e){return n&&!vne(n)?wDe(n)?e(Ene(n)):!1:!0},bne=function(n,e){var i=n.get(e);if(i!==void 0)return i;var o=SDe(e,bne.bind(void 0,n));return n.set(e,o),o},Tne=function(n){return n.dataset},bDe=function(n){return n.tagName==="BUTTON"},wne=function(n){return n.tagName==="INPUT"},Cne=function(n){return wne(n)&&n.type==="radio"},TDe=function(n){return!((wne(n)||bDe(n))&&(n.type==="hidden"||n.disabled))},wDe=function(n){var e=n.getAttribute(iDe);return![!0,"true",""].includes(e)},Wj=function(n){var e;return!!(n&&(!((e=Tne(n))===null||e===void 0)&&e.focusGuard))},IV=function(n){return!Wj(n)},CDe=function(n){return!!n},RDe=function(n,e){var i=Math.max(0,n.tabIndex),o=Math.max(0,e.tabIndex),l=i-o,d=n.index-e.index;if(l){if(!i)return 1;if(!o)return-1}return l||d},IDe=function(n){return n.tabIndex<0&&!n.hasAttribute("tabindex")?0:n.tabIndex},zj=function(n,e,i){return gf(n).map(function(o,l){var d=IDe(o);return{node:o,index:l,tabIndex:i&&d===-1?(o.dataset||{}).focusGuard?0:-1:d}}).filter(function(o){return!e||o.tabIndex>=0}).sort(RDe)},ADe=["button:enabled","select:enabled","textarea:enabled","input:enabled","a[href]","area[href]","summary","iframe","object","embed","audio[controls]","video[controls]","[tabindex]","[contenteditable]","[autofocus]"],Gj=ADe.join(","),PDe="".concat(Gj,", [data-focus-guard]"),Rne=function(n,e){return gf((n.shadowRoot||n).children).reduce(function(i,o){return i.concat(o.matches(e?PDe:Gj)?[o]:[],Rne(o))},[])},ODe=function(n,e){var i;return n instanceof HTMLIFrameElement&&(!((i=n.contentDocument)===null||i===void 0)&&i.body)?v0([n.contentDocument.body],e):[n]},v0=function(n,e){return n.reduce(function(i,o){var l,d=Rne(o,e),p=(l=[]).concat.apply(l,d.map(function(_){return ODe(_,e)}));return i.concat(p,o.parentNode?gf(o.parentNode.querySelectorAll(Gj)).filter(function(_){return _===o}):[])},[])},kDe=function(n){var e=n.querySelectorAll("[".concat(rDe,"]"));return gf(e).map(function(i){return v0([i])}).reduce(function(i,o){return i.concat(o)},[])},Hj=function(n,e){return gf(n).filter(function(i){return Sne(e,i)}).filter(function(i){return TDe(i)})},iX=function(n,e){return e===void 0&&(e=new Map),gf(n).filter(function(i){return bne(e,i)})},$j=function(n,e,i){return zj(Hj(v0(n,i),e),!0,i)},DC=function(n,e){return zj(Hj(v0(n),e),!1)},NDe=function(n,e){return Hj(kDe(n),e)},Dy=function(n,e){return n.shadowRoot?Dy(n.shadowRoot,e):Object.getPrototypeOf(n).contains!==void 0&&Object.getPrototypeOf(n).contains.call(n,e)?!0:gf(n.children).some(function(i){var o;if(i instanceof HTMLIFrameElement){var l=(o=i.contentDocument)===null||o===void 0?void 0:o.body;return l?Dy(l,e):!1}return Dy(i,e)})},DDe=function(n){for(var e=new Set,i=n.length,o=0;o<i;o+=1)for(var l=o+1;l<i;l+=1){var d=n[o].compareDocumentPosition(n[l]);(d&Node.DOCUMENT_POSITION_CONTAINED_BY)>0&&e.add(l),(d&Node.DOCUMENT_POSITION_CONTAINS)>0&&e.add(o)}return n.filter(function(p,_){return!e.has(_)})},Ine=function(n){return n.parentNode?Ine(n.parentNode):n},Kj=function(n){var e=Fy(n);return e.filter(Boolean).reduce(function(i,o){var l=o.getAttribute(CV);return i.push.apply(i,l?DDe(gf(Ine(o).querySelectorAll("[".concat(CV,'="').concat(l,'"]:not([').concat(une,'="disabled"])')))):[o]),i},[])},xDe=function(n){try{return n()}catch{return}},xC=function(n){if(n===void 0&&(n=document),!(!n||!n.activeElement)){var e=n.activeElement;return e.shadowRoot?xC(e.shadowRoot):e instanceof HTMLIFrameElement&&xDe(function(){return e.contentWindow.document})?xC(e.contentWindow.document):e}},LDe=function(n,e){return n===e},MDe=function(n,e){return!!gf(n.querySelectorAll("iframe")).some(function(i){return LDe(i,e)})},Ane=function(n,e){return e===void 0&&(e=xC(yne(n).ownerDocument)),!e||e.dataset&&e.dataset.focusGuard?!1:Kj(n).some(function(i){return Dy(i,e)||MDe(i,e)})},UDe=function(n){n===void 0&&(n=document);var e=xC(n);return e?gf(n.querySelectorAll("[".concat(nDe,"]"))).some(function(i){return Dy(i,e)}):!1},VDe=function(n,e){return e.filter(Cne).filter(function(i){return i.name===n.name}).filter(function(i){return i.checked})[0]||n},qj=function(n,e){return Cne(n)&&n.name?VDe(n,e):n},FDe=function(n){var e=new Set;return n.forEach(function(i){return e.add(qj(i,n))}),n.filter(function(i){return e.has(i)})},sX=function(n){return n[0]&&n.length>1?qj(n[0],n):n[0]},oX=function(n,e){return n.indexOf(qj(e,n))},AV="NEW_FOCUS",jDe=function(n,e,i,o,l){var d=n.length,p=n[0],_=n[d-1],E=Wj(o);if(!(o&&n.indexOf(o)>=0)){var b=o!==void 0?i.indexOf(o):-1,C=l?i.indexOf(l):b,I=l?n.indexOf(l):-1;if(b===-1)return I!==-1?I:AV;if(I===-1)return AV;var O=b-C,L=i.indexOf(p),V=i.indexOf(_),B=FDe(i),W=o!==void 0?B.indexOf(o):-1,Z=l?B.indexOf(l):W,$=B.filter(function(Q){return Q.tabIndex>=0}),se=o!==void 0?$.indexOf(o):-1,ue=l?$.indexOf(l):se,re=se>=0&&ue>=0?ue-se:Z-W;if(!O&&I>=0||e.length===0)return I;var pe=oX(n,e[0]),q=oX(n,e[e.length-1]);if(b<=L&&E&&Math.abs(O)>1)return q;if(b>=V&&E&&Math.abs(O)>1)return pe;if(O&&Math.abs(re)>1)return I;if(b<=L)return q;if(b>V)return pe;if(O)return Math.abs(O)>1?I:(d+I+O)%d}},BDe=function(n){return function(e){var i,o=(i=Tne(e))===null||i===void 0?void 0:i.autofocus;return e.autofocus||o!==void 0&&o!=="false"||n.indexOf(e)>=0}},aX=function(n,e,i){var o=n.map(function(d){var p=d.node;return p}),l=iX(o.filter(BDe(i)));return l&&l.length?sX(l):sX(iX(e))},PV=function(n,e){return e===void 0&&(e=[]),e.push(n),n.parentNode&&PV(n.parentNode.host||n.parentNode,e),e},lU=function(n,e){for(var i=PV(n),o=PV(e),l=0;l<i.length;l+=1){var d=i[l];if(o.indexOf(d)>=0)return d}return!1},Pne=function(n,e,i){var o=Fy(n),l=Fy(e),d=o[0],p=!1;return l.filter(Boolean).forEach(function(_){p=lU(p||_,_)||p,i.filter(Boolean).forEach(function(E){var b=lU(d,E);b&&(!p||Dy(b,p)?p=b:p=lU(b,p))})}),p},cX=function(n,e){return n.reduce(function(i,o){return i.concat(NDe(o,e))},[])},WDe=function(n,e){var i=new Map;return e.forEach(function(o){return i.set(o.node,o)}),n.map(function(o){return i.get(o)}).filter(CDe)},zDe=function(n,e){var i=xC(Fy(n).length>0?document:yne(n).ownerDocument),o=Kj(n).filter(IV),l=Pne(i||n,n,o),d=new Map,p=DC(o,d),_=p.filter(function(V){var B=V.node;return IV(B)});if(_[0]){var E=DC([l],d).map(function(V){var B=V.node;return B}),b=WDe(E,_),C=b.map(function(V){var B=V.node;return B}),I=b.filter(function(V){var B=V.tabIndex;return B>=0}).map(function(V){var B=V.node;return B}),O=jDe(C,I,E,i,e);if(O===AV){var L=aX(p,I,cX(o,d))||aX(p,C,cX(o,d));if(L)return{node:L};console.warn("focus-lock: cannot find any node to move focus into");return}return O===void 0?O:b[O]}},GDe=function(n){var e=Kj(n).filter(IV),i=Pne(n,n,e),o=zj(v0([i],!0),!0,!0),l=v0(e,!1);return o.map(function(d){var p=d.node,_=d.index;return{node:p,index:_,lockItem:l.indexOf(p)>=0,guard:Wj(p)}})},Yj=function(n,e){n&&("focus"in n&&n.focus(e),"contentWindow"in n&&n.contentWindow&&n.contentWindow.focus())},uU=0,dU=!1,One=function(n,e,i){i===void 0&&(i={});var o=zDe(n,e);if(!dU&&o){if(uU>2){console.error("FocusLock: focus-fighting detected. Only one focus management system could be active. See https://github.com/theKashey/focus-lock/#focus-fighting"),dU=!0,setTimeout(function(){dU=!1},1);return}uU++,Yj(o.node,i.focusOptions),uU--}};function vw(n){if(!n)return null;if(typeof WeakRef>"u")return function(){return n||null};var e=n?new WeakRef(n):null;return function(){return(e==null?void 0:e.deref())||null}}var HDe=function(n){if(!n)return null;for(var e=[],i=n;i&&i!==document.body;)e.push({current:vw(i),parent:vw(i.parentElement),left:vw(i.previousElementSibling),right:vw(i.nextElementSibling)}),i=i.parentElement;return{element:vw(n),stack:e,ownerDocument:n.ownerDocument}},$De=function(n){var e,i,o,l,d;if(n)for(var p=n.stack,_=n.ownerDocument,E=new Map,b=0,C=p;b<C.length;b++){var I=C[b],O=(e=I.parent)===null||e===void 0?void 0:e.call(I);if(O&&_.contains(O)){for(var L=(i=I.left)===null||i===void 0?void 0:i.call(I),V=I.current(),B=O.contains(V)?V:void 0,W=(o=I.right)===null||o===void 0?void 0:o.call(I),Z=$j([O],E),$=(d=(l=B??(L==null?void 0:L.nextElementSibling))!==null&&l!==void 0?l:W)!==null&&d!==void 0?d:L;$;){for(var se=0,ue=Z;se<ue.length;se++){var re=ue[se];if($!=null&&$.contains(re.node))return re.node}$=$.nextElementSibling}if(Z.length)return Z[0].node}}},kne=function(n){var e=HDe(n);return function(){return $De(e)}},KDe=function(n,e,i){if(!n||!e)return console.error("no element or scope given"),{};var o=Fy(e);if(o.every(function(p){return!Dy(p,n)}))return console.error("Active element is not contained in the scope"),{};var l=i?$j(o,new Map):DC(o,new Map),d=l.findIndex(function(p){var _=p.node;return _===n});if(d!==-1)return{prev:l[d-1],next:l[d+1],first:l[0],last:l[l.length-1]}},qDe=function(n,e){var i=e?$j(Fy(n),new Map):DC(Fy(n),new Map);return{first:i[0],last:i[i.length-1]}},YDe=function(n){return Object.assign({scope:document.body,cycle:!0,onlyTabbable:!0},n)},Nne=function(n,e,i){e===void 0&&(e={});var o=YDe(e),l=KDe(n,o.scope,o.onlyTabbable);if(l){var d=i(l,o.cycle);d&&Yj(d.node,o.focusOptions)}},XDe=function(n,e){e===void 0&&(e={}),Nne(n,e,function(i,o){var l=i.next,d=i.first;return l||o&&d})},JDe=function(n,e){e===void 0&&(e={}),Nne(n,e,function(i,o){var l=i.prev,d=i.last;return l||o&&d})},Dne=function(n,e,i){var o,l=qDe(n,(o=e.onlyTabbable)!==null&&o!==void 0?o:!0),d=l[i];d&&Yj(d.node,e.focusOptions)},QDe=function(n,e){e===void 0&&(e={}),Dne(n,e,"first")},ZDe=function(n,e){e===void 0&&(e={}),Dne(n,e,"last")};function Xj(n){setTimeout(n,1)}var exe=function(e){return e&&"current"in e?e.current:e},xne=function(){return document&&document.activeElement===document.body},txe=function(){return xne()||UDe()},r0=null,rl=null,lX=function(){return null},i0=null,LC=!1,Jj=!1,nxe=function(){return!0},rxe=function(e){return(r0.whiteList||nxe)(e)},ixe=function(e,i){i0={observerNode:e,portaledElement:i}},sxe=function(e){return i0&&i0.portaledElement===e};function uX(n,e,i,o){var l=null,d=n;do{var p=o[d];if(p.guard)p.node.dataset.focusAutoGuard&&(l=p);else if(p.lockItem){if(d!==n)return;l=null}else break}while((d+=i)!==e);l&&(l.node.tabIndex=0)}var oxe=function(e){return e?!!LC:LC==="meanwhile"},axe=function n(e,i,o){return i&&(i.host===e&&(!i.activeElement||o.contains(i.activeElement))||i.parentNode&&n(e,i.parentNode,o))},cxe=function(e,i){return i.some(function(o){return axe(e,o,o)})},Lne=function(e){return DC(e,new Map)},lxe=function(e){return!Lne([e.parentNode]).some(function(i){return i.node===e})},$k=function(){var e=!1;if(r0){var i=r0,o=i.observed,l=i.persistentFocus,d=i.autoFocus,p=i.shards,_=i.crossFrame,E=i.focusOptions,b=i.noFocusGuards,C=o||i0&&i0.portaledElement;if(xne()&&rl&&rl!==document.body&&(!document.body.contains(rl)||lxe(rl))){var I=lX();I&&I.focus()}var O=document&&document.activeElement;if(C){var L=[C].concat(p.map(exe).filter(Boolean)),V=function(){if(!oxe(_)||!b||!rl||Jj)return!1;var se=Lne(L),ue=se.findIndex(function(re){var pe=re.node;return pe===rl});return ue===0||ue===se.length-1};if((!O||rxe(O))&&(l||V()||!txe()||!rl&&d)&&(C&&!(Ane(L)||O&&cxe(O,L)||sxe(O))&&(document&&!rl&&O&&!d?(O.blur&&O.blur(),document.body.focus()):(e=One(L,rl,{focusOptions:E}),i0={})),rl=document&&document.activeElement,rl!==document.body&&(lX=kne(rl)),LC=!1),document&&O!==document.activeElement&&document.querySelector("[data-focus-auto-guard]")){var B=document&&document.activeElement,W=GDe(L),Z=W.map(function($){var se=$.node;return se}).indexOf(B);Z>-1&&(W.filter(function($){var se=$.guard,ue=$.node;return se&&ue.dataset.focusAutoGuard}).forEach(function($){var se=$.node;return se.removeAttribute("tabIndex")}),uX(Z,W.length,1,W),uX(Z,-1,-1,W))}}}return e},Mne=function(e){$k()&&e&&(e.stopPropagation(),e.preventDefault())},Qj=function(){return Xj($k)},uxe=function(e){var i=e.target,o=e.currentTarget;o.contains(i)||ixe(o,i)},dxe=function(){return null},Une=function(){Jj=!0},Vne=function(){Jj=!1,LC="just",Xj(function(){LC="meanwhile"})},hxe=function(){document.addEventListener("focusin",Mne),document.addEventListener("focusout",Qj),window.addEventListener("focus",Une),window.addEventListener("blur",Vne)},fxe=function(){document.removeEventListener("focusin",Mne),document.removeEventListener("focusout",Qj),window.removeEventListener("focus",Une),window.removeEventListener("blur",Vne)};function pxe(n){return n.filter(function(e){var i=e.disabled;return!i})}var Fne={moveFocusInside:One,focusInside:Ane,focusNextElement:XDe,focusPrevElement:JDe,focusFirstElement:QDe,focusLastElement:ZDe,captureFocusRestore:kne};function mxe(n){var e=n.slice(-1)[0];e&&!r0&&hxe();var i=r0,o=i&&e&&e.id===i.id;r0=e,i&&!o&&(i.onDeactivation(),n.filter(function(l){var d=l.id;return d===i.id}).length||i.returnFocus(!e)),e?(rl=null,(!o||i.observed!==e.observed)&&e.onActivation(Fne),$k(),Xj($k)):(fxe(),rl=null)}gne.assignSyncMedium(uxe);_ne.assignMedium(Qj);lDe.assignMedium(function(n){return n(Fne)});const gxe=_De(pxe,mxe)(dxe);var OV=D.forwardRef(function(e,i){return fi.createElement(Bj,Uy({sideCar:gxe,ref:i},e))}),jne=Bj.propTypes||{};jne.sideCar;JNe(jne,["sideCar"]);OV.propTypes={};const _xe=OV.default??OV,Bne=n=>{const{initialFocusRef:e,finalFocusRef:i,contentRef:o,restoreFocus:l,children:d,isDisabled:p,autoFocus:_,persistentFocus:E,lockFocusAcrossFrames:b}=n,C=D.useCallback(()=>{e!=null&&e.current?e.current.focus():o!=null&&o.current&&wZ(o.current).length===0&&requestAnimationFrame(()=>{var V;(V=o.current)==null||V.focus()})},[e,o]),I=D.useCallback(()=>{var L;(L=i==null?void 0:i.current)==null||L.focus()},[i]),O=l&&!i;return w.jsx(_xe,{crossFrame:b,persistentFocus:E,autoFocus:_,disabled:p,onActivation:C,onDeactivation:I,returnFocus:O,children:d})};Bne.displayName="FocusLock";const[yxe,Exe]=Ni({name:"FormErrorStylesContext",errorMessage:`useFormErrorStyles returned is 'undefined'. Seems you forgot to wrap the components in "<FormError />" `}),Gh=jt((n,e)=>{const i=nc("FormError",n),o=Vi(n),l=G0();return l!=null&&l.isInvalid?w.jsx(yxe,{value:i,children:w.jsx(Nt.div,{...l==null?void 0:l.getErrorMessageProps(o,e),className:hn("chakra-form__error-message",n.className),__css:{display:"flex",alignItems:"center",...i.text}})}):null});Gh.displayName="FormErrorMessage";const vxe=jt((n,e)=>{const i=Exe(),o=G0();if(!(o!=null&&o.isInvalid))return null;const l=hn("chakra-form__error-icon",n.className);return w.jsx(In,{ref:e,"aria-hidden":!0,...n,__css:i.icon,className:l,children:w.jsx("path",{fill:"currentColor",d:"M11.983,0a12.206,12.206,0,0,0-8.51,3.653A11.8,11.8,0,0,0,0,12.207,11.779,11.779,0,0,0,11.8,24h.214A12.111,12.111,0,0,0,24,11.791h0A11.766,11.766,0,0,0,11.983,0ZM10.5,16.542a1.476,1.476,0,0,1,1.449-1.53h.027a1.527,1.527,0,0,1,1.523,1.47,1.475,1.475,0,0,1-1.449,1.53h-.027A1.529,1.529,0,0,1,10.5,16.542ZM11,12.5v-6a1,1,0,0,1,2,0v6a1,1,0,1,1-2,0Z"})})});vxe.displayName="FormErrorIcon";const ns=jt(function(e,i){const o=Hl("FormLabel",e),l=Vi(e),{className:d,children:p,requiredIndicator:_=w.jsx(Wne,{}),optionalIndicator:E=null,...b}=l,C=G0(),I=(C==null?void 0:C.getLabelProps(b,i))??{ref:i,...b};return w.jsxs(Nt.label,{...I,className:hn("chakra-form__label",l.className),__css:{display:"block",textAlign:"start",...o},children:[p,C!=null&&C.isRequired?_:E]})});ns.displayName="FormLabel";const Wne=jt(function(e,i){const o=G0(),l=lne();if(!(o!=null&&o.isRequired))return null;const d=hn("chakra-form__required-indicator",e.className);return w.jsx(Nt.span,{...o==null?void 0:o.getRequiredIndicatorProps(e,i),__css:l.requiredIndicator,className:d})});Wne.displayName="RequiredIndicator";const zne=jt(function(e,i){const{templateAreas:o,gap:l,rowGap:d,columnGap:p,column:_,row:E,autoFlow:b,autoRows:C,templateRows:I,autoColumns:O,templateColumns:L,...V}=e,B={display:"grid",gridTemplateAreas:o,gridGap:l,gridRowGap:d,gridColumnGap:p,gridAutoColumns:O,gridColumn:_,gridRow:E,gridAutoFlow:b,gridAutoRows:C,gridTemplateRows:I,gridTemplateColumns:L};return w.jsx(Nt.div,{ref:i,__css:B,...V})});zne.displayName="Grid";const Gne=jt(function(e,i){const{columns:o,spacingX:l,spacingY:d,spacing:p,minChildWidth:_,...E}=e,b=z0(),C=_?bxe(_,b):Txe(o);return w.jsx(zne,{ref:i,gap:p,columnGap:l,rowGap:d,templateColumns:C,...E})});Gne.displayName="SimpleGrid";function Sxe(n){return typeof n=="number"?`${n}px`:n}function bxe(n,e){return I1(n,i=>{const o=nNe("sizes",i,Sxe(i))(e);return i===null?null:`repeat(auto-fit, minmax(${o}, 1fr))`})}function Txe(n){return I1(n,e=>e===null?null:`repeat(${e}, minmax(0, 1fr))`)}function Fg(n){const{viewBox:e="0 0 24 24",d:i,displayName:o,defaultProps:l={}}=n,d=D.Children.toArray(n.path),p=jt((_,E)=>w.jsx(In,{ref:E,viewBox:e,...l,..._,children:d.length?d:w.jsx("path",{fill:"currentColor",d:i})}));return p.displayName=o,p}const kV=jt(function(e,i){const{htmlWidth:o,htmlHeight:l,alt:d,...p}=e;return w.jsx("img",{width:o,height:l,ref:i,alt:d,...p})});kV.displayName="NativeImage";const Yh=jt(function(e,i){const{fallbackSrc:o,fallback:l,src:d,srcSet:p,align:_,fit:E,loading:b,ignoreFallback:C,crossOrigin:I,fallbackStrategy:O="beforeLoadOrError",referrerPolicy:L,...V}=e,B=o!==void 0||l!==void 0,W=b!=null||C||!B,Z=one({...e,crossOrigin:I,ignoreFallback:W}),$=kNe(Z,O),se={ref:i,objectFit:E,objectPosition:_,...W?V:V0(V,["onError","onLoad"])};return $?l||w.jsx(Nt.img,{as:kV,className:"chakra-image__placeholder",src:o,...se}):w.jsx(Nt.img,{as:kV,src:d,srcSet:p,crossOrigin:I,loading:b,referrerPolicy:L,className:"chakra-image",...se})});Yh.displayName="Image";const pi=jt(function(e,i){const{htmlSize:o,...l}=e,d=nc("Input",l),p=Vi(l),_=Vj(p),E=hn("chakra-input",e.className);return w.jsx(Nt.input,{size:o,..._,__css:d.field,ref:i,className:E})});pi.displayName="Input";pi.id="Input";const[wxe,Hne]=Ni({name:"InputGroupStylesContext",errorMessage:`useInputGroupStyles returned is 'undefined'. Seems you forgot to wrap the components in "<InputGroup />" `}),Sg=jt(function(e,i){const o=nc("Input",e),{children:l,className:d,...p}=Vi(e),_=hn("chakra-input__group",d),E={},b=kF(l),C=o.field;b.forEach(O=>{o&&(C&&O.type.id==="InputLeftElement"&&(E.paddingStart=C.height??C.h),C&&O.type.id==="InputRightElement"&&(E.paddingEnd=C.height??C.h),O.type.id==="InputRightAddon"&&(E.borderEndRadius=0),O.type.id==="InputLeftAddon"&&(E.borderStartRadius=0))});const I=b.map(O=>{var V,B;const L=R1({size:((V=O.props)==null?void 0:V.size)||e.size,variant:((B=O.props)==null?void 0:B.variant)||e.variant});return O.type.id!=="Input"?D.cloneElement(O,L):D.cloneElement(O,Object.assign(L,E,O.props))});return w.jsx(Nt.div,{className:_,ref:i,__css:{width:"100%",display:"flex",position:"relative",isolation:"isolate",...o.group},"data-group":!0,...p,children:w.jsx(wxe,{value:o,children:I})})});Sg.displayName="InputGroup";const Cxe={left:{marginEnd:"-1px",borderEndRadius:0,borderEndColor:"transparent"},right:{marginStart:"-1px",borderStartRadius:0,borderStartColor:"transparent"}},Rxe=Nt("div",{baseStyle:{flex:"0 0 auto",width:"auto",display:"flex",alignItems:"center",whiteSpace:"nowrap"}}),Zj=jt(function(e,i){const{placement:o="left",...l}=e,d=Cxe[o]??{},p=Hne();return w.jsx(Rxe,{ref:i,...l,__css:{...p.addon,...d}})});Zj.displayName="InputAddon";const G1=jt(function(e,i){return w.jsx(Zj,{ref:i,placement:"left",...e,className:hn("chakra-input__left-addon",e.className)})});G1.displayName="InputLeftAddon";G1.id="InputLeftAddon";const $ne=jt(function(e,i){return w.jsx(Zj,{ref:i,placement:"right",...e,className:hn("chakra-input__right-addon",e.className)})});$ne.displayName="InputRightAddon";$ne.id="InputRightAddon";const Ixe=Nt("div",{baseStyle:{display:"flex",alignItems:"center",justifyContent:"center",position:"absolute",top:"0",zIndex:2}}),H1=jt(function(e,i){const{placement:o="left",...l}=e,d=Hne(),p=d.field,E={[o==="left"?"insetStart":"insetEnd"]:"0",width:(p==null?void 0:p.height)??(p==null?void 0:p.h),height:(p==null?void 0:p.height)??(p==null?void 0:p.h),fontSize:p==null?void 0:p.fontSize,...d.element};return w.jsx(Ixe,{ref:i,__css:E,...l})});H1.id="InputElement";H1.displayName="InputElement";const uC=jt(function(e,i){const{className:o,...l}=e,d=hn("chakra-input__left-element",o);return w.jsx(H1,{ref:i,placement:"left",className:d,...l})});uC.id="InputLeftElement";uC.displayName="InputLeftElement";const Kk=jt(function(e,i){const{className:o,...l}=e,d=hn("chakra-input__right-element",o);return w.jsx(H1,{ref:i,placement:"right",className:d,...l})});Kk.id="InputRightElement";Kk.displayName="InputRightElement";const Ml=jt(function(e,i){const o=Hl("Link",e),{className:l,isExternal:d,...p}=Vi(e);return w.jsx(Nt.a,{target:d?"_blank":void 0,rel:d?"noopener":void 0,ref:i,className:hn("chakra-link",l),...p,__css:o})});Ml.displayName="Link";function Axe(n,e={}){const{ssr:i=!0,fallback:o}=e,{getWindow:l}=sAe(),d=Array.isArray(n)?n:[n];let p=Array.isArray(o)?o:[o];p=p.filter(b=>b!=null);const[_,E]=D.useState(()=>d.map((b,C)=>({media:b,matches:i?!!p[C]:l().matchMedia(b).matches})));return D.useEffect(()=>{const b=l();E(d.map(O=>({media:O,matches:b.matchMedia(O).matches})));const C=d.map(O=>b.matchMedia(O)),I=O=>{E(L=>L.slice().map(V=>V.media===O.media?{...V,matches:O.matches}:V))};return C.forEach(O=>{typeof O.addListener=="function"?O.addListener(I):O.addEventListener("change",I)}),()=>{C.forEach(O=>{typeof O.removeListener=="function"?O.removeListener(I):O.removeEventListener("change",I)})}},[l]),_.map(b=>b.matches)}function Pxe(n,e,i,o){if(e==null)return o;if(!o)return n.find(p=>i(p).toLowerCase().startsWith(e.toLowerCase()));const l=n.filter(d=>i(d).toLowerCase().startsWith(e.toLowerCase()));if(l.length>0){let d;return l.includes(o)?(d=l.indexOf(o)+1,d===l.length&&(d=0),l[d]):(d=n.indexOf(l[0]),n[d])}return o}function Oxe(n){const{key:e}=n;return e.length===1||e.length>1&&/[^a-zA-Z0-9]/.test(e)}function kxe(n={}){const{timeout:e=300,preventDefault:i=()=>!0}=n,[o,l]=D.useState([]),d=D.useRef(void 0),p=()=>{d.current&&(clearTimeout(d.current),d.current=null)},_=()=>{p(),d.current=setTimeout(()=>{l([]),d.current=null},e)};D.useEffect(()=>p,[]);function E(b){return C=>{if(C.key==="Backspace"){const I=[...o];I.pop(),l(I);return}if(Oxe(C)){const I=o.concat(C.key);i(C)&&(C.preventDefault(),C.stopPropagation()),l(I),b(I.join("")),_()}}}return E}var ll="top",Uu="bottom",Vu="right",ul="left",e4="auto",cR=[ll,Uu,Vu,ul],S0="start",MC="end",Nxe="clippingParents",Kne="viewport",Sw="popper",Dxe="reference",dX=cR.reduce(function(n,e){return n.concat([e+"-"+S0,e+"-"+MC])},[]),qne=[].concat(cR,[e4]).reduce(function(n,e){return n.concat([e,e+"-"+S0,e+"-"+MC])},[]),xxe="beforeRead",Lxe="read",Mxe="afterRead",Uxe="beforeMain",Vxe="main",Fxe="afterMain",jxe="beforeWrite",Bxe="write",Wxe="afterWrite",zxe=[xxe,Lxe,Mxe,Uxe,Vxe,Fxe,jxe,Bxe,Wxe];function ff(n){return n?(n.nodeName||"").toLowerCase():null}function Gl(n){if(n==null)return window;if(n.toString()!=="[object Window]"){var e=n.ownerDocument;return e&&e.defaultView||window}return n}function jy(n){var e=Gl(n).Element;return n instanceof e||n instanceof Element}function xu(n){var e=Gl(n).HTMLElement;return n instanceof e||n instanceof HTMLElement}function t4(n){if(typeof ShadowRoot>"u")return!1;var e=Gl(n).ShadowRoot;return n instanceof e||n instanceof ShadowRoot}function Gxe(n){var e=n.state;Object.keys(e.elements).forEach(function(i){var o=e.styles[i]||{},l=e.attributes[i]||{},d=e.elements[i];!xu(d)||!ff(d)||(Object.assign(d.style,o),Object.keys(l).forEach(function(p){var _=l[p];_===!1?d.removeAttribute(p):d.setAttribute(p,_===!0?"":_)}))})}function Hxe(n){var e=n.state,i={popper:{position:e.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(e.elements.popper.style,i.popper),e.styles=i,e.elements.arrow&&Object.assign(e.elements.arrow.style,i.arrow),function(){Object.keys(e.elements).forEach(function(o){var l=e.elements[o],d=e.attributes[o]||{},p=Object.keys(e.styles.hasOwnProperty(o)?e.styles[o]:i[o]),_=p.reduce(function(E,b){return E[b]="",E},{});!xu(l)||!ff(l)||(Object.assign(l.style,_),Object.keys(d).forEach(function(E){l.removeAttribute(E)}))})}}const $xe={name:"applyStyles",enabled:!0,phase:"write",fn:Gxe,effect:Hxe,requires:["computeStyles"]};function sf(n){return n.split("-")[0]}var xy=Math.max,qk=Math.min,b0=Math.round;function NV(){var n=navigator.userAgentData;return n!=null&&n.brands&&Array.isArray(n.brands)?n.brands.map(function(e){return e.brand+"/"+e.version}).join(" "):navigator.userAgent}function Yne(){return!/^((?!chrome|android).)*safari/i.test(NV())}function T0(n,e,i){e===void 0&&(e=!1),i===void 0&&(i=!1);var o=n.getBoundingClientRect(),l=1,d=1;e&&xu(n)&&(l=n.offsetWidth>0&&b0(o.width)/n.offsetWidth||1,d=n.offsetHeight>0&&b0(o.height)/n.offsetHeight||1);var p=jy(n)?Gl(n):window,_=p.visualViewport,E=!Yne()&&i,b=(o.left+(E&&_?_.offsetLeft:0))/l,C=(o.top+(E&&_?_.offsetTop:0))/d,I=o.width/l,O=o.height/d;return{width:I,height:O,top:C,right:b+I,bottom:C+O,left:b,x:b,y:C}}function n4(n){var e=T0(n),i=n.offsetWidth,o=n.offsetHeight;return Math.abs(e.width-i)<=1&&(i=e.width),Math.abs(e.height-o)<=1&&(o=e.height),{x:n.offsetLeft,y:n.offsetTop,width:i,height:o}}function Xne(n,e){var i=e.getRootNode&&e.getRootNode();if(n.contains(e))return!0;if(i&&t4(i)){var o=e;do{if(o&&n.isSameNode(o))return!0;o=o.parentNode||o.host}while(o)}return!1}function Wp(n){return Gl(n).getComputedStyle(n)}function Kxe(n){return["table","td","th"].indexOf(ff(n))>=0}function jg(n){return((jy(n)?n.ownerDocument:n.document)||window.document).documentElement}function $1(n){return ff(n)==="html"?n:n.assignedSlot||n.parentNode||(t4(n)?n.host:null)||jg(n)}function hX(n){return!xu(n)||Wp(n).position==="fixed"?null:n.offsetParent}function qxe(n){var e=/firefox/i.test(NV()),i=/Trident/i.test(NV());if(i&&xu(n)){var o=Wp(n);if(o.position==="fixed")return null}var l=$1(n);for(t4(l)&&(l=l.host);xu(l)&&["html","body"].indexOf(ff(l))<0;){var d=Wp(l);if(d.transform!=="none"||d.perspective!=="none"||d.contain==="paint"||["transform","perspective"].indexOf(d.willChange)!==-1||e&&d.willChange==="filter"||e&&d.filter&&d.filter!=="none")return l;l=l.parentNode}return null}function lR(n){for(var e=Gl(n),i=hX(n);i&&Kxe(i)&&Wp(i).position==="static";)i=hX(i);return i&&(ff(i)==="html"||ff(i)==="body"&&Wp(i).position==="static")?e:i||qxe(n)||e}function r4(n){return["top","bottom"].indexOf(n)>=0?"x":"y"}function dC(n,e,i){return xy(n,qk(e,i))}function Yxe(n,e,i){var o=dC(n,e,i);return o>i?i:o}function Jne(){return{top:0,right:0,bottom:0,left:0}}function Qne(n){return Object.assign({},Jne(),n)}function Zne(n,e){return e.reduce(function(i,o){return i[o]=n,i},{})}var Xxe=function(e,i){return e=typeof e=="function"?e(Object.assign({},i.rects,{placement:i.placement})):e,Qne(typeof e!="number"?e:Zne(e,cR))};function Jxe(n){var e,i=n.state,o=n.name,l=n.options,d=i.elements.arrow,p=i.modifiersData.popperOffsets,_=sf(i.placement),E=r4(_),b=[ul,Vu].indexOf(_)>=0,C=b?"height":"width";if(!(!d||!p)){var I=Xxe(l.padding,i),O=n4(d),L=E==="y"?ll:ul,V=E==="y"?Uu:Vu,B=i.rects.reference[C]+i.rects.reference[E]-p[E]-i.rects.popper[C],W=p[E]-i.rects.reference[E],Z=lR(d),$=Z?E==="y"?Z.clientHeight||0:Z.clientWidth||0:0,se=B/2-W/2,ue=I[L],re=$-O[C]-I[V],pe=$/2-O[C]/2+se,q=dC(ue,pe,re),Q=E;i.modifiersData[o]=(e={},e[Q]=q,e.centerOffset=q-pe,e)}}function Qxe(n){var e=n.state,i=n.options,o=i.element,l=o===void 0?"[data-popper-arrow]":o;l!=null&&(typeof l=="string"&&(l=e.elements.popper.querySelector(l),!l)||Xne(e.elements.popper,l)&&(e.elements.arrow=l))}const Zxe={name:"arrow",enabled:!0,phase:"main",fn:Jxe,effect:Qxe,requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function w0(n){return n.split("-")[1]}var eLe={top:"auto",right:"auto",bottom:"auto",left:"auto"};function tLe(n,e){var i=n.x,o=n.y,l=e.devicePixelRatio||1;return{x:b0(i*l)/l||0,y:b0(o*l)/l||0}}function fX(n){var e,i=n.popper,o=n.popperRect,l=n.placement,d=n.variation,p=n.offsets,_=n.position,E=n.gpuAcceleration,b=n.adaptive,C=n.roundOffsets,I=n.isFixed,O=p.x,L=O===void 0?0:O,V=p.y,B=V===void 0?0:V,W=typeof C=="function"?C({x:L,y:B}):{x:L,y:B};L=W.x,B=W.y;var Z=p.hasOwnProperty("x"),$=p.hasOwnProperty("y"),se=ul,ue=ll,re=window;if(b){var pe=lR(i),q="clientHeight",Q="clientWidth";if(pe===Gl(i)&&(pe=jg(i),Wp(pe).position!=="static"&&_==="absolute"&&(q="scrollHeight",Q="scrollWidth")),pe=pe,l===ll||(l===ul||l===Vu)&&d===MC){ue=Uu;var J=I&&pe===re&&re.visualViewport?re.visualViewport.height:pe[q];B-=J-o.height,B*=E?1:-1}if(l===ul||(l===ll||l===Uu)&&d===MC){se=Vu;var ie=I&&pe===re&&re.visualViewport?re.visualViewport.width:pe[Q];L-=ie-o.width,L*=E?1:-1}}var me=Object.assign({position:_},b&&eLe),de=C===!0?tLe({x:L,y:B},Gl(i)):{x:L,y:B};if(L=de.x,B=de.y,E){var le;return Object.assign({},me,(le={},le[ue]=$?"0":"",le[se]=Z?"0":"",le.transform=(re.devicePixelRatio||1)<=1?"translate("+L+"px, "+B+"px)":"translate3d("+L+"px, "+B+"px, 0)",le))}return Object.assign({},me,(e={},e[ue]=$?B+"px":"",e[se]=Z?L+"px":"",e.transform="",e))}function nLe(n){var e=n.state,i=n.options,o=i.gpuAcceleration,l=o===void 0?!0:o,d=i.adaptive,p=d===void 0?!0:d,_=i.roundOffsets,E=_===void 0?!0:_,b={placement:sf(e.placement),variation:w0(e.placement),popper:e.elements.popper,popperRect:e.rects.popper,gpuAcceleration:l,isFixed:e.options.strategy==="fixed"};e.modifiersData.popperOffsets!=null&&(e.styles.popper=Object.assign({},e.styles.popper,fX(Object.assign({},b,{offsets:e.modifiersData.popperOffsets,position:e.options.strategy,adaptive:p,roundOffsets:E})))),e.modifiersData.arrow!=null&&(e.styles.arrow=Object.assign({},e.styles.arrow,fX(Object.assign({},b,{offsets:e.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:E})))),e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-placement":e.placement})}const rLe={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:nLe,data:{}};var AO={passive:!0};function iLe(n){var e=n.state,i=n.instance,o=n.options,l=o.scroll,d=l===void 0?!0:l,p=o.resize,_=p===void 0?!0:p,E=Gl(e.elements.popper),b=[].concat(e.scrollParents.reference,e.scrollParents.popper);return d&&b.forEach(function(C){C.addEventListener("scroll",i.update,AO)}),_&&E.addEventListener("resize",i.update,AO),function(){d&&b.forEach(function(C){C.removeEventListener("scroll",i.update,AO)}),_&&E.removeEventListener("resize",i.update,AO)}}const sLe={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:iLe,data:{}};var oLe={left:"right",right:"left",bottom:"top",top:"bottom"};function dk(n){return n.replace(/left|right|bottom|top/g,function(e){return oLe[e]})}var aLe={start:"end",end:"start"};function pX(n){return n.replace(/start|end/g,function(e){return aLe[e]})}function i4(n){var e=Gl(n),i=e.pageXOffset,o=e.pageYOffset;return{scrollLeft:i,scrollTop:o}}function s4(n){return T0(jg(n)).left+i4(n).scrollLeft}function cLe(n,e){var i=Gl(n),o=jg(n),l=i.visualViewport,d=o.clientWidth,p=o.clientHeight,_=0,E=0;if(l){d=l.width,p=l.height;var b=Yne();(b||!b&&e==="fixed")&&(_=l.offsetLeft,E=l.offsetTop)}return{width:d,height:p,x:_+s4(n),y:E}}function lLe(n){var e,i=jg(n),o=i4(n),l=(e=n.ownerDocument)==null?void 0:e.body,d=xy(i.scrollWidth,i.clientWidth,l?l.scrollWidth:0,l?l.clientWidth:0),p=xy(i.scrollHeight,i.clientHeight,l?l.scrollHeight:0,l?l.clientHeight:0),_=-o.scrollLeft+s4(n),E=-o.scrollTop;return Wp(l||i).direction==="rtl"&&(_+=xy(i.clientWidth,l?l.clientWidth:0)-d),{width:d,height:p,x:_,y:E}}function o4(n){var e=Wp(n),i=e.overflow,o=e.overflowX,l=e.overflowY;return/auto|scroll|overlay|hidden/.test(i+l+o)}function ere(n){return["html","body","#document"].indexOf(ff(n))>=0?n.ownerDocument.body:xu(n)&&o4(n)?n:ere($1(n))}function hC(n,e){var i;e===void 0&&(e=[]);var o=ere(n),l=o===((i=n.ownerDocument)==null?void 0:i.body),d=Gl(o),p=l?[d].concat(d.visualViewport||[],o4(o)?o:[]):o,_=e.concat(p);return l?_:_.concat(hC($1(p)))}function DV(n){return Object.assign({},n,{left:n.x,top:n.y,right:n.x+n.width,bottom:n.y+n.height})}function uLe(n,e){var i=T0(n,!1,e==="fixed");return i.top=i.top+n.clientTop,i.left=i.left+n.clientLeft,i.bottom=i.top+n.clientHeight,i.right=i.left+n.clientWidth,i.width=n.clientWidth,i.height=n.clientHeight,i.x=i.left,i.y=i.top,i}function mX(n,e,i){return e===Kne?DV(cLe(n,i)):jy(e)?uLe(e,i):DV(lLe(jg(n)))}function dLe(n){var e=hC($1(n)),i=["absolute","fixed"].indexOf(Wp(n).position)>=0,o=i&&xu(n)?lR(n):n;return jy(o)?e.filter(function(l){return jy(l)&&Xne(l,o)&&ff(l)!=="body"}):[]}function hLe(n,e,i,o){var l=e==="clippingParents"?dLe(n):[].concat(e),d=[].concat(l,[i]),p=d[0],_=d.reduce(function(E,b){var C=mX(n,b,o);return E.top=xy(C.top,E.top),E.right=qk(C.right,E.right),E.bottom=qk(C.bottom,E.bottom),E.left=xy(C.left,E.left),E},mX(n,p,o));return _.width=_.right-_.left,_.height=_.bottom-_.top,_.x=_.left,_.y=_.top,_}function tre(n){var e=n.reference,i=n.element,o=n.placement,l=o?sf(o):null,d=o?w0(o):null,p=e.x+e.width/2-i.width/2,_=e.y+e.height/2-i.height/2,E;switch(l){case ll:E={x:p,y:e.y-i.height};break;case Uu:E={x:p,y:e.y+e.height};break;case Vu:E={x:e.x+e.width,y:_};break;case ul:E={x:e.x-i.width,y:_};break;default:E={x:e.x,y:e.y}}var b=l?r4(l):null;if(b!=null){var C=b==="y"?"height":"width";switch(d){case S0:E[b]=E[b]-(e[C]/2-i[C]/2);break;case MC:E[b]=E[b]+(e[C]/2-i[C]/2);break}}return E}function UC(n,e){e===void 0&&(e={});var i=e,o=i.placement,l=o===void 0?n.placement:o,d=i.strategy,p=d===void 0?n.strategy:d,_=i.boundary,E=_===void 0?Nxe:_,b=i.rootBoundary,C=b===void 0?Kne:b,I=i.elementContext,O=I===void 0?Sw:I,L=i.altBoundary,V=L===void 0?!1:L,B=i.padding,W=B===void 0?0:B,Z=Qne(typeof W!="number"?W:Zne(W,cR)),$=O===Sw?Dxe:Sw,se=n.rects.popper,ue=n.elements[V?$:O],re=hLe(jy(ue)?ue:ue.contextElement||jg(n.elements.popper),E,C,p),pe=T0(n.elements.reference),q=tre({reference:pe,element:se,placement:l}),Q=DV(Object.assign({},se,q)),J=O===Sw?Q:pe,ie={top:re.top-J.top+Z.top,bottom:J.bottom-re.bottom+Z.bottom,left:re.left-J.left+Z.left,right:J.right-re.right+Z.right},me=n.modifiersData.offset;if(O===Sw&&me){var de=me[l];Object.keys(ie).forEach(function(le){var xe=[Vu,Uu].indexOf(le)>=0?1:-1,We=[ll,Uu].indexOf(le)>=0?"y":"x";ie[le]+=de[We]*xe})}return ie}function fLe(n,e){e===void 0&&(e={});var i=e,o=i.placement,l=i.boundary,d=i.rootBoundary,p=i.padding,_=i.flipVariations,E=i.allowedAutoPlacements,b=E===void 0?qne:E,C=w0(o),I=C?_?dX:dX.filter(function(V){return w0(V)===C}):cR,O=I.filter(function(V){return b.indexOf(V)>=0});O.length===0&&(O=I);var L=O.reduce(function(V,B){return V[B]=UC(n,{placement:B,boundary:l,rootBoundary:d,padding:p})[sf(B)],V},{});return Object.keys(L).sort(function(V,B){return L[V]-L[B]})}function pLe(n){if(sf(n)===e4)return[];var e=dk(n);return[pX(n),e,pX(e)]}function mLe(n){var e=n.state,i=n.options,o=n.name;if(!e.modifiersData[o]._skip){for(var l=i.mainAxis,d=l===void 0?!0:l,p=i.altAxis,_=p===void 0?!0:p,E=i.fallbackPlacements,b=i.padding,C=i.boundary,I=i.rootBoundary,O=i.altBoundary,L=i.flipVariations,V=L===void 0?!0:L,B=i.allowedAutoPlacements,W=e.options.placement,Z=sf(W),$=Z===W,se=E||($||!V?[dk(W)]:pLe(W)),ue=[W].concat(se).reduce(function(Me,ze){return Me.concat(sf(ze)===e4?fLe(e,{placement:ze,boundary:C,rootBoundary:I,padding:b,flipVariations:V,allowedAutoPlacements:B}):ze)},[]),re=e.rects.reference,pe=e.rects.popper,q=new Map,Q=!0,J=ue[0],ie=0;ie<ue.length;ie++){var me=ue[ie],de=sf(me),le=w0(me)===S0,xe=[ll,Uu].indexOf(de)>=0,We=xe?"width":"height",$e=UC(e,{placement:me,boundary:C,rootBoundary:I,altBoundary:O,padding:b}),ve=xe?le?Vu:ul:le?Uu:ll;re[We]>pe[We]&&(ve=dk(ve));var _e=dk(ve),Ee=[];if(d&&Ee.push($e[de]<=0),_&&Ee.push($e[ve]<=0,$e[_e]<=0),Ee.every(function(Me){return Me})){J=me,Q=!1;break}q.set(me,Ee)}if(Q)for(var ke=V?3:1,we=function(ze){var Je=ue.find(function(tt){var ut=q.get(tt);if(ut)return ut.slice(0,ze).every(function(Ze){return Ze})});if(Je)return J=Je,"break"},be=ke;be>0;be--){var Ie=we(be);if(Ie==="break")break}e.placement!==J&&(e.modifiersData[o]._skip=!0,e.placement=J,e.reset=!0)}}const gLe={name:"flip",enabled:!0,phase:"main",fn:mLe,requiresIfExists:["offset"],data:{_skip:!1}};function gX(n,e,i){return i===void 0&&(i={x:0,y:0}),{top:n.top-e.height-i.y,right:n.right-e.width+i.x,bottom:n.bottom-e.height+i.y,left:n.left-e.width-i.x}}function _X(n){return[ll,Vu,Uu,ul].some(function(e){return n[e]>=0})}function _Le(n){var e=n.state,i=n.name,o=e.rects.reference,l=e.rects.popper,d=e.modifiersData.preventOverflow,p=UC(e,{elementContext:"reference"}),_=UC(e,{altBoundary:!0}),E=gX(p,o),b=gX(_,l,d),C=_X(E),I=_X(b);e.modifiersData[i]={referenceClippingOffsets:E,popperEscapeOffsets:b,isReferenceHidden:C,hasPopperEscaped:I},e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-reference-hidden":C,"data-popper-escaped":I})}const yLe={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:_Le};function ELe(n,e,i){var o=sf(n),l=[ul,ll].indexOf(o)>=0?-1:1,d=typeof i=="function"?i(Object.assign({},e,{placement:n})):i,p=d[0],_=d[1];return p=p||0,_=(_||0)*l,[ul,Vu].indexOf(o)>=0?{x:_,y:p}:{x:p,y:_}}function vLe(n){var e=n.state,i=n.options,o=n.name,l=i.offset,d=l===void 0?[0,0]:l,p=qne.reduce(function(C,I){return C[I]=ELe(I,e.rects,d),C},{}),_=p[e.placement],E=_.x,b=_.y;e.modifiersData.popperOffsets!=null&&(e.modifiersData.popperOffsets.x+=E,e.modifiersData.popperOffsets.y+=b),e.modifiersData[o]=p}const SLe={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:vLe};function bLe(n){var e=n.state,i=n.name;e.modifiersData[i]=tre({reference:e.rects.reference,element:e.rects.popper,placement:e.placement})}const TLe={name:"popperOffsets",enabled:!0,phase:"read",fn:bLe,data:{}};function wLe(n){return n==="x"?"y":"x"}function CLe(n){var e=n.state,i=n.options,o=n.name,l=i.mainAxis,d=l===void 0?!0:l,p=i.altAxis,_=p===void 0?!1:p,E=i.boundary,b=i.rootBoundary,C=i.altBoundary,I=i.padding,O=i.tether,L=O===void 0?!0:O,V=i.tetherOffset,B=V===void 0?0:V,W=UC(e,{boundary:E,rootBoundary:b,padding:I,altBoundary:C}),Z=sf(e.placement),$=w0(e.placement),se=!$,ue=r4(Z),re=wLe(ue),pe=e.modifiersData.popperOffsets,q=e.rects.reference,Q=e.rects.popper,J=typeof B=="function"?B(Object.assign({},e.rects,{placement:e.placement})):B,ie=typeof J=="number"?{mainAxis:J,altAxis:J}:Object.assign({mainAxis:0,altAxis:0},J),me=e.modifiersData.offset?e.modifiersData.offset[e.placement]:null,de={x:0,y:0};if(pe){if(d){var le,xe=ue==="y"?ll:ul,We=ue==="y"?Uu:Vu,$e=ue==="y"?"height":"width",ve=pe[ue],_e=ve+W[xe],Ee=ve-W[We],ke=L?-Q[$e]/2:0,we=$===S0?q[$e]:Q[$e],be=$===S0?-Q[$e]:-q[$e],Ie=e.elements.arrow,Me=L&&Ie?n4(Ie):{width:0,height:0},ze=e.modifiersData["arrow#persistent"]?e.modifiersData["arrow#persistent"].padding:Jne(),Je=ze[xe],tt=ze[We],ut=dC(0,q[$e],Me[$e]),Ze=se?q[$e]/2-ke-ut-Je-ie.mainAxis:we-ut-Je-ie.mainAxis,bt=se?-q[$e]/2+ke+ut+tt+ie.mainAxis:be+ut+tt+ie.mainAxis,on=e.elements.arrow&&lR(e.elements.arrow),Mt=on?ue==="y"?on.clientTop||0:on.clientLeft||0:0,Zt=(le=me==null?void 0:me[ue])!=null?le:0,an=ve+Ze-Zt-Mt,Ht=ve+bt-Zt,jn=dC(L?qk(_e,an):_e,ve,L?xy(Ee,Ht):Ee);pe[ue]=jn,de[ue]=jn-ve}if(_){var Wt,Re=ue==="x"?ll:ul,Fe=ue==="x"?Uu:Vu,Ge=pe[re],at=re==="y"?"height":"width",yt=Ge+W[Re],vt=Ge-W[Fe],Gt=[ll,ul].indexOf(Z)!==-1,gn=(Wt=me==null?void 0:me[re])!=null?Wt:0,Pn=Gt?yt:Ge-q[at]-Q[at]-gn+ie.altAxis,un=Gt?Ge+q[at]+Q[at]-gn-ie.altAxis:vt,wt=L&&Gt?Yxe(Pn,Ge,un):dC(L?Pn:yt,Ge,L?un:vt);pe[re]=wt,de[re]=wt-Ge}e.modifiersData[o]=de}}const RLe={name:"preventOverflow",enabled:!0,phase:"main",fn:CLe,requiresIfExists:["offset"]};function ILe(n){return{scrollLeft:n.scrollLeft,scrollTop:n.scrollTop}}function ALe(n){return n===Gl(n)||!xu(n)?i4(n):ILe(n)}function PLe(n){var e=n.getBoundingClientRect(),i=b0(e.width)/n.offsetWidth||1,o=b0(e.height)/n.offsetHeight||1;return i!==1||o!==1}function OLe(n,e,i){i===void 0&&(i=!1);var o=xu(e),l=xu(e)&&PLe(e),d=jg(e),p=T0(n,l,i),_={scrollLeft:0,scrollTop:0},E={x:0,y:0};return(o||!o&&!i)&&((ff(e)!=="body"||o4(d))&&(_=ALe(e)),xu(e)?(E=T0(e,!0),E.x+=e.clientLeft,E.y+=e.clientTop):d&&(E.x=s4(d))),{x:p.left+_.scrollLeft-E.x,y:p.top+_.scrollTop-E.y,width:p.width,height:p.height}}function kLe(n){var e=new Map,i=new Set,o=[];n.forEach(function(d){e.set(d.name,d)});function l(d){i.add(d.name);var p=[].concat(d.requires||[],d.requiresIfExists||[]);p.forEach(function(_){if(!i.has(_)){var E=e.get(_);E&&l(E)}}),o.push(d)}return n.forEach(function(d){i.has(d.name)||l(d)}),o}function NLe(n){var e=kLe(n);return zxe.reduce(function(i,o){return i.concat(e.filter(function(l){return l.phase===o}))},[])}function DLe(n){var e;return function(){return e||(e=new Promise(function(i){Promise.resolve().then(function(){e=void 0,i(n())})})),e}}function xLe(n){var e=n.reduce(function(i,o){var l=i[o.name];return i[o.name]=l?Object.assign({},l,o,{options:Object.assign({},l.options,o.options),data:Object.assign({},l.data,o.data)}):o,i},{});return Object.keys(e).map(function(i){return e[i]})}var yX={placement:"bottom",modifiers:[],strategy:"absolute"};function EX(){for(var n=arguments.length,e=new Array(n),i=0;i<n;i++)e[i]=arguments[i];return!e.some(function(o){return!(o&&typeof o.getBoundingClientRect=="function")})}function LLe(n){n===void 0&&(n={});var e=n,i=e.defaultModifiers,o=i===void 0?[]:i,l=e.defaultOptions,d=l===void 0?yX:l;return function(_,E,b){b===void 0&&(b=d);var C={placement:"bottom",orderedModifiers:[],options:Object.assign({},yX,d),modifiersData:{},elements:{reference:_,popper:E},attributes:{},styles:{}},I=[],O=!1,L={state:C,setOptions:function(Z){var $=typeof Z=="function"?Z(C.options):Z;B(),C.options=Object.assign({},d,C.options,$),C.scrollParents={reference:jy(_)?hC(_):_.contextElement?hC(_.contextElement):[],popper:hC(E)};var se=NLe(xLe([].concat(o,C.options.modifiers)));return C.orderedModifiers=se.filter(function(ue){return ue.enabled}),V(),L.update()},forceUpdate:function(){if(!O){var Z=C.elements,$=Z.reference,se=Z.popper;if(EX($,se)){C.rects={reference:OLe($,lR(se),C.options.strategy==="fixed"),popper:n4(se)},C.reset=!1,C.placement=C.options.placement,C.orderedModifiers.forEach(function(ie){return C.modifiersData[ie.name]=Object.assign({},ie.data)});for(var ue=0;ue<C.orderedModifiers.length;ue++){if(C.reset===!0){C.reset=!1,ue=-1;continue}var re=C.orderedModifiers[ue],pe=re.fn,q=re.options,Q=q===void 0?{}:q,J=re.name;typeof pe=="function"&&(C=pe({state:C,options:Q,name:J,instance:L})||C)}}}},update:DLe(function(){return new Promise(function(W){L.forceUpdate(),W(C)})}),destroy:function(){B(),O=!0}};if(!EX(_,E))return L;L.setOptions(b).then(function(W){!O&&b.onFirstUpdate&&b.onFirstUpdate(W)});function V(){C.orderedModifiers.forEach(function(W){var Z=W.name,$=W.options,se=$===void 0?{}:$,ue=W.effect;if(typeof ue=="function"){var re=ue({state:C,name:Z,instance:L,options:se}),pe=function(){};I.push(re||pe)}})}function B(){I.forEach(function(W){return W()}),I=[]}return L}}var MLe=[sLe,TLe,rLe,$xe,SLe,gLe,RLe,Zxe,yLe],ULe=LLe({defaultModifiers:MLe});const TS=(n,e)=>({var:n,varRef:e?`var(${n}, ${e})`:`var(${n})`}),ro={arrowShadowColor:TS("--popper-arrow-shadow-color"),arrowSize:TS("--popper-arrow-size","8px"),arrowSizeHalf:TS("--popper-arrow-size-half"),arrowBg:TS("--popper-arrow-bg"),transformOrigin:TS("--popper-transform-origin"),arrowOffset:TS("--popper-arrow-offset")};function VLe(n){if(n.includes("top"))return"1px 1px 0px 0 var(--popper-arrow-shadow-color)";if(n.includes("bottom"))return"-1px -1px 0px 0 var(--popper-arrow-shadow-color)";if(n.includes("right"))return"-1px 1px 0px 0 var(--popper-arrow-shadow-color)";if(n.includes("left"))return"1px -1px 0px 0 var(--popper-arrow-shadow-color)"}const FLe={top:"bottom center","top-start":"bottom left","top-end":"bottom right",bottom:"top center","bottom-start":"top left","bottom-end":"top right",left:"right center","left-start":"right top","left-end":"right bottom",right:"left center","right-start":"left top","right-end":"left bottom"},jLe=n=>FLe[n],vX={scroll:!0,resize:!0};function BLe(n){let e;return typeof n=="object"?e={enabled:!0,options:{...vX,...n}}:e={enabled:n,options:vX},e}const WLe={name:"matchWidth",enabled:!0,phase:"beforeWrite",requires:["computeStyles"],fn:({state:n})=>{n.styles.popper.width=`${n.rects.reference.width}px`},effect:({state:n})=>()=>{const e=n.elements.reference;n.elements.popper.style.width=`${e.offsetWidth}px`}},zLe={name:"transformOrigin",enabled:!0,phase:"write",fn:({state:n})=>{SX(n)},effect:({state:n})=>()=>{SX(n)}},SX=n=>{n.elements.popper.style.setProperty(ro.transformOrigin.var,jLe(n.placement))},GLe={name:"positionArrow",enabled:!0,phase:"afterWrite",fn:({state:n})=>{HLe(n)}},HLe=n=>{var i;if(!n.placement)return;const e=$Le(n.placement);if((i=n.elements)!=null&&i.arrow&&e){Object.assign(n.elements.arrow.style,{[e.property]:e.value,width:ro.arrowSize.varRef,height:ro.arrowSize.varRef,zIndex:-1});const o={[ro.arrowSizeHalf.var]:`calc(${ro.arrowSize.varRef} / 2 - 1px)`,[ro.arrowOffset.var]:`calc(${ro.arrowSizeHalf.varRef} * -1)`};for(const l in o)n.elements.arrow.style.setProperty(l,o[l])}},$Le=n=>{if(n.startsWith("top"))return{property:"bottom",value:ro.arrowOffset.varRef};if(n.startsWith("bottom"))return{property:"top",value:ro.arrowOffset.varRef};if(n.startsWith("left"))return{property:"right",value:ro.arrowOffset.varRef};if(n.startsWith("right"))return{property:"left",value:ro.arrowOffset.varRef}},KLe={name:"innerArrow",enabled:!0,phase:"main",requires:["arrow"],fn:({state:n})=>{bX(n)},effect:({state:n})=>()=>{bX(n)}},bX=n=>{if(!n.elements.arrow)return;const e=n.elements.arrow.querySelector("[data-popper-arrow-inner]");if(!e)return;const i=VLe(n.placement);i&&e.style.setProperty("--popper-arrow-default-shadow",i),Object.assign(e.style,{transform:"rotate(45deg)",background:ro.arrowBg.varRef,top:0,left:0,width:"100%",height:"100%",position:"absolute",zIndex:"inherit",boxShadow:"var(--popper-arrow-shadow, var(--popper-arrow-default-shadow))"})},qLe={"start-start":{ltr:"left-start",rtl:"right-start"},"start-end":{ltr:"left-end",rtl:"right-end"},"end-start":{ltr:"right-start",rtl:"left-start"},"end-end":{ltr:"right-end",rtl:"left-end"},start:{ltr:"left",rtl:"right"},end:{ltr:"right",rtl:"left"}},YLe={"auto-start":"auto-end","auto-end":"auto-start","top-start":"top-end","top-end":"top-start","bottom-start":"bottom-end","bottom-end":"bottom-start"};function XLe(n,e="ltr"){var o;const i=((o=qLe[n])==null?void 0:o[e])||n;return e==="ltr"?i:YLe[n]??i}function a4(n={}){const{enabled:e=!0,modifiers:i,placement:o="bottom",strategy:l="absolute",arrowPadding:d=8,eventListeners:p=!0,offset:_,gutter:E=8,flip:b=!0,boundary:C="clippingParents",preventOverflow:I=!0,matchWidth:O,direction:L="ltr"}=n,V=D.useRef(null),B=D.useRef(null),W=D.useRef(null),Z=XLe(o,L),$=D.useRef(()=>{}),se=D.useCallback(()=>{var ie;!e||!V.current||!B.current||((ie=$.current)==null||ie.call($),W.current=ULe(V.current,B.current,{placement:Z,modifiers:[KLe,GLe,zLe,{...WLe,enabled:!!O},{name:"eventListeners",...BLe(p)},{name:"arrow",options:{padding:d}},{name:"offset",options:{offset:_??[0,E]}},{name:"flip",enabled:!!b,options:{padding:8}},{name:"preventOverflow",enabled:!!I,options:{boundary:C}},...i??[]],strategy:l}),W.current.forceUpdate(),$.current=W.current.destroy)},[Z,e,i,O,p,d,_,E,b,I,C,l]);D.useEffect(()=>()=>{var ie;!V.current&&!B.current&&((ie=W.current)==null||ie.destroy(),W.current=null)},[]);const ue=D.useCallback(ie=>{V.current=ie,se()},[se]),re=D.useCallback((ie={},me=null)=>({...ie,ref:Ui(ue,me)}),[ue]),pe=D.useCallback(ie=>{B.current=ie,se()},[se]),q=D.useCallback((ie={},me=null)=>({...ie,ref:Ui(pe,me),style:{...ie.style,position:l,minWidth:O?void 0:"max-content",inset:"0 auto auto 0"}}),[l,pe,O]),Q=D.useCallback((ie={},me=null)=>{const{size:de,shadowColor:le,bg:xe,style:We,...$e}=ie;return{...$e,ref:me,"data-popper-arrow":"",style:JLe(ie)}},[]),J=D.useCallback((ie={},me=null)=>({...ie,ref:me,"data-popper-arrow-inner":""}),[]);return{update(){var ie;(ie=W.current)==null||ie.update()},forceUpdate(){var ie;(ie=W.current)==null||ie.forceUpdate()},transformOrigin:ro.transformOrigin.varRef,referenceRef:ue,popperRef:pe,getPopperProps:q,getArrowProps:Q,getArrowInnerProps:J,getReferenceProps:re}}function JLe(n){const{size:e,shadowColor:i,bg:o,style:l}=n,d={...l,position:"absolute"};return e&&(d["--popper-arrow-size"]=e),i&&(d["--popper-arrow-shadow-color"]=i),o&&(d["--popper-arrow-bg"]=o),d}function QLe(){const n=D.useRef(new Map),e=n.current,i=D.useCallback((l,d,p,_)=>{n.current.set(p,{type:d,el:l,options:_}),l.addEventListener(d,p,_)},[]),o=D.useCallback((l,d,p,_)=>{l.removeEventListener(d,p,_),n.current.delete(p)},[]);return D.useEffect(()=>()=>{e.forEach((l,d)=>{o(l.el,l.type,d,l.options)})},[o,e]),{add:i,remove:o}}function hU(n){var l,d;const e=((d=(l=n.composedPath)==null?void 0:l.call(n))==null?void 0:d[0])??n.target,{tagName:i,isContentEditable:o}=e;return i!=="INPUT"&&i!=="TEXTAREA"&&o!==!0}function nre(n={}){const{ref:e,isDisabled:i,isFocusable:o,clickOnEnter:l=!0,clickOnSpace:d=!0,onMouseDown:p,onMouseUp:_,onClick:E,onKeyDown:b,onKeyUp:C,tabIndex:I,onMouseOver:O,onMouseLeave:L,...V}=n,[B,W]=D.useState(!0),[Z,$]=D.useState(!1),se=QLe(),ue=ve=>{ve&&ve.tagName!=="BUTTON"&&W(!1)},re=B?I:I||0,pe=i&&!o,q=D.useCallback(ve=>{if(i){ve.stopPropagation(),ve.preventDefault();return}ve.currentTarget.focus(),E==null||E(ve)},[i,E]),Q=D.useCallback(ve=>{Z&&hU(ve)&&(ve.preventDefault(),ve.stopPropagation(),$(!1),se.remove(document,"keyup",Q,!1))},[Z,se]),J=D.useCallback(ve=>{if(b==null||b(ve),i||ve.defaultPrevented||ve.metaKey||!hU(ve.nativeEvent)||B)return;const _e=l&&ve.key==="Enter";d&&ve.key===" "&&(ve.preventDefault(),$(!0)),_e&&(ve.preventDefault(),ve.currentTarget.click()),se.add(document,"keyup",Q,!1)},[i,B,b,l,d,se,Q]),ie=D.useCallback(ve=>{if(C==null||C(ve),i||ve.defaultPrevented||ve.metaKey||!hU(ve.nativeEvent)||B)return;d&&ve.key===" "&&(ve.preventDefault(),$(!1),ve.currentTarget.click())},[d,B,i,C]),me=D.useCallback(ve=>{ve.button===0&&($(!1),se.remove(document,"mouseup",me,!1))},[se]),de=D.useCallback(ve=>{if(ve.button!==0)return;if(i){ve.stopPropagation(),ve.preventDefault();return}B||$(!0),ve.currentTarget.focus({preventScroll:!0}),se.add(document,"mouseup",me,!1),p==null||p(ve)},[i,B,p,se,me]),le=D.useCallback(ve=>{ve.button===0&&(B||$(!1),_==null||_(ve))},[_,B]),xe=D.useCallback(ve=>{if(i){ve.preventDefault();return}O==null||O(ve)},[i,O]),We=D.useCallback(ve=>{Z&&(ve.preventDefault(),$(!1)),L==null||L(ve)},[Z,L]),$e=Ui(e,ue);return B?{...V,ref:$e,type:"button","aria-disabled":pe?void 0:i,disabled:pe,onClick:q,onMouseDown:p,onMouseUp:_,onKeyUp:C,onKeyDown:b,onMouseOver:O,onMouseLeave:L}:{...V,ref:$e,role:"button","data-active":Zn(Z),"aria-disabled":i?"true":void 0,tabIndex:pe?void 0:re,onClick:q,onMouseDown:de,onMouseUp:le,onKeyUp:ie,onKeyDown:J,onMouseOver:xe,onMouseLeave:We}}const[ZLe,e2e,t2e,n2e]=nne(),[r2e,uR]=Ni({strict:!1,name:"MenuContext"});function rre(n){return(n==null?void 0:n.ownerDocument)??document}function i2e(n){return rre(n).activeElement===n}function s2e(n={}){const{id:e,closeOnSelect:i=!0,closeOnBlur:o=!0,initialFocusRef:l,autoSelect:d=!0,isLazy:p,isOpen:_,defaultIsOpen:E,onClose:b,onOpen:C,placement:I="bottom-start",lazyBehavior:O="unmount",direction:L,computePositionOnMount:V=!1,...B}=n,W=D.useRef(null),Z=D.useRef(null),$=D.useRef(!0),se=t2e(),ue=D.useCallback(()=>{requestAnimationFrame(()=>{var Ie;(Ie=W.current)==null||Ie.focus({preventScroll:!1})})},[]),re=D.useCallback(()=>{const Ie=setTimeout(()=>{var Me,ze;if(l)(Me=l.current)==null||Me.focus();else if(!se.count())(ze=W.current)==null||ze.focus({preventScroll:!1});else{const Je=se.firstEnabled();Je&&xe(Je.index)}});Ee.current.add(Ie)},[se,l]),pe=D.useCallback(()=>{const Ie=setTimeout(()=>{var Me;if(!se.count())(Me=W.current)==null||Me.focus({preventScroll:!1});else{const ze=se.lastEnabled();ze&&xe(ze.index)}});Ee.current.add(Ie)},[se]),q=D.useCallback(()=>{C==null||C(),d?re():ue()},[d,re,ue,C]),{isOpen:Q,onOpen:J,onClose:ie,onToggle:me}=hf({isOpen:_,defaultIsOpen:E,onClose:b,onOpen:q});xZ({enabled:Q&&o,ref:W,handler:Ie=>{var ze,Je,tt;const Me=((Je=(ze=Ie.composedPath)==null?void 0:ze.call(Ie))==null?void 0:Je[0])??Ie.target;(tt=Z.current)!=null&&tt.contains(Me)||ie()}});const de=a4({...B,enabled:Q||V,placement:I,direction:L}),[le,xe]=D.useState(-1);kZ(W,{focusRef:Z,visible:Q,shouldFocus:!0});const We=AZ({isOpen:Q,ref:W}),[$e,ve]=uve(e,"menu-button","menu-list"),_e=D.useCallback(()=>{J(),ue()},[J,ue]),Ee=D.useRef(new Set([]));D.useEffect(()=>{const Ie=Ee.current;return()=>{Ie.forEach(Me=>clearTimeout(Me)),Ie.clear()}},[]),Fp(()=>{var Ie;Q||(xe(-1),(Ie=W.current)==null||Ie.scrollTo(0,0))},[Q]),Fp(()=>{Q&&le===-1&&ue()},[le,Q]),D.useEffect(()=>{var Me;if(!Q)return;const Ie=se.item(le);(Me=Ie==null?void 0:Ie.node)==null||Me.focus({preventScroll:!$.current})},[se,le,Q]);const ke=D.useCallback(()=>{J(),re()},[re,J]),we=D.useCallback(()=>{$.current=!0,J(),pe()},[J,pe]),be=D.useCallback(()=>{var tt,ut;const Ie=rre(W.current),Me=(tt=W.current)==null?void 0:tt.contains(Ie.activeElement);if(!(Q&&!Me))return;const Je=(ut=se.item(le))==null?void 0:ut.node;Je==null||Je.focus({preventScroll:!$.current})},[Q,le,se]);return{openAndFocusMenu:_e,openAndFocusFirstItem:ke,openAndFocusLastItem:we,onTransitionEnd:be,unstable__animationState:We,descendants:se,popper:de,buttonId:$e,menuId:ve,forceUpdate:de.forceUpdate,orientation:"vertical",isOpen:Q,onToggle:me,onOpen:J,onClose:ie,menuRef:W,buttonRef:Z,focusedIndex:le,closeOnSelect:i,closeOnBlur:o,autoSelect:d,setFocusedIndex:xe,isLazy:p,lazyBehavior:O,initialFocusRef:l,scrollIntoViewRef:$}}function o2e(n={},e=null){const i=uR(),{onToggle:o,popper:l,openAndFocusFirstItem:d,openAndFocusLastItem:p,scrollIntoViewRef:_}=i,E=D.useCallback(b=>{const C=b.key,O={Enter:d,ArrowDown:d,ArrowUp:p}[C];O&&(_.current=!0,b.preventDefault(),b.stopPropagation(),O(b))},[d,p,_]);return{...n,ref:Ui(i.buttonRef,e,l.referenceRef),id:i.buttonId,"data-active":Zn(i.isOpen),"aria-expanded":i.isOpen,"aria-haspopup":"menu","aria-controls":i.menuId,onClick:An(n.onClick,o),onKeyDown:An(n.onKeyDown,E)}}function xV(n){var e;return u2e(n)&&!!((e=n==null?void 0:n.getAttribute("role"))!=null&&e.startsWith("menuitem"))}function a2e(n={},e=null){const i=uR();if(!i)throw new Error("useMenuContext: context is undefined. Seems you forgot to wrap component within <Menu>");const{focusedIndex:o,setFocusedIndex:l,menuRef:d,isOpen:p,onClose:_,menuId:E,isLazy:b,lazyBehavior:C,scrollIntoViewRef:I,unstable__animationState:O}=i,L=e2e(),V=kxe({preventDefault:$=>$.key!==" "&&xV($.target)}),B=D.useCallback($=>{if(!$.currentTarget.contains($.target))return;const se=$.key,re={Tab:q=>q.preventDefault(),Escape:q=>{q.stopPropagation(),_()},ArrowDown:()=>{I.current=!0;const q=L.nextEnabled(o)??L.firstEnabled();q&&l(q.index)},ArrowUp:()=>{I.current=!0;const q=L.prevEnabled(o)??L.firstEnabled();q&&l(q.index)}}[se];if(re){$.preventDefault(),re($);return}const pe=V(q=>{const Q=Pxe(L.values(),q,J=>{var ie;return((ie=J==null?void 0:J.node)==null?void 0:ie.textContent)??""},L.item(o));if(Q){const J=L.indexOf(Q.node);l(J)}});xV($.target)&&pe($)},[L,o,V,_,l,I]),W=D.useRef(!1);p&&(W.current=!0);const Z=NF({wasSelected:W.current,enabled:b,mode:C,isSelected:O.present});return{...n,ref:Ui(d,e),children:Z?n.children:null,tabIndex:-1,role:"menu",id:E,style:{...n.style,transformOrigin:"var(--popper-transform-origin)"},"aria-orientation":"vertical",onKeyDown:An(n.onKeyDown,B)}}function c2e(n={}){const{popper:e,isOpen:i}=uR();return e.getPopperProps({...n,style:{visibility:i?"visible":"hidden",...n.style}})}function l2e(n={},e=null){const{onMouseEnter:i,onMouseMove:o,onMouseLeave:l,onClick:d,onFocus:p,isDisabled:_,isFocusable:E,closeOnSelect:b,type:C,...I}=n,O=uR(),{setFocusedIndex:L,focusedIndex:V,closeOnSelect:B,onClose:W,menuId:Z,scrollIntoViewRef:$}=O,se=D.useRef(null),ue=`${Z}-menuitem-${D.useId()}`,{index:re,register:pe}=n2e({disabled:_&&!E}),q=D.useCallback(xe=>{i==null||i(xe),!_&&($.current=!1,L(re))},[L,re,_,i,$]),Q=D.useCallback(xe=>{o==null||o(xe),se.current&&!i2e(se.current)&&q(xe)},[q,o]),J=D.useCallback(xe=>{l==null||l(xe),!_&&L(-1)},[L,_,l]),ie=D.useCallback(xe=>{d==null||d(xe),xV(xe.currentTarget)&&(b??B)&&W()},[W,d,B,b]),me=D.useCallback(xe=>{p==null||p(xe),L(re)},[L,p,re]),de=re===V,le=nre({onClick:ie,onFocus:me,onMouseEnter:q,onMouseMove:Q,onMouseLeave:J,ref:Ui(pe,se,e),isDisabled:_,isFocusable:E});return{...I,...le,type:C??le.type,id:ue,role:"menuitem",tabIndex:de?0:-1}}function u2e(n){if(!d2e(n))return!1;const e=n.ownerDocument.defaultView??window;return n instanceof e.HTMLElement}function d2e(n){return n!=null&&typeof n=="object"&&"nodeType"in n&&n.nodeType===Node.ELEMENT_NODE}const[h2e,H0]=Ni({name:"MenuStylesContext",errorMessage:`useMenuStyles returned is 'undefined'. Seems you forgot to wrap the components in "<Menu />" `}),dR=n=>{const{children:e}=n,i=nc("Menu",n),o=Vi(n),{direction:l}=z0(),{descendants:d,...p}=s2e({...o,direction:l}),_=D.useMemo(()=>p,[p]),{isOpen:E,onClose:b,forceUpdate:C}=_;return w.jsx(ZLe,{value:d,children:w.jsx(r2e,{value:_,children:w.jsx(h2e,{value:i,children:cl(e,{isOpen:E,onClose:b,forceUpdate:C})})})})};dR.displayName="Menu";const f2e=jt((n,e)=>{const i=H0();return w.jsx(Nt.button,{ref:e,...n,__css:{display:"inline-flex",appearance:"none",alignItems:"center",outline:0,...i.button}})}),hR=jt((n,e)=>{const{children:i,as:o,...l}=n,d=o2e(l,e),p=o||f2e;return w.jsx(p,{...d,className:hn("chakra-menu__menu-button",n.className),children:w.jsx(Nt.span,{__css:{pointerEvents:"none",flex:"1 1 auto",minW:0},children:n.children})})});hR.displayName="MenuButton";const ire=jt((n,e)=>{const i=H0();return w.jsx(Nt.span,{ref:e,...n,__css:i.command,className:"chakra-menu__command"})});ire.displayName="MenuCommand";const sre=n=>{const{className:e,...i}=n,o=H0();return w.jsx(Nt.hr,{"aria-orientation":"horizontal",className:hn("chakra-menu__divider",e),...i,__css:o.divider})};sre.displayName="MenuDivider";const ore=n=>{const{className:e,children:i,...o}=n,l=H0(),d=D.Children.only(i),p=D.isValidElement(d)?D.cloneElement(d,{focusable:"false","aria-hidden":!0,className:hn("chakra-menu__icon",d.props.className)}):null,_=hn("chakra-menu__icon-wrapper",e);return w.jsx(Nt.span,{className:_,...o,__css:l.icon,children:p})};ore.displayName="MenuIcon";const p2e=jt((n,e)=>{const{type:i,...o}=n,l=H0(),d=o.as||i?i??void 0:"button",p=D.useMemo(()=>({textDecoration:"none",color:"inherit",userSelect:"none",display:"flex",width:"100%",alignItems:"center",textAlign:"start",flex:"0 0 auto",outline:0,...l.item}),[l.item]);return w.jsx(Nt.button,{ref:e,type:d,...o,__css:p})}),Dd=jt((n,e)=>{const{icon:i,iconSpacing:o="0.75rem",command:l,commandSpacing:d="0.75rem",children:p,..._}=n,E=l2e(_,e),C=i||l?w.jsx("span",{style:{pointerEvents:"none",flex:1},children:p}):p;return w.jsxs(p2e,{...E,className:hn("chakra-menu__menuitem",E.className),children:[i&&w.jsx(ore,{fontSize:"0.8em",marginEnd:o,children:i}),C,l&&w.jsx(ire,{marginStart:d,children:l})]})});Dd.displayName="MenuItem";const m2e={enter:{visibility:"visible",opacity:1,scale:1,transition:{duration:.2,ease:[.4,0,.2,1]}},exit:{transitionEnd:{visibility:"hidden"},opacity:0,scale:.8,transition:{duration:.1,easings:"easeOut"}}},g2e=Nt(mf.div),fR=jt(function(e,i){var O;const{rootProps:o,motionProps:l,...d}=e,{isOpen:p,onTransitionEnd:_,unstable__animationState:E}=uR(),b=a2e(d,i),C=c2e(o),I=H0();return w.jsx(Nt.div,{...C,__css:{zIndex:e.zIndex??((O=I.list)==null?void 0:O.zIndex)},children:w.jsx(g2e,{variants:m2e,initial:!1,animate:p?"enter":"exit",__css:{outline:0,...I.list},...l,...b,className:hn("chakra-menu__menu-list",b.className),onUpdate:_,onAnimationComplete:bZ(E.onComplete,b.onAnimationComplete)})})});fR.displayName="MenuList";var _2e=function(n){if(typeof document>"u")return null;var e=Array.isArray(n)?n[0]:n;return e.ownerDocument.body},wS=new WeakMap,PO=new WeakMap,OO={},fU=0,are=function(n){return n&&(n.host||are(n.parentNode))},y2e=function(n,e){return e.map(function(i){if(n.contains(i))return i;var o=are(i);return o&&n.contains(o)?o:(console.error("aria-hidden",i,"in not contained inside",n,". Doing nothing"),null)}).filter(function(i){return!!i})},E2e=function(n,e,i,o){var l=y2e(e,Array.isArray(n)?n:[n]);OO[i]||(OO[i]=new WeakMap);var d=OO[i],p=[],_=new Set,E=new Set(l),b=function(I){!I||_.has(I)||(_.add(I),b(I.parentNode))};l.forEach(b);var C=function(I){!I||E.has(I)||Array.prototype.forEach.call(I.children,function(O){if(_.has(O))C(O);else try{var L=O.getAttribute(o),V=L!==null&&L!=="false",B=(wS.get(O)||0)+1,W=(d.get(O)||0)+1;wS.set(O,B),d.set(O,W),p.push(O),B===1&&V&&PO.set(O,!0),W===1&&O.setAttribute(i,"true"),V||O.setAttribute(o,"true")}catch(Z){console.error("aria-hidden: cannot operate on ",O,Z)}})};return C(e),_.clear(),fU++,function(){p.forEach(function(I){var O=wS.get(I)-1,L=d.get(I)-1;wS.set(I,O),d.set(I,L),O||(PO.has(I)||I.removeAttribute(o),PO.delete(I)),L||I.removeAttribute(i)}),fU--,fU||(wS=new WeakMap,wS=new WeakMap,PO=new WeakMap,OO={})}},v2e=function(n,e,i){i===void 0&&(i="data-aria-hidden");var o=Array.from(Array.isArray(n)?n:[n]),l=_2e(n);return l?(o.push.apply(o,Array.from(l.querySelectorAll("[aria-live]"))),E2e(o,l,i,"aria-hidden")):function(){return null}},S2e=Object.defineProperty,b2e=(n,e,i)=>e in n?S2e(n,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):n[e]=i,T2e=(n,e,i)=>(b2e(n,e+"",i),i);class w2e{constructor(){T2e(this,"modals"),this.modals=new Set}add(e){return this.modals.add(e),this.modals.size}remove(e){this.modals.delete(e)}isTopModal(e){if(!e)return!1;const i=Array.from(this.modals)[this.modals.size-1];return e===i}}const LV=new w2e;function cre(n,e){const[i,o]=D.useState(0);return D.useEffect(()=>{const l=n.current;if(l){if(e){const d=LV.add(l);o(d)}return()=>{LV.remove(l),o(0)}}},[e,n]),i}function C2e(n){const{isOpen:e,onClose:i,id:o,closeOnOverlayClick:l=!0,closeOnEsc:d=!0,useInert:p=!0,onOverlayClick:_,onEsc:E}=n,b=D.useRef(null),C=D.useRef(null),[I,O,L]=I2e(o,"chakra-modal","chakra-modal--header","chakra-modal--body");R2e(b,e&&p);const V=cre(b,e),B=D.useRef(null),W=D.useCallback(J=>{B.current=J.target},[]),Z=D.useCallback(J=>{J.key==="Escape"&&(J.stopPropagation(),d&&(i==null||i()),E==null||E())},[d,i,E]),[$,se]=D.useState(!1),[ue,re]=D.useState(!1),pe=D.useCallback((J={},ie=null)=>({role:"dialog",...J,ref:Ui(ie,b),id:I,tabIndex:-1,"aria-modal":!0,"aria-labelledby":$?O:void 0,"aria-describedby":ue?L:void 0,onClick:An(J.onClick,me=>me.stopPropagation())}),[L,ue,I,O,$]),q=D.useCallback(J=>{J.stopPropagation(),B.current===J.target&&LV.isTopModal(b.current)&&(l&&(i==null||i()),_==null||_())},[i,l,_]),Q=D.useCallback((J={},ie=null)=>({...J,ref:Ui(ie,C),onClick:An(J.onClick,q),onKeyDown:An(J.onKeyDown,Z),onMouseDown:An(J.onMouseDown,W)}),[Z,W,q]);return{isOpen:e,onClose:i,headerId:O,bodyId:L,setBodyMounted:re,setHeaderMounted:se,dialogRef:b,overlayRef:C,getDialogProps:pe,getDialogContainerProps:Q,index:V}}function R2e(n,e){const i=n.current;D.useEffect(()=>{if(!(!n.current||!e))return v2e(n.current)},[e,n,i])}function I2e(n,...e){const i=D.useId(),o=n||i;return D.useMemo(()=>e.map(l=>`${l}-${o}`),[o,e])}const[A2e,$0]=Ni({name:"ModalStylesContext",errorMessage:`useModalStyles returned is 'undefined'. Seems you forgot to wrap the components in "<Modal />" `}),[P2e,By]=Ni({strict:!0,name:"ModalContext",errorMessage:"useModalContext: `context` is undefined. Seems you forgot to wrap modal components in `<Modal />`"}),so=n=>{const e={scrollBehavior:"outside",autoFocus:!0,trapFocus:!0,returnFocusOnClose:!0,blockScrollOnMount:!0,allowPinchZoom:!1,preserveScrollBarGap:!0,motionPreset:"scale",...n,lockFocusAcrossFrames:n.lockFocusAcrossFrames||!0},{portalProps:i,children:o,autoFocus:l,trapFocus:d,initialFocusRef:p,finalFocusRef:_,returnFocusOnClose:E,blockScrollOnMount:b,allowPinchZoom:C,preserveScrollBarGap:I,motionPreset:O,lockFocusAcrossFrames:L,animatePresenceProps:V,onCloseComplete:B}=e,W=nc("Modal",e),$={...C2e(e),autoFocus:l,trapFocus:d,initialFocusRef:p,finalFocusRef:_,returnFocusOnClose:E,blockScrollOnMount:b,allowPinchZoom:C,preserveScrollBarGap:I,motionPreset:O,lockFocusAcrossFrames:L};return w.jsx(P2e,{value:$,children:w.jsx(A2e,{value:W,children:w.jsx(j0,{...V,onExitComplete:B,children:$.isOpen&&w.jsx($l,{...i,children:o})})})})};so.displayName="Modal";var hk="right-scroll-bar-position",fk="width-before-scroll-bar",O2e="with-scroll-bars-hidden",k2e="--removed-body-scroll-bar-size",lre=pne(),pU=function(){},K1=D.forwardRef(function(n,e){var i=D.useRef(null),o=D.useState({onScrollCapture:pU,onWheelCapture:pU,onTouchMoveCapture:pU}),l=o[0],d=o[1],p=n.forwardProps,_=n.children,E=n.className,b=n.removeScrollBar,C=n.enabled,I=n.shards,O=n.sideCar,L=n.noIsolation,V=n.inert,B=n.allowPinchZoom,W=n.as,Z=W===void 0?"div":W,$=n.gapMode,se=aR(n,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noIsolation","inert","allowPinchZoom","as","gapMode"]),ue=O,re=dne([i,e]),pe=$h($h({},se),l);return D.createElement(D.Fragment,null,C&&D.createElement(ue,{sideCar:lre,removeScrollBar:b,shards:I,noIsolation:L,inert:V,setCallbacks:d,allowPinchZoom:!!B,lockRef:i,gapMode:$}),p?D.cloneElement(D.Children.only(_),$h($h({},pe),{ref:re})):D.createElement(Z,$h({},pe,{className:E,ref:re}),_))});K1.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1};K1.classNames={fullWidth:fk,zeroRight:hk};var N2e=function(){if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function D2e(){if(!document)return null;var n=document.createElement("style");n.type="text/css";var e=N2e();return e&&n.setAttribute("nonce",e),n}function x2e(n,e){n.styleSheet?n.styleSheet.cssText=e:n.appendChild(document.createTextNode(e))}function L2e(n){var e=document.head||document.getElementsByTagName("head")[0];e.appendChild(n)}var M2e=function(){var n=0,e=null;return{add:function(i){n==0&&(e=D2e())&&(x2e(e,i),L2e(e)),n++},remove:function(){n--,!n&&e&&(e.parentNode&&e.parentNode.removeChild(e),e=null)}}},U2e=function(){var n=M2e();return function(e,i){D.useEffect(function(){return n.add(e),function(){n.remove()}},[e&&i])}},ure=function(){var n=U2e(),e=function(i){var o=i.styles,l=i.dynamic;return n(o,l),null};return e},V2e={left:0,top:0,right:0,gap:0},mU=function(n){return parseInt(n||"",10)||0},F2e=function(n){var e=window.getComputedStyle(document.body),i=e[n==="padding"?"paddingLeft":"marginLeft"],o=e[n==="padding"?"paddingTop":"marginTop"],l=e[n==="padding"?"paddingRight":"marginRight"];return[mU(i),mU(o),mU(l)]},j2e=function(n){if(n===void 0&&(n="margin"),typeof window>"u")return V2e;var e=F2e(n),i=document.documentElement.clientWidth,o=window.innerWidth;return{left:e[0],top:e[1],right:e[2],gap:Math.max(0,o-i+e[2]-e[0])}},B2e=ure(),s0="data-scroll-locked",W2e=function(n,e,i,o){var l=n.left,d=n.top,p=n.right,_=n.gap;return i===void 0&&(i="margin"),`
  .`.concat(O2e,` {
   overflow: hidden `).concat(o,`;
   padding-right: `).concat(_,"px ").concat(o,`;
  }
  body[`).concat(s0,`] {
    overflow: hidden `).concat(o,`;
    overscroll-behavior: contain;
    `).concat([e&&"position: relative ".concat(o,";"),i==="margin"&&`
    padding-left: `.concat(l,`px;
    padding-top: `).concat(d,`px;
    padding-right: `).concat(p,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(_,"px ").concat(o,`;
    `),i==="padding"&&"padding-right: ".concat(_,"px ").concat(o,";")].filter(Boolean).join(""),`
  }
  
  .`).concat(hk,` {
    right: `).concat(_,"px ").concat(o,`;
  }
  
  .`).concat(fk,` {
    margin-right: `).concat(_,"px ").concat(o,`;
  }
  
  .`).concat(hk," .").concat(hk,` {
    right: 0 `).concat(o,`;
  }
  
  .`).concat(fk," .").concat(fk,` {
    margin-right: 0 `).concat(o,`;
  }
  
  body[`).concat(s0,`] {
    `).concat(k2e,": ").concat(_,`px;
  }
`)},TX=function(){var n=parseInt(document.body.getAttribute(s0)||"0",10);return isFinite(n)?n:0},z2e=function(){D.useEffect(function(){return document.body.setAttribute(s0,(TX()+1).toString()),function(){var n=TX()-1;n<=0?document.body.removeAttribute(s0):document.body.setAttribute(s0,n.toString())}},[])},G2e=function(n){var e=n.noRelative,i=n.noImportant,o=n.gapMode,l=o===void 0?"margin":o;z2e();var d=D.useMemo(function(){return j2e(l)},[l]);return D.createElement(B2e,{styles:W2e(d,!e,l,i?"":"!important")})},MV=!1;if(typeof window<"u")try{var kO=Object.defineProperty({},"passive",{get:function(){return MV=!0,!0}});window.addEventListener("test",kO,kO),window.removeEventListener("test",kO,kO)}catch{MV=!1}var CS=MV?{passive:!1}:!1,H2e=function(n){return n.tagName==="TEXTAREA"},dre=function(n,e){if(!(n instanceof Element))return!1;var i=window.getComputedStyle(n);return i[e]!=="hidden"&&!(i.overflowY===i.overflowX&&!H2e(n)&&i[e]==="visible")},$2e=function(n){return dre(n,"overflowY")},K2e=function(n){return dre(n,"overflowX")},wX=function(n,e){var i=e.ownerDocument,o=e;do{typeof ShadowRoot<"u"&&o instanceof ShadowRoot&&(o=o.host);var l=hre(n,o);if(l){var d=fre(n,o),p=d[1],_=d[2];if(p>_)return!0}o=o.parentNode}while(o&&o!==i.body);return!1},q2e=function(n){var e=n.scrollTop,i=n.scrollHeight,o=n.clientHeight;return[e,i,o]},Y2e=function(n){var e=n.scrollLeft,i=n.scrollWidth,o=n.clientWidth;return[e,i,o]},hre=function(n,e){return n==="v"?$2e(e):K2e(e)},fre=function(n,e){return n==="v"?q2e(e):Y2e(e)},X2e=function(n,e){return n==="h"&&e==="rtl"?-1:1},J2e=function(n,e,i,o,l){var d=X2e(n,window.getComputedStyle(e).direction),p=d*o,_=i.target,E=e.contains(_),b=!1,C=p>0,I=0,O=0;do{var L=fre(n,_),V=L[0],B=L[1],W=L[2],Z=B-W-d*V;(V||Z)&&hre(n,_)&&(I+=Z,O+=V),_ instanceof ShadowRoot?_=_.host:_=_.parentNode}while(!E&&_!==document.body||E&&(e.contains(_)||e===_));return(C&&Math.abs(I)<1||!C&&Math.abs(O)<1)&&(b=!0),b},NO=function(n){return"changedTouches"in n?[n.changedTouches[0].clientX,n.changedTouches[0].clientY]:[0,0]},CX=function(n){return[n.deltaX,n.deltaY]},RX=function(n){return n&&"current"in n?n.current:n},Q2e=function(n,e){return n[0]===e[0]&&n[1]===e[1]},Z2e=function(n){return`
  .block-interactivity-`.concat(n,` {pointer-events: none;}
  .allow-interactivity-`).concat(n,` {pointer-events: all;}
`)},eMe=0,RS=[];function tMe(n){var e=D.useRef([]),i=D.useRef([0,0]),o=D.useRef(),l=D.useState(eMe++)[0],d=D.useState(ure)[0],p=D.useRef(n);D.useEffect(function(){p.current=n},[n]),D.useEffect(function(){if(n.inert){document.body.classList.add("block-interactivity-".concat(l));var B=aDe([n.lockRef.current],(n.shards||[]).map(RX),!0).filter(Boolean);return B.forEach(function(W){return W.classList.add("allow-interactivity-".concat(l))}),function(){document.body.classList.remove("block-interactivity-".concat(l)),B.forEach(function(W){return W.classList.remove("allow-interactivity-".concat(l))})}}},[n.inert,n.lockRef.current,n.shards]);var _=D.useCallback(function(B,W){if("touches"in B&&B.touches.length===2||B.type==="wheel"&&B.ctrlKey)return!p.current.allowPinchZoom;var Z=NO(B),$=i.current,se="deltaX"in B?B.deltaX:$[0]-Z[0],ue="deltaY"in B?B.deltaY:$[1]-Z[1],re,pe=B.target,q=Math.abs(se)>Math.abs(ue)?"h":"v";if("touches"in B&&q==="h"&&pe.type==="range")return!1;var Q=wX(q,pe);if(!Q)return!0;if(Q?re=q:(re=q==="v"?"h":"v",Q=wX(q,pe)),!Q)return!1;if(!o.current&&"changedTouches"in B&&(se||ue)&&(o.current=re),!re)return!0;var J=o.current||re;return J2e(J,W,B,J==="h"?se:ue)},[]),E=D.useCallback(function(B){var W=B;if(!(!RS.length||RS[RS.length-1]!==d)){var Z="deltaY"in W?CX(W):NO(W),$=e.current.filter(function(re){return re.name===W.type&&(re.target===W.target||W.target===re.shadowParent)&&Q2e(re.delta,Z)})[0];if($&&$.should){W.cancelable&&W.preventDefault();return}if(!$){var se=(p.current.shards||[]).map(RX).filter(Boolean).filter(function(re){return re.contains(W.target)}),ue=se.length>0?_(W,se[0]):!p.current.noIsolation;ue&&W.cancelable&&W.preventDefault()}}},[]),b=D.useCallback(function(B,W,Z,$){var se={name:B,delta:W,target:Z,should:$,shadowParent:nMe(Z)};e.current.push(se),setTimeout(function(){e.current=e.current.filter(function(ue){return ue!==se})},1)},[]),C=D.useCallback(function(B){i.current=NO(B),o.current=void 0},[]),I=D.useCallback(function(B){b(B.type,CX(B),B.target,_(B,n.lockRef.current))},[]),O=D.useCallback(function(B){b(B.type,NO(B),B.target,_(B,n.lockRef.current))},[]);D.useEffect(function(){return RS.push(d),n.setCallbacks({onScrollCapture:I,onWheelCapture:I,onTouchMoveCapture:O}),document.addEventListener("wheel",E,CS),document.addEventListener("touchmove",E,CS),document.addEventListener("touchstart",C,CS),function(){RS=RS.filter(function(B){return B!==d}),document.removeEventListener("wheel",E,CS),document.removeEventListener("touchmove",E,CS),document.removeEventListener("touchstart",C,CS)}},[]);var L=n.removeScrollBar,V=n.inert;return D.createElement(D.Fragment,null,V?D.createElement(d,{styles:Z2e(l)}):null,L?D.createElement(G2e,{gapMode:n.gapMode}):null)}function nMe(n){for(var e=null;n!==null;)n instanceof ShadowRoot&&(e=n.host,n=n.host),n=n.parentNode;return e}const rMe=cDe(lre,tMe);var pre=D.forwardRef(function(n,e){return D.createElement(K1,$h({},n,{ref:e,sideCar:rMe}))});pre.classNames=K1.classNames;function iMe(n){const{autoFocus:e,trapFocus:i,dialogRef:o,initialFocusRef:l,blockScrollOnMount:d,allowPinchZoom:p,finalFocusRef:_,returnFocusOnClose:E,preserveScrollBarGap:b,lockFocusAcrossFrames:C,isOpen:I}=By(),[O,L]=tj();D.useEffect(()=>{!O&&L&&setTimeout(L)},[O,L]);const V=cre(o,I);return w.jsx(Bne,{autoFocus:e,isDisabled:!i,initialFocusRef:l,finalFocusRef:_,restoreFocus:E,contentRef:o,lockFocusAcrossFrames:C,children:w.jsx(pre,{removeScrollBar:!b,allowPinchZoom:p,enabled:V===1&&d,forwardProps:!0,children:n.children})})}const sMe={initial:({offsetX:n,offsetY:e,transition:i,transitionEnd:o,delay:l})=>({opacity:0,x:n,y:e,transition:(i==null?void 0:i.exit)??Ny.exit(ky.exit,l),transitionEnd:o==null?void 0:o.exit}),enter:({transition:n,transitionEnd:e,delay:i})=>({opacity:1,x:0,y:0,transition:(n==null?void 0:n.enter)??Ny.enter(ky.enter,i),transitionEnd:e==null?void 0:e.enter}),exit:({offsetY:n,offsetX:e,transition:i,transitionEnd:o,reverse:l,delay:d})=>{const p={x:e,y:n};return{opacity:0,transition:(i==null?void 0:i.exit)??Ny.exit(ky.exit,d),...l?{...p,transitionEnd:o==null?void 0:o.exit}:{transitionEnd:{...p,...o==null?void 0:o.exit}}}}},$w={initial:"initial",animate:"enter",exit:"exit",variants:sMe},oMe=D.forwardRef(function(e,i){const{unmountOnExit:o,in:l,reverse:d=!0,className:p,offsetX:_=0,offsetY:E=8,transition:b,transitionEnd:C,delay:I,animatePresenceProps:O,...L}=e,V=o?l&&o:!0,B=l||o?"enter":"exit",W={offsetX:_,offsetY:E,reverse:d,transition:b,transitionEnd:C,delay:I};return w.jsx(j0,{...O,custom:W,children:V&&w.jsx(mf.div,{ref:i,className:hn("chakra-offset-slide",p),custom:W,...$w,animate:B,...L})})});oMe.displayName="SlideFade";const aMe={exit:({reverse:n,initialScale:e,transition:i,transitionEnd:o,delay:l})=>({opacity:0,...n?{scale:e,transitionEnd:o==null?void 0:o.exit}:{transitionEnd:{scale:e,...o==null?void 0:o.exit}},transition:(i==null?void 0:i.exit)??Ny.exit(ky.exit,l)}),enter:({transitionEnd:n,transition:e,delay:i})=>({opacity:1,scale:1,transition:(e==null?void 0:e.enter)??Ny.enter(ky.enter,i),transitionEnd:n==null?void 0:n.enter})},mre={initial:"exit",animate:"enter",exit:"exit",variants:aMe},cMe=D.forwardRef(function(e,i){const{unmountOnExit:o,in:l,reverse:d=!0,initialScale:p=.95,className:_,transition:E,transitionEnd:b,delay:C,animatePresenceProps:I,...O}=e,L=o?l&&o:!0,V=l||o?"enter":"exit",B={initialScale:p,reverse:d,transition:E,transitionEnd:b,delay:C};return w.jsx(j0,{...I,custom:B,children:L&&w.jsx(mf.div,{ref:i,className:hn("chakra-offset-slide",_),...mre,animate:V,custom:B,...O})})});cMe.displayName="ScaleFade";const lMe={slideInBottom:{...$w,custom:{offsetY:16,reverse:!0}},slideInRight:{...$w,custom:{offsetX:16,reverse:!0}},slideInTop:{...$w,custom:{offsetY:-16,reverse:!0}},slideInLeft:{...$w,custom:{offsetX:-16,reverse:!0}},scale:{...mre,custom:{initialScale:.95,reverse:!0}},none:{}},uMe=Nt(mf.section),dMe=n=>lMe[n||"none"],gre=D.forwardRef((n,e)=>{const{preset:i,motionProps:o=dMe(i),...l}=n;return w.jsx(uMe,{ref:e,...o,...l})});gre.displayName="ModalTransition";const oo=jt((n,e)=>{const{className:i,children:o,containerProps:l,motionProps:d,...p}=n,{getDialogProps:_,getDialogContainerProps:E}=By(),b=_(p,e),C=E(l),I=hn("chakra-modal__content",i),O=$0(),L={display:"flex",flexDirection:"column",position:"relative",width:"100%",outline:0,...O.dialog},V={display:"flex",width:"100vw",height:"$100vh",position:"fixed",left:0,top:0,...O.dialogContainer},{motionPreset:B}=By();return w.jsx(iMe,{children:w.jsx(Nt.div,{...C,className:"chakra-modal__content-container",tabIndex:-1,__css:V,children:w.jsx(gre,{preset:B,motionProps:d,className:I,...b,__css:L,children:o})})})});oo.displayName="ModalContent";const wo=jt((n,e)=>{const{className:i,...o}=n,{bodyId:l,setBodyMounted:d}=By();D.useEffect(()=>(d(!0),()=>d(!1)),[d]);const p=hn("chakra-modal__body",i),_=$0();return w.jsx(Nt.div,{ref:e,className:p,id:l,...o,__css:_.body})});wo.displayName="ModalBody";const zo=jt((n,e)=>{const{onClick:i,className:o,...l}=n,{onClose:d}=By(),p=hn("chakra-modal__close-btn",o),_=$0();return w.jsx(Lj,{ref:e,__css:_.closeButton,className:p,onClick:An(i,E=>{E.stopPropagation(),d()}),...l})});zo.displayName="ModalCloseButton";const zp=jt((n,e)=>{const{className:i,...o}=n,l=hn("chakra-modal__footer",i),d=$0(),p={display:"flex",alignItems:"center",justifyContent:"flex-end",...d.footer};return w.jsx(Nt.footer,{ref:e,...o,__css:p,className:l})});zp.displayName="ModalFooter";const ec=jt((n,e)=>{const{className:i,...o}=n,{headerId:l,setHeaderMounted:d}=By();D.useEffect(()=>(d(!0),()=>d(!1)),[d]);const p=hn("chakra-modal__header",i),_=$0(),E={flex:0,..._.header};return w.jsx(Nt.header,{ref:e,className:p,id:l,...o,__css:E})});ec.displayName="ModalHeader";const hMe={enter:({transition:n,transitionEnd:e,delay:i}={})=>({opacity:1,transition:(n==null?void 0:n.enter)??Ny.enter(ky.enter,i),transitionEnd:e==null?void 0:e.enter}),exit:({transition:n,transitionEnd:e,delay:i}={})=>({opacity:0,transition:(n==null?void 0:n.exit)??Ny.exit(ky.exit,i),transitionEnd:e==null?void 0:e.exit})},_re={initial:"exit",animate:"enter",exit:"exit",variants:hMe},fMe=D.forwardRef(function(e,i){const{unmountOnExit:o,in:l,className:d,transition:p,transitionEnd:_,delay:E,animatePresenceProps:b,...C}=e,I=l||o?"enter":"exit",O=o?l&&o:!0,L={transition:p,transitionEnd:_,delay:E};return w.jsx(j0,{...b,custom:L,children:O&&w.jsx(mf.div,{ref:i,className:hn("chakra-fade",d),custom:L,..._re,animate:I,...C})})});fMe.displayName="Fade";const pMe=Nt(mf.div),ao=jt((n,e)=>{const{className:i,transition:o,motionProps:l,...d}=n,p=hn("chakra-modal__overlay",i),E={pos:"fixed",left:"0",top:"0",w:"100vw",h:"100vh",...$0().overlay},{motionPreset:b}=By(),I=l||(b==="none"?{}:_re);return w.jsx(pMe,{...I,__css:E,ref:e,className:p,...d})});ao.displayName="ModalOverlay";function mMe(n){const{leastDestructiveRef:e,...i}=n;return w.jsx(so,{...i,initialFocusRef:e})}const gMe=jt((n,e)=>w.jsx(oo,{ref:e,role:"alertdialog",...n})),_Me=n=>w.jsx(In,{viewBox:"0 0 24 24",...n,children:w.jsx("path",{fill:"currentColor",d:"M21,5H3C2.621,5,2.275,5.214,2.105,5.553C1.937,5.892,1.973,6.297,2.2,6.6l9,12 c0.188,0.252,0.485,0.4,0.8,0.4s0.611-0.148,0.8-0.4l9-12c0.228-0.303,0.264-0.708,0.095-1.047C21.725,5.214,21.379,5,21,5z"})}),yMe=n=>w.jsx(In,{viewBox:"0 0 24 24",...n,children:w.jsx("path",{fill:"currentColor",d:"M12.8,5.4c-0.377-0.504-1.223-0.504-1.6,0l-9,12c-0.228,0.303-0.264,0.708-0.095,1.047 C2.275,18.786,2.621,19,3,19h18c0.379,0,0.725-0.214,0.895-0.553c0.169-0.339,0.133-0.744-0.095-1.047L12.8,5.4z"})});function IX(n,e,i,o){D.useEffect(()=>{if(!n.current||!o)return;const l=n.current.ownerDocument.defaultView??window,d=Array.isArray(e)?e:[e],p=new l.MutationObserver(_=>{for(const E of _)E.type==="attributes"&&E.attributeName&&d.includes(E.attributeName)&&i(E)});return p.observe(n.current,{attributes:!0,attributeFilter:d}),()=>p.disconnect()})}const EMe=50,AX=300;function vMe(n,e){const[i,o]=D.useState(!1),[l,d]=D.useState(null),[p,_]=D.useState(!0),E=D.useRef(null),b=()=>clearTimeout(E.current);dve(()=>{l==="increment"&&n(),l==="decrement"&&e()},i?EMe:null);const C=D.useCallback(()=>{p&&n(),E.current=setTimeout(()=>{_(!1),o(!0),d("increment")},AX)},[n,p]),I=D.useCallback(()=>{p&&e(),E.current=setTimeout(()=>{_(!1),o(!0),d("decrement")},AX)},[e,p]),O=D.useCallback(()=>{_(!0),o(!1),b()},[]);return D.useEffect(()=>()=>b(),[]),{up:C,down:I,stop:O,isSpinning:i}}const SMe=/^[Ee0-9+\-.]$/;function bMe(n){return SMe.test(n)}function TMe(n,e){if(n.key==null)return!0;const i=n.ctrlKey||n.altKey||n.metaKey;return!(n.key.length===1)||i?!0:e(n.key)}function wMe(n={}){const{focusInputOnChange:e=!0,clampValueOnBlur:i=!0,keepWithinRange:o=!0,min:l=Number.MIN_SAFE_INTEGER,max:d=Number.MAX_SAFE_INTEGER,step:p=1,isReadOnly:_,isDisabled:E,isRequired:b,isInvalid:C,pattern:I="[0-9]*(.[0-9]+)?",inputMode:O="decimal",allowMouseWheel:L,id:V,onChange:B,precision:W,name:Z,"aria-describedby":$,"aria-label":se,"aria-labelledby":ue,onFocus:re,onBlur:pe,onInvalid:q,getAriaValueText:Q,isValidCharacter:J,format:ie,parse:me,...de}=n,le=Ks(re),xe=Ks(pe),We=Ks(q),$e=Ks(J??bMe),ve=Ks(Q),_e=JEe(n),{update:Ee,increment:ke,decrement:we}=_e,[be,Ie]=D.useState(!1),Me=!(_||E),ze=D.useRef(null),Je=D.useRef(null),tt=D.useRef(null),ut=D.useRef(null),Ze=D.useCallback(wt=>wt.split("").filter($e).join(""),[$e]),bt=D.useCallback(wt=>(me==null?void 0:me(wt))??wt,[me]),on=D.useCallback(wt=>((ie==null?void 0:ie(wt))??wt).toString(),[ie]);Fp(()=>{(_e.valueAsNumber>d||_e.valueAsNumber<l)&&(We==null||We("rangeOverflow",on(_e.value),_e.valueAsNumber))},[_e.valueAsNumber,_e.value,on,We]),Qh(()=>{if(!ze.current)return;if(ze.current.value!=_e.value){const lr=bt(ze.current.value);_e.setValue(Ze(lr))}},[bt,Ze]);const Mt=D.useCallback((wt=p)=>{Me&&ke(wt)},[ke,Me,p]),Zt=D.useCallback((wt=p)=>{Me&&we(wt)},[we,Me,p]),an=vMe(Mt,Zt);IX(tt,"disabled",an.stop,an.isSpinning),IX(ut,"disabled",an.stop,an.isSpinning);const Ht=D.useCallback(wt=>{if(wt.nativeEvent.isComposing)return;const Dt=bt(wt.currentTarget.value);Ee(Ze(Dt)),Je.current={start:wt.currentTarget.selectionStart,end:wt.currentTarget.selectionEnd}},[Ee,Ze,bt]),jn=D.useCallback(wt=>{var lr;le==null||le(wt),Je.current&&(wt.currentTarget.selectionStart=Je.current.start??((lr=wt.currentTarget.value)==null?void 0:lr.length),wt.currentTarget.selectionEnd=Je.current.end??wt.currentTarget.selectionStart)},[le]),Wt=D.useCallback(wt=>{if(wt.nativeEvent.isComposing)return;TMe(wt,$e)||wt.preventDefault();const lr=Re(wt)*p,Dt=wt.key,Qr={ArrowUp:()=>Mt(lr),ArrowDown:()=>Zt(lr),Home:()=>Ee(l),End:()=>Ee(d)}[Dt];Qr&&(wt.preventDefault(),Qr(wt))},[$e,p,Mt,Zt,Ee,l,d]),Re=wt=>{let lr=1;return(wt.metaKey||wt.ctrlKey)&&(lr=.1),wt.shiftKey&&(lr=10),lr},Fe=D.useMemo(()=>{const wt=ve==null?void 0:ve(_e.value);if(wt!=null)return wt;const lr=_e.value.toString();return lr||void 0},[_e.value,ve]),Ge=D.useCallback(()=>{let wt=_e.value;if(_e.value==="")return;/^[eE]/.test(_e.value.toString())?_e.setValue(""):(_e.valueAsNumber<l&&(wt=l),_e.valueAsNumber>d&&(wt=d),_e.cast(wt))},[_e,d,l]),at=D.useCallback(()=>{Ie(!1),i&&Ge()},[i,Ie,Ge]),yt=D.useCallback(()=>{e&&requestAnimationFrame(()=>{var wt;(wt=ze.current)==null||wt.focus()})},[e]),vt=D.useCallback(wt=>{wt.preventDefault(),an.up(),yt()},[yt,an]),Gt=D.useCallback(wt=>{wt.preventDefault(),an.down(),yt()},[yt,an]);Ry(()=>ze.current,"wheel",wt=>{var Hi;const Dt=(((Hi=ze.current)==null?void 0:Hi.ownerDocument)??document).activeElement===ze.current;if(!L||!Dt)return;wt.preventDefault();const qt=Re(wt)*p,Qr=Math.sign(wt.deltaY);Qr===-1?Mt(qt):Qr===1&&Zt(qt)},{passive:!1});const gn=D.useCallback((wt={},lr=null)=>{const Dt=E||o&&_e.isAtMax;return{...wt,ref:Ui(lr,tt),role:"button",tabIndex:-1,onPointerDown:An(wt.onPointerDown,qt=>{qt.button!==0||Dt||vt(qt)}),onPointerLeave:An(wt.onPointerLeave,an.stop),onPointerUp:An(wt.onPointerUp,an.stop),disabled:Dt,"aria-disabled":Np(Dt)}},[_e.isAtMax,o,vt,an.stop,E]),Pn=D.useCallback((wt={},lr=null)=>{const Dt=E||o&&_e.isAtMin;return{...wt,ref:Ui(lr,ut),role:"button",tabIndex:-1,onPointerDown:An(wt.onPointerDown,qt=>{qt.button!==0||Dt||Gt(qt)}),onPointerLeave:An(wt.onPointerLeave,an.stop),onPointerUp:An(wt.onPointerUp,an.stop),disabled:Dt,"aria-disabled":Np(Dt)}},[_e.isAtMin,o,Gt,an.stop,E]),un=D.useCallback((wt={},lr=null)=>({name:Z,inputMode:O,type:"text",pattern:I,"aria-labelledby":ue,"aria-label":se,"aria-describedby":$,id:V,disabled:E,role:"spinbutton",...wt,readOnly:wt.readOnly??_,"aria-readonly":wt.readOnly??_,"aria-required":wt.required??b,required:wt.required??b,ref:Ui(ze,lr),value:on(_e.value),"aria-valuemin":l,"aria-valuemax":d,"aria-valuenow":Number.isNaN(_e.valueAsNumber)?void 0:_e.valueAsNumber,"aria-invalid":Np(C??_e.isOutOfRange),"aria-valuetext":Fe,autoComplete:"off",autoCorrect:"off",onChange:An(wt.onChange,Ht),onKeyDown:An(wt.onKeyDown,Wt),onFocus:An(wt.onFocus,jn,()=>Ie(!0)),onBlur:An(wt.onBlur,xe,at)}),[Z,O,I,ue,se,on,$,V,E,b,_,C,_e.value,_e.valueAsNumber,_e.isOutOfRange,l,d,Fe,Ht,Wt,jn,xe,at]);return{value:on(_e.value),valueAsNumber:_e.valueAsNumber,isFocused:be,isDisabled:E,isReadOnly:_,getIncrementButtonProps:gn,getDecrementButtonProps:Pn,getInputProps:un,htmlProps:de}}const[CMe,q1]=Ni({name:"NumberInputStylesContext",errorMessage:`useNumberInputStyles returned is 'undefined'. Seems you forgot to wrap the components in "<NumberInput />" `}),[RMe,c4]=Ni({name:"NumberInputContext",errorMessage:"useNumberInputContext: `context` is undefined. Seems you forgot to wrap number-input's components within <NumberInput />"}),pk=jt(function(e,i){const o=nc("NumberInput",e),l=Vi(e),d=Fj(l),{htmlProps:p,..._}=wMe(d),E=D.useMemo(()=>_,[_]);return w.jsx(RMe,{value:E,children:w.jsx(CMe,{value:o,children:w.jsx(Nt.div,{...p,ref:i,className:hn("chakra-numberinput",e.className),__css:{position:"relative",zIndex:0,...o.root}})})})});pk.displayName="NumberInput";const mk=jt(function(e,i){const o=q1();return w.jsx(Nt.div,{"aria-hidden":!0,ref:i,...e,__css:{display:"flex",flexDirection:"column",position:"absolute",top:"0",insetEnd:"0px",margin:"1px",height:"calc(100% - 2px)",zIndex:1,...o.stepperGroup}})});mk.displayName="NumberInputStepper";const gk=jt(function(e,i){const{getInputProps:o}=c4(),l=o(e,i),d=q1();return w.jsx(Nt.input,{...l,className:hn("chakra-numberinput__field",e.className),__css:{width:"100%",...d.field}})});gk.displayName="NumberInputField";const yre=Nt("div",{baseStyle:{display:"flex",justifyContent:"center",alignItems:"center",flex:1,transitionProperty:"common",transitionDuration:"normal",userSelect:"none",cursor:"pointer",lineHeight:"normal"}}),_k=jt(function(e,i){const o=q1(),{getDecrementButtonProps:l}=c4(),d=l(e,i);return w.jsx(yre,{...d,__css:o.stepper,children:e.children??w.jsx(_Me,{})})});_k.displayName="NumberDecrementStepper";const yk=jt(function(e,i){const{getIncrementButtonProps:o}=c4(),l=o(e,i),d=q1();return w.jsx(yre,{...l,__css:d.stepper,children:e.children??w.jsx(yMe,{})})});yk.displayName="NumberIncrementStepper";const[IMe,Y1]=Ni({name:"PopoverContext",errorMessage:"usePopoverContext: `context` is undefined. Seems you forgot to wrap all popover components within `<Popover />`"}),[AMe,Ere]=Ni({name:"PopoverStylesContext",errorMessage:`usePopoverStyles returned is 'undefined'. Seems you forgot to wrap the components in "<Popover />" `}),IS={click:"click",hover:"hover"};function PMe(n={}){const{closeOnBlur:e=!0,closeOnEsc:i=!0,initialFocusRef:o,id:l,returnFocusOnClose:d=!0,autoFocus:p=!0,arrowSize:_,arrowShadowColor:E,trigger:b=IS.click,openDelay:C=200,closeDelay:I=200,isLazy:O,lazyBehavior:L="unmount",computePositionOnMount:V,...B}=n,{isOpen:W,onClose:Z,onOpen:$,onToggle:se}=hf(n),[ue,re]=D.useState(d);D.useEffect(()=>re(d),[d]);const pe=D.useRef(null),q=D.useRef(null),Q=D.useRef(null),J=D.useRef(!1),ie=D.useRef(!1);W&&(ie.current=!0);const[me,de]=D.useState(!1),[le,xe]=D.useState(!1),We=D.useId(),$e=l??We,[ve,_e,Ee,ke]=["popover-trigger","popover-content","popover-header","popover-body"].map(Wt=>`${Wt}-${$e}`),{referenceRef:we,getArrowProps:be,getPopperProps:Ie,getArrowInnerProps:Me,forceUpdate:ze}=a4({...B,enabled:W||!!V}),Je=AZ({isOpen:W,ref:Q});cve({enabled:W,ref:q}),kZ(Q,{focusRef:q,visible:W,shouldFocus:ue&&b===IS.click}),eve(Q,{focusRef:o,visible:W,shouldFocus:p&&b===IS.click}),xZ({enabled:W&&e,ref:Q,handler(Wt){var Fe;const Re=((Fe=Wt.composedPath)==null?void 0:Fe.call(Wt)[0])??[Wt.target];DO(q.current,Re)||(Re&&re(!xk(Re)),Z())}});const tt=NF({wasSelected:ie.current,enabled:O,mode:L,isSelected:Je.present}),ut=D.useCallback((Wt={},Re=null)=>{const Fe={...Wt,style:{...Wt.style,transformOrigin:ro.transformOrigin.varRef,[ro.arrowSize.var]:_?`${_}px`:void 0,[ro.arrowShadowColor.var]:E},ref:Ui(Q,Re),children:tt?Wt.children:null,id:_e,tabIndex:-1,role:"dialog",onKeyDown:An(Wt.onKeyDown,Ge=>{Ge.nativeEvent.isComposing||i&&Ge.key==="Escape"&&(Ge.preventDefault(),Ge.stopPropagation(),Z())}),onBlur:An(Wt.onBlur,Ge=>{const at=PX(Ge),yt=DO(Q.current,at),vt=DO(q.current,at),Gt=!yt&&!vt;at&&re(!xk(at)),W&&e&&Gt&&Z()}),"aria-labelledby":me?Ee:void 0,"aria-describedby":le?ke:void 0};return b===IS.hover&&(Fe.role="tooltip",Fe.onMouseEnter=An(Wt.onMouseEnter,()=>{J.current=!0}),Fe.onMouseLeave=An(Wt.onMouseLeave,Ge=>{Ge.nativeEvent.relatedTarget!==null&&(J.current=!1,setTimeout(()=>Z(),I))})),Fe},[tt,_e,me,Ee,le,ke,b,i,Z,W,e,I,E,_]),Ze=D.useCallback((Wt={},Re=null)=>Ie({...Wt,style:{visibility:W?"visible":"hidden",...Wt.style}},Re),[W,Ie]),bt=D.useCallback((Wt,Re=null)=>({...Wt,ref:Ui(Re,pe,we)}),[pe,we]),on=D.useRef(void 0),Mt=D.useRef(void 0),Zt=D.useCallback(Wt=>{pe.current==null&&we(Wt)},[we]),an=D.useCallback((Wt={},Re=null)=>{const Fe={...Wt,ref:Ui(q,Re,Zt),id:ve,"aria-haspopup":"dialog","aria-expanded":W,"aria-controls":_e};return b===IS.click&&(Fe.onClick=An(Wt.onClick,se)),b===IS.hover&&(Fe.onFocus=An(Wt.onFocus,()=>{on.current===void 0&&$()}),Fe.onBlur=An(Wt.onBlur,Ge=>{const at=PX(Ge),yt=!DO(Q.current,at);W&&e&&yt&&Z()}),Fe.onKeyDown=An(Wt.onKeyDown,Ge=>{Ge.key==="Escape"&&Z()}),Fe.onMouseEnter=An(Wt.onMouseEnter,()=>{J.current=!0,on.current=window.setTimeout(()=>$(),C)}),Fe.onMouseLeave=An(Wt.onMouseLeave,()=>{J.current=!1,on.current&&(clearTimeout(on.current),on.current=void 0),Mt.current=window.setTimeout(()=>{J.current===!1&&Z()},I)})),Fe},[ve,W,_e,b,Zt,se,$,e,Z,C,I]);D.useEffect(()=>()=>{on.current&&clearTimeout(on.current),Mt.current&&clearTimeout(Mt.current)},[]);const Ht=D.useCallback((Wt={},Re=null)=>({...Wt,id:Ee,ref:Ui(Re,Fe=>{de(!!Fe)})}),[Ee]),jn=D.useCallback((Wt={},Re=null)=>({...Wt,id:ke,ref:Ui(Re,Fe=>{xe(!!Fe)})}),[ke]);return{forceUpdate:ze,isOpen:W,onAnimationComplete:Je.onComplete,onClose:Z,getAnchorProps:bt,getArrowProps:be,getArrowInnerProps:Me,getPopoverPositionerProps:Ze,getPopoverProps:ut,getTriggerProps:an,getHeaderProps:Ht,getBodyProps:jn}}function DO(n,e){return n===e||(n==null?void 0:n.contains(e))}function PX(n){const e=n.currentTarget.ownerDocument.activeElement;return n.relatedTarget??e}function vre(n){const e=nc("Popover",n),{children:i,...o}=Vi(n),l=z0(),d=PMe({...o,direction:l.direction});return w.jsx(IMe,{value:d,children:w.jsx(AMe,{value:e,children:cl(i,{isOpen:d.isOpen,onClose:d.onClose,forceUpdate:d.forceUpdate})})})}vre.displayName="Popover";function Sre(n){var i;const e=D.version;return typeof e!="string"||e.startsWith("18.")?n==null?void 0:n.ref:(i=n==null?void 0:n.props)==null?void 0:i.ref}const bre=jt(function(e,i){const{getBodyProps:o}=Y1(),l=Ere();return w.jsx(Nt.div,{...o(e,i),className:hn("chakra-popover__body",e.className),__css:l.body})});bre.displayName="PopoverBody";function OMe(n){if(n)return{enter:{...n.enter,visibility:"visible"},exit:{...n.exit,transitionEnd:{visibility:"hidden"}}}}const kMe={exit:{opacity:0,scale:.95,transition:{duration:.1,ease:[.4,0,1,1]}},enter:{scale:1,opacity:1,transition:{duration:.15,ease:[0,0,.2,1]}}},NMe=Nt(mf.section),Tre=jt(function(e,i){const{variants:o=kMe,...l}=e,{isOpen:d}=Y1();return w.jsx(NMe,{ref:i,variants:OMe(o),initial:!1,animate:d?"enter":"exit",...l})});Tre.displayName="PopoverTransition";const wre=jt(function(e,i){const{rootProps:o,motionProps:l,...d}=e,{getPopoverProps:p,getPopoverPositionerProps:_,onAnimationComplete:E}=Y1(),b=Ere(),C={position:"relative",display:"flex",flexDirection:"column",...b.content};return w.jsx(Nt.div,{..._(o),__css:b.popper,className:"chakra-popover__popper",children:w.jsx(Tre,{...l,...p(d,i),onAnimationComplete:bZ(E,d.onAnimationComplete),className:hn("chakra-popover__content",e.className),__css:C})})});wre.displayName="PopoverContent";function Cre(n){const e=D.Children.only(n.children),{getTriggerProps:i}=Y1();return w.jsx(w.Fragment,{children:D.cloneElement(e,i(e.props,Sre(e)))})}Cre.displayName="PopoverTrigger";function DMe(n,e,i){return(n-e)*100/(i-e)}eR({"0%":{strokeDasharray:"1, 400",strokeDashoffset:"0"},"50%":{strokeDasharray:"400, 400",strokeDashoffset:"-100"},"100%":{strokeDasharray:"400, 400",strokeDashoffset:"-260"}});eR({"0%":{transform:"rotate(0deg)"},"100%":{transform:"rotate(360deg)"}});const xMe=eR({"0%":{left:"-40%"},"100%":{left:"100%"}}),LMe=eR({from:{backgroundPosition:"1rem 0"},to:{backgroundPosition:"0 0"}});function MMe(n){const{value:e=0,min:i,max:o,valueText:l,getValueText:d,isIndeterminate:p,role:_="progressbar"}=n,E=DMe(e,i,o);return{bind:{"data-indeterminate":p?"":void 0,"aria-valuemax":o,"aria-valuemin":i,"aria-valuenow":p?void 0:e,"aria-valuetext":(()=>{if(e!=null)return typeof d=="function"?d(e,E):l})(),role:_},percent:E,value:e}}const[UMe,VMe]=Ni({name:"ProgressStylesContext",errorMessage:`useProgressStyles returned is 'undefined'. Seems you forgot to wrap the components in "<Progress />" `}),FMe=jt((n,e)=>{const{min:i,max:o,value:l,isIndeterminate:d,role:p,..._}=n,E=MMe({value:l,min:i,max:o,isIndeterminate:d,role:p}),C={height:"100%",...VMe().filledTrack};return w.jsx(Nt.div,{ref:e,style:{width:`${E.percent}%`,..._.style},...E.bind,..._,__css:C})}),C0=jt((n,e)=>{var q;const{value:i,min:o=0,max:l=100,hasStripe:d,isAnimated:p,children:_,borderRadius:E,isIndeterminate:b,"aria-label":C,"aria-labelledby":I,"aria-valuetext":O,title:L,role:V,...B}=Vi(n),W=nc("Progress",n),Z=E??((q=W.track)==null?void 0:q.borderRadius),$={animation:`${LMe} 1s linear infinite`},re={...!b&&d&&p&&$,...b&&{position:"absolute",willChange:"left",minWidth:"50%",animation:`${xMe} 1s ease infinite normal none running`}},pe={overflow:"hidden",position:"relative",...W.track};return w.jsx(Nt.div,{ref:e,borderRadius:Z,__css:pe,...B,children:w.jsxs(UMe,{value:W,children:[w.jsx(FMe,{"aria-label":C,"aria-labelledby":I,"aria-valuetext":O,min:o,max:l,value:i,isIndeterminate:b,css:re,borderRadius:Z,title:L,role:V}),_]})})});C0.displayName="Progress";const Rre=jt(function(e,i){const{children:o,placeholder:l,className:d,...p}=e;return w.jsxs(Nt.select,{...p,ref:i,className:hn("chakra-select",d),children:[l&&w.jsx("option",{value:"",children:l}),o]})});Rre.displayName="SelectField";const Ire=jt((n,e)=>{var se;const i=nc("Select",n),{rootProps:o,placeholder:l,icon:d,color:p,height:_,h:E,minH:b,minHeight:C,iconColor:I,iconSize:O,...L}=Vi(n),[V,B]=GEe(L,lSe),W=Vj(B),Z={width:"100%",height:"fit-content",position:"relative",color:p},$={paddingEnd:"2rem",...i.field,_focus:{zIndex:"unset",...(se=i.field)==null?void 0:se._focus}};return w.jsxs(Nt.div,{className:"chakra-select__wrapper",__css:Z,...V,...o,children:[w.jsx(Rre,{ref:e,height:E??_,minH:b??C,placeholder:l,...W,__css:$,children:n.children}),w.jsx(Are,{"data-disabled":Zn(W.disabled),...(I||p)&&{color:I||p},__css:i.icon,...O&&{fontSize:O},children:d})]})});Ire.displayName="Select";const jMe=n=>w.jsx("svg",{viewBox:"0 0 24 24",...n,children:w.jsx("path",{fill:"currentColor",d:"M16.59 8.59L12 13.17 7.41 8.59 6 10l6 6 6-6z"})}),BMe=Nt("div",{baseStyle:{position:"absolute",display:"inline-flex",alignItems:"center",justifyContent:"center",pointerEvents:"none",top:"50%",transform:"translateY(-50%)"}}),Are=n=>{const{children:e=w.jsx(jMe,{}),...i}=n,o=D.cloneElement(e,{role:"presentation",className:"chakra-select__icon",focusable:!1,"aria-hidden":!0,style:{width:"1em",height:"1em",color:"currentColor"}});return w.jsx(BMe,{...i,className:"chakra-select__icon-wrapper",children:D.isValidElement(e)?o:null})};Are.displayName="SelectIcon";function gU(n){const{orientation:e,vertical:i,horizontal:o}=n;return e==="vertical"?i:o}function WMe(n){const{orientation:e,thumbPercents:i,isReversed:o}=n,l=L=>({position:"absolute",userSelect:"none",WebkitUserSelect:"none",MozUserSelect:"none",msUserSelect:"none",touchAction:"none",...gU({orientation:e,vertical:{bottom:`calc(${i[L]}% - var(--slider-thumb-size) / 2)`},horizontal:{left:`calc(${i[L]}% - var(--slider-thumb-size) / 2)`}})}),d={position:"relative",touchAction:"none",WebkitTapHighlightColor:"rgba(0,0,0,0)",userSelect:"none",outline:0},p={position:"absolute",...gU({orientation:e,vertical:{left:"50%",transform:"translateX(-50%)",height:"100%"},horizontal:{top:"50%",transform:"translateY(-50%)",width:"100%"}})},_=i.length===1,E=[0,o?100-i[0]:i[0]],b=_?E:i;let C=b[0];!_&&o&&(C=100-C);const I=Math.abs(b[b.length-1]-b[0]),O={...p,...gU({orientation:e,vertical:o?{height:`${I}%`,top:`${C}%`}:{height:`${I}%`,bottom:`${C}%`},horizontal:o?{width:`${I}%`,right:`${C}%`}:{width:`${I}%`,left:`${C}%`}})};return{trackStyle:p,innerTrackStyle:O,rootStyle:d,getThumbStyle:l}}function zMe(n){const{isReversed:e,direction:i,orientation:o}=n;return i==="ltr"||o==="vertical"?e:!e}function GMe(n){const{min:e=0,max:i=100,onChange:o,value:l,defaultValue:d,isReversed:p,direction:_="ltr",orientation:E="horizontal",id:b,isDisabled:C,isReadOnly:I,onChangeStart:O,onChangeEnd:L,step:V=1,getAriaValueText:B,"aria-valuetext":W,"aria-label":Z,"aria-labelledby":$,name:se,focusThumbOnChange:ue=!0,...re}=n,pe=Ks(O),q=Ks(L),Q=Ks(B),J=zMe({isReversed:p,direction:_,orientation:E}),[ie,me]=PZ({value:l,defaultValue:d??$Me(e,i),onChange:o}),[de,le]=D.useState(!1),[xe,We]=D.useState(!1),$e=!(C||I),ve=(i-e)/10,_e=V||(i-e)/100,Ee=YO(ie,e,i),ke=i-Ee+e,be=LK(J?ke:Ee,e,i),Ie=E==="vertical",Me=DZ({min:e,max:i,step:V,isDisabled:C,value:Ee,isInteractive:$e,isReversed:J,isVertical:Ie,eventSource:null,focusThumbOnChange:ue,orientation:E}),ze=D.useRef(null),Je=D.useRef(null),tt=D.useRef(null),ut=D.useId(),Ze=b??ut,[bt,on]=[`slider-thumb-${Ze}`,`slider-track-${Ze}`],Mt=D.useCallback(Dt=>{var Fi;if(!ze.current)return;const qt=Me.current;qt.eventSource="pointer";const Qr=ze.current.getBoundingClientRect(),{clientX:Hi,clientY:Vs}=((Fi=Dt.touches)==null?void 0:Fi[0])??Dt,ai=Ie?Qr.bottom-Vs:Hi-Qr.left,Ot=Ie?Qr.height:Qr.width;let On=ai/Ot;J&&(On=1-On);let or=jEe(On,qt.min,qt.max);return qt.step&&(or=parseFloat(MK(or,qt.min,qt.step))),or=YO(or,qt.min,qt.max),or},[Ie,J,Me]),Zt=D.useCallback(Dt=>{const qt=Me.current;qt.isInteractive&&(Dt=parseFloat(MK(Dt,qt.min,_e)),Dt=YO(Dt,qt.min,qt.max),me(Dt))},[_e,me,Me]),an=D.useMemo(()=>({stepUp(Dt=_e){const qt=J?Ee-Dt:Ee+Dt;Zt(qt)},stepDown(Dt=_e){const qt=J?Ee+Dt:Ee-Dt;Zt(qt)},reset(){Zt(d||0)},stepTo(Dt){Zt(Dt)}}),[Zt,J,Ee,_e,d]),Ht=D.useCallback(Dt=>{const qt=Me.current,Hi={ArrowRight:()=>an.stepUp(),ArrowUp:()=>an.stepUp(),ArrowLeft:()=>an.stepDown(),ArrowDown:()=>an.stepDown(),PageUp:()=>an.stepUp(ve),PageDown:()=>an.stepDown(ve),Home:()=>Zt(qt.min),End:()=>Zt(qt.max)}[Dt.key];Hi&&(Dt.preventDefault(),Dt.stopPropagation(),Hi(Dt),qt.eventSource="keyboard")},[an,Zt,ve,Me]),jn=(Q==null?void 0:Q(Ee))??W,{getThumbStyle:Wt,rootStyle:Re,trackStyle:Fe,innerTrackStyle:Ge}=D.useMemo(()=>{const Dt=Me.current;return WMe({isReversed:J,orientation:Dt.orientation,thumbPercents:[be]})},[J,be,Me]),at=D.useCallback(()=>{Me.current.focusThumbOnChange&&setTimeout(()=>{var qt;return(qt=Je.current)==null?void 0:qt.focus()})},[Me]);Fp(()=>{const Dt=Me.current;at(),Dt.eventSource==="keyboard"&&(q==null||q(Dt.value))},[Ee,q]);function yt(Dt){const qt=Mt(Dt);qt!=null&&qt!==Me.current.value&&me(qt)}Pve(tt,{onPanSessionStart(Dt){const qt=Me.current;qt.isInteractive&&(le(!0),at(),yt(Dt),pe==null||pe(qt.value))},onPanSessionEnd(){const Dt=Me.current;Dt.isInteractive&&(le(!1),q==null||q(Dt.value))},onPan(Dt){Me.current.isInteractive&&yt(Dt)}});const vt=D.useCallback((Dt={},qt=null)=>({...Dt,...re,ref:Ui(qt,tt),tabIndex:-1,"aria-disabled":Np(C),"data-focused":Zn(xe),style:{...Dt.style,...Re}}),[re,C,xe,Re]),Gt=D.useCallback((Dt={},qt=null)=>({...Dt,ref:Ui(qt,ze),id:on,"data-disabled":Zn(C),style:{...Dt.style,...Fe}}),[C,on,Fe]),gn=D.useCallback((Dt={},qt=null)=>({...Dt,ref:qt,style:{...Dt.style,...Ge}}),[Ge]),Pn=D.useCallback((Dt={},qt=null)=>({...Dt,ref:Ui(qt,Je),role:"slider",tabIndex:$e?0:void 0,id:bt,"data-active":Zn(de),"aria-valuetext":jn,"aria-valuemin":e,"aria-valuemax":i,"aria-valuenow":Ee,"aria-orientation":E,"aria-disabled":Np(C),"aria-readonly":Np(I),"aria-label":Z,"aria-labelledby":Z?void 0:$,style:{...Dt.style,...Wt(0)},onKeyDown:An(Dt.onKeyDown,Ht),onFocus:An(Dt.onFocus,()=>We(!0)),onBlur:An(Dt.onBlur,()=>We(!1))}),[$e,bt,de,jn,e,i,Ee,E,C,I,Z,$,Wt,Ht]),un=D.useCallback((Dt,qt=null)=>{const Qr=!(Dt.value<e||Dt.value>i),Hi=Ee>=Dt.value,Vs=LK(Dt.value,e,i),ai={position:"absolute",pointerEvents:"none",...HMe({orientation:E,vertical:{bottom:J?`${100-Vs}%`:`${Vs}%`},horizontal:{left:J?`${100-Vs}%`:`${Vs}%`}})};return{...Dt,ref:qt,role:"presentation","aria-hidden":!0,"data-disabled":Zn(C),"data-invalid":Zn(!Qr),"data-highlighted":Zn(Hi),style:{...Dt.style,...ai}}},[C,J,i,e,E,Ee]),wt=D.useCallback((Dt={},qt=null)=>({...Dt,ref:qt,type:"hidden",value:Ee,name:se}),[se,Ee]);return{state:{value:Ee,isFocused:xe,isDragging:de},actions:an,getRootProps:vt,getTrackProps:Gt,getInnerTrackProps:gn,getThumbProps:Pn,getMarkerProps:un,getInputProps:wt}}function HMe(n){const{orientation:e,vertical:i,horizontal:o}=n;return e==="vertical"?i:o}function $Me(n,e){return e<n?n:n+(e-n)/2}const[KMe,X1]=Ni({name:"SliderContext",hookName:"useSliderContext",providerName:"<Slider />"}),[qMe,J1]=Ni({name:"SliderStylesContext",hookName:"useSliderStyles",providerName:"<Slider />"}),UV=jt((n,e)=>{const i={...n,orientation:(n==null?void 0:n.orientation)??"horizontal"},o=nc("Slider",i),l=Vi(i),{direction:d}=z0();l.direction=d;const{getInputProps:p,getRootProps:_,...E}=GMe(l),b=_(),C=p({},e);return w.jsx(KMe,{value:E,children:w.jsx(qMe,{value:o,children:w.jsxs(Nt.div,{...b,className:hn("chakra-slider",i.className),__css:o.container,children:[i.children,w.jsx("input",{...C})]})})})});UV.displayName="Slider";const VV=jt((n,e)=>{const{getThumbProps:i}=X1(),o=J1(),l=i(n,e);return w.jsx(Nt.div,{...l,className:hn("chakra-slider__thumb",n.className),__css:o.thumb})});VV.displayName="SliderThumb";const FV=jt((n,e)=>{const{getTrackProps:i}=X1(),o=J1(),l=i(n,e);return w.jsx(Nt.div,{...l,className:hn("chakra-slider__track",n.className),__css:o.track})});FV.displayName="SliderTrack";const jV=jt((n,e)=>{const{getInnerTrackProps:i}=X1(),o=J1(),l=i(n,e);return w.jsx(Nt.div,{...l,className:hn("chakra-slider__filled-track",n.className),__css:o.filledTrack})});jV.displayName="SliderFilledTrack";const YMe=jt((n,e)=>{const{getMarkerProps:i}=X1(),o=J1(),l=i(n,e);return w.jsx(Nt.div,{...l,className:hn("chakra-slider__marker",n.className),__css:o.mark})});YMe.displayName="SliderMark";const Yk=Nt("div",{baseStyle:{flex:1,justifySelf:"stretch",alignSelf:"stretch"}});Yk.displayName="Spacer";const Pre=n=>w.jsx(Nt.div,{className:"chakra-stack__item",...n,__css:{display:"inline-block",flex:"0 0 auto",minWidth:0,...n.__css}});Pre.displayName="StackItem";function XMe(n){const{spacing:e,direction:i}=n,o={column:{my:e,mx:0,borderLeftWidth:0,borderBottomWidth:"1px"},"column-reverse":{my:e,mx:0,borderLeftWidth:0,borderBottomWidth:"1px"},row:{mx:e,my:0,borderLeftWidth:"1px",borderBottomWidth:0},"row-reverse":{mx:e,my:0,borderLeftWidth:"1px",borderBottomWidth:0}};return{"&":I1(i,l=>o[l])}}const l4=jt((n,e)=>{const{isInline:i,direction:o,align:l,justify:d,spacing:p="0.5rem",wrap:_,children:E,divider:b,className:C,shouldWrapChildren:I,...O}=n,L=i?"row":o??"column",V=D.useMemo(()=>XMe({spacing:p,direction:L}),[p,L]),B=!!b,W=!I&&!B,Z=D.useMemo(()=>{const se=kF(E);return W?se:se.map((ue,re)=>{const pe=typeof ue.key<"u"?ue.key:re,q=re+1===se.length,J=I?w.jsx(Pre,{children:ue},pe):ue;if(!B)return J;const ie=D.cloneElement(b,{__css:V}),me=q?null:ie;return w.jsxs(D.Fragment,{children:[J,me]},pe)})},[b,V,B,W,I,E]),$=hn("chakra-stack",C);return w.jsx(Nt.div,{ref:e,display:"flex",alignItems:l,justifyContent:d,flexDirection:L,flexWrap:_,gap:B?void 0:p,className:$,...O,children:Z})});l4.displayName="Stack";const wi=jt((n,e)=>w.jsx(l4,{align:"center",...n,direction:"row",ref:e}));wi.displayName="HStack";const Jr=jt((n,e)=>w.jsx(l4,{align:"center",...n,direction:"column",ref:e}));Jr.displayName="VStack";const of=jt(function(e,i){const o=nc("Switch",e),{spacing:l="0.5rem",children:d,...p}=Vi(e),{getIndicatorProps:_,getInputProps:E,getCheckboxProps:b,getRootProps:C,getLabelProps:I}=YNe(p),O=D.useMemo(()=>({display:"inline-block",position:"relative",verticalAlign:"middle",lineHeight:0,...o.container}),[o.container]),L=D.useMemo(()=>({display:"inline-flex",flexShrink:0,justifyContent:"flex-start",boxSizing:"content-box",cursor:"pointer",...o.track}),[o.track]),V=D.useMemo(()=>({userSelect:"none",marginStart:l,...o.label}),[l,o.label]);return w.jsxs(Nt.label,{...C(),className:hn("chakra-switch",e.className),__css:O,children:[w.jsx("input",{className:"chakra-switch__input",...E({},i)}),w.jsx(Nt.span,{...b(),className:"chakra-switch__track",__css:L,children:w.jsx(Nt.span,{__css:o.thumb,className:"chakra-switch__thumb",..._()})}),d&&w.jsx(Nt.span,{className:"chakra-switch__label",...I(),__css:V,children:d})]})});of.displayName="Switch";const[JMe,QMe,ZMe,eUe]=nne();function tUe(n){const{defaultIndex:e,onChange:i,index:o,isManual:l,isLazy:d,lazyBehavior:p="unmount",orientation:_="horizontal",direction:E="ltr",...b}=n,[C,I]=D.useState(e??0),[O,L]=PZ({defaultValue:e??0,value:o,onChange:i});D.useEffect(()=>{o!=null&&I(o)},[o]);const V=ZMe(),B=D.useId();return{id:`tabs-${n.id??B}`,selectedIndex:O,focusedIndex:C,setSelectedIndex:L,setFocusedIndex:I,isManual:l,isLazy:d,lazyBehavior:p,orientation:_,descendants:V,direction:E,htmlProps:b}}const[nUe,Q1]=Ni({name:"TabsContext",errorMessage:"useTabsContext: `context` is undefined. Seems you forgot to wrap all tabs components within <Tabs />"});function rUe(n){const{focusedIndex:e,orientation:i,direction:o}=Q1(),l=QMe(),d=D.useCallback(p=>{const _=()=>{var se;const $=l.nextEnabled(e);$&&((se=$.node)==null||se.focus())},E=()=>{var se;const $=l.prevEnabled(e);$&&((se=$.node)==null||se.focus())},b=()=>{var se;const $=l.firstEnabled();$&&((se=$.node)==null||se.focus())},C=()=>{var se;const $=l.lastEnabled();$&&((se=$.node)==null||se.focus())},I=i==="horizontal",O=i==="vertical",L=p.key,V=o==="ltr"?"ArrowLeft":"ArrowRight",B=o==="ltr"?"ArrowRight":"ArrowLeft",Z={[V]:()=>I&&E(),[B]:()=>I&&_(),ArrowDown:()=>O&&_(),ArrowUp:()=>O&&E(),Home:b,End:C}[L];Z&&(p.preventDefault(),Z(p))},[l,e,i,o]);return{...n,role:"tablist","aria-orientation":i,onKeyDown:An(n.onKeyDown,d)}}function iUe(n){const{isDisabled:e=!1,isFocusable:i=!1,...o}=n,{setSelectedIndex:l,isManual:d,id:p,setFocusedIndex:_,selectedIndex:E}=Q1(),{index:b,register:C}=eUe({disabled:e&&!i}),I=b===E,O=()=>{l(b)},L=()=>{_(b),!d&&!(e&&i)&&l(b)};return{...nre({...o,ref:Ui(C,n.ref),isDisabled:e,isFocusable:i,onClick:An(n.onClick,O)}),id:Ore(p,b),role:"tab",tabIndex:I?0:-1,type:"button","aria-selected":I,"aria-controls":kre(p,b),onFocus:e?void 0:An(n.onFocus,L)}}const[sUe,oUe]=Ni({});function aUe(n){const e=Q1(),{id:i,selectedIndex:o}=e,d=kF(n.children).map((p,_)=>D.createElement(sUe,{key:p.key??_,value:{isSelected:_===o,id:kre(i,_),tabId:Ore(i,_),selectedIndex:o}},p));return{...n,children:d}}function cUe(n){const{children:e,...i}=n,{isLazy:o,lazyBehavior:l}=Q1(),{isSelected:d,id:p,tabId:_}=oUe(),E=D.useRef(!1);d&&(E.current=!0);const b=NF({wasSelected:E.current,isSelected:d,enabled:o,mode:l});return{tabIndex:0,...i,children:b?e:null,role:"tabpanel","aria-labelledby":_,hidden:!d,id:p}}function Ore(n,e){return`${n}--tab-${e}`}function kre(n,e){return`${n}--tabpanel-${e}`}const[lUe,Z1]=Ni({name:"TabsStylesContext",errorMessage:`useTabsStyles returned is 'undefined'. Seems you forgot to wrap the components in "<Tabs />" `}),pR=jt(function(e,i){const o=nc("Tabs",e),{children:l,className:d,...p}=Vi(e),{htmlProps:_,descendants:E,...b}=tUe(p),C=D.useMemo(()=>b,[b]),{isFitted:I,...O}=_,L={position:"relative",...o.root};return w.jsx(JMe,{value:E,children:w.jsx(nUe,{value:C,children:w.jsx(lUe,{value:o,children:w.jsx(Nt.div,{className:hn("chakra-tabs",d),ref:i,...O,__css:L,children:l})})})})});pR.displayName="Tabs";const Sc=jt(function(e,i){const o=Z1(),l=iUe({...e,ref:i}),d={outline:"0",display:"flex",alignItems:"center",justifyContent:"center",...o.tab};return w.jsx(Nt.button,{...l,className:hn("chakra-tabs__tab",e.className),__css:d})});Sc.displayName="Tab";const mR=jt(function(e,i){const o=rUe({...e,ref:i}),l=Z1(),d={display:"flex",...l.tablist};return w.jsx(Nt.div,{...o,className:hn("chakra-tabs__tablist",e.className),__css:d})});mR.displayName="TabList";const xl=jt(function(e,i){const o=cUe({...e,ref:i}),l=Z1();return w.jsx(Nt.div,{outline:"0",...o,className:hn("chakra-tabs__tab-panel",e.className),__css:l.tabpanel})});xl.displayName="TabPanel";const eN=jt(function(e,i){const o=aUe(e),l=Z1();return w.jsx(Nt.div,{...o,width:"100%",ref:i,className:hn("chakra-tabs__tab-panels",e.className),__css:l.tabpanels})});eN.displayName="TabPanels";const[uUe,Nre]=Ni({name:"TagStylesContext",errorMessage:`useTagStyles returned is 'undefined'. Seems you forgot to wrap the components in "<Tag />" `}),Dre=jt((n,e)=>{const i=nc("Tag",n),o=Vi(n),l={display:"inline-flex",verticalAlign:"top",alignItems:"center",maxWidth:"100%",...i.container};return w.jsx(uUe,{value:i,children:w.jsx(Nt.span,{ref:e,...o,__css:l})})});Dre.displayName="Tag";const xre=jt((n,e)=>{const i=Nre();return w.jsx(Nt.span,{ref:e,noOfLines:1,...n,__css:i.label})});xre.displayName="TagLabel";const dUe=jt((n,e)=>w.jsx(In,{ref:e,verticalAlign:"top",marginEnd:"0.5rem",...n}));dUe.displayName="TagLeftIcon";const hUe=jt((n,e)=>w.jsx(In,{ref:e,verticalAlign:"top",marginStart:"0.5rem",...n}));hUe.displayName="TagRightIcon";const Lre=n=>w.jsx(In,{verticalAlign:"inherit",viewBox:"0 0 512 512",...n,children:w.jsx("path",{fill:"currentColor",d:"M289.94 256l95-95A24 24 0 00351 127l-95 95-95-95a24 24 0 00-34 34l95 95-95 95a24 24 0 1034 34l95-95 95 95a24 24 0 0034-34z"})});Lre.displayName="TagCloseIcon";const Mre=jt((n,e)=>{const{isDisabled:i,children:o,...l}=n,p={display:"flex",alignItems:"center",justifyContent:"center",outline:"0",...Nre().closeButton};return w.jsx(Nt.button,{ref:e,"aria-label":"close",...l,type:"button",disabled:i,__css:p,children:o||w.jsx(Lre,{})})});Mre.displayName="TagCloseButton";const fUe=["h","minH","height","minHeight"],Ure=jt((n,e)=>{const i=Hl("Textarea",n),{className:o,rows:l,...d}=Vi(n),p=Vj(d),_=l?V0(i,fUe):i;return w.jsx(Nt.textarea,{ref:e,rows:l,...p,className:hn("chakra-textarea",o),__css:_})});Ure.displayName="Textarea";function pUe(n,e){const i=n??"bottom",l={"top-start":{ltr:"top-left",rtl:"top-right"},"top-end":{ltr:"top-right",rtl:"top-left"},"bottom-start":{ltr:"bottom-left",rtl:"bottom-right"},"bottom-end":{ltr:"bottom-right",rtl:"bottom-left"}}[i];return(l==null?void 0:l[e])??i}function mUe(n,e){const i=l=>({...e,...l,position:pUe((l==null?void 0:l.position)??(e==null?void 0:e.position),n)}),o=l=>{const d=i(l),p=Zte(d);return Hh.notify(p,d)};return o.update=(l,d)=>{Hh.update(l,i(d))},o.promise=(l,d)=>{const p=o({...d.loading,status:"loading",duration:null});l.then(_=>o.update(p,{status:"success",duration:5e3,...cl(d.success,_)})).catch(_=>o.update(p,{status:"error",duration:5e3,...cl(d.error,_)}))},o.closeAll=Hh.closeAll,o.close=Hh.close,o.isActive=Hh.isActive,o}function wc(n){const{theme:e}=Xte(),i=SNe();return D.useMemo(()=>mUe(e.direction,{...i,...n}),[n,e.direction,i])}const gUe={exit:{scale:.85,opacity:0,transition:{opacity:{duration:.15,easings:"easeInOut"},scale:{duration:.2,easings:"easeInOut"}}},enter:{scale:1,opacity:1,transition:{opacity:{easings:"easeOut",duration:.2},scale:{duration:.2,ease:[.175,.885,.4,1.1]}}}},BV=n=>{var e;return((e=n.current)==null?void 0:e.ownerDocument)||document},Ek=n=>{var e,i;return((i=(e=n.current)==null?void 0:e.ownerDocument)==null?void 0:i.defaultView)||window};function _Ue(n={}){const{openDelay:e=0,closeDelay:i=0,closeOnClick:o=!0,closeOnMouseDown:l,closeOnScroll:d,closeOnPointerDown:p=l,closeOnEsc:_=!0,onOpen:E,onClose:b,placement:C,id:I,isOpen:O,defaultIsOpen:L,arrowSize:V=10,arrowShadowColor:B,arrowPadding:W,modifiers:Z,isDisabled:$,gutter:se,offset:ue,direction:re,...pe}=n,{isOpen:q,onOpen:Q,onClose:J}=hf({isOpen:O,defaultIsOpen:L,onOpen:E,onClose:b}),{referenceRef:ie,getPopperProps:me,getArrowInnerProps:de,getArrowProps:le}=a4({enabled:q,placement:C,arrowPadding:W,modifiers:Z,gutter:se,offset:ue,direction:re}),xe=D.useId(),$e=`tooltip-${I??xe}`,ve=D.useRef(null),_e=D.useRef(void 0),Ee=D.useCallback(()=>{_e.current&&(clearTimeout(_e.current),_e.current=void 0)},[]),ke=D.useRef(void 0),we=D.useCallback(()=>{ke.current&&(clearTimeout(ke.current),ke.current=void 0)},[]),be=D.useCallback(()=>{we(),J()},[J,we]),Ie=yUe(ve,be),Me=D.useCallback(()=>{if(!$&&!_e.current){q&&Ie();const Mt=Ek(ve);_e.current=Mt.setTimeout(Q,e)}},[Ie,$,q,Q,e]),ze=D.useCallback(()=>{Ee();const Mt=Ek(ve);ke.current=Mt.setTimeout(be,i)},[i,be,Ee]),Je=D.useCallback(()=>{q&&o&&ze()},[o,ze,q]),tt=D.useCallback(()=>{q&&p&&ze()},[p,ze,q]),ut=D.useCallback(Mt=>{q&&Mt.key==="Escape"&&ze()},[q,ze]);Ry(()=>BV(ve),"keydown",_?ut:void 0),Ry(()=>{if(!d)return null;const Mt=ve.current;if(!Mt)return null;const Zt=IZ(Mt);return Zt.localName==="body"?Ek(ve):Zt},"scroll",()=>{q&&d&&be()},{passive:!0,capture:!0}),D.useEffect(()=>{$&&(Ee(),q&&J())},[$,q,J,Ee]),D.useEffect(()=>()=>{Ee(),we()},[Ee,we]),Ry(()=>ve.current,"pointerleave",ze);const Ze=D.useCallback((Mt={},Zt=null)=>({...Mt,ref:Ui(ve,Zt,ie),onPointerEnter:An(Mt.onPointerEnter,Ht=>{Ht.pointerType!=="touch"&&Me()}),onClick:An(Mt.onClick,Je),onPointerDown:An(Mt.onPointerDown,tt),onFocus:An(Mt.onFocus,Me),onBlur:An(Mt.onBlur,ze),"aria-describedby":q?$e:void 0}),[Me,ze,tt,q,$e,Je,ie]),bt=D.useCallback((Mt={},Zt=null)=>me({...Mt,style:{...Mt.style,[ro.arrowSize.var]:V?`${V}px`:void 0,[ro.arrowShadowColor.var]:B}},Zt),[me,V,B]),on=D.useCallback((Mt={},Zt=null)=>{const an={...Mt.style,position:"relative",transformOrigin:ro.transformOrigin.varRef};return{ref:Zt,...pe,...Mt,id:$e,role:"tooltip",style:an}},[pe,$e]);return{isOpen:q,show:Me,hide:ze,getTriggerProps:Ze,getTooltipProps:on,getTooltipPositionerProps:bt,getArrowProps:le,getArrowInnerProps:de}}const _U="chakra-ui:close-tooltip";function yUe(n,e){return D.useEffect(()=>{const i=BV(n);return i.addEventListener(_U,e),()=>i.removeEventListener(_U,e)},[e,n]),()=>{const i=BV(n),o=Ek(n);i.dispatchEvent(new o.CustomEvent(_U))}}const EUe=Nt(mf.div),Mp=jt((n,e)=>{const i=Hl("Tooltip",n),o=Vi(n),l=z0(),{children:d,label:p,shouldWrapChildren:_,"aria-label":E,hasArrow:b,bg:C,portalProps:I,background:O,backgroundColor:L,bgColor:V,motionProps:B,animatePresenceProps:W,...Z}=o,$=O??L??C??V;if($){i.bg=$;const ie=ESe(l,"colors",$);i[ro.arrowBg.var]=ie}const se=_Ue({...Z,direction:l.direction}),ue=!D.isValidElement(d)||_;let re;if(ue)re=w.jsx(Nt.span,{display:"inline-block",tabIndex:0,...se.getTriggerProps(),children:d});else{const ie=D.Children.only(d);re=D.cloneElement(ie,se.getTriggerProps(ie.props,Sre(ie)))}const pe=!!E,q=se.getTooltipProps({},e),Q=pe?V0(q,["role","id"]):q,J=RZ(q,["role","id"]);return p?w.jsxs(w.Fragment,{children:[re,w.jsx(j0,{...W,children:se.isOpen&&w.jsx($l,{...I,children:w.jsx(Nt.div,{...se.getTooltipPositionerProps(),__css:{zIndex:i.zIndex,pointerEvents:"none"},children:w.jsxs(EUe,{variants:gUe,initial:"exit",animate:"enter",exit:"exit",...B,...Q,__css:i,children:[p,pe&&w.jsx(Nt.span,{srOnly:!0,...J,children:E}),b&&w.jsx(Nt.div,{"data-popper-arrow":!0,className:"chakra-tooltip__arrow-wrapper",children:w.jsx(Nt.div,{"data-popper-arrow-inner":!0,className:"chakra-tooltip__arrow",__css:{bg:i.bg}})})]})})})})]}):w.jsx(w.Fragment,{children:d})});Mp.displayName="Tooltip";const VC=jt(function(e,i){const o=Hl("Heading",e),{className:l,...d}=Vi(e);return w.jsx(Nt.h2,{ref:i,className:hn("chakra-heading",e.className),...d,__css:o})});VC.displayName="Heading";const nt=jt(function(e,i){const o=Hl("Text",e),{className:l,align:d,decoration:p,casing:_,...E}=Vi(e),b=R1({textAlign:e.align,textDecoration:e.decoration,textTransform:e.casing});return w.jsx(Nt.p,{ref:i,className:hn("chakra-text",e.className),...b,...E,__css:o})});nt.displayName="Text";const Vre=jt(function(e,i){const{spacing:o="0.5rem",spacingX:l,spacingY:d,children:p,justify:_,direction:E,align:b,className:C,shouldWrapChildren:I,...O}=e,L=D.useMemo(()=>I?D.Children.map(p,(V,B)=>w.jsx(u4,{children:V},B)):p,[p,I]);return w.jsx(Nt.div,{ref:i,className:hn("chakra-wrap",C),...O,children:w.jsx(Nt.ul,{className:"chakra-wrap__list",__css:{display:"flex",flexWrap:"wrap",justifyContent:_,alignItems:b,flexDirection:E,listStyleType:"none",gap:o,columnGap:l,rowGap:d,padding:"0"},children:L})})});Vre.displayName="Wrap";const u4=jt(function(e,i){const{className:o,...l}=e;return w.jsx(Nt.li,{ref:i,__css:{display:"flex",alignItems:"flex-start"},className:hn("chakra-wrap__listitem",o),...l})});u4.displayName="WrapItem";const vUe="modulepreload",SUe=function(n,e){return new URL(n,e).href},OX={},yU=function(e,i,o){let l=Promise.resolve();if(i&&i.length>0){const p=document.getElementsByTagName("link"),_=document.querySelector("meta[property=csp-nonce]"),E=(_==null?void 0:_.nonce)||(_==null?void 0:_.getAttribute("nonce"));l=Promise.allSettled(i.map(b=>{if(b=SUe(b,o),b in OX)return;OX[b]=!0;const C=b.endsWith(".css"),I=C?'[rel="stylesheet"]':"";if(!!o)for(let V=p.length-1;V>=0;V--){const B=p[V];if(B.href===b&&(!C||B.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${b}"]${I}`))return;const L=document.createElement("link");if(L.rel=C?"stylesheet":vUe,C||(L.as="script"),L.crossOrigin="",L.href=b,E&&L.setAttribute("nonce",E),document.head.appendChild(L),C)return new Promise((V,B)=>{L.addEventListener("load",V),L.addEventListener("error",()=>B(new Error(`Unable to preload CSS for ${b}`)))})}))}function d(p){const _=new Event("vite:preloadError",{cancelable:!0});if(_.payload=p,window.dispatchEvent(_),!_.defaultPrevented)throw p}return l.then(p=>{for(const _ of p||[])_.status==="rejected"&&d(_.reason);return e().catch(d)})},xO=()=>{const n=new Date,e=n.getHours().toString().padStart(2,"0"),i=n.getMinutes().toString().padStart(2,"0"),o=n.getSeconds().toString().padStart(2,"0"),l=n.getMilliseconds().toString().padStart(3,"0");return`${e}:${i}:${o}.${l}`},Y={log:(...n)=>{{const e=n.map((i,o)=>o===0&&typeof i=="string"?`
${i}`:i);console.log(`[LOG] [${xO()}] `,...e)}},error:(...n)=>{{const e=n.map((i,o)=>o===0&&typeof i=="string"?`
${i}`:i);console.error(`[ERROR] [${xO()}] `,...e)}},warn:(...n)=>{{const e=n.map((i,o)=>o===0&&typeof i=="string"?`
${i}`:i);console.warn(`[WARN] [${xO()}]`,...e)}},trace:n=>{console.trace(`[TRACE] [${xO()}] ${n}`)}};async function FC(n){let e;try{switch(n){case"default":e=await yU(()=>import("./index.v0.1.5.js"),[],import.meta.url);break;default:e=await yU(()=>import("./index.v0.1.5.js"),[],import.meta.url)}return e.default}catch(i){return Y.error("Failed to load theme:",i),e=await yU(()=>import("./index.v0.1.5.js"),[],import.meta.url),e.default}}const bUe=()=>{};var kX={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Fre=function(n){const e=[];let i=0;for(let o=0;o<n.length;o++){let l=n.charCodeAt(o);l<128?e[i++]=l:l<2048?(e[i++]=l>>6|192,e[i++]=l&63|128):(l&64512)===55296&&o+1<n.length&&(n.charCodeAt(o+1)&64512)===56320?(l=65536+((l&1023)<<10)+(n.charCodeAt(++o)&1023),e[i++]=l>>18|240,e[i++]=l>>12&63|128,e[i++]=l>>6&63|128,e[i++]=l&63|128):(e[i++]=l>>12|224,e[i++]=l>>6&63|128,e[i++]=l&63|128)}return e},TUe=function(n){const e=[];let i=0,o=0;for(;i<n.length;){const l=n[i++];if(l<128)e[o++]=String.fromCharCode(l);else if(l>191&&l<224){const d=n[i++];e[o++]=String.fromCharCode((l&31)<<6|d&63)}else if(l>239&&l<365){const d=n[i++],p=n[i++],_=n[i++],E=((l&7)<<18|(d&63)<<12|(p&63)<<6|_&63)-65536;e[o++]=String.fromCharCode(55296+(E>>10)),e[o++]=String.fromCharCode(56320+(E&1023))}else{const d=n[i++],p=n[i++];e[o++]=String.fromCharCode((l&15)<<12|(d&63)<<6|p&63)}}return e.join("")},jre={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const i=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,o=[];for(let l=0;l<n.length;l+=3){const d=n[l],p=l+1<n.length,_=p?n[l+1]:0,E=l+2<n.length,b=E?n[l+2]:0,C=d>>2,I=(d&3)<<4|_>>4;let O=(_&15)<<2|b>>6,L=b&63;E||(L=64,p||(O=64)),o.push(i[C],i[I],i[O],i[L])}return o.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(Fre(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):TUe(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();const i=e?this.charToByteMapWebSafe_:this.charToByteMap_,o=[];for(let l=0;l<n.length;){const d=i[n.charAt(l++)],_=l<n.length?i[n.charAt(l)]:0;++l;const b=l<n.length?i[n.charAt(l)]:64;++l;const I=l<n.length?i[n.charAt(l)]:64;if(++l,d==null||_==null||b==null||I==null)throw new wUe;const O=d<<2|_>>4;if(o.push(O),b!==64){const L=_<<4&240|b>>2;if(o.push(L),I!==64){const V=b<<6&192|I;o.push(V)}}}return o},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class wUe extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const CUe=function(n){const e=Fre(n);return jre.encodeByteArray(e,!0)},Xk=function(n){return CUe(n).replace(/\./g,"")},Bre=function(n){try{return jre.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function RUe(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const IUe=()=>RUe().__FIREBASE_DEFAULTS__,AUe=()=>{if(typeof process>"u"||typeof kX>"u")return;const n=kX.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},PUe=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=n&&Bre(n[1]);return e&&JSON.parse(e)},tN=()=>{try{return bUe()||IUe()||AUe()||PUe()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},Wre=n=>{var e,i;return(i=(e=tN())===null||e===void 0?void 0:e.emulatorHosts)===null||i===void 0?void 0:i[n]},zre=n=>{const e=Wre(n);if(!e)return;const i=e.lastIndexOf(":");if(i<=0||i+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const o=parseInt(e.substring(i+1),10);return e[0]==="["?[e.substring(1,i-1),o]:[e.substring(0,i),o]},Gre=()=>{var n;return(n=tN())===null||n===void 0?void 0:n.config},Hre=n=>{var e;return(e=tN())===null||e===void 0?void 0:e[`_${n}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class OUe{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,i)=>{this.resolve=e,this.reject=i})}wrapCallback(e){return(i,o)=>{i?this.reject(i):this.resolve(o),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(i):e(i,o))}}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $re(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const i={alg:"none",type:"JWT"},o=e||"demo-project",l=n.iat||0,d=n.sub||n.user_id;if(!d)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const p=Object.assign({iss:`https://securetoken.google.com/${o}`,aud:o,iat:l,exp:l+3600,auth_time:l,sub:d,user_id:d,firebase:{sign_in_provider:"custom",identities:{}}},n);return[Xk(JSON.stringify(i)),Xk(JSON.stringify(p)),""].join(".")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function tc(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function kUe(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(tc())}function NUe(){var n;const e=(n=tN())===null||n===void 0?void 0:n.forceEnvironment;if(e==="node")return!0;if(e==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function DUe(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function xUe(){const n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function LUe(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function MUe(){const n=tc();return n.indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0}function UUe(){return!NUe()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function VUe(){try{return typeof indexedDB=="object"}catch{return!1}}function FUe(){return new Promise((n,e)=>{try{let i=!0;const o="validate-browser-context-for-indexeddb-analytics-module",l=self.indexedDB.open(o);l.onsuccess=()=>{l.result.close(),i||self.indexedDB.deleteDatabase(o),n(!0)},l.onupgradeneeded=()=>{i=!1},l.onerror=()=>{var d;e(((d=l.error)===null||d===void 0?void 0:d.message)||"")}}catch(i){e(i)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jUe="FirebaseError";class _f extends Error{constructor(e,i,o){super(i),this.code=e,this.customData=o,this.name=jUe,Object.setPrototypeOf(this,_f.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,gR.prototype.create)}}class gR{constructor(e,i,o){this.service=e,this.serviceName=i,this.errors=o}create(e,...i){const o=i[0]||{},l=`${this.service}/${e}`,d=this.errors[e],p=d?BUe(d,o):"Error",_=`${this.serviceName}: ${p} (${l}).`;return new _f(l,_,o)}}function BUe(n,e){return n.replace(WUe,(i,o)=>{const l=e[o];return l!=null?String(l):`<${o}?>`})}const WUe=/\{\$([^}]+)}/g;function zUe(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function Gp(n,e){if(n===e)return!0;const i=Object.keys(n),o=Object.keys(e);for(const l of i){if(!o.includes(l))return!1;const d=n[l],p=e[l];if(NX(d)&&NX(p)){if(!Gp(d,p))return!1}else if(d!==p)return!1}for(const l of o)if(!i.includes(l))return!1;return!0}function NX(n){return n!==null&&typeof n=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _R(n){const e=[];for(const[i,o]of Object.entries(n))Array.isArray(o)?o.forEach(l=>{e.push(encodeURIComponent(i)+"="+encodeURIComponent(l))}):e.push(encodeURIComponent(i)+"="+encodeURIComponent(o));return e.length?"&"+e.join("&"):""}function Kw(n){const e={};return n.replace(/^\?/,"").split("&").forEach(o=>{if(o){const[l,d]=o.split("=");e[decodeURIComponent(l)]=decodeURIComponent(d)}}),e}function qw(n){const e=n.indexOf("?");if(!e)return"";const i=n.indexOf("#",e);return n.substring(e,i>0?i:void 0)}function GUe(n,e){const i=new HUe(n,e);return i.subscribe.bind(i)}class HUe{constructor(e,i){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=i,this.task.then(()=>{e(this)}).catch(o=>{this.error(o)})}next(e){this.forEachObserver(i=>{i.next(e)})}error(e){this.forEachObserver(i=>{i.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,i,o){let l;if(e===void 0&&i===void 0&&o===void 0)throw new Error("Missing Observer.");$Ue(e,["next","error","complete"])?l=e:l={next:e,error:i,complete:o},l.next===void 0&&(l.next=EU),l.error===void 0&&(l.error=EU),l.complete===void 0&&(l.complete=EU);const d=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?l.error(this.finalError):l.complete()}catch{}}),this.observers.push(l),d}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let i=0;i<this.observers.length;i++)this.sendOne(i,e)}sendOne(e,i){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{i(this.observers[e])}catch(o){typeof console<"u"&&console.error&&console.error(o)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function $Ue(n,e){if(typeof n!="object"||n===null)return!1;for(const i of e)if(i in n&&typeof n[i]=="function")return!0;return!1}function EU(){}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zi(n){return n&&n._delegate?n._delegate:n}class Og{constructor(e,i,o){this.name=e,this.instanceFactory=i,this.type=o,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gy="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class KUe{constructor(e,i){this.name=e,this.container=i,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const i=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(i)){const o=new OUe;if(this.instancesDeferred.set(i,o),this.isInitialized(i)||this.shouldAutoInitialize())try{const l=this.getOrInitializeService({instanceIdentifier:i});l&&o.resolve(l)}catch{}}return this.instancesDeferred.get(i).promise}getImmediate(e){var i;const o=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),l=(i=e==null?void 0:e.optional)!==null&&i!==void 0?i:!1;if(this.isInitialized(o)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:o})}catch(d){if(l)return null;throw d}else{if(l)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(YUe(e))try{this.getOrInitializeService({instanceIdentifier:gy})}catch{}for(const[i,o]of this.instancesDeferred.entries()){const l=this.normalizeInstanceIdentifier(i);try{const d=this.getOrInitializeService({instanceIdentifier:l});o.resolve(d)}catch{}}}}clearInstance(e=gy){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(i=>"INTERNAL"in i).map(i=>i.INTERNAL.delete()),...e.filter(i=>"_delete"in i).map(i=>i._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=gy){return this.instances.has(e)}getOptions(e=gy){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:i={}}=e,o=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(o))throw Error(`${this.name}(${o}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const l=this.getOrInitializeService({instanceIdentifier:o,options:i});for(const[d,p]of this.instancesDeferred.entries()){const _=this.normalizeInstanceIdentifier(d);o===_&&p.resolve(l)}return l}onInit(e,i){var o;const l=this.normalizeInstanceIdentifier(i),d=(o=this.onInitCallbacks.get(l))!==null&&o!==void 0?o:new Set;d.add(e),this.onInitCallbacks.set(l,d);const p=this.instances.get(l);return p&&e(p,l),()=>{d.delete(e)}}invokeOnInitCallbacks(e,i){const o=this.onInitCallbacks.get(i);if(o)for(const l of o)try{l(e,i)}catch{}}getOrInitializeService({instanceIdentifier:e,options:i={}}){let o=this.instances.get(e);if(!o&&this.component&&(o=this.component.instanceFactory(this.container,{instanceIdentifier:qUe(e),options:i}),this.instances.set(e,o),this.instancesOptions.set(e,i),this.invokeOnInitCallbacks(o,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,o)}catch{}return o||null}normalizeInstanceIdentifier(e=gy){return this.component?this.component.multipleInstances?e:gy:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function qUe(n){return n===gy?void 0:n}function YUe(n){return n.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class XUe{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const i=this.getProvider(e.name);if(i.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);i.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const i=new KUe(e,this);return this.providers.set(e,i),i}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Ir;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(Ir||(Ir={}));const JUe={debug:Ir.DEBUG,verbose:Ir.VERBOSE,info:Ir.INFO,warn:Ir.WARN,error:Ir.ERROR,silent:Ir.SILENT},QUe=Ir.INFO,ZUe={[Ir.DEBUG]:"log",[Ir.VERBOSE]:"log",[Ir.INFO]:"info",[Ir.WARN]:"warn",[Ir.ERROR]:"error"},eVe=(n,e,...i)=>{if(e<n.logLevel)return;const o=new Date().toISOString(),l=ZUe[e];if(l)console[l](`[${o}]  ${n.name}:`,...i);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class d4{constructor(e){this.name=e,this._logLevel=QUe,this._logHandler=eVe,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in Ir))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?JUe[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,Ir.DEBUG,...e),this._logHandler(this,Ir.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,Ir.VERBOSE,...e),this._logHandler(this,Ir.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,Ir.INFO,...e),this._logHandler(this,Ir.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,Ir.WARN,...e),this._logHandler(this,Ir.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,Ir.ERROR,...e),this._logHandler(this,Ir.ERROR,...e)}}const tVe=(n,e)=>e.some(i=>n instanceof i);let DX,xX;function nVe(){return DX||(DX=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function rVe(){return xX||(xX=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const Kre=new WeakMap,WV=new WeakMap,qre=new WeakMap,vU=new WeakMap,h4=new WeakMap;function iVe(n){const e=new Promise((i,o)=>{const l=()=>{n.removeEventListener("success",d),n.removeEventListener("error",p)},d=()=>{i(bg(n.result)),l()},p=()=>{o(n.error),l()};n.addEventListener("success",d),n.addEventListener("error",p)});return e.then(i=>{i instanceof IDBCursor&&Kre.set(i,n)}).catch(()=>{}),h4.set(e,n),e}function sVe(n){if(WV.has(n))return;const e=new Promise((i,o)=>{const l=()=>{n.removeEventListener("complete",d),n.removeEventListener("error",p),n.removeEventListener("abort",p)},d=()=>{i(),l()},p=()=>{o(n.error||new DOMException("AbortError","AbortError")),l()};n.addEventListener("complete",d),n.addEventListener("error",p),n.addEventListener("abort",p)});WV.set(n,e)}let zV={get(n,e,i){if(n instanceof IDBTransaction){if(e==="done")return WV.get(n);if(e==="objectStoreNames")return n.objectStoreNames||qre.get(n);if(e==="store")return i.objectStoreNames[1]?void 0:i.objectStore(i.objectStoreNames[0])}return bg(n[e])},set(n,e,i){return n[e]=i,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function oVe(n){zV=n(zV)}function aVe(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...i){const o=n.call(SU(this),e,...i);return qre.set(o,e.sort?e.sort():[e]),bg(o)}:rVe().includes(n)?function(...e){return n.apply(SU(this),e),bg(Kre.get(this))}:function(...e){return bg(n.apply(SU(this),e))}}function cVe(n){return typeof n=="function"?aVe(n):(n instanceof IDBTransaction&&sVe(n),tVe(n,nVe())?new Proxy(n,zV):n)}function bg(n){if(n instanceof IDBRequest)return iVe(n);if(vU.has(n))return vU.get(n);const e=cVe(n);return e!==n&&(vU.set(n,e),h4.set(e,n)),e}const SU=n=>h4.get(n);function lVe(n,e,{blocked:i,upgrade:o,blocking:l,terminated:d}={}){const p=indexedDB.open(n,e),_=bg(p);return o&&p.addEventListener("upgradeneeded",E=>{o(bg(p.result),E.oldVersion,E.newVersion,bg(p.transaction),E)}),i&&p.addEventListener("blocked",E=>i(E.oldVersion,E.newVersion,E)),_.then(E=>{d&&E.addEventListener("close",()=>d()),l&&E.addEventListener("versionchange",b=>l(b.oldVersion,b.newVersion,b))}).catch(()=>{}),_}const uVe=["get","getKey","getAll","getAllKeys","count"],dVe=["put","add","delete","clear"],bU=new Map;function LX(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(bU.get(e))return bU.get(e);const i=e.replace(/FromIndex$/,""),o=e!==i,l=dVe.includes(i);if(!(i in(o?IDBIndex:IDBObjectStore).prototype)||!(l||uVe.includes(i)))return;const d=async function(p,..._){const E=this.transaction(p,l?"readwrite":"readonly");let b=E.store;return o&&(b=b.index(_.shift())),(await Promise.all([b[i](..._),l&&E.done]))[0]};return bU.set(e,d),d}oVe(n=>({...n,get:(e,i,o)=>LX(e,i)||n.get(e,i,o),has:(e,i)=>!!LX(e,i)||n.has(e,i)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hVe{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(i=>{if(fVe(i)){const o=i.getImmediate();return`${o.library}/${o.version}`}else return null}).filter(i=>i).join(" ")}}function fVe(n){const e=n.getComponent();return(e==null?void 0:e.type)==="VERSION"}const GV="@firebase/app",MX="0.11.3";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Hp=new d4("@firebase/app"),pVe="@firebase/app-compat",mVe="@firebase/analytics-compat",gVe="@firebase/analytics",_Ve="@firebase/app-check-compat",yVe="@firebase/app-check",EVe="@firebase/auth",vVe="@firebase/auth-compat",SVe="@firebase/database",bVe="@firebase/data-connect",TVe="@firebase/database-compat",wVe="@firebase/functions",CVe="@firebase/functions-compat",RVe="@firebase/installations",IVe="@firebase/installations-compat",AVe="@firebase/messaging",PVe="@firebase/messaging-compat",OVe="@firebase/performance",kVe="@firebase/performance-compat",NVe="@firebase/remote-config",DVe="@firebase/remote-config-compat",xVe="@firebase/storage",LVe="@firebase/storage-compat",MVe="@firebase/firestore",UVe="@firebase/vertexai",VVe="@firebase/firestore-compat",FVe="firebase",jVe="11.5.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const HV="[DEFAULT]",BVe={[GV]:"fire-core",[pVe]:"fire-core-compat",[gVe]:"fire-analytics",[mVe]:"fire-analytics-compat",[yVe]:"fire-app-check",[_Ve]:"fire-app-check-compat",[EVe]:"fire-auth",[vVe]:"fire-auth-compat",[SVe]:"fire-rtdb",[bVe]:"fire-data-connect",[TVe]:"fire-rtdb-compat",[wVe]:"fire-fn",[CVe]:"fire-fn-compat",[RVe]:"fire-iid",[IVe]:"fire-iid-compat",[AVe]:"fire-fcm",[PVe]:"fire-fcm-compat",[OVe]:"fire-perf",[kVe]:"fire-perf-compat",[NVe]:"fire-rc",[DVe]:"fire-rc-compat",[xVe]:"fire-gcs",[LVe]:"fire-gcs-compat",[MVe]:"fire-fst",[VVe]:"fire-fst-compat",[UVe]:"fire-vertex","fire-js":"fire-js",[FVe]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Jk=new Map,WVe=new Map,$V=new Map;function UX(n,e){try{n.container.addComponent(e)}catch(i){Hp.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,i)}}function Wy(n){const e=n.name;if($V.has(e))return Hp.debug(`There were multiple attempts to register component ${e}.`),!1;$V.set(e,n);for(const i of Jk.values())UX(i,n);for(const i of WVe.values())UX(i,n);return!0}function nN(n,e){const i=n.container.getProvider("heartbeat").getImmediate({optional:!0});return i&&i.triggerHeartbeat(),n.container.getProvider(e)}function Ll(n){return n==null?!1:n.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zVe={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},Tg=new gR("app","Firebase",zVe);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class GVe{constructor(e,i,o){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},i),this._name=i.name,this._automaticDataCollectionEnabled=i.automaticDataCollectionEnabled,this._container=o,this.container.addComponent(new Og("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw Tg.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Qy=jVe;function Yre(n,e={}){let i=n;typeof e!="object"&&(e={name:e});const o=Object.assign({name:HV,automaticDataCollectionEnabled:!1},e),l=o.name;if(typeof l!="string"||!l)throw Tg.create("bad-app-name",{appName:String(l)});if(i||(i=Gre()),!i)throw Tg.create("no-options");const d=Jk.get(l);if(d){if(Gp(i,d.options)&&Gp(o,d.config))return d;throw Tg.create("duplicate-app",{appName:l})}const p=new XUe(l);for(const E of $V.values())p.addComponent(E);const _=new GVe(i,o,p);return Jk.set(l,_),_}function f4(n=HV){const e=Jk.get(n);if(!e&&n===HV&&Gre())return Yre();if(!e)throw Tg.create("no-app",{appName:n});return e}function af(n,e,i){var o;let l=(o=BVe[n])!==null&&o!==void 0?o:n;i&&(l+=`-${i}`);const d=l.match(/\s|\//),p=e.match(/\s|\//);if(d||p){const _=[`Unable to register library "${l}" with version "${e}":`];d&&_.push(`library name "${l}" contains illegal characters (whitespace or "/")`),d&&p&&_.push("and"),p&&_.push(`version name "${e}" contains illegal characters (whitespace or "/")`),Hp.warn(_.join(" "));return}Wy(new Og(`${l}-version`,()=>({library:l,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const HVe="firebase-heartbeat-database",$Ve=1,jC="firebase-heartbeat-store";let TU=null;function Xre(){return TU||(TU=lVe(HVe,$Ve,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(jC)}catch(i){console.warn(i)}}}}).catch(n=>{throw Tg.create("idb-open",{originalErrorMessage:n.message})})),TU}async function KVe(n){try{const i=(await Xre()).transaction(jC),o=await i.objectStore(jC).get(Jre(n));return await i.done,o}catch(e){if(e instanceof _f)Hp.warn(e.message);else{const i=Tg.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});Hp.warn(i.message)}}}async function VX(n,e){try{const o=(await Xre()).transaction(jC,"readwrite");await o.objectStore(jC).put(e,Jre(n)),await o.done}catch(i){if(i instanceof _f)Hp.warn(i.message);else{const o=Tg.create("idb-set",{originalErrorMessage:i==null?void 0:i.message});Hp.warn(o.message)}}}function Jre(n){return`${n.name}!${n.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qVe=1024,YVe=30;class XVe{constructor(e){this.container=e,this._heartbeatsCache=null;const i=this.container.getProvider("app").getImmediate();this._storage=new QVe(i),this._heartbeatsCachePromise=this._storage.read().then(o=>(this._heartbeatsCache=o,o))}async triggerHeartbeat(){var e,i;try{const l=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),d=FX();if(((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((i=this._heartbeatsCache)===null||i===void 0?void 0:i.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===d||this._heartbeatsCache.heartbeats.some(p=>p.date===d))return;if(this._heartbeatsCache.heartbeats.push({date:d,agent:l}),this._heartbeatsCache.heartbeats.length>YVe){const p=ZVe(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(p,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(o){Hp.warn(o)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const i=FX(),{heartbeatsToSend:o,unsentEntries:l}=JVe(this._heartbeatsCache.heartbeats),d=Xk(JSON.stringify({version:2,heartbeats:o}));return this._heartbeatsCache.lastSentHeartbeatDate=i,l.length>0?(this._heartbeatsCache.heartbeats=l,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),d}catch(i){return Hp.warn(i),""}}}function FX(){return new Date().toISOString().substring(0,10)}function JVe(n,e=qVe){const i=[];let o=n.slice();for(const l of n){const d=i.find(p=>p.agent===l.agent);if(d){if(d.dates.push(l.date),jX(i)>e){d.dates.pop();break}}else if(i.push({agent:l.agent,dates:[l.date]}),jX(i)>e){i.pop();break}o=o.slice(1)}return{heartbeatsToSend:i,unsentEntries:o}}class QVe{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return VUe()?FUe().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const i=await KVe(this.app);return i!=null&&i.heartbeats?i:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){var i;if(await this._canUseIndexedDBPromise){const l=await this.read();return VX(this.app,{lastSentHeartbeatDate:(i=e.lastSentHeartbeatDate)!==null&&i!==void 0?i:l.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){var i;if(await this._canUseIndexedDBPromise){const l=await this.read();return VX(this.app,{lastSentHeartbeatDate:(i=e.lastSentHeartbeatDate)!==null&&i!==void 0?i:l.lastSentHeartbeatDate,heartbeats:[...l.heartbeats,...e.heartbeats]})}else return}}function jX(n){return Xk(JSON.stringify({version:2,heartbeats:n})).length}function ZVe(n){if(n.length===0)return-1;let e=0,i=n[0].date;for(let o=1;o<n.length;o++)n[o].date<i&&(i=n[o].date,e=o);return e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function eFe(n){Wy(new Og("platform-logger",e=>new hVe(e),"PRIVATE")),Wy(new Og("heartbeat",e=>new XVe(e),"PRIVATE")),af(GV,MX,n),af(GV,MX,"esm2017"),af("fire-js","")}eFe("");function Qre(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const tFe=Qre,Zre=new gR("auth","Firebase",Qre());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Qk=new d4("@firebase/auth");function nFe(n,...e){Qk.logLevel<=Ir.WARN&&Qk.warn(`Auth (${Qy}): ${n}`,...e)}function vk(n,...e){Qk.logLevel<=Ir.ERROR&&Qk.error(`Auth (${Qy}): ${n}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Vd(n,...e){throw p4(n,...e)}function cf(n,...e){return p4(n,...e)}function eie(n,e,i){const o=Object.assign(Object.assign({},tFe()),{[e]:i});return new gR("auth","Firebase",o).create(e,{appName:n.name})}function Up(n){return eie(n,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function p4(n,...e){if(typeof n!="string"){const i=e[0],o=[...e.slice(1)];return o[0]&&(o[0].appName=n.name),n._errorFactory.create(i,...o)}return Zre.create(n,...e)}function Bn(n,e,...i){if(!n)throw p4(e,...i)}function Ap(n){const e="INTERNAL ASSERTION FAILED: "+n;throw vk(e),new Error(e)}function $p(n,e){n||Ap(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function KV(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.href)||""}function rFe(){return BX()==="http:"||BX()==="https:"}function BX(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function iFe(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(rFe()||xUe()||"connection"in navigator)?navigator.onLine:!0}function sFe(){if(typeof navigator>"u")return null;const n=navigator;return n.languages&&n.languages[0]||n.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yR{constructor(e,i){this.shortDelay=e,this.longDelay=i,$p(i>e,"Short delay should be less than long delay!"),this.isMobile=kUe()||LUe()}get(){return iFe()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function m4(n,e){$p(n.emulator,"Emulator should always be set here");const{url:i}=n.emulator;return e?`${i}${e.startsWith("/")?e.slice(1):e}`:i}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tie{static initialize(e,i,o){this.fetchImpl=e,i&&(this.headersImpl=i),o&&(this.responseImpl=o)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;Ap("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;Ap("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;Ap("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const oFe={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const aFe=new yR(3e4,6e4);function Jp(n,e){return n.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:n.tenantId}):e}async function Qp(n,e,i,o,l={}){return nie(n,l,async()=>{let d={},p={};o&&(e==="GET"?p=o:d={body:JSON.stringify(o)});const _=_R(Object.assign({key:n.config.apiKey},p)).slice(1),E=await n._getAdditionalHeaders();E["Content-Type"]="application/json",n.languageCode&&(E["X-Firebase-Locale"]=n.languageCode);const b=Object.assign({method:e,headers:E},d);return DUe()||(b.referrerPolicy="no-referrer"),tie.fetch()(rie(n,n.config.apiHost,i,_),b)})}async function nie(n,e,i){n._canInitEmulator=!1;const o=Object.assign(Object.assign({},oFe),e);try{const l=new lFe(n),d=await Promise.race([i(),l.promise]);l.clearNetworkTimeout();const p=await d.json();if("needConfirmation"in p)throw LO(n,"account-exists-with-different-credential",p);if(d.ok&&!("errorMessage"in p))return p;{const _=d.ok?p.errorMessage:p.error.message,[E,b]=_.split(" : ");if(E==="FEDERATED_USER_ID_ALREADY_LINKED")throw LO(n,"credential-already-in-use",p);if(E==="EMAIL_EXISTS")throw LO(n,"email-already-in-use",p);if(E==="USER_DISABLED")throw LO(n,"user-disabled",p);const C=o[E]||E.toLowerCase().replace(/[_\s]+/g,"-");if(b)throw eie(n,C,b);Vd(n,C)}}catch(l){if(l instanceof _f)throw l;Vd(n,"network-request-failed",{message:String(l)})}}async function ER(n,e,i,o,l={}){const d=await Qp(n,e,i,o,l);return"mfaPendingCredential"in d&&Vd(n,"multi-factor-auth-required",{_serverResponse:d}),d}function rie(n,e,i,o){const l=`${e}${i}?${o}`;return n.config.emulator?m4(n.config,l):`${n.config.apiScheme}://${l}`}function cFe(n){switch(n){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class lFe{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((i,o)=>{this.timer=setTimeout(()=>o(cf(this.auth,"network-request-failed")),aFe.get())})}}function LO(n,e,i){const o={appName:n.name};i.email&&(o.email=i.email),i.phoneNumber&&(o.phoneNumber=i.phoneNumber);const l=cf(n,e,o);return l.customData._tokenResponse=i,l}function WX(n){return n!==void 0&&n.enterprise!==void 0}class uFe{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const i of this.recaptchaEnforcementState)if(i.provider&&i.provider===e)return cFe(i.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function dFe(n,e){return Qp(n,"GET","/v2/recaptchaConfig",Jp(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function hFe(n,e){return Qp(n,"POST","/v1/accounts:delete",e)}async function iie(n,e){return Qp(n,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fC(n){if(n)try{const e=new Date(Number(n));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function fFe(n,e=!1){const i=zi(n),o=await i.getIdToken(e),l=g4(o);Bn(l&&l.exp&&l.auth_time&&l.iat,i.auth,"internal-error");const d=typeof l.firebase=="object"?l.firebase:void 0,p=d==null?void 0:d.sign_in_provider;return{claims:l,token:o,authTime:fC(wU(l.auth_time)),issuedAtTime:fC(wU(l.iat)),expirationTime:fC(wU(l.exp)),signInProvider:p||null,signInSecondFactor:(d==null?void 0:d.sign_in_second_factor)||null}}function wU(n){return Number(n)*1e3}function g4(n){const[e,i,o]=n.split(".");if(e===void 0||i===void 0||o===void 0)return vk("JWT malformed, contained fewer than 3 sections"),null;try{const l=Bre(i);return l?JSON.parse(l):(vk("Failed to decode base64 JWT payload"),null)}catch(l){return vk("Caught error parsing JWT payload as JSON",l==null?void 0:l.toString()),null}}function zX(n){const e=g4(n);return Bn(e,"internal-error"),Bn(typeof e.exp<"u","internal-error"),Bn(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function BC(n,e,i=!1){if(i)return e;try{return await e}catch(o){throw o instanceof _f&&pFe(o)&&n.auth.currentUser===n&&await n.auth.signOut(),o}}function pFe({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mFe{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){var i;if(e){const o=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),o}else{this.errorBackoff=3e4;const l=((i=this.user.stsTokenManager.expirationTime)!==null&&i!==void 0?i:0)-Date.now()-3e5;return Math.max(0,l)}}schedule(e=!1){if(!this.isRunning)return;const i=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},i)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(e==null?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qV{constructor(e,i){this.createdAt=e,this.lastLoginAt=i,this._initializeTime()}_initializeTime(){this.lastSignInTime=fC(this.lastLoginAt),this.creationTime=fC(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Zk(n){var e;const i=n.auth,o=await n.getIdToken(),l=await BC(n,iie(i,{idToken:o}));Bn(l==null?void 0:l.users.length,i,"internal-error");const d=l.users[0];n._notifyReloadListener(d);const p=!((e=d.providerUserInfo)===null||e===void 0)&&e.length?sie(d.providerUserInfo):[],_=_Fe(n.providerData,p),E=n.isAnonymous,b=!(n.email&&d.passwordHash)&&!(_!=null&&_.length),C=E?b:!1,I={uid:d.localId,displayName:d.displayName||null,photoURL:d.photoUrl||null,email:d.email||null,emailVerified:d.emailVerified||!1,phoneNumber:d.phoneNumber||null,tenantId:d.tenantId||null,providerData:_,metadata:new qV(d.createdAt,d.lastLoginAt),isAnonymous:C};Object.assign(n,I)}async function gFe(n){const e=zi(n);await Zk(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function _Fe(n,e){return[...n.filter(o=>!e.some(l=>l.providerId===o.providerId)),...e]}function sie(n){return n.map(e=>{var{providerId:i}=e,o=aR(e,["providerId"]);return{providerId:i,uid:o.rawId||"",displayName:o.displayName||null,email:o.email||null,phoneNumber:o.phoneNumber||null,photoURL:o.photoUrl||null}})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function yFe(n,e){const i=await nie(n,{},async()=>{const o=_R({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:l,apiKey:d}=n.config,p=rie(n,l,"/v1/token",`key=${d}`),_=await n._getAdditionalHeaders();return _["Content-Type"]="application/x-www-form-urlencoded",tie.fetch()(p,{method:"POST",headers:_,body:o})});return{accessToken:i.access_token,expiresIn:i.expires_in,refreshToken:i.refresh_token}}async function EFe(n,e){return Qp(n,"POST","/v2/accounts:revokeToken",Jp(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class o0{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){Bn(e.idToken,"internal-error"),Bn(typeof e.idToken<"u","internal-error"),Bn(typeof e.refreshToken<"u","internal-error");const i="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):zX(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,i)}updateFromIdToken(e){Bn(e.length!==0,"internal-error");const i=zX(e);this.updateTokensAndExpiration(e,null,i)}async getToken(e,i=!1){return!i&&this.accessToken&&!this.isExpired?this.accessToken:(Bn(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,i){const{accessToken:o,refreshToken:l,expiresIn:d}=await yFe(e,i);this.updateTokensAndExpiration(o,l,Number(d))}updateTokensAndExpiration(e,i,o){this.refreshToken=i||null,this.accessToken=e||null,this.expirationTime=Date.now()+o*1e3}static fromJSON(e,i){const{refreshToken:o,accessToken:l,expirationTime:d}=i,p=new o0;return o&&(Bn(typeof o=="string","internal-error",{appName:e}),p.refreshToken=o),l&&(Bn(typeof l=="string","internal-error",{appName:e}),p.accessToken=l),d&&(Bn(typeof d=="number","internal-error",{appName:e}),p.expirationTime=d),p}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new o0,this.toJSON())}_performRefresh(){return Ap("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function cg(n,e){Bn(typeof n=="string"||typeof n>"u","internal-error",{appName:e})}class Pp{constructor(e){var{uid:i,auth:o,stsTokenManager:l}=e,d=aR(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new mFe(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=i,this.auth=o,this.stsTokenManager=l,this.accessToken=l.accessToken,this.displayName=d.displayName||null,this.email=d.email||null,this.emailVerified=d.emailVerified||!1,this.phoneNumber=d.phoneNumber||null,this.photoURL=d.photoURL||null,this.isAnonymous=d.isAnonymous||!1,this.tenantId=d.tenantId||null,this.providerData=d.providerData?[...d.providerData]:[],this.metadata=new qV(d.createdAt||void 0,d.lastLoginAt||void 0)}async getIdToken(e){const i=await BC(this,this.stsTokenManager.getToken(this.auth,e));return Bn(i,this.auth,"internal-error"),this.accessToken!==i&&(this.accessToken=i,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),i}getIdTokenResult(e){return fFe(this,e)}reload(){return gFe(this)}_assign(e){this!==e&&(Bn(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(i=>Object.assign({},i)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const i=new Pp(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return i.metadata._copy(this.metadata),i}_onReload(e){Bn(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,i=!1){let o=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),o=!0),i&&await Zk(this),await this.auth._persistUserIfCurrent(this),o&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(Ll(this.auth.app))return Promise.reject(Up(this.auth));const e=await this.getIdToken();return await BC(this,hFe(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,i){var o,l,d,p,_,E,b,C;const I=(o=i.displayName)!==null&&o!==void 0?o:void 0,O=(l=i.email)!==null&&l!==void 0?l:void 0,L=(d=i.phoneNumber)!==null&&d!==void 0?d:void 0,V=(p=i.photoURL)!==null&&p!==void 0?p:void 0,B=(_=i.tenantId)!==null&&_!==void 0?_:void 0,W=(E=i._redirectEventId)!==null&&E!==void 0?E:void 0,Z=(b=i.createdAt)!==null&&b!==void 0?b:void 0,$=(C=i.lastLoginAt)!==null&&C!==void 0?C:void 0,{uid:se,emailVerified:ue,isAnonymous:re,providerData:pe,stsTokenManager:q}=i;Bn(se&&q,e,"internal-error");const Q=o0.fromJSON(this.name,q);Bn(typeof se=="string",e,"internal-error"),cg(I,e.name),cg(O,e.name),Bn(typeof ue=="boolean",e,"internal-error"),Bn(typeof re=="boolean",e,"internal-error"),cg(L,e.name),cg(V,e.name),cg(B,e.name),cg(W,e.name),cg(Z,e.name),cg($,e.name);const J=new Pp({uid:se,auth:e,email:O,emailVerified:ue,displayName:I,isAnonymous:re,photoURL:V,phoneNumber:L,tenantId:B,stsTokenManager:Q,createdAt:Z,lastLoginAt:$});return pe&&Array.isArray(pe)&&(J.providerData=pe.map(ie=>Object.assign({},ie))),W&&(J._redirectEventId=W),J}static async _fromIdTokenResponse(e,i,o=!1){const l=new o0;l.updateFromServerResponse(i);const d=new Pp({uid:i.localId,auth:e,stsTokenManager:l,isAnonymous:o});return await Zk(d),d}static async _fromGetAccountInfoResponse(e,i,o){const l=i.users[0];Bn(l.localId!==void 0,"internal-error");const d=l.providerUserInfo!==void 0?sie(l.providerUserInfo):[],p=!(l.email&&l.passwordHash)&&!(d!=null&&d.length),_=new o0;_.updateFromIdToken(o);const E=new Pp({uid:l.localId,auth:e,stsTokenManager:_,isAnonymous:p}),b={uid:l.localId,displayName:l.displayName||null,photoURL:l.photoUrl||null,email:l.email||null,emailVerified:l.emailVerified||!1,phoneNumber:l.phoneNumber||null,tenantId:l.tenantId||null,providerData:d,metadata:new qV(l.createdAt,l.lastLoginAt),isAnonymous:!(l.email&&l.passwordHash)&&!(d!=null&&d.length)};return Object.assign(E,b),E}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const GX=new Map;function Op(n){$p(n instanceof Function,"Expected a class definition");let e=GX.get(n);return e?($p(e instanceof n,"Instance stored in cache mismatched with class"),e):(e=new n,GX.set(n,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oie{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,i){this.storage[e]=i}async _get(e){const i=this.storage[e];return i===void 0?null:i}async _remove(e){delete this.storage[e]}_addListener(e,i){}_removeListener(e,i){}}oie.type="NONE";const HX=oie;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Sk(n,e,i){return`firebase:${n}:${e}:${i}`}class a0{constructor(e,i,o){this.persistence=e,this.auth=i,this.userKey=o;const{config:l,name:d}=this.auth;this.fullUserKey=Sk(this.userKey,l.apiKey,d),this.fullPersistenceKey=Sk("persistence",l.apiKey,d),this.boundEventHandler=i._onStorageEvent.bind(i),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);return e?Pp._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const i=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,i)return this.setCurrentUser(i)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,i,o="authUser"){if(!i.length)return new a0(Op(HX),e,o);const l=(await Promise.all(i.map(async b=>{if(await b._isAvailable())return b}))).filter(b=>b);let d=l[0]||Op(HX);const p=Sk(o,e.config.apiKey,e.name);let _=null;for(const b of i)try{const C=await b._get(p);if(C){const I=Pp._fromJSON(e,C);b!==d&&(_=I),d=b;break}}catch{}const E=l.filter(b=>b._shouldAllowMigration);return!d._shouldAllowMigration||!E.length?new a0(d,e,o):(d=E[0],_&&await d._set(p,_.toJSON()),await Promise.all(i.map(async b=>{if(b!==d)try{await b._remove(p)}catch{}})),new a0(d,e,o))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $X(n){const e=n.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(uie(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(aie(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(hie(e))return"Blackberry";if(fie(e))return"Webos";if(cie(e))return"Safari";if((e.includes("chrome/")||lie(e))&&!e.includes("edge/"))return"Chrome";if(die(e))return"Android";{const i=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,o=n.match(i);if((o==null?void 0:o.length)===2)return o[1]}return"Other"}function aie(n=tc()){return/firefox\//i.test(n)}function cie(n=tc()){const e=n.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function lie(n=tc()){return/crios\//i.test(n)}function uie(n=tc()){return/iemobile/i.test(n)}function die(n=tc()){return/android/i.test(n)}function hie(n=tc()){return/blackberry/i.test(n)}function fie(n=tc()){return/webos/i.test(n)}function _4(n=tc()){return/iphone|ipad|ipod/i.test(n)||/macintosh/i.test(n)&&/mobile/i.test(n)}function vFe(n=tc()){var e;return _4(n)&&!!(!((e=window.navigator)===null||e===void 0)&&e.standalone)}function SFe(){return MUe()&&document.documentMode===10}function pie(n=tc()){return _4(n)||die(n)||fie(n)||hie(n)||/windows phone/i.test(n)||uie(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mie(n,e=[]){let i;switch(n){case"Browser":i=$X(tc());break;case"Worker":i=`${$X(tc())}-${n}`;break;default:i=n}const o=e.length?e.join(","):"FirebaseCore-web";return`${i}/JsCore/${Qy}/${o}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bFe{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,i){const o=d=>new Promise((p,_)=>{try{const E=e(d);p(E)}catch(E){_(E)}});o.onAbort=i,this.queue.push(o);const l=this.queue.length-1;return()=>{this.queue[l]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const i=[];try{for(const o of this.queue)await o(e),o.onAbort&&i.push(o.onAbort)}catch(o){i.reverse();for(const l of i)try{l()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:o==null?void 0:o.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function TFe(n,e={}){return Qp(n,"GET","/v2/passwordPolicy",Jp(n,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wFe=6;class CFe{constructor(e){var i,o,l,d;const p=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(i=p.minPasswordLength)!==null&&i!==void 0?i:wFe,p.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=p.maxPasswordLength),p.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=p.containsLowercaseCharacter),p.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=p.containsUppercaseCharacter),p.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=p.containsNumericCharacter),p.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=p.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(l=(o=e.allowedNonAlphanumericCharacters)===null||o===void 0?void 0:o.join(""))!==null&&l!==void 0?l:"",this.forceUpgradeOnSignin=(d=e.forceUpgradeOnSignin)!==null&&d!==void 0?d:!1,this.schemaVersion=e.schemaVersion}validatePassword(e){var i,o,l,d,p,_;const E={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,E),this.validatePasswordCharacterOptions(e,E),E.isValid&&(E.isValid=(i=E.meetsMinPasswordLength)!==null&&i!==void 0?i:!0),E.isValid&&(E.isValid=(o=E.meetsMaxPasswordLength)!==null&&o!==void 0?o:!0),E.isValid&&(E.isValid=(l=E.containsLowercaseLetter)!==null&&l!==void 0?l:!0),E.isValid&&(E.isValid=(d=E.containsUppercaseLetter)!==null&&d!==void 0?d:!0),E.isValid&&(E.isValid=(p=E.containsNumericCharacter)!==null&&p!==void 0?p:!0),E.isValid&&(E.isValid=(_=E.containsNonAlphanumericCharacter)!==null&&_!==void 0?_:!0),E}validatePasswordLengthOptions(e,i){const o=this.customStrengthOptions.minPasswordLength,l=this.customStrengthOptions.maxPasswordLength;o&&(i.meetsMinPasswordLength=e.length>=o),l&&(i.meetsMaxPasswordLength=e.length<=l)}validatePasswordCharacterOptions(e,i){this.updatePasswordCharacterOptionsStatuses(i,!1,!1,!1,!1);let o;for(let l=0;l<e.length;l++)o=e.charAt(l),this.updatePasswordCharacterOptionsStatuses(i,o>="a"&&o<="z",o>="A"&&o<="Z",o>="0"&&o<="9",this.allowedNonAlphanumericCharacters.includes(o))}updatePasswordCharacterOptionsStatuses(e,i,o,l,d){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=i)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=o)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=l)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=d))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class RFe{constructor(e,i,o,l){this.app=e,this.heartbeatServiceProvider=i,this.appCheckServiceProvider=o,this.config=l,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new KX(this),this.idTokenSubscription=new KX(this),this.beforeStateQueue=new bFe(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=Zre,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=l.sdkClientVersion}_initializeWithPersistence(e,i){return i&&(this._popupRedirectResolver=Op(i)),this._initializationPromise=this.queue(async()=>{var o,l;if(!this._deleted&&(this.persistenceManager=await a0.create(this,e),!this._deleted)){if(!((o=this._popupRedirectResolver)===null||o===void 0)&&o._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(i),this.lastNotifiedUid=((l=this.currentUser)===null||l===void 0?void 0:l.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const i=await iie(this,{idToken:e}),o=await Pp._fromGetAccountInfoResponse(this,i,e);await this.directlySetCurrentUser(o)}catch(i){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",i),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var i;if(Ll(this.app)){const p=this.app.settings.authIdToken;return p?new Promise(_=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(p).then(_,_))}):this.directlySetCurrentUser(null)}const o=await this.assertedPersistence.getCurrentUser();let l=o,d=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const p=(i=this.redirectUser)===null||i===void 0?void 0:i._redirectEventId,_=l==null?void 0:l._redirectEventId,E=await this.tryRedirectSignIn(e);(!p||p===_)&&(E!=null&&E.user)&&(l=E.user,d=!0)}if(!l)return this.directlySetCurrentUser(null);if(!l._redirectEventId){if(d)try{await this.beforeStateQueue.runMiddleware(l)}catch(p){l=o,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(p))}return l?this.reloadAndSetCurrentUserOrClear(l):this.directlySetCurrentUser(null)}return Bn(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===l._redirectEventId?this.directlySetCurrentUser(l):this.reloadAndSetCurrentUserOrClear(l)}async tryRedirectSignIn(e){let i=null;try{i=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return i}async reloadAndSetCurrentUserOrClear(e){try{await Zk(e)}catch(i){if((i==null?void 0:i.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=sFe()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(Ll(this.app))return Promise.reject(Up(this));const i=e?zi(e):null;return i&&Bn(i.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(i&&i._clone(this))}async _updateCurrentUser(e,i=!1){if(!this._deleted)return e&&Bn(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),i||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return Ll(this.app)?Promise.reject(Up(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return Ll(this.app)?Promise.reject(Up(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(Op(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const i=this._getPasswordPolicyInternal();return i.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):i.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await TFe(this),i=new CFe(e);this.tenantId===null?this._projectPasswordPolicy=i:this._tenantPasswordPolicies[this.tenantId]=i}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new gR("auth","Firebase",e())}onAuthStateChanged(e,i,o){return this.registerStateListener(this.authStateSubscription,e,i,o)}beforeAuthStateChanged(e,i){return this.beforeStateQueue.pushCallback(e,i)}onIdTokenChanged(e,i,o){return this.registerStateListener(this.idTokenSubscription,e,i,o)}authStateReady(){return new Promise((e,i)=>{if(this.currentUser)e();else{const o=this.onAuthStateChanged(()=>{o(),e()},i)}})}async revokeAccessToken(e){if(this.currentUser){const i=await this.currentUser.getIdToken(),o={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:i};this.tenantId!=null&&(o.tenantId=this.tenantId),await EFe(this,o)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)===null||e===void 0?void 0:e.toJSON()}}async _setRedirectUser(e,i){const o=await this.getOrInitRedirectPersistenceManager(i);return e===null?o.removeCurrentUser():o.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const i=e&&Op(e)||this._popupRedirectResolver;Bn(i,this,"argument-error"),this.redirectPersistenceManager=await a0.create(this,[Op(i._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var i,o;return this._isInitialized&&await this.queue(async()=>{}),((i=this._currentUser)===null||i===void 0?void 0:i._redirectEventId)===e?this._currentUser:((o=this.redirectUser)===null||o===void 0?void 0:o._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,i;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const o=(i=(e=this.currentUser)===null||e===void 0?void 0:e.uid)!==null&&i!==void 0?i:null;this.lastNotifiedUid!==o&&(this.lastNotifiedUid=o,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,i,o,l){if(this._deleted)return()=>{};const d=typeof i=="function"?i:i.next.bind(i);let p=!1;const _=this._isInitialized?Promise.resolve():this._initializationPromise;if(Bn(_,this,"internal-error"),_.then(()=>{p||d(this.currentUser)}),typeof i=="function"){const E=e.addObserver(i,o,l);return()=>{p=!0,E()}}else{const E=e.addObserver(i);return()=>{p=!0,E()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return Bn(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=mie(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const i={"X-Client-Version":this.clientVersion};this.app.options.appId&&(i["X-Firebase-gmpid"]=this.app.options.appId);const o=await((e=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getHeartbeatsHeader());o&&(i["X-Firebase-Client"]=o);const l=await this._getAppCheckToken();return l&&(i["X-Firebase-AppCheck"]=l),i}async _getAppCheckToken(){var e;if(Ll(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const i=await((e=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getToken());return i!=null&&i.error&&nFe(`Error while retrieving App Check token: ${i.error}`),i==null?void 0:i.token}}function Bg(n){return zi(n)}class KX{constructor(e){this.auth=e,this.observer=null,this.addObserver=GUe(i=>this.observer=i)}get next(){return Bn(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let rN={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function IFe(n){rN=n}function gie(n){return rN.loadJS(n)}function AFe(){return rN.recaptchaEnterpriseScript}function PFe(){return rN.gapiScript}function OFe(n){return`__${n}${Math.floor(Math.random()*1e6)}`}class kFe{constructor(){this.enterprise=new NFe}ready(e){e()}execute(e,i){return Promise.resolve("token")}render(e,i){return""}}class NFe{ready(e){e()}execute(e,i){return Promise.resolve("token")}render(e,i){return""}}const DFe="recaptcha-enterprise",_ie="NO_RECAPTCHA";class xFe{constructor(e){this.type=DFe,this.auth=Bg(e)}async verify(e="verify",i=!1){async function o(d){if(!i){if(d.tenantId==null&&d._agentRecaptchaConfig!=null)return d._agentRecaptchaConfig.siteKey;if(d.tenantId!=null&&d._tenantRecaptchaConfigs[d.tenantId]!==void 0)return d._tenantRecaptchaConfigs[d.tenantId].siteKey}return new Promise(async(p,_)=>{dFe(d,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(E=>{if(E.recaptchaKey===void 0)_(new Error("recaptcha Enterprise site key undefined"));else{const b=new uFe(E);return d.tenantId==null?d._agentRecaptchaConfig=b:d._tenantRecaptchaConfigs[d.tenantId]=b,p(b.siteKey)}}).catch(E=>{_(E)})})}function l(d,p,_){const E=window.grecaptcha;WX(E)?E.enterprise.ready(()=>{E.enterprise.execute(d,{action:e}).then(b=>{p(b)}).catch(()=>{p(_ie)})}):_(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new kFe().execute("siteKey",{action:"verify"}):new Promise((d,p)=>{o(this.auth).then(_=>{if(!i&&WX(window.grecaptcha))l(_,d,p);else{if(typeof window>"u"){p(new Error("RecaptchaVerifier is only supported in browser"));return}let E=AFe();E.length!==0&&(E+=_),gie(E).then(()=>{l(_,d,p)}).catch(b=>{p(b)})}}).catch(_=>{p(_)})})}}async function qX(n,e,i,o=!1,l=!1){const d=new xFe(n);let p;if(l)p=_ie;else try{p=await d.verify(i)}catch{p=await d.verify(i,!0)}const _=Object.assign({},e);if(i==="mfaSmsEnrollment"||i==="mfaSmsSignIn"){if("phoneEnrollmentInfo"in _){const E=_.phoneEnrollmentInfo.phoneNumber,b=_.phoneEnrollmentInfo.recaptchaToken;Object.assign(_,{phoneEnrollmentInfo:{phoneNumber:E,recaptchaToken:b,captchaResponse:p,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in _){const E=_.phoneSignInInfo.recaptchaToken;Object.assign(_,{phoneSignInInfo:{recaptchaToken:E,captchaResponse:p,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return _}return o?Object.assign(_,{captchaResp:p}):Object.assign(_,{captchaResponse:p}),Object.assign(_,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(_,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),_}async function e1(n,e,i,o,l){var d;if(!((d=n._getRecaptchaConfig())===null||d===void 0)&&d.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const p=await qX(n,e,i,i==="getOobCode");return o(n,p)}else return o(n,e).catch(async p=>{if(p.code==="auth/missing-recaptcha-token"){console.log(`${i} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const _=await qX(n,e,i,i==="getOobCode");return o(n,_)}else return Promise.reject(p)})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function LFe(n,e){const i=nN(n,"auth");if(i.isInitialized()){const l=i.getImmediate(),d=i.getOptions();if(Gp(d,e??{}))return l;Vd(l,"already-initialized")}return i.initialize({options:e})}function MFe(n,e){const i=(e==null?void 0:e.persistence)||[],o=(Array.isArray(i)?i:[i]).map(Op);e!=null&&e.errorMap&&n._updateErrorMap(e.errorMap),n._initializeWithPersistence(o,e==null?void 0:e.popupRedirectResolver)}function UFe(n,e,i){const o=Bg(n);Bn(/^https?:\/\//.test(e),o,"invalid-emulator-scheme");const l=!1,d=yie(e),{host:p,port:_}=VFe(e),E=_===null?"":`:${_}`,b={url:`${d}//${p}${E}/`},C=Object.freeze({host:p,port:_,protocol:d.replace(":",""),options:Object.freeze({disableWarnings:l})});if(!o._canInitEmulator){Bn(o.config.emulator&&o.emulatorConfig,o,"emulator-config-failed"),Bn(Gp(b,o.config.emulator)&&Gp(C,o.emulatorConfig),o,"emulator-config-failed");return}o.config.emulator=b,o.emulatorConfig=C,o.settings.appVerificationDisabledForTesting=!0,FFe()}function yie(n){const e=n.indexOf(":");return e<0?"":n.substr(0,e+1)}function VFe(n){const e=yie(n),i=/(\/\/)?([^?#/]+)/.exec(n.substr(e.length));if(!i)return{host:"",port:null};const o=i[2].split("@").pop()||"",l=/^(\[[^\]]+\])(:|$)/.exec(o);if(l){const d=l[1];return{host:d,port:YX(o.substr(d.length+1))}}else{const[d,p]=o.split(":");return{host:d,port:YX(p)}}}function YX(n){if(!n)return null;const e=Number(n);return isNaN(e)?null:e}function FFe(){function n(){const e=document.createElement("p"),i=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",i.position="fixed",i.width="100%",i.backgroundColor="#ffffff",i.border=".1em solid #000000",i.color="#b50000",i.bottom="0px",i.left="0px",i.margin="0px",i.zIndex="10000",i.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",n):n())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class y4{constructor(e,i){this.providerId=e,this.signInMethod=i}toJSON(){return Ap("not implemented")}_getIdTokenResponse(e){return Ap("not implemented")}_linkToIdToken(e,i){return Ap("not implemented")}_getReauthenticationResolver(e){return Ap("not implemented")}}async function jFe(n,e){return Qp(n,"POST","/v1/accounts:signUp",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function BFe(n,e){return ER(n,"POST","/v1/accounts:signInWithPassword",Jp(n,e))}async function Eie(n,e){return Qp(n,"POST","/v1/accounts:sendOobCode",Jp(n,e))}async function WFe(n,e){return Eie(n,e)}async function zFe(n,e){return Eie(n,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function GFe(n,e){return ER(n,"POST","/v1/accounts:signInWithEmailLink",Jp(n,e))}async function HFe(n,e){return ER(n,"POST","/v1/accounts:signInWithEmailLink",Jp(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class WC extends y4{constructor(e,i,o,l=null){super("password",o),this._email=e,this._password=i,this._tenantId=l}static _fromEmailAndPassword(e,i){return new WC(e,i,"password")}static _fromEmailAndCode(e,i,o=null){return new WC(e,i,"emailLink",o)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const i=typeof e=="string"?JSON.parse(e):e;if(i!=null&&i.email&&(i!=null&&i.password)){if(i.signInMethod==="password")return this._fromEmailAndPassword(i.email,i.password);if(i.signInMethod==="emailLink")return this._fromEmailAndCode(i.email,i.password,i.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":const i={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return e1(e,i,"signInWithPassword",BFe);case"emailLink":return GFe(e,{email:this._email,oobCode:this._password});default:Vd(e,"internal-error")}}async _linkToIdToken(e,i){switch(this.signInMethod){case"password":const o={idToken:i,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return e1(e,o,"signUpPassword",jFe);case"emailLink":return HFe(e,{idToken:i,email:this._email,oobCode:this._password});default:Vd(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function c0(n,e){return ER(n,"POST","/v1/accounts:signInWithIdp",Jp(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $Fe="http://localhost";class zy extends y4{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const i=new zy(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(i.idToken=e.idToken),e.accessToken&&(i.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(i.nonce=e.nonce),e.pendingToken&&(i.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(i.accessToken=e.oauthToken,i.secret=e.oauthTokenSecret):Vd("argument-error"),i}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const i=typeof e=="string"?JSON.parse(e):e,{providerId:o,signInMethod:l}=i,d=aR(i,["providerId","signInMethod"]);if(!o||!l)return null;const p=new zy(o,l);return p.idToken=d.idToken||void 0,p.accessToken=d.accessToken||void 0,p.secret=d.secret,p.nonce=d.nonce,p.pendingToken=d.pendingToken||null,p}_getIdTokenResponse(e){const i=this.buildRequest();return c0(e,i)}_linkToIdToken(e,i){const o=this.buildRequest();return o.idToken=i,c0(e,o)}_getReauthenticationResolver(e){const i=this.buildRequest();return i.autoCreate=!1,c0(e,i)}buildRequest(){const e={requestUri:$Fe,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const i={};this.idToken&&(i.id_token=this.idToken),this.accessToken&&(i.access_token=this.accessToken),this.secret&&(i.oauth_token_secret=this.secret),i.providerId=this.providerId,this.nonce&&!this.pendingToken&&(i.nonce=this.nonce),e.postBody=_R(i)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function KFe(n){switch(n){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function qFe(n){const e=Kw(qw(n)).link,i=e?Kw(qw(e)).deep_link_id:null,o=Kw(qw(n)).deep_link_id;return(o?Kw(qw(o)).link:null)||o||i||e||n}class E4{constructor(e){var i,o,l,d,p,_;const E=Kw(qw(e)),b=(i=E.apiKey)!==null&&i!==void 0?i:null,C=(o=E.oobCode)!==null&&o!==void 0?o:null,I=KFe((l=E.mode)!==null&&l!==void 0?l:null);Bn(b&&C&&I,"argument-error"),this.apiKey=b,this.operation=I,this.code=C,this.continueUrl=(d=E.continueUrl)!==null&&d!==void 0?d:null,this.languageCode=(p=E.languageCode)!==null&&p!==void 0?p:null,this.tenantId=(_=E.tenantId)!==null&&_!==void 0?_:null}static parseLink(e){const i=qFe(e);try{return new E4(i)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class K0{constructor(){this.providerId=K0.PROVIDER_ID}static credential(e,i){return WC._fromEmailAndPassword(e,i)}static credentialWithLink(e,i){const o=E4.parseLink(i);return Bn(o,"argument-error"),WC._fromEmailAndCode(e,o.code,o.tenantId)}}K0.PROVIDER_ID="password";K0.EMAIL_PASSWORD_SIGN_IN_METHOD="password";K0.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vie{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vR extends vie{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pg extends vR{constructor(){super("facebook.com")}static credential(e){return zy._fromParams({providerId:pg.PROVIDER_ID,signInMethod:pg.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return pg.credentialFromTaggedObject(e)}static credentialFromError(e){return pg.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return pg.credential(e.oauthAccessToken)}catch{return null}}}pg.FACEBOOK_SIGN_IN_METHOD="facebook.com";pg.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mg extends vR{constructor(){super("google.com"),this.addScope("profile")}static credential(e,i){return zy._fromParams({providerId:mg.PROVIDER_ID,signInMethod:mg.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:i})}static credentialFromResult(e){return mg.credentialFromTaggedObject(e)}static credentialFromError(e){return mg.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:i,oauthAccessToken:o}=e;if(!i&&!o)return null;try{return mg.credential(i,o)}catch{return null}}}mg.GOOGLE_SIGN_IN_METHOD="google.com";mg.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gg extends vR{constructor(){super("github.com")}static credential(e){return zy._fromParams({providerId:gg.PROVIDER_ID,signInMethod:gg.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return gg.credentialFromTaggedObject(e)}static credentialFromError(e){return gg.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return gg.credential(e.oauthAccessToken)}catch{return null}}}gg.GITHUB_SIGN_IN_METHOD="github.com";gg.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _g extends vR{constructor(){super("twitter.com")}static credential(e,i){return zy._fromParams({providerId:_g.PROVIDER_ID,signInMethod:_g.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:i})}static credentialFromResult(e){return _g.credentialFromTaggedObject(e)}static credentialFromError(e){return _g.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:i,oauthTokenSecret:o}=e;if(!i||!o)return null;try{return _g.credential(i,o)}catch{return null}}}_g.TWITTER_SIGN_IN_METHOD="twitter.com";_g.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function YFe(n,e){return ER(n,"POST","/v1/accounts:signUp",Jp(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gy{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,i,o,l=!1){const d=await Pp._fromIdTokenResponse(e,o,l),p=XX(o);return new Gy({user:d,providerId:p,_tokenResponse:o,operationType:i})}static async _forOperation(e,i,o){await e._updateTokensIfNecessary(o,!0);const l=XX(o);return new Gy({user:e,providerId:l,_tokenResponse:o,operationType:i})}}function XX(n){return n.providerId?n.providerId:"phoneNumber"in n?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class t1 extends _f{constructor(e,i,o,l){var d;super(i.code,i.message),this.operationType=o,this.user=l,Object.setPrototypeOf(this,t1.prototype),this.customData={appName:e.name,tenantId:(d=e.tenantId)!==null&&d!==void 0?d:void 0,_serverResponse:i.customData._serverResponse,operationType:o}}static _fromErrorAndOperation(e,i,o,l){return new t1(e,i,o,l)}}function Sie(n,e,i,o){return(e==="reauthenticate"?i._getReauthenticationResolver(n):i._getIdTokenResponse(n)).catch(d=>{throw d.code==="auth/multi-factor-auth-required"?t1._fromErrorAndOperation(n,d,e,o):d})}async function XFe(n,e,i=!1){const o=await BC(n,e._linkToIdToken(n.auth,await n.getIdToken()),i);return Gy._forOperation(n,"link",o)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function JFe(n,e,i=!1){const{auth:o}=n;if(Ll(o.app))return Promise.reject(Up(o));const l="reauthenticate";try{const d=await BC(n,Sie(o,l,e,n),i);Bn(d.idToken,o,"internal-error");const p=g4(d.idToken);Bn(p,o,"internal-error");const{sub:_}=p;return Bn(n.uid===_,o,"user-mismatch"),Gy._forOperation(n,l,d)}catch(d){throw(d==null?void 0:d.code)==="auth/user-not-found"&&Vd(o,"user-mismatch"),d}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function bie(n,e,i=!1){if(Ll(n.app))return Promise.reject(Up(n));const o="signIn",l=await Sie(n,o,e),d=await Gy._fromIdTokenResponse(n,o,l);return i||await n._updateCurrentUser(d.user),d}async function QFe(n,e){return bie(Bg(n),e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Tie(n){const e=Bg(n);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}async function ZFe(n,e,i){const o=Bg(n);await e1(o,{requestType:"PASSWORD_RESET",email:e,clientType:"CLIENT_TYPE_WEB"},"getOobCode",zFe)}async function eje(n,e,i){if(Ll(n.app))return Promise.reject(Up(n));const o=Bg(n),p=await e1(o,{returnSecureToken:!0,email:e,password:i,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",YFe).catch(E=>{throw E.code==="auth/password-does-not-meet-requirements"&&Tie(n),E}),_=await Gy._fromIdTokenResponse(o,"signIn",p);return await o._updateCurrentUser(_.user),_}function tje(n,e,i){return Ll(n.app)?Promise.reject(Up(n)):QFe(zi(n),K0.credential(e,i)).catch(async o=>{throw o.code==="auth/password-does-not-meet-requirements"&&Tie(n),o})}async function wie(n,e){const i=zi(n),l={requestType:"VERIFY_EMAIL",idToken:await n.getIdToken()},{email:d}=await WFe(i.auth,l);d!==n.email&&await n.reload()}function nje(n,e,i,o){return zi(n).onIdTokenChanged(e,i,o)}function rje(n,e,i){return zi(n).beforeAuthStateChanged(e,i)}function ije(n,e,i,o){return zi(n).onAuthStateChanged(e,i,o)}function sje(n){return zi(n).signOut()}const n1="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cie{constructor(e,i){this.storageRetriever=e,this.type=i}_isAvailable(){try{return this.storage?(this.storage.setItem(n1,"1"),this.storage.removeItem(n1),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,i){return this.storage.setItem(e,JSON.stringify(i)),Promise.resolve()}_get(e){const i=this.storage.getItem(e);return Promise.resolve(i?JSON.parse(i):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const oje=1e3,aje=10;class Rie extends Cie{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,i)=>this.onStorageEvent(e,i),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=pie(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const i of Object.keys(this.listeners)){const o=this.storage.getItem(i),l=this.localCache[i];o!==l&&e(i,l,o)}}onStorageEvent(e,i=!1){if(!e.key){this.forAllChangedKeys((p,_,E)=>{this.notifyListeners(p,E)});return}const o=e.key;i?this.detachListener():this.stopPolling();const l=()=>{const p=this.storage.getItem(o);!i&&this.localCache[o]===p||this.notifyListeners(o,p)},d=this.storage.getItem(o);SFe()&&d!==e.newValue&&e.newValue!==e.oldValue?setTimeout(l,aje):l()}notifyListeners(e,i){this.localCache[e]=i;const o=this.listeners[e];if(o)for(const l of Array.from(o))l(i&&JSON.parse(i))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,i,o)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:i,newValue:o}),!0)})},oje)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,i){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(i)}_removeListener(e,i){this.listeners[e]&&(this.listeners[e].delete(i),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,i){await super._set(e,i),this.localCache[e]=JSON.stringify(i)}async _get(e){const i=await super._get(e);return this.localCache[e]=JSON.stringify(i),i}async _remove(e){await super._remove(e),delete this.localCache[e]}}Rie.type="LOCAL";const cje=Rie;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Iie extends Cie{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,i){}_removeListener(e,i){}}Iie.type="SESSION";const Aie=Iie;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function lje(n){return Promise.all(n.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(i){return{fulfilled:!1,reason:i}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iN{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const i=this.receivers.find(l=>l.isListeningto(e));if(i)return i;const o=new iN(e);return this.receivers.push(o),o}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const i=e,{eventId:o,eventType:l,data:d}=i.data,p=this.handlersMap[l];if(!(p!=null&&p.size))return;i.ports[0].postMessage({status:"ack",eventId:o,eventType:l});const _=Array.from(p).map(async b=>b(i.origin,d)),E=await lje(_);i.ports[0].postMessage({status:"done",eventId:o,eventType:l,response:E})}_subscribe(e,i){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(i)}_unsubscribe(e,i){this.handlersMap[e]&&i&&this.handlersMap[e].delete(i),(!i||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}iN.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function v4(n="",e=10){let i="";for(let o=0;o<e;o++)i+=Math.floor(Math.random()*10);return n+i}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uje{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,i,o=50){const l=typeof MessageChannel<"u"?new MessageChannel:null;if(!l)throw new Error("connection_unavailable");let d,p;return new Promise((_,E)=>{const b=v4("",20);l.port1.start();const C=setTimeout(()=>{E(new Error("unsupported_event"))},o);p={messageChannel:l,onMessage(I){const O=I;if(O.data.eventId===b)switch(O.data.status){case"ack":clearTimeout(C),d=setTimeout(()=>{E(new Error("timeout"))},3e3);break;case"done":clearTimeout(d),_(O.data.response);break;default:clearTimeout(C),clearTimeout(d),E(new Error("invalid_response"));break}}},this.handlers.add(p),l.port1.addEventListener("message",p.onMessage),this.target.postMessage({eventType:e,eventId:b,data:i},[l.port2])}).finally(()=>{p&&this.removeMessageHandler(p)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function lf(){return window}function dje(n){lf().location.href=n}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Pie(){return typeof lf().WorkerGlobalScope<"u"&&typeof lf().importScripts=="function"}async function hje(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function fje(){var n;return((n=navigator==null?void 0:navigator.serviceWorker)===null||n===void 0?void 0:n.controller)||null}function pje(){return Pie()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Oie="firebaseLocalStorageDb",mje=1,r1="firebaseLocalStorage",kie="fbase_key";class SR{constructor(e){this.request=e}toPromise(){return new Promise((e,i)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{i(this.request.error)})})}}function sN(n,e){return n.transaction([r1],e?"readwrite":"readonly").objectStore(r1)}function gje(){const n=indexedDB.deleteDatabase(Oie);return new SR(n).toPromise()}function YV(){const n=indexedDB.open(Oie,mje);return new Promise((e,i)=>{n.addEventListener("error",()=>{i(n.error)}),n.addEventListener("upgradeneeded",()=>{const o=n.result;try{o.createObjectStore(r1,{keyPath:kie})}catch(l){i(l)}}),n.addEventListener("success",async()=>{const o=n.result;o.objectStoreNames.contains(r1)?e(o):(o.close(),await gje(),e(await YV()))})})}async function JX(n,e,i){const o=sN(n,!0).put({[kie]:e,value:i});return new SR(o).toPromise()}async function _je(n,e){const i=sN(n,!1).get(e),o=await new SR(i).toPromise();return o===void 0?null:o.value}function QX(n,e){const i=sN(n,!0).delete(e);return new SR(i).toPromise()}const yje=800,Eje=3;class Nie{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await YV(),this.db)}async _withRetries(e){let i=0;for(;;)try{const o=await this._openDb();return await e(o)}catch(o){if(i++>Eje)throw o;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return Pie()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=iN._getInstance(pje()),this.receiver._subscribe("keyChanged",async(e,i)=>({keyProcessed:(await this._poll()).includes(i.key)})),this.receiver._subscribe("ping",async(e,i)=>["keyChanged"])}async initializeSender(){var e,i;if(this.activeServiceWorker=await hje(),!this.activeServiceWorker)return;this.sender=new uje(this.activeServiceWorker);const o=await this.sender._send("ping",{},800);o&&!((e=o[0])===null||e===void 0)&&e.fulfilled&&!((i=o[0])===null||i===void 0)&&i.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||fje()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await YV();return await JX(e,n1,"1"),await QX(e,n1),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,i){return this._withPendingWrite(async()=>(await this._withRetries(o=>JX(o,e,i)),this.localCache[e]=i,this.notifyServiceWorker(e)))}async _get(e){const i=await this._withRetries(o=>_je(o,e));return this.localCache[e]=i,i}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(i=>QX(i,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(l=>{const d=sN(l,!1).getAll();return new SR(d).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const i=[],o=new Set;if(e.length!==0)for(const{fbase_key:l,value:d}of e)o.add(l),JSON.stringify(this.localCache[l])!==JSON.stringify(d)&&(this.notifyListeners(l,d),i.push(l));for(const l of Object.keys(this.localCache))this.localCache[l]&&!o.has(l)&&(this.notifyListeners(l,null),i.push(l));return i}notifyListeners(e,i){this.localCache[e]=i;const o=this.listeners[e];if(o)for(const l of Array.from(o))l(i)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),yje)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,i){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(i)}_removeListener(e,i){this.listeners[e]&&(this.listeners[e].delete(i),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}Nie.type="LOCAL";const vje=Nie;new yR(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Sje(n,e){return e?Op(e):(Bn(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class S4 extends y4{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return c0(e,this._buildIdpRequest())}_linkToIdToken(e,i){return c0(e,this._buildIdpRequest(i))}_getReauthenticationResolver(e){return c0(e,this._buildIdpRequest())}_buildIdpRequest(e){const i={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(i.idToken=e),i}}function bje(n){return bie(n.auth,new S4(n),n.bypassAuthState)}function Tje(n){const{auth:e,user:i}=n;return Bn(i,e,"internal-error"),JFe(i,new S4(n),n.bypassAuthState)}async function wje(n){const{auth:e,user:i}=n;return Bn(i,e,"internal-error"),XFe(i,new S4(n),n.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Die{constructor(e,i,o,l,d=!1){this.auth=e,this.resolver=o,this.user=l,this.bypassAuthState=d,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(i)?i:[i]}execute(){return new Promise(async(e,i)=>{this.pendingPromise={resolve:e,reject:i};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(o){this.reject(o)}})}async onAuthEvent(e){const{urlResponse:i,sessionId:o,postBody:l,tenantId:d,error:p,type:_}=e;if(p){this.reject(p);return}const E={auth:this.auth,requestUri:i,sessionId:o,tenantId:d||void 0,postBody:l||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(_)(E))}catch(b){this.reject(b)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return bje;case"linkViaPopup":case"linkViaRedirect":return wje;case"reauthViaPopup":case"reauthViaRedirect":return Tje;default:Vd(this.auth,"internal-error")}}resolve(e){$p(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){$p(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Cje=new yR(2e3,1e4);class qS extends Die{constructor(e,i,o,l,d){super(e,i,l,d),this.provider=o,this.authWindow=null,this.pollId=null,qS.currentPopupAction&&qS.currentPopupAction.cancel(),qS.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return Bn(e,this.auth,"internal-error"),e}async onExecution(){$p(this.filter.length===1,"Popup operations only handle one event");const e=v4();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(i=>{this.reject(i)}),this.resolver._isIframeWebStorageSupported(this.auth,i=>{i||this.reject(cf(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)===null||e===void 0?void 0:e.associatedEvent)||null}cancel(){this.reject(cf(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,qS.currentPopupAction=null}pollUserCancellation(){const e=()=>{var i,o;if(!((o=(i=this.authWindow)===null||i===void 0?void 0:i.window)===null||o===void 0)&&o.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(cf(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,Cje.get())};e()}}qS.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Rje="pendingRedirect",bk=new Map;class Ije extends Die{constructor(e,i,o=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],i,void 0,o),this.eventId=null}async execute(){let e=bk.get(this.auth._key());if(!e){try{const o=await Aje(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(o)}catch(i){e=()=>Promise.reject(i)}bk.set(this.auth._key(),e)}return this.bypassAuthState||bk.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const i=await this.auth._redirectUserForId(e.eventId);if(i)return this.user=i,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function Aje(n,e){const i=kje(e),o=Oje(n);if(!await o._isAvailable())return!1;const l=await o._get(i)==="true";return await o._remove(i),l}function Pje(n,e){bk.set(n._key(),e)}function Oje(n){return Op(n._redirectPersistence)}function kje(n){return Sk(Rje,n.config.apiKey,n.name)}async function Nje(n,e,i=!1){if(Ll(n.app))return Promise.reject(Up(n));const o=Bg(n),l=Sje(o,e),p=await new Ije(o,l,i).execute();return p&&!i&&(delete p.user._redirectEventId,await o._persistUserIfCurrent(p.user),await o._setRedirectUser(null,e)),p}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Dje=10*60*1e3;class xje{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let i=!1;return this.consumers.forEach(o=>{this.isEventForConsumer(e,o)&&(i=!0,this.sendToConsumer(e,o),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!Lje(e)||(this.hasHandledPotentialRedirect=!0,i||(this.queuedRedirectEvent=e,i=!0)),i}sendToConsumer(e,i){var o;if(e.error&&!xie(e)){const l=((o=e.error.code)===null||o===void 0?void 0:o.split("auth/")[1])||"internal-error";i.onError(cf(this.auth,l))}else i.onAuthEvent(e)}isEventForConsumer(e,i){const o=i.eventId===null||!!e.eventId&&e.eventId===i.eventId;return i.filter.includes(e.type)&&o}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=Dje&&this.cachedEventUids.clear(),this.cachedEventUids.has(ZX(e))}saveEventToCache(e){this.cachedEventUids.add(ZX(e)),this.lastProcessedEventTime=Date.now()}}function ZX(n){return[n.type,n.eventId,n.sessionId,n.tenantId].filter(e=>e).join("-")}function xie({type:n,error:e}){return n==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function Lje(n){switch(n.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return xie(n);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Mje(n,e={}){return Qp(n,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Uje=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,Vje=/^https?/;async function Fje(n){if(n.config.emulator)return;const{authorizedDomains:e}=await Mje(n);for(const i of e)try{if(jje(i))return}catch{}Vd(n,"unauthorized-domain")}function jje(n){const e=KV(),{protocol:i,hostname:o}=new URL(e);if(n.startsWith("chrome-extension://")){const p=new URL(n);return p.hostname===""&&o===""?i==="chrome-extension:"&&n.replace("chrome-extension://","")===e.replace("chrome-extension://",""):i==="chrome-extension:"&&p.hostname===o}if(!Vje.test(i))return!1;if(Uje.test(n))return o===n;const l=n.replace(/\./g,"\\.");return new RegExp("^(.+\\."+l+"|"+l+")$","i").test(o)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Bje=new yR(3e4,6e4);function eJ(){const n=lf().___jsl;if(n!=null&&n.H){for(const e of Object.keys(n.H))if(n.H[e].r=n.H[e].r||[],n.H[e].L=n.H[e].L||[],n.H[e].r=[...n.H[e].L],n.CP)for(let i=0;i<n.CP.length;i++)n.CP[i]=null}}function Wje(n){return new Promise((e,i)=>{var o,l,d;function p(){eJ(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{eJ(),i(cf(n,"network-request-failed"))},timeout:Bje.get()})}if(!((l=(o=lf().gapi)===null||o===void 0?void 0:o.iframes)===null||l===void 0)&&l.Iframe)e(gapi.iframes.getContext());else if(!((d=lf().gapi)===null||d===void 0)&&d.load)p();else{const _=OFe("iframefcb");return lf()[_]=()=>{gapi.load?p():i(cf(n,"network-request-failed"))},gie(`${PFe()}?onload=${_}`).catch(E=>i(E))}}).catch(e=>{throw Tk=null,e})}let Tk=null;function zje(n){return Tk=Tk||Wje(n),Tk}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Gje=new yR(5e3,15e3),Hje="__/auth/iframe",$je="emulator/auth/iframe",Kje={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},qje=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function Yje(n){const e=n.config;Bn(e.authDomain,n,"auth-domain-config-required");const i=e.emulator?m4(e,$je):`https://${n.config.authDomain}/${Hje}`,o={apiKey:e.apiKey,appName:n.name,v:Qy},l=qje.get(n.config.apiHost);l&&(o.eid=l);const d=n._getFrameworks();return d.length&&(o.fw=d.join(",")),`${i}?${_R(o).slice(1)}`}async function Xje(n){const e=await zje(n),i=lf().gapi;return Bn(i,n,"internal-error"),e.open({where:document.body,url:Yje(n),messageHandlersFilter:i.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:Kje,dontclear:!0},o=>new Promise(async(l,d)=>{await o.restyle({setHideOnLeave:!1});const p=cf(n,"network-request-failed"),_=lf().setTimeout(()=>{d(p)},Gje.get());function E(){lf().clearTimeout(_),l(o)}o.ping(E).then(E,()=>{d(p)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Jje={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},Qje=500,Zje=600,e4e="_blank",t4e="http://localhost";class tJ{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function n4e(n,e,i,o=Qje,l=Zje){const d=Math.max((window.screen.availHeight-l)/2,0).toString(),p=Math.max((window.screen.availWidth-o)/2,0).toString();let _="";const E=Object.assign(Object.assign({},Jje),{width:o.toString(),height:l.toString(),top:d,left:p}),b=tc().toLowerCase();i&&(_=lie(b)?e4e:i),aie(b)&&(e=e||t4e,E.scrollbars="yes");const C=Object.entries(E).reduce((O,[L,V])=>`${O}${L}=${V},`,"");if(vFe(b)&&_!=="_self")return r4e(e||"",_),new tJ(null);const I=window.open(e||"",_,C);Bn(I,n,"popup-blocked");try{I.focus()}catch{}return new tJ(I)}function r4e(n,e){const i=document.createElement("a");i.href=n,i.target=e;const o=document.createEvent("MouseEvent");o.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),i.dispatchEvent(o)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const i4e="__/auth/handler",s4e="emulator/auth/handler",o4e=encodeURIComponent("fac");async function nJ(n,e,i,o,l,d){Bn(n.config.authDomain,n,"auth-domain-config-required"),Bn(n.config.apiKey,n,"invalid-api-key");const p={apiKey:n.config.apiKey,appName:n.name,authType:i,redirectUrl:o,v:Qy,eventId:l};if(e instanceof vie){e.setDefaultLanguage(n.languageCode),p.providerId=e.providerId||"",zUe(e.getCustomParameters())||(p.customParameters=JSON.stringify(e.getCustomParameters()));for(const[C,I]of Object.entries({}))p[C]=I}if(e instanceof vR){const C=e.getScopes().filter(I=>I!=="");C.length>0&&(p.scopes=C.join(","))}n.tenantId&&(p.tid=n.tenantId);const _=p;for(const C of Object.keys(_))_[C]===void 0&&delete _[C];const E=await n._getAppCheckToken(),b=E?`#${o4e}=${encodeURIComponent(E)}`:"";return`${a4e(n)}?${_R(_).slice(1)}${b}`}function a4e({config:n}){return n.emulator?m4(n,s4e):`https://${n.authDomain}/${i4e}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const CU="webStorageSupport";class c4e{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=Aie,this._completeRedirectFn=Nje,this._overrideRedirectResult=Pje}async _openPopup(e,i,o,l){var d;$p((d=this.eventManagers[e._key()])===null||d===void 0?void 0:d.manager,"_initialize() not called before _openPopup()");const p=await nJ(e,i,o,KV(),l);return n4e(e,p,v4())}async _openRedirect(e,i,o,l){await this._originValidation(e);const d=await nJ(e,i,o,KV(),l);return dje(d),new Promise(()=>{})}_initialize(e){const i=e._key();if(this.eventManagers[i]){const{manager:l,promise:d}=this.eventManagers[i];return l?Promise.resolve(l):($p(d,"If manager is not set, promise should be"),d)}const o=this.initAndGetManager(e);return this.eventManagers[i]={promise:o},o.catch(()=>{delete this.eventManagers[i]}),o}async initAndGetManager(e){const i=await Xje(e),o=new xje(e);return i.register("authEvent",l=>(Bn(l==null?void 0:l.authEvent,e,"invalid-auth-event"),{status:o.onEvent(l.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:o},this.iframes[e._key()]=i,o}_isIframeWebStorageSupported(e,i){this.iframes[e._key()].send(CU,{type:CU},l=>{var d;const p=(d=l==null?void 0:l[0])===null||d===void 0?void 0:d[CU];p!==void 0&&i(!!p),Vd(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const i=e._key();return this.originValidationPromises[i]||(this.originValidationPromises[i]=Fje(e)),this.originValidationPromises[i]}get _shouldInitProactively(){return pie()||cie()||_4()}}const l4e=c4e;var rJ="@firebase/auth",iJ="1.9.1";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class u4e{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)===null||e===void 0?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const i=this.auth.onIdTokenChanged(o=>{e((o==null?void 0:o.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,i),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const i=this.internalListeners.get(e);i&&(this.internalListeners.delete(e),i(),this.updateProactiveRefresh())}assertAuthConfigured(){Bn(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function d4e(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function h4e(n){Wy(new Og("auth",(e,{options:i})=>{const o=e.getProvider("app").getImmediate(),l=e.getProvider("heartbeat"),d=e.getProvider("app-check-internal"),{apiKey:p,authDomain:_}=o.options;Bn(p&&!p.includes(":"),"invalid-api-key",{appName:o.name});const E={apiKey:p,authDomain:_,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:mie(n)},b=new RFe(o,l,d,E);return MFe(b,i),b},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,i,o)=>{e.getProvider("auth-internal").initialize()})),Wy(new Og("auth-internal",e=>{const i=Bg(e.getProvider("auth").getImmediate());return(o=>new u4e(o))(i)},"PRIVATE").setInstantiationMode("EXPLICIT")),af(rJ,iJ,d4e(n)),af(rJ,iJ,"esm2017")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const f4e=5*60,p4e=Hre("authIdTokenMaxAge")||f4e;let sJ=null;const m4e=n=>async e=>{const i=e&&await e.getIdTokenResult(),o=i&&(new Date().getTime()-Date.parse(i.issuedAtTime))/1e3;if(o&&o>p4e)return;const l=i==null?void 0:i.token;sJ!==l&&(sJ=l,await fetch(n,{method:l?"POST":"DELETE",headers:l?{Authorization:`Bearer ${l}`}:{}}))};function oN(n=f4()){const e=nN(n,"auth");if(e.isInitialized())return e.getImmediate();const i=LFe(n,{popupRedirectResolver:l4e,persistence:[vje,cje,Aie]}),o=Hre("authTokenSyncURL");if(o&&typeof isSecureContext=="boolean"&&isSecureContext){const d=new URL(o,location.origin);if(location.origin===d.origin){const p=m4e(d.toString());rje(i,p,()=>p(i.currentUser)),nje(i,_=>p(_))}}const l=Wre("auth");return l&&UFe(i,`http://${l}`),i}function g4e(){var n,e;return(e=(n=document.getElementsByTagName("head"))===null||n===void 0?void 0:n[0])!==null&&e!==void 0?e:document}IFe({loadJS(n){return new Promise((e,i)=>{const o=document.createElement("script");o.setAttribute("src",n),o.onload=e,o.onerror=l=>{const d=cf("internal-error");d.customData=l,i(d)},o.type="text/javascript",o.charset="UTF-8",g4e().appendChild(o)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});h4e("Browser");var oJ=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var wg,Lie;(function(){var n;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(q,Q){function J(){}J.prototype=Q.prototype,q.D=Q.prototype,q.prototype=new J,q.prototype.constructor=q,q.C=function(ie,me,de){for(var le=Array(arguments.length-2),xe=2;xe<arguments.length;xe++)le[xe-2]=arguments[xe];return Q.prototype[me].apply(ie,le)}}function i(){this.blockSize=-1}function o(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(o,i),o.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function l(q,Q,J){J||(J=0);var ie=Array(16);if(typeof Q=="string")for(var me=0;16>me;++me)ie[me]=Q.charCodeAt(J++)|Q.charCodeAt(J++)<<8|Q.charCodeAt(J++)<<16|Q.charCodeAt(J++)<<24;else for(me=0;16>me;++me)ie[me]=Q[J++]|Q[J++]<<8|Q[J++]<<16|Q[J++]<<24;Q=q.g[0],J=q.g[1],me=q.g[2];var de=q.g[3],le=Q+(de^J&(me^de))+ie[0]+3614090360&4294967295;Q=J+(le<<7&4294967295|le>>>25),le=de+(me^Q&(J^me))+ie[1]+3905402710&4294967295,de=Q+(le<<12&4294967295|le>>>20),le=me+(J^de&(Q^J))+ie[2]+606105819&4294967295,me=de+(le<<17&4294967295|le>>>15),le=J+(Q^me&(de^Q))+ie[3]+3250441966&4294967295,J=me+(le<<22&4294967295|le>>>10),le=Q+(de^J&(me^de))+ie[4]+4118548399&4294967295,Q=J+(le<<7&4294967295|le>>>25),le=de+(me^Q&(J^me))+ie[5]+1200080426&4294967295,de=Q+(le<<12&4294967295|le>>>20),le=me+(J^de&(Q^J))+ie[6]+2821735955&4294967295,me=de+(le<<17&4294967295|le>>>15),le=J+(Q^me&(de^Q))+ie[7]+4249261313&4294967295,J=me+(le<<22&4294967295|le>>>10),le=Q+(de^J&(me^de))+ie[8]+1770035416&4294967295,Q=J+(le<<7&4294967295|le>>>25),le=de+(me^Q&(J^me))+ie[9]+2336552879&4294967295,de=Q+(le<<12&4294967295|le>>>20),le=me+(J^de&(Q^J))+ie[10]+4294925233&4294967295,me=de+(le<<17&4294967295|le>>>15),le=J+(Q^me&(de^Q))+ie[11]+2304563134&4294967295,J=me+(le<<22&4294967295|le>>>10),le=Q+(de^J&(me^de))+ie[12]+1804603682&4294967295,Q=J+(le<<7&4294967295|le>>>25),le=de+(me^Q&(J^me))+ie[13]+4254626195&4294967295,de=Q+(le<<12&4294967295|le>>>20),le=me+(J^de&(Q^J))+ie[14]+2792965006&4294967295,me=de+(le<<17&4294967295|le>>>15),le=J+(Q^me&(de^Q))+ie[15]+1236535329&4294967295,J=me+(le<<22&4294967295|le>>>10),le=Q+(me^de&(J^me))+ie[1]+4129170786&4294967295,Q=J+(le<<5&4294967295|le>>>27),le=de+(J^me&(Q^J))+ie[6]+3225465664&4294967295,de=Q+(le<<9&4294967295|le>>>23),le=me+(Q^J&(de^Q))+ie[11]+643717713&4294967295,me=de+(le<<14&4294967295|le>>>18),le=J+(de^Q&(me^de))+ie[0]+3921069994&4294967295,J=me+(le<<20&4294967295|le>>>12),le=Q+(me^de&(J^me))+ie[5]+3593408605&4294967295,Q=J+(le<<5&4294967295|le>>>27),le=de+(J^me&(Q^J))+ie[10]+38016083&4294967295,de=Q+(le<<9&4294967295|le>>>23),le=me+(Q^J&(de^Q))+ie[15]+3634488961&4294967295,me=de+(le<<14&4294967295|le>>>18),le=J+(de^Q&(me^de))+ie[4]+3889429448&4294967295,J=me+(le<<20&4294967295|le>>>12),le=Q+(me^de&(J^me))+ie[9]+568446438&4294967295,Q=J+(le<<5&4294967295|le>>>27),le=de+(J^me&(Q^J))+ie[14]+3275163606&4294967295,de=Q+(le<<9&4294967295|le>>>23),le=me+(Q^J&(de^Q))+ie[3]+4107603335&4294967295,me=de+(le<<14&4294967295|le>>>18),le=J+(de^Q&(me^de))+ie[8]+1163531501&4294967295,J=me+(le<<20&4294967295|le>>>12),le=Q+(me^de&(J^me))+ie[13]+2850285829&4294967295,Q=J+(le<<5&4294967295|le>>>27),le=de+(J^me&(Q^J))+ie[2]+4243563512&4294967295,de=Q+(le<<9&4294967295|le>>>23),le=me+(Q^J&(de^Q))+ie[7]+1735328473&4294967295,me=de+(le<<14&4294967295|le>>>18),le=J+(de^Q&(me^de))+ie[12]+2368359562&4294967295,J=me+(le<<20&4294967295|le>>>12),le=Q+(J^me^de)+ie[5]+4294588738&4294967295,Q=J+(le<<4&4294967295|le>>>28),le=de+(Q^J^me)+ie[8]+2272392833&4294967295,de=Q+(le<<11&4294967295|le>>>21),le=me+(de^Q^J)+ie[11]+1839030562&4294967295,me=de+(le<<16&4294967295|le>>>16),le=J+(me^de^Q)+ie[14]+4259657740&4294967295,J=me+(le<<23&4294967295|le>>>9),le=Q+(J^me^de)+ie[1]+2763975236&4294967295,Q=J+(le<<4&4294967295|le>>>28),le=de+(Q^J^me)+ie[4]+1272893353&4294967295,de=Q+(le<<11&4294967295|le>>>21),le=me+(de^Q^J)+ie[7]+4139469664&4294967295,me=de+(le<<16&4294967295|le>>>16),le=J+(me^de^Q)+ie[10]+3200236656&4294967295,J=me+(le<<23&4294967295|le>>>9),le=Q+(J^me^de)+ie[13]+681279174&4294967295,Q=J+(le<<4&4294967295|le>>>28),le=de+(Q^J^me)+ie[0]+3936430074&4294967295,de=Q+(le<<11&4294967295|le>>>21),le=me+(de^Q^J)+ie[3]+3572445317&4294967295,me=de+(le<<16&4294967295|le>>>16),le=J+(me^de^Q)+ie[6]+76029189&4294967295,J=me+(le<<23&4294967295|le>>>9),le=Q+(J^me^de)+ie[9]+3654602809&4294967295,Q=J+(le<<4&4294967295|le>>>28),le=de+(Q^J^me)+ie[12]+3873151461&4294967295,de=Q+(le<<11&4294967295|le>>>21),le=me+(de^Q^J)+ie[15]+530742520&4294967295,me=de+(le<<16&4294967295|le>>>16),le=J+(me^de^Q)+ie[2]+3299628645&4294967295,J=me+(le<<23&4294967295|le>>>9),le=Q+(me^(J|~de))+ie[0]+4096336452&4294967295,Q=J+(le<<6&4294967295|le>>>26),le=de+(J^(Q|~me))+ie[7]+1126891415&4294967295,de=Q+(le<<10&4294967295|le>>>22),le=me+(Q^(de|~J))+ie[14]+2878612391&4294967295,me=de+(le<<15&4294967295|le>>>17),le=J+(de^(me|~Q))+ie[5]+4237533241&4294967295,J=me+(le<<21&4294967295|le>>>11),le=Q+(me^(J|~de))+ie[12]+1700485571&4294967295,Q=J+(le<<6&4294967295|le>>>26),le=de+(J^(Q|~me))+ie[3]+2399980690&4294967295,de=Q+(le<<10&4294967295|le>>>22),le=me+(Q^(de|~J))+ie[10]+4293915773&4294967295,me=de+(le<<15&4294967295|le>>>17),le=J+(de^(me|~Q))+ie[1]+2240044497&4294967295,J=me+(le<<21&4294967295|le>>>11),le=Q+(me^(J|~de))+ie[8]+1873313359&4294967295,Q=J+(le<<6&4294967295|le>>>26),le=de+(J^(Q|~me))+ie[15]+4264355552&4294967295,de=Q+(le<<10&4294967295|le>>>22),le=me+(Q^(de|~J))+ie[6]+2734768916&4294967295,me=de+(le<<15&4294967295|le>>>17),le=J+(de^(me|~Q))+ie[13]+1309151649&4294967295,J=me+(le<<21&4294967295|le>>>11),le=Q+(me^(J|~de))+ie[4]+4149444226&4294967295,Q=J+(le<<6&4294967295|le>>>26),le=de+(J^(Q|~me))+ie[11]+3174756917&4294967295,de=Q+(le<<10&4294967295|le>>>22),le=me+(Q^(de|~J))+ie[2]+718787259&4294967295,me=de+(le<<15&4294967295|le>>>17),le=J+(de^(me|~Q))+ie[9]+3951481745&4294967295,q.g[0]=q.g[0]+Q&4294967295,q.g[1]=q.g[1]+(me+(le<<21&4294967295|le>>>11))&4294967295,q.g[2]=q.g[2]+me&4294967295,q.g[3]=q.g[3]+de&4294967295}o.prototype.u=function(q,Q){Q===void 0&&(Q=q.length);for(var J=Q-this.blockSize,ie=this.B,me=this.h,de=0;de<Q;){if(me==0)for(;de<=J;)l(this,q,de),de+=this.blockSize;if(typeof q=="string"){for(;de<Q;)if(ie[me++]=q.charCodeAt(de++),me==this.blockSize){l(this,ie),me=0;break}}else for(;de<Q;)if(ie[me++]=q[de++],me==this.blockSize){l(this,ie),me=0;break}}this.h=me,this.o+=Q},o.prototype.v=function(){var q=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);q[0]=128;for(var Q=1;Q<q.length-8;++Q)q[Q]=0;var J=8*this.o;for(Q=q.length-8;Q<q.length;++Q)q[Q]=J&255,J/=256;for(this.u(q),q=Array(16),Q=J=0;4>Q;++Q)for(var ie=0;32>ie;ie+=8)q[J++]=this.g[Q]>>>ie&255;return q};function d(q,Q){var J=_;return Object.prototype.hasOwnProperty.call(J,q)?J[q]:J[q]=Q(q)}function p(q,Q){this.h=Q;for(var J=[],ie=!0,me=q.length-1;0<=me;me--){var de=q[me]|0;ie&&de==Q||(J[me]=de,ie=!1)}this.g=J}var _={};function E(q){return-128<=q&&128>q?d(q,function(Q){return new p([Q|0],0>Q?-1:0)}):new p([q|0],0>q?-1:0)}function b(q){if(isNaN(q)||!isFinite(q))return I;if(0>q)return W(b(-q));for(var Q=[],J=1,ie=0;q>=J;ie++)Q[ie]=q/J|0,J*=4294967296;return new p(Q,0)}function C(q,Q){if(q.length==0)throw Error("number format error: empty string");if(Q=Q||10,2>Q||36<Q)throw Error("radix out of range: "+Q);if(q.charAt(0)=="-")return W(C(q.substring(1),Q));if(0<=q.indexOf("-"))throw Error('number format error: interior "-" character');for(var J=b(Math.pow(Q,8)),ie=I,me=0;me<q.length;me+=8){var de=Math.min(8,q.length-me),le=parseInt(q.substring(me,me+de),Q);8>de?(de=b(Math.pow(Q,de)),ie=ie.j(de).add(b(le))):(ie=ie.j(J),ie=ie.add(b(le)))}return ie}var I=E(0),O=E(1),L=E(16777216);n=p.prototype,n.m=function(){if(B(this))return-W(this).m();for(var q=0,Q=1,J=0;J<this.g.length;J++){var ie=this.i(J);q+=(0<=ie?ie:4294967296+ie)*Q,Q*=4294967296}return q},n.toString=function(q){if(q=q||10,2>q||36<q)throw Error("radix out of range: "+q);if(V(this))return"0";if(B(this))return"-"+W(this).toString(q);for(var Q=b(Math.pow(q,6)),J=this,ie="";;){var me=ue(J,Q).g;J=Z(J,me.j(Q));var de=((0<J.g.length?J.g[0]:J.h)>>>0).toString(q);if(J=me,V(J))return de+ie;for(;6>de.length;)de="0"+de;ie=de+ie}},n.i=function(q){return 0>q?0:q<this.g.length?this.g[q]:this.h};function V(q){if(q.h!=0)return!1;for(var Q=0;Q<q.g.length;Q++)if(q.g[Q]!=0)return!1;return!0}function B(q){return q.h==-1}n.l=function(q){return q=Z(this,q),B(q)?-1:V(q)?0:1};function W(q){for(var Q=q.g.length,J=[],ie=0;ie<Q;ie++)J[ie]=~q.g[ie];return new p(J,~q.h).add(O)}n.abs=function(){return B(this)?W(this):this},n.add=function(q){for(var Q=Math.max(this.g.length,q.g.length),J=[],ie=0,me=0;me<=Q;me++){var de=ie+(this.i(me)&65535)+(q.i(me)&65535),le=(de>>>16)+(this.i(me)>>>16)+(q.i(me)>>>16);ie=le>>>16,de&=65535,le&=65535,J[me]=le<<16|de}return new p(J,J[J.length-1]&-2147483648?-1:0)};function Z(q,Q){return q.add(W(Q))}n.j=function(q){if(V(this)||V(q))return I;if(B(this))return B(q)?W(this).j(W(q)):W(W(this).j(q));if(B(q))return W(this.j(W(q)));if(0>this.l(L)&&0>q.l(L))return b(this.m()*q.m());for(var Q=this.g.length+q.g.length,J=[],ie=0;ie<2*Q;ie++)J[ie]=0;for(ie=0;ie<this.g.length;ie++)for(var me=0;me<q.g.length;me++){var de=this.i(ie)>>>16,le=this.i(ie)&65535,xe=q.i(me)>>>16,We=q.i(me)&65535;J[2*ie+2*me]+=le*We,$(J,2*ie+2*me),J[2*ie+2*me+1]+=de*We,$(J,2*ie+2*me+1),J[2*ie+2*me+1]+=le*xe,$(J,2*ie+2*me+1),J[2*ie+2*me+2]+=de*xe,$(J,2*ie+2*me+2)}for(ie=0;ie<Q;ie++)J[ie]=J[2*ie+1]<<16|J[2*ie];for(ie=Q;ie<2*Q;ie++)J[ie]=0;return new p(J,0)};function $(q,Q){for(;(q[Q]&65535)!=q[Q];)q[Q+1]+=q[Q]>>>16,q[Q]&=65535,Q++}function se(q,Q){this.g=q,this.h=Q}function ue(q,Q){if(V(Q))throw Error("division by zero");if(V(q))return new se(I,I);if(B(q))return Q=ue(W(q),Q),new se(W(Q.g),W(Q.h));if(B(Q))return Q=ue(q,W(Q)),new se(W(Q.g),Q.h);if(30<q.g.length){if(B(q)||B(Q))throw Error("slowDivide_ only works with positive integers.");for(var J=O,ie=Q;0>=ie.l(q);)J=re(J),ie=re(ie);var me=pe(J,1),de=pe(ie,1);for(ie=pe(ie,2),J=pe(J,2);!V(ie);){var le=de.add(ie);0>=le.l(q)&&(me=me.add(J),de=le),ie=pe(ie,1),J=pe(J,1)}return Q=Z(q,me.j(Q)),new se(me,Q)}for(me=I;0<=q.l(Q);){for(J=Math.max(1,Math.floor(q.m()/Q.m())),ie=Math.ceil(Math.log(J)/Math.LN2),ie=48>=ie?1:Math.pow(2,ie-48),de=b(J),le=de.j(Q);B(le)||0<le.l(q);)J-=ie,de=b(J),le=de.j(Q);V(de)&&(de=O),me=me.add(de),q=Z(q,le)}return new se(me,q)}n.A=function(q){return ue(this,q).h},n.and=function(q){for(var Q=Math.max(this.g.length,q.g.length),J=[],ie=0;ie<Q;ie++)J[ie]=this.i(ie)&q.i(ie);return new p(J,this.h&q.h)},n.or=function(q){for(var Q=Math.max(this.g.length,q.g.length),J=[],ie=0;ie<Q;ie++)J[ie]=this.i(ie)|q.i(ie);return new p(J,this.h|q.h)},n.xor=function(q){for(var Q=Math.max(this.g.length,q.g.length),J=[],ie=0;ie<Q;ie++)J[ie]=this.i(ie)^q.i(ie);return new p(J,this.h^q.h)};function re(q){for(var Q=q.g.length+1,J=[],ie=0;ie<Q;ie++)J[ie]=q.i(ie)<<1|q.i(ie-1)>>>31;return new p(J,q.h)}function pe(q,Q){var J=Q>>5;Q%=32;for(var ie=q.g.length-J,me=[],de=0;de<ie;de++)me[de]=0<Q?q.i(de+J)>>>Q|q.i(de+J+1)<<32-Q:q.i(de+J);return new p(me,q.h)}o.prototype.digest=o.prototype.v,o.prototype.reset=o.prototype.s,o.prototype.update=o.prototype.u,Lie=o,p.prototype.add=p.prototype.add,p.prototype.multiply=p.prototype.j,p.prototype.modulo=p.prototype.A,p.prototype.compare=p.prototype.l,p.prototype.toNumber=p.prototype.m,p.prototype.toString=p.prototype.toString,p.prototype.getBits=p.prototype.i,p.fromNumber=b,p.fromString=C,wg=p}).apply(typeof oJ<"u"?oJ:typeof self<"u"?self:typeof window<"u"?window:{});var MO=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var Mie,Yw,Uie,wk,XV,Vie,Fie,jie;(function(){var n,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(A,z,ne){return A==Array.prototype||A==Object.prototype||(A[z]=ne.value),A};function i(A){A=[typeof globalThis=="object"&&globalThis,A,typeof window=="object"&&window,typeof self=="object"&&self,typeof MO=="object"&&MO];for(var z=0;z<A.length;++z){var ne=A[z];if(ne&&ne.Math==Math)return ne}throw Error("Cannot find global object")}var o=i(this);function l(A,z){if(z)e:{var ne=o;A=A.split(".");for(var ge=0;ge<A.length-1;ge++){var qe=A[ge];if(!(qe in ne))break e;ne=ne[qe]}A=A[A.length-1],ge=ne[A],z=z(ge),z!=ge&&z!=null&&e(ne,A,{configurable:!0,writable:!0,value:z})}}function d(A,z){A instanceof String&&(A+="");var ne=0,ge=!1,qe={next:function(){if(!ge&&ne<A.length){var ct=ne++;return{value:z(ct,A[ct]),done:!1}}return ge=!0,{done:!0,value:void 0}}};return qe[Symbol.iterator]=function(){return qe},qe}l("Array.prototype.values",function(A){return A||function(){return d(this,function(z,ne){return ne})}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var p=p||{},_=this||self;function E(A){var z=typeof A;return z=z!="object"?z:A?Array.isArray(A)?"array":z:"null",z=="array"||z=="object"&&typeof A.length=="number"}function b(A){var z=typeof A;return z=="object"&&A!=null||z=="function"}function C(A,z,ne){return A.call.apply(A.bind,arguments)}function I(A,z,ne){if(!A)throw Error();if(2<arguments.length){var ge=Array.prototype.slice.call(arguments,2);return function(){var qe=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(qe,ge),A.apply(z,qe)}}return function(){return A.apply(z,arguments)}}function O(A,z,ne){return O=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?C:I,O.apply(null,arguments)}function L(A,z){var ne=Array.prototype.slice.call(arguments,1);return function(){var ge=ne.slice();return ge.push.apply(ge,arguments),A.apply(this,ge)}}function V(A,z){function ne(){}ne.prototype=z.prototype,A.aa=z.prototype,A.prototype=new ne,A.prototype.constructor=A,A.Qb=function(ge,qe,ct){for(var Vt=Array(arguments.length-2),ei=2;ei<arguments.length;ei++)Vt[ei-2]=arguments[ei];return z.prototype[qe].apply(ge,Vt)}}function B(A){const z=A.length;if(0<z){const ne=Array(z);for(let ge=0;ge<z;ge++)ne[ge]=A[ge];return ne}return[]}function W(A,z){for(let ne=1;ne<arguments.length;ne++){const ge=arguments[ne];if(E(ge)){const qe=A.length||0,ct=ge.length||0;A.length=qe+ct;for(let Vt=0;Vt<ct;Vt++)A[qe+Vt]=ge[Vt]}else A.push(ge)}}class Z{constructor(z,ne){this.i=z,this.j=ne,this.h=0,this.g=null}get(){let z;return 0<this.h?(this.h--,z=this.g,this.g=z.next,z.next=null):z=this.i(),z}}function $(A){return/^[\s\xa0]*$/.test(A)}function se(){var A=_.navigator;return A&&(A=A.userAgent)?A:""}function ue(A){return ue[" "](A),A}ue[" "]=function(){};var re=se().indexOf("Gecko")!=-1&&!(se().toLowerCase().indexOf("webkit")!=-1&&se().indexOf("Edge")==-1)&&!(se().indexOf("Trident")!=-1||se().indexOf("MSIE")!=-1)&&se().indexOf("Edge")==-1;function pe(A,z,ne){for(const ge in A)z.call(ne,A[ge],ge,A)}function q(A,z){for(const ne in A)z.call(void 0,A[ne],ne,A)}function Q(A){const z={};for(const ne in A)z[ne]=A[ne];return z}const J="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function ie(A,z){let ne,ge;for(let qe=1;qe<arguments.length;qe++){ge=arguments[qe];for(ne in ge)A[ne]=ge[ne];for(let ct=0;ct<J.length;ct++)ne=J[ct],Object.prototype.hasOwnProperty.call(ge,ne)&&(A[ne]=ge[ne])}}function me(A){var z=1;A=A.split(":");const ne=[];for(;0<z&&A.length;)ne.push(A.shift()),z--;return A.length&&ne.push(A.join(":")),ne}function de(A){_.setTimeout(()=>{throw A},0)}function le(){var A=Ee;let z=null;return A.g&&(z=A.g,A.g=A.g.next,A.g||(A.h=null),z.next=null),z}class xe{constructor(){this.h=this.g=null}add(z,ne){const ge=We.get();ge.set(z,ne),this.h?this.h.next=ge:this.g=ge,this.h=ge}}var We=new Z(()=>new $e,A=>A.reset());class $e{constructor(){this.next=this.g=this.h=null}set(z,ne){this.h=z,this.g=ne,this.next=null}reset(){this.next=this.g=this.h=null}}let ve,_e=!1,Ee=new xe,ke=()=>{const A=_.Promise.resolve(void 0);ve=()=>{A.then(we)}};var we=()=>{for(var A;A=le();){try{A.h.call(A.g)}catch(ne){de(ne)}var z=We;z.j(A),100>z.h&&(z.h++,A.next=z.g,z.g=A)}_e=!1};function be(){this.s=this.s,this.C=this.C}be.prototype.s=!1,be.prototype.ma=function(){this.s||(this.s=!0,this.N())},be.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function Ie(A,z){this.type=A,this.g=this.target=z,this.defaultPrevented=!1}Ie.prototype.h=function(){this.defaultPrevented=!0};var Me=function(){if(!_.addEventListener||!Object.defineProperty)return!1;var A=!1,z=Object.defineProperty({},"passive",{get:function(){A=!0}});try{const ne=()=>{};_.addEventListener("test",ne,z),_.removeEventListener("test",ne,z)}catch{}return A}();function ze(A,z){if(Ie.call(this,A?A.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,A){var ne=this.type=A.type,ge=A.changedTouches&&A.changedTouches.length?A.changedTouches[0]:null;if(this.target=A.target||A.srcElement,this.g=z,z=A.relatedTarget){if(re){e:{try{ue(z.nodeName);var qe=!0;break e}catch{}qe=!1}qe||(z=null)}}else ne=="mouseover"?z=A.fromElement:ne=="mouseout"&&(z=A.toElement);this.relatedTarget=z,ge?(this.clientX=ge.clientX!==void 0?ge.clientX:ge.pageX,this.clientY=ge.clientY!==void 0?ge.clientY:ge.pageY,this.screenX=ge.screenX||0,this.screenY=ge.screenY||0):(this.clientX=A.clientX!==void 0?A.clientX:A.pageX,this.clientY=A.clientY!==void 0?A.clientY:A.pageY,this.screenX=A.screenX||0,this.screenY=A.screenY||0),this.button=A.button,this.key=A.key||"",this.ctrlKey=A.ctrlKey,this.altKey=A.altKey,this.shiftKey=A.shiftKey,this.metaKey=A.metaKey,this.pointerId=A.pointerId||0,this.pointerType=typeof A.pointerType=="string"?A.pointerType:Je[A.pointerType]||"",this.state=A.state,this.i=A,A.defaultPrevented&&ze.aa.h.call(this)}}V(ze,Ie);var Je={2:"touch",3:"pen",4:"mouse"};ze.prototype.h=function(){ze.aa.h.call(this);var A=this.i;A.preventDefault?A.preventDefault():A.returnValue=!1};var tt="closure_listenable_"+(1e6*Math.random()|0),ut=0;function Ze(A,z,ne,ge,qe){this.listener=A,this.proxy=null,this.src=z,this.type=ne,this.capture=!!ge,this.ha=qe,this.key=++ut,this.da=this.fa=!1}function bt(A){A.da=!0,A.listener=null,A.proxy=null,A.src=null,A.ha=null}function on(A){this.src=A,this.g={},this.h=0}on.prototype.add=function(A,z,ne,ge,qe){var ct=A.toString();A=this.g[ct],A||(A=this.g[ct]=[],this.h++);var Vt=Zt(A,z,ge,qe);return-1<Vt?(z=A[Vt],ne||(z.fa=!1)):(z=new Ze(z,this.src,ct,!!ge,qe),z.fa=ne,A.push(z)),z};function Mt(A,z){var ne=z.type;if(ne in A.g){var ge=A.g[ne],qe=Array.prototype.indexOf.call(ge,z,void 0),ct;(ct=0<=qe)&&Array.prototype.splice.call(ge,qe,1),ct&&(bt(z),A.g[ne].length==0&&(delete A.g[ne],A.h--))}}function Zt(A,z,ne,ge){for(var qe=0;qe<A.length;++qe){var ct=A[qe];if(!ct.da&&ct.listener==z&&ct.capture==!!ne&&ct.ha==ge)return qe}return-1}var an="closure_lm_"+(1e6*Math.random()|0),Ht={};function jn(A,z,ne,ge,qe){if(Array.isArray(z)){for(var ct=0;ct<z.length;ct++)jn(A,z[ct],ne,ge,qe);return null}return ne=gn(ne),A&&A[tt]?A.K(z,ne,b(ge)?!!ge.capture:!1,qe):Wt(A,z,ne,!1,ge,qe)}function Wt(A,z,ne,ge,qe,ct){if(!z)throw Error("Invalid event type");var Vt=b(qe)?!!qe.capture:!!qe,ei=vt(A);if(ei||(A[an]=ei=new on(A)),ne=ei.add(z,ne,ge,Vt,ct),ne.proxy)return ne;if(ge=Re(),ne.proxy=ge,ge.src=A,ge.listener=ne,A.addEventListener)Me||(qe=Vt),qe===void 0&&(qe=!1),A.addEventListener(z.toString(),ge,qe);else if(A.attachEvent)A.attachEvent(at(z.toString()),ge);else if(A.addListener&&A.removeListener)A.addListener(ge);else throw Error("addEventListener and attachEvent are unavailable.");return ne}function Re(){function A(ne){return z.call(A.src,A.listener,ne)}const z=yt;return A}function Fe(A,z,ne,ge,qe){if(Array.isArray(z))for(var ct=0;ct<z.length;ct++)Fe(A,z[ct],ne,ge,qe);else ge=b(ge)?!!ge.capture:!!ge,ne=gn(ne),A&&A[tt]?(A=A.i,z=String(z).toString(),z in A.g&&(ct=A.g[z],ne=Zt(ct,ne,ge,qe),-1<ne&&(bt(ct[ne]),Array.prototype.splice.call(ct,ne,1),ct.length==0&&(delete A.g[z],A.h--)))):A&&(A=vt(A))&&(z=A.g[z.toString()],A=-1,z&&(A=Zt(z,ne,ge,qe)),(ne=-1<A?z[A]:null)&&Ge(ne))}function Ge(A){if(typeof A!="number"&&A&&!A.da){var z=A.src;if(z&&z[tt])Mt(z.i,A);else{var ne=A.type,ge=A.proxy;z.removeEventListener?z.removeEventListener(ne,ge,A.capture):z.detachEvent?z.detachEvent(at(ne),ge):z.addListener&&z.removeListener&&z.removeListener(ge),(ne=vt(z))?(Mt(ne,A),ne.h==0&&(ne.src=null,z[an]=null)):bt(A)}}}function at(A){return A in Ht?Ht[A]:Ht[A]="on"+A}function yt(A,z){if(A.da)A=!0;else{z=new ze(z,this);var ne=A.listener,ge=A.ha||A.src;A.fa&&Ge(A),A=ne.call(ge,z)}return A}function vt(A){return A=A[an],A instanceof on?A:null}var Gt="__closure_events_fn_"+(1e9*Math.random()>>>0);function gn(A){return typeof A=="function"?A:(A[Gt]||(A[Gt]=function(z){return A.handleEvent(z)}),A[Gt])}function Pn(){be.call(this),this.i=new on(this),this.M=this,this.F=null}V(Pn,be),Pn.prototype[tt]=!0,Pn.prototype.removeEventListener=function(A,z,ne,ge){Fe(this,A,z,ne,ge)};function un(A,z){var ne,ge=A.F;if(ge)for(ne=[];ge;ge=ge.F)ne.push(ge);if(A=A.M,ge=z.type||z,typeof z=="string")z=new Ie(z,A);else if(z instanceof Ie)z.target=z.target||A;else{var qe=z;z=new Ie(ge,A),ie(z,qe)}if(qe=!0,ne)for(var ct=ne.length-1;0<=ct;ct--){var Vt=z.g=ne[ct];qe=wt(Vt,ge,!0,z)&&qe}if(Vt=z.g=A,qe=wt(Vt,ge,!0,z)&&qe,qe=wt(Vt,ge,!1,z)&&qe,ne)for(ct=0;ct<ne.length;ct++)Vt=z.g=ne[ct],qe=wt(Vt,ge,!1,z)&&qe}Pn.prototype.N=function(){if(Pn.aa.N.call(this),this.i){var A=this.i,z;for(z in A.g){for(var ne=A.g[z],ge=0;ge<ne.length;ge++)bt(ne[ge]);delete A.g[z],A.h--}}this.F=null},Pn.prototype.K=function(A,z,ne,ge){return this.i.add(String(A),z,!1,ne,ge)},Pn.prototype.L=function(A,z,ne,ge){return this.i.add(String(A),z,!0,ne,ge)};function wt(A,z,ne,ge){if(z=A.i.g[String(z)],!z)return!0;z=z.concat();for(var qe=!0,ct=0;ct<z.length;++ct){var Vt=z[ct];if(Vt&&!Vt.da&&Vt.capture==ne){var ei=Vt.listener,gi=Vt.ha||Vt.src;Vt.fa&&Mt(A.i,Vt),qe=ei.call(gi,ge)!==!1&&qe}}return qe&&!ge.defaultPrevented}function lr(A,z,ne){if(typeof A=="function")ne&&(A=O(A,ne));else if(A&&typeof A.handleEvent=="function")A=O(A.handleEvent,A);else throw Error("Invalid listener argument");return 2147483647<Number(z)?-1:_.setTimeout(A,z||0)}function Dt(A){A.g=lr(()=>{A.g=null,A.i&&(A.i=!1,Dt(A))},A.l);const z=A.h;A.h=null,A.m.apply(null,z)}class qt extends be{constructor(z,ne){super(),this.m=z,this.l=ne,this.h=null,this.i=!1,this.g=null}j(z){this.h=arguments,this.g?this.i=!0:Dt(this)}N(){super.N(),this.g&&(_.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Qr(A){be.call(this),this.h=A,this.g={}}V(Qr,be);var Hi=[];function Vs(A){pe(A.g,function(z,ne){this.g.hasOwnProperty(ne)&&Ge(z)},A),A.g={}}Qr.prototype.N=function(){Qr.aa.N.call(this),Vs(this)},Qr.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var ai=_.JSON.stringify,Ot=_.JSON.parse,On=class{stringify(A){return _.JSON.stringify(A,void 0)}parse(A){return _.JSON.parse(A,void 0)}};function or(){}or.prototype.h=null;function Fi(A){return A.h||(A.h=A.i())}function Cc(){}var us={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function Ta(){Ie.call(this,"d")}V(Ta,Ie);function Io(){Ie.call(this,"c")}V(Io,Ie);var wa={},Ca=null;function co(){return Ca=Ca||new Pn}wa.La="serverreachability";function Es(A){Ie.call(this,wa.La,A)}V(Es,Ie);function ds(A){const z=co();un(z,new Es(z))}wa.STAT_EVENT="statevent";function Ho(A,z){Ie.call(this,wa.STAT_EVENT,A),this.stat=z}V(Ho,Ie);function $i(A){const z=co();un(z,new Ho(z,A))}wa.Ma="timingevent";function vs(A,z){Ie.call(this,wa.Ma,A),this.size=z}V(vs,Ie);function rc(A,z){if(typeof A!="function")throw Error("Fn must not be null and must be a function");return _.setTimeout(function(){A()},z)}function ju(){this.g=!0}ju.prototype.xa=function(){this.g=!1};function Rc(A,z,ne,ge,qe,ct){A.info(function(){if(A.g)if(ct)for(var Vt="",ei=ct.split("&"),gi=0;gi<ei.length;gi++){var wr=ei[gi].split("=");if(1<wr.length){var Js=wr[0];wr=wr[1];var bs=Js.split("_");Vt=2<=bs.length&&bs[1]=="type"?Vt+(Js+"="+wr+"&"):Vt+(Js+"=redacted&")}}else Vt=null;else Vt=ct;return"XMLHTTP REQ ("+ge+") [attempt "+qe+"]: "+z+`
`+ne+`
`+Vt})}function Ra(A,z,ne,ge,qe,ct,Vt){A.info(function(){return"XMLHTTP RESP ("+ge+") [ attempt "+qe+"]: "+z+`
`+ne+`
`+ct+" "+Vt})}function Ia(A,z,ne,ge){A.info(function(){return"XMLHTTP TEXT ("+z+"): "+Gg(A,ne)+(ge?" "+ge:"")})}function zd(A,z){A.info(function(){return"TIMEOUT: "+z})}ju.prototype.info=function(){};function Gg(A,z){if(!A.g)return z;if(!z)return null;try{var ne=JSON.parse(z);if(ne){for(A=0;A<ne.length;A++)if(Array.isArray(ne[A])){var ge=ne[A];if(!(2>ge.length)){var qe=ge[1];if(Array.isArray(qe)&&!(1>qe.length)){var ct=qe[0];if(ct!="noop"&&ct!="stop"&&ct!="close")for(var Vt=1;Vt<qe.length;Vt++)qe[Vt]=""}}}}return ai(ne)}catch{return z}}var Bu={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},Sf={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},Xs;function Wu(){}V(Wu,or),Wu.prototype.g=function(){return new XMLHttpRequest},Wu.prototype.i=function(){return{}},Xs=new Wu;function Aa(A,z,ne,ge){this.j=A,this.i=z,this.l=ne,this.R=ge||1,this.U=new Qr(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new Gd}function Gd(){this.i=null,this.g="",this.h=!1}var Hd={},ic={};function $d(A,z,ne){A.L=1,A.v=oc(Ko(z)),A.m=ne,A.P=!0,zu(A,null)}function zu(A,z){A.F=Date.now(),Kr(A),A.A=Ko(A.v);var ne=A.A,ge=A.R;Array.isArray(ge)||(ge=[String(ge)]),Ql(ne.i,"t",ge),A.C=0,ne=A.j.J,A.h=new Gd,A.g=oE(A.j,ne?z:null,!A.m),0<A.O&&(A.M=new qt(O(A.Y,A,A.g),A.O)),z=A.U,ne=A.g,ge=A.ca;var qe="readystatechange";Array.isArray(qe)||(qe&&(Hi[0]=qe.toString()),qe=Hi);for(var ct=0;ct<qe.length;ct++){var Vt=jn(ne,qe[ct],ge||z.handleEvent,!1,z.h||z);if(!Vt)break;z.g[Vt.key]=Vt}z=A.H?Q(A.H):{},A.m?(A.u||(A.u="POST"),z["Content-Type"]="application/x-www-form-urlencoded",A.g.ea(A.A,A.u,A.m,z)):(A.u="GET",A.g.ea(A.A,A.u,null,z)),ds(),Rc(A.i,A.u,A.A,A.l,A.R,A.m)}Aa.prototype.ca=function(A){A=A.target;const z=this.M;z&&Ri(A)==3?z.j():this.Y(A)},Aa.prototype.Y=function(A){try{if(A==this.g)e:{const bs=Ri(this.g);var z=this.g.Ba();const ac=this.g.Z();if(!(3>bs)&&(bs!=3||this.g&&(this.h.h||this.g.oa()||Fs(this.g)))){this.J||bs!=4||z==7||(z==8||0>=ac?ds(3):ds(2)),Ic(this);var ne=this.g.Z();this.X=ne;t:if($o(this)){var ge=Fs(this.g);A="";var qe=ge.length,ct=Ri(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){Pa(this),fl(this);var Vt="";break t}this.h.i=new _.TextDecoder}for(z=0;z<qe;z++)this.h.h=!0,A+=this.h.i.decode(ge[z],{stream:!(ct&&z==qe-1)});ge.length=0,this.h.g+=A,this.C=0,Vt=this.h.g}else Vt=this.g.oa();if(this.o=ne==200,Ra(this.i,this.u,this.A,this.l,this.R,bs,ne),this.o){if(this.T&&!this.K){t:{if(this.g){var ei,gi=this.g;if((ei=gi.g?gi.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!$(ei)){var wr=ei;break t}}wr=null}if(ne=wr)Ia(this.i,this.l,ne,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,bf(this,ne);else{this.o=!1,this.s=3,$i(12),Pa(this),fl(this);break e}}if(this.P){ne=!0;let ra;for(;!this.J&&this.C<Vt.length;)if(ra=Kd(this,Vt),ra==ic){bs==4&&(this.s=4,$i(14),ne=!1),Ia(this.i,this.l,null,"[Incomplete Response]");break}else if(ra==Hd){this.s=4,$i(15),Ia(this.i,this.l,Vt,"[Invalid Chunk]"),ne=!1;break}else Ia(this.i,this.l,ra,null),bf(this,ra);if($o(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),bs!=4||Vt.length!=0||this.h.h||(this.s=1,$i(16),ne=!1),this.o=this.o&&ne,!ne)Ia(this.i,this.l,Vt,"[Invalid Chunked Response]"),Pa(this),fl(this);else if(0<Vt.length&&!this.W){this.W=!0;var Js=this.j;Js.g==this&&Js.ba&&!Js.M&&(Js.j.info("Great, no buffering proxy detected. Bytes received: "+Vt.length),$g(Js),Js.M=!0,$i(11))}}else Ia(this.i,this.l,Vt,null),bf(this,Vt);bs==4&&Pa(this),this.o&&!this.J&&(bs==4?am(this.j,this):(this.o=!1,Kr(this)))}else Zo(this.g),ne==400&&0<Vt.indexOf("Unknown SID")?(this.s=3,$i(12)):(this.s=0,$i(13)),Pa(this),fl(this)}}}catch{}finally{}};function $o(A){return A.g?A.u=="GET"&&A.L!=2&&A.j.Ca:!1}function Kd(A,z){var ne=A.C,ge=z.indexOf(`
`,ne);return ge==-1?ic:(ne=Number(z.substring(ne,ge)),isNaN(ne)?Hd:(ge+=1,ge+ne>z.length?ic:(z=z.slice(ge,ge+ne),A.C=ge+ne,z)))}Aa.prototype.cancel=function(){this.J=!0,Pa(this)};function Kr(A){A.S=Date.now()+A.I,Ci(A,A.I)}function Ci(A,z){if(A.B!=null)throw Error("WatchDog timer not null");A.B=rc(O(A.ba,A),z)}function Ic(A){A.B&&(_.clearTimeout(A.B),A.B=null)}Aa.prototype.ba=function(){this.B=null;const A=Date.now();0<=A-this.S?(zd(this.i,this.A),this.L!=2&&(ds(),$i(17)),Pa(this),this.s=2,fl(this)):Ci(this,this.S-A)};function fl(A){A.j.G==0||A.J||am(A.j,A)}function Pa(A){Ic(A);var z=A.M;z&&typeof z.ma=="function"&&z.ma(),A.M=null,Vs(A.U),A.g&&(z=A.g,A.g=null,z.abort(),z.ma())}function bf(A,z){try{var ne=A.j;if(ne.G!=0&&(ne.g==A||lo(ne.h,A))){if(!A.K&&lo(ne.h,A)&&ne.G==3){try{var ge=ne.Da.g.parse(z)}catch{ge=null}if(Array.isArray(ge)&&ge.length==3){var qe=ge;if(qe[0]==0){e:if(!ne.u){if(ne.g)if(ne.g.F+3e3<A.F)om(ne),yl(ne);else break e;sm(ne),$i(18)}}else ne.za=qe[1],0<ne.za-ne.T&&37500>qe[2]&&ne.F&&ne.v==0&&!ne.C&&(ne.C=rc(O(ne.Za,ne),6e3));if(1>=Zp(ne.h)&&ne.ca){try{ne.ca()}catch{}ne.ca=void 0}}else Xu(ne,11)}else if((A.K||ne.g==A)&&om(ne),!$(z))for(qe=ne.Da.g.parse(z),z=0;z<qe.length;z++){let wr=qe[z];if(ne.T=wr[0],wr=wr[1],ne.G==2)if(wr[0]=="c"){ne.K=wr[1],ne.ia=wr[2];const Js=wr[3];Js!=null&&(ne.la=Js,ne.j.info("VER="+ne.la));const bs=wr[4];bs!=null&&(ne.Aa=bs,ne.j.info("SVER="+ne.Aa));const ac=wr[5];ac!=null&&typeof ac=="number"&&0<ac&&(ge=1.5*ac,ne.L=ge,ne.j.info("backChannelRequestTimeoutMs_="+ge)),ge=ne;const ra=A.g;if(ra){const If=ra.g?ra.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(If){var ct=ge.h;ct.g||If.indexOf("spdy")==-1&&If.indexOf("quic")==-1&&If.indexOf("h2")==-1||(ct.j=ct.l,ct.g=new Set,ct.h&&(Tf(ct,ct.h),ct.h=null))}if(ge.D){const lm=ra.g?ra.g.getResponseHeader("X-HTTP-Session-Id"):null;lm&&(ge.ya=lm,Zr(ge.I,ge.D,lm))}}ne.G=3,ne.l&&ne.l.ua(),ne.ba&&(ne.R=Date.now()-A.F,ne.j.info("Handshake RTT: "+ne.R+"ms")),ge=ne;var Vt=A;if(ge.qa=Kg(ge,ge.J?ge.ia:null,ge.W),Vt.K){pl(ge.h,Vt);var ei=Vt,gi=ge.L;gi&&(ei.I=gi),ei.B&&(Ic(ei),Kr(ei)),ge.g=Vt}else eu(ge);0<ne.i.length&&Oc(ne)}else wr[0]!="stop"&&wr[0]!="close"||Xu(ne,7);else ne.G==3&&(wr[0]=="stop"||wr[0]=="close"?wr[0]=="stop"?Xu(ne,7):is(ne):wr[0]!="noop"&&ne.l&&ne.l.ta(wr),ne.v=0)}}ds(4)}catch{}}var qd=class{constructor(A,z){this.g=A,this.map=z}};function Kl(A){this.l=A||10,_.PerformanceNavigationTiming?(A=_.performance.getEntriesByType("navigation"),A=0<A.length&&(A[0].nextHopProtocol=="hq"||A[0].nextHopProtocol=="h2")):A=!!(_.chrome&&_.chrome.loadTimes&&_.chrome.loadTimes()&&_.chrome.loadTimes().wasFetchedViaSpdy),this.j=A?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function Ao(A){return A.h?!0:A.g?A.g.size>=A.j:!1}function Zp(A){return A.h?1:A.g?A.g.size:0}function lo(A,z){return A.h?A.h==z:A.g?A.g.has(z):!1}function Tf(A,z){A.g?A.g.add(z):A.h=z}function pl(A,z){A.h&&A.h==z?A.h=null:A.g&&A.g.has(z)&&A.g.delete(z)}Kl.prototype.cancel=function(){if(this.i=Yd(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const A of this.g.values())A.cancel();this.g.clear()}};function Yd(A){if(A.h!=null)return A.i.concat(A.h.D);if(A.g!=null&&A.g.size!==0){let z=A.i;for(const ne of A.g.values())z=z.concat(ne.D);return z}return B(A.i)}function Xd(A){if(A.V&&typeof A.V=="function")return A.V();if(typeof Map<"u"&&A instanceof Map||typeof Set<"u"&&A instanceof Set)return Array.from(A.values());if(typeof A=="string")return A.split("");if(E(A)){for(var z=[],ne=A.length,ge=0;ge<ne;ge++)z.push(A[ge]);return z}z=[],ne=0;for(ge in A)z[ne++]=A[ge];return z}function _r(A){if(A.na&&typeof A.na=="function")return A.na();if(!A.V||typeof A.V!="function"){if(typeof Map<"u"&&A instanceof Map)return Array.from(A.keys());if(!(typeof Set<"u"&&A instanceof Set)){if(E(A)||typeof A=="string"){var z=[];A=A.length;for(var ne=0;ne<A;ne++)z.push(ne);return z}z=[],ne=0;for(const ge in A)z[ne++]=ge;return z}}}function ql(A,z){if(A.forEach&&typeof A.forEach=="function")A.forEach(z,void 0);else if(E(A)||typeof A=="string")Array.prototype.forEach.call(A,z,void 0);else for(var ne=_r(A),ge=Xd(A),qe=ge.length,ct=0;ct<qe;ct++)z.call(void 0,ge[ct],ne&&ne[ct],A)}var Yl=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Gu(A,z){if(A){A=A.split("&");for(var ne=0;ne<A.length;ne++){var ge=A[ne].indexOf("="),qe=null;if(0<=ge){var ct=A[ne].substring(0,ge);qe=A[ne].substring(ge+1)}else ct=A[ne];z(ct,qe?decodeURIComponent(qe.replace(/\+/g," ")):"")}}}function sc(A){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,A instanceof sc){this.h=A.h,Hu(this,A.j),this.o=A.o,this.g=A.g,ml(this,A.s),this.l=A.l;var z=A.i,ne=new qo;ne.i=z.i,z.g&&(ne.g=new Map(z.g),ne.h=z.h),Xl(this,ne),this.m=A.m}else A&&(z=String(A).match(Yl))?(this.h=!1,Hu(this,z[1]||"",!0),this.o=ar(z[2]||""),this.g=ar(z[3]||"",!0),ml(this,z[4]),this.l=ar(z[5]||"",!0),Xl(this,z[6]||"",!0),this.m=ar(z[7]||"")):(this.h=!1,this.i=new qo(null,this.h))}sc.prototype.toString=function(){var A=[],z=this.j;z&&A.push(Ac(z,Jl,!0),":");var ne=this.g;return(ne||z=="file")&&(A.push("//"),(z=this.o)&&A.push(Ac(z,Jl,!0),"@"),A.push(encodeURIComponent(String(ne)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),ne=this.s,ne!=null&&A.push(":",String(ne))),(ne=this.l)&&(this.g&&ne.charAt(0)!="/"&&A.push("/"),A.push(Ac(ne,ne.charAt(0)=="/"?wf:Jd,!0))),(ne=this.i.toString())&&A.push("?",ne),(ne=this.m)&&A.push("#",Ac(ne,Cf)),A.join("")};function Ko(A){return new sc(A)}function Hu(A,z,ne){A.j=ne?ar(z,!0):z,A.j&&(A.j=A.j.replace(/:$/,""))}function ml(A,z){if(z){if(z=Number(z),isNaN(z)||0>z)throw Error("Bad port number "+z);A.s=z}else A.s=null}function Xl(A,z,ne){z instanceof qo?(A.i=z,Qo(A.i,A.h)):(ne||(z=Ac(z,tm)),A.i=new qo(z,A.h))}function Zr(A,z,ne){A.i.set(z,ne)}function oc(A){return Zr(A,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),A}function ar(A,z){return A?z?decodeURI(A.replace(/%25/g,"%2525")):decodeURIComponent(A):""}function Ac(A,z,ne){return typeof A=="string"?(A=encodeURI(A).replace(z,em),ne&&(A=A.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),A):null}function em(A){return A=A.charCodeAt(0),"%"+(A>>4&15).toString(16)+(A&15).toString(16)}var Jl=/[#\/\?@]/g,Jd=/[#\?:]/g,wf=/[#\?]/g,tm=/[#\?@]/g,Cf=/#/g;function qo(A,z){this.h=this.g=null,this.i=A||null,this.j=!!z}function hs(A){A.g||(A.g=new Map,A.h=0,A.i&&Gu(A.i,function(z,ne){A.add(decodeURIComponent(z.replace(/\+/g," ")),ne)}))}n=qo.prototype,n.add=function(A,z){hs(this),this.i=null,A=Jo(this,A);var ne=this.g.get(A);return ne||this.g.set(A,ne=[]),ne.push(z),this.h+=1,this};function Yo(A,z){hs(A),z=Jo(A,z),A.g.has(z)&&(A.i=null,A.h-=A.g.get(z).length,A.g.delete(z))}function Xo(A,z){return hs(A),z=Jo(A,z),A.g.has(z)}n.forEach=function(A,z){hs(this),this.g.forEach(function(ne,ge){ne.forEach(function(qe){A.call(z,qe,ge,this)},this)},this)},n.na=function(){hs(this);const A=Array.from(this.g.values()),z=Array.from(this.g.keys()),ne=[];for(let ge=0;ge<z.length;ge++){const qe=A[ge];for(let ct=0;ct<qe.length;ct++)ne.push(z[ge])}return ne},n.V=function(A){hs(this);let z=[];if(typeof A=="string")Xo(this,A)&&(z=z.concat(this.g.get(Jo(this,A))));else{A=Array.from(this.g.values());for(let ne=0;ne<A.length;ne++)z=z.concat(A[ne])}return z},n.set=function(A,z){return hs(this),this.i=null,A=Jo(this,A),Xo(this,A)&&(this.h-=this.g.get(A).length),this.g.set(A,[z]),this.h+=1,this},n.get=function(A,z){return A?(A=this.V(A),0<A.length?String(A[0]):z):z};function Ql(A,z,ne){Yo(A,z),0<ne.length&&(A.i=null,A.g.set(Jo(A,z),B(ne)),A.h+=ne.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";const A=[],z=Array.from(this.g.keys());for(var ne=0;ne<z.length;ne++){var ge=z[ne];const ct=encodeURIComponent(String(ge)),Vt=this.V(ge);for(ge=0;ge<Vt.length;ge++){var qe=ct;Vt[ge]!==""&&(qe+="="+encodeURIComponent(String(Vt[ge]))),A.push(qe)}}return this.i=A.join("&")};function Jo(A,z){return z=String(z),A.j&&(z=z.toLowerCase()),z}function Qo(A,z){z&&!A.j&&(hs(A),A.i=null,A.g.forEach(function(ne,ge){var qe=ge.toLowerCase();ge!=qe&&(Yo(this,ge),Ql(this,qe,ne))},A)),A.j=z}function nm(A,z){const ne=new ju;if(_.Image){const ge=new Image;ge.onload=L(Ss,ne,"TestLoadImage: loaded",!0,z,ge),ge.onerror=L(Ss,ne,"TestLoadImage: error",!1,z,ge),ge.onabort=L(Ss,ne,"TestLoadImage: abort",!1,z,ge),ge.ontimeout=L(Ss,ne,"TestLoadImage: timeout",!1,z,ge),_.setTimeout(function(){ge.ontimeout&&ge.ontimeout()},1e4),ge.src=A}else z(!1)}function Pc(A,z){const ne=new ju,ge=new AbortController,qe=setTimeout(()=>{ge.abort(),Ss(ne,"TestPingServer: timeout",!1,z)},1e4);fetch(A,{signal:ge.signal}).then(ct=>{clearTimeout(qe),ct.ok?Ss(ne,"TestPingServer: ok",!0,z):Ss(ne,"TestPingServer: server error",!1,z)}).catch(()=>{clearTimeout(qe),Ss(ne,"TestPingServer: error",!1,z)})}function Ss(A,z,ne,ge,qe){try{qe&&(qe.onload=null,qe.onerror=null,qe.onabort=null,qe.ontimeout=null),ge(ne)}catch{}}function $u(){this.g=new On}function Rf(A,z,ne){const ge=ne||"";try{ql(A,function(qe,ct){let Vt=qe;b(qe)&&(Vt=ai(qe)),z.push(ge+ct+"="+encodeURIComponent(Vt))})}catch(qe){throw z.push(ge+"type="+encodeURIComponent("_badmap")),qe}}function gl(A){this.l=A.Ub||null,this.j=A.eb||!1}V(gl,or),gl.prototype.g=function(){return new Zl(this.l,this.j)},gl.prototype.i=function(A){return function(){return A}}({});function Zl(A,z){Pn.call(this),this.D=A,this.o=z,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}V(Zl,Pn),n=Zl.prototype,n.open=function(A,z){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=A,this.A=z,this.readyState=1,ka(this)},n.send=function(A){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const z={headers:this.u,method:this.B,credentials:this.m,cache:void 0};A&&(z.body=A),(this.D||_).fetch(new Request(this.A,z)).then(this.Sa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,Oa(this)),this.readyState=0},n.Sa=function(A){if(this.g&&(this.l=A,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=A.headers,this.readyState=2,ka(this)),this.g&&(this.readyState=3,ka(this),this.g)))if(this.responseType==="arraybuffer")A.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof _.ReadableStream<"u"&&"body"in A){if(this.j=A.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;rm(this)}else A.text().then(this.Ra.bind(this),this.ga.bind(this))};function rm(A){A.j.read().then(A.Pa.bind(A)).catch(A.ga.bind(A))}n.Pa=function(A){if(this.g){if(this.o&&A.value)this.response.push(A.value);else if(!this.o){var z=A.value?A.value:new Uint8Array(0);(z=this.v.decode(z,{stream:!A.done}))&&(this.response=this.responseText+=z)}A.done?Oa(this):ka(this),this.readyState==3&&rm(this)}},n.Ra=function(A){this.g&&(this.response=this.responseText=A,Oa(this))},n.Qa=function(A){this.g&&(this.response=A,Oa(this))},n.ga=function(){this.g&&Oa(this)};function Oa(A){A.readyState=4,A.l=null,A.j=null,A.v=null,ka(A)}n.setRequestHeader=function(A,z){this.u.append(A,z)},n.getResponseHeader=function(A){return this.h&&this.h.get(A.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";const A=[],z=this.h.entries();for(var ne=z.next();!ne.done;)ne=ne.value,A.push(ne[0]+": "+ne[1]),ne=z.next();return A.join(`\r
`)};function ka(A){A.onreadystatechange&&A.onreadystatechange.call(A)}Object.defineProperty(Zl.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(A){this.m=A?"include":"same-origin"}});function _l(A){let z="";return pe(A,function(ne,ge){z+=ge,z+=":",z+=ne,z+=`\r
`}),z}function Ce(A,z,ne){e:{for(ge in ne){var ge=!1;break e}ge=!0}ge||(ne=_l(ne),typeof A=="string"?ne!=null&&encodeURIComponent(String(ne)):Zr(A,z,ne))}function De(A){Pn.call(this),this.headers=new Map,this.o=A||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}V(De,Pn);var rt=/^https?$/i,Qt=["POST","PUT"];n=De.prototype,n.Ha=function(A){this.J=A},n.ea=function(A,z,ne,ge){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+A);z=z?z.toUpperCase():"GET",this.D=A,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():Xs.g(),this.v=this.o?Fi(this.o):Fi(Xs),this.g.onreadystatechange=O(this.Ea,this);try{this.B=!0,this.g.open(z,String(A),!0),this.B=!1}catch(ct){Jn(this,ct);return}if(A=ne||"",ne=new Map(this.headers),ge)if(Object.getPrototypeOf(ge)===Object.prototype)for(var qe in ge)ne.set(qe,ge[qe]);else if(typeof ge.keys=="function"&&typeof ge.get=="function")for(const ct of ge.keys())ne.set(ct,ge.get(ct));else throw Error("Unknown input type for opt_headers: "+String(ge));ge=Array.from(ne.keys()).find(ct=>ct.toLowerCase()=="content-type"),qe=_.FormData&&A instanceof _.FormData,!(0<=Array.prototype.indexOf.call(Qt,z,void 0))||ge||qe||ne.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[ct,Vt]of ne)this.g.setRequestHeader(ct,Vt);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{jr(this),this.u=!0,this.g.send(A),this.u=!1}catch(ct){Jn(this,ct)}};function Jn(A,z){A.h=!1,A.g&&(A.j=!0,A.g.abort(),A.j=!1),A.l=z,A.m=5,Tr(A),fn(A)}function Tr(A){A.A||(A.A=!0,un(A,"complete"),un(A,"error"))}n.abort=function(A){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=A||7,un(this,"complete"),un(this,"abort"),fn(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),fn(this,!0)),De.aa.N.call(this)},n.Ea=function(){this.s||(this.B||this.u||this.j?qr(this):this.bb())},n.bb=function(){qr(this)};function qr(A){if(A.h&&typeof p<"u"&&(!A.v[1]||Ri(A)!=4||A.Z()!=2)){if(A.u&&Ri(A)==4)lr(A.Ea,0,A);else if(un(A,"readystatechange"),Ri(A)==4){A.h=!1;try{const Vt=A.Z();e:switch(Vt){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var z=!0;break e;default:z=!1}var ne;if(!(ne=z)){var ge;if(ge=Vt===0){var qe=String(A.D).match(Yl)[1]||null;!qe&&_.self&&_.self.location&&(qe=_.self.location.protocol.slice(0,-1)),ge=!rt.test(qe?qe.toLowerCase():"")}ne=ge}if(ne)un(A,"complete"),un(A,"success");else{A.m=6;try{var ct=2<Ri(A)?A.g.statusText:""}catch{ct=""}A.l=ct+" ["+A.Z()+"]",Tr(A)}}finally{fn(A)}}}}function fn(A,z){if(A.g){jr(A);const ne=A.g,ge=A.v[0]?()=>{}:null;A.g=null,A.v=null,z||un(A,"ready");try{ne.onreadystatechange=ge}catch{}}}function jr(A){A.I&&(_.clearTimeout(A.I),A.I=null)}n.isActive=function(){return!!this.g};function Ri(A){return A.g?A.g.readyState:0}n.Z=function(){try{return 2<Ri(this)?this.g.status:-1}catch{return-1}},n.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.Oa=function(A){if(this.g){var z=this.g.responseText;return A&&z.indexOf(A)==0&&(z=z.substring(A.length)),Ot(z)}};function Fs(A){try{if(!A.g)return null;if("response"in A.g)return A.g.response;switch(A.H){case"":case"text":return A.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in A.g)return A.g.mozResponseArrayBuffer}return null}catch{return null}}function Zo(A){const z={};A=(A.g&&2<=Ri(A)&&A.g.getAllResponseHeaders()||"").split(`\r
`);for(let ge=0;ge<A.length;ge++){if($(A[ge]))continue;var ne=me(A[ge]);const qe=ne[0];if(ne=ne[1],typeof ne!="string")continue;ne=ne.trim();const ct=z[qe]||[];z[qe]=ct,ct.push(ne)}q(z,function(ge){return ge.join(", ")})}n.Ba=function(){return this.m},n.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function ea(A,z,ne){return ne&&ne.internalChannelParams&&ne.internalChannelParams[A]||z}function Ku(A){this.Aa=0,this.i=[],this.j=new ju,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=ea("failFast",!1,A),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=ea("baseRetryDelayMs",5e3,A),this.cb=ea("retryDelaySeedMs",1e4,A),this.Wa=ea("forwardChannelMaxRetries",2,A),this.wa=ea("forwardChannelRequestTimeoutMs",2e4,A),this.pa=A&&A.xmlHttpFactory||void 0,this.Xa=A&&A.Tb||void 0,this.Ca=A&&A.useFetchStreams||!1,this.L=void 0,this.J=A&&A.supportsCrossDomainXhr||!1,this.K="",this.h=new Kl(A&&A.concurrentRequestLimit),this.Da=new $u,this.P=A&&A.fastHandshake||!1,this.O=A&&A.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=A&&A.Rb||!1,A&&A.xa&&this.j.xa(),A&&A.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&A&&A.detectBufferingProxy||!1,this.ja=void 0,A&&A.longPollingTimeout&&0<A.longPollingTimeout&&(this.ja=A.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}n=Ku.prototype,n.la=8,n.G=1,n.connect=function(A,z,ne,ge){$i(0),this.W=A,this.H=z||{},ne&&ge!==void 0&&(this.H.OSID=ne,this.H.OAID=ge),this.F=this.X,this.I=Kg(this,null,this.W),Oc(this)};function is(A){if(Qd(A),A.G==3){var z=A.U++,ne=Ko(A.I);if(Zr(ne,"SID",A.K),Zr(ne,"RID",z),Zr(ne,"TYPE","terminate"),qu(A,ne),z=new Aa(A,A.j,z),z.L=2,z.v=oc(Ko(ne)),ne=!1,_.navigator&&_.navigator.sendBeacon)try{ne=_.navigator.sendBeacon(z.v.toString(),"")}catch{}!ne&&_.Image&&(new Image().src=z.v,ne=!0),ne||(z.g=oE(z.j,null),z.g.ea(z.v)),z.F=Date.now(),Kr(z)}Ju(A)}function yl(A){A.g&&($g(A),A.g.cancel(),A.g=null)}function Qd(A){yl(A),A.u&&(_.clearTimeout(A.u),A.u=null),om(A),A.h.cancel(),A.s&&(typeof A.s=="number"&&_.clearTimeout(A.s),A.s=null)}function Oc(A){if(!Ao(A.h)&&!A.s){A.s=!0;var z=A.Ga;ve||ke(),_e||(ve(),_e=!0),Ee.add(z,A),A.B=0}}function Hg(A,z){return Zp(A.h)>=A.h.j-(A.s?1:0)?!1:A.s?(A.i=z.D.concat(A.i),!0):A.G==1||A.G==2||A.B>=(A.Va?0:A.Wa)?!1:(A.s=rc(O(A.Ga,A,z),Yu(A,A.B)),A.B++,!0)}n.Ga=function(A){if(this.s)if(this.s=null,this.G==1){if(!A){this.U=Math.floor(1e5*Math.random()),A=this.U++;const qe=new Aa(this,this.j,A);let ct=this.o;if(this.S&&(ct?(ct=Q(ct),ie(ct,this.S)):ct=this.S),this.m!==null||this.O||(qe.H=ct,ct=null),this.P)e:{for(var z=0,ne=0;ne<this.i.length;ne++){t:{var ge=this.i[ne];if("__data__"in ge.map&&(ge=ge.map.__data__,typeof ge=="string")){ge=ge.length;break t}ge=void 0}if(ge===void 0)break;if(z+=ge,4096<z){z=ne;break e}if(z===4096||ne===this.i.length-1){z=ne+1;break e}}z=1e3}else z=1e3;z=ta(this,qe,z),ne=Ko(this.I),Zr(ne,"RID",A),Zr(ne,"CVER",22),this.D&&Zr(ne,"X-HTTP-Session-Id",this.D),qu(this,ne),ct&&(this.O?z="headers="+encodeURIComponent(String(_l(ct)))+"&"+z:this.m&&Ce(ne,this.m,ct)),Tf(this.h,qe),this.Ua&&Zr(ne,"TYPE","init"),this.P?(Zr(ne,"$req",z),Zr(ne,"SID","null"),qe.T=!0,$d(qe,ne,null)):$d(qe,ne,z),this.G=2}}else this.G==3&&(A?im(this,A):this.i.length==0||Ao(this.h)||im(this))};function im(A,z){var ne;z?ne=z.l:ne=A.U++;const ge=Ko(A.I);Zr(ge,"SID",A.K),Zr(ge,"RID",ne),Zr(ge,"AID",A.T),qu(A,ge),A.m&&A.o&&Ce(ge,A.m,A.o),ne=new Aa(A,A.j,ne,A.B+1),A.m===null&&(ne.H=A.o),z&&(A.i=z.D.concat(A.i)),z=ta(A,ne,1e3),ne.I=Math.round(.5*A.wa)+Math.round(.5*A.wa*Math.random()),Tf(A.h,ne),$d(ne,ge,z)}function qu(A,z){A.H&&pe(A.H,function(ne,ge){Zr(z,ge,ne)}),A.l&&ql({},function(ne,ge){Zr(z,ge,ne)})}function ta(A,z,ne){ne=Math.min(A.i.length,ne);var ge=A.l?O(A.l.Na,A.l,A):null;e:{var qe=A.i;let ct=-1;for(;;){const Vt=["count="+ne];ct==-1?0<ne?(ct=qe[0].g,Vt.push("ofs="+ct)):ct=0:Vt.push("ofs="+ct);let ei=!0;for(let gi=0;gi<ne;gi++){let wr=qe[gi].g;const Js=qe[gi].map;if(wr-=ct,0>wr)ct=Math.max(0,qe[gi].g-100),ei=!1;else try{Rf(Js,Vt,"req"+wr+"_")}catch{ge&&ge(Js)}}if(ei){ge=Vt.join("&");break e}}}return A=A.i.splice(0,ne),z.D=A,ge}function eu(A){if(!A.g&&!A.u){A.Y=1;var z=A.Fa;ve||ke(),_e||(ve(),_e=!0),Ee.add(z,A),A.v=0}}function sm(A){return A.g||A.u||3<=A.v?!1:(A.Y++,A.u=rc(O(A.Fa,A),Yu(A,A.v)),A.v++,!0)}n.Fa=function(){if(this.u=null,sE(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var A=2*this.R;this.j.info("BP detection timer enabled: "+A),this.A=rc(O(this.ab,this),A)}},n.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,$i(10),yl(this),sE(this))};function $g(A){A.A!=null&&(_.clearTimeout(A.A),A.A=null)}function sE(A){A.g=new Aa(A,A.j,"rpc",A.Y),A.m===null&&(A.g.H=A.o),A.g.O=0;var z=Ko(A.qa);Zr(z,"RID","rpc"),Zr(z,"SID",A.K),Zr(z,"AID",A.T),Zr(z,"CI",A.F?"0":"1"),!A.F&&A.ja&&Zr(z,"TO",A.ja),Zr(z,"TYPE","xmlhttp"),qu(A,z),A.m&&A.o&&Ce(z,A.m,A.o),A.L&&(A.g.I=A.L);var ne=A.g;A=A.ia,ne.L=1,ne.v=oc(Ko(z)),ne.m=null,ne.P=!0,zu(ne,A)}n.Za=function(){this.C!=null&&(this.C=null,yl(this),sm(this),$i(19))};function om(A){A.C!=null&&(_.clearTimeout(A.C),A.C=null)}function am(A,z){var ne=null;if(A.g==z){om(A),$g(A),A.g=null;var ge=2}else if(lo(A.h,z))ne=z.D,pl(A.h,z),ge=1;else return;if(A.G!=0){if(z.o)if(ge==1){ne=z.m?z.m.length:0,z=Date.now()-z.F;var qe=A.B;ge=co(),un(ge,new vs(ge,ne)),Oc(A)}else eu(A);else if(qe=z.s,qe==3||qe==0&&0<z.X||!(ge==1&&Hg(A,z)||ge==2&&sm(A)))switch(ne&&0<ne.length&&(z=A.h,z.i=z.i.concat(ne)),qe){case 1:Xu(A,5);break;case 4:Xu(A,10);break;case 3:Xu(A,6);break;default:Xu(A,2)}}}function Yu(A,z){let ne=A.Ta+Math.floor(Math.random()*A.cb);return A.isActive()||(ne*=2),ne*z}function Xu(A,z){if(A.j.info("Error code "+z),z==2){var ne=O(A.fb,A),ge=A.Xa;const qe=!ge;ge=new sc(ge||"//www.google.com/images/cleardot.gif"),_.location&&_.location.protocol=="http"||Hu(ge,"https"),oc(ge),qe?nm(ge.toString(),ne):Pc(ge.toString(),ne)}else $i(2);A.G=0,A.l&&A.l.sa(z),Ju(A),Qd(A)}n.fb=function(A){A?(this.j.info("Successfully pinged google.com"),$i(2)):(this.j.info("Failed to ping google.com"),$i(1))};function Ju(A){if(A.G=0,A.ka=[],A.l){const z=Yd(A.h);(z.length!=0||A.i.length!=0)&&(W(A.ka,z),W(A.ka,A.i),A.h.i.length=0,B(A.i),A.i.length=0),A.l.ra()}}function Kg(A,z,ne){var ge=ne instanceof sc?Ko(ne):new sc(ne);if(ge.g!="")z&&(ge.g=z+"."+ge.g),ml(ge,ge.s);else{var qe=_.location;ge=qe.protocol,z=z?z+"."+qe.hostname:qe.hostname,qe=+qe.port;var ct=new sc(null);ge&&Hu(ct,ge),z&&(ct.g=z),qe&&ml(ct,qe),ne&&(ct.l=ne),ge=ct}return ne=A.D,z=A.ya,ne&&z&&Zr(ge,ne,z),Zr(ge,"VER",A.la),qu(A,ge),ge}function oE(A,z,ne){if(z&&!A.J)throw Error("Can't create secondary domain capable XhrIo object.");return z=A.Ca&&!A.pa?new De(new gl({eb:ne})):new De(A.pa),z.Ha(A.J),z}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function Wn(){}n=Wn.prototype,n.ua=function(){},n.ta=function(){},n.sa=function(){},n.ra=function(){},n.isActive=function(){return!0},n.Na=function(){};function cm(){}cm.prototype.g=function(A,z){return new na(A,z)};function na(A,z){Pn.call(this),this.g=new Ku(z),this.l=A,this.h=z&&z.messageUrlParams||null,A=z&&z.messageHeaders||null,z&&z.clientProtocolHeaderRequired&&(A?A["X-Client-Protocol"]="webchannel":A={"X-Client-Protocol":"webchannel"}),this.g.o=A,A=z&&z.initMessageHeaders||null,z&&z.messageContentType&&(A?A["X-WebChannel-Content-Type"]=z.messageContentType:A={"X-WebChannel-Content-Type":z.messageContentType}),z&&z.va&&(A?A["X-WebChannel-Client-Profile"]=z.va:A={"X-WebChannel-Client-Profile":z.va}),this.g.S=A,(A=z&&z.Sb)&&!$(A)&&(this.g.m=A),this.v=z&&z.supportsCrossDomainXhr||!1,this.u=z&&z.sendRawJson||!1,(z=z&&z.httpSessionIdParam)&&!$(z)&&(this.g.D=z,A=this.h,A!==null&&z in A&&(A=this.h,z in A&&delete A[z])),this.j=new kc(this)}V(na,Pn),na.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},na.prototype.close=function(){is(this.g)},na.prototype.o=function(A){var z=this.g;if(typeof A=="string"){var ne={};ne.__data__=A,A=ne}else this.u&&(ne={},ne.__data__=ai(A),A=ne);z.i.push(new qd(z.Ya++,A)),z.G==3&&Oc(z)},na.prototype.N=function(){this.g.l=null,delete this.j,is(this.g),delete this.g,na.aa.N.call(this)};function aE(A){Ta.call(this),A.__headers__&&(this.headers=A.__headers__,this.statusCode=A.__status__,delete A.__headers__,delete A.__status__);var z=A.__sm__;if(z){e:{for(const ne in z){A=ne;break e}A=void 0}(this.i=A)&&(A=this.i,z=z!==null&&A in z?z[A]:void 0),this.data=z}else this.data=A}V(aE,Ta);function cE(){Io.call(this),this.status=1}V(cE,Io);function kc(A){this.g=A}V(kc,Wn),kc.prototype.ua=function(){un(this.g,"a")},kc.prototype.ta=function(A){un(this.g,new aE(A))},kc.prototype.sa=function(A){un(this.g,new cE)},kc.prototype.ra=function(){un(this.g,"b")},cm.prototype.createWebChannel=cm.prototype.g,na.prototype.send=na.prototype.o,na.prototype.open=na.prototype.m,na.prototype.close=na.prototype.close,jie=function(){return new cm},Fie=function(){return co()},Vie=wa,XV={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},Bu.NO_ERROR=0,Bu.TIMEOUT=8,Bu.HTTP_ERROR=6,wk=Bu,Sf.COMPLETE="complete",Uie=Sf,Cc.EventType=us,us.OPEN="a",us.CLOSE="b",us.ERROR="c",us.MESSAGE="d",Pn.prototype.listen=Pn.prototype.K,Yw=Cc,De.prototype.listenOnce=De.prototype.L,De.prototype.getLastError=De.prototype.Ka,De.prototype.getLastErrorCode=De.prototype.Ba,De.prototype.getStatus=De.prototype.Z,De.prototype.getResponseJson=De.prototype.Oa,De.prototype.getResponseText=De.prototype.oa,De.prototype.send=De.prototype.ea,De.prototype.setWithCredentials=De.prototype.Ha,Mie=De}).apply(typeof MO<"u"?MO:typeof self<"u"?self:typeof window<"u"?window:{});const aJ="@firebase/firestore",cJ="4.7.10";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xa{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}Xa.UNAUTHENTICATED=new Xa(null),Xa.GOOGLE_CREDENTIALS=new Xa("google-credentials-uid"),Xa.FIRST_PARTY=new Xa("first-party-uid"),Xa.MOCK_USER=new Xa("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let q0="11.5.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Hy=new d4("@firebase/firestore");function OS(){return Hy.logLevel}function nn(n,...e){if(Hy.logLevel<=Ir.DEBUG){const i=e.map(b4);Hy.debug(`Firestore (${q0}): ${n}`,...i)}}function Kp(n,...e){if(Hy.logLevel<=Ir.ERROR){const i=e.map(b4);Hy.error(`Firestore (${q0}): ${n}`,...i)}}function R0(n,...e){if(Hy.logLevel<=Ir.WARN){const i=e.map(b4);Hy.warn(`Firestore (${q0}): ${n}`,...i)}}function b4(n){if(typeof n=="string")return n;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return function(i){return JSON.stringify(i)}(n)}catch{return n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $n(n="Unexpected state"){const e=`FIRESTORE (${q0}) INTERNAL ASSERTION FAILED: `+n;throw Kp(e),new Error(e)}function mi(n,e){n||$n()}function er(n,e){return n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Et={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Kt extends _f{constructor(e,i){super(e,i),this.code=e,this.message=i,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vp{constructor(){this.promise=new Promise((e,i)=>{this.resolve=e,this.reject=i})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bie{constructor(e,i){this.user=i,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class _4e{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,i){e.enqueueRetryable(()=>i(Xa.UNAUTHENTICATED))}shutdown(){}}class y4e{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,i){this.changeListener=i,e.enqueueRetryable(()=>i(this.token.user))}shutdown(){this.changeListener=null}}class E4e{constructor(e){this.t=e,this.currentUser=Xa.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,i){mi(this.o===void 0);let o=this.i;const l=E=>this.i!==o?(o=this.i,i(E)):Promise.resolve();let d=new Vp;this.o=()=>{this.i++,this.currentUser=this.u(),d.resolve(),d=new Vp,e.enqueueRetryable(()=>l(this.currentUser))};const p=()=>{const E=d;e.enqueueRetryable(async()=>{await E.promise,await l(this.currentUser)})},_=E=>{nn("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=E,this.o&&(this.auth.addAuthTokenListener(this.o),p())};this.t.onInit(E=>_(E)),setTimeout(()=>{if(!this.auth){const E=this.t.getImmediate({optional:!0});E?_(E):(nn("FirebaseAuthCredentialsProvider","Auth not yet detected"),d.resolve(),d=new Vp)}},0),p()}getToken(){const e=this.i,i=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(i).then(o=>this.i!==e?(nn("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):o?(mi(typeof o.accessToken=="string"),new Bie(o.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return mi(e===null||typeof e=="string"),new Xa(e)}}class v4e{constructor(e,i,o){this.l=e,this.h=i,this.P=o,this.type="FirstParty",this.user=Xa.FIRST_PARTY,this.T=new Map}I(){return this.P?this.P():null}get headers(){this.T.set("X-Goog-AuthUser",this.l);const e=this.I();return e&&this.T.set("Authorization",e),this.h&&this.T.set("X-Goog-Iam-Authorization-Token",this.h),this.T}}class S4e{constructor(e,i,o){this.l=e,this.h=i,this.P=o}getToken(){return Promise.resolve(new v4e(this.l,this.h,this.P))}start(e,i){e.enqueueRetryable(()=>i(Xa.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class lJ{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class b4e{constructor(e,i){this.A=i,this.forceRefresh=!1,this.appCheck=null,this.R=null,this.V=null,Ll(e)&&e.settings.appCheckToken&&(this.V=e.settings.appCheckToken)}start(e,i){mi(this.o===void 0);const o=d=>{d.error!=null&&nn("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${d.error.message}`);const p=d.token!==this.R;return this.R=d.token,nn("FirebaseAppCheckTokenProvider",`Received ${p?"new":"existing"} token.`),p?i(d.token):Promise.resolve()};this.o=d=>{e.enqueueRetryable(()=>o(d))};const l=d=>{nn("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=d,this.o&&this.appCheck.addTokenListener(this.o)};this.A.onInit(d=>l(d)),setTimeout(()=>{if(!this.appCheck){const d=this.A.getImmediate({optional:!0});d?l(d):nn("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.V)return Promise.resolve(new lJ(this.V));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(i=>i?(mi(typeof i.token=="string"),this.R=i.token,new lJ(i.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function T4e(n){const e=typeof self<"u"&&(self.crypto||self.msCrypto),i=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(i);else for(let o=0;o<n;o++)i[o]=Math.floor(256*Math.random());return i}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Wie(){return new TextEncoder}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zie{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",i=62*Math.floor(4.129032258064516);let o="";for(;o.length<20;){const l=T4e(40);for(let d=0;d<l.length;++d)o.length<20&&l[d]<i&&(o+=e.charAt(l[d]%62))}return o}}function mr(n,e){return n<e?-1:n>e?1:0}function JV(n,e){let i=0;for(;i<n.length&&i<e.length;){const o=n.codePointAt(i),l=e.codePointAt(i);if(o!==l){if(o<128&&l<128)return mr(o,l);{const d=Wie(),p=w4e(d.encode(uJ(n,i)),d.encode(uJ(e,i)));return p!==0?p:mr(o,l)}}i+=o>65535?2:1}return mr(n.length,e.length)}function uJ(n,e){return n.codePointAt(e)>65535?n.substring(e,e+2):n.substring(e,e+1)}function w4e(n,e){for(let i=0;i<n.length&&i<e.length;++i)if(n[i]!==e[i])return mr(n[i],e[i]);return mr(n.length,e.length)}function I0(n,e,i){return n.length===e.length&&n.every((o,l)=>i(o,e[l]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dJ=-62135596800,hJ=1e6;class So{static now(){return So.fromMillis(Date.now())}static fromDate(e){return So.fromMillis(e.getTime())}static fromMillis(e){const i=Math.floor(e/1e3),o=Math.floor((e-1e3*i)*hJ);return new So(i,o)}constructor(e,i){if(this.seconds=e,this.nanoseconds=i,i<0)throw new Kt(Et.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+i);if(i>=1e9)throw new Kt(Et.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+i);if(e<dJ)throw new Kt(Et.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new Kt(Et.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/hJ}_compareTo(e){return this.seconds===e.seconds?mr(this.nanoseconds,e.nanoseconds):mr(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds-dJ;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xn{static fromTimestamp(e){return new Xn(e)}static min(){return new Xn(new So(0,0))}static max(){return new Xn(new So(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fJ="__name__";class jh{constructor(e,i,o){i===void 0?i=0:i>e.length&&$n(),o===void 0?o=e.length-i:o>e.length-i&&$n(),this.segments=e,this.offset=i,this.len=o}get length(){return this.len}isEqual(e){return jh.comparator(this,e)===0}child(e){const i=this.segments.slice(this.offset,this.limit());return e instanceof jh?e.forEach(o=>{i.push(o)}):i.push(e),this.construct(i)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let i=0;i<this.length;i++)if(this.get(i)!==e.get(i))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let i=0;i<this.length;i++)if(this.get(i)!==e.get(i))return!1;return!0}forEach(e){for(let i=this.offset,o=this.limit();i<o;i++)e(this.segments[i])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,i){const o=Math.min(e.length,i.length);for(let l=0;l<o;l++){const d=jh.compareSegments(e.get(l),i.get(l));if(d!==0)return d}return mr(e.length,i.length)}static compareSegments(e,i){const o=jh.isNumericId(e),l=jh.isNumericId(i);return o&&!l?-1:!o&&l?1:o&&l?jh.extractNumericId(e).compare(jh.extractNumericId(i)):JV(e,i)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return wg.fromString(e.substring(4,e.length-2))}}class Wi extends jh{construct(e,i,o){return new Wi(e,i,o)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const i=[];for(const o of e){if(o.indexOf("//")>=0)throw new Kt(Et.INVALID_ARGUMENT,`Invalid segment (${o}). Paths must not contain // in them.`);i.push(...o.split("/").filter(l=>l.length>0))}return new Wi(i)}static emptyPath(){return new Wi([])}}const C4e=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class va extends jh{construct(e,i,o){return new va(e,i,o)}static isValidIdentifier(e){return C4e.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),va.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===fJ}static keyField(){return new va([fJ])}static fromServerFormat(e){const i=[];let o="",l=0;const d=()=>{if(o.length===0)throw new Kt(Et.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);i.push(o),o=""};let p=!1;for(;l<e.length;){const _=e[l];if(_==="\\"){if(l+1===e.length)throw new Kt(Et.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const E=e[l+1];if(E!=="\\"&&E!=="."&&E!=="`")throw new Kt(Et.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);o+=E,l+=2}else _==="`"?(p=!p,l++):_!=="."||p?(o+=_,l++):(d(),l++)}if(d(),p)throw new Kt(Et.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new va(i)}static emptyPath(){return new va([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sn{constructor(e){this.path=e}static fromPath(e){return new Sn(Wi.fromString(e))}static fromName(e){return new Sn(Wi.fromString(e).popFirst(5))}static empty(){return new Sn(Wi.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&Wi.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,i){return Wi.comparator(e.path,i.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new Sn(new Wi(e.slice()))}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zC=-1;function R4e(n,e){const i=n.toTimestamp().seconds,o=n.toTimestamp().nanoseconds+1,l=Xn.fromTimestamp(o===1e9?new So(i+1,0):new So(i,o));return new kg(l,Sn.empty(),e)}function I4e(n){return new kg(n.readTime,n.key,zC)}class kg{constructor(e,i,o){this.readTime=e,this.documentKey=i,this.largestBatchId=o}static min(){return new kg(Xn.min(),Sn.empty(),zC)}static max(){return new kg(Xn.max(),Sn.empty(),zC)}}function A4e(n,e){let i=n.readTime.compareTo(e.readTime);return i!==0?i:(i=Sn.comparator(n.documentKey,e.documentKey),i!==0?i:mr(n.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const P4e="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class O4e{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Y0(n){if(n.code!==Et.FAILED_PRECONDITION||n.message!==P4e)throw n;nn("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rt{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(i=>{this.isDone=!0,this.result=i,this.nextCallback&&this.nextCallback(i)},i=>{this.isDone=!0,this.error=i,this.catchCallback&&this.catchCallback(i)})}catch(e){return this.next(void 0,e)}next(e,i){return this.callbackAttached&&$n(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(i,this.error):this.wrapSuccess(e,this.result):new Rt((o,l)=>{this.nextCallback=d=>{this.wrapSuccess(e,d).next(o,l)},this.catchCallback=d=>{this.wrapFailure(i,d).next(o,l)}})}toPromise(){return new Promise((e,i)=>{this.next(e,i)})}wrapUserFunction(e){try{const i=e();return i instanceof Rt?i:Rt.resolve(i)}catch(i){return Rt.reject(i)}}wrapSuccess(e,i){return e?this.wrapUserFunction(()=>e(i)):Rt.resolve(i)}wrapFailure(e,i){return e?this.wrapUserFunction(()=>e(i)):Rt.reject(i)}static resolve(e){return new Rt((i,o)=>{i(e)})}static reject(e){return new Rt((i,o)=>{o(e)})}static waitFor(e){return new Rt((i,o)=>{let l=0,d=0,p=!1;e.forEach(_=>{++l,_.next(()=>{++d,p&&d===l&&i()},E=>o(E))}),p=!0,d===l&&i()})}static or(e){let i=Rt.resolve(!1);for(const o of e)i=i.next(l=>l?Rt.resolve(l):o());return i}static forEach(e,i){const o=[];return e.forEach((l,d)=>{o.push(i.call(this,l,d))}),this.waitFor(o)}static mapArray(e,i){return new Rt((o,l)=>{const d=e.length,p=new Array(d);let _=0;for(let E=0;E<d;E++){const b=E;i(e[b]).next(C=>{p[b]=C,++_,_===d&&o(p)},C=>l(C))}})}static doWhile(e,i){return new Rt((o,l)=>{const d=()=>{e()===!0?i().next(()=>{d()},l):o()};d()})}}function k4e(n){const e=n.match(/Android ([\d.]+)/i),i=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(i)}function X0(n){return n.name==="IndexedDbTransactionError"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aN{constructor(e,i){this.previousValue=e,i&&(i.sequenceNumberHandler=o=>this.oe(o),this._e=o=>i.writeSequenceNumber(o))}oe(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this._e&&this._e(e),e}}aN.ae=-1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const T4=-1;function cN(n){return n==null}function i1(n){return n===0&&1/n==-1/0}function N4e(n){return typeof n=="number"&&Number.isInteger(n)&&!i1(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Gie="";function D4e(n){let e="";for(let i=0;i<n.length;i++)e.length>0&&(e=pJ(e)),e=x4e(n.get(i),e);return pJ(e)}function x4e(n,e){let i=e;const o=n.length;for(let l=0;l<o;l++){const d=n.charAt(l);switch(d){case"\0":i+="";break;case Gie:i+="";break;default:i+=d}}return i}function pJ(n){return n+Gie+""}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mJ(n){let e=0;for(const i in n)Object.prototype.hasOwnProperty.call(n,i)&&e++;return e}function Wg(n,e){for(const i in n)Object.prototype.hasOwnProperty.call(n,i)&&e(i,n[i])}function Hie(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ys{constructor(e,i){this.comparator=e,this.root=i||ya.EMPTY}insert(e,i){return new ys(this.comparator,this.root.insert(e,i,this.comparator).copy(null,null,ya.BLACK,null,null))}remove(e){return new ys(this.comparator,this.root.remove(e,this.comparator).copy(null,null,ya.BLACK,null,null))}get(e){let i=this.root;for(;!i.isEmpty();){const o=this.comparator(e,i.key);if(o===0)return i.value;o<0?i=i.left:o>0&&(i=i.right)}return null}indexOf(e){let i=0,o=this.root;for(;!o.isEmpty();){const l=this.comparator(e,o.key);if(l===0)return i+o.left.size;l<0?o=o.left:(i+=o.left.size+1,o=o.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((i,o)=>(e(i,o),!1))}toString(){const e=[];return this.inorderTraversal((i,o)=>(e.push(`${i}:${o}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new UO(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new UO(this.root,e,this.comparator,!1)}getReverseIterator(){return new UO(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new UO(this.root,e,this.comparator,!0)}}class UO{constructor(e,i,o,l){this.isReverse=l,this.nodeStack=[];let d=1;for(;!e.isEmpty();)if(d=i?o(e.key,i):1,i&&l&&(d*=-1),d<0)e=this.isReverse?e.left:e.right;else{if(d===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const i={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return i}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class ya{constructor(e,i,o,l,d){this.key=e,this.value=i,this.color=o??ya.RED,this.left=l??ya.EMPTY,this.right=d??ya.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,i,o,l,d){return new ya(e??this.key,i??this.value,o??this.color,l??this.left,d??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,i,o){let l=this;const d=o(e,l.key);return l=d<0?l.copy(null,null,null,l.left.insert(e,i,o),null):d===0?l.copy(null,i,null,null,null):l.copy(null,null,null,null,l.right.insert(e,i,o)),l.fixUp()}removeMin(){if(this.left.isEmpty())return ya.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,i){let o,l=this;if(i(e,l.key)<0)l.left.isEmpty()||l.left.isRed()||l.left.left.isRed()||(l=l.moveRedLeft()),l=l.copy(null,null,null,l.left.remove(e,i),null);else{if(l.left.isRed()&&(l=l.rotateRight()),l.right.isEmpty()||l.right.isRed()||l.right.left.isRed()||(l=l.moveRedRight()),i(e,l.key)===0){if(l.right.isEmpty())return ya.EMPTY;o=l.right.min(),l=l.copy(o.key,o.value,null,null,l.right.removeMin())}l=l.copy(null,null,null,null,l.right.remove(e,i))}return l.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,ya.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,ya.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),i=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,i)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw $n();const e=this.left.check();if(e!==this.right.check())throw $n();return e+(this.isRed()?0:1)}}ya.EMPTY=null,ya.RED=!0,ya.BLACK=!1;ya.EMPTY=new class{constructor(){this.size=0}get key(){throw $n()}get value(){throw $n()}get color(){throw $n()}get left(){throw $n()}get right(){throw $n()}copy(e,i,o,l,d){return this}insert(e,i,o){return new ya(e,i)}remove(e,i){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bo{constructor(e){this.comparator=e,this.data=new ys(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((i,o)=>(e(i),!1))}forEachInRange(e,i){const o=this.data.getIteratorFrom(e[0]);for(;o.hasNext();){const l=o.getNext();if(this.comparator(l.key,e[1])>=0)return;i(l.key)}}forEachWhile(e,i){let o;for(o=i!==void 0?this.data.getIteratorFrom(i):this.data.getIterator();o.hasNext();)if(!e(o.getNext().key))return}firstAfterOrEqual(e){const i=this.data.getIteratorFrom(e);return i.hasNext()?i.getNext().key:null}getIterator(){return new gJ(this.data.getIterator())}getIteratorFrom(e){return new gJ(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let i=this;return i.size<e.size&&(i=e,e=this),e.forEach(o=>{i=i.add(o)}),i}isEqual(e){if(!(e instanceof bo)||this.size!==e.size)return!1;const i=this.data.getIterator(),o=e.data.getIterator();for(;i.hasNext();){const l=i.getNext().key,d=o.getNext().key;if(this.comparator(l,d)!==0)return!1}return!0}toArray(){const e=[];return this.forEach(i=>{e.push(i)}),e}toString(){const e=[];return this.forEach(i=>e.push(i)),"SortedSet("+e.toString()+")"}copy(e){const i=new bo(this.comparator);return i.data=e,i}}class gJ{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ul{constructor(e){this.fields=e,e.sort(va.comparator)}static empty(){return new Ul([])}unionWith(e){let i=new bo(va.comparator);for(const o of this.fields)i=i.add(o);for(const o of e)i=i.add(o);return new Ul(i.toArray())}covers(e){for(const i of this.fields)if(i.isPrefixOf(e))return!0;return!1}isEqual(e){return I0(this.fields,e.fields,(i,o)=>i.isEqual(o))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $ie extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sa{constructor(e){this.binaryString=e}static fromBase64String(e){const i=function(l){try{return atob(l)}catch(d){throw typeof DOMException<"u"&&d instanceof DOMException?new $ie("Invalid base64 string: "+d):d}}(e);return new Sa(i)}static fromUint8Array(e){const i=function(l){let d="";for(let p=0;p<l.length;++p)d+=String.fromCharCode(l[p]);return d}(e);return new Sa(i)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(i){return btoa(i)}(this.binaryString)}toUint8Array(){return function(i){const o=new Uint8Array(i.length);for(let l=0;l<i.length;l++)o[l]=i.charCodeAt(l);return o}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return mr(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Sa.EMPTY_BYTE_STRING=new Sa("");const L4e=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Ng(n){if(mi(!!n),typeof n=="string"){let e=0;const i=L4e.exec(n);if(mi(!!i),i[1]){let l=i[1];l=(l+"000000000").substr(0,9),e=Number(l)}const o=new Date(n);return{seconds:Math.floor(o.getTime()/1e3),nanos:e}}return{seconds:$s(n.seconds),nanos:$s(n.nanos)}}function $s(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function Dg(n){return typeof n=="string"?Sa.fromBase64String(n):Sa.fromUint8Array(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Kie="server_timestamp",qie="__type__",Yie="__previous_value__",Xie="__local_write_time__";function lN(n){var e,i;return((i=(((e=n==null?void 0:n.mapValue)===null||e===void 0?void 0:e.fields)||{})[qie])===null||i===void 0?void 0:i.stringValue)===Kie}function uN(n){const e=n.mapValue.fields[Yie];return lN(e)?uN(e):e}function GC(n){const e=Ng(n.mapValue.fields[Xie].timestampValue);return new So(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class M4e{constructor(e,i,o,l,d,p,_,E,b){this.databaseId=e,this.appId=i,this.persistenceKey=o,this.host=l,this.ssl=d,this.forceLongPolling=p,this.autoDetectLongPolling=_,this.longPollingOptions=E,this.useFetchStreams=b}}const s1="(default)";class HC{constructor(e,i){this.projectId=e,this.database=i||s1}static empty(){return new HC("","")}get isDefaultDatabase(){return this.database===s1}isEqual(e){return e instanceof HC&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Jie="__type__",U4e="__max__",VO={mapValue:{}},Qie="__vector__",o1="value";function xg(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?lN(n)?4:F4e(n)?9007199254740991:V4e(n)?10:11:$n()}function pf(n,e){if(n===e)return!0;const i=xg(n);if(i!==xg(e))return!1;switch(i){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return GC(n).isEqual(GC(e));case 3:return function(l,d){if(typeof l.timestampValue=="string"&&typeof d.timestampValue=="string"&&l.timestampValue.length===d.timestampValue.length)return l.timestampValue===d.timestampValue;const p=Ng(l.timestampValue),_=Ng(d.timestampValue);return p.seconds===_.seconds&&p.nanos===_.nanos}(n,e);case 5:return n.stringValue===e.stringValue;case 6:return function(l,d){return Dg(l.bytesValue).isEqual(Dg(d.bytesValue))}(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return function(l,d){return $s(l.geoPointValue.latitude)===$s(d.geoPointValue.latitude)&&$s(l.geoPointValue.longitude)===$s(d.geoPointValue.longitude)}(n,e);case 2:return function(l,d){if("integerValue"in l&&"integerValue"in d)return $s(l.integerValue)===$s(d.integerValue);if("doubleValue"in l&&"doubleValue"in d){const p=$s(l.doubleValue),_=$s(d.doubleValue);return p===_?i1(p)===i1(_):isNaN(p)&&isNaN(_)}return!1}(n,e);case 9:return I0(n.arrayValue.values||[],e.arrayValue.values||[],pf);case 10:case 11:return function(l,d){const p=l.mapValue.fields||{},_=d.mapValue.fields||{};if(mJ(p)!==mJ(_))return!1;for(const E in p)if(p.hasOwnProperty(E)&&(_[E]===void 0||!pf(p[E],_[E])))return!1;return!0}(n,e);default:return $n()}}function $C(n,e){return(n.values||[]).find(i=>pf(i,e))!==void 0}function A0(n,e){if(n===e)return 0;const i=xg(n),o=xg(e);if(i!==o)return mr(i,o);switch(i){case 0:case 9007199254740991:return 0;case 1:return mr(n.booleanValue,e.booleanValue);case 2:return function(d,p){const _=$s(d.integerValue||d.doubleValue),E=$s(p.integerValue||p.doubleValue);return _<E?-1:_>E?1:_===E?0:isNaN(_)?isNaN(E)?0:-1:1}(n,e);case 3:return _J(n.timestampValue,e.timestampValue);case 4:return _J(GC(n),GC(e));case 5:return JV(n.stringValue,e.stringValue);case 6:return function(d,p){const _=Dg(d),E=Dg(p);return _.compareTo(E)}(n.bytesValue,e.bytesValue);case 7:return function(d,p){const _=d.split("/"),E=p.split("/");for(let b=0;b<_.length&&b<E.length;b++){const C=mr(_[b],E[b]);if(C!==0)return C}return mr(_.length,E.length)}(n.referenceValue,e.referenceValue);case 8:return function(d,p){const _=mr($s(d.latitude),$s(p.latitude));return _!==0?_:mr($s(d.longitude),$s(p.longitude))}(n.geoPointValue,e.geoPointValue);case 9:return yJ(n.arrayValue,e.arrayValue);case 10:return function(d,p){var _,E,b,C;const I=d.fields||{},O=p.fields||{},L=(_=I[o1])===null||_===void 0?void 0:_.arrayValue,V=(E=O[o1])===null||E===void 0?void 0:E.arrayValue,B=mr(((b=L==null?void 0:L.values)===null||b===void 0?void 0:b.length)||0,((C=V==null?void 0:V.values)===null||C===void 0?void 0:C.length)||0);return B!==0?B:yJ(L,V)}(n.mapValue,e.mapValue);case 11:return function(d,p){if(d===VO.mapValue&&p===VO.mapValue)return 0;if(d===VO.mapValue)return 1;if(p===VO.mapValue)return-1;const _=d.fields||{},E=Object.keys(_),b=p.fields||{},C=Object.keys(b);E.sort(),C.sort();for(let I=0;I<E.length&&I<C.length;++I){const O=JV(E[I],C[I]);if(O!==0)return O;const L=A0(_[E[I]],b[C[I]]);if(L!==0)return L}return mr(E.length,C.length)}(n.mapValue,e.mapValue);default:throw $n()}}function _J(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return mr(n,e);const i=Ng(n),o=Ng(e),l=mr(i.seconds,o.seconds);return l!==0?l:mr(i.nanos,o.nanos)}function yJ(n,e){const i=n.values||[],o=e.values||[];for(let l=0;l<i.length&&l<o.length;++l){const d=A0(i[l],o[l]);if(d)return d}return mr(i.length,o.length)}function P0(n){return QV(n)}function QV(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(i){const o=Ng(i);return`time(${o.seconds},${o.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?function(i){return Dg(i).toBase64()}(n.bytesValue):"referenceValue"in n?function(i){return Sn.fromName(i).toString()}(n.referenceValue):"geoPointValue"in n?function(i){return`geo(${i.latitude},${i.longitude})`}(n.geoPointValue):"arrayValue"in n?function(i){let o="[",l=!0;for(const d of i.values||[])l?l=!1:o+=",",o+=QV(d);return o+"]"}(n.arrayValue):"mapValue"in n?function(i){const o=Object.keys(i.fields||{}).sort();let l="{",d=!0;for(const p of o)d?d=!1:l+=",",l+=`${p}:${QV(i.fields[p])}`;return l+"}"}(n.mapValue):$n()}function Ck(n){switch(xg(n)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=uN(n);return e?16+Ck(e):16;case 5:return 2*n.stringValue.length;case 6:return Dg(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 9:return function(o){return(o.values||[]).reduce((l,d)=>l+Ck(d),0)}(n.arrayValue);case 10:case 11:return function(o){let l=0;return Wg(o.fields,(d,p)=>{l+=d.length+Ck(p)}),l}(n.mapValue);default:throw $n()}}function a1(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function ZV(n){return!!n&&"integerValue"in n}function w4(n){return!!n&&"arrayValue"in n}function EJ(n){return!!n&&"nullValue"in n}function vJ(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function Rk(n){return!!n&&"mapValue"in n}function V4e(n){var e,i;return((i=(((e=n==null?void 0:n.mapValue)===null||e===void 0?void 0:e.fields)||{})[Jie])===null||i===void 0?void 0:i.stringValue)===Qie}function pC(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){const e={mapValue:{fields:{}}};return Wg(n.mapValue.fields,(i,o)=>e.mapValue.fields[i]=pC(o)),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let i=0;i<(n.arrayValue.values||[]).length;++i)e.arrayValue.values[i]=pC(n.arrayValue.values[i]);return e}return Object.assign({},n)}function F4e(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue===U4e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class al{constructor(e){this.value=e}static empty(){return new al({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let i=this.value;for(let o=0;o<e.length-1;++o)if(i=(i.mapValue.fields||{})[e.get(o)],!Rk(i))return null;return i=(i.mapValue.fields||{})[e.lastSegment()],i||null}}set(e,i){this.getFieldsMap(e.popLast())[e.lastSegment()]=pC(i)}setAll(e){let i=va.emptyPath(),o={},l=[];e.forEach((p,_)=>{if(!i.isImmediateParentOf(_)){const E=this.getFieldsMap(i);this.applyChanges(E,o,l),o={},l=[],i=_.popLast()}p?o[_.lastSegment()]=pC(p):l.push(_.lastSegment())});const d=this.getFieldsMap(i);this.applyChanges(d,o,l)}delete(e){const i=this.field(e.popLast());Rk(i)&&i.mapValue.fields&&delete i.mapValue.fields[e.lastSegment()]}isEqual(e){return pf(this.value,e.value)}getFieldsMap(e){let i=this.value;i.mapValue.fields||(i.mapValue={fields:{}});for(let o=0;o<e.length;++o){let l=i.mapValue.fields[e.get(o)];Rk(l)&&l.mapValue.fields||(l={mapValue:{fields:{}}},i.mapValue.fields[e.get(o)]=l),i=l}return i.mapValue.fields}applyChanges(e,i,o){Wg(i,(l,d)=>e[l]=d);for(const l of o)delete e[l]}clone(){return new al(pC(this.value))}}function Zie(n){const e=[];return Wg(n.fields,(i,o)=>{const l=new va([i]);if(Rk(o)){const d=Zie(o.mapValue).fields;if(d.length===0)e.push(l);else for(const p of d)e.push(l.child(p))}else e.push(l)}),new Ul(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ja{constructor(e,i,o,l,d,p,_){this.key=e,this.documentType=i,this.version=o,this.readTime=l,this.createTime=d,this.data=p,this.documentState=_}static newInvalidDocument(e){return new Ja(e,0,Xn.min(),Xn.min(),Xn.min(),al.empty(),0)}static newFoundDocument(e,i,o,l){return new Ja(e,1,i,Xn.min(),o,l,0)}static newNoDocument(e,i){return new Ja(e,2,i,Xn.min(),Xn.min(),al.empty(),0)}static newUnknownDocument(e,i){return new Ja(e,3,i,Xn.min(),Xn.min(),al.empty(),2)}convertToFoundDocument(e,i){return!this.createTime.isEqual(Xn.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=i,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=al.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=al.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=Xn.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof Ja&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new Ja(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class O0{constructor(e,i){this.position=e,this.inclusive=i}}function SJ(n,e,i){let o=0;for(let l=0;l<n.position.length;l++){const d=e[l],p=n.position[l];if(d.field.isKeyField()?o=Sn.comparator(Sn.fromName(p.referenceValue),i.key):o=A0(p,i.data.field(d.field)),d.dir==="desc"&&(o*=-1),o!==0)break}return o}function bJ(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let i=0;i<n.position.length;i++)if(!pf(n.position[i],e.position[i]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class KC{constructor(e,i="asc"){this.field=e,this.dir=i}}function j4e(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ese{}class io extends ese{constructor(e,i,o){super(),this.field=e,this.op=i,this.value=o}static create(e,i,o){return e.isKeyField()?i==="in"||i==="not-in"?this.createKeyFieldInFilter(e,i,o):new W4e(e,i,o):i==="array-contains"?new H4e(e,o):i==="in"?new $4e(e,o):i==="not-in"?new K4e(e,o):i==="array-contains-any"?new q4e(e,o):new io(e,i,o)}static createKeyFieldInFilter(e,i,o){return i==="in"?new z4e(e,o):new G4e(e,o)}matches(e){const i=e.data.field(this.field);return this.op==="!="?i!==null&&this.matchesComparison(A0(i,this.value)):i!==null&&xg(this.value)===xg(i)&&this.matchesComparison(A0(i,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return $n()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class Fd extends ese{constructor(e,i){super(),this.filters=e,this.op=i,this.ce=null}static create(e,i){return new Fd(e,i)}matches(e){return tse(this)?this.filters.find(i=>!i.matches(e))===void 0:this.filters.find(i=>i.matches(e))!==void 0}getFlattenedFilters(){return this.ce!==null||(this.ce=this.filters.reduce((e,i)=>e.concat(i.getFlattenedFilters()),[])),this.ce}getFilters(){return Object.assign([],this.filters)}}function tse(n){return n.op==="and"}function nse(n){return B4e(n)&&tse(n)}function B4e(n){for(const e of n.filters)if(e instanceof Fd)return!1;return!0}function eF(n){if(n instanceof io)return n.field.canonicalString()+n.op.toString()+P0(n.value);if(nse(n))return n.filters.map(e=>eF(e)).join(",");{const e=n.filters.map(i=>eF(i)).join(",");return`${n.op}(${e})`}}function rse(n,e){return n instanceof io?function(o,l){return l instanceof io&&o.op===l.op&&o.field.isEqual(l.field)&&pf(o.value,l.value)}(n,e):n instanceof Fd?function(o,l){return l instanceof Fd&&o.op===l.op&&o.filters.length===l.filters.length?o.filters.reduce((d,p,_)=>d&&rse(p,l.filters[_]),!0):!1}(n,e):void $n()}function ise(n){return n instanceof io?function(i){return`${i.field.canonicalString()} ${i.op} ${P0(i.value)}`}(n):n instanceof Fd?function(i){return i.op.toString()+" {"+i.getFilters().map(ise).join(" ,")+"}"}(n):"Filter"}class W4e extends io{constructor(e,i,o){super(e,i,o),this.key=Sn.fromName(o.referenceValue)}matches(e){const i=Sn.comparator(e.key,this.key);return this.matchesComparison(i)}}class z4e extends io{constructor(e,i){super(e,"in",i),this.keys=sse("in",i)}matches(e){return this.keys.some(i=>i.isEqual(e.key))}}class G4e extends io{constructor(e,i){super(e,"not-in",i),this.keys=sse("not-in",i)}matches(e){return!this.keys.some(i=>i.isEqual(e.key))}}function sse(n,e){var i;return(((i=e.arrayValue)===null||i===void 0?void 0:i.values)||[]).map(o=>Sn.fromName(o.referenceValue))}class H4e extends io{constructor(e,i){super(e,"array-contains",i)}matches(e){const i=e.data.field(this.field);return w4(i)&&$C(i.arrayValue,this.value)}}class $4e extends io{constructor(e,i){super(e,"in",i)}matches(e){const i=e.data.field(this.field);return i!==null&&$C(this.value.arrayValue,i)}}class K4e extends io{constructor(e,i){super(e,"not-in",i)}matches(e){if($C(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const i=e.data.field(this.field);return i!==null&&!$C(this.value.arrayValue,i)}}class q4e extends io{constructor(e,i){super(e,"array-contains-any",i)}matches(e){const i=e.data.field(this.field);return!(!w4(i)||!i.arrayValue.values)&&i.arrayValue.values.some(o=>$C(this.value.arrayValue,o))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Y4e{constructor(e,i=null,o=[],l=[],d=null,p=null,_=null){this.path=e,this.collectionGroup=i,this.orderBy=o,this.filters=l,this.limit=d,this.startAt=p,this.endAt=_,this.le=null}}function TJ(n,e=null,i=[],o=[],l=null,d=null,p=null){return new Y4e(n,e,i,o,l,d,p)}function C4(n){const e=er(n);if(e.le===null){let i=e.path.canonicalString();e.collectionGroup!==null&&(i+="|cg:"+e.collectionGroup),i+="|f:",i+=e.filters.map(o=>eF(o)).join(","),i+="|ob:",i+=e.orderBy.map(o=>function(d){return d.field.canonicalString()+d.dir}(o)).join(","),cN(e.limit)||(i+="|l:",i+=e.limit),e.startAt&&(i+="|lb:",i+=e.startAt.inclusive?"b:":"a:",i+=e.startAt.position.map(o=>P0(o)).join(",")),e.endAt&&(i+="|ub:",i+=e.endAt.inclusive?"a:":"b:",i+=e.endAt.position.map(o=>P0(o)).join(",")),e.le=i}return e.le}function R4(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let i=0;i<n.orderBy.length;i++)if(!j4e(n.orderBy[i],e.orderBy[i]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let i=0;i<n.filters.length;i++)if(!rse(n.filters[i],e.filters[i]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!bJ(n.startAt,e.startAt)&&bJ(n.endAt,e.endAt)}function tF(n){return Sn.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zy{constructor(e,i=null,o=[],l=[],d=null,p="F",_=null,E=null){this.path=e,this.collectionGroup=i,this.explicitOrderBy=o,this.filters=l,this.limit=d,this.limitType=p,this.startAt=_,this.endAt=E,this.he=null,this.Pe=null,this.Te=null,this.startAt,this.endAt}}function X4e(n,e,i,o,l,d,p,_){return new Zy(n,e,i,o,l,d,p,_)}function dN(n){return new Zy(n)}function wJ(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function I4(n){return n.collectionGroup!==null}function l0(n){const e=er(n);if(e.he===null){e.he=[];const i=new Set;for(const d of e.explicitOrderBy)e.he.push(d),i.add(d.field.canonicalString());const o=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(p){let _=new bo(va.comparator);return p.filters.forEach(E=>{E.getFlattenedFilters().forEach(b=>{b.isInequality()&&(_=_.add(b.field))})}),_})(e).forEach(d=>{i.has(d.canonicalString())||d.isKeyField()||e.he.push(new KC(d,o))}),i.has(va.keyField().canonicalString())||e.he.push(new KC(va.keyField(),o))}return e.he}function uf(n){const e=er(n);return e.Pe||(e.Pe=J4e(e,l0(n))),e.Pe}function J4e(n,e){if(n.limitType==="F")return TJ(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map(l=>{const d=l.dir==="desc"?"asc":"desc";return new KC(l.field,d)});const i=n.endAt?new O0(n.endAt.position,n.endAt.inclusive):null,o=n.startAt?new O0(n.startAt.position,n.startAt.inclusive):null;return TJ(n.path,n.collectionGroup,e,n.filters,n.limit,i,o)}}function nF(n,e){const i=n.filters.concat([e]);return new Zy(n.path,n.collectionGroup,n.explicitOrderBy.slice(),i,n.limit,n.limitType,n.startAt,n.endAt)}function c1(n,e,i){return new Zy(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,i,n.startAt,n.endAt)}function hN(n,e){return R4(uf(n),uf(e))&&n.limitType===e.limitType}function ose(n){return`${C4(uf(n))}|lt:${n.limitType}`}function kS(n){return`Query(target=${function(i){let o=i.path.canonicalString();return i.collectionGroup!==null&&(o+=" collectionGroup="+i.collectionGroup),i.filters.length>0&&(o+=`, filters: [${i.filters.map(l=>ise(l)).join(", ")}]`),cN(i.limit)||(o+=", limit: "+i.limit),i.orderBy.length>0&&(o+=`, orderBy: [${i.orderBy.map(l=>function(p){return`${p.field.canonicalString()} (${p.dir})`}(l)).join(", ")}]`),i.startAt&&(o+=", startAt: ",o+=i.startAt.inclusive?"b:":"a:",o+=i.startAt.position.map(l=>P0(l)).join(",")),i.endAt&&(o+=", endAt: ",o+=i.endAt.inclusive?"a:":"b:",o+=i.endAt.position.map(l=>P0(l)).join(",")),`Target(${o})`}(uf(n))}; limitType=${n.limitType})`}function fN(n,e){return e.isFoundDocument()&&function(o,l){const d=l.key.path;return o.collectionGroup!==null?l.key.hasCollectionId(o.collectionGroup)&&o.path.isPrefixOf(d):Sn.isDocumentKey(o.path)?o.path.isEqual(d):o.path.isImmediateParentOf(d)}(n,e)&&function(o,l){for(const d of l0(o))if(!d.field.isKeyField()&&l.data.field(d.field)===null)return!1;return!0}(n,e)&&function(o,l){for(const d of o.filters)if(!d.matches(l))return!1;return!0}(n,e)&&function(o,l){return!(o.startAt&&!function(p,_,E){const b=SJ(p,_,E);return p.inclusive?b<=0:b<0}(o.startAt,l0(o),l)||o.endAt&&!function(p,_,E){const b=SJ(p,_,E);return p.inclusive?b>=0:b>0}(o.endAt,l0(o),l))}(n,e)}function Q4e(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function ase(n){return(e,i)=>{let o=!1;for(const l of l0(n)){const d=Z4e(l,e,i);if(d!==0)return d;o=o||l.field.isKeyField()}return 0}}function Z4e(n,e,i){const o=n.field.isKeyField()?Sn.comparator(e.key,i.key):function(d,p,_){const E=p.data.field(d),b=_.data.field(d);return E!==null&&b!==null?A0(E,b):$n()}(n.field,e,i);switch(n.dir){case"asc":return o;case"desc":return-1*o;default:return $n()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eE{constructor(e,i){this.mapKeyFn=e,this.equalsFn=i,this.inner={},this.innerSize=0}get(e){const i=this.mapKeyFn(e),o=this.inner[i];if(o!==void 0){for(const[l,d]of o)if(this.equalsFn(l,e))return d}}has(e){return this.get(e)!==void 0}set(e,i){const o=this.mapKeyFn(e),l=this.inner[o];if(l===void 0)return this.inner[o]=[[e,i]],void this.innerSize++;for(let d=0;d<l.length;d++)if(this.equalsFn(l[d][0],e))return void(l[d]=[e,i]);l.push([e,i]),this.innerSize++}delete(e){const i=this.mapKeyFn(e),o=this.inner[i];if(o===void 0)return!1;for(let l=0;l<o.length;l++)if(this.equalsFn(o[l][0],e))return o.length===1?delete this.inner[i]:o.splice(l,1),this.innerSize--,!0;return!1}forEach(e){Wg(this.inner,(i,o)=>{for(const[l,d]of o)e(l,d)})}isEmpty(){return Hie(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const e3e=new ys(Sn.comparator);function qp(){return e3e}const cse=new ys(Sn.comparator);function Xw(...n){let e=cse;for(const i of n)e=e.insert(i.key,i);return e}function lse(n){let e=cse;return n.forEach((i,o)=>e=e.insert(i,o.overlayedDocument)),e}function wy(){return mC()}function use(){return mC()}function mC(){return new eE(n=>n.toString(),(n,e)=>n.isEqual(e))}const t3e=new ys(Sn.comparator),n3e=new bo(Sn.comparator);function Pr(...n){let e=n3e;for(const i of n)e=e.add(i);return e}const r3e=new bo(mr);function i3e(){return r3e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function A4(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:i1(e)?"-0":e}}function dse(n){return{integerValue:""+n}}function s3e(n,e){return N4e(e)?dse(e):A4(n,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pN{constructor(){this._=void 0}}function o3e(n,e,i){return n instanceof l1?function(l,d){const p={fields:{[qie]:{stringValue:Kie},[Xie]:{timestampValue:{seconds:l.seconds,nanos:l.nanoseconds}}}};return d&&lN(d)&&(d=uN(d)),d&&(p.fields[Yie]=d),{mapValue:p}}(i,e):n instanceof k0?fse(n,e):n instanceof N0?pse(n,e):function(l,d){const p=hse(l,d),_=CJ(p)+CJ(l.Ie);return ZV(p)&&ZV(l.Ie)?dse(_):A4(l.serializer,_)}(n,e)}function a3e(n,e,i){return n instanceof k0?fse(n,e):n instanceof N0?pse(n,e):i}function hse(n,e){return n instanceof u1?function(o){return ZV(o)||function(d){return!!d&&"doubleValue"in d}(o)}(e)?e:{integerValue:0}:null}class l1 extends pN{}class k0 extends pN{constructor(e){super(),this.elements=e}}function fse(n,e){const i=mse(e);for(const o of n.elements)i.some(l=>pf(l,o))||i.push(o);return{arrayValue:{values:i}}}class N0 extends pN{constructor(e){super(),this.elements=e}}function pse(n,e){let i=mse(e);for(const o of n.elements)i=i.filter(l=>!pf(l,o));return{arrayValue:{values:i}}}class u1 extends pN{constructor(e,i){super(),this.serializer=e,this.Ie=i}}function CJ(n){return $s(n.integerValue||n.doubleValue)}function mse(n){return w4(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gse{constructor(e,i){this.field=e,this.transform=i}}function c3e(n,e){return n.field.isEqual(e.field)&&function(o,l){return o instanceof k0&&l instanceof k0||o instanceof N0&&l instanceof N0?I0(o.elements,l.elements,pf):o instanceof u1&&l instanceof u1?pf(o.Ie,l.Ie):o instanceof l1&&l instanceof l1}(n.transform,e.transform)}class l3e{constructor(e,i){this.version=e,this.transformResults=i}}class Lu{constructor(e,i){this.updateTime=e,this.exists=i}static none(){return new Lu}static exists(e){return new Lu(void 0,e)}static updateTime(e){return new Lu(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Ik(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}class mN{}function _se(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new P4(n.key,Lu.none()):new bR(n.key,n.data,Lu.none());{const i=n.data,o=al.empty();let l=new bo(va.comparator);for(let d of e.fields)if(!l.has(d)){let p=i.field(d);p===null&&d.length>1&&(d=d.popLast(),p=i.field(d)),p===null?o.delete(d):o.set(d,p),l=l.add(d)}return new zg(n.key,o,new Ul(l.toArray()),Lu.none())}}function u3e(n,e,i){n instanceof bR?function(l,d,p){const _=l.value.clone(),E=IJ(l.fieldTransforms,d,p.transformResults);_.setAll(E),d.convertToFoundDocument(p.version,_).setHasCommittedMutations()}(n,e,i):n instanceof zg?function(l,d,p){if(!Ik(l.precondition,d))return void d.convertToUnknownDocument(p.version);const _=IJ(l.fieldTransforms,d,p.transformResults),E=d.data;E.setAll(yse(l)),E.setAll(_),d.convertToFoundDocument(p.version,E).setHasCommittedMutations()}(n,e,i):function(l,d,p){d.convertToNoDocument(p.version).setHasCommittedMutations()}(0,e,i)}function gC(n,e,i,o){return n instanceof bR?function(d,p,_,E){if(!Ik(d.precondition,p))return _;const b=d.value.clone(),C=AJ(d.fieldTransforms,E,p);return b.setAll(C),p.convertToFoundDocument(p.version,b).setHasLocalMutations(),null}(n,e,i,o):n instanceof zg?function(d,p,_,E){if(!Ik(d.precondition,p))return _;const b=AJ(d.fieldTransforms,E,p),C=p.data;return C.setAll(yse(d)),C.setAll(b),p.convertToFoundDocument(p.version,C).setHasLocalMutations(),_===null?null:_.unionWith(d.fieldMask.fields).unionWith(d.fieldTransforms.map(I=>I.field))}(n,e,i,o):function(d,p,_){return Ik(d.precondition,p)?(p.convertToNoDocument(p.version).setHasLocalMutations(),null):_}(n,e,i)}function d3e(n,e){let i=null;for(const o of n.fieldTransforms){const l=e.data.field(o.field),d=hse(o.transform,l||null);d!=null&&(i===null&&(i=al.empty()),i.set(o.field,d))}return i||null}function RJ(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!function(o,l){return o===void 0&&l===void 0||!(!o||!l)&&I0(o,l,(d,p)=>c3e(d,p))}(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}class bR extends mN{constructor(e,i,o,l=[]){super(),this.key=e,this.value=i,this.precondition=o,this.fieldTransforms=l,this.type=0}getFieldMask(){return null}}class zg extends mN{constructor(e,i,o,l,d=[]){super(),this.key=e,this.data=i,this.fieldMask=o,this.precondition=l,this.fieldTransforms=d,this.type=1}getFieldMask(){return this.fieldMask}}function yse(n){const e=new Map;return n.fieldMask.fields.forEach(i=>{if(!i.isEmpty()){const o=n.data.field(i);e.set(i,o)}}),e}function IJ(n,e,i){const o=new Map;mi(n.length===i.length);for(let l=0;l<i.length;l++){const d=n[l],p=d.transform,_=e.data.field(d.field);o.set(d.field,a3e(p,_,i[l]))}return o}function AJ(n,e,i){const o=new Map;for(const l of n){const d=l.transform,p=i.data.field(l.field);o.set(l.field,o3e(d,p,e))}return o}class P4 extends mN{constructor(e,i){super(),this.key=e,this.precondition=i,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class h3e extends mN{constructor(e,i){super(),this.key=e,this.precondition=i,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class f3e{constructor(e,i,o,l){this.batchId=e,this.localWriteTime=i,this.baseMutations=o,this.mutations=l}applyToRemoteDocument(e,i){const o=i.mutationResults;for(let l=0;l<this.mutations.length;l++){const d=this.mutations[l];d.key.isEqual(e.key)&&u3e(d,e,o[l])}}applyToLocalView(e,i){for(const o of this.baseMutations)o.key.isEqual(e.key)&&(i=gC(o,e,i,this.localWriteTime));for(const o of this.mutations)o.key.isEqual(e.key)&&(i=gC(o,e,i,this.localWriteTime));return i}applyToLocalDocumentSet(e,i){const o=use();return this.mutations.forEach(l=>{const d=e.get(l.key),p=d.overlayedDocument;let _=this.applyToLocalView(p,d.mutatedFields);_=i.has(l.key)?null:_;const E=_se(p,_);E!==null&&o.set(l.key,E),p.isValidDocument()||p.convertToNoDocument(Xn.min())}),o}keys(){return this.mutations.reduce((e,i)=>e.add(i.key),Pr())}isEqual(e){return this.batchId===e.batchId&&I0(this.mutations,e.mutations,(i,o)=>RJ(i,o))&&I0(this.baseMutations,e.baseMutations,(i,o)=>RJ(i,o))}}class O4{constructor(e,i,o,l){this.batch=e,this.commitVersion=i,this.mutationResults=o,this.docVersions=l}static from(e,i,o){mi(e.mutations.length===o.length);let l=function(){return t3e}();const d=e.mutations;for(let p=0;p<d.length;p++)l=l.insert(d[p].key,o[p].version);return new O4(e,i,o,l)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class p3e{constructor(e,i){this.largestBatchId=e,this.mutation=i}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class m3e{constructor(e,i){this.count=e,this.unchangedNames=i}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var eo,Fr;function g3e(n){switch(n){case Et.OK:return $n();case Et.CANCELLED:case Et.UNKNOWN:case Et.DEADLINE_EXCEEDED:case Et.RESOURCE_EXHAUSTED:case Et.INTERNAL:case Et.UNAVAILABLE:case Et.UNAUTHENTICATED:return!1;case Et.INVALID_ARGUMENT:case Et.NOT_FOUND:case Et.ALREADY_EXISTS:case Et.PERMISSION_DENIED:case Et.FAILED_PRECONDITION:case Et.ABORTED:case Et.OUT_OF_RANGE:case Et.UNIMPLEMENTED:case Et.DATA_LOSS:return!0;default:return $n()}}function Ese(n){if(n===void 0)return Kp("GRPC error has no .code"),Et.UNKNOWN;switch(n){case eo.OK:return Et.OK;case eo.CANCELLED:return Et.CANCELLED;case eo.UNKNOWN:return Et.UNKNOWN;case eo.DEADLINE_EXCEEDED:return Et.DEADLINE_EXCEEDED;case eo.RESOURCE_EXHAUSTED:return Et.RESOURCE_EXHAUSTED;case eo.INTERNAL:return Et.INTERNAL;case eo.UNAVAILABLE:return Et.UNAVAILABLE;case eo.UNAUTHENTICATED:return Et.UNAUTHENTICATED;case eo.INVALID_ARGUMENT:return Et.INVALID_ARGUMENT;case eo.NOT_FOUND:return Et.NOT_FOUND;case eo.ALREADY_EXISTS:return Et.ALREADY_EXISTS;case eo.PERMISSION_DENIED:return Et.PERMISSION_DENIED;case eo.FAILED_PRECONDITION:return Et.FAILED_PRECONDITION;case eo.ABORTED:return Et.ABORTED;case eo.OUT_OF_RANGE:return Et.OUT_OF_RANGE;case eo.UNIMPLEMENTED:return Et.UNIMPLEMENTED;case eo.DATA_LOSS:return Et.DATA_LOSS;default:return $n()}}(Fr=eo||(eo={}))[Fr.OK=0]="OK",Fr[Fr.CANCELLED=1]="CANCELLED",Fr[Fr.UNKNOWN=2]="UNKNOWN",Fr[Fr.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Fr[Fr.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Fr[Fr.NOT_FOUND=5]="NOT_FOUND",Fr[Fr.ALREADY_EXISTS=6]="ALREADY_EXISTS",Fr[Fr.PERMISSION_DENIED=7]="PERMISSION_DENIED",Fr[Fr.UNAUTHENTICATED=16]="UNAUTHENTICATED",Fr[Fr.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Fr[Fr.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Fr[Fr.ABORTED=10]="ABORTED",Fr[Fr.OUT_OF_RANGE=11]="OUT_OF_RANGE",Fr[Fr.UNIMPLEMENTED=12]="UNIMPLEMENTED",Fr[Fr.INTERNAL=13]="INTERNAL",Fr[Fr.UNAVAILABLE=14]="UNAVAILABLE",Fr[Fr.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _3e=new wg([4294967295,4294967295],0);function PJ(n){const e=Wie().encode(n),i=new Lie;return i.update(e),new Uint8Array(i.digest())}function OJ(n){const e=new DataView(n.buffer),i=e.getUint32(0,!0),o=e.getUint32(4,!0),l=e.getUint32(8,!0),d=e.getUint32(12,!0);return[new wg([i,o],0),new wg([l,d],0)]}class k4{constructor(e,i,o){if(this.bitmap=e,this.padding=i,this.hashCount=o,i<0||i>=8)throw new Jw(`Invalid padding: ${i}`);if(o<0)throw new Jw(`Invalid hash count: ${o}`);if(e.length>0&&this.hashCount===0)throw new Jw(`Invalid hash count: ${o}`);if(e.length===0&&i!==0)throw new Jw(`Invalid padding when bitmap length is 0: ${i}`);this.Ee=8*e.length-i,this.de=wg.fromNumber(this.Ee)}Ae(e,i,o){let l=e.add(i.multiply(wg.fromNumber(o)));return l.compare(_3e)===1&&(l=new wg([l.getBits(0),l.getBits(1)],0)),l.modulo(this.de).toNumber()}Re(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.Ee===0)return!1;const i=PJ(e),[o,l]=OJ(i);for(let d=0;d<this.hashCount;d++){const p=this.Ae(o,l,d);if(!this.Re(p))return!1}return!0}static create(e,i,o){const l=e%8==0?0:8-e%8,d=new Uint8Array(Math.ceil(e/8)),p=new k4(d,l,i);return o.forEach(_=>p.insert(_)),p}insert(e){if(this.Ee===0)return;const i=PJ(e),[o,l]=OJ(i);for(let d=0;d<this.hashCount;d++){const p=this.Ae(o,l,d);this.Ve(p)}}Ve(e){const i=Math.floor(e/8),o=e%8;this.bitmap[i]|=1<<o}}class Jw extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gN{constructor(e,i,o,l,d){this.snapshotVersion=e,this.targetChanges=i,this.targetMismatches=o,this.documentUpdates=l,this.resolvedLimboDocuments=d}static createSynthesizedRemoteEventForCurrentChange(e,i,o){const l=new Map;return l.set(e,TR.createSynthesizedTargetChangeForCurrentChange(e,i,o)),new gN(Xn.min(),l,new ys(mr),qp(),Pr())}}class TR{constructor(e,i,o,l,d){this.resumeToken=e,this.current=i,this.addedDocuments=o,this.modifiedDocuments=l,this.removedDocuments=d}static createSynthesizedTargetChangeForCurrentChange(e,i,o){return new TR(o,i,Pr(),Pr(),Pr())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ak{constructor(e,i,o,l){this.me=e,this.removedTargetIds=i,this.key=o,this.fe=l}}class vse{constructor(e,i){this.targetId=e,this.ge=i}}class Sse{constructor(e,i,o=Sa.EMPTY_BYTE_STRING,l=null){this.state=e,this.targetIds=i,this.resumeToken=o,this.cause=l}}class kJ{constructor(){this.pe=0,this.ye=NJ(),this.we=Sa.EMPTY_BYTE_STRING,this.Se=!1,this.be=!0}get current(){return this.Se}get resumeToken(){return this.we}get De(){return this.pe!==0}get ve(){return this.be}Ce(e){e.approximateByteSize()>0&&(this.be=!0,this.we=e)}Fe(){let e=Pr(),i=Pr(),o=Pr();return this.ye.forEach((l,d)=>{switch(d){case 0:e=e.add(l);break;case 2:i=i.add(l);break;case 1:o=o.add(l);break;default:$n()}}),new TR(this.we,this.Se,e,i,o)}Me(){this.be=!1,this.ye=NJ()}xe(e,i){this.be=!0,this.ye=this.ye.insert(e,i)}Oe(e){this.be=!0,this.ye=this.ye.remove(e)}Ne(){this.pe+=1}Be(){this.pe-=1,mi(this.pe>=0)}Le(){this.be=!0,this.Se=!0}}class y3e{constructor(e){this.ke=e,this.qe=new Map,this.Qe=qp(),this.$e=FO(),this.Ue=FO(),this.Ke=new ys(mr)}We(e){for(const i of e.me)e.fe&&e.fe.isFoundDocument()?this.Ge(i,e.fe):this.ze(i,e.key,e.fe);for(const i of e.removedTargetIds)this.ze(i,e.key,e.fe)}je(e){this.forEachTarget(e,i=>{const o=this.He(i);switch(e.state){case 0:this.Je(i)&&o.Ce(e.resumeToken);break;case 1:o.Be(),o.De||o.Me(),o.Ce(e.resumeToken);break;case 2:o.Be(),o.De||this.removeTarget(i);break;case 3:this.Je(i)&&(o.Le(),o.Ce(e.resumeToken));break;case 4:this.Je(i)&&(this.Ye(i),o.Ce(e.resumeToken));break;default:$n()}})}forEachTarget(e,i){e.targetIds.length>0?e.targetIds.forEach(i):this.qe.forEach((o,l)=>{this.Je(l)&&i(l)})}Ze(e){const i=e.targetId,o=e.ge.count,l=this.Xe(i);if(l){const d=l.target;if(tF(d))if(o===0){const p=new Sn(d.path);this.ze(i,p,Ja.newNoDocument(p,Xn.min()))}else mi(o===1);else{const p=this.et(i);if(p!==o){const _=this.tt(e),E=_?this.nt(_,e,p):1;if(E!==0){this.Ye(i);const b=E===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ke=this.Ke.insert(i,b)}}}}}tt(e){const i=e.ge.unchangedNames;if(!i||!i.bits)return null;const{bits:{bitmap:o="",padding:l=0},hashCount:d=0}=i;let p,_;try{p=Dg(o).toUint8Array()}catch(E){if(E instanceof $ie)return R0("Decoding the base64 bloom filter in existence filter failed ("+E.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw E}try{_=new k4(p,l,d)}catch(E){return R0(E instanceof Jw?"BloomFilter error: ":"Applying bloom filter failed: ",E),null}return _.Ee===0?null:_}nt(e,i,o){return i.ge.count===o-this.st(e,i.targetId)?0:2}st(e,i){const o=this.ke.getRemoteKeysForTarget(i);let l=0;return o.forEach(d=>{const p=this.ke.it(),_=`projects/${p.projectId}/databases/${p.database}/documents/${d.path.canonicalString()}`;e.mightContain(_)||(this.ze(i,d,null),l++)}),l}ot(e){const i=new Map;this.qe.forEach((d,p)=>{const _=this.Xe(p);if(_){if(d.current&&tF(_.target)){const E=new Sn(_.target.path);this._t(E).has(p)||this.ut(p,E)||this.ze(p,E,Ja.newNoDocument(E,e))}d.ve&&(i.set(p,d.Fe()),d.Me())}});let o=Pr();this.Ue.forEach((d,p)=>{let _=!0;p.forEachWhile(E=>{const b=this.Xe(E);return!b||b.purpose==="TargetPurposeLimboResolution"||(_=!1,!1)}),_&&(o=o.add(d))}),this.Qe.forEach((d,p)=>p.setReadTime(e));const l=new gN(e,i,this.Ke,this.Qe,o);return this.Qe=qp(),this.$e=FO(),this.Ue=FO(),this.Ke=new ys(mr),l}Ge(e,i){if(!this.Je(e))return;const o=this.ut(e,i.key)?2:0;this.He(e).xe(i.key,o),this.Qe=this.Qe.insert(i.key,i),this.$e=this.$e.insert(i.key,this._t(i.key).add(e)),this.Ue=this.Ue.insert(i.key,this.ct(i.key).add(e))}ze(e,i,o){if(!this.Je(e))return;const l=this.He(e);this.ut(e,i)?l.xe(i,1):l.Oe(i),this.Ue=this.Ue.insert(i,this.ct(i).delete(e)),this.Ue=this.Ue.insert(i,this.ct(i).add(e)),o&&(this.Qe=this.Qe.insert(i,o))}removeTarget(e){this.qe.delete(e)}et(e){const i=this.He(e).Fe();return this.ke.getRemoteKeysForTarget(e).size+i.addedDocuments.size-i.removedDocuments.size}Ne(e){this.He(e).Ne()}He(e){let i=this.qe.get(e);return i||(i=new kJ,this.qe.set(e,i)),i}ct(e){let i=this.Ue.get(e);return i||(i=new bo(mr),this.Ue=this.Ue.insert(e,i)),i}_t(e){let i=this.$e.get(e);return i||(i=new bo(mr),this.$e=this.$e.insert(e,i)),i}Je(e){const i=this.Xe(e)!==null;return i||nn("WatchChangeAggregator","Detected inactive target",e),i}Xe(e){const i=this.qe.get(e);return i&&i.De?null:this.ke.lt(e)}Ye(e){this.qe.set(e,new kJ),this.ke.getRemoteKeysForTarget(e).forEach(i=>{this.ze(e,i,null)})}ut(e,i){return this.ke.getRemoteKeysForTarget(e).has(i)}}function FO(){return new ys(Sn.comparator)}function NJ(){return new ys(Sn.comparator)}const E3e={asc:"ASCENDING",desc:"DESCENDING"},v3e={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},S3e={and:"AND",or:"OR"};class b3e{constructor(e,i){this.databaseId=e,this.useProto3Json=i}}function rF(n,e){return n.useProto3Json||cN(e)?e:{value:e}}function d1(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function bse(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function T3e(n,e){return d1(n,e.toTimestamp())}function df(n){return mi(!!n),Xn.fromTimestamp(function(i){const o=Ng(i);return new So(o.seconds,o.nanos)}(n))}function N4(n,e){return iF(n,e).canonicalString()}function iF(n,e){const i=function(l){return new Wi(["projects",l.projectId,"databases",l.database])}(n).child("documents");return e===void 0?i:i.child(e)}function Tse(n){const e=Wi.fromString(n);return mi(Ase(e)),e}function sF(n,e){return N4(n.databaseId,e.path)}function RU(n,e){const i=Tse(e);if(i.get(1)!==n.databaseId.projectId)throw new Kt(Et.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+i.get(1)+" vs "+n.databaseId.projectId);if(i.get(3)!==n.databaseId.database)throw new Kt(Et.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+i.get(3)+" vs "+n.databaseId.database);return new Sn(Cse(i))}function wse(n,e){return N4(n.databaseId,e)}function w3e(n){const e=Tse(n);return e.length===4?Wi.emptyPath():Cse(e)}function oF(n){return new Wi(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function Cse(n){return mi(n.length>4&&n.get(4)==="documents"),n.popFirst(5)}function DJ(n,e,i){return{name:sF(n,e),fields:i.value.mapValue.fields}}function C3e(n,e){let i;if("targetChange"in e){e.targetChange;const o=function(b){return b==="NO_CHANGE"?0:b==="ADD"?1:b==="REMOVE"?2:b==="CURRENT"?3:b==="RESET"?4:$n()}(e.targetChange.targetChangeType||"NO_CHANGE"),l=e.targetChange.targetIds||[],d=function(b,C){return b.useProto3Json?(mi(C===void 0||typeof C=="string"),Sa.fromBase64String(C||"")):(mi(C===void 0||C instanceof Buffer||C instanceof Uint8Array),Sa.fromUint8Array(C||new Uint8Array))}(n,e.targetChange.resumeToken),p=e.targetChange.cause,_=p&&function(b){const C=b.code===void 0?Et.UNKNOWN:Ese(b.code);return new Kt(C,b.message||"")}(p);i=new Sse(o,l,d,_||null)}else if("documentChange"in e){e.documentChange;const o=e.documentChange;o.document,o.document.name,o.document.updateTime;const l=RU(n,o.document.name),d=df(o.document.updateTime),p=o.document.createTime?df(o.document.createTime):Xn.min(),_=new al({mapValue:{fields:o.document.fields}}),E=Ja.newFoundDocument(l,d,p,_),b=o.targetIds||[],C=o.removedTargetIds||[];i=new Ak(b,C,E.key,E)}else if("documentDelete"in e){e.documentDelete;const o=e.documentDelete;o.document;const l=RU(n,o.document),d=o.readTime?df(o.readTime):Xn.min(),p=Ja.newNoDocument(l,d),_=o.removedTargetIds||[];i=new Ak([],_,p.key,p)}else if("documentRemove"in e){e.documentRemove;const o=e.documentRemove;o.document;const l=RU(n,o.document),d=o.removedTargetIds||[];i=new Ak([],d,l,null)}else{if(!("filter"in e))return $n();{e.filter;const o=e.filter;o.targetId;const{count:l=0,unchangedNames:d}=o,p=new m3e(l,d),_=o.targetId;i=new vse(_,p)}}return i}function R3e(n,e){let i;if(e instanceof bR)i={update:DJ(n,e.key,e.value)};else if(e instanceof P4)i={delete:sF(n,e.key)};else if(e instanceof zg)i={update:DJ(n,e.key,e.data),updateMask:L3e(e.fieldMask)};else{if(!(e instanceof h3e))return $n();i={verify:sF(n,e.key)}}return e.fieldTransforms.length>0&&(i.updateTransforms=e.fieldTransforms.map(o=>function(d,p){const _=p.transform;if(_ instanceof l1)return{fieldPath:p.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(_ instanceof k0)return{fieldPath:p.field.canonicalString(),appendMissingElements:{values:_.elements}};if(_ instanceof N0)return{fieldPath:p.field.canonicalString(),removeAllFromArray:{values:_.elements}};if(_ instanceof u1)return{fieldPath:p.field.canonicalString(),increment:_.Ie};throw $n()}(0,o))),e.precondition.isNone||(i.currentDocument=function(l,d){return d.updateTime!==void 0?{updateTime:T3e(l,d.updateTime)}:d.exists!==void 0?{exists:d.exists}:$n()}(n,e.precondition)),i}function I3e(n,e){return n&&n.length>0?(mi(e!==void 0),n.map(i=>function(l,d){let p=l.updateTime?df(l.updateTime):df(d);return p.isEqual(Xn.min())&&(p=df(d)),new l3e(p,l.transformResults||[])}(i,e))):[]}function A3e(n,e){return{documents:[wse(n,e.path)]}}function P3e(n,e){const i={structuredQuery:{}},o=e.path;let l;e.collectionGroup!==null?(l=o,i.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(l=o.popLast(),i.structuredQuery.from=[{collectionId:o.lastSegment()}]),i.parent=wse(n,l);const d=function(b){if(b.length!==0)return Ise(Fd.create(b,"and"))}(e.filters);d&&(i.structuredQuery.where=d);const p=function(b){if(b.length!==0)return b.map(C=>function(O){return{field:NS(O.field),direction:N3e(O.dir)}}(C))}(e.orderBy);p&&(i.structuredQuery.orderBy=p);const _=rF(n,e.limit);return _!==null&&(i.structuredQuery.limit=_),e.startAt&&(i.structuredQuery.startAt=function(b){return{before:b.inclusive,values:b.position}}(e.startAt)),e.endAt&&(i.structuredQuery.endAt=function(b){return{before:!b.inclusive,values:b.position}}(e.endAt)),{ht:i,parent:l}}function O3e(n){let e=w3e(n.parent);const i=n.structuredQuery,o=i.from?i.from.length:0;let l=null;if(o>0){mi(o===1);const C=i.from[0];C.allDescendants?l=C.collectionId:e=e.child(C.collectionId)}let d=[];i.where&&(d=function(I){const O=Rse(I);return O instanceof Fd&&nse(O)?O.getFilters():[O]}(i.where));let p=[];i.orderBy&&(p=function(I){return I.map(O=>function(V){return new KC(DS(V.field),function(W){switch(W){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(V.direction))}(O))}(i.orderBy));let _=null;i.limit&&(_=function(I){let O;return O=typeof I=="object"?I.value:I,cN(O)?null:O}(i.limit));let E=null;i.startAt&&(E=function(I){const O=!!I.before,L=I.values||[];return new O0(L,O)}(i.startAt));let b=null;return i.endAt&&(b=function(I){const O=!I.before,L=I.values||[];return new O0(L,O)}(i.endAt)),X4e(e,l,p,d,_,"F",E,b)}function k3e(n,e){const i=function(l){switch(l){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return $n()}}(e.purpose);return i==null?null:{"goog-listen-tags":i}}function Rse(n){return n.unaryFilter!==void 0?function(i){switch(i.unaryFilter.op){case"IS_NAN":const o=DS(i.unaryFilter.field);return io.create(o,"==",{doubleValue:NaN});case"IS_NULL":const l=DS(i.unaryFilter.field);return io.create(l,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const d=DS(i.unaryFilter.field);return io.create(d,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const p=DS(i.unaryFilter.field);return io.create(p,"!=",{nullValue:"NULL_VALUE"});default:return $n()}}(n):n.fieldFilter!==void 0?function(i){return io.create(DS(i.fieldFilter.field),function(l){switch(l){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return $n()}}(i.fieldFilter.op),i.fieldFilter.value)}(n):n.compositeFilter!==void 0?function(i){return Fd.create(i.compositeFilter.filters.map(o=>Rse(o)),function(l){switch(l){case"AND":return"and";case"OR":return"or";default:return $n()}}(i.compositeFilter.op))}(n):$n()}function N3e(n){return E3e[n]}function D3e(n){return v3e[n]}function x3e(n){return S3e[n]}function NS(n){return{fieldPath:n.canonicalString()}}function DS(n){return va.fromServerFormat(n.fieldPath)}function Ise(n){return n instanceof io?function(i){if(i.op==="=="){if(vJ(i.value))return{unaryFilter:{field:NS(i.field),op:"IS_NAN"}};if(EJ(i.value))return{unaryFilter:{field:NS(i.field),op:"IS_NULL"}}}else if(i.op==="!="){if(vJ(i.value))return{unaryFilter:{field:NS(i.field),op:"IS_NOT_NAN"}};if(EJ(i.value))return{unaryFilter:{field:NS(i.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:NS(i.field),op:D3e(i.op),value:i.value}}}(n):n instanceof Fd?function(i){const o=i.getFilters().map(l=>Ise(l));return o.length===1?o[0]:{compositeFilter:{op:x3e(i.op),filters:o}}}(n):$n()}function L3e(n){const e=[];return n.fields.forEach(i=>e.push(i.canonicalString())),{fieldPaths:e}}function Ase(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vg{constructor(e,i,o,l,d=Xn.min(),p=Xn.min(),_=Sa.EMPTY_BYTE_STRING,E=null){this.target=e,this.targetId=i,this.purpose=o,this.sequenceNumber=l,this.snapshotVersion=d,this.lastLimboFreeSnapshotVersion=p,this.resumeToken=_,this.expectedCount=E}withSequenceNumber(e){return new vg(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,i){return new vg(this.target,this.targetId,this.purpose,this.sequenceNumber,i,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new vg(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new vg(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class M3e{constructor(e){this.Tt=e}}function U3e(n){const e=O3e({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?c1(e,e.limit,"L"):e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class V3e{constructor(){this.Tn=new F3e}addToCollectionParentIndex(e,i){return this.Tn.add(i),Rt.resolve()}getCollectionParents(e,i){return Rt.resolve(this.Tn.getEntries(i))}addFieldIndex(e,i){return Rt.resolve()}deleteFieldIndex(e,i){return Rt.resolve()}deleteAllFieldIndexes(e){return Rt.resolve()}createTargetIndexes(e,i){return Rt.resolve()}getDocumentsMatchingTarget(e,i){return Rt.resolve(null)}getIndexType(e,i){return Rt.resolve(0)}getFieldIndexes(e,i){return Rt.resolve([])}getNextCollectionGroupToUpdate(e){return Rt.resolve(null)}getMinOffset(e,i){return Rt.resolve(kg.min())}getMinOffsetFromCollectionGroup(e,i){return Rt.resolve(kg.min())}updateCollectionGroup(e,i,o){return Rt.resolve()}updateIndexEntries(e,i){return Rt.resolve()}}class F3e{constructor(){this.index={}}add(e){const i=e.lastSegment(),o=e.popLast(),l=this.index[i]||new bo(Wi.comparator),d=!l.has(o);return this.index[i]=l.add(o),d}has(e){const i=e.lastSegment(),o=e.popLast(),l=this.index[i];return l&&l.has(o)}getEntries(e){return(this.index[e]||new bo(Wi.comparator)).toArray()}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xJ={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},Pse=41943040;class sl{static withCacheSize(e){return new sl(e,sl.DEFAULT_COLLECTION_PERCENTILE,sl.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,i,o){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=i,this.maximumSequenceNumbersToCollect=o}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */sl.DEFAULT_COLLECTION_PERCENTILE=10,sl.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,sl.DEFAULT=new sl(Pse,sl.DEFAULT_COLLECTION_PERCENTILE,sl.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),sl.DISABLED=new sl(-1,0,0);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class D0{constructor(e){this.$n=e}next(){return this.$n+=2,this.$n}static Un(){return new D0(0)}static Kn(){return new D0(-1)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const LJ="LruGarbageCollector",j3e=1048576;function MJ([n,e],[i,o]){const l=mr(n,i);return l===0?mr(e,o):l}class B3e{constructor(e){this.Hn=e,this.buffer=new bo(MJ),this.Jn=0}Yn(){return++this.Jn}Zn(e){const i=[e,this.Yn()];if(this.buffer.size<this.Hn)this.buffer=this.buffer.add(i);else{const o=this.buffer.last();MJ(i,o)<0&&(this.buffer=this.buffer.delete(o).add(i))}}get maxValue(){return this.buffer.last()[0]}}class W3e{constructor(e,i,o){this.garbageCollector=e,this.asyncQueue=i,this.localStore=o,this.Xn=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.er(6e4)}stop(){this.Xn&&(this.Xn.cancel(),this.Xn=null)}get started(){return this.Xn!==null}er(e){nn(LJ,`Garbage collection scheduled in ${e}ms`),this.Xn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.Xn=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(i){X0(i)?nn(LJ,"Ignoring IndexedDB error during garbage collection: ",i):await Y0(i)}await this.er(3e5)})}}class z3e{constructor(e,i){this.tr=e,this.params=i}calculateTargetCount(e,i){return this.tr.nr(e).next(o=>Math.floor(i/100*o))}nthSequenceNumber(e,i){if(i===0)return Rt.resolve(aN.ae);const o=new B3e(i);return this.tr.forEachTarget(e,l=>o.Zn(l.sequenceNumber)).next(()=>this.tr.rr(e,l=>o.Zn(l))).next(()=>o.maxValue)}removeTargets(e,i,o){return this.tr.removeTargets(e,i,o)}removeOrphanedDocuments(e,i){return this.tr.removeOrphanedDocuments(e,i)}collect(e,i){return this.params.cacheSizeCollectionThreshold===-1?(nn("LruGarbageCollector","Garbage collection skipped; disabled"),Rt.resolve(xJ)):this.getCacheSize(e).next(o=>o<this.params.cacheSizeCollectionThreshold?(nn("LruGarbageCollector",`Garbage collection skipped; Cache size ${o} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),xJ):this.ir(e,i))}getCacheSize(e){return this.tr.getCacheSize(e)}ir(e,i){let o,l,d,p,_,E,b;const C=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(I=>(I>this.params.maximumSequenceNumbersToCollect?(nn("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${I}`),l=this.params.maximumSequenceNumbersToCollect):l=I,p=Date.now(),this.nthSequenceNumber(e,l))).next(I=>(o=I,_=Date.now(),this.removeTargets(e,o,i))).next(I=>(d=I,E=Date.now(),this.removeOrphanedDocuments(e,o))).next(I=>(b=Date.now(),OS()<=Ir.DEBUG&&nn("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${p-C}ms
	Determined least recently used ${l} in `+(_-p)+`ms
	Removed ${d} targets in `+(E-_)+`ms
	Removed ${I} documents in `+(b-E)+`ms
Total Duration: ${b-C}ms`),Rt.resolve({didRun:!0,sequenceNumbersCollected:l,targetsRemoved:d,documentsRemoved:I})))}}function G3e(n,e){return new z3e(n,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class H3e{constructor(){this.changes=new eE(e=>e.toString(),(e,i)=>e.isEqual(i)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,i){this.assertNotApplied(),this.changes.set(e,Ja.newInvalidDocument(e).setReadTime(i))}getEntry(e,i){this.assertNotApplied();const o=this.changes.get(i);return o!==void 0?Rt.resolve(o):this.getFromCache(e,i)}getEntries(e,i){return this.getAllFromCache(e,i)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $3e{constructor(e,i){this.overlayedDocument=e,this.mutatedFields=i}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class K3e{constructor(e,i,o,l){this.remoteDocumentCache=e,this.mutationQueue=i,this.documentOverlayCache=o,this.indexManager=l}getDocument(e,i){let o=null;return this.documentOverlayCache.getOverlay(e,i).next(l=>(o=l,this.remoteDocumentCache.getEntry(e,i))).next(l=>(o!==null&&gC(o.mutation,l,Ul.empty(),So.now()),l))}getDocuments(e,i){return this.remoteDocumentCache.getEntries(e,i).next(o=>this.getLocalViewOfDocuments(e,o,Pr()).next(()=>o))}getLocalViewOfDocuments(e,i,o=Pr()){const l=wy();return this.populateOverlays(e,l,i).next(()=>this.computeViews(e,i,l,o).next(d=>{let p=Xw();return d.forEach((_,E)=>{p=p.insert(_,E.overlayedDocument)}),p}))}getOverlayedDocuments(e,i){const o=wy();return this.populateOverlays(e,o,i).next(()=>this.computeViews(e,i,o,Pr()))}populateOverlays(e,i,o){const l=[];return o.forEach(d=>{i.has(d)||l.push(d)}),this.documentOverlayCache.getOverlays(e,l).next(d=>{d.forEach((p,_)=>{i.set(p,_)})})}computeViews(e,i,o,l){let d=qp();const p=mC(),_=function(){return mC()}();return i.forEach((E,b)=>{const C=o.get(b.key);l.has(b.key)&&(C===void 0||C.mutation instanceof zg)?d=d.insert(b.key,b):C!==void 0?(p.set(b.key,C.mutation.getFieldMask()),gC(C.mutation,b,C.mutation.getFieldMask(),So.now())):p.set(b.key,Ul.empty())}),this.recalculateAndSaveOverlays(e,d).next(E=>(E.forEach((b,C)=>p.set(b,C)),i.forEach((b,C)=>{var I;return _.set(b,new $3e(C,(I=p.get(b))!==null&&I!==void 0?I:null))}),_))}recalculateAndSaveOverlays(e,i){const o=mC();let l=new ys((p,_)=>p-_),d=Pr();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,i).next(p=>{for(const _ of p)_.keys().forEach(E=>{const b=i.get(E);if(b===null)return;let C=o.get(E)||Ul.empty();C=_.applyToLocalView(b,C),o.set(E,C);const I=(l.get(_.batchId)||Pr()).add(E);l=l.insert(_.batchId,I)})}).next(()=>{const p=[],_=l.getReverseIterator();for(;_.hasNext();){const E=_.getNext(),b=E.key,C=E.value,I=use();C.forEach(O=>{if(!d.has(O)){const L=_se(i.get(O),o.get(O));L!==null&&I.set(O,L),d=d.add(O)}}),p.push(this.documentOverlayCache.saveOverlays(e,b,I))}return Rt.waitFor(p)}).next(()=>o)}recalculateAndSaveOverlaysForDocumentKeys(e,i){return this.remoteDocumentCache.getEntries(e,i).next(o=>this.recalculateAndSaveOverlays(e,o))}getDocumentsMatchingQuery(e,i,o,l){return function(p){return Sn.isDocumentKey(p.path)&&p.collectionGroup===null&&p.filters.length===0}(i)?this.getDocumentsMatchingDocumentQuery(e,i.path):I4(i)?this.getDocumentsMatchingCollectionGroupQuery(e,i,o,l):this.getDocumentsMatchingCollectionQuery(e,i,o,l)}getNextDocuments(e,i,o,l){return this.remoteDocumentCache.getAllFromCollectionGroup(e,i,o,l).next(d=>{const p=l-d.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,i,o.largestBatchId,l-d.size):Rt.resolve(wy());let _=zC,E=d;return p.next(b=>Rt.forEach(b,(C,I)=>(_<I.largestBatchId&&(_=I.largestBatchId),d.get(C)?Rt.resolve():this.remoteDocumentCache.getEntry(e,C).next(O=>{E=E.insert(C,O)}))).next(()=>this.populateOverlays(e,b,d)).next(()=>this.computeViews(e,E,b,Pr())).next(C=>({batchId:_,changes:lse(C)})))})}getDocumentsMatchingDocumentQuery(e,i){return this.getDocument(e,new Sn(i)).next(o=>{let l=Xw();return o.isFoundDocument()&&(l=l.insert(o.key,o)),l})}getDocumentsMatchingCollectionGroupQuery(e,i,o,l){const d=i.collectionGroup;let p=Xw();return this.indexManager.getCollectionParents(e,d).next(_=>Rt.forEach(_,E=>{const b=function(I,O){return new Zy(O,null,I.explicitOrderBy.slice(),I.filters.slice(),I.limit,I.limitType,I.startAt,I.endAt)}(i,E.child(d));return this.getDocumentsMatchingCollectionQuery(e,b,o,l).next(C=>{C.forEach((I,O)=>{p=p.insert(I,O)})})}).next(()=>p))}getDocumentsMatchingCollectionQuery(e,i,o,l){let d;return this.documentOverlayCache.getOverlaysForCollection(e,i.path,o.largestBatchId).next(p=>(d=p,this.remoteDocumentCache.getDocumentsMatchingQuery(e,i,o,d,l))).next(p=>{d.forEach((E,b)=>{const C=b.getKey();p.get(C)===null&&(p=p.insert(C,Ja.newInvalidDocument(C)))});let _=Xw();return p.forEach((E,b)=>{const C=d.get(E);C!==void 0&&gC(C.mutation,b,Ul.empty(),So.now()),fN(i,b)&&(_=_.insert(E,b))}),_})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class q3e{constructor(e){this.serializer=e,this.dr=new Map,this.Ar=new Map}getBundleMetadata(e,i){return Rt.resolve(this.dr.get(i))}saveBundleMetadata(e,i){return this.dr.set(i.id,function(l){return{id:l.id,version:l.version,createTime:df(l.createTime)}}(i)),Rt.resolve()}getNamedQuery(e,i){return Rt.resolve(this.Ar.get(i))}saveNamedQuery(e,i){return this.Ar.set(i.name,function(l){return{name:l.name,query:U3e(l.bundledQuery),readTime:df(l.readTime)}}(i)),Rt.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Y3e{constructor(){this.overlays=new ys(Sn.comparator),this.Rr=new Map}getOverlay(e,i){return Rt.resolve(this.overlays.get(i))}getOverlays(e,i){const o=wy();return Rt.forEach(i,l=>this.getOverlay(e,l).next(d=>{d!==null&&o.set(l,d)})).next(()=>o)}saveOverlays(e,i,o){return o.forEach((l,d)=>{this.Et(e,i,d)}),Rt.resolve()}removeOverlaysForBatchId(e,i,o){const l=this.Rr.get(o);return l!==void 0&&(l.forEach(d=>this.overlays=this.overlays.remove(d)),this.Rr.delete(o)),Rt.resolve()}getOverlaysForCollection(e,i,o){const l=wy(),d=i.length+1,p=new Sn(i.child("")),_=this.overlays.getIteratorFrom(p);for(;_.hasNext();){const E=_.getNext().value,b=E.getKey();if(!i.isPrefixOf(b.path))break;b.path.length===d&&E.largestBatchId>o&&l.set(E.getKey(),E)}return Rt.resolve(l)}getOverlaysForCollectionGroup(e,i,o,l){let d=new ys((b,C)=>b-C);const p=this.overlays.getIterator();for(;p.hasNext();){const b=p.getNext().value;if(b.getKey().getCollectionGroup()===i&&b.largestBatchId>o){let C=d.get(b.largestBatchId);C===null&&(C=wy(),d=d.insert(b.largestBatchId,C)),C.set(b.getKey(),b)}}const _=wy(),E=d.getIterator();for(;E.hasNext()&&(E.getNext().value.forEach((b,C)=>_.set(b,C)),!(_.size()>=l)););return Rt.resolve(_)}Et(e,i,o){const l=this.overlays.get(o.key);if(l!==null){const p=this.Rr.get(l.largestBatchId).delete(o.key);this.Rr.set(l.largestBatchId,p)}this.overlays=this.overlays.insert(o.key,new p3e(i,o));let d=this.Rr.get(i);d===void 0&&(d=Pr(),this.Rr.set(i,d)),this.Rr.set(i,d.add(o.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class X3e{constructor(){this.sessionToken=Sa.EMPTY_BYTE_STRING}getSessionToken(e){return Rt.resolve(this.sessionToken)}setSessionToken(e,i){return this.sessionToken=i,Rt.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class D4{constructor(){this.Vr=new bo(Bo.mr),this.gr=new bo(Bo.pr)}isEmpty(){return this.Vr.isEmpty()}addReference(e,i){const o=new Bo(e,i);this.Vr=this.Vr.add(o),this.gr=this.gr.add(o)}yr(e,i){e.forEach(o=>this.addReference(o,i))}removeReference(e,i){this.wr(new Bo(e,i))}Sr(e,i){e.forEach(o=>this.removeReference(o,i))}br(e){const i=new Sn(new Wi([])),o=new Bo(i,e),l=new Bo(i,e+1),d=[];return this.gr.forEachInRange([o,l],p=>{this.wr(p),d.push(p.key)}),d}Dr(){this.Vr.forEach(e=>this.wr(e))}wr(e){this.Vr=this.Vr.delete(e),this.gr=this.gr.delete(e)}vr(e){const i=new Sn(new Wi([])),o=new Bo(i,e),l=new Bo(i,e+1);let d=Pr();return this.gr.forEachInRange([o,l],p=>{d=d.add(p.key)}),d}containsKey(e){const i=new Bo(e,0),o=this.Vr.firstAfterOrEqual(i);return o!==null&&e.isEqual(o.key)}}class Bo{constructor(e,i){this.key=e,this.Cr=i}static mr(e,i){return Sn.comparator(e.key,i.key)||mr(e.Cr,i.Cr)}static pr(e,i){return mr(e.Cr,i.Cr)||Sn.comparator(e.key,i.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class J3e{constructor(e,i){this.indexManager=e,this.referenceDelegate=i,this.mutationQueue=[],this.Fr=1,this.Mr=new bo(Bo.mr)}checkEmpty(e){return Rt.resolve(this.mutationQueue.length===0)}addMutationBatch(e,i,o,l){const d=this.Fr;this.Fr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const p=new f3e(d,i,o,l);this.mutationQueue.push(p);for(const _ of l)this.Mr=this.Mr.add(new Bo(_.key,d)),this.indexManager.addToCollectionParentIndex(e,_.key.path.popLast());return Rt.resolve(p)}lookupMutationBatch(e,i){return Rt.resolve(this.Or(i))}getNextMutationBatchAfterBatchId(e,i){const o=i+1,l=this.Nr(o),d=l<0?0:l;return Rt.resolve(this.mutationQueue.length>d?this.mutationQueue[d]:null)}getHighestUnacknowledgedBatchId(){return Rt.resolve(this.mutationQueue.length===0?T4:this.Fr-1)}getAllMutationBatches(e){return Rt.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,i){const o=new Bo(i,0),l=new Bo(i,Number.POSITIVE_INFINITY),d=[];return this.Mr.forEachInRange([o,l],p=>{const _=this.Or(p.Cr);d.push(_)}),Rt.resolve(d)}getAllMutationBatchesAffectingDocumentKeys(e,i){let o=new bo(mr);return i.forEach(l=>{const d=new Bo(l,0),p=new Bo(l,Number.POSITIVE_INFINITY);this.Mr.forEachInRange([d,p],_=>{o=o.add(_.Cr)})}),Rt.resolve(this.Br(o))}getAllMutationBatchesAffectingQuery(e,i){const o=i.path,l=o.length+1;let d=o;Sn.isDocumentKey(d)||(d=d.child(""));const p=new Bo(new Sn(d),0);let _=new bo(mr);return this.Mr.forEachWhile(E=>{const b=E.key.path;return!!o.isPrefixOf(b)&&(b.length===l&&(_=_.add(E.Cr)),!0)},p),Rt.resolve(this.Br(_))}Br(e){const i=[];return e.forEach(o=>{const l=this.Or(o);l!==null&&i.push(l)}),i}removeMutationBatch(e,i){mi(this.Lr(i.batchId,"removed")===0),this.mutationQueue.shift();let o=this.Mr;return Rt.forEach(i.mutations,l=>{const d=new Bo(l.key,i.batchId);return o=o.delete(d),this.referenceDelegate.markPotentiallyOrphaned(e,l.key)}).next(()=>{this.Mr=o})}qn(e){}containsKey(e,i){const o=new Bo(i,0),l=this.Mr.firstAfterOrEqual(o);return Rt.resolve(i.isEqual(l&&l.key))}performConsistencyCheck(e){return this.mutationQueue.length,Rt.resolve()}Lr(e,i){return this.Nr(e)}Nr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Or(e){const i=this.Nr(e);return i<0||i>=this.mutationQueue.length?null:this.mutationQueue[i]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Q3e{constructor(e){this.kr=e,this.docs=function(){return new ys(Sn.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,i){const o=i.key,l=this.docs.get(o),d=l?l.size:0,p=this.kr(i);return this.docs=this.docs.insert(o,{document:i.mutableCopy(),size:p}),this.size+=p-d,this.indexManager.addToCollectionParentIndex(e,o.path.popLast())}removeEntry(e){const i=this.docs.get(e);i&&(this.docs=this.docs.remove(e),this.size-=i.size)}getEntry(e,i){const o=this.docs.get(i);return Rt.resolve(o?o.document.mutableCopy():Ja.newInvalidDocument(i))}getEntries(e,i){let o=qp();return i.forEach(l=>{const d=this.docs.get(l);o=o.insert(l,d?d.document.mutableCopy():Ja.newInvalidDocument(l))}),Rt.resolve(o)}getDocumentsMatchingQuery(e,i,o,l){let d=qp();const p=i.path,_=new Sn(p.child("__id-9223372036854775808__")),E=this.docs.getIteratorFrom(_);for(;E.hasNext();){const{key:b,value:{document:C}}=E.getNext();if(!p.isPrefixOf(b.path))break;b.path.length>p.length+1||A4e(I4e(C),o)<=0||(l.has(C.key)||fN(i,C))&&(d=d.insert(C.key,C.mutableCopy()))}return Rt.resolve(d)}getAllFromCollectionGroup(e,i,o,l){$n()}qr(e,i){return Rt.forEach(this.docs,o=>i(o))}newChangeBuffer(e){return new Z3e(this)}getSize(e){return Rt.resolve(this.size)}}class Z3e extends H3e{constructor(e){super(),this.Ir=e}applyChanges(e){const i=[];return this.changes.forEach((o,l)=>{l.isValidDocument()?i.push(this.Ir.addEntry(e,l)):this.Ir.removeEntry(o)}),Rt.waitFor(i)}getFromCache(e,i){return this.Ir.getEntry(e,i)}getAllFromCache(e,i){return this.Ir.getEntries(e,i)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class e5e{constructor(e){this.persistence=e,this.Qr=new eE(i=>C4(i),R4),this.lastRemoteSnapshotVersion=Xn.min(),this.highestTargetId=0,this.$r=0,this.Ur=new D4,this.targetCount=0,this.Kr=D0.Un()}forEachTarget(e,i){return this.Qr.forEach((o,l)=>i(l)),Rt.resolve()}getLastRemoteSnapshotVersion(e){return Rt.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return Rt.resolve(this.$r)}allocateTargetId(e){return this.highestTargetId=this.Kr.next(),Rt.resolve(this.highestTargetId)}setTargetsMetadata(e,i,o){return o&&(this.lastRemoteSnapshotVersion=o),i>this.$r&&(this.$r=i),Rt.resolve()}zn(e){this.Qr.set(e.target,e);const i=e.targetId;i>this.highestTargetId&&(this.Kr=new D0(i),this.highestTargetId=i),e.sequenceNumber>this.$r&&(this.$r=e.sequenceNumber)}addTargetData(e,i){return this.zn(i),this.targetCount+=1,Rt.resolve()}updateTargetData(e,i){return this.zn(i),Rt.resolve()}removeTargetData(e,i){return this.Qr.delete(i.target),this.Ur.br(i.targetId),this.targetCount-=1,Rt.resolve()}removeTargets(e,i,o){let l=0;const d=[];return this.Qr.forEach((p,_)=>{_.sequenceNumber<=i&&o.get(_.targetId)===null&&(this.Qr.delete(p),d.push(this.removeMatchingKeysForTargetId(e,_.targetId)),l++)}),Rt.waitFor(d).next(()=>l)}getTargetCount(e){return Rt.resolve(this.targetCount)}getTargetData(e,i){const o=this.Qr.get(i)||null;return Rt.resolve(o)}addMatchingKeys(e,i,o){return this.Ur.yr(i,o),Rt.resolve()}removeMatchingKeys(e,i,o){this.Ur.Sr(i,o);const l=this.persistence.referenceDelegate,d=[];return l&&i.forEach(p=>{d.push(l.markPotentiallyOrphaned(e,p))}),Rt.waitFor(d)}removeMatchingKeysForTargetId(e,i){return this.Ur.br(i),Rt.resolve()}getMatchingKeysForTargetId(e,i){const o=this.Ur.vr(i);return Rt.resolve(o)}containsKey(e,i){return Rt.resolve(this.Ur.containsKey(i))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ose{constructor(e,i){this.Wr={},this.overlays={},this.Gr=new aN(0),this.zr=!1,this.zr=!0,this.jr=new X3e,this.referenceDelegate=e(this),this.Hr=new e5e(this),this.indexManager=new V3e,this.remoteDocumentCache=function(l){return new Q3e(l)}(o=>this.referenceDelegate.Jr(o)),this.serializer=new M3e(i),this.Yr=new q3e(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.zr=!1,Promise.resolve()}get started(){return this.zr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let i=this.overlays[e.toKey()];return i||(i=new Y3e,this.overlays[e.toKey()]=i),i}getMutationQueue(e,i){let o=this.Wr[e.toKey()];return o||(o=new J3e(i,this.referenceDelegate),this.Wr[e.toKey()]=o),o}getGlobalsCache(){return this.jr}getTargetCache(){return this.Hr}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Yr}runTransaction(e,i,o){nn("MemoryPersistence","Starting transaction:",e);const l=new t5e(this.Gr.next());return this.referenceDelegate.Zr(),o(l).next(d=>this.referenceDelegate.Xr(l).next(()=>d)).toPromise().then(d=>(l.raiseOnCommittedEvent(),d))}ei(e,i){return Rt.or(Object.values(this.Wr).map(o=>()=>o.containsKey(e,i)))}}class t5e extends O4e{constructor(e){super(),this.currentSequenceNumber=e}}class x4{constructor(e){this.persistence=e,this.ti=new D4,this.ni=null}static ri(e){return new x4(e)}get ii(){if(this.ni)return this.ni;throw $n()}addReference(e,i,o){return this.ti.addReference(o,i),this.ii.delete(o.toString()),Rt.resolve()}removeReference(e,i,o){return this.ti.removeReference(o,i),this.ii.add(o.toString()),Rt.resolve()}markPotentiallyOrphaned(e,i){return this.ii.add(i.toString()),Rt.resolve()}removeTarget(e,i){this.ti.br(i.targetId).forEach(l=>this.ii.add(l.toString()));const o=this.persistence.getTargetCache();return o.getMatchingKeysForTargetId(e,i.targetId).next(l=>{l.forEach(d=>this.ii.add(d.toString()))}).next(()=>o.removeTargetData(e,i))}Zr(){this.ni=new Set}Xr(e){const i=this.persistence.getRemoteDocumentCache().newChangeBuffer();return Rt.forEach(this.ii,o=>{const l=Sn.fromPath(o);return this.si(e,l).next(d=>{d||i.removeEntry(l,Xn.min())})}).next(()=>(this.ni=null,i.apply(e)))}updateLimboDocument(e,i){return this.si(e,i).next(o=>{o?this.ii.delete(i.toString()):this.ii.add(i.toString())})}Jr(e){return 0}si(e,i){return Rt.or([()=>Rt.resolve(this.ti.containsKey(i)),()=>this.persistence.getTargetCache().containsKey(e,i),()=>this.persistence.ei(e,i)])}}class h1{constructor(e,i){this.persistence=e,this.oi=new eE(o=>D4e(o.path),(o,l)=>o.isEqual(l)),this.garbageCollector=G3e(this,i)}static ri(e,i){return new h1(e,i)}Zr(){}Xr(e){return Rt.resolve()}forEachTarget(e,i){return this.persistence.getTargetCache().forEachTarget(e,i)}nr(e){const i=this.sr(e);return this.persistence.getTargetCache().getTargetCount(e).next(o=>i.next(l=>o+l))}sr(e){let i=0;return this.rr(e,o=>{i++}).next(()=>i)}rr(e,i){return Rt.forEach(this.oi,(o,l)=>this.ar(e,o,l).next(d=>d?Rt.resolve():i(l)))}removeTargets(e,i,o){return this.persistence.getTargetCache().removeTargets(e,i,o)}removeOrphanedDocuments(e,i){let o=0;const l=this.persistence.getRemoteDocumentCache(),d=l.newChangeBuffer();return l.qr(e,p=>this.ar(e,p,i).next(_=>{_||(o++,d.removeEntry(p,Xn.min()))})).next(()=>d.apply(e)).next(()=>o)}markPotentiallyOrphaned(e,i){return this.oi.set(i,e.currentSequenceNumber),Rt.resolve()}removeTarget(e,i){const o=i.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,o)}addReference(e,i,o){return this.oi.set(o,e.currentSequenceNumber),Rt.resolve()}removeReference(e,i,o){return this.oi.set(o,e.currentSequenceNumber),Rt.resolve()}updateLimboDocument(e,i){return this.oi.set(i,e.currentSequenceNumber),Rt.resolve()}Jr(e){let i=e.key.toString().length;return e.isFoundDocument()&&(i+=Ck(e.data.value)),i}ar(e,i,o){return Rt.or([()=>this.persistence.ei(e,i),()=>this.persistence.getTargetCache().containsKey(e,i),()=>{const l=this.oi.get(i);return Rt.resolve(l!==void 0&&l>o)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class L4{constructor(e,i,o,l){this.targetId=e,this.fromCache=i,this.Hi=o,this.Ji=l}static Yi(e,i){let o=Pr(),l=Pr();for(const d of i.docChanges)switch(d.type){case 0:o=o.add(d.doc.key);break;case 1:l=l.add(d.doc.key)}return new L4(e,i.fromCache,o,l)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class n5e{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class r5e{constructor(){this.Zi=!1,this.Xi=!1,this.es=100,this.ts=function(){return UUe()?8:k4e(tc())>0?6:4}()}initialize(e,i){this.ns=e,this.indexManager=i,this.Zi=!0}getDocumentsMatchingQuery(e,i,o,l){const d={result:null};return this.rs(e,i).next(p=>{d.result=p}).next(()=>{if(!d.result)return this.ss(e,i,l,o).next(p=>{d.result=p})}).next(()=>{if(d.result)return;const p=new n5e;return this._s(e,i,p).next(_=>{if(d.result=_,this.Xi)return this.us(e,i,p,_.size)})}).next(()=>d.result)}us(e,i,o,l){return o.documentReadCount<this.es?(OS()<=Ir.DEBUG&&nn("QueryEngine","SDK will not create cache indexes for query:",kS(i),"since it only creates cache indexes for collection contains","more than or equal to",this.es,"documents"),Rt.resolve()):(OS()<=Ir.DEBUG&&nn("QueryEngine","Query:",kS(i),"scans",o.documentReadCount,"local documents and returns",l,"documents as results."),o.documentReadCount>this.ts*l?(OS()<=Ir.DEBUG&&nn("QueryEngine","The SDK decides to create cache indexes for query:",kS(i),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,uf(i))):Rt.resolve())}rs(e,i){if(wJ(i))return Rt.resolve(null);let o=uf(i);return this.indexManager.getIndexType(e,o).next(l=>l===0?null:(i.limit!==null&&l===1&&(i=c1(i,null,"F"),o=uf(i)),this.indexManager.getDocumentsMatchingTarget(e,o).next(d=>{const p=Pr(...d);return this.ns.getDocuments(e,p).next(_=>this.indexManager.getMinOffset(e,o).next(E=>{const b=this.cs(i,_);return this.ls(i,b,p,E.readTime)?this.rs(e,c1(i,null,"F")):this.hs(e,b,i,E)}))})))}ss(e,i,o,l){return wJ(i)||l.isEqual(Xn.min())?Rt.resolve(null):this.ns.getDocuments(e,o).next(d=>{const p=this.cs(i,d);return this.ls(i,p,o,l)?Rt.resolve(null):(OS()<=Ir.DEBUG&&nn("QueryEngine","Re-using previous result from %s to execute query: %s",l.toString(),kS(i)),this.hs(e,p,i,R4e(l,zC)).next(_=>_))})}cs(e,i){let o=new bo(ase(e));return i.forEach((l,d)=>{fN(e,d)&&(o=o.add(d))}),o}ls(e,i,o,l){if(e.limit===null)return!1;if(o.size!==i.size)return!0;const d=e.limitType==="F"?i.last():i.first();return!!d&&(d.hasPendingWrites||d.version.compareTo(l)>0)}_s(e,i,o){return OS()<=Ir.DEBUG&&nn("QueryEngine","Using full collection scan to execute query:",kS(i)),this.ns.getDocumentsMatchingQuery(e,i,kg.min(),o)}hs(e,i,o,l){return this.ns.getDocumentsMatchingQuery(e,o,l).next(d=>(i.forEach(p=>{d=d.insert(p.key,p)}),d))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const M4="LocalStore",i5e=3e8;class s5e{constructor(e,i,o,l){this.persistence=e,this.Ps=i,this.serializer=l,this.Ts=new ys(mr),this.Is=new eE(d=>C4(d),R4),this.Es=new Map,this.ds=e.getRemoteDocumentCache(),this.Hr=e.getTargetCache(),this.Yr=e.getBundleCache(),this.As(o)}As(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new K3e(this.ds,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.ds.setIndexManager(this.indexManager),this.Ps.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",i=>e.collect(i,this.Ts))}}function o5e(n,e,i,o){return new s5e(n,e,i,o)}async function kse(n,e){const i=er(n);return await i.persistence.runTransaction("Handle user change","readonly",o=>{let l;return i.mutationQueue.getAllMutationBatches(o).next(d=>(l=d,i.As(e),i.mutationQueue.getAllMutationBatches(o))).next(d=>{const p=[],_=[];let E=Pr();for(const b of l){p.push(b.batchId);for(const C of b.mutations)E=E.add(C.key)}for(const b of d){_.push(b.batchId);for(const C of b.mutations)E=E.add(C.key)}return i.localDocuments.getDocuments(o,E).next(b=>({Rs:b,removedBatchIds:p,addedBatchIds:_}))})})}function a5e(n,e){const i=er(n);return i.persistence.runTransaction("Acknowledge batch","readwrite-primary",o=>{const l=e.batch.keys(),d=i.ds.newChangeBuffer({trackRemovals:!0});return function(_,E,b,C){const I=b.batch,O=I.keys();let L=Rt.resolve();return O.forEach(V=>{L=L.next(()=>C.getEntry(E,V)).next(B=>{const W=b.docVersions.get(V);mi(W!==null),B.version.compareTo(W)<0&&(I.applyToRemoteDocument(B,b),B.isValidDocument()&&(B.setReadTime(b.commitVersion),C.addEntry(B)))})}),L.next(()=>_.mutationQueue.removeMutationBatch(E,I))}(i,o,e,d).next(()=>d.apply(o)).next(()=>i.mutationQueue.performConsistencyCheck(o)).next(()=>i.documentOverlayCache.removeOverlaysForBatchId(o,l,e.batch.batchId)).next(()=>i.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(o,function(_){let E=Pr();for(let b=0;b<_.mutationResults.length;++b)_.mutationResults[b].transformResults.length>0&&(E=E.add(_.batch.mutations[b].key));return E}(e))).next(()=>i.localDocuments.getDocuments(o,l))})}function Nse(n){const e=er(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",i=>e.Hr.getLastRemoteSnapshotVersion(i))}function c5e(n,e){const i=er(n),o=e.snapshotVersion;let l=i.Ts;return i.persistence.runTransaction("Apply remote event","readwrite-primary",d=>{const p=i.ds.newChangeBuffer({trackRemovals:!0});l=i.Ts;const _=[];e.targetChanges.forEach((C,I)=>{const O=l.get(I);if(!O)return;_.push(i.Hr.removeMatchingKeys(d,C.removedDocuments,I).next(()=>i.Hr.addMatchingKeys(d,C.addedDocuments,I)));let L=O.withSequenceNumber(d.currentSequenceNumber);e.targetMismatches.get(I)!==null?L=L.withResumeToken(Sa.EMPTY_BYTE_STRING,Xn.min()).withLastLimboFreeSnapshotVersion(Xn.min()):C.resumeToken.approximateByteSize()>0&&(L=L.withResumeToken(C.resumeToken,o)),l=l.insert(I,L),function(B,W,Z){return B.resumeToken.approximateByteSize()===0||W.snapshotVersion.toMicroseconds()-B.snapshotVersion.toMicroseconds()>=i5e?!0:Z.addedDocuments.size+Z.modifiedDocuments.size+Z.removedDocuments.size>0}(O,L,C)&&_.push(i.Hr.updateTargetData(d,L))});let E=qp(),b=Pr();if(e.documentUpdates.forEach(C=>{e.resolvedLimboDocuments.has(C)&&_.push(i.persistence.referenceDelegate.updateLimboDocument(d,C))}),_.push(l5e(d,p,e.documentUpdates).next(C=>{E=C.Vs,b=C.fs})),!o.isEqual(Xn.min())){const C=i.Hr.getLastRemoteSnapshotVersion(d).next(I=>i.Hr.setTargetsMetadata(d,d.currentSequenceNumber,o));_.push(C)}return Rt.waitFor(_).next(()=>p.apply(d)).next(()=>i.localDocuments.getLocalViewOfDocuments(d,E,b)).next(()=>E)}).then(d=>(i.Ts=l,d))}function l5e(n,e,i){let o=Pr(),l=Pr();return i.forEach(d=>o=o.add(d)),e.getEntries(n,o).next(d=>{let p=qp();return i.forEach((_,E)=>{const b=d.get(_);E.isFoundDocument()!==b.isFoundDocument()&&(l=l.add(_)),E.isNoDocument()&&E.version.isEqual(Xn.min())?(e.removeEntry(_,E.readTime),p=p.insert(_,E)):!b.isValidDocument()||E.version.compareTo(b.version)>0||E.version.compareTo(b.version)===0&&b.hasPendingWrites?(e.addEntry(E),p=p.insert(_,E)):nn(M4,"Ignoring outdated watch update for ",_,". Current version:",b.version," Watch version:",E.version)}),{Vs:p,fs:l}})}function u5e(n,e){const i=er(n);return i.persistence.runTransaction("Get next mutation batch","readonly",o=>(e===void 0&&(e=T4),i.mutationQueue.getNextMutationBatchAfterBatchId(o,e)))}function d5e(n,e){const i=er(n);return i.persistence.runTransaction("Allocate target","readwrite",o=>{let l;return i.Hr.getTargetData(o,e).next(d=>d?(l=d,Rt.resolve(l)):i.Hr.allocateTargetId(o).next(p=>(l=new vg(e,p,"TargetPurposeListen",o.currentSequenceNumber),i.Hr.addTargetData(o,l).next(()=>l))))}).then(o=>{const l=i.Ts.get(o.targetId);return(l===null||o.snapshotVersion.compareTo(l.snapshotVersion)>0)&&(i.Ts=i.Ts.insert(o.targetId,o),i.Is.set(e,o.targetId)),o})}async function aF(n,e,i){const o=er(n),l=o.Ts.get(e),d=i?"readwrite":"readwrite-primary";try{i||await o.persistence.runTransaction("Release target",d,p=>o.persistence.referenceDelegate.removeTarget(p,l))}catch(p){if(!X0(p))throw p;nn(M4,`Failed to update sequence numbers for target ${e}: ${p}`)}o.Ts=o.Ts.remove(e),o.Is.delete(l.target)}function UJ(n,e,i){const o=er(n);let l=Xn.min(),d=Pr();return o.persistence.runTransaction("Execute query","readwrite",p=>function(E,b,C){const I=er(E),O=I.Is.get(C);return O!==void 0?Rt.resolve(I.Ts.get(O)):I.Hr.getTargetData(b,C)}(o,p,uf(e)).next(_=>{if(_)return l=_.lastLimboFreeSnapshotVersion,o.Hr.getMatchingKeysForTargetId(p,_.targetId).next(E=>{d=E})}).next(()=>o.Ps.getDocumentsMatchingQuery(p,e,i?l:Xn.min(),i?d:Pr())).next(_=>(h5e(o,Q4e(e),_),{documents:_,gs:d})))}function h5e(n,e,i){let o=n.Es.get(e)||Xn.min();i.forEach((l,d)=>{d.readTime.compareTo(o)>0&&(o=d.readTime)}),n.Es.set(e,o)}class VJ{constructor(){this.activeTargetIds=i3e()}Ds(e){this.activeTargetIds=this.activeTargetIds.add(e)}vs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}bs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class f5e{constructor(){this.ho=new VJ,this.Po={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,i,o){}addLocalQueryTarget(e,i=!0){return i&&this.ho.Ds(e),this.Po[e]||"not-current"}updateQueryState(e,i,o){this.Po[e]=i}removeLocalQueryTarget(e){this.ho.vs(e)}isLocalQueryTarget(e){return this.ho.activeTargetIds.has(e)}clearQueryState(e){delete this.Po[e]}getAllActiveQueryTargets(){return this.ho.activeTargetIds}isActiveQueryTarget(e){return this.ho.activeTargetIds.has(e)}start(){return this.ho=new VJ,Promise.resolve()}handleUserChange(e,i,o){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class p5e{To(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const FJ="ConnectivityMonitor";class jJ{constructor(){this.Io=()=>this.Eo(),this.Ao=()=>this.Ro(),this.Vo=[],this.mo()}To(e){this.Vo.push(e)}shutdown(){window.removeEventListener("online",this.Io),window.removeEventListener("offline",this.Ao)}mo(){window.addEventListener("online",this.Io),window.addEventListener("offline",this.Ao)}Eo(){nn(FJ,"Network connectivity changed: AVAILABLE");for(const e of this.Vo)e(0)}Ro(){nn(FJ,"Network connectivity changed: UNAVAILABLE");for(const e of this.Vo)e(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let jO=null;function cF(){return jO===null?jO=function(){return 268435456+Math.round(2147483648*Math.random())}():jO++,"0x"+jO.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const IU="RestConnection",m5e={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class g5e{get fo(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const i=e.ssl?"https":"http",o=encodeURIComponent(this.databaseId.projectId),l=encodeURIComponent(this.databaseId.database);this.po=i+"://"+e.host,this.yo=`projects/${o}/databases/${l}`,this.wo=this.databaseId.database===s1?`project_id=${o}`:`project_id=${o}&database_id=${l}`}So(e,i,o,l,d){const p=cF(),_=this.bo(e,i.toUriEncodedString());nn(IU,`Sending RPC '${e}' ${p}:`,_,o);const E={"google-cloud-resource-prefix":this.yo,"x-goog-request-params":this.wo};return this.Do(E,l,d),this.vo(e,_,E,o).then(b=>(nn(IU,`Received RPC '${e}' ${p}: `,b),b),b=>{throw R0(IU,`RPC '${e}' ${p} failed with error: `,b,"url: ",_,"request:",o),b})}Co(e,i,o,l,d,p){return this.So(e,i,o,l,d)}Do(e,i,o){e["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+q0}(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),i&&i.headers.forEach((l,d)=>e[d]=l),o&&o.headers.forEach((l,d)=>e[d]=l)}bo(e,i){const o=m5e[e];return`${this.po}/v1/${i}:${o}`}terminate(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _5e{constructor(e){this.Fo=e.Fo,this.Mo=e.Mo}xo(e){this.Oo=e}No(e){this.Bo=e}Lo(e){this.ko=e}onMessage(e){this.qo=e}close(){this.Mo()}send(e){this.Fo(e)}Qo(){this.Oo()}$o(){this.Bo()}Uo(e){this.ko(e)}Ko(e){this.qo(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ka="WebChannelConnection";class y5e extends g5e{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}vo(e,i,o,l){const d=cF();return new Promise((p,_)=>{const E=new Mie;E.setWithCredentials(!0),E.listenOnce(Uie.COMPLETE,()=>{try{switch(E.getLastErrorCode()){case wk.NO_ERROR:const C=E.getResponseJson();nn(Ka,`XHR for RPC '${e}' ${d} received:`,JSON.stringify(C)),p(C);break;case wk.TIMEOUT:nn(Ka,`RPC '${e}' ${d} timed out`),_(new Kt(Et.DEADLINE_EXCEEDED,"Request time out"));break;case wk.HTTP_ERROR:const I=E.getStatus();if(nn(Ka,`RPC '${e}' ${d} failed with status:`,I,"response text:",E.getResponseText()),I>0){let O=E.getResponseJson();Array.isArray(O)&&(O=O[0]);const L=O==null?void 0:O.error;if(L&&L.status&&L.message){const V=function(W){const Z=W.toLowerCase().replace(/_/g,"-");return Object.values(Et).indexOf(Z)>=0?Z:Et.UNKNOWN}(L.status);_(new Kt(V,L.message))}else _(new Kt(Et.UNKNOWN,"Server responded with status "+E.getStatus()))}else _(new Kt(Et.UNAVAILABLE,"Connection failed."));break;default:$n()}}finally{nn(Ka,`RPC '${e}' ${d} completed.`)}});const b=JSON.stringify(l);nn(Ka,`RPC '${e}' ${d} sending request:`,l),E.send(i,"POST",b,o,15)})}Wo(e,i,o){const l=cF(),d=[this.po,"/","google.firestore.v1.Firestore","/",e,"/channel"],p=jie(),_=Fie(),E={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},b=this.longPollingOptions.timeoutSeconds;b!==void 0&&(E.longPollingTimeout=Math.round(1e3*b)),this.useFetchStreams&&(E.useFetchStreams=!0),this.Do(E.initMessageHeaders,i,o),E.encodeInitMessageHeaders=!0;const C=d.join("");nn(Ka,`Creating RPC '${e}' stream ${l}: ${C}`,E);const I=p.createWebChannel(C,E);let O=!1,L=!1;const V=new _5e({Fo:W=>{L?nn(Ka,`Not sending because RPC '${e}' stream ${l} is closed:`,W):(O||(nn(Ka,`Opening RPC '${e}' stream ${l} transport.`),I.open(),O=!0),nn(Ka,`RPC '${e}' stream ${l} sending:`,W),I.send(W))},Mo:()=>I.close()}),B=(W,Z,$)=>{W.listen(Z,se=>{try{$(se)}catch(ue){setTimeout(()=>{throw ue},0)}})};return B(I,Yw.EventType.OPEN,()=>{L||(nn(Ka,`RPC '${e}' stream ${l} transport opened.`),V.Qo())}),B(I,Yw.EventType.CLOSE,()=>{L||(L=!0,nn(Ka,`RPC '${e}' stream ${l} transport closed`),V.Uo())}),B(I,Yw.EventType.ERROR,W=>{L||(L=!0,R0(Ka,`RPC '${e}' stream ${l} transport errored:`,W),V.Uo(new Kt(Et.UNAVAILABLE,"The operation could not be completed")))}),B(I,Yw.EventType.MESSAGE,W=>{var Z;if(!L){const $=W.data[0];mi(!!$);const se=$,ue=(se==null?void 0:se.error)||((Z=se[0])===null||Z===void 0?void 0:Z.error);if(ue){nn(Ka,`RPC '${e}' stream ${l} received error:`,ue);const re=ue.status;let pe=function(J){const ie=eo[J];if(ie!==void 0)return Ese(ie)}(re),q=ue.message;pe===void 0&&(pe=Et.INTERNAL,q="Unknown error status: "+re+" with message "+ue.message),L=!0,V.Uo(new Kt(pe,q)),I.close()}else nn(Ka,`RPC '${e}' stream ${l} received:`,$),V.Ko($)}}),B(_,Vie.STAT_EVENT,W=>{W.stat===XV.PROXY?nn(Ka,`RPC '${e}' stream ${l} detected buffering proxy`):W.stat===XV.NOPROXY&&nn(Ka,`RPC '${e}' stream ${l} detected no buffering proxy`)}),setTimeout(()=>{V.$o()},0),V}}function AU(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _N(n){return new b3e(n,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dse{constructor(e,i,o=1e3,l=1.5,d=6e4){this.Ti=e,this.timerId=i,this.Go=o,this.zo=l,this.jo=d,this.Ho=0,this.Jo=null,this.Yo=Date.now(),this.reset()}reset(){this.Ho=0}Zo(){this.Ho=this.jo}Xo(e){this.cancel();const i=Math.floor(this.Ho+this.e_()),o=Math.max(0,Date.now()-this.Yo),l=Math.max(0,i-o);l>0&&nn("ExponentialBackoff",`Backing off for ${l} ms (base delay: ${this.Ho} ms, delay with jitter: ${i} ms, last attempt: ${o} ms ago)`),this.Jo=this.Ti.enqueueAfterDelay(this.timerId,l,()=>(this.Yo=Date.now(),e())),this.Ho*=this.zo,this.Ho<this.Go&&(this.Ho=this.Go),this.Ho>this.jo&&(this.Ho=this.jo)}t_(){this.Jo!==null&&(this.Jo.skipDelay(),this.Jo=null)}cancel(){this.Jo!==null&&(this.Jo.cancel(),this.Jo=null)}e_(){return(Math.random()-.5)*this.Ho}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const BJ="PersistentStream";class xse{constructor(e,i,o,l,d,p,_,E){this.Ti=e,this.n_=o,this.r_=l,this.connection=d,this.authCredentialsProvider=p,this.appCheckCredentialsProvider=_,this.listener=E,this.state=0,this.i_=0,this.s_=null,this.o_=null,this.stream=null,this.__=0,this.a_=new Dse(e,i)}u_(){return this.state===1||this.state===5||this.c_()}c_(){return this.state===2||this.state===3}start(){this.__=0,this.state!==4?this.auth():this.l_()}async stop(){this.u_()&&await this.close(0)}h_(){this.state=0,this.a_.reset()}P_(){this.c_()&&this.s_===null&&(this.s_=this.Ti.enqueueAfterDelay(this.n_,6e4,()=>this.T_()))}I_(e){this.E_(),this.stream.send(e)}async T_(){if(this.c_())return this.close(0)}E_(){this.s_&&(this.s_.cancel(),this.s_=null)}d_(){this.o_&&(this.o_.cancel(),this.o_=null)}async close(e,i){this.E_(),this.d_(),this.a_.cancel(),this.i_++,e!==4?this.a_.reset():i&&i.code===Et.RESOURCE_EXHAUSTED?(Kp(i.toString()),Kp("Using maximum backoff delay to prevent overloading the backend."),this.a_.Zo()):i&&i.code===Et.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.A_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.Lo(i)}A_(){}auth(){this.state=1;const e=this.R_(this.i_),i=this.i_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([o,l])=>{this.i_===i&&this.V_(o,l)},o=>{e(()=>{const l=new Kt(Et.UNKNOWN,"Fetching auth token failed: "+o.message);return this.m_(l)})})}V_(e,i){const o=this.R_(this.i_);this.stream=this.f_(e,i),this.stream.xo(()=>{o(()=>this.listener.xo())}),this.stream.No(()=>{o(()=>(this.state=2,this.o_=this.Ti.enqueueAfterDelay(this.r_,1e4,()=>(this.c_()&&(this.state=3),Promise.resolve())),this.listener.No()))}),this.stream.Lo(l=>{o(()=>this.m_(l))}),this.stream.onMessage(l=>{o(()=>++this.__==1?this.g_(l):this.onNext(l))})}l_(){this.state=5,this.a_.Xo(async()=>{this.state=0,this.start()})}m_(e){return nn(BJ,`close with error: ${e}`),this.stream=null,this.close(4,e)}R_(e){return i=>{this.Ti.enqueueAndForget(()=>this.i_===e?i():(nn(BJ,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class E5e extends xse{constructor(e,i,o,l,d,p){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",i,o,l,p),this.serializer=d}f_(e,i){return this.connection.Wo("Listen",e,i)}g_(e){return this.onNext(e)}onNext(e){this.a_.reset();const i=C3e(this.serializer,e),o=function(d){if(!("targetChange"in d))return Xn.min();const p=d.targetChange;return p.targetIds&&p.targetIds.length?Xn.min():p.readTime?df(p.readTime):Xn.min()}(e);return this.listener.p_(i,o)}y_(e){const i={};i.database=oF(this.serializer),i.addTarget=function(d,p){let _;const E=p.target;if(_=tF(E)?{documents:A3e(d,E)}:{query:P3e(d,E).ht},_.targetId=p.targetId,p.resumeToken.approximateByteSize()>0){_.resumeToken=bse(d,p.resumeToken);const b=rF(d,p.expectedCount);b!==null&&(_.expectedCount=b)}else if(p.snapshotVersion.compareTo(Xn.min())>0){_.readTime=d1(d,p.snapshotVersion.toTimestamp());const b=rF(d,p.expectedCount);b!==null&&(_.expectedCount=b)}return _}(this.serializer,e);const o=k3e(this.serializer,e);o&&(i.labels=o),this.I_(i)}w_(e){const i={};i.database=oF(this.serializer),i.removeTarget=e,this.I_(i)}}class v5e extends xse{constructor(e,i,o,l,d,p){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",i,o,l,p),this.serializer=d}get S_(){return this.__>0}start(){this.lastStreamToken=void 0,super.start()}A_(){this.S_&&this.b_([])}f_(e,i){return this.connection.Wo("Write",e,i)}g_(e){return mi(!!e.streamToken),this.lastStreamToken=e.streamToken,mi(!e.writeResults||e.writeResults.length===0),this.listener.D_()}onNext(e){mi(!!e.streamToken),this.lastStreamToken=e.streamToken,this.a_.reset();const i=I3e(e.writeResults,e.commitTime),o=df(e.commitTime);return this.listener.v_(o,i)}C_(){const e={};e.database=oF(this.serializer),this.I_(e)}b_(e){const i={streamToken:this.lastStreamToken,writes:e.map(o=>R3e(this.serializer,o))};this.I_(i)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class S5e{}class b5e extends S5e{constructor(e,i,o,l){super(),this.authCredentials=e,this.appCheckCredentials=i,this.connection=o,this.serializer=l,this.F_=!1}M_(){if(this.F_)throw new Kt(Et.FAILED_PRECONDITION,"The client has already been terminated.")}So(e,i,o,l){return this.M_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([d,p])=>this.connection.So(e,iF(i,o),l,d,p)).catch(d=>{throw d.name==="FirebaseError"?(d.code===Et.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),d):new Kt(Et.UNKNOWN,d.toString())})}Co(e,i,o,l,d){return this.M_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([p,_])=>this.connection.Co(e,iF(i,o),l,p,_,d)).catch(p=>{throw p.name==="FirebaseError"?(p.code===Et.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),p):new Kt(Et.UNKNOWN,p.toString())})}terminate(){this.F_=!0,this.connection.terminate()}}class T5e{constructor(e,i){this.asyncQueue=e,this.onlineStateHandler=i,this.state="Unknown",this.x_=0,this.O_=null,this.N_=!0}B_(){this.x_===0&&(this.L_("Unknown"),this.O_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.O_=null,this.k_("Backend didn't respond within 10 seconds."),this.L_("Offline"),Promise.resolve())))}q_(e){this.state==="Online"?this.L_("Unknown"):(this.x_++,this.x_>=1&&(this.Q_(),this.k_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.L_("Offline")))}set(e){this.Q_(),this.x_=0,e==="Online"&&(this.N_=!1),this.L_(e)}L_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}k_(e){const i=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.N_?(Kp(i),this.N_=!1):nn("OnlineStateTracker",i)}Q_(){this.O_!==null&&(this.O_.cancel(),this.O_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $y="RemoteStore";class w5e{constructor(e,i,o,l,d){this.localStore=e,this.datastore=i,this.asyncQueue=o,this.remoteSyncer={},this.U_=[],this.K_=new Map,this.W_=new Set,this.G_=[],this.z_=d,this.z_.To(p=>{o.enqueueAndForget(async()=>{tE(this)&&(nn($y,"Restarting streams for network reachability change."),await async function(E){const b=er(E);b.W_.add(4),await wR(b),b.j_.set("Unknown"),b.W_.delete(4),await yN(b)}(this))})}),this.j_=new T5e(o,l)}}async function yN(n){if(tE(n))for(const e of n.G_)await e(!0)}async function wR(n){for(const e of n.G_)await e(!1)}function Lse(n,e){const i=er(n);i.K_.has(e.targetId)||(i.K_.set(e.targetId,e),j4(i)?F4(i):J0(i).c_()&&V4(i,e))}function U4(n,e){const i=er(n),o=J0(i);i.K_.delete(e),o.c_()&&Mse(i,e),i.K_.size===0&&(o.c_()?o.P_():tE(i)&&i.j_.set("Unknown"))}function V4(n,e){if(n.H_.Ne(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(Xn.min())>0){const i=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(i)}J0(n).y_(e)}function Mse(n,e){n.H_.Ne(e),J0(n).w_(e)}function F4(n){n.H_=new y3e({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),lt:e=>n.K_.get(e)||null,it:()=>n.datastore.serializer.databaseId}),J0(n).start(),n.j_.B_()}function j4(n){return tE(n)&&!J0(n).u_()&&n.K_.size>0}function tE(n){return er(n).W_.size===0}function Use(n){n.H_=void 0}async function C5e(n){n.j_.set("Online")}async function R5e(n){n.K_.forEach((e,i)=>{V4(n,e)})}async function I5e(n,e){Use(n),j4(n)?(n.j_.q_(e),F4(n)):n.j_.set("Unknown")}async function A5e(n,e,i){if(n.j_.set("Online"),e instanceof Sse&&e.state===2&&e.cause)try{await async function(l,d){const p=d.cause;for(const _ of d.targetIds)l.K_.has(_)&&(await l.remoteSyncer.rejectListen(_,p),l.K_.delete(_),l.H_.removeTarget(_))}(n,e)}catch(o){nn($y,"Failed to remove targets %s: %s ",e.targetIds.join(","),o),await f1(n,o)}else if(e instanceof Ak?n.H_.We(e):e instanceof vse?n.H_.Ze(e):n.H_.je(e),!i.isEqual(Xn.min()))try{const o=await Nse(n.localStore);i.compareTo(o)>=0&&await function(d,p){const _=d.H_.ot(p);return _.targetChanges.forEach((E,b)=>{if(E.resumeToken.approximateByteSize()>0){const C=d.K_.get(b);C&&d.K_.set(b,C.withResumeToken(E.resumeToken,p))}}),_.targetMismatches.forEach((E,b)=>{const C=d.K_.get(E);if(!C)return;d.K_.set(E,C.withResumeToken(Sa.EMPTY_BYTE_STRING,C.snapshotVersion)),Mse(d,E);const I=new vg(C.target,E,b,C.sequenceNumber);V4(d,I)}),d.remoteSyncer.applyRemoteEvent(_)}(n,i)}catch(o){nn($y,"Failed to raise snapshot:",o),await f1(n,o)}}async function f1(n,e,i){if(!X0(e))throw e;n.W_.add(1),await wR(n),n.j_.set("Offline"),i||(i=()=>Nse(n.localStore)),n.asyncQueue.enqueueRetryable(async()=>{nn($y,"Retrying IndexedDB access"),await i(),n.W_.delete(1),await yN(n)})}function Vse(n,e){return e().catch(i=>f1(n,i,e))}async function EN(n){const e=er(n),i=Lg(e);let o=e.U_.length>0?e.U_[e.U_.length-1].batchId:T4;for(;P5e(e);)try{const l=await u5e(e.localStore,o);if(l===null){e.U_.length===0&&i.P_();break}o=l.batchId,O5e(e,l)}catch(l){await f1(e,l)}Fse(e)&&jse(e)}function P5e(n){return tE(n)&&n.U_.length<10}function O5e(n,e){n.U_.push(e);const i=Lg(n);i.c_()&&i.S_&&i.b_(e.mutations)}function Fse(n){return tE(n)&&!Lg(n).u_()&&n.U_.length>0}function jse(n){Lg(n).start()}async function k5e(n){Lg(n).C_()}async function N5e(n){const e=Lg(n);for(const i of n.U_)e.b_(i.mutations)}async function D5e(n,e,i){const o=n.U_.shift(),l=O4.from(o,e,i);await Vse(n,()=>n.remoteSyncer.applySuccessfulWrite(l)),await EN(n)}async function x5e(n,e){e&&Lg(n).S_&&await async function(o,l){if(function(p){return g3e(p)&&p!==Et.ABORTED}(l.code)){const d=o.U_.shift();Lg(o).h_(),await Vse(o,()=>o.remoteSyncer.rejectFailedWrite(d.batchId,l)),await EN(o)}}(n,e),Fse(n)&&jse(n)}async function WJ(n,e){const i=er(n);i.asyncQueue.verifyOperationInProgress(),nn($y,"RemoteStore received new credentials");const o=tE(i);i.W_.add(3),await wR(i),o&&i.j_.set("Unknown"),await i.remoteSyncer.handleCredentialChange(e),i.W_.delete(3),await yN(i)}async function L5e(n,e){const i=er(n);e?(i.W_.delete(2),await yN(i)):e||(i.W_.add(2),await wR(i),i.j_.set("Unknown"))}function J0(n){return n.J_||(n.J_=function(i,o,l){const d=er(i);return d.M_(),new E5e(o,d.connection,d.authCredentials,d.appCheckCredentials,d.serializer,l)}(n.datastore,n.asyncQueue,{xo:C5e.bind(null,n),No:R5e.bind(null,n),Lo:I5e.bind(null,n),p_:A5e.bind(null,n)}),n.G_.push(async e=>{e?(n.J_.h_(),j4(n)?F4(n):n.j_.set("Unknown")):(await n.J_.stop(),Use(n))})),n.J_}function Lg(n){return n.Y_||(n.Y_=function(i,o,l){const d=er(i);return d.M_(),new v5e(o,d.connection,d.authCredentials,d.appCheckCredentials,d.serializer,l)}(n.datastore,n.asyncQueue,{xo:()=>Promise.resolve(),No:k5e.bind(null,n),Lo:x5e.bind(null,n),D_:N5e.bind(null,n),v_:D5e.bind(null,n)}),n.G_.push(async e=>{e?(n.Y_.h_(),await EN(n)):(await n.Y_.stop(),n.U_.length>0&&(nn($y,`Stopping write stream with ${n.U_.length} pending writes`),n.U_=[]))})),n.Y_}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class B4{constructor(e,i,o,l,d){this.asyncQueue=e,this.timerId=i,this.targetTimeMs=o,this.op=l,this.removalCallback=d,this.deferred=new Vp,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(p=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,i,o,l,d){const p=Date.now()+o,_=new B4(e,i,p,l,d);return _.start(o),_}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new Kt(Et.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function W4(n,e){if(Kp("AsyncQueue",`${e}: ${n}`),X0(n))return new Kt(Et.UNAVAILABLE,`${e}: ${n}`);throw n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class u0{static emptySet(e){return new u0(e.comparator)}constructor(e){this.comparator=e?(i,o)=>e(i,o)||Sn.comparator(i.key,o.key):(i,o)=>Sn.comparator(i.key,o.key),this.keyedMap=Xw(),this.sortedSet=new ys(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const i=this.keyedMap.get(e);return i?this.sortedSet.indexOf(i):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((i,o)=>(e(i),!1))}add(e){const i=this.delete(e.key);return i.copy(i.keyedMap.insert(e.key,e),i.sortedSet.insert(e,null))}delete(e){const i=this.get(e);return i?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(i)):this}isEqual(e){if(!(e instanceof u0)||this.size!==e.size)return!1;const i=this.sortedSet.getIterator(),o=e.sortedSet.getIterator();for(;i.hasNext();){const l=i.getNext().key,d=o.getNext().key;if(!l.isEqual(d))return!1}return!0}toString(){const e=[];return this.forEach(i=>{e.push(i.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,i){const o=new u0;return o.comparator=this.comparator,o.keyedMap=e,o.sortedSet=i,o}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zJ{constructor(){this.Z_=new ys(Sn.comparator)}track(e){const i=e.doc.key,o=this.Z_.get(i);o?e.type!==0&&o.type===3?this.Z_=this.Z_.insert(i,e):e.type===3&&o.type!==1?this.Z_=this.Z_.insert(i,{type:o.type,doc:e.doc}):e.type===2&&o.type===2?this.Z_=this.Z_.insert(i,{type:2,doc:e.doc}):e.type===2&&o.type===0?this.Z_=this.Z_.insert(i,{type:0,doc:e.doc}):e.type===1&&o.type===0?this.Z_=this.Z_.remove(i):e.type===1&&o.type===2?this.Z_=this.Z_.insert(i,{type:1,doc:o.doc}):e.type===0&&o.type===1?this.Z_=this.Z_.insert(i,{type:2,doc:e.doc}):$n():this.Z_=this.Z_.insert(i,e)}X_(){const e=[];return this.Z_.inorderTraversal((i,o)=>{e.push(o)}),e}}class x0{constructor(e,i,o,l,d,p,_,E,b){this.query=e,this.docs=i,this.oldDocs=o,this.docChanges=l,this.mutatedKeys=d,this.fromCache=p,this.syncStateChanged=_,this.excludesMetadataChanges=E,this.hasCachedResults=b}static fromInitialDocuments(e,i,o,l,d){const p=[];return i.forEach(_=>{p.push({type:0,doc:_})}),new x0(e,i,u0.emptySet(i),p,o,l,!0,!1,d)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&hN(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const i=this.docChanges,o=e.docChanges;if(i.length!==o.length)return!1;for(let l=0;l<i.length;l++)if(i[l].type!==o[l].type||!i[l].doc.isEqual(o[l].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class M5e{constructor(){this.ea=void 0,this.ta=[]}na(){return this.ta.some(e=>e.ra())}}class U5e{constructor(){this.queries=GJ(),this.onlineState="Unknown",this.ia=new Set}terminate(){(function(i,o){const l=er(i),d=l.queries;l.queries=GJ(),d.forEach((p,_)=>{for(const E of _.ta)E.onError(o)})})(this,new Kt(Et.ABORTED,"Firestore shutting down"))}}function GJ(){return new eE(n=>ose(n),hN)}async function z4(n,e){const i=er(n);let o=3;const l=e.query;let d=i.queries.get(l);d?!d.na()&&e.ra()&&(o=2):(d=new M5e,o=e.ra()?0:1);try{switch(o){case 0:d.ea=await i.onListen(l,!0);break;case 1:d.ea=await i.onListen(l,!1);break;case 2:await i.onFirstRemoteStoreListen(l)}}catch(p){const _=W4(p,`Initialization of query '${kS(e.query)}' failed`);return void e.onError(_)}i.queries.set(l,d),d.ta.push(e),e.sa(i.onlineState),d.ea&&e.oa(d.ea)&&H4(i)}async function G4(n,e){const i=er(n),o=e.query;let l=3;const d=i.queries.get(o);if(d){const p=d.ta.indexOf(e);p>=0&&(d.ta.splice(p,1),d.ta.length===0?l=e.ra()?0:1:!d.na()&&e.ra()&&(l=2))}switch(l){case 0:return i.queries.delete(o),i.onUnlisten(o,!0);case 1:return i.queries.delete(o),i.onUnlisten(o,!1);case 2:return i.onLastRemoteStoreUnlisten(o);default:return}}function V5e(n,e){const i=er(n);let o=!1;for(const l of e){const d=l.query,p=i.queries.get(d);if(p){for(const _ of p.ta)_.oa(l)&&(o=!0);p.ea=l}}o&&H4(i)}function F5e(n,e,i){const o=er(n),l=o.queries.get(e);if(l)for(const d of l.ta)d.onError(i);o.queries.delete(e)}function H4(n){n.ia.forEach(e=>{e.next()})}var lF,HJ;(HJ=lF||(lF={}))._a="default",HJ.Cache="cache";class $4{constructor(e,i,o){this.query=e,this.aa=i,this.ua=!1,this.ca=null,this.onlineState="Unknown",this.options=o||{}}oa(e){if(!this.options.includeMetadataChanges){const o=[];for(const l of e.docChanges)l.type!==3&&o.push(l);e=new x0(e.query,e.docs,e.oldDocs,o,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let i=!1;return this.ua?this.la(e)&&(this.aa.next(e),i=!0):this.ha(e,this.onlineState)&&(this.Pa(e),i=!0),this.ca=e,i}onError(e){this.aa.error(e)}sa(e){this.onlineState=e;let i=!1;return this.ca&&!this.ua&&this.ha(this.ca,e)&&(this.Pa(this.ca),i=!0),i}ha(e,i){if(!e.fromCache||!this.ra())return!0;const o=i!=="Offline";return(!this.options.Ta||!o)&&(!e.docs.isEmpty()||e.hasCachedResults||i==="Offline")}la(e){if(e.docChanges.length>0)return!0;const i=this.ca&&this.ca.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!i)&&this.options.includeMetadataChanges===!0}Pa(e){e=x0.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.ua=!0,this.aa.next(e)}ra(){return this.options.source!==lF.Cache}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bse{constructor(e){this.key=e}}class Wse{constructor(e){this.key=e}}class j5e{constructor(e,i){this.query=e,this.fa=i,this.ga=null,this.hasCachedResults=!1,this.current=!1,this.pa=Pr(),this.mutatedKeys=Pr(),this.ya=ase(e),this.wa=new u0(this.ya)}get Sa(){return this.fa}ba(e,i){const o=i?i.Da:new zJ,l=i?i.wa:this.wa;let d=i?i.mutatedKeys:this.mutatedKeys,p=l,_=!1;const E=this.query.limitType==="F"&&l.size===this.query.limit?l.last():null,b=this.query.limitType==="L"&&l.size===this.query.limit?l.first():null;if(e.inorderTraversal((C,I)=>{const O=l.get(C),L=fN(this.query,I)?I:null,V=!!O&&this.mutatedKeys.has(O.key),B=!!L&&(L.hasLocalMutations||this.mutatedKeys.has(L.key)&&L.hasCommittedMutations);let W=!1;O&&L?O.data.isEqual(L.data)?V!==B&&(o.track({type:3,doc:L}),W=!0):this.va(O,L)||(o.track({type:2,doc:L}),W=!0,(E&&this.ya(L,E)>0||b&&this.ya(L,b)<0)&&(_=!0)):!O&&L?(o.track({type:0,doc:L}),W=!0):O&&!L&&(o.track({type:1,doc:O}),W=!0,(E||b)&&(_=!0)),W&&(L?(p=p.add(L),d=B?d.add(C):d.delete(C)):(p=p.delete(C),d=d.delete(C)))}),this.query.limit!==null)for(;p.size>this.query.limit;){const C=this.query.limitType==="F"?p.last():p.first();p=p.delete(C.key),d=d.delete(C.key),o.track({type:1,doc:C})}return{wa:p,Da:o,ls:_,mutatedKeys:d}}va(e,i){return e.hasLocalMutations&&i.hasCommittedMutations&&!i.hasLocalMutations}applyChanges(e,i,o,l){const d=this.wa;this.wa=e.wa,this.mutatedKeys=e.mutatedKeys;const p=e.Da.X_();p.sort((C,I)=>function(L,V){const B=W=>{switch(W){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return $n()}};return B(L)-B(V)}(C.type,I.type)||this.ya(C.doc,I.doc)),this.Ca(o),l=l!=null&&l;const _=i&&!l?this.Fa():[],E=this.pa.size===0&&this.current&&!l?1:0,b=E!==this.ga;return this.ga=E,p.length!==0||b?{snapshot:new x0(this.query,e.wa,d,p,e.mutatedKeys,E===0,b,!1,!!o&&o.resumeToken.approximateByteSize()>0),Ma:_}:{Ma:_}}sa(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({wa:this.wa,Da:new zJ,mutatedKeys:this.mutatedKeys,ls:!1},!1)):{Ma:[]}}xa(e){return!this.fa.has(e)&&!!this.wa.has(e)&&!this.wa.get(e).hasLocalMutations}Ca(e){e&&(e.addedDocuments.forEach(i=>this.fa=this.fa.add(i)),e.modifiedDocuments.forEach(i=>{}),e.removedDocuments.forEach(i=>this.fa=this.fa.delete(i)),this.current=e.current)}Fa(){if(!this.current)return[];const e=this.pa;this.pa=Pr(),this.wa.forEach(o=>{this.xa(o.key)&&(this.pa=this.pa.add(o.key))});const i=[];return e.forEach(o=>{this.pa.has(o)||i.push(new Wse(o))}),this.pa.forEach(o=>{e.has(o)||i.push(new Bse(o))}),i}Oa(e){this.fa=e.gs,this.pa=Pr();const i=this.ba(e.documents);return this.applyChanges(i,!0)}Na(){return x0.fromInitialDocuments(this.query,this.wa,this.mutatedKeys,this.ga===0,this.hasCachedResults)}}const K4="SyncEngine";class B5e{constructor(e,i,o){this.query=e,this.targetId=i,this.view=o}}class W5e{constructor(e){this.key=e,this.Ba=!1}}class z5e{constructor(e,i,o,l,d,p){this.localStore=e,this.remoteStore=i,this.eventManager=o,this.sharedClientState=l,this.currentUser=d,this.maxConcurrentLimboResolutions=p,this.La={},this.ka=new eE(_=>ose(_),hN),this.qa=new Map,this.Qa=new Set,this.$a=new ys(Sn.comparator),this.Ua=new Map,this.Ka=new D4,this.Wa={},this.Ga=new Map,this.za=D0.Kn(),this.onlineState="Unknown",this.ja=void 0}get isPrimaryClient(){return this.ja===!0}}async function G5e(n,e,i=!0){const o=qse(n);let l;const d=o.ka.get(e);return d?(o.sharedClientState.addLocalQueryTarget(d.targetId),l=d.view.Na()):l=await zse(o,e,i,!0),l}async function H5e(n,e){const i=qse(n);await zse(i,e,!0,!1)}async function zse(n,e,i,o){const l=await d5e(n.localStore,uf(e)),d=l.targetId,p=n.sharedClientState.addLocalQueryTarget(d,i);let _;return o&&(_=await $5e(n,e,d,p==="current",l.resumeToken)),n.isPrimaryClient&&i&&Lse(n.remoteStore,l),_}async function $5e(n,e,i,o,l){n.Ha=(I,O,L)=>async function(B,W,Z,$){let se=W.view.ba(Z);se.ls&&(se=await UJ(B.localStore,W.query,!1).then(({documents:q})=>W.view.ba(q,se)));const ue=$&&$.targetChanges.get(W.targetId),re=$&&$.targetMismatches.get(W.targetId)!=null,pe=W.view.applyChanges(se,B.isPrimaryClient,ue,re);return KJ(B,W.targetId,pe.Ma),pe.snapshot}(n,I,O,L);const d=await UJ(n.localStore,e,!0),p=new j5e(e,d.gs),_=p.ba(d.documents),E=TR.createSynthesizedTargetChangeForCurrentChange(i,o&&n.onlineState!=="Offline",l),b=p.applyChanges(_,n.isPrimaryClient,E);KJ(n,i,b.Ma);const C=new B5e(e,i,p);return n.ka.set(e,C),n.qa.has(i)?n.qa.get(i).push(e):n.qa.set(i,[e]),b.snapshot}async function K5e(n,e,i){const o=er(n),l=o.ka.get(e),d=o.qa.get(l.targetId);if(d.length>1)return o.qa.set(l.targetId,d.filter(p=>!hN(p,e))),void o.ka.delete(e);o.isPrimaryClient?(o.sharedClientState.removeLocalQueryTarget(l.targetId),o.sharedClientState.isActiveQueryTarget(l.targetId)||await aF(o.localStore,l.targetId,!1).then(()=>{o.sharedClientState.clearQueryState(l.targetId),i&&U4(o.remoteStore,l.targetId),uF(o,l.targetId)}).catch(Y0)):(uF(o,l.targetId),await aF(o.localStore,l.targetId,!0))}async function q5e(n,e){const i=er(n),o=i.ka.get(e),l=i.qa.get(o.targetId);i.isPrimaryClient&&l.length===1&&(i.sharedClientState.removeLocalQueryTarget(o.targetId),U4(i.remoteStore,o.targetId))}async function Y5e(n,e,i){const o=nBe(n);try{const l=await function(p,_){const E=er(p),b=So.now(),C=_.reduce((L,V)=>L.add(V.key),Pr());let I,O;return E.persistence.runTransaction("Locally write mutations","readwrite",L=>{let V=qp(),B=Pr();return E.ds.getEntries(L,C).next(W=>{V=W,V.forEach((Z,$)=>{$.isValidDocument()||(B=B.add(Z))})}).next(()=>E.localDocuments.getOverlayedDocuments(L,V)).next(W=>{I=W;const Z=[];for(const $ of _){const se=d3e($,I.get($.key).overlayedDocument);se!=null&&Z.push(new zg($.key,se,Zie(se.value.mapValue),Lu.exists(!0)))}return E.mutationQueue.addMutationBatch(L,b,Z,_)}).next(W=>{O=W;const Z=W.applyToLocalDocumentSet(I,B);return E.documentOverlayCache.saveOverlays(L,W.batchId,Z)})}).then(()=>({batchId:O.batchId,changes:lse(I)}))}(o.localStore,e);o.sharedClientState.addPendingMutation(l.batchId),function(p,_,E){let b=p.Wa[p.currentUser.toKey()];b||(b=new ys(mr)),b=b.insert(_,E),p.Wa[p.currentUser.toKey()]=b}(o,l.batchId,i),await CR(o,l.changes),await EN(o.remoteStore)}catch(l){const d=W4(l,"Failed to persist write");i.reject(d)}}async function Gse(n,e){const i=er(n);try{const o=await c5e(i.localStore,e);e.targetChanges.forEach((l,d)=>{const p=i.Ua.get(d);p&&(mi(l.addedDocuments.size+l.modifiedDocuments.size+l.removedDocuments.size<=1),l.addedDocuments.size>0?p.Ba=!0:l.modifiedDocuments.size>0?mi(p.Ba):l.removedDocuments.size>0&&(mi(p.Ba),p.Ba=!1))}),await CR(i,o,e)}catch(o){await Y0(o)}}function $J(n,e,i){const o=er(n);if(o.isPrimaryClient&&i===0||!o.isPrimaryClient&&i===1){const l=[];o.ka.forEach((d,p)=>{const _=p.view.sa(e);_.snapshot&&l.push(_.snapshot)}),function(p,_){const E=er(p);E.onlineState=_;let b=!1;E.queries.forEach((C,I)=>{for(const O of I.ta)O.sa(_)&&(b=!0)}),b&&H4(E)}(o.eventManager,e),l.length&&o.La.p_(l),o.onlineState=e,o.isPrimaryClient&&o.sharedClientState.setOnlineState(e)}}async function X5e(n,e,i){const o=er(n);o.sharedClientState.updateQueryState(e,"rejected",i);const l=o.Ua.get(e),d=l&&l.key;if(d){let p=new ys(Sn.comparator);p=p.insert(d,Ja.newNoDocument(d,Xn.min()));const _=Pr().add(d),E=new gN(Xn.min(),new Map,new ys(mr),p,_);await Gse(o,E),o.$a=o.$a.remove(d),o.Ua.delete(e),q4(o)}else await aF(o.localStore,e,!1).then(()=>uF(o,e,i)).catch(Y0)}async function J5e(n,e){const i=er(n),o=e.batch.batchId;try{const l=await a5e(i.localStore,e);$se(i,o,null),Hse(i,o),i.sharedClientState.updateMutationState(o,"acknowledged"),await CR(i,l)}catch(l){await Y0(l)}}async function Q5e(n,e,i){const o=er(n);try{const l=await function(p,_){const E=er(p);return E.persistence.runTransaction("Reject batch","readwrite-primary",b=>{let C;return E.mutationQueue.lookupMutationBatch(b,_).next(I=>(mi(I!==null),C=I.keys(),E.mutationQueue.removeMutationBatch(b,I))).next(()=>E.mutationQueue.performConsistencyCheck(b)).next(()=>E.documentOverlayCache.removeOverlaysForBatchId(b,C,_)).next(()=>E.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(b,C)).next(()=>E.localDocuments.getDocuments(b,C))})}(o.localStore,e);$se(o,e,i),Hse(o,e),o.sharedClientState.updateMutationState(e,"rejected",i),await CR(o,l)}catch(l){await Y0(l)}}function Hse(n,e){(n.Ga.get(e)||[]).forEach(i=>{i.resolve()}),n.Ga.delete(e)}function $se(n,e,i){const o=er(n);let l=o.Wa[o.currentUser.toKey()];if(l){const d=l.get(e);d&&(i?d.reject(i):d.resolve(),l=l.remove(e)),o.Wa[o.currentUser.toKey()]=l}}function uF(n,e,i=null){n.sharedClientState.removeLocalQueryTarget(e);for(const o of n.qa.get(e))n.ka.delete(o),i&&n.La.Ja(o,i);n.qa.delete(e),n.isPrimaryClient&&n.Ka.br(e).forEach(o=>{n.Ka.containsKey(o)||Kse(n,o)})}function Kse(n,e){n.Qa.delete(e.path.canonicalString());const i=n.$a.get(e);i!==null&&(U4(n.remoteStore,i),n.$a=n.$a.remove(e),n.Ua.delete(i),q4(n))}function KJ(n,e,i){for(const o of i)o instanceof Bse?(n.Ka.addReference(o.key,e),Z5e(n,o)):o instanceof Wse?(nn(K4,"Document no longer in limbo: "+o.key),n.Ka.removeReference(o.key,e),n.Ka.containsKey(o.key)||Kse(n,o.key)):$n()}function Z5e(n,e){const i=e.key,o=i.path.canonicalString();n.$a.get(i)||n.Qa.has(o)||(nn(K4,"New document in limbo: "+i),n.Qa.add(o),q4(n))}function q4(n){for(;n.Qa.size>0&&n.$a.size<n.maxConcurrentLimboResolutions;){const e=n.Qa.values().next().value;n.Qa.delete(e);const i=new Sn(Wi.fromString(e)),o=n.za.next();n.Ua.set(o,new W5e(i)),n.$a=n.$a.insert(i,o),Lse(n.remoteStore,new vg(uf(dN(i.path)),o,"TargetPurposeLimboResolution",aN.ae))}}async function CR(n,e,i){const o=er(n),l=[],d=[],p=[];o.ka.isEmpty()||(o.ka.forEach((_,E)=>{p.push(o.Ha(E,e,i).then(b=>{var C;if((b||i)&&o.isPrimaryClient){const I=b?!b.fromCache:(C=i==null?void 0:i.targetChanges.get(E.targetId))===null||C===void 0?void 0:C.current;o.sharedClientState.updateQueryState(E.targetId,I?"current":"not-current")}if(b){l.push(b);const I=L4.Yi(E.targetId,b);d.push(I)}}))}),await Promise.all(p),o.La.p_(l),await async function(E,b){const C=er(E);try{await C.persistence.runTransaction("notifyLocalViewChanges","readwrite",I=>Rt.forEach(b,O=>Rt.forEach(O.Hi,L=>C.persistence.referenceDelegate.addReference(I,O.targetId,L)).next(()=>Rt.forEach(O.Ji,L=>C.persistence.referenceDelegate.removeReference(I,O.targetId,L)))))}catch(I){if(!X0(I))throw I;nn(M4,"Failed to update sequence numbers: "+I)}for(const I of b){const O=I.targetId;if(!I.fromCache){const L=C.Ts.get(O),V=L.snapshotVersion,B=L.withLastLimboFreeSnapshotVersion(V);C.Ts=C.Ts.insert(O,B)}}}(o.localStore,d))}async function eBe(n,e){const i=er(n);if(!i.currentUser.isEqual(e)){nn(K4,"User change. New user:",e.toKey());const o=await kse(i.localStore,e);i.currentUser=e,function(d,p){d.Ga.forEach(_=>{_.forEach(E=>{E.reject(new Kt(Et.CANCELLED,p))})}),d.Ga.clear()}(i,"'waitForPendingWrites' promise is rejected due to a user change."),i.sharedClientState.handleUserChange(e,o.removedBatchIds,o.addedBatchIds),await CR(i,o.Rs)}}function tBe(n,e){const i=er(n),o=i.Ua.get(e);if(o&&o.Ba)return Pr().add(o.key);{let l=Pr();const d=i.qa.get(e);if(!d)return l;for(const p of d){const _=i.ka.get(p);l=l.unionWith(_.view.Sa)}return l}}function qse(n){const e=er(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=Gse.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=tBe.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=X5e.bind(null,e),e.La.p_=V5e.bind(null,e.eventManager),e.La.Ja=F5e.bind(null,e.eventManager),e}function nBe(n){const e=er(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=J5e.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=Q5e.bind(null,e),e}class p1{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=_N(e.databaseInfo.databaseId),this.sharedClientState=this.Za(e),this.persistence=this.Xa(e),await this.persistence.start(),this.localStore=this.eu(e),this.gcScheduler=this.tu(e,this.localStore),this.indexBackfillerScheduler=this.nu(e,this.localStore)}tu(e,i){return null}nu(e,i){return null}eu(e){return o5e(this.persistence,new r5e,e.initialUser,this.serializer)}Xa(e){return new Ose(x4.ri,this.serializer)}Za(e){return new f5e}async terminate(){var e,i;(e=this.gcScheduler)===null||e===void 0||e.stop(),(i=this.indexBackfillerScheduler)===null||i===void 0||i.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}p1.provider={build:()=>new p1};class rBe extends p1{constructor(e){super(),this.cacheSizeBytes=e}tu(e,i){mi(this.persistence.referenceDelegate instanceof h1);const o=this.persistence.referenceDelegate.garbageCollector;return new W3e(o,e.asyncQueue,i)}Xa(e){const i=this.cacheSizeBytes!==void 0?sl.withCacheSize(this.cacheSizeBytes):sl.DEFAULT;return new Ose(o=>h1.ri(o,i),this.serializer)}}class dF{async initialize(e,i){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(i),this.remoteStore=this.createRemoteStore(i),this.eventManager=this.createEventManager(i),this.syncEngine=this.createSyncEngine(i,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=o=>$J(this.syncEngine,o,1),this.remoteStore.remoteSyncer.handleCredentialChange=eBe.bind(null,this.syncEngine),await L5e(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return function(){return new U5e}()}createDatastore(e){const i=_N(e.databaseInfo.databaseId),o=function(d){return new y5e(d)}(e.databaseInfo);return function(d,p,_,E){return new b5e(d,p,_,E)}(e.authCredentials,e.appCheckCredentials,o,i)}createRemoteStore(e){return function(o,l,d,p,_){return new w5e(o,l,d,p,_)}(this.localStore,this.datastore,e.asyncQueue,i=>$J(this.syncEngine,i,0),function(){return jJ.D()?new jJ:new p5e}())}createSyncEngine(e,i){return function(l,d,p,_,E,b,C){const I=new z5e(l,d,p,_,E,b);return C&&(I.ja=!0),I}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,i)}async terminate(){var e,i;await async function(l){const d=er(l);nn($y,"RemoteStore shutting down."),d.W_.add(5),await wR(d),d.z_.shutdown(),d.j_.set("Unknown")}(this.remoteStore),(e=this.datastore)===null||e===void 0||e.terminate(),(i=this.eventManager)===null||i===void 0||i.terminate()}}dF.provider={build:()=>new dF};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Y4{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.iu(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.iu(this.observer.error,e):Kp("Uncaught Error in snapshot listener:",e.toString()))}su(){this.muted=!0}iu(e,i){setTimeout(()=>{this.muted||e(i)},0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Mg="FirestoreClient";class iBe{constructor(e,i,o,l,d){this.authCredentials=e,this.appCheckCredentials=i,this.asyncQueue=o,this.databaseInfo=l,this.user=Xa.UNAUTHENTICATED,this.clientId=zie.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=d,this.authCredentials.start(o,async p=>{nn(Mg,"Received user=",p.uid),await this.authCredentialListener(p),this.user=p}),this.appCheckCredentials.start(o,p=>(nn(Mg,"Received new app check token=",p),this.appCheckCredentialListener(p,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new Vp;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(i){const o=W4(i,"Failed to shutdown persistence");e.reject(o)}}),e.promise}}async function PU(n,e){n.asyncQueue.verifyOperationInProgress(),nn(Mg,"Initializing OfflineComponentProvider");const i=n.configuration;await e.initialize(i);let o=i.initialUser;n.setCredentialChangeListener(async l=>{o.isEqual(l)||(await kse(e.localStore,l),o=l)}),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=e}async function qJ(n,e){n.asyncQueue.verifyOperationInProgress();const i=await sBe(n);nn(Mg,"Initializing OnlineComponentProvider"),await e.initialize(i,n.configuration),n.setCredentialChangeListener(o=>WJ(e.remoteStore,o)),n.setAppCheckTokenChangeListener((o,l)=>WJ(e.remoteStore,l)),n._onlineComponents=e}async function sBe(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){nn(Mg,"Using user provided OfflineComponentProvider");try{await PU(n,n._uninitializedComponentsProvider._offline)}catch(e){const i=e;if(!function(l){return l.name==="FirebaseError"?l.code===Et.FAILED_PRECONDITION||l.code===Et.UNIMPLEMENTED:!(typeof DOMException<"u"&&l instanceof DOMException)||l.code===22||l.code===20||l.code===11}(i))throw i;R0("Error using user provided cache. Falling back to memory cache: "+i),await PU(n,new p1)}}else nn(Mg,"Using default OfflineComponentProvider"),await PU(n,new rBe(void 0));return n._offlineComponents}async function Yse(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(nn(Mg,"Using user provided OnlineComponentProvider"),await qJ(n,n._uninitializedComponentsProvider._online)):(nn(Mg,"Using default OnlineComponentProvider"),await qJ(n,new dF))),n._onlineComponents}function oBe(n){return Yse(n).then(e=>e.syncEngine)}async function m1(n){const e=await Yse(n),i=e.eventManager;return i.onListen=G5e.bind(null,e.syncEngine),i.onUnlisten=K5e.bind(null,e.syncEngine),i.onFirstRemoteStoreListen=H5e.bind(null,e.syncEngine),i.onLastRemoteStoreUnlisten=q5e.bind(null,e.syncEngine),i}function aBe(n,e,i={}){const o=new Vp;return n.asyncQueue.enqueueAndForget(async()=>function(d,p,_,E,b){const C=new Y4({next:O=>{C.su(),p.enqueueAndForget(()=>G4(d,I));const L=O.docs.has(_);!L&&O.fromCache?b.reject(new Kt(Et.UNAVAILABLE,"Failed to get document because the client is offline.")):L&&O.fromCache&&E&&E.source==="server"?b.reject(new Kt(Et.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):b.resolve(O)},error:O=>b.reject(O)}),I=new $4(dN(_.path),C,{includeMetadataChanges:!0,Ta:!0});return z4(d,I)}(await m1(n),n.asyncQueue,e,i,o)),o.promise}function cBe(n,e,i={}){const o=new Vp;return n.asyncQueue.enqueueAndForget(async()=>function(d,p,_,E,b){const C=new Y4({next:O=>{C.su(),p.enqueueAndForget(()=>G4(d,I)),O.fromCache&&E.source==="server"?b.reject(new Kt(Et.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):b.resolve(O)},error:O=>b.reject(O)}),I=new $4(_,C,{includeMetadataChanges:!0,Ta:!0});return z4(d,I)}(await m1(n),n.asyncQueue,e,i,o)),o.promise}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Xse(n){const e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const YJ=new Map;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Jse(n,e,i){if(!i)throw new Kt(Et.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function lBe(n,e,i,o){if(e===!0&&o===!0)throw new Kt(Et.INVALID_ARGUMENT,`${n} and ${i} cannot be used together.`)}function XJ(n){if(!Sn.isDocumentKey(n))throw new Kt(Et.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function JJ(n){if(Sn.isDocumentKey(n))throw new Kt(Et.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function vN(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{const e=function(o){return o.constructor?o.constructor.name:null}(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":$n()}function dl(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new Kt(Et.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const i=vN(n);throw new Kt(Et.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${i}`)}}return n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Qse="firestore.googleapis.com",QJ=!0;class ZJ{constructor(e){var i,o;if(e.host===void 0){if(e.ssl!==void 0)throw new Kt(Et.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=Qse,this.ssl=QJ}else this.host=e.host,this.ssl=(i=e.ssl)!==null&&i!==void 0?i:QJ;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=Pse;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<j3e)throw new Kt(Et.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}lBe("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=Xse((o=e.experimentalLongPollingOptions)!==null&&o!==void 0?o:{}),function(d){if(d.timeoutSeconds!==void 0){if(isNaN(d.timeoutSeconds))throw new Kt(Et.INVALID_ARGUMENT,`invalid long polling timeout: ${d.timeoutSeconds} (must not be NaN)`);if(d.timeoutSeconds<5)throw new Kt(Et.INVALID_ARGUMENT,`invalid long polling timeout: ${d.timeoutSeconds} (minimum allowed value is 5)`);if(d.timeoutSeconds>30)throw new Kt(Et.INVALID_ARGUMENT,`invalid long polling timeout: ${d.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(o,l){return o.timeoutSeconds===l.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class SN{constructor(e,i,o,l){this._authCredentials=e,this._appCheckCredentials=i,this._databaseId=o,this._app=l,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new ZJ({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new Kt(Et.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new Kt(Et.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new ZJ(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=function(o){if(!o)return new _4e;switch(o.type){case"firstParty":return new S4e(o.sessionIndex||"0",o.iamToken||null,o.authTokenFactory||null);case"provider":return o.client;default:throw new Kt(Et.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(i){const o=YJ.get(i);o&&(nn("ComponentProvider","Removing Datastore"),YJ.delete(i),o.terminate())}(this),Promise.resolve()}}function uBe(n,e,i,o={}){var l;const d=(n=dl(n,SN))._getSettings(),p=Object.assign(Object.assign({},d),{emulatorOptions:n._getEmulatorOptions()}),_=`${e}:${i}`;d.host!==Qse&&d.host!==_&&R0("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const E=Object.assign(Object.assign({},d),{host:_,ssl:!1,emulatorOptions:o});if(!Gp(E,p)&&(n._setSettings(E),o.mockUserToken)){let b,C;if(typeof o.mockUserToken=="string")b=o.mockUserToken,C=Xa.MOCK_USER;else{b=$re(o.mockUserToken,(l=n._app)===null||l===void 0?void 0:l.options.projectId);const I=o.mockUserToken.sub||o.mockUserToken.user_id;if(!I)throw new Kt(Et.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");C=new Xa(I)}n._authCredentials=new y4e(new Bie(b,C))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yf{constructor(e,i,o){this.converter=i,this._query=o,this.type="query",this.firestore=e}withConverter(e){return new yf(this.firestore,e,this._query)}}class Za{constructor(e,i,o){this.converter=i,this._key=o,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Cg(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Za(this.firestore,e,this._key)}}class Cg extends yf{constructor(e,i,o){super(e,i,dN(o)),this._path=o,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Za(this.firestore,null,new Sn(e))}withConverter(e){return new Cg(this.firestore,e,this._path)}}function Yp(n,e,...i){if(n=zi(n),Jse("collection","path",e),n instanceof SN){const o=Wi.fromString(e,...i);return JJ(o),new Cg(n,null,o)}{if(!(n instanceof Za||n instanceof Cg))throw new Kt(Et.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const o=n._path.child(Wi.fromString(e,...i));return JJ(o),new Cg(n.firestore,null,o)}}function $r(n,e,...i){if(n=zi(n),arguments.length===1&&(e=zie.newId()),Jse("doc","path",e),n instanceof SN){const o=Wi.fromString(e,...i);return XJ(o),new Za(n,null,new Sn(o))}{if(!(n instanceof Za||n instanceof Cg))throw new Kt(Et.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const o=n._path.child(Wi.fromString(e,...i));return XJ(o),new Za(n.firestore,n instanceof Cg?n.converter:null,new Sn(o))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const eQ="AsyncQueue";class tQ{constructor(e=Promise.resolve()){this.Vu=[],this.mu=!1,this.fu=[],this.gu=null,this.pu=!1,this.yu=!1,this.wu=[],this.a_=new Dse(this,"async_queue_retry"),this.Su=()=>{const o=AU();o&&nn(eQ,"Visibility state changed to "+o.visibilityState),this.a_.t_()},this.bu=e;const i=AU();i&&typeof i.addEventListener=="function"&&i.addEventListener("visibilitychange",this.Su)}get isShuttingDown(){return this.mu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.Du(),this.vu(e)}enterRestrictedMode(e){if(!this.mu){this.mu=!0,this.yu=e||!1;const i=AU();i&&typeof i.removeEventListener=="function"&&i.removeEventListener("visibilitychange",this.Su)}}enqueue(e){if(this.Du(),this.mu)return new Promise(()=>{});const i=new Vp;return this.vu(()=>this.mu&&this.yu?Promise.resolve():(e().then(i.resolve,i.reject),i.promise)).then(()=>i.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Vu.push(e),this.Cu()))}async Cu(){if(this.Vu.length!==0){try{await this.Vu[0](),this.Vu.shift(),this.a_.reset()}catch(e){if(!X0(e))throw e;nn(eQ,"Operation failed with retryable error: "+e)}this.Vu.length>0&&this.a_.Xo(()=>this.Cu())}}vu(e){const i=this.bu.then(()=>(this.pu=!0,e().catch(o=>{this.gu=o,this.pu=!1;const l=function(p){let _=p.message||"";return p.stack&&(_=p.stack.includes(p.message)?p.stack:p.message+`
`+p.stack),_}(o);throw Kp("INTERNAL UNHANDLED ERROR: ",l),o}).then(o=>(this.pu=!1,o))));return this.bu=i,i}enqueueAfterDelay(e,i,o){this.Du(),this.wu.indexOf(e)>-1&&(i=0);const l=B4.createAndSchedule(this,e,i,o,d=>this.Fu(d));return this.fu.push(l),l}Du(){this.gu&&$n()}verifyOperationInProgress(){}async Mu(){let e;do e=this.bu,await e;while(e!==this.bu)}xu(e){for(const i of this.fu)if(i.timerId===e)return!0;return!1}Ou(e){return this.Mu().then(()=>{this.fu.sort((i,o)=>i.targetTimeMs-o.targetTimeMs);for(const i of this.fu)if(i.skipDelay(),e!=="all"&&i.timerId===e)break;return this.Mu()})}Nu(e){this.wu.push(e)}Fu(e){const i=this.fu.indexOf(e);this.fu.splice(i,1)}}function nQ(n){return function(i,o){if(typeof i!="object"||i===null)return!1;const l=i;for(const d of o)if(d in l&&typeof l[d]=="function")return!0;return!1}(n,["next","error","complete"])}class Xp extends SN{constructor(e,i,o,l){super(e,i,o,l),this.type="firestore",this._queue=new tQ,this._persistenceKey=(l==null?void 0:l.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new tQ(e),this._firestoreClient=void 0,await e}}}function hF(n,e){const i=typeof n=="object"?n:f4(),o=typeof n=="string"?n:s1,l=nN(i,"firestore").getImmediate({identifier:o});if(!l._initialized){const d=zre("firestore");d&&uBe(l,...d)}return l}function bN(n){if(n._terminated)throw new Kt(Et.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||dBe(n),n._firestoreClient}function dBe(n){var e,i,o;const l=n._freezeSettings(),d=function(_,E,b,C){return new M4e(_,E,b,C.host,C.ssl,C.experimentalForceLongPolling,C.experimentalAutoDetectLongPolling,Xse(C.experimentalLongPollingOptions),C.useFetchStreams)}(n._databaseId,((e=n._app)===null||e===void 0?void 0:e.options.appId)||"",n._persistenceKey,l);n._componentsProvider||!((i=l.localCache)===null||i===void 0)&&i._offlineComponentProvider&&(!((o=l.localCache)===null||o===void 0)&&o._onlineComponentProvider)&&(n._componentsProvider={_offline:l.localCache._offlineComponentProvider,_online:l.localCache._onlineComponentProvider}),n._firestoreClient=new iBe(n._authCredentials,n._appCheckCredentials,n._queue,d,n._componentsProvider&&function(_){const E=_==null?void 0:_._online.build();return{_offline:_==null?void 0:_._offline.build(E),_online:E}}(n._componentsProvider))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class L0{constructor(e){this._byteString=e}static fromBase64String(e){try{return new L0(Sa.fromBase64String(e))}catch(i){throw new Kt(Et.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+i)}}static fromUint8Array(e){return new L0(Sa.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class TN{constructor(...e){for(let i=0;i<e.length;++i)if(e[i].length===0)throw new Kt(Et.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new va(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class RR{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class X4{constructor(e,i){if(!isFinite(e)||e<-90||e>90)throw new Kt(Et.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(i)||i<-180||i>180)throw new Kt(Et.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+i);this._lat=e,this._long=i}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return mr(this._lat,e._lat)||mr(this._long,e._long)}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class J4{constructor(e){this._values=(e||[]).map(i=>i)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(o,l){if(o.length!==l.length)return!1;for(let d=0;d<o.length;++d)if(o[d]!==l[d])return!1;return!0}(this._values,e._values)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hBe=/^__.*__$/;class fBe{constructor(e,i,o){this.data=e,this.fieldMask=i,this.fieldTransforms=o}toMutation(e,i){return this.fieldMask!==null?new zg(e,this.data,this.fieldMask,i,this.fieldTransforms):new bR(e,this.data,i,this.fieldTransforms)}}class Zse{constructor(e,i,o){this.data=e,this.fieldMask=i,this.fieldTransforms=o}toMutation(e,i){return new zg(e,this.data,this.fieldMask,i,this.fieldTransforms)}}function eoe(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw $n()}}class wN{constructor(e,i,o,l,d,p){this.settings=e,this.databaseId=i,this.serializer=o,this.ignoreUndefinedProperties=l,d===void 0&&this.Bu(),this.fieldTransforms=d||[],this.fieldMask=p||[]}get path(){return this.settings.path}get Lu(){return this.settings.Lu}ku(e){return new wN(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}qu(e){var i;const o=(i=this.path)===null||i===void 0?void 0:i.child(e),l=this.ku({path:o,Qu:!1});return l.$u(e),l}Uu(e){var i;const o=(i=this.path)===null||i===void 0?void 0:i.child(e),l=this.ku({path:o,Qu:!1});return l.Bu(),l}Ku(e){return this.ku({path:void 0,Qu:!0})}Wu(e){return g1(e,this.settings.methodName,this.settings.Gu||!1,this.path,this.settings.zu)}contains(e){return this.fieldMask.find(i=>e.isPrefixOf(i))!==void 0||this.fieldTransforms.find(i=>e.isPrefixOf(i.field))!==void 0}Bu(){if(this.path)for(let e=0;e<this.path.length;e++)this.$u(this.path.get(e))}$u(e){if(e.length===0)throw this.Wu("Document fields must not be empty");if(eoe(this.Lu)&&hBe.test(e))throw this.Wu('Document fields cannot begin and end with "__"')}}class pBe{constructor(e,i,o){this.databaseId=e,this.ignoreUndefinedProperties=i,this.serializer=o||_N(e)}ju(e,i,o,l=!1){return new wN({Lu:e,methodName:i,zu:o,path:va.emptyPath(),Qu:!1,Gu:l},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function IR(n){const e=n._freezeSettings(),i=_N(n._databaseId);return new pBe(n._databaseId,!!e.ignoreUndefinedProperties,i)}function toe(n,e,i,o,l,d={}){const p=n.ju(d.merge||d.mergeFields?2:0,e,i,l);e3("Data must be an object, but it was:",p,o);const _=ioe(o,p);let E,b;if(d.merge)E=new Ul(p.fieldMask),b=p.fieldTransforms;else if(d.mergeFields){const C=[];for(const I of d.mergeFields){const O=fF(e,I,i);if(!p.contains(O))throw new Kt(Et.INVALID_ARGUMENT,`Field '${O}' is specified in your field mask but missing from your input data.`);ooe(C,O)||C.push(O)}E=new Ul(C),b=p.fieldTransforms.filter(I=>E.covers(I.field))}else E=null,b=p.fieldTransforms;return new fBe(new al(_),E,b)}class CN extends RR{_toFieldTransform(e){if(e.Lu!==2)throw e.Lu===1?e.Wu(`${this._methodName}() can only appear at the top level of your update data`):e.Wu(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof CN}}function noe(n,e,i){return new wN({Lu:3,zu:e.settings.zu,methodName:n._methodName,Qu:i},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}class Q4 extends RR{constructor(e,i){super(e),this.Hu=i}_toFieldTransform(e){const i=noe(this,e,!0),o=this.Hu.map(d=>nE(d,i)),l=new k0(o);return new gse(e.path,l)}isEqual(e){return e instanceof Q4&&Gp(this.Hu,e.Hu)}}class Z4 extends RR{constructor(e,i){super(e),this.Hu=i}_toFieldTransform(e){const i=noe(this,e,!0),o=this.Hu.map(d=>nE(d,i)),l=new N0(o);return new gse(e.path,l)}isEqual(e){return e instanceof Z4&&Gp(this.Hu,e.Hu)}}function mBe(n,e,i,o){const l=n.ju(1,e,i);e3("Data must be an object, but it was:",l,o);const d=[],p=al.empty();Wg(o,(E,b)=>{const C=t3(e,E,i);b=zi(b);const I=l.Uu(C);if(b instanceof CN)d.push(C);else{const O=nE(b,I);O!=null&&(d.push(C),p.set(C,O))}});const _=new Ul(d);return new Zse(p,_,l.fieldTransforms)}function gBe(n,e,i,o,l,d){const p=n.ju(1,e,i),_=[fF(e,o,i)],E=[l];if(d.length%2!=0)throw new Kt(Et.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let O=0;O<d.length;O+=2)_.push(fF(e,d[O])),E.push(d[O+1]);const b=[],C=al.empty();for(let O=_.length-1;O>=0;--O)if(!ooe(b,_[O])){const L=_[O];let V=E[O];V=zi(V);const B=p.Uu(L);if(V instanceof CN)b.push(L);else{const W=nE(V,B);W!=null&&(b.push(L),C.set(L,W))}}const I=new Ul(b);return new Zse(C,I,p.fieldTransforms)}function roe(n,e,i,o=!1){return nE(i,n.ju(o?4:3,e))}function nE(n,e){if(soe(n=zi(n)))return e3("Unsupported field value:",e,n),ioe(n,e);if(n instanceof RR)return function(o,l){if(!eoe(l.Lu))throw l.Wu(`${o._methodName}() can only be used with update() and set()`);if(!l.path)throw l.Wu(`${o._methodName}() is not currently supported inside arrays`);const d=o._toFieldTransform(l);d&&l.fieldTransforms.push(d)}(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.Qu&&e.Lu!==4)throw e.Wu("Nested arrays are not supported");return function(o,l){const d=[];let p=0;for(const _ of o){let E=nE(_,l.Ku(p));E==null&&(E={nullValue:"NULL_VALUE"}),d.push(E),p++}return{arrayValue:{values:d}}}(n,e)}return function(o,l){if((o=zi(o))===null)return{nullValue:"NULL_VALUE"};if(typeof o=="number")return s3e(l.serializer,o);if(typeof o=="boolean")return{booleanValue:o};if(typeof o=="string")return{stringValue:o};if(o instanceof Date){const d=So.fromDate(o);return{timestampValue:d1(l.serializer,d)}}if(o instanceof So){const d=new So(o.seconds,1e3*Math.floor(o.nanoseconds/1e3));return{timestampValue:d1(l.serializer,d)}}if(o instanceof X4)return{geoPointValue:{latitude:o.latitude,longitude:o.longitude}};if(o instanceof L0)return{bytesValue:bse(l.serializer,o._byteString)};if(o instanceof Za){const d=l.databaseId,p=o.firestore._databaseId;if(!p.isEqual(d))throw l.Wu(`Document reference is for database ${p.projectId}/${p.database} but should be for database ${d.projectId}/${d.database}`);return{referenceValue:N4(o.firestore._databaseId||l.databaseId,o._key.path)}}if(o instanceof J4)return function(p,_){return{mapValue:{fields:{[Jie]:{stringValue:Qie},[o1]:{arrayValue:{values:p.toArray().map(b=>{if(typeof b!="number")throw _.Wu("VectorValues must only contain numeric values.");return A4(_.serializer,b)})}}}}}}(o,l);throw l.Wu(`Unsupported field value: ${vN(o)}`)}(n,e)}function ioe(n,e){const i={};return Hie(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Wg(n,(o,l)=>{const d=nE(l,e.qu(o));d!=null&&(i[o]=d)}),{mapValue:{fields:i}}}function soe(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof So||n instanceof X4||n instanceof L0||n instanceof Za||n instanceof RR||n instanceof J4)}function e3(n,e,i){if(!soe(i)||!function(l){return typeof l=="object"&&l!==null&&(Object.getPrototypeOf(l)===Object.prototype||Object.getPrototypeOf(l)===null)}(i)){const o=vN(i);throw o==="an object"?e.Wu(n+" a custom object"):e.Wu(n+" "+o)}}function fF(n,e,i){if((e=zi(e))instanceof TN)return e._internalPath;if(typeof e=="string")return t3(n,e);throw g1("Field path arguments must be of type string or ",n,!1,void 0,i)}const _Be=new RegExp("[~\\*/\\[\\]]");function t3(n,e,i){if(e.search(_Be)>=0)throw g1(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,i);try{return new TN(...e.split("."))._internalPath}catch{throw g1(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,i)}}function g1(n,e,i,o,l){const d=o&&!o.isEmpty(),p=l!==void 0;let _=`Function ${e}() called with invalid data`;i&&(_+=" (via `toFirestore()`)"),_+=". ";let E="";return(d||p)&&(E+=" (found",d&&(E+=` in field ${o}`),p&&(E+=` in document ${l}`),E+=")"),new Kt(Et.INVALID_ARGUMENT,_+n+E)}function ooe(n,e){return n.some(i=>i.isEqual(e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class n3{constructor(e,i,o,l,d){this._firestore=e,this._userDataWriter=i,this._key=o,this._document=l,this._converter=d}get id(){return this._key.path.lastSegment()}get ref(){return new Za(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new yBe(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const i=this._document.data.field(RN("DocumentSnapshot.get",e));if(i!==null)return this._userDataWriter.convertValue(i)}}}class yBe extends n3{data(){return super.data()}}function RN(n,e){return typeof e=="string"?t3(n,e):e instanceof TN?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function aoe(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new Kt(Et.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class r3{}class IN extends r3{}function _1(n,e,...i){let o=[];e instanceof r3&&o.push(e),o=o.concat(i),function(d){const p=d.filter(E=>E instanceof i3).length,_=d.filter(E=>E instanceof AN).length;if(p>1||p>0&&_>0)throw new Kt(Et.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(o);for(const l of o)n=l._apply(n);return n}class AN extends IN{constructor(e,i,o){super(),this._field=e,this._op=i,this._value=o,this.type="where"}static _create(e,i,o){return new AN(e,i,o)}_apply(e){const i=this._parse(e);return coe(e._query,i),new yf(e.firestore,e.converter,nF(e._query,i))}_parse(e){const i=IR(e.firestore);return function(d,p,_,E,b,C,I){let O;if(b.isKeyField()){if(C==="array-contains"||C==="array-contains-any")throw new Kt(Et.INVALID_ARGUMENT,`Invalid Query. You can't perform '${C}' queries on documentId().`);if(C==="in"||C==="not-in"){sQ(I,C);const V=[];for(const B of I)V.push(iQ(E,d,B));O={arrayValue:{values:V}}}else O=iQ(E,d,I)}else C!=="in"&&C!=="not-in"&&C!=="array-contains-any"||sQ(I,C),O=roe(_,p,I,C==="in"||C==="not-in");return io.create(b,C,O)}(e._query,"where",i,e.firestore._databaseId,this._field,this._op,this._value)}}function rQ(n,e,i){const o=e,l=RN("where",n);return AN._create(l,o,i)}class i3 extends r3{constructor(e,i){super(),this.type=e,this._queryConstraints=i}static _create(e,i){return new i3(e,i)}_parse(e){const i=this._queryConstraints.map(o=>o._parse(e)).filter(o=>o.getFilters().length>0);return i.length===1?i[0]:Fd.create(i,this._getOperator())}_apply(e){const i=this._parse(e);return i.getFilters().length===0?e:(function(l,d){let p=l;const _=d.getFlattenedFilters();for(const E of _)coe(p,E),p=nF(p,E)}(e._query,i),new yf(e.firestore,e.converter,nF(e._query,i)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}class s3 extends IN{constructor(e,i){super(),this._field=e,this._direction=i,this.type="orderBy"}static _create(e,i){return new s3(e,i)}_apply(e){const i=function(l,d,p){if(l.startAt!==null)throw new Kt(Et.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(l.endAt!==null)throw new Kt(Et.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new KC(d,p)}(e._query,this._field,this._direction);return new yf(e.firestore,e.converter,function(l,d){const p=l.explicitOrderBy.concat([d]);return new Zy(l.path,l.collectionGroup,p,l.filters.slice(),l.limit,l.limitType,l.startAt,l.endAt)}(e._query,i))}}function EBe(n,e="asc"){const i=e,o=RN("orderBy",n);return s3._create(o,i)}class o3 extends IN{constructor(e,i,o){super(),this.type=e,this._limit=i,this._limitType=o}static _create(e,i,o){return new o3(e,i,o)}_apply(e){return new yf(e.firestore,e.converter,c1(e._query,this._limit,this._limitType))}}function vBe(n){return o3._create("limit",n,"F")}class a3 extends IN{constructor(e,i,o){super(),this.type=e,this._docOrFields=i,this._inclusive=o}static _create(e,i,o){return new a3(e,i,o)}_apply(e){const i=bBe(e,this.type,this._docOrFields,this._inclusive);return new yf(e.firestore,e.converter,function(l,d){return new Zy(l.path,l.collectionGroup,l.explicitOrderBy.slice(),l.filters.slice(),l.limit,l.limitType,d,l.endAt)}(e._query,i))}}function SBe(...n){return a3._create("startAt",n,!0)}function bBe(n,e,i,o){if(i[0]=zi(i[0]),i[0]instanceof n3)return function(d,p,_,E,b){if(!E)throw new Kt(Et.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${_}().`);const C=[];for(const I of l0(d))if(I.field.isKeyField())C.push(a1(p,E.key));else{const O=E.data.field(I.field);if(lN(O))throw new Kt(Et.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+I.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(O===null){const L=I.field.canonicalString();throw new Kt(Et.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${L}' (used as the orderBy) does not exist.`)}C.push(O)}return new O0(C,b)}(n._query,n.firestore._databaseId,e,i[0]._document,o);{const l=IR(n.firestore);return function(p,_,E,b,C,I){const O=p.explicitOrderBy;if(C.length>O.length)throw new Kt(Et.INVALID_ARGUMENT,`Too many arguments provided to ${b}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const L=[];for(let V=0;V<C.length;V++){const B=C[V];if(O[V].field.isKeyField()){if(typeof B!="string")throw new Kt(Et.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${b}(), but got a ${typeof B}`);if(!I4(p)&&B.indexOf("/")!==-1)throw new Kt(Et.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${b}() must be a plain document ID, but '${B}' contains a slash.`);const W=p.path.child(Wi.fromString(B));if(!Sn.isDocumentKey(W))throw new Kt(Et.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${b}() must result in a valid document path, but '${W}' is not because it contains an odd number of segments.`);const Z=new Sn(W);L.push(a1(_,Z))}else{const W=roe(E,b,B);L.push(W)}}return new O0(L,I)}(n._query,n.firestore._databaseId,l,e,i,o)}}function iQ(n,e,i){if(typeof(i=zi(i))=="string"){if(i==="")throw new Kt(Et.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!I4(e)&&i.indexOf("/")!==-1)throw new Kt(Et.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${i}' contains a '/' character.`);const o=e.path.child(Wi.fromString(i));if(!Sn.isDocumentKey(o))throw new Kt(Et.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${o}' is not because it has an odd number of segments (${o.length}).`);return a1(n,new Sn(o))}if(i instanceof Za)return a1(n,i._key);throw new Kt(Et.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${vN(i)}.`)}function sQ(n,e){if(!Array.isArray(n)||n.length===0)throw new Kt(Et.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function coe(n,e){const i=function(l,d){for(const p of l)for(const _ of p.getFlattenedFilters())if(d.indexOf(_.op)>=0)return _.op;return null}(n.filters,function(l){switch(l){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(i!==null)throw i===e.op?new Kt(Et.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new Kt(Et.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${i.toString()}' filters.`)}class TBe{convertValue(e,i="none"){switch(xg(e)){case 0:return null;case 1:return e.booleanValue;case 2:return $s(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,i);case 5:return e.stringValue;case 6:return this.convertBytes(Dg(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,i);case 11:return this.convertObject(e.mapValue,i);case 10:return this.convertVectorValue(e.mapValue);default:throw $n()}}convertObject(e,i){return this.convertObjectMap(e.fields,i)}convertObjectMap(e,i="none"){const o={};return Wg(e,(l,d)=>{o[l]=this.convertValue(d,i)}),o}convertVectorValue(e){var i,o,l;const d=(l=(o=(i=e.fields)===null||i===void 0?void 0:i[o1].arrayValue)===null||o===void 0?void 0:o.values)===null||l===void 0?void 0:l.map(p=>$s(p.doubleValue));return new J4(d)}convertGeoPoint(e){return new X4($s(e.latitude),$s(e.longitude))}convertArray(e,i){return(e.values||[]).map(o=>this.convertValue(o,i))}convertServerTimestamp(e,i){switch(i){case"previous":const o=uN(e);return o==null?null:this.convertValue(o,i);case"estimate":return this.convertTimestamp(GC(e));default:return null}}convertTimestamp(e){const i=Ng(e);return new So(i.seconds,i.nanos)}convertDocumentKey(e,i){const o=Wi.fromString(e);mi(Ase(o));const l=new HC(o.get(1),o.get(3)),d=new Sn(o.popFirst(5));return l.isEqual(i)||Kp(`Document ${d} contains a document reference within a different database (${l.projectId}/${l.database}) which is not supported. It will be treated as a reference in the current database (${i.projectId}/${i.database}) instead.`),d}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function loe(n,e,i){let o;return o=n?i&&(i.merge||i.mergeFields)?n.toFirestore(e,i):n.toFirestore(e):e,o}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qw{constructor(e,i){this.hasPendingWrites=e,this.fromCache=i}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class uoe extends n3{constructor(e,i,o,l,d,p){super(e,i,o,l,p),this._firestore=e,this._firestoreImpl=e,this.metadata=d}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const i=new Pk(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(i,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,i={}){if(this._document){const o=this._document.data.field(RN("DocumentSnapshot.get",e));if(o!==null)return this._userDataWriter.convertValue(o,i.serverTimestamps)}}}class Pk extends uoe{data(e={}){return super.data(e)}}class doe{constructor(e,i,o,l){this._firestore=e,this._userDataWriter=i,this._snapshot=l,this.metadata=new Qw(l.hasPendingWrites,l.fromCache),this.query=o}get docs(){const e=[];return this.forEach(i=>e.push(i)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,i){this._snapshot.docs.forEach(o=>{e.call(i,new Pk(this._firestore,this._userDataWriter,o.key,o,new Qw(this._snapshot.mutatedKeys.has(o.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const i=!!e.includeMetadataChanges;if(i&&this._snapshot.excludesMetadataChanges)throw new Kt(Et.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===i||(this._cachedChanges=function(l,d){if(l._snapshot.oldDocs.isEmpty()){let p=0;return l._snapshot.docChanges.map(_=>{const E=new Pk(l._firestore,l._userDataWriter,_.doc.key,_.doc,new Qw(l._snapshot.mutatedKeys.has(_.doc.key),l._snapshot.fromCache),l.query.converter);return _.doc,{type:"added",doc:E,oldIndex:-1,newIndex:p++}})}{let p=l._snapshot.oldDocs;return l._snapshot.docChanges.filter(_=>d||_.type!==3).map(_=>{const E=new Pk(l._firestore,l._userDataWriter,_.doc.key,_.doc,new Qw(l._snapshot.mutatedKeys.has(_.doc.key),l._snapshot.fromCache),l.query.converter);let b=-1,C=-1;return _.type!==0&&(b=p.indexOf(_.doc.key),p=p.delete(_.doc.key)),_.type!==1&&(p=p.add(_.doc),C=p.indexOf(_.doc.key)),{type:wBe(_.type),doc:E,oldIndex:b,newIndex:C}})}}(this,i),this._cachedChangesIncludeMetadataChanges=i),this._cachedChanges}}function wBe(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return $n()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function To(n){n=dl(n,Za);const e=dl(n.firestore,Xp);return aBe(bN(e),n._key).then(i=>foe(e,n,i))}class c3 extends TBe{constructor(e){super(),this.firestore=e}convertBytes(e){return new L0(e)}convertReference(e){const i=this.convertDocumentKey(e,this.firestore._databaseId);return new Za(this.firestore,null,i)}}function Ky(n){n=dl(n,yf);const e=dl(n.firestore,Xp),i=bN(e),o=new c3(e);return aoe(n._query),cBe(i,n._query).then(l=>new doe(e,o,n,l))}function M0(n,e,i){n=dl(n,Za);const o=dl(n.firestore,Xp),l=loe(n.converter,e,i);return PN(o,[toe(IR(o),"setDoc",n._key,l,n.converter!==null,i).toMutation(n._key,Lu.none())])}function Co(n,e,i,...o){n=dl(n,Za);const l=dl(n.firestore,Xp),d=IR(l);let p;return p=typeof(e=zi(e))=="string"||e instanceof TN?gBe(d,"updateDoc",n._key,e,i,o):mBe(d,"updateDoc",n._key,e),PN(l,[p.toMutation(n._key,Lu.exists(!0))])}function CBe(n){return PN(dl(n.firestore,Xp),[new P4(n._key,Lu.none())])}function RBe(n,e){const i=dl(n.firestore,Xp),o=$r(n),l=loe(n.converter,e);return PN(i,[toe(IR(n.firestore),"addDoc",o._key,l,n.converter!==null,{}).toMutation(o._key,Lu.exists(!1))]).then(()=>o)}function hoe(n,...e){var i,o,l;n=zi(n);let d={includeMetadataChanges:!1,source:"default"},p=0;typeof e[p]!="object"||nQ(e[p])||(d=e[p],p++);const _={includeMetadataChanges:d.includeMetadataChanges,source:d.source};if(nQ(e[p])){const I=e[p];e[p]=(i=I.next)===null||i===void 0?void 0:i.bind(I),e[p+1]=(o=I.error)===null||o===void 0?void 0:o.bind(I),e[p+2]=(l=I.complete)===null||l===void 0?void 0:l.bind(I)}let E,b,C;if(n instanceof Za)b=dl(n.firestore,Xp),C=dN(n._key.path),E={next:I=>{e[p]&&e[p](foe(b,n,I))},error:e[p+1],complete:e[p+2]};else{const I=dl(n,yf);b=dl(I.firestore,Xp),C=I._query;const O=new c3(b);E={next:L=>{e[p]&&e[p](new doe(b,O,I,L))},error:e[p+1],complete:e[p+2]},aoe(n._query)}return function(O,L,V,B){const W=new Y4(B),Z=new $4(L,W,V);return O.asyncQueue.enqueueAndForget(async()=>z4(await m1(O),Z)),()=>{W.su(),O.asyncQueue.enqueueAndForget(async()=>G4(await m1(O),Z))}}(bN(b),C,_,E)}function PN(n,e){return function(o,l){const d=new Vp;return o.asyncQueue.enqueueAndForget(async()=>Y5e(await oBe(o),l,d)),d.promise}(bN(n),e)}function foe(n,e,i){const o=i.docs.get(e._key),l=new c3(n);return new uoe(n,l,e._key,o,new Qw(i.hasPendingWrites,i.fromCache),e.converter)}function IBe(...n){return new Q4("arrayUnion",n)}function ABe(...n){return new Z4("arrayRemove",n)}(function(e,i=!0){(function(l){q0=l})(Qy),Wy(new Og("firestore",(o,{instanceIdentifier:l,options:d})=>{const p=o.getProvider("app").getImmediate(),_=new Xp(new E4e(o.getProvider("auth-internal")),new b4e(p,o.getProvider("app-check-internal")),function(b,C){if(!Object.prototype.hasOwnProperty.apply(b.options,["projectId"]))throw new Kt(Et.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new HC(b.options.projectId,C)}(p,l),p);return d=Object.assign({useFetchStreams:i},d),_._setSettings(d),_},"PUBLIC").setMultipleInstances(!0)),af(aJ,cJ,e),af(aJ,cJ,"esm2017")})();var PBe="firebase",OBe="11.5.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */af(PBe,OBe,"app");const kBe=[{key:"VITE_FIREBASE_API_KEY",value:void 0},{key:"VITE_FIREBASE_AUTH_DOMAIN",value:void 0},{key:"VITE_FIREBASE_PROJECT_ID",value:void 0},{key:"VITE_FIREBASE_STORAGE_BUCKET",value:void 0},{key:"VITE_FIREBASE_MESSAGING_SENDER_ID",value:void 0},{key:"VITE_FIREBASE_APP_ID",value:void 0}],pF=kBe.filter(n=>!n.value);if(pF.length>0){const e=`Missing environment variables: ${pF.map(i=>i.key).join(", ")}. Using fallback values. For production, it's recommended to set up your .env file.`;Y.warn(e),console.warn(e)}const NBe={apiKey:"AIzaSyCaxoNKRIMaXhotGzdAjXc5gkARoqtS3bU",authDomain:"disruptive-metaverse.firebaseapp.com",projectId:"disruptive-metaverse",storageBucket:"disruptive-metaverse.appspot.com",messagingSenderId:"294433070603",appId:"1:294433070603:web:136cddd196eea9614fb10e"},DBe=pF.length>0;Y.log(`Firebase initializing with ${DBe?"fallback":"environment"} configuration`);let OU,l3,gr;try{OU=Yre(NBe),l3=oN(OU),gr=hF(OU),Y.log("Firebase initialized successfully")}catch(n){Y.error("Failed to initialize Firebase:",n),console.error("Failed to initialize Firebase:",n)}const oQ=(n,e)=>{const o=(n+e.charAt(0)).toLowerCase().replace(/[^a-z0-9]/g,"").substring(0,11),l=Math.floor(1e3+Math.random()*9e3);return o+l},qC=async n=>{try{if(!n||typeof n!="string"||n.trim()==="")return Y.error("userFirestore: Invalid username provided to isUsernameTaken"),!0;const e=n.toLowerCase().trim();Y.log(`userFirestore: Checking if username "${e}" is taken`);const i=Yp(gr,"users"),o=_1(i,vBe(100)),l=await Ky(o);let d=!1;return l.forEach(p=>{const _=p.data();_.username&&_.username.toLowerCase()===e&&(d=!0)}),Y.log(`userFirestore: Username "${e}" is ${d?"taken":"available"}`),d}catch(e){return Y.error("userFirestore: Error checking username availability:",e),!0}},xBe=async(n,e)=>{let i=oQ(n,e),o=0;const l=5;for(;o<l;){if(!await qC(i))return i;i=oQ(n,e),o++}return i+Math.floor(Math.random()*100)},Fu=async n=>{try{Y.log("userFirestore: Get user PUBLIC profile data for user ID: "+n);const e=$r(gr,"users",n),i=await To(e);if(i.exists()){const o=i.data();return Y.log("userFirestore: Found PUBLIC Profile for : "+o.Nickname),delete o.email,delete o.emailVerified,o}else return Y.error("userFirestore: user profile document not found"),null}catch(e){throw Y.error("userFirestore: Error fetching user public profile data:",e),e}},LBe=async(n,e,i)=>{try{if(Y.log("userFirestore: Starting registerUser process"),Y.log("userFirestore: Fields in additionalData:",Object.keys(i||{}).join(", ")),!i)throw Y.error("userFirestore: additionalData is null or undefined"),new Error("Registration data is missing");const o={firstName:i.firstName||"",lastName:i.lastName||"",companyName:i.companyName||"",linkedInProfile:i.linkedInProfile||"",username:i.username||"",Nickname:i.Nickname||"",rpmURL:i.rpmURL||"https://models.readyplayer.me/67c8408d38f7924e15a8bd0a.glb"};Y.log("userFirestore: Critical fields captured for registration"),Y.log("userFirestore: Creating user auth record");const d=(await eje(l3,n,e)).user;await wie(d),Y.log("userFirestore: Verification email sent"),Y.log("userFirestore: Waiting for Cloud Function to create initial document..."),await new Promise(L=>setTimeout(L,5e3));const p=$r(gr,"users",d.uid),_=await To(p);if(_.exists()){Y.log("userFirestore: Found document created by Cloud Function, updating with missing fields");const L=_.data(),V={};L.firstName||(V.firstName=o.firstName),L.lastName||(V.lastName=o.lastName),L.Nickname||(V.Nickname=o.Nickname),L.username||(V.username=o.username),L.companyName||(V.companyName=o.companyName),L.linkedInProfile||(V.linkedInProfile=o.linkedInProfile),L.rpmURL||(V.rpmURL=o.rpmURL),Object.keys(V).length>0&&(Y.log("userFirestore: Updating document with fields:",Object.keys(V).join(", ")),await Co(p,{...V,lastUpdated:new Date}))}else{Y.error("userFirestore: Cloud Function failed to create user document, creating manually"),await M0(p,{...o,id:d.uid,groups:["users"],createdAt:new Date,lastUpdated:new Date});const L=$r(gr,"users",d.uid,"private","data");await M0(L,{email:d.email,emailVerified:!1})}const E=await To(p);if(!E.exists())throw new Error("User document does not exist even after creation attempts");let b=E.data();b.firstName||(b.firstName=o.firstName),b.lastName||(b.lastName=o.lastName),b.Nickname||(b.Nickname=o.Nickname),b.username||(b.username=o.username),b.companyName||(b.companyName=o.companyName);let C=!1,I={};for(const L in o)(!b[L]||b[L]==="")&&(I[L]=o[L],C=!0);(!b.groups||!b.groups.includes("users"))&&(I.groups=b.groups?[...b.groups,"users"]:["users"],C=!0,Y.log("userFirestore: Adding user to users group")),C&&(Y.log("userFirestore: Updating user document with missing fields"),Y.log("userFirestore: Fields being updated:",Object.keys(I).join(", ")),await Co(p,I),b=(await To(p)).data());const O={...d,...b,firstName:o.firstName,lastName:o.lastName,Nickname:o.Nickname,username:o.username,companyName:o.companyName,linkedInProfile:o.linkedInProfile};return Y.log("userFirestore: Registration complete, returning user data"),Y.log("userFirestore: Fields included in return data:",Object.keys(O).join(", ")),O}catch(o){throw Y.error("userFirestore: Error creating user:",o),o}},poe=async(n,e)=>{try{Y.log(`userFirestore: Updating rpmURL for user ID: ${n}`);const i=$r(gr,"users",n);await Co(i,{rpmURL:e,lastUpdated:new Date().toISOString()}),Y.log("userFirestore: rpmURL updated successfully.")}catch(i){throw Y.error("userFirestore: Error updating rpmURL:",i),i}},MBe=async(n,e)=>{try{const i=await Fu(n);return i&&i.groups?i.groups.includes(e):!1}catch(i){return Y.error("userFirestore: Error checking group membership:",i),!1}},UBe=async(n,e)=>{try{if(Y.log(`userFirestore: Updating username for user ${n} to ${e}`),!e||e.trim()==="")throw Y.error("userFirestore: Cannot update to empty username"),new Error("Username cannot be empty");if(!/^[a-z0-9]{1,15}$/.test(e))throw Y.error("userFirestore: Invalid username format"),new Error("Username must be 1-15 characters, lowercase letters and numbers only");const i=$r(gr,"users",n),o=await To(i);if(!o.exists())throw Y.error(`userFirestore: User ${n} not found when updating username`),new Error("User not found");if(o.data().username===e)return Y.log(`userFirestore: Username is already set to ${e}, no update needed`),!0;if(await qC(e))throw Y.error(`userFirestore: Username ${e} is already taken`),new Error("Username is already taken");await Co(i,{username:e,lastUpdated:new Date().toISOString()});const p=await To(i);if(p.exists()){if(p.data().username===e)return Y.log(`userFirestore: Username successfully updated to ${e} for user ${n}`),!0;throw Y.error(`userFirestore: Username verification failed after update for ${n}`),new Error("Username update verification failed")}else throw Y.error(`userFirestore: User document not found after username update for ${n}`),new Error("User document not found after update")}catch(i){throw Y.error("userFirestore: Error updating username:",i),i}};var VBe={};const y1=()=>{const n=typeof process<"u"&&VBe&&!1;return typeof window<"u"&&new URLSearchParams(window.location.search).has("dev_mode"),n},FBe=(n,e)=>{if(!y1())return Y.warn(" SECURITY WARNING: Permission override attempted outside of development environment"),!1},jBe=(n,e)=>{if(!y1())return Y.warn(" SECURITY WARNING: Permission override attempted outside of development environment"),!1},u3=typeof y1=="function"?y1():!1;u3&&Y.warn(" SECURITY WARNING: Permission overrides are ENABLED. This should only happen in development.");const BBe=async(n,e)=>{if(u3)return FBe();if(!n||!n.uid)return!1;try{if(n.groups){const l=`space_${e}_owners`;if(n.groups.includes(l))return console.log(`User ${n.uid} is an owner via groups property`),!0}const o=oN().currentUser;if(o&&o.uid===n.uid)try{const d=(await o.getIdTokenResult(!0)).claims.groups||[],p=`space_${e}_owners`;if(d.includes(p))return console.log(`User ${n.uid} is an owner via Firebase token claims`),!0}catch(l){console.error("Error getting token result:",l)}return!1}catch(i){return Y.error("Error checking space owner permissions:",i),!1}},moe=async(n,e)=>{if(u3)return jBe();try{if(Y.log(`userPermissions: Checking if user ${n} belongs to group ${e}`),e==="users")return Y.log(`userPermissions: TESTING MODE - Always allowing access to 'users' group for user ${n}`),!0;if(n){const i=await Fu(n);if(Y.log(`userPermissions: User profile for ${n}:`,i),i&&i.groups&&Array.isArray(i.groups)){if(Y.log(`userPermissions: User ${n} has groups:`,i.groups),i.groups.includes(e))return Y.log(`userPermissions: User ${n} belongs to group ${e} (from user document)`),!0}else Y.log(`userPermissions: User ${n} has no groups or groups is not an array`);if(e==="disruptiveAdmin")try{const l=oN().currentUser;if(l&&l.uid===n){const d=await l.getIdTokenResult();if(Y.log(`userPermissions: Token claims for ${n}:`,d.claims),d.claims&&d.claims.groups&&Array.isArray(d.claims.groups)&&d.claims.groups.includes(e))return Y.log(`userPermissions: User ${n} belongs to group ${e} (from token claims)`),!0}}catch(o){Y.error("userPermissions: Error checking token claims:",o)}}return Y.log(`userPermissions: User ${n} does not belong to group ${e}`),!1}catch(i){return Y.error("userPermissions: Error checking if user belongs to group:",i),!1}},WBe=["email","name","rpmURL","Nickname","username","created_on","height_cm","companyName","firstName","lastName","linkedInProfile","groups"],Md={sendUserToUnity:"sendUserToUnity"};class zBe{constructor(){this.events={}}subscribe(e,i){this.events[e]||(this.events[e]=[]),this.events[e].push(i)}publish(e,i){const o=this.events[e];o?(o.forEach(l=>{l(i)}),Y.log(`EventBus: Published event '${e}'`)):Y.log(`EventBus: No subscribers for event '${e}'`)}unsubscribe(e,i){var l;const o=(l=this.events[e])==null?void 0:l.indexOf(i);o>-1&&this.events[e].splice(o,1)}}const Ud=new zBe;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const goe="firebasestorage.googleapis.com",_oe="storageBucket",GBe=2*60*1e3,HBe=10*60*1e3;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Us extends _f{constructor(e,i,o=0){super(kU(e),`Firebase Storage: ${i} (${kU(e)})`),this.status_=o,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,Us.prototype)}get status(){return this.status_}set status(e){this.status_=e}_codeEquals(e){return kU(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message=`${this._baseMessage}
${this.customData.serverResponse}`:this.message=this._baseMessage}}var Ms;(function(n){n.UNKNOWN="unknown",n.OBJECT_NOT_FOUND="object-not-found",n.BUCKET_NOT_FOUND="bucket-not-found",n.PROJECT_NOT_FOUND="project-not-found",n.QUOTA_EXCEEDED="quota-exceeded",n.UNAUTHENTICATED="unauthenticated",n.UNAUTHORIZED="unauthorized",n.UNAUTHORIZED_APP="unauthorized-app",n.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",n.INVALID_CHECKSUM="invalid-checksum",n.CANCELED="canceled",n.INVALID_EVENT_NAME="invalid-event-name",n.INVALID_URL="invalid-url",n.INVALID_DEFAULT_BUCKET="invalid-default-bucket",n.NO_DEFAULT_BUCKET="no-default-bucket",n.CANNOT_SLICE_BLOB="cannot-slice-blob",n.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",n.NO_DOWNLOAD_URL="no-download-url",n.INVALID_ARGUMENT="invalid-argument",n.INVALID_ARGUMENT_COUNT="invalid-argument-count",n.APP_DELETED="app-deleted",n.INVALID_ROOT_OPERATION="invalid-root-operation",n.INVALID_FORMAT="invalid-format",n.INTERNAL_ERROR="internal-error",n.UNSUPPORTED_ENVIRONMENT="unsupported-environment"})(Ms||(Ms={}));function kU(n){return"storage/"+n}function d3(){const n="An unknown error occurred, please check the error payload for server response.";return new Us(Ms.UNKNOWN,n)}function $Be(n){return new Us(Ms.OBJECT_NOT_FOUND,"Object '"+n+"' does not exist.")}function KBe(n){return new Us(Ms.QUOTA_EXCEEDED,"Quota for bucket '"+n+"' exceeded, please view quota on https://firebase.google.com/pricing/.")}function qBe(){const n="User is not authenticated, please authenticate using Firebase Authentication and try again.";return new Us(Ms.UNAUTHENTICATED,n)}function YBe(){return new Us(Ms.UNAUTHORIZED_APP,"This app does not have permission to access Firebase Storage on this project.")}function XBe(n){return new Us(Ms.UNAUTHORIZED,"User does not have permission to access '"+n+"'.")}function JBe(){return new Us(Ms.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function QBe(){return new Us(Ms.CANCELED,"User canceled the upload/download.")}function ZBe(n){return new Us(Ms.INVALID_URL,"Invalid URL '"+n+"'.")}function e6e(n){return new Us(Ms.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+n+"'.")}function t6e(){return new Us(Ms.NO_DEFAULT_BUCKET,"No default bucket found. Did you set the '"+_oe+"' property when initializing the app?")}function n6e(){return new Us(Ms.CANNOT_SLICE_BLOB,"Cannot slice blob for upload. Please retry the upload.")}function r6e(){return new Us(Ms.NO_DOWNLOAD_URL,"The given file does not have any download URLs.")}function i6e(n){return new Us(Ms.UNSUPPORTED_ENVIRONMENT,`${n} is missing. Make sure to install the required polyfills. See https://firebase.google.com/docs/web/environments-js-sdk#polyfills for more information.`)}function mF(n){return new Us(Ms.INVALID_ARGUMENT,n)}function yoe(){return new Us(Ms.APP_DELETED,"The Firebase app was deleted.")}function s6e(n){return new Us(Ms.INVALID_ROOT_OPERATION,"The operation '"+n+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}function _C(n,e){return new Us(Ms.INVALID_FORMAT,"String does not match format '"+n+"': "+e)}function bw(n){throw new Us(Ms.INTERNAL_ERROR,"Internal error: "+n)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vl{constructor(e,i){this.bucket=e,this.path_=i}get path(){return this.path_}get isRoot(){return this.path.length===0}fullServerUrl(){const e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(e,i){let o;try{o=Vl.makeFromUrl(e,i)}catch{return new Vl(e,"")}if(o.path==="")return o;throw e6e(e)}static makeFromUrl(e,i){let o=null;const l="([A-Za-z0-9.\\-_]+)";function d(ue){ue.path.charAt(ue.path.length-1)==="/"&&(ue.path_=ue.path_.slice(0,-1))}const p="(/(.*))?$",_=new RegExp("^gs://"+l+p,"i"),E={bucket:1,path:3};function b(ue){ue.path_=decodeURIComponent(ue.path)}const C="v[A-Za-z0-9_]+",I=i.replace(/[.]/g,"\\."),O="(/([^?#]*).*)?$",L=new RegExp(`^https?://${I}/${C}/b/${l}/o${O}`,"i"),V={bucket:1,path:3},B=i===goe?"(?:storage.googleapis.com|storage.cloud.google.com)":i,W="([^?#]*)",Z=new RegExp(`^https?://${B}/${l}/${W}`,"i"),se=[{regex:_,indices:E,postModify:d},{regex:L,indices:V,postModify:b},{regex:Z,indices:{bucket:1,path:2},postModify:b}];for(let ue=0;ue<se.length;ue++){const re=se[ue],pe=re.regex.exec(e);if(pe){const q=pe[re.indices.bucket];let Q=pe[re.indices.path];Q||(Q=""),o=new Vl(q,Q),re.postModify(o);break}}if(o==null)throw ZBe(e);return o}}class o6e{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(e=!1){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function a6e(n,e,i){let o=1,l=null,d=null,p=!1,_=0;function E(){return _===2}let b=!1;function C(...W){b||(b=!0,e.apply(null,W))}function I(W){l=setTimeout(()=>{l=null,n(L,E())},W)}function O(){d&&clearTimeout(d)}function L(W,...Z){if(b){O();return}if(W){O(),C.call(null,W,...Z);return}if(E()||p){O(),C.call(null,W,...Z);return}o<64&&(o*=2);let se;_===1?(_=2,se=0):se=(o+Math.random())*1e3,I(se)}let V=!1;function B(W){V||(V=!0,O(),!b&&(l!==null?(W||(_=2),clearTimeout(l),I(0)):W||(_=1)))}return I(0),d=setTimeout(()=>{p=!0,B(!0)},i),B}function c6e(n){n(!1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function l6e(n){return n!==void 0}function u6e(n){return typeof n=="object"&&!Array.isArray(n)}function h3(n){return typeof n=="string"||n instanceof String}function aQ(n){return f3()&&n instanceof Blob}function f3(){return typeof Blob<"u"}function cQ(n,e,i,o){if(o<e)throw mF(`Invalid value for '${n}'. Expected ${e} or greater.`);if(o>i)throw mF(`Invalid value for '${n}'. Expected ${i} or less.`)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ON(n,e,i){let o=e;return i==null&&(o=`https://${e}`),`${i}://${o}/v0${n}`}function Eoe(n){const e=encodeURIComponent;let i="?";for(const o in n)if(n.hasOwnProperty(o)){const l=e(o)+"="+e(n[o]);i=i+l+"&"}return i=i.slice(0,-1),i}var Ly;(function(n){n[n.NO_ERROR=0]="NO_ERROR",n[n.NETWORK_ERROR=1]="NETWORK_ERROR",n[n.ABORT=2]="ABORT"})(Ly||(Ly={}));/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function d6e(n,e){const i=n>=500&&n<600,l=[408,429].indexOf(n)!==-1,d=e.indexOf(n)!==-1;return i||l||d}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class h6e{constructor(e,i,o,l,d,p,_,E,b,C,I,O=!0){this.url_=e,this.method_=i,this.headers_=o,this.body_=l,this.successCodes_=d,this.additionalRetryCodes_=p,this.callback_=_,this.errorCallback_=E,this.timeout_=b,this.progressCallback_=C,this.connectionFactory_=I,this.retry=O,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((L,V)=>{this.resolve_=L,this.reject_=V,this.start_()})}start_(){const e=(o,l)=>{if(l){o(!1,new BO(!1,null,!0));return}const d=this.connectionFactory_();this.pendingConnection_=d;const p=_=>{const E=_.loaded,b=_.lengthComputable?_.total:-1;this.progressCallback_!==null&&this.progressCallback_(E,b)};this.progressCallback_!==null&&d.addUploadProgressListener(p),d.send(this.url_,this.method_,this.body_,this.headers_).then(()=>{this.progressCallback_!==null&&d.removeUploadProgressListener(p),this.pendingConnection_=null;const _=d.getErrorCode()===Ly.NO_ERROR,E=d.getStatus();if(!_||d6e(E,this.additionalRetryCodes_)&&this.retry){const C=d.getErrorCode()===Ly.ABORT;o(!1,new BO(!1,null,C));return}const b=this.successCodes_.indexOf(E)!==-1;o(!0,new BO(b,d))})},i=(o,l)=>{const d=this.resolve_,p=this.reject_,_=l.connection;if(l.wasSuccessCode)try{const E=this.callback_(_,_.getResponse());l6e(E)?d(E):d()}catch(E){p(E)}else if(_!==null){const E=d3();E.serverResponse=_.getErrorText(),this.errorCallback_?p(this.errorCallback_(_,E)):p(E)}else if(l.canceled){const E=this.appDelete_?yoe():QBe();p(E)}else{const E=JBe();p(E)}};this.canceled_?i(!1,new BO(!1,null,!0)):this.backoffId_=a6e(e,i,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,this.backoffId_!==null&&c6e(this.backoffId_),this.pendingConnection_!==null&&this.pendingConnection_.abort()}}class BO{constructor(e,i,o){this.wasSuccessCode=e,this.connection=i,this.canceled=!!o}}function f6e(n,e){e!==null&&e.length>0&&(n.Authorization="Firebase "+e)}function p6e(n,e){n["X-Firebase-Storage-Version"]="webjs/"+(e??"AppManager")}function m6e(n,e){e&&(n["X-Firebase-GMPID"]=e)}function g6e(n,e){e!==null&&(n["X-Firebase-AppCheck"]=e)}function _6e(n,e,i,o,l,d,p=!0){const _=Eoe(n.urlParams),E=n.url+_,b=Object.assign({},n.headers);return m6e(b,e),f6e(b,i),p6e(b,d),g6e(b,o),new h6e(E,n.method,b,n.body,n.successCodes,n.additionalRetryCodes,n.handler,n.errorHandler,n.timeout,n.progressCallback,l,p)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function y6e(){return typeof BlobBuilder<"u"?BlobBuilder:typeof WebKitBlobBuilder<"u"?WebKitBlobBuilder:void 0}function E6e(...n){const e=y6e();if(e!==void 0){const i=new e;for(let o=0;o<n.length;o++)i.append(n[o]);return i.getBlob()}else{if(f3())return new Blob(n);throw new Us(Ms.UNSUPPORTED_ENVIRONMENT,"This browser doesn't seem to support creating Blobs")}}function v6e(n,e,i){return n.webkitSlice?n.webkitSlice(e,i):n.mozSlice?n.mozSlice(e,i):n.slice?n.slice(e,i):null}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function S6e(n){if(typeof atob>"u")throw i6e("base-64");return atob(n)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Xh={RAW:"raw",BASE64:"base64",BASE64URL:"base64url",DATA_URL:"data_url"};class NU{constructor(e,i){this.data=e,this.contentType=i||null}}function b6e(n,e){switch(n){case Xh.RAW:return new NU(voe(e));case Xh.BASE64:case Xh.BASE64URL:return new NU(Soe(n,e));case Xh.DATA_URL:return new NU(w6e(e),C6e(e))}throw d3()}function voe(n){const e=[];for(let i=0;i<n.length;i++){let o=n.charCodeAt(i);if(o<=127)e.push(o);else if(o<=2047)e.push(192|o>>6,128|o&63);else if((o&64512)===55296)if(!(i<n.length-1&&(n.charCodeAt(i+1)&64512)===56320))e.push(239,191,189);else{const d=o,p=n.charCodeAt(++i);o=65536|(d&1023)<<10|p&1023,e.push(240|o>>18,128|o>>12&63,128|o>>6&63,128|o&63)}else(o&64512)===56320?e.push(239,191,189):e.push(224|o>>12,128|o>>6&63,128|o&63)}return new Uint8Array(e)}function T6e(n){let e;try{e=decodeURIComponent(n)}catch{throw _C(Xh.DATA_URL,"Malformed data URL.")}return voe(e)}function Soe(n,e){switch(n){case Xh.BASE64:{const l=e.indexOf("-")!==-1,d=e.indexOf("_")!==-1;if(l||d)throw _C(n,"Invalid character '"+(l?"-":"_")+"' found: is it base64url encoded?");break}case Xh.BASE64URL:{const l=e.indexOf("+")!==-1,d=e.indexOf("/")!==-1;if(l||d)throw _C(n,"Invalid character '"+(l?"+":"/")+"' found: is it base64 encoded?");e=e.replace(/-/g,"+").replace(/_/g,"/");break}}let i;try{i=S6e(e)}catch(l){throw l.message.includes("polyfill")?l:_C(n,"Invalid character found")}const o=new Uint8Array(i.length);for(let l=0;l<i.length;l++)o[l]=i.charCodeAt(l);return o}class boe{constructor(e){this.base64=!1,this.contentType=null;const i=e.match(/^data:([^,]+)?,/);if(i===null)throw _C(Xh.DATA_URL,"Must be formatted 'data:[<mediatype>][;base64],<data>");const o=i[1]||null;o!=null&&(this.base64=R6e(o,";base64"),this.contentType=this.base64?o.substring(0,o.length-7):o),this.rest=e.substring(e.indexOf(",")+1)}}function w6e(n){const e=new boe(n);return e.base64?Soe(Xh.BASE64,e.rest):T6e(e.rest)}function C6e(n){return new boe(n).contentType}function R6e(n,e){return n.length>=e.length?n.substring(n.length-e.length)===e:!1}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yg{constructor(e,i){let o=0,l="";aQ(e)?(this.data_=e,o=e.size,l=e.type):e instanceof ArrayBuffer?(i?this.data_=new Uint8Array(e):(this.data_=new Uint8Array(e.byteLength),this.data_.set(new Uint8Array(e))),o=this.data_.length):e instanceof Uint8Array&&(i?this.data_=e:(this.data_=new Uint8Array(e.length),this.data_.set(e)),o=e.length),this.size_=o,this.type_=l}size(){return this.size_}type(){return this.type_}slice(e,i){if(aQ(this.data_)){const o=this.data_,l=v6e(o,e,i);return l===null?null:new yg(l)}else{const o=new Uint8Array(this.data_.buffer,e,i-e);return new yg(o,!0)}}static getBlob(...e){if(f3()){const i=e.map(o=>o instanceof yg?o.data_:o);return new yg(E6e.apply(null,i))}else{const i=e.map(p=>h3(p)?b6e(Xh.RAW,p).data:p.data_);let o=0;i.forEach(p=>{o+=p.byteLength});const l=new Uint8Array(o);let d=0;return i.forEach(p=>{for(let _=0;_<p.length;_++)l[d++]=p[_]}),new yg(l,!0)}}uploadData(){return this.data_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Toe(n){let e;try{e=JSON.parse(n)}catch{return null}return u6e(e)?e:null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function I6e(n){if(n.length===0)return null;const e=n.lastIndexOf("/");return e===-1?"":n.slice(0,e)}function A6e(n,e){const i=e.split("/").filter(o=>o.length>0).join("/");return n.length===0?i:n+"/"+i}function woe(n){const e=n.lastIndexOf("/",n.length-2);return e===-1?n:n.slice(e+1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function P6e(n,e){return e}class Ec{constructor(e,i,o,l){this.server=e,this.local=i||e,this.writable=!!o,this.xform=l||P6e}}let WO=null;function O6e(n){return!h3(n)||n.length<2?n:woe(n)}function Coe(){if(WO)return WO;const n=[];n.push(new Ec("bucket")),n.push(new Ec("generation")),n.push(new Ec("metageneration")),n.push(new Ec("name","fullPath",!0));function e(d,p){return O6e(p)}const i=new Ec("name");i.xform=e,n.push(i);function o(d,p){return p!==void 0?Number(p):p}const l=new Ec("size");return l.xform=o,n.push(l),n.push(new Ec("timeCreated")),n.push(new Ec("updated")),n.push(new Ec("md5Hash",null,!0)),n.push(new Ec("cacheControl",null,!0)),n.push(new Ec("contentDisposition",null,!0)),n.push(new Ec("contentEncoding",null,!0)),n.push(new Ec("contentLanguage",null,!0)),n.push(new Ec("contentType",null,!0)),n.push(new Ec("metadata","customMetadata",!0)),WO=n,WO}function k6e(n,e){function i(){const o=n.bucket,l=n.fullPath,d=new Vl(o,l);return e._makeStorageReference(d)}Object.defineProperty(n,"ref",{get:i})}function N6e(n,e,i){const o={};o.type="file";const l=i.length;for(let d=0;d<l;d++){const p=i[d];o[p.local]=p.xform(o,e[p.server])}return k6e(o,n),o}function Roe(n,e,i){const o=Toe(e);return o===null?null:N6e(n,o,i)}function D6e(n,e,i,o){const l=Toe(e);if(l===null||!h3(l.downloadTokens))return null;const d=l.downloadTokens;if(d.length===0)return null;const p=encodeURIComponent;return d.split(",").map(b=>{const C=n.bucket,I=n.fullPath,O="/b/"+p(C)+"/o/"+p(I),L=ON(O,i,o),V=Eoe({alt:"media",token:b});return L+V})[0]}function x6e(n,e){const i={},o=e.length;for(let l=0;l<o;l++){const d=e[l];d.writable&&(i[d.server]=n[d.local])}return JSON.stringify(i)}class p3{constructor(e,i,o,l){this.url=e,this.method=i,this.handler=o,this.timeout=l,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ioe(n){if(!n)throw d3()}function L6e(n,e){function i(o,l){const d=Roe(n,l,e);return Ioe(d!==null),d}return i}function M6e(n,e){function i(o,l){const d=Roe(n,l,e);return Ioe(d!==null),D6e(d,l,n.host,n._protocol)}return i}function Aoe(n){function e(i,o){let l;return i.getStatus()===401?i.getErrorText().includes("Firebase App Check token is invalid")?l=YBe():l=qBe():i.getStatus()===402?l=KBe(n.bucket):i.getStatus()===403?l=XBe(n.path):l=o,l.status=i.getStatus(),l.serverResponse=o.serverResponse,l}return e}function Poe(n){const e=Aoe(n);function i(o,l){let d=e(o,l);return o.getStatus()===404&&(d=$Be(n.path)),d.serverResponse=l.serverResponse,d}return i}function U6e(n,e,i){const o=e.fullServerUrl(),l=ON(o,n.host,n._protocol),d="GET",p=n.maxOperationRetryTime,_=new p3(l,d,M6e(n,i),p);return _.errorHandler=Poe(e),_}function V6e(n,e){const i=e.fullServerUrl(),o=ON(i,n.host,n._protocol),l="DELETE",d=n.maxOperationRetryTime;function p(E,b){}const _=new p3(o,l,p,d);return _.successCodes=[200,204],_.errorHandler=Poe(e),_}function F6e(n,e){return n&&n.contentType||e&&e.type()||"application/octet-stream"}function j6e(n,e,i){const o=Object.assign({},i);return o.fullPath=n.path,o.size=e.size(),o.contentType||(o.contentType=F6e(null,e)),o}function B6e(n,e,i,o,l){const d=e.bucketOnlyServerUrl(),p={"X-Goog-Upload-Protocol":"multipart"};function _(){let se="";for(let ue=0;ue<2;ue++)se=se+Math.random().toString().slice(2);return se}const E=_();p["Content-Type"]="multipart/related; boundary="+E;const b=j6e(e,o,l),C=x6e(b,i),I="--"+E+`\r
Content-Type: application/json; charset=utf-8\r
\r
`+C+`\r
--`+E+`\r
Content-Type: `+b.contentType+`\r
\r
`,O=`\r
--`+E+"--",L=yg.getBlob(I,o,O);if(L===null)throw n6e();const V={name:b.fullPath},B=ON(d,n.host,n._protocol),W="POST",Z=n.maxUploadRetryTime,$=new p3(B,W,L6e(n,i),Z);return $.urlParams=V,$.headers=p,$.body=L.uploadData(),$.errorHandler=Aoe(e),$}class W6e{constructor(){this.sent_=!1,this.xhr_=new XMLHttpRequest,this.initXhr(),this.errorCode_=Ly.NO_ERROR,this.sendPromise_=new Promise(e=>{this.xhr_.addEventListener("abort",()=>{this.errorCode_=Ly.ABORT,e()}),this.xhr_.addEventListener("error",()=>{this.errorCode_=Ly.NETWORK_ERROR,e()}),this.xhr_.addEventListener("load",()=>{e()})})}send(e,i,o,l){if(this.sent_)throw bw("cannot .send() more than once");if(this.sent_=!0,this.xhr_.open(i,e,!0),l!==void 0)for(const d in l)l.hasOwnProperty(d)&&this.xhr_.setRequestHeader(d,l[d].toString());return o!==void 0?this.xhr_.send(o):this.xhr_.send(),this.sendPromise_}getErrorCode(){if(!this.sent_)throw bw("cannot .getErrorCode() before sending");return this.errorCode_}getStatus(){if(!this.sent_)throw bw("cannot .getStatus() before sending");try{return this.xhr_.status}catch{return-1}}getResponse(){if(!this.sent_)throw bw("cannot .getResponse() before sending");return this.xhr_.response}getErrorText(){if(!this.sent_)throw bw("cannot .getErrorText() before sending");return this.xhr_.statusText}abort(){this.xhr_.abort()}getResponseHeader(e){return this.xhr_.getResponseHeader(e)}addUploadProgressListener(e){this.xhr_.upload!=null&&this.xhr_.upload.addEventListener("progress",e)}removeUploadProgressListener(e){this.xhr_.upload!=null&&this.xhr_.upload.removeEventListener("progress",e)}}class z6e extends W6e{initXhr(){this.xhr_.responseType="text"}}function m3(){return new z6e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qy{constructor(e,i){this._service=e,i instanceof Vl?this._location=i:this._location=Vl.makeFromUrl(i,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,i){return new qy(e,i)}get root(){const e=new Vl(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return woe(this._location.path)}get storage(){return this._service}get parent(){const e=I6e(this._location.path);if(e===null)return null;const i=new Vl(this._location.bucket,e);return new qy(this._service,i)}_throwIfRoot(e){if(this._location.path==="")throw s6e(e)}}function G6e(n,e,i){n._throwIfRoot("uploadBytes");const o=B6e(n.storage,n._location,Coe(),new yg(e,!0),i);return n.storage.makeRequestWithTokens(o,m3).then(l=>({metadata:l,ref:n}))}function H6e(n){n._throwIfRoot("getDownloadURL");const e=U6e(n.storage,n._location,Coe());return n.storage.makeRequestWithTokens(e,m3).then(i=>{if(i===null)throw r6e();return i})}function $6e(n){n._throwIfRoot("deleteObject");const e=V6e(n.storage,n._location);return n.storage.makeRequestWithTokens(e,m3)}function K6e(n,e){const i=A6e(n._location.path,e),o=new Vl(n._location.bucket,i);return new qy(n.storage,o)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function q6e(n){return/^[A-Za-z]+:\/\//.test(n)}function Y6e(n,e){return new qy(n,e)}function Ooe(n,e){if(n instanceof g3){const i=n;if(i._bucket==null)throw t6e();const o=new qy(i,i._bucket);return e!=null?Ooe(o,e):o}else return e!==void 0?K6e(n,e):n}function X6e(n,e){if(e&&q6e(e)){if(n instanceof g3)return Y6e(n,e);throw mF("To use ref(service, url), the first argument must be a Storage instance.")}else return Ooe(n,e)}function lQ(n,e){const i=e==null?void 0:e[_oe];return i==null?null:Vl.makeFromBucketSpec(i,n)}function J6e(n,e,i,o={}){n.host=`${e}:${i}`,n._protocol="http";const{mockUserToken:l}=o;l&&(n._overrideAuthToken=typeof l=="string"?l:$re(l,n.app.options.projectId))}class g3{constructor(e,i,o,l,d){this.app=e,this._authProvider=i,this._appCheckProvider=o,this._url=l,this._firebaseVersion=d,this._bucket=null,this._host=goe,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=GBe,this._maxUploadRetryTime=HBe,this._requests=new Set,l!=null?this._bucket=Vl.makeFromBucketSpec(l,this._host):this._bucket=lQ(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,this._url!=null?this._bucket=Vl.makeFromBucketSpec(this._url,e):this._bucket=lQ(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){cQ("time",0,Number.POSITIVE_INFINITY,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){cQ("time",0,Number.POSITIVE_INFINITY,e),this._maxOperationRetryTime=e}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const e=this._authProvider.getImmediate({optional:!0});if(e){const i=await e.getToken();if(i!==null)return i.accessToken}return null}async _getAppCheckToken(){if(Ll(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=this._appCheckProvider.getImmediate({optional:!0});return e?(await e.getToken()).token:null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(e=>e.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new qy(this,e)}_makeRequest(e,i,o,l,d=!0){if(this._deleted)return new o6e(yoe());{const p=_6e(e,this._appId,o,l,i,this._firebaseVersion,d);return this._requests.add(p),p.getPromise().then(()=>this._requests.delete(p),()=>this._requests.delete(p)),p}}async makeRequestWithTokens(e,i){const[o,l]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(e,i,o,l).getPromise()}}const uQ="@firebase/storage",dQ="0.13.7";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const koe="storage";function _3(n,e,i){return n=zi(n),G6e(n,e,i)}function kN(n){return n=zi(n),H6e(n)}function y3(n){return n=zi(n),$6e(n)}function rE(n,e){return n=zi(n),X6e(n,e)}function iE(n=f4(),e){n=zi(n);const o=nN(n,koe).getImmediate({identifier:e}),l=zre("storage");return l&&Q6e(o,...l),o}function Q6e(n,e,i,o={}){J6e(n,e,i,o)}function Z6e(n,{instanceIdentifier:e}){const i=n.getProvider("app").getImmediate(),o=n.getProvider("auth-internal"),l=n.getProvider("app-check-internal");return new g3(i,o,l,e,Qy)}function eWe(){Wy(new Og(koe,Z6e,"PUBLIC").setMultipleInstances(!0)),af(uQ,dQ,""),af(uQ,dQ,"esm2017")}eWe();const Ok=async n=>{const e=iE(),i=rE(e,n);try{return await kN(i)}catch(o){throw Y.error("Failed to fetch HTTP URL from gs:// URL:","/src/packages/shared/firebase/firebaseStorage.js",o),o}};let Yy={};const Rg=async n=>{try{const e=$r(gr,"spaces",n),i=await To(e);if(i.exists()){let o=i.data();const l=o.name,d=o.description;if(o.webglBuildId){const p=$r(gr,"webglBuilds",o.webglBuildId),_=await To(p);if(_.exists()){const E=_.data();o={...o,...E,name:l||E.name,description:d||E.description}}else Y.warn(`spacesFirestore: No document found for webglBuildId: ${o.webglBuildId}`)}return o=await tWe(o),o=nWe(o),console.log("Space data:",o),Y.log(`spacesFirestore: Caching space data for: ${n}`),Yy[n]=o,o}else return Y.warn(`spacesFirestore: No document found for item ID: ${n}`),null}catch(e){throw Y.error("spacesFirestore: Error fetching item data:",e),e}},tWe=async n=>{const i=["gsUrlCode","gsUrlData","gsUrlFramework","gsUrlLoader","gsUrlLoadingBackground"].map(async o=>{const l=n[o];l&&l.startsWith("gs://")&&(n[o]=await Ok(l))});return await Promise.all(i),n},nWe=n=>{const{gsUrlCode:e,gsUrlData:i,gsUrlFramework:o,gsUrlLoader:l,...d}=n;return{...d,codeUrl:e,dataUrl:i,frameworkUrl:o,loaderUrl:l}};let DU={};const Noe=async n=>{Y.log("spacesFirestore: Get Videos from Firestore for space: ",n);try{if(DU[n])return Y.log("spacesFirestore: Returning cached videos for space:",n),DU[n];const e=Yp(gr,`spaces/${n}/videos`),i=await Ky(e),o=[];return i.forEach(l=>{o.push({id:l.id,...l.data()})}),DU[n]=o,o}catch(e){throw Y.error("spacesFirestore: Error fetching Space videos from Firestore:",e),e}},rWe=async(n,e)=>{try{if(!n||!e)throw new Error("Missing required parameters: spaceId and logoFile");if(!e.type.startsWith("image/"))throw new Error("File must be an image");const i=iE(),o=Date.now(),l=e.name.split(".").pop(),d=`logo_${o}.${l}`,p=rE(i,`spaces/${n}/logo/${d}`);Y.log(`Uploading logo for space ${n}`);const _=await _3(p,e),E=await kN(_.ref),b=$r(gr,"spaces",n);return await Co(b,{logoUrl:E,logoGsUrl:`gs://${_.ref.bucket}/${_.ref.fullPath}`,logoFileName:d,updatedAt:new Date().toISOString()}),Y.log(`Successfully uploaded logo for space ${n}`),E}catch(i){throw Y.error("Error uploading space logo:",i),i}},iWe=async n=>{try{const e=$r(gr,"spaces",n),i=await To(e);if(!i.exists())return Y.warn(`No space found with ID: ${n}`),!1;const o=i.data();if(o.logoGsUrl){const l=iE(),d=rE(l,o.logoGsUrl);try{await y3(d),Y.log(`Deleted logo file from storage: ${o.logoGsUrl}`)}catch(p){Y.warn(`Could not delete logo file from storage: ${p.message}`)}}return await Co(e,{logoUrl:null,logoGsUrl:null,logoFileName:null,updatedAt:new Date().toISOString()}),Y.log(`Successfully removed logo for space ${n}`),!0}catch(e){throw Y.error("Error deleting space logo:",e),e}},sWe=async(n,e)=>{try{if(!n||!e)throw new Error("Missing required parameters: spaceId and backgroundFile");if(!e.type.startsWith("image/"))throw new Error("File must be an image");const i=iE(),o=Date.now(),l=e.name.split(".").pop(),d=`background_${o}.${l}`,p=rE(i,`spaces/${n}/background/${d}`);Y.log(`Uploading background for space ${n}`);const _=await _3(p,e),E=await kN(_.ref),b=$r(gr,"spaces",n);return await Co(b,{backgroundUrl:E,backgroundGsUrl:`gs://${_.ref.bucket}/${_.ref.fullPath}`,backgroundFileName:d,gsUrlLoadingBackground:`gs://${_.ref.bucket}/${_.ref.fullPath}`,updatedAt:new Date().toISOString()}),Y.log(`Successfully uploaded background for space ${n}`),E}catch(i){throw Y.error("Error uploading space background:",i),i}},oWe=async n=>{try{const e=$r(gr,"spaces",n),i=await To(e);if(!i.exists())return Y.warn(`No space found with ID: ${n}`),!1;const o=i.data();if(o.backgroundGsUrl){const l=iE(),d=rE(l,o.backgroundGsUrl);try{await y3(d),Y.log(`Deleted background file from storage: ${o.backgroundGsUrl}`)}catch(p){Y.warn(`Could not delete background file from storage: ${p.message}`)}}return await Co(e,{backgroundUrl:null,backgroundGsUrl:null,backgroundFileName:null,gsUrlLoadingBackground:null,updatedAt:new Date().toISOString()}),Y.log(`Successfully removed background references for space ${n}`),!0}catch(e){throw Y.error("Error deleting space background:",e),e}},aWe=async(n,e)=>{try{Y.log(`spacesFirestore: Updating settings for space: ${n}`,e);const i=$r(gr,"spaces",n),o=await To(i);if(!o.exists())throw new Error(`Space with ID ${n} not found`);const l=o.data(),d={...e,accessibleToAllUsers:e.accessibleToAllUsers!==void 0?e.accessibleToAllUsers:l.accessibleToAllUsers!==void 0?l.accessibleToAllUsers:!0,updatedAt:new Date().toISOString()};await Co(i,d),Yy[n]&&delete Yy[n],Y.log(`spacesFirestore: Successfully updated settings for space: ${n}`)}catch(i){throw Y.error(`spacesFirestore: Error updating settings for space: ${n}`,i),i}},cWe=async(n,e)=>{try{Y.log(`spacesFirestore: Setting accessibleToAllUsers=${e} for space: ${n}`);const i=$r(gr,"spaces",n);if(!(await To(i)).exists())throw new Error(`Space with ID ${n} not found`);await Co(i,{accessibleToAllUsers:e,updatedAt:new Date().toISOString()}),Yy[n]&&delete Yy[n],typeof window<"u"&&window.dispatchEvent(new CustomEvent("SpaceAccessibilityChanged",{detail:{spaceId:n,accessibleToAllUsers:e}})),Y.log(`spacesFirestore: Successfully updated accessibleToAllUsers for space: ${n}`)}catch(i){throw Y.error(`spacesFirestore: Error updating accessibleToAllUsers for space: ${n}`,i),i}},gF=async(n,e)=>{try{Y.log(`spacesFirestore: Updating HLS stream for space: ${n}`,e);const i=$r(gr,"spaces",n);if(!(await To(i)).exists())throw new Error(`Space with ID ${n} not found`);const{streamUrl:l,playerIndex:d="0",enabled:p=!0,rtmpUrl:_="",streamKey:E=""}=e,b={HLSStreamURL:{streamUrl:l,playerIndex:d,enabled:p,rtmpUrl:_,streamKey:E,updatedAt:new Date().toISOString()},updatedAt:new Date().toISOString()};return await Co(i,b),Yy[n]&&delete Yy[n],typeof window<"u"&&window.dispatchEvent(new CustomEvent("SpaceHLSStreamUpdated",{detail:{spaceId:n,streamUrl:l,playerIndex:d,enabled:p,rtmpUrl:_,streamKey:E}})),Y.log(`spacesFirestore: Successfully updated HLS stream for space: ${n}`),!0}catch(i){throw Y.error(`spacesFirestore: Error updating HLS stream for space: ${n}`,i),i}},Doe=async n=>{try{Y.log(`spacesFirestore: Getting HLS stream for space: ${n}`);const e=$r(gr,"spaces",n),i=await To(e);if(!i.exists())return Y.warn(`spacesFirestore: Space with ID ${n} not found`),null;const o=i.data();return o.HLSStreamURL?(Y.log(`spacesFirestore: Found HLS stream for space: ${n}`,o.HLSStreamURL),o.HLSStreamURL):(Y.log(`spacesFirestore: No HLS stream found for space: ${n}`),null)}catch(e){throw Y.error(`spacesFirestore: Error getting HLS stream for space: ${n}`,e),e}},Go=D.createContext(null),xoe=D.createContext(null),NN=({children:n})=>{const[e,i]=D.useState(null),o=D.useRef(null),[l,d]=D.useState(!0),[p,_]=D.useState(!1),E=oN(),b=re=>re?re.Nickname?re.Nickname:`${re.firstName} ${re.lastName}`:"Anon";D.useEffect(()=>{const re=ije(E,async pe=>{if(Y.log("UserProvider: Firebase onAuthStateChanged() fired"),pe)try{const q=await Fu(pe.uid),Q=b(q),J={uid:pe.uid,email:pe.email,emailVerified:pe.emailVerified,...q,displayName:Q};Y.log(`UserProvider: User authenticated: ${pe.uid}`),i(J),o.current=J,L(J)}catch(q){Y.error("UserProvider: Error fetching user profile data:",q)}else i(null),o.current=null;d(!1)});return()=>{re&&re()}},[]);const C=async(re,pe,q)=>{try{_(!0),Y.log("UserProvider: Starting registration process"),Y.log("UserProvider: Registration includes fields:",Object.keys(q||{}).join(", "));const Q={...q},J=["firstName","lastName","username","companyName","linkedInProfile"],ie=J.filter(ve=>!Q[ve]);ie.length>0&&Y.warn(`UserProvider: Registration missing fields: ${ie.join(", ")}`);const me=Q.firstName&&Q.lastName?`${Q.firstName}${Q.lastName.charAt(0).toUpperCase()}`:"";Y.log("UserProvider: Generated default nickname for registration");const de={firstName:"",lastName:"",companyName:"",linkedInProfile:"",username:"",Nickname:Q.Nickname||me,groups:["users"],rpmURL:"https://models.readyplayer.me/67c8408d38f7924e15a8bd0a.glb",...Q};Y.log("UserProvider: Prepared registration data with fields:",Object.keys(de).join(", "));const le=await LBe(re,pe,de);Y.log("UserProvider: Registration successful, received user data");const xe=J.filter(ve=>!le[ve]);xe.length>0&&Y.warn(`UserProvider: Returned user data missing fields: ${xe.join(", ")}`),["firstName","lastName","Nickname","username","companyName"].forEach(ve=>{le[ve]||(Y.warn(`UserProvider: ${ve} is missing in returned data, using original value`),le[ve]=de[ve])});const $e={uid:le.uid,email:le.email,...le,displayName:b(le)};return Y.log("UserProvider: Created user object with fields:",Object.keys($e).join(", ")),i($e),o.current=$e,Y.log("UserProvider: User registered successfully with groups:",de.groups),await new Promise(ve=>setTimeout(ve,2e3)),_(!1),$e}catch(Q){throw _(!1),Y.error("UserProvider: Error during registration:",Q),Q}},I=async(re,pe,q)=>{try{if(Y.log("UserProvider: Signing in user"),!q)throw new Error("CAPTCHA verification is required");const J=(await tje(E,re,pe)).user;return Y.log("UserProvider: User signed in successfully:",J.email),J}catch(Q){throw Y.error("UserProvider: Error signing in:",Q),Q}},O=async()=>{try{await sje(E),i(null),Y.log("UserProvider: User signed out.")}catch(re){throw Y.error("UserProvider: Error signing out:",re),re}},L=()=>{const re=o.current;if(re){const pe=V(re);Y.log("UserProvider: sendUserToUnity() using the eventBus",pe),Ud.publish(Md.sendUserToUnity,pe)}else Y.log("UserProvider: No current user to send to Unity.")},V=re=>{const pe={};return[...WBe,"uid"].forEach(Q=>{re.hasOwnProperty(Q)&&(pe[Q]=re[Q])}),pe},B=async re=>!e||!e.uid?!1:await moe(e.uid,re),W=async re=>{if(!e||!e.uid)return!1;try{const pe=await Rg(re);if(pe.usersAllowed.includes(e.uid)||pe.userAdmin.includes(e.uid)||pe.usersModerators.includes(e.uid))return!0;if(e.groups&&Array.isArray(e.groups)){const Q=`space_${re}_owners`,J=`space_${re}_hosts`;if(e.groups.includes(Q)||e.groups.includes(J))return Y.log(`UserProvider: User ${e.uid} has access to space ${re} as owner/host`),!0}return pe.accessibleToAllUsers===!0&&e.groups?e.groups.includes("users"):!1}catch(pe){return Y.error("UserProvider: Error verifying user access to space:",pe),!1}},Z=async re=>{if(!e||!e.uid)return!1;try{return(await Rg(re)).userAdmin.includes(e.uid)}catch(pe){return Y.error("UserProvider: Error verifying user admin status for space:",pe),!1}},$=async re=>{if(!e||!e.uid)return!1;try{return(await Rg(re)).usersModerators.includes(e.uid)}catch(pe){return Y.error("UserProvider: Error verifying user moderator status for space:",pe),!1}},se=async()=>{try{const re=E.currentUser;return re&&!re.emailVerified?(await wie(re),Y.log("UserProvider: Verification email resent to:",re.email),!0):!1}catch(re){throw Y.error("UserProvider: Error resending verification email:",re),re}},ue=async()=>{try{const re=E.currentUser;if(!re)return Y.warn("UserProvider: updateUser called but no current user exists"),null;Y.log("UserProvider: Updating user data from Firestore");const pe=await Fu(re.uid);if(!pe)return Y.error("UserProvider: Failed to fetch updated user profile"),null;const q=b(pe),Q={uid:re.uid,email:re.email,emailVerified:re.emailVerified,...pe,displayName:q};return Y.log("UserProvider: User data updated with fields:",Object.keys(Q).join(", ")),i(Q),o.current=Q,L(Q),Q}catch(re){throw Y.error("UserProvider: Error updating user data:",re),re}};return w.jsx(xoe.Provider,{value:{registrationInProgress:p},children:w.jsx(Go.Provider,{value:{user:e,loading:l,register:C,signIn:I,signOut:O,sendUserToUnity:L,isUserInGroup:B,userHasAccessToSpace:W,userIsAdminOfSpace:Z,userIsModeratorOfSpace:$,resendVerificationEmail:se,updateUser:ue},children:n})})},lWe=()=>{const n=D.useContext(xoe);if(n===void 0)throw new Error("useRegistration must be used within a UserProvider");return n},Loe=D.createContext(),Bd=()=>D.useContext(Loe),E3=({children:n})=>{const[e,i]=D.useState(!1),o=D.useRef(null),[l,d]=D.useState(!1);D.useEffect(()=>{const E=()=>{const b=/iPhone|iPad|iPod|Android/i.test(navigator.userAgent);d(b)};return E(),window.addEventListener("resize",E),()=>window.removeEventListener("resize",E)},[]);const p=D.useCallback(E=>{o.current=E},[]),_=D.useCallback(()=>{const E=o.current;if(!E)return;const b=document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement;if(l){console.log("Attempting mobile fullscreen...");const C=E.querySelector("video")||E;if(/iPhone|iPad|iPod/i.test(navigator.userAgent)){if(C.webkitEnterFullscreen)try{C.webkitEnterFullscreen(),i(!0);return}catch(I){console.error("iOS fullscreen error:",I)}try{if(C.webkitRequestFullscreen){C.webkitRequestFullscreen(),i(!0);return}}catch(I){console.error("iOS fallback fullscreen error:",I)}}if(/Android/i.test(navigator.userAgent))try{b?(document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.msExitFullscreen&&document.msExitFullscreen(),i(!1)):(E.requestFullscreen?E.requestFullscreen():E.webkitRequestFullscreen?E.webkitRequestFullscreen():E.mozRequestFullScreen?E.mozRequestFullScreen():E.msRequestFullscreen&&E.msRequestFullscreen(),i(!0));return}catch(I){console.error("Android fullscreen error:",I)}}try{b?document.exitFullscreen?document.exitFullscreen().then(()=>{i(!1)}).catch(C=>console.error("Error exiting fullscreen:",C)):document.webkitExitFullscreen?(document.webkitExitFullscreen(),i(!1)):document.mozCancelFullScreen?(document.mozCancelFullScreen(),i(!1)):document.msExitFullscreen&&(document.msExitFullscreen(),i(!1)):E.requestFullscreen?E.requestFullscreen().then(()=>{i(!0)}).catch(C=>console.error("Error entering fullscreen:",C)):E.webkitRequestFullscreen?(E.webkitRequestFullscreen(),i(!0)):E.mozRequestFullScreen?(E.mozRequestFullScreen(),i(!0)):E.msRequestFullscreen&&(E.msRequestFullscreen(),i(!0))}catch(C){console.error("Fullscreen error:",C)}},[l]);return D.useEffect(()=>{const E=()=>{const b=document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement;i(!!b)};return document.addEventListener("fullscreenchange",E),document.addEventListener("webkitfullscreenchange",E),document.addEventListener("mozfullscreenchange",E),document.addEventListener("MSFullscreenChange",E),()=>{document.removeEventListener("fullscreenchange",E),document.removeEventListener("webkitfullscreenchange",E),document.removeEventListener("mozfullscreenchange",E),document.removeEventListener("MSFullscreenChange",E)}},[]),w.jsx(Loe.Provider,{value:{isFullscreen:e,toggleFullscreen:_,fullscreenRef:o,setFullscreenRef:p,isMobile:l},children:w.jsx("div",{ref:p,style:{position:"relative",zIndex:1,width:"100%",height:"100%",overflow:"hidden"},children:n})})},uWe=Fg({d:"M0,12a1.5,1.5,0,0,0,1.5,1.5h8.75a.25.25,0,0,1,.25.25V22.5a1.5,1.5,0,0,0,3,0V13.75a.25.25,0,0,1,.25-.25H22.5a1.5,1.5,0,0,0,0-3H13.75a.25.25,0,0,1-.25-.25V1.5a1.5,1.5,0,0,0-3,0v8.75a.25.25,0,0,1-.25.25H1.5A1.5,1.5,0,0,0,0,12Z",displayName:"AddIcon"}),dWe=Fg({viewBox:"0 0 14 14",d:"M14,7.77 L14,6.17 L12.06,5.53 L11.61,4.44 L12.49,2.6 L11.36,1.47 L9.55,2.38 L8.46,1.93 L7.77,0.01 L6.17,0.01 L5.54,1.95 L4.43,2.4 L2.59,1.52 L1.46,2.65 L2.37,4.46 L1.92,5.55 L0,6.23 L0,7.82 L1.94,8.46 L2.39,9.55 L1.51,11.39 L2.64,12.52 L4.45,11.61 L5.54,12.06 L6.23,13.98 L7.82,13.98 L8.45,12.04 L9.56,11.59 L11.4,12.47 L12.53,11.34 L11.61,9.53 L12.08,8.44 L14,7.75 L14,7.77 Z M7,10 C5.34,10 4,8.66 4,7 C4,5.34 5.34,4 7,4 C8.66,4 10,5.34 10,7 C10,8.66 8.66,10 7,10 Z",displayName:"SettingsIcon"}),hWe=Fg({d:"M19.5,9.5h-.75V6.75a6.75,6.75,0,0,0-13.5,0V9.5H4.5a2,2,0,0,0-2,2V22a2,2,0,0,0,2,2h15a2,2,0,0,0,2-2V11.5A2,2,0,0,0,19.5,9.5Zm-9.5,6a2,2,0,1,1,3,1.723V19.5a1,1,0,0,1-2,0V17.223A1.994,1.994,0,0,1,10,15.5ZM7.75,6.75a4.25,4.25,0,0,1,8.5,0V9a.5.5,0,0,1-.5.5H8.25a.5.5,0,0,1-.5-.5Z",displayName:"LockIcon"}),Moe=Fg({displayName:"ChevronDownIcon",d:"M16.59 8.59L12 13.17 7.41 8.59 6 10l6 6 6-6z"}),hQ=Fg({displayName:"EmailIcon",path:w.jsxs("g",{fill:"currentColor",children:[w.jsx("path",{d:"M11.114,14.556a1.252,1.252,0,0,0,1.768,0L22.568,4.87a.5.5,0,0,0-.281-.849A1.966,1.966,0,0,0,22,4H2a1.966,1.966,0,0,0-.289.021.5.5,0,0,0-.281.849Z"}),w.jsx("path",{d:"M23.888,5.832a.182.182,0,0,0-.2.039l-6.2,6.2a.251.251,0,0,0,0,.354l5.043,5.043a.75.75,0,1,1-1.06,1.061l-5.043-5.043a.25.25,0,0,0-.354,0l-2.129,2.129a2.75,2.75,0,0,1-3.888,0L7.926,13.488a.251.251,0,0,0-.354,0L2.529,18.531a.75.75,0,0,1-1.06-1.061l5.043-5.043a.251.251,0,0,0,0-.354l-6.2-6.2a.18.18,0,0,0-.2-.039A.182.182,0,0,0,0,6V18a2,2,0,0,0,2,2H22a2,2,0,0,0,2-2V6A.181.181,0,0,0,23.888,5.832Z"})]})}),fWe=Fg({displayName:"CloseIcon",d:"M.439,21.44a1.5,1.5,0,0,0,2.122,2.121L11.823,14.3a.25.25,0,0,1,.354,0l9.262,9.263a1.5,1.5,0,1,0,2.122-2.121L14.3,12.177a.25.25,0,0,1,0-.354l9.263-9.262A1.5,1.5,0,0,0,21.439.44L12.177,9.7a.25.25,0,0,1-.354,0L2.561.44A1.5,1.5,0,0,0,.439,2.561L9.7,11.823a.25.25,0,0,1,0,.354Z"}),pWe=Fg({displayName:"QuestionOutlineIcon",path:w.jsxs("g",{stroke:"currentColor",strokeWidth:"1.5",children:[w.jsx("path",{strokeLinecap:"round",fill:"none",d:"M9,9a3,3,0,1,1,4,2.829,1.5,1.5,0,0,0-1,1.415V14.25"}),w.jsx("path",{fill:"none",strokeLinecap:"round",d:"M12,17.25a.375.375,0,1,0,.375.375A.375.375,0,0,0,12,17.25h0"}),w.jsx("circle",{fill:"none",strokeMiterlimit:"10",cx:"12",cy:"12",r:"11.25"})]})}),mWe=Fg({displayName:"HamburgerIcon",viewBox:"0 0 24 24",d:"M 3 5 A 1.0001 1.0001 0 1 0 3 7 L 21 7 A 1.0001 1.0001 0 1 0 21 5 L 3 5 z M 3 11 A 1.0001 1.0001 0 1 0 3 13 L 21 13 A 1.0001 1.0001 0 1 0 21 11 L 3 11 z M 3 17 A 1.0001 1.0001 0 1 0 3 19 L 21 19 A 1.0001 1.0001 0 1 0 21 17 L 3 17 z"});var AR=n=>n.type==="checkbox",Cy=n=>n instanceof Date,vc=n=>n==null;const Uoe=n=>typeof n=="object";var Ys=n=>!vc(n)&&!Array.isArray(n)&&Uoe(n)&&!Cy(n),gWe=n=>Ys(n)&&n.target?AR(n.target)?n.target.checked:n.target.value:n,_We=n=>n.substring(0,n.search(/\.\d+(\.|$)/))||n,yWe=(n,e)=>n.has(_We(e)),EWe=n=>{const e=n.constructor&&n.constructor.prototype;return Ys(e)&&e.hasOwnProperty("isPrototypeOf")},v3=typeof window<"u"&&typeof window.HTMLElement<"u"&&typeof document<"u";function Ou(n){let e;const i=Array.isArray(n),o=typeof FileList<"u"?n instanceof FileList:!1;if(n instanceof Date)e=new Date(n);else if(n instanceof Set)e=new Set(n);else if(!(v3&&(n instanceof Blob||o))&&(i||Ys(n)))if(e=i?[]:{},!i&&!EWe(n))e=n;else for(const l in n)n.hasOwnProperty(l)&&(e[l]=Ou(n[l]));else return n;return e}var DN=n=>Array.isArray(n)?n.filter(Boolean):[],to=n=>n===void 0,dn=(n,e,i)=>{if(!e||!Ys(n))return i;const o=DN(e.split(/[,[\].]+?/)).reduce((l,d)=>vc(l)?l:l[d],n);return to(o)||o===n?to(n[e])?i:n[e]:o},Bh=n=>typeof n=="boolean",S3=n=>/^\w*$/.test(n),Voe=n=>DN(n.replace(/["|']|\]/g,"").split(/\.|\[/)),ts=(n,e,i)=>{let o=-1;const l=S3(e)?[e]:Voe(e),d=l.length,p=d-1;for(;++o<d;){const _=l[o];let E=i;if(o!==p){const b=n[_];E=Ys(b)||Array.isArray(b)?b:isNaN(+l[o+1])?{}:[]}if(_==="__proto__"||_==="constructor"||_==="prototype")return;n[_]=E,n=n[_]}return n};const fQ={BLUR:"blur",FOCUS_OUT:"focusout"},xd={onBlur:"onBlur",onChange:"onChange",onSubmit:"onSubmit",onTouched:"onTouched",all:"all"},yp={max:"max",min:"min",maxLength:"maxLength",minLength:"minLength",pattern:"pattern",required:"required",validate:"validate"};fi.createContext(null);var vWe=(n,e,i,o=!0)=>{const l={defaultValues:e._defaultValues};for(const d in n)Object.defineProperty(l,d,{get:()=>{const p=d;return e._proxyFormState[p]!==xd.all&&(e._proxyFormState[p]=!o||xd.all),n[p]}});return l},il=n=>Ys(n)&&!Object.keys(n).length,SWe=(n,e,i,o)=>{i(n);const{name:l,...d}=n;return il(d)||Object.keys(d).length>=Object.keys(e).length||Object.keys(d).find(p=>e[p]===xd.all)},kk=n=>Array.isArray(n)?n:[n];function bWe(n){const e=fi.useRef(n);e.current=n,fi.useEffect(()=>{const i=!n.disabled&&e.current.subject&&e.current.subject.subscribe({next:e.current.next});return()=>{i&&i.unsubscribe()}},[n.disabled])}var Jh=n=>typeof n=="string",TWe=(n,e,i,o,l)=>Jh(n)?(o&&e.watch.add(n),dn(i,n,l)):Array.isArray(n)?n.map(d=>(o&&e.watch.add(d),dn(i,d))):(o&&(e.watchAll=!0),i),wWe=(n,e,i,o,l)=>e?{...i[n],types:{...i[n]&&i[n].types?i[n].types:{},[o]:l||!0}}:{},pQ=n=>({isOnSubmit:!n||n===xd.onSubmit,isOnBlur:n===xd.onBlur,isOnChange:n===xd.onChange,isOnAll:n===xd.all,isOnTouch:n===xd.onTouched}),mQ=(n,e,i)=>!i&&(e.watchAll||e.watch.has(n)||[...e.watch].some(o=>n.startsWith(o)&&/^\.\w+/.test(n.slice(o.length))));const yC=(n,e,i,o)=>{for(const l of i||Object.keys(n)){const d=dn(n,l);if(d){const{_f:p,..._}=d;if(p){if(p.refs&&p.refs[0]&&e(p.refs[0],l)&&!o)return!0;if(p.ref&&e(p.ref,p.name)&&!o)return!0;if(yC(_,e))break}else if(Ys(_)&&yC(_,e))break}}};var CWe=(n,e,i)=>{const o=kk(dn(n,i));return ts(o,"root",e[i]),ts(n,i,o),n},b3=n=>n.type==="file",Kh=n=>typeof n=="function",E1=n=>{if(!v3)return!1;const e=n?n.ownerDocument:0;return n instanceof(e&&e.defaultView?e.defaultView.HTMLElement:HTMLElement)},Nk=n=>Jh(n),T3=n=>n.type==="radio",v1=n=>n instanceof RegExp;const gQ={value:!1,isValid:!1},_Q={value:!0,isValid:!0};var Foe=n=>{if(Array.isArray(n)){if(n.length>1){const e=n.filter(i=>i&&i.checked&&!i.disabled).map(i=>i.value);return{value:e,isValid:!!e.length}}return n[0].checked&&!n[0].disabled?n[0].attributes&&!to(n[0].attributes.value)?to(n[0].value)||n[0].value===""?_Q:{value:n[0].value,isValid:!0}:_Q:gQ}return gQ};const yQ={isValid:!1,value:null};var joe=n=>Array.isArray(n)?n.reduce((e,i)=>i&&i.checked&&!i.disabled?{isValid:!0,value:i.value}:e,yQ):yQ;function EQ(n,e,i="validate"){if(Nk(n)||Array.isArray(n)&&n.every(Nk)||Bh(n)&&!n)return{type:i,message:Nk(n)?n:"",ref:e}}var AS=n=>Ys(n)&&!v1(n)?n:{value:n,message:""},vQ=async(n,e,i,o,l,d)=>{const{ref:p,refs:_,required:E,maxLength:b,minLength:C,min:I,max:O,pattern:L,validate:V,name:B,valueAsNumber:W,mount:Z}=n._f,$=dn(i,B);if(!Z||e.has(B))return{};const se=_?_[0]:p,ue=de=>{l&&se.reportValidity&&(se.setCustomValidity(Bh(de)?"":de||""),se.reportValidity())},re={},pe=T3(p),q=AR(p),Q=pe||q,J=(W||b3(p))&&to(p.value)&&to($)||E1(p)&&p.value===""||$===""||Array.isArray($)&&!$.length,ie=wWe.bind(null,B,o,re),me=(de,le,xe,We=yp.maxLength,$e=yp.minLength)=>{const ve=de?le:xe;re[B]={type:de?We:$e,message:ve,ref:p,...ie(de?We:$e,ve)}};if(d?!Array.isArray($)||!$.length:E&&(!Q&&(J||vc($))||Bh($)&&!$||q&&!Foe(_).isValid||pe&&!joe(_).isValid)){const{value:de,message:le}=Nk(E)?{value:!!E,message:E}:AS(E);if(de&&(re[B]={type:yp.required,message:le,ref:se,...ie(yp.required,le)},!o))return ue(le),re}if(!J&&(!vc(I)||!vc(O))){let de,le;const xe=AS(O),We=AS(I);if(!vc($)&&!isNaN($)){const $e=p.valueAsNumber||$&&+$;vc(xe.value)||(de=$e>xe.value),vc(We.value)||(le=$e<We.value)}else{const $e=p.valueAsDate||new Date($),ve=ke=>new Date(new Date().toDateString()+" "+ke),_e=p.type=="time",Ee=p.type=="week";Jh(xe.value)&&$&&(de=_e?ve($)>ve(xe.value):Ee?$>xe.value:$e>new Date(xe.value)),Jh(We.value)&&$&&(le=_e?ve($)<ve(We.value):Ee?$<We.value:$e<new Date(We.value))}if((de||le)&&(me(!!de,xe.message,We.message,yp.max,yp.min),!o))return ue(re[B].message),re}if((b||C)&&!J&&(Jh($)||d&&Array.isArray($))){const de=AS(b),le=AS(C),xe=!vc(de.value)&&$.length>+de.value,We=!vc(le.value)&&$.length<+le.value;if((xe||We)&&(me(xe,de.message,le.message),!o))return ue(re[B].message),re}if(L&&!J&&Jh($)){const{value:de,message:le}=AS(L);if(v1(de)&&!$.match(de)&&(re[B]={type:yp.pattern,message:le,ref:p,...ie(yp.pattern,le)},!o))return ue(le),re}if(V){if(Kh(V)){const de=await V($,i),le=EQ(de,se);if(le&&(re[B]={...le,...ie(yp.validate,le.message)},!o))return ue(le.message),re}else if(Ys(V)){let de={};for(const le in V){if(!il(de)&&!o)break;const xe=EQ(await V[le]($,i),se,le);xe&&(de={...xe,...ie(le,xe.message)},ue(xe.message),o&&(re[B]=de))}if(!il(de)&&(re[B]={ref:se,...de},!o))return re}}return ue(!0),re};function RWe(n,e){const i=e.slice(0,-1).length;let o=0;for(;o<i;)n=to(n)?o++:n[e[o++]];return n}function IWe(n){for(const e in n)if(n.hasOwnProperty(e)&&!to(n[e]))return!1;return!0}function vo(n,e){const i=Array.isArray(e)?e:S3(e)?[e]:Voe(e),o=i.length===1?n:RWe(n,i),l=i.length-1,d=i[l];return o&&delete o[d],l!==0&&(Ys(o)&&il(o)||Array.isArray(o)&&IWe(o))&&vo(n,i.slice(0,-1)),n}var xU=()=>{let n=[];return{get observers(){return n},next:l=>{for(const d of n)d.next&&d.next(l)},subscribe:l=>(n.push(l),{unsubscribe:()=>{n=n.filter(d=>d!==l)}}),unsubscribe:()=>{n=[]}}},_F=n=>vc(n)||!Uoe(n);function Eg(n,e){if(_F(n)||_F(e))return n===e;if(Cy(n)&&Cy(e))return n.getTime()===e.getTime();const i=Object.keys(n),o=Object.keys(e);if(i.length!==o.length)return!1;for(const l of i){const d=n[l];if(!o.includes(l))return!1;if(l!=="ref"){const p=e[l];if(Cy(d)&&Cy(p)||Ys(d)&&Ys(p)||Array.isArray(d)&&Array.isArray(p)?!Eg(d,p):d!==p)return!1}}return!0}var Boe=n=>n.type==="select-multiple",AWe=n=>T3(n)||AR(n),LU=n=>E1(n)&&n.isConnected,Woe=n=>{for(const e in n)if(Kh(n[e]))return!0;return!1};function S1(n,e={}){const i=Array.isArray(n);if(Ys(n)||i)for(const o in n)Array.isArray(n[o])||Ys(n[o])&&!Woe(n[o])?(e[o]=Array.isArray(n[o])?[]:{},S1(n[o],e[o])):vc(n[o])||(e[o]=!0);return e}function zoe(n,e,i){const o=Array.isArray(n);if(Ys(n)||o)for(const l in n)Array.isArray(n[l])||Ys(n[l])&&!Woe(n[l])?to(e)||_F(i[l])?i[l]=Array.isArray(n[l])?S1(n[l],[]):{...S1(n[l])}:zoe(n[l],vc(e)?{}:e[l],i[l]):i[l]=!Eg(n[l],e[l]);return i}var Tw=(n,e)=>zoe(n,e,S1(e)),Goe=(n,{valueAsNumber:e,valueAsDate:i,setValueAs:o})=>to(n)?n:e?n===""?NaN:n&&+n:i&&Jh(n)?new Date(n):o?o(n):n;function MU(n){const e=n.ref;return b3(e)?e.files:T3(e)?joe(n.refs).value:Boe(e)?[...e.selectedOptions].map(({value:i})=>i):AR(e)?Foe(n.refs).value:Goe(to(e.value)?n.ref.value:e.value,n)}var PWe=(n,e,i,o)=>{const l={};for(const d of n){const p=dn(e,d);p&&ts(l,d,p._f)}return{criteriaMode:i,names:[...n],fields:l,shouldUseNativeValidation:o}},ww=n=>to(n)?n:v1(n)?n.source:Ys(n)?v1(n.value)?n.value.source:n.value:n;const SQ="AsyncFunction";var OWe=n=>!!n&&!!n.validate&&!!(Kh(n.validate)&&n.validate.constructor.name===SQ||Ys(n.validate)&&Object.values(n.validate).find(e=>e.constructor.name===SQ)),kWe=n=>n.mount&&(n.required||n.min||n.max||n.maxLength||n.minLength||n.pattern||n.validate);function bQ(n,e,i){const o=dn(n,i);if(o||S3(i))return{error:o,name:i};const l=i.split(".");for(;l.length;){const d=l.join("."),p=dn(e,d),_=dn(n,d);if(p&&!Array.isArray(p)&&i!==d)return{name:i};if(_&&_.type)return{name:d,error:_};l.pop()}return{name:i}}var NWe=(n,e,i,o,l)=>l.isOnAll?!1:!i&&l.isOnTouch?!(e||n):(i?o.isOnBlur:l.isOnBlur)?!n:(i?o.isOnChange:l.isOnChange)?n:!0,DWe=(n,e)=>!DN(dn(n,e)).length&&vo(n,e);const xWe={mode:xd.onSubmit,reValidateMode:xd.onChange,shouldFocusError:!0};function LWe(n={}){let e={...xWe,...n},i={submitCount:0,isDirty:!1,isLoading:Kh(e.defaultValues),isValidating:!1,isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,touchedFields:{},dirtyFields:{},validatingFields:{},errors:e.errors||{},disabled:e.disabled||!1},o={},l=Ys(e.defaultValues)||Ys(e.values)?Ou(e.defaultValues||e.values)||{}:{},d=e.shouldUnregister?{}:Ou(l),p={action:!1,mount:!1,watch:!1},_={mount:new Set,disabled:new Set,unMount:new Set,array:new Set,watch:new Set},E,b=0;const C={isDirty:!1,dirtyFields:!1,validatingFields:!1,touchedFields:!1,isValidating:!1,isValid:!1,errors:!1},I={values:xU(),array:xU(),state:xU()},O=pQ(e.mode),L=pQ(e.reValidateMode),V=e.criteriaMode===xd.all,B=Re=>Fe=>{clearTimeout(b),b=setTimeout(Re,Fe)},W=async Re=>{if(!e.disabled&&(C.isValid||Re)){const Fe=e.resolver?il((await Q()).errors):await ie(o,!0);Fe!==i.isValid&&I.state.next({isValid:Fe})}},Z=(Re,Fe)=>{!e.disabled&&(C.isValidating||C.validatingFields)&&((Re||Array.from(_.mount)).forEach(Ge=>{Ge&&(Fe?ts(i.validatingFields,Ge,Fe):vo(i.validatingFields,Ge))}),I.state.next({validatingFields:i.validatingFields,isValidating:!il(i.validatingFields)}))},$=(Re,Fe=[],Ge,at,yt=!0,vt=!0)=>{if(at&&Ge&&!e.disabled){if(p.action=!0,vt&&Array.isArray(dn(o,Re))){const Gt=Ge(dn(o,Re),at.argA,at.argB);yt&&ts(o,Re,Gt)}if(vt&&Array.isArray(dn(i.errors,Re))){const Gt=Ge(dn(i.errors,Re),at.argA,at.argB);yt&&ts(i.errors,Re,Gt),DWe(i.errors,Re)}if(C.touchedFields&&vt&&Array.isArray(dn(i.touchedFields,Re))){const Gt=Ge(dn(i.touchedFields,Re),at.argA,at.argB);yt&&ts(i.touchedFields,Re,Gt)}C.dirtyFields&&(i.dirtyFields=Tw(l,d)),I.state.next({name:Re,isDirty:de(Re,Fe),dirtyFields:i.dirtyFields,errors:i.errors,isValid:i.isValid})}else ts(d,Re,Fe)},se=(Re,Fe)=>{ts(i.errors,Re,Fe),I.state.next({errors:i.errors})},ue=Re=>{i.errors=Re,I.state.next({errors:i.errors,isValid:!1})},re=(Re,Fe,Ge,at)=>{const yt=dn(o,Re);if(yt){const vt=dn(d,Re,to(Ge)?dn(l,Re):Ge);to(vt)||at&&at.defaultChecked||Fe?ts(d,Re,Fe?vt:MU(yt._f)):We(Re,vt),p.mount&&W()}},pe=(Re,Fe,Ge,at,yt)=>{let vt=!1,Gt=!1;const gn={name:Re};if(!e.disabled){const Pn=!!(dn(o,Re)&&dn(o,Re)._f&&dn(o,Re)._f.disabled);if(!Ge||at){C.isDirty&&(Gt=i.isDirty,i.isDirty=gn.isDirty=de(),vt=Gt!==gn.isDirty);const un=Pn||Eg(dn(l,Re),Fe);Gt=!!(!Pn&&dn(i.dirtyFields,Re)),un||Pn?vo(i.dirtyFields,Re):ts(i.dirtyFields,Re,!0),gn.dirtyFields=i.dirtyFields,vt=vt||C.dirtyFields&&Gt!==!un}if(Ge){const un=dn(i.touchedFields,Re);un||(ts(i.touchedFields,Re,Ge),gn.touchedFields=i.touchedFields,vt=vt||C.touchedFields&&un!==Ge)}vt&&yt&&I.state.next(gn)}return vt?gn:{}},q=(Re,Fe,Ge,at)=>{const yt=dn(i.errors,Re),vt=C.isValid&&Bh(Fe)&&i.isValid!==Fe;if(e.delayError&&Ge?(E=B(()=>se(Re,Ge)),E(e.delayError)):(clearTimeout(b),E=null,Ge?ts(i.errors,Re,Ge):vo(i.errors,Re)),(Ge?!Eg(yt,Ge):yt)||!il(at)||vt){const Gt={...at,...vt&&Bh(Fe)?{isValid:Fe}:{},errors:i.errors,name:Re};i={...i,...Gt},I.state.next(Gt)}},Q=async Re=>{Z(Re,!0);const Fe=await e.resolver(d,e.context,PWe(Re||_.mount,o,e.criteriaMode,e.shouldUseNativeValidation));return Z(Re),Fe},J=async Re=>{const{errors:Fe}=await Q(Re);if(Re)for(const Ge of Re){const at=dn(Fe,Ge);at?ts(i.errors,Ge,at):vo(i.errors,Ge)}else i.errors=Fe;return Fe},ie=async(Re,Fe,Ge={valid:!0})=>{for(const at in Re){const yt=Re[at];if(yt){const{_f:vt,...Gt}=yt;if(vt){const gn=_.array.has(vt.name),Pn=yt._f&&OWe(yt._f);Pn&&C.validatingFields&&Z([at],!0);const un=await vQ(yt,_.disabled,d,V,e.shouldUseNativeValidation&&!Fe,gn);if(Pn&&C.validatingFields&&Z([at]),un[vt.name]&&(Ge.valid=!1,Fe))break;!Fe&&(dn(un,vt.name)?gn?CWe(i.errors,un,vt.name):ts(i.errors,vt.name,un[vt.name]):vo(i.errors,vt.name))}!il(Gt)&&await ie(Gt,Fe,Ge)}}return Ge.valid},me=()=>{for(const Re of _.unMount){const Fe=dn(o,Re);Fe&&(Fe._f.refs?Fe._f.refs.every(Ge=>!LU(Ge)):!LU(Fe._f.ref))&&Je(Re)}_.unMount=new Set},de=(Re,Fe)=>!e.disabled&&(Re&&Fe&&ts(d,Re,Fe),!Eg(we(),l)),le=(Re,Fe,Ge)=>TWe(Re,_,{...p.mount?d:to(Fe)?l:Jh(Re)?{[Re]:Fe}:Fe},Ge,Fe),xe=Re=>DN(dn(p.mount?d:l,Re,e.shouldUnregister?dn(l,Re,[]):[])),We=(Re,Fe,Ge={})=>{const at=dn(o,Re);let yt=Fe;if(at){const vt=at._f;vt&&(!vt.disabled&&ts(d,Re,Goe(Fe,vt)),yt=E1(vt.ref)&&vc(Fe)?"":Fe,Boe(vt.ref)?[...vt.ref.options].forEach(Gt=>Gt.selected=yt.includes(Gt.value)):vt.refs?AR(vt.ref)?vt.refs.length>1?vt.refs.forEach(Gt=>(!Gt.defaultChecked||!Gt.disabled)&&(Gt.checked=Array.isArray(yt)?!!yt.find(gn=>gn===Gt.value):yt===Gt.value)):vt.refs[0]&&(vt.refs[0].checked=!!yt):vt.refs.forEach(Gt=>Gt.checked=Gt.value===yt):b3(vt.ref)?vt.ref.value="":(vt.ref.value=yt,vt.ref.type||I.values.next({name:Re,values:{...d}})))}(Ge.shouldDirty||Ge.shouldTouch)&&pe(Re,yt,Ge.shouldTouch,Ge.shouldDirty,!0),Ge.shouldValidate&&ke(Re)},$e=(Re,Fe,Ge)=>{for(const at in Fe){const yt=Fe[at],vt=`${Re}.${at}`,Gt=dn(o,vt);(_.array.has(Re)||Ys(yt)||Gt&&!Gt._f)&&!Cy(yt)?$e(vt,yt,Ge):We(vt,yt,Ge)}},ve=(Re,Fe,Ge={})=>{const at=dn(o,Re),yt=_.array.has(Re),vt=Ou(Fe);ts(d,Re,vt),yt?(I.array.next({name:Re,values:{...d}}),(C.isDirty||C.dirtyFields)&&Ge.shouldDirty&&I.state.next({name:Re,dirtyFields:Tw(l,d),isDirty:de(Re,vt)})):at&&!at._f&&!vc(vt)?$e(Re,vt,Ge):We(Re,vt,Ge),mQ(Re,_)&&I.state.next({...i}),I.values.next({name:p.mount?Re:void 0,values:{...d}})},_e=async Re=>{p.mount=!0;const Fe=Re.target;let Ge=Fe.name,at=!0;const yt=dn(o,Ge),vt=()=>Fe.type?MU(yt._f):gWe(Re),Gt=gn=>{at=Number.isNaN(gn)||Cy(gn)&&isNaN(gn.getTime())||Eg(gn,dn(d,Ge,gn))};if(yt){let gn,Pn;const un=vt(),wt=Re.type===fQ.BLUR||Re.type===fQ.FOCUS_OUT,lr=!kWe(yt._f)&&!e.resolver&&!dn(i.errors,Ge)&&!yt._f.deps||NWe(wt,dn(i.touchedFields,Ge),i.isSubmitted,L,O),Dt=mQ(Ge,_,wt);ts(d,Ge,un),wt?(yt._f.onBlur&&yt._f.onBlur(Re),E&&E(0)):yt._f.onChange&&yt._f.onChange(Re);const qt=pe(Ge,un,wt,!1),Qr=!il(qt)||Dt;if(!wt&&I.values.next({name:Ge,type:Re.type,values:{...d}}),lr)return C.isValid&&(e.mode==="onBlur"&&wt?W():wt||W()),Qr&&I.state.next({name:Ge,...Dt?{}:qt});if(!wt&&Dt&&I.state.next({...i}),e.resolver){const{errors:Hi}=await Q([Ge]);if(Gt(un),at){const Vs=bQ(i.errors,o,Ge),ai=bQ(Hi,o,Vs.name||Ge);gn=ai.error,Ge=ai.name,Pn=il(Hi)}}else Z([Ge],!0),gn=(await vQ(yt,_.disabled,d,V,e.shouldUseNativeValidation))[Ge],Z([Ge]),Gt(un),at&&(gn?Pn=!1:C.isValid&&(Pn=await ie(o,!0)));at&&(yt._f.deps&&ke(yt._f.deps),q(Ge,Pn,gn,qt))}},Ee=(Re,Fe)=>{if(dn(i.errors,Fe)&&Re.focus)return Re.focus(),1},ke=async(Re,Fe={})=>{let Ge,at;const yt=kk(Re);if(e.resolver){const vt=await J(to(Re)?Re:yt);Ge=il(vt),at=Re?!yt.some(Gt=>dn(vt,Gt)):Ge}else Re?(at=(await Promise.all(yt.map(async vt=>{const Gt=dn(o,vt);return await ie(Gt&&Gt._f?{[vt]:Gt}:Gt)}))).every(Boolean),!(!at&&!i.isValid)&&W()):at=Ge=await ie(o);return I.state.next({...!Jh(Re)||C.isValid&&Ge!==i.isValid?{}:{name:Re},...e.resolver||!Re?{isValid:Ge}:{},errors:i.errors}),Fe.shouldFocus&&!at&&yC(o,Ee,Re?yt:_.mount),at},we=Re=>{const Fe={...p.mount?d:l};return to(Re)?Fe:Jh(Re)?dn(Fe,Re):Re.map(Ge=>dn(Fe,Ge))},be=(Re,Fe)=>({invalid:!!dn((Fe||i).errors,Re),isDirty:!!dn((Fe||i).dirtyFields,Re),error:dn((Fe||i).errors,Re),isValidating:!!dn(i.validatingFields,Re),isTouched:!!dn((Fe||i).touchedFields,Re)}),Ie=Re=>{Re&&kk(Re).forEach(Fe=>vo(i.errors,Fe)),I.state.next({errors:Re?i.errors:{}})},Me=(Re,Fe,Ge)=>{const at=(dn(o,Re,{_f:{}})._f||{}).ref,yt=dn(i.errors,Re)||{},{ref:vt,message:Gt,type:gn,...Pn}=yt;ts(i.errors,Re,{...Pn,...Fe,ref:at}),I.state.next({name:Re,errors:i.errors,isValid:!1}),Ge&&Ge.shouldFocus&&at&&at.focus&&at.focus()},ze=(Re,Fe)=>Kh(Re)?I.values.subscribe({next:Ge=>Re(le(void 0,Fe),Ge)}):le(Re,Fe,!0),Je=(Re,Fe={})=>{for(const Ge of Re?kk(Re):_.mount)_.mount.delete(Ge),_.array.delete(Ge),Fe.keepValue||(vo(o,Ge),vo(d,Ge)),!Fe.keepError&&vo(i.errors,Ge),!Fe.keepDirty&&vo(i.dirtyFields,Ge),!Fe.keepTouched&&vo(i.touchedFields,Ge),!Fe.keepIsValidating&&vo(i.validatingFields,Ge),!e.shouldUnregister&&!Fe.keepDefaultValue&&vo(l,Ge);I.values.next({values:{...d}}),I.state.next({...i,...Fe.keepDirty?{isDirty:de()}:{}}),!Fe.keepIsValid&&W()},tt=({disabled:Re,name:Fe,field:Ge,fields:at})=>{(Bh(Re)&&p.mount||Re||_.disabled.has(Fe))&&(Re?_.disabled.add(Fe):_.disabled.delete(Fe),pe(Fe,MU(Ge?Ge._f:dn(at,Fe)._f),!1,!1,!0))},ut=(Re,Fe={})=>{let Ge=dn(o,Re);const at=Bh(Fe.disabled)||Bh(e.disabled);return ts(o,Re,{...Ge||{},_f:{...Ge&&Ge._f?Ge._f:{ref:{name:Re}},name:Re,mount:!0,...Fe}}),_.mount.add(Re),Ge?tt({field:Ge,disabled:Bh(Fe.disabled)?Fe.disabled:e.disabled,name:Re}):re(Re,!0,Fe.value),{...at?{disabled:Fe.disabled||e.disabled}:{},...e.progressive?{required:!!Fe.required,min:ww(Fe.min),max:ww(Fe.max),minLength:ww(Fe.minLength),maxLength:ww(Fe.maxLength),pattern:ww(Fe.pattern)}:{},name:Re,onChange:_e,onBlur:_e,ref:yt=>{if(yt){ut(Re,Fe),Ge=dn(o,Re);const vt=to(yt.value)&&yt.querySelectorAll&&yt.querySelectorAll("input,select,textarea")[0]||yt,Gt=AWe(vt),gn=Ge._f.refs||[];if(Gt?gn.find(Pn=>Pn===vt):vt===Ge._f.ref)return;ts(o,Re,{_f:{...Ge._f,...Gt?{refs:[...gn.filter(LU),vt,...Array.isArray(dn(l,Re))?[{}]:[]],ref:{type:vt.type,name:Re}}:{ref:vt}}}),re(Re,!1,void 0,vt)}else Ge=dn(o,Re,{}),Ge._f&&(Ge._f.mount=!1),(e.shouldUnregister||Fe.shouldUnregister)&&!(yWe(_.array,Re)&&p.action)&&_.unMount.add(Re)}}},Ze=()=>e.shouldFocusError&&yC(o,Ee,_.mount),bt=Re=>{Bh(Re)&&(I.state.next({disabled:Re}),yC(o,(Fe,Ge)=>{const at=dn(o,Ge);at&&(Fe.disabled=at._f.disabled||Re,Array.isArray(at._f.refs)&&at._f.refs.forEach(yt=>{yt.disabled=at._f.disabled||Re}))},0,!1))},on=(Re,Fe)=>async Ge=>{let at;Ge&&(Ge.preventDefault&&Ge.preventDefault(),Ge.persist&&Ge.persist());let yt=Ou(d);if(_.disabled.size)for(const vt of _.disabled)ts(yt,vt,void 0);if(I.state.next({isSubmitting:!0}),e.resolver){const{errors:vt,values:Gt}=await Q();i.errors=vt,yt=Gt}else await ie(o);if(vo(i.errors,"root"),il(i.errors)){I.state.next({errors:{}});try{await Re(yt,Ge)}catch(vt){at=vt}}else Fe&&await Fe({...i.errors},Ge),Ze(),setTimeout(Ze);if(I.state.next({isSubmitted:!0,isSubmitting:!1,isSubmitSuccessful:il(i.errors)&&!at,submitCount:i.submitCount+1,errors:i.errors}),at)throw at},Mt=(Re,Fe={})=>{dn(o,Re)&&(to(Fe.defaultValue)?ve(Re,Ou(dn(l,Re))):(ve(Re,Fe.defaultValue),ts(l,Re,Ou(Fe.defaultValue))),Fe.keepTouched||vo(i.touchedFields,Re),Fe.keepDirty||(vo(i.dirtyFields,Re),i.isDirty=Fe.defaultValue?de(Re,Ou(dn(l,Re))):de()),Fe.keepError||(vo(i.errors,Re),C.isValid&&W()),I.state.next({...i}))},Zt=(Re,Fe={})=>{const Ge=Re?Ou(Re):l,at=Ou(Ge),yt=il(Re),vt=yt?l:at;if(Fe.keepDefaultValues||(l=Ge),!Fe.keepValues){if(Fe.keepDirtyValues){const Gt=new Set([..._.mount,...Object.keys(Tw(l,d))]);for(const gn of Array.from(Gt))dn(i.dirtyFields,gn)?ts(vt,gn,dn(d,gn)):ve(gn,dn(vt,gn))}else{if(v3&&to(Re))for(const Gt of _.mount){const gn=dn(o,Gt);if(gn&&gn._f){const Pn=Array.isArray(gn._f.refs)?gn._f.refs[0]:gn._f.ref;if(E1(Pn)){const un=Pn.closest("form");if(un){un.reset();break}}}}o={}}d=e.shouldUnregister?Fe.keepDefaultValues?Ou(l):{}:Ou(vt),I.array.next({values:{...vt}}),I.values.next({values:{...vt}})}_={mount:Fe.keepDirtyValues?_.mount:new Set,unMount:new Set,array:new Set,disabled:new Set,watch:new Set,watchAll:!1,focus:""},p.mount=!C.isValid||!!Fe.keepIsValid||!!Fe.keepDirtyValues,p.watch=!!e.shouldUnregister,I.state.next({submitCount:Fe.keepSubmitCount?i.submitCount:0,isDirty:yt?!1:Fe.keepDirty?i.isDirty:!!(Fe.keepDefaultValues&&!Eg(Re,l)),isSubmitted:Fe.keepIsSubmitted?i.isSubmitted:!1,dirtyFields:yt?{}:Fe.keepDirtyValues?Fe.keepDefaultValues&&d?Tw(l,d):i.dirtyFields:Fe.keepDefaultValues&&Re?Tw(l,Re):Fe.keepDirty?i.dirtyFields:{},touchedFields:Fe.keepTouched?i.touchedFields:{},errors:Fe.keepErrors?i.errors:{},isSubmitSuccessful:Fe.keepIsSubmitSuccessful?i.isSubmitSuccessful:!1,isSubmitting:!1})},an=(Re,Fe)=>Zt(Kh(Re)?Re(d):Re,Fe);return{control:{register:ut,unregister:Je,getFieldState:be,handleSubmit:on,setError:Me,_executeSchema:Q,_getWatch:le,_getDirty:de,_updateValid:W,_removeUnmounted:me,_updateFieldArray:$,_updateDisabledField:tt,_getFieldArray:xe,_reset:Zt,_resetDefaultValues:()=>Kh(e.defaultValues)&&e.defaultValues().then(Re=>{an(Re,e.resetOptions),I.state.next({isLoading:!1})}),_updateFormState:Re=>{i={...i,...Re}},_disableForm:bt,_subjects:I,_proxyFormState:C,_setErrors:ue,get _fields(){return o},get _formValues(){return d},get _state(){return p},set _state(Re){p=Re},get _defaultValues(){return l},get _names(){return _},set _names(Re){_=Re},get _formState(){return i},set _formState(Re){i=Re},get _options(){return e},set _options(Re){e={...e,...Re}}},trigger:ke,register:ut,handleSubmit:on,watch:ze,setValue:ve,getValues:we,reset:an,resetField:Mt,clearErrors:Ie,unregister:Je,setError:Me,setFocus:(Re,Fe={})=>{const Ge=dn(o,Re),at=Ge&&Ge._f;if(at){const yt=at.refs?at.refs[0]:at.ref;yt.focus&&(yt.focus(),Fe.shouldSelect&&Kh(yt.select)&&yt.select())}},getFieldState:be}}function Hoe(n={}){const e=fi.useRef(void 0),i=fi.useRef(void 0),[o,l]=fi.useState({isDirty:!1,isValidating:!1,isLoading:Kh(n.defaultValues),isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,submitCount:0,dirtyFields:{},touchedFields:{},validatingFields:{},errors:n.errors||{},disabled:n.disabled||!1,defaultValues:Kh(n.defaultValues)?void 0:n.defaultValues});e.current||(e.current={...LWe(n),formState:o});const d=e.current.control;return d._options=n,bWe({subject:d._subjects.state,next:p=>{SWe(p,d._proxyFormState,d._updateFormState)&&l({...d._formState})}}),fi.useEffect(()=>d._disableForm(n.disabled),[d,n.disabled]),fi.useEffect(()=>{if(d._proxyFormState.isDirty){const p=d._getDirty();p!==o.isDirty&&d._subjects.state.next({isDirty:p})}},[d,o.isDirty]),fi.useEffect(()=>{n.values&&!Eg(n.values,i.current)?(d._reset(n.values,d._options.resetOptions),i.current=n.values,l(p=>({...p}))):d._resetDefaultValues()},[n.values,d]),fi.useEffect(()=>{n.errors&&d._setErrors(n.errors)},[n.errors,d]),fi.useEffect(()=>{d._state.mount||(d._updateValid(),d._state.mount=!0),d._state.watch&&(d._state.watch=!1,d._subjects.state.next({...d._formState})),d._removeUnmounted()}),fi.useEffect(()=>{n.shouldUnregister&&d._subjects.values.next({values:d._getWatch()})},[n.shouldUnregister,d]),e.current.formState=vWe(o,d),e.current}var MWe=["sitekey","onChange","theme","type","tabindex","onExpired","onErrored","size","stoken","grecaptcha","badge","hl","isolated"];function yF(){return yF=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])}return n},yF.apply(this,arguments)}function UWe(n,e){if(n==null)return{};var i={},o=Object.keys(n),l,d;for(d=0;d<o.length;d++)l=o[d],!(e.indexOf(l)>=0)&&(i[l]=n[l]);return i}function zO(n){if(n===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}function VWe(n,e){n.prototype=Object.create(e.prototype),n.prototype.constructor=n,EF(n,e)}function EF(n,e){return EF=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(o,l){return o.__proto__=l,o},EF(n,e)}var xN=function(n){VWe(e,n);function e(){var o;return o=n.call(this)||this,o.handleExpired=o.handleExpired.bind(zO(o)),o.handleErrored=o.handleErrored.bind(zO(o)),o.handleChange=o.handleChange.bind(zO(o)),o.handleRecaptchaRef=o.handleRecaptchaRef.bind(zO(o)),o}var i=e.prototype;return i.getCaptchaFunction=function(l){return this.props.grecaptcha?this.props.grecaptcha.enterprise?this.props.grecaptcha.enterprise[l]:this.props.grecaptcha[l]:null},i.getValue=function(){var l=this.getCaptchaFunction("getResponse");return l&&this._widgetId!==void 0?l(this._widgetId):null},i.getWidgetId=function(){return this.props.grecaptcha&&this._widgetId!==void 0?this._widgetId:null},i.execute=function(){var l=this.getCaptchaFunction("execute");if(l&&this._widgetId!==void 0)return l(this._widgetId);this._executeRequested=!0},i.executeAsync=function(){var l=this;return new Promise(function(d,p){l.executionResolve=d,l.executionReject=p,l.execute()})},i.reset=function(){var l=this.getCaptchaFunction("reset");l&&this._widgetId!==void 0&&l(this._widgetId)},i.forceReset=function(){var l=this.getCaptchaFunction("reset");l&&l()},i.handleExpired=function(){this.props.onExpired?this.props.onExpired():this.handleChange(null)},i.handleErrored=function(){this.props.onErrored&&this.props.onErrored(),this.executionReject&&(this.executionReject(),delete this.executionResolve,delete this.executionReject)},i.handleChange=function(l){this.props.onChange&&this.props.onChange(l),this.executionResolve&&(this.executionResolve(l),delete this.executionReject,delete this.executionResolve)},i.explicitRender=function(){var l=this.getCaptchaFunction("render");if(l&&this._widgetId===void 0){var d=document.createElement("div");this._widgetId=l(d,{sitekey:this.props.sitekey,callback:this.handleChange,theme:this.props.theme,type:this.props.type,tabindex:this.props.tabindex,"expired-callback":this.handleExpired,"error-callback":this.handleErrored,size:this.props.size,stoken:this.props.stoken,hl:this.props.hl,badge:this.props.badge,isolated:this.props.isolated}),this.captcha.appendChild(d)}this._executeRequested&&this.props.grecaptcha&&this._widgetId!==void 0&&(this._executeRequested=!1,this.execute())},i.componentDidMount=function(){this.explicitRender()},i.componentDidUpdate=function(){this.explicitRender()},i.handleRecaptchaRef=function(l){this.captcha=l},i.render=function(){var l=this.props;l.sitekey,l.onChange,l.theme,l.type,l.tabindex,l.onExpired,l.onErrored,l.size,l.stoken,l.grecaptcha,l.badge,l.hl,l.isolated;var d=UWe(l,MWe);return D.createElement("div",yF({},d,{ref:this.handleRecaptchaRef}))},e}(D.Component);xN.displayName="ReCAPTCHA";xN.propTypes={sitekey:mn.string.isRequired,onChange:mn.func,grecaptcha:mn.object,theme:mn.oneOf(["dark","light"]),type:mn.oneOf(["image","audio"]),tabindex:mn.number,onExpired:mn.func,onErrored:mn.func,size:mn.oneOf(["compact","normal","invisible"]),stoken:mn.string,hl:mn.string,badge:mn.oneOf(["bottomright","bottomleft","inline"]),isolated:mn.bool};xN.defaultProps={onChange:function(){},theme:"light",type:"image",tabindex:0,size:"normal",badge:"bottomright"};function vF(){return vF=Object.assign||function(n){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])}return n},vF.apply(this,arguments)}function FWe(n,e){if(n==null)return{};var i={},o=Object.keys(n),l,d;for(d=0;d<o.length;d++)l=o[d],!(e.indexOf(l)>=0)&&(i[l]=n[l]);return i}function jWe(n,e){n.prototype=Object.create(e.prototype),n.prototype.constructor=n,n.__proto__=e}var Pd={},BWe=0;function WWe(n,e){return e=e||{},function(o){var l=o.displayName||o.name||"Component",d=function(_){jWe(E,_);function E(C,I){var O;return O=_.call(this,C,I)||this,O.state={},O.__scriptURL="",O}var b=E.prototype;return b.asyncScriptLoaderGetScriptLoaderID=function(){return this.__scriptLoaderID||(this.__scriptLoaderID="async-script-loader-"+BWe++),this.__scriptLoaderID},b.setupScriptURL=function(){return this.__scriptURL=typeof n=="function"?n():n,this.__scriptURL},b.asyncScriptLoaderHandleLoad=function(I){var O=this;this.setState(I,function(){return O.props.asyncScriptOnLoad&&O.props.asyncScriptOnLoad(O.state)})},b.asyncScriptLoaderTriggerOnScriptLoaded=function(){var I=Pd[this.__scriptURL];if(!I||!I.loaded)throw new Error("Script is not loaded.");for(var O in I.observers)I.observers[O](I);delete window[e.callbackName]},b.componentDidMount=function(){var I=this,O=this.setupScriptURL(),L=this.asyncScriptLoaderGetScriptLoaderID(),V=e,B=V.globalName,W=V.callbackName,Z=V.scriptId;if(B&&typeof window[B]<"u"&&(Pd[O]={loaded:!0,observers:{}}),Pd[O]){var $=Pd[O];if($&&($.loaded||$.errored)){this.asyncScriptLoaderHandleLoad($);return}$.observers[L]=function(q){return I.asyncScriptLoaderHandleLoad(q)};return}var se={};se[L]=function(q){return I.asyncScriptLoaderHandleLoad(q)},Pd[O]={loaded:!1,observers:se};var ue=document.createElement("script");ue.src=O,ue.async=!0;for(var re in e.attributes)ue.setAttribute(re,e.attributes[re]);Z&&(ue.id=Z);var pe=function(Q){if(Pd[O]){var J=Pd[O],ie=J.observers;for(var me in ie)Q(ie[me])&&delete ie[me]}};W&&typeof window<"u"&&(window[W]=function(){return I.asyncScriptLoaderTriggerOnScriptLoaded()}),ue.onload=function(){var q=Pd[O];q&&(q.loaded=!0,pe(function(Q){return W?!1:(Q(q),!0)}))},ue.onerror=function(){var q=Pd[O];q&&(q.errored=!0,pe(function(Q){return Q(q),!0}))},document.body.appendChild(ue)},b.componentWillUnmount=function(){var I=this.__scriptURL;if(e.removeOnUnmount===!0)for(var O=document.getElementsByTagName("script"),L=0;L<O.length;L+=1)O[L].src.indexOf(I)>-1&&O[L].parentNode&&O[L].parentNode.removeChild(O[L]);var V=Pd[I];V&&(delete V.observers[this.asyncScriptLoaderGetScriptLoaderID()],e.removeOnUnmount===!0&&delete Pd[I])},b.render=function(){var I=e.globalName,O=this.props;O.asyncScriptOnLoad;var L=O.forwardedRef,V=FWe(O,["asyncScriptOnLoad","forwardedRef"]);return I&&typeof window<"u"&&(V[I]=typeof window[I]<"u"?window[I]:void 0),V.ref=L,D.createElement(o,V)},E}(D.Component),p=D.forwardRef(function(_,E){return D.createElement(d,vF({},_,{forwardedRef:E}))});return p.displayName="AsyncScriptLoader("+l+")",p.propTypes={asyncScriptOnLoad:mn.func},PIe(p,o)}}var SF="onloadcallback",zWe="grecaptcha";function bF(){return typeof window<"u"&&window.recaptchaOptions||{}}function GWe(){var n=bF(),e=n.useRecaptchaNet?"recaptcha.net":"www.google.com";return n.enterprise?"https://"+e+"/recaptcha/enterprise.js?onload="+SF+"&render=explicit":"https://"+e+"/recaptcha/api.js?onload="+SF+"&render=explicit"}const $oe=WWe(GWe,{callbackName:SF,globalName:zWe,attributes:bF().nonce?{nonce:bF().nonce}:{}})(xN),LN=(n,e="generic-modal")=>{D.useEffect(()=>{if(!window.unityInstance)return;const i=()=>{try{window.unityInstance.SendMessage("WebGLInputManager","Disable"),Y.log(`Unity input disabled for ${e}`),document.body.classList.add("unity-input-disabled"),window.unityInputDisabled=!0,window.unityInputDisabledBy=e}catch(l){Y.error(`Failed to disable Unity input for ${e}:`,l)}},o=()=>{try{window.unityInputDisabledBy===e?(window.unityInstance.SendMessage("WebGLInputManager","Enable"),Y.log(`Unity input re-enabled (was disabled by ${e})`),document.body.classList.remove("unity-input-disabled"),window.unityInputDisabled=!1,window.unityInputDisabledBy=null):Y.log(`Not re-enabling Unity input for ${e} because it was disabled by ${window.unityInputDisabledBy}`)}catch(l){Y.error(`Failed to enable Unity input for ${e}:`,l)}};return n?i():o(),()=>{n&&o()}},[n,e])},Koe=({isOpen:n,onClose:e,userData:i,onConfirm:o,fullscreenRef:l})=>{const[d,p]=D.useState((i==null?void 0:i.username)||""),[_,E]=D.useState((i==null?void 0:i.Nickname)||""),[b,C]=D.useState(!1),[I,O]=D.useState(null),[L,V]=D.useState(!1),B=wc(),W=ue=>/^[a-z0-9]{1,15}$/.test(ue),Z=async ue=>{var re,pe;if(!W(ue))return O("Username must be 1-15 characters, lowercase letters and numbers only"),!1;C(!0),O(null);try{let q=!1,Q=0;const J=3;for(;Q<J;)try{q=await qC(ue);break}catch(ie){if(Y.error(`Attempt ${Q+1}: Error checking username:`,ie),Q++,Q>=J)throw ie;await new Promise(me=>setTimeout(me,1e3))}return q?(O("Username is already taken"),!1):!0}catch(q){return Y.error("Error checking username after retries:",q),q.code==="permission-denied"||(re=q.message)!=null&&re.includes("permissions")?O("Username check unavailable. Please try again or pick a unique name."):O("Error checking username availability. Please try again."),q.code==="permission-denied"||((pe=q.message)==null?void 0:pe.includes("permissions"))}finally{C(!1)}};D.useEffect(()=>{if(!d){O("Username cannot be empty");return}if(d!==(i==null?void 0:i.username)){const ue=setTimeout(async()=>{await Z(d)},500);return()=>clearTimeout(ue)}},[d]),D.useEffect(()=>{if(i&&i.firstName&&i.lastName){const ue=`${i.firstName}${i.lastName.charAt(0).toUpperCase()}`;E(ue)}},[i]);const $=async()=>{V(!0);try{if(!await Z(d)){V(!1);return}if(_.length>15){O("Display Name must be at most 15 characters"),V(!1);return}Y.log("UsernameConfirmation: Preparing to confirm user registration");const re=i.firstName&&i.lastName?`${i.firstName}${i.lastName.charAt(0).toUpperCase()}`:"",pe={...i,firstName:i.firstName||"",lastName:i.lastName||"",companyName:i.companyName||"",linkedInProfile:i.linkedInProfile||"",username:d,Nickname:_||re,email:i.email,password:i.password};Y.log("UsernameConfirmation: Processed registration data with fields:",Object.keys(pe).join(", ")),await o(pe),e()}catch(ue){Y.error("Error during username confirmation:",ue),B({title:"Error",description:"An error occurred. Please try again.",status:"error",duration:3e3,isClosable:!0})}finally{V(!1)}},se=()=>{L||e()};return w.jsxs(so,{isOpen:n,onClose:se,size:"md",portalProps:{containerRef:l},isCentered:!0,motionPreset:"slideInBottom",closeOnOverlayClick:!L,closeOnEsc:!L,children:[w.jsx(ao,{bg:"blackAlpha.800",backdropFilter:"blur(5px)"}),w.jsxs(oo,{bg:"gray.800",borderRadius:"xl",boxShadow:"xl",color:"white",maxW:"md",mx:4,position:"relative",children:[w.jsxs(ec,{children:[w.jsx(VC,{size:"lg",mb:2,children:"Customize Your Profile"}),w.jsx(nt,{fontSize:"sm",color:"gray.400",children:"Set your username and nickname"})]}),w.jsx(zo,{color:"gray.400",isDisabled:L}),w.jsx(wo,{children:w.jsxs(Jr,{spacing:6,align:"stretch",children:[w.jsxs(Mr,{isInvalid:!!I,children:[w.jsx(ns,{children:"Username"}),w.jsxs(Sg,{children:[w.jsx(G1,{bg:"gray.700",color:"gray.400",border:"none",children:"@"}),w.jsx(pi,{placeholder:"username",value:d,onChange:ue=>p(ue.target.value.toLowerCase()),bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},maxLength:15})]}),I?w.jsx(Gh,{children:I}):w.jsx(E0,{color:"gray.400",children:"Lowercase letters and numbers only, max 15 characters"})]}),w.jsxs(Mr,{children:[w.jsx(ns,{children:"Nickname"}),w.jsx(pi,{placeholder:"Nickname",value:_,onChange:ue=>E(ue.target.value),bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},maxLength:15}),w.jsx(E0,{color:"gray.400",children:"This is the name shown to others, max 15 characters"})]})]})}),w.jsx(zp,{children:w.jsxs(Ar,{gap:3,width:"100%",children:[w.jsx(br,{variant:"outline",onClick:se,flex:"1",isDisabled:L,children:"Back"}),w.jsx(br,{colorScheme:"blue",onClick:$,isLoading:L||b,isDisabled:!!I||!d||L,flex:"2",children:"Finish"})]})})]})]})};Koe.propTypes={isOpen:mn.bool.isRequired,onClose:mn.func.isRequired,userData:mn.object.isRequired,onConfirm:mn.func.isRequired,fullscreenRef:mn.object};const HWe="6Le4oQUrAAAAAHe0GMH5Z0tpuqTV2qqDzK9Yk4Uv";function MN({mode:n,label:e,buttonProps:i={},isOpen:o,onClose:l}){const{register:d,handleSubmit:p,formState:{errors:_}}=Hoe(),{register:E}=D.useContext(Go),b=wc(),{fullscreenRef:C}=Bd(),[I,O]=D.useState(!1),[L,V]=D.useState(!1),[B,W]=D.useState(null),Z=D.useRef(null),[$,se]=D.useState(!1),[ue,re]=D.useState(null),[pe,q]=D.useState(!1),Q=o!==void 0?o:I,J=l||(()=>O(!1));LN(Q||$),D.useEffect(()=>{!Q&&Z.current&&(Z.current.reset(),W(null))},[Q]);const ie=We=>{W(We)},me=async We=>{Y.log("Register.jsx: Processing registration form submission");const{email:$e,password:ve,confirmPassword:_e,...Ee}=We;if(Y.log("Register.jsx: Registration data fields:",Object.keys(Ee).join(", ")),!B){b({title:"Verification Required",description:"Please complete the reCAPTCHA verification.",status:"error",duration:3e3,isClosable:!0,position:"top"});return}if(ve!==_e){b({title:"Error",description:"Passwords do not match.",status:"error",duration:3e3,isClosable:!0,position:"top"});return}V(!0);try{const ke=await xBe(Ee.firstName||"",Ee.lastName||""),we=Ee.firstName&&Ee.lastName?`${Ee.firstName}${Ee.lastName.charAt(0).toUpperCase()}`:"";Y.log("Register.jsx: Generated username and nickname for new user");const be={...Ee,firstName:Ee.firstName||"",lastName:Ee.lastName||"",companyName:Ee.companyName||"",linkedInProfile:Ee.linkedInProfile||"",email:$e,password:ve,username:ke,Nickname:we,captchaToken:B};Y.log("Register.jsx: Prepared registration data with fields:",Object.keys(be).join(", ")),re(be),se(!0)}catch(ke){Y.error("User: Registration Error:",ke);let we="An error occurred during registration. Please try again.",be=!1;ke.code==="auth/email-already-in-use"?(we="This email address is already registered. Please sign in instead.",be=!0):ke.code==="auth/invalid-email"?we="The email address is not valid. Please check and try again.":ke.code==="auth/weak-password"?we="The password is too weak. Please choose a stronger password.":ke.message&&(we=ke.message),b({title:"Registration Failed",description:w.jsxs(w.Fragment,{children:[we,be&&w.jsx(nt,{mt:2,children:w.jsx(Ml,{color:"blue.400",onClick:()=>{J(),window.dispatchEvent(new CustomEvent("openSignInModal"))},children:"Go to Sign In"})})]}),status:"error",duration:5e3,isClosable:!0,position:"top"})}finally{V(!1),Z.current&&Z.current.reset()}},de=async We=>{V(!0);try{Y.log("Register.jsx: Completing registration with confirmed username");const{email:$e,password:ve,..._e}=We,Ee={..._e,firstName:_e.firstName||"",lastName:_e.lastName||"",companyName:_e.companyName||"",linkedInProfile:_e.linkedInProfile||"",username:_e.username||"",Nickname:_e.Nickname||""};Y.log("Register.jsx: Final registration data includes fields:",Object.keys(Ee).join(", "));const ke=await E($e,ve,Ee);J(),se(!1),Y.log("User: Registration process complete."),re(null),q(!1)}catch($e){Y.error("User: Registration Error during final step:",$e);let ve="An error occurred during registration. Please try again.";$e.code==="auth/email-already-in-use"?ve="This email address is already in use. Please try another one.":$e.message&&(ve=$e.message),b({title:"Registration Failed",description:ve,status:"error",duration:5e3,isClosable:!0,position:"top"}),se(!1),re(null),q(!1)}finally{V(!1)}},le=()=>{l?l():O(!I)},xe=n==="link"?w.jsx(Ml,{variant:"header",onClick:le,children:e}):w.jsx(br,{onClick:le,...i,children:e});return w.jsxs(w.Fragment,{children:[!o&&xe,w.jsxs(so,{isOpen:Q&&!$,onClose:J,size:"md",portalProps:{containerRef:C},isCentered:!0,motionPreset:"slideInBottom",blockScrollOnMount:!1,children:[w.jsx(ao,{bg:"blackAlpha.800",backdropFilter:"blur(5px)"}),w.jsxs(oo,{bg:"gray.800",borderRadius:"xl",boxShadow:"xl",color:"white",maxW:"md",mx:4,position:"relative",zIndex:9999,sx:{isolation:"isolate","& input":{position:"relative",zIndex:1e4,isolation:"isolate"},"& *":{pointerEvents:"auto !important"}},onKeyDown:We=>{We.stopPropagation()},children:[w.jsxs(ec,{p:8,textAlign:"center",children:[w.jsx(VC,{size:"lg",mb:2,children:"Create Account"}),w.jsx(nt,{fontSize:"sm",color:"gray.400",children:"Fill in your details to get started"})]}),w.jsx(zo,{color:"gray.400"}),w.jsx(wo,{px:8,children:w.jsx("form",{onSubmit:p(me),children:w.jsxs(Jr,{spacing:4,children:[w.jsxs(Mr,{isInvalid:_.companyName,isRequired:!0,children:[w.jsx(pi,{placeholder:"Company Name",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...d("companyName",{required:"Company name is required",setValueAs:We=>We===""?"":We})}),w.jsx(Gh,{children:_.companyName&&_.companyName.message})]}),w.jsxs(Ar,{gap:4,w:"100%",children:[w.jsxs(Mr,{isInvalid:_.firstName,isRequired:!0,children:[w.jsx(pi,{placeholder:"First Name",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...d("firstName",{required:"First name is required",setValueAs:We=>We===""?"":We})}),w.jsx(Gh,{children:_.firstName&&_.firstName.message})]}),w.jsxs(Mr,{isInvalid:_.lastName,isRequired:!0,children:[w.jsx(pi,{placeholder:"Last Name",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...d("lastName",{required:"Last name is required",setValueAs:We=>We===""?"":We})}),w.jsx(Gh,{children:_.lastName&&_.lastName.message})]})]}),w.jsxs(Mr,{isInvalid:_.email,isRequired:!0,children:[w.jsx(pi,{type:"email",placeholder:"Work Email Address",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...d("email",{required:"Email is required",pattern:{value:/^[^@ \t\r\n]+@[^@ \t\r\n]+\.[^@ \t\r\n]+$/,message:"Invalid email address"}})}),w.jsx(Gh,{children:_.email&&_.email.message})]}),w.jsxs(Ar,{gap:4,w:"100%",children:[w.jsxs(Mr,{isInvalid:_.password,isRequired:!0,children:[w.jsx(pi,{type:"password",placeholder:"Password",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...d("password",{required:"Password is required",minLength:{value:8,message:"Password must be at least 8 characters long"}})}),w.jsx(Gh,{children:_.password&&_.password.message})]}),w.jsxs(Mr,{isInvalid:_.confirmPassword,isRequired:!0,children:[w.jsx(pi,{type:"password",placeholder:"Confirm Password",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...d("confirmPassword",{required:"Confirm password is required"})}),w.jsx(Gh,{children:_.confirmPassword&&_.confirmPassword.message})]})]}),w.jsx(Mr,{children:w.jsx(pi,{placeholder:"LinkedIn Profile (optional)",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...d("linkedInProfile",{setValueAs:We=>We===""?"":We})})}),w.jsx(ft,{width:"100%",display:"flex",justifyContent:"center",my:4,children:w.jsx($oe,{ref:Z,sitekey:HWe,onChange:ie,theme:"dark"})})]})})}),w.jsxs(zp,{px:8,pb:8,flexDirection:"column",gap:4,children:[w.jsx(br,{type:"submit",colorScheme:"blue",size:"lg",width:"100%",onClick:p(me),isLoading:L,loadingText:"Processing",isDisabled:!B,children:"Next: Set Your Username"}),w.jsxs(nt,{fontSize:"sm",color:"gray.400",textAlign:"center",children:["Already have an account?"," ",w.jsx(Ml,{color:"blue.400",onClick:()=>{J(),window.dispatchEvent(new CustomEvent("openSignInModal"))},children:"Sign In"})]})]})]})]}),$&&w.jsx(Koe,{isOpen:$,onClose:()=>se(!1),userData:ue,onConfirm:de,fullscreenRef:C,isRegistering:pe})]})}MN.propTypes={mode:mn.oneOf(["button","link"]),label:mn.string,buttonProps:mn.object,isOpen:mn.bool,onClose:mn.func};const $We="6Le4oQUrAAAAAHe0GMH5Z0tpuqTV2qqDzK9Yk4Uv";function UN({mode:n="button",label:e="Sign In",buttonProps:i={},initialIsOpen:o=!1}){const{signIn:l}=D.useContext(Go),{fullscreenRef:d}=Bd(),p=wc(),{register:_,handleSubmit:E,formState:{errors:b}}=Hoe({defaultValues:{email:"neil@pursey.net",password:"123456"}}),[C,I]=D.useState(!1),[O,L]=D.useState(o),[V,B]=D.useState(!1),[W,Z]=D.useState(!1),[$,se]=D.useState(""),[ue,re]=D.useState(!1),[pe,q]=D.useState(null),Q=D.useRef(null);LN(O||W),D.useEffect(()=>{const $e=()=>{L(!0)};return window.addEventListener("openSignInModal",$e),()=>{window.removeEventListener("openSignInModal",$e)}},[]);const J=$e=>{q($e)},ie=async $e=>{if(!pe){p({title:"Verification Required",description:"Please complete the reCAPTCHA verification.",status:"error",duration:3e3,isClosable:!0,position:"top"});return}I(!0);try{await l($e.email,$e.password,pe),Y.log("User: Sign-in process complete."),L(!1),window.location.reload()}catch(ve){Y.error("User: SignIn Error:",ve);const _e=ve.message||"An error occurred while logging in. Please check your credentials.",Ee=_e.includes("verify your email");p({title:Ee?"Email Verification Required":"Error",description:_e,status:Ee?"warning":"error",duration:1e4,isClosable:!0,position:"top",container:d.current})}finally{I(!1),Q.current&&Q.current.reset()}},me=async()=>{if(!$){p({title:"Email Required",description:"Please enter your email address to reset your password.",status:"warning",duration:3e3,isClosable:!0,position:"top",container:d.current});return}try{re(!0),await ZFe(l3,$),p({title:"Password Reset Email Sent",description:"Check your email for instructions to reset your password.",status:"success",duration:5e3,isClosable:!0,position:"top",container:d.current}),Z(!1)}catch($e){Y.error("User: Reset Password Error:",$e),p({title:"Error",description:$e.message||"Failed to send password reset email. Please try again.",status:"error",duration:5e3,isClosable:!0,position:"top",container:d.current})}finally{re(!1)}},de=()=>L($e=>!$e),le=()=>{L(!1),B(!0)},xe=()=>{Z(!0)},We=n==="link"?w.jsx(Ml,{variant:"header",onClick:de,children:e}):w.jsx(br,{onClick:de,...i,children:e});return w.jsxs(w.Fragment,{children:[We,w.jsxs(so,{isOpen:O,onClose:de,size:"md",portalProps:{containerRef:d},isCentered:!0,motionPreset:"slideInBottom",blockScrollOnMount:!1,children:[w.jsx(ao,{bg:"blackAlpha.800",backdropFilter:"blur(5px)"}),w.jsx("form",{onSubmit:E(ie),children:w.jsxs(oo,{bg:"gray.800",borderRadius:"xl",boxShadow:"xl",color:"white",maxW:"md",mx:4,position:"relative",zIndex:9999,sx:{isolation:"isolate","& input":{position:"relative",zIndex:1e4,isolation:"isolate"},"& *":{pointerEvents:"auto !important"}},onKeyDown:$e=>{$e.stopPropagation()},children:[w.jsxs(ec,{p:8,textAlign:"center",children:[w.jsx(VC,{size:"lg",mb:2,children:"Welcome Back"}),w.jsx(nt,{fontSize:"sm",color:"gray.400",children:"Enter your credentials to access your account"})]}),w.jsx(zo,{color:"gray.400"}),w.jsx(wo,{px:8,pb:8,children:w.jsxs(Jr,{spacing:4,children:[w.jsxs(Mr,{isInvalid:b.email,children:[w.jsxs(Sg,{children:[w.jsx(uC,{pointerEvents:"none",children:w.jsx(hQ,{color:"gray.500"})}),w.jsx(pi,{type:"email",placeholder:"Email",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},..._("email",{required:"Email is required."})})]}),w.jsx(Gh,{children:b.email&&b.email.message})]}),w.jsxs(Mr,{isInvalid:b.password,children:[w.jsxs(Sg,{children:[w.jsx(uC,{pointerEvents:"none",children:w.jsx(hWe,{color:"gray.500"})}),w.jsx(pi,{type:"password",placeholder:"Password",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},..._("password",{required:"Password is required."})})]}),w.jsx(Gh,{children:b.password&&b.password.message})]}),w.jsx(ft,{alignSelf:"flex-end",children:w.jsx(Ml,{color:"blue.400",fontSize:"sm",onClick:xe,children:"Forgot Password?"})}),w.jsx(Ar,{width:"100%",justifyContent:"center",my:4,children:w.jsx($oe,{ref:Q,sitekey:$We,onChange:J,theme:"dark"})})]})}),w.jsxs(zp,{px:8,pb:8,flexDirection:"column",gap:4,children:[w.jsx(br,{type:"submit",colorScheme:"blue",size:"lg",width:"100%",isLoading:C,loadingText:"Signing In",isDisabled:!pe,children:"Sign In"}),w.jsxs(nt,{fontSize:"sm",color:"gray.400",textAlign:"center",children:["Don't have an account?"," ",w.jsx(Ml,{color:"blue.400",onClick:le,children:"Sign Up"})]})]})]})})]}),w.jsxs(so,{isOpen:W,onClose:()=>Z(!1),size:"md",portalProps:{containerRef:d},isCentered:!0,motionPreset:"slideInBottom",blockScrollOnMount:!1,children:[w.jsx(ao,{bg:"blackAlpha.800",backdropFilter:"blur(5px)"}),w.jsxs(oo,{bg:"gray.800",borderRadius:"xl",boxShadow:"xl",color:"white",maxW:"md",mx:4,position:"relative",zIndex:9999,sx:{isolation:"isolate","& input":{position:"relative",zIndex:1e4,isolation:"isolate"},"& *":{pointerEvents:"auto !important"}},onKeyDown:$e=>{$e.stopPropagation()},children:[w.jsxs(ec,{p:8,textAlign:"center",children:[w.jsx(VC,{size:"lg",mb:2,children:"Reset Password"}),w.jsx(nt,{fontSize:"sm",color:"gray.400",children:"Enter your email to receive password reset instructions"})]}),w.jsx(zo,{color:"gray.400"}),w.jsx(wo,{px:8,pb:4,children:w.jsx(Mr,{children:w.jsxs(Sg,{children:[w.jsx(uC,{pointerEvents:"none",children:w.jsx(hQ,{color:"gray.500"})}),w.jsx(pi,{type:"email",placeholder:"Email",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},value:$,onChange:$e=>se($e.target.value)})]})})}),w.jsxs(zp,{px:8,pb:8,flexDirection:"column",gap:4,children:[w.jsx(br,{colorScheme:"blue",size:"lg",width:"100%",onClick:me,isLoading:ue,loadingText:"Sending",children:"Send Reset Link"}),w.jsxs(nt,{fontSize:"sm",color:"gray.400",textAlign:"center",children:["Remember your password?"," ",w.jsx(Ml,{color:"blue.400",onClick:()=>Z(!1),children:"Back to Sign In"})]})]})]})]}),w.jsx(MN,{mode:"link",isOpen:V,onClose:()=>B(!1)})]})}UN.propTypes={mode:mn.oneOf(["button","link"]),label:mn.string,buttonProps:mn.object,initialIsOpen:mn.bool};function w3({mode:n="button",label:e="Sign Out"}){const i=wc(),{signOut:o}=D.useContext(Go),{fullscreenRef:l}=Bd(),d=async()=>{try{await o(),i({title:"Logged Out",description:"You have been successfully logged out.",status:"success",duration:3e3,isClosable:!0,position:"top",container:l.current}),window.location.href="/"}catch(_){console.error("SignOut Error:",_),i({title:"Error",description:"An error occurred while logging out.",status:"error",duration:3e3,isClosable:!0,position:"top",container:l.current})}},p=n==="link"?w.jsx(Ml,{variant:"header",onClick:d,style:{cursor:"pointer"},children:e}):null;return w.jsx(w.Fragment,{children:p})}w3.propTypes={mode:mn.oneOf(["button","link"]),label:mn.string};const U0=()=>window.unityInstance||window.gameInstance||window.reactUnityInstance,C3=()=>{document.body.classList.add("unity-focused");const n=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight","Space","PageUp","PageDown","Home","End"],e=o=>{if(n.includes(o.key)){const l=o.target.tagName==="INPUT"||o.target.tagName==="TEXTAREA"||o.target.isContentEditable,d=document.querySelector("canvas")||document.getElementById("unity-canvas"),p=o.target.closest("canvas")||o.target.closest("#webgl-root"),_=document.activeElement===d;!l&&(p||_)&&o.preventDefault()}},i=o=>{document.querySelector("canvas")||document.getElementById("unity-canvas"),document.getElementById("unity-container")||document.getElementById("webgl-root"),o.target.closest("canvas")||o.target.closest("#webgl-root")?document.body.classList.add("unity-focused"):document.body.classList.remove("unity-focused")};return document.addEventListener("keydown",e),document.addEventListener("click",i),()=>{document.body.classList.remove("unity-focused"),document.removeEventListener("keydown",e),document.removeEventListener("click",i)}},qoe=()=>{document.body.classList.remove("unity-focused")};function b1(n){return console.log(`Setting Unity keyboard capture: ${n}`),n?(document.body.classList.add("unity-focused"),window.unityKeyboardEnabled=!0):(document.body.classList.remove("unity-focused"),window.unityKeyboardEnabled=!1),n?C3():qoe(),new Promise(e=>{try{const i=U0();if(i){try{n?i.SendMessage("WebGLInput","EnableKeyboardCapture"):i.SendMessage("WebGLInput","DisableKeyboardCapture"),console.log(`Unity keyboard capture ${n?"enabled":"disabled"} (using Unity preferred method)`),e(!0);return}catch(o){console.warn("Failed to use Unity preferred keyboard method, falling back to SetCaptureAllKeyboardInput",o)}try{i.SendMessage("WebGLInput","SetCaptureAllKeyboardInput",n),console.log(`Unity keyboard capture ${n?"enabled":"disabled"} (using fallback method)`),e(!0);return}catch(o){console.warn("Failed to use SetCaptureAllKeyboardInput, trying module method",o)}if(i.Module){!n&&i.Module.WebGLInputHandler&&!window._originalWebGLInputHandler&&(window._originalWebGLInputHandler=i.Module.WebGLInputHandler),n&&window._originalWebGLInputHandler?(i.Module.WebGLInputHandler=window._originalWebGLInputHandler,window._originalWebGLInputHandler=null):n||(i.Module.WebGLInputHandler=null),console.log(`Unity keyboard capture ${n?"enabled":"disabled"} (using Module method)`),e(!0);return}}else console.warn("Unity instance not available, cannot set keyboard capture"),window.__pendingKeyboardCaptureState=n,document.getElementById("webgl-root")&&(console.log("webgl-root detected, will poll for Unity instance"),TF(n)),e(!1)}catch(i){console.error("Error setting Unity keyboard capture:",i),e(!1)}})}function TF(n){window.__unityInstancePoller&&clearTimeout(window.__unityInstancePoller);const e=20;let i=0;const o=()=>{i++;const l=U0();if(l){console.log(`Unity instance found after ${i} attempts`);try{n?l.SendMessage("WebGLInput","EnableKeyboardCapture"):l.SendMessage("WebGLInput","DisableKeyboardCapture"),console.log(`Applied pending keyboard state: ${n}`),window.__pendingKeyboardCaptureState=null}catch(d){console.warn("Failed to apply pending keyboard state with preferred method, trying fallback",d);try{l.SendMessage("WebGLInput","SetCaptureAllKeyboardInput",n),console.log(`Applied pending keyboard state: ${n} (fallback method)`),window.__pendingKeyboardCaptureState=null}catch(p){console.error("Failed to apply pending keyboard state with fallback method",p)}}}else if(i<e){const d=Math.min(500*Math.pow(1.2,i),5e3);console.log(`Unity instance not found (attempt ${i}/${e}), retrying in ${d}ms`),window.__unityInstancePoller=setTimeout(o,d)}else console.warn(`Unity instance still not found after ${e} attempts, giving up`)};window.__unityInstancePoller=setTimeout(o,500)}function KWe(){const n=U0();if(!n)return!1;const e=document.querySelector("canvas")||document.getElementById("unity-canvas");return!!(e&&document.activeElement===e||n.Module&&n.Module.WebGLInputHandler)}function vy(n=!0){return console.log("Focusing Unity canvas"),n?C3():qoe(),new Promise(e=>{try{const i=document.querySelector("canvas")||document.getElementById("unity-canvas");if(i){try{i.focus({preventScroll:!0})}catch{i.focus()}if(i.style.pointerEvents="auto",n){b1(!0).then(e);return}e(!0)}else console.warn("Unity canvas not found"),e(!1)}catch(i){console.error("Error focusing Unity canvas:",i),e(!1)}})}function Ld(n=!0){return console.log(`${n?"Blocking":"Unblocking"} Unity keyboard input`),C3(),new Promise(e=>{try{if(n)b1(!1).then(i=>{var d;i&&console.log("Successfully disabled Unity keyboard capture");const o=document.querySelector("canvas")||document.getElementById("unity-canvas");o&&(o.blur(),o.style.pointerEvents="none"),window.__keyEventHandler||(window.__keyEventHandler=p=>{window.__blockKeyboardInput&&!["INPUT","TEXTAREA","SELECT"].includes(p.target.tagName)&&p.stopPropagation()},document.addEventListener("keydown",window.__keyEventHandler,!0),document.addEventListener("keyup",window.__keyEventHandler,!0),document.addEventListener("keypress",window.__keyEventHandler,!0)),window.__blockKeyboardInput=!0;const l=U0();(d=l==null?void 0:l.Module)!=null&&d.WebGLInputHandler&&(window._savedWebGLInputHandler=l.Module.WebGLInputHandler,l.Module.WebGLInputHandler=null),e(!0)});else{window.__blockKeyboardInput=!1,window.__keyEventHandler&&(document.removeEventListener("keydown",window.__keyEventHandler,!0),document.removeEventListener("keyup",window.__keyEventHandler,!0),document.removeEventListener("keypress",window.__keyEventHandler,!0),window.__keyEventHandler=null);const i=U0();i!=null&&i.Module&&window._savedWebGLInputHandler&&(i.Module.WebGLInputHandler=window._savedWebGLInputHandler,window._savedWebGLInputHandler=null);const o=document.querySelector("canvas")||document.getElementById("unity-canvas");o&&(o.style.pointerEvents="auto"),b1(!0).then(l=>{l&&console.log("Successfully re-enabled Unity keyboard capture"),e(!0)})}}catch(i){console.error("Error in blockUnityKeyboardInput:",i),e(!1)}})}function qWe(n){if(n){if(console.log("Registering Unity instance"),window.unityInstance=n,typeof window.__pendingKeyboardCaptureState=="boolean")try{const e=window.__pendingKeyboardCaptureState;console.log(`Applying pending keyboard state: ${e}`);try{e?n.SendMessage("WebGLInput","EnableKeyboardCapture"):n.SendMessage("WebGLInput","DisableKeyboardCapture"),console.log(`Applied pending keyboard state: ${e} (Unity preferred method)`),window.__pendingKeyboardCaptureState=null}catch(i){console.warn("Failed to apply pending keyboard state with preferred method, trying fallback",i);try{n.SendMessage("WebGLInput","SetCaptureAllKeyboardInput",e),console.log(`Applied pending keyboard state: ${e} (fallback method)`),window.__pendingKeyboardCaptureState=null}catch(o){console.error("Failed to apply pending keyboard state with fallback method",o)}}}catch(e){console.error("Error applying pending keyboard state:",e)}window.__unityInstancePoller&&(clearTimeout(window.__unityInstancePoller),window.__unityInstancePoller=null)}}function YWe(){if(console.log("Initializing Unity keyboard helpers"),window.setUnityKeyboardCapture=b1,window.focusUnity=vy,window.blockUnityKeyboardInput=Ld,window.hasUnityKeyboardFocus=KWe,window.getUnityInstance=U0,window.registerUnityInstance=qWe,document.getElementById("webgl-root")){const n=new MutationObserver(e=>{for(const i of e)if(i.addedNodes.length)for(let o=0;o<i.addedNodes.length;o++){const l=i.addedNodes[o];if(l.nodeName==="CANVAS"||l.querySelector&&l.querySelector("canvas")){console.log("Canvas detected, Unity might be loading. Setting up instance detection."),TF(!0),n.disconnect();break}}});n.observe(document.body,{childList:!0,subtree:!0}),document.querySelector("canvas")&&(console.log("Canvas already exists, Unity might be loaded. Starting instance detection."),TF(!0))}if(typeof window<"u"&&typeof require=="function")try{const n=require("react");window.useUnityKeyboardFocus=function(){const[i,o]=n.useState(!1);return n.useEffect(()=>(i?(console.log("useUnityKeyboardFocus: Blocking Unity keyboard input"),Ld(!0),window.dispatchEvent(new CustomEvent("modal-opened"))):(console.log("useUnityKeyboardFocus: Unblocking Unity keyboard input"),Ld(!1),window.dispatchEvent(new CustomEvent("modal-closed"))),()=>{i&&(console.log("useUnityKeyboardFocus: Cleanup - unblocking Unity keyboard input"),Ld(!1),window.dispatchEvent(new CustomEvent("modal-closed")))}),[i]),[i,o]},console.log("Created useUnityKeyboardFocus hook globally")}catch(n){console.warn("Could not create React hook, React might not be available yet:",n)}}typeof window<"u"&&setTimeout(YWe,0);const XWe=({isOpen:n,onClose:e,user:i,profileImageUrl:o})=>{const[l,d]=D.useState(!1),[p,_]=D.useState({Nickname:(i==null?void 0:i.Nickname)||"",username:(i==null?void 0:i.username)||"",companyName:(i==null?void 0:i.companyName)||"",firstName:(i==null?void 0:i.firstName)||"",lastName:(i==null?void 0:i.lastName)||"",linkedInProfile:(i==null?void 0:i.linkedInProfile)||""}),[E,b]=D.useState(!1),[C,I]=D.useState(!1),[O,L]=D.useState(""),[V,B]=D.useState(!1),W=wc(),{sendUserToUnity:Z,updateUser:$}=D.useContext(Go),se=D.useRef(null);D.useEffect(()=>{_({Nickname:(i==null?void 0:i.Nickname)||"",username:(i==null?void 0:i.username)||"",companyName:(i==null?void 0:i.companyName)||"",firstName:(i==null?void 0:i.firstName)||"",lastName:(i==null?void 0:i.lastName)||"",linkedInProfile:(i==null?void 0:i.linkedInProfile)||""})},[i]),D.useEffect(()=>(n?(console.log("ProfileModal: Modal opened, blocking Unity keyboard input"),Ld(!0),window.dispatchEvent(new CustomEvent("modal-opened"))):(console.log("ProfileModal: Modal closed, unblocking Unity keyboard input"),Ld(!1).then(()=>{setTimeout(()=>{vy(!0)},100)}),window.dispatchEvent(new CustomEvent("modal-closed"))),()=>{n&&(console.log("ProfileModal: Cleanup on unmount, unblocking Unity keyboard input"),Ld(!1),window.dispatchEvent(new CustomEvent("modal-closed")))}),[n]),D.useEffect(()=>{if(l&&se.current){const J=()=>{se.current.focus(),I(!0),Ld(!0)};J();const ie=setTimeout(J,100),me=setTimeout(J,300);return()=>{clearTimeout(ie),clearTimeout(me)}}else I(!1)},[l]),D.useEffect(()=>{const ie=setTimeout(async()=>{if(p.username&&p.username!==(i==null?void 0:i.username)){B(!0),L("");try{if(!/^[a-z0-9]{1,15}$/.test(p.username)){L("Username must be 1-15 characters, lowercase letters and numbers only"),B(!1);return}await qC(p.username)&&L("Username is already taken")}catch(me){Y.error("Error checking username:",me),L("Error checking username availability")}finally{B(!1)}}},500);return()=>clearTimeout(ie)},[p.username,i==null?void 0:i.username]);const ue=()=>{d(!1),I(!1),e()},re=J=>{const{name:ie,value:me}=J.target;if(ie==="username"){const de=me.toLowerCase().replace(/[^a-z0-9]/g,"");_(le=>({...le,[ie]:de}))}else _(de=>({...de,[ie]:me}))},pe=async()=>{if(p.Nickname.trim()===""){W({title:"Error",description:"Display Name cannot be empty",status:"error",duration:3e3,isClosable:!0});return}if(O){W({title:"Error",description:O,status:"error",duration:3e3,isClosable:!0});return}b(!0);try{if(p.username!==i.username&&await qC(p.username)){L("Username is already taken"),W({title:"Error",description:"Username is already taken",status:"error",duration:3e3,isClosable:!0}),b(!1);return}const J=$r(gr,"users",i.uid);if(p.username!==i.username)try{if(Y.log("ProfileModal: Updating username from",i.username,"to",p.username),!await UBe(i.uid,p.username))throw new Error("Failed to update username");Y.log("ProfileModal: Username updated successfully")}catch(ie){Y.error("Error updating username:",ie),W({title:"Error",description:"Failed to update username: "+(ie.message||"Please try again"),status:"error",duration:3e3,isClosable:!0}),b(!1);return}Y.log("ProfileModal: Updating user profile");try{const ie={Nickname:p.Nickname,companyName:p.companyName,firstName:p.firstName,lastName:p.lastName,linkedInProfile:p.linkedInProfile,username:p.username,lastUpdated:new Date().toISOString()};await Co(J,ie),Y.log("ProfileModal: Profile updated successfully");const me=hoe(J,de=>{if(de.exists()&&de.data().Nickname===p.Nickname){try{Z()}catch(xe){Y.error("Error sending user to Unity:",xe)}me()}},de=>{Y.error("Error in profile update listener:",de)});try{await $()}catch(de){Y.error("Error updating user context:",de)}_({Nickname:p.Nickname,username:p.username,companyName:p.companyName,firstName:p.firstName,lastName:p.lastName,linkedInProfile:p.linkedInProfile}),W({title:"Success",description:"Profile updated successfully",status:"success",duration:3e3,isClosable:!0}),d(!1)}catch(ie){Y.error("Error updating profile data:",ie),W({title:"Error",description:"Failed to update profile: "+(ie.message||"Please try again"),status:"error",duration:3e3,isClosable:!0})}}catch(J){Y.error("Error in handleSave:",J),W({title:"Error",description:"An unexpected error occurred: "+(J.message||"Please try again"),status:"error",duration:3e3,isClosable:!0})}finally{b(!1)}},q=()=>w.jsxs(Jr,{spacing:4,align:"stretch",w:"100%",children:[w.jsxs(Ar,{direction:"column",align:"center",gap:2,children:[w.jsx(nt,{fontSize:"2xl",fontWeight:"bold",children:i.Nickname}),w.jsxs(nt,{fontSize:"md",color:"gray.400",children:["@",i.username]})]}),w.jsxs(Jr,{spacing:3,align:"stretch",bg:"gray.700",p:4,borderRadius:"md",children:[w.jsxs(Ar,{direction:"column",children:[w.jsx(nt,{color:"gray.400",fontSize:"sm",children:"Company"}),w.jsx(nt,{children:i.companyName||"Not specified"})]}),w.jsxs(Ar,{direction:"column",children:[w.jsx(nt,{color:"gray.400",fontSize:"sm",children:"Full Name"}),w.jsx(nt,{children:`${i.firstName||""} ${i.lastName||""}`.trim()||"Not specified"})]}),w.jsxs(Ar,{direction:"column",children:[w.jsx(nt,{color:"gray.400",fontSize:"sm",children:"LinkedIn"}),w.jsx(nt,{children:i.linkedInProfile||"Not specified"})]})]}),w.jsx(br,{onClick:()=>d(!0),size:"sm",variant:"outline",_hover:{bg:"gray.700"},color:"white",borderColor:"gray.600",children:"Edit Profile"})]}),Q=()=>w.jsxs(Jr,{spacing:4,align:"stretch",w:"100%",children:[w.jsxs(Mr,{children:[w.jsx(ns,{color:"gray.400",fontSize:"sm",children:"Display Name"}),w.jsx(pi,{ref:se,name:"Nickname",value:p.Nickname,onChange:re,onFocus:()=>{I(!0),Ld(!0)},placeholder:"Enter display name",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},maxLength:15})]}),w.jsxs(Mr,{isInvalid:!!O,children:[w.jsx(ns,{color:"gray.400",fontSize:"sm",children:"Username"}),w.jsxs(Sg,{children:[w.jsx(G1,{bg:"gray.700",color:"gray.400",border:"none",children:"@"}),w.jsx(pi,{name:"username",value:p.username,onChange:re,placeholder:"username",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},maxLength:15,isDisabled:V})]}),O&&w.jsx(nt,{color:"red.400",fontSize:"sm",mt:1,children:O}),w.jsx(E0,{color:"gray.400",children:"Lowercase letters and numbers only, max 15 characters"})]}),w.jsxs(Mr,{children:[w.jsx(ns,{color:"gray.400",fontSize:"sm",children:"Company Name"}),w.jsx(pi,{name:"companyName",value:p.companyName,onChange:re,placeholder:"Enter company name",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"}})]}),w.jsxs(Ar,{gap:4,children:[w.jsxs(Mr,{children:[w.jsx(ns,{color:"gray.400",fontSize:"sm",children:"First Name"}),w.jsx(pi,{name:"firstName",value:p.firstName,onChange:re,placeholder:"Enter first name",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"}})]}),w.jsxs(Mr,{children:[w.jsx(ns,{color:"gray.400",fontSize:"sm",children:"Last Name"}),w.jsx(pi,{name:"lastName",value:p.lastName,onChange:re,placeholder:"Enter last name",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"}})]})]}),w.jsxs(Mr,{children:[w.jsx(ns,{color:"gray.400",fontSize:"sm",children:"LinkedIn Profile"}),w.jsx(pi,{name:"linkedInProfile",value:p.linkedInProfile,onChange:re,placeholder:"Enter LinkedIn profile URL",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"}})]}),w.jsxs(Ar,{gap:2,justify:"flex-end",mt:2,children:[w.jsx(br,{onClick:()=>{_({Nickname:(i==null?void 0:i.Nickname)||"",username:(i==null?void 0:i.username)||"",companyName:(i==null?void 0:i.companyName)||"",firstName:(i==null?void 0:i.firstName)||"",lastName:(i==null?void 0:i.lastName)||"",linkedInProfile:(i==null?void 0:i.linkedInProfile)||""}),d(!1),L("")},variant:"outline",size:"sm",isDisabled:E,color:"white",borderColor:"gray.600",_hover:{bg:"gray.700"},children:"Cancel"}),w.jsx(br,{onClick:pe,colorScheme:"blue",size:"sm",isLoading:E||V,isDisabled:!!O||V,children:"Save Changes"})]})]});return w.jsxs(so,{isOpen:n,onClose:ue,isCentered:!0,closeOnOverlayClick:!l,trapFocus:!0,blockScrollOnMount:!1,size:"md",children:[w.jsx(ao,{backdropFilter:"blur(10px)"}),w.jsxs(oo,{bg:"gray.800",color:"white",children:[w.jsx(ec,{children:"Profile"}),w.jsx(zo,{}),w.jsx(wo,{pb:6,children:w.jsxs(Jr,{spacing:6,children:[w.jsx(zl,{src:o,size:"2xl",borderRadius:"full"}),l?Q():q()]})})]})]})},GO={bg:"white",color:"black",borderRadius:"full",px:"6",py:"2",height:"auto",fontSize:"md",fontWeight:"medium",_hover:{bg:"gray.100"},display:"flex",alignItems:"center",gap:2},Yoe=()=>{var C;const{user:n,updateUser:e}=D.useContext(Go),[i,o]=D.useState(!0),{isOpen:l,onOpen:d,onClose:p}=hf();D.useEffect(()=>{const I=setTimeout(()=>{o(!1)},500);return()=>clearTimeout(I)},[]);const _=()=>{p(),e()},E=n!=null&&n.rpmURL?n.rpmURL.replace(".glb",".png?scene=fullbody-portrait-closeupfront&w=640&q=75"):null,b=(C=n==null?void 0:n.groups)==null?void 0:C.includes("disruptiveAdmin");return i?null:w.jsx(Ar,{align:"center",gap:"4",children:n?w.jsxs(w.Fragment,{children:[w.jsx(XWe,{isOpen:l,onClose:_,user:n,profileImageUrl:E}),w.jsxs(dR,{children:[w.jsx(hR,{as:ft,cursor:"pointer",children:w.jsx(Ar,{align:"center",height:"40px",px:4,borderRadius:"full",border:"1px solid rgba(255, 255, 255, 0.3)",transition:"all 0.2s",sx:{"&:hover":{border:"2px solid white"}},children:w.jsxs(Ar,{align:"center",gap:"3",children:[w.jsx(ft,{width:"28px",height:"28px",borderRadius:"full",overflow:"hidden",bg:"white",display:"flex",alignItems:"center",justifyContent:"center",children:w.jsx(zl,{src:E,width:"100%",height:"100%",borderRadius:"full"})}),w.jsx(nt,{color:"white",fontWeight:"medium",children:n.Nickname}),w.jsx(ft,{display:"flex",alignItems:"center",height:"28px",children:w.jsx(Moe,{color:"white",w:4,h:4})})]})})}),w.jsx($l,{children:w.jsxs(fR,{bg:"gray.800",borderColor:"gray.700",zIndex:9999,children:[w.jsxs(ft,{p:4,display:"flex",alignItems:"center",gap:3,children:[w.jsx(zl,{src:E,size:"md",borderRadius:"full"}),w.jsx(nt,{fontSize:"xl",fontWeight:"bold",color:"white",children:n.Nickname})]}),w.jsx(rf,{borderColor:"gray.700"}),b&&w.jsx(Dd,{as:"a",href:"/myadmin",_hover:{bg:"gray.700"},color:"white",bg:"gray.800",children:"My Admin"}),w.jsx(Dd,{_hover:{bg:"gray.700"},color:"white",bg:"gray.800",children:"My Spaces"}),w.jsx(Dd,{onClick:d,_hover:{bg:"gray.700"},color:"white",bg:"gray.800",children:"View Profile"}),w.jsx(rf,{borderColor:"gray.700"}),w.jsx(Dd,{_hover:{bg:"gray.700"},color:"white",bg:"gray.800",children:"Support"}),w.jsx(Dd,{_hover:{bg:"gray.700"},color:"white",bg:"gray.800",children:w.jsx(w3,{mode:"link",label:"Log out",linkProps:{color:"white",_hover:{textDecoration:"none"}}})})]})})]})]}):w.jsxs(w.Fragment,{children:[w.jsx(MN,{mode:"button",label:"Register",buttonProps:{...GO,width:["100%","auto"]},customButton:w.jsxs(br,{...GO,children:[w.jsx(ft,{as:"span",fontSize:"xl",children:""}),"Register"]})}),w.jsx(UN,{mode:"button",label:"Sign In",buttonProps:{...GO,width:["100%","auto"]},customButton:w.jsxs(br,{...GO,children:[w.jsx(ft,{as:"span",fontSize:"xl",children:""}),"Sign In"]})})]})})},JWe=()=>{const{registrationInProgress:n}=lWe();return n?w.jsxs(so,{isOpen:!0,onClose:()=>{},closeOnEsc:!1,closeOnOverlayClick:!1,isCentered:!0,motionPreset:"none",size:"full",children:[w.jsx(ao,{bg:"rgba(0,0,0,0.8)",backdropFilter:"blur(8px)"}),w.jsx(oo,{bg:"transparent",boxShadow:"none",maxW:"100%",maxH:"100%",display:"flex",alignItems:"center",justifyContent:"center",children:w.jsxs(Ar,{direction:"column",align:"center",justify:"center",p:8,maxW:"md",textAlign:"center",children:[w.jsx(jd,{size:"xl",thickness:"4px",speed:"0.8s",color:"blue.400",mb:6}),w.jsx(nt,{fontSize:"2xl",fontWeight:"bold",color:"white",mb:4,children:"Creating Your Account"}),w.jsx(nt,{fontSize:"md",color:"gray.300",mb:3,children:"Please wait while we set up your profile with Spaces Metaverse"}),w.jsx(nt,{fontSize:"sm",color:"gray.400",mb:1,children:"This typically takes 5-10 seconds to complete"}),w.jsx(nt,{fontSize:"sm",color:"gray.400",children:"Please do not refresh or close this page"})]})})]}):null},UU=document.getElementById("header-auth-root");if(UU){const n=UU.getAttribute("data-theme")||"default",e=()=>{const[i,o]=D.useState(null);return D.useEffect(()=>{FC(n).then(o)},[]),i?w.jsx(z1,{theme:i,children:w.jsx(NN,{children:w.jsxs(E3,{children:[w.jsx(Yoe,{}),w.jsx(JWe,{})]})})}):w.jsx("div",{children:"Loading theme..."})};w1.createRoot(UU).render(w.jsx(e,{}))}else console.error("Root element 'header-auth-root' not found.");var VU={},Cw={},Rw={},TQ;function QWe(){if(TQ)return Rw;TQ=1,Object.defineProperty(Rw,"__esModule",{value:!0}),Rw.useUnityCanvasId=void 0;var n=Mu(),e=0,i="react-unity-webgl-canvas",o=function(l){if(l.id!==void 0)return l.id;var d=(0,n.useMemo)(function(){return[i,++e].join("-")},[]);return d};return Rw.useUnityCanvasId=o,Rw}var Ep={},Iw={},wQ;function Xoe(){if(wQ)return Iw;wQ=1,Object.defineProperty(Iw,"__esModule",{value:!0}),Iw.UnityLoaderStatus=void 0;var n;return function(e){e.Idle="Idle",e.Loading="Loading",e.Loaded="Loaded",e.Error="Error"}(n||(Iw.UnityLoaderStatus=n={})),Iw}var Aw={},CQ;function R3(){return CQ||(CQ=1,Object.defineProperty(Aw,"__esModule",{value:!0}),Aw.isBrowserEnvironment=void 0,Aw.isBrowserEnvironment=typeof window<"u"&&typeof document<"u"),Aw}var RQ;function ZWe(){if(RQ)return Ep;RQ=1;var n=Ep&&Ep.__awaiter||function(p,_,E,b){function C(I){return I instanceof E?I:new E(function(O){O(I)})}return new(E||(E=Promise))(function(I,O){function L(W){try{B(b.next(W))}catch(Z){O(Z)}}function V(W){try{B(b.throw(W))}catch(Z){O(Z)}}function B(W){W.done?I(W.value):C(W.value).then(L,V)}B((b=b.apply(p,_||[])).next())})},e=Ep&&Ep.__generator||function(p,_){var E={label:0,sent:function(){if(I[0]&1)throw I[1];return I[1]},trys:[],ops:[]},b,C,I,O=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return O.next=L(0),O.throw=L(1),O.return=L(2),typeof Symbol=="function"&&(O[Symbol.iterator]=function(){return this}),O;function L(B){return function(W){return V([B,W])}}function V(B){if(b)throw new TypeError("Generator is already executing.");for(;O&&(O=0,B[0]&&(E=0)),E;)try{if(b=1,C&&(I=B[0]&2?C.return:B[0]?C.throw||((I=C.return)&&I.call(C),0):C.next)&&!(I=I.call(C,B[1])).done)return I;switch(C=0,I&&(B=[B[0]&2,I.value]),B[0]){case 0:case 1:I=B;break;case 4:return E.label++,{value:B[1],done:!1};case 5:E.label++,C=B[1],B=[0];continue;case 7:B=E.ops.pop(),E.trys.pop();continue;default:if(I=E.trys,!(I=I.length>0&&I[I.length-1])&&(B[0]===6||B[0]===2)){E=0;continue}if(B[0]===3&&(!I||B[1]>I[0]&&B[1]<I[3])){E.label=B[1];break}if(B[0]===6&&E.label<I[1]){E.label=I[1],I=B;break}if(I&&E.label<I[2]){E.label=I[2],E.ops.push(B);break}I[2]&&E.ops.pop(),E.trys.pop();continue}B=_.call(p,E)}catch(W){B=[6,W],C=0}finally{b=I=0}if(B[0]&5)throw B[1];return{value:B[0]?B[1]:void 0,done:!0}}};Object.defineProperty(Ep,"__esModule",{value:!0}),Ep.useUnityInstance=void 0;var i=Mu(),o=Xoe(),l=R3(),d=function(p,_,E,b){(0,i.useEffect)(function(){(function(){return n(void 0,void 0,void 0,function(){var C,I;return e(this,function(O){switch(O.label){case 0:if(l.isBrowserEnvironment===!1)return[2];if(p!==o.UnityLoaderStatus.Loaded||_===null)return b.setUnityInstance(null),b.setInitialisationError(null),[2];O.label=1;case 1:return O.trys.push([1,3,,4]),[4,window.createUnityInstance(_,E,b.setLoadingProgression)];case 2:return C=O.sent(),b.setUnityInstance(C),b.setInitialisationError(null),[3,4];case 3:return I=O.sent(),b.setUnityInstance(null),b.setInitialisationError(I),[3,4];case 4:return[2]}})})})()},[p,_,E,b])};return Ep.useUnityInstance=d,Ep}var Pw={},IQ;function e8e(){if(IQ)return Pw;IQ=1,Object.defineProperty(Pw,"__esModule",{value:!0}),Pw.useUnityArguments=void 0;var n=Mu(),e=function(i){return(0,n.useMemo)(function(){return{dataUrl:i.unityProvider.unityConfig.dataUrl,frameworkUrl:i.unityProvider.unityConfig.frameworkUrl,codeUrl:i.unityProvider.unityConfig.codeUrl,streamingAssetsUrl:i.unityProvider.unityConfig.streamingAssetsUrl,memoryUrl:i.unityProvider.unityConfig.memoryUrl,symbolsUrl:i.unityProvider.unityConfig.symbolsUrl,workerUrl:i.unityProvider.unityConfig.workerUrl,companyName:i.unityProvider.unityConfig.companyName,productName:i.unityProvider.unityConfig.productName,productVersion:i.unityProvider.unityConfig.productVersion,webglContextAttributes:i.unityProvider.unityConfig.webglContextAttributes||{},cacheControl:i.unityProvider.unityConfig.cacheControl||function(){return"must-revalidate"},devicePixelRatio:i.devicePixelRatio||1,autoSyncPersistentDataPath:i.autoSyncPersistentDataPath,matchWebGLToCanvasSize:typeof i.matchWebGLToCanvasSize=="boolean"?i.matchWebGLToCanvasSize:!0,disabledCanvasEvents:i.disabledCanvasEvents||["contextmenu","dragstart"],print:function(o){},printErr:function(o){}}},[])};return Pw.useUnityArguments=e,Pw}var Ow={},AQ;function t8e(){if(AQ)return Ow;AQ=1,Object.defineProperty(Ow,"__esModule",{value:!0}),Ow.useUnityLoader=void 0;var n=Mu(),e=R3(),i=Xoe(),o=function(l){var d=(0,n.useState)(i.UnityLoaderStatus.Loading),p=d[0],_=d[1];return(0,n.useEffect)(function(){if(e.isBrowserEnvironment!==!1){if(l.loaderUrl===null){_(i.UnityLoaderStatus.Idle);return}var E=window.document.querySelector('script[src="'.concat(l.loaderUrl,'"]'));E===null?(E=window.document.createElement("script"),E.type="text/javascript",E.src=l.loaderUrl,E.async=!0,E.setAttribute("data-status","loading"),window.document.body.appendChild(E),E.addEventListener("load",function(){return E==null?void 0:E.setAttribute("data-status","loaded")}),E.addEventListener("error",function(){return E==null?void 0:E.setAttribute("data-status","error")})):_(E.getAttribute("data-status")==="loaded"?i.UnityLoaderStatus.Loaded:i.UnityLoaderStatus.Error);var b=function(C){return _(C.type==="load"?i.UnityLoaderStatus.Loaded:i.UnityLoaderStatus.Error)};return E.addEventListener("load",b),E.addEventListener("error",b),function(){E!==null&&(E.removeEventListener("load",b),E.removeEventListener("error",b),window.document.body.removeChild(E))}}},[l.loaderUrl]),p};return Ow.useUnityLoader=o,Ow}var PQ;function n8e(){if(PQ)return Cw;PQ=1,Object.defineProperty(Cw,"__esModule",{value:!0}),Cw.Unity=void 0;var n=Mu(),e=Mu(),i=QWe(),o=ZWe(),l=e8e(),d=t8e(),p=(0,e.forwardRef)(function(_,E){var b=(0,e.useRef)(null),C=(0,i.useUnityCanvasId)(_),I=(0,l.useUnityArguments)(_),O=(0,d.useUnityLoader)(_.unityProvider.unityConfig);return(0,o.useUnityInstance)(O,b.current,I,_.unityProvider),(0,n.useImperativeHandle)(E,function(){return b.current}),(0,n.createElement)("canvas",{ref:b,id:C,style:_.style,className:_.className,tabIndex:_.tabIndex})});return Cw.Unity=p,Cw}var vp={},kw={},OQ;function Joe(){if(OQ)return kw;OQ=1,Object.defineProperty(kw,"__esModule",{value:!0}),kw.errorMessages=void 0;var n={genericNoUnityInstance:"No Unity Instance found.",requestFullscreenNoUnityInstance:"Unable to Set Fullscreen while Unity is not Instantiated.",requestPointerLockNoUnityInstanceOrCanvas:"Unable to Request Pointer Lock while Unity is not Instantiated or the Canvas is not found.",sendMessageNoUnityInstance:"Unable to Send Message while Unity is not Instantiated.",quitNoUnityInstance:"Unable to Quit Unity while Unity is not Instantiated.",screenshotNoUnityInstanceOrCanvas:"Unable to Take Screenshot while Unity is not Instantiated or Canvas is not available.",noEventListener:"Unable to find Event Listener in Event System for Event"};return kw.errorMessages=n,kw}var fy={},kQ;function r8e(){if(kQ)return fy;kQ=1;var n=fy&&fy.__spreadArray||function(_,E,b){if(b||arguments.length===2)for(var C=0,I=E.length,O;C<I;C++)(O||!(C in E))&&(O||(O=Array.prototype.slice.call(E,0,C)),O[C]=E[C]);return _.concat(O||Array.prototype.slice.call(E))};Object.defineProperty(fy,"__esModule",{value:!0}),fy.useEventSystem=void 0;var e=Mu(),i=Joe(),o=R3(),l=[],d=function(_){for(var E=[],b=1;b<arguments.length;b++)E[b-1]=arguments[b];var C=void 0;return l.forEach(function(I){C=I.apply(void 0,n([_],E,!1))}),C};o.isBrowserEnvironment===!0&&(window.dispatchReactUnityEvent=d);var p=function(){var _=(0,e.useRef)([]),E=(0,e.useCallback)(function(I,O){_.current=n(n([],_.current,!0),[{eventName:I,callback:O}],!1)},[_]),b=(0,e.useCallback)(function(I,O){_.current=_.current.filter(function(L){return L.eventName!==I&&L.callback!==O})},[_]),C=(0,e.useCallback)(function(I){for(var O=[],L=1;L<arguments.length;L++)O[L-1]=arguments[L];var V=_.current.find(function(B){return B.eventName===I});if(typeof V>"u"){console.warn(i.errorMessages.noEventListener,{eventName:I});return}return V.callback.apply(V,O)},[_]);return(0,e.useEffect)(function(){return l.push(C),function(){l.splice(l.indexOf(C),1)}},[C]),{addEventListener:E,removeEventListener:b}};return fy.useEventSystem=p,fy}var Nw={},NQ;function i8e(){if(NQ)return Nw;NQ=1,Object.defineProperty(Nw,"__esModule",{value:!0}),Nw.useNullableState=void 0;var n=Mu(),e=function(i){return(0,n.useState)(i||null)};return Nw.useNullableState=e,Nw}var DQ;function s8e(){if(DQ)return vp;DQ=1;var n=vp&&vp.__awaiter||function(_,E,b,C){function I(O){return O instanceof b?O:new b(function(L){L(O)})}return new(b||(b=Promise))(function(O,L){function V(Z){try{W(C.next(Z))}catch($){L($)}}function B(Z){try{W(C.throw(Z))}catch($){L($)}}function W(Z){Z.done?O(Z.value):I(Z.value).then(V,B)}W((C=C.apply(_,E||[])).next())})},e=vp&&vp.__generator||function(_,E){var b={label:0,sent:function(){if(O[0]&1)throw O[1];return O[1]},trys:[],ops:[]},C,I,O,L=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return L.next=V(0),L.throw=V(1),L.return=V(2),typeof Symbol=="function"&&(L[Symbol.iterator]=function(){return this}),L;function V(W){return function(Z){return B([W,Z])}}function B(W){if(C)throw new TypeError("Generator is already executing.");for(;L&&(L=0,W[0]&&(b=0)),b;)try{if(C=1,I&&(O=W[0]&2?I.return:W[0]?I.throw||((O=I.return)&&O.call(I),0):I.next)&&!(O=O.call(I,W[1])).done)return O;switch(I=0,O&&(W=[W[0]&2,O.value]),W[0]){case 0:case 1:O=W;break;case 4:return b.label++,{value:W[1],done:!1};case 5:b.label++,I=W[1],W=[0];continue;case 7:W=b.ops.pop(),b.trys.pop();continue;default:if(O=b.trys,!(O=O.length>0&&O[O.length-1])&&(W[0]===6||W[0]===2)){b=0;continue}if(W[0]===3&&(!O||W[1]>O[0]&&W[1]<O[3])){b.label=W[1];break}if(W[0]===6&&b.label<O[1]){b.label=O[1],O=W;break}if(O&&b.label<O[2]){b.label=O[2],b.ops.push(W);break}O[2]&&b.ops.pop(),b.trys.pop();continue}W=E.call(_,b)}catch(Z){W=[6,Z],I=0}finally{C=O=0}if(W[0]&5)throw W[1];return{value:W[0]?W[1]:void 0,done:!0}}};Object.defineProperty(vp,"__esModule",{value:!0}),vp.useUnityContext=void 0;var i=Mu(),o=Joe(),l=r8e(),d=i8e(),p=function(_){var E=(0,d.useNullableState)(),b=E[0],C=E[1],I=(0,i.useState)(0),O=I[0],L=I[1],V=(0,i.useState)(!1),B=V[0],W=V[1],Z=(0,d.useNullableState)(),$=Z[0],se=Z[1],ue=(0,l.useEventSystem)(),re=(0,i.useRef)({setLoadingProgression:L,setInitialisationError:se,setUnityInstance:C,setIsLoaded:W,unityConfig:_}),pe=(0,i.useCallback)(function(de){if(b===null){console.warn(o.errorMessages.requestFullscreenNoUnityInstance);return}b.SetFullscreen(de===!0?1:0)},[b]),q=(0,i.useCallback)(function(){if(b===null||typeof b.Module.canvas>"u"){console.warn(o.errorMessages.requestPointerLockNoUnityInstanceOrCanvas);return}return b.Module.canvas.requestPointerLock()},[b]),Q=(0,i.useCallback)(function(de,le,xe){if(b===null){console.warn(o.errorMessages.sendMessageNoUnityInstance);return}b.SendMessage(de,le,xe)},[b]),J=(0,i.useCallback)(function(de,le){if(b===null||typeof b.Module.canvas>"u"){console.warn(o.errorMessages.screenshotNoUnityInstanceOrCanvas);return}return b.Module.canvas.toDataURL(de,le)},[b]),ie=(0,i.useCallback)(function(){return b===null?(console.warn(o.errorMessages.quitNoUnityInstance),Promise.reject()):b.Quit()},[b]),me=(0,i.useCallback)(function(){return n(void 0,void 0,void 0,function(){var de;return e(this,function(le){switch(le.label){case 0:return b===null||typeof b.Module.canvas>"u"?(console.warn(o.errorMessages.genericNoUnityInstance),[2,Promise.reject()]):(de=b.Module.canvas,document.body.appendChild(de),de.style.display="none",[4,ie()]);case 1:return le.sent(),de.remove(),[2]}})})},[b]);return(0,i.useEffect)(function(){W(O===1)},[O]),{unityProvider:re.current,loadingProgression:O,initialisationError:$,isLoaded:B,UNSAFE__unityInstance:b,requestFullscreen:pe,requestPointerLock:q,sendMessage:Q,takeScreenshot:J,unload:ie,UNSAFE__detachAndUnloadImmediate:me,addEventListener:ue.addEventListener,removeEventListener:ue.removeEventListener}};return vp.useUnityContext=p,vp}var xQ;function o8e(){return xQ||(xQ=1,function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.useUnityContext=n.Unity=void 0;var e=n8e();Object.defineProperty(n,"Unity",{enumerable:!0,get:function(){return e.Unity}});var i=s8e();Object.defineProperty(n,"useUnityContext",{enumerable:!0,get:function(){return i.useUnityContext}})}(VU)),VU}var Qoe=o8e();const Od="[UnityProvider]",wF=D.createContext(),a8e=({spaceID:n,children:e,loaderUrl:i,dataUrl:o,frameworkUrl:l,codeUrl:d,loadingBackground:p,showLoginButton:_,showDisruptiveLogo:E})=>{Y.log(`${Od} Initializing with spaceID:`,n),Y.log(`${Od} Unity URLs:`,{loaderUrl:i,dataUrl:o,frameworkUrl:l,codeUrl:d});const{unityProvider:b,loadingProgression:C,isLoaded:I,sendMessage:O,addEventListener:L,removeEventListener:V,error:B}=Qoe.useUnityContext({loaderUrl:i,dataUrl:o,frameworkUrl:l,codeUrl:d}),W={unityProvider:b,loadingProgression:C,isLoaded:I,sendMessage:O,addEventListener:L,removeEventListener:V,error:B,spaceID:n},Z=D.useRef(null),$=D.useRef(Date.now());D.useEffect(()=>{const pe=()=>{document.hidden?(Y.log(`${Od} Page hidden, starting keep-alive`),se()):(Y.log(`${Od} Page visible, stopping keep-alive`),ue())};return document.addEventListener("visibilitychange",pe),()=>{document.removeEventListener("visibilitychange",pe),ue()}},[]),D.useEffect(()=>{const pe=()=>{$.current=Date.now(),document.hidden&&O("WebGLInputManager","KeepAlive")};return window.addEventListener("mousemove",pe),window.addEventListener("keydown",pe),window.addEventListener("touchstart",pe),()=>{window.removeEventListener("mousemove",pe),window.removeEventListener("keydown",pe),window.removeEventListener("touchstart",pe)}},[O]);const se=()=>{Z.current||(Z.current=setInterval(()=>{I&&document.hidden&&(O("WebGLInputManager","KeepAlive"),Y.debug(`${Od} Sent keep-alive message`))},1e4))},ue=()=>{Z.current&&(clearInterval(Z.current),Z.current=null)};D.useEffect(()=>(Y.log(`${Od} Component mounted`),()=>{Y.log(`${Od} Component unmounting`),ue()}),[]),D.useEffect(()=>{Y.log(`${Od} Loading progress:`,C)},[C]),D.useEffect(()=>{I&&(Y.log(`${Od} Unity instance loaded for:`,n),document.hidden&&se())},[I,n]),D.useEffect(()=>{B&&Y.error(`${Od} Unity error:`,B)},[B]),Y.log(`${Od} Rendering provider with instance:`,W),D.useEffect(()=>{Y.log("UnityProvider: Unity build URLs:",{loaderUrl:i,dataUrl:o,frameworkUrl:l,codeUrl:d})},[i,o,l,d]);const re=[];if(i||re.push("loaderUrl"),o||re.push("dataUrl"),l||re.push("frameworkUrl"),d||re.push("codeUrl"),re.length>0)return Y.error(`UnityProvider: Missing required Unity build URLs: ${re.join(", ")}`),w.jsx(wF.Provider,{value:{unityProvider:null,loadingProgression:0,isLoaded:!1,sendMessage:()=>{},addEventListener:()=>{},removeEventListener:()=>{},error:new Error(`Missing required Unity build URLs: ${re.join(", ")}`),spaceID:n},children:e});try{return D.useEffect(()=>{Y.log("UnityProvider: Unity context created:",b),b?Y.log("UnityProvider: Unity provider is available"):Y.error("UnityProvider: Unity provider is not available"),I?Y.log("UnityProvider: Unity is loaded"):Y.log("UnityProvider: Unity is not loaded yet")},[b,I]),w.jsx(wF.Provider,{value:W,children:e})}catch(pe){return Y.error("UnityProvider: Error creating Unity context:",pe),w.jsxs("div",{style:{padding:"20px",color:"red",backgroundColor:"#ffeeee",border:"1px solid red",borderRadius:"5px"},children:[w.jsx("h3",{children:"Unity Error"}),w.jsxs("p",{children:["Error creating Unity context: ",pe.message]}),w.jsx("p",{children:"Please check the console for more details."})]})}},ba=()=>D.useContext(wF),Ef=()=>{const{sendMessage:n,isLoaded:e}=ba(),i=D.useRef([]),o=D.useCallback(()=>{if(e)for(;i.current.length>0;){const{eventName:d,data:p}=i.current.shift();Y.log("useSendUnityEvent: Processing queued event to Unity:",d,p);try{n("ReactIncomingEvent","HandleEvent",JSON.stringify({eventName:d,data:JSON.stringify(p)}))}catch(_){Y.error("useSendUnityEvent: Error sending event to Unity:",_),i.current.unshift({eventName:d,data:p});break}}},[n,e]);return D.useEffect(()=>{const d=setInterval(()=>{o()},1e3);return()=>clearInterval(d)},[o]),D.useCallback((d,p)=>{Y.log("useSendUnityEvent: Queuing event for Unity:",d),i.current.push({eventName:d,data:p}),o()},[o])},vf=()=>{const{addEventListener:n,removeEventListener:e}=ba();return D.useCallback((i,o)=>{const l=d=>{Y.log(i+" unity message received.");let p=null;if(d)try{p=JSON.parse(d)}catch(_){Y.warn("Failed to parse JSON data from Unity message:",_)}o(p)};return n(i,l),()=>{e(i,l)}},[n,e])},Zoe=()=>{const[n,e]=D.useState({}),[i,o]=D.useState(!1),[l,d]=D.useState(null),[p,_]=D.useState(0),E=Ef(),b=vf(),{spaceID:C,sendMessage:I,isLoaded:O}=ba(),L=D.useCallback((Z,$)=>{if(!Z)return;Y.log(`useHLSStream: Sending stream URL to Unity: ${Z} for player ${$}`);const se={identifier:"LiveProjector",playerIndex:$.toString(),streamUrl:Z};if(E("SetHLSStream",se),O&&I)try{Y.log("useHLSStream: Sending with ReactIncomingEvent approach"),I("ReactIncomingEvent","HandleEvent",JSON.stringify({eventName:"SetHLSStream",data:JSON.stringify(se)})),Y.log("useHLSStream: Sending with direct HLSStream approach"),I("HLSStream","SetHLSStream",JSON.stringify({identifier:"LiveProjector",playerIndex:$.toString(),streamUrl:Z})),Y.log("useHLSStream: Sending with most direct approach possible"),I("LiveProjector","SetStreamUrl",Z),I("HLSStreamClient","SetStreamUrl",JSON.stringify({Index:$.toString(),Url:Z}))}catch(ue){Y.error("useHLSStream: Error with direct message:",ue)}else Y.warn("useHLSStream: Unity not loaded, could not send direct message")},[E,I,O]);D.useEffect(()=>{C&&V(C)},[C]);const V=async Z=>{try{if(!Z){Y.warn("useHLSStream: Cannot load stream from Firebase - no spaceID");return}o(!0),Y.log(`useHLSStream: Loading stream from Firebase for space ${Z}`);const $=await Doe(Z);if($&&$.streamUrl)if(Y.log(`useHLSStream: Loaded stream data from Firebase for space ${Z}`,$),d($),O)Y.log("useHLSStream: Unity is loaded, sending stream URL to Unity after delay"),setTimeout(()=>{L($.streamUrl,$.playerIndex||"0")},500),setTimeout(()=>{Y.log("useHLSStream: Sending backup stream URL to Unity after longer delay"),L($.streamUrl,$.playerIndex||"0")},2e3);else{Y.warn("useHLSStream: Unity is not loaded yet, will try again later");const se=setInterval(()=>{O&&(Y.log("useHLSStream: Unity is now loaded, sending stream URL to Unity"),L($.streamUrl,$.playerIndex||"0"),clearInterval(se))},1e3);setTimeout(()=>{clearInterval(se)},3e4)}else Y.log(`useHLSStream: No saved stream found for space ${Z}`),d(null)}catch($){Y.error(`useHLSStream: Error loading stream from Firebase for space ${Z}`,$)}finally{o(!1)}},B=D.useCallback(async()=>{C&&(Y.log(`useHLSStream: Forcing reload of stream data for space ${C}`),_(Z=>Z+1),await V(C))},[C]),W=D.useCallback(async(Z,$=0,se={})=>{try{if(!Z||!Z.trim()){Y.error("useHLSStream: Invalid stream URL");return}o(!0),Y.log(`useHLSStream: Setting HLS stream URL for LiveProjector[${$}]`,Z);const{enabled:ue=!0,rtmpUrl:re="",streamKey:pe="",skipSendToUnity:q=!1}=se;if(q||L(Z,$),C)try{const Q={streamUrl:Z,playerIndex:$.toString(),enabled:ue,rtmpUrl:re,streamKey:pe,updatedAt:new Date().toISOString()};Y.log(`useHLSStream: Saving stream URL to Firebase for space ${C}`,Q),await gF(C,Q),d(Q)}catch(Q){throw Y.error(`useHLSStream: Error saving stream URL to Firebase for space ${C}`,Q),Q}else Y.warn("useHLSStream: No spaceID available, stream URL not saved to Firebase")}finally{o(!1)}},[L,C]);return D.useEffect(()=>{const $=b("SetHLSStream",se=>{if(se)try{Y.log("useHLSStream: Received player status update",se);const{identifier:ue,playerIndex:re,isReady:pe,isPlaying:q}=se,Q=`${ue}_${re}`;e(J=>({...J,[Q]:{identifier:ue,playerIndex:re,isReady:pe,isPlaying:q}}))}catch(ue){Y.error("useHLSStream: Error handling player status update",ue)}});return()=>{$()}},[b]),D.useEffect(()=>{if(l&&l.streamUrl){Y.log("useHLSStream: Resending saved stream URL to Unity");const Z=setTimeout(()=>{L(l.streamUrl,l.playerIndex||"0")},1e3);return()=>clearTimeout(Z)}},[l,n,L,p]),D.useEffect(()=>{const Z=$=>{if($.detail){if(Y.log("useHLSStream: Received stream update event",$.detail),C===$.detail.spaceId)Y.log(`useHLSStream: Stream update is for our space ${C}, loading stream data`),V(C);else if($.detail.streamUrl){Y.log(`useHLSStream: Using stream URL directly from event: ${$.detail.streamUrl}`);const se=$.detail.playerIndex||"0";L($.detail.streamUrl,se),d($.detail)}}};return window.addEventListener("SpaceHLSStreamUpdated",Z),window.addEventListener("SpaceStreamUpdated",Z),()=>{window.removeEventListener("SpaceHLSStreamUpdated",Z),window.removeEventListener("SpaceStreamUpdated",Z)}},[C,L]),{setHLSStreamUrl:W,playerStatus:n,isLoading:i,savedStreamData:l,reloadStreamData:B}},c8e=()=>{const[n,e]=D.useState(!1),i=vf();return D.useEffect(()=>{const l=i("FirstSceneLoaded",()=>{Y.log("FirstSceneLoaded unity message received."),e(!0)});return()=>{l()}},[i]),n},l8e=()=>{const[n,e]=D.useState(null),i=vf();return console.log(" Nameplate click hook initialized"),D.useEffect(()=>{console.log(" Setting up nameplate click listener...");const d=i("OpenNameplateModal",p=>{if(console.log(" Nameplate click detected!",p),!p){console.warn(" Received empty data in nameplate click handler");return}try{const _=typeof p=="string"?JSON.parse(p):p;e({playerName:_.playerName,playerId:_.playerId,uid:_.uid,isLocalPlayer:_.isLocalPlayer}),console.log(" Processed nameplate data:",_)}catch(_){console.error(" Error processing nameplate data:",_)}});return()=>{console.log(" Cleaning up nameplate click listener"),typeof d=="function"&&d()}},[i]),[n,()=>{console.log(" Resetting nameplate data"),e(null)}]},u8e=()=>{const n=vf(),{sendUserToUnity:e}=D.useContext(Go);return D.useEffect(()=>{const o=n("RequestUserForUnity",()=>{Y.log("React: Request from Unity to send user data"),e()});return()=>{o()}},[n,e]),!0},LQ=async(n,e,i,o={})=>{try{const{mediaType:l="image",displayAsVideo:d=!1,directUrl:p=null}=o;if(!n||!e)throw new Error("Missing required parameters: spaceId and mediaScreenId");let _=null;if(i){if(!i.type.startsWith("image/"))throw new Error("File must be an image");const E=iE(),b=Date.now(),C=i.name.split(".").pop(),I=`${e}_${b}.${C}`,O=rE(E,`spaces/${n}/mediaScreens/${I}`);Y.log(`Uploading image for media screen ${e} in space ${n}`);const L=await _3(O,i);_=await kN(L.ref);const V=$r(gr,`spaces/${n}/mediaScreens`,e);await M0(V,{imageUrl:_,gsUrl:`gs://${L.ref.bucket}/${L.ref.fullPath}`,fileName:I,mediaType:l,displayAsVideo:d,uploadedAt:new Date().toISOString(),updatedAt:new Date().toISOString()},{merge:!0})}else if(p){_=p;const E=$r(gr,`spaces/${n}/mediaScreens`,e);await M0(E,{videoUrl:p,mediaType:l,displayAsVideo:d,uploadedAt:new Date().toISOString(),updatedAt:new Date().toISOString()},{merge:!0})}else throw new Error("Either imageFile or directUrl must be provided");return Y.log(`Successfully uploaded ${l} for media screen ${e} (display as video: ${d})`),_}catch(l){throw Y.error(`Error uploading media screen ${(o==null?void 0:o.mediaType)||"image"}:`,l),l}},I3=async n=>{Y.log(`Getting media screen images for space: ${n}`);try{const e=Yp(gr,`spaces/${n}/mediaScreens`),i=await Ky(e),o=[];return i.forEach(l=>{o.push({id:l.id,...l.data()})}),o}catch(e){throw Y.error("Error fetching media screen images from Firestore:",e),e}},kp=async(n,e)=>{try{const i=$r(gr,`spaces/${n}/mediaScreens`,e),o=await To(i);return o.exists()?{id:o.id,...o.data()}:(Y.warn(`No media screen found with ID: ${e}`),null)}catch(i){throw Y.error("Error fetching media screen image:",i),i}},d8e=async(n,e)=>{try{const i=await kp(n,e);if(!i)return Y.warn(`No media screen found with ID: ${e} to delete`),!1;if(i.gsUrl){const l=iE(),d=rE(l,i.gsUrl);try{await y3(d),Y.log(`Deleted file from storage: ${i.gsUrl}`)}catch(p){Y.warn(`Could not delete file from storage: ${p.message}`)}}const o=$r(gr,`spaces/${n}/mediaScreens`,e);return i.mediaType==="video"?(await Co(o,{videoUrl:null,mediaType:null,displayAsVideo:!1,deletedAt:new Date().toISOString(),updatedAt:new Date().toISOString()}),Y.log(`Successfully removed video for media screen ${e}`)):(await Co(o,{imageUrl:null,gsUrl:null,fileName:null,mediaType:null,displayAsVideo:!1,deletedAt:new Date().toISOString(),updatedAt:new Date().toISOString()}),Y.log(`Successfully removed image for media screen ${e}`)),!0}catch(i){throw Y.error("Error deleting media screen image:",i),i}},h8e=async(n,e,i)=>{try{if(!n||!e||typeof i!="boolean")throw new Error("Missing or invalid required parameters");const o=await kp(n,e);if(!o||!o.imageUrl&&!o.videoUrl)return Y.warn(`No media screen content found with ID: ${e} to update`),!1;const l=$r(gr,`spaces/${n}/mediaScreens`,e);return await Co(l,{displayAsVideo:i,updatedAt:new Date().toISOString()}),Y.log(`Successfully updated display mode for media screen ${e} to ${i?"video":"image"}`),!0}catch(o){throw Y.error("Error updating media screen display mode:",o),o}},f8e=n=>{if(!n)return null;try{if(n.includes("firebasestorage.googleapis.com")){const e=new URL(n),i=e.searchParams.get("alt"),o=e.searchParams.get("token");return e.search="",i&&e.searchParams.set("alt",i),o&&e.searchParams.set("token",o),console.log(`Cleaned Firebase URL from ${n} to ${e.toString()}`),e.toString()}return n}catch(e){return console.error("Error cleaning Firebase URL:",e),n}},eae=()=>{const{spaceID:n}=ba(),e=Ef(),[i,o]=D.useState(!1);D.useEffect(()=>{if(window.isPlayerInstantiated){Y.log("useUnityMediaScreenImages: Unity already ready (via window flag)"),o(!0);return}const l=()=>{Y.log("useUnityMediaScreenImages: Unity is now ready (PlayerInstantiated event)"),o(!0)};return window.addEventListener("PlayerInstantiated",l),()=>{window.removeEventListener("PlayerInstantiated",l)}},[]),D.useEffect(()=>{if(!i){Y.log("useUnityMediaScreenImages: Waiting for Unity to be ready before loading media screens");return}Y.log("useUnityMediaScreenImages: Unity is ready, now loading media screens"),(async()=>{try{if(!n)throw new Error("spaceID is not defined.");const d=await I3(n);Y.log("Fetched Media Screen Images",d),d.forEach(p=>{const{id:_,imageUrl:E,displayAsVideo:b,videoUrl:C}=p;let I=null;(!b||!C)&&(I=E?f8e(E):null),e("SetMediaScreenImage",{mediaScreenId:_,imageUrl:I,videoUrl:C||null,displayAsVideo:b||!1,timestamp:Date.now()}),Y.log(`Sent media screen data for ${_} to Unity (displayAsVideo: ${b})`),b&&C&&(e("SetMediaScreenDisplayMode",{mediaScreenId:_,displayAsVideo:!0,videoUrl:C,timestamp:Date.now()}),Y.log(`Set display mode to video for screen ${_}`))})}catch(d){Y.error("Error fetching media screen images:",d)}})()},[e,n,i])},p8e=()=>{const{spaceID:n}=ba(),e=Ef(),[i,o]=D.useState(!1);D.useEffect(()=>{if(window.isPlayerInstantiated){Y.log("useUnityThumbnails: Unity already ready (via window flag)"),o(!0);return}const l=()=>{Y.log("useUnityThumbnails: Unity is now ready (PlayerInstantiated event)"),o(!0)};return window.addEventListener("PlayerInstantiated",l),()=>{window.removeEventListener("PlayerInstantiated",l)}},[]),D.useEffect(()=>{if(!i){Y.log("useUnityThumbnails: Waiting for Unity to be ready before loading thumbnails");return}Y.log("useUnityThumbnails: Unity is ready, now loading thumbnails"),(async()=>{try{if(!n)throw new Error("spaceID is not defined.");const d=await Noe(n),p=async b=>{const C=`https://vimeo.com/api/oembed.json?url=${b}`,I=await fetch(C);if(!I.ok)throw new Error(`Failed to fetch thumbnail: ${I.statusText}`);const O=await I.json(),L=O.thumbnail_url.replace(/_\d+x\d+/,""),V=["640x360","295x166"];let B=null;for(let W of V){const Z=`https://i.vimeocdn.com/filter/overlay?src0=${encodeURIComponent(`${L}_${W}`)}&src1=http://f.vimeocdn.com/p/images/crawler_play.png`;try{if((await fetch(Z,{method:"HEAD"})).ok){B=Z;break}}catch($){console.warn(`Failed to validate thumbnail URL: ${Z}`,$)}}return B||O.thumbnail_url},_=d.map(async b=>{const C=await p(b.url);return{gameObjectName:b.id,thumbnailUrl:C}}),E=await Promise.all(_);Y.log("Fetched Thumbnails",E),E.forEach(({gameObjectName:b,thumbnailUrl:C})=>{e("SetThumbnail",{gameObjectName:b,thumbnailUrl:C})})}catch(d){Y.error("Error fetching thumbnails:",d)}})()},[e,n,i])},tae=()=>{const[n,e]=D.useState([]),i=vf();return D.useEffect(()=>{let o=!0,l=null;const d=()=>{window.unityInstance&&(Y.log("Requesting fresh player list"),window.unityInstance.SendMessage("NetworkManager","RequestPlayerList"))},p=L=>{if(o){Y.log("UpdatePlayerList unity message received.");try{let V=[];if(typeof L=="object"&&L!==null?V=L.players||[]:V=JSON.parse(L).players||[],Array.isArray(V)){const B=Array.from(new Map(V.map(W=>[W.playerId,W])).values());e(B),l&&(clearTimeout(l),l=null)}}catch(V){Y.error("Error handling player list data:",V),l||(l=setTimeout(d,1e3))}}},_=()=>{Y.log("Player disconnected, requesting fresh player list"),d()},E=()=>{Y.log("Player left, requesting fresh player list"),d()};d();const b=i("UpdatePlayerList",p),C=i("PlayerDisconnected",_),I=i("PlayerLeft",E),O=setInterval(d,5e3);return()=>{o=!1,l&&clearTimeout(l),typeof b=="function"&&b(),typeof C=="function"&&C(),typeof I=="function"&&I(),clearInterval(O)}},[i]),n},nae=()=>{const n=Ef(),{isLoaded:e}=ba(),[i,o]=D.useState(!1);D.useEffect(()=>{if(window.isPlayerInstantiated){Y.log("usePlacePrefab: Unity already ready (via window flag)"),o(!0);return}const p=()=>{Y.log("usePlacePrefab: Unity is now ready (PlayerInstantiated event)"),o(!0)};return window.addEventListener("PlayerInstantiated",p),()=>{window.removeEventListener("PlayerInstantiated",p)}},[]);const l=D.useCallback((p,_,E,b)=>{const C=_||{x:0,y:1,z:0},I=E||{x:0,y:0,z:0},O=b||{x:1,y:1,z:1};try{const L={prefabName:p||"TestPrefab",position:C,rotation:I,scale:O};return Y.log("Sending prefab placement to Unity:",L),n("PlacePrefab",L),!0}catch(L){return Y.error("Error placing prefab:",L),!1}},[n]),d=D.useCallback((p,_,E,b)=>{const C=_||{x:0,y:1,z:0},I=E||{x:0,y:0,z:0},O=b||{x:1,y:1,z:1};if(!window.unityInstance)return Y.error("Unity not loaded, cannot place prefab directly"),!1;try{const L={prefabName:p||"TestPrefab",position:C,rotation:I,scale:O},V={eventName:"PlacePrefab",data:JSON.stringify(L)};return Y.log("Directly sending prefab placement to Unity:",L),window.unityInstance.SendMessage("ReactIncomingEvent","HandleEvent",JSON.stringify(V)),!0}catch(L){return Y.error("Error directly placing prefab:",L),!1}},[]);return{placePrefab:l,directPlacePrefab:d,isUnityLoaded:i&&e}},m8e=n=>{const[e,i]=D.useState(null),o=vf(),{spaceID:l}=ba();return D.useEffect(()=>{let p=!0;const E=o("PlayVideo",async b=>{try{const{gameObjectName:C}=b;if(!C){Y.error("Game object name is missing in Unity event data.");return}const I=await Noe(l);Y.log("SPACES VIDEOS",I);const O=I.find(L=>L.id===C);O&&p?(i(O.url),Y.log("Video URL set to:",O.url)):console.error("Video not found for game object:",C)}catch(C){console.error("Error fetching space videos:",C)}});return()=>{p=!1,E()}},[o,l,n]),[e,()=>{i(null)}]};let HO;const g8e=new Uint8Array(16);function _8e(){if(!HO&&(HO=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!HO))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return HO(g8e)}const ga=[];for(let n=0;n<256;++n)ga.push((n+256).toString(16).slice(1));function y8e(n,e=0){return ga[n[e+0]]+ga[n[e+1]]+ga[n[e+2]]+ga[n[e+3]]+"-"+ga[n[e+4]]+ga[n[e+5]]+"-"+ga[n[e+6]]+ga[n[e+7]]+"-"+ga[n[e+8]]+ga[n[e+9]]+"-"+ga[n[e+10]]+ga[n[e+11]]+ga[n[e+12]]+ga[n[e+13]]+ga[n[e+14]]+ga[n[e+15]]}const E8e=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),MQ={randomUUID:E8e};function v8e(n,e,i){if(MQ.randomUUID&&!n)return MQ.randomUUID();n=n||{};const o=n.random||(n.rng||_8e)();return o[6]=o[6]&15|64,o[8]=o[8]&63|128,y8e(o)}const VN="spaces",FN="objects",S8e=async(n,e,i)=>{try{const o=$r(gr,VN,n,FN,e),l={...i,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),spaceId:n,objectId:e};return await M0(o,l),Y.log(`Saved object ${e} to space ${n}`),!0}catch(o){return Y.error("Error saving object to space:",o),!1}},UQ=async n=>{try{const e=Yp(gr,VN,n,FN),i=await Ky(e),o=[];return i.forEach(l=>{o.push({id:l.id,...l.data()})}),Y.log(`Retrieved ${o.length} objects for space ${n}`),o}catch(e){return Y.error("Error getting space objects:",e),[]}},b8e=async(n,e)=>{try{const i=$r(gr,VN,n,FN,e);return await CBe(i),Y.log(`Deleted object ${e} from space ${n}`),!0}catch(i){return Y.error("Error deleting space object:",i),!1}},T8e=async(n,e,i)=>{try{const o=$r(gr,VN,n,FN,e),l={...i,updatedAt:new Date().toISOString()};return await Co(o,l),Y.log(`Updated object ${e} in space ${n}`),!0}catch(o){return Y.error("Error updating space object:",o),!1}},w8e=n=>{const[e,i]=D.useState([]),[o,l]=D.useState(!0),{placePrefab:d,isUnityLoaded:p}=nae();D.useEffect(()=>{(async()=>{if(n){l(!0);try{const O=await UQ(n);i(O),O.forEach(L=>{d(L.prefabName,L.position,L.rotation,L.scale)})}catch(O){Y.error("Error loading space objects:",O)}finally{l(!1)}}})()},[n,d]);const _=D.useCallback(async(I,O,L,V)=>{if(!n)return!1;const B=v8e(),W={prefabName:I,position:O,rotation:L,scale:V,objectId:B},Z=await S8e(n,B,W);return Z&&(i($=>[...$,{id:B,...W}]),d(I,O,L,V)),Z},[n,d]),E=D.useCallback(async I=>{if(!n)return!1;const O=await b8e(n,I);return O&&i(L=>L.filter(V=>V.id!==I)),O},[n]),b=D.useCallback(async(I,O)=>{if(!n)return!1;const L=await T8e(n,I,O);return L&&i(V=>V.map(B=>B.id===I?{...B,...O}:B)),L},[n]),C=D.useCallback(async()=>{if(n){l(!0);try{const I=await UQ(n);i(I),I.forEach(O=>{d(O.prefabName,O.position,O.rotation,O.scale)})}catch(I){Y.error("Error reloading space objects:",I)}finally{l(!1)}}},[n,d]);return{objects:e,isLoading:o,saveObject:_,deleteObject:E,updateObject:b,reloadObjects:C,isUnityLoaded:p}},C8e=n=>({opacity:1});function R8e(){const{loadingProgression:n,isLoaded:e,error:i}=ba(),{user:o}=D.useContext(Go),[l,d]=D.useState(!1),[p,_]=D.useState(!1),[E,b]=D.useState(!1),[C,I]=D.useState(!1),O=D.useRef(!1),L=D.useRef(!1),V=D.useRef(null),B=D.useRef(null),W=D.useRef(null),Z=vf(),$=D.useRef(null),se=D.useRef(null),ue=D.useRef(null);D.useRef(null),D.useEffect(()=>{d(!o&&n===0)},[o,n]),D.useEffect(()=>{const q=document.createElement("style");return q.textContent=`
      /* Set initial Unity canvas styles */
      #unity-canvas, #unity-container {
        opacity: 0 !important;
        transition: opacity 1s ease-in-out;
        z-index: 1 !important; /* Ensure Unity is below our loader */
      }
      
      /* Loader overlay styles */
      .loader-overlay {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        z-index: 99999 !important; /* Extremely high z-index */
        display: flex;
        align-items: center;
        justify-content: center;
        transition: opacity 1.5s ease-in-out;
        pointer-events: auto !important;
        transform: translateZ(0); /* Create stacking context */
      }
      
      /* Loader content styles */
      .loader-content {
        background-color: rgba(0, 0, 0, 0.8);
        padding: 1rem;
        border-radius: 0.5rem;
        color: white;
        text-align: center;
        z-index: 100000 !important; /* Even higher z-index */
      }
    `,document.head.appendChild(q),$.current=q,()=>{$.current&&document.head.removeChild($.current)}},[]),D.useEffect(()=>{const q=()=>{const Q=document.getElementById("unity-canvas"),J=document.getElementById("unity-container");Q&&(V.current=Q,Q.style.zIndex="1"),J&&(B.current=J,J.style.zIndex="1"),Q&&J&&ue.current&&(clearInterval(ue.current),ue.current=null)};return q(),ue.current=setInterval(q,100),()=>{ue.current&&(clearInterval(ue.current),ue.current=null)}},[]),D.useEffect(()=>{window.isFirstSceneLoaded&&(L.current=!0,I(!0));const Q=Z("FirstSceneLoaded",()=>{L.current=!0,I(!0),window.isFirstSceneLoaded=!0}),J=setTimeout(()=>{L.current||(L.current=!0,I(!0),window.isFirstSceneLoaded=!0)},1e4);return()=>{Q(),clearTimeout(J)}},[Z]),D.useEffect(()=>{window.isPlayerInstantiated&&(O.current=!0,b(!0),L.current||(L.current=!0,I(!0),window.isFirstSceneLoaded=!0));const q=()=>{O.current=!0,b(!0),L.current||(L.current=!0,I(!0),window.isFirstSceneLoaded=!0)};window.addEventListener("PlayerInstantiated",q);const Q=Z("PlayerInstantiated",q),J=setTimeout(()=>{O.current||(O.current=!0,b(!0),L.current||(L.current=!0,I(!0),window.isFirstSceneLoaded=!0))},2e4);return()=>{window.removeEventListener("PlayerInstantiated",q),Q(),clearTimeout(J)}},[Z]),D.useEffect(()=>(C&&E&&(console.log("LoaderProgress: Both conditions met, showing Unity canvas"),se.current&&clearTimeout(se.current),se.current=setTimeout(()=>{V.current&&(V.current.style.opacity="1",V.current.style.removeProperty("opacity")),B.current&&(B.current.style.opacity="1",B.current.style.removeProperty("opacity")),W.current&&(W.current.style.opacity="0",W.current.style.pointerEvents="none",setTimeout(()=>{W.current&&(W.current.style.display="none")},1500))},2e3)),()=>{se.current&&clearTimeout(se.current)}),[C,E]);const re=()=>e?e&&!C&&!E?"Scene initializing":C&&!E?"Player initializing":"Ready":"World loading",pe=()=>e?e&&!C&&!E?85:C&&!E?95:100:n*80;return w.jsx(w.Fragment,{children:l?w.jsx(ft,{position:"absolute",zIndex:"99999",width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",style:{transform:"translateZ(0)"},children:w.jsxs(Jr,{spacing:4,padding:6,borderRadius:"md",backgroundColor:"rgba(0, 0, 0, 0.8)",color:"white",children:[w.jsx(nt,{fontSize:"xl",fontWeight:"bold",children:"Sign In Required"}),w.jsx(nt,{textAlign:"center",children:"Please sign in to enter The Disruptive Spaces"}),w.jsx(br,{colorScheme:"blue",size:"lg",width:"200px",onClick:()=>_(!0),children:"Sign In"})]})}):w.jsx(ft,{ref:W,className:"loader-overlay",style:{transform:"translateZ(0)",zIndex:99999},children:w.jsxs(Ar,{className:"loader-content",flexDirection:"column",alignItems:"center",width:"300px",style:{zIndex:1e5},children:[w.jsx(nt,{fontWeight:"bold",children:"Entering The Spaces Metaverse"}),w.jsx(nt,{fontSize:"sm",children:re()}),w.jsx(C0,{value:pe(),size:"lg",width:"100%",marginY:2})]})})})}function I8e(){const{user:n}=D.useContext(Go);return w.jsx("div",{children:n!==null?w.jsx("div",{children:w.jsx(w3,{})}):w.jsxs("div",{children:[w.jsx(MN,{}),w.jsx(UN,{})]})})}function A8e(){const{fullscreenRef:n}=Bd(),[e,i]=D.useState(!1),o=()=>{i(!e)};return w.jsxs(w.Fragment,{children:[w.jsx(Mp,{label:"Help",hasArrow:!0,placement:"top",closeOnClick:!0,portalProps:{containerRef:n},children:w.jsx(Wo,{"aria-label":"Controller Help",icon:w.jsx(pWe,{}),onClick:o,variant:"iconButton"})}),w.jsxs(so,{isOpen:e,onClose:o,size:"md",portalProps:{containerRef:n},children:[w.jsx(ao,{}),w.jsxs(oo,{children:[w.jsx(ec,{children:"Notes"}),w.jsx(zo,{}),w.jsx(wo,{children:w.jsx(nt,{variant:"formIntro",children:"The help button is showing so we can see the blur and transparency styles on the button."})}),w.jsx(zp,{children:w.jsx(br,{variant:"primary",onClick:o,children:"Close"})})]})]})]})}var rae={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},VQ=fi.createContext&&fi.createContext(rae),Ig=function(){return Ig=Object.assign||function(n){for(var e,i=1,o=arguments.length;i<o;i++){e=arguments[i];for(var l in e)Object.prototype.hasOwnProperty.call(e,l)&&(n[l]=e[l])}return n},Ig.apply(this,arguments)},P8e=function(n,e){var i={};for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&e.indexOf(o)<0&&(i[o]=n[o]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var l=0,o=Object.getOwnPropertySymbols(n);l<o.length;l++)e.indexOf(o[l])<0&&Object.prototype.propertyIsEnumerable.call(n,o[l])&&(i[o[l]]=n[o[l]]);return i};function iae(n){return n&&n.map(function(e,i){return fi.createElement(e.tag,Ig({key:i},e.attr),iae(e.child))})}function Or(n){return function(e){return fi.createElement(O8e,Ig({attr:Ig({},n.attr)},e),iae(n.child))}}function O8e(n){var e=function(i){var o=n.attr,l=n.size,d=n.title,p=P8e(n,["attr","size","title"]),_=l||i.size||"1em",E;return i.className&&(E=i.className),n.className&&(E=(E?E+" ":"")+n.className),fi.createElement("svg",Ig({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},i.attr,o,p,{className:E,style:Ig(Ig({color:n.color||i.color},i.style),n.style),height:_,width:_,xmlns:"http://www.w3.org/2000/svg"}),d&&fi.createElement("title",null,d),n.children)};return VQ!==void 0?fi.createElement(VQ.Consumer,null,function(i){return e(i)}):e(rae)}function sae(n){return Or({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"}}]})(n)}function k8e(n){return Or({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M256 8C119.034 8 8 119.033 8 256s111.034 248 248 248 248-111.034 248-248S392.967 8 256 8zm130.108 117.892c65.448 65.448 70 165.481 20.677 235.637L150.47 105.216c70.204-49.356 170.226-44.735 235.638 20.676zM125.892 386.108c-65.448-65.448-70-165.481-20.677-235.637L361.53 406.784c-70.203 49.356-170.226 44.736-235.638-20.676z"}}]})(n)}function FQ(n){return Or({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M173.898 439.404l-166.4-166.4c-9.997-9.997-9.997-26.206 0-36.204l36.203-36.204c9.997-9.998 26.207-9.998 36.204 0L192 312.69 432.095 72.596c9.997-9.997 26.207-9.997 36.204 0l36.203 36.204c9.997 9.997 9.997 26.206 0 36.204l-294.4 294.401c-9.998 9.997-26.207 9.997-36.204-.001z"}}]})(n)}function jQ(n){return Or({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M320 448v40c0 13.255-10.745 24-24 24H24c-13.255 0-24-10.745-24-24V120c0-13.255 10.745-24 24-24h72v296c0 30.879 25.121 56 56 56h168zm0-344V0H152c-13.255 0-24 10.745-24 24v368c0 13.255 10.745 24 24 24h272c13.255 0 24-10.745 24-24V128H344c-13.2 0-24-10.8-24-24zm120.971-31.029L375.029 7.029A24 24 0 0 0 358.059 0H352v96h96v-6.059a24 24 0 0 0-7.029-16.97z"}}]})(n)}function CF(n){return Or({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M528 448H112c-8.8 0-16 7.2-16 16v32c0 8.8 7.2 16 16 16h416c8.8 0 16-7.2 16-16v-32c0-8.8-7.2-16-16-16zm64-320c-26.5 0-48 21.5-48 48 0 7.1 1.6 13.7 4.4 19.8L476 239.2c-15.4 9.2-35.3 4-44.2-11.6L350.3 85C361 76.2 368 63 368 48c0-26.5-21.5-48-48-48s-48 21.5-48 48c0 15 7 28.2 17.7 37l-81.5 142.6c-8.9 15.6-28.9 20.8-44.2 11.6l-72.3-43.4c2.7-6 4.4-12.7 4.4-19.8 0-26.5-21.5-48-48-48S0 149.5 0 176s21.5 48 48 48c2.6 0 5.2-.4 7.7-.8L128 416h384l72.3-192.8c2.5.4 5.1.8 7.7.8 26.5 0 48-21.5 48-48s-21.5-48-48-48z"}}]})(n)}function N8e(n){return Or({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M402.6 83.2l90.2 90.2c3.8 3.8 3.8 10 0 13.8L274.4 405.6l-92.8 10.3c-12.4 1.4-22.9-9.1-21.5-21.5l10.3-92.8L388.8 83.2c3.8-3.8 10-3.8 13.8 0zm162-22.9l-48.8-48.8c-15.2-15.2-39.9-15.2-55.2 0l-35.4 35.4c-3.8 3.8-3.8 10 0 13.8l90.2 90.2c3.8 3.8 10 3.8 13.8 0l35.4-35.4c15.2-15.3 15.2-40 0-55.2zM384 346.2V448H64V128h229.8c3.2 0 6.2-1.3 8.5-3.5l40-40c7.6-7.6 2.2-20.5-8.5-20.5H48C21.5 64 0 85.5 0 112v352c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V306.2c0-10.7-12.9-16-20.5-8.5l-40 40c-2.2 2.3-3.5 5.3-3.5 8.5z"}}]})(n)}function D8e(n){return Or({attr:{viewBox:"0 0 192 512"},child:[{tag:"path",attr:{d:"M96 184c39.8 0 72 32.2 72 72s-32.2 72-72 72-72-32.2-72-72 32.2-72 72-72zM24 80c0 39.8 32.2 72 72 72s72-32.2 72-72S135.8 8 96 8 24 40.2 24 80zm0 352c0 39.8 32.2 72 72 72s72-32.2 72-72-32.2-72-72-72-72 32.2-72 72z"}}]})(n)}function x8e(n){return Or({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M480.07 96H160a160 160 0 1 0 114.24 272h91.52A160 160 0 1 0 480.07 96zM248 268a12 12 0 0 1-12 12h-52v52a12 12 0 0 1-12 12h-24a12 12 0 0 1-12-12v-52H84a12 12 0 0 1-12-12v-24a12 12 0 0 1 12-12h52v-52a12 12 0 0 1 12-12h24a12 12 0 0 1 12 12v52h52a12 12 0 0 1 12 12zm216 76a40 40 0 1 1 40-40 40 40 0 0 1-40 40zm64-96a40 40 0 1 1 40-40 40 40 0 0 1-40 40z"}}]})(n)}function oae(n){return Or({attr:{viewBox:"0 0 496 512"},child:[{tag:"path",attr:{d:"M336.5 160C322 70.7 287.8 8 248 8s-74 62.7-88.5 152h177zM152 256c0 22.2 1.2 43.5 3.3 64h185.3c2.1-20.5 3.3-41.8 3.3-64s-1.2-43.5-3.3-64H155.3c-2.1 20.5-3.3 41.8-3.3 64zm324.7-96c-28.6-67.9-86.5-120.4-158-141.6 24.4 33.8 41.2 84.7 50 141.6h108zM177.2 18.4C105.8 39.6 47.8 92.1 19.3 160h108c8.7-56.9 25.5-107.8 49.9-141.6zM487.4 192H372.7c2.1 21 3.3 42.5 3.3 64s-1.2 43-3.3 64h114.6c5.5-20.5 8.6-41.8 8.6-64s-3.1-43.5-8.5-64zM120 256c0-21.5 1.2-43 3.3-64H8.6C3.2 212.5 0 233.8 0 256s3.2 43.5 8.6 64h114.6c-2-21-3.2-42.5-3.2-64zm39.5 96c14.5 89.3 48.7 152 88.5 152s74-62.7 88.5-152h-177zm159.3 141.6c71.4-21.2 129.4-73.7 158-141.6h-108c-8.8 56.9-25.6 107.8-50 141.6zM19.3 352c28.6 67.9 86.5 120.4 158 141.6-24.4-33.8-41.2-84.7-50-141.6h-108z"}}]})(n)}function L8e(n){return Or({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M256 8C119.043 8 8 119.083 8 256c0 136.997 111.043 248 248 248s248-111.003 248-248C504 119.083 392.957 8 256 8zm0 110c23.196 0 42 18.804 42 42s-18.804 42-42 42-42-18.804-42-42 18.804-42 42-42zm56 254c0 6.627-5.373 12-12 12h-88c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h12v-64h-12c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h64c6.627 0 12 5.373 12 12v100h12c6.627 0 12 5.373 12 12v24z"}}]})(n)}function M8e(n){return Or({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M528 448H48c-26.51 0-48-21.49-48-48V112c0-26.51 21.49-48 48-48h480c26.51 0 48 21.49 48 48v288c0 26.51-21.49 48-48 48zM128 180v-40c0-6.627-5.373-12-12-12H76c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm-336 96v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm-336 96v-40c0-6.627-5.373-12-12-12H76c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm288 0v-40c0-6.627-5.373-12-12-12H172c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h232c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12z"}}]})(n)}function RF(n){return Or({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M633.82 458.1l-157.8-121.96C488.61 312.13 496 285.01 496 256v-48c0-8.84-7.16-16-16-16h-16c-8.84 0-16 7.16-16 16v48c0 17.92-3.96 34.8-10.72 50.2l-26.55-20.52c3.1-9.4 5.28-19.22 5.28-29.67V96c0-53.02-42.98-96-96-96s-96 42.98-96 96v45.36L45.47 3.37C38.49-2.05 28.43-.8 23.01 6.18L3.37 31.45C-2.05 38.42-.8 48.47 6.18 53.9l588.36 454.73c6.98 5.43 17.03 4.17 22.46-2.81l19.64-25.27c5.41-6.97 4.16-17.02-2.82-22.45zM400 464h-56v-33.77c11.66-1.6 22.85-4.54 33.67-8.31l-50.11-38.73c-6.71.4-13.41.87-20.35.2-55.85-5.45-98.74-48.63-111.18-101.85L144 241.31v6.85c0 89.64 63.97 169.55 152 181.69V464h-56c-8.84 0-16 7.16-16 16v16c0 8.84 7.16 16 16 16h160c8.84 0 16-7.16 16-16v-16c0-8.84-7.16-16-16-16z"}}]})(n)}function IF(n){return Or({attr:{viewBox:"0 0 352 512"},child:[{tag:"path",attr:{d:"M176 352c53.02 0 96-42.98 96-96V96c0-53.02-42.98-96-96-96S80 42.98 80 96v160c0 53.02 42.98 96 96 96zm160-160h-16c-8.84 0-16 7.16-16 16v48c0 74.8-64.49 134.82-140.79 127.38C96.71 376.89 48 317.11 48 250.3V208c0-8.84-7.16-16-16-16H16c-8.84 0-16 7.16-16 16v40.16c0 89.64 63.97 169.55 152 181.69V464H96c-8.84 0-16 7.16-16 16v16c0 8.84 7.16 16 16 16h160c8.84 0 16-7.16 16-16v-16c0-8.84-7.16-16-16-16h-56v-33.77C285.71 418.47 352 344.9 352 256v-48c0-8.84-7.16-16-16-16z"}}]})(n)}function U8e(n){return Or({attr:{viewBox:"0 0 384 512"},child:[{tag:"path",attr:{d:"M0 352a160 160 0 0 0 160 160h64a160 160 0 0 0 160-160V224H0zM176 0h-16A160 160 0 0 0 0 160v32h176zm48 0h-16v192h176v-32A160 160 0 0 0 224 0z"}}]})(n)}function V8e(n){return Or({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M416 208H272V64c0-17.67-14.33-32-32-32h-32c-17.67 0-32 14.33-32 32v144H32c-17.67 0-32 14.33-32 32v32c0 17.67 14.33 32 32 32h144v144c0 17.67 14.33 32 32 32h32c17.67 0 32-14.33 32-32V304h144c17.67 0 32-14.33 32-32v-32c0-17.67-14.33-32-32-32z"}}]})(n)}function F8e(n){return Or({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M466.5 83.7l-192-80a48.15 48.15 0 0 0-36.9 0l-192 80C27.7 91.1 16 108.6 16 128c0 198.5 114.5 335.7 221.5 380.3 11.8 4.9 25.1 4.9 36.9 0C360.1 472.6 496 349.3 496 128c0-19.4-11.7-36.9-29.5-44.3zM256.1 446.3l-.1-381 175.9 73.3c-3.3 151.4-82.1 261.1-175.8 307.7z"}}]})(n)}function AF(n){return Or({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M259.3 17.8L194 150.2 47.9 171.5c-26.2 3.8-36.7 36.1-17.7 54.6l105.7 103-25 145.5c-4.5 26.3 23.2 46 46.4 33.7L288 439.6l130.7 68.7c23.2 12.2 50.9-7.4 46.4-33.7l-25-145.5 105.7-103c19-18.5 8.5-50.8-17.7-54.6L382 150.2 316.7 17.8c-11.7-23.6-45.6-23.9-57.4 0z"}}]})(n)}function j8e(n){return Or({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M624 208h-64v-64c0-8.8-7.2-16-16-16h-32c-8.8 0-16 7.2-16 16v64h-64c-8.8 0-16 7.2-16 16v32c0 8.8 7.2 16 16 16h64v64c0 8.8 7.2 16 16 16h32c8.8 0 16-7.2 16-16v-64h64c8.8 0 16-7.2 16-16v-32c0-8.8-7.2-16-16-16zm-400 48c70.7 0 128-57.3 128-128S294.7 0 224 0 96 57.3 96 128s57.3 128 128 128zm89.6 32h-16.7c-22.2 10.2-46.9 16-72.9 16s-50.6-5.8-72.9-16h-16.7C60.2 288 0 348.2 0 422.4V464c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48v-41.6c0-74.2-60.2-134.4-134.4-134.4z"}}]})(n)}function B8e(n){return Or({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M96 224c35.3 0 64-28.7 64-64s-28.7-64-64-64-64 28.7-64 64 28.7 64 64 64zm448 0c35.3 0 64-28.7 64-64s-28.7-64-64-64-64 28.7-64 64 28.7 64 64 64zm32 32h-64c-17.6 0-33.5 7.1-45.1 18.6 40.3 22.1 68.9 62 75.1 109.4h66c17.7 0 32-14.3 32-32v-32c0-35.3-28.7-64-64-64zm-256 0c61.9 0 112-50.1 112-112S381.9 32 320 32 208 82.1 208 144s50.1 112 112 112zm76.8 32h-8.3c-20.8 10-43.9 16-68.5 16s-47.6-6-68.5-16h-8.3C179.6 288 128 339.6 128 403.2V432c0 26.5 21.5 48 48 48h288c26.5 0 48-21.5 48-48v-28.8c0-63.6-51.6-115.2-115.2-115.2zm-223.7-13.4C161.5 263.1 145.6 256 128 256H64c-35.3 0-64 28.7-64 64v32c0 17.7 14.3 32 32 32h65.9c6.3-47.4 34.9-87.3 75.2-109.4z"}}]})(n)}function W8e(n){return Or({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M215.03 71.05L126.06 160H24c-13.26 0-24 10.74-24 24v144c0 13.25 10.74 24 24 24h102.06l88.97 88.95c15.03 15.03 40.97 4.47 40.97-16.97V88.02c0-21.46-25.96-31.98-40.97-16.97zM461.64 256l45.64-45.64c6.3-6.3 6.3-16.52 0-22.82l-22.82-22.82c-6.3-6.3-16.52-6.3-22.82 0L416 210.36l-45.64-45.64c-6.3-6.3-16.52-6.3-22.82 0l-22.82 22.82c-6.3 6.3-6.3 16.52 0 22.82L370.36 256l-45.63 45.63c-6.3 6.3-6.3 16.52 0 22.82l22.82 22.82c6.3 6.3 16.52 6.3 22.82 0L416 301.64l45.64 45.64c6.3 6.3 16.52 6.3 22.82 0l22.82-22.82c6.3-6.3 6.3-16.52 0-22.82L461.64 256z"}}]})(n)}function z8e(n){return Or({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M215.03 71.05L126.06 160H24c-13.26 0-24 10.74-24 24v144c0 13.25 10.74 24 24 24h102.06l88.97 88.95c15.03 15.03 40.97 4.47 40.97-16.97V88.02c0-21.46-25.96-31.98-40.97-16.97zm233.32-51.08c-11.17-7.33-26.18-4.24-33.51 6.95-7.34 11.17-4.22 26.18 6.95 33.51 66.27 43.49 105.82 116.6 105.82 195.58 0 78.98-39.55 152.09-105.82 195.58-11.17 7.32-14.29 22.34-6.95 33.5 7.04 10.71 21.93 14.56 33.51 6.95C528.27 439.58 576 351.33 576 256S528.27 72.43 448.35 19.97zM480 256c0-63.53-32.06-121.94-85.77-156.24-11.19-7.14-26.03-3.82-33.12 7.46s-3.78 26.21 7.41 33.36C408.27 165.97 432 209.11 432 256s-23.73 90.03-63.48 115.42c-11.19 7.14-14.5 22.07-7.41 33.36 6.51 10.36 21.12 15.14 33.12 7.46C447.94 377.94 480 319.54 480 256zm-141.77-76.87c-11.58-6.33-26.19-2.16-32.61 9.45-6.39 11.61-2.16 26.2 9.45 32.61C327.98 228.28 336 241.63 336 256c0 14.38-8.02 27.72-20.92 34.81-11.61 6.41-15.84 21-9.45 32.61 6.43 11.66 21.05 15.8 32.61 9.45 28.23-15.55 45.77-45 45.77-76.88s-17.54-61.32-45.78-76.86z"}}]})(n)}function G8e(n){return Or({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M634.91 154.88C457.74-8.99 182.19-8.93 5.09 154.88c-6.66 6.16-6.79 16.59-.35 22.98l34.24 33.97c6.14 6.1 16.02 6.23 22.4.38 145.92-133.68 371.3-133.71 517.25 0 6.38 5.85 16.26 5.71 22.4-.38l34.24-33.97c6.43-6.39 6.3-16.82-.36-22.98zM320 352c-35.35 0-64 28.65-64 64s28.65 64 64 64 64-28.65 64-64-28.65-64-64-64zm202.67-83.59c-115.26-101.93-290.21-101.82-405.34 0-6.9 6.1-7.12 16.69-.57 23.15l34.44 33.99c6 5.92 15.66 6.32 22.05.8 83.95-72.57 209.74-72.41 293.49 0 6.39 5.52 16.05 5.13 22.05-.8l34.44-33.99c6.56-6.46 6.33-17.06-.56-23.15z"}}]})(n)}function aae({open:n,onClose:e}){const i=D.useRef(null),o=Ef(),{user:l}=D.useContext(Go),d=E=>{i.current&&!i.current.contains(E.target)&&e()},p=async E=>{const b=_(E);if((b==null?void 0:b.source)==="readyplayerme"&&(b.eventName==="v1.frame.ready"&&i.current.contentWindow.postMessage(JSON.stringify({target:"readyplayerme",type:"subscribe",eventName:"v1.**"}),"*"),b.eventName==="v1.avatar.exported")){const C=b.data.url;if(console.log(`Avatar URL: ${C}`),o("AvatarUrlFromReact",{url:C}),l&&l.uid)try{await poe(l.uid,C),e()}catch(I){console.error("Error updating RPM URL:",I)}else console.error("No authenticated user found to update rpmURL.")}},_=E=>{try{return JSON.parse(E.data)}catch{return null}};return D.useEffect(()=>(n&&(document.addEventListener("mousedown",d),window.addEventListener("message",p)),()=>{document.removeEventListener("mousedown",d),window.removeEventListener("message",p)}),[n]),n&&w.jsx($l,{children:w.jsx(ft,{position:"fixed",top:"0",left:"0",width:"100%",height:"100%",bg:"rgba(0, 0, 0, 0.8)",zIndex:1e4,display:"flex",justifyContent:"center",alignItems:"center",onClick:E=>E.stopPropagation(),children:w.jsx(ft,{position:"relative",maxWidth:"1080px",maxHeight:"800px",width:"90%",height:"90%",children:w.jsx("iframe",{ref:i,src:"https://spacesmetaverse.readyplayer.me/avatar?frameApi",title:"Ready Player Me",width:"100%",height:"100%",style:{border:"none",borderRadius:"8px"},allow:"camera *; microphone *; clipboard-write"})})})})}function H8e({isOpen:n,onClose:e}){const[i,o]=D.useState(!1),[l,d]=D.useState(null),{user:p}=D.useContext(Go),_=Ef(),E=V=>{V.stopPropagation(),o(!0)},b=()=>{o(!1),e()},C=async V=>{if(d(V),p&&p.uid)try{await poe(p.uid,V.url),_("AvatarUrlFromReact",{url:V.url}),e()}catch(B){console.error("Error updating RPM URL:",B)}else console.error("No authenticated user found to update rpmURL.")},I=$Ie("gray.200","whiteAlpha.300"),O="rgba(0, 0, 0, 0.3)",L=[{id:1,url:"https://models.readyplayer.me/67c8408d38f7924e15a8bd0a.glb",name:"Default Avatar 1"},{id:2,url:"https://models.readyplayer.me/67c8576838e3cf57cc697c15.glb",name:"Default Avatar 2"},{id:3,url:"https://models.readyplayer.me/67c884144c4878c55e515ff5.glb",name:"Default Avatar 3"},{id:4,url:"https://models.readyplayer.me/67c885af25f4d62e75c0ff1e.glb",name:"Default Avatar 4"},{id:5,url:"https://models.readyplayer.me/67c8860f4c4878c55e5189b6.glb",name:"Default Avatar 5"},{id:6,url:"https://models.readyplayer.me/67c8869db6d0b438b7abd822.glb",name:"Default Avatar 6"},{id:7,url:"https://models.readyplayer.me/67c886ed28ee0e0bfac89688.glb",name:"Default Avatar 7"},{id:8,url:"https://models.readyplayer.me/67c88731795ea3e2e6ea84db.glb",name:"Default Avatar 8"},{id:9,url:"https://models.readyplayer.me/67c8878b0cdc0f22383f0f8f.glb",name:"Default Avatar 9"}];return w.jsxs(w.Fragment,{children:[w.jsx($l,{children:w.jsxs(so,{isOpen:n,onClose:e,isCentered:!0,size:"xl",zIndex:9999,children:[w.jsx(ao,{bg:"rgba(0, 0, 0, 0.7)"}),w.jsxs(oo,{bg:"gray.800",color:"white",maxW:"900px",children:[w.jsx(ec,{fontSize:"lg",children:"Customise Your Avatar"}),w.jsx(zo,{color:"white",_hover:{bg:"transparent",color:"whiteAlpha.800"},_focus:{boxShadow:"none"},size:"lg",position:"absolute",right:2,top:2}),w.jsx(wo,{pb:4,children:w.jsxs(Jr,{spacing:4,align:"stretch",children:[w.jsx(nt,{fontSize:"sm",children:"Choose from our collection or create your own unique avatar"}),w.jsxs(Gne,{columns:5,spacing:2,children:[w.jsx(ft,{position:"relative",cursor:"pointer",borderWidth:"2px",borderStyle:"dashed",borderColor:I,borderRadius:"lg",overflow:"hidden",onClick:E,_hover:{bg:O},transition:"all 0.2s",display:"flex",alignItems:"center",justifyContent:"center",aspectRatio:"1",children:w.jsxs(Jr,{spacing:1,children:[w.jsx(In,{as:V8e,boxSize:4}),w.jsx(nt,{fontSize:"xs",children:"Create Custom Avatar"})]})}),L.map(V=>w.jsxs(ft,{position:"relative",cursor:"pointer",borderWidth:"2px",borderColor:(l==null?void 0:l.id)===V.id?"blue.400":I,borderRadius:"lg",overflow:"hidden",onClick:()=>C(V),_hover:{bg:O},transition:"all 0.2s",aspectRatio:"1",children:[w.jsx(Yh,{src:V.url.replace(".glb",".png?scene=fullbody-portrait-closeupfront&w=640&q=75"),alt:V.name,width:"100%",height:"100%",objectFit:"cover"}),w.jsx(ft,{position:"absolute",bottom:"0",left:"0",right:"0",p:1,bg:"rgba(0, 0, 0, 0.7)",children:w.jsx(nt,{fontSize:"xs",children:V.name})})]},V.id))]})]})})]})]})}),i&&w.jsx(aae,{open:i,onClose:b})]})}function $8e(){const{fullscreenRef:n}=Bd(),[e,i]=D.useState(!1),[o,l]=D.useState(!1),[d,p]=D.useState(!1),[_,E]=D.useState(!1),{user:b}=D.useContext(Go),[C,I]=D.useState(null),[O,L]=D.useState(!0),V=($,se)=>!$||!se?"?":`${$.charAt(0)}${se.charAt(0)}`.toUpperCase(),B=async()=>{if(b!=null&&b.uid){L(!0);try{const $=await Fu(b.uid);I({rpmURL:$.rpmURL?$.rpmURL.replace(".glb",".png?scene=fullbody-portrait-closeupfront&w=640&q=75"):null,firstName:$.firstName,lastName:$.lastName})}catch($){console.error("Error fetching profile data:",$)}finally{L(!1)}}};D.useEffect(()=>{B()},[b==null?void 0:b.uid]),D.useEffect(()=>{const $=()=>{i(!0)};return window.addEventListener("PlayerInstantiated",$),()=>{window.removeEventListener("PlayerInstantiated",$)}},[]);const W=()=>l(!o),Z=()=>{l(!1),B()};return e?w.jsxs(w.Fragment,{children:[w.jsx(Mp,{label:"Edit Avatar",hasArrow:!0,placement:"top",closeOnClick:!0,isOpen:_,portalProps:{containerRef:n},children:w.jsxs(ft,{position:"relative",onMouseEnter:()=>{p(!0),E(!0)},onMouseLeave:()=>{p(!1),E(!1)},cursor:"pointer",onClick:W,children:[w.jsx(zl,{src:O||C==null?void 0:C.rpmURL,size:"md",borderRadius:"full",bg:"white",name:O?V(C==null?void 0:C.firstName,C==null?void 0:C.lastName):" ",borderWidth:"1px",borderColor:"whiteAlpha.300"}),d&&w.jsx(ft,{position:"absolute",top:"0",left:"0",right:"0",bottom:"0",display:"flex",alignItems:"center",justifyContent:"center",bg:"rgba(0, 0, 0, 0.4)",borderRadius:"full",children:w.jsx(nt,{fontSize:"xs",fontWeight:"bold",color:"white",children:"Edit"})})]})}),w.jsx(H8e,{isOpen:o,onClose:Z})]}):null}function K8e(n){return Or({attr:{viewBox:"0 0 1024 1024"},child:[{tag:"path",attr:{d:"M391 240.9c-.8-6.6-8.9-9.4-13.6-4.7l-43.7 43.7L200 146.3a8.03 8.03 0 0 0-11.3 0l-42.4 42.3a8.03 8.03 0 0 0 0 11.3L280 333.6l-43.9 43.9a8.01 8.01 0 0 0 4.7 13.6L401 410c5.1.6 9.5-3.7 8.9-8.9L391 240.9zm10.1 373.2L240.8 633c-6.6.8-9.4 8.9-4.7 13.6l43.9 43.9L146.3 824a8.03 8.03 0 0 0 0 11.3l42.4 42.3c3.1 3.1 8.2 3.1 11.3 0L333.7 744l43.7 43.7A8.01 8.01 0 0 0 391 783l18.9-160.1c.6-5.1-3.7-9.4-8.8-8.8zm221.8-204.2L783.2 391c6.6-.8 9.4-8.9 4.7-13.6L744 333.6 877.7 200c3.1-3.1 3.1-8.2 0-11.3l-42.4-42.3a8.03 8.03 0 0 0-11.3 0L690.3 279.9l-43.7-43.7a8.01 8.01 0 0 0-13.6 4.7L614.1 401c-.6 5.2 3.7 9.5 8.8 8.9zM744 690.4l43.9-43.9a8.01 8.01 0 0 0-4.7-13.6L623 614c-5.1-.6-9.5 3.7-8.9 8.9L633 783.1c.8 6.6 8.9 9.4 13.6 4.7l43.7-43.7L824 877.7c3.1 3.1 8.2 3.1 11.3 0l42.4-42.3c3.1-3.1 3.1-8.2 0-11.3L744 690.4z"}}]})(n)}function q8e(n){return Or({attr:{viewBox:"0 0 1024 1024"},child:[{tag:"path",attr:{d:"M290 236.4l43.9-43.9a8.01 8.01 0 0 0-4.7-13.6L169 160c-5.1-.6-9.5 3.7-8.9 8.9L179 329.1c.8 6.6 8.9 9.4 13.6 4.7l43.7-43.7L370 423.7c3.1 3.1 8.2 3.1 11.3 0l42.4-42.3c3.1-3.1 3.1-8.2 0-11.3L290 236.4zm352.7 187.3c3.1 3.1 8.2 3.1 11.3 0l133.7-133.6 43.7 43.7a8.01 8.01 0 0 0 13.6-4.7L863.9 169c.6-5.1-3.7-9.5-8.9-8.9L694.8 179c-6.6.8-9.4 8.9-4.7 13.6l43.9 43.9L600.3 370a8.03 8.03 0 0 0 0 11.3l42.4 42.4zM845 694.9c-.8-6.6-8.9-9.4-13.6-4.7l-43.7 43.7L654 600.3a8.03 8.03 0 0 0-11.3 0l-42.4 42.3a8.03 8.03 0 0 0 0 11.3L734 787.6l-43.9 43.9a8.01 8.01 0 0 0 4.7 13.6L855 864c5.1.6 9.5-3.7 8.9-8.9L845 694.9zm-463.7-94.6a8.03 8.03 0 0 0-11.3 0L236.3 733.9l-43.7-43.7a8.01 8.01 0 0 0-13.6 4.7L160.1 855c-.6 5.1 3.7 9.5 8.9 8.9L329.2 845c6.6-.8 9.4-8.9 4.7-13.6L290 787.6 423.7 654c3.1-3.1 3.1-8.2 0-11.3l-42.4-42.4z"}}]})(n)}function Y8e(){const{isFullscreen:n,toggleFullscreen:e,fullscreenRef:i,isMobile:o}=Bd(),l=wc();D.useEffect(()=>{const p=_=>{console.error("Fullscreen error:",_),l({title:"Fullscreen Error",description:"Could not enter fullscreen mode. Try tapping the button again or use the browser's fullscreen option.",status:"error",duration:5e3,isClosable:!0,position:"top"})};return document.addEventListener("fullscreenerror",p),document.addEventListener("webkitfullscreenerror",p),document.addEventListener("mozfullscreenerror",p),document.addEventListener("MSFullscreenError",p),()=>{document.removeEventListener("fullscreenerror",p),document.removeEventListener("webkitfullscreenerror",p),document.removeEventListener("mozfullscreenerror",p),document.removeEventListener("MSFullscreenError",p)}},[l]);const d=()=>{i.current?(o&&/iPhone|iPad|iPod/i.test(navigator.userAgent)&&!n&&l({title:"Mobile Fullscreen",description:"Tap the button again if fullscreen doesn't activate. For iOS, you may need to use the browser's share button and 'Add to Home Screen' for the best experience.",status:"info",duration:5e3,isClosable:!0,position:"top"}),e()):(console.error("Fullscreen target not set"),l({title:"Fullscreen Error",description:"Could not find fullscreen target element.",status:"error",duration:3e3,isClosable:!0,position:"top"}))};return w.jsx(Mp,{label:n?"Exit Fullscreen":"Enter Fullscreen",hasArrow:!0,placement:"bottom",closeOnClick:!0,portalProps:{containerRef:i},children:w.jsx(Wo,{"aria-label":n?"Exit Fullscreen":"Enter Fullscreen",icon:n?w.jsx(K8e,{}):w.jsx(q8e,{}),onClick:d,variant:"iconButton",size:o?"lg":"md"})})}const BQ={iframeContainer:{position:"relative",paddingBottom:"56.25%",height:0,overflow:"hidden",width:"100%"},iframe:{position:"absolute",top:0,left:0,width:"100%",height:"100%",border:"none"}};function X8e(){const{isOpen:n,onOpen:e,onClose:i}=hf(),{fullscreenRef:o}=Bd(),[l,d]=m8e(!1);D.useEffect(()=>{Y.log("VideoPlayer: Current video URL:",l),l&&(Y.log("VideoPlayer: Opening modal for video URL:",l),e())},[l,e]);const p=()=>{Y.log("VideoPlayer: Closing modal"),d(),i()};return w.jsx($l,{containerRef:o,children:w.jsxs(so,{isOpen:n,onClose:p,size:"lg",isCentered:!0,portalProps:{containerRef:o},children:[w.jsx(ao,{bg:"rgba(0, 0, 0, 0.8)"}),w.jsxs(oo,{bg:"gray.900",color:"white",borderRadius:"lg",overflow:"hidden",maxWidth:"80vw",maxHeight:"80vh",display:"flex",justifyContent:"center",alignItems:"center",position:"relative",zIndex:"modal",children:[w.jsx(zo,{size:"lg",bg:"gray.700",color:"white",borderRadius:"full",zIndex:"modal",_hover:{bg:"gray.600"},_focus:{boxShadow:"none"},position:"absolute",top:"10px",right:"10px"}),w.jsx(wo,{p:0,width:"100%",children:l&&w.jsx(ft,{style:BQ.iframeContainer,children:w.jsx("iframe",{src:l,style:BQ.iframe,allow:"autoplay; fullscreen",allowFullScreen:!0,title:"Video Player"})})})]})]})})}function J8e({isOpen:n,onClose:e,playerName:i,playerId:o,uid:l}){const[d,p]=D.useState(null),[_,E]=D.useState(!0),[b,C]=D.useState(null);return D.useEffect(()=>{n&&(async()=>{if(E(!0),C(null),!l){Y.warn("NameplateModal: No UID provided for player:",i),C("No user ID available for this player"),E(!1);return}try{Y.log("NameplateModal: Fetching profile for UID:",l);const O=await Fu(l);O?p({firstName:O.firstName,lastName:O.lastName,linkedinUrl:O.linkedinUrl,websiteUrl:O.websiteUrl,rpmURL:O.rpmURL?O.rpmURL.replace(".glb",".png?scene=fullbody-portrait-closeupfront&w=640&q=75"):null}):C("Could not find profile data for this player")}catch(O){Y.error("Error fetching profile data:",O),C("Error loading profile data")}finally{E(!1)}})()},[l,n,i]),w.jsxs(so,{isOpen:n,onClose:e,isCentered:!0,size:"md",children:[w.jsx(ao,{backdropFilter:"blur(10px)"}),w.jsxs(oo,{bg:"gray.900",color:"white",borderRadius:"xl",children:[w.jsx(ec,{children:"Player Info"}),w.jsx(zo,{}),w.jsx(wo,{pb:6,children:_?w.jsx(cne,{py:8,children:w.jsx(jd,{size:"xl",color:"blue.400"})}):b?w.jsxs(Cp,{status:"warning",variant:"solid",borderRadius:"md",children:[w.jsx(Rp,{}),b]}):w.jsxs(Jr,{spacing:4,align:"center",children:[w.jsx(zl,{size:"2xl",src:d==null?void 0:d.rpmURL,bg:"whiteAlpha.300",name:i,borderWidth:"2px",borderColor:"whiteAlpha.300"}),w.jsxs(Jr,{spacing:1,children:[w.jsx(nt,{fontSize:"2xl",fontWeight:"bold",children:i}),(d==null?void 0:d.firstName)&&w.jsxs(nt,{fontSize:"md",color:"gray.400",children:[d.firstName," ",d.lastName]}),w.jsxs(nt,{fontSize:"xs",color:"gray.500",mt:1,children:["ID: ",o]})]}),((d==null?void 0:d.linkedinUrl)||(d==null?void 0:d.websiteUrl))&&w.jsxs(w.Fragment,{children:[w.jsx(rf,{borderColor:"whiteAlpha.300"}),w.jsxs(wi,{spacing:4,pt:2,children:[(d==null?void 0:d.linkedinUrl)&&w.jsx(Ml,{href:d.linkedinUrl,isExternal:!0,children:w.jsx(Wo,{icon:w.jsx(sae,{}),variant:"ghost",colorScheme:"linkedin",size:"lg","aria-label":"LinkedIn profile",_hover:{bg:"whiteAlpha.200"}})}),(d==null?void 0:d.websiteUrl)&&w.jsx(Ml,{href:d.websiteUrl,isExternal:!0,children:w.jsx(Wo,{icon:w.jsx(oae,{}),variant:"ghost",colorScheme:"blue",size:"lg","aria-label":"Personal website",_hover:{bg:"whiteAlpha.200"}})})]})]})]})})]})]})}const Q8e=({isVisible:n,onToggleVisibility:e,spaceID:i})=>{const[o]=Axe("(max-width: 768px)"),[l,d]=D.useState(!1);D.useEffect(()=>{(()=>{const _e=navigator.userAgent||navigator.vendor||window.opera,ke=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(_e);d(ke),ke&&Y.log("UnityPlayerList: Mobile browser detected, component will not render")})()},[]);const p=o||l,_=tae(),[E,b]=D.useState(!1),[C,I]=D.useState([]),[O,L]=D.useState(!1),[V,B]=D.useState({}),[W,Z]=D.useState({}),[$,se]=D.useState(null),[ue,re]=D.useState(!1),pe=wc(),q=window.currentUser||{},J=(()=>{if(i)return i;if(window.spaceID)return window.spaceID;const _e=(window.location.pathname||"").split("/"),Ee=_e[_e.length-1];if(Ee&&Ee.length>5)return Ee;const ke=document.body.getAttribute("data-space-id");if(ke)return ke;const we=localStorage.getItem("currentSpaceId");return we||"fallback-space-id"})();D.useEffect(()=>{(async()=>{try{const Ee=await Rg(J);Ee&&Ee.voiceDisabled?(console.log("UnityPlayerList: Voice is disabled for this space"),re(!0)):re(!1)}catch(Ee){console.error("UnityPlayerList: Error checking if voice is disabled:",Ee)}})();const _e=Ee=>{Ee.detail&&typeof Ee.detail.voiceDisabled=="boolean"&&(console.log("UnityPlayerList: Voice setting changed:",Ee.detail.voiceDisabled),re(Ee.detail.voiceDisabled))};return window.addEventListener("SpaceVoiceSettingChanged",_e),()=>{window.removeEventListener("SpaceVoiceSettingChanged",_e)}},[J]),D.useEffect(()=>{const ve={};_.forEach(_e=>{if(_e.uid){if(_e.isLocalPlayer&&window.agoraClient&&window.agoraClient.client)ve[_e.uid]=window.agoraClient.client.uid;else if(window.agoraClient&&window.agoraClient.client&&window.agoraClient.client.remoteUsers){const Ee=window.agoraClient.client.remoteUsers,ke=Ee.find(we=>String(we.uid)===String(_e.uid));if(ke)ve[_e.uid]=ke.uid;else{const we=Ee.find(be=>typeof be.uid=="string"&&be.uid.includes(_e.uid));if(we)ve[_e.uid]=we.uid;else{const be=Ee.find(Ie=>typeof _e.uid=="string"&&_e.uid.includes(String(Ie.uid)));if(be)ve[_e.uid]=be.uid;else{const Ie=Ee.filter(Me=>!(typeof Me.uid=="string"&&Me.uid.startsWith("screen-")));Ie.length===1&&!_e.isLocalPlayer&&(ve[_e.uid]=Ie[0].uid)}}}}}}),Z(ve)},[_]);const ie=()=>{if(window.agoraClient&&typeof window.agoraClient.isVoiceEnabled=="boolean"){const ve=window.agoraClient.isVoiceEnabled;ve!==O&&L(ve)}if(window.agoraClient&&window.agoraClient.client&&window.agoraClient.client.remoteUsers){const ve=window.agoraClient.client.remoteUsers,_e={};ve.forEach(Ee=>{typeof Ee.uid=="string"&&Ee.uid.startsWith("screen-")||(_e[Ee.uid]=!!Ee.audioTrack&&!Ee.audioTrack.muted)}),JSON.stringify(_e)!==JSON.stringify(V)&&B(_e)}};D.useEffect(()=>{const ve=setInterval(ie,500),_e=Ee=>{Ee.detail&&typeof Ee.detail.enabled=="boolean"&&L(Ee.detail.enabled)};return window.addEventListener("VoiceToggled",_e),ie(),()=>{clearInterval(ve),window.removeEventListener("VoiceToggled",_e)}},[]),D.useEffect(()=>{const ve=()=>{Y.log("UnityPlayerList: Player instantiated, showing list"),b(!0)};return window.addEventListener("PlayerInstantiated",ve),window.isPlayerInstantiated&&(Y.log("UnityPlayerList: Player was already instantiated"),b(!0)),()=>{window.removeEventListener("PlayerInstantiated",ve)}},[]),D.useEffect(()=>{(async()=>{const _e=await Promise.all(_.map(async Ee=>{if(Ee.uid)try{const ke=await Fu(Ee.uid);let we=null;if(ke.groups){const be=`space_${J}_owners`,Ie=`space_${J}_hosts`;ke.groups.includes(be)?we="owner":ke.groups.includes(Ie)&&(we="host")}return le({uid:Ee.uid})&&se(we),{...Ee,firstName:ke.firstName,lastName:ke.lastName,linkedInProfile:ke.linkedInProfile,websiteUrl:ke.websiteUrl,rpmURL:ke.rpmURL?ke.rpmURL.replace(".glb",".png?scene=fullbody-portrait-closeupfront&w=640&q=75"):null,role:we}}catch(ke){return Y.error(`Error fetching data for player ${Ee.playerName}:`,ke),Ee}return Ee}));I(_e)})()},[_,J]);const me=[...C].sort((ve,_e)=>ve.isLocalPlayer?-1:_e.isLocalPlayer?1:0),de=()=>{Y.log("UnityPlayerList: Toggling visibility"),e&&e()},le=ve=>!!(ve.isLocalPlayer||q&&q.uid&&ve.uid===q.uid),xe=ve=>{try{if(le(ve))return window.agoraClient&&typeof window.agoraClient.isVoiceEnabled=="boolean"?window.agoraClient.isVoiceEnabled:O;if(ve.uid){if(V[ve.uid])return!0;const _e=W[ve.uid];if(_e&&V[_e])return!0;const Ee=parseInt(ve.uid);if(!isNaN(Ee)&&V[Ee])return!0}return!1}catch(_e){return console.error("Error in hasActiveMic:",_e),!1}},We=({player:ve})=>{const _e=ve.role;return _e==="owner"?w.jsxs(wi,{spacing:1,bg:"green.900",p:2,borderRadius:"md",px:3,boxShadow:"0 0 10px rgba(72, 187, 120, 0.5)",border:"1px solid",borderColor:"green.400",children:[w.jsx(In,{as:CF,color:"green.400",boxSize:5}),w.jsx(Ip,{colorScheme:"green",variant:"solid",fontSize:"md",px:2,children:"Owner"})]}):_e==="host"?w.jsxs(wi,{spacing:1,bg:"purple.900",p:2,borderRadius:"md",px:3,boxShadow:"0 0 10px rgba(159, 122, 234, 0.5)",border:"1px solid",borderColor:"purple.400",children:[w.jsx(In,{as:AF,color:"purple.400",boxSize:5}),w.jsx(Ip,{colorScheme:"purple",variant:"solid",fontSize:"md",px:2,children:"Host"})]}):null},$e=(ve,_e)=>{switch(console.log(`Action "${ve}" performed on player: ${_e.playerName}`),ve){case"mute":pe({title:"Player Muted",description:`${_e.playerName} has been muted.`,status:"info",duration:3e3,isClosable:!0});break;case"kick":pe({title:"Player Kicked",description:`${_e.playerName} has been kicked from the space.`,status:"warning",duration:3e3,isClosable:!0});break;case"promote":pe({title:"Player Promoted",description:`${_e.playerName} has been promoted to host.`,status:"success",duration:3e3,isClosable:!0});break}};return w.jsxs(ft,{position:"absolute",top:"100px",right:"20px",zIndex:"1",bg:"rgba(0,0,0,0.4)",p:4,borderRadius:"md",color:"white",minWidth:"200px",maxHeight:"300px",visibility:E&&n&&!p?"visible":"hidden",role:"group",children:[w.jsx(ft,{position:"absolute",top:2,right:2,opacity:0,_groupHover:{opacity:1},transition:"opacity 0.2s",children:w.jsx(Wo,{icon:w.jsx(fWe,{boxSize:3}),size:"xs","aria-label":"Close list",variant:"unstyled",color:"white",onClick:de,_hover:{opacity:.8}})}),w.jsxs(nt,{fontWeight:"bold",mb:2,fontSize:"sm",children:["People Online: ",_.length]}),w.jsx(ft,{maxHeight:"200px",overflowY:"auto",css:{"&::-webkit-scrollbar":{width:"4px"},"&::-webkit-scrollbar-track":{background:"rgba(0,0,0,0.1)"},"&::-webkit-scrollbar-thumb":{background:"rgba(255,255,255,0.3)",borderRadius:"2px"}},children:w.jsx(Jr,{align:"stretch",spacing:1,width:"100%",children:me.map((ve,_e)=>{const Ee=le(ve),ke=!ue&&xe(ve);return w.jsx(ft,{children:w.jsxs(vre,{placement:"left",trigger:"hover",children:[w.jsx(Cre,{children:w.jsxs(wi,{width:"100%",spacing:2,p:1,borderRadius:"md",_hover:{bg:"whiteAlpha.200"},transition:"background 0.2s",children:[w.jsx(zl,{size:"xs",src:ve.rpmURL,bg:"whiteAlpha.400",name:" ",borderWidth:"1px",borderColor:"whiteAlpha.300"}),w.jsx(nt,{fontSize:"xs",children:ve.playerName}),ve.role==="owner"&&w.jsx(In,{as:CF,color:"green.400",boxSize:2.5}),ve.role==="host"&&w.jsx(In,{as:AF,color:"purple.400",boxSize:2.5}),w.jsx(Yk,{}),$==="owner"&&w.jsxs(dR,{closeOnSelect:!0,placement:"bottom-end",children:[w.jsx(hR,{as:Wo,"aria-label":"Options",icon:w.jsx(D8e,{}),variant:"ghost",size:"xs",color:"whiteAlpha.700",_hover:{color:"white",bg:"whiteAlpha.300"},onClick:we=>we.stopPropagation()}),w.jsxs(fR,{bg:"rgba(0,0,0,0.8)",borderColor:"whiteAlpha.300",minW:"120px",zIndex:10001,children:[w.jsx(Dd,{icon:w.jsx(z8e,{}),onClick:()=>$e("mute",ve),_hover:{bg:"whiteAlpha.200"},fontSize:"sm",isDisabled:ue,children:"Mute Player"}),w.jsx(Dd,{icon:w.jsx(j8e,{}),onClick:()=>$e("promote",ve),_hover:{bg:"whiteAlpha.200"},fontSize:"sm",children:"Promote to Host"}),w.jsx(sre,{borderColor:"whiteAlpha.300"}),w.jsx(Dd,{icon:w.jsx(k8e,{}),onClick:()=>$e("kick",ve),_hover:{bg:"red.800"},color:"red.300",fontSize:"sm",children:"Kick from Space"})]})]}),!ue&&(ke?w.jsx(ft,{color:"green.400",children:w.jsx(IF,{})}):w.jsx(ft,{color:"red.400",children:w.jsx(RF,{})})),Ee&&w.jsx(nt,{fontSize:"xs",color:"gray.300",ml:1,children:"(you)"})]})}),w.jsx(wre,{bg:"rgba(0,0,0,0.8)",border:"none",boxShadow:"dark-lg",color:"white",p:4,width:"auto",minWidth:"250px",ml:"-20px",position:"absolute",left:"-250px",top:"-100px",transform:"none !important",zIndex:1e4,children:w.jsx(bre,{children:w.jsxs(Jr,{align:"center",spacing:3,children:[w.jsx(zl,{size:"xl",src:ve.rpmURL,bg:"whiteAlpha.400",name:" ",borderWidth:"2px",borderColor:"whiteAlpha.300"}),w.jsx(nt,{fontSize:"xl",fontWeight:"bold",children:ve.playerName}),w.jsx(We,{player:ve}),ve.firstName&&w.jsxs(nt,{fontSize:"sm",color:"gray.300",children:[ve.firstName," ",ve.lastName]}),w.jsxs(wi,{spacing:4,pt:2,children:[ve.linkedInProfile&&w.jsx(Ml,{href:ve.linkedInProfile,isExternal:!0,children:w.jsx(Wo,{icon:w.jsx(sae,{}),variant:"ghost",colorScheme:"whiteAlpha",size:"md","aria-label":"LinkedIn profile",_hover:{bg:"whiteAlpha.200"}})}),ve.websiteUrl&&w.jsx(Ml,{href:ve.websiteUrl,isExternal:!0,children:w.jsx(Wo,{icon:w.jsx(oae,{}),variant:"ghost",colorScheme:"whiteAlpha",size:"md","aria-label":"Personal website",_hover:{bg:"whiteAlpha.200"}})}),!ue&&w.jsx(Wo,{icon:ke?w.jsx(IF,{}):w.jsx(RF,{}),variant:"ghost",colorScheme:ke?"green":"red",size:"md","aria-label":"Microphone status",isDisabled:!0}),ue&&w.jsx(Wo,{icon:w.jsx(W8e,{}),variant:"ghost",colorScheme:"red",size:"md","aria-label":"Voice chat disabled",isDisabled:!0,title:"Voice chat is disabled for this space"})]})]})})})]})},_e)})})})]})};var Dk={exports:{}},Z8e=Dk.exports,WQ;function eze(){return WQ||(WQ=1,function(n,e){(function(i,o){n.exports=o()})(Z8e,function(){function i(t,r){return r.forEach(function(s){s&&typeof s!="string"&&!Array.isArray(s)&&Object.keys(s).forEach(function(a){if(a!=="default"&&!(a in t)){var c=Object.getOwnPropertyDescriptor(s,a);Object.defineProperty(t,a,c.get?c:{enumerable:!0,get:function(){return s[a]}})}})}),Object.freeze(t)}var o=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof Sy<"u"?Sy:typeof self<"u"?self:{};function l(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var d=function(t){try{return!!t()}catch{return!0}},p=!d(function(){var t=(function(){}).bind();return typeof t!="function"||t.hasOwnProperty("prototype")}),_=p,E=Function.prototype,b=E.call,C=_&&E.bind.bind(b,b),I=_?C:function(t){return function(){return b.apply(t,arguments)}},O=I({}.isPrototypeOf),L=function(t){return t&&t.Math==Math&&t},V=L(typeof globalThis=="object"&&globalThis)||L(typeof window=="object"&&window)||L(typeof self=="object"&&self)||L(typeof o=="object"&&o)||function(){return this}()||o||Function("return this")(),B=p,W=Function.prototype,Z=W.apply,$=W.call,se=typeof Reflect=="object"&&Reflect.apply||(B?$.bind(Z):function(){return $.apply(Z,arguments)}),ue=I,re=ue({}.toString),pe=ue("".slice),q=function(t){return pe(re(t),8,-1)},Q=q,J=I,ie=function(t){if(Q(t)==="Function")return J(t)},me=typeof document=="object"&&document.all,de={all:me,IS_HTMLDDA:me===void 0&&me!==void 0},le=de.all,xe=de.IS_HTMLDDA?function(t){return typeof t=="function"||t===le}:function(t){return typeof t=="function"},We={},$e=!d(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!=7}),ve=p,_e=Function.prototype.call,Ee=ve?_e.bind(_e):function(){return _e.apply(_e,arguments)},ke={},we={}.propertyIsEnumerable,be=Object.getOwnPropertyDescriptor,Ie=be&&!we.call({1:2},1);ke.f=Ie?function(t){var r=be(this,t);return!!r&&r.enumerable}:we;var Me,ze,Je=function(t,r){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:r}},tt=d,ut=q,Ze=Object,bt=I("".split),on=tt(function(){return!Ze("z").propertyIsEnumerable(0)})?function(t){return ut(t)=="String"?bt(t,""):Ze(t)}:Ze,Mt=function(t){return t==null},Zt=Mt,an=TypeError,Ht=function(t){if(Zt(t))throw an("Can't call method on "+t);return t},jn=on,Wt=Ht,Re=function(t){return jn(Wt(t))},Fe=xe,Ge=de.all,at=de.IS_HTMLDDA?function(t){return typeof t=="object"?t!==null:Fe(t)||t===Ge}:function(t){return typeof t=="object"?t!==null:Fe(t)},yt={},vt=yt,Gt=V,gn=xe,Pn=function(t){return gn(t)?t:void 0},un=function(t,r){return arguments.length<2?Pn(vt[t])||Pn(Gt[t]):vt[t]&&vt[t][r]||Gt[t]&&Gt[t][r]},wt=typeof navigator<"u"&&String(navigator.userAgent)||"",lr=V,Dt=wt,qt=lr.process,Qr=lr.Deno,Hi=qt&&qt.versions||Qr&&Qr.version,Vs=Hi&&Hi.v8;Vs&&(ze=(Me=Vs.split("."))[0]>0&&Me[0]<4?1:+(Me[0]+Me[1])),!ze&&Dt&&(!(Me=Dt.match(/Edge\/(\d+)/))||Me[1]>=74)&&(Me=Dt.match(/Chrome\/(\d+)/))&&(ze=+Me[1]);var ai=ze,Ot=ai,On=d,or=V.String,Fi=!!Object.getOwnPropertySymbols&&!On(function(){var t=Symbol();return!or(t)||!(Object(t)instanceof Symbol)||!Symbol.sham&&Ot&&Ot<41}),Cc=Fi&&!Symbol.sham&&typeof Symbol.iterator=="symbol",us=un,Ta=xe,Io=O,wa=Object,Ca=Cc?function(t){return typeof t=="symbol"}:function(t){var r=us("Symbol");return Ta(r)&&Io(r.prototype,wa(t))},co=String,Es=function(t){try{return co(t)}catch{return"Object"}},ds=xe,Ho=Es,$i=TypeError,vs=function(t){if(ds(t))return t;throw $i(Ho(t)+" is not a function")},rc=vs,ju=Mt,Rc=function(t,r){var s=t[r];return ju(s)?void 0:rc(s)},Ra=Ee,Ia=xe,zd=at,Gg=TypeError,Bu={exports:{}},Sf=V,Xs=Object.defineProperty,Wu=function(t,r){try{Xs(Sf,t,{value:r,configurable:!0,writable:!0})}catch{Sf[t]=r}return r},Aa="__core-js_shared__",Gd=V[Aa]||Wu(Aa,{}),Hd=Gd;(Bu.exports=function(t,r){return Hd[t]||(Hd[t]=r!==void 0?r:{})})("versions",[]).push({version:"3.31.1",mode:"pure",copyright:" 2014-2023 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.31.1/LICENSE",source:"https://github.com/zloirock/core-js"});var ic=Bu.exports,$d=Ht,zu=Object,$o=function(t){return zu($d(t))},Kd=$o,Kr=I({}.hasOwnProperty),Ci=Object.hasOwn||function(t,r){return Kr(Kd(t),r)},Ic=I,fl=0,Pa=Math.random(),bf=Ic(1 .toString),qd=function(t){return"Symbol("+(t===void 0?"":t)+")_"+bf(++fl+Pa,36)},Kl=ic,Ao=Ci,Zp=qd,lo=Fi,Tf=Cc,pl=V.Symbol,Yd=Kl("wks"),Xd=Tf?pl.for||pl:pl&&pl.withoutSetter||Zp,_r=function(t){return Ao(Yd,t)||(Yd[t]=lo&&Ao(pl,t)?pl[t]:Xd("Symbol."+t)),Yd[t]},ql=Ee,Yl=at,Gu=Ca,sc=Rc,Ko=function(t,r){var s,a;if(Ia(s=t.toString)&&!zd(a=Ra(s,t))||Ia(s=t.valueOf)&&!zd(a=Ra(s,t)))return a;throw Gg("Can't convert object to primitive value")},Hu=TypeError,ml=_r("toPrimitive"),Xl=function(t,r){if(!Yl(t)||Gu(t))return t;var s,a=sc(t,ml);if(a){if(s=ql(a,t,r),!Yl(s)||Gu(s))return s;throw Hu("Can't convert object to primitive value")}return Ko(t)},Zr=Ca,oc=function(t){var r=Xl(t,"string");return Zr(r)?r:r+""},ar=at,Ac=V.document,em=ar(Ac)&&ar(Ac.createElement),Jl=function(t){return em?Ac.createElement(t):{}},Jd=Jl,wf=!$e&&!d(function(){return Object.defineProperty(Jd("div"),"a",{get:function(){return 7}}).a!=7}),tm=$e,Cf=Ee,qo=ke,hs=Je,Yo=Re,Xo=oc,Ql=Ci,Jo=wf,Qo=Object.getOwnPropertyDescriptor;We.f=tm?Qo:function(t,r){if(t=Yo(t),r=Xo(r),Jo)try{return Qo(t,r)}catch{}if(Ql(t,r))return hs(!Cf(qo.f,t,r),t[r])};var nm=d,Pc=xe,Ss=/#|\.prototype\./,$u=function(t,r){var s=gl[Rf(t)];return s==rm||s!=Zl&&(Pc(r)?nm(r):!!r)},Rf=$u.normalize=function(t){return String(t).replace(Ss,".").toLowerCase()},gl=$u.data={},Zl=$u.NATIVE="N",rm=$u.POLYFILL="P",Oa=$u,ka=vs,_l=p,Ce=ie(ie.bind),De=function(t,r){return ka(t),r===void 0?t:_l?Ce(t,r):function(){return t.apply(r,arguments)}},rt={},Qt=$e&&d(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!=42}),Jn=at,Tr=String,qr=TypeError,fn=function(t){if(Jn(t))return t;throw qr(Tr(t)+" is not an object")},jr=$e,Ri=wf,Fs=Qt,Zo=fn,ea=oc,Ku=TypeError,is=Object.defineProperty,yl=Object.getOwnPropertyDescriptor,Qd="enumerable",Oc="configurable",Hg="writable";rt.f=jr?Fs?function(t,r,s){if(Zo(t),r=ea(r),Zo(s),typeof t=="function"&&r==="prototype"&&"value"in s&&Hg in s&&!s[Hg]){var a=yl(t,r);a&&a[Hg]&&(t[r]=s.value,s={configurable:Oc in s?s[Oc]:a[Oc],enumerable:Qd in s?s[Qd]:a[Qd],writable:!1})}return is(t,r,s)}:is:function(t,r,s){if(Zo(t),r=ea(r),Zo(s),Ri)try{return is(t,r,s)}catch{}if("get"in s||"set"in s)throw Ku("Accessors not supported");return"value"in s&&(t[r]=s.value),t};var im=rt,qu=Je,ta=$e?function(t,r,s){return im.f(t,r,qu(1,s))}:function(t,r,s){return t[r]=s,t},eu=V,sm=se,$g=ie,sE=xe,om=We.f,am=Oa,Yu=yt,Xu=De,Ju=ta,Kg=Ci,oE=function(t){var r=function(s,a,c){if(this instanceof r){switch(arguments.length){case 0:return new t;case 1:return new t(s);case 2:return new t(s,a)}return new t(s,a,c)}return sm(t,this,arguments)};return r.prototype=t.prototype,r},Wn=function(t,r){var s,a,c,u,h,m,y,v,S,R=t.target,P=t.global,N=t.stat,G=t.proto,F=P?eu:N?eu[R]:(eu[R]||{}).prototype,j=P?Yu:Yu[R]||Ju(Yu,R,{})[R],X=j.prototype;for(u in r)a=!(s=am(P?u:R+(N?".":"#")+u,t.forced))&&F&&Kg(F,u),m=j[u],a&&(y=t.dontCallGetSet?(S=om(F,u))&&S.value:F[u]),h=a&&y?y:r[u],a&&typeof m==typeof h||(v=t.bind&&a?Xu(h,eu):t.wrap&&a?oE(h):G&&sE(h)?$g(h):h,(t.sham||h&&h.sham||m&&m.sham)&&Ju(v,"sham",!0),Ju(j,u,v),G&&(Kg(Yu,c=R+"Prototype")||Ju(Yu,c,{}),Ju(Yu[c],u,h),t.real&&X&&(s||!X[u])&&Ju(X,u,h)))},cm=Math.ceil,na=Math.floor,aE=Math.trunc||function(t){var r=+t;return(r>0?na:cm)(r)},cE=aE,kc=function(t){var r=+t;return r!=r||r===0?0:cE(r)},A=kc,z=Math.max,ne=Math.min,ge=function(t,r){var s=A(t);return s<0?z(s+r,0):ne(s,r)},qe=kc,ct=Math.min,Vt=function(t){return t>0?ct(qe(t),9007199254740991):0},ei=Vt,gi=function(t){return ei(t.length)},wr=Re,Js=ge,bs=gi,ac=function(t){return function(r,s,a){var c,u=wr(r),h=bs(u),m=Js(a,h);if(t&&s!=s){for(;h>m;)if((c=u[m++])!=c)return!0}else for(;h>m;m++)if((t||m in u)&&u[m]===s)return t||m||0;return!t&&-1}},ra={includes:ac(!0),indexOf:ac(!1)},If=ra.includes;Wn({target:"Array",proto:!0,forced:d(function(){return!Array(1).includes()})},{includes:function(t){return If(this,t,arguments.length>1?arguments[1]:void 0)}});var lm=yt,cc=function(t){return lm[t+"Prototype"]},PR=cc("Array").includes,OR=at,um=q,BN=_r("match"),kR=function(t){var r;return OR(t)&&((r=t[BN])!==void 0?!!r:um(t)=="RegExp")},WN=kR,NR=TypeError,Q0={};Q0[_r("toStringTag")]="z";var Af=String(Q0)==="[object z]",qg=Af,zN=xe,Pf=q,GN=_r("toStringTag"),DR=Object,Z0=Pf(function(){return arguments}())=="Arguments",Nc=qg?Pf:function(t){var r,s,a;return t===void 0?"Undefined":t===null?"Null":typeof(s=function(c,u){try{return c[u]}catch{}}(r=DR(t),GN))=="string"?s:Z0?Pf(r):(a=Pf(r))=="Object"&&zN(r.callee)?"Arguments":a},xR=Nc,LR=String,Na=function(t){if(xR(t)==="Symbol")throw TypeError("Cannot convert a Symbol value to a string");return LR(t)},HN=_r("match"),$N=Wn,KN=function(t){if(WN(t))throw NR("The method doesn't accept regular expressions");return t},qN=Ht,MR=Na,El=function(t){var r=/./;try{"/./"[t](r)}catch{try{return r[HN]=!1,"/./"[t](r)}catch{}}return!1},Yg=I("".indexOf);$N({target:"String",proto:!0,forced:!El("includes")},{includes:function(t){return!!~Yg(MR(qN(this)),MR(KN(t)),arguments.length>1?arguments[1]:void 0)}});var UR=cc("String").includes,eb=O,VR=PR,FR=UR,Xg=Array.prototype,tb=String.prototype,YN=function(t){var r=t.includes;return t===Xg||eb(Xg,t)&&r===Xg.includes?VR:typeof t=="string"||t===tb||eb(tb,t)&&r===tb.includes?FR:r},ot=l(YN),nb=vs,Jg=$o,rb=on,jR=gi,lE=TypeError,dm=function(t){return function(r,s,a,c){nb(s);var u=Jg(r),h=rb(u),m=jR(u),y=t?m-1:0,v=t?-1:1;if(a<2)for(;;){if(y in h){c=h[y],y+=v;break}if(y+=v,t?y<0:m<=y)throw lE("Reduce of empty array with no initial value")}for(;t?y>=0:m>y;y+=v)y in h&&(c=s(c,h[y],y,u));return c}},ib={left:dm(!1)},BR=d,Of=function(t,r){var s=[][t];return!!s&&BR(function(){s.call(null,r||function(){return 1},1)})},kf=typeof process<"u"&&q(process)=="process",WR=ib.left;Wn({target:"Array",proto:!0,forced:!kf&&ai>79&&ai<83||!Of("reduce")},{reduce:function(t){var r=arguments.length;return WR(this,t,r,r>1?arguments[1]:void 0)}});var zR=cc("Array").reduce,GR=O,HR=zR,uE=Array.prototype,Zd=function(t){var r=t.reduce;return t===uE||GR(uE,t)&&r===uE.reduce?HR:r},dE=Zd,lc=l(dE),XN=q,Qg=Array.isArray||function(t){return XN(t)=="Array"},Zg=Wn,JN=Qg,$R=I([].reverse),sb=[1,2];Zg({target:"Array",proto:!0,forced:String(sb)===String(sb.reverse())},{reverse:function(){return JN(this)&&(this.length=this.length),$R(this)}});var Di=cc("Array").reverse,ob=O,hE=Di,Nf=Array.prototype,KR=function(t){var r=t.reverse;return t===Nf||ob(Nf,t)&&r===Nf.reverse?hE:r},fE=KR,hm=l(fE),pE=qd,Df=ic("keys"),e_=function(t){return Df[t]||(Df[t]=pE(t))},QN=!d(function(){function t(){}return t.prototype.constructor=null,Object.getPrototypeOf(new t)!==t.prototype}),ZN=Ci,qR=xe,mE=$o,gE=QN,_E=e_("IE_PROTO"),t_=Object,ab=t_.prototype,n_=gE?t_.getPrototypeOf:function(t){var r=mE(t);if(ZN(r,_E))return r[_E];var s=r.constructor;return qR(s)&&r instanceof s?s.prototype:r instanceof t_?ab:null},eD=I,YR=vs,tD=xe,nD=String,cb=TypeError,eh=function(t,r,s){try{return eD(YR(Object.getOwnPropertyDescriptor(t,r)[s]))}catch{}},XR=fn,fm=function(t){if(typeof t=="object"||tD(t))return t;throw cb("Can't set "+nD(t)+" as a prototype")},tu=Object.setPrototypeOf||("__proto__"in{}?function(){var t,r=!1,s={};try{(t=eh(Object.prototype,"__proto__","set"))(s,[]),r=s instanceof Array}catch{}return function(a,c){return XR(a),fm(c),r?t(a,c):a.__proto__=c,a}}():void 0),th={},Dc={},r_=Ci,rD=Re,iD=ra.indexOf,xf=Dc,pm=I([].push),Lf=function(t,r){var s,a=rD(t),c=0,u=[];for(s in a)!r_(xf,s)&&r_(a,s)&&pm(u,s);for(;r.length>c;)r_(a,s=r[c++])&&(~iD(u,s)||pm(u,s));return u},mm=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],lb=Lf,gm=mm.concat("length","prototype");th.f=Object.getOwnPropertyNames||function(t){return lb(t,gm)};var xc={};xc.f=Object.getOwnPropertySymbols;var xi=un,Ii=th,nh=xc,Po=fn,Da=I([].concat),Mf=xi("Reflect","ownKeys")||function(t){var r=Ii.f(Po(t)),s=nh.f;return s?Da(r,s(t)):r},Uf=Ci,xa=Mf,yE=We,JR=rt,EE={},vE=Lf,QR=mm,Lc=Object.keys||function(t){return vE(t,QR)},SE=$e,ub=Qt,ZR=rt,sD=fn,rh=Re,_m=Lc;EE.f=SE&&!ub?Object.defineProperties:function(t,r){sD(t);for(var s,a=rh(r),c=_m(r),u=c.length,h=0;u>h;)ZR.f(t,s=c[h++],a[s]);return t};var Qu,i_=un("document","documentElement"),bE=fn,Mc=EE,uc=mm,Vf=Dc,Zu=i_,ed=Jl,td="prototype",TE="script",wE=e_("IE_PROTO"),s_=function(){},La=function(t){return"<"+TE+">"+t+"</"+TE+">"},Ma=function(t){t.write(La("")),t.close();var r=t.parentWindow.Object;return t=null,r},_i=function(){try{Qu=new ActiveXObject("htmlfile")}catch{}var t,r,s;_i=typeof document<"u"?document.domain&&Qu?Ma(Qu):(r=ed("iframe"),s="java"+TE+":",r.style.display="none",Zu.appendChild(r),r.src=String(s),(t=r.contentWindow.document).open(),t.write(La("document.F=Object")),t.close(),t.F):Ma(Qu);for(var a=uc.length;a--;)delete _i[td][uc[a]];return _i()};Vf[wE]=!0;var ia=Object.create||function(t,r){var s;return t!==null?(s_[td]=bE(t),s=new s_,s_[td]=null,s[wE]=t):s=_i(),r===void 0?s:Mc.f(s,r)},eI=at,tI=ta,CE=Error,db=I("".replace),nI=String(CE("zxcasd").stack),o_=/\n\s*at [^:]*:[^\n]*/,rI=o_.test(nI),ym=Je,hb=!d(function(){var t=Error("a");return!("stack"in t)||(Object.defineProperty(t,"stack",ym(1,7)),t.stack!==7)}),oD=ta,a_=function(t,r){if(rI&&typeof t=="string"&&!CE.prepareStackTrace)for(;r--;)t=db(t,o_,"");return t},RE=hb,fb=Error.captureStackTrace,ih={},Em=ih,iI=_r("iterator"),IE=Array.prototype,c_=function(t){return t!==void 0&&(Em.Array===t||IE[iI]===t)},vm=Nc,AE=Rc,pb=Mt,mb=ih,gb=_r("iterator"),nd=function(t){if(!pb(t))return AE(t,gb)||AE(t,"@@iterator")||mb[vm(t)]},Uc=Ee,Ff=vs,_b=fn,sI=Es,rd=nd,sh=TypeError,l_=function(t,r){var s=arguments.length<2?rd(t):r;if(Ff(s))return _b(Uc(s,t));throw sh(sI(t)+" is not iterable")},oI=Ee,nu=fn,oh=Rc,u_=function(t,r,s){var a,c;nu(t);try{if(!(a=oh(t,"return"))){if(r==="throw")throw s;return s}a=oI(a,t)}catch(u){c=!0,a=u}if(r==="throw")throw s;if(c)throw a;return nu(a),s},aI=De,PE=Ee,cI=fn,d_=Es,ru=c_,h_=gi,Sm=O,jf=l_,yb=nd,Bf=u_,lI=TypeError,bm=function(t,r){this.stopped=t,this.result=r},ji=bm.prototype,ah=function(t,r,s){var a,c,u,h,m,y,v,S=s&&s.that,R=!(!s||!s.AS_ENTRIES),P=!(!s||!s.IS_RECORD),N=!(!s||!s.IS_ITERATOR),G=!(!s||!s.INTERRUPTED),F=aI(r,S),j=function(ee){return a&&Bf(a,"normal",ee),new bm(!0,ee)},X=function(ee){return R?(cI(ee),G?F(ee[0],ee[1],j):F(ee[0],ee[1])):G?F(ee,j):F(ee)};if(P)a=t.iterator;else if(N)a=t;else{if(!(c=yb(t)))throw lI(d_(t)+" is not iterable");if(ru(c)){for(u=0,h=h_(t);h>u;u++)if((m=X(t[u]))&&Sm(ji,m))return m;return new bm(!1)}a=jf(t,c)}for(y=P?t.next:a.next;!(v=PE(y,a)).done;){try{m=X(v.value)}catch(ee){Bf(a,"throw",ee)}if(typeof m=="object"&&m&&Sm(ji,m))return m}return new bm(!1)},Eb=Na,vb=Wn,OE=O,Sb=n_,iu=tu,Ki=function(t,r,s){for(var a=xa(r),c=JR.f,u=yE.f,h=0;h<a.length;h++){var m=a[h];Uf(t,m)||s&&Uf(s,m)||c(t,m,u(r,m))}},Ts=ia,ws=ta,Tm=Je,f_=function(t,r){eI(r)&&"cause"in r&&tI(t,"cause",r.cause)},p_=function(t,r,s,a){RE&&(fb?fb(t,r):oD(t,"stack",a_(s,a)))},aD=ah,Oo=function(t,r){return t===void 0?arguments.length<2?"":r:Eb(t)},bb=_r("toStringTag"),wm=Error,Tb=[].push,sa=function(t,r){var s,a=OE(Ua,this);iu?s=iu(wm(),a?Sb(this):Ua):(s=a?this:Ts(Ua),ws(s,bb,"Error")),r!==void 0&&ws(s,"message",Oo(r)),p_(s,sa,s.stack,1),arguments.length>2&&f_(s,arguments[2]);var c=[];return aD(t,Tb,{that:c}),ws(s,"errors",c),s};iu?iu(sa,wm):Ki(sa,wm,{name:!0});var Ua=sa.prototype=Ts(wm.prototype,{constructor:Tm(1,sa),message:Tm(1,""),name:Tm(1,"AggregateError")});vb({global:!0},{AggregateError:sa});var ch,Wf,Cm,uI=xe,wb=V.WeakMap,dI=uI(wb)&&/native code/.test(String(wb)),Cb=V,hI=at,fI=ta,kE=Ci,NE=Gd,m_=e_,pI=Dc,g_="Object already initialized",Rm=Cb.TypeError,mI=Cb.WeakMap;if(dI||NE.state){var Vc=NE.state||(NE.state=new mI);Vc.get=Vc.get,Vc.has=Vc.has,Vc.set=Vc.set,ch=function(t,r){if(Vc.has(t))throw Rm(g_);return r.facade=t,Vc.set(t,r),r},Wf=function(t){return Vc.get(t)||{}},Cm=function(t){return Vc.has(t)}}else{var zf=m_("state");pI[zf]=!0,ch=function(t,r){if(kE(t,zf))throw Rm(g_);return r.facade=t,fI(t,zf,r),r},Wf=function(t){return kE(t,zf)?t[zf]:{}},Cm=function(t){return kE(t,zf)}}var lh,Rb,Ib,id={set:ch,get:Wf,has:Cm,enforce:function(t){return Cm(t)?Wf(t):ch(t,{})},getterFor:function(t){return function(r){var s;if(!hI(r)||(s=Wf(r)).type!==t)throw Rm("Incompatible receiver, "+t+" required");return s}}},DE=$e,gI=Ci,Ab=Function.prototype,cD=DE&&Object.getOwnPropertyDescriptor,Pb=gI(Ab,"name"),_I={PROPER:Pb&&(function(){}).name==="something",CONFIGURABLE:Pb&&(!DE||DE&&cD(Ab,"name").configurable)},lD=ta,sd=function(t,r,s,a){return a&&a.enumerable?t[r]=s:lD(t,r,s),t},yI=d,EI=xe,xE=at,uD=ia,vI=n_,dD=sd,dc=_r("iterator"),LE=!1;[].keys&&("next"in(Ib=[].keys())?(Rb=vI(vI(Ib)))!==Object.prototype&&(lh=Rb):LE=!0);var ME=!xE(lh)||yI(function(){var t={};return lh[dc].call(t)!==t});EI((lh=ME?{}:uD(lh))[dc])||dD(lh,dc,function(){return this});var Ob={IteratorPrototype:lh,BUGGY_SAFARI_ITERATORS:LE},SI=Nc,bI=Af?{}.toString:function(){return"[object "+SI(this)+"]"},kb=Af,Im=rt.f,Nb=ta,Db=Ci,hD=bI,xb=_r("toStringTag"),od=function(t,r,s,a){if(t){var c=s?t:t.prototype;Db(c,xb)||Im(c,xb,{configurable:!0,value:r}),a&&!kb&&Nb(c,"toString",hD)}},TI=Ob.IteratorPrototype,wI=ia,CI=Je,fD=od,Va=ih,oa=function(){return this},UE=function(t,r,s,a){var c=r+" Iterator";return t.prototype=wI(TI,{next:CI(+!a,s)}),fD(t,c,!1,!0),Va[c]=oa,t},RI=Wn,II=Ee,AI=_I,PI=UE,Lb=n_,OI=od,VE=sd,Mb=ih,kI=Ob,Ub=AI.PROPER,Am=kI.BUGGY_SAFARI_ITERATORS,FE=_r("iterator"),jE="keys",Gf="values",NI="entries",DI=function(){return this},BE=function(t,r,s,a,c,u,h){PI(s,r,a);var m,y,v,S=function(X){if(X===c&&F)return F;if(!Am&&X in N)return N[X];switch(X){case jE:case Gf:case NI:return function(){return new s(this,X)}}return function(){return new s(this)}},R=r+" Iterator",P=!1,N=t.prototype,G=N[FE]||N["@@iterator"]||c&&N[c],F=!Am&&G||S(c),j=r=="Array"&&N.entries||G;if(j&&(m=Lb(j.call(new t)))!==Object.prototype&&m.next&&(OI(m,R,!0,!0),Mb[R]=DI),Ub&&c==Gf&&G&&G.name!==Gf&&(P=!0,F=function(){return II(G,this)}),c)if(y={values:S(Gf),keys:u?F:S(jE),entries:S(NI)},h)for(v in y)(Am||P||!(v in N))&&VE(N,v,y[v]);else RI({target:r,proto:!0,forced:Am||P},y);return h&&N[FE]!==F&&VE(N,FE,F,{}),Mb[r]=F,y},WE=function(t,r){return{value:t,done:r}},zE=Re,su=ih,xI=id;rt.f;var LI=BE,GE=WE,Vb="Array Iterator",MI=xI.set,__=xI.getterFor(Vb);LI(Array,"Array",function(t,r){MI(this,{type:Vb,target:zE(t),index:0,kind:r})},function(){var t=__(this),r=t.target,s=t.kind,a=t.index++;return!r||a>=r.length?(t.target=void 0,GE(void 0,!0)):GE(s=="keys"?a:s=="values"?r[a]:[a,r[a]],!1)},"values"),su.Arguments=su.Array;var ko=rt,HE=function(t,r,s){return ko.f(t,r,s)},pD=un,$E=HE,No=$e,UI=_r("species"),tn=O,Pm=TypeError,y_=function(t,r){if(tn(r,t))return t;throw Pm("Incorrect invocation")},VI=xe,Fb=Gd,E_=I(Function.toString);VI(Fb.inspectSource)||(Fb.inspectSource=function(t){return E_(t)});var v_=Fb.inspectSource,jb=I,FI=d,Bb=xe,jI=Nc,Wb=v_,KE=function(){},uo=[],Fc=un("Reflect","construct"),ou=/^\s*(?:class|function)\b/,BI=jb(ou.exec),WI=!ou.exec(KE),aa=function(t){if(!Bb(t))return!1;try{return Fc(KE,uo,t),!0}catch{return!1}},zb=function(t){if(!Bb(t))return!1;switch(jI(t)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return WI||!!BI(ou,Wb(t))}catch{return!0}};zb.sham=!0;var Fa,Om,Gb,qE,S_=!Fc||FI(function(){var t;return aa(aa.call)||!aa(Object)||!aa(function(){t=!0})||t})?zb:aa,zI=S_,mD=Es,YE=TypeError,XE=fn,jc=function(t){if(zI(t))return t;throw YE(mD(t)+" is not a constructor")},kr=Mt,Qs=_r("species"),ss=function(t,r){var s,a=XE(t).constructor;return a===void 0||kr(s=XE(a)[Qs])?r:jc(s)},Cs=I([].slice),hc=TypeError,vl=function(t,r){if(t<r)throw hc("Not enough arguments");return t},Rs=/(?:ipad|iphone|ipod).*applewebkit/i.test(wt),ho=V,Hf=se,JE=De,QE=xe,b_=Ci,ca=d,ZE=i_,km=Cs,au=Jl,ev=vl,Hb=Rs,uh=kf,Nm=ho.setImmediate,cu=ho.clearImmediate,tv=ho.process,$f=ho.Dispatch,$b=ho.Function,T_=ho.MessageChannel,nv=ho.String,fo=0,Bc={},Wc="onreadystatechange";ca(function(){Fa=ho.location});var Do=function(t){if(b_(Bc,t)){var r=Bc[t];delete Bc[t],r()}},rv=function(t){return function(){Do(t)}},iv=function(t){Do(t.data)},sv=function(t){ho.postMessage(nv(t),Fa.protocol+"//"+Fa.host)};Nm&&cu||(Nm=function(t){ev(arguments.length,1);var r=QE(t)?t:$b(t),s=km(arguments,1);return Bc[++fo]=function(){Hf(r,void 0,s)},Om(fo),fo},cu=function(t){delete Bc[t]},uh?Om=function(t){tv.nextTick(rv(t))}:$f&&$f.now?Om=function(t){$f.now(rv(t))}:T_&&!Hb?(qE=(Gb=new T_).port2,Gb.port1.onmessage=iv,Om=JE(qE.postMessage,qE)):ho.addEventListener&&QE(ho.postMessage)&&!ho.importScripts&&Fa&&Fa.protocol!=="file:"&&!ca(sv)?(Om=sv,ho.addEventListener("message",iv,!1)):Om=Wc in au("script")?function(t){ZE.appendChild(au("script"))[Wc]=function(){ZE.removeChild(this),Do(t)}}:function(t){setTimeout(rv(t),0)});var ov={set:Nm,clear:cu},ad=function(){this.head=null,this.tail=null};ad.prototype={add:function(t){var r={item:t,next:null},s=this.tail;s?s.next=r:this.head=r,this.tail=r},get:function(){var t=this.head;if(t)return(this.head=t.next)===null&&(this.tail=null),t.item}};var Kf,w_,cd,C_,dh,Kb=ad,GI=/ipad|iphone|ipod/i.test(wt)&&typeof Pebble<"u",qb=/web0s(?!.*chrome)/i.test(wt),lu=V,HI=De,gD=We.f,av=ov.set,$I=Kb,qf=Rs,_D=GI,Dm=qb,cv=kf,qi=lu.MutationObserver||lu.WebKitMutationObserver,KI=lu.document,Yb=lu.process,lv=lu.Promise,qI=gD(lu,"queueMicrotask"),uv=qI&&qI.value;if(!uv){var R_=new $I,dv=function(){var t,r;for(cv&&(t=Yb.domain)&&t.exit();r=R_.get();)try{r()}catch(s){throw R_.head&&Kf(),s}t&&t.enter()};qf||cv||Dm||!qi||!KI?!_D&&lv&&lv.resolve?((C_=lv.resolve(void 0)).constructor=lv,dh=HI(C_.then,C_),Kf=function(){dh(dv)}):cv?Kf=function(){Yb.nextTick(dv)}:(av=HI(av,lu),Kf=function(){av(dv)}):(w_=!0,cd=KI.createTextNode(""),new qi(dv).observe(cd,{characterData:!0}),Kf=function(){cd.data=w_=!w_}),uv=function(t){R_.head||Kf(),R_.add(t)}}var fc=uv,hh=function(t){try{return{error:!1,value:t()}}catch(r){return{error:!0,value:r}}},Yf=V.Promise,ld=typeof Deno=="object"&&Deno&&typeof Deno.version=="object",hv=!ld&&!kf&&typeof window=="object"&&typeof document=="object",Xf=V,fh=Yf,Xb=xe,Jb=Oa,yD=v_,Qb=_r,ED=hv,YI=ld,fv=ai,I_=fh&&fh.prototype,pv=Qb("species"),Zb=Xb(Xf.PromiseRejectionEvent),eT=Jb("Promise",function(){var t=yD(fh),r=t!==String(fh);if(!r&&fv===66||!I_.catch||!I_.finally)return!0;if(!fv||fv<51||!/native code/.test(t)){var s=new fh(function(c){c(1)}),a=function(c){c(function(){},function(){})};if((s.constructor={})[pv]=a,!(s.then(function(){})instanceof a))return!0}return!r&&(ED||YI)&&!Zb}),A_={CONSTRUCTOR:eT,REJECTION_EVENT:Zb},Sl={},mv=vs,gv=TypeError,tT=function(t){var r,s;this.promise=new t(function(a,c){if(r!==void 0||s!==void 0)throw gv("Bad Promise constructor");r=a,s=c}),this.resolve=mv(r),this.reject=mv(s)};Sl.f=function(t){return new tT(t)};var xm,nT,vD=Wn,Jf=kf,ph=V,ud=Ee,SD=sd,_v=od,f=function(t){var r=pD(t);No&&r&&!r[UI]&&$E(r,UI,{configurable:!0,get:function(){return this}})},g=vs,T=xe,k=at,U=y_,H=ss,ce=ov.set,Ae=fc,Ue=function(t,r){try{arguments.length==1?console.error(t):console.error(t,r)}catch{}},it=hh,Pt=Kb,kt=id,At=Yf,Xt=A_,rn=Sl,sn="Promise",os=Xt.CONSTRUCTOR,Xe=Xt.REJECTION_EVENT,Ve=kt.getterFor(sn),et=kt.set,Lt=At&&At.prototype,cn=At,_n=Lt,bn=ph.TypeError,Un=ph.document,Is=ph.process,Cr=rn.f,mh=Cr,bD=!!(Un&&Un.createEvent&&ph.dispatchEvent),O3="unhandledrejection",k3=function(t){var r;return!(!k(t)||!T(r=t.then))&&r},N3=function(t,r){var s,a,c,u=r.value,h=r.state==1,m=h?t.ok:t.fail,y=t.resolve,v=t.reject,S=t.domain;try{m?(h||(r.rejection===2&&Cae(r),r.rejection=1),m===!0?s=u:(S&&S.enter(),s=m(u),S&&(S.exit(),c=!0)),s===t.promise?v(bn("Promise-chain cycle")):(a=k3(s))?ud(a,s,y,v):y(s)):v(u)}catch(R){S&&!c&&S.exit(),v(R)}},D3=function(t,r){t.notified||(t.notified=!0,Ae(function(){for(var s,a=t.reactions;s=a.get();)N3(s,t);t.notified=!1,r&&!t.rejection&&wae(t)}))},x3=function(t,r,s){var a,c;bD?((a=Un.createEvent("Event")).promise=r,a.reason=s,a.initEvent(t,!1,!0),ph.dispatchEvent(a)):a={promise:r,reason:s},!Xe&&(c=ph["on"+t])?c(a):t===O3&&Ue("Unhandled promise rejection",s)},wae=function(t){ud(ce,ph,function(){var r,s=t.facade,a=t.value;if(L3(t)&&(r=it(function(){Jf?Is.emit("unhandledRejection",a,s):x3(O3,s,a)}),t.rejection=Jf||L3(t)?2:1,r.error))throw r.value})},L3=function(t){return t.rejection!==1&&!t.parent},Cae=function(t){ud(ce,ph,function(){var r=t.facade;Jf?Is.emit("rejectionHandled",r):x3("rejectionhandled",r,t.value)})},yv=function(t,r,s){return function(a){t(r,a,s)}},Ev=function(t,r,s){t.done||(t.done=!0,s&&(t=s),t.value=r,t.state=2,D3(t,!0))},TD=function(t,r,s){if(!t.done){t.done=!0,s&&(t=s);try{if(t.facade===r)throw bn("Promise can't be resolved itself");var a=k3(r);a?Ae(function(){var c={done:!1};try{ud(a,r,yv(TD,c,t),yv(Ev,c,t))}catch(u){Ev(c,u,t)}}):(t.value=r,t.state=1,D3(t,!1))}catch(c){Ev({done:!1},c,t)}}};os&&(_n=(cn=function(t){U(this,_n),g(t),ud(xm,this);var r=Ve(this);try{t(yv(TD,r),yv(Ev,r))}catch(s){Ev(r,s)}}).prototype,(xm=function(t){et(this,{type:sn,done:!1,notified:!1,parent:!1,reactions:new Pt,rejection:!1,state:0,value:void 0})}).prototype=SD(_n,"then",function(t,r){var s=Ve(this),a=Cr(H(this,cn));return s.parent=!0,a.ok=!T(t)||t,a.fail=T(r)&&r,a.domain=Jf?Is.domain:void 0,s.state==0?s.reactions.add(a):Ae(function(){N3(a,s)}),a.promise}),nT=function(){var t=new xm,r=Ve(t);this.promise=t,this.resolve=yv(TD,r),this.reject=yv(Ev,r)},rn.f=Cr=function(t){return t===cn||t===void 0?new nT(t):mh(t)}),vD({global:!0,wrap:!0,forced:os},{Promise:cn}),_v(cn,sn,!1,!0),f(sn);var M3=_r("iterator"),U3=!1;try{var Rae=0,V3={next:function(){return{done:!!Rae++}},return:function(){U3=!0}};V3[M3]=function(){return this},Array.from(V3,function(){throw 2})}catch{}var Iae=Yf,Aae=function(t,r){if(!U3)return!1;var s=!1;try{var a={};a[M3]=function(){return{next:function(){return{done:s=!0}}}},t(a)}catch{}return s},XI=A_.CONSTRUCTOR||!Aae(function(t){Iae.all(t).then(void 0,function(){})}),Pae=Ee,Oae=vs,kae=Sl,Nae=hh,Dae=ah;Wn({target:"Promise",stat:!0,forced:XI},{all:function(t){var r=this,s=kae.f(r),a=s.resolve,c=s.reject,u=Nae(function(){var h=Oae(r.resolve),m=[],y=0,v=1;Dae(t,function(S){var R=y++,P=!1;v++,Pae(h,r,S).then(function(N){P||(P=!0,m[R]=N,--v||a(m))},c)}),--v||a(m)});return u.error&&c(u.value),s.promise}});var xae=Wn,Lae=A_.CONSTRUCTOR;Yf&&Yf.prototype,xae({target:"Promise",proto:!0,forced:Lae,real:!0},{catch:function(t){return this.then(void 0,t)}});var Mae=Ee,Uae=vs,Vae=Sl,Fae=hh,jae=ah;Wn({target:"Promise",stat:!0,forced:XI},{race:function(t){var r=this,s=Vae.f(r),a=s.reject,c=Fae(function(){var u=Uae(r.resolve);jae(t,function(h){Mae(u,r,h).then(s.resolve,a)})});return c.error&&a(c.value),s.promise}});var Bae=Ee,Wae=Sl;Wn({target:"Promise",stat:!0,forced:A_.CONSTRUCTOR},{reject:function(t){var r=Wae.f(this);return Bae(r.reject,void 0,t),r.promise}});var zae=fn,Gae=at,Hae=Sl,F3=function(t,r){if(zae(t),Gae(r)&&r.constructor===t)return r;var s=Hae.f(t);return(0,s.resolve)(r),s.promise},$ae=Wn,Kae=Yf,qae=A_.CONSTRUCTOR,Yae=F3,Xae=un("Promise"),Jae=!qae;$ae({target:"Promise",stat:!0,forced:!0},{resolve:function(t){return Yae(Jae&&this===Xae?Kae:this,t)}});var Qae=Ee,Zae=vs,ece=Sl,tce=hh,nce=ah;Wn({target:"Promise",stat:!0,forced:XI},{allSettled:function(t){var r=this,s=ece.f(r),a=s.resolve,c=s.reject,u=tce(function(){var h=Zae(r.resolve),m=[],y=0,v=1;nce(t,function(S){var R=y++,P=!1;v++,Qae(h,r,S).then(function(N){P||(P=!0,m[R]={status:"fulfilled",value:N},--v||a(m))},function(N){P||(P=!0,m[R]={status:"rejected",reason:N},--v||a(m))})}),--v||a(m)});return u.error&&c(u.value),s.promise}});var rce=Ee,ice=vs,sce=un,oce=Sl,ace=hh,cce=ah,j3="No one promise resolved";Wn({target:"Promise",stat:!0,forced:XI},{any:function(t){var r=this,s=sce("AggregateError"),a=oce.f(r),c=a.resolve,u=a.reject,h=ace(function(){var m=ice(r.resolve),y=[],v=0,S=1,R=!1;cce(t,function(P){var N=v++,G=!1;S++,rce(m,r,P).then(function(F){G||R||(R=!0,c(F))},function(F){G||R||(G=!0,y[N]=F,--S||u(new s(y,j3)))})}),--S||u(new s(y,j3))});return h.error&&u(h.value),a.promise}});var lce=Wn,wD=Yf,uce=d,dce=un,hce=xe,fce=ss,B3=F3,pce=wD&&wD.prototype;lce({target:"Promise",proto:!0,real:!0,forced:!!wD&&uce(function(){pce.finally.call({then:function(){}},function(){})})},{finally:function(t){var r=fce(this,dce("Promise")),s=hce(t);return this.then(s?function(a){return B3(r,t()).then(function(){return a})}:t,s?function(a){return B3(r,t()).then(function(){throw a})}:t)}});var CD=I,mce=kc,gce=Na,_ce=Ht,yce=CD("".charAt),W3=CD("".charCodeAt),Ece=CD("".slice),z3=function(t){return function(r,s){var a,c,u=gce(_ce(r)),h=mce(s),m=u.length;return h<0||h>=m?t?"":void 0:(a=W3(u,h))<55296||a>56319||h+1===m||(c=W3(u,h+1))<56320||c>57343?t?yce(u,h):a:t?Ece(u,h,h+2):c-56320+(a-55296<<10)+65536}},RD={codeAt:z3(!1),charAt:z3(!0)},vce=RD.charAt,Sce=Na,G3=id,bce=BE,H3=WE,$3="String Iterator",Tce=G3.set,wce=G3.getterFor($3);bce(String,"String",function(t){Tce(this,{type:$3,string:Sce(t),index:0})},function(){var t,r=wce(this),s=r.string,a=r.index;return a>=s.length?H3(void 0,!0):(t=vce(s,a),r.index+=t.length,H3(t,!1))});var Cce=yt.Promise,Rce={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},Ice=V,Ace=Nc,Pce=ta,K3=ih,q3=_r("toStringTag");for(var ID in Rce){var Y3=Ice[ID],AD=Y3&&Y3.prototype;AD&&Ace(AD)!==q3&&Pce(AD,q3,ID),K3[ID]=K3.Array}var X3=Cce,dt=l(X3),Oce=cc("Array").values,kce=Nc,Nce=Ci,Dce=O,xce=Oce,PD=Array.prototype,Lce={DOMTokenList:!0,NodeList:!0},Mce=function(t){var r=t.values;return t===PD||Dce(PD,t)&&r===PD.values||Nce(Lce,kce(t))?xce:r},zc=l(Mce),Uce=d,Vce=_r("iterator"),OD=!Uce(function(){var t=new URL("b?a=1&b=2&c=3","http://a"),r=t.searchParams,s=new URLSearchParams("a=1&a=2"),a="";return t.pathname="c%20d",r.forEach(function(c,u){r.delete("b"),a+=u+c}),s.delete("a",2),!t.toJSON||!s.has("a",1)||s.has("a",2)||!r.size&&!0||!r.sort||t.href!=="http://a/c%20d?a=1&c=3"||r.get("c")!=="3"||String(new URLSearchParams("?a=1"))!=="a=1"||!r[Vce]||new URL("https://a@b").username!=="a"||new URLSearchParams(new URLSearchParams("a=b")).get("a")!=="b"||new URL("http://").host!=="xn--e1aybc"||new URL("http://a#").hash!=="#%D0%B1"||a!=="a1c3"||new URL("http://x",void 0).host!=="x"}),Fce=sd,jce=oc,Bce=rt,Wce=Je,JI=function(t,r,s){var a=jce(r);a in t?Bce.f(t,a,Wce(0,s)):t[a]=s},J3=ge,zce=gi,Gce=JI,Hce=Array,$ce=Math.max,kD=function(t,r,s){for(var a=zce(t),c=J3(r,a),u=J3(s===void 0?a:s,a),h=Hce($ce(u-c,0)),m=0;c<u;c++,m++)Gce(h,m,t[c]);return h.length=m,h},Q3=kD,Kce=Math.floor,ND=function(t,r){var s=t.length,a=Kce(s/2);return s<8?qce(t,r):Yce(t,ND(Q3(t,0,a),r),ND(Q3(t,a),r),r)},qce=function(t,r){for(var s,a,c=t.length,u=1;u<c;){for(a=u,s=t[u];a&&r(t[a-1],s)>0;)t[a]=t[--a];a!==u++&&(t[a]=s)}return t},Yce=function(t,r,s,a){for(var c=r.length,u=s.length,h=0,m=0;h<c||m<u;)t[h+m]=h<c&&m<u?a(r[h],s[m])<=0?r[h++]:s[m++]:h<c?r[h++]:s[m++];return t},Z3=ND,DD=Wn,vv=V,QI=Ee,gh=I,Sv=$e,e5=OD,t5=sd,Xce=HE,Jce=function(t,r,s){for(var a in r)s&&s.unsafe&&t[a]?t[a]=r[a]:Fce(t,a,r[a],s);return t},Qce=od,Zce=UE,xD=id,n5=y_,LD=xe,ele=Ci,tle=De,nle=Nc,rle=fn,r5=at,pc=Na,ile=ia,i5=Je,MD=l_,sle=nd,bv=vl,ole=Z3,ale=_r("iterator"),rT="URLSearchParams",s5=rT+"Iterator",o5=xD.set,uu=xD.getterFor(rT),cle=xD.getterFor(s5),lle=Object.getOwnPropertyDescriptor,UD=function(t){if(!Sv)return vv[t];var r=lle(vv,t);return r&&r.value},a5=UD("fetch"),ZI=UD("Request"),iT=UD("Headers"),VD=ZI&&ZI.prototype,c5=iT&&iT.prototype,ule=vv.RegExp,dle=vv.TypeError,l5=vv.decodeURIComponent,hle=vv.encodeURIComponent,fle=gh("".charAt),u5=gh([].join),P_=gh([].push),FD=gh("".replace),ple=gh([].shift),d5=gh([].splice),h5=gh("".split),mle=gh("".slice),gle=/\+/g,f5=Array(4),_le=function(t){return f5[t-1]||(f5[t-1]=ule("((?:%[\\da-f]{2}){"+t+"})","gi"))},yle=function(t){try{return l5(t)}catch{return t}},p5=function(t){var r=FD(t,gle," "),s=4;try{return l5(r)}catch{for(;s;)r=FD(r,_le(s--),yle);return r}},Ele=/[!'()~]|%20/g,vle={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},Sle=function(t){return vle[t]},m5=function(t){return FD(hle(t),Ele,Sle)},jD=Zce(function(t,r){o5(this,{type:s5,iterator:MD(uu(t).entries),kind:r})},"Iterator",function(){var t=cle(this),r=t.kind,s=t.iterator.next(),a=s.value;return s.done||(s.value=r==="keys"?a.key:r==="values"?a.value:[a.key,a.value]),s},!0),g5=function(t){this.entries=[],this.url=null,t!==void 0&&(r5(t)?this.parseObject(t):this.parseQuery(typeof t=="string"?fle(t,0)==="?"?mle(t,1):t:pc(t)))};g5.prototype={type:rT,bindURL:function(t){this.url=t,this.update()},parseObject:function(t){var r,s,a,c,u,h,m,y=sle(t);if(y)for(s=(r=MD(t,y)).next;!(a=QI(s,r)).done;){if(u=(c=MD(rle(a.value))).next,(h=QI(u,c)).done||(m=QI(u,c)).done||!QI(u,c).done)throw dle("Expected sequence with length 2");P_(this.entries,{key:pc(h.value),value:pc(m.value)})}else for(var v in t)ele(t,v)&&P_(this.entries,{key:v,value:pc(t[v])})},parseQuery:function(t){if(t)for(var r,s,a=h5(t,"&"),c=0;c<a.length;)(r=a[c++]).length&&(s=h5(r,"="),P_(this.entries,{key:p5(ple(s)),value:p5(u5(s,"="))}))},serialize:function(){for(var t,r=this.entries,s=[],a=0;a<r.length;)t=r[a++],P_(s,m5(t.key)+"="+m5(t.value));return u5(s,"&")},update:function(){this.entries.length=0,this.parseQuery(this.url.query)},updateURL:function(){this.url&&this.url.update()}};var eA=function(){n5(this,Tv);var t=o5(this,new g5(arguments.length>0?arguments[0]:void 0));Sv||(this.size=t.entries.length)},Tv=eA.prototype;if(Jce(Tv,{append:function(t,r){var s=uu(this);bv(arguments.length,2),P_(s.entries,{key:pc(t),value:pc(r)}),Sv||this.length++,s.updateURL()},delete:function(t){for(var r=uu(this),s=bv(arguments.length,1),a=r.entries,c=pc(t),u=s<2?void 0:arguments[1],h=u===void 0?u:pc(u),m=0;m<a.length;){var y=a[m];if(y.key!==c||h!==void 0&&y.value!==h)m++;else if(d5(a,m,1),h!==void 0)break}Sv||(this.size=a.length),r.updateURL()},get:function(t){var r=uu(this).entries;bv(arguments.length,1);for(var s=pc(t),a=0;a<r.length;a++)if(r[a].key===s)return r[a].value;return null},getAll:function(t){var r=uu(this).entries;bv(arguments.length,1);for(var s=pc(t),a=[],c=0;c<r.length;c++)r[c].key===s&&P_(a,r[c].value);return a},has:function(t){for(var r=uu(this).entries,s=bv(arguments.length,1),a=pc(t),c=s<2?void 0:arguments[1],u=c===void 0?c:pc(c),h=0;h<r.length;){var m=r[h++];if(m.key===a&&(u===void 0||m.value===u))return!0}return!1},set:function(t,r){var s=uu(this);bv(arguments.length,1);for(var a,c=s.entries,u=!1,h=pc(t),m=pc(r),y=0;y<c.length;y++)(a=c[y]).key===h&&(u?d5(c,y--,1):(u=!0,a.value=m));u||P_(c,{key:h,value:m}),Sv||(this.size=c.length),s.updateURL()},sort:function(){var t=uu(this);ole(t.entries,function(r,s){return r.key>s.key?1:-1}),t.updateURL()},forEach:function(t){for(var r,s=uu(this).entries,a=tle(t,arguments.length>1?arguments[1]:void 0),c=0;c<s.length;)a((r=s[c++]).value,r.key,this)},keys:function(){return new jD(this,"keys")},values:function(){return new jD(this,"values")},entries:function(){return new jD(this,"entries")}},{enumerable:!0}),t5(Tv,ale,Tv.entries,{}),t5(Tv,"toString",function(){return uu(this).serialize()},{enumerable:!0}),Sv&&Xce(Tv,"size",{get:function(){return uu(this).entries.length},configurable:!0,enumerable:!0}),Qce(eA,rT),DD({global:!0,forced:!e5},{URLSearchParams:eA}),!e5&&LD(iT)){var ble=gh(c5.has),Tle=gh(c5.set),_5=function(t){if(r5(t)){var r,s=t.body;if(nle(s)===rT)return r=t.headers?new iT(t.headers):new iT,ble(r,"content-type")||Tle(r,"content-type","application/x-www-form-urlencoded;charset=UTF-8"),ile(t,{body:i5(0,pc(s)),headers:i5(0,r)})}return t};if(LD(a5)&&DD({global:!0,dontCallGetSet:!0,forced:!0},{fetch:function(t){return a5(t,arguments.length>1?_5(arguments[1]):{})}}),LD(ZI)){var BD=function(t){return n5(this,VD),new ZI(t,arguments.length>1?_5(arguments[1]):{})};VD.constructor=BD,BD.prototype=VD,DD({global:!0,dontCallGetSet:!0,forced:!0},{Request:BD})}}var du,wle={URLSearchParams:eA,getState:uu},Cle=yt.URLSearchParams,y5=$e,Rle=I,Ile=Ee,Ale=d,WD=Lc,Ple=xc,Ole=ke,kle=$o,Nle=on,wv=Object.assign,E5=Object.defineProperty,Dle=Rle([].concat),xle=!wv||Ale(function(){if(y5&&wv({b:1},wv(E5({},"a",{enumerable:!0,get:function(){E5(this,"b",{value:3,enumerable:!1})}}),{b:2})).b!==1)return!0;var t={},r={},s=Symbol(),a="abcdefghijklmnopqrst";return t[s]=7,a.split("").forEach(function(c){r[c]=c}),wv({},t)[s]!=7||WD(wv({},r)).join("")!=a})?function(t,r){for(var s=kle(t),a=arguments.length,c=1,u=Ple.f,h=Ole.f;a>c;)for(var m,y=Nle(arguments[c++]),v=u?Dle(WD(y),u(y)):WD(y),S=v.length,R=0;S>R;)m=v[R++],y5&&!Ile(h,y,m)||(s[m]=y[m]);return s}:wv,Lle=fn,Mle=u_,Ule=De,Vle=Ee,Fle=$o,jle=function(t,r,s,a){try{return a?r(Lle(s)[0],s[1]):r(s)}catch(c){Mle(t,"throw",c)}},Ble=c_,Wle=S_,zle=gi,v5=JI,Gle=l_,Hle=nd,S5=Array,O_=I,zD=2147483647,$le=/[^\0-\u007E]/,b5=/[.\u3002\uFF0E\uFF61]/g,T5="Overflow: input needs wider integers to process",w5=RangeError,Kle=O_(b5.exec),Cv=Math.floor,GD=String.fromCharCode,C5=O_("".charCodeAt),R5=O_([].join),Lm=O_([].push),qle=O_("".replace),Yle=O_("".split),Xle=O_("".toLowerCase),I5=function(t){return t+22+75*(t<26)},Jle=function(t,r,s){var a=0;for(t=s?Cv(t/700):t>>1,t+=Cv(t/r);t>455;)t=Cv(t/35),a+=36;return Cv(a+36*t/(t+38))},Qle=function(t){var r=[];t=function(X){for(var ee=[],he=0,Se=X.length;he<Se;){var Te=C5(X,he++);if(Te>=55296&&Te<=56319&&he<Se){var ye=C5(X,he++);(64512&ye)==56320?Lm(ee,((1023&Te)<<10)+(1023&ye)+65536):(Lm(ee,Te),he--)}else Lm(ee,Te)}return ee}(t);var s,a,c=t.length,u=128,h=0,m=72;for(s=0;s<t.length;s++)(a=t[s])<128&&Lm(r,GD(a));var y=r.length,v=y;for(y&&Lm(r,"-");v<c;){var S=zD;for(s=0;s<t.length;s++)(a=t[s])>=u&&a<S&&(S=a);var R=v+1;if(S-u>Cv((zD-h)/R))throw w5(T5);for(h+=(S-u)*R,u=S,s=0;s<t.length;s++){if((a=t[s])<u&&++h>zD)throw w5(T5);if(a==u){for(var P=h,N=36;;){var G=N<=m?1:N>=m+26?26:N-m;if(P<G)break;var F=P-G,j=36-G;Lm(r,GD(I5(G+F%j))),P=Cv(F/j),N+=36}Lm(r,GD(I5(P))),m=Jle(h,R,v==y),h=0,v++}}h++,u++}return R5(r,"")},Zle=Wn,HD=$e,eue=OD,$D=V,A5=De,hu=I,tA=sd,fu=HE,tue=y_,KD=Ci,qD=xle,Rv=function(t){var r=Fle(t),s=Wle(this),a=arguments.length,c=a>1?arguments[1]:void 0,u=c!==void 0;u&&(c=Ule(c,a>2?arguments[2]:void 0));var h,m,y,v,S,R,P=Hle(r),N=0;if(!P||this===S5&&Ble(P))for(h=zle(r),m=s?new this(h):S5(h);h>N;N++)R=u?c(r[N],N):r[N],v5(m,N,R);else for(S=(v=Gle(r,P)).next,m=s?new this:[];!(y=Vle(S,v)).done;N++)R=u?jle(v,c,[y.value,N],!0):y.value,v5(m,N,R);return m.length=N,m},dd=kD,nue=RD.codeAt,rue=function(t){var r,s,a=[],c=Yle(qle(Xle(t),b5,"."),".");for(r=0;r<c.length;r++)s=c[r],Lm(a,Kle($le,s)?"xn--"+Qle(s):s);return R5(a,".")},Qf=Na,iue=od,sue=vl,P5=wle,O5=id,oue=O5.set,nA=O5.getterFor("URL"),aue=P5.URLSearchParams,cue=P5.getState,sT=$D.URL,YD=$D.TypeError,rA=$D.parseInt,lue=Math.floor,k5=Math.pow,pu=hu("".charAt),hd=hu(/./.exec),oT=hu([].join),uue=hu(1 .toString),due=hu([].pop),Iv=hu([].push),XD=hu("".replace),hue=hu([].shift),fue=hu("".split),aT=hu("".slice),iA=hu("".toLowerCase),pue=hu([].unshift),JD="Invalid scheme",k_="Invalid host",N5="Invalid port",D5=/[a-z]/i,mue=/[\d+-.a-z]/i,QD=/\d/,gue=/^0x/i,_ue=/^[0-7]+$/,yue=/^\d+$/,x5=/^[\da-f]+$/i,Eue=/[\0\t\n\r #%/:<>?@[\\\]^|]/,vue=/[\0\t\n\r #/:<>?@[\\\]^|]/,Sue=/^[\u0000-\u0020]+/,bue=/(^|[^\u0000-\u0020])[\u0000-\u0020]+$/,Tue=/[\t\n\r]/g,cT=function(t){var r,s,a,c;if(typeof t=="number"){for(r=[],s=0;s<4;s++)pue(r,t%256),t=lue(t/256);return oT(r,".")}if(typeof t=="object"){for(r="",a=function(u){for(var h=null,m=1,y=null,v=0,S=0;S<8;S++)u[S]!==0?(v>m&&(h=y,m=v),y=null,v=0):(y===null&&(y=S),++v);return v>m&&(h=y,m=v),h}(t),s=0;s<8;s++)c&&t[s]===0||(c&&(c=!1),a===s?(r+=s?":":"::",c=!0):(r+=uue(t[s],16),s<7&&(r+=":")));return"["+r+"]"}return t},sA={},L5=qD({},sA,{" ":1,'"':1,"<":1,">":1,"`":1}),M5=qD({},L5,{"#":1,"?":1,"{":1,"}":1}),ZD=qD({},M5,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),Mm=function(t,r){var s=nue(t,0);return s>32&&s<127&&!KD(r,t)?t:encodeURIComponent(t)},oA={ftp:21,file:null,http:80,https:443,ws:80,wss:443},lT=function(t,r){var s;return t.length==2&&hd(D5,pu(t,0))&&((s=pu(t,1))==":"||!r&&s=="|")},U5=function(t){var r;return t.length>1&&lT(aT(t,0,2))&&(t.length==2||(r=pu(t,2))==="/"||r==="\\"||r==="?"||r==="#")},wue=function(t){return t==="."||iA(t)==="%2e"},ex={},V5={},tx={},F5={},j5={},nx={},B5={},W5={},aA={},cA={},rx={},ix={},sx={},ox={},z5={},ax={},Av={},_h={},G5={},N_={},Zf={},cx=function(t,r,s){var a,c,u,h=Qf(t);if(r){if(c=this.parse(h))throw YD(c);this.searchParams=null}else{if(s!==void 0&&(a=new cx(s,!0)),c=this.parse(h,null,a))throw YD(c);(u=cue(new aue)).bindURL(this),this.searchParams=u}};cx.prototype={type:"URL",parse:function(t,r,s){var a,c,u,h,m,y=this,v=r||ex,S=0,R="",P=!1,N=!1,G=!1;for(t=Qf(t),r||(y.scheme="",y.username="",y.password="",y.host=null,y.port=null,y.path=[],y.query=null,y.fragment=null,y.cannotBeABaseURL=!1,t=XD(t,Sue,""),t=XD(t,bue,"$1")),t=XD(t,Tue,""),a=Rv(t);S<=a.length;){switch(c=a[S],v){case ex:if(!c||!hd(D5,c)){if(r)return JD;v=tx;continue}R+=iA(c),v=V5;break;case V5:if(c&&(hd(mue,c)||c=="+"||c=="-"||c=="."))R+=iA(c);else{if(c!=":"){if(r)return JD;R="",v=tx,S=0;continue}if(r&&(y.isSpecial()!=KD(oA,R)||R=="file"&&(y.includesCredentials()||y.port!==null)||y.scheme=="file"&&!y.host))return;if(y.scheme=R,r)return void(y.isSpecial()&&oA[y.scheme]==y.port&&(y.port=null));R="",y.scheme=="file"?v=ox:y.isSpecial()&&s&&s.scheme==y.scheme?v=F5:y.isSpecial()?v=W5:a[S+1]=="/"?(v=j5,S++):(y.cannotBeABaseURL=!0,Iv(y.path,""),v=G5)}break;case tx:if(!s||s.cannotBeABaseURL&&c!="#")return JD;if(s.cannotBeABaseURL&&c=="#"){y.scheme=s.scheme,y.path=dd(s.path),y.query=s.query,y.fragment="",y.cannotBeABaseURL=!0,v=Zf;break}v=s.scheme=="file"?ox:nx;continue;case F5:if(c!="/"||a[S+1]!="/"){v=nx;continue}v=aA,S++;break;case j5:if(c=="/"){v=cA;break}v=_h;continue;case nx:if(y.scheme=s.scheme,c==du)y.username=s.username,y.password=s.password,y.host=s.host,y.port=s.port,y.path=dd(s.path),y.query=s.query;else if(c=="/"||c=="\\"&&y.isSpecial())v=B5;else if(c=="?")y.username=s.username,y.password=s.password,y.host=s.host,y.port=s.port,y.path=dd(s.path),y.query="",v=N_;else{if(c!="#"){y.username=s.username,y.password=s.password,y.host=s.host,y.port=s.port,y.path=dd(s.path),y.path.length--,v=_h;continue}y.username=s.username,y.password=s.password,y.host=s.host,y.port=s.port,y.path=dd(s.path),y.query=s.query,y.fragment="",v=Zf}break;case B5:if(!y.isSpecial()||c!="/"&&c!="\\"){if(c!="/"){y.username=s.username,y.password=s.password,y.host=s.host,y.port=s.port,v=_h;continue}v=cA}else v=aA;break;case W5:if(v=aA,c!="/"||pu(R,S+1)!="/")continue;S++;break;case aA:if(c!="/"&&c!="\\"){v=cA;continue}break;case cA:if(c=="@"){P&&(R="%40"+R),P=!0,u=Rv(R);for(var F=0;F<u.length;F++){var j=u[F];if(j!=":"||G){var X=Mm(j,ZD);G?y.password+=X:y.username+=X}else G=!0}R=""}else if(c==du||c=="/"||c=="?"||c=="#"||c=="\\"&&y.isSpecial()){if(P&&R=="")return"Invalid authority";S-=Rv(R).length+1,R="",v=rx}else R+=c;break;case rx:case ix:if(r&&y.scheme=="file"){v=ax;continue}if(c!=":"||N){if(c==du||c=="/"||c=="?"||c=="#"||c=="\\"&&y.isSpecial()){if(y.isSpecial()&&R=="")return k_;if(r&&R==""&&(y.includesCredentials()||y.port!==null))return;if(h=y.parseHost(R))return h;if(R="",v=Av,r)return;continue}c=="["?N=!0:c=="]"&&(N=!1),R+=c}else{if(R=="")return k_;if(h=y.parseHost(R))return h;if(R="",v=sx,r==ix)return}break;case sx:if(!hd(QD,c)){if(c==du||c=="/"||c=="?"||c=="#"||c=="\\"&&y.isSpecial()||r){if(R!=""){var ee=rA(R,10);if(ee>65535)return N5;y.port=y.isSpecial()&&ee===oA[y.scheme]?null:ee,R=""}if(r)return;v=Av;continue}return N5}R+=c;break;case ox:if(y.scheme="file",c=="/"||c=="\\")v=z5;else{if(!s||s.scheme!="file"){v=_h;continue}if(c==du)y.host=s.host,y.path=dd(s.path),y.query=s.query;else if(c=="?")y.host=s.host,y.path=dd(s.path),y.query="",v=N_;else{if(c!="#"){U5(oT(dd(a,S),""))||(y.host=s.host,y.path=dd(s.path),y.shortenPath()),v=_h;continue}y.host=s.host,y.path=dd(s.path),y.query=s.query,y.fragment="",v=Zf}}break;case z5:if(c=="/"||c=="\\"){v=ax;break}s&&s.scheme=="file"&&!U5(oT(dd(a,S),""))&&(lT(s.path[0],!0)?Iv(y.path,s.path[0]):y.host=s.host),v=_h;continue;case ax:if(c==du||c=="/"||c=="\\"||c=="?"||c=="#"){if(!r&&lT(R))v=_h;else if(R==""){if(y.host="",r)return;v=Av}else{if(h=y.parseHost(R))return h;if(y.host=="localhost"&&(y.host=""),r)return;R="",v=Av}continue}R+=c;break;case Av:if(y.isSpecial()){if(v=_h,c!="/"&&c!="\\")continue}else if(r||c!="?")if(r||c!="#"){if(c!=du&&(v=_h,c!="/"))continue}else y.fragment="",v=Zf;else y.query="",v=N_;break;case _h:if(c==du||c=="/"||c=="\\"&&y.isSpecial()||!r&&(c=="?"||c=="#")){if((m=iA(m=R))===".."||m==="%2e."||m===".%2e"||m==="%2e%2e"?(y.shortenPath(),c=="/"||c=="\\"&&y.isSpecial()||Iv(y.path,"")):wue(R)?c=="/"||c=="\\"&&y.isSpecial()||Iv(y.path,""):(y.scheme=="file"&&!y.path.length&&lT(R)&&(y.host&&(y.host=""),R=pu(R,0)+":"),Iv(y.path,R)),R="",y.scheme=="file"&&(c==du||c=="?"||c=="#"))for(;y.path.length>1&&y.path[0]==="";)hue(y.path);c=="?"?(y.query="",v=N_):c=="#"&&(y.fragment="",v=Zf)}else R+=Mm(c,M5);break;case G5:c=="?"?(y.query="",v=N_):c=="#"?(y.fragment="",v=Zf):c!=du&&(y.path[0]+=Mm(c,sA));break;case N_:r||c!="#"?c!=du&&(c=="'"&&y.isSpecial()?y.query+="%27":y.query+=c=="#"?"%23":Mm(c,sA)):(y.fragment="",v=Zf);break;case Zf:c!=du&&(y.fragment+=Mm(c,L5))}S++}},parseHost:function(t){var r,s,a;if(pu(t,0)=="["){if(pu(t,t.length-1)!="]"||(r=function(c){var u,h,m,y,v,S,R,P=[0,0,0,0,0,0,0,0],N=0,G=null,F=0,j=function(){return pu(c,F)};if(j()==":"){if(pu(c,1)!=":")return;F+=2,G=++N}for(;j();){if(N==8)return;if(j()!=":"){for(u=h=0;h<4&&hd(x5,j());)u=16*u+rA(j(),16),F++,h++;if(j()=="."){if(h==0||(F-=h,N>6))return;for(m=0;j();){if(y=null,m>0){if(!(j()=="."&&m<4))return;F++}if(!hd(QD,j()))return;for(;hd(QD,j());){if(v=rA(j(),10),y===null)y=v;else{if(y==0)return;y=10*y+v}if(y>255)return;F++}P[N]=256*P[N]+y,++m!=2&&m!=4||N++}if(m!=4)return;break}if(j()==":"){if(F++,!j())return}else if(j())return;P[N++]=u}else{if(G!==null)return;F++,G=++N}}if(G!==null)for(S=N-G,N=7;N!=0&&S>0;)R=P[N],P[N--]=P[G+S-1],P[G+--S]=R;else if(N!=8)return;return P}(aT(t,1,-1)),!r))return k_;this.host=r}else if(this.isSpecial()){if(t=rue(t),hd(Eue,t)||(r=function(c){var u,h,m,y,v,S,R,P=fue(c,".");if(P.length&&P[P.length-1]==""&&P.length--,(u=P.length)>4)return c;for(h=[],m=0;m<u;m++){if((y=P[m])=="")return c;if(v=10,y.length>1&&pu(y,0)=="0"&&(v=hd(gue,y)?16:8,y=aT(y,v==8?1:2)),y==="")S=0;else{if(!hd(v==10?yue:v==8?_ue:x5,y))return c;S=rA(y,v)}Iv(h,S)}for(m=0;m<u;m++)if(S=h[m],m==u-1){if(S>=k5(256,5-u))return null}else if(S>255)return null;for(R=due(h),m=0;m<h.length;m++)R+=h[m]*k5(256,3-m);return R}(t),r===null))return k_;this.host=r}else{if(hd(vue,t))return k_;for(r="",s=Rv(t),a=0;a<s.length;a++)r+=Mm(s[a],sA);this.host=r}},cannotHaveUsernamePasswordPort:function(){return!this.host||this.cannotBeABaseURL||this.scheme=="file"},includesCredentials:function(){return this.username!=""||this.password!=""},isSpecial:function(){return KD(oA,this.scheme)},shortenPath:function(){var t=this.path,r=t.length;!r||this.scheme=="file"&&r==1&&lT(t[0],!0)||t.length--},serialize:function(){var t=this,r=t.scheme,s=t.username,a=t.password,c=t.host,u=t.port,h=t.path,m=t.query,y=t.fragment,v=r+":";return c!==null?(v+="//",t.includesCredentials()&&(v+=s+(a?":"+a:"")+"@"),v+=cT(c),u!==null&&(v+=":"+u)):r=="file"&&(v+="//"),v+=t.cannotBeABaseURL?h[0]:h.length?"/"+oT(h,"/"):"",m!==null&&(v+="?"+m),y!==null&&(v+="#"+y),v},setHref:function(t){var r=this.parse(t);if(r)throw YD(r);this.searchParams.update()},getOrigin:function(){var t=this.scheme,r=this.port;if(t=="blob")try{return new Pv(t.path[0]).origin}catch{return"null"}return t!="file"&&this.isSpecial()?t+"://"+cT(this.host)+(r!==null?":"+r:""):"null"},getProtocol:function(){return this.scheme+":"},setProtocol:function(t){this.parse(Qf(t)+":",ex)},getUsername:function(){return this.username},setUsername:function(t){var r=Rv(Qf(t));if(!this.cannotHaveUsernamePasswordPort()){this.username="";for(var s=0;s<r.length;s++)this.username+=Mm(r[s],ZD)}},getPassword:function(){return this.password},setPassword:function(t){var r=Rv(Qf(t));if(!this.cannotHaveUsernamePasswordPort()){this.password="";for(var s=0;s<r.length;s++)this.password+=Mm(r[s],ZD)}},getHost:function(){var t=this.host,r=this.port;return t===null?"":r===null?cT(t):cT(t)+":"+r},setHost:function(t){this.cannotBeABaseURL||this.parse(t,rx)},getHostname:function(){var t=this.host;return t===null?"":cT(t)},setHostname:function(t){this.cannotBeABaseURL||this.parse(t,ix)},getPort:function(){var t=this.port;return t===null?"":Qf(t)},setPort:function(t){this.cannotHaveUsernamePasswordPort()||((t=Qf(t))==""?this.port=null:this.parse(t,sx))},getPathname:function(){var t=this.path;return this.cannotBeABaseURL?t[0]:t.length?"/"+oT(t,"/"):""},setPathname:function(t){this.cannotBeABaseURL||(this.path=[],this.parse(t,Av))},getSearch:function(){var t=this.query;return t?"?"+t:""},setSearch:function(t){(t=Qf(t))==""?this.query=null:(pu(t,0)=="?"&&(t=aT(t,1)),this.query="",this.parse(t,N_)),this.searchParams.update()},getSearchParams:function(){return this.searchParams.facade},getHash:function(){var t=this.fragment;return t?"#"+t:""},setHash:function(t){(t=Qf(t))!=""?(pu(t,0)=="#"&&(t=aT(t,1)),this.fragment="",this.parse(t,Zf)):this.fragment=null},update:function(){this.query=this.searchParams.serialize()||null}};var Pv=function(t){var r=tue(this,mc),s=sue(arguments.length,1)>1?arguments[1]:void 0,a=oue(r,new cx(t,!1,s));HD||(r.href=a.serialize(),r.origin=a.getOrigin(),r.protocol=a.getProtocol(),r.username=a.getUsername(),r.password=a.getPassword(),r.host=a.getHost(),r.hostname=a.getHostname(),r.port=a.getPort(),r.pathname=a.getPathname(),r.search=a.getSearch(),r.searchParams=a.getSearchParams(),r.hash=a.getHash())},mc=Pv.prototype,mu=function(t,r){return{get:function(){return nA(this)[t]()},set:r&&function(s){return nA(this)[r](s)},configurable:!0,enumerable:!0}};if(HD&&(fu(mc,"href",mu("serialize","setHref")),fu(mc,"origin",mu("getOrigin")),fu(mc,"protocol",mu("getProtocol","setProtocol")),fu(mc,"username",mu("getUsername","setUsername")),fu(mc,"password",mu("getPassword","setPassword")),fu(mc,"host",mu("getHost","setHost")),fu(mc,"hostname",mu("getHostname","setHostname")),fu(mc,"port",mu("getPort","setPort")),fu(mc,"pathname",mu("getPathname","setPathname")),fu(mc,"search",mu("getSearch","setSearch")),fu(mc,"searchParams",mu("getSearchParams")),fu(mc,"hash",mu("getHash","setHash"))),tA(mc,"toJSON",function(){return nA(this).serialize()},{enumerable:!0}),tA(mc,"toString",function(){return nA(this).serialize()},{enumerable:!0}),sT){var H5=sT.createObjectURL,$5=sT.revokeObjectURL;H5&&tA(Pv,"createObjectURL",A5(H5,sT)),$5&&tA(Pv,"revokeObjectURL",A5($5,sT))}iue(Pv,"URL"),Zle({global:!0,forced:!eue,sham:!HD},{URL:Pv});var Cue=Wn,Rue=d,Iue=vl,K5=Na,Aue=OD,q5=un("URL");Cue({target:"URL",stat:!0,forced:!(Aue&&Rue(function(){q5.canParse()}))},{canParse:function(t){var r=Iue(arguments.length,1),s=K5(t),a=r<2||arguments[1]===void 0?void 0:K5(arguments[1]);try{return!!new q5(s,a)}catch{return!1}}});var lA=l(yt.URL);let Y5=!0,X5=!0;function uA(t,r,s){const a=t.match(r);return a&&a.length>=s&&parseInt(a[s],10)}function D_(t,r,s){if(!t.RTCPeerConnection)return;const a=t.RTCPeerConnection.prototype,c=a.addEventListener;a.addEventListener=function(h,m){if(h!==r)return c.apply(this,arguments);const y=v=>{const S=s(v);S&&(m.handleEvent?m.handleEvent(S):m(S))};return this._eventMap=this._eventMap||{},this._eventMap[r]||(this._eventMap[r]=new Map),this._eventMap[r].set(m,y),c.apply(this,[h,y])};const u=a.removeEventListener;a.removeEventListener=function(h,m){if(h!==r||!this._eventMap||!this._eventMap[r])return u.apply(this,arguments);if(!this._eventMap[r].has(m))return u.apply(this,arguments);const y=this._eventMap[r].get(m);return this._eventMap[r].delete(m),this._eventMap[r].size===0&&delete this._eventMap[r],Object.keys(this._eventMap).length===0&&delete this._eventMap,u.apply(this,[h,y])},Object.defineProperty(a,"on"+r,{get(){return this["_on"+r]},set(h){this["_on"+r]&&(this.removeEventListener(r,this["_on"+r]),delete this["_on"+r]),h&&this.addEventListener(r,this["_on"+r]=h)},enumerable:!0,configurable:!0})}function Pue(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):(Y5=t,t?"adapter.js logging disabled":"adapter.js logging enabled")}function Oue(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):(X5=!t,"adapter.js deprecation warnings "+(t?"disabled":"enabled"))}function J5(){if(typeof window=="object"){if(Y5)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function lx(t,r){X5&&console.warn(t+" is deprecated, please use "+r+" instead.")}function Q5(t){return Object.prototype.toString.call(t)==="[object Object]"}function Z5(t){var r;return Q5(t)?lc(r=Object.keys(t)).call(r,function(s,a){const c=Q5(t[a]),u=c?Z5(t[a]):t[a],h=c&&!Object.keys(u).length;return u===void 0||h?s:Object.assign(s,{[a]:u})},{}):t}function ux(t,r,s){r&&!s.has(r.id)&&(s.set(r.id,r),Object.keys(r).forEach(a=>{a.endsWith("Id")?ux(t,t.get(r[a]),s):a.endsWith("Ids")&&r[a].forEach(c=>{ux(t,t.get(c),s)})}))}function eB(t,r,s){const a=s?"outbound-rtp":"inbound-rtp",c=new Map;if(r===null)return c;const u=[];return t.forEach(h=>{h.type==="track"&&h.trackIdentifier===r.id&&u.push(h)}),u.forEach(h=>{t.forEach(m=>{m.type===a&&m.trackId===h.id&&ux(t,m,c)})}),c}const tB=J5;function nB(t,r){const s=t&&t.navigator;if(!s.mediaDevices)return;const a=function(h){if(typeof h!="object"||h.mandatory||h.optional)return h;const m={};return Object.keys(h).forEach(y=>{if(y==="require"||y==="advanced"||y==="mediaSource")return;const v=typeof h[y]=="object"?h[y]:{ideal:h[y]};v.exact!==void 0&&typeof v.exact=="number"&&(v.min=v.max=v.exact);const S=function(R,P){return R?R+P.charAt(0).toUpperCase()+P.slice(1):P==="deviceId"?"sourceId":P};if(v.ideal!==void 0){m.optional=m.optional||[];let R={};typeof v.ideal=="number"?(R[S("min",y)]=v.ideal,m.optional.push(R),R={},R[S("max",y)]=v.ideal,m.optional.push(R)):(R[S("",y)]=v.ideal,m.optional.push(R))}v.exact!==void 0&&typeof v.exact!="number"?(m.mandatory=m.mandatory||{},m.mandatory[S("",y)]=v.exact):["min","max"].forEach(R=>{v[R]!==void 0&&(m.mandatory=m.mandatory||{},m.mandatory[S(R,y)]=v[R])})}),h.advanced&&(m.optional=(m.optional||[]).concat(h.advanced)),m},c=function(h,m){if(r.version>=61)return m(h);if((h=JSON.parse(JSON.stringify(h)))&&typeof h.audio=="object"){const y=function(v,S,R){S in v&&!(R in v)&&(v[R]=v[S],delete v[S])};y((h=JSON.parse(JSON.stringify(h))).audio,"autoGainControl","googAutoGainControl"),y(h.audio,"noiseSuppression","googNoiseSuppression"),h.audio=a(h.audio)}if(h&&typeof h.video=="object"){let y=h.video.facingMode;y=y&&(typeof y=="object"?y:{ideal:y});const v=r.version<66;if(y&&(y.exact==="user"||y.exact==="environment"||y.ideal==="user"||y.ideal==="environment")&&(!s.mediaDevices.getSupportedConstraints||!s.mediaDevices.getSupportedConstraints().facingMode||v)){let S;if(delete h.video.facingMode,y.exact==="environment"||y.ideal==="environment"?S=["back","rear"]:y.exact!=="user"&&y.ideal!=="user"||(S=["front"]),S)return s.mediaDevices.enumerateDevices().then(R=>{let P=(R=R.filter(N=>N.kind==="videoinput")).find(N=>S.some(G=>{var F;return ot(F=N.label.toLowerCase()).call(F,G)}));return!P&&R.length&&ot(S).call(S,"back")&&(P=R[R.length-1]),P&&(h.video.deviceId=y.exact?{exact:P.deviceId}:{ideal:P.deviceId}),h.video=a(h.video),tB("chrome: "+JSON.stringify(h)),m(h)})}h.video=a(h.video)}return tB("chrome: "+JSON.stringify(h)),m(h)},u=function(h){return r.version>=64?h:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[h.name]||h.name,message:h.message,constraint:h.constraint||h.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(s.getUserMedia=(function(h,m,y){c(h,v=>{s.webkitGetUserMedia(v,m,S=>{y&&y(u(S))})})}).bind(s),s.mediaDevices.getUserMedia){const h=s.mediaDevices.getUserMedia.bind(s.mediaDevices);s.mediaDevices.getUserMedia=function(m){return c(m,y=>h(y).then(v=>{if(y.audio&&!v.getAudioTracks().length||y.video&&!v.getVideoTracks().length)throw v.getTracks().forEach(S=>{S.stop()}),new DOMException("","NotFoundError");return v},v=>dt.reject(u(v))))}}}function rB(t){t.MediaStream=t.MediaStream||t.webkitMediaStream}function iB(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("ontrack"in t.RTCPeerConnection.prototype)){Object.defineProperty(t.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(s){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=s)},enumerable:!0,configurable:!0});const r=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=s=>{s.stream.addEventListener("addtrack",a=>{let c;c=t.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(h=>h.track&&h.track.id===a.track.id):{track:a.track};const u=new Event("track");u.track=a.track,u.receiver=c,u.transceiver={receiver:c},u.streams=[s.stream],this.dispatchEvent(u)}),s.stream.getTracks().forEach(a=>{let c;c=t.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(h=>h.track&&h.track.id===a.id):{track:a};const u=new Event("track");u.track=a,u.receiver=c,u.transceiver={receiver:c},u.streams=[s.stream],this.dispatchEvent(u)})},this.addEventListener("addstream",this._ontrackpoly)),r.apply(this,arguments)}}else D_(t,"track",r=>(r.transceiver||Object.defineProperty(r,"transceiver",{value:{receiver:r.receiver}}),r))}function sB(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("getSenders"in t.RTCPeerConnection.prototype)&&"createDTMFSender"in t.RTCPeerConnection.prototype){const r=function(c,u){return{track:u,get dtmf(){return this._dtmf===void 0&&(u.kind==="audio"?this._dtmf=c.createDTMFSender(u):this._dtmf=null),this._dtmf},_pc:c}};if(!t.RTCPeerConnection.prototype.getSenders){t.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const c=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(h,m){let y=c.apply(this,arguments);return y||(y=r(this,h),this._senders.push(y)),y};const u=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(h){u.apply(this,arguments);const m=this._senders.indexOf(h);m!==-1&&this._senders.splice(m,1)}}const s=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(c){this._senders=this._senders||[],s.apply(this,[c]),c.getTracks().forEach(u=>{this._senders.push(r(this,u))})};const a=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(c){this._senders=this._senders||[],a.apply(this,[c]),c.getTracks().forEach(u=>{const h=this._senders.find(m=>m.track===u);h&&this._senders.splice(this._senders.indexOf(h),1)})}}else if(typeof t=="object"&&t.RTCPeerConnection&&"getSenders"in t.RTCPeerConnection.prototype&&"createDTMFSender"in t.RTCPeerConnection.prototype&&t.RTCRtpSender&&!("dtmf"in t.RTCRtpSender.prototype)){const r=t.RTCPeerConnection.prototype.getSenders;t.RTCPeerConnection.prototype.getSenders=function(){const s=r.apply(this,[]);return s.forEach(a=>a._pc=this),s},Object.defineProperty(t.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function oB(t){if(!t.RTCPeerConnection)return;const r=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){const[s,a,c]=arguments;if(arguments.length>0&&typeof s=="function")return r.apply(this,arguments);if(r.length===0&&(arguments.length===0||typeof s!="function"))return r.apply(this,[]);const u=function(m){const y={};return m.result().forEach(v=>{const S={id:v.id,timestamp:v.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[v.type]||v.type};v.names().forEach(R=>{S[R]=v.stat(R)}),y[S.id]=S}),y},h=function(m){return new Map(Object.keys(m).map(y=>[y,m[y]]))};if(arguments.length>=2){const m=function(y){a(h(u(y)))};return r.apply(this,[m,s])}return new dt((m,y)=>{r.apply(this,[function(v){m(h(u(v)))},y])}).then(a,c)}}function aB(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender&&t.RTCRtpReceiver))return;if(!("getStats"in t.RTCRtpSender.prototype)){const s=t.RTCPeerConnection.prototype.getSenders;s&&(t.RTCPeerConnection.prototype.getSenders=function(){const c=s.apply(this,[]);return c.forEach(u=>u._pc=this),c});const a=t.RTCPeerConnection.prototype.addTrack;a&&(t.RTCPeerConnection.prototype.addTrack=function(){const c=a.apply(this,arguments);return c._pc=this,c}),t.RTCRtpSender.prototype.getStats=function(){const c=this;return this._pc.getStats().then(u=>eB(u,c.track,!0))}}if(!("getStats"in t.RTCRtpReceiver.prototype)){const s=t.RTCPeerConnection.prototype.getReceivers;s&&(t.RTCPeerConnection.prototype.getReceivers=function(){const a=s.apply(this,[]);return a.forEach(c=>c._pc=this),a}),D_(t,"track",a=>(a.receiver._pc=a.srcElement,a)),t.RTCRtpReceiver.prototype.getStats=function(){const a=this;return this._pc.getStats().then(c=>eB(c,a.track,!1))}}if(!("getStats"in t.RTCRtpSender.prototype)||!("getStats"in t.RTCRtpReceiver.prototype))return;const r=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof t.MediaStreamTrack){const s=arguments[0];let a,c,u;return this.getSenders().forEach(h=>{h.track===s&&(a?u=!0:a=h)}),this.getReceivers().forEach(h=>(h.track===s&&(c?u=!0:c=h),h.track===s)),u||a&&c?dt.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):a?a.getStats():c?c.getStats():dt.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return r.apply(this,arguments)}}function cB(t){t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(u=>this._shimmedLocalStreams[u][0])};const r=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(u,h){if(!h)return r.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const m=r.apply(this,arguments);return this._shimmedLocalStreams[h.id]?this._shimmedLocalStreams[h.id].indexOf(m)===-1&&this._shimmedLocalStreams[h.id].push(m):this._shimmedLocalStreams[h.id]=[h,m],m};const s=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(u){this._shimmedLocalStreams=this._shimmedLocalStreams||{},u.getTracks().forEach(y=>{if(this.getSenders().find(S=>S.track===y))throw new DOMException("Track already exists.","InvalidAccessError")});const h=this.getSenders();s.apply(this,arguments);const m=this.getSenders().filter(y=>h.indexOf(y)===-1);this._shimmedLocalStreams[u.id]=[u].concat(m)};const a=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(u){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[u.id],a.apply(this,arguments)};const c=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(u){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},u&&Object.keys(this._shimmedLocalStreams).forEach(h=>{const m=this._shimmedLocalStreams[h].indexOf(u);m!==-1&&this._shimmedLocalStreams[h].splice(m,1),this._shimmedLocalStreams[h].length===1&&delete this._shimmedLocalStreams[h]}),c.apply(this,arguments)}}function lB(t,r){if(!t.RTCPeerConnection)return;if(t.RTCPeerConnection.prototype.addTrack&&r.version>=65)return cB(t);const s=t.RTCPeerConnection.prototype.getLocalStreams;t.RTCPeerConnection.prototype.getLocalStreams=function(){const y=s.apply(this);return this._reverseStreams=this._reverseStreams||{},y.map(v=>this._reverseStreams[v.id])};const a=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(y){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},y.getTracks().forEach(v=>{if(this.getSenders().find(R=>R.track===v))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[y.id]){const v=new t.MediaStream(y.getTracks());this._streams[y.id]=v,this._reverseStreams[v.id]=y,y=v}a.apply(this,[y])};const c=t.RTCPeerConnection.prototype.removeStream;function u(y,v){let S=v.sdp;return Object.keys(y._reverseStreams||[]).forEach(R=>{const P=y._reverseStreams[R],N=y._streams[P.id];S=S.replace(new RegExp(N.id,"g"),P.id)}),new RTCSessionDescription({type:v.type,sdp:S})}t.RTCPeerConnection.prototype.removeStream=function(y){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},c.apply(this,[this._streams[y.id]||y]),delete this._reverseStreams[this._streams[y.id]?this._streams[y.id].id:y.id],delete this._streams[y.id]},t.RTCPeerConnection.prototype.addTrack=function(y,v){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const S=[].slice.call(arguments,1);if(S.length!==1||!S[0].getTracks().find(N=>N===y))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(N=>N.track===y))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const P=this._streams[v.id];if(P)P.addTrack(y),dt.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const N=new t.MediaStream([y]);this._streams[v.id]=N,this._reverseStreams[N.id]=v,this.addStream(N)}return this.getSenders().find(N=>N.track===y)},["createOffer","createAnswer"].forEach(function(y){const v=t.RTCPeerConnection.prototype[y],S={[y](){const R=arguments;return arguments.length&&typeof arguments[0]=="function"?v.apply(this,[P=>{const N=u(this,P);R[0].apply(null,[N])},P=>{R[1]&&R[1].apply(null,P)},arguments[2]]):v.apply(this,arguments).then(P=>u(this,P))}};t.RTCPeerConnection.prototype[y]=S[y]});const h=t.RTCPeerConnection.prototype.setLocalDescription;t.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=function(y,v){let S=v.sdp;return Object.keys(y._reverseStreams||[]).forEach(R=>{const P=y._reverseStreams[R],N=y._streams[P.id];S=S.replace(new RegExp(P.id,"g"),N.id)}),new RTCSessionDescription({type:v.type,sdp:S})}(this,arguments[0]),h.apply(this,arguments)):h.apply(this,arguments)};const m=Object.getOwnPropertyDescriptor(t.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(t.RTCPeerConnection.prototype,"localDescription",{get(){const y=m.get.apply(this);return y.type===""?y:u(this,y)}}),t.RTCPeerConnection.prototype.removeTrack=function(y){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!y._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(y._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let v;this._streams=this._streams||{},Object.keys(this._streams).forEach(S=>{this._streams[S].getTracks().find(R=>y.track===R)&&(v=this._streams[S])}),v&&(v.getTracks().length===1?this.removeStream(this._reverseStreams[v.id]):v.removeTrack(y.track),this.dispatchEvent(new Event("negotiationneeded")))}}function dx(t,r){!t.RTCPeerConnection&&t.webkitRTCPeerConnection&&(t.RTCPeerConnection=t.webkitRTCPeerConnection),t.RTCPeerConnection&&r.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(s){const a=t.RTCPeerConnection.prototype[s],c={[s](){return arguments[0]=new(s==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),a.apply(this,arguments)}};t.RTCPeerConnection.prototype[s]=c[s]})}function uB(t,r){D_(t,"negotiationneeded",s=>{const a=s.target;if(!(r.version<72||a.getConfiguration&&a.getConfiguration().sdpSemantics==="plan-b")||a.signalingState==="stable")return s})}var dB=Object.freeze({__proto__:null,fixNegotiationNeeded:uB,shimAddTrackRemoveTrack:lB,shimAddTrackRemoveTrackWithNative:cB,shimGetDisplayMedia:function(t,r){t.navigator.mediaDevices&&"getDisplayMedia"in t.navigator.mediaDevices||t.navigator.mediaDevices&&(typeof r=="function"?t.navigator.mediaDevices.getDisplayMedia=function(s){return r(s).then(a=>{const c=s.video&&s.video.width,u=s.video&&s.video.height,h=s.video&&s.video.frameRate;return s.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:a,maxFrameRate:h||3}},c&&(s.video.mandatory.maxWidth=c),u&&(s.video.mandatory.maxHeight=u),t.navigator.mediaDevices.getUserMedia(s)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))},shimGetSendersWithDtmf:sB,shimGetStats:oB,shimGetUserMedia:nB,shimMediaStream:rB,shimOnTrack:iB,shimPeerConnection:dx,shimSenderReceiverGetStats:aB});function hB(t,r){const s=t&&t.navigator,a=t&&t.MediaStreamTrack;if(s.getUserMedia=function(c,u,h){lx("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),s.mediaDevices.getUserMedia(c).then(u,h)},!(r.version>55&&"autoGainControl"in s.mediaDevices.getSupportedConstraints())){const c=function(h,m,y){m in h&&!(y in h)&&(h[y]=h[m],delete h[m])},u=s.mediaDevices.getUserMedia.bind(s.mediaDevices);if(s.mediaDevices.getUserMedia=function(h){return typeof h=="object"&&typeof h.audio=="object"&&(h=JSON.parse(JSON.stringify(h)),c(h.audio,"autoGainControl","mozAutoGainControl"),c(h.audio,"noiseSuppression","mozNoiseSuppression")),u(h)},a&&a.prototype.getSettings){const h=a.prototype.getSettings;a.prototype.getSettings=function(){const m=h.apply(this,arguments);return c(m,"mozAutoGainControl","autoGainControl"),c(m,"mozNoiseSuppression","noiseSuppression"),m}}if(a&&a.prototype.applyConstraints){const h=a.prototype.applyConstraints;a.prototype.applyConstraints=function(m){return this.kind==="audio"&&typeof m=="object"&&(m=JSON.parse(JSON.stringify(m)),c(m,"autoGainControl","mozAutoGainControl"),c(m,"noiseSuppression","mozNoiseSuppression")),h.apply(this,[m])}}}}function fB(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function hx(t,r){if(typeof t!="object"||!t.RTCPeerConnection&&!t.mozRTCPeerConnection)return;!t.RTCPeerConnection&&t.mozRTCPeerConnection&&(t.RTCPeerConnection=t.mozRTCPeerConnection),r.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(c){const u=t.RTCPeerConnection.prototype[c],h={[c](){return arguments[0]=new(c==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),u.apply(this,arguments)}};t.RTCPeerConnection.prototype[c]=h[c]});const s={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},a=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){const[c,u,h]=arguments;return a.apply(this,[c||null]).then(m=>{if(r.version<53&&!u)try{m.forEach(y=>{y.type=s[y.type]||y.type})}catch(y){if(y.name!=="TypeError")throw y;m.forEach((v,S)=>{m.set(S,Object.assign({},v,{type:s[v.type]||v.type}))})}return m}).then(u,h)}}function pB(t){if(typeof t!="object"||!t.RTCPeerConnection||!t.RTCRtpSender||t.RTCRtpSender&&"getStats"in t.RTCRtpSender.prototype)return;const r=t.RTCPeerConnection.prototype.getSenders;r&&(t.RTCPeerConnection.prototype.getSenders=function(){const a=r.apply(this,[]);return a.forEach(c=>c._pc=this),a});const s=t.RTCPeerConnection.prototype.addTrack;s&&(t.RTCPeerConnection.prototype.addTrack=function(){const a=s.apply(this,arguments);return a._pc=this,a}),t.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):dt.resolve(new Map)}}function mB(t){if(typeof t!="object"||!t.RTCPeerConnection||!t.RTCRtpSender||t.RTCRtpSender&&"getStats"in t.RTCRtpReceiver.prototype)return;const r=t.RTCPeerConnection.prototype.getReceivers;r&&(t.RTCPeerConnection.prototype.getReceivers=function(){const s=r.apply(this,[]);return s.forEach(a=>a._pc=this),s}),D_(t,"track",s=>(s.receiver._pc=s.srcElement,s)),t.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function gB(t){t.RTCPeerConnection&&!("removeStream"in t.RTCPeerConnection.prototype)&&(t.RTCPeerConnection.prototype.removeStream=function(r){lx("removeStream","removeTrack"),this.getSenders().forEach(s=>{var a;s.track&&ot(a=r.getTracks()).call(a,s.track)&&this.removeTrack(s)})})}function _B(t){t.DataChannel&&!t.RTCDataChannel&&(t.RTCDataChannel=t.DataChannel)}function yB(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const r=t.RTCPeerConnection.prototype.addTransceiver;r&&(t.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let s=arguments[1]&&arguments[1].sendEncodings;s===void 0&&(s=[]),s=[...s];const a=s.length>0;a&&s.forEach(u=>{if("rid"in u&&!/^[a-z0-9]{0,16}$/i.test(u.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in u&&!(parseFloat(u.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in u&&!(parseFloat(u.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const c=r.apply(this,arguments);if(a){const{sender:u}=c,h=u.getParameters();(!("encodings"in h)||h.encodings.length===1&&Object.keys(h.encodings[0]).length===0)&&(h.encodings=s,u.sendEncodings=s,this.setParametersPromises.push(u.setParameters(h).then(()=>{delete u.sendEncodings}).catch(()=>{delete u.sendEncodings})))}return c})}function EB(t){if(typeof t!="object"||!t.RTCRtpSender)return;const r=t.RTCRtpSender.prototype.getParameters;r&&(t.RTCRtpSender.prototype.getParameters=function(){const s=r.apply(this,arguments);return"encodings"in s||(s.encodings=[].concat(this.sendEncodings||[{}])),s})}function vB(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const r=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?dt.all(this.setParametersPromises).then(()=>r.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):r.apply(this,arguments)}}function SB(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const r=t.RTCPeerConnection.prototype.createAnswer;t.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?dt.all(this.setParametersPromises).then(()=>r.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):r.apply(this,arguments)}}var bB=Object.freeze({__proto__:null,shimAddTransceiver:yB,shimCreateAnswer:SB,shimCreateOffer:vB,shimGetDisplayMedia:function(t,r){t.navigator.mediaDevices&&"getDisplayMedia"in t.navigator.mediaDevices||t.navigator.mediaDevices&&(t.navigator.mediaDevices.getDisplayMedia=function(s){if(!s||!s.video){const a=new DOMException("getDisplayMedia without video constraints is undefined");return a.name="NotFoundError",a.code=8,dt.reject(a)}return s.video===!0?s.video={mediaSource:r}:s.video.mediaSource=r,t.navigator.mediaDevices.getUserMedia(s)})},shimGetParameters:EB,shimGetUserMedia:hB,shimOnTrack:fB,shimPeerConnection:hx,shimRTCDataChannel:_B,shimReceiverGetStats:mB,shimRemoveStream:gB,shimSenderGetStats:pB});function TB(t){if(typeof t=="object"&&t.RTCPeerConnection){if("getLocalStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in t.RTCPeerConnection.prototype)){const r=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addStream=function(s){var a;this._localStreams||(this._localStreams=[]),ot(a=this._localStreams).call(a,s)||this._localStreams.push(s),s.getAudioTracks().forEach(c=>r.call(this,c,s)),s.getVideoTracks().forEach(c=>r.call(this,c,s))},t.RTCPeerConnection.prototype.addTrack=function(s){for(var a=arguments.length,c=new Array(a>1?a-1:0),u=1;u<a;u++)c[u-1]=arguments[u];return c&&c.forEach(h=>{var m;this._localStreams?ot(m=this._localStreams).call(m,h)||this._localStreams.push(h):this._localStreams=[h]}),r.apply(this,arguments)}}"removeStream"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.removeStream=function(r){this._localStreams||(this._localStreams=[]);const s=this._localStreams.indexOf(r);if(s===-1)return;this._localStreams.splice(s,1);const a=r.getTracks();this.getSenders().forEach(c=>{ot(a).call(a,c.track)&&this.removeTrack(c)})})}}function wB(t){if(typeof t=="object"&&t.RTCPeerConnection&&("getRemoteStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in t.RTCPeerConnection.prototype))){Object.defineProperty(t.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(s){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=s),this.addEventListener("track",this._onaddstreampoly=a=>{a.streams.forEach(c=>{var u;if(this._remoteStreams||(this._remoteStreams=[]),ot(u=this._remoteStreams).call(u,c))return;this._remoteStreams.push(c);const h=new Event("addstream");h.stream=c,this.dispatchEvent(h)})})}});const r=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){const s=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(a){a.streams.forEach(c=>{if(s._remoteStreams||(s._remoteStreams=[]),s._remoteStreams.indexOf(c)>=0)return;s._remoteStreams.push(c);const u=new Event("addstream");u.stream=c,s.dispatchEvent(u)})}),r.apply(s,arguments)}}}function CB(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const r=t.RTCPeerConnection.prototype,s=r.createOffer,a=r.createAnswer,c=r.setLocalDescription,u=r.setRemoteDescription,h=r.addIceCandidate;r.createOffer=function(y,v){const S=arguments.length>=2?arguments[2]:arguments[0],R=s.apply(this,[S]);return v?(R.then(y,v),dt.resolve()):R},r.createAnswer=function(y,v){const S=arguments.length>=2?arguments[2]:arguments[0],R=a.apply(this,[S]);return v?(R.then(y,v),dt.resolve()):R};let m=function(y,v,S){const R=c.apply(this,[y]);return S?(R.then(v,S),dt.resolve()):R};r.setLocalDescription=m,m=function(y,v,S){const R=u.apply(this,[y]);return S?(R.then(v,S),dt.resolve()):R},r.setRemoteDescription=m,m=function(y,v,S){const R=h.apply(this,[y]);return S?(R.then(v,S),dt.resolve()):R},r.addIceCandidate=m}function RB(t){const r=t&&t.navigator;if(r.mediaDevices&&r.mediaDevices.getUserMedia){const s=r.mediaDevices,a=s.getUserMedia.bind(s);r.mediaDevices.getUserMedia=c=>a(IB(c))}!r.getUserMedia&&r.mediaDevices&&r.mediaDevices.getUserMedia&&(r.getUserMedia=(function(s,a,c){r.mediaDevices.getUserMedia(s).then(a,c)}).bind(r))}function IB(t){return t&&t.video!==void 0?Object.assign({},t,{video:Z5(t.video)}):t}function AB(t){if(!t.RTCPeerConnection)return;const r=t.RTCPeerConnection;t.RTCPeerConnection=function(s,a){if(s&&s.iceServers){const c=[];for(let u=0;u<s.iceServers.length;u++){let h=s.iceServers[u];!h.hasOwnProperty("urls")&&h.hasOwnProperty("url")?(lx("RTCIceServer.url","RTCIceServer.urls"),h=JSON.parse(JSON.stringify(h)),h.urls=h.url,delete h.url,c.push(h)):c.push(s.iceServers[u])}s.iceServers=c}return new r(s,a)},t.RTCPeerConnection.prototype=r.prototype,"generateCertificate"in r&&Object.defineProperty(t.RTCPeerConnection,"generateCertificate",{get:()=>r.generateCertificate})}function PB(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function OB(t){const r=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(s){if(s){s.offerToReceiveAudio!==void 0&&(s.offerToReceiveAudio=!!s.offerToReceiveAudio);const a=this.getTransceivers().find(u=>u.receiver.track.kind==="audio");s.offerToReceiveAudio===!1&&a?a.direction==="sendrecv"?a.setDirection?a.setDirection("sendonly"):a.direction="sendonly":a.direction==="recvonly"&&(a.setDirection?a.setDirection("inactive"):a.direction="inactive"):s.offerToReceiveAudio!==!0||a||this.addTransceiver("audio",{direction:"recvonly"}),s.offerToReceiveVideo!==void 0&&(s.offerToReceiveVideo=!!s.offerToReceiveVideo);const c=this.getTransceivers().find(u=>u.receiver.track.kind==="video");s.offerToReceiveVideo===!1&&c?c.direction==="sendrecv"?c.setDirection?c.setDirection("sendonly"):c.direction="sendonly":c.direction==="recvonly"&&(c.setDirection?c.setDirection("inactive"):c.direction="inactive"):s.offerToReceiveVideo!==!0||c||this.addTransceiver("video",{direction:"recvonly"})}return r.apply(this,arguments)}}function kB(t){typeof t!="object"||t.AudioContext||(t.AudioContext=t.webkitAudioContext)}var NB=Object.freeze({__proto__:null,shimAudioContext:kB,shimCallbacksAPI:CB,shimConstraints:IB,shimCreateOfferLegacy:OB,shimGetUserMedia:RB,shimLocalStreamsAPI:TB,shimRTCIceServerUrls:AB,shimRemoteStreamsAPI:wB,shimTrackEventTransceiver:PB}),DB=`	
\v\f\r \u2028\u2029\uFEFF`,kue=Ht,Nue=Na,fx=DB,xB=I("".replace),Due=RegExp("^["+fx+"]+"),xue=RegExp("(^|[^"+fx+"])["+fx+"]+$"),Lue=function(t){return function(r){var s=Nue(kue(r));return 1&t&&(s=xB(s,Due,"")),2&t&&(s=xB(s,xue,"$1")),s}},Mue={trim:Lue(3)},Uue=_I.PROPER,Vue=d,LB=DB,Fue=Mue.trim;Wn({target:"String",proto:!0,forced:function(t){return Vue(function(){return!!LB[t]()||""[t]()!==""||Uue&&LB[t].name!==t})}("trim")},{trim:function(){return Fue(this)}});var jue=cc("String").trim,Bue=O,Wue=jue,px=String.prototype,zue=function(t){var r=t.trim;return typeof t=="string"||t===px||Bue(px,t)&&r===px.trim?Wue:r},po=l(zue),MB={exports:{}};(function(t){const r={generateIdentifier:function(){return Math.random().toString(36).substring(2,12)}};r.localCName=r.generateIdentifier(),r.splitLines=function(s){return s.trim().split(`
`).map(a=>a.trim())},r.splitSections=function(s){return s.split(`
m=`).map((a,c)=>(c>0?"m="+a:a).trim()+`\r
`)},r.getDescription=function(s){const a=r.splitSections(s);return a&&a[0]},r.getMediaSections=function(s){const a=r.splitSections(s);return a.shift(),a},r.matchPrefix=function(s,a){return r.splitLines(s).filter(c=>c.indexOf(a)===0)},r.parseCandidate=function(s){let a;a=s.indexOf("a=candidate:")===0?s.substring(12).split(" "):s.substring(10).split(" ");const c={foundation:a[0],component:{1:"rtp",2:"rtcp"}[a[1]]||a[1],protocol:a[2].toLowerCase(),priority:parseInt(a[3],10),ip:a[4],address:a[4],port:parseInt(a[5],10),type:a[7]};for(let u=8;u<a.length;u+=2)switch(a[u]){case"raddr":c.relatedAddress=a[u+1];break;case"rport":c.relatedPort=parseInt(a[u+1],10);break;case"tcptype":c.tcpType=a[u+1];break;case"ufrag":c.ufrag=a[u+1],c.usernameFragment=a[u+1];break;default:c[a[u]]===void 0&&(c[a[u]]=a[u+1])}return c},r.writeCandidate=function(s){const a=[];a.push(s.foundation);const c=s.component;c==="rtp"?a.push(1):c==="rtcp"?a.push(2):a.push(c),a.push(s.protocol.toUpperCase()),a.push(s.priority),a.push(s.address||s.ip),a.push(s.port);const u=s.type;return a.push("typ"),a.push(u),u!=="host"&&s.relatedAddress&&s.relatedPort&&(a.push("raddr"),a.push(s.relatedAddress),a.push("rport"),a.push(s.relatedPort)),s.tcpType&&s.protocol.toLowerCase()==="tcp"&&(a.push("tcptype"),a.push(s.tcpType)),(s.usernameFragment||s.ufrag)&&(a.push("ufrag"),a.push(s.usernameFragment||s.ufrag)),"candidate:"+a.join(" ")},r.parseIceOptions=function(s){return s.substring(14).split(" ")},r.parseRtpMap=function(s){let a=s.substring(9).split(" ");const c={payloadType:parseInt(a.shift(),10)};return a=a[0].split("/"),c.name=a[0],c.clockRate=parseInt(a[1],10),c.channels=a.length===3?parseInt(a[2],10):1,c.numChannels=c.channels,c},r.writeRtpMap=function(s){let a=s.payloadType;s.preferredPayloadType!==void 0&&(a=s.preferredPayloadType);const c=s.channels||s.numChannels||1;return"a=rtpmap:"+a+" "+s.name+"/"+s.clockRate+(c!==1?"/"+c:"")+`\r
`},r.parseExtmap=function(s){const a=s.substring(9).split(" ");return{id:parseInt(a[0],10),direction:a[0].indexOf("/")>0?a[0].split("/")[1]:"sendrecv",uri:a[1],attributes:a.slice(2).join(" ")}},r.writeExtmap=function(s){return"a=extmap:"+(s.id||s.preferredId)+(s.direction&&s.direction!=="sendrecv"?"/"+s.direction:"")+" "+s.uri+(s.attributes?" "+s.attributes:"")+`\r
`},r.parseFmtp=function(s){const a={};let c;const u=s.substring(s.indexOf(" ")+1).split(";");for(let h=0;h<u.length;h++)c=u[h].trim().split("="),a[c[0].trim()]=c[1];return a},r.writeFmtp=function(s){let a="",c=s.payloadType;if(s.preferredPayloadType!==void 0&&(c=s.preferredPayloadType),s.parameters&&Object.keys(s.parameters).length){const u=[];Object.keys(s.parameters).forEach(h=>{s.parameters[h]!==void 0?u.push(h+"="+s.parameters[h]):u.push(h)}),a+="a=fmtp:"+c+" "+u.join(";")+`\r
`}return a},r.parseRtcpFb=function(s){const a=s.substring(s.indexOf(" ")+1).split(" ");return{type:a.shift(),parameter:a.join(" ")}},r.writeRtcpFb=function(s){let a="",c=s.payloadType;return s.preferredPayloadType!==void 0&&(c=s.preferredPayloadType),s.rtcpFeedback&&s.rtcpFeedback.length&&s.rtcpFeedback.forEach(u=>{a+="a=rtcp-fb:"+c+" "+u.type+(u.parameter&&u.parameter.length?" "+u.parameter:"")+`\r
`}),a},r.parseSsrcMedia=function(s){const a=s.indexOf(" "),c={ssrc:parseInt(s.substring(7,a),10)},u=s.indexOf(":",a);return u>-1?(c.attribute=s.substring(a+1,u),c.value=s.substring(u+1)):c.attribute=s.substring(a+1),c},r.parseSsrcGroup=function(s){const a=s.substring(13).split(" ");return{semantics:a.shift(),ssrcs:a.map(c=>parseInt(c,10))}},r.getMid=function(s){const a=r.matchPrefix(s,"a=mid:")[0];if(a)return a.substring(6)},r.parseFingerprint=function(s){const a=s.substring(14).split(" ");return{algorithm:a[0].toLowerCase(),value:a[1].toUpperCase()}},r.getDtlsParameters=function(s,a){return{role:"auto",fingerprints:r.matchPrefix(s+a,"a=fingerprint:").map(r.parseFingerprint)}},r.writeDtlsParameters=function(s,a){let c="a=setup:"+a+`\r
`;return s.fingerprints.forEach(u=>{c+="a=fingerprint:"+u.algorithm+" "+u.value+`\r
`}),c},r.parseCryptoLine=function(s){const a=s.substring(9).split(" ");return{tag:parseInt(a[0],10),cryptoSuite:a[1],keyParams:a[2],sessionParams:a.slice(3)}},r.writeCryptoLine=function(s){return"a=crypto:"+s.tag+" "+s.cryptoSuite+" "+(typeof s.keyParams=="object"?r.writeCryptoKeyParams(s.keyParams):s.keyParams)+(s.sessionParams?" "+s.sessionParams.join(" "):"")+`\r
`},r.parseCryptoKeyParams=function(s){if(s.indexOf("inline:")!==0)return null;const a=s.substring(7).split("|");return{keyMethod:"inline",keySalt:a[0],lifeTime:a[1],mkiValue:a[2]?a[2].split(":")[0]:void 0,mkiLength:a[2]?a[2].split(":")[1]:void 0}},r.writeCryptoKeyParams=function(s){return s.keyMethod+":"+s.keySalt+(s.lifeTime?"|"+s.lifeTime:"")+(s.mkiValue&&s.mkiLength?"|"+s.mkiValue+":"+s.mkiLength:"")},r.getCryptoParameters=function(s,a){return r.matchPrefix(s+a,"a=crypto:").map(r.parseCryptoLine)},r.getIceParameters=function(s,a){const c=r.matchPrefix(s+a,"a=ice-ufrag:")[0],u=r.matchPrefix(s+a,"a=ice-pwd:")[0];return c&&u?{usernameFragment:c.substring(12),password:u.substring(10)}:null},r.writeIceParameters=function(s){let a="a=ice-ufrag:"+s.usernameFragment+`\r
a=ice-pwd:`+s.password+`\r
`;return s.iceLite&&(a+=`a=ice-lite\r
`),a},r.parseRtpParameters=function(s){const a={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},c=r.splitLines(s)[0].split(" ");a.profile=c[2];for(let h=3;h<c.length;h++){const m=c[h],y=r.matchPrefix(s,"a=rtpmap:"+m+" ")[0];if(y){const v=r.parseRtpMap(y),S=r.matchPrefix(s,"a=fmtp:"+m+" ");switch(v.parameters=S.length?r.parseFmtp(S[0]):{},v.rtcpFeedback=r.matchPrefix(s,"a=rtcp-fb:"+m+" ").map(r.parseRtcpFb),a.codecs.push(v),v.name.toUpperCase()){case"RED":case"ULPFEC":a.fecMechanisms.push(v.name.toUpperCase())}}}r.matchPrefix(s,"a=extmap:").forEach(h=>{a.headerExtensions.push(r.parseExtmap(h))});const u=r.matchPrefix(s,"a=rtcp-fb:* ").map(r.parseRtcpFb);return a.codecs.forEach(h=>{u.forEach(m=>{h.rtcpFeedback.find(y=>y.type===m.type&&y.parameter===m.parameter)||h.rtcpFeedback.push(m)})}),a},r.writeRtpDescription=function(s,a){let c="";c+="m="+s+" ",c+=a.codecs.length>0?"9":"0",c+=" "+(a.profile||"UDP/TLS/RTP/SAVPF")+" ",c+=a.codecs.map(h=>h.preferredPayloadType!==void 0?h.preferredPayloadType:h.payloadType).join(" ")+`\r
`,c+=`c=IN IP4 0.0.0.0\r
`,c+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,a.codecs.forEach(h=>{c+=r.writeRtpMap(h),c+=r.writeFmtp(h),c+=r.writeRtcpFb(h)});let u=0;return a.codecs.forEach(h=>{h.maxptime>u&&(u=h.maxptime)}),u>0&&(c+="a=maxptime:"+u+`\r
`),a.headerExtensions&&a.headerExtensions.forEach(h=>{c+=r.writeExtmap(h)}),c},r.parseRtpEncodingParameters=function(s){const a=[],c=r.parseRtpParameters(s),u=c.fecMechanisms.indexOf("RED")!==-1,h=c.fecMechanisms.indexOf("ULPFEC")!==-1,m=r.matchPrefix(s,"a=ssrc:").map(P=>r.parseSsrcMedia(P)).filter(P=>P.attribute==="cname"),y=m.length>0&&m[0].ssrc;let v;const S=r.matchPrefix(s,"a=ssrc-group:FID").map(P=>P.substring(17).split(" ").map(N=>parseInt(N,10)));S.length>0&&S[0].length>1&&S[0][0]===y&&(v=S[0][1]),c.codecs.forEach(P=>{if(P.name.toUpperCase()==="RTX"&&P.parameters.apt){let N={ssrc:y,codecPayloadType:parseInt(P.parameters.apt,10)};y&&v&&(N.rtx={ssrc:v}),a.push(N),u&&(N=JSON.parse(JSON.stringify(N)),N.fec={ssrc:y,mechanism:h?"red+ulpfec":"red"},a.push(N))}}),a.length===0&&y&&a.push({ssrc:y});let R=r.matchPrefix(s,"b=");return R.length&&(R=R[0].indexOf("b=TIAS:")===0?parseInt(R[0].substring(7),10):R[0].indexOf("b=AS:")===0?1e3*parseInt(R[0].substring(5),10)*.95-16e3:void 0,a.forEach(P=>{P.maxBitrate=R})),a},r.parseRtcpParameters=function(s){const a={},c=r.matchPrefix(s,"a=ssrc:").map(m=>r.parseSsrcMedia(m)).filter(m=>m.attribute==="cname")[0];c&&(a.cname=c.value,a.ssrc=c.ssrc);const u=r.matchPrefix(s,"a=rtcp-rsize");a.reducedSize=u.length>0,a.compound=u.length===0;const h=r.matchPrefix(s,"a=rtcp-mux");return a.mux=h.length>0,a},r.writeRtcpParameters=function(s){let a="";return s.reducedSize&&(a+=`a=rtcp-rsize\r
`),s.mux&&(a+=`a=rtcp-mux\r
`),s.ssrc!==void 0&&s.cname&&(a+="a=ssrc:"+s.ssrc+" cname:"+s.cname+`\r
`),a},r.parseMsid=function(s){let a;const c=r.matchPrefix(s,"a=msid:");if(c.length===1)return a=c[0].substring(7).split(" "),{stream:a[0],track:a[1]};const u=r.matchPrefix(s,"a=ssrc:").map(h=>r.parseSsrcMedia(h)).filter(h=>h.attribute==="msid");return u.length>0?(a=u[0].value.split(" "),{stream:a[0],track:a[1]}):void 0},r.parseSctpDescription=function(s){const a=r.parseMLine(s),c=r.matchPrefix(s,"a=max-message-size:");let u;c.length>0&&(u=parseInt(c[0].substring(19),10)),isNaN(u)&&(u=65536);const h=r.matchPrefix(s,"a=sctp-port:");if(h.length>0)return{port:parseInt(h[0].substring(12),10),protocol:a.fmt,maxMessageSize:u};const m=r.matchPrefix(s,"a=sctpmap:");if(m.length>0){const y=m[0].substring(10).split(" ");return{port:parseInt(y[0],10),protocol:y[1],maxMessageSize:u}}},r.writeSctpDescription=function(s,a){let c=[];return c=s.protocol!=="DTLS/SCTP"?["m="+s.kind+" 9 "+s.protocol+" "+a.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+a.port+`\r
`]:["m="+s.kind+" 9 "+s.protocol+" "+a.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+a.port+" "+a.protocol+` 65535\r
`],a.maxMessageSize!==void 0&&c.push("a=max-message-size:"+a.maxMessageSize+`\r
`),c.join("")},r.generateSessionId=function(){return Math.random().toString().substr(2,22)},r.writeSessionBoilerplate=function(s,a,c){let u;const h=a!==void 0?a:2;return u=s||r.generateSessionId(),`v=0\r
o=`+(c||"thisisadapterortc")+" "+u+" "+h+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},r.getDirection=function(s,a){const c=r.splitLines(s);for(let u=0;u<c.length;u++)switch(c[u]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return c[u].substring(2)}return a?r.getDirection(a):"sendrecv"},r.getKind=function(s){return r.splitLines(s)[0].split(" ")[0].substring(2)},r.isRejected=function(s){return s.split(" ",2)[1]==="0"},r.parseMLine=function(s){const a=r.splitLines(s)[0].substring(2).split(" ");return{kind:a[0],port:parseInt(a[1],10),protocol:a[2],fmt:a.slice(3).join(" ")}},r.parseOLine=function(s){const a=r.matchPrefix(s,"o=")[0].substring(2).split(" ");return{username:a[0],sessionId:a[1],sessionVersion:parseInt(a[2],10),netType:a[3],addressType:a[4],address:a[5]}},r.isValidSDP=function(s){if(typeof s!="string"||s.length===0)return!1;const a=r.splitLines(s);for(let c=0;c<a.length;c++)if(a[c].length<2||a[c].charAt(1)!=="=")return!1;return!0},t.exports=r})(MB);var UB=MB.exports,Ov=l(UB),Gue=i({__proto__:null,default:Ov},[UB]);function dA(t){if(!t.RTCIceCandidate||t.RTCIceCandidate&&"foundation"in t.RTCIceCandidate.prototype)return;const r=t.RTCIceCandidate;t.RTCIceCandidate=function(s){if(typeof s=="object"&&s.candidate&&s.candidate.indexOf("a=")===0&&((s=JSON.parse(JSON.stringify(s))).candidate=s.candidate.substr(2)),s.candidate&&s.candidate.length){const a=new r(s),c=Ov.parseCandidate(s.candidate),u=Object.assign(a,c);return u.toJSON=function(){return{candidate:u.candidate,sdpMid:u.sdpMid,sdpMLineIndex:u.sdpMLineIndex,usernameFragment:u.usernameFragment}},u}return new r(s)},t.RTCIceCandidate.prototype=r.prototype,D_(t,"icecandidate",s=>(s.candidate&&Object.defineProperty(s,"candidate",{value:new t.RTCIceCandidate(s.candidate),writable:"false"}),s))}function mx(t){!t.RTCIceCandidate||t.RTCIceCandidate&&"relayProtocol"in t.RTCIceCandidate.prototype||D_(t,"icecandidate",r=>{if(r.candidate){const s=Ov.parseCandidate(r.candidate.candidate);s.type==="relay"&&(r.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[s.priority>>24])}return r})}function hA(t,r){if(!t.RTCPeerConnection)return;"sctp"in t.RTCPeerConnection.prototype||Object.defineProperty(t.RTCPeerConnection.prototype,"sctp",{get(){return this._sctp===void 0?null:this._sctp}});const s=function(m){if(!m||!m.sdp)return!1;const y=Ov.splitSections(m.sdp);return y.shift(),y.some(v=>{const S=Ov.parseMLine(v);return S&&S.kind==="application"&&S.protocol.indexOf("SCTP")!==-1})},a=function(m){const y=m.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(y===null||y.length<2)return-1;const v=parseInt(y[1],10);return v!=v?-1:v},c=function(m){let y=65536;return r.browser==="firefox"&&(y=r.version<57?m===-1?16384:2147483637:r.version<60?r.version===57?65535:65536:2147483637),y},u=function(m,y){let v=65536;r.browser==="firefox"&&r.version===57&&(v=65535);const S=Ov.matchPrefix(m.sdp,"a=max-message-size:");return S.length>0?v=parseInt(S[0].substr(19),10):r.browser==="firefox"&&y!==-1&&(v=2147483637),v},h=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,r.browser==="chrome"&&r.version>=76){const{sdpSemantics:m}=this.getConfiguration();m==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return this._sctp===void 0?null:this._sctp},enumerable:!0,configurable:!0})}if(s(arguments[0])){const m=a(arguments[0]),y=c(m),v=u(arguments[0],m);let S;S=y===0&&v===0?Number.POSITIVE_INFINITY:y===0||v===0?Math.max(y,v):Math.min(y,v);const R={};Object.defineProperty(R,"maxMessageSize",{get:()=>S}),this._sctp=R}return h.apply(this,arguments)}}function fA(t){if(!t.RTCPeerConnection||!("createDataChannel"in t.RTCPeerConnection.prototype))return;function r(a,c){const u=a.send;a.send=function(){const h=arguments[0],m=h.length||h.size||h.byteLength;if(a.readyState==="open"&&c.sctp&&m>c.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+c.sctp.maxMessageSize+" bytes)");return u.apply(a,arguments)}}const s=t.RTCPeerConnection.prototype.createDataChannel;t.RTCPeerConnection.prototype.createDataChannel=function(){const a=s.apply(this,arguments);return r(a,this),a},D_(t,"datachannel",a=>(r(a.channel,a.target),a))}function gx(t){if(!t.RTCPeerConnection||"connectionState"in t.RTCPeerConnection.prototype)return;const r=t.RTCPeerConnection.prototype;Object.defineProperty(r,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(r,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(s){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),s&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=s)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(s=>{const a=r[s];r[s]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=c=>{const u=c.target;if(u._lastConnectionState!==u.connectionState){u._lastConnectionState=u.connectionState;const h=new Event("connectionstatechange",c);u.dispatchEvent(h)}return c},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),a.apply(this,arguments)}})}function _x(t,r){if(!t.RTCPeerConnection||r.browser==="chrome"&&r.version>=71||r.browser==="safari"&&r.version>=605)return;const s=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(a){if(a&&a.sdp&&a.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const c=a.sdp.split(`
`).filter(u=>po(u).call(u)!=="a=extmap-allow-mixed").join(`
`);t.RTCSessionDescription&&a instanceof t.RTCSessionDescription?arguments[0]=new t.RTCSessionDescription({type:a.type,sdp:c}):a.sdp=c}return s.apply(this,arguments)}}function pA(t,r){if(!t.RTCPeerConnection||!t.RTCPeerConnection.prototype)return;const s=t.RTCPeerConnection.prototype.addIceCandidate;s&&s.length!==0&&(t.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(r.browser==="chrome"&&r.version<78||r.browser==="firefox"&&r.version<68||r.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?dt.resolve():s.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),dt.resolve())})}function mA(t,r){if(!t.RTCPeerConnection||!t.RTCPeerConnection.prototype)return;const s=t.RTCPeerConnection.prototype.setLocalDescription;s&&s.length!==0&&(t.RTCPeerConnection.prototype.setLocalDescription=function(){let a=arguments[0]||{};if(typeof a!="object"||a.type&&a.sdp)return s.apply(this,arguments);if(a={type:a.type,sdp:a.sdp},!a.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":a.type="offer";break;default:a.type="answer"}return a.sdp||a.type!=="offer"&&a.type!=="answer"?s.apply(this,[a]):(a.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(c=>s.apply(this,[c]))})}var Hue=Object.freeze({__proto__:null,removeExtmapAllowMixed:_x,shimAddIceCandidateNullOrEmpty:pA,shimConnectionState:gx,shimMaxMessageSize:hA,shimParameterlessSetLocalDescription:mA,shimRTCIceCandidate:dA,shimRTCIceCandidateRelayProtocol:mx,shimSendThrowTypeError:fA});(function(){let{window:t}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0};const s=J5,a=function(u){const h={browser:null,version:null};if(u===void 0||!u.navigator)return h.browser="Not a browser.",h;const{navigator:m}=u;if(m.mozGetUserMedia)h.browser="firefox",h.version=uA(m.userAgent,/Firefox\/(\d+)\./,1);else if(m.webkitGetUserMedia||u.isSecureContext===!1&&u.webkitRTCPeerConnection)h.browser="chrome",h.version=uA(m.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!u.RTCPeerConnection||!m.userAgent.match(/AppleWebKit\/(\d+)\./))return h.browser="Not a supported browser.",h;h.browser="safari",h.version=uA(m.userAgent,/AppleWebKit\/(\d+)\./,1),h.supportsUnifiedPlan=u.RTCRtpTransceiver&&"currentDirection"in u.RTCRtpTransceiver.prototype}return h}(t),c={browserDetails:a,commonShim:Hue,extractVersion:uA,disableLog:Pue,disableWarnings:Oue,sdp:Gue};switch(a.browser){case"chrome":if(!dB||!dx||!r.shimChrome)return s("Chrome shim is not included in this adapter release."),c;if(a.version===null)return s("Chrome shim can not determine version, not shimming."),c;s("adapter.js shimming chrome."),c.browserShim=dB,pA(t,a),mA(t),nB(t,a),rB(t),dx(t,a),iB(t),lB(t,a),sB(t),oB(t),aB(t),uB(t,a),dA(t),mx(t),gx(t),hA(t,a),fA(t),_x(t,a);break;case"firefox":if(!bB||!hx||!r.shimFirefox)return s("Firefox shim is not included in this adapter release."),c;s("adapter.js shimming firefox."),c.browserShim=bB,pA(t,a),mA(t),hB(t,a),hx(t,a),fB(t),gB(t),pB(t),mB(t),_B(t),yB(t),EB(t),vB(t),SB(t),dA(t),gx(t),hA(t,a),fA(t);break;case"safari":if(!NB||!r.shimSafari)return s("Safari shim is not included in this adapter release."),c;s("adapter.js shimming safari."),c.browserShim=NB,pA(t,a),mA(t),AB(t),OB(t),CB(t),TB(t),wB(t),PB(t),RB(t),kB(t),dA(t),mx(t),hA(t,a),fA(t),_x(t,a);break;default:s("Unsupported browser!")}})({window:typeof window>"u"?void 0:window});var VB=Es,$ue=TypeError,FB=wt.match(/firefox\/(\d+)/i),Kue=!!FB&&+FB[1],que=/MSIE|Trident/.test(wt),jB=wt.match(/AppleWebKit\/(\d+)\./),Yue=!!jB&&+jB[1],Xue=Wn,BB=I,Jue=vs,Que=$o,WB=gi,Zue=function(t,r){if(!delete t[r])throw $ue("Cannot delete property "+VB(r)+" of "+VB(t))},zB=Na,yx=d,ede=Z3,tde=Of,GB=Kue,nde=que,HB=ai,$B=Yue,Um=[],KB=BB(Um.sort),rde=BB(Um.push),ide=yx(function(){Um.sort(void 0)}),sde=yx(function(){Um.sort(null)}),ode=tde("sort"),qB=!yx(function(){if(HB)return HB<70;if(!(GB&&GB>3)){if(nde)return!0;if($B)return $B<603;var t,r,s,a,c="";for(t=65;t<76;t++){switch(r=String.fromCharCode(t),t){case 66:case 69:case 70:case 72:s=3;break;case 68:case 71:s=4;break;default:s=2}for(a=0;a<47;a++)Um.push({k:r+a,v:s})}for(Um.sort(function(u,h){return h.v-u.v}),a=0;a<Um.length;a++)r=Um[a].k.charAt(0),c.charAt(c.length-1)!==r&&(c+=r);return c!=="DGBEFHACIJK"}});Xue({target:"Array",proto:!0,forced:ide||!sde||!ode||!qB},{sort:function(t){t!==void 0&&Jue(t);var r=Que(this);if(qB)return t===void 0?KB(r):KB(r,t);var s,a,c=[],u=WB(r);for(a=0;a<u;a++)a in r&&rde(c,r[a]);for(ede(c,function(h){return function(m,y){return y===void 0?-1:m===void 0?1:h!==void 0?+h(m,y)||0:zB(m)>zB(y)?1:-1}}(t)),s=WB(c),a=0;a<s;)r[a]=c[a++];for(;a<u;)Zue(r,a++);return r}});var ade=cc("Array").sort,cde=O,lde=ade,Ex=Array.prototype,ude=function(t){var r=t.sort;return t===Ex||cde(Ex,t)&&r===Ex.sort?lde:r},uT=l(ude),vx=V;Wn({global:!0,forced:vx.globalThis!==vx},{globalThis:vx});var YB=l(V),Sx={exports:{}};(function(t,r){(function(s,a){var c="function",u="undefined",h="object",m="string",y="major",v="model",S="name",R="type",P="vendor",N="version",G="architecture",F="console",j="mobile",X="tablet",ee="smarttv",he="wearable",Se="embedded",Te="Amazon",ye="Apple",Ne="ASUS",Ye="BlackBerry",ht="Browser",mt="Chrome",Tn="Firefox",wn="Google",fr="Huawei",ui="LG",Xr="Microsoft",ma="Motorola",je="Opera",st="Samsung",Ct="Sharp",He="Sony",M="Xiaomi",ae="Zebra",fe="Facebook",Qe="Chromium OS",Jt="Mac OS",sr=function(ki){for(var Zi={},Rr=0;Rr<ki.length;Rr++)Zi[ki[Rr].toUpperCase()]=ki[Rr];return Zi},Qi=function(ki,Zi){return typeof ki===m&&Ha(Zi).indexOf(Ha(ki))!==-1},Ha=function(ki){return ki.toLowerCase()},gp=function(ki,Zi){if(typeof ki===m)return ki=ki.replace(/^\s\s*/,""),typeof Zi===u?ki:ki.substring(0,350)},uy=function(ki,Zi){for(var Rr,yc,Mh,di,Hn,$a,sg=0;sg<Zi.length&&!Hn;){var Rd=Zi[sg],bK=Zi[sg+1];for(Rr=yc=0;Rr<Rd.length&&!Hn&&Rd[Rr];)if(Hn=Rd[Rr++].exec(ki))for(Mh=0;Mh<bK.length;Mh++)$a=Hn[++yc],typeof(di=bK[Mh])===h&&di.length>0?di.length===2?typeof di[1]==c?this[di[0]]=di[1].call(this,$a):this[di[0]]=di[1]:di.length===3?typeof di[1]!==c||di[1].exec&&di[1].test?this[di[0]]=$a?$a.replace(di[1],di[2]):a:this[di[0]]=$a?di[1].call(this,$a,di[2]):a:di.length===4&&(this[di[0]]=$a?di[3].call(this,$a.replace(di[1],di[2])):a):this[di]=$a||a;sg+=2}},fw=function(ki,Zi){for(var Rr in Zi)if(typeof Zi[Rr]===h&&Zi[Rr].length>0){for(var yc=0;yc<Zi[Rr].length;yc++)if(Qi(Zi[Rr][yc],ki))return Rr==="?"?a:Rr}else if(Qi(Zi[Rr],ki))return Rr==="?"?a:Rr;return ki},hO={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},fO={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[N,[S,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[N,[S,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[S,N],[/opios[\/ ]+([\w\.]+)/i],[N,[S,je+" Mini"]],[/\bopr\/([\w\.]+)/i],[N,[S,je]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/ ]?([\w\.]*)/i,/(avant |iemobile|slim)(?:browser)?[\/ ]?([\w\.]*)/i,/(ba?idubrowser)[\/ ]?([\w\.]+)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|qq|duckduckgo)\/([-\w\.]+)/i,/(weibo)__([\d\.]+)/i],[S,N],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[N,[S,"UC"+ht]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i],[N,[S,"WeChat(Win) Desktop"]],[/micromessenger\/([\w\.]+)/i],[N,[S,"WeChat"]],[/konqueror\/([\w\.]+)/i],[N,[S,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[N,[S,"IE"]],[/yabrowser\/([\w\.]+)/i],[N,[S,"Yandex"]],[/(avast|avg)\/([\w\.]+)/i],[[S,/(.+)/,"$1 Secure "+ht],N],[/\bfocus\/([\w\.]+)/i],[N,[S,Tn+" Focus"]],[/\bopt\/([\w\.]+)/i],[N,[S,je+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[N,[S,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[N,[S,"Dolphin"]],[/coast\/([\w\.]+)/i],[N,[S,je+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[N,[S,"MIUI "+ht]],[/fxios\/([-\w\.]+)/i],[N,[S,Tn]],[/\bqihu|(qi?ho?o?|360)browser/i],[[S,"360 "+ht]],[/(oculus|samsung|sailfish|huawei)browser\/([\w\.]+)/i],[[S,/(.+)/,"$1 "+ht],N],[/(comodo_dragon)\/([\w\.]+)/i],[[S,/_/g," "],N],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|baiduboxapp|2345Explorer)[\/ ]?([\w\.]+)/i],[S,N],[/(metasr)[\/ ]?([\w\.]+)/i,/(lbbrowser)/i,/\[(linkedin)app\]/i],[S],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[S,fe],N],[/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(chromium|instagram)[\/ ]([-\w\.]+)/i],[S,N],[/\bgsa\/([\w\.]+) .*safari\//i],[N,[S,"GSA"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[N,[S,mt+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[S,mt+" WebView"],N],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[N,[S,"Android "+ht]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[S,N],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[N,[S,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[N,S],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[S,[N,fw,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[S,N],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[S,"Netscape"],N],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[N,[S,Tn+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror|klar)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i,/panasonic;(viera)/i],[S,N],[/(cobalt)\/([\w\.]+)/i],[S,[N,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[G,"amd64"]],[/(ia32(?=;))/i],[[G,Ha]],[/((?:i[346]|x)86)[;\)]/i],[[G,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[G,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[G,"armhf"]],[/windows (ce|mobile); ppc;/i],[[G,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[G,/ower/,"",Ha]],[/(sun4\w)[;\)]/i],[[G,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[G,Ha]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[v,[P,st],[R,X]],[/\b((?:s[cgp]h|gt|sm)-\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]([-\w]+)/i,/sec-(sgh\w+)/i],[v,[P,st],[R,j]],[/\((ip(?:hone|od)[\w ]*);/i],[v,[P,ye],[R,j]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[v,[P,ye],[R,X]],[/(macintosh);/i],[v,[P,ye]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[v,[P,Ct],[R,j]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[v,[P,fr],[R,X]],[/(?:huawei|honor)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[v,[P,fr],[R,j]],[/\b(poco[\w ]+)(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite)?)(?: bui|\))/i],[[v,/_/g," "],[P,M],[R,j]],[/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[v,/_/g," "],[P,M],[R,X]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[v,[P,"OPPO"],[R,j]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[v,[P,"Vivo"],[R,j]],[/\b(rmx[12]\d{3})(?: bui|;|\))/i],[v,[P,"Realme"],[R,j]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[v,[P,ma],[R,j]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[v,[P,ma],[R,X]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[v,[P,ui],[R,X]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[v,[P,ui],[R,j]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[v,[P,"Lenovo"],[R,X]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[v,/_/g," "],[P,"Nokia"],[R,j]],[/(pixel c)\b/i],[v,[P,wn],[R,X]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[v,[P,wn],[R,j]],[/droid.+ (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[v,[P,He],[R,j]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[v,"Xperia Tablet"],[P,He],[R,X]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[v,[P,"OnePlus"],[R,j]],[/(alexa)webm/i,/(kf[a-z]{2}wi)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[v,[P,Te],[R,X]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[v,/(.+)/g,"Fire Phone $1"],[P,Te],[R,j]],[/(playbook);[-\w\),; ]+(rim)/i],[v,P,[R,X]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[v,[P,Ye],[R,j]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[v,[P,Ne],[R,X]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[v,[P,Ne],[R,j]],[/(nexus 9)/i],[v,[P,"HTC"],[R,X]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[P,[v,/_/g," "],[R,j]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[v,[P,"Acer"],[R,X]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[v,[P,"Meizu"],[R,j]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[-_ ]?([-\w]*)/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[P,v,[R,j]],[/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[P,v,[R,X]],[/(surface duo)/i],[v,[P,Xr],[R,X]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[v,[P,"Fairphone"],[R,j]],[/(u304aa)/i],[v,[P,"AT&T"],[R,j]],[/\bsie-(\w*)/i],[v,[P,"Siemens"],[R,j]],[/\b(rct\w+) b/i],[v,[P,"RCA"],[R,X]],[/\b(venue[\d ]{2,7}) b/i],[v,[P,"Dell"],[R,X]],[/\b(q(?:mv|ta)\w+) b/i],[v,[P,"Verizon"],[R,X]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[v,[P,"Barnes & Noble"],[R,X]],[/\b(tm\d{3}\w+) b/i],[v,[P,"NuVision"],[R,X]],[/\b(k88) b/i],[v,[P,"ZTE"],[R,X]],[/\b(nx\d{3}j) b/i],[v,[P,"ZTE"],[R,j]],[/\b(gen\d{3}) b.+49h/i],[v,[P,"Swiss"],[R,j]],[/\b(zur\d{3}) b/i],[v,[P,"Swiss"],[R,X]],[/\b((zeki)?tb.*\b) b/i],[v,[P,"Zeki"],[R,X]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[P,"Dragon Touch"],v,[R,X]],[/\b(ns-?\w{0,9}) b/i],[v,[P,"Insignia"],[R,X]],[/\b((nxa|next)-?\w{0,9}) b/i],[v,[P,"NextBook"],[R,X]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[P,"Voice"],v,[R,j]],[/\b(lvtel\-)?(v1[12]) b/i],[[P,"LvTel"],v,[R,j]],[/\b(ph-1) /i],[v,[P,"Essential"],[R,j]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[v,[P,"Envizen"],[R,X]],[/\b(trio[-\w\. ]+) b/i],[v,[P,"MachSpeed"],[R,X]],[/\btu_(1491) b/i],[v,[P,"Rotor"],[R,X]],[/(shield[\w ]+) b/i],[v,[P,"Nvidia"],[R,X]],[/(sprint) (\w+)/i],[P,v,[R,j]],[/(kin\.[onetw]{3})/i],[[v,/\./g," "],[P,Xr],[R,j]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[v,[P,ae],[R,X]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[v,[P,ae],[R,j]],[/smart-tv.+(samsung)/i],[P,[R,ee]],[/hbbtv.+maple;(\d+)/i],[[v,/^/,"SmartTV"],[P,st],[R,ee]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[P,ui],[R,ee]],[/(apple) ?tv/i],[P,[v,ye+" TV"],[R,ee]],[/crkey/i],[[v,mt+"cast"],[P,wn],[R,ee]],[/droid.+aft(\w)( bui|\))/i],[v,[P,Te],[R,ee]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[v,[P,Ct],[R,ee]],[/(bravia[\w ]+)( bui|\))/i],[v,[P,He],[R,ee]],[/(mitv-\w{5}) bui/i],[v,[P,M],[R,ee]],[/Hbbtv.*(technisat) (.*);/i],[P,v,[R,ee]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[P,gp],[v,gp],[R,ee]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[R,ee]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[P,v,[R,F]],[/droid.+; (shield) bui/i],[v,[P,"Nvidia"],[R,F]],[/(playstation [345portablevi]+)/i],[v,[P,He],[R,F]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[v,[P,Xr],[R,F]],[/((pebble))app/i],[P,v,[R,he]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[v,[P,ye],[R,he]],[/droid.+; (glass) \d/i],[v,[P,wn],[R,he]],[/droid.+; (wt63?0{2,3})\)/i],[v,[P,ae],[R,he]],[/(quest( 2| pro)?)/i],[v,[P,fe],[R,he]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[P,[R,Se]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+? mobile safari/i],[v,[R,j]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[v,[R,X]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[R,X]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[R,j]],[/(android[-\w\. ]{0,9});.+buil/i],[v,[P,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[N,[S,"EdgeHTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[N,[S,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i],[S,N],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[N,S]],os:[[/microsoft (windows) (vista|xp)/i],[S,N],[/(windows) nt 6\.2; (arm)/i,/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i,/(windows)[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i],[S,[N,fw,hO]],[/(win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[S,"Windows"],[N,fw,hO]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/cfnetwork\/.+darwin/i],[[N,/_/g,"."],[S,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[S,Jt],[N,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[N,S],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[S,N],[/\(bb(10);/i],[N,[S,Ye]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[N,[S,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[N,[S,Tn+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[N,[S,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[N,[S,"watchOS"]],[/crkey\/([\d\.]+)/i],[N,[S,mt+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[S,Qe],N],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[S,N],[/(sunos) ?([\w\.\d]*)/i],[[S,"Solaris"],N],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux)/i,/(unix) ?([\w\.]*)/i],[S,N]]},Nl=function(ki,Zi){if(typeof ki===h&&(Zi=ki,ki=a),!(this instanceof Nl))return new Nl(ki,Zi).getResult();var Rr=typeof s!==u&&s.navigator?s.navigator:a,yc=ki||(Rr&&Rr.userAgent?Rr.userAgent:""),Mh=Rr&&Rr.userAgentData?Rr.userAgentData:a,di=Zi?function(Hn,$a){var sg={};for(var Rd in Hn)$a[Rd]&&$a[Rd].length%2==0?sg[Rd]=$a[Rd].concat(Hn[Rd]):sg[Rd]=Hn[Rd];return sg}(fO,Zi):fO;return this.getBrowser=function(){var Hn={};return Hn[S]=a,Hn[N]=a,uy.call(Hn,yc,di.browser),Hn[y]=function($a){return typeof $a===m?$a.replace(/[^\d\.]/g,"").split(".")[0]:a}(Hn[N]),Rr&&Rr.brave&&typeof Rr.brave.isBrave==c&&(Hn[S]="Brave"),Hn},this.getCPU=function(){var Hn={};return Hn[G]=a,uy.call(Hn,yc,di.cpu),Hn},this.getDevice=function(){var Hn={};return Hn[P]=a,Hn[v]=a,Hn[R]=a,uy.call(Hn,yc,di.device),!Hn[R]&&Mh&&Mh.mobile&&(Hn[R]=j),Hn[v]=="Macintosh"&&Rr&&typeof Rr.standalone!==u&&Rr.maxTouchPoints&&Rr.maxTouchPoints>2&&(Hn[v]="iPad",Hn[R]=X),Hn},this.getEngine=function(){var Hn={};return Hn[S]=a,Hn[N]=a,uy.call(Hn,yc,di.engine),Hn},this.getOS=function(){var Hn={};return Hn[S]=a,Hn[N]=a,uy.call(Hn,yc,di.os),!Hn[S]&&Mh&&Mh.platform!="Unknown"&&(Hn[S]=Mh.platform.replace(/chrome os/i,Qe).replace(/macos/i,Jt)),Hn},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return yc},this.setUA=function(Hn){return yc=typeof Hn===m&&Hn.length>350?gp(Hn,350):Hn,this},this.setUA(yc),this};Nl.VERSION="0.7.34",Nl.BROWSER=sr([S,N,y]),Nl.CPU=sr([G]),Nl.DEVICE=sr([v,P,R,F,j,ee,X,he,Se]),Nl.ENGINE=Nl.OS=sr([S,N]),t.exports&&(r=t.exports=Nl),r.UAParser=Nl;var ig=typeof s!==u&&(s.jQuery||s.Zepto);if(ig&&!ig.ua){var dy=new Nl;ig.ua=dy.getResult(),ig.ua.get=function(){return dy.getUA()},ig.ua.set=function(ki){dy.setUA(ki);var Zi=dy.getResult();for(var Rr in Zi)ig.ua[Rr]=Zi[Rr]}}})(typeof window=="object"?window:o)})(Sx,Sx.exports);var dde=l(Sx.exports),hde=Nc,fde=Ci,pde=Mt,mde=ih,gde=_r("iterator"),_de=Object,yde=function(t){if(pde(t))return!1;var r=_de(t);return r[gde]!==void 0||"@@iterator"in r||fde(mde,hde(r))},Ede=l(yde),XB=ov.clear;Wn({global:!0,bind:!0,forced:V.clearImmediate!==XB},{clearImmediate:XB});var vde=typeof Bun=="function"&&Bun&&typeof Bun.version=="string",JB=V,Sde=se,bde=xe,Tde=vde,wde=wt,Cde=Cs,Rde=vl,Ide=JB.Function,Ade=/MSIE .\./.test(wde)||Tde&&function(){var t=JB.Bun.version.split(".");return t.length<3||t[0]==0&&(t[1]<3||t[1]==3&&t[2]==0)}(),Pde=Wn,QB=V,ZB=ov.set,Ode=function(t,r){var s=1;return Ade?function(a,c){var u=Rde(arguments.length,1)>s,h=bde(a)?a:Ide(a),m=u?Cde(arguments,s):[],y=u?function(){Sde(h,this,m)}:h;return t(y)}:t},e6=QB.setImmediate?Ode(ZB):ZB;Pde({global:!0,bind:!0,forced:QB.setImmediate!==e6},{setImmediate:e6});var t6=l(yt.setImmediate),kde=Wn,Nde=fc,Dde=vs,xde=vl,Lde=kf,Mde=V.process;kde({global:!0,dontCallGetSet:!0},{queueMicrotask:function(t){xde(arguments.length,1),Dde(t);var r=Lde&&Mde.domain;Nde(r?r.bind(t):t)}});var n6=l(yt.queueMicrotask);function r6(t,r){return function(){return t.apply(r,arguments)}}const{toString:Ude}=Object.prototype,{getPrototypeOf:bx}=Object,gA=(Tx=Object.create(null),t=>{const r=Ude.call(t);return Tx[r]||(Tx[r]=r.slice(8,-1).toLowerCase())});var Tx;const fd=t=>(t=t.toLowerCase(),r=>gA(r)===t),_A=t=>r=>typeof r===t,{isArray:kv}=Array,dT=_A("undefined"),i6=fd("ArrayBuffer"),Vde=_A("string"),bl=_A("function"),s6=_A("number"),yA=t=>t!==null&&typeof t=="object",EA=t=>{if(gA(t)!=="object")return!1;const r=bx(t);return!(r!==null&&r!==Object.prototype&&Object.getPrototypeOf(r)!==null||Symbol.toStringTag in t||Ede(t))},Fde=fd("Date"),jde=fd("File"),Bde=fd("Blob"),Wde=fd("FileList"),zde=fd("URLSearchParams"),[Gde,Hde,$de,Kde]=["ReadableStream","Request","Response","Headers"].map(fd);function hT(t,r){let s,a,{allOwnKeys:c=!1}=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(t!=null)if(typeof t!="object"&&(t=[t]),kv(t))for(s=0,a=t.length;s<a;s++)r.call(null,t[s],s,t);else{const u=c?Object.getOwnPropertyNames(t):Object.keys(t),h=u.length;let m;for(s=0;s<h;s++)m=u[s],r.call(null,t[m],m,t)}}function o6(t,r){r=r.toLowerCase();const s=Object.keys(t);let a,c=s.length;for(;c-- >0;)if(a=s[c],r===a.toLowerCase())return a;return null}const x_=YB!==void 0?YB:typeof self<"u"?self:typeof window<"u"?window:Sy,a6=t=>!dT(t)&&t!==x_,qde=(wx=typeof Uint8Array<"u"&&bx(Uint8Array),t=>wx&&t instanceof wx);var wx;const Yde=fd("HTMLFormElement"),c6=(t=>{let{hasOwnProperty:r}=t;return(s,a)=>r.call(s,a)})(Object.prototype),Xde=fd("RegExp"),l6=(t,r)=>{const s=Object.getOwnPropertyDescriptors(t),a={};hT(s,(c,u)=>{let h;(h=r(c,u,t))!==!1&&(a[u]=h||c)}),Object.defineProperties(t,a)},Cx="abcdefghijklmnopqrstuvwxyz",u6="0123456789",d6={DIGIT:u6,ALPHA:Cx,ALPHA_DIGIT:Cx+Cx.toUpperCase()+u6},Jde=fd("AsyncFunction"),h6=(f6=typeof t6=="function",p6=bl(x_.postMessage),f6?t6:p6?(Rx="axios@".concat(Math.random()),vA=[],x_.addEventListener("message",t=>{let{source:r,data:s}=t;r===x_&&s===Rx&&vA.length&&vA.shift()()},!1),t=>{vA.push(t),x_.postMessage(Rx,"*")}):t=>setTimeout(t));var f6,p6,Rx,vA;const Qde=n6!==void 0?n6.bind(x_):typeof process<"u"&&process.nextTick||h6;var lt={isArray:kv,isArrayBuffer:i6,isBuffer:function(t){return t!==null&&!dT(t)&&t.constructor!==null&&!dT(t.constructor)&&bl(t.constructor.isBuffer)&&t.constructor.isBuffer(t)},isFormData:t=>{let r;return t&&(typeof FormData=="function"&&t instanceof FormData||bl(t.append)&&((r=gA(t))==="formdata"||r==="object"&&bl(t.toString)&&t.toString()==="[object FormData]"))},isArrayBufferView:function(t){let r;return r=typeof ArrayBuffer<"u"&&ArrayBuffer.isView?ArrayBuffer.isView(t):t&&t.buffer&&i6(t.buffer),r},isString:Vde,isNumber:s6,isBoolean:t=>t===!0||t===!1,isObject:yA,isPlainObject:EA,isReadableStream:Gde,isRequest:Hde,isResponse:$de,isHeaders:Kde,isUndefined:dT,isDate:Fde,isFile:jde,isBlob:Bde,isRegExp:Xde,isFunction:bl,isStream:t=>yA(t)&&bl(t.pipe),isURLSearchParams:zde,isTypedArray:qde,isFileList:Wde,forEach:hT,merge:function t(){const{caseless:r}=a6(this)&&this||{},s={},a=(c,u)=>{const h=r&&o6(s,u)||u;EA(s[h])&&EA(c)?s[h]=t(s[h],c):EA(c)?s[h]=t({},c):kv(c)?s[h]=c.slice():s[h]=c};for(let c=0,u=arguments.length;c<u;c++)arguments[c]&&hT(arguments[c],a);return s},extend:function(t,r,s){let{allOwnKeys:a}=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return hT(r,(c,u)=>{s&&bl(c)?t[u]=r6(c,s):t[u]=c},{allOwnKeys:a}),t},trim:t=>po(t)?po(t).call(t):t.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:t=>(t.charCodeAt(0)===65279&&(t=t.slice(1)),t),inherits:(t,r,s,a)=>{t.prototype=Object.create(r.prototype,a),t.prototype.constructor=t,Object.defineProperty(t,"super",{value:r.prototype}),s&&Object.assign(t.prototype,s)},toFlatObject:(t,r,s,a)=>{let c,u,h;const m={};if(r=r||{},t==null)return r;do{for(c=Object.getOwnPropertyNames(t),u=c.length;u-- >0;)h=c[u],a&&!a(h,t,r)||m[h]||(r[h]=t[h],m[h]=!0);t=s!==!1&&bx(t)}while(t&&(!s||s(t,r))&&t!==Object.prototype);return r},kindOf:gA,kindOfTest:fd,endsWith:(t,r,s)=>{t=String(t),(s===void 0||s>t.length)&&(s=t.length),s-=r.length;const a=t.indexOf(r,s);return a!==-1&&a===s},toArray:t=>{if(!t)return null;if(kv(t))return t;let r=t.length;if(!s6(r))return null;const s=new Array(r);for(;r-- >0;)s[r]=t[r];return s},forEachEntry:(t,r)=>{const s=(t&&t[Symbol.iterator]).call(t);let a;for(;(a=s.next())&&!a.done;){const c=a.value;r.call(t,c[0],c[1])}},matchAll:(t,r)=>{let s;const a=[];for(;(s=t.exec(r))!==null;)a.push(s);return a},isHTMLForm:Yde,hasOwnProperty:c6,hasOwnProp:c6,reduceDescriptors:l6,freezeMethods:t=>{l6(t,(r,s)=>{if(bl(t)&&["arguments","caller","callee"].indexOf(s)!==-1)return!1;const a=t[s];bl(a)&&(r.enumerable=!1,"writable"in r?r.writable=!1:r.set||(r.set=()=>{throw Error("Can not rewrite read-only method '"+s+"'")}))})},toObjectSet:(t,r)=>{const s={},a=c=>{c.forEach(u=>{s[u]=!0})};return kv(t)?a(t):a(String(t).split(r)),s},toCamelCase:t=>t.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(r,s,a){return s.toUpperCase()+a}),noop:()=>{},toFiniteNumber:(t,r)=>t!=null&&Number.isFinite(t=+t)?t:r,findKey:o6,global:x_,isContextDefined:a6,ALPHABET:d6,generateString:function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:16,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:d6.ALPHA_DIGIT,s="";const{length:a}=r;for(;t--;)s+=r[Math.random()*a|0];return s},isSpecCompliantForm:function(t){return!!(t&&bl(t.append)&&t[Symbol.toStringTag]==="FormData"&&t[Symbol.iterator])},toJSONObject:t=>{const r=new Array(10),s=(a,c)=>{if(yA(a)){if(r.indexOf(a)>=0)return;if(!("toJSON"in a)){r[c]=a;const u=kv(a)?[]:{};return hT(a,(h,m)=>{const y=s(h,c+1);!dT(y)&&(u[m]=y)}),r[c]=void 0,u}}return a};return s(t,0)},isAsyncFn:Jde,isThenable:t=>t&&(yA(t)||bl(t))&&bl(t.then)&&bl(t.catch),setImmediate:h6,asap:Qde};function rr(t,r,s,a,c){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=t,this.name="AxiosError",r&&(this.code=r),s&&(this.config=s),a&&(this.request=a),c&&(this.response=c,this.status=c.status?c.status:null)}lt.inherits(rr,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:lt.toJSONObject(this.config),code:this.code,status:this.status}}});const m6=rr.prototype,g6={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(t=>{g6[t]={value:t}}),Object.defineProperties(rr,g6),Object.defineProperty(m6,"isAxiosError",{value:!0}),rr.from=(t,r,s,a,c,u)=>{const h=Object.create(m6);return lt.toFlatObject(t,h,function(m){return m!==Error.prototype},m=>m!=="isAxiosError"),rr.call(h,t.message,r,s,a,c),h.cause=t,h.name=t.name,u&&Object.assign(h,u),h};function Ix(t){return lt.isPlainObject(t)||lt.isArray(t)}function _6(t){return lt.endsWith(t,"[]")?t.slice(0,-2):t}function y6(t,r,s){return t?t.concat(r).map(function(a,c){return a=_6(a),!s&&c?"["+a+"]":a}).join(s?".":""):r}const Zde=lt.toFlatObject(lt,{},null,function(t){return/^is[A-Z]/.test(t)});function SA(t,r,s){if(!lt.isObject(t))throw new TypeError("target must be an object");r=r||new FormData;const a=(s=lt.toFlatObject(s,{metaTokens:!0,dots:!1,indexes:!1},!1,function(P,N){return!lt.isUndefined(N[P])})).metaTokens,c=s.visitor||v,u=s.dots,h=s.indexes,m=(s.Blob||typeof Blob<"u"&&Blob)&&lt.isSpecCompliantForm(r);if(!lt.isFunction(c))throw new TypeError("visitor must be a function");function y(P){if(P===null)return"";if(lt.isDate(P))return P.toISOString();if(!m&&lt.isBlob(P))throw new rr("Blob is not supported. Use a Buffer instead.");return lt.isArrayBuffer(P)||lt.isTypedArray(P)?m&&typeof Blob=="function"?new Blob([P]):Buffer.from(P):P}function v(P,N,G){let F=P;if(P&&!G&&typeof P=="object"){if(lt.endsWith(N,"{}"))N=a?N:N.slice(0,-2),P=JSON.stringify(P);else if(lt.isArray(P)&&function(j){return lt.isArray(j)&&!j.some(Ix)}(P)||(lt.isFileList(P)||lt.endsWith(N,"[]"))&&(F=lt.toArray(P)))return N=_6(N),F.forEach(function(j,X){!lt.isUndefined(j)&&j!==null&&r.append(h===!0?y6([N],X,u):h===null?N:N+"[]",y(j))}),!1}return!!Ix(P)||(r.append(y6(G,N,u),y(P)),!1)}const S=[],R=Object.assign(Zde,{defaultVisitor:v,convertValue:y,isVisitable:Ix});if(!lt.isObject(t))throw new TypeError("data must be an object");return function P(N,G){if(!lt.isUndefined(N)){if(S.indexOf(N)!==-1)throw Error("Circular reference detected in "+G.join("."));S.push(N),lt.forEach(N,function(F,j){(!(lt.isUndefined(F)||F===null)&&c.call(r,F,lt.isString(j)?po(j).call(j):j,G,R))===!0&&P(F,G?G.concat(j):[j])}),S.pop()}}(t),r}function E6(t){const r={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(t).replace(/[!'()~]|%20|%00/g,function(s){return r[s]})}function Ax(t,r){this._pairs=[],t&&SA(t,this,r)}const v6=Ax.prototype;function ehe(t){return encodeURIComponent(t).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function S6(t,r,s){if(!r)return t;const a=s&&s.encode||ehe;lt.isFunction(s)&&(s={serialize:s});const c=s&&s.serialize;let u;if(u=c?c(r,s):lt.isURLSearchParams(r)?r.toString():new Ax(r,s).toString(a),u){const h=t.indexOf("#");h!==-1&&(t=t.slice(0,h)),t+=(t.indexOf("?")===-1?"?":"&")+u}return t}v6.append=function(t,r){this._pairs.push([t,r])},v6.toString=function(t){const r=t?function(s){return t.call(this,s,E6)}:E6;return this._pairs.map(function(s){return r(s[0])+"="+r(s[1])},"").join("&")};var b6=class{constructor(){this.handlers=[]}use(t,r,s){return this.handlers.push({fulfilled:t,rejected:r,synchronous:!!s&&s.synchronous,runWhen:s?s.runWhen:null}),this.handlers.length-1}eject(t){this.handlers[t]&&(this.handlers[t]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(t){lt.forEach(this.handlers,function(r){r!==null&&t(r)})}},T6={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},w6={exports:{}},the=Wn,nhe=$e,C6=rt.f;the({target:"Object",stat:!0,forced:Object.defineProperty!==C6,sham:!nhe},{defineProperty:C6});var R6=yt.Object,rhe=w6.exports=function(t,r,s){return R6.defineProperty(t,r,s)};R6.defineProperty.sham&&(rhe.sham=!0);var I6=l(w6.exports),ihe=TypeError,A6=Qg,she=S_,ohe=at,ahe=_r("species"),P6=Array,che=function(t){var r;return A6(t)&&(r=t.constructor,(she(r)&&(r===P6||A6(r.prototype))||ohe(r)&&(r=r[ahe])===null)&&(r=void 0)),r===void 0?P6:r},O6=function(t,r){return new(che(t))(r===0?0:r)},lhe=d,uhe=ai,dhe=_r("species"),k6=function(t){return uhe>=51||!lhe(function(){var r=[];return(r.constructor={})[dhe]=function(){return{foo:1}},r[t](Boolean).foo!==1})},hhe=Wn,fhe=d,phe=Qg,mhe=at,ghe=$o,_he=gi,N6=function(t){if(t>9007199254740991)throw ihe("Maximum allowed index exceeded");return t},D6=JI,yhe=O6,Ehe=k6,vhe=ai,x6=_r("isConcatSpreadable"),She=vhe>=51||!fhe(function(){var t=[];return t[x6]=!1,t.concat()[0]!==t}),bhe=function(t){if(!mhe(t))return!1;var r=t[x6];return r!==void 0?!!r:phe(t)};hhe({target:"Array",proto:!0,forced:!She||!Ehe("concat")},{concat:function(t){var r,s,a,c,u,h=ghe(this),m=yhe(h,0),y=0;for(r=-1,a=arguments.length;r<a;r++)if(bhe(u=r===-1?h:arguments[r]))for(c=_he(u),N6(y+c),s=0;s<c;s++,y++)s in u&&D6(m,y,u[s]);else N6(y+1),D6(m,y++,u);return m.length=y,m}});var L6={},The=q,whe=Re,M6=th.f,Che=kD,U6=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];L6.f=function(t){return U6&&The(t)=="Window"?function(r){try{return M6(r)}catch{return Che(U6)}}(t):M6(whe(t))};var Nv={},Rhe=_r;Nv.f=Rhe;var V6=yt,Ihe=Ci,Ahe=Nv,Phe=rt.f,As=function(t){var r=V6.Symbol||(V6.Symbol={});Ihe(r,t)||Phe(r,t,{value:Ahe.f(t)})},Ohe=Ee,khe=un,Nhe=_r,Dhe=sd,F6=function(){var t=khe("Symbol"),r=t&&t.prototype,s=r&&r.valueOf,a=Nhe("toPrimitive");r&&!r[a]&&Dhe(r,a,function(c){return Ohe(s,this)},{})},xhe=De,Lhe=on,Mhe=$o,Uhe=gi,Vhe=O6,j6=I([].push),Fhe=function(t){var r=t==1,s=t==2,a=t==3,c=t==4,u=t==6,h=t==7,m=t==5||u;return function(y,v,S,R){for(var P,N,G=Mhe(y),F=Lhe(G),j=xhe(v,S),X=Uhe(F),ee=0,he=R||Vhe,Se=r?he(y,X):s||h?he(y,0):void 0;X>ee;ee++)if((m||ee in F)&&(N=j(P=F[ee],ee,G),t))if(r)Se[ee]=N;else if(N)switch(t){case 3:return!0;case 5:return P;case 6:return ee;case 2:j6(Se,P)}else switch(t){case 4:return!1;case 7:j6(Se,P)}return u?-1:a||c?c:Se}},B6={forEach:Fhe(0)},bA=Wn,Px=V,Ox=Ee,jhe=I,Dv=$e,xv=Fi,Bhe=d,xo=Ci,Whe=O,kx=fn,TA=Re,Nx=oc,zhe=Na,Dx=Je,fT=ia,W6=Lc,Ghe=th,z6=L6,Hhe=xc,G6=We,H6=rt,$he=EE,$6=ke,K6=sd,Khe=HE,xx=ic,q6=Dc,Y6=qd,qhe=_r,Yhe=Nv,Xhe=As,Jhe=F6,Qhe=od,X6=id,wA=B6.forEach,Gc=e_("hidden"),CA="Symbol",pT="prototype",Zhe=X6.set,J6=X6.getterFor(CA),pd=Object[pT],L_=Px.Symbol,RA=L_&&L_[pT],efe=Px.TypeError,Lx=Px.QObject,Q6=G6.f,M_=H6.f,Z6=z6.f,tfe=$6.f,eW=jhe([].push),ep=xx("symbols"),mT=xx("op-symbols"),nfe=xx("wks"),Mx=!Lx||!Lx[pT]||!Lx[pT].findChild,Ux=Dv&&Bhe(function(){return fT(M_({},"a",{get:function(){return M_(this,"a",{value:7}).a}})).a!=7})?function(t,r,s){var a=Q6(pd,r);a&&delete pd[r],M_(t,r,s),a&&t!==pd&&M_(pd,r,a)}:M_,Vx=function(t,r){var s=ep[t]=fT(RA);return Zhe(s,{type:CA,tag:t,description:r}),Dv||(s.description=r),s},IA=function(t,r,s){t===pd&&IA(mT,r,s),kx(t);var a=Nx(r);return kx(s),xo(ep,a)?(s.enumerable?(xo(t,Gc)&&t[Gc][a]&&(t[Gc][a]=!1),s=fT(s,{enumerable:Dx(0,!1)})):(xo(t,Gc)||M_(t,Gc,Dx(1,{})),t[Gc][a]=!0),Ux(t,a,s)):M_(t,a,s)},Fx=function(t,r){kx(t);var s=TA(r),a=W6(s).concat(iW(s));return wA(a,function(c){Dv&&!Ox(tW,s,c)||IA(t,c,s[c])}),t},tW=function(t){var r=Nx(t),s=Ox(tfe,this,r);return!(this===pd&&xo(ep,r)&&!xo(mT,r))&&(!(s||!xo(this,r)||!xo(ep,r)||xo(this,Gc)&&this[Gc][r])||s)},nW=function(t,r){var s=TA(t),a=Nx(r);if(s!==pd||!xo(ep,a)||xo(mT,a)){var c=Q6(s,a);return!c||!xo(ep,a)||xo(s,Gc)&&s[Gc][a]||(c.enumerable=!0),c}},rW=function(t){var r=Z6(TA(t)),s=[];return wA(r,function(a){xo(ep,a)||xo(q6,a)||eW(s,a)}),s},iW=function(t){var r=t===pd,s=Z6(r?mT:TA(t)),a=[];return wA(s,function(c){!xo(ep,c)||r&&!xo(pd,c)||eW(a,ep[c])}),a};xv||(L_=function(){if(Whe(RA,this))throw efe("Symbol is not a constructor");var t=arguments.length&&arguments[0]!==void 0?zhe(arguments[0]):void 0,r=Y6(t),s=function(a){this===pd&&Ox(s,mT,a),xo(this,Gc)&&xo(this[Gc],r)&&(this[Gc][r]=!1),Ux(this,r,Dx(1,a))};return Dv&&Mx&&Ux(pd,r,{configurable:!0,set:s}),Vx(r,t)},K6(RA=L_[pT],"toString",function(){return J6(this).tag}),K6(L_,"withoutSetter",function(t){return Vx(Y6(t),t)}),$6.f=tW,H6.f=IA,$he.f=Fx,G6.f=nW,Ghe.f=z6.f=rW,Hhe.f=iW,Yhe.f=function(t){return Vx(qhe(t),t)},Dv&&Khe(RA,"description",{configurable:!0,get:function(){return J6(this).description}})),bA({global:!0,wrap:!0,forced:!xv,sham:!xv},{Symbol:L_}),wA(W6(nfe),function(t){Xhe(t)}),bA({target:CA,stat:!0,forced:!xv},{useSetter:function(){Mx=!0},useSimple:function(){Mx=!1}}),bA({target:"Object",stat:!0,forced:!xv,sham:!Dv},{create:function(t,r){return r===void 0?fT(t):Fx(fT(t),r)},defineProperty:IA,defineProperties:Fx,getOwnPropertyDescriptor:nW}),bA({target:"Object",stat:!0,forced:!xv},{getOwnPropertyNames:rW}),Jhe(),Qhe(L_,CA),q6[Gc]=!0;var sW=Fi&&!!Symbol.for&&!!Symbol.keyFor,rfe=Wn,ife=un,sfe=Ci,ofe=Na,oW=ic,afe=sW,jx=oW("string-to-symbol-registry"),cfe=oW("symbol-to-string-registry");rfe({target:"Symbol",stat:!0,forced:!afe},{for:function(t){var r=ofe(t);if(sfe(jx,r))return jx[r];var s=ife("Symbol")(r);return jx[r]=s,cfe[s]=r,s}});var lfe=Wn,ufe=Ci,dfe=Ca,hfe=Es,ffe=sW,aW=ic("symbol-to-string-registry");lfe({target:"Symbol",stat:!0,forced:!ffe},{keyFor:function(t){if(!dfe(t))throw TypeError(hfe(t)+" is not a symbol");if(ufe(aW,t))return aW[t]}});var cW=Qg,pfe=xe,lW=q,mfe=Na,uW=I([].push),gfe=Wn,dW=un,hW=se,_fe=Ee,gT=I,fW=d,pW=xe,mW=Ca,gW=Cs,yfe=function(t){if(pfe(t))return t;if(cW(t)){for(var r=t.length,s=[],a=0;a<r;a++){var c=t[a];typeof c=="string"?uW(s,c):typeof c!="number"&&lW(c)!="Number"&&lW(c)!="String"||uW(s,mfe(c))}var u=s.length,h=!0;return function(m,y){if(h)return h=!1,y;if(cW(this))return y;for(var v=0;v<u;v++)if(s[v]===m)return y}}},Efe=Fi,vfe=String,Vm=dW("JSON","stringify"),AA=gT(/./.exec),_W=gT("".charAt),Sfe=gT("".charCodeAt),bfe=gT("".replace),Tfe=gT(1 .toString),wfe=/[\uD800-\uDFFF]/g,yW=/^[\uD800-\uDBFF]$/,EW=/^[\uDC00-\uDFFF]$/,vW=!Efe||fW(function(){var t=dW("Symbol")();return Vm([t])!="[null]"||Vm({a:t})!="{}"||Vm(Object(t))!="{}"}),SW=fW(function(){return Vm("\uDF06\uD834")!=='"\\udf06\\ud834"'||Vm("\uDEAD")!=='"\\udead"'}),Cfe=function(t,r){var s=gW(arguments),a=yfe(r);if(pW(a)||t!==void 0&&!mW(t))return s[1]=function(c,u){if(pW(a)&&(u=_fe(a,this,vfe(c),u)),!mW(u))return u},hW(Vm,null,s)},Rfe=function(t,r,s){var a=_W(s,r-1),c=_W(s,r+1);return AA(yW,t)&&!AA(EW,c)||AA(EW,t)&&!AA(yW,a)?"\\u"+Tfe(Sfe(t,0),16):t};Vm&&gfe({target:"JSON",stat:!0,forced:vW||SW},{stringify:function(t,r,s){var a=gW(arguments),c=hW(vW?Cfe:Vm,null,a);return SW&&typeof c=="string"?bfe(c,wfe,Rfe):c}});var bW=xc,Ife=$o;Wn({target:"Object",stat:!0,forced:!Fi||d(function(){bW.f(1)})},{getOwnPropertySymbols:function(t){var r=bW.f;return r?r(Ife(t)):[]}}),As("asyncIterator"),As("hasInstance"),As("isConcatSpreadable"),As("iterator"),As("match"),As("matchAll"),As("replace"),As("search"),As("species"),As("split");var Afe=F6;As("toPrimitive"),Afe();var Pfe=un,Ofe=od;As("toStringTag"),Ofe(Pfe("Symbol"),"Symbol"),As("unscopables"),od(V.JSON,"JSON",!0);var kfe=yt.Symbol,Nfe=_r,Dfe=rt.f,TW=Nfe("metadata"),wW=Function.prototype;wW[TW]===void 0&&Dfe(wW,TW,{value:null}),As("dispose"),As("metadata");var xfe=kfe;As("asyncDispose");var Lfe=I,Bx=un("Symbol"),Mfe=Bx.keyFor,Ufe=Lfe(Bx.prototype.valueOf),CW=Bx.isRegisteredSymbol||function(t){try{return Mfe(Ufe(t))!==void 0}catch{return!1}};Wn({target:"Symbol",stat:!0},{isRegisteredSymbol:CW});for(var Vfe=ic,RW=un,Ffe=I,jfe=Ca,Bfe=_r,PA=RW("Symbol"),IW=PA.isWellKnownSymbol,AW=RW("Object","getOwnPropertyNames"),Wfe=Ffe(PA.prototype.valueOf),PW=Vfe("wks"),Wx=0,OW=AW(PA),zfe=OW.length;Wx<zfe;Wx++)try{var kW=OW[Wx];jfe(PA[kW])&&Bfe(kW)}catch{}var NW=function(t){if(IW&&IW(t))return!0;try{for(var r=Wfe(t),s=0,a=AW(PW),c=a.length;s<c;s++)if(PW[a[s]]==r)return!0}catch{}return!1};Wn({target:"Symbol",stat:!0,forced:!0},{isWellKnownSymbol:NW}),As("matcher"),As("observable"),Wn({target:"Symbol",stat:!0},{isRegistered:CW}),Wn({target:"Symbol",stat:!0,forced:!0},{isWellKnown:NW}),As("metadataKey"),As("patternMatch"),As("replaceAll");var Lv=l(xfe),DW=l(Nv.f("iterator"));function _T(t){return _T=typeof Lv=="function"&&typeof DW=="symbol"?function(r){return typeof r}:function(r){return r&&typeof Lv=="function"&&r.constructor===Lv&&r!==Lv.prototype?"symbol":typeof r},_T(t)}var Gfe=l(Nv.f("toPrimitive"));function Hfe(t){var r=function(s,a){if(_T(s)!=="object"||s===null)return s;var c=s[Gfe];if(c!==void 0){var u=c.call(s,a);if(_T(u)!=="object")return u;throw new TypeError("@@toPrimitive must return a primitive value.")}return(a==="string"?String:Number)(s)}(t,"string");return _T(r)==="symbol"?r:String(r)}function K(t,r,s){return(r=Hfe(r))in t?I6(t,r,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[r]=s,t}var xW=l(Cle),$fe={isBrowser:!0,classes:{URLSearchParams:xW!==void 0?xW:Ax,FormData:typeof FormData<"u"?FormData:null,Blob:typeof Blob<"u"?Blob:null},protocols:["http","https","file","blob","url","data"]};const zx=typeof window<"u"&&typeof document<"u",Gx=typeof navigator=="object"&&navigator||void 0,Kfe=zx&&(!Gx||["ReactNative","NativeScript","NS"].indexOf(Gx.product)<0),qfe=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",Yfe=zx&&window.location.href||"http://localhost";function LW(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}function MW(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?LW(Object(s),!0).forEach(function(a){K(t,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):LW(Object(s)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))})}return t}var ja=MW(MW({},Object.freeze({__proto__:null,hasBrowserEnv:zx,hasStandardBrowserEnv:Kfe,hasStandardBrowserWebWorkerEnv:qfe,navigator:Gx,origin:Yfe})),$fe),Xfe=fn,Jfe=Ee,Qfe=Ci,Zfe=O,epe=function(){var t=Xfe(this),r="";return t.hasIndices&&(r+="d"),t.global&&(r+="g"),t.ignoreCase&&(r+="i"),t.multiline&&(r+="m"),t.dotAll&&(r+="s"),t.unicode&&(r+="u"),t.unicodeSets&&(r+="v"),t.sticky&&(r+="y"),r},UW=RegExp.prototype,VW=function(t){var r=t.flags;return r!==void 0||"flags"in UW||Qfe(t,"flags")||!Zfe(UW,t)?r:Jfe(epe,t)},tpe=RD.charAt,FW=Ee,npe=fn,rpe=xe,ipe=q,spe=/./.exec,ope=TypeError,ape=Wn,jW=Ee,BW=ie,cpe=UE,OA=WE,WW=Ht,zW=Vt,yT=Na,lpe=fn,upe=Mt,dpe=q,hpe=kR,GW=VW,fpe=Rc,ppe=d,mpe=ss,gpe=function(t,r,s){return r+(s?tpe(t,r).length:1)},_pe=function(t,r){var s=t.exec;if(rpe(s)){var a=FW(s,t,r);return a!==null&&npe(a),a}if(ipe(t)==="RegExp")return FW(spe,t,r);throw ope("RegExp#exec called on incompatible receiver")},HW=id,ype=_r("matchAll"),$W="RegExp String",KW=$W+" Iterator",Epe=HW.set,vpe=HW.getterFor(KW),Spe=TypeError,Hx=BW("".indexOf),kA=BW("".matchAll),$x=!!kA&&!ppe(function(){kA("a",/./)}),bpe=cpe(function(t,r,s,a){Epe(this,{type:KW,regexp:t,string:r,global:s,unicode:a,done:!1})},$W,function(){var t=vpe(this);if(t.done)return OA(void 0,!0);var r=t.regexp,s=t.string,a=_pe(r,s);return a===null?(t.done=!0,OA(void 0,!0)):t.global?(yT(a[0])===""&&(r.lastIndex=gpe(s,zW(r.lastIndex),t.unicode)),OA(a,!1)):(t.done=!0,OA(a,!1))}),qW=function(t){var r,s,a,c=lpe(this),u=yT(t),h=mpe(c,RegExp),m=yT(GW(c));return r=new h(h===RegExp?c.source:c,m),s=!!~Hx(m,"g"),a=!!~Hx(m,"u"),r.lastIndex=zW(c.lastIndex),new bpe(r,u,s,a)};ape({target:"String",proto:!0,forced:$x},{matchAll:function(t){var r,s,a,c,u=WW(this);if(upe(t)){if($x)return kA(u,t)}else{if(hpe(t)&&(r=yT(WW(GW(t))),!~Hx(r,"g")))throw Spe("`.matchAll` does not allow non-global regexes");if($x)return kA(u,t);if((a=fpe(t,ype))===void 0&&dpe(t)=="RegExp"&&(a=qW),a)return jW(a,t,u)}return s=yT(u),c=new RegExp(t,"g"),jW(qW,c,s)}});var Tpe=cc("String").matchAll,wpe=O,Cpe=Tpe,Kx=String.prototype,Rpe=function(t){var r=t.matchAll;return typeof t=="string"||t===Kx||wpe(Kx,t)&&r===Kx.matchAll?Cpe:r},Ipe=l(Rpe);function YW(t){function r(s,a,c,u){let h=s[u++];if(h==="__proto__")return!0;const m=Number.isFinite(+h),y=u>=s.length;return h=!h&&lt.isArray(c)?c.length:h,y?(lt.hasOwnProp(c,h)?c[h]=[c[h],a]:c[h]=a,!m):(c[h]&&lt.isObject(c[h])||(c[h]=[]),r(s,a,c[h],u)&&lt.isArray(c[h])&&(c[h]=function(v){const S={},R=Object.keys(v);let P;const N=R.length;let G;for(P=0;P<N;P++)G=R[P],S[G]=v[G];return S}(c[h])),!m)}if(lt.isFormData(t)&&lt.isFunction(t.entries)){const s={};return lt.forEachEntry(t,(a,c)=>{r(function(u){return Ipe(lt).call(lt,/\w+|\[(\w*)]/g,u).map(h=>h[0]==="[]"?"":h[1]||h[0])}(a),c,s,0)}),s}return null}const qx={transitional:T6,adapter:["xhr","http","fetch"],transformRequest:[function(t,r){const s=r.getContentType()||"",a=s.indexOf("application/json")>-1,c=lt.isObject(t);if(c&&lt.isHTMLForm(t)&&(t=new FormData(t)),lt.isFormData(t))return a?JSON.stringify(YW(t)):t;if(lt.isArrayBuffer(t)||lt.isBuffer(t)||lt.isStream(t)||lt.isFile(t)||lt.isBlob(t)||lt.isReadableStream(t))return t;if(lt.isArrayBufferView(t))return t.buffer;if(lt.isURLSearchParams(t))return r.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),t.toString();let u;if(c){if(s.indexOf("application/x-www-form-urlencoded")>-1)return function(h,m){return SA(h,new ja.classes.URLSearchParams,Object.assign({visitor:function(y,v,S,R){return ja.isNode&&lt.isBuffer(y)?(this.append(v,y.toString("base64")),!1):R.defaultVisitor.apply(this,arguments)}},m))}(t,this.formSerializer).toString();if((u=lt.isFileList(t))||s.indexOf("multipart/form-data")>-1){const h=this.env&&this.env.FormData;return SA(u?{"files[]":t}:t,h&&new h,this.formSerializer)}}return c||a?(r.setContentType("application/json",!1),function(h,m,y){if(lt.isString(h))try{return(m||JSON.parse)(h),po(lt).call(lt,h)}catch(v){if(v.name!=="SyntaxError")throw v}return(y||JSON.stringify)(h)}(t)):t}],transformResponse:[function(t){const r=this.transitional||qx.transitional,s=r&&r.forcedJSONParsing,a=this.responseType==="json";if(lt.isResponse(t)||lt.isReadableStream(t))return t;if(t&&lt.isString(t)&&(s&&!this.responseType||a)){const c=!(r&&r.silentJSONParsing)&&a;try{return JSON.parse(t)}catch(u){if(c)throw u.name==="SyntaxError"?rr.from(u,rr.ERR_BAD_RESPONSE,this,null,this.response):u}}return t}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:ja.classes.FormData,Blob:ja.classes.Blob},validateStatus:function(t){return t>=200&&t<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};lt.forEach(["delete","get","head","post","put","patch"],t=>{qx.headers[t]={}});var Yx=qx;const Ape=lt.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),XW=Symbol("internals");function ET(t){var r;return t&&po(r=String(t)).call(r).toLowerCase()}function NA(t){return t===!1||t==null?t:lt.isArray(t)?t.map(NA):String(t)}function Xx(t,r,s,a,c){return lt.isFunction(a)?a.call(this,r,s):(c&&(r=s),lt.isString(r)?lt.isString(a)?r.indexOf(a)!==-1:lt.isRegExp(a)?a.test(r):void 0:void 0)}class DA{constructor(r){r&&this.set(r)}set(r,s,a){const c=this;function u(y,v,S){const R=ET(v);if(!R)throw new Error("header name must be a non-empty string");const P=lt.findKey(c,R);(!P||c[P]===void 0||S===!0||S===void 0&&c[P]!==!1)&&(c[P||v]=NA(y))}const h=(y,v)=>lt.forEach(y,(S,R)=>u(S,R,v));if(lt.isPlainObject(r)||r instanceof this.constructor)h(r,s);else if(lt.isString(r)&&(r=po(r).call(r))&&!/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(po(m=r).call(m)))h((y=>{const v={};let S,R,P;return y&&y.split(`
`).forEach(function(N){var G,F;P=N.indexOf(":"),S=po(G=N.substring(0,P)).call(G).toLowerCase(),R=po(F=N.substring(P+1)).call(F),!S||v[S]&&Ape[S]||(S==="set-cookie"?v[S]?v[S].push(R):v[S]=[R]:v[S]=v[S]?v[S]+", "+R:R)}),v})(r),s);else if(lt.isHeaders(r))for(const[y,v]of r.entries())u(v,y,a);else r!=null&&u(s,r,a);var m;return this}get(r,s){if(r=ET(r)){const a=lt.findKey(this,r);if(a){const c=this[a];if(!s)return c;if(s===!0)return function(u){const h=Object.create(null),m=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let y;for(;y=m.exec(u);)h[y[1]]=y[2];return h}(c);if(lt.isFunction(s))return s.call(this,c,a);if(lt.isRegExp(s))return s.exec(c);throw new TypeError("parser must be boolean|regexp|function")}}}has(r,s){if(r=ET(r)){const a=lt.findKey(this,r);return!(!a||this[a]===void 0||s&&!Xx(0,this[a],a,s))}return!1}delete(r,s){const a=this;let c=!1;function u(h){if(h=ET(h)){const m=lt.findKey(a,h);!m||s&&!Xx(0,a[m],m,s)||(delete a[m],c=!0)}}return lt.isArray(r)?r.forEach(u):u(r),c}clear(r){const s=Object.keys(this);let a=s.length,c=!1;for(;a--;){const u=s[a];r&&!Xx(0,this[u],u,r,!0)||(delete this[u],c=!0)}return c}normalize(r){const s=this,a={};return lt.forEach(this,(c,u)=>{var h;const m=lt.findKey(a,u);if(m)return s[m]=NA(c),void delete s[u];const y=r?function(v){return po(v).call(v).toLowerCase().replace(/([a-z\d])(\w*)/g,(S,R,P)=>R.toUpperCase()+P)}(u):po(h=String(u)).call(h);y!==u&&delete s[u],s[y]=NA(c),a[y]=!0}),this}concat(){for(var r=arguments.length,s=new Array(r),a=0;a<r;a++)s[a]=arguments[a];return this.constructor.concat(this,...s)}toJSON(r){const s=Object.create(null);return lt.forEach(this,(a,c)=>{a!=null&&a!==!1&&(s[c]=r&&lt.isArray(a)?a.join(", "):a)}),s}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(r=>{let[s,a]=r;return s+": "+a}).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(r){return r instanceof this?r:new this(r)}static concat(r){const s=new this(r);for(var a=arguments.length,c=new Array(a>1?a-1:0),u=1;u<a;u++)c[u-1]=arguments[u];return c.forEach(h=>s.set(h)),s}static accessor(r){const s=(this[XW]=this[XW]={accessors:{}}).accessors,a=this.prototype;function c(u){const h=ET(u);s[h]||(function(m,y){const v=lt.toCamelCase(" "+y);["get","set","has"].forEach(S=>{Object.defineProperty(m,S+v,{value:function(R,P,N){return this[S].call(this,y,R,P,N)},configurable:!0})})}(a,u),s[h]=!0)}return lt.isArray(r)?r.forEach(c):c(r),this}}DA.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),lt.reduceDescriptors(DA.prototype,(t,r)=>{let{value:s}=t,a=r[0].toUpperCase()+r.slice(1);return{get:()=>s,set(c){this[a]=c}}}),lt.freezeMethods(DA);var md=DA;function Jx(t,r){const s=this||Yx,a=r||s,c=md.from(a.headers);let u=a.data;return lt.forEach(t,function(h){u=h.call(s,u,c.normalize(),r?r.status:void 0)}),c.normalize(),u}function JW(t){return!(!t||!t.__CANCEL__)}function Mv(t,r,s){rr.call(this,t??"canceled",rr.ERR_CANCELED,r,s),this.name="CanceledError"}function QW(t,r,s){const a=s.config.validateStatus;s.status&&a&&!a(s.status)?r(new rr("Request failed with status code "+s.status,[rr.ERR_BAD_REQUEST,rr.ERR_BAD_RESPONSE][Math.floor(s.status/100)-4],s.config,s.request,s)):t(s)}lt.inherits(Mv,rr,{__CANCEL__:!0});const xA=function(t,r){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:3,a=0;const c=function(u,h){u=u||10;const m=new Array(u),y=new Array(u);let v,S=0,R=0;return h=h!==void 0?h:1e3,function(P){const N=Date.now(),G=y[R];v||(v=N),m[S]=P,y[S]=N;let F=R,j=0;for(;F!==S;)j+=m[F++],F%=u;if(S=(S+1)%u,S===R&&(R=(R+1)%u),N-v<h)return;const X=G&&N-G;return X?Math.round(1e3*j/X):void 0}}(50,250);return function(u,h){let m,y,v=0,S=1e3/h;const R=function(P){v=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Date.now(),m=null,y&&(clearTimeout(y),y=null),u.apply(null,P)};return[function(){const P=Date.now(),N=P-v;for(var G=arguments.length,F=new Array(G),j=0;j<G;j++)F[j]=arguments[j];N>=S?R(F,P):(m=F,y||(y=setTimeout(()=>{y=null,R(m)},S-N)))},()=>m&&R(m)]}(u=>{const h=u.loaded,m=u.lengthComputable?u.total:void 0,y=h-a,v=c(y);a=h,t({loaded:h,total:m,progress:m?h/m:void 0,bytes:y,rate:v||void 0,estimated:v&&m&&h<=m?(m-h)/v:void 0,event:u,lengthComputable:m!=null,[r?"download":"upload"]:!0})},s)},ZW=(t,r)=>{const s=t!=null;return[a=>r[0]({lengthComputable:s,total:t,loaded:a}),r[1]]},e8=t=>function(){for(var r=arguments.length,s=new Array(r),a=0;a<r;a++)s[a]=arguments[a];return lt.asap(()=>t(...s))};var Ppe=ja.hasStandardBrowserEnv?((t,r)=>s=>(s=new lA(s,ja.origin),t.protocol===s.protocol&&t.host===s.host&&(r||t.port===s.port)))(new lA(ja.origin),ja.navigator&&/(msie|trident)/i.test(ja.navigator.userAgent)):()=>!0,Ope=ja.hasStandardBrowserEnv?{write(t,r,s,a,c,u){const h=[t+"="+encodeURIComponent(r)];lt.isNumber(s)&&h.push("expires="+new Date(s).toGMTString()),lt.isString(a)&&h.push("path="+a),lt.isString(c)&&h.push("domain="+c),u===!0&&h.push("secure"),document.cookie=h.join("; ")},read(t){const r=document.cookie.match(new RegExp("(^|;\\s*)("+t+")=([^;]*)"));return r?decodeURIComponent(r[3]):null},remove(t){this.write(t,"",Date.now()-864e5)}}:{write(){},read:()=>null,remove(){}};function t8(t,r){return t&&!function(s){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(s)}(r)?function(s,a){return a?s.replace(/\/?\/$/,"")+"/"+a.replace(/^\/+/,""):s}(t,r):r}function n8(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}const r8=t=>t instanceof md?function(r){for(var s=1;s<arguments.length;s++){var a=arguments[s]!=null?arguments[s]:{};s%2?n8(Object(a),!0).forEach(function(c){K(r,c,a[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(a)):n8(Object(a)).forEach(function(c){Object.defineProperty(r,c,Object.getOwnPropertyDescriptor(a,c))})}return r}({},t):t;function U_(t,r){r=r||{};const s={};function a(v,S,R,P){return lt.isPlainObject(v)&&lt.isPlainObject(S)?lt.merge.call({caseless:P},v,S):lt.isPlainObject(S)?lt.merge({},S):lt.isArray(S)?S.slice():S}function c(v,S,R,P){return lt.isUndefined(S)?lt.isUndefined(v)?void 0:a(void 0,v,0,P):a(v,S,0,P)}function u(v,S){if(!lt.isUndefined(S))return a(void 0,S)}function h(v,S){return lt.isUndefined(S)?lt.isUndefined(v)?void 0:a(void 0,v):a(void 0,S)}function m(v,S,R){return R in r?a(v,S):R in t?a(void 0,v):void 0}const y={url:u,method:u,data:u,baseURL:h,transformRequest:h,transformResponse:h,paramsSerializer:h,timeout:h,timeoutMessage:h,withCredentials:h,withXSRFToken:h,adapter:h,responseType:h,xsrfCookieName:h,xsrfHeaderName:h,onUploadProgress:h,onDownloadProgress:h,decompress:h,maxContentLength:h,maxBodyLength:h,beforeRedirect:h,transport:h,httpAgent:h,httpsAgent:h,cancelToken:h,socketPath:h,responseEncoding:h,validateStatus:m,headers:(v,S,R)=>c(r8(v),r8(S),0,!0)};return lt.forEach(Object.keys(Object.assign({},t,r)),function(v){const S=y[v]||c,R=S(t[v],r[v],v);lt.isUndefined(R)&&S!==m||(s[v]=R)}),s}var i8=t=>{const r=U_({},t);let s,{data:a,withXSRFToken:c,xsrfHeaderName:u,xsrfCookieName:h,headers:m,auth:y}=r;if(r.headers=m=md.from(m),r.url=S6(t8(r.baseURL,r.url),t.params,t.paramsSerializer),y&&m.set("Authorization","Basic "+btoa((y.username||"")+":"+(y.password?unescape(encodeURIComponent(y.password)):""))),lt.isFormData(a)){if(ja.hasStandardBrowserEnv||ja.hasStandardBrowserWebWorkerEnv)m.setContentType(void 0);else if((s=m.getContentType())!==!1){const[v,...S]=s?s.split(";").map(R=>po(R).call(R)).filter(Boolean):[];m.setContentType([v||"multipart/form-data",...S].join("; "))}}if(ja.hasStandardBrowserEnv&&(c&&lt.isFunction(c)&&(c=c(r)),c||c!==!1&&Ppe(r.url))){const v=u&&h&&Ope.read(h);v&&m.set(u,v)}return r},kpe=typeof XMLHttpRequest<"u"&&function(t){return new dt(function(r,s){const a=i8(t);let c=a.data;const u=md.from(a.headers).normalize();let h,m,y,v,S,{responseType:R,onUploadProgress:P,onDownloadProgress:N}=a;function G(){v&&v(),S&&S(),a.cancelToken&&a.cancelToken.unsubscribe(h),a.signal&&a.signal.removeEventListener("abort",h)}let F=new XMLHttpRequest;function j(){if(!F)return;const ee=md.from("getAllResponseHeaders"in F&&F.getAllResponseHeaders());QW(function(he){r(he),G()},function(he){s(he),G()},{data:R&&R!=="text"&&R!=="json"?F.response:F.responseText,status:F.status,statusText:F.statusText,headers:ee,config:t,request:F}),F=null}F.open(a.method.toUpperCase(),a.url,!0),F.timeout=a.timeout,"onloadend"in F?F.onloadend=j:F.onreadystatechange=function(){F&&F.readyState===4&&(F.status!==0||F.responseURL&&F.responseURL.indexOf("file:")===0)&&setTimeout(j)},F.onabort=function(){F&&(s(new rr("Request aborted",rr.ECONNABORTED,t,F)),F=null)},F.onerror=function(){s(new rr("Network Error",rr.ERR_NETWORK,t,F)),F=null},F.ontimeout=function(){let ee=a.timeout?"timeout of "+a.timeout+"ms exceeded":"timeout exceeded";const he=a.transitional||T6;a.timeoutErrorMessage&&(ee=a.timeoutErrorMessage),s(new rr(ee,he.clarifyTimeoutError?rr.ETIMEDOUT:rr.ECONNABORTED,t,F)),F=null},c===void 0&&u.setContentType(null),"setRequestHeader"in F&&lt.forEach(u.toJSON(),function(ee,he){F.setRequestHeader(he,ee)}),lt.isUndefined(a.withCredentials)||(F.withCredentials=!!a.withCredentials),R&&R!=="json"&&(F.responseType=a.responseType),N&&([y,S]=xA(N,!0),F.addEventListener("progress",y)),P&&F.upload&&([m,v]=xA(P),F.upload.addEventListener("progress",m),F.upload.addEventListener("loadend",v)),(a.cancelToken||a.signal)&&(h=ee=>{F&&(s(!ee||ee.type?new Mv(null,t,F):ee),F.abort(),F=null)},a.cancelToken&&a.cancelToken.subscribe(h),a.signal&&(a.signal.aborted?h():a.signal.addEventListener("abort",h)));const X=function(ee){const he=/^([-+\w]{1,25})(:?\/\/|:)/.exec(ee);return he&&he[1]||""}(a.url);X&&ja.protocols.indexOf(X)===-1?s(new rr("Unsupported protocol "+X+":",rr.ERR_BAD_REQUEST,t)):F.send(c||null)})},Npe=(t,r)=>{const{length:s}=t=t?t.filter(Boolean):[];if(r||s){let a,c=new AbortController;const u=function(v){if(!a){a=!0,m();const S=v instanceof Error?v:this.reason;c.abort(S instanceof rr?S:new Mv(S instanceof Error?S.message:S))}};let h=r&&setTimeout(()=>{h=null,u(new rr("timeout ".concat(r," of ms exceeded"),rr.ETIMEDOUT))},r);const m=()=>{t&&(h&&clearTimeout(h),h=null,t.forEach(v=>{v.unsubscribe?v.unsubscribe(u):v.removeEventListener("abort",u)}),t=null)};t.forEach(v=>v.addEventListener("abort",u));const{signal:y}=c;return y.unsubscribe=()=>lt.asap(m),y}},Dpe=X3,xpe=Sl;Wn({target:"Promise",stat:!0,forced:!0},{withResolvers:function(){var t=xpe.f(this);return{promise:t.promise,resolve:t.resolve,reject:t.reject}}});var Lpe=Sl,Mpe=hh;Wn({target:"Promise",stat:!0,forced:!0},{try:function(t){var r=Lpe.f(this),s=Mpe(t);return(s.error?r.reject:r.resolve)(s.value),r.promise}});var Qx=l(Dpe),s8=Nv.f("asyncIterator"),Upe=l(s8);function Zx(t,r){this.v=t,this.k=r}function vT(t){var r,s;function a(u,h){try{var m=t[u](h),y=m.value,v=y instanceof Zx;Qx.resolve(v?y.v:y).then(function(S){if(v){var R=u==="return"?"return":"next";if(!y.k||S.done)return a(R,S);S=t[R](S).value}c(m.done?"return":"normal",S)},function(S){a("throw",S)})}catch(S){c("throw",S)}}function c(u,h){switch(u){case"return":r.resolve({value:h,done:!0});break;case"throw":r.reject(h);break;default:r.resolve({value:h,done:!1})}(r=r.next)?a(r.key,r.arg):s=null}this._invoke=function(u,h){return new Qx(function(m,y){var v={key:u,arg:h,resolve:m,reject:y,next:null};s?s=s.next=v:(r=s=v,a(u,h))})},typeof t.return!="function"&&(this.return=void 0)}function Tl(t){return function(){return new vT(t.apply(this,arguments))}}function kn(t){return new Zx(t,0)}function LA(t){var r={},s=!1;function a(c,u){return s=!0,{done:!1,value:new Zx(u=new Qx(function(h){h(t[c](u))}),1)}}return r[Lv!==void 0&&DW||"@@iterator"]=function(){return this},r.next=function(c){return s?(s=!1,c):a("next",c)},typeof t.throw=="function"&&(r.throw=function(c){if(s)throw s=!1,c;return a("throw",c)}),typeof t.return=="function"&&(r.return=function(c){return s?(s=!1,c):a("return",c)}),r}vT.prototype[typeof Lv=="function"&&Upe||"@@asyncIterator"]=function(){return this},vT.prototype.next=function(t){return this._invoke("next",t)},vT.prototype.throw=function(t){return this._invoke("throw",t)},vT.prototype.return=function(t){return this._invoke("return",t)};var eL=l(s8);function tL(t){var r,s,a,c=2;for(typeof Symbol<"u"&&(s=eL,a=Symbol.iterator);c--;){if(s&&(r=t[s])!=null)return r.call(t);if(a&&(r=t[a])!=null)return new MA(r.call(t));s="@@asyncIterator",a="@@iterator"}throw new TypeError("Object is not async iterable")}function MA(t){function r(s){if(Object(s)!==s)return dt.reject(new TypeError(s+" is not an object."));var a=s.done;return dt.resolve(s.value).then(function(c){return{value:c,done:a}})}return MA=function(s){this.s=s,this.n=s.next},MA.prototype={s:null,n:null,next:function(){return r(this.n.apply(this.s,arguments))},return:function(s){var a=this.s.return;return a===void 0?dt.resolve({value:s,done:!0}):r(a.apply(this.s,arguments))},throw:function(s){var a=this.s.return;return a===void 0?dt.reject(s):r(a.apply(this.s,arguments))}},new MA(t)}const Vpe=function*(t,r){let s=t.byteLength;if(!r||s<r)return void(yield t);let a,c=0;for(;c<s;)a=c+r,yield t.slice(c,a),c=a},Fpe=function(){var t=Tl(function*(r,s){var a,c=!1,u=!1;try{for(var h,m=tL(jpe(r));c=!(h=yield kn(m.next())).done;c=!1){const y=h.value;yield*LA(tL(Vpe(y,s)))}}catch(y){u=!0,a=y}finally{try{c&&m.return!=null&&(yield kn(m.return()))}finally{if(u)throw a}}});return function(r,s){return t.apply(this,arguments)}}(),jpe=function(){var t=Tl(function*(r){if(r[eL])return void(yield*LA(tL(r)));const s=r.getReader();try{for(;;){const{done:a,value:c}=yield kn(s.read());if(a)break;yield c}}finally{yield kn(s.cancel())}});return function(r){return t.apply(this,arguments)}}(),o8=(t,r,s,a)=>{const c=Fpe(t,r);let u,h=0,m=y=>{u||(u=!0,a&&a(y))};return new ReadableStream({async pull(y){try{const{done:v,value:S}=await c.next();if(v)return m(),void y.close();let R=S.byteLength;if(s){let P=h+=R;s(P)}y.enqueue(new Uint8Array(S))}catch(v){throw m(v),v}},cancel:y=>(m(y),c.return())},{highWaterMark:2})};function a8(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}function c8(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?a8(Object(s),!0).forEach(function(a){K(t,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):a8(Object(s)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))})}return t}const UA=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",l8=UA&&typeof ReadableStream=="function",Bpe=UA&&(typeof TextEncoder=="function"?(u8=new TextEncoder,t=>u8.encode(t)):async t=>new Uint8Array(await new Response(t).arrayBuffer()));var u8;const d8=function(t){try{for(var r=arguments.length,s=new Array(r>1?r-1:0),a=1;a<r;a++)s[a-1]=arguments[a];return!!t(...s)}catch{return!1}},Wpe=l8&&d8(()=>{let t=!1;const r=new Request(ja.origin,{body:new ReadableStream,method:"POST",get duplex(){return t=!0,"half"}}).headers.has("Content-Type");return t&&!r}),nL=l8&&d8(()=>lt.isReadableStream(new Response("").body)),VA={stream:nL&&(t=>t.body)};var h8;UA&&(h8=new Response,["text","arrayBuffer","blob","formData","stream"].forEach(t=>{!VA[t]&&(VA[t]=lt.isFunction(h8[t])?r=>r[t]():(r,s)=>{throw new rr("Response type '".concat(t,"' is not supported"),rr.ERR_NOT_SUPPORT,s)})}));const zpe=async(t,r)=>{const s=lt.toFiniteNumber(t.getContentLength());return s??(async a=>a==null?0:lt.isBlob(a)?a.size:lt.isSpecCompliantForm(a)?(await new Request(ja.origin,{method:"POST",body:a}).arrayBuffer()).byteLength:lt.isArrayBufferView(a)||lt.isArrayBuffer(a)?a.byteLength:(lt.isURLSearchParams(a)&&(a+=""),lt.isString(a)?(await Bpe(a)).byteLength:void 0))(r)};var Gpe=UA&&(async t=>{let{url:r,method:s,data:a,signal:c,cancelToken:u,timeout:h,onDownloadProgress:m,onUploadProgress:y,responseType:v,headers:S,withCredentials:R="same-origin",fetchOptions:P}=i8(t);v=v?(v+"").toLowerCase():"text";let N,G=Npe([c,u&&u.toAbortSignal()],h);const F=G&&G.unsubscribe&&(()=>{G.unsubscribe()});let j;try{if(y&&Wpe&&s!=="get"&&s!=="head"&&(j=await zpe(S,a))!==0){let Te,ye=new Request(r,{method:"POST",body:a,duplex:"half"});if(lt.isFormData(a)&&(Te=ye.headers.get("content-type"))&&S.setContentType(Te),ye.body){const[Ne,Ye]=ZW(j,xA(e8(y)));a=o8(ye.body,65536,Ne,Ye)}}lt.isString(R)||(R=R?"include":"omit");const X="credentials"in Request.prototype;N=new Request(r,c8(c8({},P),{},{signal:G,method:s.toUpperCase(),headers:S.normalize().toJSON(),body:a,duplex:"half",credentials:X?R:void 0}));let ee=await fetch(N);const he=nL&&(v==="stream"||v==="response");if(nL&&(m||he&&F)){const Te={};["status","statusText","headers"].forEach(ht=>{Te[ht]=ee[ht]});const ye=lt.toFiniteNumber(ee.headers.get("content-length")),[Ne,Ye]=m&&ZW(ye,xA(e8(m),!0))||[];ee=new Response(o8(ee.body,65536,Ne,()=>{Ye&&Ye(),F&&F()}),Te)}v=v||"text";let Se=await VA[lt.findKey(VA,v)||"text"](ee,t);return!he&&F&&F(),await new dt((Te,ye)=>{QW(Te,ye,{data:Se,headers:md.from(ee.headers),status:ee.status,statusText:ee.statusText,config:t,request:N})})}catch(X){throw F&&F(),X&&X.name==="TypeError"&&/fetch/i.test(X.message)?Object.assign(new rr("Network Error",rr.ERR_NETWORK,t,N),{cause:X.cause||X}):rr.from(X,X&&X.code,t,N)}});const rL={http:null,xhr:kpe,fetch:Gpe};lt.forEach(rL,(t,r)=>{if(t){try{Object.defineProperty(t,"name",{value:r})}catch{}Object.defineProperty(t,"adapterName",{value:r})}});const f8=t=>"- ".concat(t),Hpe=t=>lt.isFunction(t)||t===null||t===!1;var p8={getAdapter:t=>{t=lt.isArray(t)?t:[t];const{length:r}=t;let s,a;const c={};for(let u=0;u<r;u++){let h;if(s=t[u],a=s,!Hpe(s)&&(a=rL[(h=String(s)).toLowerCase()],a===void 0))throw new rr("Unknown adapter '".concat(h,"'"));if(a)break;c[h||"#"+u]=a}if(!a){const u=Object.entries(c).map(h=>{let[m,y]=h;return"adapter ".concat(m," ")+(y===!1?"is not supported by the environment":"is not available in the build")});throw new rr("There is no suitable adapter to dispatch the request "+(r?u.length>1?`since :
`+u.map(f8).join(`
`):" "+f8(u[0]):"as no adapter specified"),"ERR_NOT_SUPPORT")}return a},adapters:rL};function iL(t){if(t.cancelToken&&t.cancelToken.throwIfRequested(),t.signal&&t.signal.aborted)throw new Mv(null,t)}function m8(t){return iL(t),t.headers=md.from(t.headers),t.data=Jx.call(t,t.transformRequest),["post","put","patch"].indexOf(t.method)!==-1&&t.headers.setContentType("application/x-www-form-urlencoded",!1),p8.getAdapter(t.adapter||Yx.adapter)(t).then(function(r){return iL(t),r.data=Jx.call(t,t.transformResponse,r),r.headers=md.from(r.headers),r},function(r){return JW(r)||(iL(t),r&&r.response&&(r.response.data=Jx.call(t,t.transformResponse,r.response),r.response.headers=md.from(r.response.headers))),dt.reject(r)})}const g8="1.7.9",FA={};["object","boolean","number","function","string","symbol"].forEach((t,r)=>{FA[t]=function(s){return typeof s===t||"a"+(r<1?"n ":" ")+t}});const _8={};FA.transitional=function(t,r,s){function a(c,u){return"[Axios v"+g8+"] Transitional option '"+c+"'"+u+(s?". "+s:"")}return(c,u,h)=>{if(t===!1)throw new rr(a(u," has been removed"+(r?" in "+r:"")),rr.ERR_DEPRECATED);return r&&!_8[u]&&(_8[u]=!0,console.warn(a(u," has been deprecated since v"+r+" and will be removed in the near future"))),!t||t(c,u,h)}},FA.spelling=function(t){return(r,s)=>(console.warn("".concat(s," is likely a misspelling of ").concat(t)),!0)};var jA={assertOptions:function(t,r,s){if(typeof t!="object")throw new rr("options must be an object",rr.ERR_BAD_OPTION_VALUE);const a=Object.keys(t);let c=a.length;for(;c-- >0;){const u=a[c],h=r[u];if(h){const m=t[u],y=m===void 0||h(m,u,t);if(y!==!0)throw new rr("option "+u+" must be "+y,rr.ERR_BAD_OPTION_VALUE)}else if(s!==!0)throw new rr("Unknown option "+u,rr.ERR_BAD_OPTION)}},validators:FA};const yh=jA.validators;let BA=class{constructor(t){this.defaults=t,this.interceptors={request:new b6,response:new b6}}async request(t,r){try{return await this._request(t,r)}catch(s){if(s instanceof Error){let a={};Error.captureStackTrace?Error.captureStackTrace(a):a=new Error;const c=a.stack?a.stack.replace(/^.+\n/,""):"";try{s.stack?c&&!String(s.stack).endsWith(c.replace(/^.+\n.+\n/,""))&&(s.stack+=`
`+c):s.stack=c}catch{}}throw s}}_request(t,r){typeof t=="string"?(r=r||{}).url=t:r=t||{},r=U_(this.defaults,r);const{transitional:s,paramsSerializer:a,headers:c}=r;s!==void 0&&jA.assertOptions(s,{silentJSONParsing:yh.transitional(yh.boolean),forcedJSONParsing:yh.transitional(yh.boolean),clarifyTimeoutError:yh.transitional(yh.boolean)},!1),a!=null&&(lt.isFunction(a)?r.paramsSerializer={serialize:a}:jA.assertOptions(a,{encode:yh.function,serialize:yh.function},!0)),jA.assertOptions(r,{baseUrl:yh.spelling("baseURL"),withXsrfToken:yh.spelling("withXSRFToken")},!0),r.method=(r.method||this.defaults.method||"get").toLowerCase();let u=c&&lt.merge(c.common,c[r.method]);c&&lt.forEach(["delete","get","head","post","put","patch","common"],N=>{delete c[N]}),r.headers=md.concat(u,c);const h=[];let m=!0;this.interceptors.request.forEach(function(N){typeof N.runWhen=="function"&&N.runWhen(r)===!1||(m=m&&N.synchronous,h.unshift(N.fulfilled,N.rejected))});const y=[];let v;this.interceptors.response.forEach(function(N){y.push(N.fulfilled,N.rejected)});let S,R=0;if(!m){const N=[m8.bind(this),void 0];for(N.unshift.apply(N,h),N.push.apply(N,y),S=N.length,v=dt.resolve(r);R<S;)v=v.then(N[R++],N[R++]);return v}S=h.length;let P=r;for(R=0;R<S;){const N=h[R++],G=h[R++];try{P=N(P)}catch(F){G.call(this,F);break}}try{v=m8.call(this,P)}catch(N){return dt.reject(N)}for(R=0,S=y.length;R<S;)v=v.then(y[R++],y[R++]);return v}getUri(t){return S6(t8((t=U_(this.defaults,t)).baseURL,t.url),t.params,t.paramsSerializer)}};lt.forEach(["delete","get","head","options"],function(t){BA.prototype[t]=function(r,s){return this.request(U_(s||{},{method:t,url:r,data:(s||{}).data}))}}),lt.forEach(["post","put","patch"],function(t){function r(s){return function(a,c,u){return this.request(U_(u||{},{method:t,headers:s?{"Content-Type":"multipart/form-data"}:{},url:a,data:c}))}}BA.prototype[t]=r(),BA.prototype[t+"Form"]=r(!0)});var WA=BA;class sL{constructor(r){if(typeof r!="function")throw new TypeError("executor must be a function.");let s;this.promise=new dt(function(c){s=c});const a=this;this.promise.then(c=>{if(!a._listeners)return;let u=a._listeners.length;for(;u-- >0;)a._listeners[u](c);a._listeners=null}),this.promise.then=c=>{let u;const h=new dt(m=>{a.subscribe(m),u=m}).then(c);return h.cancel=function(){a.unsubscribe(u)},h},r(function(c,u,h){a.reason||(a.reason=new Mv(c,u,h),s(a.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(r){this.reason?r(this.reason):this._listeners?this._listeners.push(r):this._listeners=[r]}unsubscribe(r){if(!this._listeners)return;const s=this._listeners.indexOf(r);s!==-1&&this._listeners.splice(s,1)}toAbortSignal(){const r=new AbortController,s=a=>{r.abort(a)};return this.subscribe(s),r.signal.unsubscribe=()=>this.unsubscribe(s),r.signal}static source(){let r;return{token:new sL(function(a){r=a}),cancel:r}}}var $pe=sL;const oL={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(oL).forEach(t=>{let[r,s]=t;oL[s]=r});var Kpe=oL;const Zs=function t(r){const s=new WA(r),a=r6(WA.prototype.request,s);return lt.extend(a,WA.prototype,s,{allOwnKeys:!0}),lt.extend(a,s,null,{allOwnKeys:!0}),a.create=function(c){return t(U_(r,c))},a}(Yx);Zs.Axios=WA,Zs.CanceledError=Mv,Zs.CancelToken=$pe,Zs.isCancel=JW,Zs.VERSION=g8,Zs.toFormData=SA,Zs.AxiosError=rr,Zs.Cancel=Zs.CanceledError,Zs.all=function(t){return dt.all(t)},Zs.spread=function(t){return function(r){return t.apply(null,r)}},Zs.isAxiosError=function(t){return lt.isObject(t)&&t.isAxiosError===!0},Zs.mergeConfig=U_,Zs.AxiosHeaders=md,Zs.formToJSON=t=>YW(lt.isHTMLForm(t)?new FormData(t):t),Zs.getAdapter=p8.getAdapter,Zs.HttpStatusCode=Kpe,Zs.default=Zs;var la=Zs;const qpe=()=>{};function ST(){const t={promise:void 0,isResolved:!1,isRejected:!1,isFinished:!1,resolve:void 0,reject:void 0,cancel:qpe};return t.promise=new dt((r,s)=>{t.resolve=a=>{t.isFinished||(t.isResolved=!0,t.isFinished=!0,r(a),t.value=a)},t.reject=a=>{t.isFinished||(t.isRejected=!0,t.isFinished=!0,s(a))}}),t}const zA=new Map,GA=new Map,Eh=new Map;let Yi=function(t){return t.WIN_10="Windows 10",t.WIN_81="Windows 8.1",t.WIN_8="Windows 8",t.WIN_7="Windows 7",t.WIN_VISTA="Windows Vista",t.WIN_SERVER_2003="Windows Server 2003",t.WIN_XP="Windows XP",t.WIN_2000="Windows 2000",t.ANDROID="Android",t.HARMONY_OS="HarmonyOS",t.OPEN_BSD="Open BSD",t.SUN_OS="Sun OS",t.LINUX="Linux",t.IOS="iOS",t.MAC_OS="Mac OS",t.CHROMIUM_OS="Chromium OS",t.QNX="QNX",t.UNIX="UNIX",t.BEOS="BeOS",t.OS_2="OS/2",t.SEARCH_BOT="Search Bot",t}({}),zn=function(t){return t.CHROME="Chrome",t.SAFARI="Safari",t.EDGE="Edge",t.FIREFOX="Firefox",t.OPERA="OPR",t.QQ="QQBrowser",t.WECHAT="MicroMessenger",t}({});const y8=new dde;let gd=y8.getResult(),aL=null;function Nn(t){if(!aL){gd=y8.getResult();const r=function(m){if(m.engine.name==="Blink"&&m.browser.name!=="WeChat")return zn.CHROME;switch(m.browser.name){case"Chrome Headless":case"Chrome":case"Chromium":return zn.CHROME;case"Safari":case"Mobile Safari":return zn.SAFARI;case"Edge":return zn.EDGE;case"Firefox":return zn.FIREFOX;case"QQ":case"QQBrowser":return zn.QQ;case"Opera":return zn.OPERA;case"WeChat":return zn.WECHAT;default:return m.browser.name||""}}(gd),s=E8(gd),a=function(m){return m.os.name==="Windows"?m.os.version?m.os.name+" "+m.os.version:m.os.name:m.os.name||""}(gd),c=gd.os.version,u=E8(gd,!1),h=gd.device.type;if(!(r&&s&&a&&c))return{name:r,version:s,os:a,osVersion:c,browserVersion:u,deviceType:h};aL={name:r,version:s,os:a,osVersion:c,browserVersion:u,deviceType:h}}return aL}function E8(t){let r,s=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];return r=t.engine.name==="Blink"?t.engine.version||"":t.browser.version||"",s?r.split(".")[0]:r}function HA(){return Nn().os}function v8(){const t=Nn();return"".concat(t.os," ").concat(t.osVersion)}function $A(){const t=Nn();return!!(gd.engine.name==="WebKit"&&t.os===Yi.MAC_OS&&navigator.maxTouchPoints&&navigator.maxTouchPoints>0&&t.name!==zn.SAFARI||Lo()&&t.name!==zn.SAFARI)}function tp(){return Nn().name===zn.CHROME}function Ps(){return Nn().name===zn.SAFARI}function S8(){return Nn().name===zn.EDGE}function Br(){return Nn().name===zn.FIREFOX}function Lo(){return Nn().os===Yi.IOS}function bT(t){const r=Nn();return!(r.name!==zn.CHROME||!r.osVersion)&&Number(r.version)>=t}function b8(t){const r=Nn();return!(r.name!==zn.CHROME||!r.osVersion)&&Number(r.version)<t}function cL(t,r,s){const a=Nn();return!(a.name!==t||!a.osVersion)&&(s?Number(a.version)>=r&&Number(a.version)<=s:Number(a.version)===r)}function lL(t){const r=Nn();return!(r.name!==zn.EDGE||!r.osVersion)&&Number(r.version)>=t}function T8(t){const r=Nn();return!(r.name!==zn.SAFARI||!r.osVersion)&&Number(r.version)>=t}function w8(t,r,s){const a=Nn();if(a.os!==Yi.IOS||!a.osVersion)return!1;const c=a.osVersion.split(".");return r&&Number(c[0])===t&&Number(c[1])<r||Number(c[0])<t}function C8(t,r,s){const a=Nn();if(a.name!==zn.SAFARI||!a.osVersion||!a.browserVersion)return!1;const c=a.browserVersion.split(".");return s?r&&Number(c[0])===t&&Number(c[1])<r||Number(c[0])<t:r?Number(c[0])===t&&Number(c[1])<=r||Number(c[0])<t:Number(c[0])<=t}function uL(t){const r=Nn();return!(r.name!==zn.OPERA||!r.osVersion)&&Number(r.version)>=t}function R8(){const t=Nn();if(t.os!==Yi.IOS||!t.osVersion)return!1;const r=t.osVersion.split(".");return Number(r[0])<14||Number(r[0])===14&&Number(r[1])<=6}function Uv(){const t=Nn();if(t.os!==Yi.IOS||!t.osVersion)return!1;const r=t.osVersion.split(".");return Number(r[0])===15}function dL(){const t=Nn();if(t.os!==Yi.IOS||!t.osVersion)return!1;const r=t.osVersion.split(".");return Number(r[0])===16}function I8(){const t=Nn();if(t.os!==Yi.IOS||!t.osVersion)return!1;const r=t.osVersion.split(".");return Number(r[0])===15&&Number(r[1])>=1}function gu(){return Ps()&&navigator.maxTouchPoints>0}function A8(){return Nn().name===zn.WECHAT}function P8(){return window.navigator.appVersion&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)!==null&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]<=35}function hL(){const t=HA();return function(){const{deviceType:r}=Nn();return r==="mobile"||r==="tablet"}()||t===Yi.ANDROID||t===Yi.IOS||t===Yi.HARMONY_OS}function np(){const t=Nn();return t.name!==zn.EDGE&&t.name!==zn.SAFARI&&!!navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]./i)}function KA(){return HA()===Yi.ANDROID}function TT(){const t=Nn();return KA()&&(t.name===zn.CHROME||t.name===zn.WECHAT||/chrome|chromium/i.test(navigator.userAgent))}function O8(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}function gt(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?O8(Object(s),!0).forEach(function(a){Yt(t,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):O8(Object(s)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))})}return t}function Yt(t,r,s){return(r=function(a){var c=function(u,h){if(typeof u!="object"||u===null)return u;var m=u[Symbol.toPrimitive];if(m!==void 0){var y=m.call(u,"string");if(typeof y!="object")return y;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(u)}(a);return typeof c=="symbol"?c:String(c)}(r))in t?Object.defineProperty(t,r,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[r]=s,t}let te=function(t){return t.UNEXPECTED_ERROR="UNEXPECTED_ERROR",t.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",t.TIMEOUT="TIMEOUT",t.INVALID_PARAMS="INVALID_PARAMS",t.NOT_READABLE="NOT_READABLE",t.NOT_SUPPORTED="NOT_SUPPORTED",t.INVALID_OPERATION="INVALID_OPERATION",t.OPERATION_ABORTED="OPERATION_ABORTED",t.WEB_SECURITY_RESTRICT="WEB_SECURITY_RESTRICT",t.EXCHANGE_SDP_FAILED="EXCHANGE_SDP_FAILED",t.ADD_CANDIDATE_FAILED="ADD_CANDIDATE_FAILED",t.DATACHANNEL_FAILED="DATACHANNEL_FAILED",t.NETWORK_ERROR="NETWORK_ERROR",t.NETWORK_TIMEOUT="NETWORK_TIMEOUT",t.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",t.API_INVOKE_TIMEOUT="API_INVOKE_TIMEOUT",t.ENUMERATE_DEVICES_FAILED="ENUMERATE_DEVICES_FAILED",t.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",t.ELECTRON_IS_NULL="ELECTRON_IS_NULL",t.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",t.CHROME_PLUGIN_NO_RESPONSE="CHROME_PLUGIN_NO_RESPONSE",t.CHROME_PLUGIN_NOT_INSTALL="CHROME_PLUGIN_NOT_INSTALL",t.MEDIA_OPTION_INVALID="MEDIA_OPTION_INVALID",t.PERMISSION_DENIED="PERMISSION_DENIED",t.CONSTRAINT_NOT_SATISFIED="CONSTRAINT_NOT_SATISFIED",t.TRACK_IS_DISABLED="TRACK_IS_DISABLED",t.GET_VIDEO_ELEMENT_VISIBLE_ERROR="GET_VIDEO_ELEMENT_VISIBLE_ERROR",t.SHARE_AUDIO_NOT_ALLOWED="SHARE_AUDIO_NOT_ALLOWED",t.LOW_STREAM_ENCODING_ERROR="LOW_STREAM_ENCODING_ERROR",t.SET_ENCODING_PARAMETER_ERROR="SET_ENCODING_PARAMETER_ERROR",t.TRACK_STATE_UNREACHABLE="TRACK_STATE_UNREACHABLE",t.INVALID_UINT_UID_FROM_STRING_UID="INVALID_UINT_UID_FROM_STRING_UID",t.CAN_NOT_GET_PROXY_SERVER="CAN_NOT_GET_PROXY_SERVER",t.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER",t.VOID_GATEWAY_ADDRESS="VOID_GATEWAY_ADDRESS",t.UID_CONFLICT="UID_CONFLICT",t.MULTI_UNILBS_RESPONSE_ERROR="MULTI_UNILBS_RESPONSE_ERROR",t.UPDATE_TICKET_FAILED="UPDATE_TICKET_FAILED",t.TOKEN_EXPIRE="TOKEN_EXPIRE",t.INVALID_LOCAL_TRACK="INVALID_LOCAL_TRACK",t.INVALID_TRACK="INVALID_TRACK",t.SENDER_NOT_FOUND="SENDER_NOT_FOUND",t.CREATE_OFFER_FAILED="CREATE_OFFER_FAILED",t.SET_ANSWER_FAILED="SET_ANSWER_FAILED",t.ICE_FAILED="ICE_FAILED",t.PC_CLOSED="PC_CLOSED",t.SENDER_REPLACE_FAILED="SENDER_REPLACE_FAILED",t.GET_LOCAL_CAPABILITIES_FAILED="GET_LOCAL_CAPABILITIES_FAILED",t.GET_LOCAL_CONNECTION_PARAMS_FAILED="GET_LOCAL_CONNECTION_PARAMS_FAILED",t.SUBSCRIBE_FAILED="SUBSCRIBE_FAILED",t.UNSUBSCRIBE_FAILED="UNSUBSCRIBE_FAILED",t.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",t.NO_ICE_CANDIDATE="NO_ICE_CANDIDATE",t.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS",t.EXIST_DISABLED_VIDEO_TRACK="EXIST_DISABLED_VIDEO_TRACK",t.INVALID_REMOTE_USER="INVALID_REMOTE_USER",t.REMOTE_USER_IS_NOT_PUBLISHED="REMOTE_USER_IS_NOT_PUBLISHED",t.CUSTOM_REPORT_SEND_FAILED="CUSTOM_REPORT_SEND_FAILED",t.CUSTOM_REPORT_FREQUENCY_TOO_HIGH="CUSTOM_REPORT_FREQUENCY_TOO_HIGH",t.FETCH_AUDIO_FILE_FAILED="FETCH_AUDIO_FILE_FAILED",t.READ_LOCAL_AUDIO_FILE_ERROR="READ_LOCAL_AUDIO_FILE_ERROR",t.DECODE_AUDIO_FILE_FAILED="DECODE_AUDIO_FILE_FAILED",t.WS_ABORT="WS_ABORT",t.WS_DISCONNECT="WS_DISCONNECT",t.WS_ERR="WS_ERR",t.EXTERNAL_SIGNAL_ABORT="EXTERNAL_SIGNAL_ABORT",t.LIVE_STREAMING_TASK_CONFLICT="LIVE_STREAMING_TASK_CONFLICT",t.LIVE_STREAMING_INVALID_ARGUMENT="LIVE_STREAMING_INVALID_ARGUMENT",t.LIVE_STREAMING_INTERNAL_SERVER_ERROR="LIVE_STREAMING_INTERNAL_SERVER_ERROR",t.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED="LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED",t.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED="LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED",t.LIVE_STREAMING_CDN_ERROR="LIVE_STREAMING_CDN_ERROR",t.LIVE_STREAMING_INVALID_RAW_STREAM="LIVE_STREAMING_INVALID_RAW_STREAM",t.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT="LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT",t.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE="LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE",t.LIVE_STREAMING_WARN_FREQUENT_REQUEST="LIVE_STREAMING_WARN_FREQUENT_REQUEST",t.WEBGL_INTERNAL_ERROR="WEBGL_INTERNAL_ERROR",t.BEAUTY_PROCESSOR_INTERNAL_ERROR="BEAUTY_PROCESSOR_INTERNAL_ERROR",t.CROSS_CHANNEL_WAIT_STATUS_ERROR="CROSS_CHANNEL_WAIT_STATUS_ERROR",t.CROSS_CHANNEL_FAILED_JOIN_SRC="CROSS_CHANNEL_FAILED_JOIN_SEC",t.CROSS_CHANNEL_FAILED_JOIN_DEST="CROSS_CHANNEL_FAILED_JOIN_DEST",t.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST="CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST",t.CROSS_CHANNEL_SERVER_ERROR_RESPONSE="CROSS_CHANNEL_SERVER_ERROR_RESPONSE",t.METADATA_OUT_OF_RANGE="METADATA_OUT_OF_RANGE",t.LOCAL_AEC_ERROR="LOCAL_AEC_ERROR",t.INVALID_PLUGIN="INVALID_PLUGIN",t.DISCONNECT_P2P="DISCONNECT_P2P",t.CONVERTING_IMAGEDATA_TO_BLOB_FAILED="CONVERTING_IMAGEDATA_TO_BLOB_FAILED",t.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED="CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED",t.INIT_DATACHANNEL_TIMEOUT="INIT_DATACHANNEL_TIMEOUT",t.CREATE_DATACHANNEL_ERROR="CREATE_DATACHANNEL_ERROR",t.DATACHANNEL_CONNECTION_TIMEOUT="DATACHANNEL_CONNECTION_TIMEOUT",t.PROHIBITED_OPERATION="PROHIBITED_OPERATION",t.IMAGE_MODERATION_UPLOAD_FAILED="IMAGE_MODERATION_UPLOAD_FAILED",t.P2P_MESSAGE_FAILED="P2P_MESSAGE_FAILED",t}({}),Le=class extends Error{constructor(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",s=arguments.length>2?arguments[2]:void 0;super(r),Yt(this,"code",void 0),Yt(this,"message",void 0),Yt(this,"data",void 0),Yt(this,"name","AgoraRTCException"),this.code=t,this.message="AgoraRTCError ".concat(this.code,": ").concat(r),this.data=s}toString(){return this.data?"".concat(this.message,`
data: `).concat(JSON.stringify(this.data)):this.message}print(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error",r=arguments.length>1?arguments[1]:void 0;return t==="error"&&(r||console).error(this.toString()),t==="warning"&&(r||console).warn(this.toString()),this}throw(t){throw this.print("error",t),this}};function rp(t,r){if(typeof t!="boolean")throw new Le(te.INVALID_PARAMS,"Invalid ".concat(r,": The value is of the boolean type."))}function Bi(t,r,s){if(!ot(s).call(s,t))throw new Le(te.INVALID_PARAMS,"".concat(r," can only be set as ").concat(JSON.stringify(s)))}function ir(t,r){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1e4;if(t<s||t>a||(!(arguments.length>4&&arguments[4]!==void 0)||arguments[4])&&!function(c){return typeof c=="number"&&c%1==0}(t))throw new Le(te.INVALID_PARAMS,"invalid ".concat(r,": the value range is [").concat(s,", ").concat(a,"]. integer only"))}function fL(t,r){if(typeof t!="number"){if(!(t.min||t.max||t.ideal||t.exact))throw new Le(te.INVALID_PARAMS,"".concat(r," is not a valid ConstrainLong"));t.min!==void 0&&ir(t.min,"".concat(r,".min"),0,1/0),t.max!==void 0&&ir(t.max,"".concat(r,".max"),1,1/0),t.exact!==void 0&&ir(t.exact,"".concat(r,".exact"),1,1/0),t.ideal!==void 0&&ir(t.ideal,"".concat(r,".ideal"),1,1/0)}else ir(t,r,1,1/0)}function fs(t,r){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:255,c=!(arguments.length>4&&arguments[4]!==void 0)||arguments[4];if(t==null)throw new Le(te.INVALID_PARAMS,"".concat(r||"param"," cannot be empty"));if(!k8(t,s,a,c))throw new Le(te.INVALID_PARAMS,"Invalid ".concat(r||"string param",": Length of the string: [").concat(s,",").concat(a,"].").concat(c?" ASCII characters only.":""))}function ip(t,r){if(!Array.isArray(t))throw new Le(te.INVALID_PARAMS,"".concat(r," should be an array"))}function Wr(t){return t==null}function k8(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:255,a=!(arguments.length>3&&arguments[3]!==void 0)||arguments[3];return typeof t=="string"&&t.length<=s&&t.length>=r&&(!a||function(c){if(typeof c!="string")return!1;for(let u=0;u<c.length;u+=1){const h=c.charCodeAt(u);if(h<0||h>255)return!1}return!0}(t))}var wT=function(t){return t.COVERED="COVERED",t.POSITION="POSITION",t.SIZE="SIZE",t.STYLE="STYLE",t}(wT||{}),pL=function(t){return t.UNMOUNTED="UNMOUNTED",t.INVALID_HTML_ELEMENT="INVALID_HTML_ELEMENT",t}(pL||{});const N8=new class{constructor(){Yt(this,"_clientSize",null),Yt(this,"getClientWidth",()=>document.documentElement?document.documentElement.clientWidth:document.body.clientWidth),Yt(this,"getClientHeight",()=>document.documentElement?document.documentElement.clientHeight:document.body.clientHeight),Yt(this,"getStyle",t=>window.getComputedStyle(t,null)),Yt(this,"checkCssVisibleProperty",t=>{var r;let s=!0;const a=this.getStyle(t),{display:c,visibility:u,opacity:h,filter:m}=a;return(c==="none"||ot(r=["hidden","collapse"]).call(r,u)||Number(h)<.1)&&(s=!1),!!s&&(m&&m.split(" ").filter(y=>{var v;const S=y.split("(")[0];return ot(v=["brightness","blur","opacity"]).call(v,S)}).map(y=>{const[v,S]=y.split(/\(|\)/);return[v,Number(S.match(/^[0-9\.]+/))]}).forEach(y=>{const[v,S]=y;switch(v){case"brightness":(S<.1||S>3)&&(s=!1);break;case"blur":S>3&&(s=!1);break;case"opacity":S<.1&&(s=!1)}}),s)}),Yt(this,"checkPropertyUpToAllParentNodes",(t,r)=>{let s=!0,a=!0;const c=h=>r(h);let u=t;for(;u&&a;)c(u)||(s=!1,a=!1),u=u.parentElement,u||(a=!1);return s}),Yt(this,"checkActualCssVisibleIncludeInherit",t=>this.checkPropertyUpToAllParentNodes(t,this.checkCssVisibleProperty)),Yt(this,"getSizeAboutClient",t=>{const{width:r,height:s,left:a,right:c,top:u,bottom:h}=t.getBoundingClientRect(),m=this.getClientWidth(),y=this.getClientHeight();return{width:r,height:s,left:a,right:c,top:u,bottom:h,clientWidth:m,clientHeight:y,clientMin:Math.min(m,y)}}),Yt(this,"checkActualSize",()=>{const{width:t,height:r,clientMin:s}=this._clientSize;return this.checkSizeIsVisible(t,r,s)}),Yt(this,"elementFromPoint",(t,r)=>document.elementFromPoint?document.elementFromPoint(t,r):null),Yt(this,"checkCoverForAPoint",(t,r,s)=>{const a=this.elementFromPoint(t,r);return a!==null&&a!==s}),Yt(this,"getPointPositionList",()=>{const{width:t,height:r,left:s,top:a}=this._clientSize,c=t/6,u=r/6,h=[],m=10**6;for(let y=0;y<5;y++)for(let v=0;v<5;v++){const S=(s*m+(y===0?.1:y===4?(c*y*m-1e5)/m:c*y)*m)/m,R=(a*m+(v===0?.1:v===4?(u*v*m-1e5)/m:u*v)*m)/m;h.push({x:S,y:R})}return[...h]}),Yt(this,"checkElementCover",t=>this.getPointPositionList().map(r=>this.checkCoverForAPoint(r.x,r.y,t)).filter(r=>!!r).length>6),Yt(this,"checkSizeIsVisible",(t,r,s)=>(t>50||s/t<=10)&&(r>50||s/r<=10)),Yt(this,"checkSizeOfPartInClient",()=>{const{left:t,right:r,top:s,bottom:a,clientHeight:c,clientWidth:u,clientMin:h}=this._clientSize;let m,y,v,S;if(t<0)m=0;else{if(!(t<u))return!1;m=t}if(r<0)return!1;if(y=r<u?r:u,s<0)v=0;else{if(!(s<c))return!1;v=s}if(a<0)return!1;S=a<c?a:c;const R=y-m,P=S-v;return this.checkSizeIsVisible(R,P,h)}),Yt(this,"returnHiddenResult",t=>(this._clientSize=null,{visible:!1,reason:t})),Yt(this,"checkOneElementVisible",t=>{if(t instanceof HTMLElement){if(this.checkElementIsMountedOnDom(t)){if(this.checkActualCssVisibleIncludeInherit(t)){if(this._clientSize=this.getSizeAboutClient(t),this.checkElementCover(t))return this.returnHiddenResult(wT.COVERED);{const r=this.checkActualSize(),s=this.checkSizeOfPartInClient();return r&&!s?this.returnHiddenResult(wT.POSITION):r?(this._clientSize=null,{visible:!0}):this.returnHiddenResult(wT.SIZE)}}return this.returnHiddenResult(wT.STYLE)}return this.returnHiddenResult(pL.UNMOUNTED)}return this.returnHiddenResult(pL.INVALID_HTML_ELEMENT)}),Yt(this,"checkElementIsMountedOnDom",t=>this.checkPropertyUpToAllParentNodes(t,r=>r.nodeName.toUpperCase()!=="HTML"?r.parentElement!==null:!!document.documentElement))}};function mL(t){return new TextEncoder().encode(t)}const D8=function(t,r){const s=new Uint8Array(t.byteLength+r.byteLength);return s.set(new Uint8Array(t),0),s.set(new Uint8Array(r),t.byteLength),s},gL=async t=>function(r,s){let a="";return new Uint8Array(r).forEach(c=>{a+=c.toString(s).padStart(2,"0")}),a}(await crypto.subtle.digest("SHA-256",mL(t)),16);let Ur=class{constructor(){Yt(this,"_events",{}),Yt(this,"addListener",this.on)}getListeners(t){return this._events[t]?this._events[t].map(r=>r.listener):[]}on(t,r){this._events[t]||(this._events[t]=[]);const s=this._events[t];this._indexOfListener(s,r)===-1&&s.push({listener:r,once:!1})}once(t,r){this._events[t]||(this._events[t]=[]);const s=this._events[t];this._indexOfListener(s,r)===-1&&s.push({listener:r,once:!0})}off(t,r){if(!this._events[t])return;const s=this._events[t],a=this._indexOfListener(s,r);a!==-1&&s.splice(a,1),this._events[t].length===0&&delete this._events[t]}removeAllListeners(t){t?delete this._events[t]:this._events={}}emit(t){this._events[t]||(this._events[t]=[]);const r=this._events[t].map(u=>u);for(var s=arguments.length,a=new Array(s>1?s-1:0),c=1;c<s;c++)a[c-1]=arguments[c];for(let u=0;u<r.length;u+=1){const h=r[u];h.once&&this.off(t,h.listener),h.listener.apply(this,a||[])}}safeEmit(t){for(var r=arguments.length,s=new Array(r>1?r-1:0),a=1;a<r;a++)s[a-1]=arguments[a];[...this._events[t]||[]].forEach(c=>{c.once&&this.off(t,c.listener);try{c.listener.apply(this,s)}catch(u){console.error("safeEmit event:".concat(t," error ").concat(u==null?void 0:u.toString()))}})}_indexOfListener(t,r){let s=t.length;for(;s--;)if(t[s].listener===r)return s;return-1}},CT=null;function x8(){if(CT)return CT;if(window.electron)return CT=window.electron;if(!window.require)return null;try{return CT=window.require("electron"),CT}catch{return null}}let Ai=function(t){return t.CREATE_CLIENT="createClient",t.CHECK_SYSTEM_REQUIREMENTS="checkSystemRequirements",t.SET_AREA="setArea",t.PRELOAD="PRELOAD",t.CHECK_VIDEO_TRACK_IS_ACTIVE="checkVideoTrackIsActive",t.CHECK_AUDIO_TRACK_IS_ACTIVE="checkAudioTrackIsActive",t.CREATE_MIC_AUDIO_TRACK="createMicrophoneAudioTrack",t.CREATE_CUSTOM_AUDIO_TRACK="createCustomAudioTrack",t.CREATE_BUFFER_AUDIO_TRACK="createBufferSourceAudioTrack",t.CREATE_CAM_VIDEO_TRACK="createCameraVideoTrack",t.CREATE_CUSTOM_VIDEO_TRACK="createCustomVideoTrack",t.CREATE_MIC_AND_CAM_TRACKS="createMicrophoneAndCameraTracks",t.CREATE_SCREEN_VIDEO_TRACK="createScreenVideoTrack",t.SET_ENCRYPTION_CONFIG="Client.setEncryptionConfig",t.START_PROXY_SERVER="Client.startProxyServer",t.STOP_PROXY_SERVER="Client.stopProxyServer",t.SET_PROXY_SERVER="Client.setProxyServer",t.SET_TURN_SERVER="Client.setTurnServer",t.SET_CLIENT_ROLE="Client.setClientRole",t.SET_LOW_STREAM_PARAMETER="Client.setLowStreamParameter",t.ENABLE_DUAL_STREAM="Client.enableDualStream",t.DISABLE_DUAL_STREAM="Client.disableDualStream",t.JOIN="Client.join",t.LEAVE="Client.leave",t.PUBLISH="Client.publish",t.UNPUBLISH="Client.unpublish",t.SUBSCRIBE="Client.subscribe",t.MASS_SUBSCRIBE="Client.massSubscribe",t.MASS_UNSUBSCRIBE="Client.massUnsubscribe",t.UNSUBSCRIBE="Client.unsubscribe",t.RENEW_TOKEN="Client.renewToken",t.SET_REMOTE_VIDEO_STREAM_TYPE="Client.setRemoteVideoStreamType",t.SET_STREAM_FALLBACK_OPTION="Client.setStreamFallbackOption",t.ENABLE_AUDIO_VOLUME_INDICATOR="Client.enableAudioVolumeIndicator",t.SEND_CUSTOM_REPORT_MESSAGE="Client.sendCustomReportMessage",t.INSPECT_VIDEO_CONTENT="Client.inspectVideoContent",t.STOP_INSPECT_VIDEO_CONTENT="Client.stopInspectVideoContent",t.JOIN_FALLBACK_TO_PROXY="Client._joinFallbackToProxy",t.ON_LIVE_STREAM_WARNING="Client.onLiveStreamWarning",t.ON_LIVE_STREAM_ERROR="Client.onLiveStreamingError",t.START_LIVE_STREAMING="Client.startLiveStreaming",t.SET_LIVE_TRANSCODING="Client.setLiveTranscoding",t.STOP_LIVE_STREAMING="Client.stopLiveStreaming",t.START_CHANNEL_MEDIA_RELAY="Client.startChannelMediaRelay",t.UPDATE_CHANNEL_MEDIA_RELAY="Client.updateChannelMediaRelay",t.STOP_CHANNEL_MEDIA_RELAY="Client.stopChannelMediaRelay",t.REQUEST_CONFIG_DISTRIBUTE="_config-distribute-request",t.SET_CONFIG_DISTRIBUTE="_configDistribute",t.LOCAL_TRACK_SET_MUTED="LocalTrack.setMute",t.LOCAL_AUDIO_TRACK_PLAY="LocalAudioTrack.play",t.LOCAL_AUDIO_TRACK_PLAY_IN_ELEMENT="LocalAudioTrack.playInElement",t.LOCAL_AUDIO_TRACK_STOP="LocalAudioTrack.stop",t.LOCAL_AUDIO_TRACK_SET_VOLUME="LocalAudioTrack.setVolume",t.MIC_AUDIO_TRACK_SET_DEVICE="MicrophoneAudioTrack.setDevice",t.BUFFER_AUDIO_TRACK_START="BufferSourceAudioTrack.startProcessAudioBuffer",t.BUFFER_AUDIO_TRACK_STOP="BufferSourceAudioTrack.stopProcessAudioBuffer",t.BUFFER_AUDIO_TRACK_PAUSE="BufferSourceAudioTrack.pauseProcessAudioBuffer",t.BUFFER_AUDIO_TRACK_RESUME="BufferSourceAudioTrack.resumeProcessAudioBuffer",t.BUFFER_AUDIO_TRACK_SEEK="BufferSourceAudioTrack.seekAudioBuffer",t.LOCAL_VIDEO_TRACK_PLAY="LocalVideoTrack.play",t.LOCAL_VIDEO_TRACK_STOP="LocalVideoTrack.stop",t.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE="LocalVideoTrack.getVideoElementVisibleStatus",t.LOCAL_VIDEO_TRACK_BEAUTY="LocalVideoTrack.setBeautyEffect",t.LOCAL_VIDEO_SEND_SEI_DATA="LocalVideoTrack.sendSeiData",t.CAM_VIDEO_TRACK_SET_DEVICE="CameraVideoTrack.setDevice",t.CAM_VIDEO_TRACK_SET_ENCODER_CONFIG="CameraVideoTrack.setEncoderConfiguration",t.REMOTE_VIDEO_TRACK_PLAY="RemoteVideoTrack.play",t.REMOTE_VIDEO_TRACK_STOP="RemoteVideoTrack.stop",t.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE="RemoteVideoTrack.getVideoElementVisibleStatus",t.REMOTE_AUDIO_TRACK_PLAY="RemoteAudioTrack.play",t.REMOTE_AUDIO_TRACK_STOP="RemoteAudioTrack.stop",t.REMOTE_AUDIO_SET_VOLUME="RemoteAudioTrack.setVolume",t.REMOTE_AUDIO_SET_OUTPUT_DEVICE="RemoteAudioTrack.setOutputDevice",t.GET_MEDIA_STREAM_TRACK="Track.getMediaStreamTrack",t.STREAM_TYPE_CHANGE="streamTypeChange",t.CONNECTION_STATE_CHANGE="connectionStateChange",t.LOAD_CONFIG_FROM_LOCALSTORAGE="loadConfigFromLocalStorage",t.IMAGE_MODERATION_UPLOAD="imageModerationUpload",t.REPUB_AFTER_PC_CONNECTED="repubAfterPCConnected",t}({}),zr=function(t){return t.TRACER="tracer",t}({});function L8(t){return ir(t.timeout,"config.timeout",0,1e5),ir(t.timeoutFactor,"config.timeoutFactor",0,100,!1),ir(t.maxRetryCount,"config.maxRetryConfig",0,1/0),ir(t.maxRetryTimeout,"config.maxRetryTimeout",0,1/0),!0}let Ype=function(t){return t[t.AUDIENCE_LEVEL_LOW_LATENCY=1]="AUDIENCE_LEVEL_LOW_LATENCY",t[t.AUDIENCE_LEVEL_ULTRA_LOW_LATENCY=2]="AUDIENCE_LEVEL_ULTRA_LOW_LATENCY",t[t.AUDIENCE_LEVEL_SYNC_LATENCY=3]="AUDIENCE_LEVEL_SYNC_LATENCY",t}({}),Kn=function(t){return t.LEAVE="LEAVE",t.NETWORK_ERROR="NETWORK_ERROR",t.SERVER_ERROR="SERVER_ERROR",t.UID_BANNED="UID_BANNED",t.FALLBACK="FALLBACK",t.IP_BANNED="IP_BANNED",t.CHANNEL_BANNED="CHANNEL_BANNED",t.LICENSE_MISSING="LICENSE_MISSING",t.LICENSE_EXPIRED="LICENSE_EXPIRED",t.LICENSE_MINUTES_EXCEEDED="LICENSE_MINUTES_EXCEEDED",t.LICENSE_PERIOD_INVALID="LICENSE_PERIOD_INVALID",t.LICENSE_MULTIPLE_SDK_SERVICE="LICENSE_MULTIPLE_SDK_SERVICE",t.LICENSE_ILLEGAL="LICENSE_ILLEGAL",t.TOKEN_EXPIRE="TOKEN_EXPIRE",t}({});function RT(t){if(!Array.isArray(t)||t.length<1)return!1;try{t.forEach(r=>{if(!r.urls)throw Error()})}catch{return!1}return!0}function M8(t){return fs(t.turnServerURL,"turnServerURL"),fs(t.username,"username"),fs(t.password,"password"),t.udpport&&ir(t.udpport,"udpport",1,99999,!0),t.forceturn&&rp(t.forceturn,"forceturn"),t.security&&rp(t.security,"security"),t.tcpport&&ir(t.tcpport,"tcpport",1,99999,!0),!0}function _L(t){return t.level!==void 0&&Bi(t.level,"level",[1,2,3]),t.delay!==void 0&&ir(t.delay,"delay",0,3e3,!0),!0}let yn=function(t){return t.PEERCONNECTION_STATE_CHANGE="peerconnection-state-change",t.AUDIO_METADATA="audio-metadata",t.CONNECTION_STATE_CHANGE="connection-state-change",t.MEDIA_RECONNECT_START="media-reconnect-start",t.MEDIA_RECONNECT_END="media-reconnect-end",t.IS_USING_CLOUD_PROXY="is-using-cloud-proxy",t.USER_JOINED="user-joined",t.USER_LEAVED="user-left",t.USER_PUBLISHED="user-published",t.USER_UNPUBLISHED="user-unpublished",t.USER_INFO_UPDATED="user-info-updated",t.CLIENT_BANNED="client-banned",t.CHANNEL_MEDIA_RELAY_STATE="channel-media-relay-state",t.CHANNEL_MEDIA_RELAY_EVENT="channel-media-relay-event",t.VOLUME_INDICATOR="volume-indicator",t.CRYPT_ERROR="crypt-error",t.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="token-privilege-will-expire",t.ON_TOKEN_PRIVILEGE_DID_EXPIRE="token-privilege-did-expire",t.NETWORK_QUALITY="network-quality",t.STREAM_TYPE_CHANGED="stream-type-changed",t.STREAM_FALLBACK="stream-fallback",t.RECEIVE_METADATA="receive-metadata",t.STREAM_MESSAGE="stream-message",t.LIVE_STREAMING_ERROR="live-streaming-error",t.LIVE_STREAMING_WARNING="live-streaming-warning",t.EXCEPTION="exception",t.ERROR="error",t.P2P_LOST="p2p_lost",t.JOIN_FALLBACK_TO_PROXY="join-fallback-to-proxy",t.CHANNEL_FALLBACK_TO_WEBSOCKET="channel-fallback-to-websocket",t.MEDIA_CONNECTION_TYPE_CHANGE="media-connection-type-change",t.PUBLISHED_USER_LIST="published-user-list",t.CONTENT_INSPECT_CONNECTION_STATE_CHANGE="content-inspect-connection-state-change",t.CONTENT_INSPECT_ERROR="content-inspect-error",t.CONTENT_INSPECT_RESULT="content-inspect-result",t.IMAGE_MODERATION_CONNECTION_STATE_CHANGE="image-moderation-connection-state-change",t}({}),Os=function(t){return t.NETWORK_ERROR="NETWORK_ERROR",t.SERVER_ERROR="SERVER_ERROR",t.MULTI_IP="MULTI_IP",t.TIMEOUT="TIMEOUT",t.OFFLINE="OFFLINE",t.LEAVE="LEAVE",t.P2P_FAILED="P2P_FAILED",t.FALLBACK="FALLBACK",t.REGIONAL_DISTRIBUTION="REGIONAL_DISTRIBUTION",t}({}),gc=function(t){return t.ONLINE="ONLINE",t.OFFLINE="OFFLINE",t}({}),Vv=function(t){return t.NETWORK_STATE_CHANGE="NETWORK_STATE_CHANGE",t.ONLINE="ONLINE",t.OFFLINE="OFFLINE",t}({});function ks(t,r){for(var s=arguments.length,a=new Array(s>2?s-2:0),c=2;c<s;c++)a[c-2]=arguments[c];return t.getListeners(r).length===0?dt.reject(new Le(te.UNEXPECTED_ERROR,"can not emit promise")):new dt((u,h)=>{t.emit(r,...a,u,h)})}function ur(t,r){if(t.getListeners(r).length===0)return dt.resolve();for(var s=arguments.length,a=new Array(s>2?s-2:0),c=2;c<s;c++)a[c-2]=arguments[c];return ks(t,r,...a)}function Hc(t,r){if(t.getListeners(r).length===0)return null;for(var s=arguments.length,a=new Array(s>2?s-2:0),c=2;c<s;c++)a[c-2]=arguments[c];return IT(t,r,...a)}function IT(t,r){let s=null,a=null;for(var c=arguments.length,u=new Array(c>2?c-2:0),h=2;h<c;h++)u[h-2]=arguments[h];if(t.emit(r,...u,m=>{s=m},m=>{a=m}),a!==null)throw a;if(s===null)throw new Le(te.UNEXPECTED_ERROR,"handler is not sync");return s}const yi=new class extends Ur{set networkState(t){this.emit(Vv.NETWORK_STATE_CHANGE,t,this._networkState),t===gc.ONLINE?this.emit(Vv.ONLINE):t===gc.OFFLINE&&(this.onlineWaiter=new dt(r=>{this.once(Vv.ONLINE,()=>{this.onlineWaiter=void 0,r(gc.ONLINE)})}),this.emit(Vv.OFFLINE)),this._networkState=t}get networkState(){return this._networkState}get isOnline(){return this._networkState===gc.ONLINE}constructor(){super(),Yt(this,"_moduleName","network-indicator"),Yt(this,"_networkState",gc.ONLINE),Yt(this,"onlineWaiter",void 0),window.addEventListener("online",()=>{this.networkState=gc.ONLINE}),window.addEventListener("offline",()=>{this.networkState=gc.OFFLINE})}};function qA(t,r){const s=t.indexOf(r);s!==-1&&t.splice(s,1)}function Fv(t){const r=[];return t.forEach(s=>{r.indexOf(s)===-1&&r.push(s)}),r}function YA(t){dt!==void 0?dt.resolve().then(t):setTimeout(t,0)}function Gr(t){return JSON.parse(JSON.stringify(t))}function V_(t){try{return Gr(t)}catch{return t}}const U8={};function Fm(t,r){U8[r]||(U8[r]=!0,t())}function F_(t){const r=window.atob(t),s=new Uint8Array(new ArrayBuffer(r.length));for(let a=0;a<r.length;a+=1)s[a]=r.charCodeAt(a);return s}function jm(t){let r="";for(let s=0;s<t.length;s+=1)r+=String.fromCharCode(t[s]);return window.btoa(r)}function V8(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:16,s=new TextEncoder().encode(t);if(s.length>r)s=s.slice(0,r);else if(s.length<r){const a=new Uint8Array(r);a.set(s),s=a}return s}function F8(){for(var t=arguments.length,r=new Array(t),s=0;s<t;s++)r[s]=arguments[s];const a=lc(r).call(r,(h,m)=>h+m.length,0),c=new Uint8Array(new ArrayBuffer(a));let u=0;return r.forEach(h=>{c.set(h,u),u+=h.length}),c}function vh(t){return window.TextEncoder?new TextEncoder().encode(t).length:t.length}function j8(t){let r=0;return(/DingTalk/i.test(navigator.userAgent)||/AliApp/i.test(navigator.userAgent))&&t.realFormData&&(t=t.realFormData),t.forEach(s=>{r+=typeof s=="string"?vh(s):s.size}),r+138}function Xpe(t){const r=new Le(te.TIMEOUT,"timeout");return new dt((s,a)=>{window.setTimeout(()=>a(r),t)})}function ps(t){return new dt(r=>{window.setTimeout(r,t)})}function dr(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:7,r=arguments.length>1?arguments[1]:void 0;const s=Math.random().toString(16).substr(2,t).toLowerCase();return s.length===t?"".concat(r).concat(s):"".concat(r).concat(s)+dr(t-s.length,"")}function j_(){return dr(32,"").toUpperCase()}const XA=()=>{},B8=new class{constructor(){Yt(this,"fnMap",new Map)}throttleByKey(t,r,s,a){for(var c=arguments.length,u=new Array(c>4?c-4:0),h=4;h<c;h++)u[h-4]=arguments[h];if(this.fnMap.has(r)){const m=this.fnMap.get(r);if(m.threshold!==s){m.fn(...m.args),clearTimeout(m.timer);const y=window.setTimeout(()=>{const v=this.fnMap.get(r);v&&v.fn(...v.args),this.fnMap.delete(r)},s);this.fnMap.set(r,{fn:t,threshold:s,timer:y,args:u,skipFn:a})}else m.skipFn&&m.skipFn(...m.args),this.fnMap.set(r,gt(gt({},m),{},{fn:t,args:u,skipFn:a}))}else{const m=window.setTimeout(()=>{const y=this.fnMap.get(r);y&&y.fn(...y.args),this.fnMap.delete(r)},s);this.fnMap.set(r,{fn:t,threshold:s,timer:m,args:u,skipFn:a})}}},W8=B8.throttleByKey.bind(B8);function z8(t){return typeof t=="object"&&t!==null&&!(t instanceof RegExp)}function yL(t,r){if(!z8(t)||!z8(r)||Array.isArray(t)&&!Array.isArray(r)||!Array.isArray(t)&&Array.isArray(r))return r;if(Array.isArray(r)&&Array.isArray(t)){const s=[...t];for(let a=0;a<r.length;a++)s[a]=yL(t[a],r[a]);return s}{const s=gt({},t);for(const a in r)Object.prototype.hasOwnProperty.call(r,a)&&(Object.prototype.hasOwnProperty.call(t,a)?s[a]=yL(t[a],r[a]):s[a]=r[a]);return s}}function G8(t,r){let s=[0];if(s=new Array(r).fill(0),t===0)return s;let a=0;for(;t>0&&(s[a]=255&t,t>>=8,a++,a!==r););return s}function EL(t){return typeof t=="number"?t:t.exact||t.ideal||t.max||t.min||0}function H8(t){const r="0123456789abcdef";function s(he){let Se,Te="";for(Se=0;Se<=3;Se++)Te+=r.charAt(he>>8*Se+4&15)+r.charAt(he>>8*Se&15);return Te}function a(he,Se){const Te=(65535&he)+(65535&Se);return(he>>16)+(Se>>16)+(Te>>16)<<16|65535&Te}function c(he,Se,Te,ye,Ne,Ye){return a(function(ht,mt){return ht<<mt|ht>>>32-mt}(a(a(Se,he),a(ye,Ye)),Ne),Te)}function u(he,Se,Te,ye,Ne,Ye,ht){return c(Se&Te|~Se&ye,he,Se,Ne,Ye,ht)}function h(he,Se,Te,ye,Ne,Ye,ht){return c(Se&ye|Te&~ye,he,Se,Ne,Ye,ht)}function m(he,Se,Te,ye,Ne,Ye,ht){return c(Se^Te^ye,he,Se,Ne,Ye,ht)}function y(he,Se,Te,ye,Ne,Ye,ht){return c(Te^(Se|~ye),he,Se,Ne,Ye,ht)}const v=function(he){let Se;const Te=1+(he.length+8>>6),ye=new Array(16*Te);for(Se=0;Se<16*Te;Se++)ye[Se]=0;for(Se=0;Se<he.length;Se++)ye[Se>>2]|=he.charCodeAt(Se)<<Se%4*8;return ye[Se>>2]|=128<<Se%4*8,ye[16*Te-2]=8*he.length,ye}(t);let S,R,P,N,G,F=1732584193,j=-271733879,X=-1732584194,ee=271733878;for(S=0;S<v.length;S+=16)R=F,P=j,N=X,G=ee,F=u(F,j,X,ee,v[S+0],7,-680876936),ee=u(ee,F,j,X,v[S+1],12,-389564586),X=u(X,ee,F,j,v[S+2],17,606105819),j=u(j,X,ee,F,v[S+3],22,-1044525330),F=u(F,j,X,ee,v[S+4],7,-176418897),ee=u(ee,F,j,X,v[S+5],12,1200080426),X=u(X,ee,F,j,v[S+6],17,-1473231341),j=u(j,X,ee,F,v[S+7],22,-45705983),F=u(F,j,X,ee,v[S+8],7,1770035416),ee=u(ee,F,j,X,v[S+9],12,-1958414417),X=u(X,ee,F,j,v[S+10],17,-42063),j=u(j,X,ee,F,v[S+11],22,-1990404162),F=u(F,j,X,ee,v[S+12],7,1804603682),ee=u(ee,F,j,X,v[S+13],12,-40341101),X=u(X,ee,F,j,v[S+14],17,-1502002290),j=u(j,X,ee,F,v[S+15],22,1236535329),F=h(F,j,X,ee,v[S+1],5,-165796510),ee=h(ee,F,j,X,v[S+6],9,-1069501632),X=h(X,ee,F,j,v[S+11],14,643717713),j=h(j,X,ee,F,v[S+0],20,-373897302),F=h(F,j,X,ee,v[S+5],5,-701558691),ee=h(ee,F,j,X,v[S+10],9,38016083),X=h(X,ee,F,j,v[S+15],14,-660478335),j=h(j,X,ee,F,v[S+4],20,-405537848),F=h(F,j,X,ee,v[S+9],5,568446438),ee=h(ee,F,j,X,v[S+14],9,-1019803690),X=h(X,ee,F,j,v[S+3],14,-187363961),j=h(j,X,ee,F,v[S+8],20,1163531501),F=h(F,j,X,ee,v[S+13],5,-1444681467),ee=h(ee,F,j,X,v[S+2],9,-51403784),X=h(X,ee,F,j,v[S+7],14,1735328473),j=h(j,X,ee,F,v[S+12],20,-1926607734),F=m(F,j,X,ee,v[S+5],4,-378558),ee=m(ee,F,j,X,v[S+8],11,-2022574463),X=m(X,ee,F,j,v[S+11],16,1839030562),j=m(j,X,ee,F,v[S+14],23,-35309556),F=m(F,j,X,ee,v[S+1],4,-1530992060),ee=m(ee,F,j,X,v[S+4],11,1272893353),X=m(X,ee,F,j,v[S+7],16,-155497632),j=m(j,X,ee,F,v[S+10],23,-1094730640),F=m(F,j,X,ee,v[S+13],4,681279174),ee=m(ee,F,j,X,v[S+0],11,-358537222),X=m(X,ee,F,j,v[S+3],16,-722521979),j=m(j,X,ee,F,v[S+6],23,76029189),F=m(F,j,X,ee,v[S+9],4,-640364487),ee=m(ee,F,j,X,v[S+12],11,-421815835),X=m(X,ee,F,j,v[S+15],16,530742520),j=m(j,X,ee,F,v[S+2],23,-995338651),F=y(F,j,X,ee,v[S+0],6,-198630844),ee=y(ee,F,j,X,v[S+7],10,1126891415),X=y(X,ee,F,j,v[S+14],15,-1416354905),j=y(j,X,ee,F,v[S+5],21,-57434055),F=y(F,j,X,ee,v[S+12],6,1700485571),ee=y(ee,F,j,X,v[S+3],10,-1894986606),X=y(X,ee,F,j,v[S+10],15,-1051523),j=y(j,X,ee,F,v[S+1],21,-2054922799),F=y(F,j,X,ee,v[S+8],6,1873313359),ee=y(ee,F,j,X,v[S+15],10,-30611744),X=y(X,ee,F,j,v[S+6],15,-1560198380),j=y(j,X,ee,F,v[S+13],21,1309151649),F=y(F,j,X,ee,v[S+4],6,-145523070),ee=y(ee,F,j,X,v[S+11],10,-1120210379),X=y(X,ee,F,j,v[S+2],15,718787259),j=y(j,X,ee,F,v[S+9],21,-343485551),F=a(F,R),j=a(j,P),X=a(X,N),ee=a(ee,G);return s(F)+s(j)+s(X)+s(ee)}let Jpe=1,$8=console,js=class{static setLogger(t){$8=t}constructor(t,r){Yt(this,"id",void 0),Yt(this,"lockingPromise",dt.resolve()),Yt(this,"locks",0),Yt(this,"name",""),Yt(this,"lockId",void 0),this.lockId=Jpe++,t&&(this.name=t),r&&(this.id=r),this.logger("created")}logger(t,r){const s=(this.id?"[".concat(this.id,"]"):"")+"[lock-".concat(this.name,"-").concat(this.lockId,"]"),a=t==="created"?"is ".concat(t,"."):"is ".concat(t,", current queue ").concat(this.locks,". ").concat(r??"");$8.debug("".concat(s," ").concat(a))}setId(t){this.id=t}get isLocked(){return this.locks>0}lock(t){let r;this.locks+=1,this.logger("locked",t);const s=new dt(c=>{r=()=>{this.locks-=1,this.logger("unlocked",t),c()}}),a=this.lockingPromise.then(()=>r);return this.lockingPromise=this.lockingPromise.then(()=>s),a}};function jv(t,r){return function(s,a,c){const u=c.value;if(typeof u!="function")throw new Error("Cannot use mutex on object property.");return c.value=async function(){const h=this[r];if(!h)throw new Error("mutex property key ".concat(r," doesn't exist on ").concat(t));const m=await h.lock("From ".concat(t,".").concat(a));try{for(var y=arguments.length,v=new Array(y),S=0;S<y;S++)v[S]=arguments[S];return await u.apply(this,v)}finally{m()}},c}}const Pi={timeout:500,timeoutFactor:1.5,maxRetryCount:1/0,maxRetryTimeout:1e4};function vL(t,r){const s=Math.floor(r.timeout*Math.pow(r.timeoutFactor,t));return Math.min(r.maxRetryTimeout,s)}function _d(t,r,s,a){const c=Object.assign({},Pi,a);let u=c.timeout;const h=async()=>{await function(v){return new dt(S=>{window.setTimeout(S,v)})}(u),u*=c.timeoutFactor,u=Math.min(c.maxRetryTimeout,u)};let m=!1;const y=new dt(async(v,S)=>{r=r||(()=>!1),s=s||(()=>!0);for(let R=0;R<c.maxRetryCount;R+=1){if(m)return S(new Le(te.OPERATION_ABORTED));try{const P=await t();if(!r(P,R)||R+1===c.maxRetryCount)return v(P);await h()}catch(P){if(!s(P,R)||R+1===c.maxRetryCount)return S(P);await h()}}});return y.cancel=()=>m=!0,y}let JA,K8=class{constructor(t){Yt(this,"input",[]),Yt(this,"size",void 0),this.size=t}add(t){this.input.push(t),this.input.length>this.size&&this.input.splice(0,1)}mean(){var t;return this.input.length===0?0:lc(t=this.input).call(t,(r,s)=>r+s)/this.input.length}},QA=0,SL=0;function bL(t,r,s,a){return new dt((c,u)=>{r.responseType=r.responseType||"json",r.data&&!s?(r.data=JSON.stringify(r.data),QA+=vh(r.data)):s&&(r.data.size?QA+=r.data.size:r.data instanceof FormData?QA+=j8(r.data):QA+=vh(JSON.stringify(r.data))),r.headers=r.headers||{},r.headers["Content-Type"]=r.headers["Content-Type"]||"application/json",r.method="POST",r.url=t,la.request(r).then(h=>{typeof h.data=="string"?SL+=vh(h.data):h.data instanceof ArrayBuffer||h.data instanceof Uint8Array?SL+=h.data.byteLength:SL+=vh(JSON.stringify(h.data)),c(h.data)}).catch(h=>{la.isCancel(h)?u(new Le(te.OPERATION_ABORTED,"cancel token canceled")):h.code==="ECONNABORTED"?u(new Le(te.NETWORK_TIMEOUT,h.message)):h.response?u(new Le(te.NETWORK_RESPONSE_ERROR,h.response.status)):u(new Le(te.NETWORK_ERROR,h.message))})})}async function Qpe(t,r){const s=new Blob([r.data],{type:"buffer"});return await bL(t,gt(gt({},r),{},{data:s,headers:{"Content-Type":"application/octet-stream"}}),!0)}const q8=()=>window.isSecureContext!==void 0;function _u(t){if(Array.isArray(t))return t.map(s=>s);if(!Y8(t))return t;const r={};for(const s in t){const a=t[s];Y8(a)||Array.isArray(a)?r[s]=_u(a):r[s]=a}return r}function Y8(t){return!(typeof t!="object"||Array.isArray(t)||!t)}let TL=class{constructor(t){Yt(this,"input",[]),Yt(this,"size",void 0),this.size=t}add(t){this.input.push(t),this.input.length>this.size&&this.input.splice(0,1)}diffMean(){return this.input.length===0?0:(this.input[this.input.length-1]-this.input[0])/this.input.length}};const Sh={address:"unknown",candidateType:"unknown",id:"unknown",port:0,priority:0,protocol:"unknown",type:"unknown"},AT={timestamp:0,bitrate:{actualEncoded:0,transmit:0},sendPacketLossRate:0,recvPacketLossRate:0,videoRecv:[],videoSend:[],audioRecv:[],audioSend:[],selectedCandidatePair:{id:"unknown",localCandidate:Sh,remoteCandidate:Sh},updateInterval:0},X8={firsCount:0,nacksCount:0,plisCount:0,framesDecodeCount:0,framesDecodeInterval:0,framesDecodeFreezeTime:0,decodeFrameRate:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,qpSumPerFrame:0,framesDroppedCount:0,outputFrameRate:0,packetsDiscarded:0,framesAssembledFromMultiplePackets:0,totalProcessingDelay:0,avgDecodeMs:0,avgFramesAssembledFromMultiplePacketsMs:0,avgProcessingDelayMs:0,avgInterFrameDelayMs:0,totalAssemblyTime:0},J8={firsCount:0,nacksCount:0,plisCount:0,frameCount:0,bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0,qpSumPerFrame:0},Q8={bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0},Z8={jitterBufferMs:0,jitterMs:0,bytes:0,packetsLost:0,packetLostRate:0,packetsDiscarded:0,packets:0,ssrc:0,receivedFrames:0,droppedFrames:0,concealedSamples:0,totalSamplesReceived:0};let wL=class{constructor(t,r){Yt(this,"onFirstVideoReceived",void 0),Yt(this,"onFirstVideoDecoded",void 0),Yt(this,"onFirstAudioReceived",void 0),Yt(this,"onFirstVideoDecodedTimeout",void 0),Yt(this,"onFirstAudioDecoded",void 0),Yt(this,"onSelectedLocalCandidateChanged",void 0),Yt(this,"onSelectedRemoteCandidateChanged",void 0),Yt(this,"videoIsReady",!1),Yt(this,"videoIsReady2",{}),Yt(this,"pc",void 0),Yt(this,"options",void 0),Yt(this,"intervalTimer",void 0),Yt(this,"stats",_u(AT)),Yt(this,"isFirstVideoReceived",{}),Yt(this,"isFirstVideoDecoded",{}),Yt(this,"isFirstAudioReceived",{}),Yt(this,"isFirstAudioDecoded",{}),Yt(this,"isFirstVideoDecodedTimeout",{}),Yt(this,"lossRateWindowStats",[]),this.pc=t,this.options=r,this.intervalTimer=window.setInterval(async()=>{this.updateStats()},this.options.updateInterval)}getStats(){return this.stats}getSelectedCandidatePair(){return new dt(t=>{t({local:gt({},Sh),remote:gt({},Sh)})})}setVideoIsReady(t){this.videoIsReady=t}setVideoIsReady2(t,r){this.videoIsReady2[t]=r}getVideoIsReady(t){return this.videoIsReady2[t]||!1}setIsFirstAudioDecoded(t){}destroy(){window.clearInterval(this.intervalTimer),this.pc=void 0}calcLossRate(t){this.lossRateWindowStats.push(t),this.lossRateWindowStats.length>this.options.lossRateInterval&&this.lossRateWindowStats.splice(0,1);const r=this.lossRateWindowStats.length,s=["videoSend","audioSend","videoRecv","audioRecv"];let a=0,c=0,u=0,h=0;for(const m of s)t[m].forEach((y,v)=>{if(!this.lossRateWindowStats[r-1][m][v]||!this.lossRateWindowStats[0][m][v])return;const S=this.lossRateWindowStats[r-1][m][v].packets-this.lossRateWindowStats[0][m][v].packets,R=this.lossRateWindowStats[r-1][m][v].packetsLost-this.lossRateWindowStats[0][m][v].packetsLost;m==="videoSend"||m==="audioSend"?(a+=S,u+=R):(c+=S,h+=R),Number.isNaN(S)||Number.isNaN(S)?y.packetLostRate=0:y.packetLostRate=S<=0||R<=0?0:R/(S+R)});t.sendPacketLossRate=a<=0||u<=0?0:u/(a+u),t.recvPacketLossRate=c<=0||h<=0?0:h/(c+h)}},Zpe=class extends wL{constructor(){super(...arguments),Yt(this,"_stats",AT),Yt(this,"lastDecodeVideoReceiverStats",new Map)}async updateStats(){const t=await this._getStats(),r=this.statsResponsesToObjects(t);this._stats=_u(AT);const s=r.filter(c=>c.type==="ssrc");this.processSSRCStats(s);const a=r.find(c=>c.type==="VideoBwe");a&&this.processBandwidthStats(a),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}processBandwidthStats(t){this._stats.bitrate={actualEncoded:Number(t.googActualEncBitrate),targetEncoded:Number(t.googTargetEncBitrate),retransmit:Number(t.googRetransmitBitrate),transmit:Number(t.googTransmitBitrate)},this._stats.sendBandwidth=Number(t.googAvailableSendBandwidth)}processSSRCStats(t){t.forEach(r=>{var s;const a=ot(s=r.id).call(s,"send");switch("".concat(r.mediaType,"_").concat(a?"send":"recv")){case"video_send":{const c=_u(J8);c.codec=r.googCodecName,c.adaptionChangeReason="none",r.googCpuLimitedResolution&&(c.adaptionChangeReason="cpu"),r.googBandwidthLimitedResolution&&(c.adaptionChangeReason="bandwidth"),c.avgEncodeMs=Number(r.googAvgEncodeMs),c.inputFrame={width:Number(r.googFrameWidthInput)||Number(r.googFrameWidthSent),height:Number(r.googFrameHeightInput)||Number(r.googFrameHeightSent),frameRate:Number(r.googFrameRateInput)},c.sentFrame={width:Number(r.googFrameWidthSent),height:Number(r.googFrameHeightSent),frameRate:Number(r.googFrameRateInput)},c.firsCount=Number(r.googFirReceived),c.nacksCount=Number(r.googNacksReceived),c.plisCount=Number(r.googPlisReceived),c.frameCount=Number(r.framesEncoded),c.bytes=Number(r.bytesSent),c.packets=Number(r.packetsSent),c.packetsLost=Number(r.packetsLost),c.ssrc=Number(r.ssrc),c.rttMs=Number(r.googRtt||0),this._stats.videoSend.push(c),this._stats.rtt=c.rttMs;break}case"video_recv":{const c=_u(X8),u=this.lastDecodeVideoReceiverStats.get(Number(r.ssrc));if(c.codec=r.googCodecName,c.targetDelayMs=Number(r.googTargetDelayMs),c.renderDelayMs=Number(r.googRenderDelayMs),c.currentDelayMs=Number(r.googCurrentDelayMs),c.minPlayoutDelayMs=Number(r.googMinPlayoutDelayMs),c.decodeMs=Number(r.googDecodeMs),c.maxDecodeMs=Number(r.googMaxDecodeMs),c.receivedFrame={width:Number(r.googFrameWidthReceived),height:Number(r.googFrameHeightReceived),frameRate:Number(r.googFrameRateReceived)},c.decodedFrame={width:Number(r.googFrameWidthReceived),height:Number(r.googFrameHeightReceived),frameRate:Number(r.googFrameRateDecoded)},c.decodeFrameRate=Number(r.googFrameRateDecoded),c.outputFrame={width:Number(r.googFrameWidthReceived),height:Number(r.googFrameHeightReceived),frameRate:Number(r.googFrameRateOutput)},c.jitterBufferMs=Number(r.googJitterBufferMs),c.firsCount=Number(r.googFirsSent),c.nacksCount=Number(r.googNacksSent),c.plisCount=Number(r.googPlisSent),c.framesDecodeCount=Number(r.framesDecoded),c.bytes=Number(r.bytesReceived),c.packets=Number(r.packetsReceived),c.packetsLost=Number(r.packetsLost),c.ssrc=Number(r.ssrc),c.packets>0&&!this.isFirstVideoReceived[c.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(c.ssrc),this.isFirstVideoReceived[c.ssrc]=!0),c.framesDecodeCount>0&&!this.isFirstVideoDecoded[c.ssrc]&&(this.onFirstVideoDecoded&&this.onFirstVideoDecoded(c.ssrc,c.decodedFrame.width,c.decodedFrame.height),this.isFirstVideoDecoded[c.ssrc]=!0),u){const h=u.stats,m=Date.now()-u.lts;c.framesDecodeFreezeTime=h.framesDecodeFreezeTime,c.framesDecodeInterval=h.framesDecodeInterval,c.framesDecodeCount>h.framesDecodeCount&&this.isFirstVideoDecoded[c.ssrc]?(u.lts=Date.now(),c.framesDecodeInterval=m,c.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(r.ssrc,10))?c.framesDecodeFreezeTime+=c.framesDecodeInterval:this.setVideoIsReady2(parseInt(r.ssrc,10),!0))):c.framesDecodeCount<u.stats.framesDecodeCount&&(c.framesDecodeInterval=0)}this.lastDecodeVideoReceiverStats.set(c.ssrc,{stats:gt({},c),lts:Date.now()}),this._stats.videoRecv.push(c);break}case"audio_recv":{const c=_u(Z8);c.codec=r.googCodecName,c.outputLevel=Math.abs(Number(r.audioOutputLevel))/32767,c.decodingCNG=Number(r.googDecodingCNG),c.decodingCTN=Number(r.googDecodingCTN),c.decodingCTSG=Number(r.googDecodingCTSG),c.decodingNormal=Number(r.googDecodingNormal),c.decodingPLC=Number(r.googDecodingPLC),c.decodingPLCCNG=Number(r.googDecodingPLCCNG),c.expandRate=Number(r.googExpandRate),c.accelerateRate=Number(r.googAccelerateRate),c.preemptiveExpandRate=Number(r.googPreemptiveExpandRate),c.secondaryDecodedRate=Number(r.googSecondaryDecodedRate),c.speechExpandRate=Number(r.googSpeechExpandRate),c.preferredJitterBufferMs=Number(r.googPreferredJitterBufferMs),c.jitterBufferMs=Number(r.googJitterBufferMs),c.jitterMs=Number(r.googJitterReceived),c.bytes=Number(r.bytesReceived),c.packets=Number(r.packetsReceived),c.packetsLost=Number(r.packetsLost),c.ssrc=Number(r.ssrc),c.receivedFrames=Number(r.googDecodingCTN)||Number(r.packetsReceived),c.droppedFrames=Number(r.googDecodingPLC)+Number(r.googDecodingPLCCNG)||Number(r.packetsLost),c.receivedFrames>0&&!this.isFirstAudioReceived[c.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(c.ssrc),this.isFirstAudioReceived[c.ssrc]=!0),c.decodingNormal>0&&!this.isFirstAudioDecoded[c.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(c.ssrc),this.isFirstAudioDecoded[c.ssrc]=!0),this._stats.audioRecv.push(c);break}case"audio_send":{const c=_u(Q8);c.codec=r.googCodecName,c.inputLevel=Math.abs(Number(r.audioInputLevel))/32767,c.aecReturnLoss=Number(r.googEchoCancellationReturnLoss||0),c.aecReturnLossEnhancement=Number(r.googEchoCancellationReturnLossEnhancement||0),c.residualEchoLikelihood=Number(r.googResidualEchoLikelihood||0),c.residualEchoLikelihoodRecentMax=Number(r.googResidualEchoLikelihoodRecentMax||0),c.bytes=Number(r.bytesSent),c.packets=Number(r.packetsSent),c.packetsLost=Number(r.packetsLost),c.ssrc=Number(r.ssrc),c.rttMs=Number(r.googRtt||0),this._stats.rtt=c.rttMs,this._stats.audioSend.push(c);break}}})}_getStats(){return new dt((t,r)=>{this.pc.getStats(t,r)})}statsResponsesToObjects(t){const r=[];return t.result().forEach(s=>{const a={id:s.id,timestamp:s.timestamp.valueOf().toString(),type:s.type};s.names().forEach(c=>{a[c]=s.stat(c)}),r.push(a)}),r}},PT=function(t){return t.BANDWIDTH="bandwidth",t.CPU="cpu",t.NONE="none",t.OTHER="other",t}({}),ZA=function(t){return t.L1T1="L1T1",t.L1T2="L1T2",t.L1T3="L1T3",t.L1T3_KEY="L1T3_KEY",t.L2T1_KEY="L2T1_KEY",t.L2T2_KEY="L2T2_KEY",t.L2T3_KEY="L2T3_KEY",t.L3T1_KEY="L3T1_KEY",t.L3T2_KEY="L3T2_KEY",t.L3T3_KEY="L3T3_KEY",t}({}),CL=function(t){return t[t.new=0]="new",t[t.connecting=1]="connecting",t[t.connected=2]="connected",t[t.disconnected=3]="disconnected",t[t.failed=4]="failed",t[t.closed=5]="closed",t}({}),$c=function(t){return t.CERTIFICATE="certificate",t.CODEC="codec",t.CANDIDATE_PAIR="candidate-pair",t.LOCAL_CANDIDATE="local-candidate",t.REMOTE_CANDIDATE="remote-candidate",t.INBOUND="inbound-rtp",t.TRACK="track",t.OUTBOUND="outbound-rtp",t.PC="peer-connection",t.REMOTE_INBOUND="remote-inbound-rtp",t.REMOTE_OUTBOUND="remote-outbound-rtp",t.TRANSPORT="transport",t.CSRC="csrc",t.DATA_CHANNEL="data-channel",t.STREAM="stream",t.SENDER="sender",t.RECEIVER="receiver",t}({});var Bv=function(t){return t[t.kNone=1]="kNone",t[t.kMillisecondsFromSeconds=1e3]="kMillisecondsFromSeconds",t[t.kBytesToBits=8]="kBytesToBits",t}(Bv||{});function OT(t,r,s,a){let c=arguments.length>4&&arguments[4]!==void 0?arguments[4]:Bv.kNone;if(!r)return;const u=Number(r[s]);if(typeof u!="number")return;const h=Number(r[a]);if(typeof h!="number")return;if(!t)return h?u/h*c:void 0;const m=Number(t[s]);if(typeof m!="number")return;const y=Number(t[a]);if(typeof y!="number")return;const v=h-y;return v?(u-m)/v*c:void 0}let ez=class extends wL{constructor(){super(...arguments),Yt(this,"_stats",AT),Yt(this,"report",void 0),Yt(this,"lastDecodeVideoReceiverStats",new Map),Yt(this,"lastVideoFramesRecv",new Map),Yt(this,"lastVideoFramesSent",new Map),Yt(this,"lastVideoFramesDecode",new Map),Yt(this,"lastVideoFramesOutput",new Map),Yt(this,"lastVideoJBDelay",new Map),Yt(this,"lastAudioJBDelay",new Map),Yt(this,"mediaBytesSent",new Map),Yt(this,"mediaBytesRetransmit",new Map),Yt(this,"mediaBytesTargetEncode",new Map),Yt(this,"lastDecodeAudioReceiverStats",new Map),Yt(this,"lastEncoderMs",new Map)}async updateStats(){this.report=await this.pc.getStats(),this._stats=_u(AT),this.report.forEach(t=>{switch(t.type){case $c.OUTBOUND:case $c.INBOUND:{const r=t.mediaType||t.kind,s=!r&&"frameWidth"in t,a=!r&&!("frameWidth"in t);t.type===$c.OUTBOUND?r==="audio"||a?this.processAudioOutboundStats(t):(r==="video"||s)&&this.processVideoOutboundStats(t):t.type===$c.INBOUND&&(r==="audio"||a?this.processAudioInboundStats(t):(r==="video"||s)&&this.processVideoInboundStats(t));break}case $c.TRANSPORT:{const r=this.report.get(t.selectedCandidatePairId);r&&this.processCandidatePairStats(r);break}case $c.CANDIDATE_PAIR:t.selected&&this.processCandidatePairStats(t)}}),this.updateSendBitrate(),this._stats.updateInterval=Date.now()-this.stats.timestamp,this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}async getSelectedCandidatePair(){const t=await this.pc.getStats(),r={local:gt({},Sh),remote:gt({},Sh)};return t.forEach(s=>{let a;if(s.type===$c.TRANSPORT&&(a=t.get(s.selectedCandidatePairId)),s.type===$c.CANDIDATE_PAIR&&s.selected&&(a=s),a){const c=(u,h)=>{u.type=h.type,u.id=h.id,h.address&&(u.address=h.address),h.candidateType&&(u.candidateType=h.candidateType),h.port&&(u.port=h.port),h.priority&&(u.priority=h.priority),h.protocol&&(u.protocol=h.protocol),h.relayProtocol&&(u.relayProtocol=h.relayProtocol)};if(a.localCandidateId){const u=t.get(a.localCandidateId);u&&c(r.local,u)}if(a.remoteCandidateId){const u=t.get(a.remoteCandidateId);u&&c(r.remote,u)}}}),r}processCandidatePairStats(t){if(this._stats.sendBandwidth=t.availableOutgoingBitrate||0,t.currentRoundTripTime&&(this._stats.rtt=1e3*t.currentRoundTripTime),this._stats.videoSend.forEach(r=>{t.currentRoundTripTime&&(r.rttMs=1e3*t.currentRoundTripTime)}),this._stats.audioSend.forEach(r=>{t.currentRoundTripTime&&(r.rttMs=1e3*t.currentRoundTripTime)}),this._stats.selectedCandidatePair.id=t.id,t.localCandidateId){const r=this.report.get(t.localCandidateId);r&&this.processCandidateStats(r)}if(t.remoteCandidateId){const r=this.report.get(t.remoteCandidateId);r&&this.processCandidateStats(r)}}processCandidateStats(t){let r;t.type===$c.LOCAL_CANDIDATE&&(r=this._stats.selectedCandidatePair.localCandidate),t.type===$c.REMOTE_CANDIDATE&&(r=this._stats.selectedCandidatePair.remoteCandidate),r&&(r.type=t.type,r.id=t.id,t.address&&(r.address=t.address),t.candidateType&&(r.candidateType=t.candidateType),t.port&&(r.port=t.port),t.priority&&(r.priority=t.priority),t.protocol&&(r.protocol=t.protocol),t.relayProtocol&&(r.relayProtocol=t.relayProtocol),t.type===$c.LOCAL_CANDIDATE&&this.stats.selectedCandidatePair.localCandidate.id!==r.id&&this.onSelectedLocalCandidateChanged&&this.onSelectedLocalCandidateChanged(gt({},r),gt({},this.stats.selectedCandidatePair.localCandidate)),t.type===$c.REMOTE_CANDIDATE&&this.stats.selectedCandidatePair.remoteCandidate.id!==r.id&&this.onSelectedRemoteCandidateChanged&&this.onSelectedRemoteCandidateChanged(gt({},r),gt({},this.stats.selectedCandidatePair.remoteCandidate)))}processAudioInboundStats(t){let r=this._stats.audioRecv.find(a=>a.ssrc===t.ssrc);r||(r=_u(Z8),this._stats.audioRecv.push(r)),r.ssrc=t.ssrc,r.packets=t.packetsReceived,r.packetsLost=t.packetsLost,r.packetsDiscarded=t.packetsDiscarded,r.bytes=t.bytesReceived,r.jitterMs=1e3*t.jitter,r.retransmittedBytesReceived=t.retransmittedBytesReceived,r.retransmittedPacketsReceived=t.retransmittedPacketsReceived,r.totalProcessingDelay=t.totalProcessingDelay,r.jitterBufferEmittedCount=t.jitterBufferEmittedCount;const s=this.lastDecodeAudioReceiverStats.get(r.ssrc);r.avgProcessingDelayMs=OT(s,r,"totalProcessingDelay","jitterBufferEmittedCount",Bv.kMillisecondsFromSeconds),this.processAudioTrackReceiverStats(t,t.trackId,r),t.codecId&&(r.codec=this.getCodecFromCodecStats(t.codecId)),r.receivedFrames||(r.receivedFrames=t.packetsReceived),r.droppedFrames||(r.droppedFrames=t.packetsLost),r.receivedFrames>0&&!this.isFirstAudioReceived[r.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(r.ssrc),this.isFirstAudioReceived[r.ssrc]=!0),r.outputLevel&&r.outputLevel>0&&!this.isFirstAudioDecoded[r.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(r.ssrc),this.isFirstAudioDecoded[r.ssrc]=!0),typeof t.concealedSamples=="number"&&(r.concealedSamples=t.concealedSamples),this.lastDecodeAudioReceiverStats.set(r.ssrc,gt({},r))}processVideoInboundStats(t){let r=this._stats.videoRecv.find(h=>h.ssrc===t.ssrc);r||(r=_u(X8),this._stats.videoRecv.push(r)),r.ssrc=t.ssrc,r.packets=t.packetsReceived,r.packetsLost=t.packetsLost,r.bytes=t.bytesReceived,r.firsCount=t.firCount,r.nacksCount=t.nackCount,r.plisCount=t.pliCount,r.framesDecodeCount=t.framesDecoded,r.framesDroppedCount=t.framesDropped,r.totalInterFrameDelay=t.totalInterFrameDelay,r.totalSquaredInterFrameDelay=t.totalSquaredInterFrameDelay,r.totalFreezesDuration=t.totalFreezesDuration,r.totalProcessingDelay=t.totalProcessingDelay,r.packetsDiscarded=t.packetsDiscarded,r.framesAssembledFromMultiplePackets=t.framesAssembledFromMultiplePackets,r.totalAssemblyTime=t.totalAssemblyTime,r.keyFramesDecoded=t.keyFramesDecoded,r.retransmittedBytesReceived=t.retransmittedBytesReceived,r.retransmittedPacketsReceived=t.retransmittedPacketsReceived;const s=this.lastDecodeVideoReceiverStats.get(r.ssrc),a=this.lastVideoFramesDecode.get(r.ssrc),c=this.lastVideoFramesOutput.get(r.ssrc),u=Date.now();if(r.framesDecodeCount>0&&!this.isFirstVideoDecoded[r.ssrc]){const h=r.decodedFrame?r.decodedFrame.width:0,m=r.decodedFrame?r.decodedFrame.height:0;this.onFirstVideoDecoded&&this.onFirstVideoDecoded(r.ssrc,h,m),this.isFirstVideoDecoded[r.ssrc]=!0}if(s){const h=s.stats,m=u-s.lts;r.framesDecodeFreezeTime=h.framesDecodeFreezeTime,r.framesDecodeInterval=h.framesDecodeInterval,!this.isFirstVideoDecoded[r.ssrc]&&m>this.options.firstVideoDecodedTimeout&&!this.isFirstVideoDecodedTimeout[r.ssrc]&&(this.onFirstVideoDecodedTimeout&&this.onFirstVideoDecodedTimeout(r.ssrc),this.isFirstVideoDecodedTimeout[r.ssrc]=!0),r.framesDecodeCount>h.framesDecodeCount&&this.isFirstVideoDecoded[r.ssrc]?(s.lts=Date.now(),r.framesDecodeInterval=m,r.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(t.ssrc))?r.framesDecodeFreezeTime+=r.framesDecodeInterval:this.setVideoIsReady2(parseInt(t.ssrc,10),!0))):r.framesDecodeCount<h.framesDecodeCount&&(r.framesDecodeInterval=0),t.framesDecoded&&t.qpSum&&(s.stats.framesDecodeCount>t.framesDecoded?r.qpSumPerFrame=t.qpSum/t.framesDecoded:r.qpSumPerFrame=(t.qpSum-s.qpSum)/(t.framesDecoded-s.stats.framesDecodeCount))}t.totalDecodeTime&&(r.decodeMs=1e3*t.totalDecodeTime,r.avgDecodeMs=OT(s==null?void 0:s.stats,r,"decodeMs","framesDecodeCount")),r.avgProcessingDelayMs=OT(s==null?void 0:s.stats,r,"totalProcessingDelay","framesDecodeCount",Bv.kMillisecondsFromSeconds),r.avgFramesAssembledFromMultiplePacketsMs=OT(s==null?void 0:s.stats,r,"totalAssemblyTime","framesAssembledFromMultiplePackets",Bv.kMillisecondsFromSeconds),r.avgInterFrameDelayMs=OT(s==null?void 0:s.stats,r,"totalInterFrameDelay","framesDecodeCount",Bv.kMillisecondsFromSeconds),a&&u-a.lts>=800?(r.decodeFrameRate=Math.round((r.framesDecodeCount-a.count)/((u-a.lts)/1e3)),this.lastVideoFramesDecode.set(r.ssrc,{count:r.framesDecodeCount,lts:u,rate:r.decodeFrameRate})):a?r.decodeFrameRate=a.rate:this.lastVideoFramesDecode.set(r.ssrc,{count:r.framesDecodeCount,lts:u,rate:0}),r.framesDroppedCount&&t.framesReceived&&(c&&u-c.lts>=800?(r.outputFrameRate=Math.round((t.framesReceived-r.framesDroppedCount-c.count)/((u-c.lts)/1e3)),this.lastVideoFramesOutput.set(r.ssrc,{count:t.framesReceived-r.framesDroppedCount,lts:u,rate:Math.max(r.outputFrameRate,0)})):c?r.outputFrameRate=c.rate:this.lastVideoFramesOutput.set(r.ssrc,{count:t.framesReceived-r.framesDroppedCount,lts:u,rate:0})),this.processVideoTrackReceiverStats(t,t.trackId,r),t.codecId&&(r.codec=this.getCodecFromCodecStats(t.codecId)),t.framerateMean&&(r.framesRateFirefox=t.framerateMean),r.packets>0&&!this.isFirstVideoReceived[r.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(r.ssrc),this.isFirstVideoReceived[r.ssrc]=!0),this.lastDecodeVideoReceiverStats.set(r.ssrc,{stats:gt({},r),lts:s?s.lts:Date.now(),qpSum:t.qpSum})}processVideoOutboundStats(t){let r=this._stats.videoSend.find(a=>a.ssrc===t.ssrc);r||(r=_u(J8),this._stats.videoSend.push(r));const s=this.mediaBytesSent.get(t.ssrc);if(s)s.add(t.bytesSent);else{const a=new TL(10);a.add(t.bytesSent),this.mediaBytesSent.set(t.ssrc,a)}if(t.retransmittedBytesSent!==void 0){const a=this.mediaBytesRetransmit.get(t.ssrc);if(a)a.add(t.retransmittedBytesSent);else{const c=new TL(10);c.add(t.retransmittedBytesSent),this.mediaBytesRetransmit.set(t.ssrc,c)}}if(t.totalEncodedBytesTarget){const a=this.mediaBytesTargetEncode.get(t.ssrc);if(a)a.add(t.totalEncodedBytesTarget);else{const c=new TL(10);c.add(t.totalEncodedBytesTarget),this.mediaBytesTargetEncode.set(t.ssrc,c)}}if(r.ssrc=t.ssrc,r.bytes=t.bytesSent,r.packets=t.packetsSent,r.firsCount=t.firCount,r.nacksCount=t.nackCount,r.plisCount=t.pliCount,r.frameCount=t.framesEncoded,r.adaptionChangeReason=t.qualityLimitationReason,r.scalabilityMode=t.scalabilityMode,r.retransmittedBytesSent=t.retransmittedBytesSent,r.retransmittedPacketsSent=t.retransmittedPacketsSent,r.hugeFramesSent=t.hugeFramesSent,r.keyFramesEncoded=t.keyFramesEncoded,t.totalEncodeTime&&t.framesEncoded){const a=this.lastEncoderMs.get(t.ssrc);if(!a||a.lastFrameCount>t.framesEncoded)r.avgEncodeMs=1e3*t.totalEncodeTime/t.framesEncoded;else{const c=t.framesEncoded-a.lastFrameCount,u=t.totalEncodeTime-a.lastEncoderTime;r.avgEncodeMs=1e3*u/c}}if(t.framesEncoded&&t.qpSum){const a=this.lastEncoderMs.get(t.ssrc);!a||a.lastFrameCount>t.framesEncoded?r.qpSumPerFrame=t.qpSum/t.framesEncoded:r.qpSumPerFrame=(t.qpSum-a.lastQpSum)/(t.framesEncoded-a.lastFrameCount)}if(this.lastEncoderMs.set(t.ssrc,{lastFrameCount:t.framesEncoded,lastEncoderTime:t.totalEncodeTime,lastQpSum:t.qpSum,lts:Date.now()}),t.codecId&&(r.codec=this.getCodecFromCodecStats(t.codecId)),t.mediaSourceId&&this.processVideoMediaSource(t.mediaSourceId,r),this.processVideoTrackSenderStats(t,t.trackId,r),t.remoteId)this.processRemoteInboundStats(t.remoteId,r);else{const a=this.findRemoteStatsId(t.ssrc,$c.REMOTE_INBOUND);a&&this.processRemoteInboundStats(a,r)}}processAudioOutboundStats(t){let r=this._stats.audioSend.find(s=>s.ssrc===t.ssrc);if(r||(r=_u(Q8),this._stats.audioSend.push(r)),r.ssrc=t.ssrc,r.packets=t.packetsSent,r.bytes=t.bytesSent,r.retransmittedBytesSent=t.retransmittedBytesSent,r.retransmittedPacketsSent=t.retransmittedPacketsSent,t.mediaSourceId&&this.processAudioMediaSource(t.mediaSourceId,r),t.codecId&&(r.codec=this.getCodecFromCodecStats(t.codecId)),this.processAudioTrackSenderStats(t,t.trackId,r),t.remoteId)this.processRemoteInboundStats(t.remoteId,r);else{const s=this.findRemoteStatsId(t.ssrc,$c.REMOTE_INBOUND);s&&this.processRemoteInboundStats(s,r)}}findRemoteStatsId(t,r){var s;const a=Array.from(zc(s=this.report).call(s)).find(c=>c.type===r&&c.ssrc===t);return a?a.id:null}processVideoMediaSource(t,r){const s=this.report.get(t);s&&s.width&&s.height&&s.framesPerSecond&&(r.inputFrame={width:s.width,height:s.height,frameRate:s.framesPerSecond})}processAudioMediaSource(t,r){const s=this.report.get(t);s&&(r.inputLevel=s.audioLevel)}processVideoTrackSenderStats(t,r,s){var a,c,u,h;const m=r?this.report.get(r):void 0,y=(a=m==null?void 0:m.framesSent)!==null&&a!==void 0?a:t.framesSent;if(typeof y!="number")return;let v=(c=m==null?void 0:m.frameWidth)!==null&&c!==void 0?c:t.frameWidth,S=(u=m==null?void 0:m.frameHeight)!==null&&u!==void 0?u:t.frameHeight,R=(h=m==null?void 0:m.framesPerSecond)!==null&&h!==void 0?h:t.framesPerSecond;if(typeof v=="number"&&typeof S=="number"||(v=0,S=0),R==null){const P=Date.now(),N=this.lastVideoFramesSent.get(s.ssrc);N&&P-N.lts>=800?(R=Math.round((y-N.count)/((P-N.lts)/1e3)),this.lastVideoFramesSent.set(s.ssrc,{count:y,lts:P,rate:R})):N?R=N.rate:this.lastVideoFramesSent.set(s.ssrc,{count:y,lts:P,rate:0})}s.sentFrame={width:v,height:S,frameRate:Math.max(0,R)}}processVideoTrackReceiverStats(t,r,s){var a,c,u,h,m;const y=r?this.report.get(r):void 0,v=(a=y==null?void 0:y.framesReceived)!==null&&a!==void 0?a:t.framesReceived,S=(c=y==null?void 0:y.frameWidth)!==null&&c!==void 0?c:t.frameWidth,R=(u=y==null?void 0:y.frameHeight)!==null&&u!==void 0?u:t.frameHeight,P=(h=y==null?void 0:y.jitterBufferDelay)!==null&&h!==void 0?h:t.jitterBufferDelay,N=(m=y==null?void 0:y.jitterBufferEmittedCount)!==null&&m!==void 0?m:t.jitterBufferEmittedCount;if(typeof v=="number"){const G=this.lastVideoFramesRecv.get(s.ssrc),F=Date.now();s.framesReceivedCount=v;let j=0;G&&F-G.lts>=800?(j=Math.round((v-G.count)/((F-G.lts)/1e3)),this.lastVideoFramesRecv.set(s.ssrc,{count:v,lts:F,rate:j})):G?j=G.rate:this.lastVideoFramesRecv.set(s.ssrc,{count:v,lts:F,rate:0}),s.receivedFrame={width:S||0,height:R||0,frameRate:j||0},s.decodedFrame={width:S||0,height:R||0,frameRate:s.decodeFrameRate||0},s.outputFrame={width:S||0,height:R||0,frameRate:s.outputFrameRate||s.decodeFrameRate||0}}if(P&&N){const G=this.lastVideoJBDelay.get(s.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let F=G.jitterBufferMs;const j=N-G.jitterBufferEmittedCount;j>0&&(F=1e3*(P-G.jitterBufferDelay)/j),s.jitterBufferMs=F,s.currentDelayMs=Math.round(F),this.lastVideoJBDelay.set(s.ssrc,{jitterBufferDelay:P,jitterBufferEmittedCount:N,jitterBufferMs:s.currentDelayMs})}}processAudioTrackSenderStats(t,r,s){var a,c,u,h;const m=r?this.report.get(r):void 0,y=(a=(c=m==null?void 0:m.echoReturnLoss)!==null&&c!==void 0?c:t.echoReturnLoss)!==null&&a!==void 0?a:0,v=(u=(h=m==null?void 0:m.echoReturnLossEnhancement)!==null&&h!==void 0?h:t.echoReturnLossEnhancement)!==null&&u!==void 0?u:0;s.aecReturnLoss=y,s.aecReturnLossEnhancement=v}processAudioTrackReceiverStats(t,r,s){var a,c,u,h,m,y,v;const S=r?this.report.get(r):void 0,R=(a=S==null?void 0:S.removedSamplesForAcceleration)!==null&&a!==void 0?a:t.removedSamplesForAcceleration,P=(c=S==null?void 0:S.totalSamplesReceived)!==null&&c!==void 0?c:t.totalSamplesReceived,N=(u=S==null?void 0:S.jitterBufferDelay)!==null&&u!==void 0?u:t.jitterBufferDelay,G=(h=S==null?void 0:S.jitterBufferEmittedCount)!==null&&h!==void 0?h:t.jitterBufferEmittedCount,F=(m=S==null?void 0:S.audioLevel)!==null&&m!==void 0?m:t==null?void 0:t.audioLevel,j=(y=S==null?void 0:S.totalSamplesDuration)!==null&&y!==void 0?y:t==null?void 0:t.totalSamplesDuration,X=(v=S==null?void 0:S.concealedSamples)!==null&&v!==void 0?v:t.concealedSamples;if(typeof P=="number"&&(s.totalSamplesReceived=P),R&&P&&(s.accelerateRate=R/P),N&&G){const he=this.lastAudioJBDelay.get(s.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let Se=he.jitterBufferMs;const Te=G-he.jitterBufferEmittedCount;Te>0&&(Se=1e3*(N-he.jitterBufferDelay)/Te),s.jitterBufferMs=Math.round(Se),this.lastAudioJBDelay.set(s.ssrc,{jitterBufferDelay:N,jitterBufferEmittedCount:G,jitterBufferMs:s.jitterBufferMs})}s.outputLevel=F;let ee=1920;j&&P&&(ee=P/j/50,s.receivedFrames=Math.round(P/ee)),X&&(s.droppedFrames=Math.round(X/ee))}processRemoteInboundStats(t,r){const s=this.report.get(t);s&&(r.packetsLost=s.packetsLost,s.roundTripTime&&(r.rttMs=1e3*s.roundTripTime),s.jitter&&(r.jitterMs=1e3*s.jitter),s.timestamp&&(r.timestamp=s.timestamp))}getCodecFromCodecStats(t){const r=this.report.get(t);if(!r)return"";const s=r.mimeType.match(/\/(.*)$/);return s&&s[1]?s[1]:""}updateSendBitrate(){let t=0,r=null,s=null;this.mediaBytesSent.forEach(c=>{t+=c.diffMean()}),this.mediaBytesRetransmit.forEach(c=>{r=r===null?c.diffMean():r+c.diffMean()}),this.mediaBytesTargetEncode.forEach(c=>{s=s===null?c.diffMean():s+c.diffMean()});const a=r!==null?t-r:t;this._stats.bitrate={actualEncoded:8*a/(this.options.updateInterval/1e3),transmit:8*t/(this.options.updateInterval/1e3)},r!==null&&(this._stats.bitrate.retransmit=8*r/(this.options.updateInterval/1e3)),s!==null&&(this._stats.bitrate.targetEncoded=8*s/(this.options.updateInterval/1e3))}},eme=class extends wL{updateStats(){return dt.resolve()}};function RL(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:250,s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:8,a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:500,c=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1e4;const u=function(){const h=navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]*/i);return h&&h[0]?Number(h[0].split("/")[1]):null}();return u?u<76?new Zpe(t,{updateInterval:r,lossRateInterval:s,freezeRateLimit:a,firstVideoDecodedTimeout:c}):new ez(t,{updateInterval:r,lossRateInterval:s,freezeRateLimit:a,firstVideoDecodedTimeout:c}):function(h){if(!window.RTCStatsReport)return!1;const m=h.getStats();return!!(m instanceof dt||function(y){return!!y&&(typeof y=="object"||typeof y=="function")&&typeof y.then=="function"}(m))}(t)?new ez(t,{updateInterval:r,lossRateInterval:s,freezeRateLimit:a,firstVideoDecodedTimeout:c}):new eme(t,{updateInterval:r,lossRateInterval:s,freezeRateLimit:a,firstVideoDecodedTimeout:c})}const tz="websdk_ng_install_id";function IL(){try{if(oe("INSTALL_ID"))return oe("INSTALL_ID");let t=window.localStorage.getItem(tz);return t||(t=j_(),window.localStorage.setItem(tz,t)),tr("INSTALL_ID",t),t}catch{return}}const wl=function(t){if(t.match(/[0-9]+\.[0-9]+\.[0-9]+$/))return t;const r=t.match(/([0-9]+\.[0-9]+\.[0-9]+)\-([0-9]+)/);if(r&&r[1]&&r[2]){const s=r[1],a=r[2];return"".concat(s,".").concat(a)}return"4.0.0.999"}("4.23.2"),AL=function(){try{return JSON.parse("true")===!0}catch{return!0}}();let B_=function(t){return t.Default="default",t.Auto="auto",t.Relay="relay",t.SdRtn="sd-rtn",t}({});const Ns=function(){const t="us".concat("erna","me"),r="pa".concat("sswo","rd"),s=["t","s","t"];s.splice(1,0,"e");const a=s.join(""),c=[];for(let m=0;m<6;m++)c.push("1");const u=c.join(""),h={};return h[t]=a,h[r]=u,Object.assign(h,{turnServerURL:"",tcpport:3433,udpport:3478,forceturn:!1})}();window.DEFAULT_TURN_CONFIG=Ns;const eP={ENABLE_PUBLISHED_USER_LIST:!0,MAX_SUBSCRIPTION:50,SUBSCRIBE_AUDIO_FILTER_TOPN:void 0,ENABLE_PUBLISH_AUDIO_FILTER:void 0,ENABLE_USER_LICENSE_CHECK:!0,DISABLE_FEC:void 0,ENABLE_NTP_REPORT:!1,ENABLE_INSTANT_VIDEO:!1,ENABLE_USER_AUTO_REBALANCE_CHECK:!0,ENABLE_LOSSBASED_BWE:!0,ENABLE_AUT_CC:!1,ENABLE_CC_FALLBACK:void 0,SUBSCRIBE_TWCC:!0,PUBLISH_TWCC:!1,ENABLE_SVC_DEFAULT_CODECS:["H264","VP8","VP9","AV1"],SVC:[],ENABLE_FULL_LINK_AV_SYNC:!1,SVC_MODE:null,PRE_SUB_NUM:2,ENABLE_AUT_FEEDBACK:!1,SVC_EXTENDED:["VP9"]},PL={MIN_FRAME_RATE:1,MAX_FRAME_RATE:30,MAX_THRESHOLD_FRAMERATE:30,BITRATE_MIN_THRESHOLD:100,BITRATE_MAX_THRESHOLD:100,MAX_SCALE:5,BWE_SCALE_UP_THRESHOLD:.6,BWE_SCALE_DOWN_THRESHOLD:.6,PERF_SCALE_UP_THRESHOLD:.7,PERF_SCALE_DOWN_THRESHOLD:.6,MOTION_RESOLUTION_FACTOR:.8,MOTION_BITRATE_FACTOR:.6,DETAIL_FRAMERATE_FACTOR:.8,DETAIL_BITRATE_FACTOR:.6,BALANCE_RESOLUTION_FACTOR:.9,BALANCE_FRAMERATE_FACTOR:.9,BALANCE_BITRATE_FACTOR:.6,OVERUSE_TIMES_THRESHOLD:10,UNDERUSE_TIMES_THRESHOLD:40},OL="v4.23.2-0-g1599fdac-dirty(3/4/2025, 5:13:36 PM)",kL={ENABLE_EVENT_REPORT:!0,UPLOAD_LOG:!1,ENABLE_AG_ADAPTATION:!0,FORCE_AG_HIGH_FRAMERATE:!1,FORCE_SUPPORT_AG_ADAPTATION:!1,ENCODER_CONFIG_LIMIT:{},CAMERA_CAPTURE_CONFIG:void 0,ENABLE_PRELOAD:!0,NEW_ICE_RESTART:!1,ICE_RESTART_INTERVAL:1e4,RESTART_SEQUENCE:["udp_tcp_relay","relay"],FIRST_TCP_CANDIDATE:!1,FIRST_TCP_CANDIDATE_INTERVAL:1e3,TURN_DOMAIN:"edge.agora.io",USE_TURN_IP:!1,NEW_TURN_MODE:void 0,NEW_FORCE_TURN:!1},vr=gt(gt(gt({},kL),{},{PROCESS_ID:"",ENCRYPT_AES:!0,AREAS:["CHINA","GLOBAL"],WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io","webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io","webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-web-2.ap.sd-rtn.com","cds-ap-web-3.agora.io","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-web-2.ap.sd-rtn.com","sua-ap-web-3.agora.io","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-ap-web-1.agora.io","uap-web-2.ap.sd-rtn.com","uap-ap-web-3.agora.io","uap-web-4.ap.sd-rtn.com"],LOG_UPLOAD_SERVER:"logservice.agora.io",EVENT_REPORT_DOMAIN:"statscollector-1.agora.io",EVENT_REPORT_BACKUP_DOMAIN:"web-2.statscollector.sd-rtn.com",GATEWAY_ADDRESS:[],GATEWAY_WSS_ADDRESS:"",LIVE_STREAMING_ADDRESS:"",HTTP_CONNECT_TIMEOUT:5e3,SIGNAL_REQUEST_TIMEOUT:1e4,REPORT_STATS:!0,NOT_REPORT_EVENT:[],PING_PONG_TIME_OUT:10,WEBSOCKET_TIMEOUT_MIN:1e4,EVENT_REPORT_SEND_INTERVAL:3e3,CONFIG_DISTRIBUTE_INTERVAL:3e5,ENABLE_CONFIG_DISTRIBUTE:!0,CANDIDATE_TIMEOUT:5e3,SHOW_REPORT_INVOKER_LOG:!1,SHOW_REPORT_USER_INVOKER_LOG:!0,JOIN_EXTEND:"",PUB_EXTEND:"",SUB_EXTEND:"",FORCE_TURN:!1,TURN_ENABLE_TCP:!0,TURN_ENABLE_UDP:!0,MAX_UPLOAD_CACHE:50,UPLOAD_CACHE_INTERVAL:2e3,AJAX_REQUEST_CONCURRENT:3,REPORT_APP_SCENARIO:void 0,GATEWAY_DOMAINS:["edge.agora.io","edge.sd-rtn.com"],CONNECT_GATEWAY_WITHOUT_DOMAIN:!1,WORKER_DOMAIN:"edge.agora.io",EVENT_REPORT_RETRY:!0,CHROME_FORCE_PLAN_B:!1,AUDIO_SOURCE_VOLUME_UPDATE_INTERVAL:400,AUDIO_SOURCE_AVG_VOLUME_DURATION:3e3,AUDIO_VOLUME_INDICATION_INTERVAL:2e3,VOLUME_VOICE_WEIGHT:10,GET_VOLUME_OF_MUTED_AUDIO_TRACK:!1,STATS_UPDATE_INTERVAL:250,NORMAL_EVENT_QUEUE_CAPACITY:100,CUSTOM_REPORT:!0,CUSTOM_REPORT_LIMIT:20,PROXY_SERVER_TYPE2:"webnginx-proxy.agora.io",PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com","webrtc-cloud-proxy.agora.io"],CUSTOM_PUB_ANSWER_MODIFIER:null,CUSTOM_SUB_ANSWER_MODIFIER:null,CUSTOM_PUB_OFFER_MODIFIER:null,CUSTOM_SUB_OFFER_MODIFIER:null,DSCP_TYPE:"high",REMOVE_NEW_CODECS:!0,FRAGEMENT_LENGTH:3,WEBSOCKET_COMPRESS:!1,SIMULCAST:!1,PRELOAD_MEDIA_COUNT:0,CHECK_VIDEO_VISIBLE_INTERVAL:3e4,CHECK_LOCAL_STATS_INTERVAL:250,PROFILE_SWITCH_INTERVAL:2e3,UNSUPPORTED_VIDEO_CODEC:[],ENUMERATE_DEVICES_INTERVAL:!1,ENUMERATE_DEVICES_INTERVAL_TIME:1e4,USE_NEW_TOKEN:!1,CLOSE_AFB_FOR_LOCAL_AP:!0,JOIN_MAX_CONCURRENCY:6,JOIN_WITH_FALLBACK_SIGNAL_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE:!1,JOIN_GATEWAY_TRY_443PORT_DURATION:2e3,JOIN_GATEWAY_USE_443PORT_ONLY:!1,JOIN_GATEWAY_USE_DUAL_DOMAIN:!0,JOIN_GATEWAY_FALLBACK_PORT:443,USE_TURN_SERVER_OF_GATEWAY:!1,H264_PROFILE_LEVEL_ID:"",USE_NEW_LOG:!1,LOG_VERSION:3,MEDIA_DEVICE_CONSTRAINTS:null,ENCRYPT_PROXY_USERNAME_AND_PSW:!0,SDP_LOGGING:!1,CSP_DETECTED_HOSTNAME_LIST:["agora.io","sd-rtn.com"],REMOTE_AUDIO_TRACK_USES_WEB_AUDIO:!1,LOCAL_AUDIO_TRACK_USES_WEB_AUDIO:!1,BITRATE_ADAPTER_TYPE:"STANDARD_BITRATE",AI_DENOISER_PARAMETERS:{excludedLinks:[]},ADJUST_3A_FROM_PLUGINS:!0,RAISE_H264_BASELINE_PRIORITY:!0,FILTER_SEND_H264_BASELINE:!1,FIRST_H264_PROFILE_LEVEL_ID:"42001f",FIRST_PACKETIZATION_MODE:"",X_GOOGLE_START_BITRATE:void 0,NEW_REPORT_SERVER:!1,NEW_REPORT_SERVER_DOMAINS:["data-reporting.agora.io","data-reporting.agora.io"],VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT:3e5,VIDEO_INSPECT_INTERVAL_MINIMUM:1e3,VIDEO_INSPECT_QUALITY_RATIO:.9,VIDEO_INSPECT_WORKER_MANAGER_HOST:"edge.agora.io",VIDEO_INSPECT_WORKER_MANAGER_PORT:"",VIDEO_INSPECT_WORKER_PORT:"",SHOW_VIDEO_INSPECT_WORKER_MESSAGE:!1,STATS_COLLECTOR_PORT:443,FORCE_TURN_TCP:!1,WEBAUDIO_INIT_OPTIONS:void 0,FILTER_VIDEO_FEC:!0,FILTER_AUDIO_FEC:!1,CHROME_DUAL_STREAM_USE_ENCODING:!0,DISABLE_DUAL_STREAM_USE_ENCODING:!1,EXTENSION_USAGE_UPLOAD_INTERVAL:1e4,ICE_RESTART:!0,FINGERPRINT:null,ENABLE_VIDEO_FRAME_CALLBACK:!0,VIDEO_FREEZE_DURATION:500,SPATIALIZER_PARAMETERS:{},UPLOAD_LOG_INTERVAL:3e3,UPLOAD_LOG_REQUEST_RETRY_INTERVAL:2e3,UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL:2e4,UPLOAD_LOG_TRY_INTERVAL_WHILE_OFF:5e3,UPLOAD_LOG_RETRY_INTERVAL_V1:1e4,UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1:200,UPLOAD_LOG_LENGTH_EACH_TIME:10,APP_TYPE:0,DISABLE_WEBAUDIO:!1,CHANNEL_MEDIA_RELAY_SERVERS:void 0,KEEP_LAST_FRAME:!0,FORWARD_P2P_CREATION:!0,SYNC_GROUP:!0,BLOCK_LOCAL_CLIENT:!1,ENABLE_AUDIO_TOPN:!1,ENABLE_AUDIO_METADATA:!1,ENABLE_AUDIO_PTS_METADATA:!1,TOPN_SMOOTH_LEVEL:void 0,TOPN_NEW_SPEAKER_DELAY:void 0,TOPN_SWITCH_HOLD_MS:void 0,TOPN_AUDIO_GAIN:void 0,TOPN_SILENCE_THRESHOLD:250,AP_AREA:!0,ENABLE_ENCODED_TRANSFORM:!1,ENABLE_VIDEO_SEI:!1,IMAGE_MODERATION_WORKER_HOST:"edge.agora.io",IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT:3e5,IMAGE_MODERATION_INTERVAL_MINIMUM:1e3,SHOW_IMAGE_MODERATION_WORKER_MESSAGE:!1,IMAGE_MODERATION_QUALITY_RATIO:.9,IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL:5e3,SHOW_GLOBAL_CLIENT_LIST:!1,DATASTREAM_MAX_RETRANSMITS:10,TCP_CANDIDATE_ONLY:!1,EXTERNAL_SIGNAL_REQUEST_TIMEOUT:3e3,SHOW_P2P_LOG:!1,MAX_P2P_TIMEOUT:3e4,P2P_TOKEN_INTERVAL:1e3,SHOW_DATASTREAM2_LOG:!1,RESTRICTION_SET_PLAYBACK_DEVICE:!0,USE_PURE_ENCRYPTION_MASTER_KEY:!1,ACCOUNT_REGISTER_RETRY_TIMEOUT:1,ACCOUNT_REGISTER_RETRY_RATIO:2,ACCOUNT_REGISTER_RETRY_TIMEOUT_MAX:6e4,ACCOUNT_REGISTER_RETRY_COUNT_MAX:1e5,AUDIO_CONTEXT:null,WEBCS_BACKUP_CONNECT_TIMEOUT:6e3,PLAYER_STATE_DEFER:2e3,SIGNAL_REQUEST_WATCH_INTERVAL:1e3,FILEPATH_LENMAX:255,DUALSTREAM_OPERATION_CHECK:!0,MEDIA_ELEMENT_EXISTS_DEPTH:3,SHIM_CANDIDATE:!1,LEAVE_MSG_TIMEOUT:2e3,STATS_FILTER:{transportId:!0,googTrackId:!0},FILTER_VIDEO_CODEC:[],USE_NEW_NETWORK_CONFIG:!1,AUTO_RESET_AUDIO_ROUTE:!1,PLUGIN_INFO:[],OVERUSE_DETECTOR_PARAMS:PL,CUSTOM_ADAPTATION_DEFAULT_MODE:"",HIDE_NO_POSTER:!1,AP_CACHE_NUM:10,AP_UPDATE_INTERVAL:12e4,AP_CACHE_LIFETIME:12e4,MAX_PRELOAD_ASYNC_LENGTH:3,DISABLE_SCREEN_SHARE_REMB:!1},eP),{},{USE_CANDIDATE_FROM_AP_DETAIL:!1,AP_REQUEST_DETAIL:void 0,ENABLE_ROLE_SELECT_EDGE:!1,CLIENT_ROLE_OPTIONS:void 0,COMPATIBLE_SDP_EXTENSION:["gdpr_forbidden"],LIMIT_BITRATE:void 0,EXPERIMENTS:{},USE_PUB_RTX:!0,USE_SUB_RTX:!0,ENABLE_DATASTREAM_2:!1,USE_XR:!0,ENABLE_PREALLOC_PC:!1,ENABLE_PRE_SUB:!1,ENABLE_SVC:!1},{INSTALL_ID:""});function tr(t,r,s){var a,c,u;ot(a=Object.keys(vr)).call(a,t)&&(!s&&ot(c=Object.keys(yd)).call(c,t)||(vr[t]=r,t!=="ENABLE_VIDEO_SEI"&&t!=="ENABLE_AUDIO_TOPN"&&t!=="ENABLE_AUDIO_METADATA"&&t!=="ENABLE_AUDIO_PTS_METADATA"||r!==!0||(vr.ENABLE_ENCODED_TRANSFORM=!0,t==="ENABLE_AUDIO_PTS_METADATA"&&(vr.ENABLE_AUDIO_METADATA=!0)),t==="USE_NEW_NETWORK_CONFIG"&&r&&(u=!!r,vr.USE_NEW_NETWORK_CONFIG=u,u&&(vr.WEBCS_DOMAIN=["webrtc2-2.ap.sd-rtn.com"],vr.WEBCS_DOMAIN_BACKUP_LIST=["webrtc2-4.ap.sd-rtn.com"],vr.CDS_AP=["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],vr.ACCOUNT_REGISTER=["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],vr.EVENT_REPORT_DOMAIN="web-2.statscollector.sd-rtn.com",vr.EVENT_REPORT_BACKUP_DOMAIN="statscollector-1.agora.io",vr.GATEWAY_DOMAINS=["edge.sd-rtn.com"])),t==="ENABLE_PRE_SUB"&&r&&(vr.ENABLE_INSTANT_VIDEO=!0,vr.ENABLE_PREALLOC_PC=!0),t==="ENABLE_SVC"&&r&&(vr.ENABLE_AUT_CC=!0),t==="NEW_FORCE_TURN"&&r&&(vr.NEW_TURN_MODE||(vr.NEW_TURN_MODE=4))))}function oe(t){return vr[t]}AL||(vr.WEBCS_DOMAIN=["ap-web-1-oversea.agora.io","ap-web-1-north-america.agora.io"],vr.WEBCS_DOMAIN_BACKUP_LIST=["ap-web-2-oversea.agora.io","ap-web-2-north-america.agora.io"],vr.PROXY_CS=["proxy-ap-web-oversea.agora.io","proxy-ap-web-america.agora.io"],vr.CDS_AP=["cds-ap-web-oversea.agora.io","cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],vr.ACCOUNT_REGISTER=["sua-ap-web-oversea.agora.io","sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],vr.UAP_AP=["uap-ap-web-oversea.agora.io","uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],vr.LOG_UPLOAD_SERVER="logservice-oversea.agora.io",vr.EVENT_REPORT_DOMAIN="statscollector-1-oversea.agora.io",vr.EVENT_REPORT_BACKUP_DOMAIN="statscollector-2-oversea.agora.io",vr.PROXY_SERVER_TYPE3="webrtc-cloud-proxy.agora.io",vr.AREAS=["NORTH_AMERICA","OVERSEA"]);let nz=function(t){return t[t.REALTIME=1]="REALTIME",t}({});const yd={};var En=function(t){return t.SET_SESSION_ID="SET_SESSION_ID",t.SET_P2P_ID="SET_P2P_id",t.SET_DC_ID="SET_DC_id",t.SET_UID="SET_UID",t.SET_INT_UID="SET_INT_UID",t.SET_PUB_ID="SET_PUB_ID",t.SET_CLOUD_PROXY_SERVER_MODE="SET_CLOUD_PROXY_SERVER_MODE",t.KEY_METRIC_CLIENT_CREATED="KEY_METRIC_CLIENT_CREATED",t.KEY_METRIC_JOIN_START="KEY_METRIC_JOIN_START",t.AVOID_JOIN_START="AVOID_JOIN_START",t.KEY_METRIC_JOIN_END="KEY_METRIC_JOIN_END",t.KEY_METRIC_REQUEST_AP_START="KEY_METRIC_REQUEST_AP_START",t.KEY_METRIC_REQUEST_AP_END="KEY_METRIC_REQUEST_AP_END",t.KEY_METRIC_JOIN_GATEWAY_START="KEY_METRIC_JOIN_GATEWAY_START",t.KEY_METRIC_JOIN_GATEWAY_END="KEY_METRIC_JOIN_GATEWAY_END",t.KEY_METRIC_PEER_CONNECTION_START="KEY_METRIC_PEER_CONNECTION_START",t.KEY_METRIC_PEER_CONNECTION_END="KEY_METRIC_PEER_CONNECTION_END",t.KEY_METRIC_DESCRIPTION_START="KEY_METRIC_DESCRIPTION_START",t.KEY_METRIC_ICE_CONNECTION_END="KEY_METRIC_ICE_CONNECTION_END",t.KEY_METRIC_SIGNAL_CHANNEL_OPEN="KEY_METRIC_SIGNAL_CHANNEL_OPEN",t.KEY_METRIC_PUBLISH="KEY_METRIC_PUBLISH",t.KEY_METRIC_SUBSCRIBE="KEY_METRIC_SUBSCRIBE",t.RECORD_JOIN_CHANNEL_SERVICE="RECORD_JOIN_CHANNEL_SERVICE",t.RESET_JOIN_CHANNEL_SERVICE_RECORDS="RESET_JOIN_CHANNEL_SERVICE_RECORDS",t.RESET_KEY_METRICS="RESET_KEY_METRICS",t.SET_USE_P2P="SET_USE_P2P",t.SET_TRANSPORT_TYPE="SET_TRANSPORT_TYPE",t}(En||{});let tP=function(t){return t.h264="h264",t.h265="h265",t.vp8="vp8",t.vp9="vp9",t.av1="av1",t}({});(function(t){t.opus="opus",t.pcma="pcma",t.pcmu="pcmu",t.g722="g722"})({});const rz=128,tme=96,iz=1e3,Wv=10;let nme=0;var sz=(()=>{var t={8:(a,c,u)=>{u.r(c),u.d(c,{Parser:()=>ht,Printer:()=>ui,parse:()=>st,print:()=>Ct});const h=`
`,m="".concat("\r").concat(h),y=" ";let v;function S(He){return He>="0"&&He<="9"}function R(He){return He>="!"&&He<="~"}function P(He){return R(He)||He>=""&&He<=""}function N(He){return He==="!"||He>="#"&&He<="'"||He>="*"&&He<="+"||He>="-"&&He<="."||He>="0"&&He<="9"||He>="A"&&He<="Z"||He>="^"&&He<="~"}function G(He){return He>="1"&&He<="9"}function F(He){return He>="A"&&He<="Z"||He>="a"&&He<="z"}function j(He){return He==="d"||He==="h"||He==="m"||He==="s"}function X(He){return He>""&&He<"	"||He>"\v"&&He<"\f"||He>""&&He<""}function ee(He){return F(He)||S(He)||He==="+"||He==="/"}function he(He){return S(He)||F(He)||He==="+"||He==="/"||He==="-"||He==="_"}function Se(He){return F(He)||S(He)||He==="+"||He==="/"}function Te(He,M){var ae=Object.keys(He);if(Object.getOwnPropertySymbols){var fe=Object.getOwnPropertySymbols(He);M&&(fe=fe.filter(function(Qe){return Object.getOwnPropertyDescriptor(He,Qe).enumerable})),ae.push.apply(ae,fe)}return ae}function ye(He){for(var M=1;M<arguments.length;M++){var ae=arguments[M]!=null?arguments[M]:{};M%2?Te(Object(ae),!0).forEach(function(fe){Ne(He,fe,ae[fe])}):Object.getOwnPropertyDescriptors?Object.defineProperties(He,Object.getOwnPropertyDescriptors(ae)):Te(Object(ae)).forEach(function(fe){Object.defineProperty(He,fe,Object.getOwnPropertyDescriptor(ae,fe))})}return He}function Ne(He,M,ae){return M in He?Object.defineProperty(He,M,{value:ae,enumerable:!0,configurable:!0,writable:!0}):He[M]=ae,He}(function(He){He.VERSION="v",He.ORIGIN="o",He.SESSION_NAME="s",He.INFORMATION="i",He.URI="u",He.EMAIL="e",He.PHONE="p",He.CONNECTION="c",He.BANDWIDTH="b",He.TIME="t",He.REPEAT="r",He.ZONE_ADJUSTMENTS="z",He.KEY="k",He.ATTRIBUTE="a",He.MEDIA="m"})(v||(v={}));class Ye{consumeText(M,ae){let fe=ae;for(;fe<M.length;){const Qe=M[fe];if(Qe==="\0"||Qe==="\r"||Qe===h)break;fe+=1}if(fe-ae==0)throw new Error("Invalid text, at ".concat(M));return fe}consumeUnicastAddress(M,ae,fe){return this.consumeTill(M,ae,y)}consumeOneOrMore(M,ae,fe){let Qe=ae;for(;fe(M[Qe]);)Qe++;if(Qe-ae==0)throw new Error("Invalid rule at ".concat(ae,"."));return Qe}consumeSpace(M,ae){if(M[ae]===y)return ae+1;throw new Error("Invalid space at ".concat(ae,"."))}consumeIP4Address(M,ae){let fe=ae;for(let Qe=0;Qe<4;Qe++)if(fe=this.consumeDecimalUChar(M,fe),Qe!==3){if(M[fe]!==".")throw new Error("Invalid IP4 address.");fe++}return fe}consumeDecimalUChar(M,ae){let fe=ae;for(let Jt=0;Jt<3&&S(M[fe]);Jt++,fe++);if(fe-ae==0)throw new Error("Invalid decimal uchar.");const Qe=parseInt(M.slice(ae,fe));if(Qe>=0&&Qe<=255)return fe;throw new Error("Invalid decimal uchar")}consumeIP6Address(M,ae){let fe=this.consumeHexpart(M,ae);return M[fe]===":"&&(fe+=1,fe=this.consumeIP4Address(M,fe)),fe}consumeHexpart(M,ae){let fe=ae;if(M[fe]===":"&&M[fe+1]===":"){fe+=2;try{fe=this.consumeHexseq(M,fe)}catch{}return fe}if(fe=this.consumeHexseq(M,fe),M[fe]===":"&&M[fe+1]===":"){fe+=2;try{fe=this.consumeHexseq(M,fe)}catch{}return fe}return fe}consumeHexseq(M,ae){let fe=ae;for(;fe=this.consumeHex4(M,fe),M[fe]===":"&&M[fe+1]!==":";)fe+=1;return fe}consumeHex4(M,ae){let fe=0;for(;fe<4;fe++)if(!((Qe=M[ae+fe])>="0"&&Qe<="9"||Qe>="a"&&Qe<="f"||Qe>="A"&&Qe<="F")){if(fe===0)throw new Error("Invalid hex 4");break}var Qe;return ae+fe}consumeFQDN(M,ae){let fe=ae;for(;S(M[fe])||F(M[fe])||M[fe]==="-"||M[fe]===".";)fe+=1;if(fe-ae<4)throw new Error("Invalid FQDN");return fe}consumeExtnAddr(M,ae){return this.consumeOneOrMore(M,ae,P)}consumeMulticastAddress(M,ae,fe){switch(fe){case"IP4":case"ip4":return this.consumeIP4MulticastAddress(M,ae);case"IP6":case"ip6":return this.consumeIP6MulticastAddress(M,ae);default:try{return this.consumeFQDN(M,ae)}catch{return this.consumeExtnAddr(M,ae)}}}consumeIP6MulticastAddress(M,ae){const fe=this.consumeHexpart(M,ae);return M[fe]==="/"?this.consumeInteger(M,fe+1):fe}consumeIP4MulticastAddress(M,ae){let fe=ae+3;const Qe=M.slice(ae,fe),Jt=parseInt(Qe);if(Jt<224||Jt>239)throw new Error("Invalid IP4 multicast address, IPv4 multicast addresses may be in the range 224.0.0.0 to 239.255.255.255.");for(let sr=0;sr<3;sr++){if(M[fe]!==".")throw new Error("Invalid IP4 multicast address.");fe+=1,fe=this.consumeDecimalUChar(M,fe)}return M[fe]==="/"&&(fe+=1),fe=this.consumeTTL(M,fe),M[fe]==="/"&&(fe=this.consumeInteger(M,fe)),fe}consumeInteger(M,ae){if(!G(M[ae]))throw new Error("Invalid integer.");for(ae+=1;S(M[ae]);)ae+=1;return ae}consumeTTL(M,ae){if(M[ae]==="0")return ae+1;if(!G(M[ae]))throw new Error("Invalid TTL.");ae+=1;for(let fe=0;fe<2&&S(M[ae]);fe++)ae+=1;return ae}consumeToken(M,ae){return this.consumeOneOrMore(M,ae,N)}consumeTime(M,ae){let fe=ae;if(M[fe]==="0")return fe+1;for(G(M[fe])&&(fe+=1);S(M[fe]);)fe++;if(fe-ae<10)throw new Error("Invalid time");return fe}consumeAddress(M,ae){return this.consumeTill(M,ae,y)}consumeTypedTime(M,ae){let fe=ae;return fe=this.consumeOneOrMore(M,fe,S),j(M[fe])?fe+1:fe}consumeRepeatInterval(M,ae){if(!G(M[ae]))throw new Error("Invalid repeat interval");for(ae+=1;S(M[ae]);)ae+=1;return j(M[ae])&&(ae+=1),ae}consumePort(M,ae){return this.consumeOneOrMore(M,ae,S)}consume(M,ae,fe){for(let Qe=0;Qe<fe.length;Qe++){if(ae+Qe>=M.length)throw new Error("consume exceeding value length");if(M[ae+Qe]!==fe[Qe])throw new Error("consume ".concat(fe," failed at ").concat(Qe))}return ae+fe.length}consumeTill(M,ae,fe){let Qe=ae;for(;Qe<M.length&&(typeof fe!="string"||M[Qe]!==fe)&&(typeof fe!="function"||!fe(M[Qe]));)Qe++;return Qe}}class ht extends Ye{constructor(){super(),Ne(this,"records",[]),Ne(this,"currentLine",0)}parse(M){const ae=this.probeEOL(M);this.records=M.split(ae).filter(dy=>!!po(dy).call(dy)).map(this.parseLine),this.currentLine=0;const fe=this.parseVersion(),Qe=this.parseOrigin(),Jt=this.parseSessionName(),sr=this.parseInformation(),Qi=this.parseUri(),Ha=this.parseEmail(),gp=this.parsePhone(),uy=this.parseConnection(),fw=this.parseBandWidth(),hO=this.parseTimeFields(),fO=this.parseKey(),Nl=this.parseSessionAttribute(),ig=this.parseMediaDescription();if(this.currentLine!==this.records.length)throw new Error("parsing failed, non exhaustive sdp lines.");return{version:fe,origin:Qe,sessionName:Jt,information:sr,uri:Qi,emails:Ha,phones:gp,connection:uy,bandwidths:fw,timeFields:hO,key:fO,attributes:Nl,mediaDescriptions:ig}}getCurrentRecord(){const M=this.records[this.currentLine];if(!M)throw new Error("Record doesn't exit.");return M}probeEOL(M){for(let ae=0;ae<M.length;ae++)if(M[ae]===h)return M[ae-1]==="\r"?m:h;throw new Error("Invalid newline character.")}parseLine(M,ae){if(M.length<2)throw new Error("Invalid sdp line, sdp line should be of form <type>=<value>.");const fe=M[0];if(M[1]!=="=")throw new Error('Invalid sdp line, <type> should be a single character followed by an "=" sign.');return{type:fe,value:M.slice(2),line:ae,cur:0}}parseSessionAttribute(){const M=new Tn;for(;this.currentLine<this.records.length;){const ae=this.getCurrentRecord();if(ae.type!==v.ATTRIBUTE)break;const fe={attField:this.extractOneOrMore(ae,Qe=>N(Qe)&&Qe!==":"),_cur:0};ae.value[ae.cur]===":"&&(ae.cur+=1,fe.attValue=this.extractOneOrMore(ae,X)),M.parse(fe),this.currentLine++}return M.digest()}parseMediaAttributes(M){const ae=new wn(M);for(;this.currentLine<this.records.length;){const fe=this.getCurrentRecord();if(fe.type!==v.ATTRIBUTE)break;const Qe={attField:this.extractOneOrMore(fe,Jt=>N(Jt)&&Jt!==":"),_cur:0};fe.value[fe.cur]===":"&&(fe.cur+=1,Qe.attValue=this.extractOneOrMore(fe,X)),ae.parse(Qe),this.currentLine++}return ae.digest()}parseKey(){const M=this.getCurrentRecord();if(M.type===v.KEY){if(M.value==="prompt"||M.value==="clear:"||M.value==="base64:"||M.value==="uri:")return M.value;throw this.currentLine++,new Error("Invalid key.")}}parseZone(){const M=this.getCurrentRecord();if(M.type===v.ZONE_ADJUSTMENTS){const ae=[];for(;;)try{const fe=this.extract(M,this.consumeTime);this.consumeSpaceForRecord(M);let Qe=!1;M.value[M.cur]==="-"&&(Qe=!0,M.cur+=1);const Jt=this.extract(M,this.consumeTypedTime);ae.push({time:fe,typedTime:Jt,back:Qe})}catch{break}if(ae.length===0)throw new Error("Invalid zone adjustments");return this.currentLine++,ae}return[]}parseRepeat(){const M=[];for(;;){const ae=this.getCurrentRecord();if(ae.type!==v.REPEAT)break;{const fe=this.extract(ae,this.consumeRepeatInterval),Qe=this.parseTypedTime(ae);M.push({repeatInterval:fe,typedTimes:Qe}),this.currentLine++}}return M}parseTypedTime(M){const ae=[];for(;;)try{this.consumeSpaceForRecord(M),ae.push(this.extract(M,this.consumeTypedTime))}catch{break}if(ae.length===0)throw new Error("Invalid typed time.");return ae}parseTime(){const M=this.getCurrentRecord(),ae=this.extract(M,this.consumeTime);this.consumeSpaceForRecord(M);const fe=this.extract(M,this.consumeTime);return this.currentLine++,{startTime:ae,stopTime:fe}}parseBandWidth(){const M=[];for(;this.currentLine<this.records.length;){const ae=this.getCurrentRecord();if(ae.type!==v.BANDWIDTH)break;{const fe=this.extractOneOrMore(ae,N);if(ae.value[ae.cur]!==":")throw new Error("Invalid bandwidth field.");ae.cur++;const Qe=this.extractOneOrMore(ae,S);M.push({bwtype:fe,bandwidth:Qe}),this.currentLine++}}return M}parseVersion(){const M=this.getCurrentRecord();if(M.type!==v.VERSION)throw new Error("first sdp record must be version");const ae=M.value.slice(0,this.consumeOneOrMore(M.value,0,S));if(ae.length!==M.value.length)throw new Error('invalid proto version, "v='.concat(M.value,'"'));return this.currentLine++,ae}parseOrigin(){const M=this.getCurrentRecord();if(M.type!==v.ORIGIN)throw new Error("second line of sdp must be origin");const ae=this.extractOneOrMore(M,P);this.consumeSpaceForRecord(M);const fe=this.extractOneOrMore(M,S);this.consumeSpaceForRecord(M);const Qe=this.extractOneOrMore(M,S);this.consumeSpaceForRecord(M);const Jt=this.extractOneOrMore(M,N);this.consumeSpaceForRecord(M);const sr=this.extractOneOrMore(M,N);this.consumeSpaceForRecord(M);const Qi=this.extract(M,this.consumeUnicastAddress);return this.currentLine++,{username:ae,sessId:fe,sessVersion:Qe,nettype:Jt,addrtype:sr,unicastAddress:Qi}}parseSessionName(){const M=this.getCurrentRecord();if(M.type===v.SESSION_NAME){const ae=this.extract(M,this.consumeText);return this.currentLine++,ae}}parseInformation(){const M=this.getCurrentRecord();if(M.type!==v.INFORMATION)return;const ae=this.extract(M,this.consumeText);return this.currentLine++,ae}parseUri(){const M=this.getCurrentRecord();if(M.type===v.URI)return this.currentLine++,M.value}parseEmail(){const M=[];for(;;){const ae=this.getCurrentRecord();if(ae.type!==v.EMAIL)break;M.push(ae.value),this.currentLine++}return M}parsePhone(){const M=[];for(;;){const ae=this.getCurrentRecord();if(ae.type!==v.PHONE)break;M.push(ae.value),this.currentLine++}return M}parseConnection(){const M=this.getCurrentRecord();if(M.type===v.CONNECTION){const ae=this.extractOneOrMore(M,N);this.consumeSpaceForRecord(M);const fe=this.extractOneOrMore(M,N);this.consumeSpaceForRecord(M);const Qe=this.extract(M,this.consumeAddress);return this.currentLine++,{nettype:ae,addrtype:fe,address:Qe}}}parseMedia(){const M=this.getCurrentRecord(),ae=this.extract(M,this.consumeToken);this.consumeSpaceForRecord(M);let fe=this.extract(M,this.consumePort);M.value[M.cur]==="/"&&(M.cur+=1,fe+=this.extract(M,this.consumeInteger)),this.consumeSpaceForRecord(M);const Qe=[];for(Qe.push(this.extract(M,this.consumeToken));M.value[M.cur]==="/";)M.cur+=1,Qe.push(this.extract(M,this.consumeToken));if(Qe.length===0)throw new Error("Invalid proto");const Jt=this.parseFmt(M);return this.currentLine++,{mediaType:ae,port:fe,protos:Qe,fmts:Jt}}parseTimeFields(){const M=[];for(;this.getCurrentRecord().type===v.TIME;){const ae=this.parseTime(),fe=this.parseRepeat(),Qe=this.parseZone();M.push({time:ae,repeats:fe,zones:Qe})}return M}parseMediaDescription(){const M=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===v.MEDIA;){const ae=this.parseMedia(),fe=this.parseInformation(),Qe=this.parseConnections(),Jt=this.parseBandWidth(),sr=this.parseKey(),Qi=this.parseMediaAttributes(ae);M.push({media:ae,information:fe,connections:Qe,bandwidths:Jt,key:sr,attributes:Qi})}return M}parseConnections(){const M=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===v.CONNECTION;)M.push(this.parseConnection());return M}parseFmt(M){const ae=[];for(;;)try{this.consumeSpaceForRecord(M),ae.push(this.extract(M,this.consumeToken))}catch{break}if(ae.length===0)throw new Error("Invalid fmts");return ae}extract(M,ae){for(var fe=arguments.length,Qe=new Array(fe>2?fe-2:0),Jt=2;Jt<fe;Jt++)Qe[Jt-2]=arguments[Jt];const sr=ae.call(this,M.value,M.cur,...Qe),Qi=M.value.slice(M.cur,sr);return M.cur=sr,Qi}extractOneOrMore(M,ae){const fe=this.consumeOneOrMore(M.value,M.cur,ae),Qe=M.value.slice(M.cur,fe);return M.cur=fe,Qe}consumeSpaceForRecord(M){if(M.value[M.cur]!==y)throw new Error("Invalid space at ".concat(M.cur,"."));M.cur+=1}}class mt extends Ye{constructor(){super(...arguments),Ne(this,"attributes",void 0),Ne(this,"digested",!1)}extractOneOrMore(M,ae,fe){const Qe=this.consumeOneOrMore(M.attValue,M._cur,ae),Jt=M.attValue.slice(M._cur,Qe),[sr,Qi]=fe||[];if(typeof sr=="number"&&Jt.length<sr)throw new Error("error in length, should be more or equal than ".concat(sr," characters."));if(typeof Qi=="number"&&Jt.length>Qi)throw new Error("error in length, should be less or equal than ".concat(Qi," characters."));return M._cur=Qe,Jt}consumeAttributeSpace(M){if(M.attValue[M._cur]!==y)throw new Error("Invalid space at ".concat(M._cur,"."));M._cur+=1}extract(M,ae){if(!M.attValue)throw new Error("Nothing to extract from attValue.");for(var fe=arguments.length,Qe=new Array(fe>2?fe-2:0),Jt=2;Jt<fe;Jt++)Qe[Jt-2]=arguments[Jt];const sr=ae.call(this,M.attValue,M._cur,...Qe),Qi=M.attValue.slice(M._cur,sr);return M._cur=sr,Qi}atEnd(M){if(!M.attValue)throw new Error;return M._cur>=M.attValue.length}peekChar(M){if(!M.attValue)throw new Error;return M.attValue[M._cur]}peek(M,ae){if(!M.attValue)throw new Error;for(let fe=0;fe<ae.length;fe++)if(ae[fe]!==M.attValue[M._cur+fe])return!1;return!0}parseIceUfrag(M){if(this.attributes.iceUfrag)throw new Error("Invalid ice-ufrag, should be only a single line if 'a=ice-ufrag'");this.attributes.iceUfrag=this.extractOneOrMore(M,ee,[4,256])}parseIcePwd(M){if(this.attributes.icePwd)throw new Error("Invalid ice-pwd, should be only a single line if 'a=ice-pwd'");this.attributes.icePwd=this.extractOneOrMore(M,ee,[22,256])}parseIceOptions(M){if(this.attributes.iceOptions)throw new Error("Invalid ice-options, should be only one 'ice-options' line");const ae=[];for(;!this.atEnd(M);){ae.push(this.extractOneOrMore(M,ee));try{this.consumeAttributeSpace(M)}catch(fe){if(this.atEnd(M))break;throw fe}}this.attributes.iceOptions=ae}parseFingerprint(M){const ae=this.extract(M,this.consumeToken);this.consumeAttributeSpace(M);const fe=this.extract(M,this.consumeTill);this.attributes.fingerprints.push({hashFunction:ae,fingerprint:fe})}parseExtmap(M){const ae=this.extractOneOrMore(M,S);let fe;this.peekChar(M)==="/"&&(this.extract(M,this.consume,"/"),fe=this.extract(M,this.consumeToken)),this.consumeAttributeSpace(M);const Qe=this.extract(M,this.consumeTill,y),Jt=ye(ye({entry:parseInt(ae,10)},fe&&{direction:fe}),{},{extensionName:Qe});this.peekChar(M)===y&&(this.consumeAttributeSpace(M),Jt.extensionAttributes=this.extract(M,this.consumeTill)),this.attributes.extmaps.push(Jt)}parseSetup(M){if(this.attributes.setup)throw new Error("must only be one single 'a=setup' line.");const ae=this.extract(M,this.consumeTill);if(ae!=="active"&&ae!=="passive"&&ae!=="actpass"&&ae!=="holdconn")throw new Error("role must be one of 'active', 'passive', 'actpass', 'holdconn'.");this.attributes.setup=ae}}class Tn extends mt{constructor(){super(...arguments),Ne(this,"attributes",{unrecognized:[],groups:[],extmaps:[],fingerprints:[],identities:[]})}parse(M){if(this.digested)throw new Error("already digested");try{switch(M.attField){case"group":this.parseGroup(M);break;case"ice-lite":this.parseIceLite();break;case"ice-ufrag":this.parseIceUfrag(M);break;case"ice-pwd":this.parseIcePwd(M);break;case"ice-options":this.parseIceOptions(M);break;case"fingerprint":this.parseFingerprint(M);break;case"setup":this.parseSetup(M);break;case"tls-id":this.parseTlsId(M);break;case"identity":this.parseIdentity(M);break;case"extmap":this.parseExtmap(M);break;case"msid-semantic":this.parseMsidSemantic(M);break;default:M.ignored=!0,this.attributes.unrecognized.push(M)}}catch(ae){throw console.error("parsing session attribute ".concat(M.attField,' error, "a=').concat(M.attField,":").concat(M.attValue,'"')),ae}if(!M.ignored&&M.attValue&&!this.atEnd(M))throw new Error("attribute parsing error")}digest(){return this.digested=!0,this.attributes}parseGroup(M){const ae=this.extract(M,this.consumeToken),fe=[];for(;!this.atEnd(M)&&this.peekChar(M)===y;)this.consumeAttributeSpace(M),fe.push(this.extract(M,this.consumeToken));this.attributes.groups.push({semantic:ae,identificationTag:fe})}parseIceLite(){if(this.attributes.iceLite)throw new Error("Invalid ice-lite, should be only a single line of 'a=ice-lite'");this.attributes.iceLite=!0}parseTlsId(M){if(this.attributes.tlsId)throw new Error("must be only one tld-id line");this.attributes.tlsId=this.extractOneOrMore(M,he)}parseIdentity(M){const ae=this.extractOneOrMore(M,Se),fe=[];for(;!this.atEnd(M)&&this.peekChar(M)===y;){this.consumeAttributeSpace(M);const Qe=this.extract(M,this.consumeToken);this.extract(M,this.consume,"=");const Jt=this.extractOneOrMore(M,sr=>sr!==y&&X(sr));fe.push({name:Qe,value:Jt})}this.attributes.identities.push({assertionValue:ae,extensions:fe})}parseMsidSemantic(M){this.peekChar(M)===y&&this.consumeAttributeSpace(M);const ae={semantic:this.extract(M,this.consumeToken),identifierList:[]};for(;;){try{this.consumeAttributeSpace(M)}catch{break}if(this.peekChar(M)==="*"){this.extract(M,this.consume,"*"),ae.applyForAll=!0;break}{const fe=this.extract(M,this.consumeTill,y);ae.identifierList.push(fe)}}this.attributes.msidSemantic=ae}}class wn extends mt{constructor(M){super(),Ne(this,"attributes",void 0),M.protos.indexOf("RTP")!==-1||M.protos.indexOf("rtp"),this.attributes={unrecognized:[],candidates:[],extmaps:[],fingerprints:[],imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[]}}parse(M){if(this.digested)throw new Error("already digested");try{switch(M.attField){case"extmap":this.parseExtmap(M);break;case"setup":this.parseSetup(M);break;case"ice-ufrag":this.parseIceUfrag(M);break;case"ice-pwd":this.parseIcePwd(M);break;case"ice-options":this.parseIceOptions(M);break;case"candidate":this.parseCandidate(M);break;case"remote-candidate":this.parseRemoteCandidate(M);break;case"end-of-candidates":this.parseEndOfCandidates();break;case"fingerprint":this.parseFingerprint(M);break;case"rtpmap":this.parseRtpmap(M);break;case"ptime":this.parsePtime(M);break;case"maxptime":this.parseMaxPtime(M);break;case"sendrecv":case"recvonly":case"sendonly":case"inactive":this.parseDirection(M);break;case"ssrc":this.parseSSRC(M);break;case"fmtp":this.parseFmtp(M);break;case"rtcp-fb":this.parseRtcpFb(M);break;case"rtcp-mux":this.parseRTCPMux();break;case"rtcp-mux-only":this.parseRTCPMuxOnly();break;case"rtcp-rsize":this.parseRTCPRsize();break;case"rtcp":this.parseRTCP(M);break;case"mid":this.parseMid(M);break;case"msid":this.parseMsid(M);break;case"imageattr":this.parseImageAttr(M);break;case"rid":this.parseRid(M);break;case"simulcast":this.parseSimulcast(M);break;case"sctp-port":this.parseSctpPort(M);break;case"max-message-size":this.parseMaxMessageSize(M);break;case"ssrc-group":this.parseSSRCGroup(M);break;default:M.ignored=!0,this.attributes.unrecognized.push(M)}}catch(ae){throw console.error("parsing media attribute ".concat(M.attField,' error, "a=').concat(M.attField,":").concat(M.attValue,'"')),ae}if(!M.ignored&&M.attValue&&!this.atEnd(M))throw new Error("attribute parsing error")}parseCandidate(M){const ae=this.extractOneOrMore(M,ee,[1,32]);this.consumeAttributeSpace(M);const fe=this.extractOneOrMore(M,S,[1,5]);this.consumeAttributeSpace(M);const Qe=this.extract(M,this.consumeToken);this.consumeAttributeSpace(M);const Jt=this.extractOneOrMore(M,S,[1,10]);this.consumeAttributeSpace(M);const sr=this.extract(M,this.consumeAddress);this.consumeAttributeSpace(M);const Qi=this.extract(M,this.consumePort);this.consumeAttributeSpace(M),this.extract(M,this.consume,"typ"),this.consumeAttributeSpace(M);const Ha={foundation:ae,componentId:fe,transport:Qe,priority:Jt,connectionAddress:sr,port:Qi,type:this.extract(M,this.consumeToken),extension:{}};for(this.peek(M," raddr")&&(this.extract(M,this.consume," raddr"),this.consumeAttributeSpace(M),Ha.relAddr=this.extract(M,this.consumeAddress)),this.peek(M," rport")&&(this.extract(M,this.consume," rport"),this.consumeAttributeSpace(M),Ha.relPort=this.extract(M,this.consumePort));this.peekChar(M)===y;){this.consumeAttributeSpace(M);const gp=this.extract(M,this.consumeToken);this.consumeAttributeSpace(M),Ha.extension[gp]=this.extractOneOrMore(M,R)}this.attributes.candidates.push(Ha)}parseRemoteCandidate(M){const ae=[];for(;;){const fe=this.extractOneOrMore(M,S,[1,5]);this.consumeAttributeSpace(M);const Qe=this.extract(M,this.consumeAddress);this.consumeAttributeSpace(M);const Jt=this.extract(M,this.consumePort);ae.push({componentId:fe,connectionAddress:Qe,port:Jt});try{this.consumeAttributeSpace(M)}catch{break}}this.attributes.remoteCandidatesList.push(ae)}parseEndOfCandidates(){if(this.attributes.endOfCandidates)throw new Error("must be only one line of end-of-candidates");this.attributes.endOfCandidates=!0}parseRtpmap(M){const ae=this.extract(M,this.consumeToken);this.consumeAttributeSpace(M);const fe=this.extract(M,this.consumeTill,"/");this.extract(M,this.consume,"/");const Qe={encodingName:fe,clockRate:this.extractOneOrMore(M,S)};this.atEnd(M)||this.peekChar(M)!=="/"||(this.extract(M,this.consume,"/"),Qe.encodingParameters=parseInt(this.extract(M,this.consumeTill),10));const Jt=this.attributes.payloads.find(sr=>sr.payloadType===parseInt(ae,10));Jt?Jt.rtpMap=Qe:this.attributes.payloads.push({payloadType:parseInt(ae,10),rtpMap:Qe,rtcpFeedbacks:[]})}parsePtime(M){if(this.attributes.ptime)throw new Error("must be only one line of ptime");this.attributes.ptime=this.extract(M,this.consumeTill)}parseMaxPtime(M){if(this.attributes.maxPtime)throw new Error("must be only one line of ptime");this.attributes.maxPtime=this.extract(M,this.consumeTill)}parseDirection(M){if(this.attributes.direction)throw new Error("must be only one line of direction info");this.attributes.direction=M.attField}parseSSRC(M){const ae=this.extractOneOrMore(M,S);this.consumeAttributeSpace(M);const fe=this.extract(M,this.consumeTill,":");let Qe;this.peekChar(M)===":"&&(this.extract(M,this.consume,":"),Qe=this.extract(M,this.consumeTill));const Jt=this.attributes.ssrcs.find(sr=>sr.ssrcId===parseInt(ae,10));Jt?Jt.attributes[fe]=Qe:this.attributes.ssrcs.push({ssrcId:parseInt(ae,10),attributes:{[fe]:Qe}})}parseFmtp(M){const ae=this.extract(M,this.consumeTill,y);this.consumeAttributeSpace(M);const fe=this.extract(M,this.consumeTill),Qe={};fe.split(";").forEach(sr=>{let[Qi,Ha]=sr.split("=");Qi=po(Qi).call(Qi);const gp=typeof Ha=="string"?po(Ha).call(Ha):null;typeof Qi=="string"&&Qi.length>0&&(Qe[Qi]=gp)});const Jt=this.attributes.payloads.find(sr=>sr.payloadType===parseInt(ae,10));Jt?Jt.fmtp={parameters:Qe}:this.attributes.payloads.push({payloadType:parseInt(ae,10),rtcpFeedbacks:[],fmtp:{parameters:Qe}})}parseFmtParameters(M){const ae={},fe=this.extract(M,this.consumeTill,"=");M._cur++;const Qe=this.extract(M,this.consumeTill,";");for(ae[fe]=Qe;M.attValue[M._cur]===";";){const Jt=this.extract(M,this.consumeTill,"=");M._cur++;const sr=this.extract(M,this.consumeTill,";");ae[Jt]=sr}return ae}parseRtcpFb(M){let ae="";ae=this.peekChar(M)==="*"?this.extract(M,this.consume,"*"):this.extract(M,this.consumeTill,y),this.consumeAttributeSpace(M);const fe=this.extract(M,this.consumeTill,y);let Qe;if(fe==="trr-int")Qe={type:fe,interval:this.extract(M,this.consumeTill)};else{const Jt={type:fe};this.peekChar(M)===y&&(this.consumeAttributeSpace(M),Jt.parameter=this.extract(M,this.consumeToken),this.peekChar(M)===y&&(Jt.additional=this.extract(M,this.consumeTill))),Qe=Jt}if(ae==="*")this.attributes.rtcpFeedbackWildcards.push(Qe);else{const Jt=this.attributes.payloads.find(sr=>sr.payloadType===parseInt(ae,10));Jt?Jt.rtcpFeedbacks.push(Qe):this.attributes.payloads.push({payloadType:parseInt(ae,10),rtcpFeedbacks:[Qe]})}}parseRTCPMux(){if(this.attributes.rtcpMux)throw new Error("must be single line of rtcp-mux");this.attributes.rtcpMux=!0}parseRTCPMuxOnly(){if(this.attributes.rtcpMuxOnly)throw new Error("must be single line of rtcp-only");this.attributes.rtcpMuxOnly=!0}parseRTCPRsize(){if(this.attributes.rtcpRsize)throw new Error("must be single line of rtcp-rsize");this.attributes.rtcpRsize=!0}parseRTCP(M){if(this.attributes.rtcp)throw new Error("must be single line of rtcp");const ae={port:this.extract(M,this.consumePort)};this.peekChar(M)===y&&(this.consumeAttributeSpace(M),ae.netType=this.extractOneOrMore(M,N),this.consumeAttributeSpace(M),ae.addressType=this.extractOneOrMore(M,N),this.consumeAttributeSpace(M),ae.address=this.extract(M,this.consumeAddress)),this.attributes.rtcp=ae}parseMsid(M){const ae={id:this.extractOneOrMore(M,N,[1,64])};this.peekChar(M)===y&&(this.consumeAttributeSpace(M),ae.appdata=this.extractOneOrMore(M,N,[1,64])),this.attributes.msids.push(ae)}parseImageAttr(M){this.attributes.imageattr.push(M.attValue)}parseRid(M){const ae=this.extractOneOrMore(M,Qe=>F(Qe)||S(Qe)||Qe==="_"||Qe==="-");this.consumeAttributeSpace(M);const fe={id:ae,direction:this.extract(M,this.consumeToken),params:[]};if(this.peekChar(M)===y){if(this.consumeAttributeSpace(M),this.peek(M,"pt=")){this.extract(M,this.consume,"pt=");const Qe=[];for(;;){const Jt=this.extract(M,this.consumeToken);Qe.push(Jt);try{this.extract(M,this.consume,",")}catch{break}}fe.payloads=Qe,this.peekChar(M)===y&&this.extract(M,this.consume,y)}for(;;){const Qe=this.extract(M,this.consumeToken);switch(Qe){case"depend":{const Jt={type:Qe,rids:this.extract(M,this.consume,"=").split(",")};fe.params.push(Jt);break}default:{const Jt={type:Qe};this.peekChar(M)==="="&&(this.extract(M,this.consume,"="),Jt.val=this.extract(M,this.consumeTill,";")),fe.params.push(Jt)}}try{this.extract(M,this.consume,";")}catch{break}}}this.attributes.rids.push(fe)}parseSimulcast(M){if(this.attributes.simulcast)throw new Error("must be single line of simulcast");this.attributes.simulcast=M.attValue,this.extract(M,this.consumeTill)}parseSctpPort(M){this.attributes.sctpPort=this.extractOneOrMore(M,S,[1,5])}parseMaxMessageSize(M){this.attributes.maxMessageSize=this.extractOneOrMore(M,S,[1,void 0])}digest(){return this.digested=!0,this.attributes}parseMid(M){this.attributes.mid=this.extract(M,this.consumeToken)}parseSSRCGroup(M){const ae=this.extract(M,this.consumeToken),fe=[];for(;;)try{this.consumeAttributeSpace(M);const Qe=this.extract(M,this.consumeInteger);fe.push(parseInt(Qe,10))}catch{break}this.attributes.ssrcGroups.push({semantic:ae,ssrcIds:fe})}}function fr(He,M,ae){return M in He?Object.defineProperty(He,M,{value:ae,enumerable:!0,configurable:!0,writable:!0}):He[M]=ae,He}class ui{constructor(){fr(this,"eol",m)}print(M,ae){let fe="";return ae&&(this.eol=ae),fe+=this.printVersion(M.version),fe+=this.printOrigin(M.origin),fe+=this.printSessionName(M.sessionName),fe+=this.printInformation(M.information),fe+=this.printUri(M.uri),fe+=this.printEmail(M.emails),fe+=this.printPhone(M.phones),fe+=this.printConnection(M.connection),fe+=this.printBandwidth(M.bandwidths),fe+=this.printTimeFields(M.timeFields),fe+=this.printKey(M.key),fe+=this.printSessionAttributes(M.attributes),fe+=this.printMediaDescription(M.mediaDescriptions),fe}printVersion(M){return"v=".concat(M).concat(this.eol)}printOrigin(M){return"o=".concat(M.username," ").concat(M.sessId," ").concat(M.sessVersion," ").concat(M.nettype," ").concat(M.addrtype," ").concat(M.unicastAddress).concat(this.eol)}printSessionName(M){return M?"s=".concat(M).concat(this.eol):""}printInformation(M){return M?"i=".concat(M).concat(this.eol):""}printUri(M){return M?"u=".concat(M).concat(this.eol):""}printEmail(M){let ae="";for(const fe of M)ae+="e=".concat(fe).concat(this.eol);return ae}printPhone(M){let ae="";for(const fe of M)ae+="e=".concat(fe).concat(this.eol);return ae}printConnection(M){return M?"c=".concat(M.nettype," ").concat(M.addrtype," ").concat(M.address).concat(this.eol):""}printBandwidth(M){let ae="";for(const fe of M)ae+="b=".concat(fe.bwtype,":").concat(fe.bandwidth).concat(this.eol);return ae}printTimeFields(M){let ae="";for(const fe of M){ae+="t=".concat(fe.time.startTime," ").concat(fe.time.startTime).concat(this.eol);for(const Qe of fe.repeats)ae+="r=".concat(Qe.repeatInterval," ").concat(Qe.typedTimes.join(" ")).concat(this.eol);fe.zoneAdjustments&&(ae+="z=",ae+="z=".concat(fe.zoneAdjustments.map(Qe=>"".concat(Qe.time," ").concat(Qe.back?"-":""," ").concat(Qe.typedTime)).join(" ")).concat(this.eol),ae+=this.eol)}return ae}printKey(M){return M?"k=".concat(M).concat(this.eol):""}printAttributes(M){let ae="";for(const fe of M)ae+="a=".concat(fe.attField).concat(fe.attValue?":".concat(fe.attValue):"").concat(this.eol);return ae}printMediaDescription(M){let ae="";for(const fe of M)ae+=this.printMedia(fe.media),ae+=this.printInformation(fe.information),ae+=this.printConnections(fe.connections),ae+=this.printBandwidth(fe.bandwidths),ae+=this.printKey(fe.key),ae+=this.printMediaAttributes(fe);return ae}printConnections(M){let ae="";for(const fe of M)ae+=this.printConnection(fe);return ae}printMedia(M){return"m=".concat(M.mediaType," ").concat(M.port," ").concat(M.protos.join("/")," ").concat(M.fmts.join(" ")).concat(this.eol)}printSessionAttributes(M){return new ma(this.eol).print(M)}printMediaAttributes(M){return new je(this.eol).print(M)}}class Xr{constructor(M){fr(this,"eol",void 0),this.eol=M}printIceUfrag(M){return M===void 0?"":"a=ice-ufrag:".concat(M).concat(this.eol)}printIcePwd(M){return M===void 0?"":"a=ice-pwd:".concat(M).concat(this.eol)}printIceOptions(M){return M===void 0?"":"a=ice-options:".concat(M.join(y)).concat(this.eol)}printFingerprints(M){return M.length>0?M.map(ae=>"a=fingerprint:".concat(ae.hashFunction).concat(y).concat(ae.fingerprint)).join(this.eol)+this.eol:""}printExtmap(M){return M.map(ae=>"a=extmap:".concat(ae.entry).concat(ae.direction?"/".concat(ae.direction):"").concat(y).concat(ae.extensionName).concat(ae.extensionAttributes?"".concat(y).concat(ae.extensionAttributes):"").concat(this.eol)).join("")}printSetup(M){return M===void 0?"":"a=setup:".concat(M).concat(this.eol)}printUnrecognized(M){return M.map(ae=>"a=".concat(ae.attField).concat(ae.attValue?":".concat(ae.attValue):"").concat(this.eol)).join("")}}class ma extends Xr{print(M){let ae="";return ae+=this.printGroups(M.groups),ae+=this.printMsidSemantic(M.msidSemantic),ae+=this.printIceLite(M.iceLite),ae+=this.printIceUfrag(M.iceUfrag),ae+=this.printIcePwd(M.icePwd),ae+=this.printIceOptions(M.iceOptions),ae+=this.printFingerprints(M.fingerprints),ae+=this.printSetup(M.setup),ae+=this.printTlsId(M.tlsId),ae+=this.printIdentity(M.identities),ae+=this.printExtmap(M.extmaps),ae+=this.printUnrecognized(M.unrecognized),ae}printGroups(M){let ae="";return M.length>0&&(ae+=M.map(fe=>"a=group:".concat(fe.semantic).concat(fe.identificationTag.map(Qe=>"".concat(y).concat(Qe)).join("")).concat(this.eol)).join("")),ae}printIceLite(M){return M===void 0?"":"a=ice-lite"+this.eol}printTlsId(M){return M?"a=tls-id:".concat(M).concat(this.eol):""}printIdentity(M){return M.length===0?"":M.map(ae=>"a=identity:".concat(ae.assertionValue).concat(ae.extensions.map(fe=>"".concat(y).concat(fe.name).concat(fe.value?"=".concat(fe.value):"")))).join(this.eol)+this.eol}printMsidSemantic(M){if(!M)return"";let ae="a=msid-semantic:".concat(M.semantic);return M.applyForAll?ae+="".concat(y,"*"):M.identifierList.length>0&&(ae+=M.identifierList.map(fe=>"".concat(y).concat(fe))),ae+this.eol}}class je extends Xr{print(M){const ae=M.attributes;let fe="";return fe+=this.printRTCP(ae.rtcp),fe+=this.printIceUfrag(ae.iceUfrag),fe+=this.printIcePwd(ae.icePwd),fe+=this.printIceOptions(ae.iceOptions),fe+=this.printCandidates(ae.candidates),fe+=this.printRemoteCandidatesList(ae.remoteCandidatesList),fe+=this.printEndOfCandidates(ae.endOfCandidates),fe+=this.printFingerprints(ae.fingerprints),fe+=this.printSetup(ae.setup),fe+=this.printMid(ae.mid),fe+=this.printExtmap(ae.extmaps),fe+=this.printRTPRelated(ae),fe+=this.printPtime(ae.ptime),fe+=this.printMaxPtime(ae.maxPtime),fe+=this.printDirection(ae.direction),fe+=this.printSSRCGroups(ae.ssrcGroups),fe+=this.printSSRC(ae.ssrcs),fe+=this.printRTCPMux(ae.rtcpMux),fe+=this.printRTCPMuxOnly(ae.rtcpMuxOnly),fe+=this.printRTCPRsize(ae.rtcpRsize),fe+=this.printMSId(ae.msids),fe+=this.printImageattr(ae.imageattr),fe+=this.printRid(ae.rids),fe+=this.printSimulcast(ae.simulcast),fe+=this.printSCTPPort(ae.sctpPort),fe+=this.printMaxMessageSize(ae.maxMessageSize),fe+=this.printUnrecognized(ae.unrecognized),fe}printCandidates(M){return M.map(ae=>"a=candidate:".concat(ae.foundation).concat(y).concat(ae.componentId).concat(y).concat(ae.transport).concat(y).concat(ae.priority).concat(y).concat(ae.connectionAddress).concat(y).concat(ae.port).concat(y,"typ").concat(y).concat(ae.type).concat(ae.relAddr?"".concat(y,"raddr").concat(y).concat(ae.relAddr):"").concat(ae.relPort?"".concat(y,"rport").concat(y).concat(ae.relPort):"").concat(Object.keys(ae.extension).map(fe=>"".concat(y).concat(fe).concat(y).concat(ae.extension[fe])).join("")).concat(this.eol)).join("")}printRemoteCandidatesList(M){return M.map(ae=>"a=remote-candidates:".concat(ae.join(y)).concat(this.eol)).join("")}printEndOfCandidates(M){return M===void 0?"":"a=end-of-candidates"+this.eol}printRTPRelated(M){if(!M.payloads)return"";const ae=M.payloads;let fe="";fe+=M.rtcpFeedbackWildcards.map(Qe=>this.printRTCPFeedback("*",Qe)).join("");for(const Qe of ae)fe+=this.printRtpMap(Qe.payloadType,Qe.rtpMap),fe+=this.printFmtp(Qe.payloadType,Qe.fmtp),fe+=Qe.rtcpFeedbacks.map(Jt=>this.printRTCPFeedback(Qe.payloadType,Jt)).join("");return fe}printFmtp(M,ae){if(!ae)return"";const fe=Object.keys(ae.parameters);return fe.length===1&&ae.parameters[fe[0]]===null?"a=fmtp:".concat(M).concat(y).concat(fe[0]).concat(this.eol):"a=fmtp:".concat(M).concat(y).concat(Object.keys(ae.parameters).map(Qe=>"".concat(Qe,"=").concat(ae.parameters[Qe])).join(";")).concat(this.eol)}printRtpMap(M,ae){return ae?"a=rtpmap:".concat(M).concat(y).concat(ae.encodingName,"/").concat(ae.clockRate).concat(ae.encodingParameters?"/".concat(ae.encodingParameters):"").concat(this.eol):""}printRTCPFeedback(M,ae){let fe="a=rtcp-fb:".concat(M).concat(y),Qe=ae;return Qe.type==="trr-int"?fe+="ttr-int".concat(y).concat(Qe.interval):(fe+="".concat(Qe.type),Qe.parameter&&(fe+="".concat(y).concat(Qe.parameter),Qe.additional&&(fe+="".concat(y).concat(Qe.additional)))),fe+this.eol}printPtime(M){return M===void 0?"":"a=ptime:".concat(M).concat(this.eol)}printMaxPtime(M){return M===void 0?"":"a=maxptime:".concat(M).concat(this.eol)}printDirection(M){return M===void 0?"":"a=".concat(M).concat(this.eol)}printSSRC(M){return M.map(ae=>Object.keys(ae.attributes).map(fe=>"a=ssrc:".concat(ae.ssrcId.toString(10)).concat(y).concat(fe).concat(ae.attributes[fe]?":".concat(ae.attributes[fe]):"").concat(this.eol)).join("")).join("")}printRTCPMux(M){return M===void 0?"":"a=rtcp-mux".concat(this.eol)}printRTCPMuxOnly(M){return M===void 0?"":"a=rtcp-mux-only".concat(this.eol)}printRTCPRsize(M){return M===void 0?"":"a=rtcp-rsize".concat(this.eol)}printRTCP(M){if(M===void 0)return"";let ae="a=rtcp:".concat(M.port);return M.netType&&(ae+="".concat(y).concat(M.netType)),M.addressType&&(ae+="".concat(y).concat(M.addressType)),M.address&&(ae+="".concat(y).concat(M.address)),ae+this.eol}printMSId(M){return M.map(ae=>"a=msid:".concat(ae.id).concat(ae.appdata?"".concat(y).concat(ae.appdata):"").concat(this.eol)).join("")}printImageattr(M){return M.map(ae=>"a=imageattr:".concat(ae).concat(this.eol)).join("")}printRid(M){return M.map(ae=>{let fe="a=rid:".concat(ae.id).concat(y).concat(ae.direction);return ae.payloads&&(fe+="".concat(y,"pt=").concat(ae.payloads.join(","))),ae.params.length>0&&(fe+="".concat(y).concat(ae.params.map(Qe=>Qe.type==="depend"?"depend=".concat(Qe.rids.join(",")):"".concat(Qe.type,"=").concat(Qe.val)).join(";"))),fe+this.eol}).join("")}printSimulcast(M){return M===void 0?"":"a=simulcast:".concat(M).concat(this.eol)}printSCTPPort(M){return M===void 0?"":"a=sctp-port:".concat(M).concat(this.eol)}printMaxMessageSize(M){return M===void 0?"":"a=max-message-size:".concat(M).concat(this.eol)}printMid(M){return M===void 0?"":"a=mid:".concat(M).concat(this.eol)}printSSRCGroups(M){return M.map(ae=>"a=ssrc-group:".concat(ae.semantic).concat(ae.ssrcIds.map(fe=>"".concat(y).concat(fe.toString(10))).join("")).concat(this.eol)).join("")}}function st(He){return new ht().parse(He)}function Ct(He,M){return new ui().print(He,M)}}},r={};function s(a){if(r[a])return r[a].exports;var c=r[a]={exports:{}};return t[a](c,c.exports,s),c.exports}return s.d=(a,c)=>{for(var u in c)s.o(c,u)&&!s.o(a,u)&&Object.defineProperty(a,u,{enumerable:!0,get:c[u]})},s.o=(a,c)=>Object.prototype.hasOwnProperty.call(a,c),s.r=a=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(a,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(a,"__esModule",{value:!0})},s(8)})();function Ba(t){return sz.parse(t)}function Bm(t,r){return sz.print(t,r)}var rme=cc("Array").keys,ime=Nc,sme=Ci,ome=O,ame=rme,NL=Array.prototype,cme={DOMTokenList:!0,NodeList:!0},lme=function(t){var r=t.keys;return t===NL||ome(NL,t)&&r===NL.keys||sme(cme,ime(t))?ame:r},Kc=l(lme);function oz(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}function ln(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?oz(Object(s),!0).forEach(function(a){Hr(t,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):oz(Object(s)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))})}return t}function Hr(t,r,s){return(r=function(a){var c=function(u,h){if(typeof u!="object"||u===null)return u;var m=u[Symbol.toPrimitive];if(m!==void 0){var y=m.call(u,"string");if(typeof y!="object")return y;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(u)}(a);return typeof c=="symbol"?c:String(c)}(r))in t?Object.defineProperty(t,r,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[r]=s,t}const az=new class extends Ur{constructor(){super(...arguments),Hr(this,"currentUploadLogID",0)}reportLogUploadError(t){const{errorRange:r}=t;r[r.length-1]&&r[r.length-1]>this.currentUploadLogID&&(this.currentUploadLogID=r[r.length-1],this.emit("REPORT_LOG_UPLOAD",t))}};class ume{constructor(r){Hr(this,"logger",void 0),Hr(this,"prefixLists",[]),this.logger=r}debug(){for(var r=arguments.length,s=new Array(r),a=0;a<r;a++)s[a]=arguments[a];this.logger.debug(...this.prefixLists,...s)}info(){for(var r=arguments.length,s=new Array(r),a=0;a<r;a++)s[a]=arguments[a];this.logger.info(...this.prefixLists,...s)}warning(){for(var r=arguments.length,s=new Array(r),a=0;a<r;a++)s[a]=arguments[a];this.logger.warning(...this.prefixLists,...s)}error(){for(var r=arguments.length,s=new Array(r),a=0;a<r;a++)s[a]=arguments[a];this.logger.error(...this.prefixLists,...s)}prefix(r){return this.prefixLists.push(r),this}popPrefix(){return this.prefixLists.pop(),this}}function DL(){const t=new Date;return t.toTimeString().split(" ")[0]+":"+t.getMilliseconds()}function cz(){const t=new Date,r=/((\d+:){2}\d+)/.exec(new Date().toUTCString());return r?(r==null?void 0:r[0])+":"+t.getUTCMilliseconds():t.toTimeString().split(" ")[0]+":"+t.getMilliseconds()}const Cl={DEBUG:0,INFO:1,WARNING:2,ERROR:3,NONE:4},nP=Date.now(),kT=t=>{for(const r in Cl)if(Object.prototype.hasOwnProperty.call(Cl,r)&&Cl[r]===t)return r;return"DEFAULT"},x=new class{constructor(){Hr(this,"proxyServerURL",void 0),Hr(this,"logLevel",Cl.DEBUG),Hr(this,"uploadState","collecting"),Hr(this,"uploadLogWaitingList",[]),Hr(this,"uploadLogUploadingList",[]),Hr(this,"uploadErrorCount",0),Hr(this,"currentLogID",0),Hr(this,"url",void 0),Hr(this,"extLog",(t,r)=>{this.appendLogToWaitingList(t,...r)})}debug(){for(var t=arguments.length,r=new Array(t),s=0;s<t;s++)r[s]=arguments[s];const a=[Cl.DEBUG].concat(r);this.log.apply(this,a)}info(){for(var t=arguments.length,r=new Array(t),s=0;s<t;s++)r[s]=arguments[s];const a=[Cl.INFO].concat(r);this.log.apply(this,a)}warning(){for(var t=arguments.length,r=new Array(t),s=0;s<t;s++)r[s]=arguments[s];const a=[Cl.WARNING].concat(r);this.log.apply(this,a)}warn(){this.warning(...arguments)}error(){for(var t=arguments.length,r=new Array(t),s=0;s<t;s++)r[s]=arguments[s];const a=[Cl.ERROR].concat(r);this.log.apply(this,a)}upload(){for(var t=arguments.length,r=new Array(t),s=0;s<t;s++)r[s]=arguments[s];const a=[Cl.DEBUG].concat(r);this.uploadLog.apply(this,a)}setLogLevel(t){t=Math.min(Math.max(0,t),4),this.logLevel=t}enableLogUpload(){tr("UPLOAD_LOG",!0)}disableLogUpload(){tr("UPLOAD_LOG",!1),this.uploadLogUploadingList=[],this.uploadLogWaitingList=[]}setProxyServer(t){this.proxyServerURL=t}prefix(t){return new ume(this).prefix(t)}log(){for(var t=arguments.length,r=new Array(t),s=0;s<t;s++)r[s]=arguments[s];if(Date.now()-nP<100)return void setTimeout(()=>{this.log(...r)},Date.now()-nP);const a=Math.max(0,Math.min(4,r[0]));if(r[0]=DL()+" Agora-SDK [".concat(kT(a),"]:"),this.appendLogToWaitingList(a,...r),a<this.logLevel)return;const c=DL()+" %cAgora-SDK [".concat(kT(a),"]:");let u=[];if(!oe("USE_NEW_LOG"))switch(a){case Cl.DEBUG:u=[c,"color: #64B5F6;"].concat(r.slice(1)),console.log.apply(console,u);break;case Cl.INFO:u=[c,"color: #1E88E5; font-weight: bold;"].concat(r.slice(1)),console.log.apply(console,u);break;case Cl.WARNING:u=[c,"color: #FB8C00; font-weight: bold;"].concat(r.slice(1)),console.warn.apply(console,u);break;case Cl.ERROR:u=[c,"color: #B00020; font-weight: bold;"].concat(r.slice(1)),console.error.apply(console,u)}}uploadLog(){for(var t=arguments.length,r=new Array(t),s=0;s<t;s++)r[s]=arguments[s];if(Date.now()-nP<100)return void setTimeout(()=>{this.uploadLog(...r)},Date.now()-nP);const a=Math.max(0,Math.min(4,r[0]));r[0]=DL()+" Agora-SDK [".concat(kT(a),"]:"),this.appendLogToWaitingList(a,...r)}appendLogToWaitingList(t){if(!oe("UPLOAD_LOG"))return;for(var r=arguments.length,s=new Array(r>1?r-1:0),a=1;a<r;a++)s[a-1]=arguments[a];Array.isArray(s[0])?s[0][0]=cz()+" Agora-SDK [".concat(kT(t),"]:"):s[0]=cz()+" Agora-SDK [".concat(kT(t),"]:");let c="";s.forEach(u=>{typeof u=="object"&&(u=JSON.stringify(u)),c+="".concat(u," ")}),this.uploadLogWaitingList.push({payload_str:c,log_level:t,log_item_id:this.currentLogID++}),this.uploadState==="uploading"&&this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}startUpload(){this.uploadState="uploading",this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}async uploadLogs(){const t=this.uploadLogUploadingList,r={sdk_version:wl,process_id:oe("PROCESS_ID"),payload:JSON.stringify(t)};return _d(async()=>{const s=await la.post(this.url||(this.proxyServerURL?"https://".concat(this.proxyServerURL,"/ls/?h=").concat(oe("LOG_UPLOAD_SERVER"),"&p=443&d=upload/v1"):"https://".concat(oe("LOG_UPLOAD_SERVER"),"/upload/v1")),r,{responseType:"text"});if(s.data!=="OK"){const a=new Error("unexpected upload log response");throw a.response=s,a}},()=>(this.uploadLogUploadingList=[],!1),s=>{const a={status:-1,message:s.message,errorRange:t.map(c=>c.log_item_id)};return s.response?(a.status=s.response.status,a.data=s.response.data,a.headers=s.response.headers):s.request&&(a.status=s.request.status),az.reportLogUploadError(a),!0},{timeout:oe("UPLOAD_LOG_REQUEST_RETRY_INTERVAL"),maxRetryTimeout:oe("UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL")})}uploadLogInterval(){this.uploadLogUploadingList.length===0&&this.uploadLogWaitingList.length===0||(this.uploadLogUploadingList.length===0&&(this.uploadLogUploadingList=this.uploadLogWaitingList.splice(0,oe("UPLOAD_LOG_LENGTH_EACH_TIME"))),this.uploadLogs().then(()=>{this.uploadErrorCount=0,this.uploadLogWaitingList.length>0&&window.setTimeout(()=>this.uploadLogInterval(),oe("UPLOAD_LOG_INTERVAL"))}).catch(t=>{this.uploadErrorCount+=1,this.uploadErrorCount<2?window.setTimeout(()=>this.uploadLogInterval(),oe("UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1")):window.setTimeout(()=>this.uploadLogInterval(),oe("UPLOAD_LOG_RETRY_INTERVAL_V1"))}))}};var lz;function dme(t){return fs(t.reportId,"params.reportId",0,100,!1),fs(t.category,"params.category",0,100,!1),fs(t.event,"params.event",0,100,!1),fs(t.label,"params.label",0,100,!1),ir(t.value,"params.value",Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,!1),!0}(lz={}).FREE="free",lz.UPLOADING="uploading",function(t){t[t.MISC=0]="MISC",t[t.INTERNAL_EVENT=1]="INTERNAL_EVENT",t[t.PUBLIC_EVENT=2]="PUBLIC_EVENT",t[t.WEB_EVENT=3]="WEB_EVENT",t[t.INTERNAL_API=4]="INTERNAL_API",t[t.WEB_API=5]="WEB_API",t[t.PUBLIC_API=6]="PUBLIC_API"}({});const hme={sid:"",lts:0,success:null,cname:null,uid:null,peer:null,cid:null,elapse:null,extend:null,vid:0};let Xi=function(t){return t.PUBLISH="publish",t.SUBSCRIBE="subscribe",t.WS_COMPRESSOR_INIT="ws_compressor_init",t.SESSION_INIT="session_init",t.JOIN_CHOOSE_SERVER="join_choose_server",t.REQ_USER_ACCOUNT="req_user_account",t.JOIN_GATEWAY="join_gateway",t.REJOIN_GATEWAY="rejoin_gateway",t.STREAM_SWITCH="stream_switch",t.REQUEST_PROXY_WORKER_MANAGER="request_proxy_worker_manager",t.REQUEST_PROXY_APPCENTER="request_proxy_appcenter",t.FIRST_VIDEO_RECEIVED="first_video_received",t.FIRST_AUDIO_RECEIVED="first_audio_received",t.FIRST_VIDEO_DECODE="first_video_decode",t.FIRST_AUDIO_DECODE="first_audio_decode",t.ON_ADD_AUDIO_STREAM="on_add_audio_stream",t.ON_ADD_VIDEO_STREAM="on_add_video_stream",t.ON_UPDATE_STREAM="on_update_stream",t.ON_REMOVE_STREAM="on_remove_stream",t.USER_ANALYTICS="req_user_analytics",t.PC_STATS="pc_stats",t.UPDATE_REMOTE_RTPCAPABILITIES="update_remote_rtpCapabilities",t.AB_TEST="ab_test",t}({}),Nr=function(t){return t.SESSION="io.agora.pb.Wrtc.Session",t.JOIN_CHOOSE_SERVER="io.agora.pb.Wrtc.JoinChooseServer",t.REQ_USER_ACCOUNT="io.agora.pb.Wrtc.ReqUserAccount",t.JOIN_GATEWAY="io.agora.pb.Wrtc.JoinGateway",t.RE_JOIN_GATEWAY="io.agora.pb.Wrtc.ReJoinGateway",t.PUBLISH="io.agora.pb.Wrtc.Publish",t.SUBSCRIBE="io.agora.pb.Wrtc.Subscribe",t.WS_COMPRESSOR_INIT="io.agora.pb.Wrtc.WsCompressorInit",t.STREAM_SWITCH="io.agora.pb.Wrtc.StreamSwitch",t.AUDIO_SENDING_STOPPED="io.agora.pb.Wrtc.AudioSendingStopped",t.VIDEO_SENDING_STOPPED="io.agora.pb.Wrtc.VideoSendingStopped",t.REQUEST_PROXY_APPCENTER="io.agora.pb.Wrtc.RequestProxyAppCenter",t.REQUEST_PROXY_WORKER_MANAGER="io.agora.pb.Wrtc.RequestProxyWorkerManager",t.API_INVOKE="io.agora.pb.Wrtc.ApiInvoke",t.FIRST_VIDEO_RECEIVED="io.agora.pb.Wrtc.FirstVideoReceived",t.FIRST_AUDIO_RECEIVED="io.agora.pb.Wrtc.FirstAudioReceived",t.FIRST_VIDEO_DECODE="io.agora.pb.Wrtc.FirstVideoDecode",t.FIRST_AUDIO_DECODE="io.agora.pb.Wrtc.FirstAudioDecode",t.ON_ADD_AUDIO_STREAM="io.agora.pb.Wrtc.OnAddAudioStream",t.ON_ADD_VIDEO_STREAM="io.agora.pb.Wrtc.OnAddVideoStream",t.ON_UPDATE_STREAM="io.agora.pb.Wrtc.OnUpdateStream",t.ON_REMOVE_STREAM="io.agora.pb.Wrtc.OnRemoveStream",t.JOIN_CHANNEL_TIMEOUT="io.agora.pb.Wrtc.JoinChannelTimeout",t.PEER_PUBLISH_STATUS="io.agora.pb.Wrtc.PeerPublishStatus",t.WORKER_EVENT="io.agora.pb.Wrtc.WorkerEvent",t.AP_WORKER_EVENT="io.agora.pb.Wrtc.APWorkerEvent",t.JOIN_WEB_PROXY_AP="io.agora.pb.Wrtc.JoinWebProxyAP",t.WEBSOCKET_QUIT="io.agora.pb.Wrtc.WebSocketQuit",t.USER_ANALYTICS="io.agora.pb.Wrtc.UserAnalytics",t.AUTOPLAY_FAILED="io.agora.pb.Wrtc.AutoplayFailed",t.PC_STATS="io.agora.pb.Wrtc.PCStats",t.UPDATE_REMOTE_RTPCAPABILITIES="io.agora.pb.Wrtc.UpdateRemoteRTPCapabilities",t.AB_TEST="io.agora.pb.Wrtc.ABTest",t}({});(function(t){t[t.WORKER_EVENT=156]="WORKER_EVENT",t[t.AP_WORKER_EVENT=160]="AP_WORKER_EVENT"})({});let fme=function(t){return t[t.SESSION=26]="SESSION",t[t.JOIN_CHOOSE_SERVER=27]="JOIN_CHOOSE_SERVER",t[t.REQ_USER_ACCOUNT=196]="REQ_USER_ACCOUNT",t[t.JOIN_GATEWAY=28]="JOIN_GATEWAY",t[t.PUBLISH=30]="PUBLISH",t[t.SUBSCRIBE=29]="SUBSCRIBE",t[t.WS_COMPRESSOR_INIT=9430]="WS_COMPRESSOR_INIT",t[t.STREAM_SWITCH=32]="STREAM_SWITCH",t[t.AUDIO_SENDING_STOPPED=33]="AUDIO_SENDING_STOPPED",t[t.VIDEO_SENDING_STOPPED=34]="VIDEO_SENDING_STOPPED",t[t.REQUEST_PROXY_APPCENTER=35]="REQUEST_PROXY_APPCENTER",t[t.REQUEST_PROXY_WORKER_MANAGER=36]="REQUEST_PROXY_WORKER_MANAGER",t[t.API_INVOKE=41]="API_INVOKE",t[t.FIRST_VIDEO_RECEIVED=348]="FIRST_VIDEO_RECEIVED",t[t.FIRST_AUDIO_RECEIVED=349]="FIRST_AUDIO_RECEIVED",t[t.FIRST_VIDEO_DECODE=350]="FIRST_VIDEO_DECODE",t[t.FIRST_AUDIO_DECODE=351]="FIRST_AUDIO_DECODE",t[t.ON_ADD_AUDIO_STREAM=352]="ON_ADD_AUDIO_STREAM",t[t.ON_ADD_VIDEO_STREAM=353]="ON_ADD_VIDEO_STREAM",t[t.ON_UPDATE_STREAM=356]="ON_UPDATE_STREAM",t[t.ON_REMOVE_STREAM=355]="ON_REMOVE_STREAM",t[t.JOIN_CHANNEL_TIMEOUT=407]="JOIN_CHANNEL_TIMEOUT",t[t.PEER_PUBLISH_STATUS=408]="PEER_PUBLISH_STATUS",t[t.WORKER_EVENT=156]="WORKER_EVENT",t[t.AP_WORKER_EVENT=160]="AP_WORKER_EVENT",t[t.JOIN_WEB_PROXY_AP=700]="JOIN_WEB_PROXY_AP",t[t.WEBSOCKET_QUIT=671]="WEBSOCKET_QUIT",t[t.USER_ANALYTICS=1e4]="USER_ANALYTICS",t[t.AUTOPLAY_FAILED=9178]="AUTOPLAY_FAILED",t}({});function Ft(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return function(r,s,a){const c=a.value;if(typeof c=="function"){const u=t.className||r.__className__||(r.constructor.name==="AgoraRTCClient"?"Client":r.constructor.name);a.value=function(){for(var h,m=arguments.length,y=new Array(m),v=0;v<m;v++)y[v]=arguments[v];let S=y;if(t.argsMap)try{S=t.argsMap(this,...y)}catch(P){x.warning(P),S=[]}try{JSON.stringify(S)}catch{x.warning("arguments for method ".concat(u,".").concat(String(s)," not serializable for apiInvoke.")),S=[]}const R=(t.report||It).reportApiInvoke(this._sessionId||null,{id:this._clientId||((h=this.store)===null||h===void 0?void 0:h.clientId)||this._ID,name:"".concat(u,".").concat(String(s)),options:S,tag:zr.TRACER,reportResult:t.reportResult},t.throttleTime);try{const P=c.apply(this,y);return P instanceof dt?P.then(N=>(R.onSuccess(t.reportResult&&N),N)).catch(N=>{throw R.onError(N),N}):(R.onSuccess(t.reportResult&&P),P)}catch(P){throw R.onError(P),P}}}return a}}const It=new class{constructor(){Hr(this,"baseInfoMap",new Map),Hr(this,"proxyServer",void 0),Hr(this,"eventUploadTimer",void 0),Hr(this,"setSessionIdTimer",void 0),Hr(this,"url",void 0),Hr(this,"sids",new Set),Hr(this,"backupUrl",void 0),Hr(this,"_appId",void 0),Hr(this,"_aid",0),Hr(this,"keyEventUploadPendingItems",[]),Hr(this,"normalEventUploadPendingItems",[]),Hr(this,"apiInvokeUploadPendingItems",[]),Hr(this,"apiInvokeCount",0),Hr(this,"apiInvokeLoggedCount",0),Hr(this,"ltsList",[]),Hr(this,"lastSendNormalEventTime",Date.now()),Hr(this,"customReportCounterTimer",void 0),Hr(this,"customReportCount",0),Hr(this,"extApiInvoke",async t=>{for(const r of t){const s=ln(ln({},r),{},{sid:null,invokeId:++this.apiInvokeCount,tag:zr.TRACER});this.sendApiInvoke(s)}}),this.eventUploadTimer=window.setInterval(this.doSend.bind(this),oe("EVENT_REPORT_SEND_INTERVAL")),this.setSessionIdTimer=window.setInterval(this.appendSessionId.bind(this),oe("EVENT_REPORT_SEND_INTERVAL"))}getBaseInfoBySessionId(t){return this.baseInfoMap.get(t)}setAppId(t){this._appId=t,this._aid=parseInt(t.replace(/[a-fA-F0-9]{8}/g,r=>{let[s,a]=r;return s+a}),16)||0}reportApiInvoke(t,r,s){r.timeout=r.timeout||6e4,r.reportResult=r.reportResult===void 0||r.reportResult;const a=Date.now();this.apiInvokeCount+=1;const c=this.apiInvokeCount,u=!!oe("SHOW_REPORT_INVOKER_LOG"),h=!!oe("SHOW_REPORT_USER_INVOKER_LOG"),m=u||h&&r.id;m&&(this.apiInvokeLoggedCount+=1);const y=this.apiInvokeLoggedCount;function v(N,G){if(m){let F="[apiInvoke-".concat(y,"]");r.id&&(F+="[".concat(r.id,"]")),r.name&&(F+="[".concat(r.name,"]")),x.info("".concat(F," ").concat(N),N==="start"?r.options:G||"")}}const S=()=>({tag:r.tag,invokeId:c,sid:t,name:r.name,apiInvokeTime:a,options:r.options,states:r.states||null});v("start");let R=!1;ps(r.timeout).then(()=>{R||(this.sendApiInvoke(ln(ln({},S()),{},{error:te.API_INVOKE_TIMEOUT,success:!1})),v("timeout"))});const P=new Le(te.UNEXPECTED_ERROR,"".concat(r.name,": this api invoke is end"));return{onSuccess:N=>{const G=()=>{if(R)throw P;return R=!0,this.sendApiInvoke(ln(ln({},S()),{},{success:!0},r.reportResult&&{result:N})),v("onSuccess"),N};return s?W8(G,r.name+"Success",s,()=>R=!0):G()},onError:N=>{const G=()=>{if(R)throw N;R=!0,this.sendApiInvoke(ln(ln({},S()),{},{success:!1,error:N})),v("onFailure",N.toString())};return s?W8(G,r.name+"Error",s,()=>R=!0):G()}}}sessionInit(t,r){if(this.baseInfoMap.has(t))return;const s=Date.now(),a=this.createBaseInfo(t,s);a.cname=r.cname;const c=Object.assign({},{willUploadConsoleLog:oe("UPLOAD_LOG"),maxTouchPoints:navigator.maxTouchPoints,areaVersion:AL?"global":"oversea",areas:oe("AREAS")&&oe("AREAS").join(",")},r.extend),{stringUid:u,channelProfile:h,channelMode:m,isABTestSuccess:y,lsid:v,clientRole:S}=r,R=Date.now(),P=ln(ln({},a),{},{eventType:Xi.SESSION_INIT,appid:r.appid,browser:navigator.userAgent,buildFormat:r.buildFormat,build:OL,lts:R,elapse:R-s,extend:JSON.stringify(c),mode:r.mode,process:oe("PROCESS_ID"),appType:oe("APP_TYPE"),success:!0,version:wl,stringUid:u,channelProfile:h,channelMode:m,isABTestSuccess:y,lsid:v,clientType:ot(N=window.navigator.userAgent).call(N,"AgoraWebView")?42:20,clientRole:S,serviceId:oe("PROCESS_ID"),extensionID:oe("PLUGIN_INFO").join(",")||""});var N;this.send({type:Nr.SESSION,data:P},!0)}joinChooseServer(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const a=s.info,c=Date.now(),u=ln(ln({},a),{},{role:r.role,eventType:Xi.JOIN_CHOOSE_SERVER,lts:c,eventElapse:r.elapse||c-r.lts,chooseServerAddr:r.csAddr,errorCode:r.ec,elapse:c-s.startTime,success:r.succ,chooseServerAddrList:JSON.stringify(r.serverList),uid:r.uid?parseInt(r.uid):null,cid:r.cid?parseInt(r.cid):null,chooseServerIp:r.csIp||"",opid:r.opid,unilbsServerIds:r.unilbsServerIds,extend:r.extend||void 0,isHttp3:r.isHttp3,corssRegionTagReq:r.corssRegionTagReq||void 0,corssRegionTagRes:r.corssRegionTagRes||void 0});this.send({type:Nr.JOIN_CHOOSE_SERVER,data:u},!0)}reqUserAccount(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const a=s.info,c=Date.now(),u=ln(ln({},a),{},{eventType:Xi.REQ_USER_ACCOUNT,lts:c,success:r.success,serverAddress:r.serverAddr,stringUid:r.stringUid,uid:r.uid,errorCode:r.errorCode,elapse:r.elapse||c-s.startTime,eventElapse:c-r.lts,extend:JSON.stringify(r.extend)});this.send({type:Nr.REQ_USER_ACCOUNT,data:u},!0)}joinGateway(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const a=s.info;r.vid&&(a.vid=r.vid),a.uid=r.uid,a.cid=r.cid;const c=Date.now(),{firstSuccess:u,avoidJoinStartTime:h,addr:m,isProxy:y}=r,v=c-(u&&h?h:s.startTime),S=ln(ln({},a),{},{eventType:Xi.JOIN_GATEWAY,lts:c,gatewayAddr:r.addr,success:r.succ,errorCode:r.ec,errorMsg:r.errorMsg||"",elapse:v,eventElapse:c-r.lts,firstSuccess:u,signalChannel:r.signalChannel,preload:r.preload?1:0,installId:IL(),isABTestSuccess:r.isABTestSuccess?1:0}),R=S.success?1:0;if(r.succ&&(s.lastJoinSuccessTime=c),u)this.send({type:Nr.JOIN_GATEWAY,data:S},!0);else{let P;if(m)if(y){const G=m.match(/h=(\d{1,3}-){3}\d{1,3}/g),F=m.match(/p=[0-9]{1,6}/g);P={isSuccess:R,gatewayIp:G&&G.length?G[0].split("=")[1].replace(/-/g,"."):"",port:F&&F.length?F[0].split("=")[1]:"",isProxy:y?1:0}}else{const G=m.match(/wss:\/\/(\d{1,3}-){3}\d{1,3}/g),F=m.match(/(:|p=)[0-9]{1,6}/g);P={isSuccess:R,gatewayIp:G&&G.length?G[0].split("//")[1].replace(/-/g,"."):"",port:F&&F.length?F[0].split(/:|p=/g)[1]:"",isProxy:y?1:0}}else P={isSuccess:R,gatewayIp:"",port:"",isProxy:y?1:0};delete S.success,delete S.eventType,delete S.firstSuccess,S.vid=Number(S.vid);const N=Object.assign({},S,P,{eventType:Xi.REJOIN_GATEWAY});this.send({type:Nr.RE_JOIN_GATEWAY,data:N},!0)}}joinChannelTimeout(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const a=Date.now(),c=ln(ln({},s.info),{},{lts:a,timeout:r,elapse:a-s.startTime});this.send({type:Nr.JOIN_CHANNEL_TIMEOUT,data:c},!0)}publish(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const a=s.info,c=Date.now(),u=ln(ln({},a),{},{eventType:Xi.PUBLISH,lts:c,eventElapse:r.eventElapse,elapse:c-s.startTime,success:r.succ,errorCode:r.ec,videoName:r.videoName,audioName:r.audioName,screenName:r.screenName,screenshare:r.screenshare,audio:r.audio,video:r.video,p2pid:r.p2pid,publishRequestid:r.publishRequestid});this.send({type:Nr.PUBLISH,data:u},!0)}subscribe(t,r,s){const a=this.baseInfoMap.get(t);if(!a)return;const c=a.info,u=Date.now(),h=ln(ln({},c),{},{eventType:Xi.SUBSCRIBE,lts:u,eventElapse:r.eventElapse,elapse:u-a.startTime,success:r.succ,errorCode:r.ec,video:r.video,audio:r.audio,subscribeRequestid:r.subscribeRequestid,p2pid:r.p2pid,preSsrc:r.preSsrc?1:0},s&&{extend:JSON.stringify({isMassSubscribe:!0})});typeof r.peerid=="string"?h.peerSuid=r.peerid:h.peer=r.peerid,this.send({type:Nr.SUBSCRIBE,data:h},!0)}wsCompressorInit(t){var r;const s=[...Kc(r=this.baseInfoMap).call(r)],a=s.length?s[0]:"UnableToGetSid",c=this.baseInfoMap.get(a);if(!c)return;const u=c.info,h=Date.now(),m=ln(ln({},u),{},{eventType:Xi.WS_COMPRESSOR_INIT,lts:h,eventElapse:t.eventElapse,elapse:h-c.startTime,status:t.status?1:2});this.send({type:Nr.WS_COMPRESSOR_INIT,data:m},!0)}firstRemoteVideoDecode(t,r,s,a){const c=this.baseInfoMap.get(t);if(!c)return;const u=c.info,h=Date.now(),m=ln(ln(ln({},u),a),{},{elapse:h-c.startTime,eventType:r,lts:h,firstDecodeFrame:Math.max((a.firstFrame||h)-c.startTime,0),apEnd:Math.max(a.apEnd-c.startTime,0),apStart:Math.max(a.apStart-c.startTime,0),joinGwEnd:Math.max(a.joinGwEnd-c.startTime,0),joinGwStart:Math.max(a.joinGwStart-c.startTime,0),pcEnd:Math.max(a.pcEnd-c.startTime,0),pcStart:Math.max(a.pcStart-c.startTime,0),subscriberEnd:Math.max(a.subscriberEnd-c.startTime,0),subscriberStart:Math.max(a.subscriberStart-c.startTime,0),videoAddNotify:Math.max(a.videoAddNotify-c.startTime,0)});this.send({type:s,data:m},!0)}firstRemoteFrame(t,r,s,a){const c=this.baseInfoMap.get(t);if(!c)return;const u=c.info,h=Date.now(),m=ln(ln(ln({},u),a),{},{elapse:h-c.startTime,eventType:r,lts:h});this.send({type:s,data:m},!0)}abTest(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const a=s.info,c=Date.now(),u=ln(ln(ln({},a),r),{},{vid:a.vid===void 0?0:Number(a.vid),elapse:c-s.startTime,eventType:Xi.AB_TEST,lts:c});this.send({type:Nr.AB_TEST,data:u},!0)}pcStats(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const a=s.info,c=Date.now(),u=ln(ln(ln({},a),r),{},{vid:a.vid===void 0?0:Number(a.vid),elapse:c-s.startTime,eventType:Xi.PC_STATS,lts:c,preallocation:r.preallocation?1:0});this.send({type:Nr.PC_STATS,data:u},!0)}updateRemoteRTPCapabilities(t,r){if(t){const s=this.baseInfoMap.get(t);if(!s)return;const a=s.info,c=Date.now(),u=ln(ln(ln({},a),r),{},{vid:a.vid===void 0?0:Number(a.vid),eventType:Xi.UPDATE_REMOTE_RTPCAPABILITIES,lts:c});this.send({type:Nr.UPDATE_REMOTE_RTPCAPABILITIES,data:u},!0)}}onGatewayStream(t,r,s,a){const c=this.baseInfoMap.get(t);if(!c)return;const u=c.info,h=Date.now(),m=ln(ln(ln({},u),a),{},{eventType:r,lts:h});this.send({type:s,data:m},!0)}streamSwitch(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const a=s.info,c=Date.now(),u=ln(ln({},a),{},{eventType:Xi.STREAM_SWITCH,lts:c,isDual:r.isdual,elapse:c-s.startTime,success:r.succ});this.send({type:Nr.STREAM_SWITCH,data:u},!0)}requestProxyAppCenter(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const a=s.info,c=Date.now(),u=ln(ln({},a),{},{eventType:Xi.REQUEST_PROXY_APPCENTER,lts:c,eventElapse:c-r.lts,elapse:c-s.startTime,APAddr:r.APAddr,workerManagerList:r.workerManagerList,response:r.response,errorCode:r.ec,success:r.succ});this.send({type:Nr.REQUEST_PROXY_APPCENTER,data:u},!0)}requestProxyWorkerManager(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const a=s.info,c=Date.now(),u=ln(ln({},a),{},{eventType:Xi.REQUEST_PROXY_WORKER_MANAGER,lts:c,eventElapse:c-r.lts,elapse:c-s.startTime,workerManagerAddr:r.workerManagerAddr,response:r.response,errorCode:r.ec,success:r.succ});this.send({type:Nr.REQUEST_PROXY_WORKER_MANAGER,data:u},!0)}setProxyServer(t){this.proxyServer=t,t?x.debug("reportProxyServerurl: ".concat(t)):x.debug("disable reportProxyServerurl: ".concat(t))}peerPublishStatus(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const a=s.info,c=Date.now(),u=ln(ln({},a),{},{subscribeElapse:r.subscribeElapse,peer:r.peer,peerPublishDuration:Math.max(r.audioPublishDuration,r.videoPublishDuration),audiotag:r.audioPublishDuration>0?1:-1,videotag:r.videoPublishDuration>0?1:-1,lts:c,elapse:c-s.startTime,joinChannelSuccessElapse:c-(s.lastJoinSuccessTime||c),peerPublishDurationVideo:r.videoPublishDuration,peerPublishDurationAudio:r.audioPublishDuration});this.send({type:Nr.PEER_PUBLISH_STATUS,data:u},!0)}workerEvent(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const a=s.info,c=Date.now();(function(u,h,m){const y=u[h];if(!y||typeof y!="string")return[u];u[h]="";const v=vh(JSON.stringify(u));let S=0;const R=[];let P=0;for(let N=0;N<y.length;N++)P+=y.charCodeAt(N)<=127?1:3,P<=m-v||(R[R.length]=gt(gt({},u),{},{[h]:y.substring(S,N)}),S=N,P=y.charCodeAt(N)<=127?1:3);return S!==y.length-1&&(R[R.length]=gt(gt({},u),{},{[h]:y.substring(S)})),R})(ln(ln(ln({},a),r),{},{elapse:c-s.startTime,lts:c,productType:"WebRTC"}),"payload",1300).forEach(u=>this.send({type:Nr.WORKER_EVENT,data:u},!0))}apworkerEvent(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const a=s.info,c=Date.now(),u=ln(ln(ln({},a),r),{},{elapse:c-s.startTime,lts:c});this.send({type:Nr.AP_WORKER_EVENT,data:u},!0)}joinWebProxyAP(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const a=s.info,c=Date.now(),u=ln(ln(ln({},a),r),{},{elapse:c-s.startTime,lts:c,extend:r.extend||void 0});this.send({type:Nr.JOIN_WEB_PROXY_AP,data:u},!0)}WebSocketQuit(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const a=s.info,c=Date.now(),u=ln(ln(ln({},a),r),{},{elapse:c-s.startTime,lts:c});this.send({type:Nr.WEBSOCKET_QUIT,data:u},!0)}async sendCustomReportMessage(t,r){if(this.customReportCount+=r.length,this.customReportCount>oe("CUSTOM_REPORT_LIMIT"))throw new Le(te.CUSTOM_REPORT_FREQUENCY_TOO_HIGH);this.customReportCounterTimer||(this.customReportCounterTimer=window.setInterval(()=>{this.customReportCount=0},5e3));const s=Date.now(),a=r.map(c=>({type:Nr.USER_ANALYTICS,data:ln(ln({sid:t},c),{},{lts:s})}));try{oe("NEW_REPORT_SERVER")?await this.postDataToStatsCollector2(a):await this.postDataToStatsCollector(a)}catch(c){throw x.error("send custom report message failed",c.toString()),new Le(te.CUSTOM_REPORT_SEND_FAILED,c.message)}}sendApiInvoke(t){const r=oe("NOT_REPORT_EVENT");if(t.tag&&ot(r)&&ot(r).call(r,t.tag))return!1;if(t.sid===null)return this.apiInvokeUploadPendingItems.push(t),!1;const s=this.baseInfoMap.get(t.sid);if(!s)return this.apiInvokeUploadPendingItems.push(t),!1;const{cname:a,uid:c,cid:u}=s.info;let h;if(t.lts=t.lts||Date.now(),t.error)if(t.error instanceof Le){const{code:y,message:v}=t.error;h=y||v||t.error.toString()}else h=t.error.toString();const m={invokeId:t.invokeId,sid:t.sid,cname:a,cid:u,uid:c,lts:t.lts,success:t.success,elapse:t.lts-s.startTime,execElapse:t.lts-t.apiInvokeTime,apiName:t.name,options:t.options?JSON.stringify(t.options):void 0,execStates:t.states?JSON.stringify(t.states):void 0,execResult:t.result?JSON.stringify(t.result):void 0,errorCode:t.error?h:void 0,errorMsg:t.error?JSON.stringify(t.error):void 0};return this.send({type:Nr.API_INVOKE,data:m},!1),!0}addSid(t){this.sids.add(t)}removeSid(t){this.sids.delete(t)}appendSessionId(){const t=this.apiInvokeUploadPendingItems;if(t.length===0)return;const r=Array.from(this.sids).find(s=>s!==null);r&&t.forEach(s=>{s&&(s.sid=r,this.sendApiInvoke(Object.assign({},s)))}),t.length=0}send(t,r){if(r)return this.keyEventUploadPendingItems.push(t),void this.sendItems(this.keyEventUploadPendingItems,!0);this.normalEventUploadPendingItems.push(t),this.normalEventUploadPendingItems.length>oe("NORMAL_EVENT_QUEUE_CAPACITY")&&this.normalEventUploadPendingItems.splice(0,1),this.normalEventUploadPendingItems.length>=10&&this.sendItems(this.normalEventUploadPendingItems,!1)}doSend(){this.keyEventUploadPendingItems.length>0&&this.sendItems(this.keyEventUploadPendingItems,!0),this.normalEventUploadPendingItems.length>0&&Date.now()-this.lastSendNormalEventTime>=5e3&&this.sendItems(this.normalEventUploadPendingItems,!1)}sendItems(t,r){const s=[],a=[];for(;t.length;){const u=t.shift();s.length<20?s.push(u):a.push(u)}t.push(...a);for(const u of[...s]){var c;this.ltsList.indexOf(u.data.lts)!==-1?(u.data.lts=this.ltsList[this.ltsList.length-1]+1,this.ltsList.push(u.data.lts)):(this.ltsList.push(u.data.lts),uT(c=this.ltsList).call(c,(h,m)=>h-m))}return r||(this.lastSendNormalEventTime=Date.now()),oe("ENABLE_EVENT_REPORT")&&s.length&&(oe("NEW_REPORT_SERVER")?this.postDataToStatsCollector2(s):this.postDataToStatsCollector(s)).catch((u=>h=>{oe("EVENT_REPORT_RETRY")&&(r?this.keyEventUploadPendingItems=this.keyEventUploadPendingItems.concat(u):(this.normalEventUploadPendingItems=this.normalEventUploadPendingItems.concat(u),this.normalEventUploadPendingItems.length>oe("NORMAL_EVENT_QUEUE_CAPACITY")&&(this.normalEventUploadPendingItems.splice(0,this.normalEventUploadPendingItems.length-oe("NORMAL_EVENT_QUEUE_CAPACITY")),x.warning("report: drop normal events"))))})(s)),t}async postDataToStatsCollector2(t){yi.networkState===gc.OFFLINE&&await dt.race([yi.onlineWaiter,ps(2*Pi.maxRetryTimeout)]);const r=c=>{let u=new Uint8Array;return c.forEach(h=>{const m=mL(JSON.stringify(h.data)),y=new ArrayBuffer(5),v=(R=>{let P=0;return Object.entries(Nr).forEach(N=>{let[G,F]=N;F===R.type&&(P=fme[G])}),P})(h),S=new DataView(y);S.setUint16(0,m.byteLength,!0),S.setUint8(2,255&v),S.setUint8(3,v>>>8&255),S.setUint8(4,v>>>16&255),u=D8(u,new Uint8Array(y)),u=D8(u,m)}),u},s="event";let a=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(oe("NEW_REPORT_SERVER_DOMAINS")[0],"&p=443&d=").concat(s):"https://".concat(oe("NEW_REPORT_SERVER_DOMAINS")[0],"/").concat(s);for(let c=0;c<2;c+=1){c===1&&(a=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(oe("NEW_REPORT_SERVER_DOMAINS")[1],"&p=443&d=").concat(s):"https://".concat(oe("NEW_REPORT_SERVER_DOMAINS")[1],"/").concat(s));try{await bL(a,{timeout:1e4,data:r(t),headers:ln(ln({biz:"webrtc",sendts:Math.round(Date.now()/1e3),debug:"false"},this._appId&&{appid:this._appId}),{},{"Content-Type":"application/octet-stream"})},!0)}catch(u){if(c===1)throw u;continue}return}}async postDataToStatsCollector(t){let r=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const s=(m=>{const y=m&&m.data.sid&&this.baseInfoMap.get(m.data.sid);return y&&y.info.vid&&+y.info.vid||0})(t[0]),a=s?void 0:this._aid,c={msgType:"EventMessages",sentTs:Math.round(Date.now()/1e3),payloads:t.map(m=>JSON.stringify(m)),vid:s,aid:a};yi.networkState===gc.OFFLINE&&await dt.race([yi.onlineWaiter,ps(2*Pi.maxRetryTimeout)]);const u=r?"/events/proto-raws":"/events/messages";let h=this.url||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(oe("EVENT_REPORT_DOMAIN"),"&p=").concat(oe("STATS_COLLECTOR_PORT"),"&d=").concat(u):"https://".concat(oe("EVENT_REPORT_DOMAIN"),":").concat(oe("STATS_COLLECTOR_PORT")).concat(u));for(let m=0;m<2;m+=1){m===1&&(h=this.backupUrl||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(oe("EVENT_REPORT_BACKUP_DOMAIN"),"&p=").concat(oe("STATS_COLLECTOR_PORT"),"&d=").concat(u):"https://".concat(oe("EVENT_REPORT_BACKUP_DOMAIN"),":").concat(oe("STATS_COLLECTOR_PORT")).concat(u)));try{r?await Qpe(h,{timeout:1e4,data:c}):await bL(h,{timeout:1e4,data:c})}catch(y){if(m===1)throw y;continue}return}}createBaseInfo(t,r){const s=Object.assign({},hme);return s.sid=t,this.baseInfoMap.set(t,{info:s,startTime:r}),s}reportResourceTiming(t,r){const s=performance.getEntriesByName(t),a=s[s.length-1];a&&this.reportApiInvoke(r,{name:"Client.resourceTiming",options:a,tag:zr.TRACER}).onSuccess()}};az.on("REPORT_LOG_UPLOAD",t=>{t.networkState=yi.networkState,It.reportApiInvoke(null,{name:"logUploadError",options:t,tag:zr.TRACER}).onSuccess("logUploadError")});class Oe extends Le{constructor(r){super(r,arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",arguments.length>2?arguments[2]:void 0),Hr(this,"name","AgoraRTCException")}print(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error";return super.print(r,x)}throw(){super.throw(x)}}const ms={getDisplayMedia:!1,getStreamFromExtension:!1,supportUnifiedPlan:!1,supportMinBitrate:!1,supportSetRtpSenderParameters:!1,supportDualStream:!0,webAudioMediaStreamDest:!1,supportReplaceTrack:!1,supportWebGL:!1,webAudioWithAEC:!1,supportRequestFrame:!1,supportShareAudio:!1,supportDualStreamEncoding:!1,supportDataChannel:!1,supportPCSetConfiguration:!1,supportWebRTCEncodedTransform:!1,supportWebRTCInsertableStream:!1,supportRequestVideoFrameCallback:!1,supportWebCrypto:!1};function Vn(){return ms}function uz(){return"setSinkId"in HTMLAudioElement.prototype&&(!oe("RESTRICTION_SET_PLAYBACK_DEVICE")||(tp()||S8())&&!hL())}function dz(){return!ms.supportUnifiedPlan||oe("CHROME_FORCE_PLAN_B")&&np()}let gs=function(t){return t.IOS_15_16_INTERRUPTION_START="ios15_16-interruption-start",t.IOS_15_16_INTERRUPTION_END="ios15_16-interruption-end",t.IOS_INTERRUPTION_START="ios-interruption-start",t.IOS_INTERRUPTION_END="ios-interruption-end",t.STATE_CHANGE="state-change",t}({});function zv(t,r,s){return{sampleRate:t,stereo:r,bitrate:s}}function Dn(t,r,s,a,c){return{width:t,height:r,frameRate:s,bitrateMin:a,bitrateMax:c}}function yu(t,r,s,a,c){return{width:{max:t},height:{max:r},frameRate:s,bitrateMin:a,bitrateMax:c}}function xL(t,r){return{numSpatialLayers:t,numTemporalLayers:r}}const pme={"90p":Dn(160,90),"90p_1":Dn(160,90),"120p":Dn(160,120,15,30,65),"120p_1":Dn(160,120,15,30,65),"120p_3":Dn(120,120,15,30,50),"120p_4":Dn(212,120),"180p":Dn(320,180,15,30,140),"180p_1":Dn(320,180,15,30,140),"180p_3":Dn(180,180,15,30,100),"180p_4":Dn(240,180,15,30,120),"240p":Dn(320,240,15,40,200),"240p_1":Dn(320,240,15,40,200),"240p_3":Dn(240,240,15,40,140),"240p_4":Dn(424,240,15,40,220),"360p":Dn(640,360,15,80,400),"360p_1":Dn(640,360,15,80,400),"360p_3":Dn(360,360,15,80,260),"360p_4":Dn(640,360,30,80,600),"360p_6":Dn(360,360,30,80,400),"360p_7":Dn(480,360,15,80,320),"360p_8":Dn(480,360,30,80,490),"360p_9":Dn(640,360,15,80,800),"360p_10":Dn(640,360,24,80,800),"360p_11":Dn(640,360,24,80,1e3),"480p":Dn(640,480,15,100,500),"480p_1":Dn(640,480,15,100,500),"480p_2":Dn(640,480,30,100,1e3),"480p_3":Dn(480,480,15,100,400),"480p_4":Dn(640,480,30,100,750),"480p_6":Dn(480,480,30,100,600),"480p_8":Dn(848,480,15,100,610),"480p_9":Dn(848,480,30,100,930),"480p_10":Dn(640,480,10,100,400),"720p":Dn(1280,720,15,120,1130),"720p_auto":Dn(1280,720,30,900,3e3),"720p_1":Dn(1280,720,15,120,1130),"720p_2":Dn(1280,720,30,120,2e3),"720p_3":Dn(1280,720,30,120,1710),"720p_5":Dn(960,720,15,120,910),"720p_6":Dn(960,720,30,120,1380),"1080p":Dn(1920,1080,15,120,2080),"1080p_1":Dn(1920,1080,15,120,2080),"1080p_2":Dn(1920,1080,30,120,3e3),"1080p_3":Dn(1920,1080,30,120,3150),"1080p_5":Dn(1920,1080,60,120,4780),"1440p":Dn(2560,1440,30,120,4850),"1440p_1":Dn(2560,1440,30,120,4850),"1440p_2":Dn(2560,1440,60,120,7350),"4k":Dn(3840,2160,30,120,8910),"4k_1":Dn(3840,2160,30,120,8910),"4k_3":Dn(3840,2160,60,120,13500)},mme={"480p":yu(640,480,5),"480p_1":yu(640,480,5),"480p_2":yu(640,480,30),"480p_3":yu(640,480,15),"720p":yu(1280,720,5),"720p_auto":Dn(1280,720,30,900,3e3),"720p_1":yu(1280,720,5),"720p_2":yu(1280,720,30),"720p_3":yu(1280,720,15),"1080p":yu(1920,1080,5),"1080p_1":yu(1920,1080,5),"1080p_2":yu(1920,1080,30),"1080p_3":yu(1920,1080,15)},gme={"1SL1TL":xL(1,1),"3SL3TL":xL(3,3),"2SL3TL":xL(2,3)};function bh(t){return t||(t="480p_1"),typeof t=="string"?Object.assign({},pme[t]):t}function LL(t){return typeof t=="string"?Object.assign({},mme[t]):t}function rP(t){return typeof t=="string"?Object.assign({},gme[t]):t}const _me={speech_low_quality:zv(16e3,!1),speech_standard:zv(32e3,!1,18),music_standard:zv(48e3,!1),standard_stereo:zv(48e3,!0,56),high_quality:zv(48e3,!1,128),high_quality_stereo:zv(48e3,!0,192)};function iP(t){return typeof t=="string"?Object.assign({},_me[t]):t}const Gv=[];function hz(t){return Bi(t,"mediaSource",["screen","window","application"]),!0}let St=function(t){return t.NEED_RENEGOTIATE="@need_renegotiate",t.NEED_REPLACE_TRACK="@need_replace_track",t.NEED_REPLACE_MIXING_TRACK="@need_replace_mixing_track",t.NEED_CLOSE="@need_close",t.NEED_ENABLE_TRACK="@need_enable_track",t.NEED_DISABLE_TRACK="@need_disable_track",t.NEED_SESSION_ID="@need_sid",t.SET_OPTIMIZATION_MODE="@set_optimization_mode",t.GET_STATS="@get_stats",t.GET_RTC_STATS="@get_rtc_stats",t.GET_LOW_VIDEO_TRACK="@get_low_video_track",t.NEED_RESET_REMOTE_SDP="@need_reset_remote_sdp",t.NEED_UPDATE_VIDEO_ENCODER="@need_update_video_encoder",t.NEED_UPDATE_VIDEO_SEND_PARAMETERS="@need_update_video_send_parameters",t.NEED_MUTE_TRACK="@need_mute_track",t.NEED_UNMUTE_TRACK="@need_unmute_track",t}({}),hr=function(t){return t.SCREEN_TRACK="screen_track",t.CUSTOM_TRACK="custome_track",t.LOW_STREAM="low_stream",t.SCREEN_LOW_TRACK="screen_low_track",t}({}),Hv=function(t){return t[t.HIGH_STREAM=0]="HIGH_STREAM",t[t.LOW_STREAM=1]="LOW_STREAM",t}({}),yme=function(t){return t[t.HIGH_STREAM=0]="HIGH_STREAM",t[t.LOW_STREAM=1]="LOW_STREAM",t[t.HIGH_STREAM_LAYER1=4]="HIGH_STREAM_LAYER1",t[t.HIGH_STREAM_LAYER2=5]="HIGH_STREAM_LAYER2",t[t.HIGH_STREAM_LAYER3=6]="HIGH_STREAM_LAYER3",t[t.HIGH_STREAM_LAYER4=7]="HIGH_STREAM_LAYER4",t[t.HIGH_STREAM_LAYER5=8]="HIGH_STREAM_LAYER5",t[t.HIGH_STREAM_LAYER6=9]="HIGH_STREAM_LAYER6",t}({}),Eme=function(t){return t[t.DISABLE=0]="DISABLE",t[t.LOW_STREAM=1]="LOW_STREAM",t[t.AUDIO_ONLY=2]="AUDIO_ONLY",t[t.HIGH_STREAM_LAYER1=3]="HIGH_STREAM_LAYER1",t[t.HIGH_STREAM_LAYER2=4]="HIGH_STREAM_LAYER2",t[t.HIGH_STREAM_LAYER3=5]="HIGH_STREAM_LAYER3",t[t.HIGH_STREAM_LAYER4=6]="HIGH_STREAM_LAYER4",t[t.HIGH_STREAM_LAYER5=7]="HIGH_STREAM_LAYER5",t[t.HIGH_STREAM_LAYER6=8]="HIGH_STREAM_LAYER6",t}({}),W_=function(t){return t.TRANSCEIVER_UPDATED="transceiver-updated",t.SEI_TO_SEND="sei-to-send",t.SEI_RECEIVED="sei-received",t.TRACK_UPDATED="track-updated",t}({}),$v=function(t){return t.SOURCE_STATE_CHANGE="source-state-change",t.TRACK_ENDED="track-ended",t.BEAUTY_EFFECT_OVERLOAD="beauty-effect-overload",t.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",t.CLOSED="closed",t}({}),Kv=function(t){return t.FIRST_FRAME_DECODED="first-frame-decoded",t.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",t.VIDEO_STATE_CHANGED="video-state-changed",t}({}),qv=function(t){return t.AUDIO="audio",t.VIDEO="video",t.DATA="data",t}({}),qc=function(t){return t.AUDIO_SOURCE_STATE_CHANGE="audio_source_state_change",t.RECEIVE_TRACK_BUFFER="receive_track_buffer",t.ON_AUDIO_BUFFER="on_audio_buffer",t.UPDATE_SOURCE="update_source",t}({});(function(t){t.UPDATE_TRACK_SOURCE="update-track-source"})({});const ML={sendVolumeLevel:0,sendBitrate:0,sendBytes:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,currentPacketLossRate:0},UL={sendBytes:0,sendBitrate:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,sendResolutionHeight:0,sendResolutionWidth:0,captureResolutionHeight:0,captureResolutionWidth:0,targetSendBitrate:0,totalDuration:0,totalFreezeTime:0,currentPacketLossRate:0},fz={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveLevel:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receivePacketsDiscarded:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1},vme={uplinkNetworkQuality:0,downlinkNetworkQuality:0},pz={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receiveResolutionHeight:0,receiveResolutionWidth:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1};let Mo=function(t){return t.ON_TRACK="on_track",t.ON_NODE="on_node",t}({}),Yc=function(t){return t.REQUEST_UPDATE_CONSTRAINTS="request_update_constraints",t.REQUEST_CONSTRAINTS="request_constraints",t}({}),NT=function(t){return t.IDLE="IDLE",t.INITING="INITING",t.INITEND="INITEND",t}({}),z_=function(t){return t.STATE_CHANGE="state_change",t.RECORDING_DEVICE_CHANGED="recordingDeviceChanged",t.PLAYOUT_DEVICE_CHANGED="playoutDeviceChanged",t.CAMERA_DEVICE_CHANGED="cameraDeviceChanged",t}({}),mo=function(t){return t.NONE="none",t.INIT="init",t.CANPLAY="canplay",t.PLAYING="playing",t.PAUSED="paused",t.SUSPEND="suspend",t.STALLED="stalled",t.WAITING="waiting",t.ERROR="error",t.DESTROYED="destroyed",t.ABORT="abort",t.ENDED="ended",t.EMPTIED="emptied",t.LOADEDDATA="loadeddata",t}({}),Th=function(t){return t[t.VideoStateStopped=0]="VideoStateStopped",t[t.VideoStateStarting=1]="VideoStateStarting",t[t.VideoStateDecoding=2]="VideoStateDecoding",t[t.VideoStateFrozen=3]="VideoStateFrozen",t}({});const VL={uninit:100,none:110,init:120,loadeddata:130,canplay:200,playing:210,paused:220,suspend:300,stalled:310,waiting:320,error:330,destroyed:340,abort:350,ended:360,emptied:370};let sP=function(t){return t.OPEN="open",t.MESSAGE="message",t.CLOSE="close",t.CLOSING="closing",t.ERROR="error",t}({});function mz(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}function Dr(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?mz(Object(s),!0).forEach(function(a){Pe(t,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):mz(Object(s)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))})}return t}function Pe(t,r,s){return(r=function(a){var c=function(u,h){if(typeof u!="object"||u===null)return u;var m=u[Symbol.toPrimitive];if(m!==void 0){var y=m.call(u,"string");if(typeof y!="object")return y;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(u)}(a);return typeof c=="symbol"?c:String(c)}(r))in t?Object.defineProperty(t,r,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[r]=s,t}function xn(t,r,s,a,c){var u,h,m={};return Object.keys(a).forEach(function(y){m[y]=a[y]}),m.enumerable=!!m.enumerable,m.configurable=!!m.configurable,("value"in m||m.initializer)&&(m.writable=!0),m=lc(u=hm(h=s.slice()).call(h)).call(u,function(y,v){return v(t,r,y)||y},m),c&&m.initializer!==void 0&&(m.value=m.initializer?m.initializer.call(c):void 0,m.initializer=void 0),m.initializer===void 0&&(Object.defineProperty(t,r,m),m=null),m}class gz extends Ur{set _mediaStreamTrack(r){r!==this.mediaStreamTrack&&(this.safeEmit(W_.TRACK_UPDATED,r),this.mediaStreamTrack=r)}get _mediaStreamTrack(){return this.mediaStreamTrack}constructor(r,s){super(),Pe(this,"trackMediaType",void 0),Pe(this,"_ID",void 0),Pe(this,"_rtpTransceiver",void 0),Pe(this,"_lowRtpTransceiver",void 0),Pe(this,"_hints",[]),Pe(this,"_isClosed",!1),Pe(this,"_originMediaStreamTrack",void 0),Pe(this,"mediaStreamTrack",void 0),Pe(this,"_external",{}),this._ID=s||dr(8,"track-"),this._originMediaStreamTrack=r,this.mediaStreamTrack=r,function(a){ot(Gv).call(Gv,a)||Gv.push(a)}(this)}toString(){return this._ID}getTrackId(){return this._ID}getMediaStreamTrack(r){return r||Fm(()=>{var s;It.reportApiInvoke(null,{name:Ai.GET_MEDIA_STREAM_TRACK,options:[],tag:zr.TRACER}).onSuccess(((s=this._mediaStreamTrack)===null||s===void 0?void 0:s.label)||"")},this.mediaStreamTrack.id||this.getTrackId()),this._mediaStreamTrack}getRTCRtpTransceiver(r){return r===Hv.LOW_STREAM?this._lowRtpTransceiver:this._rtpTransceiver}getMediaStreamTrackSettings(){return this.getMediaStreamTrack(!0).getSettings()}close(){this._isClosed=!0,this._lowRtpTransceiver=void 0,this._rtpTransceiver=void 0,function(r){const s=Gv.indexOf(r);s!==-1&&Gv.splice(s,1)}(this),this.emit($v.CLOSED),this.removeAllListeners(W_.SEI_RECEIVED)}_updateRtpTransceiver(r,s){if(s===Hv.LOW_STREAM){if(this._lowRtpTransceiver===r)return;this._lowRtpTransceiver=r}else{if(this._rtpTransceiver===r)return;this._rtpTransceiver=r}this.emit(W_.TRANSCEIVER_UPDATED,r,s)}}class Yv extends gz{get isExternalTrack(){return this._isExternalTrack}get muted(){return this._muted}get enabled(){return this._enabled}get processorContext(){return this._processorContext}constructor(r,s){super(r,s),Pe(this,"_enabled",!0),Pe(this,"_muted",!1),Pe(this,"_isExternalTrack",!1),Pe(this,"_isClosed",!1),Pe(this,"_enabledMutex",void 0),Pe(this,"processor",void 0),Pe(this,"_processorContext",void 0),Pe(this,"_handleTrackEnded",()=>{this.onTrackEnded()}),this._enabledMutex=new js("".concat(this.getTrackId())),r.addEventListener("ended",this._handleTrackEnded)}getTrackLabel(){var r,s;return(r=(s=this._originMediaStreamTrack)===null||s===void 0?void 0:s.label)!==null&&r!==void 0?r:""}close(){this._isClosed||(this.stop(),this._originMediaStreamTrack.stop(),this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack.stop(),this._mediaStreamTrack=null),this._originMediaStreamTrack=null,this._enabledMutex=null,x.debug("[".concat(this.getTrackId(),"] close")),this.emit(St.NEED_CLOSE),super.close())}async _updateOriginMediaStreamTrack(r,s){let a=arguments.length>2&&arguments[2]!==void 0&&arguments[2];this._isExternalTrack=a,r!==this._originMediaStreamTrack&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),s&&this._originMediaStreamTrack.stop()),r.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=r,this._muted&&(this._originMediaStreamTrack.enabled=!1),this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await ur(this,St.NEED_REPLACE_TRACK,this),this.processor&&this._processorContext&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this._processorContext}))}_getDefaultPlayerConfig(){return{}}onTrackEnded(){x.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit($v.TRACK_ENDED)}stateCheck(r,s){if(x.debug("check track state, [muted: ".concat(this._muted,", enabled: ").concat(this._enabled,"] to [").concat(r,": ").concat(s,"]")),rp(s,r),this._enabled&&this._muted&&r==="enabled"&&s===!1)throw new Le(te.TRACK_STATE_UNREACHABLE,"cannot set enabled while the track is muted").print("error",x);if(!this._enabled&&!this._muted&&r==="muted"&&s===!0)throw new Le(te.TRACK_STATE_UNREACHABLE,"cannot set muted while the track is disabled").print("error",x)}getProcessorStats(){return this._processorContext&&this._processorContext.gatherStats()||[]}getProcessorUsage(){return this._processorContext?this._processorContext.gatherUsage():dt.resolve([])}}const _z=window.AudioContext||window.webkitAudioContext;let Xc=null;const nr=new class extends Ur{constructor(){super(...arguments),Pe(this,"prevState",void 0),Pe(this,"curState",void 0),Pe(this,"currentTime",void 0),Pe(this,"currentTimeStuckAt",void 0),Pe(this,"interruptDetectorTrack",void 0),Pe(this,"onLocalAudioTrackMute",()=>{x.info("ios15-interruption-start"),this.emit(gs.IOS_15_16_INTERRUPTION_START)}),Pe(this,"onLocalAudioTrackUnmute",async()=>{x.info("ios15-interruption-end"),this.curState!=="running"||this.duringInterruption?x.info("ios15-interruption-end-canceled"):(Xc&&await Xc.suspend(),this.emit(gs.IOS_15_16_INTERRUPTION_END))})}get duringInterruption(){return this.prevState==="running"&&this.curState==="interrupted"}bindInterruptDetectorTrack(t){x.debug("webaudio bindInterruptDetectorTrack ".concat(t.getTrackId())),this.interruptDetectorTrack||(this.interruptDetectorTrack=t,this.interruptDetectorTrack._mediaStreamTrack.onmute=this.onLocalAudioTrackMute,this.interruptDetectorTrack._mediaStreamTrack.onunmute=this.onLocalAudioTrackUnmute)}unbindInterruptDetectorTrack(t){x.debug("webaudio unbindInterruptDetectorTrack ".concat(t.getTrackId())),this.interruptDetectorTrack&&this.interruptDetectorTrack===t&&(this.interruptDetectorTrack._mediaStreamTrack&&(this.interruptDetectorTrack._mediaStreamTrack.onmute=null,this.interruptDetectorTrack._mediaStreamTrack.onunmute=null),this.interruptDetectorTrack=void 0)}};function Xv(){if(!Xc){if(function(){if(!_z)return void x.error("your browser is not support web audio");x.info("create audio context");const t=Dr({},oe("WEBAUDIO_INIT_OPTIONS"));x.debug("audio context init option:",JSON.stringify(t)),Xc=new _z(t),nr.curState=Xc.state,Xc.onstatechange=()=>{nr.prevState=nr.curState,nr.curState=Xc?Xc.state:void 0;const{prevState:r,curState:s}=nr,a=s==="running",c=s==="interrupted",u=r==="running",h=r==="suspended",m=r==="interrupted",y=Nn().osVersion;(Lo()||gu())&&u&&c&&(x.info("ios".concat(y,"-interruption-start")),nr.emit(gs.IOS_INTERRUPTION_START)),(Lo()||gu())&&(h||m)&&a&&(x.info("ios".concat(y,"-interruption-end")),nr.emit(gs.IOS_INTERRUPTION_END)),r!==s&&nr.emit(gs.STATE_CHANGE,s,r)},setInterval(()=>{var r;const s=(r=Xc)===null||r===void 0?void 0:r.currentTime;nr.currentTime!==s?(nr.currentTimeStuckAt&&(x.debug("AudioContext current time resume at ".concat(s)),nr.currentTimeStuckAt=void 0),nr.currentTime=s):(s!==nr.currentTimeStuckAt&&(It.reportApiInvoke(null,{name:"WEB_AUDIO_CURRENT_TIME_STUCK",options:{currentTime:s},tag:zr.TRACER}).onSuccess(),x.warning("AudioContext current time stuck at ".concat(s))),nr.currentTimeStuckAt=s)},5e3),async function(r){const s=["click","contextmenu","auxclick","dblclick","mousedown","mouseup","touchend","keydown","keyup"];let a,c=!1,u=!1,h=!1;function m(F){r.state==="running"?y(!1):Lo()||gu()?r.state==="suspended"&&(y(!0),F&&r.resume().then(v,v)):r.state!=="closed"&&(y(!0),F&&r.resume().then(v,v))}function y(F){if(c!==F){c=F;for(let j=0,X=s;j<X.length;j+=1){const ee=X[j];F?window.addEventListener(ee,S,{capture:!0,passive:!0}):window.removeEventListener(ee,S,{capture:!0,passive:!0})}}}function v(){m(!1)}function S(){m(!0)}function R(F){if(!h)if(a.paused)if(F){let j;P(!1),h=!0;try{j=a.play(),j?j.then(N,N):(a.addEventListener("playing",N),a.addEventListener("abort",N),a.addEventListener("error",N))}catch{N()}}else P(!0);else P(!1)}function P(F){if(u!==F){u=F;for(let j=0,X=s;j<X.length;j++){const ee=X[j];F?window.addEventListener(ee,G,{capture:!0,passive:!0}):window.removeEventListener(ee,G,{capture:!0,passive:!0})}}}function N(){a.removeEventListener("playing",N),a.removeEventListener("abort",N),a.removeEventListener("error",N),h=!1,R(!1)}function G(){R(!0)}if(Lo()){const F=r.createMediaStreamDestination(),j=document.createElement("div");j.innerHTML="<audio x-webkit-airplay='deny'></audio>",a=j.children.item(0),a.controls=!1,a.disableRemotePlayback=!0,a.preload="auto",a.srcObject=F.stream,R(!0)}nr.on(gs.STATE_CHANGE,function(){m(!0)}),m(!1)}(Xc)}(),!Xc)throw new Le(te.NOT_SUPPORTED,"can not create audio context");return Xc}return Xc}function G_(t){if(function(){if(FL!==null)return FL;const a=Xv(),c=a.createBufferSource(),u=a.createGain(),h=a.createGain();c.connect(u),c.connect(h),c.disconnect(u);let m=!1;try{c.disconnect(u)}catch{m=!0}return c.disconnect(),FL=m,m}())return;const r=t.connect,s=t.disconnect;t.connect=(a,c,u)=>{var h;return t._inputNodes||(t._inputNodes=[]),ot(h=t._inputNodes).call(h,a)||(a instanceof AudioNode?(t._inputNodes.push(a),r.call(t,a,c,u)):r.call(t,a,c)),t},t.disconnect=(a,c,u)=>{s.call(t),a?qA(t._inputNodes,a):t._inputNodes=[];for(const h of t._inputNodes)r.call(t,h)}}let FL=null;function jL(t,r){let s=!1;const a=1/r;if(oe("DISABLE_WEBAUDIO")){const c=window.setInterval(()=>{s?window.clearInterval(c):t(performance.now()/1e3)},1e3*a)}else{const c=Xv();let u=c.createGain();u.gain.value=0,u.connect(c.destination);const h=()=>{if(s)return void(u=null);const m=c.createOscillator();m.onended=h,m.connect(u),m.start(0),m.stop(c.currentTime+a),t(c.currentTime)};h()}return()=>{s=!0}}class yz{constructor(){Pe(this,"context",void 0),Pe(this,"analyserNode",void 0),Pe(this,"sourceNode",void 0),this.context=Xv(),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4}updateSource(r){if(r!==this.sourceNode){if(this.sourceNode)try{this.sourceNode.disconnect(this.analyserNode)}catch{}this.sourceNode=r,r==null||r.connect(this.analyserNode)}}getVolumeLevel(){if(!this.sourceNode||(!this.context||Lo()||gu()||this.context.state!=="running"&&this.context.resume(),!this.analyserNode))return 0;const r=new Float32Array(this.analyserNode.fftSize);if(this.analyserNode.getFloatTimeDomainData)this.analyserNode.getFloatTimeDomainData(r);else{const a=new Uint8Array(this.analyserNode.fftSize);this.analyserNode.getByteTimeDomainData(a);for(let c=0;c<r.length;++c)r[c]=a[c]/128-1}const s=lc(r).call(r,(a,c)=>a+c*c,0)/r.length;return Math.max(10*Math.log10(s)+100,0)/100}getAnalyserNode(){return this.analyserNode}rebuildAnalyser(){try{var r,s;(r=this.sourceNode)===null||r===void 0||r.disconnect(this.analyserNode),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4,(s=this.sourceNode)===null||s===void 0||s.connect(this.analyserNode)}catch{x.warning("rebuild analyser node failed.")}}destroy(){this.updateSource(void 0)}}class Ez extends Ur{get processSourceNode(){return this.sourceNode}set processedNode(r){var s;if(!this.isDestroyed&&this._processedNode!==r){try{var a;(a=this.sourceNode)===null||a===void 0||a.disconnect(this.outputNode)}catch{}(s=this._processedNode)===null||s===void 0||s.disconnect(),this._processedNode=r,this.connect()}}get processedNode(){return this._processedNode}constructor(){super(),Pe(this,"outputNode",void 0),Pe(this,"outputTrack",void 0),Pe(this,"isPlayed",!1),Pe(this,"sourceNode",void 0),Pe(this,"context",void 0),Pe(this,"audioBufferNode",void 0),Pe(this,"destNode",void 0),Pe(this,"audioOutputLevel",0),Pe(this,"volumeLevelAnalyser",void 0),Pe(this,"_processedNode",void 0),Pe(this,"playNode",void 0),Pe(this,"isDestroyed",!1),Pe(this,"onNoAudioInput",void 0),Pe(this,"isNoAudioInput",!1),Pe(this,"_noAudioInputCount",0),this.context=Xv(),this.playNode=this.context.destination,this.outputNode=this.context.createGain(),G_(this.outputNode),this.volumeLevelAnalyser=new yz}startGetAudioBuffer(r){this.audioBufferNode||(this.audioBufferNode=this.context.createScriptProcessor(r),this.outputNode.connect(this.audioBufferNode),this.audioBufferNode.connect(this.context.destination),this.audioBufferNode.onaudioprocess=s=>{this.emit(qc.ON_AUDIO_BUFFER,function(a){for(let c=0;c<a.outputBuffer.numberOfChannels;c+=1){const u=a.outputBuffer.getChannelData(c);for(let h=0;h<u.length;h+=1)u[h]=0}return a.inputBuffer}(s))})}stopGetAudioBuffer(){this.audioBufferNode&&(this.audioBufferNode.onaudioprocess=null,this.outputNode.disconnect(this.audioBufferNode),this.audioBufferNode=void 0)}createOutputTrack(){if(!Vn().webAudioMediaStreamDest)throw new Le(te.NOT_SUPPORTED,"your browser is not support audio processor");return this.destNode&&this.outputTrack||(this.destNode=this.context.createMediaStreamDestination(),this.outputNode.connect(this.destNode),this.outputTrack=this.destNode.stream.getAudioTracks()[0]),this.outputTrack}play(r){this.context.state!=="running"&&YA(()=>{nr.emit("autoplay-failed")}),this.isPlayed=!0,this.playNode=r||this.context.destination,this.outputNode.connect(this.playNode)}stop(){if(this.isPlayed)try{this.outputNode.disconnect(this.playNode)}catch{}this.isPlayed=!1}getAccurateVolumeLevel(){return this.volumeLevelAnalyser.getVolumeLevel()}async checkHasAudioInput(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;if(r>5)return this.isNoAudioInput=!0,this.onNoAudioInput&&this.onNoAudioInput(),!1;Lo()||gu()?this.context.state==="suspended"&&this.context.resume():this.context.state!=="running"&&this.context.resume();const s=this.volumeLevelAnalyser.getAnalyserNode();let a;s.getFloatTimeDomainData?(a=new Float32Array(s.fftSize),s.getFloatTimeDomainData(a)):(a=new Uint8Array(s.fftSize),s.getByteTimeDomainData(a));let c=!1;for(let u=0;u<a.length;u++)a[u]!==0&&(c=!0);return c?(this.isNoAudioInput=!1,!0):(await ps(200),await this.checkHasAudioInput(r?r+1:1)&&c)}getAudioVolume(){return this.outputNode.gain.value}setVolume(r){this.outputNode.gain.setValueAtTime(r,this.context.currentTime)}destroy(){this.disconnect(),this.stop(),this.isDestroyed=!0,this.onNoAudioInput=void 0}disconnect(){var r,s;(r=this.processedNode)===null||r===void 0||r.disconnect(),(s=this.sourceNode)===null||s===void 0||s.disconnect(),this.outputNode&&this.outputNode.disconnect()}connect(){var r;this.processedNode?(r=this.processedNode)===null||r===void 0||r.connect(this.outputNode):this.sourceNode&&this.sourceNode.connect(this.outputNode),this.volumeLevelAnalyser.updateSource(this.outputNode)}}class vz extends Ez{get isFreeze(){return!1}constructor(r,s,a){var c;if(super(),Pe(this,"sourceNode",void 0),Pe(this,"track",void 0),Pe(this,"clonedTrack",void 0),Pe(this,"audioElement",void 0),Pe(this,"isCurrentTrackCloned",!1),Pe(this,"isRemoteTrack",!1),Pe(this,"originVolumeLevelAnalyser",void 0),Pe(this,"rebuildWebAudio",async()=>{if(x.debug("ready to rebuild web audio, state:",this.context.state),this.isNoAudioInput&&await this.checkHasAudioInput(),!this.isNoAudioInput||this.isDestroyed)return document.body.removeEventListener("click",this.rebuildWebAudio,!0),void x.debug("rebuild web audio success, current volume status",this.getAccurateVolumeLevel());this.context.resume().then(()=>x.info("resume success")),x.debug("rebuild web audio because of ios 12 bugs"),this.disconnect();const m=this.track;this.track=this.track.clone(),this.isCurrentTrackCloned?m.stop():this.isCurrentTrackCloned=!0;const y=new MediaStream([this.track]);this.sourceNode=this.context.createMediaStreamSource(y),G_(this.sourceNode),this.volumeLevelAnalyser.rebuildAnalyser();const v=this.outputNode.gain.value;this.outputNode=this.context.createGain(),this.outputNode.gain.setValueAtTime(v,this.context.currentTime),G_(this.outputNode),this.emit(qc.UPDATE_SOURCE),this.connect(),this.audioElement.srcObject=y,this.isPlayed&&this.play(this.playNode),this.checkHasAudioInput()}),r.kind!=="audio")throw new Le(te.UNEXPECTED_ERROR);this.track=r;const u=new MediaStream([this.track]);if(this.isRemoteTrack=!!s,this.sourceNode=this.context.createMediaStreamSource(u),G_(this.sourceNode),a){const m=a.clone();m.enabled=!0,this.clonedTrack=m,x.debug("create an unmuted track ".concat(m.id," from the original track ").concat(a.id," to get the volume"));const y=this.context.createMediaStreamSource(new MediaStream([m]));G_(y),this.originVolumeLevelAnalyser=new yz,this.originVolumeLevelAnalyser.updateSource(y)}this.connect(),this.audioElement=document.createElement("audio"),this.audioElement.srcObject=u;const h=Nn();s&&h.os===Yi.IOS&&Number((c=h.osVersion)===null||c===void 0?void 0:c.split(".")[0])<15&&(nr.on(gs.STATE_CHANGE,()=>{this.context.state==="suspended"?document.body.addEventListener("click",this.rebuildWebAudio,!0):this.context.state==="running"&&this.rebuildWebAudio()}),this.checkHasAudioInput().then(m=>{m||document.body.addEventListener("click",this.rebuildWebAudio,!0)}))}updateTrack(r){this.sourceNode.disconnect(),this.track=r,this.isCurrentTrackCloned=!1;const s=new MediaStream([r]);this.sourceNode=this.context.createMediaStreamSource(s),G_(this.sourceNode),this.processedNode||this.sourceNode.connect(this.outputNode),this.emit(qc.UPDATE_SOURCE),this.audioElement.srcObject=s}destroy(){var r;this.audioElement.srcObject=null,this.audioElement.remove(),nr.off("state-change",this.rebuildWebAudio),(r=this.originVolumeLevelAnalyser)===null||r===void 0||r.destroy(),this.clonedTrack=void 0,super.destroy()}createMediaStreamSourceNode(r){return this.context.createMediaStreamSource(new MediaStream([r]))}updateOriginTrack(r){const s=r.clone();s.enabled=!0,this.clonedTrack&&(this.clonedTrack.stop(),this.clonedTrack=s),x.debug("create an unmuted track ".concat(s.id," from the original track ").concat(r.id," to get the volume"));const a=this.context.createMediaStreamSource(new MediaStream([s]));G_(a),this.originVolumeLevelAnalyser&&this.originVolumeLevelAnalyser.updateSource(a)}getOriginVolumeLevel(){return this.originVolumeLevelAnalyser?this.originVolumeLevelAnalyser.getVolumeLevel():this.getAccurateVolumeLevel()}}async function Sz(t,r,s){const a=(u,h)=>u?typeof u!="number"?u.max||u.exact||u.ideal||u.min||h:u:h,c={audio:!!s&&{mandatory:{chromeMediaSource:"desktop"}},video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:t,maxHeight:a(r.height,1080),maxWidth:a(r.width,1920)}}};return r.frameRate&&typeof r.frameRate!="number"?(c.video.mandatory.maxFrameRate=r.frameRate.max,c.video.mandatory.minFrameRate=r.frameRate.min):typeof r.frameRate=="number"&&(c.video.mandatory.maxFrameRate=r.frameRate),await navigator.mediaDevices.getUserMedia(c)}async function Sme(t,r){const s=await bz(t.mediaSource),{sourceId:a,audio:c}=await function(u){let h=arguments.length>1&&arguments[1]!==void 0&&arguments[1];return new dt((m,y)=>{const v=document.createElement("div");v.innerText="share screen",v.setAttribute("style","text-align: center; height: 25px; line-height: 25px; border-radius: 4px 4px 0 0; background: #D4D2D4; border-bottom:  solid 1px #B9B8B9;");const S=document.createElement("div");S.setAttribute("style","width: 100%; height: 500px; padding: 15px 25px ; box-sizing: border-box;");const R=document.createElement("div");R.innerText="Agora Web Screensharing wants to share the contents of your screen with webdemo.agorabeckon.com. Choose what you'd like to share.",R.setAttribute("style","height: 12%;");const P=document.createElement("div");P.setAttribute("style","width: 100%; height: 80%; background: #FFF; border:  solid 1px #CBCBCB; display: flex; flex-wrap: wrap; justify-content: space-around; overflow-y: scroll; padding: 0 15px; box-sizing: border-box;");const N=document.createElement("div");N.setAttribute("style","display: flex; justify-content: space-between; padding: 16px 0;");const G=document.createElement("button");G.innerHTML="cancel",G.setAttribute("style","width: 85px;"),G.onclick=()=>{document.body.removeChild(X);const ee=new Error("NotAllowedError");ee.name="NotAllowedError",y(ee)};let F=h;const j=document.createElement("div");if(h){const ee=document.createElement("input");ee.setAttribute("type","checkbox");const he=document.createElement("span");ee.setAttribute("style","margin-right: 6px;"),he.innerText="Share audio",ee.checked=F,ee.onchange=()=>{F=ee.checked},j.appendChild(ee),j.appendChild(he)}N.appendChild(j),N.appendChild(G),S.appendChild(R),S.appendChild(P),S.appendChild(N);const X=document.createElement("div");X.setAttribute("style","position: fixed; z-index: 99999999; top: 50%; left: 50%; width: 620px; height: 525px; background: #ECECEC; border-radius: 4px; -webkit-transform: translate(-50%,-50%); transform: translate(-50%,-50%);"),X.appendChild(v),X.appendChild(S),document.body.appendChild(X),u.map(ee=>{if(ee.id){const he=document.createElement("div");he.setAttribute("style","width: 30%; height: 160px; padding: 20px 0; text-align: center;box-sizing: content-box;");let Se=ee.thumbnail;try{const{width:Te}=Se.getSize();Te>1920&&(Se=Se.resize({width:1920}))}catch(Te){throw Te&&Te.message.startsWith("Illegal invocation")&&console.error("Operate thumbnail error, please try to set contextIsolation: false. (https://github.com/electron/electron/issues/34953)"),Te}he.innerHTML='<div style="height: 120px; display: table-cell; vertical-align: middle;"><img style="width: 100%; background: #333333; box-shadow: 1px 1px 1px 1px rgba(0, 0, 0, 0.2);" src='+Se.toDataURL()+' /></div><span style="	height: 40px; line-height: 40px; display: inline-block; width: 70%; word-break: keep-all; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+ee.name.replace(/[\u00A0-\u9999<>\&]/g,function(Te){return"&#"+Te.charCodeAt(0)+";"})+"</span>",he.onclick=()=>{document.body.removeChild(X),m({sourceId:ee.id,audio:F})},P.appendChild(he)}})})}(s,r);return await Sz(a,t,c)}async function bz(t){let r=["window","screen"];t!=="application"&&t!=="window"||(r=["window"]),t==="screen"&&(r=["screen"]);const s=x8();if(!s)throw console.error("failed to fetch electron, please mount it to window"),new Le(te.ELECTRON_IS_NULL);let a=null;try{var c;a=((c=s.desktopCapturer)===null||c===void 0?void 0:c.getSources({types:r}))||s.ipcRenderer.invoke("DESKTOP_CAPTURER_GET_SOURCES",{types:r})}catch{a=null}a&&a.then||(a=new dt((u,h)=>{s.desktopCapturer.getSources({types:r},(m,y)=>{m?h(m):u(y)})}));try{return await a}catch(u){throw new Le(te.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR,u.toString())}}const BL=new js("safari");let Tz=!1,wz=!1;async function Jc(t,r){let s=0,a=null;for(;s<2;)try{a=await bme(t,r,s>0);break}catch(c){if(c instanceof Le)throw x.error("[".concat(r,"] ").concat(c.toString())),c;const u=oP(c.name||c.code||c,c.message);if(u.code===te.MEDIA_OPTION_INVALID){x.debug("[".concat(r,"] detect media option invalid, retry")),s+=1,await ps(500);continue}throw x.error("[".concat(r,"] ").concat(u.toString())),u}if(!a)throw new Le(te.UNEXPECTED_ERROR,"can not find stream after getUserMedia");return a}async function bme(t,r,s){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new Le(te.NOT_SUPPORTED,"can not find getUserMedia");s&&(t.video&&(delete t.video.width,delete t.video.height),t.screen&&(delete t.screen.width,delete t.screen.height));const a=Vn(),c=new MediaStream;if(t.audioSource&&c.addTrack(t.audioSource),t.videoSource&&c.addTrack(t.videoSource),!t.audio&&!t.video&&!t.screen)return x.debug("Using Video Source/ Audio Source"),c;if(t.screen)if(x8())t.screen.sourceId?Jv(c,await Sz(t.screen.sourceId,t.screen,!!t.screenAudio)):Jv(c,await Sme(t.screen,!!t.screenAudio));else if(tp()&&t.screen.extensionId&&t.screen.mandatory){if(!a.getStreamFromExtension)throw new Le(te.NOT_SUPPORTED,"This browser does not support screen sharing");x.debug("[".concat(r,'] Screen access on chrome stable, looking for extension"'));const P=await(h=t.screen.extensionId,m=r,new dt((N,G)=>{try{chrome.runtime.sendMessage(h,{getStream:!0},F=>{if(!F||!F.streamId)return x.error("[".concat(m,"] No response from Chrome Plugin. Plugin not installed properly"),F),void G(new Le(te.CHROME_PLUGIN_NO_RESPONSE,"No response from Chrome Plugin. Plugin not installed properly"));N(F.streamId)})}catch(F){x.error("[".concat(m,"] AgoraRTC screensharing plugin is not accessible(").concat(h,")"),F.toString()),G(new Le(te.CHROME_PLUGIN_NOT_INSTALL))}}));t.screen.mandatory.chromeMediaSourceId=P,Jv(c,await navigator.mediaDevices.getUserMedia({video:{mandatory:t.screen.mandatory}}))}else if(a.getDisplayMedia){var u;t.screen.mediaSource&&hz(t.screen.mediaSource);const P={width:t.screen.width,height:t.screen.height,frameRate:t.screen.frameRate,displaySurface:(u=t.screen.displaySurface)!==null&&u!==void 0?u:t.screen.mediaSource==="screen"?"monitor":t.screen.mediaSource},{selfBrowserSurface:N,surfaceSwitching:G,systemAudio:F,preferCurrentTab:j}=t.screen,X={selfBrowserSurface:N,surfaceSwitching:G,systemAudio:F,preferCurrentTab:j};!N&&delete X.selfBrowserSurface,!G&&delete X.surfaceSwitching,!F&&delete X.systemAudio,!j&&delete X.preferCurrentTab,x.debug("[".concat(r,"] getDisplayMedia:"),JSON.stringify({video:P,audio:t.screenAudio,controls:X})),Jv(c,await navigator.mediaDevices.getDisplayMedia(Dr({video:P,audio:t.screenAudio},X)))}else{if(!Br())throw x.error("[".concat(r,"] This browser does not support screenSharing")),new Le(te.NOT_SUPPORTED,"This browser does not support screen sharing");{t.screen.mediaSource&&hz(t.screen.mediaSource);const P={video:{mediaSource:t.screen.mediaSource,width:t.screen.width,height:t.screen.height,frameRate:t.screen.frameRate}};x.debug("[".concat(r,"] getUserMedia: ").concat(JSON.stringify(P))),Jv(c,await navigator.mediaDevices.getUserMedia(P))}}var h,m;if(!t.video&&!t.audio)return c;let y={video:t.video,audio:t.audio},v=oe("MEDIA_DEVICE_CONSTRAINTS");if(v)try{typeof v=="string"&&(v=JSON.parse(v)),y=yL(y,v)}catch{}x.debug("[".concat(r,"] GetUserMedia"),JSON.stringify(y)),Nn();let S,R=null;(Ps()||Lo()||$A())&&(R=await BL.lock());try{S=await navigator.mediaDevices.getUserMedia(y)}catch(P){throw R&&R(),P}return y.audio&&(Tz=!0),y.video&&(wz=!0),Jv(c,S),R&&R(),c}function oP(t,r){switch(t){case"Starting video failed":case"OverconstrainedError":case"TrackStartError":return new Le(te.MEDIA_OPTION_INVALID,"".concat(t,": ").concat(r));case"NotFoundError":case"DevicesNotFoundError":return new Le(te.DEVICE_NOT_FOUND,"".concat(t,": ").concat(r));case"NotSupportedError":return new Le(te.NOT_SUPPORTED,"".concat(t,": ").concat(r));case"NotReadableError":return new Le(te.NOT_READABLE,"".concat(t,": ").concat(r));case"InvalidStateError":case"NotAllowedError":case"PERMISSION_DENIED":case"PermissionDeniedError":return new Le(te.PERMISSION_DENIED,"".concat(t,": ").concat(r));case"ConstraintNotSatisfiedError":return new Le(te.CONSTRAINT_NOT_SATISFIED,"".concat(t,": ").concat(r));default:return x.error("getUserMedia unexpected error",t),new Le(te.UNEXPECTED_ERROR,"".concat(t,": ").concat(r))}}function Jv(t,r){const s=t.getVideoTracks()[0],a=t.getAudioTracks()[0],c=r.getVideoTracks()[0],u=r.getAudioTracks()[0];u&&(a&&t.removeTrack(a),t.addTrack(u)),c&&(s&&t.removeTrack(s),t.addTrack(c))}const Qc=new class extends Ur{get state(){return this._state}set state(t){t!==this._state&&(this.emit(z_.STATE_CHANGE,t),this._state=t)}constructor(){super(),Pe(this,"_state",NT.IDLE),Pe(this,"isAccessMicrophonePermission",!1),Pe(this,"isAccessCameraPermission",!1),Pe(this,"lastAccessMicrophonePermission",!1),Pe(this,"lastAccessCameraPermission",!1),Pe(this,"checkdeviceMatched",!1),Pe(this,"deviceInfoMap",new Map),this.init().then(()=>{navigator.mediaDevices.addEventListener&&navigator.mediaDevices.addEventListener("devicechange",this.updateDevicesInfo.bind(this)),window.setInterval(()=>{(oe("ENUMERATE_DEVICES_INTERVAL")||(KA()||HA()===Yi.HARMONY_OS)&&np())&&this.updateDevicesInfo()},oe("ENUMERATE_DEVICES_INTERVAL_TIME"))}).catch(t=>x.error(t.toString()))}async enumerateDevices(t,r){let s=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)return new Le(te.NOT_SUPPORTED,"enumerateDevices() not supported.").throw();const a=await navigator.mediaDevices.enumerateDevices(),c=this.checkMediaDeviceInfoIsOk(a);let u=!this.isAccessMicrophonePermission&&t,h=!this.isAccessCameraPermission&&r;c.audio&&(u=!1),c.video&&(h=!1);let m=null,y=null,v=null;if(!s&&(u||h)){if(BL.isLocked&&(x.debug("[device manager] wait GUM lock"),(await BL.lock())(),x.debug("[device manager] GUM unlock")),Tz&&(u=!1,this.isAccessMicrophonePermission=!0),wz&&(h=!1,this.isAccessCameraPermission=!0),x.debug("[device manager] check media device permissions",t,r,u,h),u&&h){try{v=await navigator.mediaDevices.getUserMedia({audio:!0,video:!0})}catch(S){const R=oP(S.name||S.code||S,S.message);if(R.code===te.PERMISSION_DENIED)throw R;x.warning("getUserMedia failed in getDevices",R)}this.isAccessCameraPermission=!0,this.isAccessMicrophonePermission=!0}else if(u){try{m=await navigator.mediaDevices.getUserMedia({audio:t})}catch(S){const R=oP(S.name||S.code||S,S.message);if(R.code===te.PERMISSION_DENIED)throw R;x.warning("getUserMedia failed in getDevices",R)}this.isAccessMicrophonePermission=!0}else if(h){try{y=await navigator.mediaDevices.getUserMedia({video:r})}catch(S){const R=oP(S.name||S.code||S,S.message);if(R.code===te.PERMISSION_DENIED)throw R;x.warning("getUserMedia failed in getDevices",R)}this.isAccessCameraPermission=!0}x.debug("[device manager] mic permission",t,"cam permission",r)}try{const S=await navigator.mediaDevices.enumerateDevices();return m&&m.getTracks().forEach(R=>R.stop()),y&&y.getTracks().forEach(R=>R.stop()),v&&v.getTracks().forEach(R=>R.stop()),m=null,y=null,v=null,S}catch(S){return m&&m.getTracks().forEach(R=>R.stop()),y&&y.getTracks().forEach(R=>R.stop()),v&&v.getTracks().forEach(R=>R.stop()),m=null,y=null,v=null,new Le(te.ENUMERATE_DEVICES_FAILED,S.toString()).throw()}}async getRecordingDevices(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,t)).filter(r=>r.kind==="audioinput")}async getCamerasDevices(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!1,!0,t)).filter(r=>r.kind==="videoinput")}async getSpeakers(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,t)).filter(r=>r.kind==="audiooutput")}searchDeviceIdByName(t){let r=null;return this.deviceInfoMap.forEach(s=>{s.device.label===t&&(r=s.device.deviceId)}),r}async getDeviceById(t){const r=(await this.enumerateDevices(!0,!0,!0)).find(s=>s.deviceId===t);if(!r)throw new Le(te.DEVICE_NOT_FOUND,"deviceId: ".concat(t));return r}async init(){this.state=NT.INITING;try{await this.updateDevicesInfo(),this.state=NT.INITEND}catch(t){throw x.warning("Device Detection functionality cannot start properly.",t.toString()),this.state=NT.IDLE,(typeof isSecureContext=="boolean"?isSecureContext:location.protocol==="https:"||location.protocol==="file:"||location.hostname==="localhost"||location.hostname==="127.0.0.1"||location.hostname==="::1")||new Le(te.WEB_SECURITY_RESTRICT,"Your context is limited by web security, please try using https protocol or localhost.").throw(),t}}async updateDevicesInfo(){const t=await this.enumerateDevices(!0,!0,!0),r=Date.now(),s=[];if(t[0]&&t[0].label&&this.checkdeviceMatched===!1){this.checkdeviceMatched=!0;const c=t.find(h=>h.kind==="audioinput"&&h.deviceId==="default"),u=t.find(h=>h.kind==="audiooutput"&&h.deviceId==="default");c&&u?u.groupId===c.groupId?x.debug("[device-check] default input ".concat(c.label," and output ").concat(u.label," is the same group")):x.debug("[device-check] default input ".concat(c.label," and output ").concat(u.label," is not the same group")):x.debug("[device-check] default input or output not found")}const a=this.checkMediaDeviceInfoIsOk(t);if(t.forEach(c=>{if(!c.deviceId)return;const u=this.deviceInfoMap.get("".concat(c.kind,"_").concat(c.deviceId));if((u?u.state:"INACTIVE")!=="ACTIVE"){const h={initAt:r,updateAt:r,device:c,state:"ACTIVE"};this.deviceInfoMap.set("".concat(c.kind,"_").concat(c.deviceId),h),s.push(h)}u&&(u.updateAt=r)}),this.deviceInfoMap.forEach((c,u)=>{c.state==="ACTIVE"&&c.updateAt!==r&&(c.state="INACTIVE",s.push(c))}),this.state!==NT.INITEND)return a.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),void(a.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0));s.forEach(c=>{switch(c.device.kind){case"audioinput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(z_.RECORDING_DEVICE_CHANGED,c);break;case"videoinput":this.lastAccessCameraPermission&&this.isAccessCameraPermission&&this.emit(z_.CAMERA_DEVICE_CHANGED,c);break;case"audiooutput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(z_.PLAYOUT_DEVICE_CHANGED,c)}}),a.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),a.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0)}checkMediaDeviceInfoIsOk(t){const r=t.filter(c=>c.kind==="audioinput"),s=t.filter(c=>c.kind==="videoinput"),a={audio:!1,video:!1};for(const c of r)if(c.label&&c.deviceId){a.audio=!0;break}for(const c of s)if(c.label&&c.deviceId){a.video=!0;break}return a}};let WL=!1;const Zc=new class extends Ur{constructor(){super(...arguments),Pe(this,"onAutoplayFailed",void 0),Pe(this,"onAudioAutoplayFailed",void 0)}};function Cz(){if(Nn(),!WL){const t=r=>{r.preventDefault(),WL=!1,TT()?document.body.removeEventListener("click",t,!0):(document.body.removeEventListener("touchstart",t,!0),document.body.removeEventListener("mousedown",t,!0))};WL=!0,TT()?document.body.addEventListener("click",t,!0):(document.body.addEventListener("touchstart",t,!0),document.body.addEventListener("mousedown",t,!0)),x.info("detect media autoplay failed, document: https://docs.agora.io/cn/Voice/autoplay_policy_web_ng?platform=Web"),Zc.onAutoplayFailed?Zc.onAutoplayFailed():Zc.onAudioAutoplayFailed?x.warning(`AgoraRTC.onAudioAutoplayFailed has been deprecated in favor of AgoraRTC.onAutoplayFailed.

  Please refer to the Agora document to migrate the newer API, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`):x.warning(`We have detected a media autoplay failed event, and found out that you haven't implemented AgoraRTC.onAutoplayFailed callback yet.

  It will cause audio/video element not playing automatically on some browsers without user interaction, possibly hurting user experiences.

  Please refer to the Agora document to properly handle autoplay failed event, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`),Zc.emit("autoplay-failed")}}function Rz(t,r,s,a){if(!t)return;const c=It.getBaseInfoBySessionId(t);if(!c)return;const u=c.info,h=Date.now(),m=Dr(Dr({},u),{},{vid:u.vid===void 0?0:Number(u.vid),lts:h,elapse:h-c.startTime,cbRegistered:Zc.onAutoplayFailed||Zc.onAudioAutoplayFailed?1:-1,errorMsg:s,mediaType:r,trackId:a,extend:void 0});It.send({type:Nr.AUTOPLAY_FAILED,data:m},!0)}const Tme=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","error"],ua=new class{constructor(){Pe(this,"onAutoplayFailed",void 0),Pe(this,"elementMap",new Map),Pe(this,"elementStateMap",new Map),Pe(this,"elementsNeedToResume",[]),Pe(this,"sinkIdMap",new Map),Pe(this,"autoResumeAfterInterruption",t=>{Array.from(this.elementMap.entries()).forEach(r=>{let[s,a]=r;const c=this.elementStateMap.get(s),u=a.srcObject.getAudioTracks()[0],h=u&&u.readyState;if(x.debug("resume after interrupted, ele: ".concat(c," audio: ").concat(h," ").concat(t)),h==="live"){if(t)return a.pause(),void a.play();if(nr.curState==="running")return Uv()?(a.pause(),void a.play()):void(c&&c==="paused"&&a.play())}})}),Pe(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{Array.from(this.elementMap.entries()).forEach(t=>{let[r,s]=t;const a=s.srcObject.getAudioTracks()[0];a&&a.readyState==="live"&&(x.debug("auto resume after interruption inside autoResumeAfterInterruptionOnIOS15"),s.pause(),s.play())})}),this.autoResumeAudioElement(),nr.on(gs.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),nr.on(gs.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),nr.on(gs.STATE_CHANGE,()=>{Lo()&&nr.prevState==="suspended"&&nr.curState==="running"&&this.autoResumeAfterInterruption()})}async setSinkID(t,r){const s=this.elementMap.get(t);if(this.sinkIdMap.set(t,r),s)try{await s.setSinkId(r)}catch(a){throw new Le(te.PERMISSION_DENIED,"can not set sink id: "+a.toString())}}play(t,r,s,a){if(this.elementMap.has(r))return;const c=document.createElement("audio");c.autoplay=!0,c.srcObject=new MediaStream([t]),this.bindAudioElementEvents(r,c),this.elementMap.set(r,c),this.elementStateMap.set(r,mo.INIT),this.setVolume(r,s);const u=this.sinkIdMap.get(r);if(u)try{c.setSinkId(u).catch(m=>{x.warning("[".concat(r,"] set sink id failed"),m.toString())})}catch(m){x.warning("[".concat(r,"] set sink id failed"),m.toString())}const h=c.play();h&&h.then&&h.catch(m=>{a&&Rz(a,"audio",m.message,r),x.warning("audio element play warning",m.toString()),this.elementMap.has(r)&&m.name==="NotAllowedError"&&(x.warning("detected audio element autoplay failed"),this.elementsNeedToResume.push(c),YA(()=>{this.onAutoplayFailed&&this.onAutoplayFailed(),Cz()}))})}updateTrack(t,r){const s=this.elementMap.get(t);s&&(s.srcObject=new MediaStream([r]))}isPlaying(t){return this.elementMap.has(t)&&this.elementStateMap.get(t)==="playing"}setVolume(t,r){const s=this.elementMap.get(t);s&&(r=Math.max(0,Math.min(100,r)),s.volume=r/100)}stop(t){const r=this.elementMap.get(t);if(this.sinkIdMap.delete(t),!r)return;const s=this.elementsNeedToResume.indexOf(r);this.elementsNeedToResume.splice(s,1),r.srcObject=null,r.remove(),this.elementMap.delete(t),this.elementStateMap.delete(t)}bindAudioElementEvents(t,r){Tme.forEach(s=>{r.addEventListener(s,a=>{const c=this.elementStateMap.get(t),u=a.type==="pause"?"paused":a.type;if(x.debug("[".concat(t,"] audio-element-status change ").concat(c," => ").concat(u)),a.type==="error"){const h=r==null?void 0:r.error;h&&x.error("[".concat(t,"] media error, code: ").concat(h.code,", message: ").concat(h.message))}this.elementStateMap.set(t,u)})})}getPlayerState(t){return this.elementStateMap.get(t)||"uninit"}autoResumeAudioElement(){const t=()=>{this.elementsNeedToResume.forEach(r=>{r.play().then(s=>{x.debug("Auto resume audio element success")}).catch(s=>{x.warning("Auto resume audio element failed!",s)})}),this.elementsNeedToResume=[]};new dt(r=>{document.body?r():window.addEventListener("load",()=>r())}).then(()=>{TT()?document.body.addEventListener("click",t,!0):(document.body.addEventListener("touchstart",t,!0),document.body.addEventListener("mousedown",t,!0))})}};function ci(){return function(t,r,s){const a=s.value;return typeof a=="function"&&(s.value=function(){this._isClosed&&new Le(te.INVALID_OPERATION,"[".concat(this.getTrackId(),"] cannot operate a closed track")).print("warning",x);for(var c=arguments.length,u=new Array(c),h=0;h<c;h++)u[h]=arguments[h];const m=a.apply(this,u);return m instanceof dt?new dt((y,v)=>{m.then(y).catch(v)}):m}),s}}class Iz extends Ur{constructor(r){super(),Pe(this,"name","VideoProcessorDestination"),Pe(this,"ID","0"),Pe(this,"_source",void 0),Pe(this,"videoContext",void 0),Pe(this,"inputTrack",void 0),this.videoContext=r}get kind(){return"video"}get enabled(){return!0}pipe(){throw new Le(te.NOT_SUPPORTED,"VideoProcessor cannot pipe to any other Processor")}unpipe(){throw new Le(te.NOT_SUPPORTED,"VideoProcessor cannot unpipe to any other Processor")}enable(){}disable(){}updateInput(r){if(r.context!==this.videoContext)throw new Error(`ProcessorContext passed to VideoTrack.processorDestination doesn't match it's belonging VideoTrack's context.
Probably you are making pipeline like this:
videoTrack1.pipe(processor).pipe(videoTrack2.processorDestination).`);r.track&&r.track!==this.inputTrack&&(this.videoContext.chained=!0,this.inputTrack=r.track,this.emit(Mo.ON_TRACK,r.track))}reset(){this.inputTrack=void 0,this.videoContext.chained=!1,this.emit(Mo.ON_TRACK,void 0)}}class Az extends Ur{set chained(r){this._chained=r}get chained(){return this._chained}constructor(r,s){super(),Pe(this,"constraintsMap",new Map),Pe(this,"statsRegistry",[]),Pe(this,"usageRegistry",[]),Pe(this,"trackId",void 0),Pe(this,"direction",void 0),Pe(this,"_chained",!1),this.trackId=r,this.direction=s}async getConstraints(){return await ks(this,Yc.REQUEST_CONSTRAINTS)}async requestApplyConstraints(r,s){var a;return x.info("processor ".concat(s.name," requestApplyConstraints for ").concat(this.trackId)),r&&this.constraintsMap.set(s,r),ur(this,Yc.REQUEST_UPDATE_CONSTRAINTS,Array.from(zc(a=this.constraintsMap).call(a)))}async requestRevertConstraints(r){var s;if(this.constraintsMap.has(r))return x.info("processor ".concat(r.name," requestRevertConstraints for ").concat(this.trackId)),this.constraintsMap.delete(r),ur(this,Yc.REQUEST_UPDATE_CONSTRAINTS,Array.from(zc(s=this.constraintsMap).call(s)))}registerStats(r,s,a){this.statsRegistry.find(c=>c.processorID===r.ID&&c.processorName===r.name&&c.type===s)||this.statsRegistry.push({processorName:r.name,processorID:r.ID,type:s,cb:a})}unregisterStats(r,s){const a=this.statsRegistry.findIndex(c=>c.processorID===r.ID&&c.processorName===r.name&&c.type===s);a!==-1&&this.statsRegistry.splice(a,1)}gatherStats(){const r=[];for(const{processorID:s,processorName:a,type:c,cb:u}of this.statsRegistry)try{const h=u();r.push({processorID:s,processorName:a,type:c,stats:h})}catch(h){x.error(new Le(te.UNEXPECTED_ERROR,h.message))}return r}registerUsage(r,s){this.usageRegistry.find(a=>a.processorID===r.ID&&a.processorName===r.name)||this.usageRegistry.push({processorID:r.ID,processorName:r.name,cb:s})}unregisterUsage(r){const s=this.usageRegistry.findIndex(a=>a.processorID===r.ID&&a.processorName===r.name);s!==-1&&this.usageRegistry.splice(s,1)}async gatherUsage(){const r=[];if(!this.chained)return[];for(const{cb:s}of this.usageRegistry)try{let a=s();a instanceof dt&&(a=await a),r.push(Dr(Dr({},a),{},{direction:this.direction}))}catch(a){x.error("gather extension usage error",a)}return r}getDirection(){return this.direction}}class Pz extends Ur{constructor(r){super(),Pe(this,"name","AudioProcessorDestination"),Pe(this,"ID","0"),Pe(this,"inputTrack",void 0),Pe(this,"inputNode",void 0),Pe(this,"audioProcessorContext",void 0),Pe(this,"_source",void 0),this.audioProcessorContext=r}get kind(){return"audio"}get enabled(){return!0}pipe(){throw new Le(te.NOT_SUPPORTED,"AudioProcessorDestination cannot pipe to any other Processor")}unpipe(){throw new Le(te.NOT_SUPPORTED,"AudioProcessor cannot unpipe to any other Processor")}enable(){}disable(){}reset(){this.inputTrack=void 0,this.inputNode=void 0,this.audioProcessorContext.chained=!1,this.emit(Mo.ON_TRACK,void 0),this.emit(Mo.ON_NODE,void 0)}updateInput(r){if(r.context!==this.audioProcessorContext)throw new Error(`ProcessorContext passed to AudioTrack.processorDestination doesn't match it's belonging AudioTrack's context.
        Probably you are making pipeline like this: audioTrack1.pipe(processor).pipe(audioTrack2.processorDestination).`);r.track&&this.inputTrack!==r.track&&(this.audioProcessorContext.chained=!0,this.inputTrack=r.track,this.emit(Mo.ON_TRACK,this.inputTrack)),r.node&&this.inputNode!==r.node&&(this.audioProcessorContext.chained=!0,this.inputNode=r.node,this.emit(Mo.ON_NODE,this.inputNode))}}class Oz extends Ur{set chained(r){this._chained=r}get chained(){return this._chained}constructor(r,s,a){super(),Pe(this,"constraintsMap",new Map),Pe(this,"statsRegistry",[]),Pe(this,"audioContext",void 0),Pe(this,"trackId",void 0),Pe(this,"direction",void 0),Pe(this,"usageRegistry",[]),Pe(this,"_chained",!1),this.audioContext=r,this.trackId=s,this.direction=a}async getConstraints(){return ks(this,Yc.REQUEST_CONSTRAINTS)}getAudioContext(){return this.audioContext}async requestApplyConstraints(r,s){var a;return x.info("processor ".concat(s.name," requestApplyConstraints for ").concat(this.trackId)),r&&this.constraintsMap.set(s,r),ur(this,Yc.REQUEST_UPDATE_CONSTRAINTS,Array.from(zc(a=this.constraintsMap).call(a)))}async requestRevertConstraints(r){var s;if(this.constraintsMap.has(r))return this.constraintsMap.delete(r),ur(this,Yc.REQUEST_UPDATE_CONSTRAINTS,Array.from(zc(s=this.constraintsMap).call(s)))}registerStats(r,s,a){this.statsRegistry.find(c=>c.processorID===r.ID&&c.processorName===r.name&&c.type===s)||this.statsRegistry.push({processorName:r.name,processorID:r.ID,type:s,cb:a})}unregisterStats(r,s){const a=this.statsRegistry.findIndex(c=>c.processorID===r.ID&&c.processorName===r.name&&c.type===s);a!==-1&&this.statsRegistry.splice(a,1)}gatherStats(){const r=[];for(const{processorID:s,processorName:a,type:c,cb:u}of this.statsRegistry)try{const h=u();r.push({processorID:s,processorName:a,type:c,stats:h})}catch(h){x.error(new Le(te.UNEXPECTED_ERROR,h.message))}return r}registerUsage(r,s){this.usageRegistry.find(a=>a.processorID===r.ID&&a.processorName===r.name)||this.usageRegistry.push({processorID:r.ID,processorName:r.name,cb:s})}unregisterUsage(r){const s=this.usageRegistry.findIndex(a=>a.processorID===r.ID&&a.processorName===r.name);s!==-1&&this.usageRegistry.splice(s,1)}async gatherUsage(){const r=[];if(!this.chained)return[];for(const{cb:s}of this.usageRegistry)try{let a=s();a instanceof dt&&(a=await a),r.push(Dr(Dr({},a),{},{direction:this.direction}))}catch(a){x.error("gather extension usage error",a)}return r}getDirection(){return this.direction}}class zL extends Ur{get isPlayed(){return!0}get isFreeze(){return!1}constructor(){super(),Pe(this,"context",void 0),Pe(this,"processSourceNode",void 0),Pe(this,"outputTrack",void 0),Pe(this,"processedNode",void 0),Pe(this,"clonedTrack",void 0),Pe(this,"outputNode",void 0),this.outputNode=new wme}setVolume(){}createOutputTrack(){throw new Le(te.NOT_SUPPORTED,"can not create output MediaStreamTrack when WebAudio disabled")}getOriginVolumeLevel(){return 0}getAccurateVolumeLevel(){return 0}stopGetAudioBuffer(){}startGetAudioBuffer(){}play(){}stop(){}destroy(){}updateTrack(){}updateOriginTrack(){}createMediaStreamSourceNode(){}}class wme{disconnect(){}connect(){}}function kz(t){return new dt((r,s)=>{let a=!1;const c=document.createElement("video");c.setAttribute("autoplay",""),c.setAttribute("muted",""),c.muted=!0,c.autoplay=!0,c.setAttribute("playsinline",""),c.setAttribute("style","position: fixed; top: 0; left: 0; width: 1px; height: 1px"),document.body.appendChild(c);const u=Lo()?"canplay":"playing";c.addEventListener(u,()=>{const h=c.videoWidth,m=c.videoHeight;!h&&Br()||(a=!0,c.srcObject=null,c.remove(),r([h,m]))}),c.srcObject=new MediaStream([t]),c.play().catch(XA),setTimeout(()=>{a||(c.srcObject=null,c.remove(),r([c.videoWidth,c.videoHeight]))},4e3)})}function aP(t){const r={};t.facingMode&&(r.facingMode=t.facingMode),t.cameraId&&(r.deviceId={exact:t.cameraId});const s=bh(t.encoderConfig);return s.width!=null&&(r.width=s.width),s.height!=null&&(r.height=s.height),!P8()&&s.frameRate&&(r.frameRate=s.frameRate),S8()&&typeof r.frameRate=="object"&&(r.frameRate.max=60),Br()&&(r.frameRate={ideal:30,max:30}),r}function Nz(t){const r={};return P8()||(t.AGC!==void 0&&(r.autoGainControl=t.AGC),t.AEC!==void 0&&(r.echoCancellation=t.AEC),t.ANS!==void 0&&(r.noiseSuppression=t.ANS,tp()&&t.ANS&&(r.googHighpassFilter=t.ANS))),r}function Dz(t){const r=Nz(t);if(t.encoderConfig){const s=iP(t.encoderConfig);r.channelCount=s.stereo?2:1,r.sampleRate=s.sampleRate,r.sampleSize=s.sampleSize}return t.microphoneId&&(r.deviceId={exact:t.microphoneId}),KA()&&(r.sampleRate=void 0),r}const Cme=t=>{const r=t._encoderConfig;if(!r)return;const{frameRate:s,width:a,height:c}=t.getMediaStreamTrackSettings();let{frameRate:u=s,width:h=a,height:m=c}=r;if(!u||!h||!m)return;h=EL(h),m=EL(m),u=EL(u);const{max:y,min:v}=function(N,G,F){const j=200*Math.pow(F/15,.6)*Math.pow(N*G/640/360,.75);return{min:Math.floor(j),max:Math.floor(4*j)}}(h,m,u),{bitrateMax:S,bitrateMin:R}=r||{};S||x.debug("calculate bitrate: [w: ".concat(h,", h: ").concat(m,", fps: ").concat(u,"] => [brMax: ").concat(S,", brMin: ").concat(R,"]"));const{maxFramerate:P}=oe("ENCODER_CONFIG_LIMIT");return P&&typeof P=="number"&&(u=Math.min(u,P)),{frameRate:u,bitrateMax:S||y,bitrateMin:R||v,scaleResolutionDownBy:1,scale:0}},xz=async(t,r,s)=>await(async(a,c,u)=>{const h=function(v){const S=[];for(let R=0;R<v.length;R+=2)S.push(parseInt(v.slice(R,R+2),16));return Uint8Array.from(S)}(H8(""+c+u)).slice(0,16),m=h.slice(0,12),y=await window.crypto.subtle.importKey("raw",h,"AES-GCM",!0,["encrypt"]);return new Uint8Array(await window.crypto.subtle.encrypt({name:"AES-GCM",iv:m},y,a))})(t.buffer,r,s),GL=t=>{const r=document.createElement("canvas");return r.width=2,r.height=2,new dt((s,a)=>{r.toBlob(async c=>{if(r.remove(),c){const u=await Lz(c);s({buffer:u,width:r.width,height:r.height})}else a(new Le(te.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},t,1)})},Lz=async t=>{const r=await t.arrayBuffer();return new Uint8Array(r)};var Mz,Uz,Vz,Fz,jz,Bz,Wz,zz,Gz,Hz,$z,Kz,qz,Yz,Xz,Jz,Qz,Zz,Vr,eG,tG,nG,rG,iG,sG,wh,oG,aG,cG,lG,uG,dG,hG,fG,pG,mG,gG,_G,yG,Ds;let Yr=(Mz=Ft({argsMap:(t,r)=>[t.getTrackId(),r],throttleTime:300}),Uz=Ft({argsMap:(t,r)=>[t.getTrackId(),r]}),Vz=ci(),Fz=jv("LocalAudioTrack","_enabledMutex"),jz=Ft({argsMap:(t,r)=>[t.getTrackId(),r]}),Bz=ci(),Wz=jv("LocalAudioTrack","_enabledMutex"),zz=Ft({argsMap:(t,r)=>[t.getTrackId(),r]}),Gz=ci(),Hz=ci(),$z=ci(),Kz=Ft({argsMap:t=>[t.getTrackId()]}),qz=ci(),Yz=Ft({argsMap:t=>[t.getTrackId()]}),Xz=ci(),Jz=Ft({argsMap:t=>[t.getTrackId()]}),Qz=Ft({argsMap:(t,r)=>[t.getTrackId(),r.name]}),Zz=Ft({argsMap:t=>[t.getTrackId()]}),xn((Vr=class extends Yv{get _source(){return this.initWebAudio()}set _source(t){this._trackSource=t}get processorContext(){return this._processorContext||(this._processorContext=this.initProcessor().processorContext),this._processorContext}get processorDestination(){return this._processorDestination||(this._processorDestination=this.initProcessor().processorDestination),this._processorDestination}get isPlaying(){return this._useAudioElement?ua.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"LocalAudioTrack"}constructor(t,r,s,a){super(t,s),Pe(this,"trackMediaType",qv.AUDIO),Pe(this,"_encoderConfig",void 0),Pe(this,"_trackSource",void 0),Pe(this,"metadata",[]),Pe(this,"_enabled",!0),Pe(this,"_volume",100),Pe(this,"_useAudioElement",!0),Pe(this,"_bypassWebAudio",!1),Pe(this,"processor",void 0),Pe(this,"_processorContext",void 0),Pe(this,"_processorDestination",void 0),Pe(this,"_getOriginVolumeLevel",void 0),this._encoderConfig=r,this._getOriginVolumeLevel=!!a,this._trackSource=new zL,oe("DISABLE_WEBAUDIO")&&(this._bypassWebAudio=!0),oe("LOCAL_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1),Ps()&&!Xc?setTimeout(()=>this.initWebAudio()):this.initWebAudio()}setVolume(t){ir(t,"volume",0,1e3),this._volume=t,this._source.setVolume(t/100),this._useAudioElement&&ua.setVolume(this.getTrackId(),t);try{if(this._bypassWebAudio)return void x.debug("[".concat(this.getTrackId(),"] setVolume returned because no pass through WebAudio."));const r=this._source.createOutputTrack();this._mediaStreamTrack!==r&&(this._mediaStreamTrack=r,ur(this,St.NEED_REPLACE_TRACK,this).then(()=>{x.debug("[".concat(this.getTrackId(),"] replace web audio track success"))}).catch(s=>{x.warning("[".concat(this.getTrackId(),"] replace web audio track failed"),s)}))}catch{}}getVolumeLevel(){return this._muted&&this.enabled&&this._getOriginVolumeLevel?this._source.getOriginVolumeLevel():this._source.getAccurateVolumeLevel()}async setPlaybackDevice(t){if(!this._useAudioElement||!uz())throw new Le(te.NOT_SUPPORTED,"your browser does not support setting the audio output device");await ua.setSinkID(this.getTrackId(),t)}async setEnabled(t,r,s){return this._setEnabled(t,r,s)}async _setEnabled(t,r,s){if(!s){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(x.info("[".concat(this.getTrackId(),"] start setEnabled"),t),t){this._originMediaStreamTrack.enabled=!0;try{s||(this._enabled=!0),await ur(this,St.NEED_ENABLE_TRACK,this),x.info("[".concat(this.getTrackId(),"] setEnabled to ").concat(t," success"))}catch(a){throw s||(this._enabled=!1),x.error("[".concat(this.getTrackId(),"] setEnabled to true error"),a.toString()),a}}else{this._originMediaStreamTrack.enabled=!1,s||(this._enabled=!1);try{await ur(this,St.NEED_DISABLE_TRACK,this)}catch(a){throw s||(this._enabled=!0),x.error("[".concat(this.getTrackId(),"] setEnabled to false error"),a.toString()),a}}}async setMuted(t){t!==this._muted&&(this.stateCheck("muted",t),this._muted=t,this._originMediaStreamTrack.enabled=!t,x.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(t)),t?await ur(this,St.NEED_MUTE_TRACK,this):await ur(this,St.NEED_UNMUTE_TRACK,this))}getStats(){return Fm(()=>{x.warning("[deprecated] LocalAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalAudioStats instead")},"localAudioTrackGetStatsWarning"),Hc(this,St.GET_STATS)||Dr({},ML)}setAudioFrameCallback(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!t)return this._source.removeAllListeners(qc.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(r),this._source.removeAllListeners(qc.ON_AUDIO_BUFFER),this._source.on(qc.ON_AUDIO_BUFFER,s=>t(s))}play(){x.debug("[".concat(this.getTrackId(),"] start audio playback")),this._useAudioElement?(x.debug("[".concat(this.getTrackId(),"] start audio playback in element")),ua.play(this._mediaStreamTrack,this.getTrackId(),this._volume)):this._source.play()}stop(){x.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._useAudioElement?ua.stop(this.getTrackId()):this._source.stop()}close(){super.close(),this._processorDestination&&this.unbindProcessorDestinationEvents(this._processorDestination),this._processorContext&&this.unbindProcessorContextEvents(this._processorContext),this.unpipe(),this._processorDestination&&this._processorDestination._source&&this._processorDestination._source.unpipe(),this._source.destroy()}_updatePlayerSource(){let t=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];x.debug("[".concat(this.getTrackId(),"] update player source track")),t&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&ua.updateTrack(this.getTrackId(),this._mediaStreamTrack)}async _updateOriginMediaStreamTrack(t,r){this._originMediaStreamTrack!==t&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),r&&this._originMediaStreamTrack.stop()),t.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=t,this._muted&&(this._originMediaStreamTrack.enabled=!1),this.processor&&this._processorContext&&this.processor.updateInput({track:t,context:this._processorContext}),this._mediaStreamTrack!==this._source.outputTrack?(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await ur(this,St.NEED_REPLACE_TRACK,this)):this._source.updateTrack(this._originMediaStreamTrack),this._getOriginVolumeLevel&&this._source.updateOriginTrack(t))}renewMediaStreamTrack(t){return dt.resolve(void 0)}pipe(t){if(this._bypassWebAudio)throw new Le(te.INVALID_OPERATION,"Can not process AudioTrack when bypassWebAudio set to true.");if(this.processor===t)return t;if(t._source)throw new Le(te.INVALID_OPERATION,"Processor ".concat(t.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=t,this.processor._source=this,t.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),t}unpipe(){var t;if(!this.processor)return;const r=this.processor;(t=this._source.processSourceNode)===null||t===void 0||t.disconnect(),this.processor._source=!1,this.processor=void 0,r.reset()}bindProcessorDestinationEvents(t){t.on(Mo.ON_TRACK,async r=>{r?r!==this._mediaStreamTrack&&(this._mediaStreamTrack=r,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(r),await ur(this,St.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await ur(this,St.NEED_REPLACE_TRACK,this))}),t.on(Mo.ON_NODE,r=>{this._source.processedNode=r})}unbindProcessorDestinationEvents(t){t.removeAllListeners(Mo.ON_TRACK),t.removeAllListeners(Mo.ON_NODE)}bindProcessorContextEvents(t){t.on(Yc.REQUEST_CONSTRAINTS,async r=>{r(this._originMediaStreamTrack.getSettings())})}unbindProcessorContextEvents(t){t.removeAllListeners(Yc.REQUEST_CONSTRAINTS)}initWebAudio(){return this._trackSource instanceof zL&&(this._trackSource=new vz(this._mediaStreamTrack,!1,this._getOriginVolumeLevel?this._mediaStreamTrack:void 0)),this._trackSource}initProcessor(){const t=new Oz(this._source.context,this.getTrackId(),"local"),r=new Pz(t);return this._processorContext=t,this._processorDestination=r,this.bindProcessorContextEvents(t),this.bindProcessorDestinationEvents(r),this._source.on(qc.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:t})}),this._useAudioElement&&(this._useAudioElement=!1,this.isPlaying&&(ua.stop(this.getTrackId()),this._source.play()),ur(this,St.NEED_REPLACE_MIXING_TRACK,this).then(()=>{x.debug("[".concat(this.getTrackId(),"] replace from origin track to web audio track success"))}).catch(s=>{x.warning("[".concat(this.getTrackId(),"] replace from origin track to web audio track failed"),s)})),{processorContext:t,processorDestination:r}}}).prototype,"setVolume",[Mz],Object.getOwnPropertyDescriptor(Vr.prototype,"setVolume"),Vr.prototype),xn(Vr.prototype,"setPlaybackDevice",[Uz,Vz],Object.getOwnPropertyDescriptor(Vr.prototype,"setPlaybackDevice"),Vr.prototype),xn(Vr.prototype,"setEnabled",[Fz,jz,Bz],Object.getOwnPropertyDescriptor(Vr.prototype,"setEnabled"),Vr.prototype),xn(Vr.prototype,"setMuted",[Wz,zz,Gz],Object.getOwnPropertyDescriptor(Vr.prototype,"setMuted"),Vr.prototype),xn(Vr.prototype,"getStats",[Hz],Object.getOwnPropertyDescriptor(Vr.prototype,"getStats"),Vr.prototype),xn(Vr.prototype,"setAudioFrameCallback",[$z],Object.getOwnPropertyDescriptor(Vr.prototype,"setAudioFrameCallback"),Vr.prototype),xn(Vr.prototype,"play",[Kz,qz],Object.getOwnPropertyDescriptor(Vr.prototype,"play"),Vr.prototype),xn(Vr.prototype,"stop",[Yz,Xz],Object.getOwnPropertyDescriptor(Vr.prototype,"stop"),Vr.prototype),xn(Vr.prototype,"close",[Jz],Object.getOwnPropertyDescriptor(Vr.prototype,"close"),Vr.prototype),xn(Vr.prototype,"pipe",[Qz],Object.getOwnPropertyDescriptor(Vr.prototype,"pipe"),Vr.prototype),xn(Vr.prototype,"unpipe",[Zz],Object.getOwnPropertyDescriptor(Vr.prototype,"unpipe"),Vr.prototype),Vr),cP=(eG=Ft({argsMap:(t,r)=>[t.getTrackId(),r]}),tG=ci(),nG=jv("MicrophoneAudioTrack","_enabledMutex"),rG=Ft({argsMap:(t,r,s)=>[t.getTrackId(),r,s]}),iG=ci(),sG=Ft({argsMap:t=>[t.getTrackId()]}),xn((wh=class extends Yr{get __className__(){return"MicrophoneAudioTrack"}constructor(t,r,s,a){super(t,r.encoderConfig?iP(r.encoderConfig):{},a,oe("GET_VOLUME_OF_MUTED_AUDIO_TRACK")),Pe(this,"_config",void 0),Pe(this,"_deviceName","default"),Pe(this,"_constraints",void 0),Pe(this,"_originalConstraints",void 0),Pe(this,"_enabled",!0),this._config=r,this._constraints=s,this._originalConstraints=s,this._deviceName=t.label,typeof r.bypassWebAudio=="boolean"&&(this._bypassWebAudio=r.bypassWebAudio),(Uv()||dL())&&nr.bindInterruptDetectorTrack(this)}async setDevice(t){if(x.info("[".concat(this.getTrackId(),"] start set device to ").concat(t)),this._enabled)try{const r=await Qc.getDeviceById(t),s={};s.audio=Dr({},this._constraints),s.audio.deviceId={exact:t},this._originMediaStreamTrack.stop();let a=null;try{a=await Jc(s,this.getTrackId())}catch(c){throw x.error("[".concat(this.getTrackId(),"] setDevice failed"),c.toString()),a=await Jc({audio:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(a.getAudioTracks()[0],!1),c}await this._updateOriginMediaStreamTrack(a.getAudioTracks()[0],!1),this._deviceName=r.label,this._config.microphoneId=t,this._constraints.deviceId={exact:t}}catch(r){throw x.error("[".concat(this.getTrackId(),"] setDevice error"),r.toString()),r}else try{const r=await Qc.getDeviceById(t);this._deviceName=r.label,this._config.microphoneId=t,this._constraints.deviceId={exact:t}}catch(r){throw x.error("[".concat(this.getTrackId(),"] setDevice error"),r.toString()),r}x.info("[".concat(this.getTrackId(),"] set device to ").concat(t," success"))}async setEnabled(t,r,s){if(r)return x.debug("[".concat(this.getTrackId(),"] setEnabled false (do not close microphone)")),await super._setEnabled(t);if(!s){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(x.info("[".concat(this.getTrackId(),"] start setEnabled"),t),oe("AUTO_RESET_AUDIO_ROUTE")&&(Lo()||gu())){const h=navigator.audioSession;h&&(t||(h.type="playback"),h.type="auto")}if(!t){var a;this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop(),(a=this._source.clonedTrack)===null||a===void 0||a.stop(),s||(this._enabled=!1);try{await ur(this,St.NEED_DISABLE_TRACK,this)}catch(h){throw x.error("[".concat(this.getTrackId(),"] setEnabled false failed"),h.toString()),h}return}const c=Dr({},this._constraints),u=Qc.searchDeviceIdByName(this._deviceName);u&&!c.deviceId&&(c.deviceId=u);try{s||(this._enabled=!0);const h=await Jc({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(h.getAudioTracks()[0],!1),await ur(this,St.NEED_ENABLE_TRACK,this)}catch(h){throw s||(this._enabled=!1),x.error("[".concat(this.getTrackId(),"] setEnabled true failed"),h.toString()),h}x.info("[".concat(this.getTrackId(),"] setEnabled success"))}close(){super.close(),(Uv()||dL())&&nr.unbindInterruptDetectorTrack(this)}onTrackEnded(){if((Lo()||gu())&&this._enabled&&!this._isClosed&&nr.duringInterruption){const t=async()=>{nr.off(gs.IOS_INTERRUPTION_END,t),this._enabled&&!this._isClosed&&(x.debug("[".concat(this.getTrackId(),"] try capture microphone media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};nr.on(gs.IOS_INTERRUPTION_END,t)}else x.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit($v.TRACK_ENDED)}async renewMediaStreamTrack(t){const r=t||this._constraints,s=Qc.searchDeviceIdByName(this._deviceName);if(s&&!r.deviceId&&(r.deviceId=s),this._constraints=r,this._enabled){this._originMediaStreamTrack.stop();const a=await Jc({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(a.getAudioTracks()[0],!0)}}bindProcessorContextEvents(t){super.bindProcessorContextEvents(t),t.on(Yc.REQUEST_UPDATE_CONSTRAINTS,async(r,s,a)=>{try{const c=Object.assign({},this._originalConstraints,...r);await this.renewMediaStreamTrack(c),s()}catch(c){a(c)}})}unbindProcessorContextEvents(t){super.unbindProcessorContextEvents(t),t.removeAllListeners(Yc.REQUEST_UPDATE_CONSTRAINTS)}}).prototype,"setDevice",[eG,tG],Object.getOwnPropertyDescriptor(wh.prototype,"setDevice"),wh.prototype),xn(wh.prototype,"setEnabled",[nG,rG,iG],Object.getOwnPropertyDescriptor(wh.prototype,"setEnabled"),wh.prototype),xn(wh.prototype,"close",[sG],Object.getOwnPropertyDescriptor(wh.prototype,"close"),wh.prototype),wh),Rme=(oG=Ft({argsMap:(t,r)=>[t.getTrackId(),r,t.duration]}),aG=ci(),cG=Ft({argsMap:t=>[t.getTrackId()]}),lG=ci(),uG=Ft({argsMap:t=>[t.getTrackId()]}),dG=ci(),hG=Ft({argsMap:t=>[t.getTrackId()]}),fG=ci(),pG=Ft({argsMap:t=>[t.getTrackId()]}),mG=ci(),gG=Ft({argsMap:t=>[t.getTrackId()]}),_G=Ft({argsMap:t=>[t.getTrackId()]}),yG=ci(),xn((Ds=class extends Yr{get __className__(){return"BufferSourceAudioTrack"}constructor(t,r,s,a){super(r.createOutputTrack(),s,a),Pe(this,"source",void 0),Pe(this,"_bufferSource",void 0),this._useAudioElement=!1,this.source=t,this._bufferSource=r,this._bufferSource.on(qc.AUDIO_SOURCE_STATE_CHANGE,c=>{this.safeEmit($v.SOURCE_STATE_CHANGE,c)});try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}}get currentState(){return this._bufferSource.currentState}get duration(){return this._bufferSource.duration}get playbackSpeed(){return this._bufferSource.playbackSpeed}getCurrentTime(){return this._bufferSource.currentTime}startProcessAudioBuffer(t){t&&this._bufferSource.updateOptions(t),this._bufferSource.startProcessAudioBuffer()}pauseProcessAudioBuffer(){this._bufferSource.pauseProcessAudioBuffer()}seekAudioBuffer(t){this._bufferSource.seekAudioBuffer(t)}resumeProcessAudioBuffer(){this._bufferSource.resumeProcessAudioBuffer()}stopProcessAudioBuffer(){this._bufferSource.stopProcessAudioBuffer()}close(){this.source=null,this._bufferSource.destroy(),super.close()}setAudioBufferPlaybackSpeed(t){ir(t,"speed",0),this._bufferSource.setAudioBufferPlaybackSpeed(t)}}).prototype,"startProcessAudioBuffer",[oG,aG],Object.getOwnPropertyDescriptor(Ds.prototype,"startProcessAudioBuffer"),Ds.prototype),xn(Ds.prototype,"pauseProcessAudioBuffer",[cG,lG],Object.getOwnPropertyDescriptor(Ds.prototype,"pauseProcessAudioBuffer"),Ds.prototype),xn(Ds.prototype,"seekAudioBuffer",[uG,dG],Object.getOwnPropertyDescriptor(Ds.prototype,"seekAudioBuffer"),Ds.prototype),xn(Ds.prototype,"resumeProcessAudioBuffer",[hG,fG],Object.getOwnPropertyDescriptor(Ds.prototype,"resumeProcessAudioBuffer"),Ds.prototype),xn(Ds.prototype,"stopProcessAudioBuffer",[pG,mG],Object.getOwnPropertyDescriptor(Ds.prototype,"stopProcessAudioBuffer"),Ds.prototype),xn(Ds.prototype,"close",[gG],Object.getOwnPropertyDescriptor(Ds.prototype,"close"),Ds.prototype),xn(Ds.prototype,"setAudioBufferPlaybackSpeed",[_G,yG],Object.getOwnPropertyDescriptor(Ds.prototype,"setAudioBufferPlaybackSpeed"),Ds.prototype),Ds);class Li extends Yr{get __className__(){return"MixingAudioTrack"}get isActive(){for(const r of this.trackList)if(r._enabled&&!r._isClosed&&!r.muted)return!0;return!1}constructor(){const r=Xv().createMediaStreamDestination();super(r.stream.getAudioTracks()[0],void 0,dr(8,"track-mix-")),Pe(this,"trackList",void 0),Pe(this,"destNode",void 0),this._useAudioElement=!1;try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}this.destNode=r,this.trackList=[]}hasAudioTrack(r){return this.trackList.indexOf(r)!==-1}addAudioTrack(r){this.trackList.indexOf(r)===-1?(x.debug("add ".concat(r.getTrackId()," to mixing track")),r._source.outputNode.connect(this.destNode),this.trackList.push(r),this.updateEncoderConfig()):x.debug("track ".concat(r.getTrackId()," is already added"))}removeAudioTrack(r){if(this.trackList.indexOf(r)!==-1){x.debug("remove ".concat(r.getTrackId()," from mixing track"));try{r._source.outputNode.disconnect(this.destNode)}catch{}qA(this.trackList,r),this.updateEncoderConfig()}}updateEncoderConfig(){const r={};this.trackList.forEach(s=>{s._encoderConfig&&((s._encoderConfig.bitrate||0)>(r.bitrate||0)&&(r.bitrate=s._encoderConfig.bitrate),(s._encoderConfig.sampleRate||0)>(r.sampleRate||0)&&(r.sampleRate=s._encoderConfig.sampleRate),(s._encoderConfig.sampleSize||0)>(r.sampleSize||0)&&(r.sampleSize=s._encoderConfig.sampleSize),s._encoderConfig.stereo&&(r.stereo=!0))}),this._encoderConfig=r}_updateRtpTransceiver(r){this._rtpTransceiver!==r&&(this._rtpTransceiver=r,this.trackList.forEach(s=>{s instanceof Li?s.emit(W_.TRANSCEIVER_UPDATED,r):s._updateRtpTransceiver(r)}))}}class Ime extends Ez{set currentState(r){r!==this._currentState&&(this._currentState=r,this.safeEmit(qc.AUDIO_SOURCE_STATE_CHANGE,this._currentState))}get currentState(){return this._currentState}constructor(r){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),Pe(this,"audioBuffer",void 0),Pe(this,"sourceNode",void 0),Pe(this,"startPlayTime",0),Pe(this,"startPlayOffset",0),Pe(this,"pausePlayTime",0),Pe(this,"options",void 0),Pe(this,"currentLoopCount",0),Pe(this,"currentPlaybackSpeed",100),Pe(this,"_currentState","stopped"),this.audioBuffer=r,this.options=s,this.startPlayOffset=this.options.startPlayTime||0}createWebAudioDiagram(){return this.context.createGain()}get duration(){return this.audioBuffer?this.audioBuffer.duration:0}get playbackSpeed(){return this.currentPlaybackSpeed}get currentTime(){return this.audioBuffer?this.currentState==="stopped"?0:this.currentState==="paused"?this.pausePlayTime:((this.context.currentTime-this.startPlayTime)*(this.playbackSpeed/100)+this.startPlayOffset)%this.audioBuffer.duration:0}updateOptions(r){this.currentState==="stopped"?(this.options=r,this.startPlayOffset=this.options.startPlayTime||0):x.warning("can not set audio source options")}startProcessAudioBuffer(){this.sourceNode&&this.stopProcessAudioBuffer(),this.sourceNode=this.createSourceNode(),this.startSourceNode(),this.currentState="playing"}pauseProcessAudioBuffer(){this.sourceNode&&this.currentState==="playing"&&(this.pausePlayTime=this.currentTime,this.sourceNode.onended=null,this.sourceNode.stop(),this.sourceNode.buffer=null,this.sourceNode=this.createSourceNode(),this.currentState="paused")}seekAudioBuffer(r){this.sourceNode&&(this.sourceNode.onended=null,this.currentState==="playing"&&this.sourceNode.stop(),this.sourceNode=this.createSourceNode(),this.currentState==="playing"?(this.startPlayOffset=r,this.startSourceNode()):this.currentState==="paused"&&(this.pausePlayTime=r))}resumeProcessAudioBuffer(){this.currentState==="paused"&&this.sourceNode&&(this.startPlayOffset=this.pausePlayTime,this.pausePlayTime=0,this.startSourceNode(),this.currentState="playing")}stopProcessAudioBuffer(){if(this.sourceNode){this.sourceNode.onended=null;try{this.sourceNode.stop()}catch{}this.reset()}}destroy(){this.audioBuffer=null,super.destroy()}setAudioBufferPlaybackSpeed(r){this.sourceNode&&(this.currentState==="playing"&&(this.startPlayOffset=this.currentTime,this.startPlayTime=this.context.currentTime),this.sourceNode.playbackRate.value=r/100),this.currentPlaybackSpeed=r}startSourceNode(){this.sourceNode&&this.sourceNode.buffer&&(this.sourceNode.start(0,this.startPlayOffset),this.startPlayTime=this.context.currentTime,this.sourceNode.onended=this.handleSourceNodeEnded.bind(this))}createSourceNode(){const r=this.context.createBufferSource();return r.buffer=this.audioBuffer,r.loop=!!this.options.loop,r.connect(this.outputNode),r.playbackRate.value=this.currentPlaybackSpeed/100,r}handleSourceNodeEnded(){if(this.currentLoopCount+=1,this.options.cycle&&this.options.cycle>this.currentLoopCount)return this.startPlayOffset=0,this.sourceNode=void 0,void this.startProcessAudioBuffer();this.reset()}reset(){this.startPlayOffset=this.options.startPlayTime||0,this.currentState="stopped",this.sourceNode&&(this.sourceNode.disconnect(),this.sourceNode=void 0),this.currentLoopCount=0}}const EG=new Map;class HL{get rendFrameRate(){if(this.renderStats&&this.renderStats.curTs!==this.renderStats.lastTs){const r=this.renderStats.curTs-this.renderStats.lastTs,s=(this.renderStats.renderNum-this.renderStats.lastRenderNum)/r;return this.renderStats.lastRenderNum=this.renderStats.renderNum,this.renderStats.lastTs=this.renderStats.curTs,s}return 0}get videoElementStatus(){return this._videoElementStatus}set videoElementStatus(r){r!==this._videoElementStatus&&(x.debug("[".concat(this.trackId,"] video-element-status change ").concat(this._videoElementStatus," => ").concat(r)),this._videoElementStatus=r)}get videoState(){return this._videoState}set videoState(r){var s;r!==this._videoState&&(this._videoState=r,(s=this.onVideoStateChanged)===null||s===void 0||s.call(this,this.videoState))}constructor(r){Pe(this,"trackId",void 0),Pe(this,"config",void 0),Pe(this,"onFirstVideoFrameDecoded",void 0),Pe(this,"onVideoStateChanged",void 0),Pe(this,"freezeTimeCounterList",[]),Pe(this,"renderFreezeAccTime",0),Pe(this,"isKeepLastFrame",!1),Pe(this,"timeUpdatedCount",0),Pe(this,"freezeTime",0),Pe(this,"playbackTime",0),Pe(this,"lastTimeUpdatedTime",0),Pe(this,"autoplayFailed",!1),Pe(this,"videoTrack",void 0),Pe(this,"videoElement",void 0),Pe(this,"cacheVideoElement",void 0),Pe(this,"renderStats",void 0),Pe(this,"_videoState",Th.VideoStateStopped),Pe(this,"videoElementCheckInterval",void 0),Pe(this,"videoElementFreezeTimeout",void 0),Pe(this,"_videoElementStatus",mo.NONE),Pe(this,"isGettingVideoDimensions",!1),Pe(this,"startGetVideoDimensions",()=>{const s=()=>{if(this.isGettingVideoDimensions=!0,this.videoElement.videoWidth*this.videoElement.videoHeight>4)return x.debug("[".concat(this.trackId,"] current video dimensions:"),this.videoElement.videoWidth,this.videoElement.videoHeight),void(this.isGettingVideoDimensions=!1);setTimeout(s,500)};!this.isGettingVideoDimensions&&s()}),Pe(this,"autoResumeAfterInterruption",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&nr.curState==="running"&&(x.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(v8())),I8()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),Pe(this,"handleVideoEvents",s=>{switch(s.type){case"play":case"playing":this.startGetVideoDimensions(),this.videoElementStatus=mo.PLAYING;break;case"loadeddata":if(this.videoState=Th.VideoStateStarting,this.onFirstVideoFrameDecoded&&this.onFirstVideoFrameDecoded(),this.cacheVideoElement){try{this.cacheVideoElement.srcObject=null,this.cacheVideoElement.remove()}catch{}this.cacheVideoElement=void 0}break;case"canplay":this.videoElementStatus=mo.CANPLAY;break;case"stalled":this.videoElementStatus=mo.STALLED;break;case"suspend":this.videoElementStatus=mo.SUSPEND;break;case"pause":this.videoElementStatus=mo.PAUSED,Lo()||gu()||Ps()&&this.autoplayFailed||!this.videoTrack||this.videoTrack.readyState!=="live"||(x.debug("[track-".concat(this.trackId,"] video element paused, auto resume")),this.videoElement.play());break;case"waiting":this.videoElementStatus=mo.WAITING;break;case"abort":this.videoElementStatus=mo.ABORT;break;case"ended":this.videoElementStatus=mo.ENDED;break;case"emptied":this.videoElementStatus=mo.EMPTIED;break;case"error":{const a=this.videoElement.error;a&&(this.videoElementStatus=mo.ERROR,x.error("[".concat(this.trackId,"] media error: ").concat(a.message," (").concat(a.code,")")));break}case"timeupdate":{const a=performance.now();if(this.timeUpdatedCount+=1,this.timeUpdatedCount<10)return void(this.lastTimeUpdatedTime=a);const c=a-this.lastTimeUpdatedTime,u=this.lastTimeUpdatedTime;if(this.lastTimeUpdatedTime=a,sp.lastVisibleTime<sp.lastHiddenTime||u<sp.lastHiddenTime||u<sp.lastVisibleTime)return;for(c>oe("VIDEO_FREEZE_DURATION")&&(this.freezeTime+=c),this.playbackTime+=c;this.playbackTime>=6e3;){this.playbackTime-=6e3;const h=Math.min(6e3,this.freezeTime);this.freezeTimeCounterList.push(h),this.freezeTime=Math.max(0,this.freezeTime-6e3)}break}}}),Pe(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&(x.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(v8())),I8()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),this.trackId=r.trackId,this.config=r,r.element instanceof HTMLVideoElement?this.videoElement=r.element:this.videoElement=document.createElement("video"),nr.on(gs.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),nr.on(gs.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16)}getVideoElement(){return this.videoElement}getContainerElement(){var r;return(r=this.videoElement.parentElement)!==null&&r!==void 0?r:void 0}updateConfig(r){this.config=r,this.trackId=r.trackId,r.element!==this.videoElement&&(this.destroy(),this.videoElement=r.element),this.videoTrack&&this.initVideoElement()}updateVideoTrack(r){this.videoTrack!==r&&(this.videoTrack=r,this.initVideoElement())}play(r){const s=this.videoElement.play();s&&s.catch&&s.catch(c=>{r&&Rz(r,"video",c.message,this.trackId),c.name==="NotAllowedError"?(x.warning("detected video element autoplay failed",c),this.autoplayFailed=!0,this.handleAutoPlayFailed()):x.warning("[".concat(this.trackId,"] play warning: "),c)});const a=Nn();if((a.name==="Safari"&&Number(a.version)===15||Uv())&&s&&s.then){const c=()=>{this.config.mirror&&(this.videoElement.style.transform="rotateY(180deg)")};s.then(c).catch(c)}}getCurrentFrame(){const r=document.createElement("canvas");r.width=this.videoElement.videoWidth,r.height=this.videoElement.videoHeight;const s=r.getContext("2d");if(!s)return x.error("create canvas context failed!"),new ImageData(2,2);s.drawImage(this.videoElement,0,0,r.width,r.height);const a=s.getImageData(0,0,r.width,r.height);return r.remove(),a}async getCurrentFrameToUint8Array(r){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;const a=document.createElement("canvas");a.width=this.videoElement.videoWidth,a.height=this.videoElement.videoHeight;const c=a.getContext("2d");return c?(c.drawImage(this.videoElement,0,0,a.width,a.height),new dt((u,h)=>{a.toBlob(async m=>{if(a.remove(),m){const y=await Lz(m);u({buffer:y,width:a.width,height:a.height})}else h(new Le(te.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},r,s<0?.1:s>1?1:s)})):await GL(r)}destroy(){this.renderStats=void 0,nr.off(gs.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),nr.off(gs.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),this.videoElement.srcObject=null,this.resetVideoElement(),this.freezeTimeCounterList=[],this.videoState=Th.VideoStateStopped}initVideoElement(){if(this.videoElementStatus=mo.INIT,!this.videoElementCheckInterval&&(vG.forEach(u=>{this.videoElement.addEventListener(u,this.handleVideoEvents)}),this.videoElementCheckInterval=window.setInterval(()=>{(function(u){return u!==document.body&&document.body.contains(u)})(this.videoElement)||(this.videoElementStatus=mo.DESTROYED)},1e3),oe("ENABLE_VIDEO_FRAME_CALLBACK"))){var r,s;let u;const h=()=>{document.visibilityState==="visible"&&(document.removeEventListener("visibilitychange",h),this.videoElementFreezeTimeout=window.setTimeout(m,oe("VIDEO_FREEZE_DURATION")))},m=()=>{this.videoElementFreezeTimeout=void 0,this.videoState===Th.VideoStateDecoding&&(document.visibilityState==="visible"?this.videoState=Th.VideoStateFrozen:document.addEventListener("visibilitychange",h))},y=(v,S)=>{if(this.videoElementStatus===mo.PLAYING){if(this.renderStats?(this.renderStats.renderNum++,this.renderStats.curTs=S.mediaTime):this.renderStats={lastTs:S.mediaTime,curTs:S.mediaTime,lastRenderNum:0,renderNum:0},u){const N=S.presentationTime-u.presentationTime;this.videoState===Th.VideoStateStarting&&(this.videoState=Th.VideoStateDecoding),this.videoState===Th.VideoStateDecoding&&this.onVideoStateChanged&&(this.videoElementFreezeTimeout&&window.clearTimeout(this.videoElementFreezeTimeout),this.videoElementFreezeTimeout=window.setTimeout(m,oe("VIDEO_FREEZE_DURATION"))),N<oe("VIDEO_FREEZE_DURATION")&&this.videoState===Th.VideoStateFrozen&&(this.videoState=Th.VideoStateDecoding),N>oe("VIDEO_FREEZE_DURATION")&&sp.lastVisibleTime>=sp.lastHiddenTime&&u.timestamp>sp.lastVisibleTime&&u.timestamp>sp.lastHiddenTime&&(this.renderFreezeAccTime+=N)}u=Dr(Dr({},S),{},{timestamp:v})}var R,P;oe("ENABLE_VIDEO_FRAME_CALLBACK")&&((R=(P=this.videoElement).requestVideoFrameCallback)===null||R===void 0||R.call(P,y))};(r=(s=this.videoElement).requestVideoFrameCallback)===null||r===void 0||r.call(s,y)}this.videoElement.controls=!1,this.videoElement.setAttribute("playsinline",""),KA()&&!oe("HIDE_NO_POSTER")&&(this.videoElement.poster="noposter");const a=Nn();a.name==="Safari"&&Number(a.version)===15||Uv()||!this.config.mirror||(this.videoElement.style.transform="rotateY(180deg)"),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover",this.videoElement.setAttribute("muted",""),this.videoElement.muted=!0,this.videoElement.srcObject&&this.videoElement.srcObject instanceof MediaStream?this.videoElement.srcObject.getVideoTracks()[0]!==this.videoTrack&&(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,Br()&&this.videoElement.load()):(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,Br()&&this.videoElement.load());const c=this.videoElement.play();c!==void 0&&c.catch(u=>{x.debug("[".concat(this.trackId,"] playback interrupted"),u.toString())})}resetVideoElement(){vG.forEach(r=>{this.videoElement&&this.videoElement.removeEventListener(r,this.handleVideoEvents)}),this.videoElementCheckInterval&&(window.clearInterval(this.videoElementCheckInterval),this.videoElementCheckInterval=void 0),this.videoElementStatus=mo.NONE}handleAutoPlayFailed(){const r=s=>{s.preventDefault(),this.videoElement.play().then(()=>{x.debug("[".concat(this.trackId,"] Video element for trackId:").concat(this.trackId," autoplay resumed."))}).catch(a=>{x.error(a)}),this.autoplayFailed=!1,TT()?document.body.removeEventListener("click",r,!0):(document.body.removeEventListener("touchstart",r,!0),document.body.removeEventListener("mousedown",r,!0))};TT()?document.body.addEventListener("click",r,!0):(document.body.addEventListener("touchstart",r,!0),document.body.addEventListener("mousedown",r,!0)),Cz()}}const vG=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","timeupdate","error"];class SG extends HL{constructor(r){super(r),Pe(this,"container",void 0),Pe(this,"slot",void 0),this.slot=r.element,this.updateConfig(r)}updateConfig(r){this.config=r,this.trackId=r.trackId;const s=r.element;s!==this.slot&&(this.destroy(),this.slot=s),this.createElements()}updateVideoTrack(r){this.videoTrack!==r&&(this.videoTrack=r,this.createElements())}play(r){var s;(s=this.container)!==null&&s!==void 0&&s.contains(this.videoElement)&&super.play(r)}getCurrentFrame(){var r;return(r=this.container)!==null&&r!==void 0&&r.contains(this.videoElement)?super.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameToUint8Array(r){var s;let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return(s=this.container)!==null&&s!==void 0&&s.contains(this.videoElement)?await super.getCurrentFrameToUint8Array(r,a):await GL(r)}destroy(){if(super.destroy(),this.videoElement.remove(),this.videoElement=document.createElement("video"),this.container){try{this.container.remove(),this.slot.removeChild(this.container)}catch{}this.container=void 0}}createElements(){this.container||(this.container=document.createElement("div")),this.container.id="agora-video-player-".concat(this.trackId),this.container.style.width="100%",this.container.style.height="100%",this.container.style.position="relative",this.container.style.overflow="hidden",this.videoTrack?(this.container.style.backgroundColor="black",oe("KEEP_LAST_FRAME")&&this.isKeepLastFrame&&this.videoElement.paused&&this.resetVideoElement(),this.mountedVideoElement()):this.unmountedVideoElement(),this.slot.appendChild(this.container)}mountedVideoElement(){var r;!this.container||(r=this.container)!==null&&r!==void 0&&r.contains(this.videoElement)||this.container.appendChild(this.videoElement),super.initVideoElement(),this.videoElement.id="video_".concat(this.trackId),this.videoElement.className="agora_video_player",this.videoElement.style.width="100%",this.videoElement.style.height="100%",this.videoElement.style.position="absolute",this.videoElement.style.left="0",this.videoElement.style.top="0"}unmountedVideoElement(){var r;if((r=this.container)!==null&&r!==void 0&&r.contains(this.videoElement)){super.resetVideoElement();try{this.container&&this.container.removeChild(this.videoElement)}catch{}this.videoElement=document.createElement("video")}}resetVideoElement(){var r;(r=this.container)!==null&&r!==void 0&&r.contains(this.videoElement)&&(super.resetVideoElement(),this.cacheVideoElement=this.videoElement,this.videoElement=document.createElement("video"))}getContainerElement(){return this.container}}var bG,TG,wG,CG,RG,IG,AG,PG,OG,kG,NG,DG,xG,LG,MG,UG,VG,FG,jG,BG,WG,zG,GG,HG,Cn,$G,KG,qG,YG,XG,JG,QG,ZG,el;let Sr=(bG=Ft({argsMap:(t,r,s)=>[t.getTrackId(),typeof r=="string"?r:r instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",s]}),TG=ci(),wG=Ft({argsMap:t=>[t.getTrackId()]}),CG=jv("LocalVideoTrack","_enabledMutex"),RG=Ft({argsMap:(t,r)=>[t.getTrackId(),r]}),IG=ci(),AG=jv("LocalVideoTrack","_enabledMutex"),PG=Ft({argsMap:(t,r)=>[t.getTrackId(),r]}),OG=ci(),kG=Ft({argsMap:(t,r)=>[t.getTrackId(),r]}),NG=ci(),DG=ci(),xG=Ft({argsMap:(t,r,s)=>[t.getTrackId(),r,s]}),LG=ci(),MG=ci(),UG=ci(),VG=ci(),FG=ci(),jG=ci(),BG=ci(),WG=Ft({argsMap:(t,r)=>[t.getTrackId(),r.name]}),zG=Ft({argsMap:t=>[t.getTrackId()]}),GG=Ft({argsMap:t=>[t.getTrackId()]}),HG=Ft({argsMap:(t,r,s)=>[t.getTrackId(),r.label,s]}),Cn=class cae extends Yv{get videoHeight(){if(Ps()){const{height:r}=this._mediaStreamTrack.getSettings();return this._videoHeight=r,this._videoHeight}return this._videoHeight}get videoWidth(){if(Ps()){const{width:r}=this._mediaStreamTrack.getSettings();return this._videoWidth=r,this._videoWidth}return this._videoWidth}get isPlaying(){return!(!this._player||this._player.videoElementStatus!==mo.PLAYING)}get processorDestination(){return this._processorDestination}get processorContext(){return this._processorContext}set processorContext(r){this._processorContext=r}get __className__(){return"LocalVideoTrack"}constructor(r,s,a,c,u,h){if(super(r,u),Pe(this,"trackMediaType",qv.VIDEO),Pe(this,"_player",void 0),Pe(this,"isUseScaleResolutionDownBy",!1),Pe(this,"_videoVisibleTimer",null),Pe(this,"_previousVideoVisibleStatus",void 0),Pe(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),Pe(this,"_encoderConfig",void 0),Pe(this,"_scalabilityMode",{numSpatialLayers:1,numTemporalLayers:1}),Pe(this,"_optimizationMode",void 0),Pe(this,"_videoHeight",void 0),Pe(this,"_videoWidth",void 0),Pe(this,"_forceBitrateLimit",void 0),Pe(this,"_enabled",!0),Pe(this,"_processorDestination",void 0),Pe(this,"_processorContext",void 0),Ps()){const{width:m,height:y}=r.getSettings();this._videoWidth=m,this._videoHeight=y}else this.updateMediaStreamTrackResolution();if(this._encoderConfig=s,this._scalabilityMode=a,this._optimizationMode=c,this._hints=h||[],this._hints.indexOf(hr.SCREEN_TRACK)===-1)this.updateBitrateFromProfile();else if(cL(zn.CHROME,115)&&HA().indexOf("Windows")!==-1){const m=function(y,v){if("VideoFrame"in window&&"TransformStream"in window&&Vn().supportWebRTCInsertableStream){const S=new MediaStreamTrackProcessor(y),R=new MediaStreamTrackGenerator({kind:"video"});let P,N,G=Date.now();const F=()=>{j&&(clearInterval(j),j=void 0),P&&(P.close(),P=void 0),y.stop(),N=void 0,R.removeEventListener("ended",F)};let j=window.setInterval(()=>{if(N&&P&&Date.now()-G>1e3)try{R.readyState==="live"?N.enqueue(P.clone()):F()}catch{F()}},1e3);const X=new TransformStream({transform:(ee,he)=>{R.readyState==="live"?(N=he,G=Date.now(),P===void 0?(P=ee,he.enqueue(ee.clone())):(he.enqueue(P),P=ee)):ee.close()}});return R.addEventListener("ended",F),S.readable.pipeThrough(X).pipeTo(R.writable),R}}(r);m&&(x.info("local screen video track begin to inject frame"),this._mediaStreamTrack=m)}s&&this._hints.indexOf(hr.CUSTOM_TRACK)!==-1&&this.setEncoderConfiguration(s),this._processorContext=new Az(this.getTrackId(),"local"),this._processorDestination=new Iz(this.processorContext),this.bindProcessorDestinationEvents()}play(r){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof r=="string"){const c=document.getElementById(r);c?r=c:(x.warning("[".concat(this.getTrackId(),'] can not find "#').concat(r,'" element, use document.body')),r=document.body)}x.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(r instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(s));const a=Dr(Dr(Dr({},this._getDefaultPlayerConfig()),s),{},{trackId:this.getTrackId(),element:r});this._player?this._player.updateConfig(a):(r instanceof HTMLVideoElement?this._player=new HL(a):this._player=new SG(a),this._player.updateVideoTrack(this._mediaStreamTrack)),this._player.play(),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const c=this.getVideoElementVisibleStatus();this.safeEmit($v.VIDEO_ELEMENT_VISIBLE_STATUS,c)}catch{}},oe("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,x.debug("[".concat(this.getTrackId(),"] stop video playback")))}async setEnabled(r,s){if(!s){if(r===this._enabled)return;this.stateCheck("enabled",r)}if(x.info("[".concat(this.getTrackId(),"] start setEnabled"),r),!r){this._originMediaStreamTrack.enabled=!1;try{await ur(this,St.NEED_DISABLE_TRACK,this)}catch(a){throw x.error("[".concat(this.getTrackId(),"] setEnabled to false error"),a.toString()),a}return s||(this._enabled=!1),void x.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}this._originMediaStreamTrack.enabled=!0;try{await ur(this,St.NEED_ENABLE_TRACK,this)}catch(a){throw x.error("[".concat(this.getTrackId(),"] setEnabled to true error"),a.toString()),a}x.info("[".concat(this.getTrackId(),"] setEnabled to true success")),s||(this._enabled=!0)}async setMuted(r){r!==this._muted&&(this.stateCheck("muted",r),this._muted=r,this._originMediaStreamTrack.enabled=!r,x.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(r)),r?await ur(this,St.NEED_MUTE_TRACK,this):await ur(this,St.NEED_UNMUTE_TRACK,this))}async setEncoderConfiguration(r,s){if(!this._enabled)throw new Le(te.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");if(r=bh(r),this._forceBitrateLimit&&(r.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:r.bitrateMax,r.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:r.bitrateMin),r.width||r.height||r.frameRate){const a=aP({encoderConfig:r});(Ps()||Lo()||gu())&&(a.deviceId=void 0),x.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(r),JSON.stringify(a));try{await this._originMediaStreamTrack.applyConstraints(a),this.updateMediaStreamTrackResolution()}catch(c){const u=new Le(te.UNEXPECTED_ERROR,c.toString());throw x.error("[".concat(this.getTrackId(),"] applyConstraints error"),u.toString()),u}}this._encoderConfig=r,this._hints.indexOf(hr.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await ur(this,St.NEED_UPDATE_VIDEO_ENCODER,this)}catch(a){return a.throw(x)}}getStats(){return Fm(()=>{x.warning("[deprecated] LocalVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalVideoStats instead")},"localVideoTrackGetStatsWarning"),Hc(this,St.GET_STATS)||Dr({},UL)}async setBeautyEffect(r){x.error("LocalVideoTrack.setBeautyEffect was deprecated, please migrate to agora-extension-beauty-effect")}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameImage(r){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return this._player?this._player.getCurrentFrameToUint8Array(r,s):await GL(r)}async setBitrateLimit(r){x.debug("[".concat(this.getTrackId(),"] set bitrate limit, ").concat(JSON.stringify(r))),r&&(this._forceBitrateLimit=r,this._encoderConfig&&(this._encoderConfig.bitrateMax?this._encoderConfig.bitrateMax=this._encoderConfig.bitrateMax<r.max_bitrate?this._encoderConfig.bitrateMax:r.max_bitrate:this._encoderConfig.bitrateMax=r.max_bitrate,this._encoderConfig.bitrateMin,this._encoderConfig.bitrateMin=r.min_bitrate))}async setOptimizationMode(r){if(r!=="motion"&&r!=="detail"&&r!=="balanced")return void x.error(te.INVALID_PARAMS,"optimization mode must be motion, detail or balanced");const s=this._optimizationMode;try{this._optimizationMode=r,await ur(this,St.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this)}catch(a){throw this._optimizationMode=s,x.error("[".concat(this.getTrackId(),"] set optimization mode failed"),a.toString()),a}x.info("[".concat(this.getTrackId(),"] set optimization mode success (").concat(r,")"))}setScalabiltyMode(r){if(r.numSpatialLayers===1&&r.numTemporalLayers!==1)return x.error(te.INVALID_PARAMS,"scalability mode currently not supported, no SVC."),void(this._scalabilityMode={numSpatialLayers:1,numTemporalLayers:1});this._scalabilityMode=r,x.info("[".concat(this.getTrackId(),"] set scalability mode success (").concat(r,")"))}updateMediaStreamTrackResolution(){kz(this._originMediaStreamTrack).then(r=>{let[s,a]=r;this._videoHeight=a,this._videoWidth=s}).catch(XA)}_updatePlayerSource(){this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}_getDefaultPlayerConfig(){return{fit:"contain"}}async setSenderConfiguration(r){if(!this._enabled)throw new Le(te.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");x.debug("[".concat(this.getTrackId(),"] setSenderConfiguration applyConstraints"),JSON.stringify(r)),r=bh(r),this._forceBitrateLimit&&(r.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:r.bitrateMax,r.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:r.bitrateMin),this._encoderConfig=r,this._hints.indexOf(hr.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await ur(this,St.NEED_UPDATE_VIDEO_ENCODER,this)}catch(s){return s.throw(x)}}updateBitrateFromProfile(){if(!this._encoderConfig)return;const{width:r,height:s,frameRate:a}=this.getMediaStreamTrackSettings();if(!r||!s||!a)return;const{bitrateMax:c,bitrateMin:u}=this._encoderConfig;if(u==null||c==null){const{max:h,min:m}=function(y,v,S,R,P){const N=oe("BITRATE_ADAPTER_TYPE");if(N==="DEFAULT_BITRATE")return{min:R,max:P};if(P===void 0){var G;const j=Math.floor(200*Math.pow(S/15,.6)*Math.pow(y*v/640/360,.75));P=N==="STANDARD_BITRATE"?4*j:2*j,R=(G=R)!==null&&G!==void 0?G:j}else{var F;R=(F=R)!==null&&F!==void 0?F:Math.floor(P/10)}return{min:R,max:P}}(r,s,a,u,c);this._encoderConfig.bitrateMin=m,this._encoderConfig.bitrateMax=h,x.debug("[".concat(this.getTrackId(),"] update bitrate from profile, [w: ").concat(r,", h: ").concat(s,", fps: ").concat(a,"] => [brMax: ").concat(h,", brMin: ").concat(m,"]"))}}getVideoElementVisibleStatus(){try{var r,s;const a=this==null||(r=this._player)===null||r===void 0?void 0:r.getContainerElement(),c={track:this,element:this==null||(s=this._player)===null||s===void 0?void 0:s.getVideoElement(),slot:a==null?void 0:a.parentElement},{element:u,slot:h}=c;if(this.isPlaying&&u instanceof HTMLVideoElement&&h instanceof HTMLElement){const m=N8.checkOneElementVisible(u),y=Object.assign({},m);if(y.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=y.visible;const v=It.reportApiInvoke(null,{tag:zr.TRACER,name:Ai.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});y.visible?v.onSuccess("Video is visible"):v.onSuccess("Invisible because of ".concat(y.reason))}return y}return}catch(a){throw new Le(te.GET_VIDEO_ELEMENT_VISIBLE_ERROR,a.message)}}async renewMediaStreamTrack(r){}pipe(r){if(this.processor===r)return r;if(r._source)throw new Le(te.INVALID_OPERATION,"Processor ".concat(r.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=r,this.processor._source=this,r.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),r}unpipe(){if(!this.processor)return;const r=this.processor;this.processor._source=void 0,this.processor=void 0,r.reset()}close(){super.close(),this.unbindProcessorDestinationEvents(),this.unbindProcessorContextEvents(),this.unpipe(),this.processorDestination._source&&this.processorDestination._source.unpipe()}clone(r){let s=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],a=this._encoderConfig;r&&(a=Dr(Dr({},a),bh(r))),a=V_(a);const c=dr(8,"track-video-cloned-"),u=new cae(s?this._mediaStreamTrack.clone():this._mediaStreamTrack,a,V_(this._scalabilityMode),this._optimizationMode,c,V_(this._hints));return r&&a&&u.setEncoderConfiguration(a),x.debug("clone video track from ".concat(this.getTrackId()," to ").concat(c,", clone ").concat(s)),u}async replaceTrack(r,s){if(!(r instanceof MediaStreamTrack))throw new Le(te.INVALID_PARAMS,"track should be an instance of MediaStreamTrack");if(r.kind!=="video")throw new Le(te.INVALID_PARAMS,"track should be a video MediaStreamTrack");await this._updateOriginMediaStreamTrack(r,s,!0),this.updateMediaStreamTrackResolution()}sendSeiData(r){if(Fm(()=>{It.reportApiInvoke(null,{name:Ai.LOCAL_VIDEO_SEND_SEI_DATA,options:[],tag:zr.TRACER}).onSuccess("")},this._mediaStreamTrack.id||this.getTrackId()),!oe("ENABLE_VIDEO_SEI")||!oe("ENABLE_ENCODED_TRANSFORM"))return void x.warning('To send/receive SEI, please call AgoraRTC.setParameter("ENABLE_VIDEO_SEI", true) before instantiate IAgoraRtcClient');if(r instanceof Uint8Array==0)return new Le(te.INVALID_PARAMS,"Invalid argument type, ILocalVideoTrack.sendSeiData() only accept Uint8Array argument.").throw();const s=this.getRTCRtpTransceiver();if(!s)return void x.warning("Video track is not published, SEI can not be send");const a=s.sender.getParameters();if(a.codecs.length===0)return;const c=a.codecs[0].mimeType.toLocaleLowerCase();c==="video/h264"?this.safeEmit("sei-to-send",r):x.warning("SEI is not supported by ".concat(c))}bindProcessorDestinationEvents(){this.processorDestination.on(Mo.ON_TRACK,async r=>{r?r!==this._mediaStreamTrack&&(this._mediaStreamTrack=r,this._updatePlayerSource(),await ur(this,St.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await ur(this,St.NEED_REPLACE_TRACK,this))})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(Mo.ON_TRACK)}unbindProcessorContextEvents(){this.processorContext.removeAllListeners(Yc.REQUEST_UPDATE_CONSTRAINTS),this.processorContext.removeAllListeners(Yc.REQUEST_CONSTRAINTS)}},xn(Cn.prototype,"play",[bG,TG],Object.getOwnPropertyDescriptor(Cn.prototype,"play"),Cn.prototype),xn(Cn.prototype,"stop",[wG],Object.getOwnPropertyDescriptor(Cn.prototype,"stop"),Cn.prototype),xn(Cn.prototype,"setEnabled",[CG,RG,IG],Object.getOwnPropertyDescriptor(Cn.prototype,"setEnabled"),Cn.prototype),xn(Cn.prototype,"setMuted",[AG,PG,OG],Object.getOwnPropertyDescriptor(Cn.prototype,"setMuted"),Cn.prototype),xn(Cn.prototype,"setEncoderConfiguration",[kG,NG],Object.getOwnPropertyDescriptor(Cn.prototype,"setEncoderConfiguration"),Cn.prototype),xn(Cn.prototype,"getStats",[DG],Object.getOwnPropertyDescriptor(Cn.prototype,"getStats"),Cn.prototype),xn(Cn.prototype,"setBeautyEffect",[xG,LG],Object.getOwnPropertyDescriptor(Cn.prototype,"setBeautyEffect"),Cn.prototype),xn(Cn.prototype,"getCurrentFrameData",[MG],Object.getOwnPropertyDescriptor(Cn.prototype,"getCurrentFrameData"),Cn.prototype),xn(Cn.prototype,"getCurrentFrameImage",[UG],Object.getOwnPropertyDescriptor(Cn.prototype,"getCurrentFrameImage"),Cn.prototype),xn(Cn.prototype,"setBitrateLimit",[VG],Object.getOwnPropertyDescriptor(Cn.prototype,"setBitrateLimit"),Cn.prototype),xn(Cn.prototype,"setOptimizationMode",[FG],Object.getOwnPropertyDescriptor(Cn.prototype,"setOptimizationMode"),Cn.prototype),xn(Cn.prototype,"setScalabiltyMode",[jG],Object.getOwnPropertyDescriptor(Cn.prototype,"setScalabiltyMode"),Cn.prototype),xn(Cn.prototype,"updateMediaStreamTrackResolution",[BG],Object.getOwnPropertyDescriptor(Cn.prototype,"updateMediaStreamTrackResolution"),Cn.prototype),xn(Cn.prototype,"pipe",[WG],Object.getOwnPropertyDescriptor(Cn.prototype,"pipe"),Cn.prototype),xn(Cn.prototype,"unpipe",[zG],Object.getOwnPropertyDescriptor(Cn.prototype,"unpipe"),Cn.prototype),xn(Cn.prototype,"close",[GG],Object.getOwnPropertyDescriptor(Cn.prototype,"close"),Cn.prototype),xn(Cn.prototype,"replaceTrack",[HG],Object.getOwnPropertyDescriptor(Cn.prototype,"replaceTrack"),Cn.prototype),Cn),$L=($G=Ft({argsMap:(t,r)=>[t.getTrackId(),r]}),KG=ci(),qG=jv("CameraVideoTrack","_enabledMutex"),YG=Ft({argsMap:(t,r)=>[t.getTrackId(),r]}),XG=ci(),JG=Ft({argsMap:(t,r)=>[t.getTrackId(),r]}),QG=ci(),ZG=Ft({argsMap:t=>[t.getTrackId()]}),el=class lae extends Sr{get __className__(){return"CameraVideoTrack"}constructor(r,s,a,c,u,h){super(r,bh(s.encoderConfig),c,u,h),Pe(this,"_config",void 0),Pe(this,"_originalConstraints",void 0),Pe(this,"_constraints",void 0),Pe(this,"_enabled",!0),Pe(this,"_deviceName","default"),Pe(this,"tryResumeVideoForIOS15_16WeChat",async()=>{(Uv()||dL())&&!function(){const m=Nn();if(m.os!==Yi.IOS||!m.osVersion)return!1;const y=m.osVersion.split(".");return Number(y[0])===15&&Number(y[1])>=2}()&&A8()&&this._enabled&&!this._isClosed&&(x.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS 15 device on WeChat.")),await this.renewMediaStreamTrack())}),this._config=s,this._originalConstraints=a,this._constraints=a,this._deviceName=r.label,this._encoderConfig=bh(this._config.encoderConfig),nr.on(gs.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),nr.on(gs.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),this.bindProcessorContextEvents()}async setDevice(r){return typeof r=="string"?this._setDeviceById(r):r.deviceId?this._setDeviceById(r.deviceId):r.facingMode?this._setDeviceByFacingModel(r.facingMode):void 0}async _setDeviceById(r){if(x.info("[".concat(this.getTrackId(),"] set device to ").concat(r)),this._enabled)try{const s=await Qc.getDeviceById(r),a={};a.video=Dr({},this._constraints),a.video.deviceId={exact:r},a.video.facingMode=void 0,this._originMediaStreamTrack.stop();let c=null;try{c=await Jc(a,this.getTrackId())}catch(u){throw x.error("[".concat(this.getTrackId(),"] setDevice failed"),u.toString()),c=await Jc({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(c.getVideoTracks()[0],!1),u}await this._updateOriginMediaStreamTrack(c.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution(),this._deviceName=s.label,this._config.cameraId=r,this._constraints.deviceId={exact:r}}catch(s){throw x.error("[".concat(this.getTrackId(),"] setDevice error"),s.toString()),s}else try{const s=await Qc.getDeviceById(r);this._deviceName=s.label,this._config.cameraId=r,this._constraints.deviceId={exact:r}}catch(s){throw x.error("[".concat(this.getTrackId(),"] setDevice error"),s.toString()),s}x.info("[".concat(this.getTrackId(),"] setDevice success"))}async _setDeviceByFacingModel(r){x.info("[".concat(this.getTrackId(),"] set facingMode ").concat(r));const s={video:Dr(Dr({},this._constraints),{},{deviceId:void 0,facingMode:{exact:r}})};if(this._enabled){this._originMediaStreamTrack.stop();let a=null;try{a=await Jc(s,this.getTrackId())}catch(c){throw x.error("[".concat(this.getTrackId(),"] setDeviceByFacingModel failed"),c.toString()),a=await Jc({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(a.getVideoTracks()[0],!1),c}await this._updateOriginMediaStreamTrack(a.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution()}this._deviceName="",this._config.facingMode=r,this._config.cameraId=void 0,this._constraints=Dr({},s.video),x.info("[".concat(this.getTrackId(),"] setDeviceByFacingModel success"))}async setEnabled(r,s){if(!s){if(r===this._enabled)return;this.stateCheck("enabled",r)}if(x.info("[".concat(this.getTrackId(),"] start setEnabled"),r),r){try{if(this.isExternalTrack)this._originMediaStreamTrack.enabled=!0;else{const a=await Jc({video:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(a.getVideoTracks()[0],!1)}await ur(this,St.NEED_ENABLE_TRACK,this)}catch(a){throw x.error("[".concat(this.getTrackId(),"] setEnabled true error"),a.toString()),a}this.updateMediaStreamTrackResolution(),x.info("[".concat(this.getTrackId(),"] setEnabled to true success")),s||(this._enabled=!0)}else{this.isExternalTrack?this._originMediaStreamTrack.enabled=!1:(this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop()),s||(this._enabled=!1);try{await ur(this,St.NEED_DISABLE_TRACK,this)}catch(a){throw x.error("[".concat(this.getTrackId(),"] setEnabled to false error"),a.toString()),a}x.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}}async setEncoderConfiguration(r,s){if(!this._enabled)throw new Le(te.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");r=bh(r),this._forceBitrateLimit&&(r.bitrateMax=this._forceBitrateLimit.max_bitrate||r.bitrateMax,r.bitrateMin=this._forceBitrateLimit.min_bitrate||r.bitrateMin);const a=Gr(this._config);a.encoderConfig=r;const c=aP(a);(Ps()||Lo()||gu())&&(c.deviceId=void 0),x.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(r),JSON.stringify(c));try{await this._originMediaStreamTrack.applyConstraints(c),this.updateMediaStreamTrackResolution()}catch(u){const h=new Le(te.UNEXPECTED_ERROR,u.toString());throw x.error("[".concat(this.getTrackId(),"] applyConstraints error"),h.toString()),h}this._config=a,this._constraints=c,this._originalConstraints=c,this._encoderConfig=r,this._hints.indexOf(hr.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await ur(this,St.NEED_UPDATE_VIDEO_ENCODER,this)}catch(u){return u.throw(x)}}_getDefaultPlayerConfig(){return{mirror:!0,fit:"cover"}}onTrackEnded(){if((Lo()||gu())&&this._enabled&&!this._isClosed&&nr.duringInterruption){const r=async()=>{nr.off(gs.IOS_INTERRUPTION_END,r),this._enabled&&!this._isClosed&&(x.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};nr.on(gs.IOS_INTERRUPTION_END,r)}else x.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit($v.TRACK_ENDED)}async renewMediaStreamTrack(r){const s=r||this._constraints,a=Qc.searchDeviceIdByName(this._deviceName);if(a&&!s.deviceId&&(s.deviceId={exact:a}),this._enabled){const c=await Jc({video:s},this.getTrackId());this._constraints=s,await this._updateOriginMediaStreamTrack(c.getVideoTracks()[0],!0),this.updateMediaStreamTrackResolution()}}close(){super.close(),nr.off(gs.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),nr.off(gs.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat)}clone(r){let s=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],a=this._encoderConfig;r&&(a=Dr(Dr({},a),bh(r))),a=V_(a);const c=dr(8,"track-cam-cloned-"),u=new lae(s?this._mediaStreamTrack.clone():this._mediaStreamTrack,V_(Dr(Dr({},this._config),{},{encoderConfig:a})),V_(this._constraints),V_(this._scalabilityMode),this._optimizationMode,c);return r&&a&&u.setEncoderConfiguration(a),x.debug("clone track from ".concat(this.getTrackId()," to ").concat(c,", clone ").concat(s)),u}bindProcessorContextEvents(){this.processorContext.on(Yc.REQUEST_UPDATE_CONSTRAINTS,async(r,s,a)=>{try{const c=Object.assign({},this._originalConstraints,...r);await this.renewMediaStreamTrack(c),s()}catch(c){a(c)}}),this.processorContext.on(Yc.REQUEST_CONSTRAINTS,async r=>{r(this._originMediaStreamTrack.getSettings())})}},xn(el.prototype,"setDevice",[$G,KG],Object.getOwnPropertyDescriptor(el.prototype,"setDevice"),el.prototype),xn(el.prototype,"setEnabled",[qG,YG,XG],Object.getOwnPropertyDescriptor(el.prototype,"setEnabled"),el.prototype),xn(el.prototype,"setEncoderConfiguration",[JG,QG],Object.getOwnPropertyDescriptor(el.prototype,"setEncoderConfiguration"),el.prototype),xn(el.prototype,"close",[ZG],Object.getOwnPropertyDescriptor(el.prototype,"close"),el.prototype),el);function KL(t,r,s,a){s.optimizationMode&&(a&&a.width&&a.height?(s.encoderConfig=Dr(Dr({},a),{},{bitrateMin:a.bitrateMin,bitrateMax:a.bitrateMax}),s.optimizationMode!=="motion"&&s.optimizationMode!=="detail"||(r.contentHint=s.optimizationMode,r.contentHint===s.optimizationMode?x.debug("[".concat(t,"] set content hint to"),s.optimizationMode):x.debug("[".concat(t,"] set content hint failed")))):x.warning("[".concat(t,"] can not apply optimization mode bitrate config, no encoderConfig")))}var eH,tH,nH,rH,Rl,iH,sH,oH,aH,cH,lH,go;class uH extends gz{getUserId(){return this._userId}constructor(r,s,a,c){super(r,"track-".concat(r.kind,"-").concat(s,"-").concat(c.clientId,"_").concat(dr(5,""))),Pe(this,"_userId",void 0),Pe(this,"_uintId",void 0),Pe(this,"_isDestroyed",!1),Pe(this,"store",void 0),Pe(this,"processor",void 0),Pe(this,"processorContext",void 0),this._userId=s,this._uintId=a,this.store=c}_updateOriginMediaStreamTrack(r){this._originMediaStreamTrack=r,this._mediaStreamTrack=r,this._updatePlayerSource(),this.processor&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this.processorContext})}_destroy(){this._isDestroyed=!0,x.info("[".concat(this.getTrackId(),"] is destroyed")),this.stop(),super.close()}getProcessorStats(){return this.processorContext.gatherStats()}getProcessorUsage(){return this.processorContext.gatherUsage()}}let Qv=(eH=Ft({argsMap:(t,r,s)=>[t.getTrackId(),typeof r=="string"?r:r instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",s]}),tH=Ft({argsMap:t=>[t.getTrackId()]}),nH=Ft({argsMap:(t,r)=>[t.getTrackId(),r.name]}),rH=Ft({argsMap:t=>[t.getTrackId()]}),xn((Rl=class extends uH{get isPlaying(){return!(!this._player||this._player.videoElementStatus!==mo.PLAYING)}get __className__(){return"RemoteVideoTrack"}constructor(t,r,s,a){super(t,r,s,a),Pe(this,"_videoVisibleTimer",null),Pe(this,"_previousVideoVisibleStatus",void 0),Pe(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),Pe(this,"trackMediaType",qv.VIDEO),Pe(this,"_videoWidth",void 0),Pe(this,"_videoHeight",void 0),Pe(this,"_player",void 0),Pe(this,"processorDestination",void 0),Pe(this,"processorContext",void 0),this.updateMediaStreamTrackResolution(),this.processorContext=new Az(this.getTrackId(),"remote"),this.processorDestination=new Iz(this.processorContext),this.bindProcessorDestinationEvents()}getStats(){return Fm(()=>{x.warning("[deprecated] RemoteVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteVideoStats instead")},"remoteVideoTrackGetStatsWarning"),Hc(this,St.GET_STATS)||Dr({},pz)}play(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof t=="string"){const a=document.getElementById(t);a?t=a:(x.warning("[".concat(this.getTrackId(),'] can not find "#').concat(t,'" element, use document.body')),t=document.body)}x.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(r));const s=Dr(Dr({fit:"cover"},r),{},{trackId:this.getTrackId(),element:t});this._player?this._player.updateConfig(s):(t instanceof HTMLVideoElement?this._player=new HL(s):this._player=new SG(s),this._player.updateVideoTrack(this._mediaStreamTrack),this._player.onFirstVideoFrameDecoded=()=>{this.store.subscribe(this.getUserId(),"video",void 0,void 0,Date.now()),this.safeEmit(Kv.FIRST_FRAME_DECODED)},this._player.onVideoStateChanged=a=>{this.safeEmit(Kv.VIDEO_STATE_CHANGED,a)}),this._player.play(this.store.sessionId||void 0),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const a=this.getVideoElementVisibleStatus();this.safeEmit(Kv.VIDEO_ELEMENT_VISIBLE_STATUS,a)}catch{}},oe("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,x.debug("[".concat(this.getTrackId(),"] stop video playback")))}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}updateMediaStreamTrackResolution(){kz(this._originMediaStreamTrack).then(t=>{let[r,s]=t;this._videoHeight=s,this._videoWidth=r}).catch(XA)}_updatePlayerSource(){x.debug("[".concat(this.getTrackId(),"] update player source track")),this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}getVideoElementVisibleStatus(){try{var t,r;const s=this==null||(t=this._player)===null||t===void 0?void 0:t.getContainerElement(),a={track:this,element:this==null||(r=this._player)===null||r===void 0?void 0:r.getVideoElement(),slot:s==null?void 0:s.parentElement},{element:c,slot:u}=a;if(this.isPlaying&&c instanceof HTMLVideoElement&&u instanceof HTMLElement){const h=N8.checkOneElementVisible(c),m=Object.assign({},h);if(m.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=m.visible;const y=It.reportApiInvoke(null,{tag:zr.TRACER,name:Ai.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});m.visible?y.onSuccess("Video is visible"):y.onSuccess("Invisible because of ".concat(m.reason))}return m}return}catch(s){throw new Le(te.GET_VIDEO_ELEMENT_VISIBLE_ERROR,s.message)}}pipe(t){if(this.processor===t)return t;if(t._source)throw new Le(te.INVALID_OPERATION,"Processor ".concat(t.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=t,this.processor._source=this,t.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),t}unpipe(){if(!this.processor)return;const t=this.processor;this.processor._source=void 0,this.processor=void 0,t.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(Mo.ON_TRACK,async t=>{t?t!==this._mediaStreamTrack&&(this._mediaStreamTrack=t,this._updatePlayerSource()):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(Mo.ON_TRACK)}_destroy(){super._destroy(),this.unbindProcessorDestinationEvents()}_onSei(t){this.emit(W_.SEI_RECEIVED,t)}}).prototype,"play",[eH],Object.getOwnPropertyDescriptor(Rl.prototype,"play"),Rl.prototype),xn(Rl.prototype,"stop",[tH],Object.getOwnPropertyDescriptor(Rl.prototype,"stop"),Rl.prototype),xn(Rl.prototype,"pipe",[nH],Object.getOwnPropertyDescriptor(Rl.prototype,"pipe"),Rl.prototype),xn(Rl.prototype,"unpipe",[rH],Object.getOwnPropertyDescriptor(Rl.prototype,"unpipe"),Rl.prototype),Rl),Zv=(iH=Ft({argsMap:(t,r)=>[t.getTrackId(),r],throttleTime:300}),sH=Ft({argsMap:(t,r)=>[t.getTrackId(),r]}),oH=Ft({argsMap:t=>[t.getTrackId()]}),aH=Ft({argsMap:t=>[t.getTrackId()]}),cH=Ft({argsMap:(t,r)=>[t.getTrackId(),r.name]}),lH=Ft({argsMap:t=>[t.getTrackId()]}),xn((go=class extends uH{get isPlaying(){return this._useAudioElement?ua.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"RemoteAudioTrack"}constructor(t,r,s,a){super(t,r,s,a),Pe(this,"trackMediaType",qv.AUDIO),Pe(this,"_source",void 0),Pe(this,"_useAudioElement",!0),Pe(this,"_volume",100),Pe(this,"processorContext",void 0),Pe(this,"processorDestination",void 0),Pe(this,"_played",!1),Pe(this,"_bypassWebAudio",!1),oe("DISABLE_WEBAUDIO")?(this._source=new zL,this._bypassWebAudio=!0,this._useAudioElement=!0):(this._source=new vz(t,!0),oe("REMOTE_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1)),this._source.once(qc.RECEIVE_TRACK_BUFFER,()=>{this.safeEmit(Kv.FIRST_FRAME_DECODED)}),this.processorContext=new Oz(this._source.context,this.getTrackId(),"remote"),this.processorDestination=new Pz(this.processorContext),this.bindProcessorDestinationEvents(),this._source.on(qc.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:this.processorContext})})}setAudioFrameCallback(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!t)return this._source.removeAllListeners(qc.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(r),this._source.removeAllListeners(qc.ON_AUDIO_BUFFER),this._source.on(qc.ON_AUDIO_BUFFER,s=>t(s))}setVolume(t){this._volume=t,this._useAudioElement?ua.setVolume(this.getTrackId(),t):this._source.setVolume(t/100)}async setPlaybackDevice(t){if(!this._useAudioElement||!uz())throw new Le(te.NOT_SUPPORTED,"your browser does not support setting the audio output device");await ua.setSinkID(this.getTrackId(),t)}getVolumeLevel(){return this._source.getAccurateVolumeLevel()}getStats(){return Fm(()=>{x.warning("[deprecated] RemoteAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteAudioStats instead")},"remoteAudioTrackGetStatsWarning"),Hc(this,St.GET_STATS)||Dr({},fz)}play(){x.debug("[".concat(this.getTrackId(),"] start audio playback")),this._played=!0,this._useAudioElement?(x.debug("[".concat(this.getTrackId(),"] use audio element to play")),ua.play(this._mediaStreamTrack,this.getTrackId(),this._volume,this.store.sessionId||void 0)):this._source.play()}stop(){x.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._played=!1,this._useAudioElement?ua.stop(this.getTrackId()):this._source.stop()}_destroy(){super._destroy(),this._played=!1,this.unbindProcessorDestinationEvents(),this._source.destroy()}_isFreeze(){return this._source.isFreeze}_updatePlayerSource(){let t=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];x.debug("[".concat(this.getTrackId(),"] update player source track")),t&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&ua.updateTrack(this.getTrackId(),this._mediaStreamTrack)}pipe(t){if(this._bypassWebAudio)throw new Le(te.NOT_SUPPORTED,"can not pipe extension when WebAudio disabled");if(this.processor===t)return t;if(t._source)throw new Le(te.INVALID_OPERATION,"Processor ".concat(t.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=t,this.processor._source=this,t.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),t}unpipe(){var t;if(this._bypassWebAudio)throw new Le(te.NOT_SUPPORTED,"can not unpipe extension when WebAudio disabled");if(!this.processor)return;const r=this.processor;(t=this._source.processSourceNode)===null||t===void 0||t.disconnect(),this.processor._source=!1,this.processor=void 0,r.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(Mo.ON_TRACK,async t=>{t?t!==this._mediaStreamTrack&&(this._mediaStreamTrack=t,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(t)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())}),this.processorDestination.on(Mo.ON_NODE,t=>{this._source.processedNode=t;const r=!t;this._useAudioElement!==r&&(this._played?(this.stop(),this._useAudioElement=r,this.play()):this._useAudioElement=r)})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(Mo.ON_TRACK),this.processorDestination.removeAllListeners(Mo.ON_NODE)}}).prototype,"setVolume",[iH],Object.getOwnPropertyDescriptor(go.prototype,"setVolume"),go.prototype),xn(go.prototype,"setPlaybackDevice",[sH],Object.getOwnPropertyDescriptor(go.prototype,"setPlaybackDevice"),go.prototype),xn(go.prototype,"play",[oH],Object.getOwnPropertyDescriptor(go.prototype,"play"),go.prototype),xn(go.prototype,"stop",[aH],Object.getOwnPropertyDescriptor(go.prototype,"stop"),go.prototype),xn(go.prototype,"pipe",[cH],Object.getOwnPropertyDescriptor(go.prototype,"pipe"),go.prototype),xn(go.prototype,"unpipe",[lH],Object.getOwnPropertyDescriptor(go.prototype,"unpipe"),go.prototype),go);const sp=new class extends Ur{get visibility(){return document.visibilityState}get lastHiddenTime(){return this._lastHiddenTime}get lastVisibleTime(){return this._lastVisibleTime}constructor(){super(),Pe(this,"_lastHiddenTime",0),Pe(this,"_lastVisibleTime",0),document.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"?this._lastHiddenTime=performance.now():this._lastVisibleTime=performance.now(),x.debug("current web page is ".concat(document.visibilityState)),this.emit("VISIBILITY_CHANGE",document.visibilityState)})}};class dH extends Ur{constructor(r,s){super(),Pe(this,"trackMediaType",qv.DATA),Pe(this,"_version",1),Pe(this,"_type",3),Pe(this,"_config",void 0),Pe(this,"_originDataChannel",void 0),Pe(this,"_dataStreamPacketHeader",new ArrayBuffer(4)),Pe(this,"_dataStreamPacketHandler",{serialize:a=>a,deserialize:a=>a}),Pe(this,"_datachannelEventMap",new Map),this._config=r,s&&(this._originDataChannel=s,this._bandDataChannelEvents(s)),this._initPacketHeader()}useDataStream(r){this._dataStreamPacketHandler=r}get id(){return this._config.id}get ordered(){return this._config.ordered}get maxRetransmits(){return oe("DATASTREAM_MAX_RETRANSMITS")}get metadata(){return this._config.metadata}get readyState(){var r,s;return(r=(s=this._originDataChannel)===null||s===void 0?void 0:s.readyState)!==null&&r!==void 0?r:"connecting"}get _originDataChannelId(){var r,s;return(r=(s=this._originDataChannel)===null||s===void 0?void 0:s.id)!==null&&r!==void 0?r:null}getChannelId(){return this.id}getConfig(){return this._config}_close(){this._originDataChannel&&(this._unbindDataChannelEvents(this._originDataChannel),this._originDataChannel=void 0)}async _waitTillOpen(){return new dt((r,s)=>{if(this._originDataChannel){this._originDataChannel.readyState==="open"&&r();const a=setTimeout(()=>{var c;s(new Le(te.DATACHANNEL_CONNECTION_TIMEOUT,"Cannot create datachannel, id: ".concat((c=this._originDataChannel)===null||c===void 0?void 0:c.id)))},1e4);this._originDataChannel.onopen=()=>{clearTimeout(a),this._originDataChannel&&this._bandDataChannelEvents(this._originDataChannel),r()},this._originDataChannel.onerror=()=>{throw clearTimeout(a),new Le(te.DATACHANNEL_CONNECTION_TIMEOUT)}}else s(new Le(te.DATACHANNEL_CONNECTION_TIMEOUT,"cannot find dataChannel"))})}_updateOriginDataChannel(r){this._originDataChannel=r,this._bandDataChannelEvents(r)}_initPacketHeader(){const r=new DataView(this._dataStreamPacketHeader);r.setUint16(0,this._version),r.setUint8(2,this._type),r.setUint8(3,this._config.id)}_bandDataChannelEvents(r){this._unbindDataChannelEvents(r),[sP.OPEN,sP.CLOSE,sP.ERROR].forEach(s=>{const a=()=>{this.emit(s)};this._datachannelEventMap.set(s,a),r.addEventListener(s,a)})}_unbindDataChannelEvents(r){Array.from(this._datachannelEventMap.entries()).forEach(s=>{let[a,c]=s;r.removeEventListener(a,c)}),this._datachannelEventMap.clear()}}class Ame extends dH{constructor(r){super(r),Pe(this,"_messageListener",void 0),this._messageListener=s=>{if(s.data.byteLength<this._dataStreamPacketHeader.byteLength)throw Error("invalid byteLength: the byte length must exceed "+this._dataStreamPacketHeader.byteLength);const a=s.data.slice(0,this._dataStreamPacketHeader.byteLength),c=new DataView(a).getUint8(3);if(c!==this.id)return void(oe("SHOW_DATASTREAM2_LOG")&&x.debug("invalid datachannel id: ".concat(c," !== ").concat(this.id)));let u=s.data.slice(this._dataStreamPacketHeader.byteLength);u=this._dataStreamPacketHandler.deserialize(u),this.emit(sP.MESSAGE,u)}}_updateOriginDataChannel(r){super._updateOriginDataChannel(r),this._bandRemoteDataChannelEvents()}_close(){this._originDataChannel&&(this._originDataChannel.removeEventListener("message",this._messageListener),super._close())}_bandRemoteDataChannelEvents(){this._originDataChannel&&this._originDataChannel.addEventListener("message",this._messageListener)}}class Pme extends dH{send(r){if(this._originDataChannel){let s=r;s=this._dataStreamPacketHandler.serialize(r);const a=new Uint8Array(this._dataStreamPacketHeader.byteLength+s.byteLength);a.set(new Uint8Array(this._dataStreamPacketHeader),0),a.set(new Uint8Array(s),this._dataStreamPacketHeader.byteLength),this._originDataChannel.send(a.buffer)}}}function lP(){const t=new Blob([atob("ZnVuY3Rpb24gdCh0LGUsbil7bGV0IGE9bmV3IFVpbnQ4QXJyYXkodCxlLG4pLG89W10scj0wO2Zvcig7by5sZW5ndGg8bjspciszPG4mJjA9PT1hW3JdJiYwPT09YVtyKzFdJiYzPT09YVtyKzJdJiYoMD09PWFbciszXXx8MT09PWFbciszXXx8Mj09PWFbciszXXx8Mz09PWFbciszXSk/KG8ucHVzaChhW3JdLGFbcisxXSxhW3IrM10pLHIrPTQpOihvLnB1c2goYVtyXSkscisrKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkobyl9ZnVuY3Rpb24gZSh0LGUpe2NvbnN0IG49ZnVuY3Rpb24odCl7Y29uc3QgZT10Lmxlbmd0aDtsZXQgbj1bXSxhPTA7Zm9yKDthPGU7KWErMjxlJiYwPT09dFthXSYmMD09PXRbYSsxXSYmKDA9PT10W2ErMl18fDE9PT10W2ErMl18fDI9PT10W2ErMl18fDM9PT10W2ErMl0pPyhuLnB1c2godFthXSx0W2ErMV0sMyx0W2ErMl0pLGErPTMpOihuLnB1c2godFthXSksYSsrKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkobil9KGUpLGE9bi5sZW5ndGgsbz1NYXRoLmZsb29yKGEvMjU1KSxyPWElMjU1LHM9bmV3IFVpbnQ4QXJyYXkoNitvKzErYSt0LmJ5dGVMZW5ndGgpO3NbMF09MCxzWzFdPTAsc1syXT0wLHNbM109MSxzWzRdPTYsc1s1XT0xMDE7bGV0IGk9MDtmb3IoO2k8bzspc1s2K2ldPTI1NSxpKys7cmV0dXJuIHNbNitpXT1yLGkrKyxzLnNldChuLDYraSkscy5zZXQobmV3IFVpbnQ4QXJyYXkodCksNitpK2EpLHMuYnVmZmVyfWNvbnN0IG49NzEsYT0xLG89MixyPTEscz0yO3ZhciBpOyFmdW5jdGlvbih0KXt0W3QuQVVESU9fTEVWRUw9MV09IkFVRElPX0xFVkVMIix0W3QuTUVUQURBVEE9Ml09Ik1FVEFEQVRBIix0W3QuQVVESU9fNjRfQklUX1BUUz0zXT0iQVVESU9fNjRfQklUX1BUUyJ9KGl8fChpPXt9KSk7bmF2aWdhdG9yLnVzZXJBZ2VudC5pbmRleE9mKCJTYWZhcmkiKT4tMSYmLTE9PT1uYXZpZ2F0b3IudXNlckFnZW50LmluZGV4T2YoIkNocm9tZSIpJiYoc2VsZi5vbnJ0Y3RyYW5zZm9ybT1mPT57Y29uc3QgdT1mLnRyYW5zZm9ybWVyO2xldCBkPVtdLGw9W107dS5vcHRpb25zLnBvcnQub25tZXNzYWdlPXQ9Pnt0LmRhdGEuc2VpJiZkLnB1c2godC5kYXRhLnNlaSksdC5kYXRhLm1ldGFkYXRhJiZsLnB1c2godC5kYXRhLm1ldGFkYXRhKX0sc2VsZi5wb3N0TWVzc2FnZSgic3RhcnRlZCIpO2NvbnN0IGc9dS5yZWFkYWJsZS5nZXRSZWFkZXIoKSxjPXUud3JpdGFibGUuZ2V0V3JpdGVyKCk7InNlaS1yeCI9PT11Lm9wdGlvbnMubmFtZT9mdW5jdGlvbiBlKG4pe2cucmVhZCgpLnRoZW4oKGE9PntpZighYS5kb25lKXtpZihhLnZhbHVlIGluc3RhbmNlb2YgUlRDRW5jb2RlZFZpZGVvRnJhbWUpe2NvbnN0IGU9ZnVuY3Rpb24oZSl7Y29uc3Qgbj1uZXcgRGF0YVZpZXcoZS5kYXRhKTtsZXQgYT0wO2Zvcig7YSs0PGUuZGF0YS5ieXRlTGVuZ3RoOyl7aWYoMD09PW4uZ2V0VWludDgoYSswKSYmMD09PW4uZ2V0VWludDgoYSsxKSYmMD09PW4uZ2V0VWludDgoYSsyKSYmMT09PW4uZ2V0VWludDgoYSszKSYmNj09PW4uZ2V0VWludDgoYSs0KSl7bGV0IG89YSs2LHI9MCxzPTA7Zm9yKDsyNTU9PT0ocz1uLmdldFVpbnQ4KG8rKykpOylyKz0yNTU7cis9cztjb25zdCBpPXQoZS5kYXRhLG8scik7cmV0dXJuIG5ldyBVaW50OEFycmF5KGkpfWErK31yZXR1cm4gbnVsbH0oYS52YWx1ZSk7ZSYmbi5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3NlaTplfSl9Yy53cml0ZShhLnZhbHVlKSxuLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSxlKG4pfX0pKX0odSk6InNlaS10eCI9PT11Lm9wdGlvbnMubmFtZT9mdW5jdGlvbiB0KG4pe2cucmVhZCgpLnRoZW4oKGE9PntpZighYS5kb25lKXtpZihhLnZhbHVlIGluc3RhbmNlb2YgUlRDRW5jb2RlZFZpZGVvRnJhbWUpe2NvbnN0IHQ9ZC5zaGlmdCgpO3QmJihhLnZhbHVlLmRhdGE9ZShhLnZhbHVlLmRhdGEsdCkpfWMud3JpdGUoYS52YWx1ZSksbi5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3RyYW5zZm9ybWVkOiEwfSksdChuKX19KSl9KHUpOiJhdWRpby1tZXRhZGF0YS1yeCI9PT11Lm9wdGlvbnMubmFtZT9mdW5jdGlvbiB0KGUpe2cucmVhZCgpLnRoZW4oKGY9PntpZighZi5kb25lKXtpZihmLnZhbHVlIGluc3RhbmNlb2YgUlRDRW5jb2RlZEF1ZGlvRnJhbWUpe2NvbnN0IHQ9ZnVuY3Rpb24odCxlPSExKXtjb25zdCBmPXQuZ2V0VWludDgoMCk7aWYoZiE9PW4pcmV0dXJuO2NvbnN0IHU9dC5nZXRVaW50MTYoMSksZD1hK28rdSxsPW5ldyBVaW50OEFycmF5KHQuYnl0ZUxlbmd0aC1kKTtsLnNldChuZXcgVWludDhBcnJheSh0LmJ1ZmZlcixkLHQuYnl0ZUxlbmd0aC1kKSk7Y29uc3QgZz17bTpmLHRsdkxlbjp1LHRsdjpbXSxmcmFtZTpsfTtsZXQgYz1hK287Zm9yKDtjPGQ7KXtjb25zdCBuPXQuZ2V0VWludDgoYyksYT10LmdldFVpbnQxNihjK3IpLG89citzO2lmKG49PT1pLkFVRElPX0xFVkVMKXtsZXQgcj10LmdldFVpbnQ4KGMrbyk7Zm9yKGxldCBlPTE7ZTxhO2UrKylyPXI8PDh8dC5nZXRVaW50OChjK28rZSk7Zy50bHYucHVzaCh7dGFnOm4sbGVuZ3RoOmEsdmFsdWU6ZT8xMjdecj4+MToxMjcmcn0pfWVsc2UgaWYobj09PWkuTUVUQURBVEF8fG49PT1pLkFVRElPXzY0X0JJVF9QVFMpe2NvbnN0IGU9bmV3IFVpbnQ4QXJyYXkoYSk7Zm9yKGxldCBuPTA7bjxhO24rKyllW25dPXQuZ2V0VWludDgoYytvK24pO2cudGx2LnB1c2goe3RhZzpuLGxlbmd0aDphLHZhbHVlOmV9KX1jKz1vK2F9cmV0dXJuIGd9KG5ldyBEYXRhVmlldyhmLnZhbHVlLmRhdGEpKTtpZih0KXtjb25zdCBuPXQudGx2LmZpbmQoKHQ9PnQudGFnPT09aS5NRVRBREFUQXx8dC50YWc9PT1pLkFVRElPXzY0X0JJVF9QVFMpKTtuJiZuLnZhbHVlIGluc3RhbmNlb2YgVWludDhBcnJheSYmZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe21ldGFkYXRhOm4udmFsdWV9KSxmLnZhbHVlLmRhdGE9dC5mcmFtZS5idWZmZXJ9fWMud3JpdGUoZi52YWx1ZSksZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3RyYW5zZm9ybWVkOiEwfSksdChlKX19KSl9KHUpOiJhdWRpby1tZXRhZGF0YS10eCI9PT11Lm9wdGlvbnMubmFtZSYmZnVuY3Rpb24gdChlKXtnLnJlYWQoKS50aGVuKChmPT57aWYoIWYuZG9uZSl7aWYoZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe2dldE1ldGFkYXRhOiEwfSksZi52YWx1ZSBpbnN0YW5jZW9mIFJUQ0VuY29kZWRBdWRpb0ZyYW1lKXtjb25zdCB0PWwuc2hpZnQoKTt0JiYoZi52YWx1ZS5kYXRhPWZ1bmN0aW9uKHQsZSxpKXtjb25zdCBmPWkuYnl0ZUxlbmd0aCx1PWYrcitzLGQ9YStvK3UsbD1uZXcgQXJyYXlCdWZmZXIodC5ieXRlTGVuZ3RoK2QpLGc9bmV3IERhdGFWaWV3KGwpO2cuc2V0VWludDgoMCxuKSxnLnNldFVpbnQxNigxLHUpLGcuc2V0VWludDgoMyxlKSxnLnNldFVpbnQxNig0LGYpO2ZvcihsZXQgdD0wO3Q8Zjt0KyspZy5zZXRVaW50OCg2K3QsaVt0XSk7Y29uc3QgYz1uZXcgVWludDhBcnJheShnLmJ1ZmZlcik7cmV0dXJuIGMuc2V0KG5ldyBVaW50OEFycmF5KHQpLGQpLGMuYnVmZmVyfShmLnZhbHVlLmRhdGEsaS5BVURJT182NF9CSVRfUFRTLHQpKX1jLndyaXRlKGYudmFsdWUpLGUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHt0cmFuc2Zvcm1lZDohMH0pLHQoZSl9fSkpfSh1KX0sc2VsZi5wb3N0TWVzc2FnZSgicmVnaXN0ZXJlZCIpKTsK")],{type:"text/javascript"});return setTimeout(()=>lA.revokeObjectURL(t),0),new Worker(lA.createObjectURL(t))}const hH=71,qL=1,YL=2,XL=1,fH=2;var op=function(t){return t[t.AUDIO_LEVEL=1]="AUDIO_LEVEL",t[t.METADATA=2]="METADATA",t[t.AUDIO_64_BIT_PTS=3]="AUDIO_64_BIT_PTS",t}(op||{});function pH(t){let r=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const s=t.getUint8(0);if(s!==hH)return;const a=t.getUint16(1),c=qL+YL+a,u=new Uint8Array(t.byteLength-c);u.set(new Uint8Array(t.buffer,c,t.byteLength-c));const h={m:s,tlvLen:a,tlv:[],frame:u};let m=qL+YL;for(;m<c;){const y=t.getUint8(m),v=t.getUint16(m+XL),S=XL+fH;if(y===op.AUDIO_LEVEL){let R=t.getUint8(m+S);for(let P=1;P<v;P++)R=R<<8|t.getUint8(m+S+P);h.tlv.push({tag:y,length:v,value:r?127^R>>1:127&R})}else if(y===op.METADATA||y===op.AUDIO_64_BIT_PTS){const R=new Uint8Array(v);for(let P=0;P<v;P++)R[P]=t.getUint8(m+S+P);h.tlv.push({tag:y,length:v,value:R})}m+=S+v}return h}const uP=new Map,dP=127,H_=1e-10,JL=139/13,hP=new Map;function QL(t,r,s){const a="".concat(t,"-").concat(r,"-").concat(s);let c=0;return hP.has(a)?c=hP.get(a):(c=Math.log(function(h,m){const y=h-m;m<y&&(m=y);let v=1;for(let S=h,R=1;S>m;S--,R++)v=v*S/R;return v}(r,t))+t*Math.log(.5)+(r-t)*Math.log(1-.5)-Math.log(s)+s*t,hP.set(a,c)),c<H_&&(c=H_),c}function mH(t,r,s){const a=r.length,c=t.length/a;let u=!1;for(let h=0,m=0;h<a;h++){let y=0;for(let v=m+c;m<v;m++)t[m]>s&&y++;r[h]!==y&&(r[h]=y,u=!0)}return u}window.cache=hP;let Ome=0;class gH{constructor(r){Pe(this,"id",void 0),Pe(this,"immediates",[]),Pe(this,"lastNonSilence",-1),Pe(this,"immediateSpeechActivityScore",H_),Pe(this,"lastLevelChangedTime",Date.now()),Pe(this,"levels",[]),Pe(this,"longs",[]),Pe(this,"longSpeechActivityScore",H_),Pe(this,"mediums",[]),Pe(this,"mediumSpeechActivityScore",H_),Pe(this,"minLevel",0),Pe(this,"nextMinLevel",0),Pe(this,"nextMinLevelWindowLength",0),Pe(this,"energyScore",0),this.id=r||"".concat(Ome++),this.immediates.length=50,this.mediums.length=10,this.longs.length=1,this.levels.length=this.immediates.length}computeImmediates(){const r=this.immediates,s=this.levels,a=this.minLevel+JL;let c=!1;for(let u=0;u<r.length;++u){let h=s[u];h<a&&(h=0);const m=Math.floor(h/JL);r[u]!==m&&(r[u]=m,c=!0)}return c}computeLongs(){return mH(this.mediums,this.longs,4)}computeMediums(){return mH(this.immediates,this.mediums,7)}evaluateImmediateSpeechActivityScore(){this.immediateSpeechActivityScore=QL(this.immediates[0],13,.78)}evaluateLongSpeechActivityScore(r){this.longSpeechActivityScore=QL(this.longs[0],10,47),this.longSpeechActivityScore>H_&&(this.lastNonSilence=r)}evaluateMediumSpeechActivityScore(){this.mediumSpeechActivityScore=QL(this.mediums[0],5,24)}evaluateSpeechActivityScores(r){this.computeImmediates()&&(this.evaluateImmediateSpeechActivityScore(),this.computeMediums()&&(this.evaluateMediumSpeechActivityScore(),this.computeLongs()&&this.evaluateLongSpeechActivityScore(r)))}getLastLevelChangedTime(){return this.lastLevelChangedTime}getLevels(){var r;return"[".concat(hm(r=[...this.levels]).call(r).join(),"]")}getSpeechActivityScore(r){switch(r){case 0:return this.immediateSpeechActivityScore;case 1:return this.mediumSpeechActivityScore;case 2:return this.longSpeechActivityScore;default:throw new Error("interval "+r)}}levelChanged(r,s){if(this.lastLevelChangedTime<=s){this.lastLevelChangedTime=s;let a=r;return r<0&&(a=0),r>dP&&(a=dP),this.levels.unshift(a),this.levels.length>this.immediates.length&&this.levels.pop(),this.updateMinLevel(a),a>=this.minLevel+JL?a:a/2}return-1}levelTimedOut(){this.levelChanged(0,this.lastLevelChangedTime)}updateMinLevel(r){if(r!==0){if(this.minLevel===0||this.minLevel>r)return this.minLevel=r,this.nextMinLevel=0,void(this.nextMinLevelWindowLength=0);if(this.nextMinLevel===0)return this.nextMinLevel=r,void(this.nextMinLevelWindowLength=1);if(this.nextMinLevel>r&&(this.nextMinLevel=r),this.nextMinLevelWindowLength++,this.nextMinLevelWindowLength>=750){let s=Math.sqrt(this.minLevel*this.nextMinLevel);s<0?s=0:s>dP&&(s=dP),this.minLevel=s,this.nextMinLevel=0,this.nextMinLevelWindowLength=0}}}}class kme{constructor(r){Pe(this,"algorithm",void 0),this.algorithm=r}execute(){let r=!this.algorithm;if(!r)try{const s=this.algorithm.runInDecisionMaker(this);s<=0?r=!0:setTimeout(this.execute.bind(this),s)}catch{r=!0}r&&this.algorithm&&this.algorithm.decisionMakerExited(this)}}class ZL{constructor(r,s,a){Pe(this,"isDominant",void 0),Pe(this,"energyRanking",void 0),Pe(this,"energyScore",void 0),this.isDominant=r,this.energyRanking=s,this.energyScore=a}}class Nme extends Ur{constructor(r){super(),Pe(this,"dominantId",null),Pe(this,"lastDecisionTime",0),Pe(this,"lastLevelChangedTime",0),Pe(this,"lastLevelIdleTime",0),Pe(this,"relativeSpeechActivities",[]),Pe(this,"speakers",new Map),Pe(this,"enableSilence",!1),Pe(this,"timeoutToSilenceInterval",0),Pe(this,"decisionMaker",null),Pe(this,"loudest",[]),Pe(this,"numLoudestToTrack",3),Pe(this,"energyExpireTimeMs",250),Pe(this,"energyAlphaPct",50),this.timeoutToSilenceInterval=r,this.enableSilence=r>0,this.relativeSpeechActivities.length=3}setLoudestConfig(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:3,s=arguments.length>1?arguments[1]:void 0,a=arguments.length>2?arguments[2]:void 0;this.numLoudestToTrack=r,s!=null&&(this.energyExpireTimeMs=s),a!=null&&(this.energyAlphaPct=a),this.loudest.length>r&&this.loudest.splice(r)}getDominantSpeaker(){return this.dominantId}isAmongLoudest(r){return this.loudest.some(s=>s.id===r)}levelChanged(r,s){const a=Date.now(),c=this.getOrCreateSpeaker(r);this.lastLevelChangedTime<a&&(this.lastLevelChangedTime=a,this.maybeStartDecisionMaker());const u=c.levelChanged(s,a);return this.updateLoudestList(c,u,a)}runInDecisionMaker(r){return this.decisionMaker!==r||this.lastDecisionTime>0&&this.lastDecisionTime-this.lastLevelChangedTime>=15e3?-1:this._runInDecisionMaker()}decisionMakerExited(r){this.decisionMaker===r&&(this.decisionMaker=null)}destroy(){this.decisionMaker=null,this.loudest.length=0,this.speakers.clear(),this.removeAllListeners()}addSpeakers(r){r.forEach(s=>{this.speakers.has(s.id)||this.speakers.set(s.id,s)})}removeSpeakers(r){r.forEach(s=>{this.speakers.delete(s.id)})}getOrCreateSpeaker(r){let s=this.speakers.get(r);return s||(s=new gH(r),this.speakers.set(r,s),this.maybeStartDecisionMaker()),s}updateLoudestList(r,s,a){const c=r.id===this.dominantId;if(s<0){let y=0;for(;y<this.loudest.length&&this.loudest[y]!==r;)++y;return new ZL(c,y,r.energyScore)}if(r.energyScore=Math.floor((this.energyAlphaPct*s+(100-this.energyAlphaPct)*r.energyScore+50)/100),this.numLoudestToTrack===0)return new ZL(c,0,r.energyScore);const u=a-this.energyExpireTimeMs;let h=0;for(;h<this.loudest.length;){const y=this.loudest[h];if(y.getLastLevelChangedTime()<u&&this.loudest.length>=this.numLoudestToTrack)this.loudest.splice(h,1);else if(y.id!==r.id)++h;else if(this.loudest.splice(h,1),this.loudest.length<this.numLoudestToTrack)break}let m=0;for(;m<this.loudest.length&&!(this.loudest[m].energyScore<r.energyScore);)++m;return m<this.numLoudestToTrack&&(this.loudest.splice(m,0,r),this.loudest.length>this.numLoudestToTrack&&this.loudest.splice(this.numLoudestToTrack,1)),new ZL(c,m,r.energyScore)}maybeStartDecisionMaker(){!this.decisionMaker&&this.speakers.size>0&&(this.decisionMaker=new kme(this),this.decisionMaker.execute())}makeDecision(r){let s=null,a=null;const c=this.speakers.size;let u=null;if(c===0)u=null;else if(c===1){var h;const m=zc(h=this.speakers).call(h).next().value;this.enableSilence&&m&&(u=m.id,m.evaluateSpeechActivityScores(r),r-m.lastNonSilence>this.timeoutToSilenceInterval&&(u=null))}else{let m=this.dominantId==null?null:this.speakers.get(this.dominantId);if(m==null){const S=this.speakers.entries().next();S.value&&(u=S.value[0],m=S.value[1])}else u=m.id;m!=null&&m.evaluateSpeechActivityScores(r);const y=this.relativeSpeechActivities;let v=2;for(const S of this.speakers.entries()){const[R,P]=S;if(P===m)continue;P.evaluateSpeechActivityScores(r);for(let j=0;j<y.length;++j){const X=m==null?H_:m.getSpeechActivityScore(j);y[j]=Math.log(P.getSpeechActivityScore(j)/X)}const N=y[0],G=y[1],F=y[2];N>3&&G>2&&F>0&&G>v&&(v=G,u=R)}this.enableSilence&&m!=null&&u===m.id&&r-m.lastNonSilence>this.timeoutToSilenceInterval&&(u=null)}u==null&&!this.enableSilence||u===this.dominantId||(s=this.dominantId,this.dominantId=u,a=this.dominantId),a==null&&!this.enableSilence||a===s||this.emit("ActiveSpeakerChanged",a)}_runInDecisionMaker(){const r=Date.now(),s=300-(r-this.lastLevelIdleTime);let a=0;s<=0?(this.lastLevelIdleTime!==0&&this.timeoutIdleLevels(r),this.lastLevelIdleTime=r):a=s;let c=300-(r-this.lastDecisionTime);return c<=0&&(this.lastDecisionTime=r,this.makeDecision(r),c=300-(Date.now()-r)),c>0&&a>c&&(a=c),a}timeoutIdleLevels(r){const s=[];for(const c of zc(a=this.speakers).call(a)){var a;const u=r-c.getLastLevelChangedTime();36e5<u&&(this.dominantId==null||c.id!==this.dominantId)?s.push(c.id):300<u&&c.levelTimedOut()}s.forEach(c=>this.speakers.delete(c))}}const eS=new Map;let Ed=null,fP=null;const _H=3;let $_=[];const vd=new Map,pP=new Map;class Dme{get samples(){return this.actives+this.inactives}get activeRate(){return this.actives/this.samples}constructor(r,s){Pe(this,"id",void 0),Pe(this,"track",void 0),Pe(this,"score",0),Pe(this,"active",!0),Pe(this,"muted",!1),Pe(this,"timer",0),Pe(this,"actives",0),Pe(this,"inactives",0),this.id=r,this.track=s,this.setActive(vd.size<3)}autoCheckActive(){this.autoSetActive(),this.autoAdjustActive(),this.resetTimer(),this.actives=0,this.inactives=0}autoSetActive(){const r=this.active;this.active=this.activeRate>=.8;const{actives:s,inactives:a}=function(){const c=[],u=[];return Array.from(zc(vd).call(vd)).forEach(h=>{h.active?c.push(h):u.push(h)}),{actives:c,inactives:u}}();if(s.length>3){let c;s.forEach(u=>{(!c||c.score>u.score)&&(c=u)}),c&&c.setActive(!1)}if(s.length<3&&a.length>0){let c;a.forEach(u=>{(!c||c.score<u.score)&&u.id!==this.id&&(c=u)}),c&&r&&!this.active&&(c.samples>40&&c.activeRate-this.activeRate>.4?c.setActive(!0):this.active=!0)}this.setMuted(!this.active)}setActive(r){this.active=r,this.resetTimer(),this.setMuted(!r)}autoAdjustActive(){this.active?this.autoSwitchToInactive():this.autoSwitchToActive()}autoSwitchToActive(){const r=function(s){let a;return Array.from(zc(vd).call(vd)).forEach(c=>{!c.active||c.id===s||c.samples<40||(!a||c.score<a.score)&&(a=c)}),a}(this.id);r&&this.activeRate-r.activeRate>.4&&(r.setActive(!1),this.setActive(!0))}autoSwitchToInactive(){const r=function(s){let a;return Array.from(zc(vd).call(vd)).forEach(c=>{c.active||c.id===s||c.samples<40||(!a||c.score>a.score)&&(a=c)}),a}(this.id);r&&r.activeRate-this.activeRate>.4&&(r.setActive(!0),this.setActive(!1))}addSample(r){r?this.actives+=1:this.inactives+=1,this.samples>66.66666666666667&&this.autoCheckActive()}setMuted(r){this.track&&(this.track.enabled=!r,this.muted=r)}resetTimer(){this.clearTimer(),this.timer=window.setTimeout(()=>{if(this.samples!==0)return this.samples<50?this.resetTimer():void this.autoCheckActive()},1e3)}clearTimer(){this.timer&&(clearTimeout(this.timer),this.timer=0)}}let mP;function yH(t){const r=vd.get(t);r&&(vd.delete(t),r.clearTimer())}const gP=new Map,xme=new Map;function Lme(t,r,s){let a=new Uint8Array(t,r,s),c=[],u=0;for(;c.length<s;)u+3<s&&a[u]===0&&a[u+1]===0&&a[u+2]===3&&(a[u+3]===0||a[u+3]===1||a[u+3]===2||a[u+3]===3)?(c.push(a[u],a[u+1],a[u+3]),u+=4):(c.push(a[u]),u++);return new Uint8Array(c)}const _P=new Map,DT=new Map;(function(){const t=Nn();ms.getDisplayMedia=!(!navigator.mediaDevices||!navigator.mediaDevices.getDisplayMedia),ms.getStreamFromExtension=t.name===zn.CHROME&&Number(t.version)>34,ms.supportUnifiedPlan=function(){if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;const r=new RTCPeerConnection;let s=!1;try{r.addTransceiver("audio"),s=!0}catch{}return r.close(),s}(),ms.supportMinBitrate=t.name===zn.CHROME||t.name===zn.EDGE,ms.supportSetRtpSenderParameters=function(){const r=Nn();return!!(window.RTCRtpSender&&window.RTCRtpSender.prototype.setParameters&&window.RTCRtpSender.prototype.getParameters)&&(!!np()||!(!Ps()&&!$A())||r.name===zn.FIREFOX&&Number(r.version)>=64)}(),t.name===zn.SAFARI&&(Number(t.version)>=14?ms.supportDualStream=!0:ms.supportDualStream=!1),ms.webAudioMediaStreamDest=function(){const r=Nn();return!(r.name===zn.SAFARI&&Number(r.version)<12)}(),ms.supportReplaceTrack=!!window.RTCRtpSender&&typeof RTCRtpSender.prototype.replaceTrack=="function",ms.supportWebGL=typeof WebGLRenderingContext<"u",ms.supportRequestFrame=!!window.CanvasCaptureMediaStreamTrack,np()||(ms.webAudioWithAEC=!0),ms.supportShareAudio=function(){const r=Nn();return(r.os===Yi.WIN_10||r.os===Yi.WIN_81||r.os===Yi.WIN_7||r.os===Yi.LINUX||r.os===Yi.MAC_OS||r.os===Yi.CHROMIUM_OS)&&r.name===zn.CHROME&&Number(r.version)>=74}(),ms.supportDataChannel=!!(bT(76)||function(r){const s=Nn();return!(s.name!==zn.FIREFOX||!s.osVersion)&&Number(s.version)>=r}(68)||T8(14)),ms.supportPCSetConfiguration=function(){const r=window.RTCPeerConnection;return!Br()&&!!r&&r.prototype.setConfiguration instanceof Function}(),ms.supportWebRTCEncodedTransform=function(){const r=Nn();return r.name==="Chrome"&&Number(r.version)>=87||r.name==="Safari"&&Number(r.version)>=15}(),ms.supportWebRTCInsertableStream=function(){const r=Nn();return(r.name===zn.CHROME||r.name===zn.EDGE)&&Number(r.version)>=94&&"MediaStreamTrackGenerator"in window&&"MediaStreamTrackProcessor"in window}(),ms.supportRequestVideoFrameCallback="requestVideoFrameCallback"in HTMLVideoElement.prototype,ms.supportWebCrypto=typeof window<"u"&&window.crypto!==void 0&&window.crypto.subtle!==void 0,YA(()=>{ms.supportDualStreamEncoding=function(){const r=Nn();return!!oe("DISABLE_WEBAUDIO")||r.name==="Safari"&&Number(r.version)>=14||!!(r.name==="Chrome"&&/Windows/i.test(r.os||"")&&Number(r.version)>=100&&oe("CHROME_DUAL_STREAM_USE_ENCODING"))}(),x.debug("browser ua: ",navigator.userAgent),x.info("browser info: ",t),x.info("browser compatibility: ",ms)})})();const Mme=["CHINA","GLOBAL"],EH=[[0,1,2,3,4,5,5],[0,2,2,3,4,5,5],[0,3,3,3,4,5,5],[0,4,4,4,4,5,5],[0,5,5,5,5,5,5]],K_=[],tS=[];function q_(t,r){return!!r&&K_.some(s=>s.uid===t&&s.channelName===r)}function e2(){return tS.length>0}var Ume=B6.forEach,vH=Of("forEach")?[].forEach:function(t){return Ume(this,t,arguments.length>1?arguments[1]:void 0)};Wn({target:"Array",proto:!0,forced:[].forEach!=vH},{forEach:vH});var Vme=cc("Array").forEach,Fme=Nc,jme=Ci,Bme=O,Wme=Vme,t2=Array.prototype,zme={DOMTokenList:!0,NodeList:!0},Gme=function(t){var r=t.forEach;return t===t2||Bme(t2,t)&&r===t2.forEach||jme(zme,Fme(t))?Wme:r},Hme=l(Gme),$me=$o,SH=Lc;Wn({target:"Object",stat:!0,forced:d(function(){SH(1)})},{keys:function(t){return SH($me(t))}});var bH=l(yt.Object.keys),Kme=l(dE),qme=l(fE),Yme=Wn,TH=Qg,Xme=S_,Jme=at,wH=ge,Qme=gi,Zme=Re,ege=JI,tge=_r,nge=Cs,rge=k6("slice"),ige=tge("species"),n2=Array,sge=Math.max;Yme({target:"Array",proto:!0,forced:!rge},{slice:function(t,r){var s,a,c,u=Zme(this),h=Qme(u),m=wH(t,h),y=wH(r===void 0?h:r,h);if(TH(u)&&(s=u.constructor,(Xme(s)&&(s===n2||TH(s.prototype))||Jme(s)&&(s=s[ige])===null)&&(s=void 0),s===n2||s===void 0))return nge(u,m,y);for(a=new(s===void 0?n2:s)(sge(y-m,0)),c=0;m<y;m++,c++)m in u&&ege(a,c,u[m]);return a.length=c,a}});var oge=cc("Array").slice,age=O,cge=oge,r2=Array.prototype,lge=function(t){var r=t.slice;return t===r2||age(r2,t)&&r===r2.slice?cge:r},uge=l(lge);function Tt(t,r,s,a,c){var u,h,m,y={};return Hme(u=bH(a)).call(u,function(v){y[v]=a[v]}),y.enumerable=!!y.enumerable,y.configurable=!!y.configurable,("value"in y||y.initializer)&&(y.writable=!0),y=Kme(h=qme(m=uge(s).call(s)).call(m)).call(h,function(v,S){return S(t,r,v)||v},y),c&&y.initializer!==void 0&&(y.value=y.initializer?y.initializer.call(c):void 0,y.initializer=void 0),y.initializer===void 0&&(I6(t,r,y),y=null),y}let yP=function(t){return t[t.ACCESS_POINT=101]="ACCESS_POINT",t[t.UNILBS=201]="UNILBS",t[t.STRING_UID_ALLOCATOR=901]="STRING_UID_ALLOCATOR",t}({}),i2=function(t){return t[t.IIIEGAL_APPID=1]="IIIEGAL_APPID",t[t.IIIEGAL_UID=2]="IIIEGAL_UID",t[t.INTERNAL_ERROR=3]="INTERNAL_ERROR",t}({}),Eu=function(t){return t[t.INVALID_VENDOR_KEY=5]="INVALID_VENDOR_KEY",t[t.INVALID_CHANNEL_NAME=7]="INVALID_CHANNEL_NAME",t[t.INTERNAL_ERROR=8]="INTERNAL_ERROR",t[t.NO_AUTHORIZED=9]="NO_AUTHORIZED",t[t.DYNAMIC_KEY_TIMEOUT=10]="DYNAMIC_KEY_TIMEOUT",t[t.NO_ACTIVE_STATUS=11]="NO_ACTIVE_STATUS",t[t.DYNAMIC_KEY_EXPIRED=13]="DYNAMIC_KEY_EXPIRED",t[t.STATIC_USE_DYNAMIC_KEY=14]="STATIC_USE_DYNAMIC_KEY",t[t.DYNAMIC_USE_STATIC_KEY=15]="DYNAMIC_USE_STATIC_KEY",t[t.USER_OVERLOAD=16]="USER_OVERLOAD",t[t.FORBIDDEN_REGION=18]="FORBIDDEN_REGION",t[t.CANNOT_MEET_AREA_DEMAND=19]="CANNOT_MEET_AREA_DEMAND",t}({}),Uo=function(t){return t[t.NO_FLAG_SET=100]="NO_FLAG_SET",t[t.FLAG_SET_BUT_EMPTY=101]="FLAG_SET_BUT_EMPTY",t[t.INVALID_FALG_SET=102]="INVALID_FALG_SET",t[t.FLAG_SET_BUT_NO_RE=103]="FLAG_SET_BUT_NO_RE",t[t.INVALID_SERVICE_ID=104]="INVALID_SERVICE_ID",t[t.NO_SERVICE_AVAILABLE=200]="NO_SERVICE_AVAILABLE",t[t.NO_SERVICE_AVAILABLE_P2P=201]="NO_SERVICE_AVAILABLE_P2P",t[t.NO_SERVICE_AVAILABLE_VOICE=202]="NO_SERVICE_AVAILABLE_VOICE",t[t.NO_SERVICE_AVAILABLE_WEBRTC=203]="NO_SERVICE_AVAILABLE_WEBRTC",t[t.NO_SERVICE_AVAILABLE_CDS=204]="NO_SERVICE_AVAILABLE_CDS",t[t.NO_SERVICE_AVAILABLE_CDN=205]="NO_SERVICE_AVAILABLE_CDN",t[t.NO_SERVICE_AVAILABLE_TDS=206]="NO_SERVICE_AVAILABLE_TDS",t[t.NO_SERVICE_AVAILABLE_REPORT=207]="NO_SERVICE_AVAILABLE_REPORT",t[t.NO_SERVICE_AVAILABLE_APP_CENTER=208]="NO_SERVICE_AVAILABLE_APP_CENTER",t[t.NO_SERVICE_AVAILABLE_ENV0=209]="NO_SERVICE_AVAILABLE_ENV0",t[t.NO_SERVICE_AVAILABLE_VOET=210]="NO_SERVICE_AVAILABLE_VOET",t[t.NO_SERVICE_AVAILABLE_STRING_UID=211]="NO_SERVICE_AVAILABLE_STRING_UID",t[t.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS=212]="NO_SERVICE_AVAILABLE_WEBRTC_UNILBS",t[t.NO_SERVICE_AVAILABLE_UNILBS_FLV=213]="NO_SERVICE_AVAILABLE_UNILBS_FLV",t}({}),Ut=function(t){return t[t.K_TIMESTAMP_EXPIRED=2]="K_TIMESTAMP_EXPIRED",t[t.K_CHANNEL_PERMISSION_INVALID=3]="K_CHANNEL_PERMISSION_INVALID",t[t.K_CERTIFICATE_INVALID=4]="K_CERTIFICATE_INVALID",t[t.K_CHANNEL_NAME_EMPTY=5]="K_CHANNEL_NAME_EMPTY",t[t.K_CHANNEL_NOT_FOUND=6]="K_CHANNEL_NOT_FOUND",t[t.K_TICKET_INVALID=7]="K_TICKET_INVALID",t[t.K_CHANNEL_CONFLICTED=8]="K_CHANNEL_CONFLICTED",t[t.K_SERVICE_NOT_READY=9]="K_SERVICE_NOT_READY",t[t.K_SERVICE_TOO_HEAVY=10]="K_SERVICE_TOO_HEAVY",t[t.K_UID_BANNED=14]="K_UID_BANNED",t[t.K_IP_BANNED=15]="K_IP_BANNED",t[t.K_CHANNEL_BANNED=16]="K_CHANNEL_BANNED",t[t.DATASTREAM2_NOT_AVAILABLE=27]="DATASTREAM2_NOT_AVAILABLE",t[t.K_AUTO_REBALANCE=28]="K_AUTO_REBALANCE",t[t.WARN_NO_AVAILABLE_CHANNEL=103]="WARN_NO_AVAILABLE_CHANNEL",t[t.WARN_LOOKUP_CHANNEL_TIMEOUT=104]="WARN_LOOKUP_CHANNEL_TIMEOUT",t[t.WARN_LOOKUP_CHANNEL_REJECTED=105]="WARN_LOOKUP_CHANNEL_REJECTED",t[t.WARN_OPEN_CHANNEL_TIMEOUT=106]="WARN_OPEN_CHANNEL_TIMEOUT",t[t.WARN_OPEN_CHANNEL_REJECTED=107]="WARN_OPEN_CHANNEL_REJECTED",t[t.WARN_REQUEST_DEFERRED=108]="WARN_REQUEST_DEFERRED",t[t.ERR_DYNAMIC_KEY_TIMEOUT=109]="ERR_DYNAMIC_KEY_TIMEOUT",t[t.ERR_NO_AUTHORIZED=110]="ERR_NO_AUTHORIZED",t[t.ERR_VOM_SERVICE_UNAVAILABLE=111]="ERR_VOM_SERVICE_UNAVAILABLE",t[t.ERR_NO_CHANNEL_AVAILABLE_CODE=112]="ERR_NO_CHANNEL_AVAILABLE_CODE",t[t.ERR_MASTER_VOCS_UNAVAILABLE=114]="ERR_MASTER_VOCS_UNAVAILABLE",t[t.ERR_INTERNAL_ERROR=115]="ERR_INTERNAL_ERROR",t[t.ERR_NO_ACTIVE_STATUS=116]="ERR_NO_ACTIVE_STATUS",t[t.ERR_INVALID_UID=117]="ERR_INVALID_UID",t[t.ERR_DYNAMIC_KEY_EXPIRED=118]="ERR_DYNAMIC_KEY_EXPIRED",t[t.ERR_STATIC_USE_DYANMIC_KE=119]="ERR_STATIC_USE_DYANMIC_KE",t[t.ERR_DYNAMIC_USE_STATIC_KE=120]="ERR_DYNAMIC_USE_STATIC_KE",t[t.ERR_NO_VOCS_AVAILABLE=2e3]="ERR_NO_VOCS_AVAILABLE",t[t.ERR_NO_VOS_AVAILABLE=2001]="ERR_NO_VOS_AVAILABLE",t[t.ERR_JOIN_CHANNEL_TIMEOUT=2002]="ERR_JOIN_CHANNEL_TIMEOUT",t[t.ERR_REPEAT_JOIN_CHANNEL=2003]="ERR_REPEAT_JOIN_CHANNEL",t[t.ERR_JOIN_BY_MULTI_IP=2004]="ERR_JOIN_BY_MULTI_IP",t[t.ERR_NOT_JOINED=2011]="ERR_NOT_JOINED",t[t.ERR_REPEAT_JOIN_REQUEST=2012]="ERR_REPEAT_JOIN_REQUEST",t[t.ERR_INVALID_VENDOR_KEY=2013]="ERR_INVALID_VENDOR_KEY",t[t.ERR_INVALID_CHANNEL_NAME=2014]="ERR_INVALID_CHANNEL_NAME",t[t.ERR_INVALID_STRINGUID=2015]="ERR_INVALID_STRINGUID",t[t.ERR_TOO_MANY_USERS=2016]="ERR_TOO_MANY_USERS",t[t.ERR_SET_CLIENT_ROLE_TIMEOUT=2017]="ERR_SET_CLIENT_ROLE_TIMEOUT",t[t.ERR_SET_CLIENT_ROLE_NO_PERMISSION=2018]="ERR_SET_CLIENT_ROLE_NO_PERMISSION",t[t.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE=2019]="ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",t[t.ERR_PUBLISH_REQUEST_INVALID=2020]="ERR_PUBLISH_REQUEST_INVALID",t[t.ERR_SUBSCRIBE_REQUEST_INVALID=2021]="ERR_SUBSCRIBE_REQUEST_INVALID",t[t.ERR_NOT_SUPPORTED_MESSAGE=2022]="ERR_NOT_SUPPORTED_MESSAGE",t[t.ERR_ILLEAGAL_PLUGIN=2023]="ERR_ILLEAGAL_PLUGIN",t[t.ERR_REJOIN_TOKEN_INVALID=2024]="ERR_REJOIN_TOKEN_INVALID",t[t.ERR_REJOIN_USER_NOT_JOINED=2025]="ERR_REJOIN_USER_NOT_JOINED",t[t.ERR_INVALID_OPTIONAL_INFO=2027]="ERR_INVALID_OPTIONAL_INFO",t[t.ILLEGAL_AES_PASSWORD=2028]="ILLEGAL_AES_PASSWORD",t[t.ILLEGAL_CLIENT_ROLE_LEVEL=2029]="ILLEGAL_CLIENT_ROLE_LEVEL",t[t.ERR_TOO_MANY_BROADCASTERS=2031]="ERR_TOO_MANY_BROADCASTERS",t[t.ERR_TOO_MANY_SUBSCRIBERS=2032]="ERR_TOO_MANY_SUBSCRIBERS",t[t.ERR_LICENSE_MISSING=32769]="ERR_LICENSE_MISSING",t[t.ERR_LICENSE_EXPIRED=32771]="ERR_LICENSE_EXPIRED",t[t.ERR_LICENSE_MINUTES_EXCEEDED=32773]="ERR_LICENSE_MINUTES_EXCEEDED",t[t.ERR_LICENSE_PERIOD_INVALID=32774]="ERR_LICENSE_PERIOD_INVALID",t[t.ERR_LICENSE_MULTIPLE_SDK_SERVICE=32778]="ERR_LICENSE_MULTIPLE_SDK_SERVICE",t[t.ERR_LICENSE_ILLEGAL=32783]="ERR_LICENSE_ILLEGAL",t[t.ERR_TEST_RECOVER=9e3]="ERR_TEST_RECOVER",t[t.ERR_TEST_TRYNEXT=9001]="ERR_TEST_TRYNEXT",t[t.ERR_TEST_RETRY=9002]="ERR_TEST_RETRY",t}({}),pr=function(t){return t.CONNECTING="connecting",t.CONNECTED="connected",t.RECONNECTING="reconnecting",t.CLOSED="closed",t}({}),$t=function(t){return t.WS_CONNECTED="ws_connected",t.WS_RECONNECTING="ws_reconnecting",t.WS_CLOSED="ws_closed",t.WS_RECONNECT_CREATE_CONNECTION="ws_reconnect_create_connection",t.ON_BINARY_DATA="on_binary_data",t.REQUEST_RECOVER="request_recover",t.REQUEST_JOIN_INFO="request_join_info",t.REQUEST_REJOIN_INFO="req_rejoin_info",t.IS_P2P_DISCONNECTED="is_p2p_dis",t.DISCONNECT_P2P="dis_p2p",t.ABORT_P2P_EXECUTION="abort_p2p_execution",t.NEED_RENEW_SESSION="need-sid",t.REPORT_JOIN_GATEWAY="report_join_gateway",t.REQUEST_TIMEOUT="request_timeout",t.REQUEST_SUCCESS="request_success",t.JOIN_RESPONSE="join_response",t.PRE_CONNECT_PC="pre_connect_pc",t.P2P_CONNECTION="p2p_connection",t.P2P_REMOTE_CANDIDATE_UPDATE="p2p_remote_candidate_update",t.P2P_SUBSCRIBE="p2p_subscribe",t.P2P_UNSUBSCRIBE="p2p_unsubscribe",t.P2P_EXCHANGE_SDP="p2p_exchange_sdp",t.P2P_ON_ADD_VIDEO_STREAM="p2p_on_add_video_stream",t.P2P_ON_ADD_AUDIO_STREAM="p2p_on_add_audio_stream",t.RECOVER_NOTIFICATION="recover_notification",t}({}),zt=function(t){return t.PING="ping",t.PING_BACK="ping_back",t.JOIN="join_v3",t.REJOIN="rejoin_v3",t.LEAVE="leave",t.SET_CLIENT_ROLE="set_client_role",t.PUBLISH="publish",t.PUBLISH_DATASTREAM="publish_datastream",t.UNPUBLISH="unpublish",t.UNPUBLISH_DATASTREAM="unpublish_datastream",t.SUBSCRIBE="subscribe",t.PRE_SUBSCRIBE="pre_subscribe",t.SUBSCRIBE_DATASTREAM="subscribe_datastream",t.SUBSCRIBE_STREAMS="subscribe_streams",t.UNSUBSCRIBE="unsubscribe",t.UNSUBSCRIBE_DATASTREAM="unsubscribe_datastream",t.UNSUBSCRIBE_STREAMS="unsubscribe_streams",t.SUBSCRIBE_CHANGE="subscribe_change",t.TRAFFIC_STATS="traffic_stats",t.RENEW_TOKEN="renew_token",t.SWITCH_VIDEO_STREAM="switch_video_stream",t.DEFAULT_VIDEO_STREAM="default_video_stream",t.SET_FALLBACK_OPTION="set_fallback_option",t.GATEWAY_INFO="gateway_info",t.CONTROL="control",t.SEND_METADATA="send_metadata",t.DATA_STREAM="data_stream",t.PICK_SVC_LAYER="pick_svc_layer",t.RESTART_ICE="restart_ice",t.CONNECT_PC="connect_pc",t.SET_VIDEO_PROFILE="set_video_profile",t.SET_PARAMETER="set_parameter",t.SET_RTM2_FLAG="set_rtm2_flag",t}({}),xT=function(t){return t.WRTC_STATS="wrtc_stats",t.WS_INFLATE_DATA_LENGTH="ws_inflate_data_length",t.DENOISER_STATS="denoiser_stats",t.EXTENSION_USAGE_STATS="extension_usage_stats",t}({}),vn=function(t){return t.ON_USER_ONLINE="on_user_online",t.ON_USER_OFFLINE="on_user_offline",t.ON_STREAM_FALLBACK_UPDATE="on_stream_fallback_update",t.ON_PUBLISH_STREAM="on_publish_stream",t.ON_UPLINK_STATS="on_uplink_stats",t.ON_P2P_LOST="on_p2p_lost",t.ON_REMOVE_STREAM="on_remove_stream",t.ON_ADD_AUDIO_STREAM="on_add_audio_stream",t.ON_ADD_VIDEO_STREAM="on_add_video_stream",t.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="on_token_privilege_will_expire",t.ON_TOKEN_PRIVILEGE_DID_EXPIRE="on_token_privilege_did_expire",t.ON_USER_BANNED="on_user_banned",t.ON_USER_LICENSE_BANNED="on_user_license_banned",t.ON_NOTIFICATION="on_notification",t.ON_CRYPT_ERROR="on_crypt_error",t.MUTE_AUDIO="mute_audio",t.MUTE_VIDEO="mute_video",t.UNMUTE_AUDIO="unmute_audio",t.UNMUTE_VIDEO="unmute_video",t.ON_P2P_OK="on_p2p_ok",t.RECEIVE_METADATA="receive_metadata",t.ON_DATA_STREAM="on_data_stream",t.ON_RTP_CAPABILITY_CHANGE="on_rtp_capability_change",t.ON_REMOTE_DATASTREAM_UPDATE="on_remote_datastream_update",t.ON_REMOTE_FULL_DATASTREAM_INFO="on_remote_full_datastream_info",t.ENABLE_LOCAL_VIDEO="enable_local_video",t.DISABLE_LOCAL_VIDEO="disable_local_video",t.ENABLE_LOCAL_AUDIO="enable_local_audio",t.DISABLE_LOCAL_AUDIO="disable_local_audio",t.ON_PUBLISHED_USER_LIST="on_published_user_list",t}({}),Vo=function(t){return t.SEND_ONLY="SEND_ONLY",t.RECEIVE_ONLY="RECEIVE_ONLY",t}({}),en=function(t){return t.CONNECTED="websocket:connected",t.RECONNECTING="websocket:reconnecting",t.WILL_RECONNECT="websocket:will_reconnect",t.CLOSED="websocket:closed",t.FAILED="websocket:failed",t.ON_MESSAGE="websocket:on_message",t.REQUEST_NEW_URLS="websocket:request_new_urls",t.RECONNECT_CREATE_CONNECTION="websocket:reconnect_create_connection",t.ON_TOKEN_PRIVILEGE_DID_EXPIRE="websocket:on_token_privilege_did_expire",t}({});function EP(t){if(typeof t!="string"||!/^[a-zA-Z0-9 \!\#\$\%\&\(\)\+\-\:\;\<\=\.\>\?\@\[\]\^\_\{\}\|\~\,]{1,64}$/.test(t))throw x.error("Invalid Channel Name ".concat(t)),new Oe(te.INVALID_PARAMS,"The length must be within 64 bytes. The supported characters: a-z,A-Z,0-9,space,!, #, $, %, &, (, ), +, -, :, ;, <, =, ., >, ?, @, [, ], ^, _,  {, }, |, ~, ,")}function vP(t){if(r=t,!(typeof r=="number"&&Math.floor(r)===r&&0<=r&&r<=4294967295||k8(t,1,255)))throw new Oe(te.INVALID_PARAMS,"[String uid] Length of the string: [1,255]. ASCII characters only. [Number uid] The value range is [0,10000]");var r;typeof t=="string"&&x.warn("You input a string as the user ID, to ensure better end-user experience, Agora highly suggests not using a string as the user ID.")}let ap=function(t){return t.TRANSCODE="mix_streaming",t.RAW="raw_streaming",t}({});const dge={alpha:1,height:640,width:360,x:0,y:0,zOrder:0,audioChannel:0},s2={x:0,y:0,width:160,height:160,zOrder:255,alpha:1};function o2(t,r){fs(t.url,"".concat(r,".url"),1,1e3,!1),Wr(t.x)||ir(t.x,"".concat(r,".x"),0,1e4),Wr(t.y)||ir(t.y,"".concat(r,".y"),0,1e4),Wr(t.width)||ir(t.width,"".concat(r,".width"),0,1e4),Wr(t.height)||ir(t.height,"".concat(r,".height"),0,1e4),Wr(t.zOrder)||ir(t.zOrder,"".concat(r,".zOrder"),0,255),Wr(t.alpha)||ir(t.alpha,"".concat(r,".alpha"),0,1,!1)}const hge={audioBitrate:48,audioChannels:1,audioSampleRate:48e3,backgroundColor:0,height:360,lowLatency:!1,videoBitrate:400,videoCodecProfile:100,videoCodecType:1,videoFrameRate:15,videoGop:30,width:640,images:[],userConfigs:[],userConfigExtraInfo:""};let Wm=function(t){return t.WARNING="@live_uap-warning",t.ERROR="@line_uap-error",t.PUBLISH_STREAM_STATUS="@live_uap-publish-status",t.WORKER_STATUS="@live_uap-worker-status",t.REQUEST_NEW_ADDRESS="@live_uap-request-address",t}({}),a2=function(t){return t.REQUEST_WORKER_MANAGER_LIST="@live_req_worker_manager",t}({}),Mi=function(t){return t[t.LIVE_STREAM_RESPONSE_SUCCEED=200]="LIVE_STREAM_RESPONSE_SUCCEED",t[t.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM=454]="LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM",t[t.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR=450]="LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR",t[t.LIVE_STREAM_RESPONSE_BAD_STREAM=451]="LIVE_STREAM_RESPONSE_BAD_STREAM",t[t.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR=400]="LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR",t[t.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST=404]="LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST",t[t.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED=456]="LIVE_STREAM_RESPONSE_NOT_AUTHORIZED",t[t.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE=457]="LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE",t[t.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN=429]="LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN",t[t.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH=452]="LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH",t[t.LIVE_STREAM_RESPONSE_NOT_SUPPORTED=453]="LIVE_STREAM_RESPONSE_NOT_SUPPORTED",t[t.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM=455]="LIVE_STREAM_RESPONSE_MAX_STREAM_NUM",t[t.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR=500]="LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR",t[t.LIVE_STREAM_RESPONSE_WORKER_LOST=501]="LIVE_STREAM_RESPONSE_WORKER_LOST",t[t.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT=502]="LIVE_STREAM_RESPONSE_RESOURCE_LIMIT",t[t.LIVE_STREAM_RESPONSE_WORKER_QUIT=503]="LIVE_STREAM_RESPONSE_WORKER_QUIT",t[t.ERROR_FAIL_SEND_MESSAGE=504]="ERROR_FAIL_SEND_MESSAGE",t[t.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE=30]="PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE",t[t.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT=31]="PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT",t[t.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH=32]="PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH",t[t.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN=33]="PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN",t}({});function CH(t){if(!t.channelName)throw new Oe(te.INVALID_PARAMS,"invalid channelName in info");if(typeof t.uid!="number")throw new Oe(te.INVALID_PARAMS,"invalid uid in info, uid must be a number");return t.token&&fs(t.token,"info.token",1,2047),vP(t.uid),EP(t.channelName),!0}let Fo=function(t){return t[t.SetSdkProfile=0]="SetSdkProfile",t[t.SetSourceChannel=1]="SetSourceChannel",t[t.SetSourceUserId=2]="SetSourceUserId",t[t.SetDestChannel=3]="SetDestChannel",t[t.StartPacketTransfer=4]="StartPacketTransfer",t[t.StopPacketTransfer=5]="StopPacketTransfer",t[t.UpdateDestChannel=6]="UpdateDestChannel",t[t.Reconnect=7]="Reconnect",t[t.SetVideoProfile=8]="SetVideoProfile",t}({}),cp=function(t){return t.NETWORK_DISCONNECTED="NETWORK_DISCONNECTED",t.NETWORK_CONNECTED="NETWORK_CONNECTED",t.PACKET_JOINED_SRC_CHANNEL="PACKET_JOINED_SRC_CHANNEL",t.PACKET_JOINED_DEST_CHANNEL="PACKET_JOINED_DEST_CHANNEL",t.PACKET_SENT_TO_DEST_CHANNEL="PACKET_SENT_TO_DEST_CHANNEL",t.PACKET_RECEIVED_VIDEO_FROM_SRC="PACKET_RECEIVED_VIDEO_FROM_SRC",t.PACKET_RECEIVED_AUDIO_FROM_SRC="PACKET_RECEIVED_AUDIO_FROM_SRC",t.PACKET_UPDATE_DEST_CHANNEL="PACKET_UPDATE_DEST_CHANNEL",t.PACKET_UPDATE_DEST_CHANNEL_REFUSED="PACKET_UPDATE_DEST_CHANNEL_REFUSED",t.PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE="PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE",t}({}),Wa=function(t){return t.RELAY_STATE_IDLE="RELAY_STATE_IDLE",t.RELAY_STATE_CONNECTING="RELAY_STATE_CONNECTING",t.RELAY_STATE_RUNNING="RELAY_STATE_RUNNING",t.RELAY_STATE_FAILURE="RELAY_STATE_FAILURE",t}({}),nS=function(t){return t.RELAY_OK="RELAY_OK",t.SERVER_CONNECTION_LOST="SERVER_CONNECTION_LOST",t.SRC_TOKEN_EXPIRED="SRC_TOKEN_EXPIRED",t.DEST_TOKEN_EXPIRED="DEST_TOKEN_EXPIRED",t}({}),Yn=function(t){return t.High="high",t.Low="low",t.Audio="audio",t.Screen="screen",t.ScreenLow="screen_low",t}({}),as=function(t){return t.DISCONNECT="disconnect",t.CONNECTION_STATE_CHANGE="connection-state-change",t.NETWORK_QUALITY="network-quality",t.STREAM_TYPE_CHANGE="stream-type-change",t.IS_P2P_DISCONNECTED="is-p2p-dis",t.DISCONNECT_P2P="dis-p2p",t.REQUEST_NEW_GATEWAY_LIST="req-gate-url",t.NEED_RENEW_SESSION="need-sid",t.REQUEST_P2P_CONNECTION_PARAMS="request-p2p-connection-params",t.JOIN_RESPONSE="join-response",t.RESET_CONNECTION_EVENTS="reset-connection-events",t.PRE_CONNECT_PC="pre-connect_pc",t.UPDATE_GATEWAY_CONFIG="update-gateway-config",t}({}),SP=function(t){return t.P2P_DISCONNECTED="P2P_DISCONNECTED",t.A_ROUND_WS_FAILED="A_ROUND_WS_FAILED",t.TIMEOUT="TIMEOUT",t.UNKNOWN_REASON="UNKNOWN_REASON",t}({}),Ji=function(t){return t[t.Nothing=0]="Nothing",t[t.Audio=1]="Audio",t[t.LwoVideo=2]="LwoVideo",t[t.Video=4]="Video",t[t.Data=8]="Data",t[t.DataStream0=256]="DataStream0",t[t.DataStream1=512]="DataStream1",t[t.DataStream2=1024]="DataStream2",t[t.DataStream3=2048]="DataStream3",t[t.DataStream4=4096]="DataStream4",t[t.DataStream5=8192]="DataStream5",t[t.DataStream6=16384]="DataStream6",t[t.DataStream7=32768]="DataStream7",t}({}),Gn=function(t){return t.CHINA="CHINA",t.ASIA="ASIA",t.NORTH_AMERICA="NORTH_AMERICA",t.EUROPE="EUROPE",t.JAPAN="JAPAN",t.INDIA="INDIA",t.KOREA="KOREA",t.HKMC="HKMC",t.US="US",t.OCEANIA="OCEANIA",t.SOUTH_AMERICA="SOUTH_AMERICA",t.AFRICA="AFRICA",t.OVERSEA="OVERSEA",t.GLOBAL="GLOBAL",t.EXTENSIONS="EXTENSIONS",t}({});const RH=[Gn.AFRICA,Gn.ASIA,Gn.CHINA,Gn.EUROPE,Gn.GLOBAL,Gn.INDIA,Gn.JAPAN,Gn.NORTH_AMERICA,Gn.OCEANIA,Gn.OVERSEA,Gn.SOUTH_AMERICA];let Bs=function(t){return t.CHINA="CN",t.ASIA="AS",t.NORTH_AMERICA="NA",t.EUROPE="EU",t.JAPAN="JP",t.INDIA="IN",t.KOREA="KR",t.HKMC="HK",t.US="US",t.OCEANIA="OC",t.SOUTH_AMERICA="SA",t.AFRICA="AF",t.OVERSEA="OVERSEA",t.GLOBAL="GLOBAL",t.EXTENSIONS="GLOBAL",t}({});const bP={CHINA:{},ASIA:{CODE:Bs.ASIA,WEBCS_DOMAIN:["ap-web-1-asia.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-asia.agora.io"],PROXY_CS:["proxy-ap-web-asia.agora.io"],CDS_AP:["cds-ap-web-asia.agora.io","cds-ap-web-asia2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-asia.agora.io","sua-ap-web-asia2.agora.io"],UAP_AP:["uap-ap-web-asia.agora.io","uap-ap-web-asia2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"],PROXY_SERVER_TYPE3:["southeast-asia.webrtc-cloud-proxy.sd-rtn.com"]},NORTH_AMERICA:{CODE:Bs.NORTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-north-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-north-america.agora.io"],PROXY_CS:["proxy-ap-web-america.agora.io"],CDS_AP:["cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],UAP_AP:["uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"],PROXY_SERVER_TYPE3:["east-usa.webrtc-cloud-proxy.sd-rtn.com"]},EUROPE:{CODE:Bs.EUROPE,WEBCS_DOMAIN:["ap-web-1-europe.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-europe.agora.io"],PROXY_CS:["proxy-ap-web-europe.agora.io"],CDS_AP:["cds-ap-web-europe.agora.io","cds-ap-web-europe2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-europe.agora.io","sua-ap-web-europe.agora.io"],UAP_AP:["uap-ap-web-europe.agora.io","uap-ap-web-europe2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"],PROXY_SERVER_TYPE3:["europe.webrtc-cloud-proxy.sd-rtn.com"]},JAPAN:{CODE:Bs.JAPAN,WEBCS_DOMAIN:["ap-web-1-japan.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-japan.agora.io"],PROXY_CS:["proxy-ap-web-japan.agora.io"],CDS_AP:["cds-ap-web-japan.agora.io","cds-ap-web-japan2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-japan.agora.io","sua-ap-web-japan2.agora.io"],UAP_AP:["uap-ap-web-japan.agora.io","uap-ap-web-japan2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"],PROXY_SERVER_TYPE3:["japan.webrtc-cloud-proxy.sd-rtn.com"]},INDIA:{CODE:Bs.INDIA,WEBCS_DOMAIN:["ap-web-1-india.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-india.agora.io"],PROXY_CS:["proxy-ap-web-india.agora.io"],CDS_AP:["cds-ap-web-india.agora.io","cds-ap-web-india2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-india.agora.io","sua-ap-web-india2.agora.io"],UAP_AP:["uap-ap-web-india.agora.io","uap-ap-web-india2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"],PROXY_SERVER_TYPE3:["india.webrtc-cloud-proxy.sd-rtn.com"]},KOREA:{CODE:Bs.KOREA,WEBCS_DOMAIN:["ap-web-1-korea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-korea.agora.io"],PROXY_CS:["proxy-ap-web-korea.agora.io"],CDS_AP:["cds-ap-web-korea.agora.io","cds-ap-web-korea2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-korea.agora.io","sua-ap-web-korea2.agora.io"],UAP_AP:["uap-ap-web-korea.agora.io","uap-ap-web-korea2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-korea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-korea.agora.io"],LOG_UPLOAD_SERVER:["logservice-korea.agora.io"],PROXY_SERVER_TYPE3:["korea.webrtc-cloud-proxy.sd-rtn.com"]},HKMC:{CODE:Bs.HKMC,WEBCS_DOMAIN:["ap-web-1-hkmc.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-hkmc.agora.io"],PROXY_CS:["proxy-ap-web-hkmc.agora.io"],CDS_AP:["cds-ap-web-hkmc.agora.io","cds-ap-web-hkmc2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-hkmc.agora.io","sua-ap-web-hkmc2.agora.io"],UAP_AP:["uap-ap-web-hkmc.agora.io","uap-ap-web-hkmc2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-hkmc.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-hkmc.agora.io"],LOG_UPLOAD_SERVER:["logservice-hkmc.agora.io"],PROXY_SERVER_TYPE3:["hkmc.webrtc-cloud-proxy.sd-rtn.com"]},US:{CODE:Bs.US,WEBCS_DOMAIN:["ap-web-1-us.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-us.agora.io"],PROXY_CS:["proxy-ap-web-us.agora.io"],CDS_AP:["cds-ap-web-us.agora.io","cds-ap-web-us2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-us.agora.io","sua-ap-web-us2.agora.io"],UAP_AP:["uap-ap-web-us.agora.io","uap-ap-web-us2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-us.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-us.agora.io"],LOG_UPLOAD_SERVER:["logservice-us.agora.io"],PROXY_SERVER_TYPE3:["us.webrtc-cloud-proxy.sd-rtn.com"]},OVERSEA:{CODE:Bs.OVERSEA,WEBCS_DOMAIN:["ap-web-1-oversea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oversea.agora.io"],PROXY_CS:["proxy-ap-web-oversea.agora.io"],CDS_AP:["cds-ap-web-oversea.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oversea.agora.io"],UAP_AP:["uap-ap-web-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.agora.io"]},GLOBAL:{CODE:Bs.GLOBAL,WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-ap-web-3.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-ap-web-3.agora.io"],UAP_AP:["uap-ap-web-1.agora.io","uap-ap-web-3.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2.agora.io"],LOG_UPLOAD_SERVER:["logservice.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com"]},OCEANIA:{CODE:Bs.OCEANIA,WEBCS_DOMAIN:["ap-web-1-oceania.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oceania.agora.io"],PROXY_CS:["proxy-ap-web-oceania.agora.io"],CDS_AP:["cds-ap-web-oceania.agora.io","cds-ap-web-oceania2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oceania.agora.io","sua-ap-web-oceania2.agora.io"],UAP_AP:["uap-ap-web-oceania.agora.io","uap-ap-web-oceania2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"],PROXY_SERVER_TYPE3:["oceania.webrtc-cloud-proxy.sd-rtn.com"]},SOUTH_AMERICA:{CODE:Bs.SOUTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-south-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-south-america.agora.io"],PROXY_CS:["proxy-ap-web-south-america.agora.io"],CDS_AP:["cds-ap-web-south-america.agora.io","cds-ap-web-south-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-south-america.agora.io","sua-ap-web-south-america2.agora.io"],UAP_AP:["uap-ap-web-south-america.agora.io","uap-ap-web-south-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"],PROXY_SERVER_TYPE3:["south-america.webrtc-cloud-proxy.sd-rtn.com"]},AFRICA:{CODE:Bs.AFRICA,WEBCS_DOMAIN:["ap-web-1-africa.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-africa.agora.io"],PROXY_CS:["proxy-ap-web-africa.agora.io"],CDS_AP:["cds-ap-web-africa.agora.io","cds-ap-web-africa2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-africa.agora.io","sua-ap-web-africa2.agora.io"],UAP_AP:["uap-ap-web-africa.agora.io","uap-ap-web-africa2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"],PROXY_SERVER_TYPE3:["africa.webrtc-cloud-proxy.sd-rtn.com"]},EXTENSIONS:{}};AL&&(bP.CHINA={CODE:Bs.CHINA,WEBCS_DOMAIN:["webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["proxy-web.ap.sd-rtn.com"],CDS_AP:["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-web-2.ap.sd-rtn.com","uap-web-4.ap.sd-rtn.com"],EVENT_REPORT_DOMAIN:["web-3.statscollector.sd-rtn.com"],EVENT_REPORT_BACKUP_DOMAIN:["web-4.statscollector.sd-rtn.com"],LOG_UPLOAD_SERVER:["logservice-china.agora.io"],PROXY_SERVER_TYPE3:["east-cn.webrtc-cloud-proxy.sd-rtn.com"]});let LT=function(t){return t.UPDATE_BITRATE_LIMIT="update_bitrate_limit",t.UPDATE_CLIENT_ROLE_OPTIONS="update_client_role_options",t}({});function IH(t){return!!t&&!(!t.uplink||!t.id)&&t.uplink.max_bitrate!==void 0&&t.uplink.min_bitrate!==void 0}class AH extends Ur{constructor(r,s){super(),K(this,"onICEConnectionStateChange",void 0),K(this,"onConnectionStateChange",void 0),K(this,"onDTLSTransportStateChange",void 0),K(this,"onDTLSTransportError",void 0),K(this,"onICETransportStateChange",void 0),K(this,"onFirstAudioReceived",void 0),K(this,"onFirstVideoReceived",void 0),K(this,"onFirstAudioDecoded",void 0),K(this,"onFirstVideoDecoded",void 0),K(this,"onFirstVideoDecodedTimeout",void 0),K(this,"onSelectedLocalCandidateChanged",void 0),K(this,"onSelectedRemoteCandidateChanged",void 0),K(this,"onICECandidateError",void 0),K(this,"getLocalVideoStats",void 0)}}class PH extends AH{constructor(r,s){super(r,s),K(this,"establishPromise",void 0)}}let _t=function(t){return t.VIDEO="video",t.AUDIO="audio",t}({}),Ws=function(t){return t.UDP_RELAY="udp_relay",t.UDP_TCP_RELAY="udp_tcp_relay",t.TCP_RELAY="tcp_relay",t.RELAY="relay",t}({}),lp=function(t){return t[t.FIRST_CONNECTION=0]="FIRST_CONNECTION",t[t.UDP_TCP_RESTART=1]="UDP_TCP_RESTART",t[t.RELAY_RESTART=2]="RELAY_RESTART",t[t.TCP_RESTART=3]="TCP_RESTART",t[t.OLD_FIRST_CONNECTION=10]="OLD_FIRST_CONNECTION",t[t.OLD_RESTART=11]="OLD_RESTART",t[t.DISCONNECTED_OR_FAILED=20]="DISCONNECTED_OR_FAILED",t}({});const OH=["disconnected","failed"];let Ke=function(t){return t.LocalVideoTrack="videoTrack",t.LocalAudioTrack="audioTrack",t.LocalVideoLowTrack="videoLowTrack",t}({}),qn=function(t){return t.New="new",t.Connected="connected",t.Reconnecting="reconnecting",t.Disconnected="disconnected",t}({}),xt=function(t){return t.AudioMetadata="audioMetadata",t.StateChange="stateChange",t.IceConnectionStateChange="iceConnectionStateChange",t.RequestMuteLocal="requestMuteLocal",t.RequestUnmuteLocal="requestUnmuteLocal",t.RequestRePublish="requestRePublish",t.RequestRePublishDataChannel="requestRePublishDataChannel",t.RequestReSubscribe="requestReSubscribe",t.RequestUploadStats="requestUploadStats",t.RequestUpload="requestUpload",t.MediaReconnectStart="MediaReconnectStart",t.MediaReconnectEnd="MediaReconnectEnd",t.NeedSignalRTT="NeedSignalRTT",t.RequestRestartICE="RequestRestartIce",t.PeerConnectionStateChange="PeerConnectionStateChange",t.RequestReconnect="RequestReconnect",t.RequestReconnectPC="RequestReconnectPC",t.RequestUnpublishForReconnectPC="RequestUnpublishForReconnectPC",t.P2PLost="P2PLost",t.UpdateVideoEncoder="UpdateVideoEncoder",t.ConnectionTypeChange="ConnectionTypeChange",t.RequestLowStreamParameter="RequestLowStreamParameter",t.QueryClientConnectionState="QueryClientConnectionState",t.LocalCandidate="LocalCandidate",t.RequestP2PMuteLocal="requestP2PMuteLocal",t.RequestP2PUnPublish="RequestP2PUnPublish",t.RequestP2PUnmuteRemote="RequestP2PUnmuteRemote",t.RequestP2PMuteRemote="RequestP2PMuteRemote",t.RequestP2PRestartICE="RequestP2PRestartICE",t}({}),vu=function(t){return t.CONNECTING="CONNECTING",t.RECONNECTING="RECONNECTING",t.CONNECTED="CONNECTED",t.CLOSED="CLOSED",t}({}),Su=function(t){return t[t.CONNECT_AP=0]="CONNECT_AP",t[t.AP_CONNECTED=1]="AP_CONNECTED",t[t.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",t[t.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",t[t.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",t[t.CONNECT_WORKER=5]="CONNECT_WORKER",t[t.WORKER_CONNECTED=6]="WORKER_CONNECTED",t[t.CLOSED=7]="CLOSED",t}({}),cs=function(t){return t.CONNECTION_STATE_CHANGE="connection-state-change",t.STATE_CHANGE="state-change",t.INSPECT_RESULT="inspect-result",t.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",t.REQUEST_NEW_WORKER_URL="request-new-worker-url",t}({}),kH=function(t){return t.CONNECTED="transmitter:connected",t.RECONNECTING="transmitter:reconnecting",t.WILL_RECONNECT="transmitter:will_reconnect",t.CLOSED="transmitter:closed",t.FAILED="transmitter:failed",t.ON_MESSAGE="transmitter:on_message",t.REQUEST_NEW_URLS="transmitter:request_new_urls",t.RECONNECT_CREATE_CONNECTION="transmitter:reconnect_create_connection",t.ON_TOKEN_PRIVILEGE_DID_EXPIRE="transmitter:on_token_privilege_did_expire",t.TO_CONNECT_DATACHANNEL="transmitter:to_connect_datachannel",t.FAILBACK="transmitter:failback",t.PRE_CONNECT_PC="transmitter:pre_connect_pc",t}({}),Ch=function(t){return t.CAMERA_CHANGED="camera-changed",t.MICROPHONE_CHANGED="microphone-changed",t.PLAYBACK_DEVICE_CHANGED="playback-device-changed",t.AUDIO_AUTOPLAY_FAILED="audio-autoplay-failed",t.AUTOPLAY_FAILED="autoplay-failed",t.AUDIO_CONTEXT_STATE_CHANGED="audio-context-state-changed",t.SECURITY_POLICY_VIOLATION="security-policy-violation",t}({}),Il=function(t){return t.CONNECTING="CONNECTING",t.RECONNECTING="RECONNECTING",t.CONNECTED="CONNECTED",t.CLOSED="CLOSED",t}({}),Sd=function(t){return t.CONNECTION_STATE_CHANGE="connection-state-change",t.STATE_CHANGE="state-change",t.INSPECT_RESULT="inspect-result",t.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",t.REQUEST_NEW_WORKER_URL="request-new-worker-url",t}({}),rS=function(t){return t[t.CONNECT_AP=0]="CONNECT_AP",t[t.AP_CONNECTED=1]="AP_CONNECTED",t[t.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",t[t.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",t[t.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",t[t.CONNECT_WORKER=5]="CONNECT_WORKER",t[t.WORKER_CONNECTED=6]="WORKER_CONNECTED",t[t.CLOSED=7]="CLOSED",t}({}),li=function(t){return t.CALL="call",t.CANDIDATE="candidate",t.PUBLISH="publish",t.UNPUBLISH="unpublish",t.CONTROL="control",t.RESTART_ICE="restart_ice",t.ACK="ack",t.RESPONSE="response",t.JOIN="join",t.CHECK="check",t}({}),iS=function(t){return t.ABORT="abort",t}({}),zm=function(t){return t.MUTE_LOCAL_AUDIO="mute_local_audio",t.MUTE_LOCAL_VIDEO="mute_local_video",t.UNMUTE_LOCAL_AUDIO="unmute_local_audio",t.UNMUTE_LOCAL_VIDEO="unmute_local_video",t}({}),fge=function(t){return t.P2P_TOKEN_TIMEOUT="p2p_token_timeout",t.P2P_TOKEN_CHANGED="p2p_token_changed",t}({});const pge={[yP.ACCESS_POINT]:{[Uo.NO_FLAG_SET]:{desc:"flag is zero",retry:!1},[Uo.FLAG_SET_BUT_EMPTY]:{desc:"flag is empty",retry:!1},[Uo.INVALID_FALG_SET]:{desc:"invalid flag",retry:!1},[Uo.FLAG_SET_BUT_NO_RE]:{desc:"flag set unilbs but no request",retry:!1},[Uo.INVALID_SERVICE_ID]:{desc:"invalid service id",retry:!1},[Uo.NO_SERVICE_AVAILABLE]:{desc:"no service available",retry:!0},[Uo.NO_SERVICE_AVAILABLE_P2P]:{desc:"no unilbs p2p service available",retry:!0},[Uo.NO_SERVICE_AVAILABLE_VOICE]:{desc:"no unilbs voice service available",retry:!0},[Uo.NO_SERVICE_AVAILABLE_WEBRTC]:{desc:"no unilbs webrtc service available",retry:!0},[Uo.NO_SERVICE_AVAILABLE_CDS]:{desc:"no cds service available",retry:!0},[Uo.NO_SERVICE_AVAILABLE_CDN]:{desc:"no cdn dispatcher service available",retry:!0},[Uo.NO_SERVICE_AVAILABLE_TDS]:{desc:"no tds service available",retry:!0},[Uo.NO_SERVICE_AVAILABLE_REPORT]:{desc:"no unilbs report service available",retry:!0},[Uo.NO_SERVICE_AVAILABLE_APP_CENTER]:{desc:"no app center service available",retry:!0},[Uo.NO_SERVICE_AVAILABLE_ENV0]:{desc:"no unilbs sig env0 service available",retry:!0},[Uo.NO_SERVICE_AVAILABLE_VOET]:{desc:"no unilbs voet service available",retry:!0},[Uo.NO_SERVICE_AVAILABLE_STRING_UID]:{desc:"no string uid service available",retry:!0},[Uo.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS]:{desc:"no webrtc unilbs service available",retry:!0}},[yP.UNILBS]:{[Eu.INVALID_VENDOR_KEY]:{desc:"invalid vendor key, can not find appid",retry:!1},[Eu.INVALID_CHANNEL_NAME]:{desc:"invalid channel name",retry:!1},[Eu.INTERNAL_ERROR]:{desc:"unilbs internal error",retry:!1},[Eu.NO_AUTHORIZED]:{desc:"invalid token, authorized failed",retry:!1},[Eu.DYNAMIC_KEY_TIMEOUT]:{desc:"dynamic key or token timeout",retry:!1},[Eu.NO_ACTIVE_STATUS]:{desc:"no active status",retry:!1},[Eu.DYNAMIC_KEY_EXPIRED]:{desc:"dynamic key expired",retry:!1},[Eu.STATIC_USE_DYNAMIC_KEY]:{desc:"static use dynamic key",retry:!1},[Eu.DYNAMIC_USE_STATIC_KEY]:{desc:"dynamic use static key",retry:!1},[Eu.USER_OVERLOAD]:{desc:"amount of users over load",retry:!1},[Eu.FORBIDDEN_REGION]:{desc:"the request is forbidden in this area",retry:!1},[Eu.CANNOT_MEET_AREA_DEMAND]:{desc:"unable to allocate services in this area",retry:!1}},[yP.STRING_UID_ALLOCATOR]:{[i2.IIIEGAL_APPID]:{desc:"invalid appid",retry:!1},[i2.IIIEGAL_UID]:{desc:"invalid string uid",retry:!1},[i2.INTERNAL_ERROR]:{desc:"string uid allocator internal error",retry:!0}}};function sS(t){const r=pge[Math.floor(t/1e4)];if(!r)return{desc:"unknown error",retry:!1};const s=r[t%1e4];if(!s){if(Math.floor(t/1e4)===yP.ACCESS_POINT){const a=t%1e4;if(a.toString()[0]==="1")return{desc:t.toString(),retry:!1};if(a.toString()[0]==="2")return{desc:t.toString(),retry:!0}}return{desc:"unknown error",retry:!1}}return s}const mge={[Ut.K_TIMESTAMP_EXPIRED]:{desc:"K_TIMESTAMP_EXPIRED",action:"failed"},[Ut.K_CHANNEL_PERMISSION_INVALID]:{desc:"K_CHANNEL_PERMISSION_INVALID",action:"failed"},[Ut.K_CERTIFICATE_INVALID]:{desc:"K_CERTIFICATE_INVALID",action:"failed"},[Ut.K_CHANNEL_NAME_EMPTY]:{desc:"K_CHANNEL_NAME_EMPTY",action:"failed"},[Ut.K_CHANNEL_NOT_FOUND]:{desc:"K_CHANNEL_NOT_FOUND",action:"failed"},[Ut.K_TICKET_INVALID]:{desc:"K_TICKET_INVALID",action:"failed"},[Ut.K_CHANNEL_CONFLICTED]:{desc:"K_CHANNEL_CONFLICTED",action:"failed"},[Ut.K_SERVICE_NOT_READY]:{desc:"K_SERVICE_NOT_READY",action:"tryNext"},[Ut.K_SERVICE_TOO_HEAVY]:{desc:"K_SERVICE_TOO_HEAVY",action:"tryNext"},[Ut.K_UID_BANNED]:{desc:"K_UID_BANNED",action:"failed"},[Ut.K_IP_BANNED]:{desc:"K_IP_BANNED",action:"failed"},[Ut.DATASTREAM2_NOT_AVAILABLE]:{desc:"DATASTREAM2_NOT_AVAILABLE",action:"quit"},[Ut.K_AUTO_REBALANCE]:{desc:"k_AUTO_REBALANCE",action:"recover"},[Ut.ERR_INVALID_VENDOR_KEY]:{desc:"ERR_INVALID_VENDOR_KEY",action:"failed"},[Ut.ERR_INVALID_CHANNEL_NAME]:{desc:"ERR_INVALID_CHANNEL_NAME",action:"failed"},[Ut.WARN_NO_AVAILABLE_CHANNEL]:{desc:"WARN_NO_AVAILABLE_CHANNEL",action:"failed"},[Ut.WARN_LOOKUP_CHANNEL_TIMEOUT]:{desc:"WARN_LOOKUP_CHANNEL_TIMEOUT",action:"tryNext"},[Ut.WARN_LOOKUP_CHANNEL_REJECTED]:{desc:"WARN_LOOKUP_CHANNEL_REJECTED",action:"failed"},[Ut.WARN_OPEN_CHANNEL_TIMEOUT]:{desc:"WARN_OPEN_CHANNEL_TIMEOUT",action:"tryNext"},[Ut.WARN_OPEN_CHANNEL_REJECTED]:{desc:"WARN_OPEN_CHANNEL_REJECTED",action:"failed"},[Ut.WARN_REQUEST_DEFERRED]:{desc:"WARN_REQUEST_DEFERRED",action:"failed"},[Ut.ERR_DYNAMIC_KEY_TIMEOUT]:{desc:"ERR_DYNAMIC_KEY_TIMEOUT",action:"failed"},[Ut.ERR_NO_AUTHORIZED]:{desc:"ERR_NO_AUTHORIZED",action:"failed"},[Ut.ERR_VOM_SERVICE_UNAVAILABLE]:{desc:"ERR_VOM_SERVICE_UNAVAILABLE",action:"tryNext"},[Ut.ERR_NO_CHANNEL_AVAILABLE_CODE]:{desc:"ERR_NO_CHANNEL_AVAILABLE_CODE",action:"failed"},[Ut.ERR_MASTER_VOCS_UNAVAILABLE]:{desc:"ERR_MASTER_VOCS_UNAVAILABLE",action:"tryNext"},[Ut.ERR_INTERNAL_ERROR]:{desc:"ERR_INTERNAL_ERROR",action:"tryNext"},[Ut.ERR_NO_ACTIVE_STATUS]:{desc:"ERR_NO_ACTIVE_STATUS",action:"failed"},[Ut.ERR_INVALID_UID]:{desc:"ERR_INVALID_UID",action:"failed"},[Ut.ERR_DYNAMIC_KEY_EXPIRED]:{desc:"ERR_DYNAMIC_KEY_EXPIRED",action:"failed"},[Ut.ERR_STATIC_USE_DYANMIC_KE]:{desc:"ERR_STATIC_USE_DYANMIC_KE",action:"failed"},[Ut.ERR_DYNAMIC_USE_STATIC_KE]:{desc:"ERR_DYNAMIC_USE_STATIC_KE",action:"failed"},[Ut.ERR_NO_VOCS_AVAILABLE]:{desc:"ERR_NO_VOCS_AVAILABLE",action:"tryNext"},[Ut.ERR_NO_VOS_AVAILABLE]:{desc:"ERR_NO_VOS_AVAILABLE",action:"tryNext"},[Ut.ERR_JOIN_CHANNEL_TIMEOUT]:{desc:"ERR_JOIN_CHANNEL_TIMEOUT",action:"tryNext"},[Ut.ERR_JOIN_BY_MULTI_IP]:{desc:"ERR_JOIN_BY_MULTI_IP",action:"recover"},[Ut.ERR_NOT_JOINED]:{desc:"ERR_NOT_JOINED",action:"failed"},[Ut.ERR_REPEAT_JOIN_REQUEST]:{desc:"ERR_REPEAT_JOIN_REQUEST",action:"quit"},[Ut.ERR_REPEAT_JOIN_CHANNEL]:{desc:"ERR_REPEAT_JOIN_CHANNEL",action:"quit"},[Ut.ERR_INVALID_STRINGUID]:{desc:"ERR_INVALID_STRINGUID",action:"failed"},[Ut.ERR_TOO_MANY_USERS]:{desc:"ERR_TOO_MANY_USERS",action:"tryNext"},[Ut.ERR_SET_CLIENT_ROLE_TIMEOUT]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[Ut.ERR_SET_CLIENT_ROLE_NO_PERMISSION]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[Ut.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE]:{desc:"ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",action:"success"},[Ut.ERR_PUBLISH_REQUEST_INVALID]:{desc:"ERR_PUBLISH_REQUEST_INVALID",action:"failed"},[Ut.ERR_SUBSCRIBE_REQUEST_INVALID]:{desc:"ERR_SUBSCRIBE_REQUEST_INVALID",action:"failed"},[Ut.ERR_NOT_SUPPORTED_MESSAGE]:{desc:"ERR_NOT_SUPPORTED_MESSAGE",action:"failed"},[Ut.ERR_ILLEAGAL_PLUGIN]:{desc:"ERR_ILLEAGAL_PLUGIN",action:"failed"},[Ut.ILLEGAL_CLIENT_ROLE_LEVEL]:{desc:"ILLEGAL_CLIENT_ROLE_LEVEL",action:"failed"},[Ut.ERR_REJOIN_TOKEN_INVALID]:{desc:"ERR_REJOIN_TOKEN_INVALID",action:"failed"},[Ut.ERR_REJOIN_USER_NOT_JOINED]:{desc:"ERR_REJOIN_NOT_JOINED",action:"failed"},[Ut.ERR_INVALID_OPTIONAL_INFO]:{desc:"ERR_INVALID_OPTIONAL_INFO",action:"quit"},[Ut.ERR_TEST_RECOVER]:{desc:"ERR_TEST_RECOVER",action:"recover"},[Ut.ERR_TEST_TRYNEXT]:{desc:"ERR_TEST_TRYNEXT",action:"recover"},[Ut.ERR_TEST_RETRY]:{desc:"ERR_TEST_RETRY",action:"recover"},[Ut.ILLEGAL_AES_PASSWORD]:{desc:"ERR_TEST_RETRY",action:"failed"},[Ut.ERR_TOO_MANY_BROADCASTERS]:{desc:"ERR_TOO_MANY_BROADCASTERS",action:"failed"},[Ut.ERR_TOO_MANY_SUBSCRIBERS]:{desc:"ERR_TOO_MANY_SUBSCRIBERS",action:"failed"},[Ut.ERR_LICENSE_ILLEGAL]:{desc:"ERR_LICENSE_ILLEGAL",action:"quit"},[Ut.ERR_LICENSE_MISSING]:{desc:"ERR_LICENSE_MISSING",action:"quit"},[Ut.ERR_LICENSE_EXPIRED]:{desc:"ERR_LICENSE_EXPIRED",action:"quit"},[Ut.ERR_LICENSE_MINUTES_EXCEEDED]:{desc:"ERR_LICENSE_MINUTES_EXCEEDED",action:"quit"},[Ut.ERR_LICENSE_PERIOD_INVALID]:{desc:"ERR_LICENSE_PERIOD_INVALID",action:"quit"},[Ut.ERR_LICENSE_MULTIPLE_SDK_SERVICE]:{desc:"ERR_LICENSE_MULTIPLE_SDK_SERVICE",action:"quit"}};function MT(t){return mge[t]||{desc:"UNKNOWN_ERROR_".concat(t),action:"failed"}}function NH(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}function c2(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?NH(Object(s),!0).forEach(function(a){K(t,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):NH(Object(s)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))})}return t}function DH(t,r){if(typeof t=="string")return t;const{proxy:s,host:a,port:c}=t;if(r){const u=oe("JOIN_GATEWAY_FALLBACK_PORT")||443;return u===443?"wss://".concat(a,"/ws/?p=").concat(Number(c)+150):"wss://".concat(a,":").concat(u,"/ws/?p=").concat(Number(c)+150)}return s?"wss://".concat(s,"/ws/?h=").concat(a,"&p=").concat(c):"wss://".concat(a,":").concat(c)}const gge=/wss:\/\/(.+)\/ws\/\?h=(.+)&p=([0-9]+)\/?/,_ge=/wss:\/\/(.+)\/ws\/\?p=([0-9]+)\/?/,yge=/wss:\/\/(.+):([0-9]+)\/?/,Ege=/wss:\/\/(.[^\/]+)\/?/;let vge=0;class Sge{constructor(r,s){K(this,"id",0),K(this,"store",void 0),K(this,"recordIndex",void 0),K(this,"websockets",[]),K(this,"try443PortDuration",2e3),K(this,"forceCloseWSDuration",5e3),K(this,"try443PortTimeout",null),K(this,"forceCloseTimeout",null),K(this,"isTry443PortFailed",!1),K(this,"isNormalPortFailed",!1),K(this,"useDoubleDomain",!1),K(this,"useProxy",!1),K(this,"startTime",Date.now()),this.id=++vge,this.try443PortDuration=oe("JOIN_GATEWAY_TRY_443PORT_DURATION")||2e3,this.forceCloseWSDuration=r||5e3,this.store=s}closeAllWebsockets(){this.websockets.forEach(r=>{r.onopen=null,r.onclose=null,r.onmessage=null,r.close()}),this.websockets.length=0}clearTimeout(){this.forceCloseTimeout&&clearTimeout(this.forceCloseTimeout),this.try443PortTimeout&&clearTimeout(this.try443PortTimeout),this.forceCloseTimeout=null,this.try443PortTimeout=null}logger(){var r;const s=Date.now()-this.startTime;for(var a=arguments.length,c=new Array(a),u=0;u<a;u++)c[u]=arguments[u];x.debug("[choose-best-ws ".concat((r=this.store)===null||r===void 0?void 0:r.clientId," ").concat(this.id,"] ").concat(s,"ms:"),...c)}createWebSocket(r,s,a){this.logger("createWebSocket:",r,{isTry443Port:s,hasTimeoutDetection:a});const c=oe("GATEWAY_DOMAINS"),u=Date.now(),h=[],m=c.find(P=>{var N;return ot(N=r.host).call(N,P)});m||(this.useDoubleDomain=!1);const y=[];if(this.useDoubleDomain)c.forEach(P=>{y.push(DH(c2(c2({},r),{},{host:r.host.replace(m,P)}),s))});else{const P=c2({},r);if(s&&m){const N=c.find(G=>G!==m);N&&(P.host=P.host.replace(m,N))}y.push(DH(P,s))}try{y.forEach(P=>{const N=new WebSocket(P);N.binaryType="arraybuffer",h.push(N),this.logger("ws is connecting:",N.url)})}catch(P){if(this.logger("ws create failed"),h.forEach(N=>N.close()),h.length=0,this.useDoubleDomain)return this.useDoubleDomain=!1,this.createWebSocket(r,s,a);if(!s&&Number(r.port)!==443)return this.createWebSocket(r,!0,a);throw new Oe(te.WS_ERR,"init websocket failed! Error: ".concat(P.toString()))}const v=ST();this.store&&this.store.recordJoinChannelService({urls:h.map(P=>P.url),service:"gateway"},this.recordIndex),h.forEach(P=>{P.onopen=()=>{this.logger("onopen: ws ".concat(P.url," open cost ").concat(Date.now()-u,"ms")),this.websockets.forEach(N=>{N!==P&&(N.onopen=null,N.onclose=null,N.onmessage=null,N.close(),this.logger("close backup websocket: ".concat(N.url)))}),this.websockets.length=0,v.resolve(P)},P.onclose=N=>{this.logger("onclose: ws ".concat(P.url," closed cost ").concat(Date.now()-u,"ms state: ").concat(P.readyState));const G=h.every(F=>F.readyState===WebSocket.CLOSED||F.readyState===WebSocket.CLOSING);this.logger("".concat(s?"443":"47xx"," websocket closed, all failed: ").concat(G)),G&&(s||this.isTry443PortFailed||this.useProxy)?(this.logger("onclose: all websocket is closed, ".concat(N.reason)),v.reject({code:N.code,reason:SP.A_ROUND_WS_FAILED})):!s&&G&&!this.isNormalPortFailed&&this.try443PortTimeout&&(this.logger("all 47xx websocket is closed, try 443 port"),this.clearTimeout(),R()),s?this.isTry443PortFailed=G:this.isNormalPortFailed=G},P.onmessage=N=>this.logger("".concat(P.url," onmessage: ").concat(N.data))}),this.websockets.push(...h);const S=()=>{this.websockets.forEach(P=>P.readyState!==WebSocket.OPEN&&P.close())},R=()=>{if(v.isResolved)return S();Nn().os===Yi.MAC_OS&&Br()&&S(),this.createWebSocket(r,!0,!0).then(P=>{v.resolve(P)}).catch(P=>{this.isNormalPortFailed&&v.reject(P),this.logger("try 443 port to create ws failed")}),this.forceCloseTimeout=window.setTimeout(()=>{this.logger("5s timeout close un-opens, isWebsocket created: ",v.isResolved),this.forceCloseTimeout=null,S()},this.forceCloseWSDuration)};return a||(()=>{if(s||this.useProxy)return this.logger("add 5s timeout at ".concat(s?"try-443":"proxy"," condition")),this.forceCloseTimeout=window.setTimeout(()=>{this.forceCloseTimeout=null,S()},this.forceCloseWSDuration);this.try443PortTimeout=window.setTimeout(()=>{this.logger("2s timeout, isWebsocket created: ",v.isResolved),this.try443PortTimeout=null,R()},this.try443PortDuration)})(),v.promise}chooseBestWebsocket(r,s,a,c){return this.useDoubleDomain=!!s,typeof r=="string"&&(r=function(u){let h,m,y;return[,h,m,y]=u.match(gge)||[],h||([,m,y]=u.match(_ge)||[]),m&&y||([,m,y]=u.match(yge)||[]),m&&y||([,m]=u.match(Ege)||[]),m||x.warning("un-destructible url: ",u),{proxy:h,host:m,port:y||"443"}}(r)),this.recordIndex=c,this.useProxy=!!r.proxy,a&&this.useProxy&&(x.warn("cannot use 443 only when use proxy"),a=!1),this.createWebSocket(r,!!a,!1).finally(()=>this.clearTimeout())}}function xH(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}class LH extends Ur{get url(){return this.websocket&&this.websocket.url||null}get reconnectMode(){return this._reconnectMode}set reconnectMode(r){var s;ot(s=["tryNext","recover"]).call(s,r)&&this.resetReconnectCount(r),this._reconnectMode=r}get state(){return this._state}set state(r){r!==this._state&&(this._state=r,this._state==="reconnecting"?this.emit(en.RECONNECTING,this.reconnectReason):this._state==="connected"?this.emit(en.CONNECTED):this._state==="closed"?this.emit(en.CLOSED):this._state==="failed"&&this.emit(en.FAILED))}resetReconnectCount(r){x.debug("websocket reset reconnect count, reason: "+r),this.reconnectCount=0}constructor(r,s){let a=arguments.length>2&&arguments[2]!==void 0&&arguments[2],c=arguments.length>3&&arguments[3]!==void 0&&arguments[3],u=arguments.length>4&&arguments[4]!==void 0&&arguments[4],h=arguments.length>5?arguments[5]:void 0;super(),K(this,"connectionID",0),K(this,"currentURLIndex",0),K(this,"urls",[]),K(this,"_reconnectMode","tryNext"),K(this,"reconnectReason",void 0),K(this,"_initMutex",void 0),K(this,"name",void 0),K(this,"_state","closed"),K(this,"reconnectInterrupter",void 0),K(this,"websocket",void 0),K(this,"retryConfig",void 0),K(this,"reconnectCount",0),K(this,"forceCloseTimeout",5e3),K(this,"onlineReconnectListener",void 0),K(this,"useCompress",void 0),K(this,"tryDoubleDomain",!1),K(this,"use443PortOnly",!1),K(this,"wsInflateLength",0),K(this,"wsDeflateLength",0),K(this,"closeEstablishingWs",()=>{}),K(this,"store",void 0),K(this,"joinGatewayRecordIndex",void 0),this.store=h,this.name=r,this.retryConfig=function(R){for(var P=1;P<arguments.length;P++){var N=arguments[P]!=null?arguments[P]:{};P%2?xH(Object(N),!0).forEach(function(G){K(R,G,N[G])}):Object.getOwnPropertyDescriptors?Object.defineProperties(R,Object.getOwnPropertyDescriptors(N)):xH(Object(N)).forEach(function(G){Object.defineProperty(R,G,Object.getOwnPropertyDescriptor(N,G))})}return R}({},s),this.useCompress=a,this.tryDoubleDomain=c,this.use443PortOnly=u,this._initMutex=new js("websocket",h?h.clientId:void 0);const{timeout:m,timeoutFactor:y}=s,v=Math.max(300,Math.floor(3*m/5)),S=Math.max(1.2,Math.floor(8*y)/10);gc.ONLINE&&(this.retryConfig.timeout=v,this.retryConfig.timeoutFactor=S),yi.on(Vv.NETWORK_STATE_CHANGE,(R,P)=>{R!==P&&(this.resetReconnectCount("network state change: ".concat(P," -> ").concat(R)),R===gc.ONLINE?(this.retryConfig.timeout=v,this.retryConfig.timeoutFactor=S):(this.retryConfig.timeout=m,this.retryConfig.timeoutFactor=y))})}getConnection(){return this.websocket||void 0}async init(r){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const a=await this._initMutex.lock();this._reconnectMode="tryNext",this.forceCloseTimeout=s,this.urls=r,this.state="connecting";try{const c=ST(),u=this.urls[this.currentURLIndex];oe("ENABLE_PREALLOC_PC")&&this.emit(kH.PRE_CONNECT_PC),this.createWebSocketConnection(u).then(c.resolve).catch(c.reject),this.once(en.CLOSED,()=>{c.reject(new Le(te.WS_DISCONNECT))}),this.once(en.CONNECTED,c.resolve),await c.promise}catch{}finally{a()}}close(r,s){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this.reconnectInterrupter&&this.reconnectInterrupter(),this.websocket){this.websocket.onclose=null,this.websocket.onopen=null,this.websocket.onmessage=null;const a=this.websocket;s?setTimeout(()=>a.close(),500):a.close(),this.websocket=void 0}this.state=r?"failed":"closed",this.closeEstablishingWs&&this.closeEstablishingWs()}reconnect(r,s){if(!this.websocket)return void x.warning("[".concat(this.name,"] can not reconnect, no websocket"));r!==void 0&&(this.reconnectMode=r),x.debug("[".concat(this.name,"] reconnect is triggered initiative")),typeof this.joinGatewayRecordIndex=="number"&&this.store&&this.store.recordJoinChannelService({status:"error",errors:[new Error(s)]},this.joinGatewayRecordIndex);const a=this.websocket.onclose;this.websocket.onclose=null,this.websocket.close(),a&&a.bind(this.websocket)({code:9999,reason:s})}sendMessage(r){let s=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!this.websocket||this.websocket.readyState!==WebSocket.OPEN)throw new Le(te.WS_ABORT,"websocket is not ready");try{s||(r=JSON.stringify(r)),this.websocket.send(r)}catch(a){throw new Le(te.WS_ERR,"send websocket message error"+a.toString())}}setWsInflateData(r){this.wsDeflateLength=this.wsDeflateLength+r.originLength,this.wsInflateLength=this.wsInflateLength+r.compressedLength}getWsInflateData(){const r=this.wsInflateLength,s=this.wsDeflateLength;return this.clearWsInflateData(),{wsInflateLength:r,wsDeflateLength:s}}clearWsInflateData(){this.wsInflateLength=0,this.wsDeflateLength=0}async createWebSocketConnection(r){var s;const a=ST();this.connectionID+=1,this.joinGatewayRecordIndex=void 0;const c=S=>{var R;(R=this.store)===null||R===void 0||R.signalChannelOpen(),x.debug("[".concat(this.name,"] websocket opened:"),S),this.reconnectMode="retry",this.state="connected",this.resetReconnectCount("opened"),a.resolve()},u=async S=>{var R;if(x.debug("[".concat(this.name,"] websocket close ").concat((R=this.websocket)===null||R===void 0?void 0:R.url,", code: ").concat(S.code,", reason: ").concat(S.reason,", current mode: ").concat(this.reconnectMode)),this.reconnectCount>=this.retryConfig.maxRetryCount)a.reject(new Le(te.WS_DISCONNECT,"websocket close: ".concat(S.code))),this.close();else{this.state==="connected"&&(this.reconnectReason=S.reason,this.state="reconnecting");const P=Hc(this,en.WILL_RECONNECT,this.reconnectMode,S.reason)||this.reconnectMode,N=await this.reconnectWithAction(P);if(this.state==="closed")return void x.debug("[".concat(this.connectionID,"] ws is closed, no need to reconnect"));if(!N)return a.reject(new Le(te.WS_DISCONNECT,"websocket reconnect failed: ".concat(S.code))),this.close(!0);a.resolve()}},h=S=>{this.emit(en.ON_MESSAGE,S)},m=S=>{x.warn("[".concat(this.connectionID,"] ws open error ").concat(S))};this.websocket&&(this.websocket.onclose=null,this.websocket.close()),oe("GATEWAY_WSS_ADDRESS")&&this.name.startsWith("gateway")&&(r=oe("GATEWAY_WSS_ADDRESS")),x.debug("[".concat(this.name,"] start connect, url:"),r);const y=(s=this.store)===null||s===void 0?void 0:s.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"});try{var v;const S=await this.chooseBestWebsocketConnection(r);this.websocket=S,c&&c(this.websocket.url),this.websocket.onclose=u,this.websocket.onmessage=h,this.websocket.onerror=m,(v=this.store)===null||v===void 0||v.recordJoinChannelService({endTs:Date.now(),status:"success"},y),this.joinGatewayRecordIndex=y}catch(S){const R=this.state==="closed",P=S instanceof Le,N=P&&S.code===te.WS_ABORT,G=P&&S.code===te.WS_ERR,F=P?S.message:S&&(S.reason||S.toString());x.warning("[choose-best-ws] chooseBestWebsocket error: ".concat(F)),this.store&&this.store.recordJoinChannelService({endTs:Date.now(),status:N?"aborted":"error",errors:[S]},y),R||G?(a.reject(R?new Le(te.WS_DISCONNECT,"websocket is closed: ".concat(F)):new Le(te.WS_ERR,"init websocket failed: ".concat(F))),G&&x.error("[".concat(this.name,"] init websocket failed: ").concat(F))):u&&u(S)}return a.promise}async reconnectWithAction(r){let s=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(this.reconnectCount>=this.retryConfig.maxRetryCount||this.urls.length===0||this.state==="closed")return!1;x.warning("[choose-best-ws] action: =>",r),this.onlineReconnectListener||yi.isOnline||!yi.onlineWaiter||(this.onlineReconnectListener=yi.onlineWaiter.then(()=>{this.onlineReconnectListener=void 0}));let a=!0;if(this.reconnectInterrupter=()=>a=!1,s){const h=vL(this.reconnectCount,this.retryConfig);x.debug("[".concat(this.name,"] wait ").concat(h,"ms to reconnect websocket, mode: ").concat(r)),await dt.race([ps(h),this.onlineReconnectListener||new dt(()=>{})])}if(this._state==="closed"||!a)return!1;this.reconnectCount+=1;const c=async(h,m)=>{this.emit(en.RECONNECT_CREATE_CONNECTION,m),await this.createWebSocketConnection(h)};try{if(r==="retry")await c(this.urls[this.currentURLIndex],r);else if(r==="tryNext"){if(this.currentURLIndex+=1,this.currentURLIndex>=this.urls.length)return this.reconnectWithAction("recover",!1);x.debug("[".concat(this.name,"] websocket url length: ").concat(this.urls.length," current index: ").concat(this.currentURLIndex)),await c(this.urls[this.currentURLIndex],r)}else r==="recover"&&(x.debug("[".concat(this.name,"] request new urls")),this.resetReconnectCount("recover mode"),this.urls=await ks(this,en.REQUEST_NEW_URLS),this.currentURLIndex=0,await c(this.urls[this.currentURLIndex],r))}catch(h){var u;x.error("[".concat(this.name,"] reconnect failed ").concat(h&&h.toString()));const m=h==null||(u=h.data)===null||u===void 0?void 0:u.desc;return Array.isArray(m)&&ot(m).call(m,"dynamic key expired")?(this.emit(en.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):this.reconnectWithAction(r,s)}return!0}}class l2 extends LH{constructor(r,s){super(r,s,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(r,s){const a=ST(),c=function(h,m){return new Sge(h,m)}(this.forceCloseTimeout,this.store);this.closeEstablishingWs=()=>{x.debug("[choose-best-ws] close establishing websockets"),c.closeAllWebsockets(),a.reject(new Le(te.WS_ABORT,"choose best websocket aborted"))};const u=oe("GATEWAY_DOMAINS");return x.debug("[choose-best-ws] currentDomain: ",r,", domains: ",u,"total: ".concat(this.urls.length),"current: ".concat(this.currentURLIndex+1)),c.chooseBestWebsocket(r,this.tryDoubleDomain,this.use443PortOnly,s).then(a.resolve).catch(a.reject),a.promise.finally(()=>{this.closeEstablishingWs=void 0})}}class UT extends LH{constructor(r,s){super(r,s,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(r,s){return new dt((a,c)=>{let u=!1;const h=[];this.closeEstablishingWs=()=>{x.debug("[choose-best-ws] close establishing websockets"),h.forEach(G=>{G.onclose=null,G.onopen=null,G.onmessage=null,G.close()}),c(new Le(te.WS_ABORT,"choose best websocket aborted"))};const m=oe("GATEWAY_DOMAINS");let y;const v=r.indexOf("?h="),S=m.find(G=>v!==-1?ot(r).call(r,G,v):ot(r).call(r,G));x.debug("[choose-best-ws] currentDomain: ",S,", domains: ",m);let R=!this.tryDoubleDomain||!S;if(!R&&S){var P;const G=Date.now();try{m.forEach(F=>{const j=v===-1?r.replace(S,F):r.substr(0,v)+r.substr(v).replace(S,F),X=new WebSocket(j);X.binaryType="arraybuffer",h.push(X),x.debug("[choose-best-ws] ws is connecting:",X.url)})}catch{for(x.debug("[choose-best-ws] ws create failed, fallback to single url"),h.forEach(j=>j.close());h.length;)h.pop();R=!0}(P=this.store)===null||P===void 0||P.recordJoinChannelService({urls:h.map(F=>F.url),service:"gateway"},s),h.forEach(F=>{F.onopen=()=>{if(u)return;const j=Date.now()-G;x.debug("[choose-best-ws] ws open cost ".concat(j,"ms")),h.filter(X=>X!==F).forEach(X=>{x.debug("[choose-best-ws]close backup websocket: ".concat(X.url)),X.close()}),u=!0,a(F)},F.onclose=j=>{y=j,!u&&(h.find(X=>!(X.readyState===WebSocket.CLOSED||X.readyState===WebSocket.CLOSING))||(x.debug("[choose-best-ws] all websocket is closed"),u=!0,c(y)))},F.onmessage=j=>{x.debug("[choose-best-ws]".concat(F.url," onmessage: ").concat(j.data))}}),ps(this.forceCloseTimeout).then(()=>{h.forEach(F=>{F.readyState!==WebSocket.OPEN&&F.close()})})}if(R){var N;let G;x.debug("[choose-best-ws] use single url: ",r),(N=this.store)===null||N===void 0||N.recordJoinChannelService({urls:[r],service:"gateway"},s);try{G=new WebSocket(r),h.push(G),G.binaryType="arraybuffer"}catch(F){const j=new Le(te.WS_ERR,"init websocket failed! Error: ".concat(F.toString()));return x.error("[".concat(this.name,"]").concat(j)),void c(j)}G.onopen=()=>{a(G)},G.onclose=F=>{c(F)},G.onmessage=F=>{x.debug("[choose-best-ws]".concat(G.url," onmessage: ").concat(F.data))},ps(this.forceCloseTimeout).then(()=>{G&&G.readyState!==WebSocket.OPEN&&G.close()})}}).then(a=>(this.closeEstablishingWs=void 0,a)).catch(a=>{throw this.closeEstablishingWs=void 0,a})}}class bge extends Ur{get connectionState(){return this._connectionState}set connectionState(r){r!==this._connectionState&&(this._connectionState=r,r===pr.CONNECTED?this.emit($t.WS_CONNECTED):r===pr.RECONNECTING?this.emit($t.WS_RECONNECTING,this._websocketReconnectReason):r===pr.CLOSED&&this.emit($t.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(r,s){super(),K(this,"_disconnectedReason",void 0),K(this,"_websocketReconnectReason",void 0),K(this,"_connectionState",pr.CLOSED),K(this,"reconnectToken",void 0),K(this,"websocket",void 0),K(this,"openConnectionTime",void 0),K(this,"clientId",void 0),K(this,"lastMsgTime",Date.now()),K(this,"uploadCache",[]),K(this,"uploadCacheInterval",void 0),K(this,"rttRolling",new K8(5)),K(this,"pingpongTimer",void 0),K(this,"wsInflateDataTimer",void 0),K(this,"pingpongTimeoutCount",0),K(this,"joinResponse",void 0),K(this,"multiIpOption",void 0),K(this,"initError",void 0),K(this,"spec",void 0),K(this,"store",void 0),K(this,"onWebsocketMessage",a=>{if(a.data instanceof ArrayBuffer)return void this.emit($t.ON_BINARY_DATA,a.data);const c=JSON.parse(a.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(c,"_id")){const u="res-@".concat(c._id);this.emit(u,c._result,c._message)}else if(Object.prototype.hasOwnProperty.call(c,"_type")){if(this.emit(c._type,c._message),c._type===vn.ON_NOTIFICATION&&this.handleNotification(c._message),c._type===vn.ON_USER_BANNED)switch(c._message.error_code){case 14:this.close(Kn.UID_BANNED);break;case 15:this.close(Kn.IP_BANNED);break;case 16:this.close(Kn.CHANNEL_BANNED)}if(c._type===vn.ON_USER_LICENSE_BANNED)switch(c._message.error_code){case Ut.ERR_LICENSE_MISSING:this.close(Kn.LICENSE_MISSING);break;case Ut.ERR_LICENSE_EXPIRED:this.close(Kn.LICENSE_EXPIRED);break;case Ut.ERR_LICENSE_MINUTES_EXCEEDED:this.close(Kn.LICENSE_MINUTES_EXCEEDED);break;case Ut.ERR_LICENSE_PERIOD_INVALID:this.close(Kn.LICENSE_PERIOD_INVALID);break;case Ut.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(Kn.LICENSE_MULTIPLE_SDK_SERVICE);break;case Ut.ERR_LICENSE_ILLEGAL:this.close(Kn.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=r.clientId,this.spec=r,this.store=s,this.websocket=new l2("gateway-".concat(this.clientId),this.spec.retryConfig,!0,oe("JOIN_GATEWAY_USE_DUAL_DOMAIN"),oe("JOIN_GATEWAY_USE_443PORT_ONLY"),s),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===pr.CONNECTED&&this.reconnect("retry",Os.OFFLINE)})}async request(r,s,a,c){const u=dr(6,""),h={_id:u,_type:r,_message:s},m=this.websocket.connectionID,y=()=>new dt((G,F)=>{if(this.connectionState===pr.CONNECTED)return G();const j=()=>{this.off($t.WS_CLOSED,X),G()},X=()=>{this.off($t.WS_CONNECTED,j),F(new Oe(te.WS_ABORT))};this.once($t.WS_CONNECTED,j),this.once($t.WS_CLOSED,X),r!==zt.PUBLISH&&r!==zt.PUBLISH_DATASTREAM&&r!==zt.SUBSCRIBE&&r!==zt.SUBSCRIBE_DATASTREAM&&r!==zt.UNSUBSCRIBE&&r!==zt.UNSUBSCRIBE_DATASTREAM&&r!==zt.UNPUBLISH&&r!==zt.UNPUBLISH_DATASTREAM&&r!==zt.CONTROL&&r!==zt.RESTART_ICE||this.once($t.DISCONNECT_P2P,()=>{F(new Oe(te.DISCONNECT_P2P))}),r!==zt.PUBLISH&&r!==zt.RESTART_ICE||this.once($t.ABORT_P2P_EXECUTION,()=>{F(new Oe(te.DISCONNECT_P2P))})});if(this.connectionState!==pr.CONNECTING&&this.connectionState!==pr.RECONNECTING||r===zt.JOIN||r===zt.REJOIN||await y(),this.websocket.sendMessage(h,!0),c)return;const v=new dt((G,F)=>{let j=!1;const X=(he,Se)=>{j=!0,G({isSuccess:he==="success",message:Se||{}}),this.off($t.WS_CLOSED,ee),this.off($t.WS_RECONNECTING,ee),this.emit($t.REQUEST_SUCCESS,r,s)};this.once("res-@".concat(u),X);const ee=()=>{F(new Oe(te.WS_ABORT,"type: ".concat(r))),this.off($t.WS_CLOSED,ee),this.off($t.WS_RECONNECTING,ee),this.off("res-@".concat(u),X)};this.once($t.WS_CLOSED,ee),this.once($t.WS_RECONNECTING,ee),ps(oe("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==m||j||(x.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(r)),this.emit($t.REQUEST_TIMEOUT,r,s))})});let S=null;try{S=await v}catch(G){if(this.connectionState===pr.CLOSED||r===zt.LEAVE)throw new Oe(te.WS_ABORT);return!this.spec.forceWaitGatewayResponse||a?G.throw():r===zt.JOIN||r===zt.REJOIN?null:(await y(),await this.request(r,s))}if(S.isSuccess)return S.message;const R=Number(S.message.error_code||S.message.code),P=MT(R),N=new Oe(te.UNEXPECTED_RESPONSE,"".concat(P.desc,": ").concat(S.message.error_str),{code:R,data:S.message,desc:P.desc});return P.action==="success"?S.message:(x.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(r,", error_code: ").concat(R,", message: ").concat(P.desc,", action: ").concat(P.action)),R===Ut.ERR_TOO_MANY_BROADCASTERS?((r===zt.JOIN||r===zt.REJOIN)&&(this.initError=N,this.close()),N.throw()):P.action==="failed"?N.throw():P.action==="quit"?(this.initError=N,this.close(),N.throw()):(R===Ut.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=S.message.option,x.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",Os.MULTI_IP)):this.reconnect(P.action,Os.SERVER_ERROR),r===zt.JOIN||r===zt.REJOIN?null:await this.request(r,s)))}waitMessage(r,s){return new dt(a=>{const c=u=>{(!s||s(u))&&(this.off(r,c),a(u))};this.on(r,c)})}uploadWRTCStats(r){if(!this.store.sessionId)return void x.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const s={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:r};this.upload(xT.WRTC_STATS,s)}upload(r,s){const a={_type:r,_message:s};try{this.websocket.sendMessage(a)}catch{const u=oe("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(a),this.uploadCache.length>u&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==pr.CONNECTED)return;const h=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(h._type,h._message)},oe("UPLOAD_CACHE_INTERVAL")||2e3))}}send(r,s){const a={_type:r,_message:s};this.websocket.sendMessage(a)}init(r){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new dt((s,a)=>{this.once($t.WS_CONNECTED,()=>s(this.joinResponse)),this.once($t.WS_CLOSED,c=>a(this.initError||new Oe(te.WS_ABORT,c))),this.connectionState=pr.CONNECTING,this.websocket.init(r).catch(a),this.wsInflateDataTimer&&window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=window.setInterval(()=>{this.handleWsInflateData()},2e4)})}close(r){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.wsInflateDataTimer&&(this.handleWsInflateData(),window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=r||Kn.LEAVE,this.connectionState=pr.CLOSED,x.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close()}async join(){if(!this.joinResponse){this.emit($t.ABORT_P2P_EXECUTION);const r=await ks(this,$t.REQUEST_JOIN_INFO),s=await this.request(zt.JOIN,r);if(!s)return this.emit($t.REPORT_JOIN_GATEWAY,SP.TIMEOUT,this.url||""),!1;this.joinResponse=s,this.emit($t.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=pr.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}async rejoin(){if(!this.reconnectToken)throw new Oe(te.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const r=IT(this,$t.REQUEST_REJOIN_INFO);r.token=this.reconnectToken;const s=await this.request(zt.REJOIN,r);return!!s&&(this.connectionState=pr.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),s.peers&&s.peers.forEach(a=>{this.emit(vn.ON_USER_ONLINE,{uid:a.uid}),a.audio&&this.emit(vn.ON_ADD_AUDIO_STREAM,{uid:a.uid,uint_id:a.uint_id,audio:!0,ssrcId:a.audio_ssrc}),a.video&&this.emit(vn.ON_ADD_VIDEO_STREAM,{uid:a.uid,uint_id:a.uint_id,video:!0,ssrcId:a.video_ssrc}),a.audio_mute?this.emit(vn.MUTE_AUDIO,{uid:a.uid}):this.emit(vn.UNMUTE_AUDIO,{uid:a.uid}),a.video_mute?this.emit(vn.MUTE_VIDEO,{uid:a.uid}):this.emit(vn.UNMUTE_VIDEO,{uid:a.uid}),a.audio_enable_local?this.emit(vn.ENABLE_LOCAL_AUDIO,{uid:a.uid}):this.emit(vn.DISABLE_LOCAL_AUDIO,{uid:a.uid}),a.video_enable_local?this.emit(vn.ENABLE_LOCAL_VIDEO,{uid:a.uid}):this.emit(vn.DISABLE_LOCAL_VIDEO,{uid:a.uid}),a.audio||a.video||this.emit(vn.ON_REMOVE_STREAM,{uid:a.uid,uint_id:a.uint_id})}),!0)}reconnect(r,s){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(r,s)}handleNotification(r){x.debug("[".concat(this.clientId,"] receive notification: "),r);const s=MT(r.code);if(r.code===28&&"detail"in r&&(x.info("[".concat(this.clientId,"] receive recover notification: "),r.detail),this.emit($t.RECOVER_NOTIFICATION,r.detail)),s.action!=="success"){if(s.action!=="failed")return s.action==="quit"?(s.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(Kn.UID_BANNED),void this.close()):void this.reconnect(s.action,Os.SERVER_ERROR);x.error("[".concat(this.clientId,"] ignore error: "),s.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const r=oe("PING_PONG_TIME_OUT"),s=Date.now();this.pingpongTimeoutCount>=r&&(x.warning("[".concat(this.clientId,"] PING-PONG Timeout. Last Socket Message: ").concat(s-this.lastMsgTime,"ms")),s-this.lastMsgTime>oe("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",Os.TIMEOUT):this.request(zt.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const a=Date.now()-s;this.rttRolling.add(a),oe("REPORT_STATS")&&this.send(zt.PING_BACK,{pingpongElapse:a})}).catch(a=>{})}handleWsInflateData(){const{wsInflateLength:r,wsDeflateLength:s}=this.websocket.getWsInflateData();r!==0&&s!==0&&this.upload(xT.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:s,ws_inflate_length:r})}handleWebsocketEvents(){this.websocket.on(en.RECONNECT_CREATE_CONNECTION,r=>{this.emit($t.WS_RECONNECT_CREATE_CONNECTION,r)}),this.websocket.on(en.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(en.CLOSED,()=>{this.connectionState=pr.CLOSED}),this.websocket.on(en.FAILED,()=>{this._disconnectedReason=Kn.NETWORK_ERROR,this.connectionState=pr.CLOSED}),this.websocket.on(en.RECONNECTING,r=>{this._websocketReconnectReason=r,this.joinResponse=void 0,this.connectionState===pr.CONNECTED?this.connectionState=pr.RECONNECTING:this.connectionState=pr.CONNECTING}),this.websocket.on(en.WILL_RECONNECT,(r,s,a)=>{const c=IT(this,$t.IS_P2P_DISCONNECTED),u=c||r!=="retry";c&&r==="retry"&&(x.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),r="tryNext",s=SP.P2P_DISCONNECTED),u&&(x.debug("".concat(this.clientId," will renewSession, reconnect mode: ").concat(r)),this.emit($t.REPORT_JOIN_GATEWAY,s||SP.UNKNOWN_REASON,this.url||""),this.reconnectToken=void 0,this.emit($t.DISCONNECT_P2P)),a(r)}),this.websocket.on(en.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(r=>{x.warning("[".concat(this.clientId,"] rejoin failed ").concat(r)),this.reconnect("tryNext",Os.SERVER_ERROR)}):this.join().catch(r=>{if(this.emit($t.REPORT_JOIN_GATEWAY,r,this.url||""),r instanceof Oe){if(r.code===te.UNEXPECTED_RESPONSE&&r.data.code===Ut.ERR_NO_AUTHORIZED)return this.initError=new Oe(te.TOKEN_EXPIRE,"dynamic key expired"),void this.close(Kn.TOKEN_EXPIRE);x.error("[".concat(this.clientId,"] join gateway request failed"),r.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",Os.SERVER_ERROR):(this.initError=r,this.close())}})}),this.websocket.on(en.REQUEST_NEW_URLS,(r,s)=>{ks(this,$t.REQUEST_RECOVER,this.multiIpOption).then(r).catch(s)}),this.websocket.on(en.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(vn.ON_TOKEN_PRIVILEGE_DID_EXPIRE)}),this.websocket.on(kH.PRE_CONNECT_PC,()=>{this.emit($t.PRE_CONNECT_PC)})}}let Tge=function(t){return t.NATIVE_RTC="native_rtc",t.NATIVE_RTM="native_rtm",t.WEB_RTC="web_rtc",t.WEB_RTM="web_rtm",t}({}),Ei=function(t){return t[t.CHOOSE_SERVER=11]="CHOOSE_SERVER",t[t.CLOUD_PROXY=18]="CLOUD_PROXY",t[t.CLOUD_PROXY_5=20]="CLOUD_PROXY_5",t[t.CLOUD_PROXY_FALLBACK=26]="CLOUD_PROXY_FALLBACK",t}({});function MH(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}function TP(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?MH(Object(s),!0).forEach(function(a){K(t,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):MH(Object(s)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))})}return t}function Gm(t){return t.match(/^[\.\:\d]+$/)?"".concat(t.replace(/[^\d]/g,"-"),".").concat(oe("TURN_DOMAIN")):(x.debug("Cannot recognized as ip address: ".concat(t,", use as host")),t)}function u2(t,r){t.addresses||(t.addresses=[]);const s=function(m,y){if(oe("CONNECT_GATEWAY_WITHOUT_DOMAIN"))return m.map(R=>{let{ip:P,port:N}=R;return{address:"".concat(P,":").concat(N)}});const v=oe("GATEWAY_DOMAINS");let S=v[1]&&ot(y).call(y,v[1])?1:0;return m.map(R=>{let{domain_prefix:P,port:N,ip:G}=R;if(P)return{address:"".concat(P,".").concat(v[S++%v.length],":").concat(N)};const F=/^[\.\:\d]+$/.test(G),j=F?"".concat(G.replace(/[^\d]/g,"-"),".").concat(v[S++%v.length],":").concat(N):"".concat(G,":").concat(N);return F||x.debug("Cannot recognized as ip address: ".concat(G,", use as host")),{ip:G,port:N,address:j}})}(t.addresses,r),a=Array.isArray(t.detail)&&t.detail[18];if(a&&typeof a=="string"){const m=a.split(";");for(let y=0;y<m.length;y++){var c;const v=po(c=m[y]).call(c);s[y]&&v&&(s[y].ip6=v)}}const u=t.detail&&t.detail.candidate;let h;if(u){const[m,y]=u.split(":");m&&y&&(h={port:Number(y),ip:m,address:"".concat(m,":").concat(y)})}return{gatewayAddrs:s,apGatewayAddress:h,uid:t.uid,cid:t.cid,cert:t.cert,vid:t.detail&&t.detail[8],uni_lbs_ip:t.detail&&t.detail[1],res:t,csIp:t.detail&&t.detail[502]}}function _c(t){return typeof t=="number"?t:t.exact||t.ideal||t.max||t.min||0}function UH(t){const r=t._encoderConfig;if(!r)return{};const s={resolution:r.width&&r.height?"".concat(_c(r.width),"x").concat(_c(r.height)):void 0,maxVideoBW:r.bitrateMax,minVideoBW:r.bitrateMin};return typeof r.frameRate=="number"?(s.maxFrameRate=r.frameRate,s.minFrameRate=r.frameRate):r.frameRate&&(s.maxFrameRate=r.frameRate.max||r.frameRate.ideal||r.frameRate.exact||r.frameRate.min,s.minFrameRate=r.frameRate.min||r.frameRate.ideal||r.frameRate.exact||r.frameRate.max),s}function VH(t){return t>=0&&t<.17?1:t>=.17&&t<.36?2:t>=.36&&t<.59?3:t>=.59&&t<=1?4:t>1?5:0}function VT(t,r){let s,a,c;switch(r){case Ei.CHOOSE_SERVER:a=4096,c="choose server";break;case Ei.CLOUD_PROXY:a=1048576,c="proxy";break;case Ei.CLOUD_PROXY_5:a=4194304,c="proxy5";break;case Ei.CLOUD_PROXY_FALLBACK:a=4194310,c="proxy fallback";break;default:throw new Oe(te.UNEXPECTED_ERROR,"multi unlibs response transformer get unknown service id",{csIp:t.detail&&t.detail[502],retry:!1})}if(t.response_body.forEach(u=>{u.buffer&&u.buffer.flag===a&&(s={code:u.buffer.code,addresses:(u.buffer.edges_services||[]).map(h=>TP(TP({},h),{},{ticket:u.buffer.cert})),server_ts:t.enter_ts,uid:u.buffer.uid,cid:u.buffer.cid,cname:u.buffer.cname,detail:TP(TP({},u.buffer.detail),t.detail),flag:u.buffer.flag,opid:t.opid,cert:u.buffer.cert})}),!s)throw new Oe(te.MULTI_UNILBS_RESPONSE_ERROR,"cannot parse response ".concat(c," from multi unilbs response"),{csIp:t.detail&&t.detail[502]});return s}async function FH(t,r){return await dt.all(t.addresses.map(async s=>({address:oe("USE_TURN_IP")?s.ip:Gm(s.ip),tcpport:s.port,udpport:s.port,username:r&&oe("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?r.toString():Ns.username,password:r&&oe("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?await gL(r.toString()):Ns.password})))}function d2(t,r){const s=r.getMediaStreamTrack(!0).getSettings(),a=r.videoHeight||s.height,c=r.videoWidth||s.width;return a&&c?Math.max(Math.min(a,c)/Math.min(_c(t.height),_c(t.width)),1):(x.warning("can't get ori-track's height, default scale down 4 times for low stream"),4)}function Hm(t){let{candidateType:r,relayProtocol:s,type:a,address:c,port:u,protocol:h}=t;const m={candidateType:r,relayProtocol:s,protocol:h};if(a!=="local-candidate"){const y=c.split(".");y.length>=4&&(y[1]="*",y[2]="*"),m.address=y.join("."),m.port=u}return m}function wP(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:oe("SVC_MODE");if(oe("ENABLE_SVC"))return function(r){return r in ZA}(t)?t:ZA.L1T3}const jH={[_t.VIDEO]:[{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"},{key:"video-orientation",extensionName:"urn:3gpp:video-orientation"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"playout-delay",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/playout-delay"},{key:"video-content-type",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-content-type"},{key:"color-space",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/color-space"},{key:"video-timing",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-timing"}],[_t.AUDIO]:[{key:"ssrc-audio-level",extensionName:"urn:ietf:params:rtp-hdrext:ssrc-audio-level"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"}]};function CP(t,r,s){r.forEach(a=>{var c;const u=jH[t].find(m=>{var y;let{key:v}=m;return ot(y=a.extensionName).call(y,v)});if(!u)return;const h=s.find(m=>{let{extensionName:y}=m;return ot(y).call(y,u.key)});h&&ot(c=h.extensionName).call(c,"gdpr_forbidden")&&(a.extensionName=h.extensionName)})}function oS(t,r){r.forEach(s=>{var a;const c=jH[t].find(u=>{var h;let{key:m}=u;return ot(h=s.extensionName).call(h,m)});ot(a=s.extensionName).call(a,"gdpr_forbidden")&&c&&(s.extensionName=c.extensionName)})}function BH(t){return t==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"||ot(t).call(t,"abs-send-time")}function RP(t){return t==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"||ot(t).call(t,"draft-holmer-rmcat-transport-wide-cc-extensions-01")}function WH(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}function zH(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?WH(Object(s),!0).forEach(function(a){K(t,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):WH(Object(s)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))})}return t}function FT(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},a=arguments.length>3?arguments[3]:void 0;const{filterRTX:c,filterVideoFec:u,filterAudioFec:h,filterAudioCodec:m,filterVideoCodec:y}=r,{useXR:v}=s;let S=[],R=[],P=[],N=[],G=!1,F=!1;if(Ba(t).mediaDescriptions.forEach(X=>{a&&a!==X.attributes.direction||(X.media.mediaType!=="video"||G||(R=X.attributes.payloads,N=X.attributes.extmaps,G=!0),X.media.mediaType!=="audio"||F||(S=X.attributes.payloads,P=X.attributes.extmaps,F=!0))}),!N||R.length===0)throw new Error("Cannot get video capabilities from SDP.");if(!P||S.length===0)throw new Error("Cannot get audio capabilities from SDP.");if(R.forEach(X=>{var ee;(ee=X.rtpMap)!==null&&ee!==void 0&&ee.clockRate&&(X.rtpMap.clockRate=parseInt(X.rtpMap.clockRate)),v&&X.rtcpFeedbacks.push({type:"rrtr"})}),S.forEach(X=>{var ee;(ee=X.rtpMap)!==null&&ee!==void 0&&ee.clockRate&&(X.rtpMap.clockRate=parseInt(X.rtpMap.clockRate)),v&&X.rtcpFeedbacks.push({type:"rrtr"})}),c&&(S=S.filter(X=>{var ee;return((ee=X.rtpMap)===null||ee===void 0?void 0:ee.encodingName.toLowerCase())!=="rtx"}),R=R.filter(X=>{var ee;return((ee=X.rtpMap)===null||ee===void 0?void 0:ee.encodingName.toLowerCase())!=="rtx"})),u&&(R=R.filter(X=>{var ee;return!/(red)|(ulpfec)|(flexfec)/i.test(((ee=X.rtpMap)===null||ee===void 0?void 0:ee.encodingName)||"")})),h&&(S=S.filter(X=>{var ee;return!/(red)|(ulpfec)|(flexfec)/i.test(((ee=X.rtpMap)===null||ee===void 0?void 0:ee.encodingName)||"")})),m&&(m==null?void 0:m.length)>0&&(S=S.filter(X=>{var ee;return ot(m).call(m,((ee=X.rtpMap)===null||ee===void 0?void 0:ee.encodingName.toLowerCase())||"")})),y&&(y==null?void 0:y.length)>0){const X=R.filter(ee=>{var he;return ot(y).call(y,((he=ee.rtpMap)===null||he===void 0?void 0:he.encodingName.toLowerCase())||"")});R=X.concat(c?[]:p2(X,R))}const j=oe("UNSUPPORTED_VIDEO_CODEC");return j&&j.length>0&&(R=R.filter(X=>!(X.rtpMap&&ot(j).call(j,X.rtpMap.encodingName.toLowerCase())))),{audioCodecs:S,videoCodecs:R,audioExtensions:P,videoExtensions:N}}function $m(t){const r=Ba(t);let s,a;for(const c of r.mediaDescriptions){if(!s){const u=c.attributes.iceUfrag,h=c.attributes.icePwd;if(!u||!h)throw new Error("Cannot get iceUfrag or icePwd from SDP.");s={iceUfrag:u,icePwd:h}}if(!a){const u=c.attributes.fingerprints;u.length>0&&(a={fingerprints:u})}}if(!a&&r.attributes.fingerprints.length>0&&(a={fingerprints:r.attributes.fingerprints}),!a||!s)throw new Error("Cannot get iceParameters or dtlsParameters from SDP.");return{iceParameters:s,dtlsParameters:a}}function GH(t,r){const s=[],a=t.attributes.ssrcGroups.filter(h=>h.semantic==="FID"),c=t.attributes.ssrcGroups.find(h=>h.semantic==="SIM"),u=t.attributes.ssrcs;if(c)c.ssrcIds.forEach(h=>{var m;const y=(m=a.find(v=>v.ssrcIds[0]===h))===null||m===void 0?void 0:m.ssrcIds[1];s.push({ssrcId:h,rtx:r?y:void 0})});else if(a.length>0){const h=a[0].ssrcIds[0],m=a[0].ssrcIds[1];s.push({ssrcId:h,rtx:r?m:void 0})}else{if(u.length===0)throw new Error("No ssrcs found on local media description.");s.push({ssrcId:u[0].ssrcId})}return s}function HH(t,r,s){const{cname:a}=t;let c=[];r&&(c=$H(r)),c.length===0&&(c=t.iceParameters.candidates.map(S=>({foundation:S.foundation,componentId:"1",transport:S.protocol,priority:S.priority.toString(),connectionAddress:S.ip,port:S.port.toString(),type:S.type,extension:{}})),x.debug("Using candidates from gateway."));const u={fingerprints:t.dtlsParameters.fingerprints.map(S=>({hashFunction:S.algorithm,fingerprint:S.fingerprint}))},h={iceUfrag:t.iceParameters.iceUfrag,icePwd:t.iceParameters.icePwd};let m;switch(t.dtlsParameters.role){case"server":m="passive";break;case"client":m="active";break;case"auto":m="actpass"}const y=AP(t.rtpCapabilities),v=[];return Array.isArray(s)&&s.length>0&&s.forEach(S=>{v.push({kind:_t.VIDEO,ssrcId:S.v,rtx:S.v_rtx,mslabel:"".concat(S.v,"_").concat(S.a)},{kind:_t.AUDIO,ssrcId:S.a,mslabel:"".concat(S.v,"_").concat(S.a)})}),{dtlsParameters:u,iceParameters:h,candidates:c,rtpCapabilities:y,setup:m,cname:a,preSSRCs:v}}function $H(t){let r=[];return t.ip&&typeof t.port=="number"&&(r=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:t.ip,port:t.port.toString(),type:"host",extension:{}}],x.debug("Using remote candidate from AP ".concat(t.ip,":").concat(t.port)),t.ip6&&(r.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:t.ip6,port:t.port.toString(),type:"host",extension:{}}),x.debug("Using IPV6 remote candidate from AP ".concat(t.ip6,":").concat(t.port)))),r}function Y_(t,r,s){const a=[],c=[];return t.forEach(u=>{let{ssrcId:h,rtx:m}=u;const y=dr(8,"track-"),v={ssrcId:h,attributes:zH({label:y,mslabel:s=s||dr(10,""),msid:"".concat(s," ").concat(y)},r&&{cname:r})};if(a.push(v),m!==void 0){const S={ssrcId:m,attributes:zH({label:y,mslabel:s,msid:"".concat(s," ").concat(y)},r&&{cname:r})};a.push(S),c.push({semantic:"FID",ssrcIds:[h,m]})}}),t.length>1&&c.push({semantic:"SIM",ssrcIds:t.map(u=>{let{ssrcId:h}=u;return h})}),{ssrcs:a,ssrcGroups:c}}function aS(t,r){r instanceof Yr&&t.attributes.payloads.forEach(s=>{var a;const c=(a=s.rtpMap)===null||a===void 0?void 0:a.encodingName.toLowerCase();if(!c||["opus","pcmu","pcma","g722"].indexOf(c)===-1)return;s.fmtp||(s.fmtp={parameters:{}}),s.fmtp.parameters.minptime="10",s.fmtp.parameters.useinbandfec="1";const u=r._encoderConfig;u&&c!=="pcmu"&&c!=="pcma"&&c!=="g722"&&(u.bitrate&&!Br()&&(s.fmtp.parameters.maxaveragebitrate="".concat(Math.floor(1e3*u.bitrate))),u.sampleRate&&(s.fmtp.parameters.maxplaybackrate="".concat(u.sampleRate),s.fmtp.parameters["sprop-maxcapturerate"]="".concat(u.sampleRate)),u.stereo&&(s.fmtp.parameters.stereo="1",s.fmtp.parameters["sprop-stereo"]="1"))})}function h2(t){const r=t.attributes.unrecognized.findIndex(s=>s.attField==="x-google-flag"&&s.attValue==="conference");r!==-1&&t.attributes.unrecognized.splice(r,1)}function f2(t,r){var s;if(!(r instanceof Sr&&r._encoderConfig&&r._hints.indexOf(hr.SCREEN_TRACK)===-1))return;const a=r._encoderConfig;Vn().supportMinBitrate&&a.bitrateMin&&t.attributes.payloads.forEach(c=>{var u,h;ot(u=["h264","h265","vp8","vp9","av1"]).call(u,((h=c.rtpMap)===null||h===void 0?void 0:h.encodingName.toLowerCase())||"")&&(c.fmtp||(c.fmtp={parameters:{}}),c.fmtp.parameters["x-google-min-bitrate"]="".concat(a.bitrateMin))}),Vn().supportMinBitrate&&!ot(s=r._hints).call(s,hr.LOW_STREAM)&&a.bitrateMax&&t.attributes.payloads.forEach(c=>{var u,h;ot(u=["h264","h265","vp8","vp9","av1"]).call(u,((h=c.rtpMap)===null||h===void 0?void 0:h.encodingName.toLowerCase())||"")&&(c.fmtp||(c.fmtp={parameters:{}}),c.fmtp.parameters["x-google-start-bitrate"]="".concat(oe("X_GOOGLE_START_BITRATE")||Math.floor(a.bitrateMax)))})}function KH(t){if(t.media.mediaType!=="video")return;const r=Nn();if(r.name!==zn.SAFARI&&r.os!==Yi.IOS)return;const s=t.attributes.extmaps.findIndex(a=>/video-orientation/g.test(a.extensionName));s!==-1&&t.attributes.extmaps.splice(s,1)}function IP(t,r,s){if(!r)return;let a,c;if(t.media.mediaType==="video"?(a=s.videoExtensions,c=s.videoCodecs):(a=s.audioExtensions,c=s.audioCodecs),r.twcc===!0){const u=a.find(h=>RP(h.extensionName));if(u){const h=u.extensionName;t.attributes.extmaps.find(y=>RP(y.extensionName))||t.attributes.extmaps.push({entry:u.entry,extensionName:h}),function(y,v){return v.filter(S=>!!y.find(R=>R.payloadType===S.payloadType&&!!R.rtcpFeedbacks.find(P=>P.type==="transport-cc")))}(c,t.attributes.payloads).forEach(y=>{y.rtcpFeedbacks.find(v=>v.type==="transport-cc")||y.rtcpFeedbacks.push({type:"transport-cc"})})}}else if(r.twcc===!1){const u=t.attributes.extmaps.findIndex(h=>RP(h.extensionName));u!==-1&&t.attributes.extmaps.splice(u,1),t.attributes.payloads.forEach(h=>{const m=h.rtcpFeedbacks.findIndex(y=>y.type==="transport-cc");m!==-1&&h.rtcpFeedbacks.splice(m,1)})}if(r.remb===!0){const u=a.find(h=>BH(h.extensionName));if(u){const h=u.extensionName;t.attributes.extmaps.find(y=>y.extensionName===h)||t.attributes.extmaps.push({entry:u.entry,extensionName:h}),function(y,v){return v.filter(S=>!!y.find(R=>R.payloadType===S.payloadType&&!!R.rtcpFeedbacks.find(P=>P.type==="goog-remb")))}(c,t.attributes.payloads).forEach(y=>{y.rtcpFeedbacks.find(v=>v.type==="goog-remb")||y.rtcpFeedbacks.push({type:"goog-remb"})})}}else if(r.remb===!1){const u=t.attributes.extmaps.findIndex(h=>BH(h.extensionName));u!==-1&&t.attributes.extmaps.splice(u,1),t.attributes.payloads.forEach(h=>{const m=h.rtcpFeedbacks.findIndex(y=>y.type==="goog-remb");m!==-1&&h.rtcpFeedbacks.splice(m,1)})}}function qH(t,r,s){if(Br()||t.media.mediaType!=="video"||!(r instanceof Sr)||s!=="vp9"&&s!=="vp8"||s==="vp8"&&!oe("SIMULCAST")||s==="vp9"&&oe("ENABLE_SVC")||r._scalabilityMode===void 0||r._scalabilityMode.numSpatialLayers<=1)return;const a=s==="vp8"?2:r._scalabilityMode.numSpatialLayers,c=t.attributes.ssrcs[0],u=t.attributes.ssrcGroups.find(m=>m.semantic==="FID"&&m.ssrcIds[0]===c.ssrcId),h={semantic:"SIM",ssrcIds:[c.ssrcId]};for(let m=1;m<a;m++)t.attributes.ssrcs.push({ssrcId:c.ssrcId+m,attributes:Gr(c.attributes)}),h.ssrcIds.push(c.ssrcId+m),u&&(t.attributes.ssrcs.push({ssrcId:u.ssrcIds[1]+m,attributes:Gr(c.attributes)}),t.attributes.ssrcGroups.push({semantic:"FID",ssrcIds:[c.ssrcId+m,u.ssrcIds[1]+m]}));t.attributes.ssrcGroups.unshift(h)}async function YH(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const s=new RTCPeerConnection;s.addTransceiver("video",{direction:"sendonly"}),s.addTransceiver("audio",{direction:"sendonly"}),s.addTransceiver("video",{direction:"recvonly"}),s.addTransceiver("audio",{direction:"recvonly"});const a=(await s.createOffer()).sdp,{send:c,recv:u,sendrecv:h}=function(){let m=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},y=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},v=arguments.length>2?arguments[2]:void 0;const S=FT(v,m,y,"sendonly"),R=FT(v,m,y,"recvonly"),P={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},N={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},G={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(bu(S,R,"videoExtensions",P,N,G),bu(S,R,"videoCodecs",P,N,G),bu(S,R,"audioExtensions",P,N,G),bu(S,R,"audioCodecs",P,N,G),oe("RAISE_H264_BASELINE_PRIORITY")){const F=[],j=[];G.videoCodecs.forEach((X,ee)=>{var he;if(((he=X.rtpMap)===null||he===void 0?void 0:he.encodingName.toLocaleLowerCase())==="h264"){var Se,Te;const ye=G.videoCodecs[ee+1],Ne=ye&&e9(X,ye),Ye=(Se=X.fmtp)===null||Se===void 0?void 0:Se.parameters["profile-level-id"],ht=(Te=X.fmtp)===null||Te===void 0?void 0:Te.parameters["packetization-mode"];!Ye||Ye!==oe("FIRST_H264_PROFILE_LEVEL_ID")||oe("FIRST_PACKETIZATION_MODE")&&ht!==oe("FIRST_PACKETIZATION_MODE")?Ne?j.push([X,ye]):j.push([X]):Ne?F.push([X,ye]):F.push([X])}}),F.length>0&&j.length>0&&(x.debug("raising H264 baseline profile priority"),G.videoCodecs.forEach((X,ee)=>{var he;if(((he=X.rtpMap)===null||he===void 0?void 0:he.encodingName.toLocaleLowerCase())==="h264"){const Se=e9(X,G.videoCodecs[ee+1]),Te=F.shift()||j.shift()||[];Te.length>0&&(Se?G.videoCodecs.splice(ee,2,...Te):G.videoCodecs.splice(ee,1,...Te))}}),N.videoCodecs=N.videoCodecs.filter(X=>{var ee,he;return!(((ee=X.rtpMap)===null||ee===void 0?void 0:ee.encodingName.toLocaleLowerCase())==="h264"&&((he=X.fmtp)===null||he===void 0?void 0:he.parameters["profile-level-id"])!==oe("FIRST_H264_PROFILE_LEVEL_ID"))}),oe("FILTER_SEND_H264_BASELINE")&&(P.videoCodecs=P.videoCodecs.filter(X=>{var ee,he;return!(((ee=X.rtpMap)===null||ee===void 0?void 0:ee.encodingName.toLocaleLowerCase())==="h264"&&((he=X.fmtp)===null||he===void 0?void 0:he.parameters["profile-level-id"])!==oe("FIRST_H264_PROFILE_LEVEL_ID"))})))}return{send:P,recv:N,sendrecv:G}}(t,r,a);try{s.close()}catch{}return{send:c,recv:u,sendrecv:h}}function XH(){const t={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},r=FT(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"recvonly"),s={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},a={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},c={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(bu(t,r,"videoExtensions",s,a,c),bu(t,r,"videoCodecs",s,a,c),bu(t,r,"audioExtensions",s,a,c),bu(t,r,"audioCodecs",s,a,c),oe("RAISE_H264_BASELINE_PRIORITY")){const u=c.videoCodecs.findIndex(h=>h.rtpMap&&h.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&h.fmtp&&h.fmtp.parameters["profile-level-id"]==="42001f");if(u!==-1){const h=c.videoCodecs.findIndex(m=>m.rtpMap&&m.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(h<u){x.debug("raising H264 baseline profile priority");const m=c.videoCodecs[u];c.videoCodecs.splice(u,1),c.videoCodecs.splice(h,0,m)}h!==-1&&(a.videoCodecs=a.videoCodecs.filter(m=>!(m.rtpMap&&m.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&m.fmtp&&m.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:s,recv:a,sendrecv:c}}function bu(t,r,s,a,c,u){if(s==="videoExtensions"||s==="audioExtensions"){const h=[];return t[s].forEach(m=>{r[s].some((y,v)=>{if(m.entry===y.entry&&m.extensionName===y.extensionName)return h.push(v),!0})?u[s].push(m):a[s].push(m)}),void r[s].forEach((m,y)=>{h.indexOf(y)===-1&&c[s].push(m)})}if(s==="videoCodecs"||s==="audioCodecs"){const h=[];return t[s].forEach(m=>{r[s].some((y,v)=>{if(m.payloadType===y.payloadType&&JSON.stringify(m)===JSON.stringify(y))return h.push(v),!0})?u[s].push(m):a[s].push(m)}),void r[s].forEach((m,y)=>{h.indexOf(y)===-1&&c[s].push(m)})}}function AP(t){const{send:r,recv:s,sendrecv:a}=t;if(!a){if(!r||!s)throw new Error("cannot merge rtp capabilities because one of send or recv is empty!");return{send:r,recv:s}}let c,u;return r?(c={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},c.audioCodecs=[...r.audioCodecs,...a.audioCodecs],c.videoCodecs=[...r.videoCodecs,...a.videoCodecs],c.audioExtensions=[...r.audioExtensions,...a.audioExtensions],c.videoExtensions=[...r.videoExtensions,...a.videoExtensions]):c=a,s?(u={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},u.audioCodecs=[...s.audioCodecs,...a.audioCodecs],u.videoCodecs=[...s.videoCodecs,...a.videoCodecs],u.audioExtensions=[...s.audioExtensions,...a.audioExtensions],u.videoExtensions=[...s.videoExtensions,...a.videoExtensions]):u=a,{send:c,recv:u}}function cS(t){t.media.mediaType==="audio"&&t.attributes.payloads.filter(r=>{var s;return((s=r.rtpMap)===null||s===void 0?void 0:s.encodingName.toLowerCase())==="opus"}).forEach(r=>{r.fmtp||(r.fmtp={parameters:{}}),r.fmtp.parameters.stereo="1",r.fmtp.parameters["sprop-stereo"]="1"})}function jT(t,r,s,a){let c=[];if(t===_t.VIDEO){if(oe("H264_PROFILE_LEVEL_ID")&&a==="h264"&&(c=r.videoCodecs.filter(u=>{var h;return ot(h=u.rtpMap&&u.rtpMap.encodingName.toLowerCase()||"").call(h,a)&&u&&u.fmtp&&u.fmtp.parameters["profile-level-id"]===oe("H264_PROFILE_LEVEL_ID")})),!Array.isArray(c)||c.length===0){let u=[];const h=[],m=[],y=[];if(s.videoCodecs.forEach(v=>{const S=v.rtpMap&&v.rtpMap.encodingName.toLowerCase()||"";ot(S).call(S,a)?u.push(v):ot(S).call(S,"vp9")?h.push(v):ot(S).call(S,"vp8")?m.push(v):ot(S).call(S,"h264")&&y.push(v)}),u.length===0){let v="";h.length!==0?(u=h,v="vp9"):m.length!==0?(u=m,v="vp8"):y.length!==0&&(u=y,v="h264"),x.warning("codec ".concat(a," not included in rtpCapabilities, fallback to default payloads: ").concat(v))}u.length!==0&&(c=r.videoCodecs.filter(v=>u.some(S=>S.payloadType===v.payloadType)))}if(c.length===0&&(x.warning("codec ".concat(a," not included in rtpCapabilities, fallback to default payloads: ").concat(r.videoCodecs[0].rtpMap&&r.videoCodecs[0].rtpMap.encodingName)),c=r.videoCodecs),oe("USE_PUB_RTX")||oe("USE_SUB_RTX")){const u=p2(c,r.videoCodecs);c=[...c,...u]}}else c=r.audioCodecs.filter(u=>{var h;return ot(h=u.rtpMap&&u.rtpMap.encodingName.toLowerCase()||"").call(h,a)}),c.length===0&&(x.warning("codec ".concat(a," not included in rtpCapabilities, fallback to opus")),c=r.audioCodecs.filter(u=>{var h;return ot(h=u.rtpMap&&u.rtpMap.encodingName.toLowerCase()||"").call(h,"opus")}));return c}function p2(t,r){const s=t.map(a=>a.payloadType.toString());return r.filter(a=>a.rtpMap&&a.rtpMap.encodingName==="rtx"&&a.fmtp&&a.fmtp.parameters.apt&&ot(s).call(s,a.fmtp&&a.fmtp.parameters.apt))}async function BT(t,r,s){const a=r.toString(),c=QH(a,"offer","remote","exchangeSDP");await t.setRemoteDescription({type:"offer",sdp:a});const u=await t.createAnswer();if(!u.sdp)throw new Error("cannot get answer sdp");let h=u.sdp;h=JH(h,s||{}),c==null||c(h||""),await t.setLocalDescription({type:"answer",sdp:h})}function JH(t,r,s){const a=Ba(t),{useXR:c}=r;return a.mediaDescriptions.forEach(u=>{var h;u.attributes.mid&&(Array.isArray(s)&&!ot(s).call(s,u.attributes.mid)||(u.media.mediaType==="audio"&&cS(u),c&&ot(h=["audio","video"]).call(h,u.media.mediaType)&&u.attributes.payloads.forEach(m=>{m.rtcpFeedbacks.findIndex(y=>y.type==="rrtr")===-1&&m.rtcpFeedbacks.push({type:"rrtr"})})))}),Bm(a)}function QH(t,r,s,a){if(oe("SDP_LOGGING"))return x.upload("exchanging ".concat(s," ").concat(r," SDP during P2PConnection.").concat(a,`
`),t),r==="offer"?c=>{QH(c,"answer",s==="local"?"remote":"local",a)}:void 0}function ZH(t){const r=oe("COMPATIBLE_SDP_EXTENSION");return!!(Array.isArray(r)&&r.length>0)&&r.some(s=>ot(t).call(t,s))}function e9(t,r){try{var s;return((s=t.fmtp)===null||s===void 0?void 0:s.parameters.apt)===r.payloadType.toString()}catch{return!1}}function t9(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}function Al(t,r){return typeof oe(t)===r?oe(t):void 0}function wge(){try{const t=oe("EXPERIMENTS")||{};return typeof t=="string"||Array.isArray(t)?{}:function(r){for(var s=1;s<arguments.length;s++){var a=arguments[s]!=null?arguments[s]:{};s%2?t9(Object(a),!0).forEach(function(c){K(r,c,a[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(a)):t9(Object(a)).forEach(function(c){Object.defineProperty(r,c,Object.getOwnPropertyDescriptor(a,c))})}return r}({},t)}catch(t){return x.debug("handle gateway attributes failed: ",t),{}}}const n9={};function Km(t){(!(arguments.length>1&&arguments[1]!==void 0)||arguments[1])&&x.debug("install service ".concat(t.name)),n9[t.name]=t}function up(t){const r=n9[t];if(!r)throw new Le(te.INVALID_OPERATION,"".concat(t," not found, please use AgoraRTC.use(").concat(t,"Service) to load it first"));return r}function r9(t,r){return up("DataStream").create(t,r)}function PP(){return up("InterceptFrame").create()}function i9(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}function dp(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?i9(Object(s),!0).forEach(function(a){K(t,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):i9(Object(s)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))})}return t}const m2=new Map;class Cge extends Ur{get state(){return this._state}set state(r){if(r===this._state)return;const s=this._state;this._state=r,r==="DISCONNECTED"&&this._disconnectedReason?this.emit(as.CONNECTION_STATE_CHANGE,r,s,this._disconnectedReason):this.emit(as.CONNECTION_STATE_CHANGE,r,s)}get joinGatewayStartTime(){return this._joinGatewayStartTime}set joinGatewayStartTime(r){x.debug("[".concat(this.store.clientId,"] set joinGatewayStartTime at ").concat(r)),this._joinGatewayStartTime=r}constructor(r,s){var a,c,u;super(),K(this,"store",void 0),K(this,"joinInfo",void 0),K(this,"key",void 0),K(this,"ntpOffset",0),K(this,"signal",void 0),K(this,"role",void 0),K(this,"inChannelInfo",{joinAt:null,duration:0}),K(this,"spec",void 0),K(this,"_state","DISCONNECTED"),K(this,"_statsCollector",void 0),K(this,"_disconnectedReason",void 0),K(this,"isSignalRecover",!1),K(this,"hasChangeBGPAddress",!1),K(this,"trafficStatsInterval",void 0),K(this,"networkQualityInterval",void 0),K(this,"_joinGatewayStartTime",0),K(this,"_signalTimeout",!1),K(this,"_clientRoleOptions",void 0),K(this,"_isProactiveJoin",!1),this.store=r,this.spec=s,this.signal=this.store.useP2P?(a={spec:dp(dp({},s),{},{retryConfig:s.websocketRetryConfig}),store:r},(c=(u=up("P2PChannel")).createSubmodule)===null||c===void 0?void 0:c.call(u,a)):new bge(dp(dp({},s),{},{retryConfig:s.websocketRetryConfig}),r),this._statsCollector=s.statsCollector,this.role=s.role||"audience",this._clientRoleOptions=s.clientRoleOptions,this.handleSignalEvents()}async join(r,s,a){this.store.joinGatewayStart(),r.cloudProxyServer!=="disabled"&&(this.hasChangeBGPAddress=!0);const c=Date.now();let u=m2.get(r.cname);if(u||(u=new Map,m2.set(r.cname,u)),this._isProactiveJoin=!0,u.has(r.uid)){const v=new Oe(te.UID_CONFLICT);throw It.joinGateway(r.sid,{lts:c,succ:!1,ec:v.code,addr:null,uid:r.uid,cid:r.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!r.proxyServer,signalChannel:"0",preload:r.preload}),v}u.set(r.uid,!0),this.joinInfo=r,this.key=s;let h=0;this.joinGatewayStartTime=c;const m=r.proxyServer;try{x.debug("[".concat(this.store.clientId,"] use websocket join uid ").concat(h));const v=r.gatewayAddrs.map(S=>{let{address:R}=S;const[P,N]=R.split(":"),G={host:P,port:N};return r.proxyServer&&(G.proxy=r.proxyServer),G});h=(await this.signal.init(v)).uid,x.debug("[".concat(this.store.clientId,"] websocket join uid ").concat(h," cost ").concat(Date.now()-this.joinGatewayStartTime))}catch(v){var y;throw x.error("[".concat(this.store.clientId,"] User join failed"),v.toString()),It.joinGateway(r.sid,{lts:c,succ:!1,ec:((y=v.data)===null||y===void 0?void 0:y.desc)||v.code,errorMsg:v.message,addr:this.signal.url,uid:r.uid,cid:r.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!m,signalChannel:"0",preload:r.preload}),u.delete(r.uid),this.signal.close(),v}return this.state="CONNECTED",this.inChannelInfo.joinAt=Date.now(),x.debug("[".concat(this.store.clientId,"] Connected to gateway server")),this.trafficStatsInterval=window.setInterval(()=>{this.updateTrafficStats().catch(v=>{x.warning("[".concat(this.store.clientId,"] get traffic stats error"),v.toString())})},3e3),this.networkQualityInterval=window.setInterval(()=>{navigator&&navigator.onLine!==void 0&&!navigator.onLine?this.emit(as.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6}):this._signalTimeout?this.emit(as.NETWORK_QUALITY,{downlinkNetworkQuality:5,uplinkNetworkQuality:5}):this.state==="CONNECTED"&&this._statsCollector.trafficStats?this.emit(as.NETWORK_QUALITY,{uplinkNetworkQuality:VH(this._statsCollector.trafficStats.B_unq),downlinkNetworkQuality:VH(this._statsCollector.trafficStats.B_dnq)}):this.emit(as.NETWORK_QUALITY,{uplinkNetworkQuality:0,downlinkNetworkQuality:0})},2e3),this.store.joinGatewayEnd(),h}async leave(){let r=arguments.length>0&&arguments[0]!==void 0&&arguments[0],s=arguments.length>1?arguments[1]:void 0;if(this.state!=="DISCONNECTED"){s!==Kn.FALLBACK&&(this.state="DISCONNECTING");try{r||this.signal.connectionState!==pr.CONNECTED||await function(a,c){return c===1/0?a:dt.race([a,Xpe(c)])}(this.signal.request(zt.LEAVE,void 0,!0),3e3)}catch(a){x.warning("[".concat(this.store.clientId,"] leave request failed, ignore"),a)}this.signal.close(s),s!==Kn.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}}async publish(r,s,a){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Oe(te.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const c={state:"offer",p2p_id:this.store.p2pId,ortc:s,mode:this.spec.mode,extend:oe("PUB_EXTEND"),twcc:!!oe("PUBLISH_TWCC"),rtx:!!oe("USE_PUB_RTX")};try{return(await this.signal.request(zt.PUBLISH,c,!0))._message}catch(u){if(a&&u.data&&u.data.code===Ut.ERR_PUBLISH_REQUEST_INVALID)return x.warning("[".concat(this.store.clientId,"] receive publish error code, retry"),u.toString()),await this.tryUnpubBeforeRepub(r,s),this.publish(r,s,!1);throw u}}async publishDataChannel(r,s,a){var c;if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Oe(te.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const u={stream_id:s.streamId,ordered:s.ordered?1:0,max_retrans_times:(c=s.maxRetransmits)!==null&&c!==void 0?c:10,channel_id:s.channelId,metadata:s.metadata};try{await this.signal.request(zt.PUBLISH_DATASTREAM,u,!0)}catch(h){if(a&&h.data&&h.data.code===Ut.ERR_PUBLISH_REQUEST_INVALID)return x.warning("[".concat(this.store.clientId,"] receive publish datachannels error code, retry"),h.toString()),await this.tryUnpubDataChannelBeforeRepub(r,s),this.publishDataChannel(r,s,!1);throw h}}async unpublish(r,s){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Oe(te.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await this.signal.request(zt.UNPUBLISH,{stream_id:s,ortc:r},!0)}catch(a){x.warning("[".concat(this.store.clientId,"] unpublish warning: "),a)}}async unpublishDataChannel(r){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Oe(te.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await dt.all(r.map(s=>this.signal.request(zt.UNPUBLISH_DATASTREAM,{channel_id:s},!0)))}catch(s){x.warning("unpublish datachannels warning: ",s)}}async presubscribe(r,s,a){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Oe(te.INVALID_OPERATION,"can not presubscribe when connection state is ".concat(this.state));const c={stream_id:r,stream_type:s,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!oe("SUBSCRIBE_TWCC"),rtx:!!oe("USE_SUB_RTX")||void 0,extend:oe("SUB_EXTEND"),svc:Array.isArray(oe("SVC"))&&oe("SVC").length!==0?oe("SVC"):void 0};try{return await this.signal.request(zt.PRE_SUBSCRIBE,c,!0)}catch(u){if(a&&u.data&&u.data.code===Ut.ERR_SUBSCRIBE_REQUEST_INVALID)return x.warning("[".concat(this.store.clientId,"] pre-subscribe error, retry"),u.toString()),this.presubscribe(r,s,!1);throw u}}async subscribe(r,s,a){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Oe(te.INVALID_OPERATION,"can not subscribe when connection state is ".concat(this.state));const c={stream_id:r,stream_type:s.stream_type,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!oe("SUBSCRIBE_TWCC"),rtx:!!oe("USE_SUB_RTX"),extend:oe("SUB_EXTEND"),ssrcId:s.ssrcId,svc:Array.isArray(oe("SVC"))&&oe("SVC").length!==0?oe("SVC"):void 0};try{return(await this.signal.request(zt.SUBSCRIBE,c,!0))._message}catch(u){if(a&&u.data&&u.data.code===Ut.ERR_SUBSCRIBE_REQUEST_INVALID)return x.warning("[".concat(this.store.clientId,"] receiver subscribe error code, retry"),u.toString()),await this.tryUnsubBeforeResub(r,s),await this.subscribe(r,s,!1);throw u}}async subscribeDataChannel(r,s,a){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Oe(te.INVALID_OPERATION,"can not subscribe datachannel when connection state is ".concat(this.state));const c={uid:r,stream_id:s.id,channel_id:s.datachannelId};try{return void await this.signal.request(zt.SUBSCRIBE_DATASTREAM,c,!0)}catch(u){if(a&&u.data&&u.data.code===Ut.ERR_SUBSCRIBE_REQUEST_INVALID)return x.warning("[".concat(this.store.clientId,"] receiver subscribe datachannel error code, retry"),u.toString()),await this.tryUnsubDataChannelBeforeResub(r,s),await this.subscribeDataChannel(r,s,!1);throw u}}async subscribeAll(r,s){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Oe(te.INVALID_OPERATION,"can not massSubscribe when connection state is ".concat(this.state));const a={p2p_id:this.store.p2pId,users:r,dtx:!1,rtx:!!oe("USE_SUB_RTX"),twcc:!!oe("SUBSCRIBE_TWCC"),svc:Array.isArray(oe("SVC"))&&oe("SVC").length!==0?oe("SVC"):void 0};try{return await this.signal.request(zt.SUBSCRIBE_STREAMS,a,!0)}catch(c){if(s&&c.data&&c.data.code===Ut.ERR_SUBSCRIBE_REQUEST_INVALID)return x.warning("[".concat(this.store.clientId,"] receiver massSubscribe error code, retry"),c.toString()),await this.tryMassUnsubBeforeResub(r),await this.subscribeAll(r,!1);throw c}}async setVideoProfile(r){const s=function(a){if(!(a.bitrateMax&&a.bitrateMin&&a.frameRate&&a.height&&a.width))return;let c=a.frameRate,u=a.width,h=a.height,m=!0;return typeof c!="number"&&(c=c.exact||c.ideal||c.max||c.min||0,c||(m=!1)),typeof u!="number"&&(u=u.exact||u.ideal||u.max||u.min||0,u||(m=!1)),typeof h!="number"&&(h=h.exact||h.ideal||h.max||h.min||0,c||(m=!1)),m?{stream_type:0,width:u,height:h,fps:c,start_bps:1e3*a.bitrateMax,min_bps:1e3*a.bitrateMin,target_bps:1e3*a.bitrateMax}:void 0}(r);if(s)return this.signal.request(zt.SET_VIDEO_PROFILE,s);x.debug("[".concat(this.store.clientId,"] encoder config is not complete, do not report to gateway"))}async unsubscribe(r,s){try{await this.signal.request(zt.UNSUBSCRIBE,{p2p_id:this.store.p2pId,ortc:r,stream_id:s},!0)}catch(a){x.warning("[".concat(this.store.clientId,"] unsubscribe warning: "),a)}}async unsubscribeDataChannel(r,s){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Oe(te.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await dt.all(r.map(a=>this.signal.request(zt.UNSUBSCRIBE_DATASTREAM,{stream_id:a,uid:s},!0)))}catch(a){x.warning("unsubscribeDataChannel warning: ",a)}}async massUnsubscribe(r){try{await this.signal.request(zt.UNSUBSCRIBE_STREAMS,r,!0)}catch(s){x.warning("[".concat(this.store.clientId,"] massUnsubscribeAll warning: "),s)}}async reconnectPC(r){const{iceParameters:s,dtlsParameters:a,rtpCapabilities:c}=r;return{gatewayEstablishParams:await this.signal.request(zt.CONNECT_PC,{p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:{iceParameters:s,dtlsParameters:a,rtpCapabilities:c}},!0),gatewayAddress:this.getCurrentGatewayAddress()}}getGatewayInfo(){return this.signal.request(zt.GATEWAY_INFO)}async renewToken(r){await this.signal.request(zt.RENEW_TOKEN,r),this.key=r.token}updateClientRole(r,s){s&&(this._clientRoleOptions=Object.assign({},s)),oe("CLIENT_ROLE_OPTIONS")&&(x.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify(oe("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," ")),this._clientRoleOptions=Object.assign({},oe("CLIENT_ROLE_OPTIONS"))),this.role=r}async setClientRole(r,s){if(s&&(this._clientRoleOptions=Object.assign({},s)),oe("CLIENT_ROLE_OPTIONS")&&(this._clientRoleOptions=Object.assign({},oe("CLIENT_ROLE_OPTIONS")),x.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify(oe("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," "))),this.state!=="CONNECTED")return void(this.role=r);let a,c=0;r==="audience"?this._clientRoleOptions&&this._clientRoleOptions.delay?(a=this._clientRoleOptions.delay,c=1):c=this._clientRoleOptions&&this._clientRoleOptions.level?this._clientRoleOptions.level:2:c=0,await this.signal.request(zt.SET_CLIENT_ROLE,{role:r,level:c,delay:a,client_ts:Date.now()}),this.role=r}async setRemoteVideoStreamType(r,s){await this.signal.request(zt.SWITCH_VIDEO_STREAM,{stream_id:r,stream_type:s})}async setDefaultRemoteVideoStreamType(r){await this.signal.request(zt.DEFAULT_VIDEO_STREAM,{stream_type:r})}async setStreamFallbackOption(r,s){await this.signal.request(zt.SET_FALLBACK_OPTION,{stream_id:r,fallback_type:s})}async pickSVCLayer(r,s){await this.signal.request(zt.PICK_SVC_LAYER,{stream_id:r,spatial_layer:s.spatialLayer,temporal_layer:s.temporalLayer})}async setRTM2Flag(r){await this.signal.request(zt.SET_RTM2_FLAG,{rtm2_flag:r})}async sendExtensionMessage(r,s,a){if(this.store.useP2P)return this.signal.sendExtensionMessage(r,s,a)}getInChannelInfo(){return this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt),dp({},this.inChannelInfo)}async getGatewayVersion(){return(await this.signal.request(zt.GATEWAY_INFO)).version}reset(){if(this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt,this.inChannelInfo.joinAt=null),this.trafficStatsInterval&&(window.clearInterval(this.trafficStatsInterval),this.trafficStatsInterval=void 0),this.joinInfo){const r=m2.get(this.joinInfo.cname);r&&r.delete(this.joinInfo.uid)}this.joinInfo=void 0,this.key=void 0,this.networkQualityInterval&&(window.clearInterval(this.networkQualityInterval),this.networkQualityInterval=void 0)}updateTurnConfigFromSignal(){if(!this.joinInfo)return;const r=function(s){let a;return a=s.startsWith("dc")?s.match(/(dc\:\/\/)?([^:]+):(\d+)/):s.match(/(wss\:\/\/)?([^:]+):(\d+)/),a?{username:Ns.username,password:Ns.password,turnServerURL:a[2],tcpport:parseInt(a[3])+30,udpport:parseInt(a[3])+30,forceturn:!1}:null}((this.joinInfo.cloudProxyServer==="disabled"?this.signal.url:this.joinInfo.gatewayAddrs[this.signal.currentURLIndex].address)||"");this.joinInfo.turnServer.serversFromGateway=[],r&&this.joinInfo.turnServer.mode!=="off"&&this.joinInfo.cloudProxyServer==="disabled"&&this.joinInfo.turnServer.serversFromGateway.push(dp(dp({},Ns),{},{turnServerURL:r.turnServerURL,tcpport:r.tcpport,udpport:r.udpport,username:this.joinInfo.uid.toString(),password:this.joinInfo.token}))}async updateTrafficStats(){if(this.state!=="CONNECTED")return;const r=await this.signal.request(zt.TRAFFIC_STATS,void 0,!0);r.timestamp=Date.now(),r.ntp_offset!=null&&(this.ntpOffset=r.ntp_offset),r.peer_delay.forEach(s=>{const a=this._statsCollector.trafficStats&&this._statsCollector.trafficStats.peer_delay.find(c=>c.peer_uid===s.peer_uid);a&&a.B_st!==s.B_st&&YA(()=>{this.emit(as.STREAM_TYPE_CHANGE,s.peer_uid,s.B_st)})}),this._statsCollector.updateTrafficStats(r)}getJoinMessage(r){if(!this.joinInfo||!this.key)throw new Oe(te.UNEXPECTED_ERROR,"can not generate join message, no join info");const s=Object.assign({},this.joinInfo.apResponse);let a=oe("REPORT_APP_SCENARIO");if(typeof a!="string")try{a=JSON.stringify(a)}catch{a=void 0}var c;a&&a.length>128&&(a=void 0),this.store.hasStartJoinChannel=!0,this.store.isABTestSuccess||this.emit(as.UPDATE_GATEWAY_CONFIG),c=this.store.clientId,ot(tS).call(tS,c)||tS.push(c);const u=!(Br()||b8(87)||dz())&&typeof oe("ENABLE_PRE_SUB")=="boolean"&&oe("ENABLE_PRE_SUB"),h=!dz()&&Al("ENABLE_PREALLOC_PC","boolean"),m=wge(),y=bT(87)||function(){const S=Nn();if(S.name!==zn.SAFARI||!S.browserVersion)return!1;const R=S.browserVersion.split(".");return Number(R[0])>15||Number(R[0])===15&&Number(R[1])>=4}(),v=dp({license:this.joinInfo.license,p2p_id:this.store.p2pId,session_id:this.joinInfo.sid,app_id:this.joinInfo.appId,channel_key:this.key,channel_name:this.joinInfo.cname,sdk_version:wl,browser:navigator.userAgent,process_id:oe("PROCESS_ID"),mode:this.store.useP2P?"p2p":this.spec.mode,codec:this.spec.codec,role:this.role,has_changed_gateway:this.hasChangeBGPAddress,ap_response:s,extend:oe("JOIN_EXTEND"),details:{6:this.joinInfo.stringUid,cservice_map:this.joinInfo.cloudProxyServer==="proxy3"?"1":this.joinInfo.cloudProxyServer==="proxy5"?"2":void 0},features:{rejoin:!0},optionalInfo:this.joinInfo.optionalInfo,appScenario:a,attributes:{userAttributes:dp({enableEncodedTransform:!!oe("ENABLE_AUDIO_METADATA")&&y||!!oe("ENABLE_AUDIO_TOPN")&&cL(zn.CHROME,87,116)||void 0,enableAudioMetadata:!!oe("ENABLE_AUDIO_METADATA")&&y,enableAudioPts:!!oe("ENABLE_AUDIO_PTS_METADATA")&&y,topnSmoothLevel:oe("TOPN_SMOOTH_LEVEL"),topnNewSpeakerDelay:oe("TOPN_NEW_SPEAKER_DELAY"),topnSwitchHoldMs:oe("TOPN_SWITCH_HOLD_MS"),topnAudioGain:oe("TOPN_AUDIO_GAIN"),enablePublishedUserList:oe("ENABLE_PUBLISHED_USER_LIST"),maxSubscription:oe("MAX_SUBSCRIPTION"),subscribeAudioFilterTopN:Al("SUBSCRIBE_AUDIO_FILTER_TOPN","number"),enablePublishAudioFilter:Al("ENABLE_PUBLISH_AUDIO_FILTER","boolean"),enableUserLicenseCheck:Al("ENABLE_USER_LICENSE_CHECK","boolean"),enableRTX:oe("USE_PUB_RTX")===!0||oe("USE_SUB_RTX")===!0||void 0,disableFEC:oe("DISABLE_FEC"),enableNTPReport:!!oe("ENABLE_NTP_REPORT")||void 0,enableInstantVideo:!!oe("ENABLE_INSTANT_VIDEO")||void 0,enableFulllinkAvSync:!!oe("ENABLE_FULL_LINK_AV_SYNC")||void 0,enableDataStream2:Al("ENABLE_DATASTREAM_2","boolean"),enableAutFeedback:!!oe("ENABLE_AUT_FEEDBACK")||void 0,rtm2Flag:typeof this.joinInfo.rtmFlag=="number"?this.joinInfo.rtmFlag:void 0,enableUserAutoRebalanceCheck:!!oe("ENABLE_USER_AUTO_REBALANCE_CHECK"),enableXR:Al("USE_XR","boolean"),enableLossbasedBwe:Al("ENABLE_LOSSBASED_BWE","boolean"),enableAutCC:!!oe("ENABLE_AUT_CC")||void 0,enableCCFallback:Al("ENABLE_CC_FALLBACK","boolean"),enablePreallocPC:h,preSubNum:u?Al("PRE_SUB_NUM","number"):void 0,enablePubTWCC:Al("PUBLISH_TWCC","boolean"),enableSubTWCC:Al("SUBSCRIBE_TWCC","boolean"),enablePubRTX:Al("USE_PUB_RTX","boolean"),enableSubRTX:Al("USE_SUB_RTX","boolean"),enableSubSVC:oe("ENABLE_SVC")?oe("ENABLE_SVC_DEFAULT_CODECS"):Array.isArray(oe("SVC"))&&oe("SVC").length!==0?oe("SVC"):void 0,enableSvcExtended:oe("ENABLE_SVC")&&Array.isArray(oe("SVC_EXTENDED"))&&oe("SVC_EXTENDED").length!==0?oe("SVC_EXTENDED"):void 0},m)},join_ts:this.joinGatewayStartTime},r);return this.joinInfo.stringUid&&(v.string_uid=this.joinInfo.stringUid),this.joinInfo.aesmode&&this.joinInfo.aespassword&&(v.aes_mode=this.joinInfo.aesmode,oe("ENCRYPT_AES")?(v.aes_secret=this.joinInfo.aespassword,v.aes_encrypt=!0):v.aes_secret=this.joinInfo.aespassword,this.joinInfo.aessalt&&(v.aes_salt=this.joinInfo.aessalt)),s.addresses[this.signal.websocket.currentURLIndex]&&(v.ap_response.ticket=s.addresses[this.signal.websocket.currentURLIndex].ticket,delete s.addresses),this.joinInfo.defaultVideoStream!==void 0&&(v.default_video_stream=this.joinInfo.defaultVideoStream),v}getRejoinMessage(){if(!this.joinInfo)throw new Oe(te.UNEXPECTED_ERROR,"can not generate rejoin message, no join info");return{session_id:this.joinInfo.sid,channel_name:this.joinInfo.cname,cid:this.joinInfo.cid,uid:this.joinInfo.uid,vid:Number(this.joinInfo.vid)}}handleSignalEvents(){this.signal.on($t.WS_RECONNECT_CREATE_CONNECTION,r=>{this.joinGatewayStartTime=Date.now()}),this.signal.on($t.WS_RECONNECTING,r=>{this.joinInfo&&It.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:r||Os.NETWORK_ERROR}),this.joinInfo&&(this.state="RECONNECTING",It.sessionInit(this.joinInfo.sid,{lts:new Date().getTime(),extend:this.isSignalRecover?{recover:!0}:{rejoin:!0},cname:this.joinInfo.cname,appid:this.joinInfo.appId,mode:this.spec.mode,stringUid:this.joinInfo.stringUid,channelProfile:this.spec.mode==="live"?1:0,channelMode:0,lsid:this.joinInfo.sid,clientRole:this.role==="audience"?2:1,buildFormat:1}),this.isSignalRecover=!1,this.joinGatewayStartTime=Date.now())}),this.signal.on($t.WS_CLOSED,r=>{let s;switch(r){case Kn.LEAVE:s=Os.LEAVE;break;case Kn.UID_BANNED:case Kn.IP_BANNED:case Kn.CHANNEL_BANNED:case Kn.SERVER_ERROR:s=Os.SERVER_ERROR;break;case Kn.FALLBACK:s=Os.FALLBACK;break;case Kn.LICENSE_MISSING:case Kn.LICENSE_EXPIRED:case Kn.LICENSE_MINUTES_EXCEEDED:case Kn.LICENSE_PERIOD_INVALID:case Kn.LICENSE_MULTIPLE_SDK_SERVICE:case Kn.LICENSE_ILLEGAL:case Kn.TOKEN_EXPIRE:s=r;break;default:s=Os.NETWORK_ERROR}x.debug("[".concat(this.store.clientId,"] [signal] websocket closed, reason: ").concat(s||"undefined -> "+Os.NETWORK_ERROR)),this.joinInfo&&It.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:r===Kn.LEAVE?1:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:s}),this._disconnectedReason=r,r!==Kn.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}),this.signal.on($t.WS_CONNECTED,()=>{if(this.updateTurnConfigFromSignal(),this.state="CONNECTED",this.joinInfo){if(this.role==="audience"){const r=oe("CLIENT_ROLE_OPTIONS")||this._clientRoleOptions;r&&(r.level||r.delay)&&(x.debug("[".concat(this.store.clientId,"] patch to send set client role, role: ").concat(this.role,", mode: ").concat(this.spec.mode,", level: ").concat(r.level,", delay: ").concat(r.delay)),this.setClientRole(this.role,r))}if(It.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!0,ec:null,vid:this.joinInfo.vid,addr:this.signal.url,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload,isABTestSuccess:this.store.isABTestSuccess}),this._isProactiveJoin=!1,this.joinInfo.useLocalAccessPoint&&this.joinInfo.setLocalAPVersion===1){const r=this.signal.url&&this.signal.url.match(/wss\:\/\/([^:]+):(\d+)/);if(!r)return void x.error("[".concat(this.store.clientId,"] set local access point after joined failed: ").concat(r));tr("EVENT_REPORT_DOMAIN",r[1]),tr("EVENT_REPORT_BACKUP_DOMAIN",r[1]),tr("LOG_UPLOAD_SERVER","".concat(r[1],":6444"))}}}),this.signal.on(vn.ON_UPLINK_STATS,r=>{this._statsCollector.updateUplinkStats(r)}),this.signal.on($t.REQUEST_RECOVER,(r,s,a)=>{if(!this.joinInfo)return a(new Oe(te.UNEXPECTED_ERROR,"gateway: can not recover, no join info"));r&&(this.joinInfo.multiIP=r,this.hasChangeBGPAddress=!0),this.isSignalRecover=!0,ks(this,as.REQUEST_NEW_GATEWAY_LIST).then(s).catch(a)}),this.signal.on($t.REQUEST_JOIN_INFO,async(r,s,a)=>{var c;if(this.updateTurnConfigFromSignal(),this.store.useP2P)return void r(this.getJoinMessage({ortc:{}}));const u=Gr((c=this.joinInfo)===null||c===void 0?void 0:c.turnServer);if(oe("NEW_TURN_MODE")&&u){let v=u.servers,S=u.serversFromGateway;const R=this.signal.currentURLIndex;v.length>0&&(v=[v[R%v.length]],u.servers=v),Array.isArray(S)&&S.length>0&&(S=[S[0]],u.serversFromGateway=S),x.debug("[".concat(this.store.clientId,"] use single turn, use turn server index: ").concat(R))}const{iceParameters:h,dtlsParameters:m,rtpCapabilities:y}=await ks(this,as.REQUEST_P2P_CONNECTION_PARAMS,{turnServer:u});try{r(this.getJoinMessage({ortc:{iceParameters:h,dtlsParameters:m,rtpCapabilities:y,version:"2"}}))}catch(v){s(v)}}),this.signal.on($t.REQUEST_REJOIN_INFO,r=>{r(this.getRejoinMessage())}),this.signal.on($t.REPORT_JOIN_GATEWAY,(r,s)=>{if(!this.joinInfo)return;let a,c="";var u;r instanceof Oe?(a=((u=r.data)===null||u===void 0?void 0:u.desc)||r.code,c=r.message):a=r,It.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!1,ec:a,errorMsg:c,addr:s,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload})}),this.signal.on($t.IS_P2P_DISCONNECTED,r=>{r(IT(this,as.IS_P2P_DISCONNECTED))}),this.signal.on($t.DISCONNECT_P2P,()=>{this.emit(as.DISCONNECT_P2P)}),this.signal.on($t.REQUEST_SUCCESS,()=>{this._signalTimeout=!1}),this.signal.on($t.REQUEST_TIMEOUT,()=>{this._signalTimeout=!0}),this.signal.on($t.JOIN_RESPONSE,r=>{const s=this.getCurrentGatewayAddress();this.emit(as.JOIN_RESPONSE,r,s)}),this.signal.on($t.PRE_CONNECT_PC,async()=>{if(this.joinInfo){this.updateTurnConfigFromSignal();const r=this.getCurrentGatewayAddress(),s=oe("FINGERPRINT")||this.joinInfo.apResponse.addresses[this.signal.currentURLIndex].fingerprint;if(r&&s){const a=$H(r);this.emit(as.PRE_CONNECT_PC,{candidates:a,fingerprint:s})}}}),this.signal.on($t.RECOVER_NOTIFICATION,r=>{this.joinInfo&&typeof oe("AP_REQUEST_DETAIL")=="string"&&(this.joinInfo.apRequestDetail="".concat(oe("AP_REQUEST_DETAIL"),";").concat(r))})}async tryUnsubBeforeResub(r,s){try{await this.signal.request(zt.UNSUBSCRIBE,{p2p_id:this.store.p2pId,stream_id:r,ortc:[s]},!0)}catch(a){throw x.warning("[".concat(this.store.clientId,"] tryUnsubBeforeResub warning"),a),a}}async tryUnsubDataChannelBeforeResub(r,s){try{await this.signal.request(zt.UNSUBSCRIBE,{stream_id:s.id},!0)}catch(a){throw x.warning("unsubscribe datachannel warning",a),a}}async tryUnpubBeforeRepub(r,s){try{await this.signal.request(zt.UNPUBLISH,{stream_id:r,ortc:s},!0)}catch(a){throw x.warning("[".concat(this.store.clientId,"] tryUnpubBeforeRepub warning: "),a),a}}async tryUnpubDataChannelBeforeRepub(r,s){try{await this.signal.request(zt.UNPUBLISH_DATASTREAM,{channnel_id:s.channelId},!0)}catch(a){throw x.warning("unpublish datastream warning: ",a),a}}async tryMassUnsubBeforeResub(r){const s={users:r.map(a=>({stream_id:a.stream_id,stream_type:a.stream_type}))};try{await this.signal.request(zt.UNSUBSCRIBE_STREAMS,s,!0)}catch(a){throw x.warning("[".concat(this.store.clientId,"] tryMassUnsubBeforeResub warning"),a),a}}async muteLocal(r,s){const a={action:r.find(c=>c.stream_type===Yn.Audio)?"mute_local_audio":"mute_local_video",p2p_id:this.store.p2pId,ortc:r,stream_id:s};try{await this.signal.request(zt.CONTROL,a,!0,!0)}catch(c){throw x.warning("[".concat(this.store.clientId,"] gateway muteLocal warning: "),c),c}}async unmuteLocal(r,s){const a={action:r.find(c=>c.stream_type===Yn.Audio)?"unmute_local_audio":"unmute_local_video",p2p_id:this.store.p2pId,ortc:r,stream_id:s};try{await this.signal.request(zt.CONTROL,a,!0,!0)}catch(c){throw x.warning("[".concat(this.store.clientId,"] gateway unmuteLocal warning: "),c),c}}async muteRemote(r,s){const a={action:r===_t.AUDIO?"mute_remote_audio":"mute_remote_video",p2p_id:this.store.p2pId,stream_id:s};try{await this.signal.request(zt.CONTROL,a,!0,!0)}catch(c){throw x.warning("[".concat(this.store.clientId,"] gateway muteRemote warning: "),c),c}}async unmuteRemote(r,s){const a={action:r===_t.AUDIO?"unmute_remote_audio":"unmute_remote_video",p2p_id:this.store.p2pId,stream_id:s};try{await this.signal.request(zt.CONTROL,a,!0,!0)}catch(c){throw x.warning("[".concat(this.store.clientId,"] gateway unmuteRemote warning: "),c),c}}uploadWRTCStats(r){this.signal.uploadWRTCStats(r)}upload(r,s){this.signal.upload(r,s)}getSignalRTT(){return this.signal.rtt}async restartICE(r){const s={p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:r};try{return await this.signal.request(zt.RESTART_ICE,s,!0)}catch(a){throw x.warning("[".concat(this.store.clientId,"] P2PChannel.restartICE warning: "),a),a}}reconnect(r,s){this.state==="CONNECTED"&&this.signal.reconnect(r||void 0,s||Os.P2P_FAILED)}getCurrentGatewayAddress(){var r,s;if(!oe("GATEWAY_WSS_ADDRESS"))return oe("USE_CANDIDATE_FROM_AP_DETAIL")&&(r=this.joinInfo)!==null&&r!==void 0&&r.apGatewayAddress?(x.debug("[".concat(this.store.clientId,"] use candidate from ap detail, ").concat(JSON.stringify(this.joinInfo.apGatewayAddress))),this.joinInfo.apGatewayAddress):(s=this.joinInfo)!==null&&s!==void 0&&s.gatewayAddrs?this.joinInfo.gatewayAddrs[this.signal.currentURLIndex]:void 0}async setPublishAudioFilterEnabled(r){await this.signal.request(zt.SET_PARAMETER,{enablePublishAudioFilter:r})}}let OP=0,g2=0;function bd(t,r,s,a){return new dt((c,u)=>{r.timeout=r.timeout||oe("HTTP_CONNECT_TIMEOUT"),r.responseType=r.responseType||"json",r.data&&!s?(r.data=JSON.stringify(r.data),OP+=vh(r.data)):s&&(r.data.size?OP+=r.data.size:r.data instanceof FormData?OP+=j8(r.data):OP+=vh(JSON.stringify(r.data))),r.headers=r.headers||{},r.headers["Content-Type"]=r.headers["Content-Type"]||"application/json",r.method="POST",r.url=t,la.request(r).then(h=>{typeof h.data=="string"?g2+=vh(h.data):h.data instanceof ArrayBuffer||h.data instanceof Uint8Array?g2+=h.data.byteLength:g2+=vh(JSON.stringify(h.data)),a&&c({data:h.data,headers:h.headers}),c(h.data)}).catch(h=>{la.isCancel(h)?u(new Oe(te.OPERATION_ABORTED,"cancel token canceled")):h.code==="ECONNABORTED"?u(new Oe(te.NETWORK_TIMEOUT,h.message)):h.response?u(new Oe(te.NETWORK_RESPONSE_ERROR,h.response.status)):u(new Oe(te.NETWORK_ERROR,h.message))})})}/*! formdata-polyfill. MIT License. Jimmy W?rting <https://jimmy.warting.se/opensource> */(function(){var t;function r(je){var st=0;return function(){return st<je.length?{done:!1,value:je[st++]}:{done:!0}}}var s=typeof Object.defineProperties=="function"?Object.defineProperty:function(je,st,Ct){return je==Array.prototype||je==Object.prototype||(je[st]=Ct.value),je},a,c=function(je){je=[typeof globalThis=="object"&&globalThis,je,typeof window=="object"&&window,typeof self=="object"&&self,typeof o=="object"&&o];for(var st=0;st<je.length;++st){var Ct=je[st];if(Ct&&Ct.Math==Math)return Ct}throw Error("Cannot find global object")}(this);function u(je,st){if(st)e:{var Ct=c;je=je.split(".");for(var He=0;He<je.length-1;He++){var M=je[He];if(!(M in Ct))break e;Ct=Ct[M]}(st=st(He=Ct[je=je[je.length-1]]))!=He&&st!=null&&s(Ct,je,{configurable:!0,writable:!0,value:st})}}function h(je){return(je={next:je})[Symbol.iterator]=function(){return this},je}function m(je){var st=typeof Symbol<"u"&&Symbol.iterator&&je[Symbol.iterator];return st?st.call(je):{next:r(je)}}if(u("Symbol",function(je){function st(M,ae){this.A=M,s(this,"description",{configurable:!0,writable:!0,value:ae})}if(je)return je;st.prototype.toString=function(){return this.A};var Ct="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",He=0;return function M(ae){if(this instanceof M)throw new TypeError("Symbol is not a constructor");return new st(Ct+(ae||"")+"_"+He++,ae)}}),u("Symbol.iterator",function(je){if(je)return je;je=Symbol("Symbol.iterator");for(var st="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),Ct=0;Ct<st.length;Ct++){var He=c[st[Ct]];typeof He=="function"&&typeof He.prototype[je]!="function"&&s(He.prototype,je,{configurable:!0,writable:!0,value:function(){return h(r(this))}})}return je}),typeof Object.setPrototypeOf=="function")a=Object.setPrototypeOf;else{var y;e:{var v={};try{v.__proto__={a:!0},y=v.a;break e}catch{}y=!1}a=y?function(je,st){if(je.__proto__=st,je.__proto__!==st)throw new TypeError(je+" is not extensible");return je}:null}var S=a;function R(){this.m=!1,this.j=null,this.v=void 0,this.h=1,this.u=this.C=0,this.l=null}function P(je){if(je.m)throw new TypeError("Generator is already running");je.m=!0}function N(je,st){return je.h=3,{value:st}}function G(je){this.g=new R,this.G=je}function F(je,st,Ct,He){try{var M=st.call(je.g.j,Ct);if(!(M instanceof Object))throw new TypeError("Iterator result "+M+" is not an object");if(!M.done)return je.g.m=!1,M;var ae=M.value}catch(fe){return je.g.j=null,je.g.s(fe),j(je)}return je.g.j=null,He.call(je.g,ae),j(je)}function j(je){for(;je.g.h;)try{var st=je.G(je.g);if(st)return je.g.m=!1,{value:st.value,done:!1}}catch(Ct){je.g.v=void 0,je.g.s(Ct)}if(je.g.m=!1,je.g.l){if(st=je.g.l,je.g.l=null,st.F)throw st.D;return{value:st.return,done:!0}}return{value:void 0,done:!0}}function X(je){this.next=function(st){return je.o(st)},this.throw=function(st){return je.s(st)},this.return=function(st){return function(Ct,He){P(Ct.g);var M=Ct.g.j;return M?F(Ct,"return"in M?M.return:function(ae){return{value:ae,done:!0}},He,Ct.g.return):(Ct.g.return(He),j(Ct))}(je,st)},this[Symbol.iterator]=function(){return this}}function ee(je,st){return st=new X(new G(st)),S&&je.prototype&&S(st,je.prototype),st}if(R.prototype.o=function(je){this.v=je},R.prototype.s=function(je){this.l={D:je,F:!0},this.h=this.C||this.u},R.prototype.return=function(je){this.l={return:je},this.h=this.u},G.prototype.o=function(je){return P(this.g),this.g.j?F(this,this.g.j.next,je,this.g.o):(this.g.o(je),j(this))},G.prototype.s=function(je){return P(this.g),this.g.j?F(this,this.g.j.throw,je,this.g.o):(this.g.s(je),j(this))},u("Array.prototype.entries",function(je){return je||function(){return function(st,Ct){st instanceof String&&(st+="");var He=0,M=!1,ae={next:function(){if(!M&&He<st.length){var fe=He++;return{value:Ct(fe,st[fe]),done:!1}}return M=!0,{done:!0,value:void 0}}};return ae[Symbol.iterator]=function(){return ae},ae}(this,function(st,Ct){return[st,Ct]})}}),typeof Blob<"u"&&(typeof FormData>"u"||!FormData.prototype.keys)){var he=function(je,st){for(var Ct=0;Ct<je.length;Ct++)st(je[Ct])},Se=function(je){return je.replace(/\r?\n|\r/g,`\r
`)},Te=function(je,st,Ct){return st instanceof Blob?(Ct=Ct!==void 0?Ct+"":typeof st.name=="string"?st.name:"blob",st.name===Ct&&Object.prototype.toString.call(st)!=="[object Blob]"||(st=new File([st],Ct)),[String(je),st]):[String(je),String(st)]},ye=function(je,st){if(je.length<st)throw new TypeError(st+" argument required, but only "+je.length+" present.")},Ne=typeof globalThis=="object"?globalThis:typeof window=="object"?window:typeof self=="object"?self:this,Ye=Ne.FormData,ht=Ne.XMLHttpRequest&&Ne.XMLHttpRequest.prototype.send,mt=Ne.Request&&Ne.fetch,Tn=Ne.navigator&&Ne.navigator.sendBeacon,wn=Ne.Element&&Ne.Element.prototype,fr=Ne.Symbol&&Symbol.toStringTag;fr&&(Blob.prototype[fr]||(Blob.prototype[fr]="Blob"),"File"in Ne&&!File.prototype[fr]&&(File.prototype[fr]="File"));try{new File([],"")}catch{Ne.File=function(st,Ct,He){return st=new Blob(st,He||{}),Object.defineProperties(st,{name:{value:Ct},lastModified:{value:+(He&&He.lastModified!==void 0?new Date(He.lastModified):new Date)},toString:{value:function(){return"[object File]"}}}),fr&&Object.defineProperty(st,fr,{value:"File"}),st}}var ui=function(je){return je.replace(/\n/g,"%0A").replace(/\r/g,"%0D").replace(/"/g,"%22")},Xr=function(je){this.i=[];var st=this;je&&he(je.elements,function(Ct){if(Ct.name&&!Ct.disabled&&Ct.type!=="submit"&&Ct.type!=="button"&&!Ct.matches("form fieldset[disabled] *"))if(Ct.type==="file"){var He=Ct.files&&Ct.files.length?Ct.files:[new File([],"",{type:"application/octet-stream"})];he(He,function(M){st.append(Ct.name,M)})}else Ct.type==="select-multiple"||Ct.type==="select-one"?he(Ct.options,function(M){!M.disabled&&M.selected&&st.append(Ct.name,M.value)}):Ct.type==="checkbox"||Ct.type==="radio"?Ct.checked&&st.append(Ct.name,Ct.value):(He=Ct.type==="textarea"?Se(Ct.value):Ct.value,st.append(Ct.name,He))})};if((t=Xr.prototype).append=function(je,st,Ct){ye(arguments,2),this.i.push(Te(je,st,Ct))},t.delete=function(je){ye(arguments,1);var st=[];je=String(je),he(this.i,function(Ct){Ct[0]!==je&&st.push(Ct)}),this.i=st},t.entries=function je(){var st,Ct=this;return ee(je,function(He){if(He.h==1&&(st=0),He.h!=3)return st<Ct.i.length?He=N(He,Ct.i[st]):(He.h=0,He=void 0),He;st++,He.h=2})},t.forEach=function(je,st){ye(arguments,1);for(var Ct=m(this),He=Ct.next();!He.done;He=Ct.next()){var M=m(He.value);He=M.next().value,M=M.next().value,je.call(st,M,He,this)}},t.get=function(je){ye(arguments,1);var st=this.i;je=String(je);for(var Ct=0;Ct<st.length;Ct++)if(st[Ct][0]===je)return st[Ct][1];return null},t.getAll=function(je){ye(arguments,1);var st=[];return je=String(je),he(this.i,function(Ct){Ct[0]===je&&st.push(Ct[1])}),st},t.has=function(je){ye(arguments,1),je=String(je);for(var st=0;st<this.i.length;st++)if(this.i[st][0]===je)return!0;return!1},t.keys=function je(){var st,Ct,He,M,ae=this;return ee(je,function(fe){if(fe.h==1&&(st=m(ae),Ct=st.next()),fe.h!=3)return Ct.done?void(fe.h=0):(He=Ct.value,M=m(He),N(fe,M.next().value));Ct=st.next(),fe.h=2})},t.set=function(je,st,Ct){ye(arguments,2),je=String(je);var He=[],M=Te(je,st,Ct),ae=!0;he(this.i,function(fe){fe[0]===je?ae&&(ae=!He.push(M)):He.push(fe)}),ae&&He.push(M),this.i=He},t.values=function je(){var st,Ct,He,M,ae=this;return ee(je,function(fe){if(fe.h==1&&(st=m(ae),Ct=st.next()),fe.h!=3)return Ct.done?void(fe.h=0):(He=Ct.value,(M=m(He)).next(),N(fe,M.next().value));Ct=st.next(),fe.h=2})},Xr.prototype._asNative=function(){for(var je=new Ye,st=m(this),Ct=st.next();!Ct.done;Ct=st.next()){var He=m(Ct.value);Ct=He.next().value,He=He.next().value,je.append(Ct,He)}return je},Xr.prototype._blob=function(){var je="----formdata-polyfill-"+Math.random(),st=[],Ct="--"+je+`\r
Content-Disposition: form-data; name="`;return this.forEach(function(He,M){return typeof He=="string"?st.push(Ct+ui(Se(M))+`"\r
\r
`+Se(He)+`\r
`):st.push(Ct+ui(Se(M))+'"; filename="'+ui(He.name)+`"\r
Content-Type: `+(He.type||"application/octet-stream")+`\r
\r
`,He,`\r
`)}),st.push("--"+je+"--"),new Blob(st,{type:"multipart/form-data; boundary="+je})},Xr.prototype[Symbol.iterator]=function(){return this.entries()},Xr.prototype.toString=function(){return"[object FormData]"},wn&&!wn.matches&&(wn.matches=wn.matchesSelector||wn.mozMatchesSelector||wn.msMatchesSelector||wn.oMatchesSelector||wn.webkitMatchesSelector||function(je){for(var st=(je=(this.document||this.ownerDocument).querySelectorAll(je)).length;0<=--st&&je.item(st)!==this;);return-1<st}),fr&&(Xr.prototype[fr]="FormData"),ht){var ma=Ne.XMLHttpRequest.prototype.setRequestHeader;Ne.XMLHttpRequest.prototype.setRequestHeader=function(je,st){ma.call(this,je,st),je.toLowerCase()==="content-type"&&(this.B=!0)},Ne.XMLHttpRequest.prototype.send=function(je){je instanceof Xr?(je=je._blob(),this.B||this.setRequestHeader("Content-Type",je.type),ht.call(this,je)):ht.call(this,je)}}mt&&(Ne.fetch=function(je,st){return st&&st.body&&st.body instanceof Xr&&(st.body=st.body._blob()),mt.call(this,je,st)}),Tn&&(Ne.navigator.sendBeacon=function(je,st){return st instanceof Xr&&(st=st._asNative()),Tn.call(this,je,st)}),Ne.FormData=Xr}})();const WT=()=>{const t=oe("AREAS");return t.length===0&&t.push(Gn.GLOBAL),lc(t).call(t,(r,s,a)=>{const c=s9(s);return c?a===0?c:"".concat(r,",").concat(c):r},"")},s9=t=>t===Gn.OVERSEA?"".concat(Bs.ASIA,",").concat(Bs.EUROPE,",").concat(Bs.AFRICA,",").concat(Bs.NORTH_AMERICA,",").concat(Bs.SOUTH_AMERICA,",").concat(Bs.OCEANIA):Bs[t],Rge=t=>{const r={CODE:"",WEBCS_DOMAIN:[],WEBCS_DOMAIN_BACKUP_LIST:[],PROXY_CS:[],CDS_AP:[],ACCOUNT_REGISTER:[],UAP_AP:[],EVENT_REPORT_DOMAIN:[],EVENT_REPORT_BACKUP_DOMAIN:[],LOG_UPLOAD_SERVER:[],PROXY_SERVER_TYPE3:[]};return t.map(s=>{const a=bP[s],c=Object.keys(a);c&&c.map(u=>{u!=="CODE"&&(r[u]=r[u].concat(a[u]))})}),r},kP={GLOBAL:{ASIA:[Gn.CHINA,Gn.JAPAN,Gn.INDIA,Gn.KOREA,Gn.HKMC],EUROPE:[],NORTH_AMERICA:[Gn.US],SOUTH_AMERICA:[],OCEANIA:[],AFRICA:[]}},NP=Object.keys(kP[Gn.GLOBAL]),_2=[Gn.CHINA,Gn.NORTH_AMERICA,Gn.EUROPE,Gn.ASIA,Gn.JAPAN,Gn.INDIA,Gn.OCEANIA,Gn.SOUTH_AMERICA,Gn.AFRICA,Gn.KOREA,Gn.HKMC,Gn.US],Ige=function(t,r){let s=[];if(ot(t).call(t,Gn.GLOBAL)){const u=[Gn.GLOBAL,Gn.OVERSEA],h=Object.keys(bP);if(r===Gn.GLOBAL)throw new Oe(te.INVALID_PARAMS,"GLOBAL is an invalid excludedArea value");if(r===Gn.CHINA)s=[Gn.OVERSEA];else if(c=r,ot(NP).call(NP,c)){const m=(a=r,kP[Gn.GLOBAL][a]||[]),y=[...u,r,...m];s=h.filter(v=>!ot(y).call(y,v))}else if(function(m){let y=!1;return NP.forEach(v=>{var S;ot(S=kP[Gn.GLOBAL][v]).call(S,m)&&(y=!0)}),y}(r)){const m=function(v){let S;return NP.forEach(R=>{var P;ot(P=kP[Gn.GLOBAL][R]).call(P,v)&&(S=R)}),S}(r),y=[...u,m,r];s=h.filter(v=>!ot(y).call(y,v))}else s=t;s=function(m){const y=[];return _2.forEach(v=>{ot(m).call(m,v)&&y.push(v)}),y.concat(m.filter(v=>!ot(_2).call(_2,v)))}(s)}else s=t;var a,c;return s};function o9(t){var r,s;if(!t&&ot(r=oe("AREAS")).call(r,Gn.EXTENSIONS))return x.debug("update area from ap : reset"),void y2(Mme,!0);if(!ot(s=oe("AREAS")).call(s,Gn.GLOBAL)||!t)return;let a=bP.EXTENSIONS;a&&(a={CODE:s9(Gn.EXTENSIONS),WEBCS_DOMAIN:["ap-web-1-".concat(t,".agora.io")],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-".concat(t,".ap.sd-rtn.com")],PROXY_CS:["proxy-ap-web-".concat(t,".agora.io")],CDS_AP:["cds-ap-web-1-".concat(t,".agora.io"),"cds-ap-web-2-".concat(t,".ap.sd-rtn.com")],ACCOUNT_REGISTER:["sua-ap-web-1-".concat(t,".agora.io"),"sua-ap-web-2-".concat(t,".ap.sd-rtn.com")],UAP_AP:["uap-ap-web-1-".concat(t,".agora.io"),"uap-ap-web-2-".concat(t,".ap.sd-rtn.com")],EVENT_REPORT_DOMAIN:["statscollector-1-".concat(t,".agora.io")],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-".concat(t,".agora.io")],LOG_UPLOAD_SERVER:["logservice-".concat(t,".agora.io")],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy-".concat(t,".agora.io")]},x.debug("update area from ap success: ".concat(t,",config is "),a),tr("AREAS",[Gn.EXTENSIONS],!0),Object.keys(a).map(c=>{c==="LOG_UPLOAD_SERVER"||c==="EVENT_REPORT_DOMAIN"||c==="EVENT_REPORT_BACKUP_DOMAIN"||c==="PROXY_SERVER_TYPE3"?tr(c,a[c][0]):tr(c,a[c])}))}function y2(t){let r=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const s=It.reportApiInvoke(null,{name:Ai.SET_AREA,options:t,tag:zr.TRACER});try{let a=[];if(typeof t=="string"&&(a=[t]),Array.isArray(t)&&(t.forEach(u=>{if(!ot(RH).call(RH,u))throw new Oe(te.INVALID_PARAMS,"invalid area code")}),a=t),Object.prototype.toString.call(t)==="[object Object]"){const{areaCode:u,excludedArea:h}=t;if(!u)throw new Oe(te.INVALID_PARAMS,"area code is needed");let m=u;typeof u=="string"&&(m=[u]),a=h?Ige(m,h):m}if(!r){if(yd.AREAS){const u=new Oe(te.PROHIBITED_OPERATION,"setArea is prohibited because of config-distribute");return s.onError(u),void x.warning("setArea is prohibited because of config-distribute")}if(ot(a).call(a,Gn.GLOBAL)&&oe("AREAS")===Gn.EXTENSIONS){const u=new Oe(te.PROHIBITED_OPERATION,"setArea is prohibited because of ap extensions");return s.onError(u),void x.warning("setArea is prohibited because of ap extensions")}}tr("AREAS",a,r);const c=Rge(a);Object.keys(c).map(u=>{u==="LOG_UPLOAD_SERVER"||u==="EVENT_REPORT_DOMAIN"||u==="EVENT_REPORT_BACKUP_DOMAIN"||u==="PROXY_SERVER_TYPE3"?tr(u,c[u][0]):tr(u,c[u])}),x.debug("set area success:",a.join(","))}catch(a){throw s.onError(a),a}s.onSuccess()}function a9(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}function Rh(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?a9(Object(s),!0).forEach(function(a){K(t,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):a9(Object(s)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))})}return t}let E2=1;function Age(t,r,s,a,c){E2+=1;const u={sid:s.sid,command:"convergeAllocateEdge",uid:"666",appId:s.appId,ts:Math.floor(Date.now()/1e3),seq:E2,requestId:E2,version:wl,cname:s.cname},h={service_name:r,json_body:JSON.stringify(u)};let m,y,v=t[0];return _d(async()=>{m=Date.now();const S=await bd(v,{data:h,cancelToken:a,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"}});if(y=Date.now()-m,S.code!==0){const N=new Oe(te.UNEXPECTED_RESPONSE,"live streaming ap error, code"+S.code,{retry:!0,responseTime:y});throw x.error(N.toString()),N}const R=JSON.parse(S.json_body);if(R.code!==200){const N=new Oe(te.UNEXPECTED_RESPONSE,"live streaming app center error, code: ".concat(R.code,", reason: ").concat(R.reason),{code:R.code,responseTime:y});throw x.error(N.toString()),N}if(!R.servers||R.servers.length===0){const N=new Oe(te.UNEXPECTED_RESPONSE,"live streaming app center empty server",{code:R.code,responseTime:y});throw x.error(N.toString()),N}const P=function(N,G){return{addressList:N.servers.map(F=>"wss://".concat(F.address.replace(/\./g,"-"),".").concat(oe("WORKER_DOMAIN"),":").concat(F.wss,"?serviceName=").concat(encodeURIComponent(G))),workerToken:N.workerToken,vid:N.vid}}(R,r);return oe("LIVE_STREAMING_ADDRESS")&&(P.addressList=oe("LIVE_STREAMING_ADDRESS")instanceof Array?oe("LIVE_STREAMING_ADDRESS"):[oe("LIVE_STREAMING_ADDRESS")]),Rh(Rh({},P),{},{responseTime:y})},(S,R)=>(It.apworkerEvent(s.sid,{success:!0,sc:200,serviceName:r,responseDetail:JSON.stringify(S.addressList),firstSuccess:R===0,responseTime:y,serverIp:t[R%t.length]}),!1),(S,R)=>(It.apworkerEvent(s.sid,{success:!1,sc:S.data&&S.data.code||200,serviceName:r,responseTime:y,serverIp:t[R%t.length]}),!!(S.code!==te.OPERATION_ABORTED&&S.code!==te.UNEXPECTED_RESPONSE||S.data&&S.data.retry)&&(v=t[(R+1)%t.length],!0)),c)}let v2=1;function c9(t,r,s,a){let{url:c,areaCode:u}=t;const{clientId:h,sid:m}=r,y=Date.now();let v;const S=r.role,[R,P]=b2(r,u,[Ei.CHOOSE_SERVER]);let N=yi.networkState;return _d(async()=>{N&&yi.networkState===gc.OFFLINE&&yi.onlineWaiter&&await dt.race([yi.onlineWaiter,ps(a&&a.maxRetryTimeout||Pi.maxRetryTimeout)]),N=yi.networkState;const{data:G,headers:F}=await bd(c,{data:R,cancelToken:s,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);v=F.http3==="1"?1:-1,It.reportResourceTiming(c,m),u9(G,c,r,y,[Ei.CHOOSE_SERVER],v);const j=VT(G,Ei.CHOOSE_SERVER);return S2(j),u2(j,c)},G=>(G&&It.joinChooseServer(m,{role:S,lts:y,succ:!0,csAddr:c,opid:P,serverList:G.gatewayAddrs.map(F=>F.address),ec:null,cid:G.cid.toString(),uid:G.uid.toString(),csIp:G.csIp,unilbsServerIds:[Ei.CHOOSE_SERVER].toString(),isHttp3:v,corssRegionTagReq:r.apRequestDetail,corssRegionTagRes:G.res.detail&&G.res.detail[38]}),!1),G=>G.code!==te.OPERATION_ABORTED&&(G.code===te.CAN_NOT_GET_GATEWAY_SERVER?G.data.retry:(It.joinChooseServer(m,{role:S,lts:y,succ:!1,csAddr:c,serverList:null,opid:P,ec:G.code,csIp:G.data&&G.data.csIp,unilbsServerIds:[Ei.CHOOSE_SERVER].toString(),extend:JSON.stringify({networkState:N}),isHttp3:v,corssRegionTagReq:r.apRequestDetail}),x.warning("[".concat(h||"sid-".concat(m.slice(0,6)),"] Choose server network error, retry"),G),!0)),a)}function l9(t,r,s,a){let c,{url:u,areaCode:h,serviceIds:m}=t;const y=Date.now(),v=r.role,[S,R]=b2(r,h,m);let P;return _d(async()=>{P&&yi.networkState===gc.OFFLINE&&yi.onlineWaiter&&await dt.race([yi.onlineWaiter,ps(a&&a.maxRetryTimeout||Pi.maxRetryTimeout)]),P=yi.networkState;const{data:N,headers:G}=await bd(u,{data:S,cancelToken:s,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);c=G.http3==="1"?1:-1,It.reportResourceTiming(u,r.sid),u9(N,u,r,y,m,c);const F=VT(N,Ei.CHOOSE_SERVER),j=VT(N,r.cloudProxyServer==="proxy5"?Ei.CLOUD_PROXY_5:r.cloudProxyServer==="proxy3"||r.cloudProxyServer==="proxy4"?Ei.CLOUD_PROXY:Ei.CLOUD_PROXY_FALLBACK);return S2(F),{gatewayInfo:u2(F,u),proxyInfo:j,url:u}},N=>(N.gatewayInfo&&It.joinChooseServer(r.sid,{role:v,lts:y,succ:!0,csAddr:u,serverList:N.gatewayInfo.gatewayAddrs.map(G=>G.address),ec:null,opid:R,cid:N.gatewayInfo.cid.toString(),uid:N.gatewayInfo.uid.toString(),csIp:N.gatewayInfo.csIp,unilbsServerIds:m.toString(),isHttp3:c,corssRegionTagReq:r.apRequestDetail,corssRegionTagRes:N.gatewayInfo.res.detail&&N.gatewayInfo.res.detail[38]}),N.proxyInfo&&It.joinWebProxyAP(r.sid,{lts:y,sucess:1,apServerAddr:u,turnServerAddrList:N.proxyInfo.addresses.map(G=>G.ip).join(","),errorCode:null,eventType:r.cloudProxyServer,unilbsServerIds:m.toString()}),!1),N=>N.code!==te.OPERATION_ABORTED&&(N.code===te.CAN_NOT_GET_GATEWAY_SERVER?N.data.retry:(It.joinWebProxyAP(r.sid,{lts:y,sucess:0,apServerAddr:u,turnServerAddrList:null,errorCode:N.code,eventType:r.cloudProxyServer,unilbsServerIds:m.toString(),extend:JSON.stringify({networkState:P})}),x.warning("[".concat(r.clientId,"] multi unilbs network error, retry"),N),!0)),a)}const u9=(t,r,s,a,c,u)=>{const{sid:h,clientId:m,cloudProxyServer:y}=s,v=[],S=R=>{R.flag===4096?It.joinChooseServer(h,{role:s.role,lts:a,succ:!1,csAddr:r,opid:t.opid,serverList:null,ec:R.error.message,csIp:R.error.data&&R.error.data.csIp,unilbsServerIds:c.toString(),isHttp3:u,corssRegionTagReq:s.apRequestDetail}):R.flag!==1048576&&R.flag!==4194304&&R.flag!==4194310||It.joinWebProxyAP(h,{lts:a,sucess:0,apServerAddr:r,turnServerAddrList:null,errorCode:R.error.code,eventType:y,unilbsServerIds:c.toString()})};if(t.response_body.forEach(R=>{const P=R.buffer.code;if(R.uri===23&&P===0&&!R.buffer.edges_services)if(R.buffer.flag===4194310)x.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers"),R.buffer.edges_services=[];else{const N={error:new Oe(te.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:t.detail[502]}),flag:R.buffer.flag};v.push(N),S(N)}if(P!==0){const N=sS(P),G={error:new Oe(te.CAN_NOT_GET_GATEWAY_SERVER,N.desc,{desc:N.desc,retry:N.retry,csIp:t.detail[502]}),flag:R.buffer.flag};R.buffer.flag===4194310?x.warning(G.error.toString()):v.push(G),S(G)}}),v.length)throw x.warning("[".concat(m||"sid-".concat(h.slice(0,6)),"] multi unilbs ").concat(r," failed, ").concat(v.map(R=>"flag: ".concat(R.flag,", message: ").concat(R.error.message,", retry: ").concat(R.error.data.retry)).join(" | "))),new Oe(te.CAN_NOT_GET_GATEWAY_SERVER,v.map(R=>"flag: ".concat(R.flag,", message: ").concat(R.error.message)).join(" | "),{retry:!!v.find(R=>R.error.data.retry),csIp:t.detail[502],desc:[...new Set(v.map(R=>{var P;return R==null||(P=R.error)===null||P===void 0||(P=P.data)===null||P===void 0?void 0:P.desc}).filter(R=>!!R))]})},S2=t=>{var r,s,a,c;if(t.addresses&&t.addresses.length===0&&t.code===0)throw new Oe(te.CAN_NOT_GET_GATEWAY_SERVER,"void gateway address",{retry:!0,csIp:t.detail&&t.detail[502]});if(oe("AP_AREA")&&((a=t.detail)!==null&&a!==void 0&&a[23]&&typeof((c=t.detail)===null||c===void 0?void 0:c[23])=="string"?o9(t.detail[23].toLowerCase()):o9()),(r=t.detail)!==null&&r!==void 0&&r[19]&&typeof((s=t.detail)===null||s===void 0?void 0:s[19])=="string"){const h=t.detail[19],m=h==null?void 0:h.split(";");for(let y=0;y<m.length;y++){var u;const v=po(u=m[y]).call(u);t.addresses[y]&&m&&(t.addresses[y].fingerprint=v)}}if(oe("GATEWAY_ADDRESS")&&oe("GATEWAY_ADDRESS").length>0){x.debug("assign gateway address to",oe("GATEWAY_ADDRESS"));const h=oe("GATEWAY_ADDRESS").map(m=>{var y,v;const S=(y=(v=t.addresses.find(R=>R.ip===m.ip&&R.port===m.port))===null||v===void 0?void 0:v.fingerprint)!==null&&y!==void 0?y:"";return{ip:m.ip,port:m.port,ticket:t.addresses[0]&&t.addresses[0].ticket,fingerprint:S}});t.addresses=h}},Pge=(t,r)=>{if(t.response_body&&t.response_body.length){const s=t.response_body[0];if(s.buffer.code!==0){const a=sS(s.buffer.code);throw new Oe(te.UPDATE_TICKET_FAILED,"[".concat(s.buffer.code,"]: ").concat(a.desc),{retry:a.retry})}return s.buffer.ticket}throw x.debug("update ticket request received ap response without response body:",r),new Oe(te.UPDATE_TICKET_FAILED,"cannot find response body from ap response",{retry:!1})},b2=(t,r,s)=>{const a=Math.floor(Math.random()*1e12),c=t.role==="host"?"1":t.role==="audience"?"2":void 0,u={appid:t.appId,client_ts:Date.now(),opid:a,sid:t.sid,request_bodies:[{uri:22,buffer:{cname:t.cname,detail:Rh(Rh(Rh({6:t.stringUid,11:r,12:oe("USE_NEW_TOKEN")?"1":void 0},c?{17:c}:{}),{},{22:r},t.apRequestDetail?{33:t.apRequestDetail}:{}),t.apRTM?{26:"RTM2"}:{}),key:t.token,service_ids:s,uid:t.uid||0}}]};u.request_bodies.forEach(m=>{t.multiIP&&t.multiIP.gateway_ip&&(m.buffer.detail[5]=JSON.stringify({vocs_ip:[t.multiIP.uni_lbs_ip],vos_ip:[t.multiIP.gateway_ip]}))});const h=new FormData;return h.append("request",JSON.stringify(u)),[h,a]},Oge=(t,r)=>{const s=Math.floor(Math.random()*1e12),a={appid:t.appId,client_ts:Date.now(),opid:s,sid:t.sid,request_bodies:[{uri:28,buffer:{cname:t.cname,detail:{1:"",6:t.stringUid,12:"1"},token:t.token,service_ids:r,uid:t.uid||0,edges_services:t.apResponse.addresses.map(u=>({ip:u.ip,port:u.port}))}}]},c=new FormData;return c.append("request",JSON.stringify(a)),[c,s]};let lS=0;function uS(t){return dt.all(t.map(r=>r.then(s=>{throw s},s=>s))).then(r=>{throw r},r=>r)}const zT=async t=>{let{fragementLength:r,referenceList:s,asyncMapHandler:a,allFailedhandler:c,promisesCollector:u}=t,h=0;const m=r;let y,v=0;const S=async()=>{const R=(()=>{const P=h*m,N=P+m;return s.slice(P,N).map(a)})();u&&u.push(...R);try{y=await uS(R)}catch(P){if(v+=m,h++,!(v>=s.length))return void await S();c(P)}R.forEach(P=>P.cancel())};return await S(),y},d9=async t=>{let{referenceList:r,asyncMapHandler:s,closeFn:a}=t;const c=r.length;let u=0;const h=async()=>{const m=s(r.shift());try{return await m}catch(y){if(u++,u>=c||a!=null&&a(y))throw y;return h()}};return h()};async function T2(t,r,s,a){return{gatewayInfo:await async function(u,h,m,y){let v=null;const S=[],R=async()=>{const N=oe("WEBCS_DOMAIN").slice(0,oe("AJAX_REQUEST_CONCURRENT")).map(j=>({url:u.proxyServer?"https://".concat(u.proxyServer,"/ap/?url=").concat(j+"/api/v2/transpond/webrtc?v=2"):"https://".concat(j,"/api/v2/transpond/webrtc?v=2"),areaCode:WT()})),G=y.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:N.map(j=>j.url)}),F=await zT({fragementLength:oe("FRAGEMENT_LENGTH"),referenceList:N,asyncMapHandler:j=>(x.debug("[".concat(u.clientId,"] Connect to choose_server:"),j.url),c9(j,u,h,m)),allFailedhandler:j=>{throw y.recordJoinChannelService({endTs:Date.now(),status:"error",errors:j},G),j[0]},promisesCollector:S});return y.recordJoinChannelService({endTs:Date.now(),status:"success"},G),F},P=async()=>{if(await ps(1e3),v!==null)return v;const N=oe("WEBCS_DOMAIN_BACKUP_LIST").map(j=>({url:u.proxyServer?"https://".concat(u.proxyServer,"/ap/?url=").concat(j+"/api/v2/transpond/webrtc?v=2"):"https://".concat(j,"/api/v2/transpond/webrtc?v=2"),areaCode:WT()})),G=y.recordJoinChannelService({endTs:void 0,startTs:Date.now(),status:"pending",service:"chooseServer",urls:N.map(j=>j.url)}),F=await zT({fragementLength:oe("FRAGEMENT_LENGTH"),referenceList:N,asyncMapHandler:j=>(x.debug("[".concat(u.clientId,"] Connect to backup choose_server:"),j.url),c9(j,u,h,m)),allFailedhandler:j=>{throw y.recordJoinChannelService({endTs:Date.now(),status:"error",errors:j},G),j[0]},promisesCollector:S});return y.recordJoinChannelService({endTs:Date.now(),status:"success"},G),F};try{return v=await uS([R(),P()]),S.length&&S.forEach(N=>N.cancel&&typeof N.cancel=="function"&&N.cancel()),v}catch(N){throw N[0]}}(t,r,s,a)}}async function h9(t,r,s,a,c){const u=t.cloudProxyServer;if(u==="disabled"){if(t.useLocalAccessPoint)return await T2(t,r,s,c);if(oe("JOIN_WITH_FALLBACK_MEDIA_PROXY")){const{gatewayInfo:P,proxyInfo:N}=await m9(t,r,s,c);if(t.turnServer&&t.turnServer.mode!=="auto")return{gatewayInfo:P};const G=N.map(F=>({turnServerURL:F.address,tcpport:F.tcpport||Ns.tcpport,udpport:F.udpport||Ns.udpport,username:F.username||Ns.username,password:F.password||Ns.password,forceturn:!1,security:!0}));if(c.useP2P){var h;const F=(h=t.uid)!==null&&h!==void 0?h:P.uid,j="glb:".concat(F.toString()),X=await gL(j),ee=N.map(he=>({turnServerURL:he.address,tcpport:he.tcpport||Ns.tcpport,udpport:he.udpport||Ns.udpport,username:j,password:X,forceturn:!1,security:!0}));G.push(...ee)}return t.turnServer={mode:"manual",servers:G},{gatewayInfo:P}}return await T2(t,r,s,c)}const{proxyInfo:m,gatewayInfo:y}=await m9(t,r,s,c),v={gatewayInfo:y},S=m.map(P=>({turnServerURL:P.address,tcpport:u==="proxy3"?void 0:P.tcpport?P.tcpport:Ns.tcpport,udpport:u==="proxy4"?void 0:P.udpport?P.udpport:Ns.udpport,username:P.username||Ns.username,password:P.password||Ns.password,forceturn:u!=="proxy4",security:u==="proxy5"}));if(c.useP2P){var R;const P=(R=t.uid)!==null&&R!==void 0?R:y.uid,N="glb:".concat(P.toString()),G=await gL(N),F=m.map(j=>({turnServerURL:j.address,tcpport:u==="proxy3"?void 0:j.tcpport||Ns.tcpport,udpport:u==="proxy4"?void 0:j.udpport||Ns.udpport,username:N,password:G,forceturn:u!=="proxy4",security:u==="proxy5"}));S.push(...F)}return t.turnServer={mode:"manual",servers:S},x.debug("[".concat(t.clientId,"] set proxy server: ").concat(t.proxyServer,", mode: ").concat(u)),v}async function f9(t,r,s,a,c){const u=oe("ACCOUNT_REGISTER").slice(0,oe("AJAX_REQUEST_CONCURRENT"));let h=[];h=r.proxyServer?u.map(y=>"https://".concat(r.proxyServer,"/ap/?url=").concat(y+"/api/v1")):u.map(y=>"https://".concat(y,"/api/v1"));const m=c==null?void 0:c.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"stringUID",urls:h});try{const y=await async function(v,S,R,P,N){const G=Date.now(),F={sid:R.sid,opid:10,appid:R.appId,string_uid:S};let j=v[0];const X=await _d(()=>bd(j+"".concat(j.indexOf("?")===-1?"?":"&","action=stringuid"),{data:F,cancelToken:P,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}}),(ee,he)=>{if(ee.code===0){if(ee.uid<=0||ee.uid>=Math.pow(2,32))throw x.error("Invalid Uint Uid ".concat(S," => ").concat(ee.uid),ee),It.reqUserAccount(F.sid,{lts:G,success:!1,serverAddr:j,stringUid:F.string_uid,uid:ee.uid,errorCode:te.INVALID_UINT_UID_FROM_STRING_UID,extend:F}),new Oe(te.INVALID_UINT_UID_FROM_STRING_UID);return It.reqUserAccount(F.sid,{lts:G,success:!0,serverAddr:j,stringUid:F.string_uid,uid:ee.uid,errorCode:null,extend:F}),!1}const Se=sS(ee.code);return Se.retry&&(j=v[(he+1)%v.length]),It.reqUserAccount(F.sid,{lts:G,success:!1,serverAddr:j,stringUid:F.string_uid,uid:ee.uid,errorCode:Se.desc,extend:F}),Se.retry},(ee,he)=>ee.code!==te.OPERATION_ABORTED&&(It.reqUserAccount(F.sid,{lts:G,success:!1,serverAddr:j,stringUid:F.string_uid,uid:null,errorCode:ee.code,extend:F}),j=v[(he+1)%v.length],!0),N);if(X.code!==0){const ee=sS(X.code);throw new Oe(te.UNEXPECTED_RESPONSE,ee.desc)}return X}(h,t,r,s,a);return c==null||c.recordJoinChannelService({status:"success",endTs:Date.now()},m),y.uid}catch(y){throw c==null||c.recordJoinChannelService({status:"error",endTs:Date.now(),errors:[y]},m),y}}async function kge(t,r,s){const a=oe("ACCOUNT_REGISTER");let c=[];c=r.proxyServer?a.map(u=>"https://".concat(r.proxyServer,"/ap/?url=").concat(u+"/api/v1")):a.map(u=>"https://".concat(u,"/api/v1"));try{return await d9({referenceList:c,asyncMapHandler:h=>async function(m,y,v,S){const R=Date.now(),P={sid:v.sid,opid:10,appid:v.appId,string_uid:y};try{const N=await bd(m+"".concat(m.indexOf("?")===-1?"?":"&","action=stringuid"),{data:P,cancelToken:S,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}});if(N.code!==0){const G=sS(N.code);throw new Oe(te.UNEXPECTED_RESPONSE,"preload sua error:".concat(G.desc),G)}if(N.uid<=0||N.uid>=Math.pow(2,32))throw new Oe(te.INVALID_UINT_UID_FROM_STRING_UID);return{requestTime:R,url:m,req:P,uid:N.uid,elapse:Date.now()-R}}catch(N){throw N}}(h,t,r,s),closeFn:h=>h.code===te.OPERATION_ABORTED||h.code===te.UNEXPECTED_RESPONSE&&!h.data.retry})}catch(u){throw u}}async function Nge(t,r,s){const a=oe("CDS_AP").slice(0,oe("AJAX_REQUEST_CONCURRENT")).map(y=>t.proxyServer?"https://".concat(t.proxyServer,"/ap/?url=").concat(y+"/api/v1"):"https://".concat(y,"/api/v1?action=config")),c=a.map(y=>function(v,S,R,P){const N=Nn(),G={flag:64,cipher_method:0,features:Rh(Rh(Rh(Rh(Rh({install_id:IL(),device:N.name,system:N.os,system_general:navigator.userAgent,vendor:S.appId,version:wl,cname:S.cname,session_id:S.sid,proxyServer:S.proxyServer,sdk_type:Tge.WEB_RTC,browser_name:N.name,browser_version:N.version,user_agent:navigator.userAgent,channel_name:S.cname},S.stringUid&&{string_uid:S.stringUid}),S.uid&&{uid:S.uid+""}),N.os&&{os_name:N.os}),N.osVersion&&{os_version:N.osVersion}),{},{detail:""})};return _d(()=>bd(v,{data:G,timeout:1e3,cancelToken:R,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":54}}),void 0,F=>F.code!==te.OPERATION_ABORTED,P)}(y,t,r,s));let u=null,h=null,m={};try{u=await uS(c)}catch(y){if(y.code===te.OPERATION_ABORTED)throw y;h=y}if(c.forEach(y=>y.cancel()),It.reportApiInvoke(t.sid,{name:Ai.REQUEST_CONFIG_DISTRIBUTE,options:{error:h,res:u}}).onSuccess(),u&&u.test_tags)try{m=function(y){if(!y.test_tags)return{};const v=y.test_tags,S=Object.keys(v),R={};return S.forEach(P=>{var N;const G=po(N=P.slice(4)).call(N),F=JSON.parse(v[P]),j=F[1];R[G]={tag:F[0]||"",value:j}}),R}(u)}catch{}return m}async function p9(t,r){const s=oe("WEBCS_DOMAIN").concat(oe("WEBCS_DOMAIN_BACKUP_LIST")).map(a=>({url:"https://".concat(a,"/api/v2/transpond/webrtc?v=2"),areaCode:WT(),serviceIds:[Ei.CHOOSE_SERVER,Ei.CLOUD_PROXY_FALLBACK]}));try{return await d9({referenceList:s,asyncMapHandler:c=>async function(u,h,m){let y,{url:v,areaCode:S,serviceIds:R}=u;const P=Date.now(),[N,G]=b2(h,S,R);let F=yi.networkState;try{F&&yi.networkState===gc.OFFLINE&&yi.onlineWaiter&&await dt.race([yi.onlineWaiter,ps(Pi.maxRetryTimeout)]),F=yi.networkState;const{data:j,headers:X}=await bd(v,{data:N,cancelToken:m,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);y=X.http3==="1"?1:-1,(Te=>{const ye=[];if(Te.response_body.forEach(Ne=>{const Ye=Ne.buffer.code;if(Ne.uri===23&&Ye===0&&!Ne.buffer.edges_services)if(Ne.buffer.flag===4194310)Ne.buffer.edges_services=[];else{const ht={error:new Oe(te.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:Te.detail[502]}),flag:Ne.buffer.flag};ye.push(ht)}if(Ye!==0){const ht=sS(Ye),mt={error:new Oe(te.CAN_NOT_GET_GATEWAY_SERVER,ht.desc,{desc:ht.desc,retry:ht.retry,csIp:Te.detail[502]}),flag:Ne.buffer.flag};Ne.buffer.flag===4194310?x.warning(mt.error.toString()):ye.push(mt)}}),ye.length)throw new Oe(te.CAN_NOT_GET_GATEWAY_SERVER,ye.map(Ne=>"flag: ".concat(Ne.flag,", message: ").concat(Ne.error.message)).join(" | "),{retry:!!ye.find(Ne=>Ne.error.data.retry),csIp:Te.detail[502],desc:[...new Set(ye.map(Ne=>{var Ye;return Ne==null||(Ye=Ne.error)===null||Ye===void 0||(Ye=Ye.data)===null||Ye===void 0?void 0:Ye.desc}).filter(Ne=>!!Ne))]})})(j);const he=VT(j,Ei.CHOOSE_SERVER),Se=VT(j,Ei.CLOUD_PROXY_FALLBACK);return S2(he),{gatewayInfo:u2(he,v),proxyInfo:Se,opid:G,requestTime:P,url:v,isHttp3:y,elapse:Date.now()-P}}catch(j){throw j}}(c,t,r),closeFn:c=>c.code===te.OPERATION_ABORTED||c.code===te.CAN_NOT_GET_GATEWAY_SERVER&&!c.data.retry})}catch(a){throw a}}async function m9(t,r,s,a){const c=oe("PROXY_SERVER_TYPE3"),u=(N,G,F)=>{let j=F||c;return Array.isArray(j)&&(j=G%2==0?c[1]:c[0]),"https://".concat(j,"/ap/?url=").concat(N)};let h=null;const m=[],y=async()=>{const N=oe("WEBCS_DOMAIN").slice(0,oe("AJAX_REQUEST_CONCURRENT")).map((j,X)=>{let ee;return ee=t.cloudProxyServer==="disabled"&&t.proxyServer?u("".concat(j,"/api/v2/transpond/webrtc?v=2"),X,t.proxyServer):t.cloudProxyServer==="disabled"||t.cloudProxyServer==="fallback"?"https://".concat(j,"/api/v2/transpond/webrtc?v=2"):u("".concat(j,"/api/v2/transpond/webrtc?v=2"),X),{url:ee,areaCode:WT(),serviceIds:[Ei.CHOOSE_SERVER,t.cloudProxyServer==="proxy5"?Ei.CLOUD_PROXY_5:t.cloudProxyServer==="proxy3"||t.cloudProxyServer==="proxy4"?Ei.CLOUD_PROXY:Ei.CLOUD_PROXY_FALLBACK]}}),G=a.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:N.map(j=>j.url)}),F=await zT({fragementLength:oe("FRAGEMENT_LENGTH"),referenceList:N,asyncMapHandler:j=>(x.debug("[".concat(t.clientId,"] Connect to choose_server:"),j.url),l9(j,t,r,s)),allFailedhandler:j=>{throw a.recordJoinChannelService({endTs:Date.now(),status:"error",errors:j},G),j[0]},promisesCollector:m});return a.recordJoinChannelService({endTs:Date.now(),status:"success"},G),F},v=async()=>{if(await ps(1e3),h!==null)return h;const N=oe("WEBCS_DOMAIN_BACKUP_LIST").map((j,X)=>{let ee;return ee=t.cloudProxyServer==="disabled"&&t.proxyServer?u("".concat(j,"/api/v2/transpond/webrtc?v=2"),X,t.proxyServer):t.cloudProxyServer==="disabled"||t.cloudProxyServer==="fallback"?"https://".concat(j,"/api/v2/transpond/webrtc?v=2"):u("".concat(j,"/api/v2/transpond/webrtc?v=2"),X),{url:ee,areaCode:WT(),serviceIds:[Ei.CHOOSE_SERVER,t.cloudProxyServer==="proxy5"?Ei.CLOUD_PROXY_5:t.cloudProxyServer==="proxy3"||t.cloudProxyServer==="proxy4"?Ei.CLOUD_PROXY:Ei.CLOUD_PROXY_FALLBACK]}}),G=a.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:N.map(j=>j.url)}),F=await zT({fragementLength:oe("FRAGEMENT_LENGTH"),referenceList:N,asyncMapHandler:j=>(x.debug("[".concat(t.clientId,"] Connect to backup choose_server:"),j.url),l9(j,t,r,s)),allFailedhandler:j=>{throw a.recordJoinChannelService({endTs:Date.now(),status:"error",errors:j},G),j[0]},promisesCollector:m});return a.recordJoinChannelService({endTs:Date.now(),status:"success"},G),F};let S,R,P;try{({gatewayInfo:S,proxyInfo:R,url:P}=await uS([y(),v()]))}catch(N){throw N[0]}if(m.length&&m.forEach(N=>N.cancel&&typeof N.cancel=="function"&&N.cancel()),!S||!R)throw new Oe(te.UNEXPECTED_ERROR,"missing gateway or proxy response").print();if(t.apUrl=P,t.cloudProxyServer!=="disabled"&&Array.isArray(c)&&P){const N=/^https?:\/\/(.+?)(\/.*)?$/.exec(P)[1];ot(c).call(c,N)&&(t.proxyServer=N,x.setProxyServer(N),It.setProxyServer(N))}return h={gatewayInfo:S,proxyInfo:await FH(R,S.uid)},h}async function Dge(t,r,s){const a=oe("UAP_AP").slice(0,oe("AJAX_REQUEST_CONCURRENT")).map(u=>t.proxyServer?"https://".concat(t.proxyServer,"/ap/?url=").concat(u+"/api/v1?action=uap"):"https://".concat(u,"/api/v1?action=uap")),c=a.map(u=>function(h,m,y,v){const S={command:"convergeAllocateEdge",sid:m.sid,appId:m.appId,token:m.token,ts:Date.now(),version:wl,cname:m.cname,uid:m.uid.toString(),requestId:v2,seq:v2};v2+=1;const R={service_name:"tele_channel",json_body:JSON.stringify(S)};return _d(async()=>{const P=await bd(h,{data:R,cancelToken:y,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":61}});if(P.code!==0){const G=new Oe(te.UNEXPECTED_RESPONSE,"cross channel ap error, code"+P.code,{retry:!0});throw x.error(G.toString()),G}const N=JSON.parse(P.json_body);if(N.code!==200){const G=new Oe(te.UNEXPECTED_RESPONSE,"cross channel app center error, code: ".concat(N.code,", reason: ").concat(N.reason));throw x.error(G.toString()),G}if(!N.servers||N.servers.length===0){const G=new Oe(te.UNEXPECTED_RESPONSE,"cross channel app center empty server");throw x.error(G.toString()),G}return{vid:N.vid,workerToken:N.workerToken,addressList:(oe("CHANNEL_MEDIA_RELAY_SERVERS")||N.servers).map(G=>"wss://".concat(G.address.replace(/\./g,"-"),".").concat(oe("WORKER_DOMAIN"),":").concat(G.wss))}},void 0,P=>!!(P.code!==te.OPERATION_ABORTED&&P.code!==te.UNEXPECTED_RESPONSE||P.data&&P.data.retry),v)}(u,t,r,s));try{const u=await uS(c);return c.forEach(h=>h.cancel()),u}catch(u){throw u[0]}}async function xge(t,r,s){let a=null;const c=[],u=async h=>{const m=oe(h?"WEBCS_DOMAIN_BACKUP_LIST":"WEBCS_DOMAIN").map(y=>t.proxyServer?"https://".concat(t.proxyServer,"/ap/?url=").concat(y+"/api/v2/transpond/webrtc?v=2"):"https://".concat(y,"/api/v2/transpond/webrtc?v=2"));return h&&(await ps(1e3),a!==null)?a:await zT({fragementLength:oe("FRAGEMENT_LENGTH"),referenceList:m,asyncMapHandler:y=>(x.debug("[".concat(t.clientId,"] update ticket, Connect to ").concat(h?"backup":""," choose_server:"),y),function(v,S,R,P){const[N]=Oge(S,[Ei.CHOOSE_SERVER]);let G=yi.networkState;return _d(async()=>{G&&yi.networkState===gc.OFFLINE&&yi.onlineWaiter&&await dt.race([yi.onlineWaiter,ps(P&&P.maxRetryTimeout||Pi.maxRetryTimeout)]),G=yi.networkState;const F=await bd(v,{data:N,cancelToken:R,headers:{"Content-Type":"multipart/form-data;"}},!0);return Pge(F,v)},()=>!1,F=>F.code!==te.OPERATION_ABORTED&&(F.code===te.UPDATE_TICKET_FAILED?F.data.retry:(x.warning("[".concat(S.clientId,"] update ticket network error, retry"),F),!0)),P)}(y,t,r,s)),allFailedhandler:y=>{throw y[0]},promisesCollector:c})};try{return a=await uS([u(!1),u(!0)]),c.length&&c.forEach(h=>h.cancel&&typeof h.cancel=="function"&&h.cancel()),a}catch(h){throw h[0]}}function g9(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}function w2(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?g9(Object(s),!0).forEach(function(a){K(t,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):g9(Object(s)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))})}return t}class Lge extends Ur{get isSuccess(){return!!this.configs}constructor(r,s){super(),K(this,"configs",void 0),K(this,"store",void 0),K(this,"joinInfo",void 0),K(this,"cancelToken",void 0),K(this,"retryConfig",{timeout:3e3,timeoutFactor:1.5,maxRetryCount:1,maxRetryTimeout:1e4}),K(this,"interval",void 0),K(this,"mutex",void 0),K(this,"mutableParamsRead",!1),K(this,"configCache",{}),K(this,"limit_bitrate",void 0),this.mutex=new js("config-distribute",r),this.store=s}startGetConfigDistribute(r,s){this.joinInfo=r,this.cancelToken=s,this.interval&&this.stopGetConfigDistribute(),oe("ENABLE_CONFIG_DISTRIBUTE")&&(this.updateConfigDistribute(),this.interval=window.setInterval(()=>{this.updateConfigDistribute()},oe("CONFIG_DISTRIBUTE_INTERVAL")))}stopGetConfigDistribute(){this.interval&&clearInterval(this.interval),this.interval=void 0,this.joinInfo=void 0,this.cancelToken=void 0,this.configs=void 0,this.limit_bitrate=void 0}async awaitConfigDistributeComplete(){this.mutex.isLocked&&(await this.mutex.lock())()}async updateConfigDistribute(){if(this.mutableParamsRead||(this.mutableParamsRead=!0,It.reportApiInvoke(null,{options:void 0,name:Ai.LOAD_CONFIG_FROM_LOCALSTORAGE,tag:zr.TRACER}).onSuccess(JSON.stringify(yd))),!this.joinInfo||!this.cancelToken||!this.retryConfig)return void x.debug("[config-distribute] get config distribute interrupted have no joininfo");let r;const s=await this.mutex.lock();try{r=await Nge(this.joinInfo,this.cancelToken,this.retryConfig),x.debug("[config-distribute] get config distribute",JSON.stringify(r));const a=function(c){var u;const h=uT(u=Object.keys(c).filter(v=>/^webrtc_ng_global_parameter/.test(v))).call(u);for(let v=0;v<h.length;v++)for(let S=h.length-1;S>v;S--){const R=h[S],P=c[R].value;if(typeof P.__priority=="number"){const N=P.__priority,G=h[S-1],F=c[G].value;if(typeof F.__priority=="number"){if(!(N>F.__priority))continue;{const j=R;h[S]=h[S-1],h[S-1]=j}}else{const j=R;h[S]=h[S-1],h[S-1]=j}}}const m=Date.now();let y={};return h.forEach(v=>{const S=c[v].value.__expires;S&&S<=m||(y[v]=c[v])}),y}(r);this.cacheGlobalParameterConfig(a),this.store.hasStartJoinChannel||(this.store.isABTestSuccess=!0),this.configs=a}catch(a){const c=new Oe(te.NETWORK_RESPONSE_ERROR,a);x.warning("[config-distribute] ".concat(c.toString()))}finally{s()}}getBitrateLimit(){return this.limit_bitrate||void 0}handleBitrateLimit(r){IH(r)&&(this.limit_bitrate?this.limit_bitrate&&this.limit_bitrate.id!==r.id&&this.emit(LT.UPDATE_BITRATE_LIMIT,r):this.emit(LT.UPDATE_BITRATE_LIMIT,r))}getLowStreamConfigDistribute(){return this.limit_bitrate&&w2({},this.limit_bitrate.low_stream_uplink)}handleABTestConfigDistribute(r){try{const s={},a=Object.keys(r),c=[];a.forEach(u=>{const h=r[u].value;s[u]=h;const m=h.__id;if(m&&this.configCache[u]&&this.configCache[u].__id===m)return;const y=h.__type,v=r[u].value,S=r[u].tag;let R=0;y?y===nz.REALTIME&&(R=1):Object.keys(v).some(P=>Object.prototype.hasOwnProperty.call(kL,P)||!e2()&&Object.prototype.hasOwnProperty.call(eP,P)?(R=1,!0):void 0),c.push({tag:S,isApplied:R,feature:u,params:JSON.stringify(h)})}),c.forEach(u=>{let{tag:h,feature:m,params:y,isApplied:v}=u;this.store.sessionId&&It.abTest(this.store.sessionId,{intSucc:1,isApplied:v,tag:h,feature:m,params:y,cid:this.store.cid,uid:this.store.intUid})}),this.configCache=s}catch(s){x.debug("handleABTestConfigDistribute error",s)}}cacheGlobalParameterConfig(r){const s=function(c){const u={};return Object.keys(c).forEach(h=>{const m=c[h].value,y=m.__expires,v=m.__type;Object.keys(m).forEach(S=>{S==="__id"||S==="__type"||S==="__priority"||S==="__expires"||Object.prototype.hasOwnProperty.call(u,S)||(u[S]=w2(w2({value:m[S]},y&&{expires:y}),v&&{type:v}))})}),u}(r);try{var a;const c=(a=s.LIMIT_BITRATE)===null||a===void 0?void 0:a.value;delete s.LIMIT_BITRATE,c&&IH(c)&&this.handleBitrateLimit(c),this.limit_bitrate=c,this.handleGlobalParameterConfig(s),this.handleABTestConfigDistribute(r),function(m){try{const y=Date.now();Object.keys(m).forEach(v=>{const{value:S,type:R,expires:P}=m[v];P&&P<=y||((R===nz.REALTIME||Object.prototype.hasOwnProperty.call(kL,v))&&(yd[v]=S,vr[v]=S,x.debug("Update realtime parameters from config distribute",v,S)),R||e2()||!Object.prototype.hasOwnProperty.call(eP,v)||(yd[v]=S,vr[v]=S,x.debug("Update gateway parameters from config distribute",v,S)))})}catch(y){x.error("Error update config immediately: ".concat(m),y.message)}}(s);const u=JSON.stringify(s),h=window.btoa(u);window.localStorage.setItem("websdk_ng_global_parameter",h),x.debug("Caching global parameters ".concat(u))}catch(c){x.error("Error caching global parameters:",c.message)}}handleGlobalParameterConfig(r){try{const s=Date.now();Object.keys(r).forEach(a=>{if(a==="CLIENT_ROLE_OPTIONS"&&Object.prototype.hasOwnProperty.call(vr,a)){const{value:c,expires:u}=r[a];if(u&&u<=s)return;(function(h,m){try{return typeof h=="object"&&typeof m=="object"&&JSON.stringify(h)===JSON.stringify(m)}catch{return!1}})(vr[a],c)||(yd[a]=c,vr[a]=c,this.emit(LT.UPDATE_CLIENT_ROLE_OPTIONS,c),x.debug("Updating client role options: ".concat(JSON.stringify(c))))}})}catch(s){x.error("Error handling global parameter config:",s.message)}}}class Mge extends Ur{constructor(){super(...arguments),K(this,"resultStorage",new Map)}setLocalAudioStats(r,s,a){this.record("AUDIO_INPUT_LEVEL_TOO_LOW",r,this.checkAudioInputLevel(a,s)),this.record("SEND_AUDIO_BITRATE_TOO_LOW",r,this.checkSendAudioBitrate(a,s))}setLocalVideoStats(r,s,a){this.record("SEND_VIDEO_BITRATE_TOO_LOW",r,this.checkSendVideoBitrate(a,s)),this.record("FRAMERATE_INPUT_TOO_LOW",r,this.checkFramerateInput(a,s)),this.record("FRAMERATE_SENT_TOO_LOW",r,this.checkFramerateSent(a))}setRemoteAudioStats(r,s){const a=r.getUserId();this.record("AUDIO_OUTPUT_LEVEL_TOO_LOW",a,this.checkAudioOutputLevel(s))}setRemoteVideoStats(r,s){const a=r.getUserId();this.record("RECV_VIDEO_DECODE_FAILED",a,this.checkVideoDecode(s))}record(r,s,a){if(oe("STATS_UPDATE_INTERVAL")>500)return;this.resultStorage.has(r)||this.resultStorage.set(r,{result:[],isPrevNormal:!0});const c=this.resultStorage.get(r);if(c&&(c.result.push(a),c.result.length>=5)){var u;const h=ot(u=c.result).call(u,!0);c.isPrevNormal&&!h&&this.emit("exception",_9[r],r,s),!c.isPrevNormal&&h&&this.emit("exception",_9[r]+2e3,r+"_RECOVER",s),c.isPrevNormal=h,c.result=[]}}checkAudioOutputLevel(r){return!(r.receiveBitrate>0&&r.receiveLevel===0)}checkAudioInputLevel(r,s){return s instanceof Li&&!s.isActive||!!s.muted||r.sendVolumeLevel!==0}checkFramerateInput(r,s){let a=null;s._encoderConfig&&s._encoderConfig.frameRate&&(a=_c(s._encoderConfig.frameRate));const c=r.captureFrameRate;return!a||!c||!(a>10&&c<5||a<10&&a>=5&&c<=1)}checkFramerateSent(r){return!(r.captureFrameRate&&r.sendFrameRate&&r.captureFrameRate>5&&r.sendFrameRate<=1)}checkSendVideoBitrate(r,s){return!!s.muted||r.sendBitrate!==0}checkSendAudioBitrate(r,s){return s instanceof Li&&!s.isActive||!!s.muted||r.sendBitrate!==0}checkVideoDecode(r){return r.receiveBitrate===0||r.decodeFrameRate!==0}}const _9={FRAMERATE_INPUT_TOO_LOW:1001,FRAMERATE_SENT_TOO_LOW:1002,SEND_VIDEO_BITRATE_TOO_LOW:1003,RECV_VIDEO_DECODE_FAILED:1005,AUDIO_INPUT_LEVEL_TOO_LOW:2001,AUDIO_OUTPUT_LEVEL_TOO_LOW:2002,SEND_AUDIO_BITRATE_TOO_LOW:2003},zs=new class{markSubscribeStart(t,r){performance.mark("agora-web-sdk/".concat(t,"/subscribe-").concat(r))}markPublishStart(t,r){performance.mark("agora-web-sdk/".concat(t,"/publish-").concat(r))}measureFromSubscribeStart(t,r){const s=performance.getEntriesByName("agora-web-sdk/".concat(t,"/subscribe-").concat(r));if(s.length>0){const a=s[s.length-1];return Math.round(performance.now()-a.startTime)}return 0}measureFromPublishStart(t,r){const s=performance.getEntriesByName("agora-web-sdk/".concat(t,"/publish-").concat(r));if(s.length>0){const a=s[s.length-1];return Math.round(performance.now()-a.startTime)}return 0}};function y9(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}function X_(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?y9(Object(s),!0).forEach(function(a){K(t,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):y9(Object(s)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))})}return t}class GT{constructor(r){K(this,"store",void 0),K(this,"onStatsException",void 0),K(this,"onUploadPublishDuration",void 0),K(this,"onStatsChanged",void 0),K(this,"localStats",new Map),K(this,"remoteStats",new Map),K(this,"updateStatsInterval",void 0),K(this,"trafficStats",void 0),K(this,"trafficStatsPeerList",[]),K(this,"uplinkStats",void 0),K(this,"exceptionMonitor",void 0),K(this,"p2pChannel",void 0),K(this,"scalabilityMode",ZA.L1T1),K(this,"updateStats",()=>{this.p2pChannel&&(this.updateRemoteStats(this.p2pChannel),this.updateLocalStats(this.p2pChannel))}),this.store=r,this.exceptionMonitor=new Mge,this.exceptionMonitor.on("exception",(s,a,c)=>{this.onStatsException&&this.onStatsException(s,a,c)})}startUpdateStats(){this.updateStatsInterval||(this.updateStatsInterval=window.setInterval(this.updateStats,1e3))}stopUpdateStats(){this.updateStatsInterval&&(window.clearInterval(this.updateStatsInterval),this.updateStatsInterval=void 0)}reset(){this.localStats=new Map,this.remoteStats=new Map,this.trafficStats=void 0,this.trafficStatsPeerList=[],this.uplinkStats=void 0}getLocalAudioTrackStats(){return this.localStats.get(Ke.LocalAudioTrack)||X_({},ML)}getLocalVideoTrackStats(){return this.localStats.get(Ke.LocalVideoTrack)||X_({},UL)}getRemoteAudioTrackStats(r){const s=(u,h)=>{if(!this.trafficStats)return h;const m=this.trafficStats.peer_delay.find(y=>y.peer_uid===u);return m&&(h.publishDuration=m.B_ppad+(Date.now()-this.trafficStats.timestamp)),h},a={};if(r){var c;const u=(c=this.remoteStats.get(r))===null||c===void 0?void 0:c.audioStats;u&&(a[r]=s(r,u))}else Array.from(this.remoteStats.entries()).forEach(u=>{let[h,{audioStats:m}]=u;m&&(a[h]=s(h,m))});return a}getRemoteNetworkQualityStats(r){const s={};if(r){var a;const c=(a=this.remoteStats.get(r))===null||a===void 0?void 0:a.networkStats;c&&(s[r]=c)}else Array.from(this.remoteStats.entries()).forEach(c=>{let[u,{networkStats:h}]=c;h&&(s[u]=h)});return s}getRemoteVideoTrackStats(r){const s=(u,h)=>{if(!this.trafficStats)return h;const m=this.trafficStats.peer_delay.find(y=>y.peer_uid===u);return m&&(h.publishDuration=m.B_ppvd+(Date.now()-this.trafficStats.timestamp)),h},a={};if(r){var c;const u=(c=this.remoteStats.get(r))===null||c===void 0?void 0:c.videoStats;u&&(a[r]=s(r,u))}else Array.from(this.remoteStats.entries()).forEach(u=>{let[h,{videoStats:m}]=u;m&&(a[h]=s(h,m))});return a}getRTCStats(){let r=0,s=0,a=0,c=0;const u=this.localStats.get(Ke.LocalAudioTrack);u&&(r+=u.sendBytes,s+=u.sendBitrate);const h=this.localStats.get(Ke.LocalVideoTrack);h&&(r+=h.sendBytes,s+=h.sendBitrate);const m=this.localStats.get(Ke.LocalVideoLowTrack);m&&(r+=m.sendBytes,s+=m.sendBitrate),this.remoteStats.forEach(v=>{let{audioStats:S,videoStats:R}=v;S&&(a+=S.receiveBytes,c+=S.receiveBitrate),R&&(a+=R.receiveBytes,c+=R.receiveBitrate)});let y=1;return this.trafficStats&&(y+=this.trafficStats.peer_delay.length),{Duration:0,UserCount:y,SendBitrate:s,SendBytes:r,RecvBytes:a,RecvBitrate:c,OutgoingAvailableBandwidth:this.uplinkStats?this.uplinkStats.B_uab/1e3:0,RTT:this.trafficStats?2*this.trafficStats.B_acd:0}}addLocalStats(r){this.localStats.set(r,void 0)}removeLocalStats(r){r?this.localStats.delete(r):this.localStats.clear()}addRemoteStats(r){this.remoteStats.set(r,{})}removeRemoteStats(r){r?this.remoteStats.delete(r):this.remoteStats.clear()}addP2PChannel(r){this.p2pChannel=r}updateTrafficStats(r){r.peer_delay=r.peer_delay.filter(s=>s.B_ppad!==void 0||s.B_ppvd!==void 0),r.peer_delay.filter(s=>this.trafficStatsPeerList.indexOf(s.peer_uid)===-1).forEach(s=>{var a;const c=(a=this.p2pChannel)===null||a===void 0?void 0:a.getRemoteMedia(s.peer_uid),u=c!=null&&c.videoSSRC?zs.measureFromSubscribeStart(this.store.clientId,c.videoSSRC):0,h=c!=null&&c.audioSSRC?zs.measureFromSubscribeStart(this.store.clientId,c.audioSSRC):0;s.B_ppad!==void 0&&s.B_ppvd!==void 0&&(this.onUploadPublishDuration&&this.onUploadPublishDuration(s.peer_uid,s.B_ppad,s.B_ppvd,u>h?u:h),this.trafficStatsPeerList.push(s.peer_uid))}),this.trafficStats=r}updateUplinkStats(r){this.uplinkStats&&this.uplinkStats.B_fir!==r.B_fir&&x.debug("[".concat(this.store.clientId,"]: Period fir changes to ").concat(r.B_fir)),this.uplinkStats=r}static isRemoteVideoFreeze(r,s,a){if(!r)return!1;const c=!!a&&s.framesDecodeFreezeTime>a.framesDecodeFreezeTime,u=!a||s.framesDecodeCount>a.framesDecodeCount;return c||!u}static isRemoteAudioFreeze(r){return!!r&&r._isFreeze()}isLocalVideoFreeze(r){return!(!r.inputFrame||!r.sentFrame)&&r.inputFrame.frameRate>5&&r.sentFrame.frameRate<3}updateLocalStats(r){Array.from(this.localStats.entries()).forEach(s=>{let[a,c]=s;switch(a){case Ke.LocalVideoTrack:case Ke.LocalVideoLowTrack:{const h=c,m=X_({},UL),y=r.getStats(),v=r.getLocalMedia(a);if(y){const S=y.videoSend.find(R=>R.ssrc===(v==null?void 0:v.ssrcs[0].ssrcId));if(S){const R=r.getLocalVideoSize(),P=r.getEncoderConfig(Ke.LocalVideoTrack);S.codec!=="H264"&&S.codec!=="H265"&&S.codec!=="VP8"&&S.codec!=="VP9"&&S.codec!=="AV1X"&&S.codec!=="AV1"||(m.codecType=S.codec),m.sendBytes=S.bytes,m.sendBitrate=h?8*Math.max(0,m.sendBytes-h.sendBytes):0,S.inputFrame?(m.captureFrameRate=S.inputFrame.frameRate,m.captureResolutionHeight=S.inputFrame.height,m.captureResolutionWidth=S.inputFrame.width):R&&(m.captureResolutionWidth=R.width,m.captureResolutionHeight=R.height),S.sentFrame?(m.sendFrameRate=S.sentFrame.frameRate,m.sendResolutionHeight=S.sentFrame.height,m.sendResolutionWidth=S.sentFrame.width):R&&(m.sendResolutionWidth=R.width,m.sendResolutionHeight=R.height),S.avgEncodeMs&&(m.encodeDelay=S.avgEncodeMs),P&&P.bitrateMax&&(m.targetSendBitrate=1e3*P.bitrateMax),m.sendPackets=S.packets,m.sendPacketsLost=S.packetsLost,m.sendJitterMs=S.jitterMs,m.sendRttMs=S.rttMs,m.totalDuration=h?h.totalDuration+1:1,m.totalFreezeTime=h?h.totalFreezeTime:0,this.isLocalVideoFreeze(S)&&(m.totalFreezeTime+=1),S.scalabilityMode&&this.scalabilityMode!==S.scalabilityMode&&(x.debug("[".concat(this.store.clientId,"]: The scalabilityMode of the video sending stream is ").concat(S.scalabilityMode)),this.scalabilityMode=S.scalabilityMode)}this.trafficStats&&(m.currentPacketLossRate=(this.trafficStats.B_pvlr4||0)/100)}var u;this.localStats.set(a,m),((h==null?void 0:h.sendResolutionWidth)!==m.sendResolutionWidth||(h==null?void 0:h.sendResolutionHeight)!==m.sendResolutionHeight)&&((u=this.onStatsChanged)===null||u===void 0||u.call(this,"resolution",{width:m.sendResolutionWidth,height:m.sendResolutionHeight})),m&&v&&this.exceptionMonitor.setLocalVideoStats(this.store.uid,v.track,m);break}case Ke.LocalAudioTrack:{const h=c,m=X_({},ML),y=r.getStats(),v=r.getLocalMedia(a);if(y){const S=y.audioSend.find(R=>R.ssrc===(v==null?void 0:v.ssrcs[0].ssrcId));if(S){if(S.codec!=="opus"&&S.codec!=="aac"&&S.codec!=="PCMU"&&S.codec!=="PCMA"&&S.codec!=="G722"||(m.codecType=S.codec),S.inputLevel)m.sendVolumeLevel=Math.round(32767*S.inputLevel);else{const R=r.getLocalAudioVolume();R&&(m.sendVolumeLevel=Math.round(32767*R))}m.sendBytes=S.bytes,m.sendPackets=S.packets,m.sendPacketsLost=S.packetsLost,m.sendJitterMs=S.jitterMs,m.sendRttMs=S.rttMs,m.sendBitrate=h?8*Math.max(0,m.sendBytes-h.sendBytes):0}}this.trafficStats&&(m.currentPacketLossRate=(this.trafficStats.B_palr4||0)/100),this.localStats.set(Ke.LocalAudioTrack,m),m&&v&&this.exceptionMonitor.setLocalAudioStats(this.store.uid,v.track,m);break}}})}updateRemoteStats(r){Array.from(this.remoteStats.entries()).forEach(s=>{var a,c;let[u,{videoStats:h,audioStats:m,videoPcStats:y}]=s;const v=m,S=h,R=y,P=X_({},fz),N=X_({},pz),G=X_({},vme),{audioTrack:F,videoTrack:j,audioSSRC:X,videoSSRC:ee}=r.getRemoteMedia(u);let he;he=this.store.useP2P?r.getStats(!0):r.getStats();const Se=(a=he)===null||a===void 0?void 0:a.audioRecv.find(Ye=>Ye.ssrc===X),Te=(c=he)===null||c===void 0?void 0:c.videoRecv.find(Ye=>Ye.ssrc===ee),ye=this.trafficStats&&this.trafficStats.peer_delay.find(Ye=>Ye.peer_uid===u);if(Se&&(Se.codec!=="opus"&&Se.codec!=="aac"&&Se.codec!=="PCMU"&&Se.codec!=="PCMA"&&Se.codec!=="G722"||(P.codecType=Se.codec),Se.outputLevel?P.receiveLevel=Math.round(32767*Se.outputLevel):F&&(P.receiveLevel=Math.round(32767*F.getVolumeLevel())),P.receiveBytes=Se.bytes,P.receivePackets=Se.packets,P.receivePacketsLost=Se.packetsLost,P.receivePacketsDiscarded=Se.packetsDiscarded,P.packetLossRate=P.receivePacketsLost/(P.receivePackets+P.receivePacketsLost),P.receiveBitrate=v?8*Math.max(0,P.receiveBytes-v.receiveBytes):0,P.totalDuration=v?v.totalDuration+1:1,P.totalFreezeTime=v?v.totalFreezeTime:0,P.freezeRate=P.totalFreezeTime/P.totalDuration,P.receiveDelay=Se.jitterBufferMs,P.totalDuration>10&&GT.isRemoteAudioFreeze(F)&&(P.totalFreezeTime+=1)),Te){var Ne;Te.codec!=="H264"&&Te.codec!=="H265"&&Te.codec!=="VP8"&&Te.codec!=="VP9"&&Te.codec!=="AV1X"&&Te.codec!=="AV1"||(N.codecType=Te.codec),N.receiveBytes=Te.bytes,N.receiveBitrate=S?8*Math.max(0,N.receiveBytes-S.receiveBytes):0,N.decodeFrameRate=Te.decodeFrameRate<0?0:Te.decodeFrameRate,N.renderFrameRate=Te.decodeFrameRate<0?0:Te.decodeFrameRate,Te.outputFrame&&(N.renderFrameRate=Te.outputFrame.frameRate),Te.receivedFrame?(N.receiveFrameRate=Te.receivedFrame.frameRate,N.receiveResolutionHeight=Te.receivedFrame.height,N.receiveResolutionWidth=Te.receivedFrame.width):j&&(N.receiveResolutionHeight=j._videoHeight||0,N.receiveResolutionWidth=j._videoWidth||0),Te.framesRateFirefox!==void 0&&(N.receiveFrameRate=Math.round(Te.framesRateFirefox)),N.receivePackets=Te.packets,N.receivePacketsLost=Te.packetsLost,N.packetLossRate=N.receivePacketsLost/(N.receivePackets+N.receivePacketsLost);const Ye=S?S.totalFreezeTime:0,ht=S?S.totalDuration:0;N.totalDuration=S?S.totalDuration+1:1,N.totalFreezeTime=(Ne=Te.totalFreezesDuration)!==null&&Ne!==void 0?Ne:Ye||0,N.receiveDelay=Te.jitterBufferMs||0;const mt=!!ee&&r.getRemoteVideoIsReady(ee);Te.totalFreezesDuration===void 0&&j&&mt&&GT.isRemoteVideoFreeze(j,Te,R)&&(N.totalFreezeTime+=1),N.freezeRate=Math.max(0,Math.min((N.totalFreezeTime-Ye)/(N.totalDuration-ht),1))}ye&&(P.end2EndDelay=ye.B_ad,N.end2EndDelay=ye.B_vd,P.transportDelay=ye.B_ed,N.transportDelay=ye.B_ed,P.currentPacketLossRate=ye.B_ealr4/100,N.currentPacketLossRate=ye.B_evlr4/100,G.uplinkNetworkQuality=ye.B_punq?ye.B_punq:0,G.downlinkNetworkQuality=ye.B_pdnq?ye.B_pdnq:0),this.remoteStats.set(u,{audioStats:P,videoStats:N,videoPcStats:Te,networkStats:G}),F&&this.exceptionMonitor.setRemoteAudioStats(F,P),j&&this.exceptionMonitor.setRemoteVideoStats(j,N)})}}class E9{constructor(){K(this,"destChannelMediaInfos",new Map),K(this,"srcChannelMediaInfo",void 0)}setSrcChannelInfo(r){CH(r),this.srcChannelMediaInfo=r}addDestChannelInfo(r){CH(r),this.destChannelMediaInfos.set(r.channelName,r)}removeDestChannelInfo(r){EP(r),this.destChannelMediaInfos.delete(r)}getSrcChannelMediaInfo(){return this.srcChannelMediaInfo}getDestChannelMediaInfo(){return this.destChannelMediaInfos}}function v9(t){if(!(t instanceof E9))return new Oe(te.INVALID_PARAMS,"Config should be instance of [ChannelMediaRelayConfiguration]").throw();const r=t.getSrcChannelMediaInfo(),s=t.getDestChannelMediaInfo();if(!r)return new Oe(te.INVALID_PARAMS,"srcChannelMediaInfo should not be empty").throw();if(s.size===0)return new Oe(te.INVALID_PARAMS,"destChannelMediaInfo should not be empty").throw()}class qm{get hasVideo(){return this._video_enabled_&&!this._video_muted_&&this._video_added_}get hasAudio(){return this._audio_enabled_&&!this._audio_muted_&&this._audio_added_}get audioTrack(){if(this.hasAudio||this._audio_pre_subscribed)return this._audioTrack}get videoTrack(){if(this.hasVideo||this._video_pre_subscribed)return this._videoTrack}get dataChannels(){return this._dataChannels}constructor(r,s){K(this,"uid",void 0),K(this,"_uintid",void 0),K(this,"_trust_in_room_",!0),K(this,"_trust_audio_enabled_state_",!0),K(this,"_trust_video_enabled_state_",!0),K(this,"_trust_audio_mute_state_",!0),K(this,"_trust_video_mute_state_",!0),K(this,"_audio_muted_",!1),K(this,"_video_muted_",!1),K(this,"_audio_enabled_",!0),K(this,"_video_enabled_",!0),K(this,"_audio_added_",!1),K(this,"_video_added_",!1),K(this,"_is_pre_created",!1),K(this,"_video_pre_subscribed",!1),K(this,"_audio_pre_subscribed",!1),K(this,"_trust_video_stream_added_state_",!0),K(this,"_trust_audio_stream_added_state_",!0),K(this,"_audioTrack",void 0),K(this,"_videoTrack",void 0),K(this,"_dataChannels",[]),K(this,"_audioSSRC",void 0),K(this,"_videoSSRC",void 0),K(this,"_audioOrtc",void 0),K(this,"_videoOrtc",void 0),K(this,"_cname",void 0),K(this,"_rtxSsrcId",void 0),K(this,"_videoMid",void 0),K(this,"_audioMid",void 0),this.uid=r,this._uintid=s}}function S9(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}function b9(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?S9(Object(s),!0).forEach(function(a){K(t,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):S9(Object(s)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))})}return t}const HT="9",T9=4e4;function w9(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}function hp(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?w9(Object(s),!0).forEach(function(a){K(t,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):w9(Object(s)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))})}return t}var dS=function(t){return t[t.DOWN=0]="DOWN",t[t.UP=1]="UP",t}(dS||{});const DP=new Map;function C9(t,r,s,a){let{scale:c}=t;if(c===0&&a===dS.UP||c>=r.length-1&&a===dS.DOWN)return t;let u=hp(hp({},t),{},{scale:a===dS.DOWN?++c:--c});switch(s){case"maintain-framerate":u=hp(hp({},u),r[c].motion);break;case"maintain-resolution":u=hp(hp({},u),r[c].detail);break;case"balanced":u=hp(hp({},u),r[c].balanced)}return u}function R9(t,r){if(r){const s={overUse:0,underUse:0,adaptationList:I9(r)};DP.set(t,s)}else DP.delete(t)}function I9(t){const r=hp({},t),{bitrateMax:s,frameRate:a,scaleResolutionDownBy:c,bitrateMin:u}=r,{MIN_FRAME_RATE:h,MAX_THRESHOLD_FRAMERATE:m,MAX_SCALE:y,BITRATE_MIN_THRESHOLD:v,BITRATE_MAX_THRESHOLD:S,BWE_SCALE_UP_THRESHOLD:R,BWE_SCALE_DOWN_THRESHOLD:P,PERF_SCALE_DOWN_THRESHOLD:N,PERF_SCALE_UP_THRESHOLD:G,BALANCE_BITRATE_FACTOR:F,BALANCE_FRAMERATE_FACTOR:j,BALANCE_RESOLUTION_FACTOR:X,MOTION_RESOLUTION_FACTOR:ee,MOTION_BITRATE_FACTOR:he,DETAIL_FRAMERATE_FACTOR:Se,DETAIL_BITRATE_FACTOR:Te}=PL,ye=Math.min(r.frameRate,m),Ne=[{scale:0,threshold:{bwe_down:Math.round(Math.pow(P,1)*s),bwe_up:s,fps_down:Math.round(Math.pow(N,1)*ye),fps_up:a},balanced:{scaleResolutionDownBy:1,frameRate:a,bitrateMax:s,bitrateMin:u},motion:{scaleResolutionDownBy:1,frameRate:a,bitrateMax:s,bitrateMin:u},detail:{scaleResolutionDownBy:1,frameRate:a,bitrateMax:s,bitrateMin:u}}];for(let Ye=1;Ye<=y;Ye++){const ht={bwe_up:Math.round(Math.pow(R,Ye)*s),bwe_down:Math.round(Math.pow(P,Ye+1)*s),fps_up:Math.round(Math.pow(G,Ye)*ye),fps_down:Math.round(Math.pow(N,Ye+1)*ye)},mt={scaleResolutionDownBy:c/Math.pow(X,Ye),frameRate:Math.max(Math.round(Math.pow(j,Ye)*a),h),bitrateMax:Math.max(Math.round(Math.pow(F,Ye)*s),S),bitrateMin:Math.max(Math.round(Math.pow(F,Ye)*u),v)},Tn={scaleResolutionDownBy:c/Math.pow(ee,Ye),frameRate:a,bitrateMax:Math.max(Math.round(Math.pow(he,Ye)*s),S),bitrateMin:Math.max(Math.round(Math.pow(he,Ye)*u),v)},wn={scaleResolutionDownBy:1,frameRate:Math.max(Math.round(Math.pow(Se,Ye)*a),h),bitrateMax:Math.max(Math.round(Math.pow(Te,Ye)*s),S),bitrateMin:Math.max(Math.round(Math.pow(Te,Ye)*u),v)};Ne.push({scale:Ye,threshold:ht,balanced:mt,motion:Tn,detail:wn})}return Ne}function Uge(t,r,s,a,c,u){const h=DP.get(t)||{overUse:0,underUse:0,adaptationList:I9(c)},{adaptationList:m}=h;DP.set(t,h);const{OVERUSE_TIMES_THRESHOLD:y,UNDERUSE_TIMES_THRESHOLD:v}=PL,{scale:S}=a;let R,P;return typeof r=="number"&&r>0&&function(N,G,F,j){if(G>=F.length)return!1;let{threshold:{fps_down:X}}=F[G];return oe("FORCE_AG_HIGH_FRAMERATE")&&j==="maintain-framerate"&&(X=F[0].threshold.fps_down),N<X}(r,S,m,u)&&(h.overUse++,P=PT.CPU,h.overUse>y)||typeof s=="number"&&s>0&&function(N,G,F){if(G>=F.length)return!1;const{threshold:{bwe_down:j}}=F[G];return N<j}(s,S,m)&&(h.overUse++,P=PT.BANDWIDTH,h.overUse>y)?(h.overUse=0,h.underUse=0,R=C9(a,m,u,dS.DOWN),[R,P]):(typeof r=="number"&&r>0&&typeof s=="number"&&s>0&&function(N,G,F,j){if(G===0)return;let{threshold:{fps_up:X}}=F[G];return oe("FORCE_AG_HIGH_FRAMERATE")&&j==="maintain-framerate"&&(X=F[1].threshold.fps_up),N>X}(r,S,m,u)&&function(N,G,F){if(G===0)return;const{threshold:{bwe_up:j}}=F[G];return N>j}(s,S,m)&&(h.underUse++,h.underUse>v&&(h.overUse=0,h.underUse=0,R=C9(a,m,u,dS.UP),R.scale===0&&(P=PT.NONE))),[R,P])}function A9(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}function C2(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?A9(Object(s),!0).forEach(function(a){K(t,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):A9(Object(s)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))})}return t}function Vge(t){var r;return!!oe("ENABLE_AG_ADAPTATION")&&!!(t instanceof $L||ot(r=t._hints).call(r,hr.CUSTOM_TRACK))&&(!!oe("FORCE_SUPPORT_AG_ADAPTATION")||!!(function(s){const a=Nn();if(a.os!==Yi.IOS||!a.osVersion)return!1;const c=a.osVersion.split(".");return Number(c[0])>=s}(14)&&w8(17,4)||T8(14)&&C8(17,4,!0)))}const xP=new Map;function LP(t,r){const s=xP.get(t);if(s){const{timer:a}=s;window.clearTimeout(a),xP.delete(t)}r.qualityLimitationReason=PT.NONE,R9(t)}function Fge(t,r){var s;let a;switch(r){case Ke.LocalAudioTrack:a=Yn.Audio;break;case Ke.LocalVideoTrack:a=ot(s=t._hints).call(s,hr.SCREEN_TRACK)?Yn.Screen:Yn.High;break;case Ke.LocalVideoLowTrack:a=Yn.Low}return a}function R2(t){const r=Vn();if(t.some(s=>s._bypassWebAudio))throw new Le(te.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");if(!r.webAudioMediaStreamDest)throw new Le(te.NOT_SUPPORTED,"cannot publish multiple tracks because your browser does not support audio mixing")}function I2(t,r){R2(t);const s=new Li;return t.forEach(a=>s.addAudioTrack(a)),s}const jge=!Vn().supportUnifiedPlan||oe("CHROME_FORCE_PLAN_B")&&np();function MP(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var s;return jge?(s={spec:r,store:t},up("PlanBConnection").create(s)):new Ih(r,t)}function A2(t){return t&&(t.iceConnectionState==="disconnected"||t.iceConnectionState==="checking"||t.iceConnectionState==="failed")}function P9(t){try{if(t.iceServers)return!1;if(t.turnServer&&t.turnServer.mode!=="off"){if(RT(t.turnServer.servers))return!1;if(oe("FORCE_TURN_TCP")||t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).some(r=>r.forceturn))return!0}return!1}catch{return!1}}var Rn;function O9(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}function Td(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?O9(Object(s),!0).forEach(function(a){K(t,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):O9(Object(s)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))})}return t}let Ih=(Rn=class _y extends PH{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var r,s;return(r=(s=this.peerConnection.getReceivers()[0])===null||s===void 0||(s=s.transport)===null||s===void 0?void 0:s.state)!==null&&r!==void 0?r:null}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.send.videoCodecs.map(r=>r.rtpMap&&r.rtpMap.encodingName.toLowerCase()||"").filter(r=>{var s;return ot(s=Object.keys(tP)).call(s,r)}))]}constructor(r,s){super(r,s),K(this,"id",dr(5,"connection-")),K(this,"store",void 0),K(this,"peerConnection",void 0),K(this,"forceTurn",!1),K(this,"remoteSDP",void 0),K(this,"initialOffer",void 0),K(this,"transportEventReceiver",void 0),K(this,"statsFilter",void 0),K(this,"extension",{useXR:oe("USE_XR")}),K(this,"localCapabilities",void 0),K(this,"remoteCodecs",void 0),K(this,"localCandidateCount",0),K(this,"allCandidatesReceived",!1),K(this,"isPreallocation",!1),K(this,"preSSRCMap",new Map),K(this,"dataStreamChannelMap",new Map),K(this,"establishPromise",void 0),K(this,"recoveredDataChannelIds",[]),K(this,"currentDataChannelId",1),K(this,"supportAV1RtpSpec",!1),K(this,"mutex",void 0),K(this,"qualityLimitationReason",PT.NONE),K(this,"isFirstConnected",!1),this.store=s,this.forceTurn=P9(r),this.mutex=new js("P2PConnection-mutex",s.clientId),this.peerConnection=new RTCPeerConnection(_y.resolvePCConfiguration(r),{optional:[{googDscp:!0}]}),this.isFirstConnected=!1,this.statsFilter=RL(this.peerConnection,oe("STATS_UPDATE_INTERVAL"),void 0,Br()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}getPreMedia(r){const s=this.preSSRCMap.get(r);if(s!==void 0){const a=this.peerConnection.getTransceivers().find(c=>c.mid===s);if(a)return{transceiver:a,track:a.receiver.track,id:s}}}async updateRemoteRTPCapabilities(r,s){if(this.remoteCodecs=s,!this.remoteSDP)return void x.debug("[P2PConnection] cannot updateRemoteRTPCapabilities before remote SDP created, local codecs: ".concat(this.localCodecs,", codecs: ").concat(s));if(this.remoteSDP.updateRemoteCodec(r,s,this.store.codec)){const a=await this.peerConnection.createOffer(),c=this.logSDPExchange(a.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(a);const u=this.remoteSDP.toString();c==null||c(u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}else x.debug("[P2PConnection] updateRemoteRTPCapabilities no need to exchange SDP.")}async establish(){try{this.peerConnection.addTransceiver("video",{direction:"recvonly"}),this.peerConnection.addTransceiver("audio",{direction:"recvonly"});const a=await this.peerConnection.createOffer();if(!a.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const c=$m(a.sdp),u=await YH({filterRTX:!oe("USE_PUB_RTX")&&!oe("USE_SUB_RTX"),filterVideoFec:oe("FILTER_VIDEO_FEC"),filterAudioFec:oe("FILTER_AUDIO_FEC"),filterVideoCodec:oe("FILTER_VIDEO_CODEC")},this.extension);if(this.localCapabilities=AP(u),this.initialOffer=a,oe("ENABLE_SVC")&&this.store.codec=="av1"){const m=await async function(){try{const y=new RTCPeerConnection;y.addTransceiver("video",{direction:"sendonly",sendEncodings:[{scalabilityMode:ZA.L1T3}]});const v=await y.createOffer();if(!v.sdp)return void y.close();const S=Ba(v.sdp).mediaDescriptions[0];if(!S)return;const R=S.attributes.extmaps.find(P=>P.extensionName==="https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension");return y.close(),R}catch{return}}();var r;m&&(this.supportAV1RtpSpec=!0,(r=u.send)===null||r===void 0||r.videoExtensions.push(m))}let h;return a.sdp&&ZH(a.sdp)&&(h=Gr(u),(s=h).send&&(oS(_t.VIDEO,s.send.videoExtensions),oS(_t.AUDIO,s.send.audioExtensions)),s.recv&&(oS(_t.VIDEO,s.recv.videoExtensions),oS(_t.AUDIO,s.recv.audioExtensions)),s.sendrecv&&(oS(_t.VIDEO,s.sendrecv.videoExtensions),oS(_t.AUDIO,s.sendrecv.audioExtensions))),Td(Td({},c),{},{rtpCapabilities:h||u,offerSDP:a.sdp})}catch(a){throw new Le(te.GET_LOCAL_CONNECTION_PARAMS_FAILED,a.toString())}var s}async connect(r){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.initialOffer.sdp&&ZH(this.initialOffer.sdp)&&(s=r.rtpCapabilities,a=this.localCapabilities,s.send&&(CP(_t.VIDEO,s.send.videoExtensions,a.send.videoExtensions),CP(_t.AUDIO,s.send.audioExtensions,a.send.audioExtensions)),s.recv&&(CP(_t.VIDEO,s.recv.videoExtensions,a.recv.videoExtensions),CP(_t.AUDIO,s.recv.audioExtensions,a.recv.audioExtensions))),this.remoteSDP=new class{get localCapabilities(){return Gr(this._localCapabilities)}get rtpCapabilities(){return Gr(this._rtpCapabilities)}get candidates(){return Gr(this._candidates)}get iceParameters(){return Gr(this._iceParameters)}get dtlsParameters(){return Gr(this._dtlsParameters)}constructor(v){let S=arguments.length>1&&arguments[1]!==void 0&&arguments[1];K(this,"sessionDesc",void 0),K(this,"_localCapabilities",void 0),K(this,"_rtpCapabilities",void 0),K(this,"_candidates",void 0),K(this,"_originCandidates",void 0),K(this,"_iceParameters",void 0),K(this,"_isUseExtmapAllowMixed",void 0),K(this,"_dtlsParameters",void 0),K(this,"setup",void 0),K(this,"currentMidIndex",void 0),K(this,"cname",void 0),K(this,"firefoxSsrcMidMap",new Map),this._isUseExtmapAllowMixed=S,v=Gr(v);const{iceParameters:R,dtlsParameters:P,candidates:N,rtpCapabilities:G,setup:F,localCapabilities:j,cname:X}=v;this._rtpCapabilities=G,this._candidates=N,this._originCandidates=Gr(N),this._iceParameters=R,this._dtlsParameters=P,this._localCapabilities=j,this.setup=F,this.cname=X,this.sessionDesc=this.updateRemoteRTPCapabilities(G),this.currentMidIndex=this.sessionDesc.mediaDescriptions.length-1}preloadRemoteMedia(v){const S=this.candidates,R=this.dtlsParameters,P=this.iceParameters,N=this.rtpCapabilities.send;let G=this.sessionDesc.mediaDescriptions.length-1;for(let F=1;F<v;F++){const j=2*F+2e4,X=2*F+T9,{ssrcs:ee,ssrcGroups:he}=Y_([{ssrcId:j}],this.cname),{ssrcs:Se,ssrcGroups:Te}=Y_([{ssrcId:X,rtx:oe("USE_SUB_RTX")?X+1:void 0}],this.cname);this.sessionDesc.mediaDescriptions.push({media:{mediaType:"video",port:HT,protos:["UDP","TLS","RTP","SAVPF"],fmts:N.videoCodecs.map(ye=>ye.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:P.iceUfrag,icePwd:P.icePwd,unrecognized:[],candidates:S,extmaps:N.videoExtensions,fingerprints:R.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:Se,ssrcGroups:Te,rtcpFeedbackWildcards:[],payloads:N.videoCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(++G)}}),this.sessionDesc.mediaDescriptions.push({media:{mediaType:"audio",port:HT,protos:["UDP","TLS","RTP","SAVPF"],fmts:N.audioCodecs.map(ye=>ye.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:P.iceUfrag,icePwd:P.icePwd,unrecognized:[],candidates:S,extmaps:N.audioExtensions,fingerprints:R.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:ee,ssrcGroups:he,rtcpFeedbackWildcards:[],payloads:N.audioCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(++G)}}),this.currentMidIndex+=2}this.updateBundleMids()}toString(){return Bm(this.sessionDesc)}send(v,S,R,P){const{ssrcs:N,ssrcGroups:G}=Y_(S,this.cname,oe("SYNC_GROUP")?R:void 0),F=this.findPreloadMediaDesc(N);if(F){if(Br()&&this.firefoxSsrcMidMap.set(N[0].ssrcId,F.attributes.mid),P&&(P.twcc||P.remb)){const j=this.sessionDesc.mediaDescriptions.indexOf(F);return this.sessionDesc.mediaDescriptions[j]=this.mungSendMediaDesc(F,P),{mid:F.attributes.mid,needExchangeSDP:!0}}return{mid:F.attributes.mid,needExchangeSDP:!1}}{const j=this.findAvailableMediaIndex(v,N);let X;return j===-1||j===1&&(Ps()||function(){const ee=Nn();return!(ee.name!==zn.CHROME||!ee.osVersion)&&Number(ee.version)<=90}()||oe("ENABLE_ENCODED_TRANSFORM")&&tp())||j===0&&oe("USE_SUB_RTX")||R8()?(X=this.createOrRecycleSendMedia(v,N,G,"sendonly",P),this.updateBundleMids()):(X=Gr(this.sessionDesc.mediaDescriptions[j]),X.attributes.direction="sendonly",X.attributes.ssrcs=N,X.attributes.ssrcGroups=G,this.sessionDesc.mediaDescriptions[j]=this.mungSendMediaDesc(X,P)),Br()&&this.firefoxSsrcMidMap.set(N[0].ssrcId,X.attributes.mid),{mid:X.attributes.mid,needExchangeSDP:!0}}}sendDataChannel(){const{mediaDesc:v,needExchangeSDP:S}=this.createOrRecycleDataChannel();return this.updateBundleMids(),{mid:v.attributes.mid,needExchangeSDP:S}}batchSend(v){const S=v.map(N=>{let{kind:G,ssrcMsg:F,mslabel:j}=N;return this.send(G,F,j)}),R=[];let P=!1;return S.forEach(N=>{let{mid:G,needExchangeSDP:F}=N;F&&(P=!0),R.push(G)}),{mids:R,needExchangeSDP:P}}stopSending(v){const S=this.sessionDesc.mediaDescriptions.filter(R=>R.attributes.mid&&v.indexOf(R.attributes.mid)!==-1);if(S.length!==v.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");S.forEach(R=>{R.attributes.mid==="0"||Br()||R8()?R.attributes.ssrcs=[]:(R.attributes.ssrcs=[],R.attributes.direction="inactive",R.media.port="0")}),this.updateBundleMids()}mute(v){const S=this.sessionDesc.mediaDescriptions.find(R=>R.attributes.mid===v);if(!S)throw new Error("mediaDescription not found with ".concat(v," in remote SDP when calling RemoteSDP.mute."));S.attributes.direction="inactive"}unmute(v){const S=this.sessionDesc.mediaDescriptions.find(R=>R.attributes.mid===v);if(!S)throw new Error("mediaDescription not found with ".concat(v," in remote SDP when calling RemoteSDP.unmute."));S.attributes.direction="sendonly"}muteRemote(v){const S=this.sessionDesc.mediaDescriptions.filter(R=>ot(v).call(v,R.attributes.mid||""));if(S.length!==v.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");S.forEach(R=>{R.attributes.direction="inactive"})}unmuteRemote(v){const S=this.sessionDesc.mediaDescriptions.filter(R=>ot(v).call(v,R.attributes.mid||""));if(S.length!==v.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");S.forEach(R=>{R.attributes.direction="recvonly"})}receive(v,S,R,P){v.forEach((N,G)=>{this.createOrRecycleRecvMedia(N,[],"recvonly",S,R,P[G])}),this.updateBundleMids()}stopReceiving(v){const S=this.sessionDesc.mediaDescriptions.filter(R=>v.indexOf(R.attributes.mid)!==-1);if(S.length!==v.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");S.forEach(R=>{R.media.port="0",R.attributes.direction="inactive"}),this.updateBundleMids()}updateRemoteRTPCapabilities(v){const S=this.sessionDesc||Ba((R=this._isUseExtmapAllowMixed,`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=ice-lite`.concat(R?`
a=extmap-allow-mixed`:"",`
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`)));var R;this._rtpCapabilities=v;const P=this.rtpCapabilities.send,N=this.localCapabilities.send;for(const G of S.mediaDescriptions){if(G.attributes.iceUfrag=this._iceParameters.iceUfrag,G.attributes.icePwd=this._iceParameters.icePwd,G.attributes.fingerprints=this._dtlsParameters.fingerprints,G.attributes.candidates=this._candidates,G.attributes.setup=this.setup,G.media.mediaType==="application"&&(G.attributes.sctpPort="5000"),G.media.mediaType==="video"){if(P.videoCodecs.length===0){const F=N.videoCodecs.filter(j=>{var X,ee;return(X=j.rtpMap)===null||X===void 0?void 0:ot(ee=X.encodingName.toLowerCase()).call(ee,"vp8")})||[N.videoCodecs[0]];G.media.fmts=F.map(j=>j.payloadType.toString(10)),G.attributes.payloads=F,G.attributes.extmaps=[]}else if(G.media.fmts=P.videoCodecs.map(F=>F.payloadType.toString(10)),G.attributes.payloads=P.videoCodecs,G.attributes.extmaps=P.videoExtensions,oe("PRELOAD_MEDIA_COUNT")>0){const{ssrcs:F,ssrcGroups:j}=Y_([{ssrcId:T9,rtx:oe("USE_SUB_RTX")?40001:void 0}],this.cname);G.attributes.ssrcs=F,G.attributes.ssrcGroups=j}}if(G.media.mediaType==="audio"){if(P.audioCodecs.length===0){const F=N.audioCodecs.filter(j=>{var X,ee;return(X=j.rtpMap)===null||X===void 0?void 0:ot(ee=X.encodingName.toLowerCase()).call(ee,"opus")})||[N.audioCodecs[0]];G.media.fmts=F.map(j=>j.payloadType.toString(10)),G.attributes.payloads=F,G.attributes.extmaps=[]}else if(G.media.fmts=P.audioCodecs.map(F=>F.payloadType.toString(10)),G.attributes.payloads=P.audioCodecs,G.attributes.extmaps=P.audioExtensions,cS(G),oe("PRELOAD_MEDIA_COUNT")>0){const{ssrcs:F,ssrcGroups:j}=Y_([{ssrcId:2e4}],this.cname);G.attributes.ssrcs=F,G.attributes.ssrcGroups=j}}}return this.sessionDesc=S,this.currentMidIndex=S.mediaDescriptions.length-1,this.sessionDesc}updateCandidates(v){const S=this._originCandidates.filter(P=>P.transport==="udp"),R=[];if(S.forEach(P=>{R.push(b9(b9({},P),{},{foundation:"tcpcandidate",priority:Number(P.priority)-1+"",transport:"tcp",port:Number(P.port)+90+""}))}),S.length!==0){switch(v){case Ws.TCP_RELAY:this._candidates=R;break;case Ws.UDP_TCP_RELAY:case Ws.RELAY:this._candidates=[...S,...R];break;default:this._candidates=S}for(const P of this.sessionDesc.mediaDescriptions)P.attributes.candidates=this.candidates}}restartICE(v){v=Gr(v),this._iceParameters=v,this.sessionDesc.mediaDescriptions.forEach(S=>{S.attributes.iceUfrag=v.iceUfrag,S.attributes.icePwd=v.icePwd})}predictReceivingMids(v){const S=[];for(let R=0;R<v;R++)S.push((this.currentMidIndex+R+1).toString(10));return S}findAvailableMediaIndex(v,S){return this.sessionDesc.mediaDescriptions.findIndex(R=>{const P=R.media.mediaType===v&&R.media.port!=="0"&&(R.attributes.direction==="sendonly"||R.attributes.direction==="sendrecv")&&R.attributes.ssrcs.length===0;if(Br()){if(P){const N=this.firefoxSsrcMidMap.get(S[0].ssrcId);return!(N||R.attributes.mid!=="0"&&R.attributes.mid!=="1")||!(!N||N!==R.attributes.mid)}return!1}return P})}createOrRecycleDataChannel(){for(const R of this.sessionDesc.mediaDescriptions)if(R.media.mediaType==="application")return{mediaDesc:R,needExchangeSDP:!1};this.currentMidIndex+=1;const v="".concat(this.currentMidIndex),S={media:{mediaType:"application",port:HT,protos:["UDP","DTLS","SCTP"],fmts:["webrtc-datachannel"]},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:[],fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[],rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,mid:"".concat(v),sctpPort:"5000"}};return this.sessionDesc.mediaDescriptions.push(S),{mediaDesc:S,needExchangeSDP:!0}}createOrRecycleRecvMedia(v,S,R,P,N,G){const F=v._mediaStreamTrack.kind,j=this.rtpCapabilities.recv,X=jT(F,j,this.localCapabilities.send,F===_t.VIDEO?P:N),ee=F===_t.VIDEO?j.videoExtensions:j.audioExtensions;this.currentMidIndex+=1;const he="".concat(this.currentMidIndex);let Se={media:{mediaType:F,port:HT,protos:["UDP","TLS","RTP","SAVPF"],fmts:X.map(ye=>ye.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:ee,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:S,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:X,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:R,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(he)}};Se=this.mungRecvMediaDsec(Se,v,G);const Te=this.findFirstClosedMedia(F);if(Te){const ye=this.sessionDesc.mediaDescriptions.indexOf(Te);this.sessionDesc.mediaDescriptions[ye]=Se}else this.sessionDesc.mediaDescriptions.push(Se);return Se}updateRemoteCodec(v,S,R){const P=[...new Set(this._rtpCapabilities.recv.videoCodecs.map(Se=>Se.rtpMap&&Se.rtpMap.encodingName.toLowerCase()||"").filter(Se=>{var Te;return ot(Te=Object.keys(tP)).call(Te,Se)}))],N=new Set(S);if(P.every(Se=>N.has(Se)))return x.debug("codecs has not changed, no need to updateRemoteCodec, codecs: ".concat(S)),!1;const G=this._rtpCapabilities.recv.videoCodecs.filter(Se=>S.some(Te=>{var ye;return ot(ye=Se.rtpMap&&Se.rtpMap.encodingName.toLowerCase()||"").call(ye,Te)}));if(G.length===0)return x.debug("updateRemoteCodec failed, because cannot find matched codec, remoteCapabilities codecs: ".concat(P," codecs: ").concat(S)),!1;const F=[...new Set(G.map(Se=>Se.rtpMap&&Se.rtpMap.encodingName.toLowerCase()||""))];let j;if(x.debug("updateRemoteCodec, from ".concat(P," to ").concat(F)),v.length===0)j=this.sessionDesc.mediaDescriptions.filter(Se=>Se.media.mediaType==="video"&&Se.attributes.direction==="recvonly");else if(j=this.sessionDesc.mediaDescriptions.filter(Se=>Se.attributes.mid&&ot(v).call(v,Se.attributes.mid)&&Se.attributes.direction==="recvonly"),j.length!==v.length)return x.debug("updateRemoteCodec failed, because cannot find mids, mids: ".concat(v,", codecs: ").concat(S)),!1;if(oe("USE_PUB_RTX")||oe("USE_SUB_RTX")){const Se=p2(G,this.rtpCapabilities.recv.videoCodecs);G.push(...Se)}this._rtpCapabilities.recv.videoCodecs=G;const X=this.localCapabilities.send,ee=this.rtpCapabilities.recv,he=jT(_t.VIDEO,ee,X,R);return j.forEach(Se=>{const Te=he.map(ye=>ye.payloadType.toString(10));x.debug("updateRemoteCodec mid: ".concat(Se.attributes.mid,", from"),Se.attributes.payloads,"to",he),Se.attributes.payloads=he,Se.media.fmts=Te}),!0}createOrRecycleSendMedia(v,S,R,P,N){const G=this.rtpCapabilities.send,F=v===_t.VIDEO?G.videoCodecs:G.audioCodecs,j=v===_t.VIDEO?G.videoExtensions:G.audioExtensions;this.currentMidIndex+=1;const X="".concat(this.currentMidIndex);let ee={media:{mediaType:v,port:HT,protos:["UDP","TLS","RTP","SAVPF"],fmts:F.map(Se=>Se.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:j,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:S,ssrcGroups:R,rtcpFeedbackWildcards:[],payloads:F,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:P,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(X)}};ee=this.mungSendMediaDesc(ee,N);const he=this.findFirstClosedMedia(v);if(he){const Se=this.sessionDesc.mediaDescriptions.indexOf(he);this.sessionDesc.mediaDescriptions[Se]=ee}else this.sessionDesc.mediaDescriptions.push(ee);return ee}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(v=>v.media.port!=="0").map(v=>v.attributes.mid)}mungRecvMediaDsec(v,S,R){const P=Gr(v);return h2(P),aS(P,S),f2(P,S),KH(P),IP(P,R,this.localCapabilities.send),P}mungSendMediaDesc(v,S){const R=Gr(v);return IP(R,S,this.localCapabilities.recv),cS(R),R}updateRecvMedia(v,S){const R=this.sessionDesc.mediaDescriptions.findIndex(P=>P.attributes.mid===v);if(R!==-1){const P=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[R],S);this.sessionDesc.mediaDescriptions[R]=P}}bumpMid(v){this.currentMidIndex+=v}findFirstClosedMedia(v){return this.sessionDesc.mediaDescriptions.find(S=>Br()?S.media.port==="0"&&S.media.mediaType===v:S.media.port==="0")}findPreloadMediaDesc(v){return this.sessionDesc.mediaDescriptions.find(S=>{var R;return((R=S.attributes)===null||R===void 0||(R=R.ssrcs[0])===null||R===void 0?void 0:R.ssrcId)===v[0].ssrcId})}getSSRC(v){var S;return(S=this.sessionDesc.mediaDescriptions.find(R=>R.attributes.mid===v))===null||S===void 0?void 0:S.attributes.ssrcs}}(Td(Td({},r),{},{localCapabilities:this.localCapabilities}),this.supportAV1RtpSpec),r.preallocation&&(this.isPreallocation=!0),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);const c=this.remoteSDP.toString(),u=JH(this.initialOffer.sdp,this.extension),h=this.logSDPExchange(u||"","offer","local","connect");this.store.descriptionStart(),await this.peerConnection.setLocalDescription({type:"offer",sdp:u}),h==null||h(c),await this.peerConnection.setRemoteDescription({type:"answer",sdp:c});const m=this.peerConnection.getTransceivers()[0];if(m!=null&&m.receiver&&this.tryBindTransportEvents(m.receiver),oe("PRELOAD_MEDIA_COUNT")>0){this.remoteSDP.preloadRemoteMedia(oe("PRELOAD_MEDIA_COUNT"));const v=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:v});const S=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(S)}const{preSSRCs:y}=r;if(Array.isArray(y)&&y.length>0){const{mids:v}=this.remoteSDP.batchSend(y.map(S=>({kind:S.kind,ssrcMsg:[{ssrcId:S.ssrcId,rtx:S.rtx}],mslabel:S.mslabel})));v.forEach((S,R)=>{this.preSSRCMap.set(y[R].ssrcId,S)}),await BT(this.peerConnection,this.remoteSDP,this.extension),x.debug("[".concat(this.store.clientId,"] [P2PConnection] pre-batchReceive exchange SDP."))}}catch(c){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(c.toString()))}var s,a}async updateRemoteConnect(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateRemoteConnect before remote SDP created");const{rtpCapabilities:s}=r;this.remoteSDP.updateRemoteRTPCapabilities(s),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);const{preSSRCs:a}=r;if(Array.isArray(a)&&a.length>0){const{mids:c}=this.remoteSDP.batchSend(a.map(u=>Object.assign({},{kind:u.kind,ssrcMsg:[{ssrcId:u.ssrcId,rtx:u.rtx}],mslabel:u.mslabel})));c.forEach((u,h)=>{this.preSSRCMap.set(a[h].ssrcId,u)})}await BT(this.peerConnection,this.remoteSDP,this.extension),x.debug("[P2PConnection] updateRemoteRTPCapabilities by exchanging SDP.")}catch(s){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.updateRemoteConnect failed; ".concat(s.toString()))}}send(r,s,a){var c=this;return Tl(function*(){const u=yield kn(c.mutex.lock("From P2PConnection.send"));try{if(!c.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const h=[],m=wP();r.forEach(j=>{const X=c.peerConnection.addTransceiver(j._mediaStreamTrack,Td({direction:"sendonly"},j.trackMediaType==="video"&&c.supportAV1RtpSpec&&m?{sendEncodings:[{scalabilityMode:m}]}:{}));h.push(X),j._updateRtpTransceiver(X)}),Br()&&oe("SIMULCAST")===!0&&(yield kn(c.applySimulcastForFirefox(h,r)));const y=yield kn(c.peerConnection.createOffer()),v=c.remoteSDP.predictReceivingMids(r.length),S=c.mungSendOfferSDP(y.sdp,r,v),R=Ba(S),P=v.map(j=>{const X=R.mediaDescriptions.find(ee=>ee.attributes.mid===j);if(!X)throw new Error("Cannot extract ssrc from mediaDescription.");return GH(X,oe("USE_PUB_RTX"))});let N;try{N=yield P}catch(j){N=[],c.remoteSDP.receive(r,s,a,N);const X=c.remoteSDP.toString();throw yield kn(c.peerConnection.setLocalDescription({type:"offer",sdp:S})),yield kn(c.peerConnection.setRemoteDescription({type:"answer",sdp:X})),yield kn(c.stopSending(v,!0)),j}c.remoteSDP.receive(r,s,a,N);const G=c.remoteSDP.toString(),F=c.logSDPExchange(S,"offer","local","send");return yield kn(c.peerConnection.setLocalDescription({type:"offer",sdp:S})),yield kn(c.applySimulcastEncodings(h,r)),yield kn(c.applySendEncodings(h,r)),F==null||F(G),yield kn(c.peerConnection.setRemoteDescription({type:"answer",sdp:G})),h.map((j,X)=>{const ee=v[X];return{localSSRC:P[X],id:ee,transceiver:j}})}catch(h){throw h instanceof Le?h:new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(h.toString()))}finally{u()}})()}async createDataChannels(r,s){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.createDataChannels before remote SDP created");let a=this.dataStreamChannelMap.get(r);if(a&&a.readyState==="open")x.debug("[P2PConnection] Channels are already available and can be reused directly.");else{const u=this.currentDataChannelId<1023?this.currentDataChannelId++:this.recoveredDataChannelIds.shift();if(typeof u!="number")throw new Error("create DataChannel error, because cannot get dc id");a=this.peerConnection.createDataChannel("datastream-channel",{id:u,negotiated:!0,ordered:!1,maxRetransmits:oe("DATASTREAM_MAX_RETRANSMITS")}),a.binaryType="arraybuffer",this.dataStreamChannelMap.set(r,a)}s.forEach(u=>{u._updateOriginDataChannel(a)});const{needExchangeSDP:c}=this.remoteSDP.sendDataChannel();if(c){const u=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:u});const h=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(h),x.debug("[P2PConnection] createDataChannels by exchanging SDP.")}else x.debug("[P2PConnection] createDataChannels no need to exchange SDP.");return}catch(a){throw a instanceof Le?a:new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.createDataChannels failed; ".concat(a.toString()))}}async stopDataChannels(r){try{const s=this.dataStreamChannelMap.get(r);return s&&(s.id&&this.recoveredDataChannelIds.push(s.id),s.close()),void this.dataStreamChannelMap.delete(r)}catch(s){throw s instanceof Le?s:new Le(te.DATACHANNEL_FAILED,"P2PConnection.stopDataChannels failed; ".concat(s.toString()))}}async stopSending(r,s){const a=s?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const c=this.peerConnection.getTransceivers().filter(y=>r.indexOf(y.mid)!==-1);if(c.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");c.map(y=>{var v;LP(this.id+y.mid,this),y.direction="inactive",(v=y.stop)===null||v===void 0||v.call(y)});const u=await this.peerConnection.createOffer(),h=this.logSDPExchange(u.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(u),this.remoteSDP.stopReceiving(r);const m=this.remoteSDP.toString();h==null||h(m),await this.peerConnection.setRemoteDescription({type:"answer",sdp:m})}catch(c){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(c.toString()))}finally{a&&a()}}async receive(r,s,a,c){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(r," before remoteSDP created."));const{mid:u,needExchangeSDP:h}=this.remoteSDP.send(r,s,a,c);h&&(await BT(this.peerConnection,this.remoteSDP,this.extension),x.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(r," by exchanging SDP.")));const m=this.peerConnection.getTransceivers().find(y=>y.mid===u);if(!m)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:m.receiver.track,id:u,transceiver:m}}catch(u){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(u.toString()))}}async batchReceive(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const{mids:s,needExchangeSDP:a}=this.remoteSDP.batchSend(r);return a&&(await BT(this.peerConnection,this.remoteSDP,this.extension),x.debug("[".concat(this.store.clientId,"] [P2PConnection] batchReceive by exchanging SDP."))),s.map(c=>{const u=this.peerConnection.getTransceivers().find(h=>h.mid===c);if(!u)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:u.receiver.track,id:c,transceiver:u}})}catch(s){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(s.toString()))}}async stopReceiving(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");r.forEach(u=>{Array.from(this.preSSRCMap.entries()).some(h=>{let[m,y]=h;if(y===u)return this.preSSRCMap.delete(m),!0})}),this.remoteSDP.stopSending(r);const s=this.remoteSDP.toString(),a=this.logSDPExchange(s,"offer","remote","stopReceiving");await this.peerConnection.setRemoteDescription({type:"offer",sdp:s});const c=await this.peerConnection.createAnswer();a==null||a(c.sdp||""),await this.peerConnection.setLocalDescription(c)}catch(s){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(s.toString()))}}async muteRemote(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteRemote mid=".concat(r," before remote SDP created."));this.remoteSDP.mute(r);const s=this.remoteSDP.toString(),a=this.logSDPExchange(s,"offer","remote","muteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:s});const c=await this.peerConnection.createAnswer();a==null||a(c.sdp||""),await this.peerConnection.setLocalDescription(c)}catch(s){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.muteRemote failed; ".concat(s.toString()))}}async unmuteRemote(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteRemote mid=".concat(r," before remote SDP created."));this.remoteSDP.unmute(r);const s=this.remoteSDP.toString(),a=this.logSDPExchange(s,"offer","remote","unmuteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:s});const c=await this.peerConnection.createAnswer();a==null||a(c.sdp||""),await this.peerConnection.setLocalDescription(c)}catch(s){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteRemote failed; ".concat(s.toString()))}}async muteLocal(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const s=this.peerConnection.getTransceivers().filter(h=>h.mid&&r.indexOf(h.mid)!==-1);if(s.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length.");s.map(h=>{h.direction="inactive"});const a=await this.peerConnection.createOffer(),c=this.logSDPExchange(a.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(a),this.remoteSDP.muteRemote(r);const u=this.remoteSDP.toString();c==null||c(u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(s){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(s.toString()))}}async unmuteLocal(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const s=this.peerConnection.getTransceivers().filter(h=>h.mid&&r.indexOf(h.mid)!==-1);if(s.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length.");s.map(async(h,m)=>{h.direction="sendonly"});const a=await this.peerConnection.createOffer(),c=this.logSDPExchange(a.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(a),this.remoteSDP.unmuteRemote(r),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec(r,this.remoteCodecs,this.store.codec);const u=this.remoteSDP.toString();c==null||c(u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(s){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(s.toString()))}}restartICE(r){var s=this;return Tl(function*(){const a=yield kn(s.mutex.lock("From P2PConnection.restartICE"));try{if(!s.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");const c=Vn().supportPCSetConfiguration,u=oe("FORCE_TURN_TCP")||s.forceTurn;if(r===Ws.RELAY&&!c)return;if(c&&!u){const R=r===Ws.RELAY?"relay":"all",P=s.peerConnection.getConfiguration();P.iceTransportPolicy!==R&&(x.debug("[".concat(s.store.clientId,"] restartICE change iceTransportPolicy from [").concat(P.iceTransportPolicy,"] to [").concat(R,"]")),P.iceTransportPolicy=R,s.peerConnection.setConfiguration(P))}s.remoteSDP.updateCandidates(r);const h=yield kn(s.peerConnection.createOffer({iceRestart:!0}));if(!h.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const m=$m(h.sdp),{remoteIceParameters:y}=yield m.iceParameters;s.remoteSDP.restartICE(y);const v=s.remoteSDP.toString(),S=s.logSDPExchange(h.sdp||"","offer","local","restartICE");s.store.descriptionStart(),yield kn(s.peerConnection.setLocalDescription(h)),S==null||S(v),yield kn(s.peerConnection.setRemoteDescription({type:"answer",sdp:v}))}catch(c){x.warning("[".concat(s.store.clientId,"] restart ICE failed, abort operation"),c)}finally{a()}})()}async extendCandidate(){if(!this.remoteSDP||this.isFirstConnected)return;const r=await this.mutex.lock("From P2PConnection.extendCandidate");try{this.remoteSDP.updateCandidates(Ws.TCP_RELAY),await BT(this.peerConnection,this.remoteSDP,this.extension)}catch(s){x.warning("[".concat(this.store.clientId,"] extend candidate failed, abort operation"),s)}finally{r()}}close(){var r;this.peerConnection.getTransceivers().forEach(s=>{LP(this.id+s.mid,this)}),this.preSSRCMap.clear(),this.peerConnection.close(),(r=this.onConnectionStateChange)===null||r===void 0||r.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy(),this.dataStreamChannelMap.clear(),this.recoveredDataChannelIds=[],this.currentDataChannelId=1}getStats(){return Td(Td({},this.statsFilter.getStats()),{},{qualityLimitationReason:this.qualityLimitationReason})}getRemoteVideoIsReady(r){return this.statsFilter.getVideoIsReady(r)}async updateEncoderConfig(r,s){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const a=await this.peerConnection.createOffer(),c=this.mungSendOfferSDP(a.sdp,[s],[r]);this.remoteSDP.updateRecvMedia(r,s);const u=this.remoteSDP.toString(),h=this.logSDPExchange(c,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:c}),h==null||h(u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(a){throw new Le(te.EXCHANGE_SDP_FAILED,a.toString())}}async updateSendParameters(r,s){const a=this.peerConnection.getTransceivers().filter(c=>c.mid===r);a.length===1&&(this.isVP8Simulcast(s)?Br()||await this.applySimulcastEncodings(a,[s]):await this.applySendEncodings(a,[s]))}setStatsRemoteVideoIsReady(r,s){this.statsFilter.setVideoIsReady2(r,s)}async replaceTrack(r,s){const a=this.peerConnection.getTransceivers().find(c=>c.mid===s);a&&await a.sender.replaceTrack(r._mediaStreamTrack)}async getSelectedCandidatePair(){const r=this.peerConnection.getReceivers();if(r.length>0&&r[0].transport&&r[0].transport.iceTransport&&r[0].transport.iceTransport.getSelectedCandidatePair&&r[0].transport.iceTransport.getSelectedCandidatePair()){const s=r[0].transport.iceTransport,{local:a,remote:c}=s.getSelectedCandidatePair();return{local:Td(Td({},Sh),{},{candidateType:a.type,protocol:a.protocol,address:a.address,port:a.port}),remote:Td(Td({},Sh),{},{candidateType:c.type,protocol:c.protocol,address:c.address,port:c.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var r;(r=this.onICEConnectionStateChange)===null||r===void 0||r.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var r;this.peerConnection.connectionState==="connected"&&(this.isFirstConnected=!0),(r=this.onConnectionStateChange)===null||r===void 0||r.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidateerror=r=>{if(r&&(r.errorCode||r.errorText)){var s;const a="code: ".concat(r.errorCode,", message: ").concat(r.errorText),c=r.port?"local: ".concat(r.port):"";x.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICECandidateError(").concat(a,"), url: ").concat(r.url||"",", host_candidate:").concat(c)),(s=this.onICECandidateError)===null||s===void 0||s.call(this,a)}},this.peerConnection.onicegatheringstatechange=r=>{r&&r.target&&"iceGatheringState"in r.target&&x.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] RTCPeerConnection.onicegatheringstatechange(").concat(r.target.iceGatheringState,")"))},this.peerConnection.onicecandidate=r=>{r.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,x.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,x.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},oe("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(r){const s={iceServers:[]};return r.iceServers?s.iceServers=r.iceServers:r.turnServer&&(RT(r.turnServer.servers)?s.iceServers=r.turnServer.servers:oe("NEW_TURN_MODE")&&s.iceServers?(oe("USE_TURN_SERVER_OF_GATEWAY")?r.turnServer.serversFromGateway&&s.iceServers.push(..._y.newTurnServerConfigToIceServers(r.turnServer.serversFromGateway)):s.iceServers.push(..._y.newTurnServerConfigToIceServers(r.turnServer.servers)),oe("NEW_FORCE_TURN")&&(s.iceTransportPolicy="relay")):r.turnServer.mode!=="off"&&(s.iceServers&&s.iceServers.push(..._y.turnServerConfigToIceServers(r.turnServer.servers)),oe("USE_TURN_SERVER_OF_GATEWAY")&&s.iceServers&&r.turnServer.serversFromGateway&&s.iceServers.push(..._y.turnServerConfigToIceServers(r.turnServer.serversFromGateway)),oe("FORCE_TURN_TCP")?s.iceTransportPolicy="relay":r.turnServer.servers.concat(r.turnServer.serversFromGateway||[]).forEach(a=>{a.forceturn&&(s.iceTransportPolicy="relay")}))),oe("ENABLE_ENCODED_TRANSFORM")&&Vn().supportWebRTCEncodedTransform&&(s.encodedInsertableStreams=!0),s}static turnServerConfigToIceServers(r){const s=[];return r.forEach(a=>{a.security?a.tcpport&&s.push({username:a.username,credential:a.password,credentialType:"password",urls:"turns:".concat(Gm(a.turnServerURL),":").concat(a.tcpport,"?transport=tcp")}):(a.udpport&&!oe("FORCE_TURN_TCP")&&s.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":").concat(a.udpport,"?transport=udp")}),a.tcpport&&s.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":").concat(a.tcpport,"?transport=tcp")}))}),s}static newTurnServerConfigToIceServers(r){const s=[];return r.forEach(a=>{const c=oe("NEW_TURN_MODE");c===1?s.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":3478?transport=udp")}):c===2?s.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":3478?transport=tcp")}):c===3?s.push({username:a.username,credential:a.password,credentialType:"password",urls:"turns:".concat(Gm(a.turnServerURL),":443?transport=tcp")}):c===4&&(s.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":3478?transport=udp")}),s.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":3478?transport=tcp")}),s.push({username:a.username,credential:a.password,credentialType:"password",urls:"turns:".concat(Gm(a.turnServerURL),":443?transport=tcp")}))}),s}tryBindTransportEvents(r){const s=r.transport;if(s){this.transportEventReceiver=r,s.onstatechange=()=>{var c;s!=null&&s.state&&((c=this.onDTLSTransportStateChange)===null||c===void 0||c.call(this,s.state))},s.onerror=c=>{var u;(u=this.onDTLSTransportError)===null||u===void 0||u.call(this,"error"in c?c.error:c)};const a=s.iceTransport;a&&(a.onstatechange=()=>{const c=s==null?void 0:s.iceTransport.state;var u;c&&((u=this.onICETransportStateChange)===null||u===void 0||u.call(this,c))},a.getSelectedCandidatePair&&(a.onselectedcandidatepairchange=()=>{if(a.getSelectedCandidatePair()){const{local:c,remote:u}=a.getSelectedCandidatePair();x.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:c.type,protocol:c.protocol}),", remote ").concat(JSON.stringify({candidateType:u.type,protocol:u.protocol,address:u.address,port:u.port})," )"))}}))}}tryUnbindTransportEvents(){this.transportEventReceiver&&this.transportEventReceiver.transport&&(this.transportEventReceiver.transport.onstatechange=null,this.transportEventReceiver.transport.onerror=null,this.transportEventReceiver.transport.iceTransport&&(this.transportEventReceiver.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(r,s){var a,c;if(s||(s=this.peerConnection.getSenders().find(j=>j.track===r._mediaStreamTrack)),!s)return x.warn("[".concat(r.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(r))return x.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!Vn().supportSetRtpSenderParameters)return x.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const u={},h={};switch(r._optimizationMode){case"motion":u.degradationPreference="maintain-framerate";break;case"detail":u.degradationPreference="maintain-resolution";break;case"balanced":u.degradationPreference="balanced"}const m=function(F,j){return F.getTransceivers().find(X=>X.sender.track===j||X.receiver.track===j)}(this.peerConnection,r._mediaStreamTrack),y=Cme(r);if(Vge(r)&&m&&s&&y&&this.getLocalVideoStats&&ot(a=["vp8","vp9"]).call(a,this.store.codec)){var v;const F=u.degradationPreference||(ot(v=r._hints).call(v,hr.CUSTOM_TRACK)?oe("CUSTOM_ADAPTATION_DEFAULT_MODE"):"maintain-framerate");(function(j,X,ee,he,Se,Te){if(LP(j,ee),Se(X),he!=="balanced"&&he!=="maintain-framerate"&&he!=="maintain-resolution")return;let ye=-1;R9(j,X);const Ne=window.setInterval(()=>{const ht=xP.get(j);if(!oe("ENABLE_AG_ADAPTATION")||!ht)return LP(j,ee),void Se(X);const mt=Te();if(mt.sendPackets>0&&mt.OutgoingAvailableBandwidth>0){if(ye===-1)return void(ye=Date.now());if(Date.now()-ye<1e3)return;const Tn=mt.sendFrameRate,wn=mt.OutgoingAvailableBandwidth,[fr,ui]=Uge(j,Tn,wn,ht.adaptationConfig,X,he);ui&&(ee.qualityLimitationReason=ui),fr&&ht.adaptationConfig.scale!==fr.scale&&(x.debug("[".concat(j,"] applyAdaptation: ").concat(ee.qualityLimitationReason,`
           sendFps `).concat(Tn,", bwe ").concat(wn,", switch from ").concat(ht.adaptationConfig.scale," to ").concat(fr.scale," ")),ht.adaptationConfig=C2(C2({},ht.adaptationConfig),fr),Se(fr))}},oe("CHECK_LOCAL_STATS_INTERVAL")),Ye=C2({},X);xP.set(j,{timer:Ne,adaptationConfig:Ye,originConfig:X,adaptationFunc:Se}),x.debug("[".concat(j,"] start adaptation, originConfig: ").concat(JSON.stringify(X),", degradationPreference: ").concat(he))})(this.id+m.mid,y,this,F,j=>{s&&this.updateAdaptation(s,j)},this.getLocalVideoStats.bind(this))}if(r._encoderConfig){var S;const{bitrateMax:F,frameRate:j,scaleResolutionDownBy:X}=r._encoderConfig;F&&(h.maxBitrate=1e3*F),(ot(S=r._hints).call(S,hr.LOW_STREAM)||r.isUseScaleResolutionDownBy)&&(j&&(h.maxFramerate=_c(j)),X&&X>=1&&(h.scaleResolutionDownBy=X))}const{maxFramerate:R}=oe("ENCODER_CONFIG_LIMIT");if(R&&typeof R=="number"&&(h.maxFramerate=h.maxFramerate?Math.min(h.maxFramerate,R):R),oe("DSCP_TYPE")&&np()){var P;const F=oe("DSCP_TYPE");ot(P=["very-low","low","medium","high"]).call(P,F)&&(h.networkPriority=F)}const N=s.getParameters(),G=(c=N.encodings)===null||c===void 0?void 0:c[0];Br()&&!G&&(u.encodings=[h]),G&&Object.assign(G,h),Object.assign(N,u),x.debug("[".concat(r.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(N.encodings))),await s.setParameters(N),await async function(F,j,X){try{var ee;if(!Vn().supportSetRtpSenderParameters||!function(Ne){return Ne==="vp9"||Ne==="av1"}(F)||!oe("ENABLE_SVC"))return;const he={},Se={},Te=j.getParameters(),ye=(ee=Te.encodings)===null||ee===void 0?void 0:ee[0];Se.scalabilityMode=wP(X),ye&&Object.assign(ye,Se),Object.assign(Te,he),await j.setParameters(Te),x.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode success: ".concat(JSON.stringify(Te.encodings)))}catch(he){x.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode failed",he)}}(this.store.codec,s,oe("SVC_MODE"))}async updateAdaptation(r,s){var a,c;if(!r)return x.debug("[updateAdaptation] no rtpSender found");if(!Vn().supportSetRtpSenderParameters)return x.debug("[updateAdaptation] Browser not support set rtp-sender parameters");const u={},{bitrateMax:h,frameRate:m,scaleResolutionDownBy:y}=s;h&&(u.maxBitrate=1e3*h),m&&(u.maxFramerate=_c(m)),y&&y>=1&&ot(a=["vp8","vp9"]).call(a,this.store.codec)&&(u.scaleResolutionDownBy=y);const v=r.getParameters(),S=(c=v.encodings)===null||c===void 0?void 0:c[0];S&&Object.assign(S,u),Object.assign(v,{});try{await r.setParameters(v),x.debug("[updateAdaptation] updateRtpSenderEncodings: ".concat(JSON.stringify(v.encodings)))}catch(R){!("transport"in r)||r.transport&&r.transport.state==="connected"?this.peerConnectionState!=="connected"?x.debug("[updateAdaptation] peerConnection not connected}"):x.debug("[updateAdaptation] updateRtpSenderEncodings failed",R):x.debug("[updateAdaptation] rtpSender transport not connected}")}}async applySendEncodings(r,s){try{if(!Vn().supportSetRtpSenderParameters||r.length!==s.length)return;for(let a=0;a<r.length;a++){const c=r[a],u=s[a];u instanceof Sr&&!this.isVP8Simulcast(u)&&await this.updateRtpSenderEncodings(u,c.sender)}}catch{x.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(r,s,a){const c=Ba(r);return s.forEach((u,h)=>{const m=a[h],y=c.mediaDescriptions.find(v=>v.attributes.mid===m);y&&(aS(y,u),qH(y,u,this.store.codec))}),Bm(c)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=r=>{var s;(s=this.onFirstAudioReceived)===null||s===void 0||s.call(this,r)},this.statsFilter.onFirstVideoReceived=r=>{var s;(s=this.onFirstVideoReceived)===null||s===void 0||s.call(this,r)},this.statsFilter.onFirstAudioDecoded=r=>{var s;(s=this.onFirstAudioDecoded)===null||s===void 0||s.call(this,r)},this.statsFilter.onFirstVideoDecoded=(r,s,a)=>{var c;(c=this.onFirstVideoDecoded)===null||c===void 0||c.call(this,r,s,a)},this.statsFilter.onSelectedLocalCandidateChanged=(r,s)=>{var a;(a=this.onSelectedLocalCandidateChanged)===null||a===void 0||a.call(this,r,s)},this.statsFilter.onSelectedRemoteCandidateChanged=(r,s)=>{var a;(a=this.onSelectedRemoteCandidateChanged)===null||a===void 0||a.call(this,r,s)},this.statsFilter.onFirstVideoDecodedTimeout=r=>{var s;(s=this.onFirstVideoDecodedTimeout)===null||s===void 0||s.call(this,r)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(r,s){if(r.length===s.length)for(let y=0;y<r.length;y++){var a,c,u,h,m;const v=r[y],S=s[y];if(S instanceof Sr&&!ot(a=S._hints).call(a,hr.LOW_STREAM)&&(c=S._encoderConfig)!==null&&c!==void 0&&c.bitrateMax&&((u=S._encoderConfig)===null||u===void 0?void 0:u.bitrateMax)>200&&(h=S._scalabilityMode)!==null&&h!==void 0&&h.numSpatialLayers&&((m=S._scalabilityMode)===null||m===void 0?void 0:m.numSpatialLayers)>1&&this.store.codec==="vp8"){const R={},P={high:1e3*(S._encoderConfig.bitrateMax-50),medium:5e4};R.encodings=[{rid:"m",active:!0,maxBitrate:P.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:P.high}];const N=v.sender.getParameters();await v.sender.setParameters(Object.assign(N,R))}}}async applySimulcastEncodings(r,s){if(!Br()&&r.length===s.length)for(let a=0;a<r.length;a++){const c=s[a];if(c instanceof Sr&&this.isVP8Simulcast(c)){const u=r[a],h={},m={high:1e3*(c._encoderConfig.bitrateMax-50),medium:5e4};h.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:m.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:m.medium,scaleResolutionDownBy:4}];const y=u.sender.getParameters();await u.sender.setParameters(Object.assign(y,h))}}}isVP8Simulcast(r){var s,a,c,u,h;return!!(r instanceof Sr&&oe("SIMULCAST")&&this.store.codec==="vp8"&&!ot(s=r._hints).call(s,hr.LOW_STREAM)&&(a=r._encoderConfig)!==null&&a!==void 0&&a.bitrateMax&&((c=r._encoderConfig)===null||c===void 0?void 0:c.bitrateMax)>200&&(u=r._scalabilityMode)!==null&&u!==void 0&&u.numSpatialLayers&&((h=r._scalabilityMode)===null||h===void 0?void 0:h.numSpatialLayers)>1)}logSDPExchange(r,s,a,c){if(oe("SDP_LOGGING"))return x.upload("[".concat(this.store.clientId,"] exchanging ").concat(a," ").concat(s," SDP during P2PConnection.").concat(c,`
`),r),s==="offer"?u=>{this.logSDPExchange(u,"answer",a==="local"?"remote":"local",c)}:void 0}async getRemoteSSRC(r){if(!this.remoteSDP)return;const s=this.remoteSDP.getSSRC(r);return s&&s.length!==0?s[0].ssrcId:void 0}setConfiguration(r){if(Vn().supportPCSetConfiguration){const s=_y.resolvePCConfiguration(r);this.peerConnection.setConfiguration(s)}}},Tt(Rn.prototype,"updateRemoteRTPCapabilities",[da],Object.getOwnPropertyDescriptor(Rn.prototype,"updateRemoteRTPCapabilities"),Rn.prototype),Tt(Rn.prototype,"connect",[da],Object.getOwnPropertyDescriptor(Rn.prototype,"connect"),Rn.prototype),Tt(Rn.prototype,"updateRemoteConnect",[da],Object.getOwnPropertyDescriptor(Rn.prototype,"updateRemoteConnect"),Rn.prototype),Tt(Rn.prototype,"createDataChannels",[da],Object.getOwnPropertyDescriptor(Rn.prototype,"createDataChannels"),Rn.prototype),Tt(Rn.prototype,"receive",[da],Object.getOwnPropertyDescriptor(Rn.prototype,"receive"),Rn.prototype),Tt(Rn.prototype,"batchReceive",[da],Object.getOwnPropertyDescriptor(Rn.prototype,"batchReceive"),Rn.prototype),Tt(Rn.prototype,"stopReceiving",[da],Object.getOwnPropertyDescriptor(Rn.prototype,"stopReceiving"),Rn.prototype),Tt(Rn.prototype,"muteRemote",[da],Object.getOwnPropertyDescriptor(Rn.prototype,"muteRemote"),Rn.prototype),Tt(Rn.prototype,"unmuteRemote",[da],Object.getOwnPropertyDescriptor(Rn.prototype,"unmuteRemote"),Rn.prototype),Tt(Rn.prototype,"muteLocal",[da],Object.getOwnPropertyDescriptor(Rn.prototype,"muteLocal"),Rn.prototype),Tt(Rn.prototype,"unmuteLocal",[da],Object.getOwnPropertyDescriptor(Rn.prototype,"unmuteLocal"),Rn.prototype),Tt(Rn.prototype,"close",[da],Object.getOwnPropertyDescriptor(Rn.prototype,"close"),Rn.prototype),Tt(Rn.prototype,"updateEncoderConfig",[da],Object.getOwnPropertyDescriptor(Rn.prototype,"updateEncoderConfig"),Rn.prototype),Tt(Rn.prototype,"updateSendParameters",[da],Object.getOwnPropertyDescriptor(Rn.prototype,"updateSendParameters"),Rn.prototype),Tt(Rn.prototype,"replaceTrack",[da],Object.getOwnPropertyDescriptor(Rn.prototype,"replaceTrack"),Rn.prototype),Tt(Rn.prototype,"updateAdaptation",[da],Object.getOwnPropertyDescriptor(Rn.prototype,"updateAdaptation"),Rn.prototype),Tt(Rn.prototype,"getRemoteSSRC",[da],Object.getOwnPropertyDescriptor(Rn.prototype,"getRemoteSSRC"),Rn.prototype),Rn);function da(t,r,s){const a=t[r];if(typeof a!="function")throw new Error("Cannot use mutex on object property.");return s.value=async function(){const c=this.mutex,u=await c.lock("From P2PConnection.".concat(r));try{for(var h=arguments.length,m=new Array(h),y=0;y<h;y++)m[y]=arguments[y];return await a.apply(this,m)}finally{u()}},s}function P2(t,r){let s=document.createElement("video"),a=document.createElement("canvas");s.setAttribute("style","display:none"),a.setAttribute("style","display:none"),s.setAttribute("muted",""),s.muted=!0,s.setAttribute("autoplay",""),s.autoplay=!0,s.setAttribute("playsinline",""),a.width=_c(r.width),a.height=_c(r.height);const c=_c(r.framerate||15);document.body.append(s),document.body.append(a);let u=t._mediaStreamTrack;s.srcObject=new MediaStream([u]),s.play();const h=a.getContext("2d");if(!h)throw new Oe(te.UNEXPECTED_ERROR,"can not get canvas context");const m=Vn(),y=a.captureStream(m.supportRequestFrame?0:c).getVideoTracks()[0];y.canvas||(y.canvas=a),a.startCapture=()=>{if(!s)return a.stopCapture&&a.stopCapture();if(s.paused&&s.play(),s.videoHeight>2&&s.videoWidth>2){const S=s.videoWidth,R=s.videoHeight/S,P=a.width*R;Math.abs(P-a.height)>=2&&(x.debug("adjust low stream resolution","".concat(a.width,"x").concat(a.height," -> ").concat(a.width,"x").concat(P)),a.height=P)}h.drawImage(s,0,0,a.width,a.height),y.requestFrame&&y.requestFrame(),u!==t._mediaStreamTrack&&(u=t._mediaStreamTrack,s.srcObject=new MediaStream([u]))},a.stopCapture=jL(()=>a.startCapture&&a.startCapture(),c);const v=y.stop;return y.stop=()=>{v.call(y),s&&(s.remove(),s.srcObject=null,s=null),a&&(a.width=0,a.remove(),a.stopCapture&&a.stopCapture(),a.startCapture=void 0,a.stopCapture=void 0,a=null),x.debug("clean low stream renderer")},y}var UP=function(t){return t[t.HEIGHT=2033]="HEIGHT",t[t.FRAME_RATE=2034]="FRAME_RATE",t[t.WIDTH=2035]="WIDTH",t}(UP||{}),vi=function(t){return t[t.FRAME_RATE=2002]="FRAME_RATE",t[t.WIDTH=2003]="WIDTH",t[t.HEIGHT=2004]="HEIGHT",t[t.PACKAGE_LOST=2005]="PACKAGE_LOST",t[t.AVG_ENCODE=2007]="AVG_ENCODE",t[t.NACKS=2009]="NACKS",t[t.PLIS=2010]="PLIS",t[t.FIRS=2011]="FIRS",t[t.BITRATE=2012]="BITRATE",t[t.PACKAGE_RATE=2031]="PACKAGE_RATE",t[t.ADAPTATION=2032]="ADAPTATION",t[t.ACTUAL_ENCODED=2060]="ACTUAL_ENCODED",t[t.BANDWIDTH=2061]="BANDWIDTH",t[t.RETRANSMIT=2062]="RETRANSMIT",t[t.TARGET_ENCODED=2064]="TARGET_ENCODED",t[t.TRANSMIT=2066]="TRANSMIT",t[t.FREEZE=2082]="FREEZE",t[t.DISABLED=2095]="DISABLED",t[t.PLAYER_STATUS=2128]="PLAYER_STATUS",t[t.QP_SUM=2143]="QP_SUM",t[t.BYTES_RETRANSMIT=2173]="BYTES_RETRANSMIT",t[t.PACKAGES_RETRANSMIT=2172]="PACKAGES_RETRANSMIT",t[t.HUGE_FRAME_SENT=2174]="HUGE_FRAME_SENT",t[t.KEY_FRAMES_ENCODED=2207]="KEY_FRAMES_ENCODED",t}(vi||{}),J_=function(t){return t[t.BITRATE=2069]="BITRATE",t[t.PACKAGE_LOST=2070]="PACKAGE_LOST",t[t.PACKAGE_RATE=2071]="PACKAGE_RATE",t[t.HEIGHT=2073]="HEIGHT",t[t.FRAME_RATE=2075]="FRAME_RATE",t[t.WIDTH=2077]="WIDTH",t}(J_||{}),Si=function(t){return t[t.JITTER=-1]="JITTER",t[t.PACKAGE_LOST=2014]="PACKAGE_LOST",t[t.WIDTH=2018]="WIDTH",t[t.HEIGHT=2019]="HEIGHT",t[t.FRAME_RATE=2020]="FRAME_RATE",t[t.JITTER_BUFFER=2023]="JITTER_BUFFER",t[t.CURRENT_DELAY=2024]="CURRENT_DELAY",t[t.NACKS=2026]="NACKS",t[t.PLIS=2027]="PLIS",t[t.FIRS=2028]="FIRS",t[t.BITRATE=2029]="BITRATE",t[t.PACKAGE_RATE=2078]="PACKAGE_RATE",t[t.FREEZE=2084]="FREEZE",t[t.DISABLED=2101]="DISABLED",t[t.PLAYER_STATUS=2129]="PLAYER_STATUS",t[t.QP_SUM=2144]="QP_SUM",t[t.I_FRAME_DELAY=2149]="I_FRAME_DELAY",t[t.FRAMES_DROPPED=2181]="FRAMES_DROPPED",t[t.BYTES_RETRANSMIT=2175]="BYTES_RETRANSMIT",t[t.PACKAGES_RETRANSMIT=2176]="PACKAGES_RETRANSMIT",t[t.PACKAGES_DISCARDED=2198]="PACKAGES_DISCARDED",t[t.AVG_DECODE=2200]="AVG_DECODE",t[t.AVG_PROCESSING_DELAY=2202]="AVG_PROCESSING_DELAY",t[t.AVG_ASSEMBLY_TIME=2203]="AVG_ASSEMBLY_TIME",t[t.AVG_INTER_FRAME_DELAY=2204]="AVG_INTER_FRAME_DELAY",t[t.KEY_FRAMES_DECODED=2206]="KEY_FRAMES_DECODED",t}(Si||{}),Q_=function(t){return t[t.FRAME_RATE_DECODE=2021]="FRAME_RATE_DECODE",t[t.FRAME_RATE_RENDER=2022]="FRAME_RATE_RENDER",t[t.FRAME_RATE_OUTPUT=2155]="FRAME_RATE_OUTPUT",t[t.FREEZE_TIME=2109]="FREEZE_TIME",t[t.FREEZE_TIME_RENDER=2147]="FREEZE_TIME_RENDER",t[t.FREEZE_DURATION=2156]="FREEZE_DURATION",t}(Q_||{}),k9=function(t){return t[t.PCM_LEVEL=2104]="PCM_LEVEL",t}(k9||{}),Ah=function(t){return t[t.PACKAGE_LOST=-1]="PACKAGE_LOST",t[t.LEVEL=2038]="LEVEL",t[t.BITRATE=2039]="BITRATE",t[t.PACKAGE_RATE=2040]="PACKAGE_RATE",t[t.AEC_RETURN_LOSS=2041]="AEC_RETURN_LOSS",t[t.AEC_RETURN_LOSS_ENH=2042]="AEC_RETURN_LOSS_ENH",t[t.FREEZE=2081]="FREEZE",t[t.DISABLED=2096]="DISABLED",t[t.BYTES_RETRANSMIT=2179]="BYTES_RETRANSMIT",t[t.PACKAGES_RETRANSMIT=2180]="PACKAGES_RETRANSMIT",t}(Ah||{}),ha=function(t){return t[t.BITRATE=2044]="BITRATE",t[t.PACKAGE_LOST=2045]="PACKAGE_LOST",t[t.PACKAGE_RATE=2046]="PACKAGE_RATE",t[t.CURRENT_DELAY=2047]="CURRENT_DELAY",t[t.JITTER_BUFFER=2054]="JITTER_BUFFER",t[t.JITTER=2055]="JITTER",t[t.FREEZE=2083]="FREEZE",t[t.DISABLED=2102]="DISABLED",t[t.PCM_LEVEL=2105]="PCM_LEVEL",t[t.PLAYER_STATUS=2130]="PLAYER_STATUS",t[t.CONCEALED_SAMPLES=2148]="CONCEALED_SAMPLES",t[t.BYTES_RETRANSMIT=2178]="BYTES_RETRANSMIT",t[t.PACKAGES_RETRANSMIT=2177]="PACKAGES_RETRANSMIT",t[t.PACKAGES_DISCARDED=2199]="PACKAGES_DISCARDED",t[t.AVG_PROCESSING_DELAY=2201]="AVG_PROCESSING_DELAY",t[t.TOTAL_SAMPLES_RECEIVED=2224]="TOTAL_SAMPLES_RECEIVED",t}(ha||{}),N9=function(t){return t[t.FREEZE_TIME=-1]="FREEZE_TIME",t[t.LEVEL=2043]="LEVEL",t}(N9||{}),fa=function(t){return t[t.RTT=2006]="RTT",t[t.CONN_TYPE=801]="CONN_TYPE",t[t.STATS_UPDATE_INTERVAL=2205]="STATS_UPDATE_INTERVAL",t}(fa||{}),VP=function(t){return t[t.RTC_PEER_CONNECTION_STATE=2219]="RTC_PEER_CONNECTION_STATE",t}(VP||{});const Z_=1e3,ey=6,FP=3,Bge=Math.max(ey,FP);function Bt(t,r,s){s!=null&&Number.isFinite(s)&&(t[r]=Math.round(Math.max(0,s)))}function D9(t){const r={[fa.CONN_TYPE]:0,[fa.RTT]:t.rtt,[fa.STATS_UPDATE_INTERVAL]:t.updateInterval?Math.round(Math.max(0,t.updateInterval)):void 0};switch(t.selectedCandidatePair.localCandidate.candidateType){case"relay":{const s=t.selectedCandidatePair.localCandidate.relayProtocol;s==="udp"&&(r[fa.CONN_TYPE]=1),s==="tcp"&&(r[fa.CONN_TYPE]=3),s==="tls"&&(r[fa.CONN_TYPE]=4);break}case"srflx":r[fa.CONN_TYPE]=2;break;case"unknown":r[fa.CONN_TYPE]=5;break;default:r[fa.CONN_TYPE]=0}return r}function x9(t){let r=0;switch(t){case"none":r=0;break;case"cpu":r=1;break;case"bandwidth":r=2;break;case"other":r=3}return r}class L9 extends Ur{constructor(r){super(),K(this,"store",void 0),K(this,"uploadWRTCStatsTimer",void 0),K(this,"uploadOutboundDenoiserStatsTimer",void 0),K(this,"uploadExtStatsTimer",void 0),K(this,"uploadExtUsageStatsTimer",void 0),K(this,"uploadInboundExtStatsTimer",void 0),K(this,"requestStats",void 0),K(this,"requestTransportStats",void 0),K(this,"requestLocalMedia",void 0),K(this,"requestRemoteMedia",void 0),K(this,"requestAllTracks",void 0),K(this,"requestVideoIsReady",void 0),K(this,"requestUploadStats",void 0),K(this,"requestUpload",void 0),K(this,"uploadOutboundStarted",!1),K(this,"uploadInboundStarted",!1),K(this,"uploadTransportStarted",!1),K(this,"uploadBaseStatsStarted",!1),K(this,"uploadExtensionUsageStarted",!1),K(this,"lastRecvStats",void 0),K(this,"lastSendStats",void 0),K(this,"lastRefRecvStats",void 0),K(this,"lastRefSendStats",void 0),K(this,"lastFullRecvStats",void 0),K(this,"lastFullSendStats",void 0),K(this,"needUploadRenderFreezeTime",!0),this.store=r}uploadWRTCStats(r){if(!this.requestStats||!this.requestUploadStats)return;const s=r%FP==0,a=r%ey==0;let c,u;if(this.uploadTransportStarted&&(c=this.requestStats(),this.store.useP2P&&(u=this.requestStats(!0))),!c&&this.uploadOutboundStarted&&(c=this.requestStats()),!u&&this.uploadInboundStarted&&(u=this.requestStats(!0)),c||u){var h;const m={};if(this.uploadTransportStarted&&c){const v=this.getTransportStats(c,u,s);v&&(m.misc=[v])}if(this.uploadOutboundStarted&&c){const v=this.getOutboundStats(c,a?this.lastFullSendStats:s?this.lastRefSendStats:this.lastSendStats,s,a);v&&(m.outbound=[v])}if(this.uploadInboundStarted&&u){const v=this.getInboundStats(u,a?this.lastFullRecvStats:s?this.lastRefRecvStats:this.lastRecvStats,s,a);v&&(m.inbound=v)}const y=(h=this.requestTransportStats)===null||h===void 0?void 0:h.call(this).connectState;y&&(Array.isArray(m.misc)?m.misc[0]&&m.misc[0].addition&&(m.misc[0].addition[VP.RTC_PEER_CONNECTION_STATE]=CL[y]):m.misc=[{addition:{[VP.RTC_PEER_CONNECTION_STATE]:CL[y]}}]),this.requestUploadStats(m)}this.lastRecvStats=u,this.lastSendStats=c,a&&(this.lastFullRecvStats=u,this.lastFullSendStats=c),s&&(this.lastRefRecvStats=u,this.lastRefSendStats=c)}startUploadWRTCStats(){if(this.uploadWRTCStatsTimer)return;this.uploadBaseStatsStarted=!0;let r=1;this.uploadWRTCStatsTimer=window.setInterval(()=>{if(!this.uploadTransportStarted&&!this.uploadInboundStarted&&!this.uploadOutboundStarted){if(this.uploadBaseStatsStarted){var s,a;const c=(s=this.requestTransportStats)===null||s===void 0?void 0:s.call(this);return void(c&&((a=this.requestUploadStats)===null||a===void 0||a.call(this,{misc:[{addition:{[VP.RTC_PEER_CONNECTION_STATE]:CL[c.connectState]}}]})))}return this.stopUploadWRTCStats()}this.uploadWRTCStats(r),++r===Bge+1&&(r=1)},Z_)}stopUploadWRTCStats(){window.clearInterval(this.uploadWRTCStatsTimer),this.uploadWRTCStatsTimer=void 0,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0)}getTransportStats(r,s,a){if(!this.requestStats)return;if(!a)return r.rtt==null?void 0:{addition:{[fa.RTT]:r.rtt,[fa.CONN_TYPE]:void 0,[fa.STATS_UPDATE_INTERVAL]:r.updateInterval||void 0}};const c=D9(r);if(this.store.useP2P){if(s){const u=D9(s);c[fa.CONN_TYPE]+=u[fa.CONN_TYPE]<<3}c[fa.CONN_TYPE]+=110}else c[fa.CONN_TYPE]+=100;return{addition:c}}getOutboundStats(r,s,a,c){if(!this.requestUploadStats||!this.requestLocalMedia)return;const u=this.requestLocalMedia();if(!u||u.length===0)return;let h,m,y;return u.forEach(v=>{let[S,{track:R,ssrcs:P}]=v;switch(S){case Ke.LocalVideoLowTrack:case Ke.LocalVideoTrack:if(S===Ke.LocalVideoTrack){const N=function(j,X,ee,he,Se,Te){const ye=X.videoSend.find(mt=>mt.ssrc===j);if(!ye)return;const Ne={},{sentFrame:Ye,inputFrame:ht}=ye;if(Te&&(Bt(Ne,vi.QP_SUM,ye.qpSumPerFrame),ht&&Ye)){const mt=ht.frameRate,Tn=Ye.frameRate;Ne[vi.FREEZE]=function(wn,fr){let ui=!0;return ui=!(wn<=5)&&(wn<=10?fr<3:wn<=20?fr<4:fr<5),ui}(mt,Tn)?1:0}if(Se){switch(Ye&&(Bt(Ne,vi.HEIGHT,Ye.height),Bt(Ne,vi.WIDTH,Ye.width),Bt(Ne,vi.FRAME_RATE,Ye.frameRate)),Ne[vi.DISABLED]=he._originMediaStreamTrack&&!he._originMediaStreamTrack.enabled||he._mediaStreamTrack&&!he._mediaStreamTrack.enabled?1:0,ye.adaptionChangeReason){case"none":Ne[vi.ADAPTATION]=0;break;case"cpu":Ne[vi.ADAPTATION]=1;break;case"bandwidth":Ne[vi.ADAPTATION]=2;break;case"other":Ne[vi.ADAPTATION]=3}let mt=0;ye.adaptionChangeReason&&(mt+=x9(ye.adaptionChangeReason)),X.qualityLimitationReason&&(mt+=x9(X.qualityLimitationReason)<<3),Ne[vi.ADAPTATION]=mt,Ne[vi.PLAYER_STATUS]=VL[he._player?he._player.videoElementStatus:"uninit"],Bt(Ne,vi.NACKS,ye.nacksCount),Bt(Ne,vi.PLIS,ye.plisCount),Bt(Ne,vi.FIRS,ye.firsCount),Bt(Ne,vi.AVG_ENCODE,ye.avgEncodeMs),Bt(Ne,vi.HUGE_FRAME_SENT,ye.hugeFramesSent),Bt(Ne,vi.BYTES_RETRANSMIT,ye.retransmittedBytesSent),Bt(Ne,vi.PACKAGES_RETRANSMIT,ye.retransmittedPacketsSent),Bt(Ne,vi.KEY_FRAMES_ENCODED,ye.keyFramesEncoded);const Tn=ee&&ee.videoSend.find(wn=>wn.ssrc===j);if(Tn){let wn=Se?Z_:Z_*ey;Tn.timestamp&&ye.timestamp&&(wn=ye.timestamp-Tn.timestamp),Tn.packets!=null&&ye.packets!=null&&Bt(Ne,vi.PACKAGE_RATE,1e3*(ye.packets-Tn.packets)/wn),ye.packetsLost!=null&&Tn.packetsLost!=null&&Bt(Ne,vi.PACKAGE_LOST,ye.packetsLost-Tn.packetsLost),Tn.bytes!=null&&ye.bytes!=null&&Bt(Ne,vi.BITRATE,8*(ye.bytes-Tn.bytes)/wn)}}return Ne}(P[0].ssrcId,r,s,R,a,c),G=R&&function(j,X,ee,he){const Se=X.videoSend.find(ye=>ye.ssrc===j);if(!Se)return null;const Te={};if(he){const ye=Se.inputFrame,Ne=ye&&ye.height||ee.videoHeight||0,Ye=ye&&ye.width||ee.videoWidth||0,ht=ye&&ye.frameRate||0;Bt(Te,UP.HEIGHT,Ne),Bt(Te,UP.WIDTH,Ye),Bt(Te,UP.FRAME_RATE,ht)}return Te}(P[0].ssrcId,r,R,a),F=function(j,X){const ee={};return X&&(Bt(ee,vi.RETRANSMIT,j.bitrate.retransmit),Bt(ee,vi.TARGET_ENCODED,j.bitrate.targetEncoded),Bt(ee,vi.ACTUAL_ENCODED,j.bitrate.actualEncoded),Bt(ee,vi.TRANSMIT,j.bitrate.transmit),Bt(ee,vi.BANDWIDTH,j.sendBandwidth)),ee}(r,a);m=Object.assign({},N,G,F)}else y=function(N,G,F,j){const X=G.videoSend.find(he=>he.ssrc===N);if(!X)return;const ee={};if(j){const he=X.sentFrame;if(he&&(Bt(ee,J_.HEIGHT,he.height),Bt(ee,J_.WIDTH,he.width),Bt(ee,J_.FRAME_RATE,he.frameRate)),F){const Se=F.videoSend.find(Te=>Te.ssrc===N);if(Se){let Te=Z_*ey;Se.timestamp&&X.timestamp&&(Te=X.timestamp-Se.timestamp),Se.packets!=null&&X.packets!=null&&Bt(ee,J_.PACKAGE_RATE,1e3*(X.packets-Se.packets)/Te),X.packetsLost!=null&&Se.packetsLost!=null&&Bt(ee,J_.PACKAGE_LOST,X.packetsLost-Se.packetsLost),Se.bytes!=null&&X.bytes!=null&&Bt(ee,J_.BITRATE,8*(X.bytes-Se.bytes)/Te)}}}return ee}(P[0].ssrcId,r,s,a);break;case Ke.LocalAudioTrack:h=R&&function(N,G,F,j,X){const ee=G.audioSend.find(Se=>Se.ssrc===N);if(!ee)return;const he={};if(X){he[Ah.DISABLED]=j._originMediaStreamTrack&&!j._originMediaStreamTrack.enabled||j._mediaStreamTrack&&!j._mediaStreamTrack.enabled?1:0;const Se=100*j._source.getAccurateVolumeLevel(),Te=ee.inputLevel;if(Te!=null){const Ne=Math.ceil(50*Math.log10(100*Te+1));Bt(he,Ah.LEVEL,Ne)}Bt(he,k9.PCM_LEVEL,Se),Bt(he,Ah.AEC_RETURN_LOSS,ee.aecReturnLoss),Bt(he,Ah.AEC_RETURN_LOSS_ENH,ee.aecReturnLossEnhancement),Bt(he,Ah.BYTES_RETRANSMIT,ee.retransmittedBytesSent),Bt(he,Ah.PACKAGES_RETRANSMIT,ee.retransmittedPacketsSent),he[Ah.FREEZE]=0;const ye=F&&F.audioSend.find(Ne=>Ne.ssrc===N);if(ye){let Ne=Z_*ey;ye.timestamp&&ee.timestamp&&(Ne=ee.timestamp-ye.timestamp),ye.bytes!=null&&ee.bytes!=null&&Bt(he,Ah.BITRATE,8*(ee.bytes-ye.bytes)/Ne),ye.packets!=null&&ee.packets!=null&&Bt(he,Ah.PACKAGE_RATE,1e3*(ee.packets-ye.packets)/Ne)}}return he}(P[0].ssrcId,r,s,R,a)}}),{high:m,low:y,audio:h}}getInboundStats(r,s,a,c){if(!this.requestRemoteMedia)return;const u=this.requestRemoteMedia()||[],h=[];return u.forEach(m=>{let[y,v]=m;const S={peer:y.uid};if(v.has(_t.VIDEO)&&y.videoTrack){const R=y._videoSSRC&&this.requestVideoIsReady&&this.requestVideoIsReady(y._videoSSRC)||!1,P=y.videoTrack?function(N,G,F,j,X,ee,he,Se){const Te=G.videoRecv.find(wn=>wn.ssrc===N);if(!Te)return;const ye={},{receivedFrame:Ne,outputFrame:Ye,decodeFrameRate:ht}=Te,mt=F&&F.videoRecv.find(wn=>wn.ssrc===N);if(Bt(ye,Q_.FRAME_RATE_DECODE,ht),Te.framesRateFirefox&&Bt(ye,Si.FRAME_RATE,Te.framesRateFirefox),Ne&&Bt(ye,Si.FRAME_RATE,Ne.frameRate),Bt(ye,Si.FRAMES_DROPPED,Te.framesDroppedCount),Bt(ye,Si.BYTES_RETRANSMIT,Te.retransmittedBytesReceived),Bt(ye,Si.PACKAGES_RETRANSMIT,Te.retransmittedPacketsReceived),Bt(ye,Si.PACKAGES_DISCARDED,Te.packetsDiscarded),Bt(ye,Si.AVG_DECODE,Te.avgDecodeMs),Bt(ye,Si.AVG_PROCESSING_DELAY,Te.avgProcessingDelayMs),Bt(ye,Si.AVG_ASSEMBLY_TIME,Te.avgFramesAssembledFromMultiplePacketsMs),Bt(ye,Si.AVG_INTER_FRAME_DELAY,Te.avgInterFrameDelayMs),Bt(ye,Si.KEY_FRAMES_DECODED,Te.keyFramesDecoded),mt){const wn=G.timestamp-F.timestamp||Z_*(Se?ey:he?FP:1);Te.packetsLost!=null&&mt.packetsLost!=null&&Bt(ye,Si.PACKAGE_LOST,Te.packetsLost-mt.packetsLost),mt.bytes!=null&&Te.bytes!=null&&Bt(ye,Si.BITRATE,8*(Te.bytes-mt.bytes)/wn),mt.packets!=null&&Te.packets!=null&&Bt(ye,Si.PACKAGE_RATE,1e3*(Te.packets-mt.packets)/wn)}if(Se&&(Bt(ye,Si.QP_SUM,Te.qpSumPerFrame),ye[Si.FREEZE]=X&&GT.isRemoteVideoFreeze(j,Te,mt)?1:0),he){var Tn;Ne?(Bt(ye,Si.HEIGHT,Ne.height),Bt(ye,Si.WIDTH,Ne.width)):j&&(Bt(ye,Si.HEIGHT,j._videoHeight||0),Bt(ye,Si.WIDTH,j._videoWidth||0)),Ye&&Bt(ye,Q_.FRAME_RATE_OUTPUT,Ye.frameRate);const wn=(Tn=j._player)===null||Tn===void 0?void 0:Tn.rendFrameRate.toFixed(0);if(wn&&Bt(ye,Q_.FRAME_RATE_RENDER,+wn),Bt(ye,Si.JITTER_BUFFER,Te.jitterBufferMs),Bt(ye,Si.CURRENT_DELAY,Te.currentDelayMs),Bt(ye,Si.FIRS,Te.firsCount),Bt(ye,Si.NACKS,Te.nacksCount),Bt(ye,Si.PLIS,Te.plisCount),j){ye[Si.DISABLED]=j._originMediaStreamTrack.enabled&&j._mediaStreamTrack.enabled?0:1;const fr=j._player;if(fr){const{freezeTimeCounterList:ui,renderFreezeAccTime:Xr,videoElementStatus:ma}=fr;if(ui&&ui.length>0&&Bt(ye,Q_.FREEZE_TIME,ui.splice(0,1)[0]),ee&&sp.visibility==="visible"&&ma===mo.PLAYING&&Vn().supportRequestVideoFrameCallback){const je=Math.min(6e3,Xr);fr.renderFreezeAccTime=Math.max(0,Xr-je),Bt(ye,Q_.FREEZE_TIME_RENDER,je)}if(typeof Te.totalFreezesDuration=="number"){const je=mt&&mt.totalFreezesDuration?Te.totalFreezesDuration-mt.totalFreezesDuration:Te.totalFreezesDuration;Bt(ye,Q_.FREEZE_DURATION,1e3*je)}}}if(ye[Si.PLAYER_STATUS]=VL[j._player?j._player.videoElementStatus:"uninit"],mt&&Te.totalInterFrameDelay!==void 0&&Te.totalSquaredInterFrameDelay!==void 0&&mt.totalInterFrameDelay!==void 0&&mt.totalSquaredInterFrameDelay!==void 0){const fr=Te.totalInterFrameDelay-mt.totalInterFrameDelay,ui=Te.totalSquaredInterFrameDelay-mt.totalSquaredInterFrameDelay,Xr=Te.framesDecodeCount-mt.framesDecodeCount,ma=fr/Xr*1e3,je=Math.round(1e3*Math.sqrt((ui-Math.pow(fr,2)/Xr)/Xr));!isNaN(je)&&ma+je>Math.max(3*ma,ma+150)&&(ye[Si.I_FRAME_DELAY]=je)}}return ye}(y._videoSSRC,r,s,y.videoTrack,R===!0,this.needUploadRenderFreezeTime,a,c):void 0;P&&(S.video=P)}if(v.has(_t.AUDIO)&&y.audioTrack){const R=y.audioTrack?function(P,N,G,F,j,X){const ee=N.audioRecv.find(ye=>ye.ssrc===P);if(!ee)return;const he={},Se=G&&G.audioRecv.find(ye=>ye.ssrc===P);if(Bt(he,ha.JITTER,ee.jitterMs),Bt(he,ha.BYTES_RETRANSMIT,ee.retransmittedBytesReceived),Bt(he,ha.PACKAGES_RETRANSMIT,ee.retransmittedPacketsReceived),Bt(he,ha.PACKAGES_DISCARDED,ee.packetsDiscarded),Bt(he,ha.AVG_PROCESSING_DELAY,ee.avgProcessingDelayMs),Se){const ye=N.timestamp-G.timestamp||Z_*(X?ey:j?FP:1);ee.packets!=null&&Se.packets!=null&&Bt(he,ha.PACKAGE_RATE,1e3*(ee.packets-Se.packets)/ye),j&&Se.bytes!=null&&ee.bytes!=null&&Bt(he,ha.BITRATE,8*(ee.bytes-Se.bytes)/ye),ee.packetsLost!=null&&Se.packetsLost!=null&&Bt(he,ha.PACKAGE_LOST,ee.packetsLost-Se.packetsLost)}if(X){const{receivedFrames:ye,droppedFrames:Ne}=ee;ye!=null&&Ne!=null&&(he[ha.FREEZE]=(Te=ye)===0||100*Ne/Te>20?1:0)}var Te;if(j){const ye=100*F._source.getAccurateVolumeLevel(),Ne=ee.outputLevel;if(Ne!=null){const Ye=Math.ceil(50*Math.log10(100*Ne+1));Bt(he,N9.LEVEL,Ye)}if(Bt(he,ha.PCM_LEVEL,ye),F&&(he[ha.DISABLED]=F._originMediaStreamTrack.enabled&&F._mediaStreamTrack.enabled?0:1),Bt(he,ha.JITTER_BUFFER,ee.jitterBufferMs),Bt(he,ha.CURRENT_DELAY,ee.jitterBufferMs),he[ha.PLAYER_STATUS]=VL[ua.getPlayerState(F.getTrackId())],Se){const Ye=ee.concealedSamples-Se.concealedSamples;Ye>0&&Bt(he,ha.CONCEALED_SAMPLES,Ye);const ht=ee.totalSamplesReceived-Se.totalSamplesReceived;ht>0&&Bt(he,ha.TOTAL_SAMPLES_RECEIVED,ht)}}return he}(y._audioSSRC,r,s,y.audioTrack,a,c):void 0;R&&(S.audio=R)}(S.video||S.audio)&&h.push(S)}),this.needUploadRenderFreezeTime=!this.needUploadRenderFreezeTime,h}startUploadTransportStats(){this.uploadTransportStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats()}stopUploadTransportStats(){this.uploadTransportStarted=!1}startUploadOutboundStats(){this.uploadOutboundStarted||(this.uploadOutboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=window.setInterval(()=>{if(!this.requestAllTracks||!this.requestUpload)return;const r=(this.requestAllTracks()||[]).find(s=>s instanceof cP);if(r&&r._external.getDenoiserStats){const s=r._external.getDenoiserStats();s&&this.requestUpload(xT.DENOISER_STATS,s)}},2e3),this.uploadExtStatsTimer&&window.clearInterval(this.uploadExtStatsTimer),this.uploadExtStatsTimer=window.setInterval(()=>{!this.requestAllTracks||!this.requestUpload||this.requestAllTracks().forEach(r=>{r.getProcessorStats().forEach(s=>{this.requestUpload&&this.requestUpload(s.type,s.stats)})})},2e3))}stopUploadOutboundStats(){this.uploadOutboundStarted&&(this.uploadOutboundStarted=!1,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=void 0)}startUploadInboundStats(){this.uploadInboundStarted||(this.uploadInboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadInboundExtStatsTimer&&window.clearInterval(this.uploadInboundExtStatsTimer),this.uploadInboundExtStatsTimer=window.setInterval(()=>{!this.requestUpload||!this.requestRemoteMedia||(this.requestRemoteMedia()||[]).forEach(r=>{let[s,a]=r;a.has(_t.VIDEO)&&s.videoTrack&&s.videoTrack.getProcessorStats().forEach(c=>{this.requestUpload&&this.requestUpload(c.type,c.stats)}),a.has(_t.AUDIO)&&s.audioTrack&&s.audioTrack.getProcessorStats().forEach(c=>{this.requestUpload&&this.requestUpload(c.type,c.stats)})})},2e3))}stopUploadInboundStats(){this.uploadInboundStarted&&(this.uploadInboundStarted=!1,this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0))}startUploadExtensionUsageStats(){if(this.uploadExtensionUsageStarted)return;this.uploadExtensionUsageStarted=!0,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer);const r=new Map;this.uploadExtUsageStatsTimer=window.setInterval(async()=>{const s=Date.now(),a={connectionInterval:oe("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3,details:[],lts:s};let c=[];const u=this.requestAllTracks&&this.requestAllTracks()||[];for(const v of u)!v.muted&&v.enabled&&(c=c.concat(await v.getProcessorUsage()));const h=this.requestRemoteMedia&&this.requestRemoteMedia()||[];for(const[v,S]of h)S.has(_t.VIDEO)&&v.videoTrack&&(c=c.concat(await v.videoTrack.getProcessorUsage())),S.has(_t.AUDIO)&&v.audioTrack&&(c=c.concat(await v.audioTrack.getProcessorUsage()));if(c.length===0)return;a.details=function(v,S){const R={};for(const{id:F,value:j,level:X,direction:ee}of v){var P;const he=(P=S.get(F))!==null&&P!==void 0?P:0,Se=j===2?he+oe("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3:he;var N,G;S.set(F,Se),R[F]?(j===2&&(R[F].value=j),X>R[F].level&&(R[F].level=X),ee==="remote"&&(R[F].remoteUidCount+=1),R[F].totalTs=(N=S.get(F))!==null&&N!==void 0?N:0):R[F]={value:j,level:X,remoteUidCount:ee==="local"?0:1,totalTs:(G=S.get(F))!==null&&G!==void 0?G:0}}return Object.keys(R).map(F=>{const{level:j,value:X,totalTs:ee}=R[F];return{id:F,level:j,value:X,totalTs:ee}})}(c,r);const m=Date.now(),y=m>s?m:s+1;this.requestUpload&&this.requestUpload(xT.EXTENSION_USAGE_STATS,{usageStats:a,sendTs:y})},oe("EXTENSION_USAGE_UPLOAD_INTERVAL"))}stopUploadExtensionUsageStats(){this.uploadExtensionUsageStarted&&(this.uploadExtensionUsageStarted=!1,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer),this.uploadExtUsageStatsTimer=void 0)}stopUploadBaseStats(){this.uploadBaseStatsStarted=!1}}const Wge=oe("ICE_RESTART_INTERVAL");let jP=new Map,hS=new Map,Ym=[Ws.UDP_TCP_RELAY,Ws.TCP_RELAY,Ws.RELAY],O2=oe("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&Vn().supportPCSetConfiguration;function M9(t){let r=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const s=jP.get(t.id);s&&(window.clearTimeout(s),jP.delete(t.id));const a=hS.get(t.id);r&&a&&a.index===Ym.length-1&&(x.debug("[".concat(t.id,"] reset ICE restart policy")),hS.delete(t.id))}function U9(t,r,s){if(jP.size===0&&hS.size===0&&(Array.isArray(oe("RESTART_SEQUENCE"))&&oe("RESTART_SEQUENCE").length>0&&!function(m,y){if(m.length!==y.length)return!1;for(let v=0;v<m.length;v+=1){const S=m[v];if(m.filter(R=>R===S).length!==y.filter(R=>R===S).length)return!1}return!0}(Ym,oe("RESTART_SEQUENCE"))&&(Ym=oe("RESTART_SEQUENCE").filter(m=>{var y;if(ot(y=Object.values(Ws)).call(y,m))return!0}),x.debug("use reconnection policy from config distribution, queues: ".concat(Ym.join(" => ")))),O2=oe("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&Vn().supportPCSetConfiguration),Ym.length===0)return void s();let a,{index:c=0,type:u}=hS.get(t.id)||{};if(O2&&u===Ws.RELAY)return void s();let h=u&&c>=Ym.length-1;if(O2)u=Ws.RELAY;else{if(h)return void s();u?(c++,u=Ym[c]):(u=Ym[0],c=0)}x.debug("[".concat(t.id,"] choose ICE restart policy: ").concat(u,", index: ").concat(c)),r(u),hS.set(t.id,{index:c,type:u}),a=window.setTimeout(()=>U9(t,r,s),Wge),jP.set(t.id,a)}var pn;function V9(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}function Ph(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?V9(Object(s),!0).forEach(function(a){K(t,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):V9(Object(s)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))})}return t}function F9(t){var r,s,a,c=2;for(typeof Symbol<"u"&&(s=eL,a=Symbol.iterator);c--;){if(s&&(r=t[s])!=null)return r.call(t);if(a&&(r=t[a])!=null)return new BP(r.call(t));s="@@asyncIterator",a="@@iterator"}throw new TypeError("Object is not async iterable")}function BP(t){function r(s){if(Object(s)!==s)return dt.reject(new TypeError(s+" is not an object."));var a=s.done;return dt.resolve(s.value).then(function(c){return{value:c,done:a}})}return BP=function(s){this.s=s,this.n=s.next},BP.prototype={s:null,n:null,next:function(){return r(this.n.apply(this.s,arguments))},return:function(s){var a=this.s.return;return a===void 0?dt.resolve({value:s,done:!0}):r(a.apply(this.s,arguments))},throw:function(s){var a=this.s.return;return a===void 0?dt.reject(s):r(a.apply(this.s,arguments))}},new BP(t)}let $T=(pn=class extends Ur{get state(){return this._state}set state(t){const r=this._state;this._state=t,this.emit(xt.StateChange,r,this._state)}constructor(t,r){super(),K(this,"isPlanB",void 0),K(this,"store",void 0),K(this,"statsUploader",void 0),K(this,"connection",void 0),K(this,"localTrackMap",new Map),K(this,"remoteUserMap",new Map),K(this,"localDataChannels",[]),K(this,"remoteDataChannelMap",new Map),K(this,"pendingLocalTracks",[]),K(this,"pendingRemoteTracks",[]),K(this,"pendingLocalDataChannels",[]),K(this,"pendingRemoteDataChannels",[]),K(this,"statsCollector",void 0),K(this,"shouldForwardP2PCreation",void 0),K(this,"iceFailedCount",0),K(this,"dtlsFailedCount",0),K(this,"mutex",void 0),K(this,"_state",qn.Disconnected),K(this,"_pcStatsUploadType",oe("NEW_ICE_RESTART")?lp.FIRST_CONNECTION:lp.OLD_FIRST_CONNECTION),K(this,"_isStartRestartIce",!1),K(this,"_restartTimer",void 0),K(this,"_isTryConnecting",!1),K(this,"_iceError",null),K(this,"_forceTurn",!1),K(this,"_isWaitPcToRePub",!1),K(this,"handleMuteLocalTrack",async(s,a,c)=>{const u=await this.mutex.lock("Locking from P2PChannel.handleMuteLocalTrack");try{if(!this.connection||this.state!==qn.Connected)return void c(new Le(te.INVALID_OPERATION,"Cannot call P2PChannel.handleMuteLocalTrack before connection established."));const h=this.filterTobeMutedTracks(s);if(h.length===0)return void a();const m=h.find(v=>v[0]==="videoLowTrack");m&&m[1].track._originMediaStreamTrack.stop(),await this.connection.muteLocal(h.map(v=>{let[,{id:S}]=v;return S}));const y=this.createMuteMessage(h);await ur(this,xt.RequestMuteLocal,y),a()}catch(h){c(h)}finally{u()}}),K(this,"handleUnmuteLocalTrack",async(s,a,c)=>{const u=await this.mutex.lock("Locking from P2PChannel.handleUnmuteLocalTrack");try{if(!this.connection||this.state!==qn.Connected)return void c(new Le(te.INVALID_OPERATION,"Cannot call P2PChannel.handleUnmuteLocalTrack before connection established."));const h=this.filterTobeUnmutedTracks(s);if(h.length===0)return void a();const m=h.find(v=>v[0]==="videoLowTrack");if(m){const v=m[1];if(v.track._originMediaStreamTrack.stop(),!oe("DISABLE_DUAL_STREAM_USE_ENCODING")&&Vn().supportDualStreamEncoding){const S=s._mediaStreamTrack.clone();v.track._mediaStreamTrack=S,v.track._originMediaStreamTrack=S}else{const S=P2(s,IT(this,xt.RequestLowStreamParameter));v.track._mediaStreamTrack=S,v.track._originMediaStreamTrack=S}await new dt((S,R)=>{this.handleReplaceTrack(v.track,S,R,!0)})}await this.connection.unmuteLocal(h.map(v=>{let[,{id:S}]=v;return S}));const y=this.createUnmuteMessage(h);await ur(this,xt.RequestUnmuteLocal,y),a()}catch(h){c(h)}finally{u()}}),K(this,"handleUpdateVideoEncoder",async(s,a,c,u)=>{let h;u||(h=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoEncoder"));try{const y=this.localTrackMap.get(Ke.LocalVideoTrack);if(!this.connection||!y||y.track!==s||this.state!==qn.Connected)return void a();const{id:v,track:S}=y;await this.connection.updateSendParameters(v,S),await this.connection.updateEncoderConfig(v,S),this.emit(xt.UpdateVideoEncoder,S),a()}catch(y){c(y)}finally{var m;(m=h)===null||m===void 0||m()}}),K(this,"handleUpdateVideoSendParameters",async(s,a,c)=>{const u=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoSendParameters");try{const h=this.localTrackMap.get(Ke.LocalVideoTrack);if(!this.connection||!h||h.track!==s||this.state!==qn.Connected)return void a();const{id:m,track:y}=h;await this.connection.updateSendParameters(m,y),a()}catch(h){c(h)}finally{u()}}),K(this,"handleReplaceMixingTrack",async(s,a,c,u)=>{if(!this.connection||this.state!==qn.Connected)return void a();const h=I2([s]);let m;x.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(h.getTrackId(),"]")),typeof u=="boolean"&&u||(m=await this.mutex.lock("From P2PChannel.handleReplaceMixingTrack"));try{await this.replaceTrack(s,h),a()}catch(v){c(v)}finally{var y;(y=m)===null||y===void 0||y()}}),K(this,"handleReplaceTrack",async(s,a,c,u)=>{let h;x.debug("[".concat(this.store.clientId,"] P2PChannel handleReplaceTrack for [track-id-").concat(s.getTrackId(),"]")),typeof u=="boolean"&&u||(h=await this.mutex.lock("From P2PChannel.handleReplaceTrack"));try{var m;const v=Array.from(this.localTrackMap.entries()).find(S=>{let[,{track:R}]=S;return s===R});if(!this.connection||!v||this.state!==qn.Connected)return void a();if(await((m=this.connection)===null||m===void 0?void 0:m.replaceTrack(s,v[1].id)),this.isPlanB){const S=v[1];S.id=s._mediaStreamTrack.id,this.localTrackMap.set(v[0],S)}if(v[0]===Ke.LocalVideoTrack&&!oe("DISABLE_DUAL_STREAM_USE_ENCODING")&&Vn().supportDualStreamEncoding){const S=this.localTrackMap.get(Ke.LocalVideoLowTrack);if(S){const R=s._mediaStreamTrack.clone();S.track._originMediaStreamTrack.stop(),S.track._mediaStreamTrack=R,S.track._originMediaStreamTrack=R,await new dt((P,N)=>{this.handleReplaceTrack(S.track,P,N,!0)})}}a()}catch(v){c(v)}finally{var y;(y=h)===null||y===void 0||y()}}),K(this,"handleGetRTCStats",s=>{s(this.statsCollector.getRTCStats())}),K(this,"handleGetLocalVideoStats",s=>{s(this.statsCollector.getLocalVideoTrackStats())}),K(this,"handleGetLocalAudioStats",s=>{s(this.statsCollector.getLocalAudioTrackStats())}),K(this,"handleGetRemoteVideoStats",s=>this.statsCollector.getRemoteVideoTrackStats(s.uid)[s.uid]),K(this,"handleGetRemoteAudioStats",s=>this.statsCollector.getRemoteAudioTrackStats(s.uid)[s.uid]),this.store=t,this.statsCollector=r,this.statsCollector.addP2PChannel(this),this.statsUploader=new L9(this.store),this.bindStatsUploaderEvents(),this.mutex=new js("P2PChannel-mutex",this.store.clientId),this.isPlanB=!Vn().supportUnifiedPlan||oe("CHROME_FORCE_PLAN_B")&&np(),this.shouldForwardP2PCreation=oe("FORWARD_P2P_CREATION")&&Vn().supportPCSetConfiguration&&hL(),this.shouldForwardP2PCreation&&(this.connection=MP(this.store),this.emit(xt.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection))}async startP2PConnection(t){var r;this.state=qn.New,this._forceTurn=P9(t),x.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] forceTurn: ").concat(this._forceTurn));const s=this.shouldForwardP2PCreation&&((r=this.connection)===null||r===void 0?void 0:r.peerConnectionState)==="closed";if(this.shouldForwardP2PCreation&&!s||(s&&this.connection&&(x.warning("[".concat(this.store.clientId,"] P2PChannel.startP2PConnection ForwardP2P closed.")),this.resetConnection(this.connection)),this.connection=MP(this.store,t),this.emit(xt.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),!this.connection)throw new Le(te.UNEXPECTED_ERROR,"Cannot P2PChannel.startConnection before P2PConnection initialization .");return this._pcStatsUploadType=oe("NEW_ICE_RESTART")?lp.FIRST_CONNECTION:lp.OLD_FIRST_CONNECTION,this._isTryConnecting=!0,this._isStartRestartIce=!1,this._iceError=null,this.connection.setConfiguration(t),this.connection.establishPromise}async connect(t){if(!this.connection)throw new Le(te.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");oe("ENABLE_PREALLOC_PC")&&this.state===qn.Connected?await this.connection.updateRemoteConnect(t):(this.store.peerConnectionStart(),await this.connection.connect(t),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=qn.Connected)}updateRemoteRTPCapabilities(t){const r=Array.from(this.localTrackMap.entries()).filter(c=>{var u;let[h]=c;return ot(u=[Ke.LocalVideoLowTrack,Ke.LocalVideoTrack]).call(u,h)}),s=r.map(c=>{let[,{id:u}]=c;return u}),a=r.map(c=>{let[u]=c;return u});if(this.connection instanceof Ih){if(It.updateRemoteRTPCapabilities(this.store.sessionId,{trackTypes:JSON.stringify(a),localCodecs:JSON.stringify(this.connection.localCodecs),remoteCodecs:JSON.stringify(t)}),!ot(t).call(t,this.store.codec)){const c=["vp9","vp8","h264"].find(u=>ot(t).call(t,u));c&&(this.store.codec=c,x.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId," updateRemoteRTPCapabilities] default codec is not available, hence the fallback to ").concat(c,".")))}this.connection.updateRemoteRTPCapabilities(s,t)}}async getEstablishParams(){var t;if(this.connection instanceof Ih&&this.connection.peerConnectionState!=="closed"&&ot(t=[qn.New,qn.Connected]).call(t,this.state))return this.connection.establishPromise}async publishDataChannel(t){if(!this.connection||this.state!==qn.Connected){if(this.state===qn.Disconnected)throw new Le(te.UNEXPECTED_ERROR,"PeerConnection already disconnected.");return t.forEach(s=>{var a;ot(a=this.pendingLocalDataChannels).call(a,s)||this.pendingLocalDataChannels.push(s)}),[]}const r=this.filterTobePublishedDataChannels(t);return r.length===0?[]:(r.forEach(s=>{const a=Date.now();this.store.publish(s.id.toString(),"datachannel",a)}),await this.connection.createDataChannels(this.store.uid,r),r.forEach(s=>{this.localDataChannels.push(s);const a=Date.now();this.store.publish(s.id+"","datachannel",void 0,a)}),t.map(s=>({streamId:s.id,ordered:s.ordered,maxRetransmits:s.maxRetransmits,metadata:s.metadata,channelId:s._originDataChannelId})))}publish(t,r,s){var a=this;return Tl(function*(){const c=yield kn(a.mutex.lock("From P2PChannel.publish"));try{var u;const h=a.connection&&ot(u=["disconnected","failed"]).call(u,a.connection.peerConnectionState);if(!a.connection||a.state!==qn.Connected||h){if(a.state===qn.Disconnected)throw new Le(te.UNEXPECTED_ERROR,"PeerConnection already disconnected.");a.throwIfTrackTypeNotMatch(t);const y=t.filter(v=>a.pendingLocalTracks.indexOf(v)===-1);return a.pendingLocalTracks=a.pendingLocalTracks.concat(y),void(h&&(a._isWaitPcToRePub=!0))}a.store.pubId=a.store.pubId+1,zs.markPublishStart(a.store.clientId,a.store.pubId);const m=a.filterTobePublishedTracks(t,r,s);if(m.length===0)return void(yield kn(a.tryToUnmuteAudio(t)));yield*LA(F9(a.doPublish(a.connection,m)))}finally{c()}})()}doPublish(t,r){var s=this;return Tl(function*(){r.forEach(P=>{let{track:N,type:G}=P;const F=Date.now();s.store.publish(N.getTrackId(),G===Ke.LocalAudioTrack?"audio":"video",F)}),s.bindLocalTrackEvents(r);const a=r.map(P=>{let{track:N}=P;return N}),c=yield kn(t.send(a,s.store.codec,s.store.audioCodec)),u=(yield kn(c.next())).value,h=s.createGatewayPublishMessage(r,u);let m;try{m=yield h}catch(P){throw c.throw(P),(P==null?void 0:P.code)===te.WS_ABORT&&r.forEach(N=>{let{track:G}=N;s.pendingLocalTracks.indexOf(G)===-1&&s.pendingLocalTracks.push(G)}),s.unbindLocalTrackEvents(r),P}const y=s.mapPubResToRemoteConfig(h,m,a),v=(yield kn(c.next(y))).value;if(s.state===qn.Disconnected)throw new Le(te.UNEXPECTED_ERROR,"PeerConnection already disconnected.");oe("ENABLE_VIDEO_SEI");const S=oe("ENABLE_ENCODED_TRANSFORM"),R=oe("ENABLE_AUDIO_METADATA");a.forEach(async P=>{const N=P.getRTCRtpTransceiver();if(!N||!S)return;const{interceptLocalVideoFrame:G,interceptLocalAudioFrame:F}=PP();P.trackMediaType===_t.VIDEO?await G(N.sender,P):P.trackMediaType===_t.AUDIO&&await F(N.sender,{metadata:R?()=>{const j=P.metadata.shift();return j&&j.value}:void 0})}),r.forEach(P=>{let{type:N}=P;s.statsCollector.addLocalStats(N)}),s.assignLocalTracks(r,v),s.statsUploader.startUploadOutboundStats(),r.forEach(P=>{let{track:N,type:G}=P;const F=Date.now();s.store.publish(N.getTrackId(),G===Ke.LocalAudioTrack?"audio":"video",void 0,F)})})()}async updateVideoStreamParameter(t,r){const s=this.localTrackMap.get(r);if(!s||!this.connection)return;if(!(s.track instanceof Sr))return x.warn("[updateVideoStreamParameter]: track is not an instance of LocalVideoTrack");const{track:a}=s,c=function(u,h){const m={};return u.height&&u.width&&(m.scaleResolutionDownBy=d2(u,h)),m.maxFramerate=u.framerate?_c(u.framerate):void 0,m.maxBitrate=u.bitrate?1e3*u.bitrate:void 0,m}(t,a);if(a._encoderConfig||(a._encoderConfig={}),r!==Ke.LocalVideoLowTrack||!oe("DISABLE_DUAL_STREAM_USE_ENCODING")&&Vn().supportDualStreamEncoding)c.scaleResolutionDownBy!=null&&(a._encoderConfig.scaleResolutionDownBy=c.scaleResolutionDownBy);else{const u=a._originMediaStreamTrack;if(!u.canvas)return x.warn("[".concat(a.getTrackId(),"] no canvas on track"));(function(h,m){const y=h.canvas;m.width&&(y.width=_c(m.width)),m.height&&(y.height=_c(m.height)),m.framerate&&(y.stopCapture&&y.stopCapture(),y.stopCapture=jL(()=>{!y.startCapture&&y.stopCapture&&y.stopCapture(),y.startCapture&&y.startCapture()},_c(m.framerate)))})(u,t)}c.maxBitrate!=null&&(a._encoderConfig.bitrateMax=c.maxBitrate/1e3),c.maxFramerate!=null&&(a._encoderConfig.frameRate&&typeof a._encoderConfig.frameRate=="object"?a._encoderConfig.frameRate.max=c.maxFramerate:a._encoderConfig.frameRate={max:c.maxFramerate}),x.debug("[".concat(a.getTrackId(),"] LowStreamEncoderConfig: , ").concat(JSON.stringify(a._encoderConfig))),await this.connection.updateRtpSenderEncodings(a)}publishLowStream(t){var r=this;return Tl(function*(){if(!r.connection||r.state!==qn.Connected)return;const s=yield kn(r.mutex.lock("Locking from P2PChannel.publishLowStream"));try{const c=r.localTrackMap.get(Ke.LocalVideoTrack);if(!c)throw new Le(te.UNEXPECTED_ERROR,"Could not find high stream");if(r.localTrackMap.has(Ke.LocalVideoLowTrack))throw new Le(te.UNEXPECTED_ERROR,"[".concat(r.store.clientId,"] Can't publish low stream when stream already publish"));const u=[{track:r.getLowVideoTrack(c.track,t),type:Ke.LocalVideoLowTrack}];if(yield*LA(F9(r.doPublish(r.connection,u))),c.track.muted||!c.track.enabled){var a;const h=(a=r.localTrackMap.get(Ke.LocalVideoLowTrack))===null||a===void 0?void 0:a.id;h!==void 0&&(yield kn(r.connection.muteLocal([h])))}}finally{s()}})()}async republish(){this.pendingLocalTracks.length>0&&(x.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await ks(this,xt.RequestRePublish,this.pendingLocalTracks),this.emit(xt.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[]),this.pendingLocalDataChannels.length>0&&(x.debug("Emit P2PChannelEvents.RequestRePublishDataChannel to republish datachannels."),await ks(this,xt.RequestRePublishDataChannel,this.pendingLocalDataChannels),this.pendingLocalDataChannels=[]),this._isWaitPcToRePub=!1}async reSubscribe(t){for(let r=this.pendingRemoteTracks.length-1;r>=0;r--){const{user:s,kind:a}=this.pendingRemoteTracks[r];(a!==_t.AUDIO||s._audio_added_&&s._audioSSRC)&&(a!==_t.VIDEO||s._video_added_&&s._videoSSRC)||this.pendingRemoteTracks.splice(r,1)}if(t)await ks(this,xt.RequestReSubscribe,this.pendingRemoteTracks);else for(const{user:r,kind:s}of this.pendingRemoteTracks)await this.subscribe(r,s,s===_t.VIDEO?r._videoSSRC:r._audioSSRC);this.pendingRemoteTracks.forEach(r=>{let{user:s}=r;this.emit(xt.MediaReconnectEnd,s.uid)}),this.pendingRemoteTracks=[]}async unpublish(t){if(!this.connection||this.state!==qn.Connected)return void t.forEach(a=>{const c=this.pendingLocalTracks.indexOf(a);c!==-1&&this.pendingLocalTracks.splice(c,1)});const r=this.filterTobeUnpublishedTracks(t);if(r.length===0)return;const s=r.find(a=>a[0]==="videoLowTrack");return s&&s[1].track.close(),this.doUnpublish(this.connection,r)}async unpublishDataChannel(t){if(!this.connection||this.state!==qn.Connected)return void t.forEach(s=>{const a=this.pendingLocalDataChannels.indexOf(s);a!==-1&&this.pendingLocalDataChannels.splice(a,1)});const r=this.filterTobeUnpublishedDataChannels(t);return r.length!==0?(r.forEach(s=>{const a=this.localDataChannels.indexOf(s);a!==-1&&this.localDataChannels.splice(a,1)}),this.localDataChannels.length===0&&await this.connection.stopDataChannels(this.store.uid),r.map(s=>s.id)):void 0}async unpublishLowStream(){if(!this.connection||this.state!==qn.Connected)return;const t=this.localTrackMap.get(Ke.LocalVideoLowTrack);if(!t)return;t.track.close();const r=[[Ke.LocalVideoLowTrack,t]];return this.doUnpublish(this.connection,r)}async doUnpublish(t,r){const s=this.createGatewayUnpublishMessage(r);return await t.stopSending(r.map(a=>{let[,{id:c}]=a;return c})),this.withdrawLocalTracks(r),this.unbindLocalTrackEvents(r.map(a=>{let[c,{track:u}]=a;return{type:c,track:u}})),r.forEach(a=>{let[c]=a;this.statsCollector.removeLocalStats(c)}),this.localTrackMap.size===0&&this.statsUploader.stopUploadOutboundStats(),s}async subscribeDataChannel(t,r){if(!this.connection||this.state!==qn.Connected)throw new Le(te.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");const s=r.filter(a=>{var c;return!((c=this.remoteDataChannelMap.get(t))!==null&&c!==void 0&&c.get(a.id))});if(s.length!==0)return await this.connection.createDataChannels(t.uid,s),s.forEach(a=>{var c;this.remoteDataChannelMap.has(t)?(c=this.remoteDataChannelMap.get(t))===null||c===void 0||c.set(a.id,a):this.remoteDataChannelMap.set(t,new Map([[a.id,a]]));const u=this.pendingRemoteDataChannels.findIndex(h=>{let{user:m,id:y}=h;return m.uid===t.uid&&y===a.id});u!==-1&&this.pendingRemoteDataChannels.splice(u,1)}),s.map(a=>a.id)}async subscribe(t,r,s,a,c){var u;if(!this.connection||this.state!==qn.Connected)throw new Le(te.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");if((u=this.remoteUserMap.get(t))!==null&&u!==void 0&&u.has(r))return;let h,m,y;const v=this.connection.getPreMedia(s);if(v)x.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] preSSRCMap has ssrcId: ").concat(s,", no need to send sub to gateway.")),y=v.transceiver,h=v.track,m=v.id;else if(c){const P=c.find(G=>{let{stream_type:F}=G;return F===r});if(!P)throw new Le(te.UNEXPECTED_ERROR,"Cannot subscribe to remote ".concat(r," for user: ").concat(t.uid," because subscribe answer from gateway does not contain stream_type: ").concat(r,"."));const N=await this.connection.receive(r,P.ssrcs,String(t._uintid),P.attributes);this.connection instanceof Ih&&(y=N.transceiver),h=N.track,m=N.id}else{const P=await this.connection.receive(r,[{ssrcId:s,rtx:a}],String(t._uintid),void 0);this.connection instanceof Ih&&(y=P.transceiver),h=P.track,m=P.id}if(r===_t.AUDIO?(t._audioTrack?t._audioTrack._updateOriginMediaStreamTrack(h):(t._audioTrack=new Zv(h,t.uid,t._uintid,this.store),x.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(t._audioTrack.getTrackId()))),y&&t._audioTrack._updateRtpTransceiver(y),this.bindRemoteTrackEvents(t,t._audioTrack)):(t._videoTrack?t._videoTrack._updateOriginMediaStreamTrack(h):(t._videoTrack=new Qv(h,t.uid,t._uintid,this.store),x.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(t._videoTrack.getTrackId()))),y&&t._videoTrack._updateRtpTransceiver(y),this.bindRemoteTrackEvents(t,t._videoTrack)),y&&oe("ENABLE_ENCODED_TRANSFORM")){const{interceptRemoteVideoFrame:P,interceptRemoteAudioFrame:N}=PP();r==_t.VIDEO?await P(y.receiver,{onSei:oe("ENABLE_VIDEO_SEI")&&(G=>{var F;return(F=t._videoTrack)===null||F===void 0?void 0:F._onSei(G)})}):r==_t.AUDIO&&await N(y.receiver,{enableTopn:!!oe("ENABLE_AUDIO_TOPN"),enableMetadata:!!oe("ENABLE_AUDIO_METADATA"),onMetadata:G=>{this.safeEmit(xt.AudioMetadata,G)}})}const S=this.remoteUserMap.get(t);S?S.set(r,m):this.remoteUserMap.set(t,new Map([[r,m]])),this.statsCollector.addRemoteStats(t.uid),this.statsUploader.startUploadInboundStats();const R=this.pendingRemoteTracks.findIndex(P=>{let{user:N,kind:G}=P;return N.uid===t.uid&&r===G});R!==-1&&(this.pendingRemoteTracks.splice(R,1),this.emit(xt.MediaReconnectEnd,t.uid))}async massSubscribe(t){return this.massSubscribeNoLock(t)}async massSubscribeNoLock(t){if(!this.connection||this.state!==qn.Connected)throw new Le(te.INVALID_OPERATION,"Cannot subscribeAll remote users when peerConnection disconnected.");t=t.filter(c=>{var u;let{user:h,mediaType:m}=c;return!((u=this.remoteUserMap.get(h))!==null&&u!==void 0&&u.has(m))});const r=[],s=new Map;t.forEach(c=>{if(!this.connection)return;const u=this.connection.getPreMedia(c.ssrcId);u?s.set(c.ssrcId,u):r.push(c)});const a=await this.connection.batchReceive(r.map(c=>{let{user:u,mediaType:h,ssrcId:m,rtxSsrcId:y}=c;return{kind:h,ssrcMsg:[{ssrcId:m,rtx:y}],mslabel:String(u._uintid)}}));r.forEach((c,u)=>{s.set(c.ssrcId,a[u])});for(const{user:c,mediaType:u,ssrcId:h}of t){const m=s.get(h);if(!m)return void x.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] cannot find ").concat(c.uid," subscribe data,").concat(u,", ").concat(h));const{track:y,id:v,transceiver:S}=m;if(S&&oe("ENABLE_ENCODED_TRANSFORM")){const{interceptRemoteVideoFrame:N,interceptRemoteAudioFrame:G}=PP();u==_t.VIDEO?await N(S.receiver,{onSei:oe("ENABLE_VIDEO_SEI")&&(F=>{var j;return(j=c._videoTrack)===null||j===void 0?void 0:j._onSei(F)})}):u==_t.AUDIO&&await G(S.receiver,{enableTopn:!!oe("ENABLE_AUDIO_TOPN"),enableMetadata:!!oe("ENABLE_AUDIO_METADATA"),onMetadata:F=>{this.safeEmit(xt.AudioMetadata,F)}})}if(u===_t.AUDIO?(c._audioTrack?c._audioTrack._updateOriginMediaStreamTrack(y):(c._audioTrack=new Zv(y,c.uid,c._uintid,this.store),x.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(c._audioTrack.getTrackId()))),S&&c._audioTrack._updateRtpTransceiver(S),this.bindRemoteTrackEvents(c,c._audioTrack)):(c._videoTrack?c._videoTrack._updateOriginMediaStreamTrack(y):(c._videoTrack=new Qv(y,c.uid,c._uintid,this.store),x.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(c._videoTrack.getTrackId()))),S&&c._videoTrack._updateRtpTransceiver(S),this.bindRemoteTrackEvents(c,c._videoTrack)),oe("ENABLE_VIDEO_SEI")&&S){const{interceptRemoteVideoFrame:N,interceptRemoteAudioFrame:G}=PP();u==_t.VIDEO?await N(S.receiver,{onSei:F=>{var j;(j=c._videoTrack)===null||j===void 0||j._onSei(F)}}):u==_t.AUDIO&&await G(S.receiver)}const R=this.remoteUserMap.get(c);R?R.set(u,v):this.remoteUserMap.set(c,new Map([[u,v]])),this.statsCollector.addRemoteStats(c.uid),this.statsUploader.startUploadInboundStats();const P=this.pendingRemoteTracks.findIndex(N=>{let{user:G,kind:F}=N;return G.uid===c.uid&&u===F});P!==-1&&(this.pendingRemoteTracks.splice(P,1),this.emit(xt.MediaReconnectEnd,c.uid))}}async unsubscribe(t,r,s){const a=this.pendingRemoteTracks.filter(h=>{let{user:m,kind:y}=h;return r!==void 0?m.uid===t.uid&&r===y:m.uid===t.uid});if(a.forEach(h=>{const m=this.pendingRemoteTracks.indexOf(h);this.pendingRemoteTracks.splice(m,1)}),this.connection&&this.state===qn.Connected||s||a.forEach(h=>{let{kind:m}=h;var y;if(m===_t.AUDIO)(y=t._audioTrack)===null||y===void 0||y._destroy(),t._audioTrack=void 0;else if(m===_t.VIDEO){var v;(v=t._videoTrack)===null||v===void 0||v._destroy(),t._videoTrack=void 0}}),!this.connection||this.state!==qn.Connected)return;const c=this.filterTobeUnSubscribedTracks(t,r);if(c.length===0)return;await this.connection.stopReceiving(c.map(h=>{let[,{id:m}]=h;return m}));const u=this.createUnsubscribeMessage(c);return this.withdrawRemoteTracks(c),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),c.forEach(h=>{let[m,{kind:y}]=h;var v,S;if(y===_t.VIDEO&&m._videoSSRC&&((v=this.connection)===null||v===void 0||v.setStatsRemoteVideoIsReady(m._videoSSRC,!1)),y===_t.VIDEO)this.unbindRemoteTrackEvents(m._videoTrack),s||((S=m._videoTrack)===null||S===void 0||S._destroy(),m._videoTrack=void 0);else if(y===_t.AUDIO){var R;this.unbindRemoteTrackEvents(m._audioTrack),!s&&((R=m._audioTrack)===null||R===void 0||R._destroy(),m._audioTrack=void 0)}}),u}async unsubscribeDataChannel(t,r){if(r.forEach(c=>{const u=this.pendingRemoteDataChannels.findIndex(h=>h.id===c.id);u!==-1&&this.pendingRemoteDataChannels.splice(u,1)}),!this.connection)return;const s=this.filterTobeUnSubscribedDataChannels(t,r);if(s.length===0)return;r.forEach(c=>{c._close()});const a=this.remoteDataChannelMap.get(t);return s.forEach(c=>{a&&a.delete(c.id)}),a&&a.size===0&&(this.remoteDataChannelMap.delete(t),await this.connection.stopDataChannels(t.uid)),s.map(c=>c.id)}async massUnsubscribe(t){return this.massUnsubscribeNoLock(t)}async massUnsubscribeNoLock(t){let r=[];for(const{user:c,mediaType:u}of t){const h=this.pendingRemoteTracks.filter(m=>{let{user:y,kind:v}=m;return u!==void 0?y.uid===c.uid&&u===v:y.uid===c.uid});h.forEach(m=>{const y=this.pendingRemoteTracks.indexOf(m);this.pendingRemoteTracks.splice(y,1)}),r=r.concat(h)}if(!this.connection||this.state!==qn.Connected)return void r.forEach(c=>{let{user:u,kind:h}=c;var m;if(h===_t.AUDIO)(m=u._audioTrack)===null||m===void 0||m._destroy(),u._audioTrack=void 0;else if(h===_t.VIDEO){var y;(y=u._videoTrack)===null||y===void 0||y._destroy(),u._videoTrack=void 0}});const s=lc(t).call(t,(c,u)=>{let{user:h,mediaType:m}=u;const y=this.filterTobeUnSubscribedTracks(h,m);return c.concat(y)},[]);if(s.length===0)return;await this.connection.stopReceiving(s.map(c=>{let[,{id:u}]=c;return u}));const a=this.createUnsubscribeAllMessage(s);return this.withdrawRemoteTracks(s),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),s.forEach(c=>{let[u,{kind:h}]=c;var m,y;if(h===_t.VIDEO&&u._videoSSRC&&((m=this.connection)===null||m===void 0||m.setStatsRemoteVideoIsReady(u._videoSSRC,!1)),h===_t.VIDEO)this.unbindRemoteTrackEvents(u._videoTrack),(y=u._videoTrack)===null||y===void 0||y._destroy(),u._videoTrack=void 0;else if(h===_t.AUDIO){var v;this.unbindRemoteTrackEvents(u._audioTrack),(v=u._audioTrack)===null||v===void 0||v._destroy(),u._audioTrack=void 0}}),a}isPreSubScribe(t){return!this.connection||this.state!==qn.Connected?!1:!!this.connection.getPreMedia(t)}async muteRemote(t,r){if(!this.connection)return;const s=this.remoteUserMap.get(t);if(!s)return void x.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(t.uid,"."));if(!s.get(r))return void x.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(t.uid," media type ").concat(r,"."));const a=r===_t.VIDEO?t._videoSSRC:t._audioSSRC;a!==void 0&&this.connection.setStatsRemoteVideoIsReady(a,!1)}async unmuteRemote(t,r){return this.unmuteRemoteNoLock(t,r)}async unmuteRemoteNoLock(t,r){if(!this.connection)return;const s=this.remoteUserMap.get(t);if(!s)return void x.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(t.uid,"."));s.get(r)||x.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(t.uid," media type ").concat(r,"."))}addAudioMetadata(t){const r=this.localTrackMap.get(Ke.LocalAudioTrack),s=r&&r.track;s&&s.metadata.push(t)}getAllTracks(t){const r=this.localTrackMap.get(Ke.LocalAudioTrack);if((r==null?void 0:r.track)instanceof Li){const s=r.track;return Array.from(this.localTrackMap.entries()).filter(a=>{let[c]=a;return c!==Ke.LocalAudioTrack}).filter(a=>{let[c]=a;return!(t&&c===Ke.LocalVideoLowTrack)}).map(a=>{let[,{track:c}]=a;return c}).concat(s.trackList)}return Array.from(this.localTrackMap.entries()).filter(s=>{let[a]=s;return!(t&&a===Ke.LocalVideoLowTrack)}).map(s=>{let[,{track:a}]=s;return a})}getAllDataChannels(){return this.localDataChannels}reportPublishEvent(t,r,s,a,c){if(t){const h=this.localTrackMap.get(Ke.LocalAudioTrack),m=a?this.localTrackMap.get(Ke.LocalVideoLowTrack):this.localTrackMap.get(Ke.LocalVideoTrack);It.publish(this.store.sessionId,{eventElapse:zs.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:t,ec:r,audioName:h==null?void 0:h.track.getTrackLabel(),videoName:m==null?void 0:m.track.getTrackLabel(),screenshare:(m==null?void 0:m.track._hints.indexOf(hr.SCREEN_TRACK))!==-1,audio:!!h,video:!!m,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:c})}else{var u;s||(s=[]);const h=s.find(y=>y instanceof Yr),m=a?(u=this.localTrackMap.get(Ke.LocalVideoTrack))===null||u===void 0?void 0:u.track:s.find(y=>y instanceof Sr);It.publish(this.store.sessionId,{eventElapse:zs.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:t,ec:r,audioName:h==null?void 0:h.getTrackLabel(),videoName:m==null?void 0:m.getTrackLabel(),screenshare:(m==null?void 0:m._hints.indexOf(hr.SCREEN_TRACK))!==-1,audio:!!h,video:!!m,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:c})}}reportSubscribeEvent(t,r,s,a){const c=a===_t.VIDEO?s._videoSSRC:s._audioSSRC;c&&It.subscribe(this.store.sessionId,{succ:t,ec:r,video:a===_t.VIDEO,audio:a===_t.AUDIO,peerid:s.uid,subscribeRequestid:c,p2pid:this.store.p2pId,eventElapse:zs.measureFromSubscribeStart(this.store.clientId,c),preSsrc:this.isPreSubScribe(c)})}reset(){x.debug("[".concat(this.store.clientId,"] P2PChannel.reset")),this.mutex=new js("P2PChannel-mutex",this.store.clientId),this.connection&&(this.resetConnection(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=MP(this.store),this.emit(xt.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.statsUploader.stopUploadBaseStats(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const t=this.localTrackMap.get(Ke.LocalAudioTrack);if((t==null?void 0:t.track)instanceof Li){if(t.track.trackList.length>0){const r=t.track;t.track.trackList.forEach(s=>{r.removeAudioTrack(s)})}t.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.iceFailedCount=0,this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.localDataChannels=[],this.remoteDataChannelMap.clear(),this.pendingLocalDataChannels=[],this.pendingRemoteDataChannels=[],this.state=qn.Disconnected}getStats(){var t;return(t=this.connection)===null||t===void 0?void 0:t.getStats()}getRemoteVideoIsReady(t){var r;return((r=this.connection)===null||r===void 0?void 0:r.getRemoteVideoIsReady(t))||!1}getLocalAudioVolume(){const t=this.localTrackMap.get(Ke.LocalAudioTrack);if(t)return t.track.getVolumeLevel()}getLocalVideoSize(){const t=this.localTrackMap.get(Ke.LocalVideoTrack);if(t)return{width:t.track.videoWidth||0,height:t.track.videoHeight||0}}getEncoderConfig(t){const r=this.localTrackMap.get(t);return r&&r.track instanceof Sr||r&&r.track instanceof Yr?r.track._encoderConfig:void 0}getLocalMedia(t){return this.localTrackMap.get(t)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(t,r){if(!t)return this.remoteUserMap.size>0;const s=this.remoteUserMap.get(t);return!!s&&(!r||s.has(r))}async hasRemoteMediaWithLock(t,r){if(!t)return this.remoteUserMap.size>0;const s=this.remoteUserMap.get(t);return!!s&&(!r||s.has(r))}getRemoteMedia(t){var r;const s=Array.from(Kc(r=this.remoteUserMap).call(r)).find(a=>a.uid===t);return s?{audioTrack:s.audioTrack,audioSSRC:s._audioSSRC,videoTrack:s.videoTrack,videoSSRC:s._videoSSRC}:{}}getAudioLevels(){let t=Array.from(this.remoteUserMap.entries()).map(s=>{let[a]=s;return{uid:a.uid,level:a.audioTrack?100*a.audioTrack._source.getAccurateVolumeLevel():0}});const r=this.localTrackMap.get(Ke.LocalAudioTrack);return r&&t.push({level:100*r.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),t=uT(t).call(t,(s,a)=>s.level-a.level),t}async disconnectForReconnect(){this.connection&&(x.debug("[".concat(this.store.clientId,"] P2PChannel.disconnectForReconnect closing P2PConnection")),this.state=qn.Reconnecting,oe("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(t=>{let[r]=t;var s;r._videoTrack&&r._videoTrack._player&&((s=r._videoTrack._player.getVideoElement())===null||s===void 0||s.pause(),r._videoTrack._player.isKeepLastFrame=!0,r._videoTrack._originMediaStreamTrack.stop())}),this.resetConnection(this.connection),this.connection=void 0,this.shouldForwardP2PCreation&&(this.connection=MP(this.store),this.emit(xt.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(t=>{var r;let[s,{track:a}]=t;switch(s){case Ke.LocalVideoTrack:ot(r=a._hints).call(r,hr.LOW_STREAM)?a.close():this.pendingLocalTracks.push(a);break;case Ke.LocalAudioTrack:a instanceof Li?this.pendingLocalTracks=this.pendingLocalTracks.concat(a.trackList):this.pendingLocalTracks.push(a);case Ke.LocalVideoLowTrack:}}),this.emit(xt.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(t=>{let[r,s]=t;Array.from(Kc(s).call(s)).forEach(a=>{this.setPendingRemoteMedia(r,a)}),this.emit(xt.MediaReconnectStart,r.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.localDataChannels.length!==0&&(this.localDataChannels.forEach(t=>{this.pendingLocalDataChannels.push(t)}),this.localDataChannels.length=0),this.remoteDataChannelMap.size!==0&&(Array.from(this.remoteDataChannelMap.entries()).forEach(t=>{let[r,s]=t;Array.from(Kc(s).call(s)).forEach(a=>{this.setPendingRemoteDataChannel(r,a)})}),this.remoteDataChannelMap.clear()),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),x.debug("[".concat(this.store.clientId,"] P2PChannel disconnected, waiting to reconnect.")))}hasPendingRemoteDataChannel(t,r){for(const s of this.pendingRemoteDataChannels){const{user:a,id:c}=s;if((t instanceof qm?t.uid:t)===a.uid&&c===r)return!0}return!1}setPendingRemoteDataChannel(t,r){this.hasPendingRemoteDataChannel(t,r)||this.pendingRemoteDataChannels.push({user:t,id:r})}hasPendingRemoteMedia(t,r){for(const s of this.pendingRemoteTracks){const{user:a,kind:c}=s;if((t instanceof qm?t.uid:t)===a.uid&&r===c)return!0}return!1}setPendingRemoteMedia(t,r){this.hasPendingRemoteMedia(t,r)||this.pendingRemoteTracks.push({user:t,kind:r})}restartICE(t){var r=this;return Tl(function*(){if(!r.connection||r.state!==qn.Connected)return;const s=yield kn(r.mutex.lock("From P2PChannel.restartICE"));let a;try{a=yield kn(r.connection.restartICE(t));const u=yield kn(a.next());if(u.done)return;const h=u.value,m=yield h;switch(A2(r.connection)&&r.reportPCStats(Date.now(),!1,r._pcStatsUploadType),t){case Ws.UDP_TCP_RELAY:r._pcStatsUploadType=lp.UDP_TCP_RESTART;break;case Ws.TCP_RELAY:r._pcStatsUploadType=lp.TCP_RESTART;break;case Ws.RELAY:r._pcStatsUploadType=lp.RELAY_RESTART;break;default:r._pcStatsUploadType=lp.OLD_RESTART}r._isTryConnecting=!0,a.next(m)}catch(u){var c;(c=a)===null||c===void 0||c.throw(u)}finally{s()}})()}getUplinkNetworkQuality(){if(!this.connection)return 0;const t=this.connection.getStats(),r=this.localTrackMap.get(Ke.LocalVideoTrack),s=this.localTrackMap.get(Ke.LocalAudioTrack),a=t.videoSend.find(N=>N.ssrc===(r==null?void 0:r.ssrcs[0].ssrcId)),c=t.audioSend.find(N=>N.ssrc===(s==null?void 0:s.ssrcs[0].ssrcId));if(!a||!c)return 1;const u=Hc(this,xt.NeedSignalRTT),h=a?a.rttMs:void 0,m=c?c.rttMs:void 0,y=h&&m?(h+m)/2:h||m,v=(y&&u?(y+u)/2:y||u)||0,S=100*t.sendPacketLossRate*.7/50+.3*v/1500,R=S<.17?1:S<.36?2:S<.59?3:S<.1?4:5,P=r==null?void 0:r.track;if(P&&P._encoderConfig&&P._hints.indexOf(hr.SCREEN_TRACK)===-1){const N=P._encoderConfig.bitrateMax,G=t.bitrate.actualEncoded;if(N&&G){const F=(1e3*N-G)/(1e3*N);return EH[F<.15?0:F<.3?1:F<.45?2:F<.6?3:4][R]}}return R}getDownlinkNetworkQuality(){if(!this.connection)return 0;const t=this.connection.getStats();let r=0;return Array.from(this.remoteUserMap.entries()).forEach(s=>{let[a]=s;const c=a._audioSSRC,u=a._videoSSRC,h=t.audioRecv.find(G=>G.ssrc===c),m=t.videoRecv.find(G=>G.ssrc===u);if(!h&&!m)return void(r+=1);const y=Hc(this,xt.NeedSignalRTT),v=t.rtt,S=(v&&y?(v+y)/2:v||y)||0,R=h?h.jitterMs:void 0,P=t.recvPacketLossRate;let N=.7*P*100/50+.3*S/1500;R&&(N=.6*P*100/50+.2*S/1500+.2*R/400),r+=N<.1?1:N<.17?2:N<.36?3:N<.59?4:5}),this.remoteUserMap.size>0?Math.round(r/this.remoteUserMap.size):r}async muteLocalTrack(t){return new dt((r,s)=>{this.handleMuteLocalTrack(t,r,s)})}async replaceTrack(t,r){var s;if(x.debug("[".concat(this.store.clientId,"] P2PChannel replaceTrack from [").concat(t.getTrackId(),"] to [").concat(r.getTrackId(),"]")),!this.connection||this.state!==qn.Connected)return;const a=Array.from(this.localTrackMap.entries()).find(u=>{let[,{track:h}]=u;return t===h});if(!a)return;const c=a[0];if(t!==r&&(this.unbindLocalTrackEvents([{track:t,type:c}]),this.bindLocalTrackEvents([{track:r,type:c}]),a[1].track=r),await((s=this.connection)===null||s===void 0?void 0:s.replaceTrack(r,a[1].id)),this.isPlanB){const u=a[1];u.id=r._mediaStreamTrack.id,this.localTrackMap.set(c,u)}if(c===Ke.LocalVideoTrack&&!oe("DISABLE_DUAL_STREAM_USE_ENCODING")&&Vn().supportDualStreamEncoding){const u=this.localTrackMap.get(Ke.LocalVideoLowTrack);if(u){const h=t._mediaStreamTrack.clone();u.track._originMediaStreamTrack.stop(),u.track._mediaStreamTrack=h,u.track._originMediaStreamTrack=h,await new dt((m,y)=>{this.handleReplaceTrack(u.track,m,y,!0)})}}}filterTobePublishedTracks(t,r,s){const a=[],c=this.getAllTracks();t=Fv(t=t.filter(y=>c.indexOf(y)===-1));let u,h=!1;const m=this.localTrackMap.get(Ke.LocalAudioTrack);for(const y of t){if(y instanceof Sr&&(this.localTrackMap.has(Ke.LocalVideoTrack)||h?new Le(te.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(a.push({track:y,type:Ke.LocalVideoTrack}),h=!0),r)){const v=this.getLowVideoTrack(y,s);a.push({track:v,type:Ke.LocalVideoLowTrack})}if(y instanceof Yr)if(m){const v=m.track;if(v instanceof Li)R2([y]),v.addAudioTrack(y),this.bindLocalAudioTrackEvents(y,!0);else{const S=I2([v,y]);x.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(S.getTrackId(),"]")),this.replaceTrack(v,S)}}else u instanceof Li?(R2([y]),u.addAudioTrack(y)):u||!y._useAudioElement&&Vn().webAudioMediaStreamDest&&!y._bypassWebAudio?u=I2(u?[y,u]:[y]):u=y}return u&&(x.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will send audioTrack [").concat(u.getTrackId(),"]")),a.push({track:u,type:Ke.LocalAudioTrack})),a}filterTobeUnpublishedTracks(t){const r=[],s=this.getAllTracks();t=Fv(t=t.filter(a=>s.indexOf(a)!==-1));for(const a of t){if(a instanceof Yr){const c=this.localTrackMap.get(Ke.LocalAudioTrack);if(!c)continue;c.track instanceof Li?(c.track.removeAudioTrack(a),this.unbindLocalAudioTrackEvents(a),c.track.trackList.length===0&&(r.push([Ke.LocalAudioTrack,c]),c.track.close())):r.push([Ke.LocalAudioTrack,c])}if(a instanceof Sr){const c=this.localTrackMap.get(Ke.LocalVideoTrack);if(!c)continue;r.push([Ke.LocalVideoTrack,c]);const u=this.localTrackMap.get(Ke.LocalVideoLowTrack);u&&r.push([Ke.LocalVideoLowTrack,u])}}return r}filterTobePublishedDataChannels(t){return t=(t=Fv(t)).filter(r=>this.localDataChannels.findIndex(s=>s.id===r.id)===-1)}filterTobeUnpublishedDataChannels(t){return t=(t=(t=Fv(t)).filter(r=>this.localDataChannels.indexOf(r)!==-1)).filter(r=>r._originDataChannel)}bindLocalTrackEvents(t){t.forEach(r=>{let{track:s,type:a}=r;switch(a){case Ke.LocalVideoTrack:s.addListener(St.GET_STATS,this.handleGetLocalVideoStats),s.addListener(St.GET_RTC_STATS,this.handleGetRTCStats),s.addListener(St.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),s.addListener(St.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),s.addListener(St.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),s.addListener(St.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),s.addListener(St.NEED_REPLACE_TRACK,this.handleReplaceTrack),s.addListener(St.NEED_MUTE_TRACK,this.handleMuteLocalTrack),s.addListener(St.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Ke.LocalAudioTrack:this.bindLocalAudioTrackEvents(s);case Ke.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(t,r){t instanceof Li?t.trackList.forEach(s=>{s.addListener(St.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),s.addListener(St.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),s.addListener(St.GET_STATS,this.handleGetLocalAudioStats),s.addListener(St.NEED_MUTE_TRACK,this.handleMuteLocalTrack),s.addListener(St.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(t.addListener(St.GET_STATS,this.handleGetLocalAudioStats),t.addListener(St.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.addListener(St.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.addListener(St.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.addListener(St.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),r||(t.addListener(St.NEED_REPLACE_TRACK,this.handleReplaceTrack),t.addListener(St.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack)))}unbindLocalTrackEvents(t){t||(t=Array.from(this.localTrackMap.entries()).map(r=>{let[s,{track:a}]=r;return{track:a,type:s}})),t.forEach(r=>{let{track:s,type:a}=r;switch(a){case Ke.LocalVideoTrack:s.off(St.GET_STATS,this.handleGetLocalVideoStats),s.off(St.GET_RTC_STATS,this.handleGetRTCStats),s.off(St.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),s.off(St.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),s.off(St.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),s.off(St.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),s.off(St.NEED_REPLACE_TRACK,this.handleReplaceTrack),s.off(St.NEED_MUTE_TRACK,this.handleMuteLocalTrack),s.off(St.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Ke.LocalAudioTrack:this.unbindLocalAudioTrackEvents(s);case Ke.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(t){t instanceof Li?t.trackList.forEach(r=>{r.off(St.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),r.off(St.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),r.off(St.GET_STATS,this.handleGetLocalAudioStats),r.off(St.NEED_MUTE_TRACK,this.handleMuteLocalTrack),r.off(St.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(t.off(St.GET_STATS,this.handleGetLocalAudioStats),t.off(St.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(St.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(St.NEED_REPLACE_TRACK,this.handleReplaceTrack),t.off(St.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack),t.off(St.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(St.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(t,r){r instanceof Qv&&r.addListener(St.GET_STATS,s=>{s(this.handleGetRemoteVideoStats(t))}),r instanceof Zv&&r.addListener(St.GET_STATS,s=>{s(this.handleGetRemoteAudioStats(t))})}unbindRemoteTrackEvents(t){t&&t.removeAllListeners(St.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(t=>{let[r,s]=t;s.has(_t.AUDIO)&&this.unbindRemoteTrackEvents(r._audioTrack),s.has(_t.VIDEO)&&this.unbindRemoteTrackEvents(r._videoTrack)})}createGatewayPublishMessage(t,r){return t.map((s,a)=>{var c;let u,h,{track:m,type:y}=s;switch(y){case Ke.LocalAudioTrack:u=Yn.Audio,h={dtx:m instanceof cP&&m._config.DTX,hq:!1,lq:!1,stereo:!1,speech:!1};break;case Ke.LocalVideoTrack:u=ot(c=m._hints).call(c,hr.SCREEN_TRACK)?Yn.Screen:Yn.High,h=Ph(Ph({},UH(m)),{},{codec:this.store.codec,svc_mode:wP()});break;case Ke.LocalVideoLowTrack:u=Yn.Low,h=Ph(Ph({},UH(m)),{},{codec:this.store.codec,svc_mode:wP()})}return{stream_type:u,attributes:h,ssrcs:r[a]}})}createGatewayUnpublishMessage(t){return t.map(r=>{var s;let a,[c,{track:u,ssrcs:h,id:m}]=r;switch(c){case Ke.LocalVideoTrack:a=ot(s=u._hints).call(s,hr.SCREEN_TRACK)?Yn.Screen:Yn.High;break;case Ke.LocalAudioTrack:a=Yn.Audio;break;case Ke.LocalVideoLowTrack:a=Yn.Low}return{stream_type:a,ssrcs:h,mid:m}})}assignLocalTracks(t,r){t.forEach((s,a)=>{let{track:c,type:u}=s;this.localTrackMap.set(u,{track:c,id:r[a].id,ssrcs:r[a].localSSRC})})}withdrawLocalTracks(t){t.forEach(r=>{let[s]=r;this.localTrackMap.delete(s)})}bindConnectionEvents(t){t.onConnectionStateChange=async r=>{if(x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onConnectionStateChange(").concat(r,")")),this.emit(xt.PeerConnectionStateChange,r),r==="connecting"&&t instanceof Ih&&!Br()&&oe("FIRST_TCP_CANDIDATE")&&window.setTimeout(()=>{r==="connecting"&&t.extendCandidate()},oe("FIRST_TCP_CANDIDATE_INTERVAL")),r!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),r==="connected"&&(this._restartTimer&&(window.clearTimeout(this._restartTimer),this._restartTimer=void 0),t instanceof Ih&&M9(t,!0),this._isTryConnecting&&this.reportPCStats(Date.now(),!0,this._pcStatsUploadType),this._isTryConnecting=!1,this._isStartRestartIce=!1,this._pcStatsUploadType=lp.DISCONNECTED_OR_FAILED,Hc(this,xt.QueryClientConnectionState)==="CONNECTED"&&this._isWaitPcToRePub)){const s=this.pendingLocalTracks.map(c=>c.getTrackId()),a=this.pendingLocalDataChannels.map(c=>"dc_".concat(c.id));It.reportApiInvoke(this.store.sessionId,{name:Ai.REPUB_AFTER_PC_CONNECTED,options:s.concat(a),tag:zr.TRACER}).onSuccess(),this.republish()}if(oe("NEW_ICE_RESTART")&&t instanceof Ih&&!Br()&&!this._forceTurn){if(ot(OH).call(OH,r)){if(this._isStartRestartIce)return;this._isStartRestartIce=!0;const s=c=>{A2(t)&&(x.debug("[".concat(this.store.clientId,"] [P2PChannel] try to restartICE, type is ").concat(c)),Hc(this,xt.QueryClientConnectionState)==="CONNECTED"&&this.emit(xt.RequestRestartICE,c))},a=()=>{A2(t)&&(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),x.debug("[".concat(this.store.clientId,"] P2PConnection disconnected timeout, force reconnect")),setTimeout(()=>this.emit(xt.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())};return void(this._restartTimer=window.setTimeout(()=>{U9(t,s,a)},800))}}else{if(r==="disconnected"&&t.iceConnectionState==="disconnected")return setTimeout(()=>{t.iceConnectionState==="disconnected"&&oe("ICE_RESTART")&&Hc(this,xt.QueryClientConnectionState)==="CONNECTED"&&this.emit(xt.RequestRestartICE)},800),void setTimeout(()=>{t.peerConnectionState==="disconnected"&&(x.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection disconnected timeout 4000ms, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isTryConnecting=!1,setTimeout(()=>this.emit(xt.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())},4e3);r==="failed"&&(x.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection state failed, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),setTimeout(()=>this.emit(xt.P2PLost),0),this.iceFailedCount+=1,await this.requestReconnect())}},t.onICEConnectionStateChange=r=>{r!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(r,")")),It.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:r,tag:zr.TRACER}).onSuccess(),this.emit(xt.IceConnectionStateChange,r)},t.onICETransportStateChange=r=>{x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(r,")"))},t.onDTLSTransportStateChange=r=>{x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(r,")"))},t.onDTLSTransportError=r=>{x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(r,")"))},t.onFirstAudioDecoded=r=>{var s;const a=Array.from(Kc(s=this.remoteUserMap).call(s)).find(u=>u._audioSSRC===r);var c;a&&(this.store.subscribe(a.uid,"audio",void 0,void 0,void 0,Date.now()),(c=a.audioTrack)===null||c===void 0||c.emit(Kv.FIRST_FRAME_DECODED),It.firstRemoteFrame(this.store.sessionId,Xi.FIRST_AUDIO_DECODE,Nr.FIRST_AUDIO_DECODE,{peer:a._uintid,subscribeElapse:zs.measureFromSubscribeStart(this.store.clientId,r),subscribeRequestid:r,p2pid:this.store.p2pId}))},t.onFirstAudioReceived=r=>{var s;const a=Array.from(Kc(s=this.remoteUserMap).call(s)).find(c=>c._audioSSRC===r);a&&It.firstRemoteFrame(this.store.sessionId,Xi.FIRST_AUDIO_RECEIVED,Nr.FIRST_AUDIO_RECEIVED,{peer:a._uintid,subscribeElapse:zs.measureFromSubscribeStart(this.store.clientId,r),subscribeRequestid:r,p2pid:this.store.p2pId})},t.onFirstVideoDecoded=(r,s,a)=>{this.reportVideoFirstFrameDecoded(r,s,a)},t.onFirstVideoReceived=r=>{var s;const a=Array.from(Kc(s=this.remoteUserMap).call(s)).find(c=>c._videoSSRC===r);a&&It.firstRemoteFrame(this.store.sessionId,Xi.FIRST_VIDEO_RECEIVED,Nr.FIRST_VIDEO_RECEIVED,{peer:a._uintid,subscribeElapse:zs.measureFromSubscribeStart(this.store.clientId,r),subscribeRequestid:r,p2pid:this.store.p2pId})},t.onSelectedLocalCandidateChanged=(r,s)=>{const a=r.candidateType==="relay",c=s.candidateType==="relay";s.candidateType!=="unknown"&&a===c||this.emit(xt.ConnectionTypeChange,a),x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(Hm(s))," -> ").concat(JSON.stringify(Hm(r)),")"))},t.onSelectedRemoteCandidateChanged=(r,s)=>{x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(Hm(s))," -> ").concat(JSON.stringify(Hm(r)),")"))},t.onFirstVideoDecodedTimeout=r=>{this.reportVideoFirstFrameDecoded(r,void 0,void 0,!0)},t.getLocalVideoStats=()=>{const r=this.statsCollector.getLocalVideoTrackStats(),s=this.statsCollector.getRTCStats();return Ph(Ph({},r),s)},t.onICECandidateError=r=>{this._iceError=r}}resetConnection(t){t instanceof Ih&&function(r){hS.delete(r.id),M9(r)}(t),t.close(),this.emit(xt.PeerConnectionStateChange,"closed"),function(r){r.onConnectionStateChange=void 0,r.onICEConnectionStateChange=void 0,r.onICETransportStateChange=void 0,r.onDTLSTransportStateChange=void 0,r.onDTLSTransportError=void 0,r.onFirstAudioDecoded=void 0,r.onFirstAudioReceived=void 0,r.onFirstVideoDecoded=void 0,r.onFirstVideoReceived=void 0,r.onSelectedLocalCandidateChanged=void 0,r.onSelectedRemoteCandidateChanged=void 0,r.onFirstVideoDecodedTimeout=void 0,r.getLocalVideoStats=void 0}(t),this._isWaitPcToRePub=!1}filterTobeMutedTracks(t){const r=[];if(this.getAllTracks().indexOf(t)===-1)return r;const s=this.localTrackMap.get(Ke.LocalAudioTrack);if(t instanceof Yr&&(s==null?void 0:s.track)instanceof Li)return s.track.isActive||r.push([Ke.LocalAudioTrack,s]),r;const a=Array.from(this.localTrackMap.entries()).find(c=>{let[,{track:u}]=c;return t===u});if(a&&(r.push(a),a[0]===Ke.LocalVideoTrack)){const c=this.localTrackMap.get(Ke.LocalVideoLowTrack);c&&r.push([Ke.LocalVideoLowTrack,c])}return r}filterTobeUnmutedTracks(t){const r=[],s=this.localTrackMap.get(Ke.LocalAudioTrack);if(t instanceof Yr&&(s==null?void 0:s.track)instanceof Li)return s.track.isActive&&r.push([Ke.LocalAudioTrack,s]),r;const a=Array.from(this.localTrackMap.entries()).find(c=>{let[,{track:u}]=c;return t===u});if(a)if(a[0]===Ke.LocalVideoTrack){r.push(a);const c=this.localTrackMap.get(Ke.LocalVideoLowTrack);c&&r.push([Ke.LocalVideoLowTrack,c])}else r.push(a);return r}createMuteMessage(t){return t.map(r=>{var s;let a,[c,{track:u,ssrcs:h,id:m}]=r;switch(c){case Ke.LocalAudioTrack:a=Yn.Audio;break;case Ke.LocalVideoTrack:a=ot(s=u._hints).call(s,hr.SCREEN_TRACK)?Yn.Screen:Yn.High;break;case Ke.LocalVideoLowTrack:a=Yn.Low}return{stream_type:a,ssrcs:h,mid:m}})}createUnmuteMessage(t){return t.map(r=>{var s;let a,[c,{track:u,ssrcs:h,id:m}]=r;switch(c){case Ke.LocalAudioTrack:a=Yn.Audio;break;case Ke.LocalVideoTrack:a=ot(s=u._hints).call(s,hr.SCREEN_TRACK)?Yn.Screen:Yn.High;break;case Ke.LocalVideoLowTrack:a=Yn.Low}return{stream_type:a,ssrcs:h,mid:m}})}filterTobeUnSubscribedTracks(t,r){const s=[],a=this.remoteUserMap.get(t);if(!a)return s;if(r){const c=a.get(r);if(!c)return s;s.push([t,{kind:r,id:c}])}else Array.from(a.entries()).forEach(c=>{let[u,h]=c;s.push([t,{kind:u,id:h}])});return s}filterTobeUnSubscribedDataChannels(t,r){const s=[];return r.forEach(a=>{var c;(c=this.remoteDataChannelMap.get(t))!==null&&c!==void 0&&c.has(a.id)&&s.push(a)}),s}createUnsubscribeMessage(t){const r=[];return t.forEach(s=>{let[a,{kind:c,id:u}]=s;switch(c){case _t.VIDEO:return void(a._videoSSRC&&r.push({stream_type:_t.VIDEO,ssrcId:a._videoSSRC}));case _t.AUDIO:return void(a._audioSSRC&&r.push({stream_type:_t.AUDIO,ssrcId:a._audioSSRC}))}}),r}createUnsubscribeAllMessage(t){const r=new Map;return t.forEach(s=>{let[a,{kind:c}]=s;if(r.has(a)){let u=r.get(a);c===_t.VIDEO?u|=Ji.Video:u|=Ji.Audio,r.set(a,u)}else c===_t.VIDEO?r.set(a,Ji.Video):r.set(a,Ji.Audio)}),{users:Array.from(r.entries()).map(s=>{let[a,c]=s;return{stream_id:a.uid,stream_type:c}})}}withdrawRemoteTracks(t){t.forEach(r=>{let[s,{kind:a}]=r;const c=this.remoteUserMap.get(s);c&&(c.delete(a),Array.from(c.entries()).length===0&&this.remoteUserMap.delete(s))})}async updateBitrateLimit(t){const r=this.localTrackMap.get(Ke.LocalVideoTrack),s=this.localTrackMap.get(Ke.LocalVideoLowTrack);r&&(await r.track.setBitrateLimit(t.uplink),await new dt((a,c)=>{this.handleUpdateVideoEncoder(r.track,a,c,!0)})),s&&t.low_stream_uplink&&(await s.track.setBitrateLimit({max_bitrate:t.low_stream_uplink.bitrate,min_bitrate:t.low_stream_uplink.bitrate||0}),await new dt((a,c)=>{this.handleUpdateVideoEncoder(s.track,a,c,!0)}))}isP2PDisconnected(){return this.connection?this.connection.peerConnectionState!=="connected":!0}mapPubResToRemoteConfig(t,r,s){return t.map((a,c)=>{var u;let{stream_type:h}=a;const m=(u=r.find(y=>{let{stream_type:v}=y;return h===v}))===null||u===void 0?void 0:u.attributes;if(m&&oe("DISABLE_SCREEN_SHARE_REMB")){const y=s[c]._hints;(ot(y).call(y,hr.SCREEN_TRACK)||ot(y).call(y,hr.SCREEN_LOW_TRACK))&&(m.remb=!1,x.debug("disable remb for screen share, hints:",y))}return m})}async tryToUnmuteAudio(t){for(let s=0;s<t.length;s++)if(t[s]instanceof Yr){var r;const a=this.filterTobeUnmutedTracks(t[s]);if(a.length===0)continue;await((r=this.connection)===null||r===void 0?void 0:r.unmuteLocal(a.map(u=>{let[,{id:h}]=u;return h})));const c=this.createUnmuteMessage(a);return void await ur(this,xt.RequestUnmuteLocal,c)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=()=>this.getStats(),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=t=>{var r;return!((r=this.connection)===null||r===void 0||!r.getRemoteVideoIsReady(t))},this.statsUploader.requestUpload=(t,r)=>this.emit(xt.RequestUpload,t,r),this.statsUploader.requestUploadStats=t=>this.emit(xt.RequestUploadStats,t),this.statsUploader.requestAllTracks=()=>this.getAllTracks(),this.statsUploader.requestTransportStats=()=>{var t;return{connectState:((t=this.connection)===null||t===void 0?void 0:t.peerConnectionState)||"closed"}}}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await ps(vL(this.dtlsFailedCount,Pi)),this.emit(xt.RequestReconnect)}async reconnectP2P(){const t=Array.from(this.localTrackMap.entries()),r=this.createGatewayUnpublishMessage(t);Array.from(this.remoteUserMap.entries()),r.length>0&&await ks(this,xt.RequestUnpublishForReconnectPC,r),this.disconnectForReconnect(),this.emit(xt.RequestReconnectPC)}canPublishLowStream(){return this.localTrackMap.has(Ke.LocalVideoTrack)||this.pendingLocalTracks.some(t=>t instanceof Sr)}throwIfTrackTypeNotMatch(t){if(t.filter(r=>r instanceof Sr).length>1)throw new Le(te.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t.filter(r=>r instanceof Yr).length>1&&(t.some(r=>r instanceof Yr&&r._bypassWebAudio)||!Vn().webAudioMediaStreamDest))throw new Le(te.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const r of t){if(r instanceof Sr&&this.pendingLocalTracks.some(s=>s instanceof Sr))throw new Le(te.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(r instanceof Yr&&this.pendingLocalTracks.some(s=>s instanceof Yr)&&(!Vn().webAudioMediaStreamDest||r._bypassWebAudio||this.pendingLocalTracks.some(s=>s instanceof Yr&&s._bypassWebAudio)))throw new Le(te.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(t,r){var s;const a=!oe("DISABLE_DUAL_STREAM_USE_ENCODING")&&Vn().supportDualStreamEncoding,c=Ph(Ph({},{width:160,height:120,framerate:15,bitrate:50}),r);let u;u=a?t._mediaStreamTrack.clone():P2(t,c);const h=dr(8,"track-low-"),m=new Sr(u,Ph(Ph({},a&&{scaleResolutionDownBy:d2(c,t)}),{},{frameRate:c.framerate,bitrateMax:c.bitrate,bitrateMin:c.bitrate}),void 0,void 0,h);return m.on(W_.TRANSCEIVER_UPDATED,y=>{t._updateRtpTransceiver(y,Hv.LOW_STREAM)}),m._hints.push(hr.LOW_STREAM),ot(s=t._hints).call(s,hr.SCREEN_TRACK)&&m._hints.push(hr.SCREEN_LOW_TRACK),t.on("sei-to-send",y=>{m.emit("sei-to-send",y)}),t.addListener(St.NEED_CLOSE,()=>{m.close()}),m}async globalLock(){return this.mutex.lock("From P2PChannel.globalLock")}async reportPCStats(t,r,s){let a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;if(this.connection&&this.connection instanceof Ih){var c,u,h,m;const y=this.store.keyMetrics.descriptionStart||0,{iceConnectionState:v,dtlsTransportState:S,peerConnectionState:R}=this.connection,{local:P,remote:N}=await this.connection.getSelectedCandidatePair();It.pcStats(this.store.sessionId,{startTime:y,eventElapse:t-y||0,iceconnectionsate:v,dtlsstate:S,connectionstate:R,intSucc:r?1:2,error:this._iceError||a||"",selectedLocalCandidateProtocol:(c=P==null?void 0:P.protocol)!==null&&c!==void 0?c:"",selectedLocalCandidateType:(u=P.candidateType)!==null&&u!==void 0?u:"",selectedLocalCandidateAddress:"".concat(P.address,":").concat(P.port),selectedRemoteCandidateProtocol:(h=N.protocol)!==null&&h!==void 0?h:"",selectedRemoteCandidateType:(m=N.candidateType)!==null&&m!==void 0?m:"",selectedRemoteCandidateAddress:"".concat(N.address,":").concat(N.port),restartCnt:s,preallocation:this.connection.isPreallocation}),this._iceError=null}}reportVideoFirstFrameDecoded(t,r,s,a){var c;const u=Array.from(Kc(c=this.remoteUserMap).call(c)).find(h=>h._videoSSRC===t);if(u){a||this.store.subscribe(u.uid,"video",void 0,void 0,void 0,void 0,Date.now());const h=this.store.keyMetrics,m=h.subscribe.find(y=>y.userId===u.uid&&y.type==="video");It.firstRemoteVideoDecode(this.store.sessionId,Xi.FIRST_VIDEO_DECODE,Nr.FIRST_VIDEO_DECODE,{peer:u._uintid,videowidth:r,videoheight:s,subscribeElapse:zs.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId,apEnd:h.requestAPEnd||0,apStart:h.requestAPStart||0,joinGwEnd:h.joinGatewayEnd||0,joinGwStart:h.joinGatewayStart||0,pcEnd:h.peerConnectionEnd||0,pcStart:h.peerConnectionStart||0,subscriberEnd:(m==null?void 0:m.subscribeEnd)||0,subscriberStart:(m==null?void 0:m.subscribeStart)||0,videoAddNotify:(m==null?void 0:m.streamAdded)||0,state:a?1:0,firstFrame:(m==null?void 0:m.firstFrame)||0})}}async remoteMediaSsrcChanged(t,r,s){if(!this.connection)return!1;const a=this.remoteUserMap.get(t);if(!a)return!1;const c=a.get(r);if(!c)return!1;const u=await this.connection.getRemoteSSRC(c);return u!==void 0&&u!==s}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(t=>{let[r,{track:s}]=t;r===Ke.LocalVideoLowTrack?s._updateRtpTransceiver(void 0,Hv.LOW_STREAM):s._updateRtpTransceiver(void 0)})}},Tt(pn.prototype,"startP2PConnection",[_o],Object.getOwnPropertyDescriptor(pn.prototype,"startP2PConnection"),pn.prototype),Tt(pn.prototype,"connect",[_o],Object.getOwnPropertyDescriptor(pn.prototype,"connect"),pn.prototype),Tt(pn.prototype,"updateRemoteRTPCapabilities",[_o],Object.getOwnPropertyDescriptor(pn.prototype,"updateRemoteRTPCapabilities"),pn.prototype),Tt(pn.prototype,"publishDataChannel",[_o],Object.getOwnPropertyDescriptor(pn.prototype,"publishDataChannel"),pn.prototype),Tt(pn.prototype,"unpublish",[_o],Object.getOwnPropertyDescriptor(pn.prototype,"unpublish"),pn.prototype),Tt(pn.prototype,"unpublishDataChannel",[_o],Object.getOwnPropertyDescriptor(pn.prototype,"unpublishDataChannel"),pn.prototype),Tt(pn.prototype,"unpublishLowStream",[_o],Object.getOwnPropertyDescriptor(pn.prototype,"unpublishLowStream"),pn.prototype),Tt(pn.prototype,"subscribeDataChannel",[_o],Object.getOwnPropertyDescriptor(pn.prototype,"subscribeDataChannel"),pn.prototype),Tt(pn.prototype,"subscribe",[_o],Object.getOwnPropertyDescriptor(pn.prototype,"subscribe"),pn.prototype),Tt(pn.prototype,"massSubscribe",[_o],Object.getOwnPropertyDescriptor(pn.prototype,"massSubscribe"),pn.prototype),Tt(pn.prototype,"unsubscribe",[_o],Object.getOwnPropertyDescriptor(pn.prototype,"unsubscribe"),pn.prototype),Tt(pn.prototype,"unsubscribeDataChannel",[_o],Object.getOwnPropertyDescriptor(pn.prototype,"unsubscribeDataChannel"),pn.prototype),Tt(pn.prototype,"massUnsubscribe",[_o],Object.getOwnPropertyDescriptor(pn.prototype,"massUnsubscribe"),pn.prototype),Tt(pn.prototype,"muteRemote",[_o],Object.getOwnPropertyDescriptor(pn.prototype,"muteRemote"),pn.prototype),Tt(pn.prototype,"unmuteRemote",[_o],Object.getOwnPropertyDescriptor(pn.prototype,"unmuteRemote"),pn.prototype),Tt(pn.prototype,"hasRemoteMediaWithLock",[_o],Object.getOwnPropertyDescriptor(pn.prototype,"hasRemoteMediaWithLock"),pn.prototype),Tt(pn.prototype,"disconnectForReconnect",[_o],Object.getOwnPropertyDescriptor(pn.prototype,"disconnectForReconnect"),pn.prototype),Tt(pn.prototype,"updateBitrateLimit",[_o],Object.getOwnPropertyDescriptor(pn.prototype,"updateBitrateLimit"),pn.prototype),Tt(pn.prototype,"remoteMediaSsrcChanged",[_o],Object.getOwnPropertyDescriptor(pn.prototype,"remoteMediaSsrcChanged"),pn.prototype),pn);function _o(t,r,s){const a=t[r];if(typeof a!="function")throw new Error("Cannot use mutex on object property.");return s.value=async function(){const c=this.mutex,u=await c.lock("From P2PChannel.".concat(r));try{for(var h=arguments.length,m=new Array(h),y=0;y<h;y++)m[y]=arguments[y];return await a.apply(this,m)}finally{u()}},s}function j9(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}function B9(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?j9(Object(s),!0).forEach(function(a){K(t,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):j9(Object(s)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))})}return t}const zge=Date.now(),Gge=20,k2=new Map,WP=new Map;async function W9(t){const r=k2.get(t),s=Array.isArray(r)&&r[r.length-1],a=WP.get(t);if(!s)return void(a.isSyncing=!1);const c={uid:s.uid,payload:s.payload};a.firstRecvTs===0&&(a.firstRecvTs=s.recvTs,a.firstSendTs=s.sendTs);const u=s.sendTs-a.firstSendTs,h=u-(Date.now()-a.firstRecvTs);h>0&&(a.firstRecvTs=Date.now()-u);let m=s.mediaDelay+h;m<=0?(r.pop(),z9(s.context,c),m=0):m=Math.min(m,Gge),setTimeout(()=>r.length&&W9(t),m)}function z9(t,r){t.safeEmit(yn.STREAM_MESSAGE,r.uid,r.payload),t.onStreamMessage&&t.onStreamMessage(r)}function Hge(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,s=arguments.length>2?arguments[2]:void 0;if(!t.syncWithAudio)return z9(s,{uid:t.uid,payload:t.payload});const a="".concat(s.id,"-").concat(t.uid),c=k2.get(a)||[],u=c.findIndex(v=>t.sendTs>=v.sendTs),h=B9(B9({},t),{},{context:s,mediaDelay:r,recvTs:Date.now()});u===-1?c.push(h):c.splice(u,0,h),k2.set(a,c);let m=!1;var y;WP.has(a)?m=!((y=WP.get(a))===null||y===void 0||!y.isSyncing):WP.set(a,{isSyncing:m,firstRecvTs:0,firstSendTs:0}),m||W9(a)}const $ge=Nn().name;function G9(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}function H9(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?G9(Object(s),!0).forEach(function(a){K(t,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):G9(Object(s)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))})}return t}const fS="websdk_ng_cache_parameter",Kge=oe("MAX_PRELOAD_ASYNC_LENGTH"),qge=1e4,ty=new Map,ny=[];let N2=null,D2=0,x2=0;const zP=new Map,Yge=function(t,r){const s=[];let a=0;const c=async()=>{const u=s.shift();u&&await u(),s.length>0&&a<r?c():a--};return async function(){for(var u=arguments.length,h=new Array(u),m=0;m<u;m++)h[m]=arguments[m];return new dt(async(y,v)=>{s.push(async()=>{try{const S=await t(...h);y(S)}catch(S){v(S)}}),a<r&&(a++,c())})}}($9,Kge),L2=la.CancelToken.source();async function $9(t,r,s,a,c,u){try{if(!oe("ENABLE_PRELOAD"))return;if(!Vn().supportWebCrypto)return void Fm(()=>{x.warn("Your browser does not support preloading, this feature  be run in a secure environment")},"preload_webcrypto_not_supported");if(!s&&s!==null)throw new Le(te.INVALID_PARAMS,"Invalid token: ".concat(s,". If you don not use token, set it to null"));s&&fs(s,"token",1,2047),fs(t,"appid",1,2047),EP(r),a&&vP(a);const h=j_();x.debug("preload channel ".concat(r,", uid is ").concat(a));const m={appId:t,cname:r,token:s||t,uid:typeof a!="string"?a:null,sid:h,proxyServer:c};let y,v;typeof a=="string"?(m.stringUid=a,[v,y]=await dt.all([kge(a,{sid:h,appId:t},L2.token),p9(H9(H9({},m),{},{token:s||t,uid:0}),L2.token)]),m.uid=v.uid,y.gatewayInfo.uid=m.uid,y.gatewayInfo.res.uid=m.uid):(u&&(m.stringUid=u),y=await p9(m,L2.token));const S={sid:h,appId:t,cname:r,token:s||t,uid:m.stringUid||a,intUid:m.uid||y.gatewayInfo.uid,stringUid:m.stringUid,ts:Date.now(),sua:v,ap:y};await async function(R){let P;try{R.uid&&q9({appId:R.appId,cname:R.cname,token:R.token,uid:R.uid,stringUid:R.stringUid});const N=Q9(R),G=await async function(j,X){try{const ee=await window.crypto.subtle.importKey("raw",V8(X),"AES-GCM",!1,["encrypt"]),he=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:new Uint8Array(1)},ee,F_(window.btoa(JSON.stringify(j))));return jm(new Uint8Array(he))}catch{return}}(R,R.token||R.appId);if(!G)return;P=J9(fS);const F=P?JSON.parse(P):[];F.push({[N]:G}),F.length>oe("AP_CACHE_NUM")&&F.shift(),GP(fS,JSON.stringify(F))}catch(N){x.warn("Error caching server parameters:",N.message),GP(fS,"")}}(S),D2++}catch(h){throw x2++,function(m){N2||(N2=window.setTimeout(()=>{let v="";zP.forEach((S,R)=>{v+="".concat(R,": ").concat(S," ;")}),It.reportApiInvoke(null,{name:Ai.PRELOAD,options:{success:D2,failed:x2,err:v}}).onError(m),D2=0,x2=0,zP.clear(),N2=null},qge));const y=zP.get(m.code)||0;zP.set(m.code,y+1)}(h),h}}async function K9(t){try{if(oe("AP_REQUEST_DETAIL")||oe("ENABLE_ROLE_SELECT_EDGE"))return;const r=q9(t);if(!r||t.cloudProxyServer!=="disabled")return;const s=await async function(a,c){try{const u=await window.crypto.subtle.importKey("raw",V8(c),"AES-GCM",!1,["decrypt"]),h=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:new Uint8Array(1)},u,F_(a));return JSON.parse(window.atob(jm(new Uint8Array(h))))}catch{return}}(r,t.token||t.appId);if(!s||!function(a,c){return a.cname===c.cname&&a.appId===c.appId&&a.token===c.token?c.stringUid?a.stringUid===c.stringUid:typeof c.uid=="number"?a.uid===c.uid:a.uid==c.uid:!1}(s,t))return;if(s&&Date.now()-s.ts<oe("AP_CACHE_LIFETIME"))return s}catch(r){x.warn("Error get preloadInfo",r.message)}}function q9(t){let r;try{if(r=J9(fS),!r)return;const s=JSON.parse(r),a=Q9(t),c=function(h,m){for(let y=h.length-1;y>=0;y--)if(m(h[y]))return y;return-1}(s,h=>a in h);if(c===-1)return;const u=s.splice(c,1)[0];return GP(fS,JSON.stringify(s)),u[a]}catch(s){x.warn("Error delete preload info: ".concat(r),s.message),GP(fS,"")}}function M2(t){if(t){let r=ty.get(t);r&&(window.clearTimeout(r),r=null,ty.delete(t)),ot(ny).call(ny,t)||t.cloudProxyServer!=="disabled"||ny.push(t)}if(ty.size<oe("AP_CACHE_NUM")&&ny.length>0){const r=ny.shift();ty.set(r,window.setTimeout(async()=>{const{appId:s,cname:a,token:c,stringUid:u,uid:h,proxyServer:m}=r;try{await Yge(s,a,c,h,m,u),ty.has(r)&&M2(r)}catch(y){x.warn("update preload failed",y.message),Y9(r)}},oe("AP_UPDATE_INTERVAL")))}}function Y9(t){const r=ny.indexOf(t);r!==-1&&ny.splice(r,1);let s=ty.get(t);s&&(window.clearTimeout(s),s=null,ty.delete(t),M2())}function X9(t,r){const s=t.sua,a=t.ap;r&&s&&It.reqUserAccount(t.sid,{lts:s.requestTime,elapse:s.elapse,success:!0,serverAddr:s.url,stringUid:r,uid:t.intUid,errorCode:null,extend:s.req}),It.reportResourceTiming(t.ap.url,t.sid),It.joinWebProxyAP(t.sid,{lts:a.requestTime,elapse:a.elapse,sucess:1,apServerAddr:a.url,turnServerAddrList:a.proxyInfo.addresses.map(c=>c.ip).join(","),eventType:"disabled",unilbsServerIds:[Ei.CHOOSE_SERVER,Ei.CLOUD_PROXY_FALLBACK].toString()}),It.joinChooseServer(t.sid,{lts:a.requestTime,elapse:a.elapse,succ:!0,csAddr:a.url,opid:a.opid,serverList:a.gatewayInfo.gatewayAddrs.map(c=>c.address),ec:null,cid:a.gatewayInfo.cid.toString(),uid:a.gatewayInfo.uid.toString(),csIp:a.gatewayInfo.csIp,unilbsServerIds:[Ei.CHOOSE_SERVER].toString(),isHttp3:a.isHttp3})}function J9(t){return window.atob(window.localStorage.getItem(t)||"")}function GP(t,r){window.localStorage.setItem(t,window.btoa(r))}function Q9(t){let r="".concat(t.appId,"_").concat(t.cname);return typeof t.uid=="string"&&(r+="_s_".concat(t.uid)),typeof t.uid=="number"&&(r+="_".concat(t.uid)),t.token&&(r+="_".concat(t.token)),H8(r)}function Xge(t){let r=function(){const s=Zge.pop();return s?(s.offset=s.limit=0,s):{bytes:new Uint8Array(64),offset:0,limit:0}}();return function(s,a){let c=s.appId;c!==void 0&&(bi(a,10),Xm(a,c));let u=s.cid;u!==void 0&&(bi(a,16),bi(a,u));let h=s.cname;h!==void 0&&(bi(a,26),Xm(a,h));let m=s.deviceId;m!==void 0&&(bi(a,34),Xm(a,m));let y=s.elapse;y!==void 0&&(bi(a,40),Jm(a,y));let v=s.fileSize;v!==void 0&&(bi(a,48),Jm(a,pS(v)));let S=s.height;S!==void 0&&(bi(a,56),Jm(a,pS(S)));let R=s.jpg;R!==void 0&&(bi(a,66),bi(a,R.length),e7(a,R));let P=s.networkType;P!==void 0&&(bi(a,72),Jm(a,pS(P)));let N=s.osType;N!==void 0&&(bi(a,80),Jm(a,pS(N)));let G=s.requestId;G!==void 0&&(bi(a,90),Xm(a,G));let F=s.sdkVersion;F!==void 0&&(bi(a,98),Xm(a,F));let j=s.sequence;j!==void 0&&(bi(a,104),Jm(a,pS(j)));let X=s.sid;X!==void 0&&(bi(a,114),Xm(a,X));let ee=s.timestamp;ee!==void 0&&(bi(a,120),Jm(a,ee));let he=s.uid;he!==void 0&&(bi(a,128),bi(a,he));let Se=s.vid;Se!==void 0&&(bi(a,136),bi(a,Se));let Te=s.width;Te!==void 0&&(bi(a,144),Jm(a,pS(Te)));let ye=s.service;ye!==void 0&&(bi(a,152),bi(a,ye));let Ne=s.callbackData;Ne!==void 0&&(bi(a,162),bi(a,Ne.length),e7(a,Ne));let Ye=s.ticket;Ye!==void 0&&(bi(a,170),Xm(a,Ye));let ht=s.vendorConfigs;ht!==void 0&&(bi(a,178),Xm(a,ht))}(t,r),function(s){let a=s.bytes,c=s.limit;return a.length===c?a:a.subarray(0,c)}(r)}function Jge(t){return function(s){let a={};e:for(;!e_e(s);){let c=KT(s);switch(c>>>3){case 0:break e;case 1:a.code=KT(s);break;case 2:a.msg=t7(s,KT(s));break;case 3:a.requestId=t7(s,KT(s));break;case 4:a.timestamp=t_e(s,!1);break;default:Qge(s,7&c)}}return a}({bytes:r=t,offset:0,limit:r.length});var r}function Qge(t,r){switch(r){case 0:for(;128&Tu(t););break;case 2:U2(t,KT(t));break;case 5:U2(t,4);break;case 1:U2(t,8);break;default:throw new Error("Unimplemented type: "+r)}}function pS(t){return{low:t|=0,high:t>>31,unsigned:t>=0}}let Zge=[];function U2(t,r){if(t.offset+r>t.limit)throw new Error("Skip past limit");t.offset+=r}function e_e(t){return t.offset>=t.limit}function HP(t,r){let s=t.bytes,a=t.offset,c=t.limit,u=a+r;if(u>s.length){let h=new Uint8Array(2*u);h.set(s),t.bytes=h}return t.offset=u,u>c&&(t.limit=u),a}function Z9(t,r){let s=t.offset;if(s+r>t.limit)throw new Error("Read past limit");return t.offset+=r,s}function e7(t,r){let s=HP(t,r.length);t.bytes.set(r,s)}function t7(t,r){let s=Z9(t,r),a=String.fromCharCode,c=t.bytes,u="",h="";for(let m=0;m<r;m++){let y,v,S,R,P=c[m+s];(128&P)==0?h+=a(P):(224&P)==192?m+1>=r?h+=u:(y=c[m+s+1],(192&y)!=128?h+=u:(R=(31&P)<<6|63&y,R<128?h+=u:(h+=a(R),m++))):(240&P)==224?m+2>=r?h+=u:(y=c[m+s+1],v=c[m+s+2],(49344&(y|v<<8))!=32896?h+=u:(R=(15&P)<<12|(63&y)<<6|63&v,R<2048||R>=55296&&R<=57343?h+=u:(h+=a(R),m+=2))):(248&P)==240?m+3>=r?h+=u:(y=c[m+s+1],v=c[m+s+2],S=c[m+s+3],(12632256&(y|v<<8|S<<16))!=8421504?h+=u:(R=(7&P)<<18|(63&y)<<12|(63&v)<<6|63&S,R<65536||R>1114111?h+=u:(R-=65536,h+=a(55296+(R>>10),56320+(1023&R)),m+=3))):h+=u}return h}function Xm(t,r){let s=r.length,a=0;for(let h=0;h<s;h++){let m=r.charCodeAt(h);m>=55296&&m<=56319&&h+1<s&&(m=(m<<10)+r.charCodeAt(++h)-56613888),a+=m<128?1:m<2048?2:m<65536?3:4}bi(t,a);let c=HP(t,a),u=t.bytes;for(let h=0;h<s;h++){let m=r.charCodeAt(h);m>=55296&&m<=56319&&h+1<s&&(m=(m<<10)+r.charCodeAt(++h)-56613888),m<128?u[c++]=m:(m<2048?u[c++]=m>>6&31|192:(m<65536?u[c++]=m>>12&15|224:(u[c++]=m>>18&7|240,u[c++]=m>>12&63|128),u[c++]=m>>6&63|128),u[c++]=63&m|128)}}function Tu(t){return t.bytes[Z9(t,1)]}function n7(t,r){let s=HP(t,1);t.bytes[s]=r}function KT(t){let r,s=0,a=0;do r=Tu(t),s<32&&(a|=(127&r)<<s),s+=7;while(128&r);return a}function bi(t,r){for(r>>>=0;r>=128;)n7(t,127&r|128),r>>>=7;n7(t,r)}function t_e(t,r){let s,a=0,c=0,u=0;return s=Tu(t),a=127&s,128&s&&(s=Tu(t),a|=(127&s)<<7,128&s&&(s=Tu(t),a|=(127&s)<<14,128&s&&(s=Tu(t),a|=(127&s)<<21,128&s&&(s=Tu(t),c=127&s,128&s&&(s=Tu(t),c|=(127&s)<<7,128&s&&(s=Tu(t),c|=(127&s)<<14,128&s&&(s=Tu(t),c|=(127&s)<<21,128&s&&(s=Tu(t),u=127&s,128&s&&(s=Tu(t),u|=(127&s)<<7))))))))),{low:a|c<<28,high:c>>>4|u<<24,unsigned:r}}function Jm(t,r){let s=r.low>>>0,a=(r.low>>>28|r.high<<4)>>>0,c=r.high>>>24,u=c===0?a===0?s<16384?s<128?1:2:s<1<<21?3:4:a<16384?a<128?5:6:a<1<<21?7:8:c<128?9:10,h=HP(t,u),m=t.bytes;switch(u){case 10:m[h+9]=c>>>7&1;case 9:m[h+8]=u!==9?128|c:127&c;case 8:m[h+7]=u!==8?a>>>21|128:a>>>21&127;case 7:m[h+6]=u!==7?a>>>14|128:a>>>14&127;case 6:m[h+5]=u!==6?a>>>7|128:a>>>7&127;case 5:m[h+4]=u!==5?128|a:127&a;case 4:m[h+3]=u!==4?s>>>21|128:s>>>21&127;case 3:m[h+2]=u!==3?s>>>14|128:s>>>14&127;case 2:m[h+1]=u!==2?s>>>7|128:s>>>7&127;case 1:m[h]=u!==1?128|s:127&s}}const r7={},i7={},$P=4294967296,n_e=$P*$P,r_e=n_e/2;o7(0,!0);const s7=o7(0),i_e=qT(0,-2147483648,!1),s_e=qT(-1,2147483647,!1);function o7(t,r){let s,a,c;return r?(c=0<=(t>>>=0)&&t<256)&&(a=i7[t],a)?a:(s=qT(t,0,!0),c&&(i7[t]=s),s):(c=-128<=(t|=0)&&t<128)&&(a=r7[t],a)?a:(s=qT(t,t<0?-1:0,!1),c&&(r7[t]=s),s)}function qT(t,r,s){return{low:0|t,high:0|r,unsigned:!!s}}function a7(t,r){if(isNaN(t))return s7;{if(t<=-9223372036854776e3)return i_e;if(t+1>=r_e)return s_e}return t<0?s7:qT(t%$P|0,t/$P|0,r)}function c7(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}class V2 extends Ur{get connectionState(){return this._connectionState}set connectionState(r){if(this._connectionState===r)return;const s=this._connectionState;this._connectionState=r,this.emit(Sd.CONNECTION_STATE_CHANGE,r,s)}get quality(){return this._quality}set quality(r){this._quality=r>1?1:r<.1?.1:r,this._qualityTimer&&(window.clearTimeout(this._qualityTimer),this._qualityTimer=null),this._quality>=1||(this._qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this._qualityRatio},6e4))}constructor(r){var s;super(),K(this,"name","AgoraRTCImageModeration"),K(this,"_connectionState",Il.CONNECTING),K(this,"_sequence",0),K(this,"_moderationStartTime",void 0),K(this,"_workerConnection",void 0),K(this,"_workerMessageLengthLimit",void 0),K(this,"_qualityRatio",void 0),K(this,"_connectInfo",void 0),K(this,"_cancelTokenSource",la.CancelToken.source()),K(this,"_retryConfig",void 0),K(this,"_moderationInterval",void 0),K(this,"_moderationTimer",null),K(this,"_moderationMode",1),K(this,"_quality",1),K(this,"_qualityTimer",null),K(this,"_ticket",void 0),K(this,"_moderationIntervalMinimum",void 0),K(this,"_uploadFailedNum",0),K(this,"_uploadNum",0),K(this,"_uploadTimer",null),K(this,"_extraInfo",void 0),K(this,"_vendor",""),K(this,"_encoder",new TextEncoder),K(this,"_moderationId",void 0),K(this,"inspectImage",()=>{if(this.connectionState!==Il.CONNECTED)throw new Oe(te.OPERATION_ABORTED,"image moderation service connection status is ".concat(this.connectionState));this._moderationTimer&&(window.clearInterval(this._moderationTimer),this._moderationTimer=null),this._moderationTimer=window.setInterval(()=>{this.connectionState===Il.CONNECTED?this.requestToInspectImage():x.debug("[".concat(this._moderationId,"] Moderation State is not connected , "),this.connectionState)},this._moderationInterval<this._moderationIntervalMinimum?this._moderationIntervalMinimum:this._moderationInterval),this.requestToInspectImage()}),this._moderationId=dr(5,"image-moderation-"),this._workerMessageLengthLimit=oe("IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT"),this._moderationIntervalMinimum=oe("IMAGE_MODERATION_INTERVAL_MINIMUM"),this._moderationInterval=(s=r.interval)!==null&&s!==void 0?s:1e3,r.extraInfo&&(this._extraInfo=this._encoder.encode(r.extraInfo)),r.vendor&&(this._vendor=r.vendor),this._qualityRatio=oe("IMAGE_MODERATION_QUALITY_RATIO"),this._moderationStartTime=Number(Date.now()),this._workerConnection=new UT("worker-"+this._moderationId,Pi),this.on(Sd.STATE_CHANGE,(a,c)=>{x.debug("[".concat(this._moderationId,"] Moderation operation :").concat(rS[a]," ").concat(c||""))}),this.handleWorkerEvents()}async init(r,s){this.emit(Sd.STATE_CHANGE,rS.CONNECT_AP),this._connectInfo=r;const a=this._cancelTokenSource.token;return this._retryConfig=s,new dt((c,u)=>{this.on(Sd.CONNECTION_STATE_CHANGE,(h,m)=>{h===Il.CONNECTED&&c()}),this.requestAP(r,a,s).then(h=>{this.connectWorker(h)}).catch(h=>{u(h)})})}updateConfig(r){var s;this._moderationInterval=(s=r.interval)!==null&&s!==void 0?s:1e3,r.extraInfo&&(this._extraInfo=this._encoder.encode(r.extraInfo)),r.vendor&&(this._vendor=r.vendor),x.debug("[".concat(this._moderationId,"] updateConfig: ").concat(JSON.stringify(r))),this.connectionState===Il.CONNECTED&&this.inspectImage()}async requestAP(r,s,a){const c=oe("WEBCS_DOMAIN").map(y=>"https://".concat(y,"/api/v1")),u=await function(y,v,S,R){let{appId:P,areaCode:N,cname:G,sid:F,token:j,uid:X}=v;lS++;const ee="moderation_plugin",he={service_name:ee,json_body:JSON.stringify({appId:P,areaCode:N,cname:G,command:"allocateEdge",requestId:lS,seq:lS,sid:F,appToken:j,ts:Date.now(),uid:X+""})};let Se,Te,ye=y[0];return _d(async()=>{Se=Date.now();const Ne=await bd(ye,{data:he,cancelToken:S,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(Te=Date.now()-Se,Ne.code!==0){const mt=new Oe(te.UNEXPECTED_RESPONSE,"moderation plugin ap error, code"+Ne.code,{retry:!0,responseTime:Te});throw x.error(mt.toString()),mt}const Ye=JSON.parse(Ne.json_body);if(Ye.code!==200){const mt=new Oe(te.UNEXPECTED_RESPONSE,"moderation plugin ap error, code: ".concat(Ye.code,", reason: ").concat(Ye.reason),{code:Ye.code,responseTime:Te});throw x.error(mt.toString()),mt}if(!Ye.servers||!Array.isArray(Ye.servers)||Ye.servers.length===0){const mt=new Oe(te.UNEXPECTED_RESPONSE,"moderation plugin ap empty server",{code:Ye.code,responseTime:Te});throw x.error(mt.toString()),mt}if(!Ye.servers.some(mt=>!!mt.wss)){const mt=new Oe(te.UNEXPECTED_RESPONSE,"moderation plugin ap empty port",{code:Ye.code,responseTime:Te});throw x.error(mt.toString()),mt}const ht=oe("IMAGE_MODERATION_WORKER_HOST");return{addressList:Ye.servers.map(mt=>{let{address:Tn,wss:wn}=mt;if(Tn&&wn)return"wss://".concat(Tn.replace(/\./g,"-"),".").concat(ht,":").concat(wn,"/moderation")}).filter(mt=>!!mt),workerToken:Ye.workerToken,vid:Ye.vid,ticket:Ye.appTicket,responseTime:Te}},(Ne,Ye)=>(It.apworkerEvent(F,{success:!0,sc:200,serviceName:ee,responseDetail:JSON.stringify(Ne.addressList),firstSuccess:Ye===0,responseTime:Te,serverIp:y[Ye%y.length]}),!1),(Ne,Ye)=>(It.apworkerEvent(F,{success:!1,sc:Ne.data&&Ne.data.code||200,serviceName:ee,responseTime:Te,serverIp:y[Ye%y.length]}),!!(Ne.code!==te.OPERATION_ABORTED&&Ne.code!==te.UNEXPECTED_RESPONSE||Ne.data&&Ne.data.retry)&&(ye=y[(Ye+1)%y.length],!0)),R)}(c,r,s,a);this.emit(Sd.STATE_CHANGE,rS.AP_CONNECTED);const{addressList:h,ticket:m}=u;return this._ticket=m,h}async connectWorker(r){this.emit(Sd.STATE_CHANGE,rS.CONNECT_WORKER),await this._workerConnection.init(r,1e4)}handleWorkerEvents(){this._workerConnection.on(en.CONNECTED,async()=>{this.emit(Sd.STATE_CHANGE,rS.WORKER_CONNECTED,this._workerConnection.url),this.connectionState=Il.CONNECTED}),this._workerConnection.on(en.CLOSED,()=>{this.connectionState=Il.CLOSED}),this._workerConnection.on(en.FAILED,()=>{this.connectionState=Il.CLOSED}),this._workerConnection.on(en.RECONNECTING,()=>{this.connectionState=this.connectionState===Il.CONNECTED?Il.RECONNECTING:Il.CONNECTING}),this._workerConnection.on(en.ON_MESSAGE,async r=>{if(r.data instanceof ArrayBuffer){const s=Jge(new Uint8Array(r.data));oe("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&x.debug("[".concat(this._moderationId,"] Response message for worker of image moderation "),JSON.stringify(s)),this._uploadNum++,s.code===void 0||s.code===0||(this._uploadFailedNum++,x.error("[".concat(this._moderationId,"] Error response from worke, code is ").concat(s.code,", msg is ").concat(s.msg)),this._uploadTimer||(this._uploadTimer=window.setTimeout(()=>{It.reportApiInvoke(this._connectInfo.sid||null,{name:Ai.IMAGE_MODERATION_UPLOAD,options:[this._uploadFailedNum,this._uploadNum,s.code],tag:zr.TRACER}).onError(new Oe(te.IMAGE_MODERATION_UPLOAD_FAILED,s.msg)),this._uploadTimer=null},oe("IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL"))))}else x.error("[".concat(this._moderationId,"] Unexpected message type from worker"))}),this._workerConnection.on(en.WILL_RECONNECT,(r,s,a)=>{r==="recover"&&a(r),a("tryNext")}),this._workerConnection.on(en.REQUEST_NEW_URLS,(r,s)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(r).catch(s)})}static intToLong(r){return{low:r|=0,high:r>>31,unsigned:r>=0}}async requestToInspectImage(){const r=Hc(this,Sd.CLIENT_LOCAL_VIDEO_TRACK),s={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(r){if(!r.isPlaying)return void(oe("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&x.debug("Only the track being played can be inspected"));this._sequence++;const a=await this.generateRequestData(r,s);this._workerConnection.sendMessage(a,!0,!0)}else oe("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&x.debug("Only the track being published can be inspected")}async generateRequestData(r,s){let{appId:a,cname:c,cid:u,vid:h,sid:m,uid:y}=s;const v=Date.now(),S=await r.getCurrentFrameImage("image/jpeg",this.quality),R=await xz(S,a,c),P=this._sequence+"-"+u+"-"+y+"-"+v+"-"+dr(12,""),N={appId:a,cid:u,cname:c,deviceId:"",elapse:V2.intToLong(Number(v-this._moderationStartTime)),fileSize:S.buffer.byteLength,height:S.height,width:S.width,jpg:R,networkType:6,osType:7,requestId:P,sdkVersion:"4.23.2",sequence:this._sequence,sid:m,timestamp:a7(v),uid:y,vid:h,service:this._moderationMode,ticket:this._ticket,callbackData:this._extraInfo,vendorConfigs:this._vendor};this._extraInfo===void 0&&delete N.callbackData;const G=Xge(N);if(G.byteLength<this._workerMessageLengthLimit){if(oe("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")){const F=function(j){for(var X=1;X<arguments.length;X++){var ee=arguments[X]!=null?arguments[X]:{};X%2?c7(Object(ee),!0).forEach(function(he){K(j,he,ee[he])}):Object.getOwnPropertyDescriptors?Object.defineProperties(j,Object.getOwnPropertyDescriptors(ee)):c7(Object(ee)).forEach(function(he){Object.defineProperty(j,he,Object.getOwnPropertyDescriptor(ee,he))})}return j}({},N);delete F.jpg,x.debug("[".concat(this._moderationId,"] Request message for worker of image moderation service: "),JSON.stringify(F))}return G}{const F=this.quality*this._qualityRatio;return this.quality=F,await this.generateRequestData(r,{appId:a,cname:c,cid:u,vid:h,sid:m,uid:y})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=la.CancelToken.source(),this._workerConnection&&this._workerConnection.close(),this._moderationTimer&&window.clearInterval(this._moderationTimer),this._moderationTimer=null,this._uploadTimer&&window.clearTimeout(this._uploadTimer),this._uploadTimer=null,this.connectionState=Il.CLOSED,this.emit(Sd.STATE_CHANGE,rS.CLOSED)}}function l7(t){if(ir(t.interval,"interval",1e3,1/0),t&&t.extraInfo&&t.extraInfo.length>1024)throw new Oe(te.INVALID_PARAMS,"config.extraInfo length cannot exceed 1024 bytes");if(t&&t.vendor&&t.vendor.length>1024)throw new Oe(te.INVALID_PARAMS,"config.vendor length cannot exceed 1024 bytes")}const o_e={name:"ImageModeration",create:function(t){let{config:r}=t;return l7(r),new V2(r)}};var u7,d7,h7,f7,p7,m7,g7,_7,y7,E7,v7,S7,b7,T7,w7,C7,R7,I7,A7,P7,O7,k7,N7,D7,x7,L7,M7,U7,V7,F7,j7,B7,W7,z7,G7,H7,$7,K7,q7,Y7,X7,pt;function J7(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}function wu(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?J7(Object(s),!0).forEach(function(a){K(t,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):J7(Object(s)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))})}return t}js.setLogger(x);let a_e=(u7=Ft(),d7=Ft({argsMap:(t,r)=>{if(!Array.isArray(r)){if(!(r instanceof Yv))return[r];r=[r]}return r.map(s=>s?Object(s).toString():"null")}}),h7=Ft({argsMap:(t,r)=>(r||(r=[]),Array.isArray(r)||r.trackMediaType!==qv.DATA?(Array.isArray(r)||(r=[r]),r.map(s=>s.getTrackId())):[r.getChannelId()])}),f7=Ft({argsMap:(t,r,s,a)=>[typeof r=="object"?r.uid:r,s,a]}),p7=Ft({argsMap:(t,r,s)=>[r,s]}),m7=Ft({argsMap:(t,r)=>r.map(s=>{let{user:a,mediaType:c}=s;return[a==null?void 0:a.uid,c]})}),g7=Ft({argsMap:(t,r,s,a)=>[typeof r=="object"?r.uid:r,s,a]}),_7=Ft({argsMap:(t,r)=>r.map(s=>{let{user:a,mediaType:c}=s;return{uid:a==null?void 0:a.uid,mediaType:c}})}),y7=Ft(),E7=Ft(),v7=Ft(),S7=Ft(),b7=Ft(),T7=Ft(),w7=Ft(),C7=Ft(),R7=Ft(),I7=Ft(),A7=Ft(),P7=Ft(),O7=Ft(),k7=Ft(),N7=Ft(),D7=Ft({argsMap:(t,r)=>[r]}),x7=Ft(),L7=Ft(),M7=Ft(),U7=Ft(),V7=Ft(),F7=Ft(),j7=Ft(),B7=Ft(),W7=Ft({argsMap:(t,r)=>(Array.isArray(r)||(r=[r]),[JSON.stringify(r)])}),z7=Ft(),G7=Ft(),H7=Ft(),$7=Ft(),K7=Ft(),q7=Ft(),Y7=Ft({reportResult:!0}),X7=Ft(),pt=class extends Ur{get connectionState(){return this._gateway.state}get remoteUsers(){return this._users}get localTracks(){return this._p2pChannel.getAllTracks(!0)}get uid(){return this._uid}get channelName(){return this._channelName}get localDataChannels(){return this._p2pChannel.getAllDataChannels()}get mode(){return this._config.mode}get role(){var t;return((t=this._config)===null||t===void 0?void 0:t.role)||"audience"}get codec(){return this._config.codec}get audioCodec(){return this._config.audioCodec||"opus"}get isStringUID(){return!!this._joinInfo&&!!this._joinInfo.stringUid}get __className__(){return"Client"}constructor(t,r){let s;if(super(),K(this,"store",void 0),K(this,"_uid",void 0),K(this,"_channelName",void 0),K(this,"_uintUid",void 0),K(this,"_users",[]),K(this,"_config",void 0),K(this,"_clientId",void 0),K(this,"_appId",void 0),K(this,"_sessionId",null),K(this,"_key",void 0),K(this,"_rtmConfig",{}),K(this,"_joinInfo",void 0),K(this,"_gateway",void 0),K(this,"_statsCollector",void 0),K(this,"_configDistribute",void 0),K(this,"_leaveMutex",void 0),K(this,"_publishMutex",void 0),K(this,"_renewTokenMutex",void 0),K(this,"_subscribeMutex",void 0),K(this,"_encryptionMode","none"),K(this,"_encryptionSecret",null),K(this,"_encryptionSalt",null),K(this,"_encryptDataStream",!1),K(this,"_encryptDataStreamKey",null),K(this,"_encryptDataStreamIv",null),K(this,"_proxyServer",void 0),K(this,"_turnServer",{servers:[],mode:"auto"}),K(this,"_cloudProxyServerMode","disabled"),K(this,"_isDualStreamEnabled",!1),K(this,"_defaultStreamFallbackType",void 0),K(this,"_lowStreamParameter",void 0),K(this,"_streamFallbackTypeCacheMap",new Map),K(this,"_remoteStreamTypeCacheMap",new Map),K(this,"_axiosCancelSource",la.CancelToken.source()),K(this,"_audioVolumeIndicationInterval",void 0),K(this,"_networkQualityInterval",void 0),K(this,"_userOfflineTimeout",void 0),K(this,"_streamRemovedTimeout",void 0),K(this,"_liveTranscodeStreamingClient",void 0),K(this,"_liveRawStreamingClient",void 0),K(this,"_channelMediaRelayClient",void 0),K(this,"_networkQualitySensitivity","normal"),K(this,"_p2pChannel",void 0),K(this,"_useLocalAccessPoint",!1),K(this,"_setLocalAPVersion",void 0),K(this,"_joinAndNotLeaveYet",!1),K(this,"_numberOfJoinCount",0),K(this,"_remoteDefaultVideoStreamType",void 0),K(this,"_inspect",void 0),K(this,"_moderation",void 0),K(this,"_license",void 0),K(this,"_pendingPublishedUsers",[]),K(this,"ntpAlignErrorCount",0),K(this,"remoteInboundOffset",0),K(this,"_peerConnectionState",void 0),K(this,"_handleLocalTrackEnable",(c,u,h)=>{this.publish(c,!1).then(u).catch(h)}),K(this,"_handleLocalTrackDisable",(c,u,h)=>{this.unpublish(c).then(u).catch(h)}),K(this,"_handleUserOnline",c=>{if(oe("BLOCK_LOCAL_CLIENT")&&q_(c.uid,this.channelName))return void x.debug("[".concat(c.uid,"] will be ignored in local"));this.isStringUID&&typeof c.uid!="string"&&x.error("[".concat(this._clientId,"] StringUID is Mixed with UintUID"));const u=this._users.find(h=>h.uid===c.uid);if(u)u._trust_in_room_=!0,u._is_pre_created&&(u._is_pre_created=!1,this.safeEmit(yn.USER_JOINED,u));else{const h=new qm(c.uid,c.uint_id||c.uid);this._users.push(h),x.debug("[".concat(this._clientId,"] user online"),c.uid),this.safeEmit(yn.USER_JOINED,h)}}),K(this,"_handleUserOffline",c=>{if(oe("BLOCK_LOCAL_CLIENT")&&q_(c.uid,this.channelName))return;const u=this._users.find(h=>h.uid===c.uid);u&&(this._handleRemoveStream(c),this._handleRemoveDataChannels(c),u._audio_pre_subscribed||u._video_pre_subscribed?u._is_pre_created=!0:qA(this._users,u),this._remoteStreamTypeCacheMap.delete(u.uid),this._streamFallbackTypeCacheMap.delete(u.uid),x.debug("[".concat(this._clientId,"] user offline"),c.uid,"reason:",c.reason),this.safeEmit(yn.USER_LEAVED,u,c.reason))}),K(this,"_handleAddAudioOrVideoStream",(c,u,h,m,y,v,S)=>{if(oe("BLOCK_LOCAL_CLIENT")&&q_(u,this.channelName))return;const R=this._users.find(N=>N.uid===u);if(!R)return void x.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));x.debug("[".concat(this._clientId,"] stream added with uid ").concat(u,", type ").concat(c)),this.store.subscribe(R.uid,c,void 0,void 0,void 0,Date.now());const P=c==="audio"?R.hasAudio:R.hasVideo;R._uintid||(R._uintid=y||u),c==="audio"?R._trust_audio_stream_added_state_=!0:R._trust_video_stream_added_state_=!0,c==="audio"?(R._audio_added_=!0,h!==void 0&&(R._audioSSRC=h),m!==void 0&&(R._cname=m),v&&(R._audioOrtc=v)):(R._video_added_=!0,h!==void 0&&(R._videoSSRC=h),m!==void 0&&(R._cname=m),S!==void 0&&(R._rtxSsrcId=S),v&&(R._videoOrtc=v)),(c==="audio"?R.hasAudio:R.hasVideo)&&!P&&(x.info("[".concat(this._clientId,"] remote user ").concat(R.uid," published ").concat(c)),this.safeEmit(yn.USER_PUBLISHED,R,c)),c==="video"?It.onGatewayStream(this._sessionId,Xi.ON_ADD_VIDEO_STREAM,Nr.ON_ADD_VIDEO_STREAM,{peer:y||u,ssrc:R._videoSSRC}):It.onGatewayStream(this._sessionId,Xi.ON_ADD_AUDIO_STREAM,Nr.ON_ADD_AUDIO_STREAM,{peer:y||u,ssrc:R._audioSSRC}),this._p2pChannel.remoteMediaSsrcChanged(R,c,h).then(N=>{if(N&&(x.debug("[".concat(this._clientId,"] resubscribe ").concat(c," for user ").concat(R.uid," after rejoin because SSRC id changed.")),this._p2pChannel instanceof $T))return this._p2pChannel.unsubscribe(R,c,!0).then(()=>this._subscribe(R,c,!0).catch(G=>{x.error("[".concat(this._clientId,"] resubscribe error"),G.toString())}))}),this._p2pChannel.hasPendingRemoteMedia(R,c)&&(x.debug("[".concat(this._clientId,"] resubscribe ").concat(c," for user ").concat(R.uid," after reconnect.")),this._subscribe(R,c,!0).catch(N=>{x.error("[".concat(this._clientId,"] resubscribe error"),N.toString())}))}),K(this,"_handleRemoveStream",c=>{if(oe("BLOCK_LOCAL_CLIENT")&&q_(c.uid,this.channelName))return;const u=this._users.find(m=>m.uid===c.uid);if(!u)return void x.warning("[".concat(this._clientId,"] can not find target user!(on_remove_stream)"));x.debug("[".concat(this._clientId,"] stream removed with uid ").concat(c.uid));let h=()=>{};u.hasAudio&&u.hasVideo?h=()=>{x.info("[".concat(this._clientId,"] remote user ").concat(u.uid," unpublished audio track")),this.safeEmit(yn.USER_UNPUBLISHED,u,"audio"),x.info("[".concat(this._clientId,"] remote user ").concat(u.uid," unpublished video track")),this.safeEmit(yn.USER_UNPUBLISHED,u,"video")}:u.hasVideo?h=()=>{x.info("[".concat(this._clientId,"] remote user ").concat(u.uid," unpublished video track")),this.safeEmit(yn.USER_UNPUBLISHED,u,"video")}:u.hasAudio&&(h=()=>{x.info("[".concat(this._clientId,"] remote user ").concat(u.uid," unpublished audio track")),this.safeEmit(yn.USER_UNPUBLISHED,u,"audio")}),u._video_pre_subscribed||u._audio_pre_subscribed||(u._trust_audio_stream_added_state_=!0,u._trust_video_stream_added_state_=!0,u._audio_added_=!1,u._video_added_=!1,this._p2pChannel instanceof $T&&this._p2pChannel.unsubscribe(u).then(m=>{if(m)return this._gateway.unsubscribe(m,u.uid)}),u._audioSSRC=void 0,u._videoSSRC=void 0,u._audioOrtc=void 0,u._videoOrtc=void 0,u._rtxSsrcId=void 0),It.onGatewayStream(this._sessionId,Xi.ON_REMOVE_STREAM,Nr.ON_REMOVE_STREAM,{peer:c.uint_id||c.uid}),h()}),K(this,"_handleSetStreamLocalEnable",(c,u,h)=>{if(oe("BLOCK_LOCAL_CLIENT")&&q_(u,this.channelName))return;const m=this._users.find(S=>S.uid===u);if(!m)return void x.error("[".concat(this._clientId,"] can not find target user!(disable_local)"));x.debug("[".concat(this._clientId,"] local ").concat(c," ").concat(h?"enabled":"disabled"," with uid ").concat(u));const y=c==="audio"?m.hasAudio:m.hasVideo;if(c==="audio"){m._trust_audio_enabled_state_=!0;const S=m._audio_enabled_;if(m._audio_enabled_=h,m._audio_enabled_===S)return;{const R=m._audio_enabled_?"enable-local-audio":"disable-local-audio";x.debug("[".concat(this._clientId,"] user-info-updated, uid: ").concat(u,", msg: ").concat(R)),this.safeEmit(yn.USER_INFO_UPDATED,u,R)}}else{m._trust_video_enabled_state_=!0;const S=m._video_enabled_;if(m._video_enabled_=h,m._video_enabled_===S)return;{const R=m._video_enabled_?"enable-local-video":"disable-local-video";x.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(u,", msg: ").concat(R)),this.safeEmit(yn.USER_INFO_UPDATED,u,R)}}const v=c==="audio"?m.hasAudio:m.hasVideo;return y!==v?!y&&v?(x.info("[".concat(this._clientId,"] remote user ").concat(u," published ").concat(c)),void this.safeEmit(yn.USER_PUBLISHED,m,c)):(c==="video"&&m._videoTrack&&m._videoTrack._destroy(),c==="audio"&&m._audioTrack,this._p2pChannel.muteRemote(m,c),x.info("[".concat(this._clientId,"] remote user ").concat(u," unpublished ").concat(c)),void this.safeEmit(yn.USER_UNPUBLISHED,m,c)):void 0}),K(this,"_handleMuteStream",(c,u,h)=>{if(oe("BLOCK_LOCAL_CLIENT")&&q_(c,this.channelName))return;x.debug("[".concat(this._clientId,"] receive mute message"),c,u,h);const m=this._users.find(S=>S.uid===c);if(!m)return void x.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(c));const y=u==="audio"?m.hasAudio:m.hasVideo;if(u==="audio"){m._trust_audio_mute_state_=!0;const S=m._audio_muted_;if(m._audio_muted_=h,m._audio_muted_===S)return;{const R=m._audio_muted_?"mute-audio":"unmute-audio";x.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(c,", msg: ").concat(R)),this.safeEmit(yn.USER_INFO_UPDATED,c,R)}}else{m._trust_video_mute_state_=!0;const S=m._video_muted_;if(m._video_muted_=h,m._video_muted_===S)return;{const R=m._video_muted_?"mute-video":"unmute-video";x.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(c,", msg: ").concat(R)),this.safeEmit(yn.USER_INFO_UPDATED,c,R)}}const v=u==="audio"?m.hasAudio:m.hasVideo;if(y!==v){if(!y&&v)return(u==="audio"?m._audioSSRC:m._videoSSRC)?(x.info("[".concat(this._clientId,"] remote user ").concat(c," published ").concat(u)),void this.safeEmit(yn.USER_PUBLISHED,m,u)):void x.warning("[".concat(this._clientId,"] remote user ").concat(c," receive ").concat(u," unmute message  before add stream message, ").concat(u," SSRC doesn't exist yet."));u==="video"&&m._videoTrack&&!m._video_pre_subscribed&&m._videoTrack._destroy(),u==="audio"&&m._audioTrack,this._p2pChannel.muteRemote(m,u),x.info("[".concat(this._clientId,"] remote user ").concat(c," unpublished ").concat(u)),this.safeEmit(yn.USER_UNPUBLISHED,m,u)}}),K(this,"_handleP2PLost",async c=>{x.debug("[".concat(this._clientId,"] receive p2p lost"),c),parseInt(c.p2pid,10)===this.store.p2pId?await this._p2pChannel.requestReconnect():x.warning("[".concat(this._clientId,"] P2PLost stream not found"),c)}),K(this,"_handleTokenWillExpire",()=>{x.debug("[".concat(this._clientId,"] received message onTokenPrivilegeWillExpire")),this.safeEmit(yn.ON_TOKEN_PRIVILEGE_WILL_EXPIRE)}),K(this,"_handleBeforeUnload",c=>{c.type==="beforeunload"&&c.returnValue!==void 0&&c.returnValue!==""||(this.leave(),x.info("[".concat(this._clientId,"] auto leave onbeforeunload or pagehide")))}),K(this,"_handleUpdateNetworkQuality",()=>{if(this._networkQualitySensitivity==="normal")return;if(navigator&&navigator.onLine!==void 0&&!navigator.onLine)return void this.safeEmit(yn.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6});const c={downlinkNetworkQuality:0,uplinkNetworkQuality:0};c.uplinkNetworkQuality=this._p2pChannel.getUplinkNetworkQuality(),c.downlinkNetworkQuality=this._p2pChannel.getDownlinkNetworkQuality(),this.safeEmit(yn.NETWORK_QUALITY,c)}),K(this,"_handleP2PAddAudioOrVideoStream",(c,u,h,m)=>{const y=this._users.find(S=>S.uid===u);if(!y)return void x.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));x.debug("[".concat(this._clientId,"] stream added with uid ").concat(u,", type ").concat(c)),this.store.subscribe(y.uid,c,void 0,void 0,void 0,Date.now());const v=c==="audio"?y.hasAudio:y.hasVideo;c==="audio"?y._trust_audio_stream_added_state_=!0:y._trust_video_stream_added_state_=!0,c==="audio"?(y._audio_added_=!0,h!==void 0&&(y._audioSSRC=h),m!==void 0&&(y._audioMid=m)):(y._video_added_=!0,h!==void 0&&(y._videoSSRC=h),m!==void 0&&(y._videoMid=m)),(c==="audio"?y.hasAudio:y.hasVideo)&&!v&&(x.info("[".concat(this._clientId,"] remote user ").concat(y.uid," published ").concat(c)),this.safeEmit(yn.USER_PUBLISHED,y,c)),this._p2pChannel.hasPendingRemoteMedia(y,c)&&(x.debug("[".concat(this._clientId,"] resubscribe ").concat(c," for user ").concat(y.uid," after reconnect.")),this._subscribe(y,c,!0).catch(S=>{x.error("[".concat(this._clientId,"] resubscribe error"),S.toString())}))}),this._config=t,this._clientId=r||dr(5,"client-"),this.store=new class{constructor(c,u,h,m){Yt(this,"state",void 0),this.state={codec:c,audioCodec:u,mode:h,clientId:m,sessionId:null,p2pId:0,dcId:0,pubId:0,subId:0,avoidJoinStart:0,keyMetrics:{publish:[],subscribe:[]},joinChannelServiceRecords:[],cloudProxyServerMode:"disabled",useP2P:!1,p2pTransport:B_.Default,hasStartJoinChannel:!1,isABTestSuccess:!1}}dispatch(c){this.state=function(u,h){switch(h.type){case En.SET_SESSION_ID:return gt(gt({},u),{},{sessionId:h.sessionId});case En.SET_P2P_ID:return gt(gt({},u),{},{p2pId:h.p2pId});case En.SET_UID:return gt(gt({},u),{},{uid:h.uid});case En.SET_INT_UID:return gt(gt({},u),{},{intUid:h.intUid});case En.SET_PUB_ID:return gt(gt({},u),{},{pubId:h.pubId});case En.KEY_METRIC_CLIENT_CREATED:return gt(gt({},u),{},{keyMetrics:gt(gt({},u.keyMetrics),{},{clientCreated:h.metric})});case En.KEY_METRIC_JOIN_START:return gt(gt({},u),{},{keyMetrics:gt(gt({},u.keyMetrics),{},{joinStart:h.metric})});case En.AVOID_JOIN_START:return gt(gt({},u),{},{avoidJoinStart:h.avoidJoinStart});case En.KEY_METRIC_JOIN_END:return gt(gt({},u),{},{keyMetrics:gt(gt({},u.keyMetrics),{},{joinEnd:h.metric})});case En.KEY_METRIC_REQUEST_AP_START:return gt(gt({},u),{},{keyMetrics:gt(gt({},u.keyMetrics),{},{requestAPStart:h.metric})});case En.KEY_METRIC_REQUEST_AP_END:return gt(gt({},u),{},{keyMetrics:gt(gt({},u.keyMetrics),{},{requestAPEnd:h.metric})});case En.KEY_METRIC_JOIN_GATEWAY_START:return gt(gt({},u),{},{keyMetrics:gt(gt({},u.keyMetrics),{},{joinGatewayStart:h.metric})});case En.KEY_METRIC_JOIN_GATEWAY_END:return gt(gt({},u),{},{keyMetrics:gt(gt({},u.keyMetrics),{},{joinGatewayEnd:h.metric})});case En.KEY_METRIC_PEER_CONNECTION_START:return gt(gt({},u),{},{keyMetrics:gt(gt({},u.keyMetrics),{},{peerConnectionStart:h.metric})});case En.KEY_METRIC_PEER_CONNECTION_END:return gt(gt({},u),{},{keyMetrics:gt(gt({},u.keyMetrics),{},{peerConnectionEnd:h.metric})});case En.KEY_METRIC_DESCRIPTION_START:return gt(gt({},u),{},{keyMetrics:gt(gt({},u.keyMetrics),{},{descriptionStart:h.metric})});case En.KEY_METRIC_SIGNAL_CHANNEL_OPEN:return gt(gt({},u),{},{keyMetrics:gt(gt({},u.keyMetrics),{},{signalChannelOpen:h.metric})});case En.KEY_METRIC_ICE_CONNECTION_END:return gt(gt({},u),{},{keyMetrics:gt(gt({},u.keyMetrics),{},{iceConnectionEnd:h.metric})});case En.KEY_METRIC_PUBLISH:{const m=u.keyMetrics.publish,y=m.findIndex(v=>v.trackId===h.metric.trackId);return y!==-1?(m[y]=gt(gt({},m[y]),h.metric),gt(gt({},u),{},{keyMetrics:gt(gt({},u.keyMetrics),{},{publish:[...m]})})):gt(gt({},u),{},{keyMetrics:gt(gt({},u.keyMetrics),{},{publish:[...u.keyMetrics.publish,h.metric]})})}case En.KEY_METRIC_SUBSCRIBE:{const m=u.keyMetrics.subscribe,y=m.findIndex(v=>v.userId===h.metric.userId&&v.type===h.metric.type);return y!==-1?(m[y]=gt(gt({},m[y]),h.metric),gt(gt({},u),{},{keyMetrics:gt(gt({},u.keyMetrics),{},{subscribe:[...m]})})):gt(gt({},u),{},{keyMetrics:gt(gt({},u.keyMetrics),{},{subscribe:[...u.keyMetrics.subscribe,h.metric]})})}case En.SET_CLOUD_PROXY_SERVER_MODE:return u.cloudProxyServerMode=h.mode,u;case En.RECORD_JOIN_CHANNEL_SERVICE:return typeof h.index!="number"?u.joinChannelServiceRecords=[...u.joinChannelServiceRecords,h.record]:(u.joinChannelServiceRecords[h.index]=gt(gt({},u.joinChannelServiceRecords[h.index]),h.record),u.joinChannelServiceRecords=[...u.joinChannelServiceRecords]),u;case En.RESET_JOIN_CHANNEL_SERVICE_RECORDS:return u.joinChannelServiceRecords=[],u;case En.RESET_KEY_METRICS:return u.keyMetrics={publish:[],subscribe:[]},u;case En.SET_USE_P2P:return gt(gt({},u),{},{useP2P:h.val});case En.SET_TRANSPORT_TYPE:return gt(gt({},u),{},{p2pTransport:h.val});default:return u}}(this.state,c)}set sessionId(c){this.dispatch({type:En.SET_SESSION_ID,sessionId:c})}get sessionId(){return this.state.sessionId}set cid(c){this.state.cid=c}get cid(){return this.state.cid}set codec(c){this.state.codec=c}get codec(){return this.state.codec}get mode(){return this.state.mode}get audioCodec(){return this.state.audioCodec}get clientId(){return this.state.clientId}set p2pId(c){this.dispatch({type:En.SET_P2P_ID,p2pId:c})}get p2pId(){return this.state.p2pId}set dcId(c){this.dispatch({type:En.SET_DC_ID,dcId:c})}get dcId(){return this.state.dcId}set uid(c){this.dispatch({type:En.SET_UID,uid:c})}get uid(){return this.state.uid}set intUid(c){this.dispatch({type:En.SET_INT_UID,intUid:c})}get intUid(){return this.state.intUid}set pubId(c){this.dispatch({type:En.SET_PUB_ID,pubId:c})}get pubId(){return this.state.pubId}set cloudProxyServerMode(c){this.dispatch({type:En.SET_CLOUD_PROXY_SERVER_MODE,mode:c})}get cloudProxyServerMode(){return this.state.cloudProxyServerMode}set useP2P(c){this.dispatch({type:En.SET_USE_P2P,val:c})}get useP2P(){return this.state.useP2P}set p2pTransport(c){this.dispatch({type:En.SET_TRANSPORT_TYPE,val:c})}get p2pTransport(){return this.state.p2pTransport}set hasStartJoinChannel(c){this.state.hasStartJoinChannel=c}get hasStartJoinChannel(){return this.state.hasStartJoinChannel}set isABTestSuccess(c){this.state.isABTestSuccess=c}get isABTestSuccess(){return this.state.isABTestSuccess}clientCreated(){this.dispatch({type:En.KEY_METRIC_CLIENT_CREATED,metric:Date.now()})}joinStart(){this.dispatch({type:En.KEY_METRIC_JOIN_START,metric:Date.now()})}joinEnd(){this.dispatch({type:En.KEY_METRIC_JOIN_END,metric:Date.now()})}requestAPStart(){this.dispatch({type:En.KEY_METRIC_REQUEST_AP_START,metric:Date.now()})}requestAPEnd(){this.dispatch({type:En.KEY_METRIC_REQUEST_AP_END,metric:Date.now()})}joinGatewayStart(){this.dispatch({type:En.KEY_METRIC_JOIN_GATEWAY_START,metric:Date.now()})}joinGatewayEnd(){this.dispatch({type:En.KEY_METRIC_JOIN_GATEWAY_END,metric:Date.now()})}peerConnectionStart(){this.dispatch({type:En.KEY_METRIC_PEER_CONNECTION_START,metric:Date.now()})}peerConnectionEnd(){this.dispatch({type:En.KEY_METRIC_PEER_CONNECTION_END,metric:Date.now()})}descriptionStart(){this.dispatch({type:En.KEY_METRIC_DESCRIPTION_START,metric:Date.now()})}signalChannelOpen(){this.dispatch({type:En.KEY_METRIC_SIGNAL_CHANNEL_OPEN,metric:Date.now()})}iceConnectionEnd(){this.dispatch({type:En.KEY_METRIC_ICE_CONNECTION_END,metric:Date.now()})}publish(c,u,h,m){this.dispatch({type:En.KEY_METRIC_PUBLISH,metric:gt(gt({trackId:c,type:u},h&&{publishStart:h}),m&&{publishEnd:m})})}subscribe(c,u,h,m,y,v,S){this.dispatch({type:En.KEY_METRIC_SUBSCRIBE,metric:gt(gt(gt(gt(gt({userId:c,type:u},h&&{subscribeStart:h}),m&&{subscribeEnd:m}),y&&{firstFrame:y}),v&&{streamAdded:v}),S&&{firstDecoded:S})})}massSubscribe(c,u,h,m){c.forEach(y=>{this.dispatch({type:En.KEY_METRIC_SUBSCRIBE,metric:gt(gt(gt({userId:y.userId,type:y.type},u&&{subscribeStart:u}),h&&{subscribeEnd:h}),m&&{firstFrame:m})})})}get keyMetrics(){return this.state.keyMetrics}recordJoinChannelService(c,u){c.service==="gateway"&&Array.isArray(c.urls)&&(c.urls=c.urls.map(h=>h.replace(/(\d+)-\d+-\d+-(\d+)/,"$1-*-*-$2")));try{return typeof u!="number"?(this.dispatch({type:En.RECORD_JOIN_CHANNEL_SERVICE,record:gt(gt({},c),{},{sessionId:this.sessionId,cloudProxyMode:this.cloudProxyServerMode,uid:this.uid})}),this.state.joinChannelServiceRecords.length-1):(u<0||u>=this.state.joinChannelServiceRecords.length||this.dispatch({type:En.RECORD_JOIN_CHANNEL_SERVICE,record:c,index:u}),u)}catch{return 0}}resetJoinChannelServiceRecords(){this.dispatch({type:En.RESET_JOIN_CHANNEL_SERVICE_RECORDS})}resetKeyMetrics(){this.dispatch({type:En.RESET_KEY_METRICS})}get joinChannelServiceRecords(){try{return this.state.joinChannelServiceRecords}catch{return[]}}get avoidJoinStart(){return this.state.avoidJoinStart}set avoidJoinStart(c){this.dispatch({type:En.AVOID_JOIN_START,avoidJoinStart:c})}}(t.codec,t.audioCodec,t.mode,this._clientId),this._leaveMutex=new js("client-leave",this._clientId),this._publishMutex=new js("client-publish",this._clientId),this._renewTokenMutex=new js("client-renewtoken",this._clientId),this._subscribeMutex=new js("client-subscribe",this._clientId),this.store.clientCreated(),t.proxyServer&&this.setProxyServer(t.proxyServer,!0),t.turnServer&&this.setTurnServer(t.turnServer,!0),x.info("[".concat(this._clientId,"] Initializing AgoraRTC client v").concat(wl," build: ").concat(OL,", mode: ").concat(this.mode,", codec: ").concat(this.codec)),t.clientRoleOptions)try{_L(t.clientRoleOptions),s=Object.assign({},t.clientRoleOptions)}catch(c){x.warning("[".concat(this._clientId,"] ").concat(c.toString()))}var a;this._statsCollector=new GT(this.store),this._statsCollector.onStatsException=(c,u,h)=>{x.warn("[".concat(this._clientId,"] receive exception msg, code: ").concat(c,", msg: ").concat(u,", uid: ").concat(h)),this.safeEmit(yn.EXCEPTION,{code:c,msg:u,uid:h})},this._statsCollector.onUploadPublishDuration=(c,u,h,m)=>{const y=this._users.find(v=>v.uid===c);y&&It.peerPublishStatus(this._sessionId,{subscribeElapse:m,audioPublishDuration:u,videoPublishDuration:h,peer:y._uintid})},this.store.useP2P=t.mode==="p2p",this._gateway=new Cge(this.store,{clientId:this._clientId,mode:this.mode,codec:this.codec,websocketRetryConfig:t.websocketRetryConfig||Pi,httpRetryConfig:t.httpRetryConfig||Pi,forceWaitGatewayResponse:t.forceWaitGatewayResponse===void 0||t.forceWaitGatewayResponse,statsCollector:this._statsCollector,role:t.role,clientRoleOptions:s}),this._configDistribute=new Lge(this._clientId,this.store),this.store.useP2P?(this._p2pChannel=(a={store:this.store,statsCollector:this._statsCollector},up("P2PChannel").create(a)),this._handleP2PEvents()):this._p2pChannel=new $T(this.store,this._statsCollector),this._handleP2PChannelEvents(),this._handleGatewayEvents(),this._handleGatewaySignalEvents()}async joinMeta(t,r,s,a,c){let u=!(arguments.length>5&&arguments[5]!==void 0)||arguments[5],h=arguments.length>6&&arguments[6]!==void 0&&arguments[6];tr("JOIN_GATEWAY_USE_443PORT_ONLY",u),tr("JOIN_GATEWAY_USE_DUAL_DOMAIN",h);const m=this._gateway.signal.websocket;return m instanceof l2&&(m.use443PortOnly=u,m.tryDoubleDomain=h),async function(y,v,S){zA.get(y)||zA.set(y,[]),GA.get(y)||GA.set(y,v),Eh.get(y)||Eh.set(y,0);const R=zA.get(y),P=GA.get(y);if(!R||!P)throw new Error("concurrent: deferQueue or maxConcurrency is null");if(Eh.get(y)===P){const X=ST();R.push(X),await X.promise}Eh.set(y,Eh.get(y)+1);for(var N=arguments.length,G=new Array(N>3?N-3:0),F=3;F<N;F++)G[F-3]=arguments[F];const j=await S(...G);return Eh.set(y,Eh.get(y)-1),Eh.get(y)===P-1&&R.length>0&&(R[0].resolve(),R.shift()),Eh.get(y)===0&&(zA.set(y,[]),GA.set(y,0),Eh.set(y,0)),j}("client.join",oe("JOIN_MAX_CONCURRENCY"),this.join.bind(this),t,r,s,a,c)}async join(t,r,s,a,c){const u=++this._numberOfJoinCount;this.store.joinStart(),a&&(this.store.uid=a);const h=(JA||JA||(JA=(window.location.protocol.split(":")[0]||"").toUpperCase(),JA))==="HTTPS",m=q8()?window.isSecureContext:"Browser Not Support";(!q8()&&!h||!window.isSecureContext)&&x.warning("The website must be running in a secure context (About secure context: https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts ), otherwise the media collection will be restricted by the browser"),this.connectionState==="DISCONNECTED"&&(this.store.avoidJoinStart=Math.round(Date.now()),x.debug("[".concat(this._clientId,"] set avoidJoinStart to ").concat(this.store.avoidJoinStart))),It.setAppId(t);try{if(!s&&s!==null)throw new Oe(te.INVALID_PARAMS,"Invalid token: ".concat(s,". If you don not use token, set it to null"));s&&fs(s,"token",1,2047),fs(t,"appid",1,2047),EP(r),a&&vP(a),c&&fs(c,"optionalInfo",1,2047)}catch(F){throw It.reportApiInvoke(j_(),{name:Ai.JOIN,options:[t,r,s,a],states:{isHttps:h,isSecureContext:m},tag:zr.TRACER}).onError(F),F}if(this._leaveMutex.isLocked&&(x.debug("[".concat(this._clientId,"] join: waiting leave operation")),(await this._leaveMutex.lock())(),x.debug("[".concat(this._clientId,"] join: continue"))),this._joinAndNotLeaveYet=!0,this.connectionState!=="DISCONNECTED"){const F=new Oe(te.INVALID_OPERATION,"[".concat(this._clientId,"] Client already in connecting/connected state"));throw It.reportApiInvoke(j_(),{name:Ai.JOIN,options:[t,r,s,a],states:{isHttps:h,isSecureContext:m},tag:zr.TRACER}).onError(F),F}this._gateway.state="CONNECTING";const y=await K9({appId:t,cname:r,uid:a,stringUid:typeof a=="string"?a:void 0,token:s||t,cloudProxyServer:this._cloudProxyServerMode});if(!this._joinAndNotLeaveYet)throw new Oe(te.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));const v=(y==null?void 0:y.sid)||j_();x.info("[".concat(this._clientId,"] start join channel ").concat(r,", join number: ").concat(u)),this._sessionId||(this._sessionId=v,this.store.sessionId=this._sessionId);const S=It.reportApiInvoke(v,{id:this._clientId,name:Ai.JOIN,options:[t,r,s,a],states:{isHttps:h,isSecureContext:m},tag:zr.TRACER}),R=wu(wu(wu({},this._rtmConfig),{},{role:this.role,clientId:this._clientId,appId:t,sid:this._sessionId,cname:r,uid:typeof a!="string"?a:null,turnServer:this._turnServer,proxyServer:this._proxyServer,token:s||t,cloudProxyServer:this._cloudProxyServerMode,optionalInfo:c,license:this._license,useLocalAccessPoint:this._useLocalAccessPoint,preload:!!y},this._remoteDefaultVideoStreamType!==void 0&&{defaultVideoStream:this._remoteDefaultVideoStreamType}),{},{apRequestDetail:oe("AP_REQUEST_DETAIL")||void 0});if(this._useLocalAccessPoint&&(R.setLocalAPVersion=this._setLocalAPVersion),typeof a=="string"&&(R.stringUid=a,this._uintUid?(R.uid=this._uintUid,this._uintUid=void 0):R.uid=0),this._encryptionMode!=="none"&&this._encryptionSecret){if(R.aesmode=this._encryptionMode,R.aespassword=await(async F=>{const j=function(Se){const Te=window.atob(`MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDCMnXAHkKIGAM+x4N22gCI+Wyu
STM9ztkT3uYslTT2PuKmZfPzhH6kVdO7PTjGCOZnAsyb3oTtWat0KcxQ4jxvqQV+
HvYl3iI1Yd4vl2c3qRMJPLtRDfNxa2Mcxgq7e9aEUibzdd0st+OJAy3tOj/Y0aVy
xQiYDz3vqa6bP29adwIDAQAB`),ye=new Uint8Array(new ArrayBuffer(Te.length));for(let Ne=0;Ne<Te.length;Ne+=1)ye[Ne]=Te.charCodeAt(Ne);return ye}(),X=await window.crypto.subtle.importKey("spki",j,{name:"RSA-OAEP",hash:"SHA-256"},!0,["encrypt"]),ee=mL(F),he=await window.crypto.subtle.encrypt({name:"RSA-OAEP"},X,ee);return function(Se){let Te="";for(let ye=0;ye<Se.length;ye+=1)Te+=String.fromCharCode(Se[ye]);return window.btoa(Te)}(new Uint8Array(he))})(this._encryptionSecret),!this._joinAndNotLeaveYet)throw new Oe(te.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));this._encryptionSalt&&(R.aessalt=this._encryptionSalt)}if(this._encryptDataStream&&(this._encryptionMode==="aes-128-gcm2"||this._encryptionMode==="aes-256-gcm2"))if(this._encryptionSalt&&this._encryptionSecret)if(window.crypto.subtle){const F=new TextEncoder,j=oe("USE_PURE_ENCRYPTION_MASTER_KEY")?F.encode(R.appId+this._encryptionSecret+this._encryptionSecret):F.encode(R.appId+R.cname+this._encryptionSecret);this._encryptDataStreamIv=await async function(X,ee,he){const Se=await window.crypto.subtle.importKey("raw",ee,"PBKDF2",!1,["deriveBits","deriveKey"]),Te=X==="aes-128-gcm2"?128:256,ye=await window.crypto.subtle.deriveBits({name:"PBKDF2",iterations:iz,hash:"SHA-256",salt:he},Se,Te+tme);return new Uint8Array(ye).subarray(Te/8)}(this._encryptionMode,j,F_(this._encryptionSalt)),this._encryptDataStreamKey=await async function(X,ee,he){const Se=await window.crypto.subtle.importKey("raw",ee,"PBKDF2",!1,["deriveBits","deriveKey"]),Te=X==="aes-128-gcm2"?128:256;return await window.crypto.subtle.deriveKey({name:"PBKDF2",iterations:iz,hash:"SHA-256",salt:he},Se,{name:"AES-GCM",length:Te},!0,["encrypt","decrypt"])}(this._encryptionMode,j,F_(this._encryptionSalt))}else m?x.warning("[".concat(this._clientId,"] encrypt datastream must be running in a secure context, fallback to plain data stream")):x.warning("[".concat(this._clientId,"] current browser do not support WebCrypto ,fallback to plain data stream")),this._encryptDataStream=!1;else this._encryptDataStream=!1,x.debug("[".concat(this._clientId,"] no salt / secret, cannot support encrypt data stream, fallback to plain data stream"));this._startSession(this._sessionId,{channel:r,appId:t,stringUid:R.stringUid});const P=this._sessionId;setTimeout(()=>{this.connectionState==="CONNECTING"&&P===this._sessionId&&It.joinChannelTimeout(this._sessionId,5)},5e3);try{var N;let F;const j=R.cloudProxyServer;if(ot(N=["proxy3","proxy4","proxy5"]).call(N,j)){const Te=oe("PROXY_SERVER_TYPE3");Array.isArray(Te)?R.proxyServer=Te[0]:R.proxyServer=Te}if(It.setProxyServer(R.proxyServer),x.setProxyServer(R.proxyServer),this.store.requestAPStart(),y){if(x.debug("[".concat(this._clientId,"] get serverInfo Success from Preload Cache ").concat(R.stringUid?", ".concat(R.stringUid," => ").concat(y.intUid):""," ")),R.stringUid&&!R.uid&&(R.uid=y.intUid),F={gatewayInfo:y.ap.gatewayInfo},oe("JOIN_WITH_FALLBACK_MEDIA_PROXY")&&R.turnServer.mode==="auto")if(y.ap.proxyInfo.addresses.length===0)x.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers");else{const Te=(await FH(y.ap.proxyInfo,y.ap.gatewayInfo.uid)).map(ye=>({turnServerURL:ye.address,tcpport:ye.tcpport||Ns.tcpport,udpport:ye.udpport||Ns.udpport,username:ye.username||Ns.username,password:ye.password||Ns.password,forceturn:!1,security:!0}));R.turnServer={mode:"manual",servers:Te}}X9(y,R.stringUid)}else{if(R.stringUid&&!R.uid){let Te;[Te,F]=await dt.all([f9(R.stringUid,R,this._axiosCancelSource.token,this._config.httpRetryConfig||Pi,this.store),h9(R,this._axiosCancelSource.token,this._config.httpRetryConfig||Pi,!0,this.store)]),x.debug("[".concat(this._clientId,"] getUserAccount Success ").concat(R.stringUid," => ").concat(Te)),R.uid=Te,F.gatewayInfo.uid=Te,F.gatewayInfo.res.uid=Te}else F=await h9(R,this._axiosCancelSource.token,this._config.httpRetryConfig||Pi,!0,this.store);if(!this._joinAndNotLeaveYet)throw new Oe(te.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"))}this.store.requestAPEnd(),setTimeout(()=>{this._configDistribute.startGetConfigDistribute(R,this._axiosCancelSource.token),this._configDistribute.on(LT.UPDATE_BITRATE_LIMIT,Te=>{this._p2pChannel.updateBitrateLimit(Te)}),this._configDistribute.on(LT.UPDATE_CLIENT_ROLE_OPTIONS,Te=>{this._setClientRoleOptions(Te)})},0),this._key=s||t;const X=F.gatewayInfo,ee=R.uid?R.uid:X.uid;this._joinInfo=wu(wu({},R),{},{cid:X.cid,uid:ee,vid:X.vid,apResponse:X.res,apGatewayAddress:X.apGatewayAddress,uni_lbs_ip:X.uni_lbs_ip,gatewayAddrs:X.gatewayAddrs}),this.store.intUid=ee,this.store.cid=X.cid;const he=await this._joinGateway();if(!this._joinAndNotLeaveYet)throw new Oe(te.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));S.onSuccess(he),this._appId=t,this._channelName=R.cname,this._uid=he,this.store.uid=he,setTimeout(()=>{this._networkQualityInterval&&window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=window.setInterval(this._handleUpdateNetworkQuality,2e3),window.addEventListener(Ps()?"beforeunload":"pagehide",this._handleBeforeUnload),this._statsCollector.startUpdateStats()},0);const Se=R.stringUid?"string uid: ".concat(R.stringUid,",uid: ").concat(R.uid):"uid: ".concat(this._uid);return x.info("[".concat(this._clientId,"] Joining channel success: channel: ").concat(r,",").concat(Se)),setTimeout(()=>{x.startUpload()},5e3),this.store.joinEnd(),G=this,ot(K_).call(K_,G)||K_.push(G),this._cloudProxyServerMode==="disabled"&&Vn().supportWebCrypto&&oe("ENABLE_PRELOAD")&&M2(this._joinInfo),he}catch(F){const j=Array.isArray(F)?F[0]:F;throw j&&j.code===te.OPERATION_ABORTED?x.warning("[".concat(this._clientId,"] join number: ").concat(u,", Joining channel failed, rollback"),j):x.error("[".concat(this._clientId,"] join number: ").concat(u,", Joining channel failed, rollback"),j),j.code!==te.OPERATION_ABORTED&&this._numberOfJoinCount===u&&(this._gateway.state="DISCONNECTED",this._reset()),S.onError(j),j}var G}_joinGateway(){if(!this._joinInfo||!this._key)throw new Oe(te.INVALID_OPERATION);return this._gateway.join(this._joinInfo,this._key,!(this._joinInfo.cloudProxyServer!=="disabled"||this._joinInfo.proxyServer||!oe("JOIN_WITH_FALLBACK_SIGNAL_PROXY")))}async leave(){x.info("[".concat(this._clientId,"] Leaving channel")),window.removeEventListener(Ps()?"beforeunload":"pagehide",this._handleBeforeUnload),this._reset(),function(r){const s=K_.indexOf(r);s!==-1&&K_.splice(s,1)}(this),this._statsCollector.stopUpdateStats();const t=await this._leaveMutex.lock();if(this.connectionState==="DISCONNECTED")return x.info("[".concat(this._clientId,"] Leaving channel repeated, success")),void t();await this._gateway.leave(this.connectionState!=="CONNECTED",Kn.LEAVE),x.info("[".concat(this._clientId,"] Leaving channel success")),this._joinAndNotLeaveYet=!1,this.store.resetJoinChannelServiceRecords(),t()}async publish(t){let r=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!Array.isArray(t)){if(!(t instanceof Yv))return this._publishDataChannel(t);t=[t]}if(t.length===0)throw new Oe(te.INVALID_PARAMS,"param list is empty");const s=t;if(this._gateway.role==="audience")throw new Oe(te.INVALID_OPERATION,"audience can not publish stream");for(const c of s){if(!(c instanceof Yv))throw new Oe(te.INVALID_PARAMS,"parameter is not local track");if(!c._enabled&&r)throw new Oe(te.TRACK_IS_DISABLED,"can not publish a disabled track: ".concat(c.getTrackId()))}x.info("[".concat(this._clientId,"] Publishing tracks, id ").concat(s.map(c=>"".concat(c.getTrackId()," "))));const a=await this._publishMutex.lock();await this._configDistribute.awaitConfigDistributeComplete(),r&&s.forEach(c=>{const u=this._configDistribute.getBitrateLimit();c instanceof Sr&&u&&c.setBitrateLimit(u.uplink)});try{await this._publishHighStream(s),x.info("[".concat(this._clientId,"] Publish success, id ").concat(s.map(c=>"".concat(c.getTrackId()," "))))}catch(c){throw x.error("[".concat(this._clientId,"] publish error"),c.toString()),c}finally{a()}}async _publishDataChannel(t){ir(t.id,"id",0,65535,!0),rp(t.ordered,"ordered"),fs(t.metadata,"metadata",0,512),x.info("[".concat(this._clientId,"] Publishing datachannels, id ").concat(t.id));const r=await this._publishMutex.lock();try{if(this._p2pChannel.getAllDataChannels().findIndex(c=>c.id===t.id)!==-1)throw new Oe(te.INVALID_PARAMS,"Invalid id: ".concat(t.id,". If you want to republish the datachannel, unpublish first"));if(!this._joinInfo||this._uid===void 0)throw new Oe(te.INVALID_OPERATION,"Can't publish datachannel, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Oe(te.INVALID_OPERATION,"can not publish datachannel in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&oe("FORCE_TURN")&&!oe("TURN_ENABLE_TCP")&&!oe("TURN_ENABLE_UDP"))throw new Oe(te.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");const s=function(c){return r9(c,!1)}(t),a=await this._p2pChannel.publishDataChannel([s]);if(a.length>0){if(typeof s._originDataChannelId!="number")throw x.error("[".concat(this._clientId,"] can not publish with mediaType datachannel, cannot get RTCDatachannel id")),new Oe(te.CREATE_DATACHANNEL_ERROR);try{await dt.all(a.map(c=>this._uid&&this._gateway.publishDataChannel(this._uid,c,!0))),await s._waitTillOpen()}catch(c){if(c.code!==te.DISCONNECT_P2P)throw c}}return x.info("[".concat(this._clientId,"] Publish dataChannels success, id ").concat(s.id)),s}catch(s){throw x.error("[".concat(this._clientId,"] publish datachannels error"),s.toString()),s}finally{r()}}async unpublish(t){if(!this._joinInfo||this._uid===void 0)throw new Oe(te.INVALID_OPERATION,"Can't unpublish stream, haven't joined yet!");let r=[];if(t)if(Array.isArray(t))r=t;else{if(!(t instanceof Yv))return this._unpublishDataChannel([t]);r=[t]}else this.store.useP2P||await this._unpublishDataChannel(),r=this._p2pChannel.getAllTracks(!0);x.info("[".concat(this._clientId,"] Unpublish tracks, tracks ").concat(r.map(a=>"".concat(a.getTrackId()," "))," "));const s=await this._publishMutex.lock();try{if(this.store.useP2P){const a=await this._p2pChannel.unpublish(r);a&&await this._gateway.sendExtensionMessage(li.UNPUBLISH,{unpubMsg:a},!0)}else{const a=await this._p2pChannel.unpublish(r);a&&await this._gateway.unpublish(a,this._uid),x.info("[".concat(this._clientId,"] Unpublish success,tracks ").concat(r.map(c=>"".concat(c.getTrackId()))))}}catch(a){throw x.error("[".concat(this._clientId,"] unpublish error"),a.toString()),a}finally{s&&s()}}async _unpublishDataChannel(t){t!==void 0&&t.length!==0||(t=this._p2pChannel.getAllDataChannels()),x.info("[".concat(this._clientId,"] Unpublish datachannels, datachannels ").concat(t.map(s=>"".concat(s.id," "))," "));const r=await this._publishMutex.lock();try{const s=await this._p2pChannel.unpublishDataChannel(t);s&&await this._gateway.unpublishDataChannel(s),x.info("[".concat(this._clientId,"] Unpublish dataChannel success,dataChannel ").concat(t.map(a=>"".concat(a.id))))}catch(s){throw x.error("[".concat(this._clientId,"] unpublish dataChannel error"),s.toString()),s}finally{r&&r()}}async subscribe(t,r,s){if(!(t instanceof qm)){const a=this.remoteUsers.find(c=>c.uid===t);if(!a)throw new Oe(te.INVALID_REMOTE_USER,"user is not in the channel");t=a}return r==="datachannel"?this._subscribeDataChannel(t,s):this._subscribe(t,r)}async presubscribe(t,r){if(Bi(r,"mediaType",["audio","video"]),this.store.useP2P)throw new Oe(te.INVALID_OPERATION,"can't presub at p2p mode");if(!this._joinInfo)throw new Oe(te.INVALID_OPERATION,"can't presub when not join");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Oe(te.INVALID_OPERATION,"can't presub in ".concat(this.connectionState," state"));const s=r===_t.AUDIO,a=r===_t.VIDEO,c=await this._subscribeMutex.lock();try{const{ssrcId:u,ortc:h,rtxSsrcId:m,cname:y,uint_id:v}=await this._gateway.presubscribe(t,r,!0);if(u==null)throw new Oe(te.UNEXPECTED_RESPONSE,"no ssrc id");let S=this._users.find(P=>P.uid===t);S||(S=new qm(t,v||t),S._is_pre_created=!0,this._users.push(S)),y&&(S._cname=y),S._uintid||(S._uintid=v||t),s&&(S._audioSSRC=u,S._audio_pre_subscribed=!0,h&&(S._audioOrtc=h)),a&&(S._videoSSRC=u,S._video_pre_subscribed=!0,h&&(S._videoOrtc=h),m!=null&&(S._rtxSsrcId=m)),x.info("[".concat(this._clientId,"] presub succeed ssrc: ").concat(u)),await this._p2pChannel.subscribe(S,r,u,m,h);const R=s?S._audioTrack:S._videoTrack;if(!R)throw new Oe(te.UNEXPECTED_ERROR,"can not find remote track in user");return s&&(S._trust_audio_stream_added_state_=!0,S._audio_added_=!0),a&&(S._trust_video_stream_added_state_=!0,S._video_added_=!0),R}catch(u){throw x.error("[".concat(this._clientId,"] presub user ").concat(t," error"),u),u}finally{c()}}async _subscribeDataChannel(t,r){var s;if(ir(r,"channelId",0,65535,!0),!this._joinInfo)throw new Oe(te.INVALID_OPERATION,"Can't subscribe datachannel, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Oe(te.INVALID_OPERATION,"Can't subscribe datachannel in ".concat(this.connectionState," state"));if(!this._users.find(m=>m===t))throw x.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", this user is not in the channel")),new Oe(te.INVALID_REMOTE_USER,"user is not in the channel");if(!t.hasAudio&&!t.hasVideo&&t._dataChannels.length===0)throw x.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", user is not published")),new Oe(te.INVALID_REMOTE_USER,"user is not published");const c=(s=t._dataChannels)===null||s===void 0?void 0:s.find(m=>m.id===r);if(!c)throw x.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid," with mediaType datachannel, remote datachannel is not published")),new Oe(te.REMOTE_USER_IS_NOT_PUBLISHED);const u=await this._subscribeMutex.lock();x.info("[".concat(this._clientId,"] subscribe user ").concat(t.uid,", mediaType: datachannel"));try{const m=await this._p2pChannel.subscribeDataChannel(t,[c]);if(m&&ot(m).call(m,c.id))try{var h;if(typeof c._originDataChannelId!="number")throw x.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid," with mediaType datachannel, cannot get RTCDatachannel")),new Oe(te.CREATE_DATACHANNEL_ERROR);const y={id:c.id,datachannelId:c._originDataChannelId,ordered:c.ordered,maxRetransmits:c.maxRetransmits,metadata:(h=c.metadata)!==null&&h!==void 0?h:""};await this._gateway.subscribeDataChannel(t.uid,y,!0),await c._waitTillOpen()}catch(y){if((y==null?void 0:y.code)!==te.WS_ABORT)throw await this._p2pChannel.unsubscribeDataChannel(t,[c]),y;await this._p2pChannel.unsubscribeDataChannel(t,[c]),this._p2pChannel.setPendingRemoteDataChannel(t,c.id)}return x.info("[".concat(this._clientId,"] subscribe success user ").concat(t.uid,", mediaType: datachannel")),c}finally{u()}}async _p2pSubscribe(t,r,s){if(Bi(r,"mediaType",["audio","video"]),!this._joinInfo)throw new Oe(te.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Oe(te.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(u=>u===t)){const u=new Oe(te.INVALID_REMOTE_USER,"user is not in the channel");throw x.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", this user is not in the channel")),u}if(!t.hasAudio&&!t.hasVideo){const u=new Oe(te.INVALID_REMOTE_USER,"user is not published");throw x.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", user is not published")),u}if(!s&&(r==="audio"&&!t.hasAudio||r==="video"&&!t.hasVideo)){const u=new Oe(te.REMOTE_USER_IS_NOT_PUBLISHED);throw x.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid," with mediaType ").concat(r,", remote track is not published")),u}const c=await this._subscribeMutex.lock();x.info("[".concat(this._clientId,"] subscribe user ").concat(t.uid,", mediaType: ").concat(r));try{if(await this._p2pChannel.hasRemoteMediaWithLock(t,r))await this._p2pChannel.unmuteRemote(t,r);else try{const h=r==="audio"?t._audioSSRC:t._videoSSRC,m=r==="audio"?t._audioMid:t._videoMid;this.store.subscribe(t.uid,r,Date.now()),this.store.useP2P&&await this._p2pChannel.subscribe(t,r,h,m)}catch(h){throw h}x.info("[".concat(this._clientId,"] subscribe success user ").concat(t.uid,", mediaType: ").concat(r)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(t.uid,this._defaultStreamFallbackType).catch(h=>{x.warning("[".concat(this._clientId,"] auto set fallback failed"),h)});const u=r==="audio"?t._audioTrack:t._videoTrack;if(!u)throw new Oe(te.UNEXPECTED_ERROR,"can not find remote track in user object");return u}catch(u){throw x.error("[".concat(this._clientId,"] subscribe user ").concat(t.uid," error"),u),u}finally{c()}}async _subscribe(t,r,s){if(this.store.useP2P)return this._p2pSubscribe(t,r);if(Bi(r,"mediaType",["audio","video"]),!this._joinInfo)throw new Oe(te.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Oe(te.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(v=>v===t)){const v=new Oe(te.INVALID_REMOTE_USER,"user is not in the channel");throw x.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", this user is not in the channel")),v}if(!t.hasAudio&&!t.hasVideo){const v=new Oe(te.INVALID_REMOTE_USER,"user is not published");throw x.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", user is not published")),v}if(!(s||(r!=="audio"||t.hasAudio&&t._audioSSRC!==void 0)&&(r!=="video"||t.hasVideo&&t._videoSSRC!==void 0))){const v=new Oe(te.REMOTE_USER_IS_NOT_PUBLISHED);throw x.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid," with mediaType ").concat(r,", remote track is not published")),v}let c=r==="audio"?t._audioSSRC:t._videoSSRC,u=r==="audio"?t._audioOrtc:t._videoOrtc,h=r==="video"?t._rtxSsrcId:void 0,m={stream_type:r==="audio"?_t.AUDIO:_t.VIDEO,ssrcId:c};const y=await this._subscribeMutex.lock();x.info("[".concat(this._clientId,"] subscribe user ").concat(t.uid,", mediaType: ").concat(r));try{if(await this._p2pChannel.hasRemoteMediaWithLock(t,r))await this._p2pChannel.unmuteRemote(t,r);else try{const S=r==="audio"?t._audioSSRC:t._videoSSRC;S!==void 0&&S!==c&&(c=S,u=r==="audio"?t._audioOrtc:t._videoOrtc,h=r==="video"?t._rtxSsrcId:void 0,m={stream_type:r==="audio"?_t.AUDIO:_t.VIDEO,ssrcId:c}),zs.markSubscribeStart(this.store.clientId,c),this.store.subscribe(t.uid,r,Date.now()),await this._p2pChannel.subscribe(t,r,c,h,u);try{this._p2pChannel.isPreSubScribe(c)||await this._gateway.subscribe(t.uid,m,!0)}catch(R){if((R==null?void 0:R.code)!==te.WS_ABORT)throw await this._p2pChannel.unsubscribe(t,r),R;await this._p2pChannel.unsubscribe(t,r,!0),this._p2pChannel.setPendingRemoteMedia(t,r)}this.store.subscribe(t.uid,r,void 0,Date.now()),this._p2pChannel.reportSubscribeEvent(!0,null,t,r)}catch(S){throw this._p2pChannel.reportSubscribeEvent(!1,S==null?void 0:S.code,t,r),S}x.info("[".concat(this._clientId,"] subscribe success user ").concat(t.uid,", mediaType: ").concat(r)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(t.uid,this._defaultStreamFallbackType).catch(S=>{x.warning("[".concat(this._clientId,"] auto set fallback failed"),S)});const v=r==="audio"?t._audioTrack:t._videoTrack;if(!v)throw new Oe(te.UNEXPECTED_ERROR,"can not find remote track in user object");return v}catch(v){throw x.error("[".concat(this._clientId,"] subscribe user ").concat(t.uid," error"),v),v}finally{y()}}async massSubscribe(t){if(ip(t,"subscribeList"),!this._joinInfo)throw new Oe(te.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Oe(te.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));const r=Date.now(),s=new Map,a=await this._subscribeMutex.lock();x.info("[".concat(this._clientId,"]start massSubscribe user ").concat(t.map(m=>{let{user:y,mediaType:v}=m;return"user: ".concat(y==null?void 0:y.uid,", mediaType: ").concat(v)}).join("; ")));const c=(t=[...t]).map(m=>{let{user:y,mediaType:v}=m;return{user:y,mediaType:v}}),u=await this._p2pChannel.globalLock();try{var h;for(let y=t.length-1;y>=0;y--){const v=t[y],{user:S,mediaType:R}=v;if(Bi(R,"mediaType",["audio","video"]),!S){const F=new Oe(te.INVALID_PARAMS,"user property does not exist in subscribeList item");throw x.error("[".concat(this._clientId,"] user property does not exist in subscribeList item")),F}if(!this._users.find(F=>F===S)){const F=new Oe(te.INVALID_REMOTE_USER,"user is not in the channel");x.error("[".concat(this._clientId,"] can not massSubscribe ").concat(S.uid,", this user is not in the channel")),c[y].error=F,t.splice(y,1);continue}if(R==="audio"&&(!S.hasAudio||S._audioSSRC===void 0)||R==="video"&&(!S.hasVideo||S._videoSSRC===void 0)){const F=new Oe(te.REMOTE_USER_IS_NOT_PUBLISHED);x.error("[".concat(this._clientId,"] can not subscribe ").concat(S.uid," with mediaType ").concat(R,", remote user is not published")),c[y].error=F,t.splice(y,1);continue}const N=Ji.Video|Ji.LwoVideo,G=s.get(S);if(G){if(R==="video"?G&N:G&Ji.Audio){t.splice(y,1),x.warning("[".concat(this._clientId,"] repeat massSubscribe user:").concat(S.uid,", mediaType:").concat(R," twice"));continue}s.set(S,G|(R==="video"?N:Ji.Audio))}else s.set(S,R==="video"?N:Ji.Audio)}for(let y=t.length-1;y>=0;y--){const v=t[y],{user:S,mediaType:R}=v,P=Ji.Video|Ji.LwoVideo;if(this._p2pChannel.hasRemoteMedia(S,R)){await this._p2pChannel.unmuteRemoteNoLock(S,R);const N=s.get(S);s.set(S,R==="video"?N^P:N^Ji.Audio),t.splice(y,1)}}this.store.massSubscribe(t.map(y=>({userId:y.user.uid,type:y.mediaType})),r);let m=lc(h=Array.from(s.entries())).call(h,(y,v)=>{let[S,R]=v;if(R===0)return y;const P={stream_id:S.uid,stream_type:R};return R&Ji.Audio&&(P.audio_ssrc=S._audioSSRC),R&Ji.Video&&(P.video_ssrc=S._videoSSRC),y.push(P),y},[]);try{t.length>0&&await this._p2pChannel.massSubscribeNoLock(t.map(v=>{let{user:S,mediaType:R}=v;return{user:S,mediaType:R,ssrcId:R===_t.VIDEO?S._videoSSRC:S._audioSSRC,rtxSsrcId:R===_t.VIDEO?S._rtxSsrcId:void 0}}));const y=new Map;if(m=m.filter(v=>v.video_ssrc&&!this._p2pChannel.isPreSubScribe(v.video_ssrc)||v.audio_ssrc&&!this._p2pChannel.isPreSubScribe(v.audio_ssrc)||!v.video_ssrc&&!v.audio_ssrc),m.length>0){const v=await this._gateway.subscribeAll(m,!0);((v==null?void 0:v.users)||[]).forEach(S=>{let{stream_id:R,video_error_code:P,audio_error_code:N,error_code:G}=S;(P||N||G)&&y.set(R,{video_error_code:P,audio_error_code:N,error_code:G})})}if(Array.from(y.entries()).length>0){const v=[];Array.from(y.entries()).forEach(S=>{let[R,P]=S;const N=this.remoteUsers.find(G=>G.uid===R);if(N){let G;P.error_code||P.video_error_code&&P.audio_error_code?G=void 0:P.video_error_code?G=_t.VIDEO:P.audio_error_code&&(G=_t.AUDIO),v.push({user:N,mediaType:G})}}),v.length>0&&await this._p2pChannel.massUnsubscribeNoLock(v)}for(const v of c){const S=y.get(v.user.uid);if(S){const R=S.error_code||v.mediaType==="audio"&&S.audio_error_code||v.mediaType==="video"&&S.video_error_code;if(R){const P=MT(R);x.error("user:".concat(v.user.uid," mediaType:").concat(v.mediaType," has massSubscribe error ").concat(P.desc)),v.error=new Oe(te.SUBSCRIBE_FAILED,"code ".concat(R,": ").concat(P.desc))}}v.error||(v.mediaType==="video"?v.track=v.user.videoTrack:v.track=v.user.audioTrack)}return this.store.massSubscribe(c.filter(v=>!v.error).map(v=>({userId:v.user.uid,type:v.mediaType})),void 0,Date.now()),c.forEach(v=>{var S;It.subscribe(this.store.sessionId,{succ:!!v.error,ec:((S=v.error)===null||S===void 0?void 0:S.code)||null,video:v.mediaType===_t.VIDEO,audio:v.mediaType===_t.AUDIO,peerid:v.user.uid,subscribeRequestid:v.mediaType===_t.VIDEO?v.user._videoSSRC:v.user._audioSSRC,p2pid:this.store.p2pId,eventElapse:Math.floor(performance.now()-r),preSsrc:this._p2pChannel.isPreSubScribe(v.user._videoSSRC)},!0)}),x.info("[".concat(this._clientId,"] massSubscribe success ").concat(t.map(v=>{let{user:S,mediaType:R}=v;return"user: ".concat(S==null?void 0:S.uid,", mediaType: ").concat(R)}).join("; "))),c}catch(y){throw await this._p2pChannel.massUnsubscribeNoLock(t),y}}finally{u(),a()}}async unsubscribe(t,r,s){if(!(t instanceof qm)){const u=this.remoteUsers.find(h=>h.uid===t);if(!u)throw new Oe(te.INVALID_REMOTE_USER,"user is not in the channel");t=u}if(r||this.store.useP2P){if(r==="datachannel")return this._unsubscribeDataChannel(t,s)}else await this._unsubscribeDataChannel(t,s);if(r&&Bi(r,"mediaType",["audio","video"]),!this._joinInfo)throw new Oe(te.INVALID_OPERATION,"Can't unsubscribe stream, haven't joined yet!");if(!this._users.find(u=>u===t)){const u=new Oe(te.INVALID_REMOTE_USER,"user is not in the channel");throw x.error("[".concat(this._clientId,"] can not unsubscribe ").concat(t.uid,", user is not in the channel")),u}x.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(t.uid,", mediaType: ").concat(r));const c=await this._subscribeMutex.lock();try{if(this.store.useP2P)await this._p2pChannel.unsubscribe(t,r);else{const u=await this._p2pChannel.unsubscribe(t,r);u&&await this._gateway.unsubscribe(u,t.uid),r&&r!=="audio"||(t._audio_pre_subscribed=!1),r&&r!=="video"||(t._video_pre_subscribed=!1),t._is_pre_created&&qA(this._users,t),x.info("[".concat(this._clientId,"] unsubscribe success uid: ").concat(t.uid,", mediaType: ").concat(r))}}catch(u){if(u.code===te.DISCONNECT_P2P)return void x.warning("disconnecting p2p, abort unsubscribe request.");throw x.error("[".concat(this._clientId,"] unsubscribe user ").concat(t.uid," error"),u.toString()),u}finally{c()}}async _unsubscribeDataChannel(t,r){if(r&&ir(r,"id",0,65535,!0),!this._joinInfo)throw new Oe(te.INVALID_OPERATION,"Can't unsubscribe datachannel, haven't joined yet!");if(!this._users.find(c=>c===t)){const c=new Oe(te.INVALID_REMOTE_USER,"user is not in the channel");throw x.error("[".concat(this._clientId,"] can not unsubscribe ").concat(t.uid,", user is not in the channel")),c}let a;if(typeof r=="number"){const c=t._dataChannels.find(u=>u.id===r);c&&(a=[c])}else a=t._dataChannels;if(a===void 0){const c=new Oe(te.REMOTE_USER_IS_NOT_PUBLISHED);throw x.error("[".concat(this._clientId,"] can not unsubscribe ").concat(t.uid," with channelId ").concat(r,", remote datachannel is not published")),c}x.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(t.uid,", mediaType: datachannel, ids: ").concat(a.map(c=>c.id)));try{const c=await this._p2pChannel.unsubscribeDataChannel(t,a);c&&await this._gateway.unsubscribeDataChannel(c,t.uid),x.info("[".concat(this._clientId,"] unsubscribe datachannel success uid: ").concat(t.uid,", mediaType: datachannel, ids: ").concat(c))}catch(c){if(c.code===te.DISCONNECT_P2P)return void x.warning("disconnecting p2p, abort unsubscribe request.");throw x.error("[".concat(this._clientId,"] unsubscribe user ").concat(t.uid," error"),c.toString()),c}}async massUnsubscribe(t){if(ip(t,"unsubscribeList"),!this._joinInfo)throw new Oe(te.INVALID_OPERATION,"Can't unsubscribeAll stream, haven't joined yet!");x.info("[".concat(this._clientId,"] start massUnsubscribe ").concat(t.map(s=>{let{user:a,mediaType:c}=s;return"user: ".concat(a==null?void 0:a.uid,", mediaType: ").concat(c,";")}).join())),t=[...t];const r=new Map;for(let s=t.length-1;s>=0;s--){const{user:a,mediaType:c}=t[s];if(!a){const m=new Oe(te.INVALID_PARAMS,"user property does not exist in unsubscribeList item");throw x.error("[".concat(this._clientId,"] user property does not exist in unsubscribeList item")),m}if(Bi(c,"mediaType",["video","audio",void 0]),!this._users.find(m=>m===a)){x.warning("[".concat(this._clientId,"] can not unsubscribe ").concat(a.uid,", user is not in the channel")),t.splice(s,1);continue}const h=Ji.Video|Ji.LwoVideo;if(r.has(a)){const m=r.get(a);let y;switch(c){case"video":y=m&h;break;case"audio":y=m&Ji.Audio;break;default:y=m&(Ji.Audio|h)}if(y){x.warning("[".concat(this._clientId,"] repeat massUnsubscribe user:").concat(a.uid,",mediaType:").concat(c," twice.")),t.splice(s,1);continue}c?c==="audio"?r.set(a,m|Ji.Audio):c==="video"&&r.set(a,m|h):r.set(a,m|Ji.Audio|h)}else c?c==="audio"?r.set(a,Ji.Audio):c==="video"&&r.set(a,h):r.set(a,Ji.Audio|h)}try{const s=await this._p2pChannel.massUnsubscribe(t);s&&await this._gateway.massUnsubscribe(s),x.info("[".concat(this._clientId,"] massUnsubscribe success ").concat(t.map(a=>{let{user:c,mediaType:u}=a;return"user: ".concat(c==null?void 0:c.uid,", mediaType: ").concat(u,";")}).join()))}catch(s){if(s.code===te.DISCONNECT_P2P)return void x.warning("[".concat(this._clientId,"] disconnecting p2p, abort unsubscribe request."));throw x.error("[".concat(this._clientId,"] massUnsubscribe error"),s.toString()),s}}async setLowStreamParameter(t){(function(s){if(!s)throw new Le(te.INVALID_PARAMS);Wr(s.width)||fL(s.width,"streamParameter.width"),Wr(s.height)||fL(s.height,"streamParameter.height"),Wr(s.framerate)||fL(s.framerate,"streamParameter.framerate"),Wr(s.bitrate)||ir(s.bitrate,"streamParameter.bitrate")})(t),(!t.width&&t.height||t.width&&!t.height)&&x.warning("[".concat(this._clientId,"] The width and height parameters take effect only when both are set")),x.info("[".concat(this._clientId,"] set low stream parameter to"),JSON.stringify(t));const r=this._configDistribute.getLowStreamConfigDistribute();if(r&&r.bitrate&&t.bitrate&&r.bitrate<t.bitrate&&(t.bitrate=r.bitrate),this._lowStreamParameter=t,this._isDualStreamEnabled)return this._p2pChannel.updateVideoStreamParameter(t,Ke.LocalVideoLowTrack)}async enableDualStream(){if(!Vn().supportDualStream)throw It.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),new Oe(te.NOT_SUPPORTED,"Your browser is not support dual stream");if(this._isDualStreamEnabled)throw new Oe(te.INVALID_OPERATION,"Dual stream is already enabled");if(this._p2pChannel.canPublishLowStream())try{await this._publishLowStream()}catch(t){throw It.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),t}this._isDualStreamEnabled=!0,It.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!0}),x.info("[".concat(this._clientId,"] enable dual stream"))}async disableDualStream(){if(this._isDualStreamEnabled){if(!this._joinInfo)throw new Oe(te.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this._p2pChannel.getLocalMedia(Ke.LocalVideoLowTrack))try{const t=await this._p2pChannel.unpublishLowStream();t&&await this._gateway.unpublish(t,this._joinInfo.stringUid||this._joinInfo.uid)}catch(t){throw It.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!1}),t}this._isDualStreamEnabled=!1,It.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!0}),x.info("[".concat(this._clientId,"] disable dual stream"))}}async setClientRole(t,r){if(function(a){Bi(a,"role",["audience","host"])}(t),r&&_L(r),this.mode==="rtc"||this.mode==="p2p")throw x.warning("[".concat(this._clientId,"]").concat(this.mode," mode can not use setClientRole")),new Oe(te.INVALID_OPERATION,"".concat(this.mode," mode can not use setClientRole"));if(r&&r.level&&t==="host")throw new Oe(te.INVALID_OPERATION,"host mode can not set audience latency level");if(t==="audience"&&this._p2pChannel.hasLocalMedia())throw new Oe(te.INVALID_OPERATION,"can not set client role to audience when publishing stream");const s=this._config.role;this._joinInfo&&(this._joinInfo.role=t),t!==s&&oe("ENABLE_ROLE_SELECT_EDGE")?(this._gateway.updateClientRole(t,r),this._config.role=t,this._gateway.reconnect("recover",Os.REGIONAL_DISTRIBUTION)):(await this._gateway.setClientRole(t,r),this._config.role=t),x.info("[".concat(this._clientId,"] set client role to ").concat(t,", level: ").concat(r&&r.level))}async _setClientRoleOptions(t){if(this.mode==="rtc"||this.mode==="p2p"||this._config.role!=="audience"||this._p2pChannel.hasLocalMedia())return;let r=!1;try{t&&_L(t),await this._gateway.setClientRole(this._config.role,t),r=!0}catch{}finally{x.info("[".concat(this._clientId,"] set client role options ").concat(r?"succeed":"failed",", options is ").concat(t))}}getRemoteInboundOffset(){var t;const r=(t=this._p2pChannel.getStats())===null||t===void 0?void 0:t.audioSend[0];if(!r||!r.timestamp)return 0;const s=r.timestamp-Date.now();return Math.abs(s)>1e3+r.rttMs+100?this.ntpAlignErrorCount+=1:this.ntpAlignErrorCount=0,this.ntpAlignErrorCount>=3?s:0}getNtpWallTimeInMs(){return document.visibilityState==="visible"&&(this.remoteInboundOffset=this.getRemoteInboundOffset()),this.remoteInboundOffset+Date.now()+this._gateway.ntpOffset}setProxyServer(t,r){if(fs(t,"proxyServer"),!r){if(this.connectionState!=="DISCONNECTED")throw new Oe(te.INVALID_OPERATION,"Set proxy server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new Oe(te.INVALID_OPERATION,"You have already set the proxy")}this._proxyServer=t,It.setProxyServer(this._proxyServer),x.setProxyServer(this._proxyServer),x.info("[".concat(this._clientId,"] Set proxy server ").concat(r?"by initialize call":""," success."))}setTurnServer(t,r){if(Array.isArray(t)||(t=[t]),!r){if(this.connectionState!=="DISCONNECTED")throw new Oe(te.INVALID_OPERATION,"Set turn server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new Oe(te.INVALID_OPERATION,"You have already set the proxy")}if(RT(t))return this._turnServer={servers:t,mode:"original-manual"},void x.info("[".concat(this._clientId,"] Set original turnserver ").concat(r?"by initialize call":""," success: ").concat(t.map(s=>s.urls).join(","),"."));t.forEach(s=>M8(s)),this._turnServer={servers:t,mode:"manual"},x.info("[".concat(this._clientId,"] Set turnserver ").concat(r?"by initialize call":""," success."))}setLicense(t){if(this.connectionState!=="DISCONNECTED")throw new Oe(te.INVALID_OPERATION,"you should set license before join channel");if(fs(t,"license",32,32),!/^[A-Za-z\d]+$/.test(t))throw new Oe(te.INVALID_PARAMS,"license should only contains characters from A-Z a-z 0-9");this._license=t,x.info("[".concat(this._clientId,"] set license success"),t)}startProxyServer(t){if(this.connectionState!=="DISCONNECTED")throw new Oe(te.INVALID_OPERATION,"Start proxy server before join channel");if(this._proxyServer||this._turnServer.mode==="manual"||this._useLocalAccessPoint)throw new Oe(te.INVALID_OPERATION,"You have already set the proxy");const r=[3,4,5];let s;switch(t===void 0&&(t=3),t){case 1:case 2:throw new Oe(te.NOT_SUPPORTED,"proxy mode 1/2 has been deprecated and not supported.");case 3:s="proxy3";break;case 4:s="proxy4";break;case 5:s="proxy5";break;default:throw new Oe(te.INVALID_PARAMS,"proxy server mode must be ".concat(r.join("|")))}this._cloudProxyServerMode=s,this.store.cloudProxyServerMode=s,x.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode)}stopProxyServer(){if(this.connectionState!=="DISCONNECTED")throw new Oe(te.INVALID_OPERATION,"Stop proxy server after leave channel");It.setProxyServer(),x.setProxyServer(),this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled",x.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode),this._proxyServer=void 0,this._turnServer={mode:"auto",servers:[]}}setLocalAccessPointsV2(t){if(!t.accessPoints)throw new Oe(te.INVALID_PARAMS,"accessPoints is required.");ip(t.accessPoints.serverList,"accessPoints.serverList"),fs(t.accessPoints.domain,"accessPoints.domain");const r=(P,N)=>{ir(P,N,0,65535,!0)};let s=443;if(t.accessPoints.port&&(r(t.accessPoints.port,"accessPoints.port"),s=t.accessPoints.port),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new Oe(te.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");oe("CLOSE_AFB_FOR_LOCAL_AP")&&(tr("JOIN_WITH_FALLBACK_SIGNAL_PROXY",!1),tr("JOIN_WITH_FALLBACK_MEDIA_PROXY",!1));const a=/^((\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.){3}(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/,c=t.accessPoints.domain,u=t.accessPoints.serverList.map(P=>a.test(P)?"".concat(P.replace(/\./g,"-"),".").concat(c):P),h=u.map(P=>"".concat(P,":").concat(s));this._useLocalAccessPoint=!0,this._setLocalAPVersion=2,tr("WEBCS_DOMAIN",h),tr("WEBCS_DOMAIN_BACKUP_LIST",h),tr("GATEWAY_DOMAINS",[c]),t.report&&t.report.hostname&&Array.isArray(t.report.hostname)&&t.report.hostname.length?(ip(t.report.hostname,"report.hostname"),tr("EVENT_REPORT_DOMAIN",t.report.hostname[0]),tr("EVENT_REPORT_BACKUP_DOMAIN",t.report.hostname[1]||t.report.hostname[0])):(tr("EVENT_REPORT_DOMAIN",u[0]),tr("EVENT_REPORT_BACKUP_DOMAIN",u[1]||u[0]));let m=6443;t.report&&t.report.port&&(r(t.report.port,"report.port"),m=t.report.port),tr("STATS_COLLECTOR_PORT",m),t.report?tr("ENABLE_EVENT_REPORT",!0):tr("ENABLE_EVENT_REPORT",!1);let y="";t.log&&t.log.hostname&&Array.isArray(t.log.hostname)&&t.log.hostname.length?(ip(t.log.hostname,"log.hostname"),y=t.log.hostname[0]):y=u[0];let v=6444;t.log&&t.log.port&&(r(t.log.port,"log.port"),v=t.log.port),tr("LOG_UPLOAD_SERVER","".concat(y,":").concat(v));let S=[];t.cds&&t.cds.hostname&&Array.isArray(t.cds.hostname)&&t.cds.hostname.length?(ip(t.cds.hostname,"cds.hostname"),S=t.cds.hostname):S=u;let R=443;t.cds&&t.cds.port&&(r(t.cds.port,"cds.port"),R=t.cds.port),tr("CDS_AP",S.map(P=>"".concat(P,":").concat(R))),t.cds?tr("ENABLE_CONFIG_DISTRIBUTE",!0):tr("ENABLE_CONFIG_DISTRIBUTE",!1),x.info("set local access point v2 success")}setLocalAccessPoints(t,r){if(ip(t,"serverList"),fs(r,"domain"),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new Oe(te.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");const s=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/;t=t.map(a=>s.test(a)?"".concat(a.replace(/\./g,"-"),".").concat(r):a),this._useLocalAccessPoint=!0,this._setLocalAPVersion=1,tr("WEBCS_DOMAIN",t),tr("WEBCS_DOMAIN_BACKUP_LIST",t),tr("GATEWAY_DOMAINS",[r]),tr("EVENT_REPORT_DOMAIN",t[0]),tr("EVENT_REPORT_BACKUP_DOMAIN",t[1]||t[0]),tr("LOG_UPLOAD_SERVER","".concat(t[0],":6444")),x.info("[".concat(this._clientId,"] set local access point success"))}async setRemoteDefaultVideoStreamType(t){if(Bi(t,"streamType",[0,1,4,5,6,7,8,9]),this._remoteDefaultVideoStreamType=t,this._joinInfo)try{await this._gateway.setDefaultRemoteVideoStreamType(t),this._joinInfo.defaultVideoStream=this._remoteDefaultVideoStreamType}catch(r){throw x.error("[".concat(this._clientId,"] set default remote video stream type error"),r.toString()),r}else x.debug("[".concat(this._clientId,"] haven't joined yet, cache remoteDefaultVideoStreamType ").concat(t))}async setRemoteVideoStreamType(t,r){Bi(r,"streamType",[0,1,4,5,6,7,8,9]);try{await this._gateway.setRemoteVideoStreamType(t,r),setTimeout(()=>{const s=this._users.find(a=>a.uid===t);s&&s.videoTrack&&s.videoTrack.updateMediaStreamTrackResolution()},2e3)}catch(s){throw x.error("[".concat(this._clientId,"] set remote video stream type error"),s.toString()),s}x.info("[".concat(this._clientId,"] set remote ").concat(t," video stream type to ").concat(r)),this._remoteStreamTypeCacheMap.set(t,r)}async setStreamFallbackOption(t,r){Bi(r,"fallbackType",[0,1,2,3,4,5,6,7,8]);try{await this._gateway.setStreamFallbackOption(t,r)}catch(s){throw x.error("[".concat(this._clientId,"] set stream fallback option"),s.toString()),s}x.info("[".concat(this._clientId,"] set remote ").concat(t," stream fallback type to ").concat(r)),this._streamFallbackTypeCacheMap.set(t,r)}setEncryptionConfig(t,r,s,a){(function(u){Bi(u,"encryptionMode",["aes-128-xts","aes-256-xts","aes-128-ecb","sm4-128-ecb","aes-128-gcm","aes-256-gcm","aes-128-gcm2","aes-256-gcm2","none"])})(t),fs(r,"secret");const c=["aes-128-gcm2","aes-256-gcm2"];if(ot(c).call(c,t)){if(!s||!(s instanceof Uint8Array&&s.length===32))throw new Oe(te.INVALID_PARAMS,"salt must be an Uint8Array and exactly equal to 32 bytes")}else if(s)throw new Oe(te.INVALID_PARAMS,"current encrypt mode does not need salt");if(a){if(rp(a,"encryptDataStream"),!ot(c).call(c,t))throw new Oe(te.INVALID_PARAMS,"current encrypt mode does not support data stream");this._encryptDataStream=!0}new RegExp(`^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*,.<>?/:;'"|{}\\[\\]])(?=.{8,})`).test(r)||x.warning(`The secret is not strong:
      The secret must contain at least 1 lowercase alphabetical character,
      The secret must contain at least 1 uppercase alphabetical character,
      The secret must contain at least 1 numeric character,
      The secret must contain at least one special character,
      The secret must be eight characters or longer.
      `),this._encryptionMode=t,this._encryptionSecret=r,s&&(this._encryptionSalt=jm(s))}async renewToken(t){if(fs(t,"token",1,2047),!this._key||!this._joinInfo)throw new Oe(te.INVALID_OPERATION,"renewToken should not be called before user join");const r=this._key;this._key=t,this._joinInfo&&(this._joinInfo.token=t);const s=await this._renewTokenMutex.lock();try{if(oe("USE_NEW_TOKEN")){x.debug("[".concat(this._clientId,"] start renew token with ticket from unilbs"));const a=await xge(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||Pi);x.debug("[".concat(this._clientId,"] get ticket from unilbs success")),await this._gateway.renewToken({token:t,ticket:a})}else x.debug("[".concat(this._clientId,"] start renew token without ticket")),await this._gateway.renewToken({token:t});x.debug("[".concat(this._clientId,"] renewToken success"))}catch(a){throw this._key=r,this._joinInfo.token=r,x.error("[".concat(this._clientId,"] renewToken failed"),a.toString()),a}finally{s()}}enableAudioVolumeIndicator(){this._audioVolumeIndicationInterval?x.warning("you have already enabled audio volume indicator!"):this._audioVolumeIndicationInterval=window.setInterval(()=>{const t=this._p2pChannel.getAudioLevels();this.safeEmit(yn.VOLUME_INDICATOR,t)},oe("AUDIO_VOLUME_INDICATION_INTERVAL")||2e3)}getRTCStats(){const t=this._statsCollector.getRTCStats(),r=this._gateway.getInChannelInfo();return t.Duration=Math.round(r.duration/1e3),t}async startLiveStreaming(t,r){if(!r){if(this.codec!=="h264")throw new Oe(te.LIVE_STREAMING_INVALID_RAW_STREAM,"raw streaming is only support h264");if(!this._p2pChannel.hasLocalMedia())throw new Oe(te.LIVE_STREAMING_INVALID_RAW_STREAM,"can not find stream to raw streaming")}if(this._liveRawStreamingClient&&this._liveRawStreamingClient.hasUrl(t)||this._liveTranscodeStreamingClient&&this._liveTranscodeStreamingClient.hasUrl(t))throw new Oe(te.LIVE_STREAMING_TASK_CONFLICT);const s=r?ap.TRANSCODE:ap.RAW;return this._createLiveStreamingClient(s).startLiveStreamingTask(t,s)}setLiveTranscoding(t){return this._createLiveStreamingClient(ap.TRANSCODE).setTranscodingConfig(t)}async stopLiveStreaming(t){const r=[this._liveRawStreamingClient,this._liveTranscodeStreamingClient].filter(s=>s&&s.hasUrl(t));if(!r.length)throw new Oe(te.INVALID_PARAMS,"can not find live streaming url to stop");await dt.all(r.map(s=>s&&s.stopLiveStreamingTask(t)))}async startChannelMediaRelay(t){v9(t),await this._createChannelMediaRelayClient().startChannelMediaRelay(t)}async updateChannelMediaRelay(t){v9(t),await this._createChannelMediaRelayClient().updateChannelMediaRelay(t)}async stopChannelMediaRelay(){await this._createChannelMediaRelayClient().stopChannelMediaRelay(),this._statsCollector.onStatsChanged&&(this._statsCollector.onStatsChanged=void 0)}sendAudioMetadata(t){this._p2pChannel instanceof $T&&this._p2pChannel.addAudioMetadata(t)}async sendStreamMessage(t){var r;let s=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!this._joinInfo)throw new Oe(te.INVALID_OPERATION,"can not send data stream, not joined");if((typeof t=="string"||t instanceof Uint8Array)&&(t={payload:t}),typeof t.payload=="string"){const c=new TextEncoder;t.payload=c.encode(t.payload)}let a=!1;if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&ot(r=["aes-128-gcm2","aes-256-gcm2"]).call(r,this._encryptionMode)&&(a=!0,t.payload=await async function(c,u,h){var m;const y=lc(m=Array.from(h)).call(m,(F,j)=>F+j,0),v={serverTs:0,seq:nme++,length:h.length,checkSum:y},S=new Uint8Array(G8(y,2)),R=new ArrayBuffer(Wv),P=new DataView(R);P.setUint32(0,v.serverTs),P.setUint16(4,v.seq),P.setUint16(6,v.length),P.setUint16(8,v.checkSum);const N=16-h.length%16;h=F8(h,new Uint8Array(N));const G=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:c,tagLength:rz,additionalData:S},u,h);return F8(new Uint8Array(R),new Uint8Array(G))}(this._encryptDataStreamIv,this._encryptDataStreamKey,t.payload)),new Blob([t.payload]).size>1024)throw new Oe(te.INVALID_PARAMS,a?"encrypted stream message out of range.":"stream message out of range.");return this._gateway.signal.request(zt.DATA_STREAM,{payload:jm(t.payload),syncWithAudio:t.syncWithAudio,sendTs:Date.now()-zge},!s)}sendMetadata(t){if(!this._joinInfo)throw new Oe(te.INVALID_OPERATION,"can not send metadata, not joined");if(new Blob([t]).size>1024)throw new Oe(te.METADATA_OUT_OF_RANGE);return this._gateway.signal.request(zt.SEND_METADATA,{session_id:this._joinInfo.sid,metadata:jm(t)})}async sendCustomReportMessage(t){if(Array.isArray(t)||(t=[t]),t.forEach(dme),!this._joinInfo)throw new Oe(te.INVALID_OPERATION,"can not send custom report, not joined");await It.sendCustomReportMessage(this._joinInfo.sid,t)}getLocalAudioStats(){return this._statsCollector.getLocalAudioTrackStats()}getRemoteAudioStats(){return this._statsCollector.getRemoteAudioTrackStats()}getLocalVideoStats(){return this._statsCollector.getLocalVideoTrackStats()}getRemoteVideoStats(){return this._statsCollector.getRemoteVideoTrackStats()}getRemoteNetworkQuality(){return this._statsCollector.getRemoteNetworkQualityStats()}async pickSVCLayer(t,r){Bi(r.spatialLayer,"spatialLayer",[0,1,2,3]),Bi(r.temporalLayer,"temporalLayer",[0,1,2,3]);try{await this._gateway.pickSVCLayer(t,r)}catch(s){throw x.error("[".concat(this._clientId,"] pick SVC layer failed"),s.toString()),s}}async setRTMConfig(t){const{apRTM:r=!1,rtmFlag:s}=t;if(rp(r,"apRTM"),ir(s,"rtmFlag",0),this._rtmConfig.apRTM=r,this._rtmConfig.rtmFlag=s,x.debug("[".concat(this._clientId,"] setRTMconfig ").concat(JSON.stringify(t)," in ").concat(this.connectionState," state")),(this.connectionState==="CONNECTED"||this.connectionState==="RECONNECTING")&&this._joinInfo)return this._joinInfo.apRTM=r,this._joinInfo.rtmFlag=s,this._gateway.setRTM2Flag(s)}_reset(){if(x.debug("[".concat(this._clientId,"] reset client")),function(t){const r=tS.indexOf(t);r!==-1&&tS.splice(r,1)}(this._clientId),this.store.hasStartJoinChannel=!1,this.store.isABTestSuccess=!1,this._axiosCancelSource.cancel(),this._axiosCancelSource=la.CancelToken.source(),this._streamFallbackTypeCacheMap=new Map,this._remoteStreamTypeCacheMap=new Map,this._configDistribute.stopGetConfigDistribute(),this._joinInfo&&Y9(this._joinInfo),this._joinInfo=void 0,this._proxyServer=void 0,this._defaultStreamFallbackType=void 0,this._sessionId&&It.removeSid(this._sessionId),this._sessionId=null,this.store.sessionId=null,this._statsCollector.reset(),this._key=void 0,this._appId=void 0,this._uid=void 0,this.store.uid=void 0,this._channelName=void 0,this._encryptionMode="none",this._encryptionSecret=null,this._encryptionSalt=null,this._encryptDataStreamKey=null,this._encryptDataStreamIv=null,this._pendingPublishedUsers=[],this._users.forEach(t=>{t._audioTrack&&t._audioTrack._destroy(),t._videoTrack&&t._videoTrack._destroy(),t._dataChannels&&(t._dataChannels.forEach(r=>r._close()),t._dataChannels.length=0)}),this._users=[],this._audioVolumeIndicationInterval&&(window.clearInterval(this._audioVolumeIndicationInterval),this._audioVolumeIndicationInterval=void 0),this._cloudProxyServerMode==="fallback"&&(this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled"),this._p2pChannel.reset(),this._publishMutex=new js("client-publish",this._clientId),this._subscribeMutex=new js("client-subscribe",this._clientId),this._networkQualityInterval&&(window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=void 0),this._liveRawStreamingClient&&(this._liveRawStreamingClient.terminate(),this._liveRawStreamingClient.removeAllListeners(),this._liveRawStreamingClient=void 0),this._liveTranscodeStreamingClient&&(this._liveTranscodeStreamingClient.terminate(),this._liveTranscodeStreamingClient.removeAllListeners(),this._liveTranscodeStreamingClient=void 0),this._channelMediaRelayClient&&(this._channelMediaRelayClient.dispose(),this._channelMediaRelayClient=void 0),this._inspect)try{this._inspect.close(),this._inspect=void 0}catch{}if(this._moderation)try{this.setImageModeration(!1)}catch{}}_startSession(t,r){var s;const a=t||j_();t?x.debug("[".concat(this._clientId,"] new Session ").concat(a)):x.debug("[".concat(this._clientId,"] renewSession ").concat(this._sessionId," => ").concat(a));const c=t?"":this._sessionId||"";this._sessionId=a,this.store.sessionId=a,It.addSid(a);const u={lts:new Date().getTime(),mode:this.mode,buildFormat:1,stringUid:(r==null?void 0:r.stringUid)||((s=this._joinInfo)===null||s===void 0?void 0:s.stringUid),channelProfile:this.mode==="live"?1:0,channelMode:0,isABTestSuccess:Number(this._configDistribute.isSuccess),lsid:c,clientRole:this.role==="audience"?2:1};It.sessionInit(this._sessionId,wu({cname:r.channel,appid:r.appId},u)),this._joinInfo&&(this._joinInfo.sid=a),this._gateway.joinInfo&&(this._gateway.joinInfo.sid=a)}async _publishHighStream(t){if(!this._joinInfo||this._uid===void 0)throw new Oe(te.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Oe(te.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&oe("FORCE_TURN")&&!oe("TURN_ENABLE_TCP")&&!oe("TURN_ENABLE_UDP"))throw new Oe(te.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");x.debug("[".concat(this._clientId,"] publish high stream"));try{const s=await this._p2pChannel.publish(t,this._isDualStreamEnabled,this._lowStreamParameter);if(this.store.useP2P){const a=(await s.next()).value;if(a){try{await this._gateway.sendExtensionMessage(li.PUBLISH,a,!0)}catch(c){throw s.throw(c),c}await s.next()}this._p2pChannel.reportPublishEvent(!0,null)}else{const a=(await s.next()).value;if(a){var r;let c;try{c=await this._gateway.publish(this._uid,a,!0)}catch(u){if(u.code!==te.DISCONNECT_P2P)throw s.throw(u),u}await s.next(((r=c)===null||r===void 0?void 0:r.ortc)||[])}this._p2pChannel.reportPublishEvent(!0,null);for(const c of t)c instanceof Sr&&c._encoderConfig&&this._gateway.setVideoProfile(c._encoderConfig).catch(u=>{x.debug("[".concat(this._clientId,"] stop setVideoProfile, because websocket is closed"))}),!c.muted&&c.enabled||await this._p2pChannel.muteLocalTrack(c)}}catch(s){if(this._p2pChannel.reportPublishEvent(!1,s==null?void 0:s.code,t),(s==null?void 0:s.code)===te.WS_ABORT)return;throw s}}async _publishLowStream(){if(!this._joinInfo||this._uid===void 0)throw new Oe(te.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Oe(te.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));x.debug("[".concat(this._clientId,"] publish low stream"));const t=this._configDistribute.getLowStreamConfigDistribute();t&&t.bitrate&&(this._lowStreamParameter||(this._lowStreamParameter={width:160,height:120,framerate:15,bitrate:50}),this._lowStreamParameter&&this._lowStreamParameter.bitrate&&t.bitrate<this._lowStreamParameter.bitrate&&(this._lowStreamParameter.bitrate=t.bitrate));try{const s=await this._p2pChannel.publishLowStream(this._lowStreamParameter),a=(await s.next()).value;if(a){var r;let c;try{c=await this._gateway.publish(this._uid,a,!0)}catch(u){if(u.code!==te.DISCONNECT_P2P)throw s.throw(u),u}s.next(((r=c)===null||r===void 0?void 0:r.ortc)||[]),this._p2pChannel.reportPublishEvent(!0,null,void 0,!0)}}catch(s){if(this._p2pChannel.reportPublishEvent(!1,s==null?void 0:s.code,void 0,!0),(s==null?void 0:s.code)===te.WS_ABORT)return;throw s}}_createLiveStreamingClient(t){const r=()=>{if(!this._joinInfo||!this._appId)return new Oe(te.INVALID_OPERATION,"can not create live streaming client, please join channel first").throw();const s=(a={joinInfo:this._joinInfo,appId:this._appId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig},up("LiveStreaming").create(a));var a;return s.onLiveStreamError=(c,u)=>{It.reportApiInvoke(this._sessionId,{name:Ai.ON_LIVE_STREAM_ERROR,options:[c,u],tag:zr.TRACER}).onSuccess(),this.safeEmit(yn.LIVE_STREAMING_ERROR,c,u)},s.onLiveStreamWarning=(c,u)=>{It.reportApiInvoke(this._sessionId,{name:Ai.ON_LIVE_STREAM_WARNING,options:[c,u],tag:zr.TRACER}).onSuccess(),this.safeEmit(yn.LIVE_STREAMING_WARNING,c,u)},s.on(a2.REQUEST_WORKER_MANAGER_LIST,(c,u,h)=>{if(!this._joinInfo)return h(new Oe(te.INVALID_OPERATION,"can not find join info to get worker manager"));(async function(m,y,v,S){const R=oe("UAP_AP").slice(0,oe("AJAX_REQUEST_CONCURRENT")).map(P=>y.proxyServer?"https://".concat(y.proxyServer,"/ap/?url=").concat(P+"/api/v1?action=uap"):"https://".concat(P,"/api/v1?action=uap"));return await Age(R,m,y,v,S)})(c,this._joinInfo,this._axiosCancelSource.token,Pi).then(u).catch(h)}),s};return t===ap.RAW?(this._liveRawStreamingClient=this._liveRawStreamingClient||r(),this._liveRawStreamingClient):(this._liveTranscodeStreamingClient=this._liveTranscodeStreamingClient||r(),this._liveTranscodeStreamingClient)}_createChannelMediaRelayClient(){if(!this._joinInfo)return new Oe(te.INVALID_OPERATION,"can not create channel media relay client, please join channel first").throw();if(!this._channelMediaRelayClient){const{sendResolutionWidth:r,sendResolutionHeight:s}=this.getLocalVideoStats(),a=(t={joinInfo:this._joinInfo,clientId:this._clientId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig,resolution:{width:r,height:s}},up("ChannelMediaRelay").create(t));a.on("state",c=>{c===Wa.RELAY_STATE_FAILURE&&a&&a.dispose(),this.safeEmit(yn.CHANNEL_MEDIA_RELAY_STATE,c)}),a.on("event",c=>{this.safeEmit(yn.CHANNEL_MEDIA_RELAY_EVENT,c)}),this._channelMediaRelayClient=a,this._statsCollector.onStatsChanged=(c,u)=>{var h;c==="resolution"&&((h=this._channelMediaRelayClient)===null||h===void 0||h.setVideoProfile(u))}}var t;return this._channelMediaRelayClient}_handleUpdateDataChannel(t,r){const{added:s,deleted:a}=t,c=[];if(r){const u=[];this._users.forEach(h=>{h._dataChannels.forEach(m=>{s.every(y=>y.uid!==h._uintid||y.stream_id!==m.id)&&u.push({uid:h._uintid,stream_id:m.id,ordered:m.ordered,max_retrans_times:m.maxRetransmits,metadata:m.metadata})})}),u.length>0&&this._handleUpdateDataChannel({added:[],deleted:u})}Array.isArray(s)&&s.length>0&&s.forEach(u=>{const{uid:h,stream_id:m,ordered:y,max_retrans_times:v,metadata:S}=u,R=this._users.find(P=>P._uintid===h);if(!R)return void x.error("[".concat(this._clientId,"] can not find target user!(on_add_data_channel)"));if(x.debug("[".concat(this._clientId,"] data_channel added with uid ").concat(h)),ot(c).call(c,R)||c.push(R),R._uintid||(R._uintid=h),R._dataChannels.findIndex(P=>P.id===u.stream_id)===-1){const P={id:m,ordered:!!y,maxRetransmits:v,metadata:S},N=function(G){return r9(G,!0)}(P);R._dataChannels.push(N),x.info("[".concat(this._clientId,"] remote user ").concat(R.uid," published datachannel")),r||this.safeEmit(yn.USER_PUBLISHED,R,"datachannel",P)}this._p2pChannel.hasPendingRemoteDataChannel(R,u.stream_id)&&(x.debug("[".concat(this._clientId,"] resubscribe datachannel for user ").concat(R.uid," after reconnect.")),this._subscribeDataChannel(R,u.stream_id).catch(P=>{x.error("[".concat(this._clientId,"] resubscribe datachannel error"),P.toString())}))}),r&&(this.safeEmit(yn.PUBLISHED_USER_LIST,this._pendingPublishedUsers),this._pendingPublishedUsers=[]),Array.isArray(a)&&a.length>0&&a.forEach(u=>{const{uid:h,stream_id:m}=u,y=this._users.find(S=>S._uintid===h);if(!y)return void x.error("[".concat(this._clientId,"] can not find target user!(on_delete_data_channel)"));const v=y._dataChannels.find(S=>S.id===u.stream_id);v&&(x.debug("[".concat(this._clientId,"] data_stream delete with uid ").concat(h)),this._p2pChannel.unsubscribeDataChannel(y,[v]).then(S=>{if(y._dataChannels=y._dataChannels.filter(R=>R!==v),S)return this._gateway.unsubscribeDataChannel(S,y.uid)}),x.info("[".concat(this._clientId,"] remote user ").concat(h," unpublished datachannel ,id:").concat(v.id)),this.safeEmit(yn.USER_UNPUBLISHED,y,"datachannel",v._config))})}_handleRemoveDataChannels(t){const r=this._users.find(s=>s.uid===t.uid);if(r){if(r._dataChannels!==void 0&&r._dataChannels.length>0){x.debug("[".concat(this._clientId,"] datachannel removed with uid ").concat(t.uid));const s=()=>{x.info("[".concat(this._clientId,"] remote user ").concat(r.uid," unpublished datachannel")),r._dataChannels.forEach(a=>{this.safeEmit(yn.USER_UNPUBLISHED,r,"datachannel",a._config)})};this._p2pChannel.unsubscribeDataChannel(r,r._dataChannels).then(a=>{if(a)return this._gateway.unsubscribeDataChannel(a,r.uid)}),s()}}else x.warning("[".concat(this._clientId,"] can not find target user!(on_remove_datachannel)"))}_handleGatewayEvents(){this._gateway.on(as.UPDATE_GATEWAY_CONFIG,()=>{(function(){let t;try{t=window.localStorage.getItem("websdk_ng_global_parameter")}catch(r){return void x.error("Error loading sdk config",r.message)}if(t)try{const r=JSON.parse(window.atob(t)),s=Date.now();Object.keys(r).forEach(a=>{const{value:c,type:u,expires:h}=r[a];h&&h<=s||u||e2()||!Object.prototype.hasOwnProperty.call(eP,a)||(yd[a]=c,vr[a]=c,x.debug("Update gateway parameters from config distribute",a,c))})}catch(r){x.error("Error update config from local cache",r.message)}})()}),this._gateway.on(as.DISCONNECT_P2P,async()=>{await this._p2pChannel.disconnectForReconnect()}),this._gateway.on(as.CONNECTION_STATE_CHANGE,(t,r,s)=>{var a;if(s===Kn.FALLBACK)return;const c=()=>{this.safeEmit(yn.CONNECTION_STATE_CHANGE,t,r,s)};if(It.reportApiInvoke(this._sessionId||((a=this._gateway.joinInfo)===null||a===void 0?void 0:a.sid)||null,{name:Ai.CONNECTION_STATE_CHANGE,options:[t,r,s],tag:zr.TRACER}).onSuccess(JSON.stringify({cur:t,prev:r,reason:s})),x.info("[".concat(this._clientId,"] signal connection state change: ").concat(r," -> ").concat(t)),t==="DISCONNECTED")return this._reset(),void c();if(t==="RECONNECTING")this._users.forEach(h=>{h._trust_in_room_=!1,h._trust_audio_enabled_state_=!1,h._trust_video_enabled_state_=!1,h._trust_audio_mute_state_=!1,h._trust_video_mute_state_=!1,h._trust_audio_stream_added_state_=!1,h._trust_video_stream_added_state_=!1,h._is_pre_created||(h._audio_pre_subscribed||(h._audioSSRC=void 0,h._audioOrtc=void 0),h._video_pre_subscribed||(h._videoSSRC=void 0,h._videoOrtc=void 0,h._rtxSsrcId=void 0),h._cname=void 0)}),this._userOfflineTimeout&&window.clearTimeout(this._userOfflineTimeout),this._streamRemovedTimeout&&window.clearTimeout(this._streamRemovedTimeout),this._userOfflineTimeout=void 0,this._streamRemovedTimeout=void 0;else if(t==="CONNECTED"){var u;this._streamFallbackTypeCacheMap.forEach((h,m)=>{this._gateway.setStreamFallbackOption(m,h).catch(y=>{x.warning("[".concat(this._clientId,"] auto set stream fallback option failed"),y)})}),this._remoteStreamTypeCacheMap.forEach((h,m)=>{this._gateway.setRemoteVideoStreamType(m,h).catch(y=>{x.warning("[".concat(this._clientId,"] auto set remote stream type failed"),y)})}),this._remoteDefaultVideoStreamType!==void 0&&((u=this._joinInfo)===null||u===void 0?void 0:u.defaultVideoStream)===void 0&&this.setRemoteDefaultVideoStreamType(this._remoteDefaultVideoStreamType).then(()=>{x.debug("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway connected"))}).catch(h=>{x.error("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway failed, ").concat(h))}),this.store.useP2P||(this._p2pChannel.republish(),this._userOfflineTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._userOfflineTimeout=void 0,this._users.filter(h=>!h._trust_in_room_).forEach(h=>{x.debug("[".concat(this._clientId,"] user offline timeout, emit user offline ").concat(h.uid)),this._handleUserOffline({uid:h.uid})}))},3e3),this._streamRemovedTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._streamRemovedTimeout=void 0,this._users.forEach(h=>{h._trust_audio_mute_state_||(x.debug("[".concat(this._clientId,"] auto dispatch audio unmute event ").concat(h.uid)),this._handleMuteStream(h.uid,_t.AUDIO,!1)),h._trust_video_mute_state_||(x.debug("[".concat(this._clientId,"] auto dispatch video unmute event ").concat(h.uid)),this._handleMuteStream(h.uid,_t.VIDEO,!1)),h._trust_audio_enabled_state_||(x.debug("[".concat(this._clientId,"] auto dispatch enable local audio ").concat(h.uid)),this._handleSetStreamLocalEnable("audio",h.uid,!0)),h._trust_video_enabled_state_||(x.debug("[".concat(this._clientId,"] auto dispatch enable local video ").concat(h.uid)),this._handleSetStreamLocalEnable("video",h.uid,!0)),h._trust_video_stream_added_state_||(x.debug("[".concat(this._clientId,"] auto dispatch reset video stream added ").concat(h.uid)),this._handleResetAddStream(h,"video")),h._trust_audio_stream_added_state_||(x.debug("[".concat(this._clientId,"] auto dispatch reset audio stream added ").concat(h.uid)),this._handleResetAddStream(h,"audio")),h._video_added_||h._audio_added_||(x.debug("[".concat(this._clientId,"] auto dispatch stream remove ").concat(h.uid)),this._handleRemoveStream({uid:h.uid,uint_id:h._uintid}))}))},1e3))}c()}),this._gateway.on(as.REQUEST_NEW_GATEWAY_LIST,async(t,r)=>{if(!this._joinInfo)return r(new Oe(te.UNEXPECTED_ERROR,"can not recover, no join info"));try{let s;const a=await K9(wu(wu({},this._joinInfo),{},{uid:this._joinInfo.uid,stringUid:void 0}));a?(s=a.ap,X9(a),this._joinInfo.preload=!0):(s=await T2(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||Pi,this.store),this._joinInfo.preload=!1),this._joinInfo&&(this._joinInfo.apResponse=s.gatewayInfo.res,this._joinInfo.gatewayAddrs=s.gatewayInfo.gatewayAddrs,this._joinInfo.uni_lbs_ip=s.gatewayInfo.uni_lbs_ip);const c=[];s.gatewayInfo.gatewayAddrs.forEach(u=>{let{address:h}=u;const[m,y]=h.split(":");this._joinInfo&&this._joinInfo.proxyServer?c.push({proxy:this._joinInfo.proxyServer,host:m,port:y}):c.push({host:m,port:y})}),t(c)}catch(s){r(s)}}),this._gateway.on(as.NETWORK_QUALITY,t=>{this._networkQualitySensitivity==="normal"&&this.safeEmit(yn.NETWORK_QUALITY,t)}),this._gateway.on(as.STREAM_TYPE_CHANGE,(t,r)=>{this.safeEmit(yn.STREAM_TYPE_CHANGED,t,r),It.reportApiInvoke(this._sessionId,{name:Ai.STREAM_TYPE_CHANGE,options:[t,r],tag:zr.TRACER}).onSuccess(JSON.stringify({uid:t,streamType:r}))}),this._gateway.on(as.IS_P2P_DISCONNECTED,t=>{this._p2pChannel.isP2PDisconnected()?t(!0):this._p2pChannel.hasLocalMedia()||this._p2pChannel.hasRemoteMedia()?t(!1):t(!0)}),this._gateway.on(as.REQUEST_P2P_CONNECTION_PARAMS,async(t,r,s)=>{try{let a=await this._p2pChannel.getEstablishParams();oe("ENABLE_PREALLOC_PC")&&a||(a=await this._p2pChannel.startP2PConnection(t)),r(a)}catch(a){s(a)}}),this._gateway.on(as.JOIN_RESPONSE,(t,r)=>{if(this.store.useP2P)return;let s;t.attributes?s=t.attributes.userAttributes.preSubSsrcs:x.debug("no attributes in joinResponse");const a=HH(t.ortc,r,s);this._p2pChannel.connect(a)}),this._gateway.on(as.PRE_CONNECT_PC,async t=>{const{candidates:r,fingerprint:s}=t;if(this._joinInfo&&r.length>0&&!this._p2pChannel.isPlanB){var a;await this._p2pChannel.startP2PConnection({turnServer:this._joinInfo.turnServer});const{cert:c,cid:u}=this._joinInfo.apResponse;await this._p2pChannel.connect({iceParameters:{iceUfrag:"".concat(u,"_").concat(c),icePwd:"".concat(u,"_").concat(c)},dtlsParameters:{fingerprints:[{hashFunction:"sha-256",fingerprint:(a=oe("FINGERPRINT"))!==null&&a!==void 0?a:s}]},candidates:r,rtpCapabilities:{send:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},recv:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]}},setup:"active",cname:"o/i14u9pJrxRKAsu",preallocation:!0})}})}_handleGatewaySignalEvents(){this._gateway.signal.on(vn.ON_USER_ONLINE,this._handleUserOnline),this._gateway.signal.on(vn.ON_USER_OFFLINE,this._handleUserOffline),this._gateway.signal.on(vn.ON_ADD_AUDIO_STREAM,t=>this._handleAddAudioOrVideoStream("audio",t.uid,t.ssrcId,t.cname,t.uint_id,t.ortc)),this._gateway.signal.on(vn.ON_ADD_VIDEO_STREAM,t=>this._handleAddAudioOrVideoStream("video",t.uid,t.ssrcId,t.cname,t.uint_id,t.ortc,t.rtxSsrcId)),this._gateway.signal.on(vn.ON_REMOTE_DATASTREAM_UPDATE,t=>{this._handleUpdateDataChannel(t)}),this._gateway.signal.on(vn.ON_REMOTE_FULL_DATASTREAM_INFO,t=>{this._handleUpdateDataChannel({added:t.datastreams||[],deleted:[]},!0)}),this._gateway.signal.on(vn.ON_REMOVE_STREAM,this._handleRemoveStream),this._gateway.signal.on(vn.ON_P2P_LOST,this._handleP2PLost),this._gateway.signal.on(vn.MUTE_AUDIO,t=>this._handleMuteStream(t.uid,_t.AUDIO,!0)),this._gateway.signal.on(vn.UNMUTE_AUDIO,t=>this._handleMuteStream(t.uid,_t.AUDIO,!1)),this._gateway.signal.on(vn.MUTE_VIDEO,t=>this._handleMuteStream(t.uid,_t.VIDEO,!0)),this._gateway.signal.on(vn.UNMUTE_VIDEO,t=>this._handleMuteStream(t.uid,_t.VIDEO,!1)),this._gateway.signal.on(vn.RECEIVE_METADATA,t=>{const r=F_(t.metadata);this.safeEmit(yn.RECEIVE_METADATA,t.uid,r)}),this._gateway.signal.on(vn.ON_DATA_STREAM,async t=>{var r;if(!t)return;let s=F_(t.payload);if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&ot(r=["aes-128-gcm2","aes-256-gcm2"]).call(r,this._encryptionMode)){if(t.payload.length<Wv)throw new Oe(te.UNEXPECTED_RESPONSE,"payload length ".concat(t.payload.length," is less than header length ").concat(Wv));s=await async function(u,h,m){const y=m.subarray(0,Wv),v=y.slice(8,Wv),S=(v[0]<<8)+v[1],R=(y[6]<<8)+y[7],P=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:u,tagLength:rz,additionalData:new Uint8Array(G8(S,2))},h,m.subarray(Wv));return new Uint8Array(P).subarray(0,R)}(this._encryptDataStreamIv,this._encryptDataStreamKey,s)}let a=0;if(t.ordered||t.syncWithAudio){const c=this._p2pChannel.getStats(),u=this.remoteUsers.find(m=>m.uid===t.uid),h=c==null?void 0:c.audioRecv.find(m=>m.ssrc===(u==null?void 0:u._audioSSRC));a=h==null?void 0:h.jitterBufferMs}(a==null||Number.isNaN(a))&&(a=0),Hge(wu(wu({},t),{},{payload:s}),a,{id:this._clientId,onStreamMessage:typeof this.onStreamMessage=="function"?this.onStreamMessage.bind(this):void 0,safeEmit:this.safeEmit.bind(this)})}),this._gateway.signal.on(vn.ON_CRYPT_ERROR,()=>{Fm(()=>{x.warning("[".concat(this._clientId,"] on crypt error")),this.safeEmit(yn.CRYPT_ERROR)},this._sessionId)}),this._gateway.signal.on(vn.ON_TOKEN_PRIVILEGE_WILL_EXPIRE,this._handleTokenWillExpire),this._gateway.signal.on(vn.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{x.warning("[".concat(this._clientId,"] received message onTokenPrivilegeDidExpire, please get new token and join again")),this._gateway.leave(!0,Kn.TOKEN_EXPIRE),this.safeEmit(yn.ON_TOKEN_PRIVILEGE_DID_EXPIRE),this._reset()}),this._gateway.signal.on(vn.ON_STREAM_FALLBACK_UPDATE,t=>{x.debug("[".concat(this._clientId,"] stream fallback peerId: ").concat(t.stream_id,", attr: ").concat(t.stream_type)),this.safeEmit(yn.STREAM_FALLBACK,t.stream_id,t.stream_type===1?"fallback":"recover")}),this._gateway.signal.on(vn.ON_PUBLISH_STREAM,t=>{this.uid===this._uid&&(this._p2pChannel.reportPublishEvent(!0,null,void 0,!1,JSON.stringify({proxy:t.proxy})),x.info("[".concat(this._clientId,"] on publish stream, ").concat(JSON.stringify(t))))}),this._gateway.signal.on(vn.ENABLE_LOCAL_VIDEO,t=>{this._handleSetStreamLocalEnable("video",t.uid,!0)}),this._gateway.signal.on(vn.DISABLE_LOCAL_VIDEO,t=>{this._handleSetStreamLocalEnable("video",t.uid,!1)}),this._gateway.signal.on($t.REQUEST_TIMEOUT,(t,r)=>{if(this._joinInfo)switch(t){case zt.PUBLISH:{if(!r)return;const c=r.ortc;if(c){var s,a;const u=c.some(y=>{let{stream_type:v}=y;return v===Yn.Audio}),h=c.some(y=>{let{stream_type:v}=y;return v!==Yn.Audio}),m=c.some(y=>{let{stream_type:v}=y;return v===Yn.Screen||v===Yn.ScreenLow});r.state==="offer"&&It.publish(this._joinInfo.sid,{eventElapse:zs.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:!1,ec:te.TIMEOUT,audio:u,video:h,p2pid:r.p2p_id,publishRequestid:this.store.pubId,screenshare:m,audioName:u?(s=c.find(y=>{let{stream_type:v}=y;return v===Yn.Audio}))===null||s===void 0||(s=s.ssrcs[0])===null||s===void 0?void 0:s.ssrcId.toString():void 0,videoName:h?(a=c.find(y=>{let{stream_type:v}=y;return v!==Yn.Audio}))===null||a===void 0||(a=a.ssrcs[0])===null||a===void 0?void 0:a.ssrcId.toString():void 0})}break}case zt.SUBSCRIBE:r&&It.subscribe(this._joinInfo.sid,{succ:!1,ec:te.TIMEOUT,audio:r.stream_type===_t.AUDIO,video:r.stream_type===_t.VIDEO,peerid:r.stream_id,subscribeRequestid:r.ssrcId,p2pid:this.store.p2pId,eventElapse:zs.measureFromSubscribeStart(this.store.clientId,r.ssrcId),preSsrc:this._p2pChannel.isPreSubScribe(r.ssrcId)})}}),this._gateway.signal.on(vn.ON_P2P_OK,t=>{this.uid,this._uid}),this._gateway.signal.on(vn.ON_PUBLISHED_USER_LIST,t=>{if(t==null||!t.users)return;oe("BLOCK_LOCAL_CLIENT")&&(t.users=t.users.filter(a=>!q_(a.string_id||a.stream_id,this.channelName)));const r=[],s=[];for(const a of t.users){let c=this._users.find(S=>S._uintid===a.stream_id);c?c._trust_in_room_=!0:(c=new qm(a.string_id||a.stream_id,a.stream_id),this._users.push(c),this.getListeners(yn.PUBLISHED_USER_LIST).length===0&&(x.debug("[".concat(this._clientId,"] user online"),a.stream_id),this.safeEmit(yn.USER_JOINED,c)));const u=Ji.Audio&a.stream_type,h=(Ji.Video|Ji.LwoVideo)&a.stream_type,m=(65280&a.stream_type)!=0,y=u&&c.hasAudio,v=h&&c.hasVideo;h&&(c._trust_video_stream_added_state_=!0,c._video_added_=!0,c._videoSSRC=a.video_ssrc,c._rtxSsrcId=a.video_rtx),u&&(c._trust_audio_stream_added_state_=!0,c._audio_added_=!0,c._audioSSRC=a.audio_ssrc),u&&!y&&this.getListeners(yn.PUBLISHED_USER_LIST).length===0&&(x.info("[".concat(this._clientId,"] remote user ").concat(c.uid," published audio")),this.safeEmit(yn.USER_PUBLISHED,c,"audio")),h&&!v&&this.getListeners(yn.PUBLISHED_USER_LIST).length===0&&(x.info("[".concat(this._clientId,"] remote user ").concat(c.uid," published video")),this.safeEmit(yn.USER_PUBLISHED,c,"video")),(u&&!y||h&&!v||m)&&r.push(c),h&&this._p2pChannel.hasPendingRemoteMedia(c,"video")&&s.push({user:c,mediaType:"video"}),u&&this._p2pChannel.hasPendingRemoteMedia(c,"audio")&&s.push({user:c,mediaType:"audio"})}s.length>0&&(x.debug("[".concat(this._clientId,"] RE massSubscribe after reconnect ").concat(s.map(a=>"user: ".concat(a.user.uid,", mediaType: ").concat(a.mediaType)).join("; ")," ")),this.massSubscribe(s).catch(a=>{x.error("[".concat(this._clientId,"] mass resubscribe error"),a.toString())})),this.getListeners(yn.PUBLISHED_USER_LIST).length>0?oe("ENABLE_DATASTREAM_2")?this._pendingPublishedUsers=r:(x.info("[".concat(this._clientId,"] client emit user-list event, users: ").concat(r.map(a=>a.uid).join(", "))),this.safeEmit(yn.PUBLISHED_USER_LIST,r)):x.info("[".concat(this._clientId,"] client not emit user-list event case there is no user-list listener, users: ").concat(r.map(a=>a.uid).join(", ")))}),this._gateway.signal.on(vn.ON_RTP_CAPABILITY_CHANGE,t=>{const{video_codec:r}=t;this._p2pChannel instanceof $T&&this._p2pChannel.updateRemoteRTPCapabilities(r.map(s=>s.toLowerCase()).filter(s=>{var a;return ot(a=Object.keys(tP)).call(a,s)}))})}_handleP2PEvents(){this._gateway.signal.on(vn.ON_USER_OFFLINE,()=>{this._p2pChannel.disconnectForReconnect()}),this._gateway.signal.on(li.PUBLISH,(t,r,s)=>{const{uid:a}=t;t.forEach(c=>{const{kind:u,ssrcs:h,mid:m,isMuted:y}=c;this._handleP2PAddAudioOrVideoStream(u,a,h[0].ssrcId,m);const v=this._users.find(S=>S.uid===a);return v&&this.store.useP2P?this._p2pChannel.mockSubscribe(v,u,h[0].ssrcId,m).then(()=>{r()}).catch(s):r(),this._handleMuteStream(a,u,!!y)})}),this._gateway.signal.on(li.CALL,async(t,r,s)=>{if(this.store.useP2P)try{var a;r(await this._p2pChannel.startP2P({turnServer:(a=this._joinInfo)===null||a===void 0?void 0:a.turnServer},t))}catch(c){s(c)}}),this._gateway.signal.on($t.P2P_CONNECTION,async t=>{this.store.useP2P&&(await this._p2pChannel).p2pConnect(t)}),this._gateway.signal.on(li.UNPUBLISH,async(t,r,s)=>{if(this.store.useP2P){const{unpubMsg:a,uid:c}=t,u=this._users.find(h=>h.uid===c);if(!u)return x.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(c)),void r();try{a.forEach(async h=>{let{stream_type:m}=h;const y=m===Yn.Audio?_t.AUDIO:_t.VIDEO;await this._p2pChannel.unsubscribe(u,y),this._handleMuteStream(c,y,!0)}),r()}catch(h){s(h)}}}),this._gateway.signal.on(li.CONTROL,async(t,r)=>{const{action:s}=t;switch(s){case zm.MUTE_LOCAL_VIDEO:this._handleMuteStream(r,_t.VIDEO,!0);break;case zm.MUTE_LOCAL_AUDIO:this._handleMuteStream(r,_t.AUDIO,!0);break;case zm.UNMUTE_LOCAL_VIDEO:this._handleP2PAddAudioOrVideoStream("video",r),this._handleMuteStream(r,_t.VIDEO,!1);break;case zm.UNMUTE_LOCAL_AUDIO:this._handleP2PAddAudioOrVideoStream("audio",r),this._handleMuteStream(r,_t.AUDIO,!1)}}),this._gateway.signal.on(li.RESTART_ICE,async(t,r,s)=>{if(this.store.useP2P)try{const{direction:a,iceParameter:c}=t;a!==Vo.SEND_ONLY||c?r(await this._p2pChannel.restartICE(a,c)):(this._p2pChannel.handleDisconnect(a),r())}catch(a){s(a)}}),this._gateway.signal.on(li.CANDIDATE,t=>{if(this.store.useP2P){const{candidate:r,direction:s}=t;this._p2pChannel.addRemoteCandidate(r,s)}}),this._p2pChannel.on(xt.RequestP2PRestartICE,async(t,r,s)=>{try{const{direction:a}=t;r(await this._gateway.sendExtensionMessage(li.RESTART_ICE,t,a===Vo.SEND_ONLY))}catch(a){s(a)}}),this._p2pChannel.on(xt.LocalCandidate,t=>{this._gateway.sendExtensionMessage(li.CANDIDATE,JSON.stringify(t),!0)}),this._p2pChannel.on(xt.RequestP2PMuteLocal,async(t,r,s)=>{try{await this._gateway.sendExtensionMessage(li.CONTROL,t,!0),r()}catch(a){s(a)}}),this._p2pChannel.on(xt.RequestP2PUnmuteRemote,async(t,r,s)=>{if(this._joinInfo)try{await this._gateway.unmuteRemote(t,this._joinInfo.stringUid||this._joinInfo.uid),r()}catch(a){a.code===te.DISCONNECT_P2P?r():s(a)}else r()}),this._p2pChannel.on(xt.RequestP2PMuteRemote,async(t,r,s)=>{if(this._joinInfo)try{await this._gateway.muteRemote(t,this._joinInfo.stringUid||this._joinInfo.uid),r()}catch(a){a.code===te.DISCONNECT_P2P?r():s(a)}else r()}),this._p2pChannel.on(xt.StateChange,(t,r)=>{r===qn.Connected&&this._p2pChannel.republish()})}_handleP2PChannelEvents(){this._p2pChannel.on(xt.PeerConnectionStateChange,t=>{const r=this._peerConnectionState;t!==r&&(this.safeEmit(yn.PEERCONNECTION_STATE_CHANGE,t,r),this._peerConnectionState=t)}),this._p2pChannel.on(xt.RequestMuteLocal,async(t,r,s)=>{if(this._joinInfo)try{await this._gateway.muteLocal(t,this._joinInfo.stringUid||this._joinInfo.uid),r()}catch(a){a.code===te.DISCONNECT_P2P?r():s(a)}else r()}),this._p2pChannel.on(xt.RequestUnmuteLocal,async(t,r,s)=>{if(this._joinInfo)try{await this._gateway.unmuteLocal(t,this._joinInfo.stringUid||this._joinInfo.uid),r()}catch(a){a.code===te.DISCONNECT_P2P?r():s(a)}else r()}),this._p2pChannel.on(xt.RequestRePublish,(t,r,s)=>{this.publish(t,!1).then(r).catch(s)}),this._p2pChannel.on(xt.RequestRePublishDataChannel,(t,r,s)=>{dt.all(t.map(async a=>{const c=await this._p2pChannel.publishDataChannel([a]);try{c.forEach(u=>{this._uid&&this._gateway.publishDataChannel(this._uid,u,!0)})}catch(u){if(u.code!==te.DISCONNECT_P2P)throw u}})).then(r).catch(s)}),this._p2pChannel.on(xt.RequestReSubscribe,async(t,r,s)=>{try{for(const{user:a,kind:c}of t)c===_t.VIDEO?await this.subscribe(a,"video"):await this.subscribe(a,"audio");r()}catch(a){s(a)}}),this._p2pChannel.on(xt.RequestUpload,(t,r)=>{this._gateway.upload(t,r)}),this._p2pChannel.on(xt.RequestUploadStats,t=>{this._gateway.uploadWRTCStats(t)}),this._p2pChannel.on(xt.MediaReconnectStart,t=>{this.safeEmit(yn.MEDIA_RECONNECT_START,t)}),this._p2pChannel.on(xt.MediaReconnectEnd,t=>{this.safeEmit(yn.MEDIA_RECONNECT_END,t)}),this._p2pChannel.on(xt.NeedSignalRTT,t=>{t(this._gateway.getSignalRTT())}),this._p2pChannel.on(xt.RequestRestartICE,async t=>{if(this.store.useP2P)return;const r=await this._p2pChannel.restartICE(t),s=await r.next();if(s.done)return;const a=s.value;let c;try{c=await this._gateway.restartICE({iceParameters:a})}catch(h){return void r.throw(h)}const{iceParameters:u}=function(h){const m=h.iceParameters;return{iceParameters:{iceUfrag:m.iceUfrag,icePwd:m.icePwd}}}(c);await r.next({remoteIceParameters:u})}),this._p2pChannel.on(xt.RequestReconnect,async()=>{this._gateway.reconnect()}),this._p2pChannel.on(xt.RequestReconnectPC,async()=>{var t;const{iceParameters:r,dtlsParameters:s,rtpCapabilities:a}=await this._p2pChannel.startP2PConnection({turnServer:(t=this._joinInfo)===null||t===void 0?void 0:t.turnServer}),{gatewayEstablishParams:c,gatewayAddress:u}=await this._gateway.reconnectPC({iceParameters:r,dtlsParameters:s,rtpCapabilities:a}),h=HH(c,u);await this._p2pChannel.connect(h),await this._p2pChannel.republish(),await this._p2pChannel.reSubscribe()}),this._p2pChannel.on(xt.RequestUnpublishForReconnectPC,async(t,r,s)=>{this._joinInfo&&this._uid!==void 0?(await this._gateway.unpublish(t,this._uid),r()):s()}),this._p2pChannel.on(xt.P2PLost,()=>{this.safeEmit(yn.P2P_LOST,this.store.uid)}),this._p2pChannel.on(xt.UpdateVideoEncoder,t=>{t._encoderConfig&&this._gateway.setVideoProfile(t._encoderConfig)}),this._p2pChannel.on(xt.ConnectionTypeChange,t=>{this.safeEmit(yn.IS_USING_CLOUD_PROXY,t)}),this._p2pChannel.on(xt.RequestLowStreamParameter,t=>{t(this._lowStreamParameter||{width:160,height:120,framerate:15,bitrate:50})}),this._p2pChannel.on(xt.QueryClientConnectionState,t=>{t(this.connectionState)}),this._p2pChannel.on(xt.AudioMetadata,t=>{this.safeEmit(yn.AUDIO_METADATA,t)})}getKeyMetrics(){return this.store.keyMetrics}async enableContentInspect(t){if(!this._joinInfo||this.connectionState!=="CONNECTED")throw new Oe(te.INVALID_OPERATION,"[".concat(this._clientId,"] can not create content inspect, please join channel first"));if(this._inspect)throw new Oe(te.INVALID_OPERATION,"[".concat(this._clientId,"] Inspect content service already in connecting/connected state"));try{const s=(r={config:t},up("ContentInspect").create(r));this._inspect=s,this.handleVideoInspectEvents(s);const{appId:a,cname:c,sid:u,token:h,uid:m,cid:y,vid:v}=this._joinInfo;await s.init({appId:a,areaCode:"",cname:c,sid:u,token:h,uid:m,cid:y,vid:v?Number(v):0},Pi)}catch(s){throw Array.isArray(s)?s[0]:s}var r}handleVideoInspectEvents(t){t.on(cs.CONNECTION_STATE_CHANGE,(r,s)=>{if(this.safeEmit(yn.CONTENT_INSPECT_CONNECTION_STATE_CHANGE,r,s),s===vu.CONNECTED){if(this.connectionState!=="CONNECTED")return void this.safeEmit(yn.CONTENT_INSPECT_ERROR,new Oe(te.OPERATION_ABORTED,"Content inspect was cancelled because it left the channel"));t.inspectImage()}}),t.on(cs.INSPECT_RESULT,(r,s)=>{var a;if((s==null?void 0:s.code)===te.INVALID_OPERATION&&this.connectionState==="DISCONNECTED")return x.debug("Stop inspect content because that has left channel"),this==null||(a=this._inspect)===null||a===void 0||a.close(),void(this._inspect=void 0);this.safeEmit(yn.CONTENT_INSPECT_RESULT,r,s)}),t.on(cs.CLIENT_LOCAL_VIDEO_TRACK,r=>{r(this.localTracks.filter(s=>s.trackMediaType==="video")[0])})}async disableContentInspect(){if(!this._inspect)throw new Oe(te.INVALID_OPERATION,"[".concat(this._clientId,"] inspectVideoContent not started"));try{this._inspect.close(),this._inspect=void 0}catch(t){throw Array.isArray(t)?t[0]:t}}async setImageModeration(t,r){if(rp(t,"enabled"),t){if(!r)throw new Oe(te.INVALID_PARAMS,"config is required");if(l7(r),!this._joinInfo)throw new Oe(te.INVALID_OPERATION,"can not create image moderation, please join channel first");try{if(this._moderation)this._moderation.updateConfig(r);else{const a=(s={config:r},up("ImageModeration").create(s));this._moderation=a,this.handleImageModerationEvents(a);const{appId:c,cname:u,sid:h,token:m,uid:y,cid:v,vid:S}=this._joinInfo;await a.init({appId:c,areaCode:"",cname:u,sid:h,token:m,uid:y,cid:v,vid:S?Number(S):0},Pi)}}catch(a){throw Array.isArray(a)?a[0]:a}}else{var s;if(!this._moderation)throw new Oe(te.INVALID_OPERATION,"[".concat(this._clientId,"] image moderation not started"));try{this._moderation.close(),this._moderation.removeAllListeners(),this._moderation=void 0}catch(a){throw Array.isArray(a)?a[0]:a}}}handleImageModerationEvents(t){t.on(Sd.CONNECTION_STATE_CHANGE,(r,s)=>{if(this.safeEmit(yn.IMAGE_MODERATION_CONNECTION_STATE_CHANGE,r,s),r===Il.CONNECTED){if(this.connectionState!=="CONNECTED")throw this.setImageModeration(!1),new Oe(te.OPERATION_ABORTED,"Image moderation was cancelled because it left the channel");t.inspectImage()}}),t.on(Sd.CLIENT_LOCAL_VIDEO_TRACK,r=>{r(this.localTracks.filter(s=>s.trackMediaType==="video")[0])})}setP2PTransport(t){if(function(r){Bi(r,"transport",["default","auto","relay","sd-rtn"])}(t),this.mode!=="p2p")throw new Oe(te.INVALID_OPERATION,"only p2p mode can set p2pTransport");this.store.p2pTransport=t,x.info("[".concat(this._clientId,"] set client p2pTransport to ").concat(t))}getJoinChannelServiceRecords(){return x.debug("getJoinChannelServiceRecords"),this.store.joinChannelServiceRecords}async setPublishAudioFilterEnabled(t){rp(t,"enabled"),tr("ENABLE_PUBLISH_AUDIO_FILTER",t),this._joinInfo&&await this._gateway.setPublishAudioFilterEnabled(t)}_handleResetAddStream(t,r){switch(r){case"audio":t._audio_added_=!1,t._trust_audio_stream_added_state_=!0;break;case"video":t._video_added_=!1,t._trust_video_stream_added_state_=!0}}},Tt(pt.prototype,"leave",[u7],Object.getOwnPropertyDescriptor(pt.prototype,"leave"),pt.prototype),Tt(pt.prototype,"publish",[d7],Object.getOwnPropertyDescriptor(pt.prototype,"publish"),pt.prototype),Tt(pt.prototype,"unpublish",[h7],Object.getOwnPropertyDescriptor(pt.prototype,"unpublish"),pt.prototype),Tt(pt.prototype,"subscribe",[f7],Object.getOwnPropertyDescriptor(pt.prototype,"subscribe"),pt.prototype),Tt(pt.prototype,"presubscribe",[p7],Object.getOwnPropertyDescriptor(pt.prototype,"presubscribe"),pt.prototype),Tt(pt.prototype,"massSubscribe",[m7],Object.getOwnPropertyDescriptor(pt.prototype,"massSubscribe"),pt.prototype),Tt(pt.prototype,"unsubscribe",[g7],Object.getOwnPropertyDescriptor(pt.prototype,"unsubscribe"),pt.prototype),Tt(pt.prototype,"massUnsubscribe",[_7],Object.getOwnPropertyDescriptor(pt.prototype,"massUnsubscribe"),pt.prototype),Tt(pt.prototype,"setLowStreamParameter",[y7],Object.getOwnPropertyDescriptor(pt.prototype,"setLowStreamParameter"),pt.prototype),Tt(pt.prototype,"enableDualStream",[E7],Object.getOwnPropertyDescriptor(pt.prototype,"enableDualStream"),pt.prototype),Tt(pt.prototype,"disableDualStream",[v7],Object.getOwnPropertyDescriptor(pt.prototype,"disableDualStream"),pt.prototype),Tt(pt.prototype,"setClientRole",[S7],Object.getOwnPropertyDescriptor(pt.prototype,"setClientRole"),pt.prototype),Tt(pt.prototype,"_setClientRoleOptions",[b7],Object.getOwnPropertyDescriptor(pt.prototype,"_setClientRoleOptions"),pt.prototype),Tt(pt.prototype,"setProxyServer",[T7],Object.getOwnPropertyDescriptor(pt.prototype,"setProxyServer"),pt.prototype),Tt(pt.prototype,"setTurnServer",[w7],Object.getOwnPropertyDescriptor(pt.prototype,"setTurnServer"),pt.prototype),Tt(pt.prototype,"setLicense",[C7],Object.getOwnPropertyDescriptor(pt.prototype,"setLicense"),pt.prototype),Tt(pt.prototype,"startProxyServer",[R7],Object.getOwnPropertyDescriptor(pt.prototype,"startProxyServer"),pt.prototype),Tt(pt.prototype,"stopProxyServer",[I7],Object.getOwnPropertyDescriptor(pt.prototype,"stopProxyServer"),pt.prototype),Tt(pt.prototype,"setLocalAccessPointsV2",[A7],Object.getOwnPropertyDescriptor(pt.prototype,"setLocalAccessPointsV2"),pt.prototype),Tt(pt.prototype,"setLocalAccessPoints",[P7],Object.getOwnPropertyDescriptor(pt.prototype,"setLocalAccessPoints"),pt.prototype),Tt(pt.prototype,"setRemoteDefaultVideoStreamType",[O7],Object.getOwnPropertyDescriptor(pt.prototype,"setRemoteDefaultVideoStreamType"),pt.prototype),Tt(pt.prototype,"setRemoteVideoStreamType",[k7],Object.getOwnPropertyDescriptor(pt.prototype,"setRemoteVideoStreamType"),pt.prototype),Tt(pt.prototype,"setStreamFallbackOption",[N7],Object.getOwnPropertyDescriptor(pt.prototype,"setStreamFallbackOption"),pt.prototype),Tt(pt.prototype,"setEncryptionConfig",[D7],Object.getOwnPropertyDescriptor(pt.prototype,"setEncryptionConfig"),pt.prototype),Tt(pt.prototype,"renewToken",[x7],Object.getOwnPropertyDescriptor(pt.prototype,"renewToken"),pt.prototype),Tt(pt.prototype,"enableAudioVolumeIndicator",[L7],Object.getOwnPropertyDescriptor(pt.prototype,"enableAudioVolumeIndicator"),pt.prototype),Tt(pt.prototype,"startLiveStreaming",[M7],Object.getOwnPropertyDescriptor(pt.prototype,"startLiveStreaming"),pt.prototype),Tt(pt.prototype,"setLiveTranscoding",[U7],Object.getOwnPropertyDescriptor(pt.prototype,"setLiveTranscoding"),pt.prototype),Tt(pt.prototype,"stopLiveStreaming",[V7],Object.getOwnPropertyDescriptor(pt.prototype,"stopLiveStreaming"),pt.prototype),Tt(pt.prototype,"startChannelMediaRelay",[F7],Object.getOwnPropertyDescriptor(pt.prototype,"startChannelMediaRelay"),pt.prototype),Tt(pt.prototype,"updateChannelMediaRelay",[j7],Object.getOwnPropertyDescriptor(pt.prototype,"updateChannelMediaRelay"),pt.prototype),Tt(pt.prototype,"stopChannelMediaRelay",[B7],Object.getOwnPropertyDescriptor(pt.prototype,"stopChannelMediaRelay"),pt.prototype),Tt(pt.prototype,"sendCustomReportMessage",[W7],Object.getOwnPropertyDescriptor(pt.prototype,"sendCustomReportMessage"),pt.prototype),Tt(pt.prototype,"pickSVCLayer",[z7],Object.getOwnPropertyDescriptor(pt.prototype,"pickSVCLayer"),pt.prototype),Tt(pt.prototype,"setRTMConfig",[G7],Object.getOwnPropertyDescriptor(pt.prototype,"setRTMConfig"),pt.prototype),Tt(pt.prototype,"enableContentInspect",[H7],Object.getOwnPropertyDescriptor(pt.prototype,"enableContentInspect"),pt.prototype),Tt(pt.prototype,"disableContentInspect",[$7],Object.getOwnPropertyDescriptor(pt.prototype,"disableContentInspect"),pt.prototype),Tt(pt.prototype,"setImageModeration",[K7],Object.getOwnPropertyDescriptor(pt.prototype,"setImageModeration"),pt.prototype),Tt(pt.prototype,"setP2PTransport",[q7],Object.getOwnPropertyDescriptor(pt.prototype,"setP2PTransport"),pt.prototype),Tt(pt.prototype,"getJoinChannelServiceRecords",[Y7],Object.getOwnPropertyDescriptor(pt.prototype,"getJoinChannelServiceRecords"),pt.prototype),Tt(pt.prototype,"setPublishAudioFilterEnabled",[X7],Object.getOwnPropertyDescriptor(pt.prototype,"setPublishAudioFilterEnabled"),pt.prototype),pt);class YT{constructor(r,s){K(this,"id",0),K(this,"element",void 0),K(this,"peerPair",void 0),K(this,"context",void 0),K(this,"audioPlayerElement",void 0),K(this,"audioTrack",void 0),YT.count+=1,this.id=YT.count,this.element=r,this.context=s}initPeers(){this.peerPair=[new RTCPeerConnection,new RTCPeerConnection],this.peerPair[1].ontrack=r=>{const s=document.createElement("audio");s.srcObject=new MediaStream([r.track]),s.play(),this.audioPlayerElement=s}}async switchSdp(){if(!this.peerPair)return;const r=async(a,c)=>{const u=c==="offer"?await a.createOffer():await a.createAnswer();return await a.setLocalDescription(u),a.iceGatheringState==="complete"?a.localDescription:new dt(h=>{a.onicegatheringstatechange=()=>{a.iceGatheringState==="complete"&&h(a.localDescription)}})},s=async(a,c)=>await a.setRemoteDescription(c);try{const a=await r(this.peerPair[0],"offer");await s(this.peerPair[1],a);const c=await r(this.peerPair[1],"answer");await s(this.peerPair[0],c)}catch(a){throw new Oe(te.LOCAL_AEC_ERROR,a.toString()).print()}}async getTracksFromMediaElement(r){if(this.audioTrack)return this.audioTrack;let s;try{r instanceof HTMLVideoElement&&(r.captureStream?r.captureStream():r.mozCaptureStream()),s=this.context.createMediaStreamDestination(),this.context.createMediaElementSource(r).connect(s)}catch(c){throw new Oe(te.LOCAL_AEC_ERROR,c.toString()).print()}if(!s)throw new Oe(te.LOCAL_AEC_ERROR,"no dest node when local aec").print();const a=s.stream.getAudioTracks()[0];return this.audioTrack=a,a}getElement(){return this.element}async startEchoCancellation(){this.context.resume(),this.peerPair&&this.close(),this.initPeers();const r=this.element,s=await this.getTracksFromMediaElement(r);this.peerPair&&this.peerPair[0].addTrack(s),await this.switchSdp()}close(){x.debug("close echo cancellation unit, id is",this.id),this.audioPlayerElement&&this.audioPlayerElement.pause(),this.peerPair&&this.peerPair.forEach(r=>{r.close()}),this.peerPair=void 0,this.audioPlayerElement=void 0}}var Q7,KP;K(YT,"count",0);const c_e=window.AudioContext||window.webkitAudioContext,l_e=new(Q7=Ft({report:It}),Tt((KP=class{constructor(){K(this,"units",[]),K(this,"context",void 0)}processExternalMediaAEC(t){if(!this._doesEnvironmentNeedAEC())return x.debug("the system does not need to process local aec"),-1;this.context||(this.context=new c_e);let r=this.units.find(s=>s&&s.getElement()===t);return r||(r=new YT(t,this.context),this.units.push(r)),r.startEchoCancellation(),x.debug("start processing local audio echo cancellation, id is",r.id),r.id}_doesEnvironmentNeedAEC(){return Nn().name!==zn.SAFARI}}).prototype,"processExternalMediaAEC",[Q7],Object.getOwnPropertyDescriptor(KP.prototype,"processExternalMediaAEC"),KP.prototype),KP);function Z7(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}function e$(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?Z7(Object(s),!0).forEach(function(a){K(t,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):Z7(Object(s)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))})}return t}const F2=window||document;function t$(t){let r=arguments.length>1&&arguments[1]!==void 0&&arguments[1];if(!F2)return;const s=Oi._cspEventHandlerPointer;if(s&&r)return void console.error(s,r);const a=c=>{if(!(c&&c.blockedURI&&(Oi.onSecurityPolicyViolation||Oi.getListeners(Ch.SECURITY_POLICY_VIOLATION).length>0)))return;const u=c.blockedURI;oe("CSP_DETECTED_HOSTNAME_LIST").some(h=>ot(u).call(u,h))&&(Oi.onSecurityPolicyViolation&&typeof Oi.onSecurityPolicyViolation=="function"&&Oi.onSecurityPolicyViolation(c),Oi.getListeners(Ch.SECURITY_POLICY_VIOLATION).length>0&&Oi.safeEmit(Ch.SECURITY_POLICY_VIOLATION,c))};s&&F2.removeEventListener("securitypolicyviolation",s),(r||t&&typeof t=="function"||Oi.getListeners(Ch.SECURITY_POLICY_VIOLATION).length>0)&&F2.addEventListener("securitypolicyviolation",a),Oi._cspEventHandlerPointer=a}var u_e=O,d_e=VW,n$=RegExp.prototype,h_e=function(t){return t===n$||u_e(n$,t)?d_e(t):t.flags},yo=l(h_e);function mS(t){let r=t.length;for(;--r>=0;)t[r]=0}const j2=256,r$=286,XT=30,JT=15,B2=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),qP=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),f_e=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),i$=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),fp=new Array(576);mS(fp);const QT=new Array(60);mS(QT);const ZT=new Array(512);mS(ZT);const ew=new Array(256);mS(ew);const W2=new Array(29);mS(W2);const YP=new Array(XT);function z2(t,r,s,a,c){this.static_tree=t,this.extra_bits=r,this.extra_base=s,this.elems=a,this.max_length=c,this.has_stree=t&&t.length}let s$,o$,a$;function G2(t,r){this.dyn_tree=t,this.max_code=0,this.stat_desc=r}mS(YP);const c$=t=>t<256?ZT[t]:ZT[256+(t>>>7)],tw=(t,r)=>{t.pending_buf[t.pending++]=255&r,t.pending_buf[t.pending++]=r>>>8&255},tl=(t,r,s)=>{t.bi_valid>16-s?(t.bi_buf|=r<<t.bi_valid&65535,tw(t,t.bi_buf),t.bi_buf=r>>16-t.bi_valid,t.bi_valid+=s-16):(t.bi_buf|=r<<t.bi_valid&65535,t.bi_valid+=s)},Oh=(t,r,s)=>{tl(t,s[2*r],s[2*r+1])},l$=(t,r)=>{let s=0;do s|=1&t,t>>>=1,s<<=1;while(--r>0);return s>>>1},u$=(t,r,s)=>{const a=new Array(16);let c,u,h=0;for(c=1;c<=JT;c++)h=h+s[c-1]<<1,a[c]=h;for(u=0;u<=r;u++){let m=t[2*u+1];m!==0&&(t[2*u]=l$(a[m]++,m))}},d$=t=>{let r;for(r=0;r<r$;r++)t.dyn_ltree[2*r]=0;for(r=0;r<XT;r++)t.dyn_dtree[2*r]=0;for(r=0;r<19;r++)t.bl_tree[2*r]=0;t.dyn_ltree[512]=1,t.opt_len=t.static_len=0,t.sym_next=t.matches=0},h$=t=>{t.bi_valid>8?tw(t,t.bi_buf):t.bi_valid>0&&(t.pending_buf[t.pending++]=t.bi_buf),t.bi_buf=0,t.bi_valid=0},f$=(t,r,s,a)=>{const c=2*r,u=2*s;return t[c]<t[u]||t[c]===t[u]&&a[r]<=a[s]},H2=(t,r,s)=>{const a=t.heap[s];let c=s<<1;for(;c<=t.heap_len&&(c<t.heap_len&&f$(r,t.heap[c+1],t.heap[c],t.depth)&&c++,!f$(r,a,t.heap[c],t.depth));)t.heap[s]=t.heap[c],s=c,c<<=1;t.heap[s]=a},p$=(t,r,s)=>{let a,c,u,h,m=0;if(t.sym_next!==0)do a=255&t.pending_buf[t.sym_buf+m++],a+=(255&t.pending_buf[t.sym_buf+m++])<<8,c=t.pending_buf[t.sym_buf+m++],a===0?Oh(t,c,r):(u=ew[c],Oh(t,u+j2+1,r),h=B2[u],h!==0&&(c-=W2[u],tl(t,c,h)),a--,u=c$(a),Oh(t,u,s),h=qP[u],h!==0&&(a-=YP[u],tl(t,a,h)));while(m<t.sym_next);Oh(t,256,r)},$2=(t,r)=>{const s=r.dyn_tree,a=r.stat_desc.static_tree,c=r.stat_desc.has_stree,u=r.stat_desc.elems;let h,m,y,v=-1;for(t.heap_len=0,t.heap_max=573,h=0;h<u;h++)s[2*h]!==0?(t.heap[++t.heap_len]=v=h,t.depth[h]=0):s[2*h+1]=0;for(;t.heap_len<2;)y=t.heap[++t.heap_len]=v<2?++v:0,s[2*y]=1,t.depth[y]=0,t.opt_len--,c&&(t.static_len-=a[2*y+1]);for(r.max_code=v,h=t.heap_len>>1;h>=1;h--)H2(t,s,h);y=u;do h=t.heap[1],t.heap[1]=t.heap[t.heap_len--],H2(t,s,1),m=t.heap[1],t.heap[--t.heap_max]=h,t.heap[--t.heap_max]=m,s[2*y]=s[2*h]+s[2*m],t.depth[y]=(t.depth[h]>=t.depth[m]?t.depth[h]:t.depth[m])+1,s[2*h+1]=s[2*m+1]=y,t.heap[1]=y++,H2(t,s,1);while(t.heap_len>=2);t.heap[--t.heap_max]=t.heap[1],((S,R)=>{const P=R.dyn_tree,N=R.max_code,G=R.stat_desc.static_tree,F=R.stat_desc.has_stree,j=R.stat_desc.extra_bits,X=R.stat_desc.extra_base,ee=R.stat_desc.max_length;let he,Se,Te,ye,Ne,Ye,ht=0;for(ye=0;ye<=JT;ye++)S.bl_count[ye]=0;for(P[2*S.heap[S.heap_max]+1]=0,he=S.heap_max+1;he<573;he++)Se=S.heap[he],ye=P[2*P[2*Se+1]+1]+1,ye>ee&&(ye=ee,ht++),P[2*Se+1]=ye,Se>N||(S.bl_count[ye]++,Ne=0,Se>=X&&(Ne=j[Se-X]),Ye=P[2*Se],S.opt_len+=Ye*(ye+Ne),F&&(S.static_len+=Ye*(G[2*Se+1]+Ne)));if(ht!==0){do{for(ye=ee-1;S.bl_count[ye]===0;)ye--;S.bl_count[ye]--,S.bl_count[ye+1]+=2,S.bl_count[ee]--,ht-=2}while(ht>0);for(ye=ee;ye!==0;ye--)for(Se=S.bl_count[ye];Se!==0;)Te=S.heap[--he],Te>N||(P[2*Te+1]!==ye&&(S.opt_len+=(ye-P[2*Te+1])*P[2*Te],P[2*Te+1]=ye),Se--)}})(t,r),u$(s,v,t.bl_count)},m$=(t,r,s)=>{let a,c,u=-1,h=r[1],m=0,y=7,v=4;for(h===0&&(y=138,v=3),r[2*(s+1)+1]=65535,a=0;a<=s;a++)c=h,h=r[2*(a+1)+1],++m<y&&c===h||(m<v?t.bl_tree[2*c]+=m:c!==0?(c!==u&&t.bl_tree[2*c]++,t.bl_tree[32]++):m<=10?t.bl_tree[34]++:t.bl_tree[36]++,m=0,u=c,h===0?(y=138,v=3):c===h?(y=6,v=3):(y=7,v=4))},g$=(t,r,s)=>{let a,c,u=-1,h=r[1],m=0,y=7,v=4;for(h===0&&(y=138,v=3),a=0;a<=s;a++)if(c=h,h=r[2*(a+1)+1],!(++m<y&&c===h)){if(m<v)do Oh(t,c,t.bl_tree);while(--m!=0);else c!==0?(c!==u&&(Oh(t,c,t.bl_tree),m--),Oh(t,16,t.bl_tree),tl(t,m-3,2)):m<=10?(Oh(t,17,t.bl_tree),tl(t,m-3,3)):(Oh(t,18,t.bl_tree),tl(t,m-11,7));m=0,u=c,h===0?(y=138,v=3):c===h?(y=6,v=3):(y=7,v=4)}};let _$=!1;const y$=(t,r,s,a)=>{tl(t,0+(a?1:0),3),h$(t),tw(t,s),tw(t,~s),s&&t.pending_buf.set(t.window.subarray(r,r+s),t.pending),t.pending+=s};var p_e=t=>{_$||((()=>{let r,s,a,c,u;const h=new Array(16);for(a=0,c=0;c<28;c++)for(W2[c]=a,r=0;r<1<<B2[c];r++)ew[a++]=c;for(ew[a-1]=c,u=0,c=0;c<16;c++)for(YP[c]=u,r=0;r<1<<qP[c];r++)ZT[u++]=c;for(u>>=7;c<XT;c++)for(YP[c]=u<<7,r=0;r<1<<qP[c]-7;r++)ZT[256+u++]=c;for(s=0;s<=JT;s++)h[s]=0;for(r=0;r<=143;)fp[2*r+1]=8,r++,h[8]++;for(;r<=255;)fp[2*r+1]=9,r++,h[9]++;for(;r<=279;)fp[2*r+1]=7,r++,h[7]++;for(;r<=287;)fp[2*r+1]=8,r++,h[8]++;for(u$(fp,287,h),r=0;r<XT;r++)QT[2*r+1]=5,QT[2*r]=l$(r,5);s$=new z2(fp,B2,257,r$,JT),o$=new z2(QT,qP,0,XT,JT),a$=new z2(new Array(0),f_e,0,19,7)})(),_$=!0),t.l_desc=new G2(t.dyn_ltree,s$),t.d_desc=new G2(t.dyn_dtree,o$),t.bl_desc=new G2(t.bl_tree,a$),t.bi_buf=0,t.bi_valid=0,d$(t)},m_e=(t,r,s,a)=>{let c,u,h=0;t.level>0?(t.strm.data_type===2&&(t.strm.data_type=(m=>{let y,v=4093624447;for(y=0;y<=31;y++,v>>>=1)if(1&v&&m.dyn_ltree[2*y]!==0)return 0;if(m.dyn_ltree[18]!==0||m.dyn_ltree[20]!==0||m.dyn_ltree[26]!==0)return 1;for(y=32;y<j2;y++)if(m.dyn_ltree[2*y]!==0)return 1;return 0})(t)),$2(t,t.l_desc),$2(t,t.d_desc),h=(m=>{let y;for(m$(m,m.dyn_ltree,m.l_desc.max_code),m$(m,m.dyn_dtree,m.d_desc.max_code),$2(m,m.bl_desc),y=18;y>=3&&m.bl_tree[2*i$[y]+1]===0;y--);return m.opt_len+=3*(y+1)+5+5+4,y})(t),c=t.opt_len+3+7>>>3,u=t.static_len+3+7>>>3,u<=c&&(c=u)):c=u=s+5,s+4<=c&&r!==-1?y$(t,r,s,a):t.strategy===4||u===c?(tl(t,2+(a?1:0),3),p$(t,fp,QT)):(tl(t,4+(a?1:0),3),((m,y,v,S)=>{let R;for(tl(m,y-257,5),tl(m,v-1,5),tl(m,S-4,4),R=0;R<S;R++)tl(m,m.bl_tree[2*i$[R]+1],3);g$(m,m.dyn_ltree,y-1),g$(m,m.dyn_dtree,v-1)})(t,t.l_desc.max_code+1,t.d_desc.max_code+1,h+1),p$(t,t.dyn_ltree,t.dyn_dtree)),d$(t),a&&h$(t)},g_e=(t,r,s)=>(t.pending_buf[t.sym_buf+t.sym_next++]=r,t.pending_buf[t.sym_buf+t.sym_next++]=r>>8,t.pending_buf[t.sym_buf+t.sym_next++]=s,r===0?t.dyn_ltree[2*s]++:(t.matches++,r--,t.dyn_ltree[2*(ew[s]+j2+1)]++,t.dyn_dtree[2*c$(r)]++),t.sym_next===t.sym_end),__e=t=>{tl(t,2,3),Oh(t,256,fp),(r=>{r.bi_valid===16?(tw(r,r.bi_buf),r.bi_buf=0,r.bi_valid=0):r.bi_valid>=8&&(r.pending_buf[r.pending++]=255&r.bi_buf,r.bi_buf>>=8,r.bi_valid-=8)})(t)},y_e={_tr_init:p_e,_tr_stored_block:y$,_tr_flush_block:m_e,_tr_tally:g_e,_tr_align:__e},nw=(t,r,s,a)=>{let c=65535&t|0,u=t>>>16&65535|0,h=0;for(;s!==0;){h=s>2e3?2e3:s,s-=h;do c=c+r[a++]|0,u=u+c|0;while(--h);c%=65521,u%=65521}return c|u<<16|0};const E_e=new Uint32Array((()=>{let t,r=[];for(var s=0;s<256;s++){t=s;for(var a=0;a<8;a++)t=1&t?3988292384^t>>>1:t>>>1;r[s]=t}return r})());var jo=(t,r,s,a)=>{const c=E_e,u=a+s;t^=-1;for(let h=a;h<u;h++)t=t>>>8^c[255&(t^r[h])];return-1^t},ry={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},XP={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:v_e,_tr_stored_block:K2,_tr_flush_block:S_e,_tr_tally:Qm,_tr_align:b_e}=y_e,{Z_NO_FLUSH:Zm,Z_PARTIAL_FLUSH:T_e,Z_FULL_FLUSH:w_e,Z_FINISH:Cu,Z_BLOCK:E$,Z_OK:pa,Z_STREAM_END:v$,Z_STREAM_ERROR:kh,Z_DATA_ERROR:C_e,Z_BUF_ERROR:q2,Z_DEFAULT_COMPRESSION:R_e,Z_FILTERED:I_e,Z_HUFFMAN_ONLY:JP,Z_RLE:A_e,Z_FIXED:P_e,Z_DEFAULT_STRATEGY:O_e,Z_UNKNOWN:k_e,Z_DEFLATED:QP}=XP,Y2=286,N_e=30,D_e=19,x_e=2*Y2+1,L_e=15,iy=258,Nh=262,gS=42,sy=113,rw=666,oy=(t,r)=>(t.msg=ry[r],r),S$=t=>2*t-(t>4?9:0),eg=t=>{let r=t.length;for(;--r>=0;)t[r]=0},M_e=t=>{let r,s,a,c=t.w_size;r=t.hash_size,a=r;do s=t.head[--a],t.head[a]=s>=c?s-c:0;while(--r);r=c,a=r;do s=t.prev[--a],t.prev[a]=s>=c?s-c:0;while(--r)};let tg=(t,r,s)=>(r<<t.hash_shift^s)&t.hash_mask;const Pl=t=>{const r=t.state;let s=r.pending;s>t.avail_out&&(s=t.avail_out),s!==0&&(t.output.set(r.pending_buf.subarray(r.pending_out,r.pending_out+s),t.next_out),t.next_out+=s,r.pending_out+=s,t.total_out+=s,t.avail_out-=s,r.pending-=s,r.pending===0&&(r.pending_out=0))},Ol=(t,r)=>{S_e(t,t.block_start>=0?t.block_start:-1,t.strstart-t.block_start,r),t.block_start=t.strstart,Pl(t.strm)},ti=(t,r)=>{t.pending_buf[t.pending++]=r},iw=(t,r)=>{t.pending_buf[t.pending++]=r>>>8&255,t.pending_buf[t.pending++]=255&r},X2=(t,r,s,a)=>{let c=t.avail_in;return c>a&&(c=a),c===0?0:(t.avail_in-=c,r.set(t.input.subarray(t.next_in,t.next_in+c),s),t.state.wrap===1?t.adler=nw(t.adler,r,c,s):t.state.wrap===2&&(t.adler=jo(t.adler,r,c,s)),t.next_in+=c,t.total_in+=c,c)},b$=(t,r)=>{let s,a,c=t.max_chain_length,u=t.strstart,h=t.prev_length,m=t.nice_match;const y=t.strstart>t.w_size-Nh?t.strstart-(t.w_size-Nh):0,v=t.window,S=t.w_mask,R=t.prev,P=t.strstart+iy;let N=v[u+h-1],G=v[u+h];t.prev_length>=t.good_match&&(c>>=2),m>t.lookahead&&(m=t.lookahead);do if(s=r,v[s+h]===G&&v[s+h-1]===N&&v[s]===v[u]&&v[++s]===v[u+1]){u+=2,s++;do;while(v[++u]===v[++s]&&v[++u]===v[++s]&&v[++u]===v[++s]&&v[++u]===v[++s]&&v[++u]===v[++s]&&v[++u]===v[++s]&&v[++u]===v[++s]&&v[++u]===v[++s]&&u<P);if(a=iy-(P-u),u=P-iy,a>h){if(t.match_start=r,h=a,a>=m)break;N=v[u+h-1],G=v[u+h]}}while((r=R[r&S])>y&&--c!=0);return h<=t.lookahead?h:t.lookahead},_S=t=>{const r=t.w_size;let s,a,c;do{if(a=t.window_size-t.lookahead-t.strstart,t.strstart>=r+(r-Nh)&&(t.window.set(t.window.subarray(r,r+r-a),0),t.match_start-=r,t.strstart-=r,t.block_start-=r,t.insert>t.strstart&&(t.insert=t.strstart),M_e(t),a+=r),t.strm.avail_in===0)break;if(s=X2(t.strm,t.window,t.strstart+t.lookahead,a),t.lookahead+=s,t.lookahead+t.insert>=3)for(c=t.strstart-t.insert,t.ins_h=t.window[c],t.ins_h=tg(t,t.ins_h,t.window[c+1]);t.insert&&(t.ins_h=tg(t,t.ins_h,t.window[c+3-1]),t.prev[c&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=c,c++,t.insert--,!(t.lookahead+t.insert<3)););}while(t.lookahead<Nh&&t.strm.avail_in!==0)},T$=(t,r)=>{let s,a,c,u=t.pending_buf_size-5>t.w_size?t.w_size:t.pending_buf_size-5,h=0,m=t.strm.avail_in;do{if(s=65535,c=t.bi_valid+42>>3,t.strm.avail_out<c||(c=t.strm.avail_out-c,a=t.strstart-t.block_start,s>a+t.strm.avail_in&&(s=a+t.strm.avail_in),s>c&&(s=c),s<u&&(s===0&&r!==Cu||r===Zm||s!==a+t.strm.avail_in)))break;h=r===Cu&&s===a+t.strm.avail_in?1:0,K2(t,0,0,h),t.pending_buf[t.pending-4]=s,t.pending_buf[t.pending-3]=s>>8,t.pending_buf[t.pending-2]=~s,t.pending_buf[t.pending-1]=~s>>8,Pl(t.strm),a&&(a>s&&(a=s),t.strm.output.set(t.window.subarray(t.block_start,t.block_start+a),t.strm.next_out),t.strm.next_out+=a,t.strm.avail_out-=a,t.strm.total_out+=a,t.block_start+=a,s-=a),s&&(X2(t.strm,t.strm.output,t.strm.next_out,s),t.strm.next_out+=s,t.strm.avail_out-=s,t.strm.total_out+=s)}while(h===0);return m-=t.strm.avail_in,m&&(m>=t.w_size?(t.matches=2,t.window.set(t.strm.input.subarray(t.strm.next_in-t.w_size,t.strm.next_in),0),t.strstart=t.w_size,t.insert=t.strstart):(t.window_size-t.strstart<=m&&(t.strstart-=t.w_size,t.window.set(t.window.subarray(t.w_size,t.w_size+t.strstart),0),t.matches<2&&t.matches++,t.insert>t.strstart&&(t.insert=t.strstart)),t.window.set(t.strm.input.subarray(t.strm.next_in-m,t.strm.next_in),t.strstart),t.strstart+=m,t.insert+=m>t.w_size-t.insert?t.w_size-t.insert:m),t.block_start=t.strstart),t.high_water<t.strstart&&(t.high_water=t.strstart),h?4:r!==Zm&&r!==Cu&&t.strm.avail_in===0&&t.strstart===t.block_start?2:(c=t.window_size-t.strstart,t.strm.avail_in>c&&t.block_start>=t.w_size&&(t.block_start-=t.w_size,t.strstart-=t.w_size,t.window.set(t.window.subarray(t.w_size,t.w_size+t.strstart),0),t.matches<2&&t.matches++,c+=t.w_size,t.insert>t.strstart&&(t.insert=t.strstart)),c>t.strm.avail_in&&(c=t.strm.avail_in),c&&(X2(t.strm,t.window,t.strstart,c),t.strstart+=c,t.insert+=c>t.w_size-t.insert?t.w_size-t.insert:c),t.high_water<t.strstart&&(t.high_water=t.strstart),c=t.bi_valid+42>>3,c=t.pending_buf_size-c>65535?65535:t.pending_buf_size-c,u=c>t.w_size?t.w_size:c,a=t.strstart-t.block_start,(a>=u||(a||r===Cu)&&r!==Zm&&t.strm.avail_in===0&&a<=c)&&(s=a>c?c:a,h=r===Cu&&t.strm.avail_in===0&&s===a?1:0,K2(t,t.block_start,s,h),t.block_start+=s,Pl(t.strm)),h?3:1)},J2=(t,r)=>{let s,a;for(;;){if(t.lookahead<Nh){if(_S(t),t.lookahead<Nh&&r===Zm)return 1;if(t.lookahead===0)break}if(s=0,t.lookahead>=3&&(t.ins_h=tg(t,t.ins_h,t.window[t.strstart+3-1]),s=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),s!==0&&t.strstart-s<=t.w_size-Nh&&(t.match_length=b$(t,s)),t.match_length>=3)if(a=Qm(t,t.strstart-t.match_start,t.match_length-3),t.lookahead-=t.match_length,t.match_length<=t.max_lazy_match&&t.lookahead>=3){t.match_length--;do t.strstart++,t.ins_h=tg(t,t.ins_h,t.window[t.strstart+3-1]),s=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart;while(--t.match_length!=0);t.strstart++}else t.strstart+=t.match_length,t.match_length=0,t.ins_h=t.window[t.strstart],t.ins_h=tg(t,t.ins_h,t.window[t.strstart+1]);else a=Qm(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++;if(a&&(Ol(t,!1),t.strm.avail_out===0))return 1}return t.insert=t.strstart<2?t.strstart:2,r===Cu?(Ol(t,!0),t.strm.avail_out===0?3:4):t.sym_next&&(Ol(t,!1),t.strm.avail_out===0)?1:2},yS=(t,r)=>{let s,a,c;for(;;){if(t.lookahead<Nh){if(_S(t),t.lookahead<Nh&&r===Zm)return 1;if(t.lookahead===0)break}if(s=0,t.lookahead>=3&&(t.ins_h=tg(t,t.ins_h,t.window[t.strstart+3-1]),s=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),t.prev_length=t.match_length,t.prev_match=t.match_start,t.match_length=2,s!==0&&t.prev_length<t.max_lazy_match&&t.strstart-s<=t.w_size-Nh&&(t.match_length=b$(t,s),t.match_length<=5&&(t.strategy===I_e||t.match_length===3&&t.strstart-t.match_start>4096)&&(t.match_length=2)),t.prev_length>=3&&t.match_length<=t.prev_length){c=t.strstart+t.lookahead-3,a=Qm(t,t.strstart-1-t.prev_match,t.prev_length-3),t.lookahead-=t.prev_length-1,t.prev_length-=2;do++t.strstart<=c&&(t.ins_h=tg(t,t.ins_h,t.window[t.strstart+3-1]),s=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart);while(--t.prev_length!=0);if(t.match_available=0,t.match_length=2,t.strstart++,a&&(Ol(t,!1),t.strm.avail_out===0))return 1}else if(t.match_available){if(a=Qm(t,0,t.window[t.strstart-1]),a&&Ol(t,!1),t.strstart++,t.lookahead--,t.strm.avail_out===0)return 1}else t.match_available=1,t.strstart++,t.lookahead--}return t.match_available&&(a=Qm(t,0,t.window[t.strstart-1]),t.match_available=0),t.insert=t.strstart<2?t.strstart:2,r===Cu?(Ol(t,!0),t.strm.avail_out===0?3:4):t.sym_next&&(Ol(t,!1),t.strm.avail_out===0)?1:2};function Dh(t,r,s,a,c){this.good_length=t,this.max_lazy=r,this.nice_length=s,this.max_chain=a,this.func=c}const sw=[new Dh(0,0,0,0,T$),new Dh(4,4,8,4,J2),new Dh(4,5,16,8,J2),new Dh(4,6,32,32,J2),new Dh(4,4,16,16,yS),new Dh(8,16,32,32,yS),new Dh(8,16,128,128,yS),new Dh(8,32,128,256,yS),new Dh(32,128,258,1024,yS),new Dh(32,258,258,4096,yS)];function U_e(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=QP,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(2*x_e),this.dyn_dtree=new Uint16Array(2*(2*N_e+1)),this.bl_tree=new Uint16Array(2*(2*D_e+1)),eg(this.dyn_ltree),eg(this.dyn_dtree),eg(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(L_e+1),this.heap=new Uint16Array(2*Y2+1),eg(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*Y2+1),eg(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const ow=t=>{if(!t)return 1;const r=t.state;return!r||r.strm!==t||r.status!==gS&&r.status!==57&&r.status!==69&&r.status!==73&&r.status!==91&&r.status!==103&&r.status!==sy&&r.status!==rw?1:0},w$=t=>{if(ow(t))return oy(t,kh);t.total_in=t.total_out=0,t.data_type=k_e;const r=t.state;return r.pending=0,r.pending_out=0,r.wrap<0&&(r.wrap=-r.wrap),r.status=r.wrap===2?57:r.wrap?gS:sy,t.adler=r.wrap===2?0:1,r.last_flush=-2,v_e(r),pa},C$=t=>{const r=w$(t);return r===pa&&(s=>{s.window_size=2*s.w_size,eg(s.head),s.max_lazy_match=sw[s.level].max_lazy,s.good_match=sw[s.level].good_length,s.nice_match=sw[s.level].nice_length,s.max_chain_length=sw[s.level].max_chain,s.strstart=0,s.block_start=0,s.lookahead=0,s.insert=0,s.match_length=s.prev_length=2,s.match_available=0,s.ins_h=0})(t.state),r},R$=(t,r,s,a,c,u)=>{if(!t)return kh;let h=1;if(r===R_e&&(r=6),a<0?(h=0,a=-a):a>15&&(h=2,a-=16),c<1||c>9||s!==QP||a<8||a>15||r<0||r>9||u<0||u>P_e||a===8&&h!==1)return oy(t,kh);a===8&&(a=9);const m=new U_e;return t.state=m,m.strm=t,m.status=gS,m.wrap=h,m.gzhead=null,m.w_bits=a,m.w_size=1<<m.w_bits,m.w_mask=m.w_size-1,m.hash_bits=c+7,m.hash_size=1<<m.hash_bits,m.hash_mask=m.hash_size-1,m.hash_shift=~~((m.hash_bits+3-1)/3),m.window=new Uint8Array(2*m.w_size),m.head=new Uint16Array(m.hash_size),m.prev=new Uint16Array(m.w_size),m.lit_bufsize=1<<c+6,m.pending_buf_size=4*m.lit_bufsize,m.pending_buf=new Uint8Array(m.pending_buf_size),m.sym_buf=m.lit_bufsize,m.sym_end=3*(m.lit_bufsize-1),m.level=r,m.strategy=u,m.method=s,C$(t)};var V_e=(t,r)=>{if(ow(t)||r>E$||r<0)return t?oy(t,kh):kh;const s=t.state;if(!t.output||t.avail_in!==0&&!t.input||s.status===rw&&r!==Cu)return oy(t,t.avail_out===0?q2:kh);const a=s.last_flush;if(s.last_flush=r,s.pending!==0){if(Pl(t),t.avail_out===0)return s.last_flush=-1,pa}else if(t.avail_in===0&&S$(r)<=S$(a)&&r!==Cu)return oy(t,q2);if(s.status===rw&&t.avail_in!==0)return oy(t,q2);if(s.status===gS&&s.wrap===0&&(s.status=sy),s.status===gS){let c=QP+(s.w_bits-8<<4)<<8,u=-1;if(u=s.strategy>=JP||s.level<2?0:s.level<6?1:s.level===6?2:3,c|=u<<6,s.strstart!==0&&(c|=32),c+=31-c%31,iw(s,c),s.strstart!==0&&(iw(s,t.adler>>>16),iw(s,65535&t.adler)),t.adler=1,s.status=sy,Pl(t),s.pending!==0)return s.last_flush=-1,pa}if(s.status===57){if(t.adler=0,ti(s,31),ti(s,139),ti(s,8),s.gzhead)ti(s,(s.gzhead.text?1:0)+(s.gzhead.hcrc?2:0)+(s.gzhead.extra?4:0)+(s.gzhead.name?8:0)+(s.gzhead.comment?16:0)),ti(s,255&s.gzhead.time),ti(s,s.gzhead.time>>8&255),ti(s,s.gzhead.time>>16&255),ti(s,s.gzhead.time>>24&255),ti(s,s.level===9?2:s.strategy>=JP||s.level<2?4:0),ti(s,255&s.gzhead.os),s.gzhead.extra&&s.gzhead.extra.length&&(ti(s,255&s.gzhead.extra.length),ti(s,s.gzhead.extra.length>>8&255)),s.gzhead.hcrc&&(t.adler=jo(t.adler,s.pending_buf,s.pending,0)),s.gzindex=0,s.status=69;else if(ti(s,0),ti(s,0),ti(s,0),ti(s,0),ti(s,0),ti(s,s.level===9?2:s.strategy>=JP||s.level<2?4:0),ti(s,3),s.status=sy,Pl(t),s.pending!==0)return s.last_flush=-1,pa}if(s.status===69){if(s.gzhead.extra){let c=s.pending,u=(65535&s.gzhead.extra.length)-s.gzindex;for(;s.pending+u>s.pending_buf_size;){let m=s.pending_buf_size-s.pending;if(s.pending_buf.set(s.gzhead.extra.subarray(s.gzindex,s.gzindex+m),s.pending),s.pending=s.pending_buf_size,s.gzhead.hcrc&&s.pending>c&&(t.adler=jo(t.adler,s.pending_buf,s.pending-c,c)),s.gzindex+=m,Pl(t),s.pending!==0)return s.last_flush=-1,pa;c=0,u-=m}let h=new Uint8Array(s.gzhead.extra);s.pending_buf.set(h.subarray(s.gzindex,s.gzindex+u),s.pending),s.pending+=u,s.gzhead.hcrc&&s.pending>c&&(t.adler=jo(t.adler,s.pending_buf,s.pending-c,c)),s.gzindex=0}s.status=73}if(s.status===73){if(s.gzhead.name){let c,u=s.pending;do{if(s.pending===s.pending_buf_size){if(s.gzhead.hcrc&&s.pending>u&&(t.adler=jo(t.adler,s.pending_buf,s.pending-u,u)),Pl(t),s.pending!==0)return s.last_flush=-1,pa;u=0}c=s.gzindex<s.gzhead.name.length?255&s.gzhead.name.charCodeAt(s.gzindex++):0,ti(s,c)}while(c!==0);s.gzhead.hcrc&&s.pending>u&&(t.adler=jo(t.adler,s.pending_buf,s.pending-u,u)),s.gzindex=0}s.status=91}if(s.status===91){if(s.gzhead.comment){let c,u=s.pending;do{if(s.pending===s.pending_buf_size){if(s.gzhead.hcrc&&s.pending>u&&(t.adler=jo(t.adler,s.pending_buf,s.pending-u,u)),Pl(t),s.pending!==0)return s.last_flush=-1,pa;u=0}c=s.gzindex<s.gzhead.comment.length?255&s.gzhead.comment.charCodeAt(s.gzindex++):0,ti(s,c)}while(c!==0);s.gzhead.hcrc&&s.pending>u&&(t.adler=jo(t.adler,s.pending_buf,s.pending-u,u))}s.status=103}if(s.status===103){if(s.gzhead.hcrc){if(s.pending+2>s.pending_buf_size&&(Pl(t),s.pending!==0))return s.last_flush=-1,pa;ti(s,255&t.adler),ti(s,t.adler>>8&255),t.adler=0}if(s.status=sy,Pl(t),s.pending!==0)return s.last_flush=-1,pa}if(t.avail_in!==0||s.lookahead!==0||r!==Zm&&s.status!==rw){let c=s.level===0?T$(s,r):s.strategy===JP?((u,h)=>{let m;for(;;){if(u.lookahead===0&&(_S(u),u.lookahead===0)){if(h===Zm)return 1;break}if(u.match_length=0,m=Qm(u,0,u.window[u.strstart]),u.lookahead--,u.strstart++,m&&(Ol(u,!1),u.strm.avail_out===0))return 1}return u.insert=0,h===Cu?(Ol(u,!0),u.strm.avail_out===0?3:4):u.sym_next&&(Ol(u,!1),u.strm.avail_out===0)?1:2})(s,r):s.strategy===A_e?((u,h)=>{let m,y,v,S;const R=u.window;for(;;){if(u.lookahead<=iy){if(_S(u),u.lookahead<=iy&&h===Zm)return 1;if(u.lookahead===0)break}if(u.match_length=0,u.lookahead>=3&&u.strstart>0&&(v=u.strstart-1,y=R[v],y===R[++v]&&y===R[++v]&&y===R[++v])){S=u.strstart+iy;do;while(y===R[++v]&&y===R[++v]&&y===R[++v]&&y===R[++v]&&y===R[++v]&&y===R[++v]&&y===R[++v]&&y===R[++v]&&v<S);u.match_length=iy-(S-v),u.match_length>u.lookahead&&(u.match_length=u.lookahead)}if(u.match_length>=3?(m=Qm(u,1,u.match_length-3),u.lookahead-=u.match_length,u.strstart+=u.match_length,u.match_length=0):(m=Qm(u,0,u.window[u.strstart]),u.lookahead--,u.strstart++),m&&(Ol(u,!1),u.strm.avail_out===0))return 1}return u.insert=0,h===Cu?(Ol(u,!0),u.strm.avail_out===0?3:4):u.sym_next&&(Ol(u,!1),u.strm.avail_out===0)?1:2})(s,r):sw[s.level].func(s,r);if(c!==3&&c!==4||(s.status=rw),c===1||c===3)return t.avail_out===0&&(s.last_flush=-1),pa;if(c===2&&(r===T_e?b_e(s):r!==E$&&(K2(s,0,0,!1),r===w_e&&(eg(s.head),s.lookahead===0&&(s.strstart=0,s.block_start=0,s.insert=0))),Pl(t),t.avail_out===0))return s.last_flush=-1,pa}return r!==Cu?pa:s.wrap<=0?v$:(s.wrap===2?(ti(s,255&t.adler),ti(s,t.adler>>8&255),ti(s,t.adler>>16&255),ti(s,t.adler>>24&255),ti(s,255&t.total_in),ti(s,t.total_in>>8&255),ti(s,t.total_in>>16&255),ti(s,t.total_in>>24&255)):(iw(s,t.adler>>>16),iw(s,65535&t.adler)),Pl(t),s.wrap>0&&(s.wrap=-s.wrap),s.pending!==0?pa:v$)},F_e=(t,r)=>{let s=r.length;if(ow(t))return kh;const a=t.state,c=a.wrap;if(c===2||c===1&&a.status!==gS||a.lookahead)return kh;if(c===1&&(t.adler=nw(t.adler,r,s,0)),a.wrap=0,s>=a.w_size){c===0&&(eg(a.head),a.strstart=0,a.block_start=0,a.insert=0);let y=new Uint8Array(a.w_size);y.set(r.subarray(s-a.w_size,s),0),r=y,s=a.w_size}const u=t.avail_in,h=t.next_in,m=t.input;for(t.avail_in=s,t.next_in=0,t.input=r,_S(a);a.lookahead>=3;){let y=a.strstart,v=a.lookahead-2;do a.ins_h=tg(a,a.ins_h,a.window[y+3-1]),a.prev[y&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=y,y++;while(--v);a.strstart=y,a.lookahead=2,_S(a)}return a.strstart+=a.lookahead,a.block_start=a.strstart,a.insert=a.lookahead,a.lookahead=0,a.match_length=a.prev_length=2,a.match_available=0,t.next_in=h,t.input=m,t.avail_in=u,a.wrap=c,pa},aw={deflateInit:(t,r)=>R$(t,r,QP,15,8,O_e),deflateInit2:R$,deflateReset:C$,deflateResetKeep:w$,deflateSetHeader:(t,r)=>ow(t)||t.state.wrap!==2?kh:(t.state.gzhead=r,pa),deflate:V_e,deflateEnd:t=>{if(ow(t))return kh;const r=t.state.status;return t.state=null,r===sy?oy(t,C_e):pa},deflateSetDictionary:F_e,deflateInfo:"pako deflate (from Nodeca project)"};const j_e=(t,r)=>Object.prototype.hasOwnProperty.call(t,r);var ZP={assign:function(t){const r=Array.prototype.slice.call(arguments,1);for(;r.length;){const s=r.shift();if(s){if(typeof s!="object")throw new TypeError(s+"must be non-object");for(const a in s)j_e(s,a)&&(t[a]=s[a])}}return t},flattenChunks:t=>{let r=0;for(let a=0,c=t.length;a<c;a++)r+=t[a].length;const s=new Uint8Array(r);for(let a=0,c=0,u=t.length;a<u;a++){let h=t[a];s.set(h,c),c+=h.length}return s}};let I$=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{I$=!1}const cw=new Uint8Array(256);for(let t=0;t<256;t++)cw[t]=t>=252?6:t>=248?5:t>=240?4:t>=224?3:t>=192?2:1;cw[254]=cw[254]=1;var lw={string2buf:t=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(t);let r,s,a,c,u,h=t.length,m=0;for(c=0;c<h;c++)s=t.charCodeAt(c),(64512&s)==55296&&c+1<h&&(a=t.charCodeAt(c+1),(64512&a)==56320&&(s=65536+(s-55296<<10)+(a-56320),c++)),m+=s<128?1:s<2048?2:s<65536?3:4;for(r=new Uint8Array(m),u=0,c=0;u<m;c++)s=t.charCodeAt(c),(64512&s)==55296&&c+1<h&&(a=t.charCodeAt(c+1),(64512&a)==56320&&(s=65536+(s-55296<<10)+(a-56320),c++)),s<128?r[u++]=s:s<2048?(r[u++]=192|s>>>6,r[u++]=128|63&s):s<65536?(r[u++]=224|s>>>12,r[u++]=128|s>>>6&63,r[u++]=128|63&s):(r[u++]=240|s>>>18,r[u++]=128|s>>>12&63,r[u++]=128|s>>>6&63,r[u++]=128|63&s);return r},buf2string:(t,r)=>{const s=r||t.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(t.subarray(0,r));let a,c;const u=new Array(2*s);for(c=0,a=0;a<s;){let h=t[a++];if(h<128){u[c++]=h;continue}let m=cw[h];if(m>4)u[c++]=65533,a+=m-1;else{for(h&=m===2?31:m===3?15:7;m>1&&a<s;)h=h<<6|63&t[a++],m--;m>1?u[c++]=65533:h<65536?u[c++]=h:(h-=65536,u[c++]=55296|h>>10&1023,u[c++]=56320|1023&h)}}return((h,m)=>{if(m<65534&&h.subarray&&I$)return String.fromCharCode.apply(null,h.length===m?h:h.subarray(0,m));let y="";for(let v=0;v<m;v++)y+=String.fromCharCode(h[v]);return y})(u,c)},utf8border:(t,r)=>{(r=r||t.length)>t.length&&(r=t.length);let s=r-1;for(;s>=0&&(192&t[s])==128;)s--;return s<0||s===0?r:s+cw[t[s]]>r?s:r}},A$=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const P$=Object.prototype.toString,{Z_NO_FLUSH:B_e,Z_SYNC_FLUSH:W_e,Z_FULL_FLUSH:z_e,Z_FINISH:G_e,Z_OK:eO,Z_STREAM_END:H_e,Z_DEFAULT_COMPRESSION:$_e,Z_DEFAULT_STRATEGY:K_e,Z_DEFLATED:q_e}=XP;function tO(t){this.options=ZP.assign({level:$_e,method:q_e,chunkSize:16384,windowBits:15,memLevel:8,strategy:K_e},t||{});let r=this.options;r.raw&&r.windowBits>0?r.windowBits=-r.windowBits:r.gzip&&r.windowBits>0&&r.windowBits<16&&(r.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new A$,this.strm.avail_out=0;let s=aw.deflateInit2(this.strm,r.level,r.method,r.windowBits,r.memLevel,r.strategy);if(s!==eO)throw new Error(ry[s]);if(r.header&&aw.deflateSetHeader(this.strm,r.header),r.dictionary){let a;if(a=typeof r.dictionary=="string"?lw.string2buf(r.dictionary):P$.call(r.dictionary)==="[object ArrayBuffer]"?new Uint8Array(r.dictionary):r.dictionary,s=aw.deflateSetDictionary(this.strm,a),s!==eO)throw new Error(ry[s]);this._dict_set=!0}}function Y_e(t,r){const s=new tO(r);if(s.push(t,!0),s.err)throw s.msg||ry[s.err];return s.result}tO.prototype.push=function(t,r){const s=this.strm,a=this.options.chunkSize;let c,u;if(this.ended)return!1;for(u=r===~~r?r:r===!0?G_e:B_e,typeof t=="string"?s.input=lw.string2buf(t):P$.call(t)==="[object ArrayBuffer]"?s.input=new Uint8Array(t):s.input=t,s.next_in=0,s.avail_in=s.input.length;;)if(s.avail_out===0&&(s.output=new Uint8Array(a),s.next_out=0,s.avail_out=a),(u===W_e||u===z_e)&&s.avail_out<=6)this.onData(s.output.subarray(0,s.next_out)),s.avail_out=0;else{if(c=aw.deflate(s,u),c===H_e)return s.next_out>0&&this.onData(s.output.subarray(0,s.next_out)),c=aw.deflateEnd(this.strm),this.onEnd(c),this.ended=!0,c===eO;if(s.avail_out!==0){if(u>0&&s.next_out>0)this.onData(s.output.subarray(0,s.next_out)),s.avail_out=0;else if(s.avail_in===0)break}else this.onData(s.output)}return!0},tO.prototype.onData=function(t){this.chunks.push(t)},tO.prototype.onEnd=function(t){t===eO&&(this.result=ZP.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};var X_e={deflate:Y_e};const nO=16209;var J_e=function(t,r){let s,a,c,u,h,m,y,v,S,R,P,N,G,F,j,X,ee,he,Se,Te,ye,Ne,Ye,ht;const mt=t.state;s=t.next_in,Ye=t.input,a=s+(t.avail_in-5),c=t.next_out,ht=t.output,u=c-(r-t.avail_out),h=c+(t.avail_out-257),m=mt.dmax,y=mt.wsize,v=mt.whave,S=mt.wnext,R=mt.window,P=mt.hold,N=mt.bits,G=mt.lencode,F=mt.distcode,j=(1<<mt.lenbits)-1,X=(1<<mt.distbits)-1;e:do{N<15&&(P+=Ye[s++]<<N,N+=8,P+=Ye[s++]<<N,N+=8),ee=G[P&j];t:for(;;){if(he=ee>>>24,P>>>=he,N-=he,he=ee>>>16&255,he===0)ht[c++]=65535&ee;else{if(!(16&he)){if((64&he)==0){ee=G[(65535&ee)+(P&(1<<he)-1)];continue t}if(32&he){mt.mode=16191;break e}t.msg="invalid literal/length code",mt.mode=nO;break e}Se=65535&ee,he&=15,he&&(N<he&&(P+=Ye[s++]<<N,N+=8),Se+=P&(1<<he)-1,P>>>=he,N-=he),N<15&&(P+=Ye[s++]<<N,N+=8,P+=Ye[s++]<<N,N+=8),ee=F[P&X];n:for(;;){if(he=ee>>>24,P>>>=he,N-=he,he=ee>>>16&255,!(16&he)){if((64&he)==0){ee=F[(65535&ee)+(P&(1<<he)-1)];continue n}t.msg="invalid distance code",mt.mode=nO;break e}if(Te=65535&ee,he&=15,N<he&&(P+=Ye[s++]<<N,N+=8,N<he&&(P+=Ye[s++]<<N,N+=8)),Te+=P&(1<<he)-1,Te>m){t.msg="invalid distance too far back",mt.mode=nO;break e}if(P>>>=he,N-=he,he=c-u,Te>he){if(he=Te-he,he>v&&mt.sane){t.msg="invalid distance too far back",mt.mode=nO;break e}if(ye=0,Ne=R,S===0){if(ye+=y-he,he<Se){Se-=he;do ht[c++]=R[ye++];while(--he);ye=c-Te,Ne=ht}}else if(S<he){if(ye+=y+S-he,he-=S,he<Se){Se-=he;do ht[c++]=R[ye++];while(--he);if(ye=0,S<Se){he=S,Se-=he;do ht[c++]=R[ye++];while(--he);ye=c-Te,Ne=ht}}}else if(ye+=S-he,he<Se){Se-=he;do ht[c++]=R[ye++];while(--he);ye=c-Te,Ne=ht}for(;Se>2;)ht[c++]=Ne[ye++],ht[c++]=Ne[ye++],ht[c++]=Ne[ye++],Se-=3;Se&&(ht[c++]=Ne[ye++],Se>1&&(ht[c++]=Ne[ye++]))}else{ye=c-Te;do ht[c++]=ht[ye++],ht[c++]=ht[ye++],ht[c++]=ht[ye++],Se-=3;while(Se>2);Se&&(ht[c++]=ht[ye++],Se>1&&(ht[c++]=ht[ye++]))}break}}break}}while(s<a&&c<h);Se=N>>3,s-=Se,N-=Se<<3,P&=(1<<N)-1,t.next_in=s,t.next_out=c,t.avail_in=s<a?a-s+5:5-(s-a),t.avail_out=c<h?h-c+257:257-(c-h),mt.hold=P,mt.bits=N};const rO=15,Q_e=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),Z_e=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),eye=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),tye=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var uw=(t,r,s,a,c,u,h,m)=>{const y=m.bits;let v,S,R,P,N,G,F=0,j=0,X=0,ee=0,he=0,Se=0,Te=0,ye=0,Ne=0,Ye=0,ht=null;const mt=new Uint16Array(16),Tn=new Uint16Array(16);let wn,fr,ui,Xr=null;for(F=0;F<=rO;F++)mt[F]=0;for(j=0;j<a;j++)mt[r[s+j]]++;for(he=y,ee=rO;ee>=1&&mt[ee]===0;ee--);if(he>ee&&(he=ee),ee===0)return c[u++]=20971520,c[u++]=20971520,m.bits=1,0;for(X=1;X<ee&&mt[X]===0;X++);for(he<X&&(he=X),ye=1,F=1;F<=rO;F++)if(ye<<=1,ye-=mt[F],ye<0)return-1;if(ye>0&&(t===0||ee!==1))return-1;for(Tn[1]=0,F=1;F<rO;F++)Tn[F+1]=Tn[F]+mt[F];for(j=0;j<a;j++)r[s+j]!==0&&(h[Tn[r[s+j]]++]=j);if(t===0?(ht=Xr=h,G=20):t===1?(ht=Q_e,Xr=Z_e,G=257):(ht=eye,Xr=tye,G=0),Ye=0,j=0,F=X,N=u,Se=he,Te=0,R=-1,Ne=1<<he,P=Ne-1,t===1&&Ne>852||t===2&&Ne>592)return 1;for(;;){wn=F-Te,h[j]+1<G?(fr=0,ui=h[j]):h[j]>=G?(fr=Xr[h[j]-G],ui=ht[h[j]-G]):(fr=96,ui=0),v=1<<F-Te,S=1<<Se,X=S;do S-=v,c[N+(Ye>>Te)+S]=wn<<24|fr<<16|ui|0;while(S!==0);for(v=1<<F-1;Ye&v;)v>>=1;if(v!==0?(Ye&=v-1,Ye+=v):Ye=0,j++,--mt[F]==0){if(F===ee)break;F=r[s+h[j]]}if(F>he&&(Ye&P)!==R){for(Te===0&&(Te=he),N+=X,Se=F-Te,ye=1<<Se;Se+Te<ee&&(ye-=mt[Se+Te],!(ye<=0));)Se++,ye<<=1;if(Ne+=1<<Se,t===1&&Ne>852||t===2&&Ne>592)return 1;R=Ye&P,c[R]=he<<24|Se<<16|N-u|0}}return Ye!==0&&(c[N+Ye]=F-Te<<24|64<<16|0),m.bits=he,0};const{Z_FINISH:O$,Z_BLOCK:nye,Z_TREES:iO,Z_OK:ay,Z_STREAM_END:rye,Z_NEED_DICT:iye,Z_STREAM_ERROR:Ru,Z_DATA_ERROR:k$,Z_MEM_ERROR:N$,Z_BUF_ERROR:sye,Z_DEFLATED:D$}=XP,sO=16180,oO=16190,pp=16191,Q2=16192,Z2=16194,aO=16199,cO=16200,eM=16206,ls=16209,x$=t=>(t>>>24&255)+(t>>>8&65280)+((65280&t)<<8)+((255&t)<<24);function oye(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const cy=t=>{if(!t)return 1;const r=t.state;return!r||r.strm!==t||r.mode<sO||r.mode>16211?1:0},L$=t=>{if(cy(t))return Ru;const r=t.state;return t.total_in=t.total_out=r.total=0,t.msg="",r.wrap&&(t.adler=1&r.wrap),r.mode=sO,r.last=0,r.havedict=0,r.flags=-1,r.dmax=32768,r.head=null,r.hold=0,r.bits=0,r.lencode=r.lendyn=new Int32Array(852),r.distcode=r.distdyn=new Int32Array(592),r.sane=1,r.back=-1,ay},M$=t=>{if(cy(t))return Ru;const r=t.state;return r.wsize=0,r.whave=0,r.wnext=0,L$(t)},U$=(t,r)=>{let s;if(cy(t))return Ru;const a=t.state;return r<0?(s=0,r=-r):(s=5+(r>>4),r<48&&(r&=15)),r&&(r<8||r>15)?Ru:(a.window!==null&&a.wbits!==r&&(a.window=null),a.wrap=s,a.wbits=r,M$(t))},V$=(t,r)=>{if(!t)return Ru;const s=new oye;t.state=s,s.strm=t,s.window=null,s.mode=sO;const a=U$(t,r);return a!==ay&&(t.state=null),a};let tM,nM,F$=!0;const aye=t=>{if(F$){tM=new Int32Array(512),nM=new Int32Array(32);let r=0;for(;r<144;)t.lens[r++]=8;for(;r<256;)t.lens[r++]=9;for(;r<280;)t.lens[r++]=7;for(;r<288;)t.lens[r++]=8;for(uw(1,t.lens,0,288,tM,0,t.work,{bits:9}),r=0;r<32;)t.lens[r++]=5;uw(2,t.lens,0,32,nM,0,t.work,{bits:5}),F$=!1}t.lencode=tM,t.lenbits=9,t.distcode=nM,t.distbits=5},j$=(t,r,s,a)=>{let c;const u=t.state;return u.window===null&&(u.wsize=1<<u.wbits,u.wnext=0,u.whave=0,u.window=new Uint8Array(u.wsize)),a>=u.wsize?(u.window.set(r.subarray(s-u.wsize,s),0),u.wnext=0,u.whave=u.wsize):(c=u.wsize-u.wnext,c>a&&(c=a),u.window.set(r.subarray(s-a,s-a+c),u.wnext),(a-=c)?(u.window.set(r.subarray(s-a,s),0),u.wnext=a,u.whave=u.wsize):(u.wnext+=c,u.wnext===u.wsize&&(u.wnext=0),u.whave<u.wsize&&(u.whave+=c))),0};var cye=(t,r)=>{let s,a,c,u,h,m,y,v,S,R,P,N,G,F,j,X,ee,he,Se,Te,ye,Ne,Ye=0;const ht=new Uint8Array(4);let mt,Tn;const wn=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(cy(t)||!t.output||!t.input&&t.avail_in!==0)return Ru;s=t.state,s.mode===pp&&(s.mode=Q2),h=t.next_out,c=t.output,y=t.avail_out,u=t.next_in,a=t.input,m=t.avail_in,v=s.hold,S=s.bits,R=m,P=y,Ne=ay;e:for(;;)switch(s.mode){case sO:if(s.wrap===0){s.mode=Q2;break}for(;S<16;){if(m===0)break e;m--,v+=a[u++]<<S,S+=8}if(2&s.wrap&&v===35615){s.wbits===0&&(s.wbits=15),s.check=0,ht[0]=255&v,ht[1]=v>>>8&255,s.check=jo(s.check,ht,2,0),v=0,S=0,s.mode=16181;break}if(s.head&&(s.head.done=!1),!(1&s.wrap)||(((255&v)<<8)+(v>>8))%31){t.msg="incorrect header check",s.mode=ls;break}if((15&v)!==D$){t.msg="unknown compression method",s.mode=ls;break}if(v>>>=4,S-=4,ye=8+(15&v),s.wbits===0&&(s.wbits=ye),ye>15||ye>s.wbits){t.msg="invalid window size",s.mode=ls;break}s.dmax=1<<s.wbits,s.flags=0,t.adler=s.check=1,s.mode=512&v?16189:pp,v=0,S=0;break;case 16181:for(;S<16;){if(m===0)break e;m--,v+=a[u++]<<S,S+=8}if(s.flags=v,(255&yo(s))!==D$){t.msg="unknown compression method",s.mode=ls;break}if(57344&yo(s)){t.msg="unknown header flags set",s.mode=ls;break}s.head&&(s.head.text=v>>8&1),512&yo(s)&&4&s.wrap&&(ht[0]=255&v,ht[1]=v>>>8&255,s.check=jo(s.check,ht,2,0)),v=0,S=0,s.mode=16182;case 16182:for(;S<32;){if(m===0)break e;m--,v+=a[u++]<<S,S+=8}s.head&&(s.head.time=v),512&yo(s)&&4&s.wrap&&(ht[0]=255&v,ht[1]=v>>>8&255,ht[2]=v>>>16&255,ht[3]=v>>>24&255,s.check=jo(s.check,ht,4,0)),v=0,S=0,s.mode=16183;case 16183:for(;S<16;){if(m===0)break e;m--,v+=a[u++]<<S,S+=8}s.head&&(s.head.xflags=255&v,s.head.os=v>>8),512&yo(s)&&4&s.wrap&&(ht[0]=255&v,ht[1]=v>>>8&255,s.check=jo(s.check,ht,2,0)),v=0,S=0,s.mode=16184;case 16184:if(1024&yo(s)){for(;S<16;){if(m===0)break e;m--,v+=a[u++]<<S,S+=8}s.length=v,s.head&&(s.head.extra_len=v),512&yo(s)&&4&s.wrap&&(ht[0]=255&v,ht[1]=v>>>8&255,s.check=jo(s.check,ht,2,0)),v=0,S=0}else s.head&&(s.head.extra=null);s.mode=16185;case 16185:if(1024&yo(s)&&(N=s.length,N>m&&(N=m),N&&(s.head&&(ye=s.head.extra_len-s.length,s.head.extra||(s.head.extra=new Uint8Array(s.head.extra_len)),s.head.extra.set(a.subarray(u,u+N),ye)),512&yo(s)&&4&s.wrap&&(s.check=jo(s.check,a,N,u)),m-=N,u+=N,s.length-=N),s.length))break e;s.length=0,s.mode=16186;case 16186:if(2048&yo(s)){if(m===0)break e;N=0;do ye=a[u+N++],s.head&&ye&&s.length<65536&&(s.head.name+=String.fromCharCode(ye));while(ye&&N<m);if(512&yo(s)&&4&s.wrap&&(s.check=jo(s.check,a,N,u)),m-=N,u+=N,ye)break e}else s.head&&(s.head.name=null);s.length=0,s.mode=16187;case 16187:if(4096&yo(s)){if(m===0)break e;N=0;do ye=a[u+N++],s.head&&ye&&s.length<65536&&(s.head.comment+=String.fromCharCode(ye));while(ye&&N<m);if(512&yo(s)&&4&s.wrap&&(s.check=jo(s.check,a,N,u)),m-=N,u+=N,ye)break e}else s.head&&(s.head.comment=null);s.mode=16188;case 16188:if(512&yo(s)){for(;S<16;){if(m===0)break e;m--,v+=a[u++]<<S,S+=8}if(4&s.wrap&&v!==(65535&s.check)){t.msg="header crc mismatch",s.mode=ls;break}v=0,S=0}s.head&&(s.head.hcrc=yo(s)>>9&1,s.head.done=!0),t.adler=s.check=0,s.mode=pp;break;case 16189:for(;S<32;){if(m===0)break e;m--,v+=a[u++]<<S,S+=8}t.adler=s.check=x$(v),v=0,S=0,s.mode=oO;case oO:if(s.havedict===0)return t.next_out=h,t.avail_out=y,t.next_in=u,t.avail_in=m,s.hold=v,s.bits=S,iye;t.adler=s.check=1,s.mode=pp;case pp:if(r===nye||r===iO)break e;case Q2:if(s.last){v>>>=7&S,S-=7&S,s.mode=eM;break}for(;S<3;){if(m===0)break e;m--,v+=a[u++]<<S,S+=8}switch(s.last=1&v,v>>>=1,S-=1,3&v){case 0:s.mode=16193;break;case 1:if(aye(s),s.mode=aO,r===iO){v>>>=2,S-=2;break e}break;case 2:s.mode=16196;break;case 3:t.msg="invalid block type",s.mode=ls}v>>>=2,S-=2;break;case 16193:for(v>>>=7&S,S-=7&S;S<32;){if(m===0)break e;m--,v+=a[u++]<<S,S+=8}if((65535&v)!=(v>>>16^65535)){t.msg="invalid stored block lengths",s.mode=ls;break}if(s.length=65535&v,v=0,S=0,s.mode=Z2,r===iO)break e;case Z2:s.mode=16195;case 16195:if(N=s.length,N){if(N>m&&(N=m),N>y&&(N=y),N===0)break e;c.set(a.subarray(u,u+N),h),m-=N,u+=N,y-=N,h+=N,s.length-=N;break}s.mode=pp;break;case 16196:for(;S<14;){if(m===0)break e;m--,v+=a[u++]<<S,S+=8}if(s.nlen=257+(31&v),v>>>=5,S-=5,s.ndist=1+(31&v),v>>>=5,S-=5,s.ncode=4+(15&v),v>>>=4,S-=4,s.nlen>286||s.ndist>30){t.msg="too many length or distance symbols",s.mode=ls;break}s.have=0,s.mode=16197;case 16197:for(;s.have<s.ncode;){for(;S<3;){if(m===0)break e;m--,v+=a[u++]<<S,S+=8}s.lens[wn[s.have++]]=7&v,v>>>=3,S-=3}for(;s.have<19;)s.lens[wn[s.have++]]=0;if(s.lencode=s.lendyn,s.lenbits=7,mt={bits:s.lenbits},Ne=uw(0,s.lens,0,19,s.lencode,0,s.work,mt),s.lenbits=mt.bits,Ne){t.msg="invalid code lengths set",s.mode=ls;break}s.have=0,s.mode=16198;case 16198:for(;s.have<s.nlen+s.ndist;){for(;Ye=s.lencode[v&(1<<s.lenbits)-1],j=Ye>>>24,X=Ye>>>16&255,ee=65535&Ye,!(j<=S);){if(m===0)break e;m--,v+=a[u++]<<S,S+=8}if(ee<16)v>>>=j,S-=j,s.lens[s.have++]=ee;else{if(ee===16){for(Tn=j+2;S<Tn;){if(m===0)break e;m--,v+=a[u++]<<S,S+=8}if(v>>>=j,S-=j,s.have===0){t.msg="invalid bit length repeat",s.mode=ls;break}ye=s.lens[s.have-1],N=3+(3&v),v>>>=2,S-=2}else if(ee===17){for(Tn=j+3;S<Tn;){if(m===0)break e;m--,v+=a[u++]<<S,S+=8}v>>>=j,S-=j,ye=0,N=3+(7&v),v>>>=3,S-=3}else{for(Tn=j+7;S<Tn;){if(m===0)break e;m--,v+=a[u++]<<S,S+=8}v>>>=j,S-=j,ye=0,N=11+(127&v),v>>>=7,S-=7}if(s.have+N>s.nlen+s.ndist){t.msg="invalid bit length repeat",s.mode=ls;break}for(;N--;)s.lens[s.have++]=ye}}if(s.mode===ls)break;if(s.lens[256]===0){t.msg="invalid code -- missing end-of-block",s.mode=ls;break}if(s.lenbits=9,mt={bits:s.lenbits},Ne=uw(1,s.lens,0,s.nlen,s.lencode,0,s.work,mt),s.lenbits=mt.bits,Ne){t.msg="invalid literal/lengths set",s.mode=ls;break}if(s.distbits=6,s.distcode=s.distdyn,mt={bits:s.distbits},Ne=uw(2,s.lens,s.nlen,s.ndist,s.distcode,0,s.work,mt),s.distbits=mt.bits,Ne){t.msg="invalid distances set",s.mode=ls;break}if(s.mode=aO,r===iO)break e;case aO:s.mode=cO;case cO:if(m>=6&&y>=258){t.next_out=h,t.avail_out=y,t.next_in=u,t.avail_in=m,s.hold=v,s.bits=S,J_e(t,P),h=t.next_out,c=t.output,y=t.avail_out,u=t.next_in,a=t.input,m=t.avail_in,v=s.hold,S=s.bits,s.mode===pp&&(s.back=-1);break}for(s.back=0;Ye=s.lencode[v&(1<<s.lenbits)-1],j=Ye>>>24,X=Ye>>>16&255,ee=65535&Ye,!(j<=S);){if(m===0)break e;m--,v+=a[u++]<<S,S+=8}if(X&&(240&X)==0){for(he=j,Se=X,Te=ee;Ye=s.lencode[Te+((v&(1<<he+Se)-1)>>he)],j=Ye>>>24,X=Ye>>>16&255,ee=65535&Ye,!(he+j<=S);){if(m===0)break e;m--,v+=a[u++]<<S,S+=8}v>>>=he,S-=he,s.back+=he}if(v>>>=j,S-=j,s.back+=j,s.length=ee,X===0){s.mode=16205;break}if(32&X){s.back=-1,s.mode=pp;break}if(64&X){t.msg="invalid literal/length code",s.mode=ls;break}s.extra=15&X,s.mode=16201;case 16201:if(s.extra){for(Tn=s.extra;S<Tn;){if(m===0)break e;m--,v+=a[u++]<<S,S+=8}s.length+=v&(1<<s.extra)-1,v>>>=s.extra,S-=s.extra,s.back+=s.extra}s.was=s.length,s.mode=16202;case 16202:for(;Ye=s.distcode[v&(1<<s.distbits)-1],j=Ye>>>24,X=Ye>>>16&255,ee=65535&Ye,!(j<=S);){if(m===0)break e;m--,v+=a[u++]<<S,S+=8}if((240&X)==0){for(he=j,Se=X,Te=ee;Ye=s.distcode[Te+((v&(1<<he+Se)-1)>>he)],j=Ye>>>24,X=Ye>>>16&255,ee=65535&Ye,!(he+j<=S);){if(m===0)break e;m--,v+=a[u++]<<S,S+=8}v>>>=he,S-=he,s.back+=he}if(v>>>=j,S-=j,s.back+=j,64&X){t.msg="invalid distance code",s.mode=ls;break}s.offset=ee,s.extra=15&X,s.mode=16203;case 16203:if(s.extra){for(Tn=s.extra;S<Tn;){if(m===0)break e;m--,v+=a[u++]<<S,S+=8}s.offset+=v&(1<<s.extra)-1,v>>>=s.extra,S-=s.extra,s.back+=s.extra}if(s.offset>s.dmax){t.msg="invalid distance too far back",s.mode=ls;break}s.mode=16204;case 16204:if(y===0)break e;if(N=P-y,s.offset>N){if(N=s.offset-N,N>s.whave&&s.sane){t.msg="invalid distance too far back",s.mode=ls;break}N>s.wnext?(N-=s.wnext,G=s.wsize-N):G=s.wnext-N,N>s.length&&(N=s.length),F=s.window}else F=c,G=h-s.offset,N=s.length;N>y&&(N=y),y-=N,s.length-=N;do c[h++]=F[G++];while(--N);s.length===0&&(s.mode=cO);break;case 16205:if(y===0)break e;c[h++]=s.length,y--,s.mode=cO;break;case eM:if(s.wrap){for(;S<32;){if(m===0)break e;m--,v|=a[u++]<<S,S+=8}if(P-=y,t.total_out+=P,s.total+=P,4&s.wrap&&P&&(t.adler=s.check=yo(s)?jo(s.check,c,P,h-P):nw(s.check,c,P,h-P)),P=y,4&s.wrap&&(yo(s)?v:x$(v))!==s.check){t.msg="incorrect data check",s.mode=ls;break}v=0,S=0}s.mode=16207;case 16207:if(s.wrap&&yo(s)){for(;S<32;){if(m===0)break e;m--,v+=a[u++]<<S,S+=8}if(4&s.wrap&&v!==(4294967295&s.total)){t.msg="incorrect length check",s.mode=ls;break}v=0,S=0}s.mode=16208;case 16208:Ne=rye;break e;case ls:Ne=k$;break e;case 16210:return N$;default:return Ru}return t.next_out=h,t.avail_out=y,t.next_in=u,t.avail_in=m,s.hold=v,s.bits=S,(s.wsize||P!==t.avail_out&&s.mode<ls&&(s.mode<eM||r!==O$))&&j$(t,t.output,t.next_out,P-t.avail_out),R-=t.avail_in,P-=t.avail_out,t.total_in+=R,t.total_out+=P,s.total+=P,4&s.wrap&&P&&(t.adler=s.check=yo(s)?jo(s.check,c,P,t.next_out-P):nw(s.check,c,P,t.next_out-P)),t.data_type=s.bits+(s.last?64:0)+(s.mode===pp?128:0)+(s.mode===aO||s.mode===Z2?256:0),(R===0&&P===0||r===O$)&&Ne===ay&&(Ne=sye),Ne},mp={inflateReset:M$,inflateReset2:U$,inflateResetKeep:L$,inflateInit:t=>V$(t,15),inflateInit2:V$,inflate:cye,inflateEnd:t=>{if(cy(t))return Ru;let r=t.state;return r.window&&(r.window=null),t.state=null,ay},inflateGetHeader:(t,r)=>{if(cy(t))return Ru;const s=t.state;return(2&s.wrap)==0?Ru:(s.head=r,r.done=!1,ay)},inflateSetDictionary:(t,r)=>{const s=r.length;let a,c,u;return cy(t)?Ru:(a=t.state,a.wrap!==0&&a.mode!==oO?Ru:a.mode===oO&&(c=1,c=nw(c,r,s,0),c!==a.check)?k$:(u=j$(t,r,s,s),u?(a.mode=16210,N$):(a.havedict=1,ay)))},inflateInfo:"pako inflate (from Nodeca project)"},lye=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const B$=Object.prototype.toString,{Z_NO_FLUSH:uye,Z_FINISH:dye,Z_OK:dw,Z_STREAM_END:rM,Z_NEED_DICT:iM,Z_STREAM_ERROR:hye,Z_DATA_ERROR:W$,Z_MEM_ERROR:fye}=XP;function lO(t){this.options=ZP.assign({chunkSize:65536,windowBits:15,to:""},t||{});const r=this.options;r.raw&&r.windowBits>=0&&r.windowBits<16&&(r.windowBits=-r.windowBits,r.windowBits===0&&(r.windowBits=-15)),!(r.windowBits>=0&&r.windowBits<16)||t&&t.windowBits||(r.windowBits+=32),r.windowBits>15&&r.windowBits<48&&(15&r.windowBits)==0&&(r.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new A$,this.strm.avail_out=0;let s=mp.inflateInit2(this.strm,r.windowBits);if(s!==dw)throw new Error(ry[s]);if(this.header=new lye,mp.inflateGetHeader(this.strm,this.header),r.dictionary&&(typeof r.dictionary=="string"?r.dictionary=lw.string2buf(r.dictionary):B$.call(r.dictionary)==="[object ArrayBuffer]"&&(r.dictionary=new Uint8Array(r.dictionary)),r.raw&&(s=mp.inflateSetDictionary(this.strm,r.dictionary),s!==dw)))throw new Error(ry[s])}function pye(t,r){const s=new lO(r);if(s.push(t),s.err)throw s.msg||ry[s.err];return s.result}lO.prototype.push=function(t,r){const s=this.strm,a=this.options.chunkSize,c=this.options.dictionary;let u,h,m;if(this.ended)return!1;for(h=r===~~r?r:r===!0?dye:uye,B$.call(t)==="[object ArrayBuffer]"?s.input=new Uint8Array(t):s.input=t,s.next_in=0,s.avail_in=s.input.length;;){for(s.avail_out===0&&(s.output=new Uint8Array(a),s.next_out=0,s.avail_out=a),u=mp.inflate(s,h),u===iM&&c&&(u=mp.inflateSetDictionary(s,c),u===dw?u=mp.inflate(s,h):u===W$&&(u=iM));s.avail_in>0&&u===rM&&s.state.wrap>0&&t[s.next_in]!==0;)mp.inflateReset(s),u=mp.inflate(s,h);switch(u){case hye:case W$:case iM:case fye:return this.onEnd(u),this.ended=!0,!1}if(m=s.avail_out,s.next_out&&(s.avail_out===0||u===rM))if(this.options.to==="string"){let y=lw.utf8border(s.output,s.next_out),v=s.next_out-y,S=lw.buf2string(s.output,y);s.next_out=v,s.avail_out=a-v,v&&s.output.set(s.output.subarray(y,y+v),0),this.onData(S)}else this.onData(s.output.length===s.next_out?s.output:s.output.subarray(0,s.next_out));if(u!==dw||m!==0){if(u===rM)return u=mp.inflateEnd(this.strm),this.onEnd(u),this.ended=!0,!0;if(s.avail_in===0)break}}return!0},lO.prototype.onData=function(t){this.chunks.push(t)},lO.prototype.onEnd=function(t){t===dw&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=ZP.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};var mye={inflate:pye};const{deflate:gye}=X_e,{inflate:_ye}=mye;var yye=gye,Eye=_ye,z$=function(t){return t[t.ONE_BYTE=0]="ONE_BYTE",t[t.TWO_BYTE=1]="TWO_BYTE",t}(z$||{});class vye{constructor(){K(this,"_sequence",0),K(this,"_startTime",Date.now()),K(this,"isUseOneByte",!0)}get startTime(){const r=Date.now()-this._startTime;return r<Math.pow(2,16)?r:(this._startTime+=Math.pow(2,16),this.startTime)}get sequence(){return this._sequence<Math.pow(2,32)?this._sequence++:(this._sequence-=Math.pow(2,32),this.sequence)}serialize(r){const s={commonPacketHeader:{length:0,reserved:0,extension:0,sequence:this.sequence},commonStreamHeader:this.startTime,extension:void 0,payload:r};if(r.byteLength>128){const m=new Uint8Array(4);m.set([1,0,0,0]);const y={id:0,length:4,data:m.buffer},v={profile:this.isUseOneByte?0:1,length:this.isUseOneByte?5:6,datas:[y]};s.commonPacketHeader.extension=1,s.extension=v,s.payload=this.compress(r),s.commonPacketHeader.length=8+(s.extension.length+2)+s.payload.byteLength}else s.commonPacketHeader.length=8+s.payload.byteLength;oe("SHOW_DATASTREAM2_LOG")&&x.debug("send data header: ".concat(JSON.stringify(s.commonPacketHeader)));const a=new ArrayBuffer(s.commonPacketHeader.length),c=new Uint8Array(a),u=new DataView(a);let h=0;if(u.setUint16(h,s.commonPacketHeader.extension<<15|s.commonPacketHeader.reserved<<14|s.commonPacketHeader.length,!0),h+=2,u.setUint32(h,s.commonPacketHeader.sequence,!0),h+=4,u.setUint16(h,s.commonStreamHeader,!0),h+=2,s.extension){const m=this.serializeExtension(s.extension);c.set(new Uint8Array(m),h),h+=m.byteLength}if(c.set(new Uint8Array(s.payload),h),h+=s.payload.byteLength,h!==s.commonPacketHeader.length)throw Error("serialize error!");return a}deserialize(r){if(r.byteLength<4)return new ArrayBuffer(0);const s=new DataView(r);let a=0;const c=s.getUint16(a,!0);a+=2;const u={length:16383&c,reserved:(16384&c)>>14,extension:(32768&c)>>15,sequence:s.getUint16(a+2,!0)<<16|s.getUint16(a,!0)};let h,m;if(a+=4,oe("SHOW_DATASTREAM2_LOG")&&x.debug("receive data header: ".concat(JSON.stringify(u))),s.getUint16(a,!0),a+=2,u.extension){m=this.deserializeExtension(r.slice(a)),a+=2+m.length,h=r.slice(a);let y=!1;if(m.datas.length>0){const v=m.datas.find(S=>S.id===0);v&&(y=(1&new DataView(v.data).getUint32(0,!0))==1)}h=y?this.decompress(h):h}else h=r.slice(8);return h}serializeExtension(r){const{profile:s,length:a,datas:c}=r,u=new ArrayBuffer(a+2),h=new Uint8Array(u),m=new DataView(u);let y=0;if(m.setUint8(y++,s),m.setUint8(y++,a),c.forEach(v=>{s?(m.setUint8(y++,v.id),m.setUint8(y++,v.length),h.set(new Uint8Array(v.data),y),y+=v.data.byteLength):(m.setUint8(y++,v.id|v.length<<4),h.set(new Uint8Array(v.data),y),y+=v.data.byteLength)}),y!==a+2)throw Error("serialize extension error, is ".concat(y,"!==").concat(a+2));return u}deserializeExtension(r){const s=new DataView(r);let a=0;const c=s.getUint8(a);a++;const u=s.getUint8(a);a++;const h=c===z$.TWO_BYTE,m=[],y=new DataView(r,2);let v=0;for(;v<u;){let S=0,R=0,P=new ArrayBuffer(0);h?(S=y.getUint8(v),v++,R=y.getUint8(v),v++):(S=15&y.getUint8(v),R=y.getUint8(v)>>4,v++),R>0&&(P=y.buffer.slice(v+2,v+2+R),v+=P.byteLength),m.push({id:S,length:R,data:P})}if(v!==u)throw Error("parse error");return{profile:c,length:u,datas:m}}decompress(r){return Eye(new Uint8Array(r))}compress(r){return yye(new Uint8Array(r))}}const Sye={name:"DataStream",create:(t,r)=>{const s=r?new Ame(t):new Pme(t);return s.useDataStream(new vye),s}};class bye extends Ur{constructor(r,s,a){super(),K(this,"ws",void 0),K(this,"requestId",1),K(this,"heartBeatTimer",void 0),K(this,"joinInfo",void 0),K(this,"clientId",void 0),K(this,"onOpen",()=>{this.emit("open"),this.startHeartBeatCheck()}),K(this,"onClose",c=>{this.emit("close"),this.dispose()}),K(this,"onMessage",c=>{const u=JSON.parse(c.data);if(!u||u.command!=="serverResponse"||!u.requestId)return u&&u.command==="serverStatus"&&u.serverStatus&&u.serverStatus.command?(this.emit("status",u.serverStatus),void this.emit(u.serverStatus.command,u.serverStatus)):void 0;this.emit("req_".concat(u.requestId),u)}),this.joinInfo=r,this.clientId=s,this.ws=new UT("cross-channel-".concat(this.clientId),a),this.ws.on(en.RECONNECTING,()=>{this.ws.reconnectMode="retry",this.emit("reconnecting")}),this.ws.on(en.CONNECTED,this.onOpen),this.ws.on(en.ON_MESSAGE,this.onMessage),this.ws.on(en.CLOSED,this.onClose)}isConnect(){return this.ws.state==="connected"}sendMessage(r){const s=this.requestId++;return r.requestId=s,r.seq=s,this.ws.sendMessage(r),s}waitStatus(r){return new dt((s,a)=>{const c=window.setTimeout(()=>{a(new Oe(te.TIMEOUT,"wait status timeout, status: ".concat(r)))},5e3);this.once(r,u=>{window.clearTimeout(c),u.state&&u.state!==0?a(new Oe(te.CROSS_CHANNEL_WAIT_STATUS_ERROR,"wait status error, status: ".concat(r))):s(void 0)}),this.once("dispose",()=>{window.clearTimeout(c),a(new Oe(te.WS_ABORT))})})}async request(r){if(this.ws.state==="closed")throw new Oe(te.WS_DISCONNECT);const s=()=>new dt((h,m)=>{this.ws.once(en.CLOSED,()=>m(new Oe(te.WS_ABORT))),this.ws.once(en.CONNECTED,h)});this.ws.state!=="connected"&&await s();const a=this.sendMessage(r),c=new dt((h,m)=>{const y=()=>{m(new Oe(te.WS_ABORT))};this.ws.once(en.RECONNECTING,y),this.ws.once(en.CLOSED,y),this.once("req_".concat(a),h),ps(3e3).then(()=>{this.removeAllListeners("req_".concat(a)),this.ws.off(en.RECONNECTING,y),this.ws.off(en.CLOSED,y),m(new Oe(te.TIMEOUT,"cross channel ws request timeout"))})}),u=await c;if(!u||u.code!==200)throw new Oe(te.CROSS_CHANNEL_SERVER_ERROR_RESPONSE,"response: ".concat(JSON.stringify(u)));return u}async connect(r){this.ws.removeAllListeners(en.REQUEST_NEW_URLS),this.ws.on(en.REQUEST_NEW_URLS,s=>{s(r)}),await this.ws.init(r)}dispose(){this.clearHeartBeatCheck(),this.emit("dispose"),this.removeAllListeners(),this.ws.close()}sendPing(r){const s=this.requestId++;return r.requestId=s,this.ws.sendMessage(r),s}startHeartBeatCheck(){this.heartBeatTimer&&window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=window.setInterval(()=>{this.sendPing({command:"ping",appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sid:this.joinInfo.sid,ts:+new Date,requestId:0})},3e3)}clearHeartBeatCheck(){window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=void 0}}class Tye extends Ur{set state(r){r!==this._state&&(r!==Wa.RELAY_STATE_FAILURE&&(this.errorCode=nS.RELAY_OK),this.emit("state",r,this.errorCode),this._state=r)}get state(){return this._state}constructor(r,s,a,c,u){super(),K(this,"joinInfo",void 0),K(this,"sid",void 0),K(this,"clientId",void 0),K(this,"cancelToken",la.CancelToken.source()),K(this,"workerToken",void 0),K(this,"requestId",0),K(this,"signal",void 0),K(this,"prevChannelMediaConfig",void 0),K(this,"httpRetryConfig",void 0),K(this,"_resolution",void 0),K(this,"_state",Wa.RELAY_STATE_IDLE),K(this,"errorCode",nS.RELAY_OK),K(this,"onStatus",h=>{x.debug("[".concat(this.clientId,"] ChannelMediaStatus: ").concat(JSON.stringify(h))),h&&h.command&&(h.command==="onAudioPacketReceived"&&this.emit("event",cp.PACKET_RECEIVED_AUDIO_FROM_SRC),h.command==="onVideoPacketReceived"&&this.emit("event",cp.PACKET_RECEIVED_VIDEO_FROM_SRC),h.command==="onSrcTokenPrivilegeDidExpire"&&(this.errorCode=nS.SRC_TOKEN_EXPIRED,this.state=Wa.RELAY_STATE_FAILURE),h.command==="onDestTokenPrivilegeDidExpire"&&(this.errorCode=nS.DEST_TOKEN_EXPIRED,this.state=Wa.RELAY_STATE_FAILURE))}),K(this,"onReconnect",async()=>{x.debug("[".concat(this.clientId,"] ChannelMediaSocket disconnect, reconnecting")),this.emit("event",cp.NETWORK_DISCONNECTED),this.state=Wa.RELAY_STATE_IDLE,this.prevChannelMediaConfig&&this.sendStartRelayMessage(this.prevChannelMediaConfig).catch(h=>{this.state!==Wa.RELAY_STATE_IDLE&&(x.error("auto restart channel media relay failed",h.toString()),this.errorCode=nS.SERVER_CONNECTION_LOST,this.state=Wa.RELAY_STATE_FAILURE)})}),this.joinInfo=r,this.clientId=s,this.sid=j_(),this.signal=new bye(this.joinInfo,this.clientId,a),this.httpRetryConfig=c,this._resolution=u}async startChannelMediaRelay(r){if(this.state!==Wa.RELAY_STATE_IDLE)throw new Oe(te.INVALID_OPERATION);this.state=Wa.RELAY_STATE_CONNECTING,await this.connect(),x.debug("[".concat(this.clientId,"] startChannelMediaRelay: connect success"));try{await this.sendStartRelayMessage(r)}catch(s){throw s.data&&s.data.serverResponse&&s.data.serverResponse.command==="SetSourceChannel"?new Oe(te.CROSS_CHANNEL_FAILED_JOIN_SRC):s.data&&s.data.serverResponse&&s.serverResponse.command==="SetDestChannelStatus"?new Oe(te.CROSS_CHANNEL_FAILED_JOIN_DEST):s.data&&s.data.serverResponse&&s.serverResponse.command==="StartPacketTransfer"?new Oe(te.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST):s}this.prevChannelMediaConfig=r}async updateChannelMediaRelay(r){if(this.state!==Wa.RELAY_STATE_RUNNING)throw new Oe(te.INVALID_OPERATION);await this.sendUpdateMessage(r),this.prevChannelMediaConfig=r}async setVideoProfile(r){if(this._resolution=r,this.state!==Wa.RELAY_STATE_RUNNING)throw new Oe(te.INVALID_OPERATION);const s=this.genMessage(Fo.SetVideoProfile);await this.signal.request(s),x.debug("[".concat(this.clientId,"] startChannelMediaRelay: setVideoProfile success"))}async stopChannelMediaRelay(){await this.sendStopRelayMessage(),x.debug("[".concat(this.clientId,"] stopChannelMediaRelay: send stop message success")),this.state=Wa.RELAY_STATE_IDLE,this.dispose()}dispose(){x.debug("[".concat(this.clientId,"] disposeChannelMediaRelay")),this.cancelToken.cancel(),this.cancelToken=la.CancelToken.source(),this.state=Wa.RELAY_STATE_IDLE,this.emit("dispose"),this.signal.dispose(),this.prevChannelMediaConfig=void 0}async connect(){const r=await Dge(this.joinInfo,this.cancelToken.token,this.httpRetryConfig);this.workerToken=r.workerToken,await this.signal.connect(r.addressList),this.emit("event",cp.NETWORK_CONNECTED),this.signal.on("status",this.onStatus),this.signal.on("reconnecting",this.onReconnect)}async sendStartRelayMessage(r){const s=this.genMessage(Fo.StopPacketTransfer);await this.signal.request(s),await this.signal.waitStatus("Normal Quit"),x.debug("[".concat(this.clientId,"] startChannelMediaRelay: StopPacketTransfer success"));const a=this.genMessage(Fo.SetSdkProfile,r);await this.signal.request(a),x.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSdkProfile success"));const c=this.genMessage(Fo.SetSourceChannel,r);await this.signal.request(c),await this.signal.waitStatus("SetSourceChannelStatus"),this.emit("event",cp.PACKET_JOINED_SRC_CHANNEL),x.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceChannel success"));const u=this.genMessage(Fo.SetSourceUserId,r);await this.signal.request(u),x.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceUserId success"));const h=this.genMessage(Fo.SetDestChannel,r);await this.signal.request(h),await this.signal.waitStatus("SetDestChannelStatus"),this.emit("event",cp.PACKET_JOINED_DEST_CHANNEL),x.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetDestChannel success"));const m=this.genMessage(Fo.StartPacketTransfer,r);await this.signal.request(m),this.emit("event",cp.PACKET_SENT_TO_DEST_CHANNEL),this.state=Wa.RELAY_STATE_RUNNING,x.debug("[".concat(this.clientId,"] startChannelMediaRelay: StartPacketTransfer success")),this.setVideoProfile(this._resolution)}async sendUpdateMessage(r){const s=this.genMessage(Fo.UpdateDestChannel,r);await this.signal.request(s),this.emit("event",cp.PACKET_UPDATE_DEST_CHANNEL),x.debug("[".concat(this.clientId,"] sendUpdateMessage: UpdateDestChannel success"))}async sendStopRelayMessage(){const r=this.genMessage(Fo.StopPacketTransfer);await this.signal.request(r),x.debug("[".concat(this.clientId,"] sendStopRelayMessage: StopPacketTransfer success"))}genMessage(r,s){const a=[],c=[],u=[];this.requestId+=1;const h={appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sdkVersion:wl,sid:this.sid,ts:Date.now(),requestId:this.requestId,seq:this.requestId,allocate:!0,clientRequest:{}};h.sdkVersion==="4.23.2"&&(h.sdkVersion="0.0.1");let m=null,y=null;switch(r){case Fo.SetSdkProfile:return h.clientRequest={command:"SetSdkProfile",type:"multi_channel"},h;case Fo.SetSourceChannel:if(y=s&&s.getSrcChannelMediaInfo(),!y)throw new Oe(te.UNEXPECTED_ERROR,"can not find source config");return h.clientRequest={command:"SetSourceChannel",uid:"0",channelName:y.channelName,token:y.token||this.joinInfo.appId},h;case Fo.SetSourceUserId:if(y=s&&s.getSrcChannelMediaInfo(),!y)throw new Oe(te.UNEXPECTED_ERROR,"can not find source config");return h.clientRequest={command:"SetSourceUserId",uid:y.uid+""},h;case Fo.SetDestChannel:if(m=s&&s.getDestChannelMediaInfo(),!m)throw new Oe(te.UNEXPECTED_ERROR,"can not find dest config");return m.forEach(v=>{a.push(v.channelName),c.push(v.uid+""),u.push(v.token||this.joinInfo.appId)}),h.clientRequest={command:"SetDestChannel",channelName:a,uid:c,token:u},h;case Fo.StartPacketTransfer:return h.clientRequest={command:"StartPacketTransfer"},h;case Fo.Reconnect:return h.clientRequest={command:"Reconnect"},h;case Fo.StopPacketTransfer:return h.clientRequest={command:"StopPacketTransfer"},h;case Fo.UpdateDestChannel:if(m=s&&s.getDestChannelMediaInfo(),!m)throw new Oe(te.UNEXPECTED_ERROR,"can not find dest config");return m.forEach(v=>{a.push(v.channelName),c.push(v.uid+""),u.push(v.token||this.joinInfo.appId)}),h.clientRequest={command:"UpdateDestChannel",channelName:a,uid:c,token:u},h;case Fo.SetVideoProfile:h.clientRequest={command:"SetVideoProfile",width:this._resolution.width,height:this._resolution.height}}return h}}const wye={name:"ChannelMediaRelay",create:function(t){return new Tye(t.joinInfo,t.clientId,t.websocketRetryConfig||Pi,t.httpRetryConfig||Pi,t.resolution)}};function G$(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}function hw(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?G$(Object(s),!0).forEach(function(a){K(t,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):G$(Object(s)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))})}return t}class Cye extends Ur{constructor(r,s,a,c){super(),K(this,"spec",void 0),K(this,"token",void 0),K(this,"websocket",void 0),K(this,"pingpongTimer",void 0),K(this,"reconnectMode","retry"),K(this,"serviceMode",void 0),K(this,"reqId",0),K(this,"commandReqId",0),K(this,"handleWebSocketOpen",()=>{this.reconnectMode="retry",this.startPingPong()}),K(this,"handleWebSocketMessage",u=>{if(!u.data)return;const h=JSON.parse(u.data);h.requestId?this.emit("@".concat(h.requestId,"-").concat(h.sid),h):(It.workerEvent(this.spec.sid,{actionType:"status",serverCode:h.code,workerType:this.serviceMode===ap.TRANSCODE?1:2}),this.emit(Wm.PUBLISH_STREAM_STATUS,h))}),this.spec=s,this.token=r,this.serviceMode=c,this.websocket=new UT("live-streaming",a),this.websocket.on(en.CONNECTED,this.handleWebSocketOpen),this.websocket.on(en.ON_MESSAGE,this.handleWebSocketMessage),this.websocket.on(en.REQUEST_NEW_URLS,(u,h)=>{ks(this,Wm.REQUEST_NEW_ADDRESS).then(u).catch(h)}),this.websocket.on(en.RECONNECTING,()=>{this.websocket.reconnectMode=this.reconnectMode})}init(r){return this.websocket.init(r)}async request(r,s,a,c){this.reqId+=1,r==="request"&&(this.commandReqId+=1);const u=this.commandReqId,h=this.reqId;if(!h||!this.websocket)throw new Oe(te.UNEXPECTED_ERROR);const m=hw({command:r,sdkVersion:wl==="4.23.2"?"0.0.1":wl,seq:h,requestId:h,allocate:a,cname:this.spec.cname,appId:this.spec.appId,sid:this.spec.sid,uid:this.spec.uid.toString(),ts:Math.floor(Date.now()/1e3)},s);if(this.websocket.state==="closed")throw new Oe(te.WS_DISCONNECT);const y=()=>new dt((P,N)=>{this.websocket.once(en.CLOSED,()=>N(new Oe(te.WS_ABORT))),this.websocket.once(en.CONNECTED,P)});this.websocket.state!=="connected"&&await y(),m.clientRequest&&(m.clientRequest.workerToken=this.token);const v=new dt((P,N)=>{const G=()=>{N(new Oe(te.WS_ABORT))};this.websocket.once(en.RECONNECTING,G),this.websocket.once(en.CLOSED,G),this.once("@".concat(h,"-").concat(this.spec.sid),F=>{P(F)})});c&&It.workerEvent(this.spec.sid,hw(hw({},c),{},{requestId:u,actionType:"request",payload:JSON.stringify(s.clientRequest),serverCode:0,code:0}));const S=Date.now();this.websocket.sendMessage(m);let R=null;try{R=await v}catch(P){if(this.websocket.state==="closed")throw P;return await y(),await this.request(r,s,a)}return c&&It.workerEvent(this.spec.sid,hw(hw({},c),{},{requestId:u,actionType:"response",payload:JSON.stringify(R.serverResponse),serverCode:R.code,success:R.code===200,responseTime:Date.now()-S})),R.code!==200&&this.handleResponseError(R),R}tryNextAddress(){this.reconnectMode="tryNext",this.websocket.reconnect("tryNext")}close(){const r=wl==="4.23.2"?"0.0.1":wl;this.reqId+=1,this.websocket.state==="connected"?(this.websocket.sendMessage({command:"request",appId:this.spec.appId,cname:this.spec.cname,uid:this.spec.uid.toString(),sdkVersion:r,sid:this.spec.sid,seq:this.reqId,ts:Math.floor(Date.now()/1e3),requestId:this.reqId,clientRequest:{command:"DestroyWorker"}}),this.websocket.close(!1,!0)):this.websocket.close(!1),this.pingpongTimer&&(window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0)}handleResponseError(r){switch(r.code){case Mi.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM:return void x.warning("live stream response already exists stream");case Mi.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR:case Mi.LIVE_STREAM_RESPONSE_BAD_STREAM:case Mi.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR:return new Oe(te.LIVE_STREAMING_INVALID_ARGUMENT,"",{code:r.code}).throw();case Mi.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST:if(r.serverResponse.command==="UnpublishStream")return;throw new Oe(te.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case Mi.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED:return new Oe(te.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED,"",{code:r.code}).throw();case Mi.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const s=new Oe(te.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE);return this.emit(Wm.WARNING,s,r.serverResponse.url)}case Mi.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN:{const s=new Oe(te.LIVE_STREAMING_WARN_FREQUENT_REQUEST);return this.emit(Wm.WARNING,s,r.serverResponse.url)}case Mi.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH:throw new Oe(te.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case Mi.LIVE_STREAM_RESPONSE_NOT_SUPPORTED:return new Oe(te.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED,"",{code:r.code}).throw();case Mi.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM:{const s=new Oe(te.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT);return this.emit(Wm.WARNING,s,r.serverResponse.url)}case Mi.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR:return new Oe(te.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:r.code}).throw();case Mi.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT:throw new Oe(te.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream resource limit",{retry:!0,changeAddress:!0});case Mi.LIVE_STREAM_RESPONSE_WORKER_LOST:case Mi.LIVE_STREAM_RESPONSE_WORKER_QUIT:if(r.serverResponse.command==="UnpublishStream")return;throw new Oe(te.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case Mi.ERROR_FAIL_SEND_MESSAGE:if(r.serverResponse.command==="UnpublishStream")return;if(r.serverResponse.command==="UpdateTranscoding"||r.serverResponse.command==="ControlStream")return new Oe(te.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{code:r.code}).throw();throw new Oe(te.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case Mi.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case Mi.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case Mi.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case Mi.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:return new Oe(te.LIVE_STREAMING_CDN_ERROR,"",{code:r.code}).throw()}}startPingPong(){this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(()=>{this.websocket.state==="connected"&&this.request("ping",{}).catch(XA)},6e3)}}function H$(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}function za(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?H$(Object(s),!0).forEach(function(a){K(t,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):H$(Object(s)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))})}return t}class Rye extends Ur{constructor(r){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Pi,a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Pi;super(),K(this,"onLiveStreamWarning",void 0),K(this,"onLiveStreamError",void 0),K(this,"spec",void 0),K(this,"retryTimeout",1e4),K(this,"connection",void 0),K(this,"httpRetryConfig",void 0),K(this,"wsRetryConfig",void 0),K(this,"streamingTasks",new Map),K(this,"isStartingStreamingTask",!1),K(this,"taskMutex",new js("live-streaming")),K(this,"cancelToken",la.CancelToken.source()),K(this,"transcodingConfig",void 0),K(this,"uapResponse",void 0),K(this,"lastTaskId",1),K(this,"statusError",new Map),this.spec=r,this.httpRetryConfig=a,this.wsRetryConfig=s}async setTranscodingConfig(r){const s=za(za({},hge),r);s.videoCodecProfile!==66&&s.videoCodecProfile!==77&&s.videoCodecProfile!==100&&(x.debug("[".concat(this.spec.clientId,"] set transcoding config, fix video codec profile: ").concat(s.videoCodecProfile," -> 100")),s.videoCodecProfile=100),s.transcodingUsers||(s.transcodingUsers=s.userConfigs),s.transcodingUsers&&(s.transcodingUsers=s.transcodingUsers.map(h=>za(za(za({},dge),h),{},{zOrder:h.zOrder?h.zOrder+1:1}))),function(h){Wr(h.width)||ir(h.width,"config.width",0,1e4),Wr(h.height)||ir(h.height,"config.height",0,1e4),Wr(h.videoBitrate)||ir(h.videoBitrate,"config.videoBitrate",1,1e6),Wr(h.videoFrameRate)||ir(h.videoFrameRate,"config.videoFrameRate"),Wr(h.lowLatency)||rp(h.lowLatency,"config.lowLatency"),Wr(h.audioSampleRate)||Bi(h.audioSampleRate,"config.audioSampleRate",[32e3,44100,48e3]),Wr(h.audioBitrate)||ir(h.audioBitrate,"config.audioBitrate",1,128),Wr(h.audioChannels)||Bi(h.audioChannels,"config.audioChannels",[1,2,3,4,5]),Wr(h.videoGop)||ir(h.videoGop,"config.videoGop"),Wr(h.videoCodecProfile)||Bi(h.videoCodecProfile,"config.videoCodecProfile",[66,77,100]),Wr(h.userCount)||ir(h.userCount,"config.userCount",0,17),Wr(h.backgroundColor)||ir(h.backgroundColor,"config.backgroundColor",0,16777215),Wr(h.userConfigExtraInfo)||fs(h.userConfigExtraInfo,"config.userConfigExtraInfo",0,4096,!1),h.transcodingUsers&&!Wr(h.transcodingUsers)&&(ip(h.transcodingUsers,"config.transcodingUsers"),h.transcodingUsers.forEach((m,y)=>{vP(m.uid),Wr(m.x)||ir(m.x,"transcodingUser[".concat(y,"].x"),0,1e4),Wr(m.y)||ir(m.y,"transcodingUser[".concat(y,"].y"),0,1e4),Wr(m.width)||ir(m.width,"transcodingUser[".concat(y,"].width"),0,1e4),Wr(m.height)||ir(m.height,"transcodingUser[".concat(y,"].height"),0,1e4),Wr(m.zOrder)||ir(m.zOrder-1,"transcodingUser[".concat(y,"].zOrder"),0,100),Wr(m.alpha)||ir(m.alpha,"transcodingUser[".concat(y,"].alpha"),0,1,!1)})),Wr(h.watermark)||o2(h.watermark,"watermark"),Wr(h.backgroundImage)||o2(h.backgroundImage,"backgroundImage"),h.images&&!Wr(h.images)&&(ip(h.images,"config.images"),h.images.forEach((m,y)=>{o2(m,"images[".concat(y,"]"))}))}(s);const a=[];s.images&&a.push(...s.images.map(h=>za(za(za({},s2),h),{},{zOrder:255}))),s.backgroundImage&&(a.push(za(za(za({},s2),s.backgroundImage),{},{zOrder:0})),delete s.backgroundImage),s.watermark&&(a.push(za(za(za({},s2),s.watermark),{},{zOrder:255})),delete s.watermark),s.images=a,s.transcodingUsers&&(s.userConfigs=s.transcodingUsers.map(h=>za({},h)),s.userCount=s.transcodingUsers.length,delete s.transcodingUsers);const c=(s.userConfigs||[]).map(h=>typeof h.uid=="number"?dt.resolve(h.uid):f9(h.uid,this.spec,this.cancelToken.token,this.httpRetryConfig));if((await dt.all(c)).forEach((h,m)=>{s.userConfigs&&s.userConfigs[m]&&(s.userConfigs[m].uid=h)}),this.transcodingConfig=s,this.connection)try{var u;const h=await this.connection.request("request",{clientRequest:{command:"UpdateTranscoding",transcodingConfig:this.transcodingConfig}},!1,{command:"UpdateTranscoding",workerType:1,requestByUser:!0,tid:Array.from(zc(u=this.streamingTasks).call(u)).map(m=>m.taskId).join("#")});x.debug("[".concat(this.spec.clientId,"] update live transcoding config success, code: ").concat(h.code,", config:"),JSON.stringify(this.transcodingConfig))}catch(h){if(!h.data||!h.data.retry)throw h;h.data.changeAddress&&this.connection.tryNextAddress(),this.streamingTasks.forEach(m=>{x.warning("[".concat(this.spec.clientId,"] live streaming receive error"),h.toString(),"try to republish",m.url),this.startLiveStreamingTask(m.url,m.mode,h).then(()=>{x.debug("[".concat(this.spec.clientId,"] live streaming republish ").concat(m.url," success"))}).catch(y=>{x.error("[".concat(this.spec.clientId,"] live streaming republish failed"),m.url,y.toString()),this.onLiveStreamError&&this.onLiveStreamError(m.url,y)})})}}async startLiveStreamingTask(r,s,a){if(!this.transcodingConfig&&s===ap.TRANSCODE)throw new Oe(te.INVALID_OPERATION,"[LiveStreaming] no transcoding config found, can not start transcoding streaming task");const c={command:"PublishStream",ts:Date.now(),url:r,uid:this.spec.uid.toString(),autoDestroyTime:100,acceptImageTimeout:!0};x.debug("[".concat(this.spec.clientId,"] start live streaming ").concat(r,", mode: ").concat(s));const u=await this.taskMutex.lock();if(!this.connection&&a)return void u();if(this.streamingTasks.get(r)&&!a)return u(),new Oe(te.LIVE_STREAMING_TASK_CONFLICT).throw();try{this.connection||(this.connection=await this.connect(s))}catch(m){throw u(),m}switch(s){case ap.TRANSCODE:c.transcodingConfig=za({},this.transcodingConfig)}this.uapResponse&&this.uapResponse.vid&&(c.vid=this.uapResponse.vid),this.isStartingStreamingTask=!0;const h=this.lastTaskId++;try{const m=new dt((v,S)=>{ps(this.retryTimeout).then(()=>{if(a)return S(a);const R=this.statusError.get(r);return R?(this.statusError.delete(r),S(R)):void 0})}),y=await dt.race([this.connection.request("request",{clientRequest:c},!0,{url:r,command:"PublishStream",workerType:s===ap.TRANSCODE?1:2,requestByUser:!a,tid:h.toString()}),m]);this.isStartingStreamingTask=!1,x.debug("[".concat(this.spec.clientId,"] live streaming started, code: ").concat(y.code)),this.streamingTasks.set(r,{clientRequest:c,mode:s,url:r,taskId:h}),u()}catch(m){if(u(),this.isStartingStreamingTask=!1,!m.data||!m.data.retry||a)throw m;return m.data.changeAddress?(this.connection.tryNextAddress(),await this.startLiveStreamingTask(r,s,m)):await this.startLiveStreamingTask(r,s,m)}}stopLiveStreamingTask(r){return new dt((s,a)=>{const c=this.streamingTasks.get(r);if(!c||!this.connection)return new Oe(te.UNEXPECTED_ERROR,"can not find streaming task to stop").throw();const u=c.mode;c.abortTask=()=>{x.debug("[".concat(this.spec.clientId,"] stop live streaming success(worker exception)")),this.streamingTasks.delete(r),s()},this.connection.request("request",{clientRequest:{command:"UnpublishStream",url:c.url}},!1,{url:r,command:"UnPublishStream",workerType:u===ap.TRANSCODE?1:2,requestByUser:!0,tid:(this.lastTaskId++).toString()}).then(h=>{x.debug("[".concat(this.spec.clientId,"] stop live streaming success, code: ").concat(h.code)),this.streamingTasks.delete(r),this.streamingTasks.size===0&&(this.connection&&this.connection.close(),this.connection=void 0),s()}).catch(a)})}resetAllTask(){var r;const s=Array.from(zc(r=this.streamingTasks).call(r));this.terminate();for(const a of s)this.startLiveStreamingTask(a.url,a.mode).catch(c=>{this.onLiveStreamError&&this.onLiveStreamError(a.url,c)})}terminate(){this.cancelToken&&this.cancelToken.cancel(),this.streamingTasks=new Map,this.isStartingStreamingTask=!1,this.statusError=new Map,this.cancelToken=la.CancelToken.source(),this.uapResponse=void 0,this.connection&&this.connection.close(),this.connection=void 0}async connect(r){if(this.connection)throw new Oe(te.UNEXPECTED_ERROR,"live streaming connection has already connected");const s=await ks(this,a2.REQUEST_WORKER_MANAGER_LIST,r);return this.uapResponse=s,this.connection=new Cye(s.workerToken,this.spec,this.wsRetryConfig,r),this.connection.on(Wm.WARNING,(a,c)=>this.onLiveStreamWarning&&this.onLiveStreamWarning(c,a)),this.connection.on(Wm.PUBLISH_STREAM_STATUS,a=>this.handlePublishStreamServer(a)),this.connection.on(Wm.REQUEST_NEW_ADDRESS,(a,c)=>{if(!this.connection)return c(new Oe(te.UNEXPECTED_ERROR,"can not get new live streaming address list"));ks(this,a2.REQUEST_WORKER_MANAGER_LIST,r).then(u=>{this.uapResponse=u,a(u.addressList)}).catch(c)}),await this.connection.init(s.addressList),this.connection}handlePublishStreamServer(r){const s=r.serverStatus&&r.serverStatus.url||"empty_url",a=this.streamingTasks.get(s),c=r.reason;switch(r.code){case Mi.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case Mi.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case Mi.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case Mi.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:{const h=new Oe(te.LIVE_STREAMING_CDN_ERROR,"",{code:r.code});if(a)return x.error(h.toString()),this.onLiveStreamError&&this.onLiveStreamError(s,h);if(!this.isStartingStreamingTask)return;this.statusError.set(s,h)}case Mi.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const h=new Oe(te.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE,c);return this.onLiveStreamWarning&&this.onLiveStreamWarning(s,h)}case Mi.LIVE_STREAM_RESPONSE_WORKER_LOST:case Mi.LIVE_STREAM_RESPONSE_WORKER_QUIT:{var u;if(!this.connection)return;this.connection.tryNextAddress();const h=Array.from(zc(u=this.streamingTasks).call(u));for(const m of h)m.abortTask?m.abortTask():(x.warning("[".concat(this.spec.clientId,"] publish stream status code"),r.code,"try to republish",m.url),this.startLiveStreamingTask(m.url,m.mode,new Oe(te.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:r.code})).then(()=>{x.debug("[".concat(this.spec.clientId,"] republish live stream success"),m.url)}).catch(y=>{x.error(y.toString()),this.onLiveStreamError&&this.onLiveStreamError(m.url,y)}));return}}}hasUrl(r){return this.streamingTasks.has(r)}}const Iye={name:"LiveStreaming",create:function(t){return new Rye(t.joinInfo,t.websocketRetryConfig||Pi,t.httpRetryConfig||Pi)}};function Aye(t){let r=q$();return function(s,a){let c=s.appId;c!==void 0&&(Qn(a,10),xh(a,c));let u=s.cid;u!==void 0&&(Qn(a,16),Qn(a,u));let h=s.cname;h!==void 0&&(Qn(a,26),xh(a,h));let m=s.deviceId;m!==void 0&&(Qn(a,34),xh(a,m));let y=s.elapse;y!==void 0&&(Qn(a,40),ng(a,y));let v=s.fileSize;v!==void 0&&(Qn(a,48),ng(a,ES(v)));let S=s.height;S!==void 0&&(Qn(a,56),ng(a,ES(S)));let R=s.jpg;R!==void 0&&(Qn(a,66),Qn(a,R.length),function(ma,je){let st=vS(ma,je.length);ma.bytes.set(je,st)}(a,R));let P=s.networkType;P!==void 0&&(Qn(a,72),ng(a,ES(P)));let N=s.osType;N!==void 0&&(Qn(a,80),ng(a,ES(N)));let G=s.requestId;G!==void 0&&(Qn(a,90),xh(a,G));let F=s.sdkVersion;F!==void 0&&(Qn(a,98),xh(a,F));let j=s.sequence;j!==void 0&&(Qn(a,104),ng(a,ES(j)));let X=s.sid;X!==void 0&&(Qn(a,114),xh(a,X));let ee=s.timestamp;ee!==void 0&&(Qn(a,120),ng(a,ee));let he=s.uid;he!==void 0&&(Qn(a,128),Qn(a,he));let Se=s.vid;Se!==void 0&&(Qn(a,136),Qn(a,Se));let Te=s.width;Te!==void 0&&(Qn(a,144),ng(a,ES(Te)));let ye=s.service;ye!==void 0&&(Qn(a,152),Qn(a,ye));let Ne=s.callbackData;Ne!==void 0&&(Qn(a,162),xh(a,Ne));let Ye=s.jpgEncryption;Ye!==void 0&&(Qn(a,168),Qn(a,Ye));let ht=s.requestType;ht!==void 0&&(Qn(a,176),Qn(a,ht));let mt=s.scorePorn;mt!==void 0&&(Qn(a,185),lM(a,mt));let Tn=s.scoreSexy;Tn!==void 0&&(Qn(a,193),lM(a,Tn));let wn=s.scoreNeutral;wn!==void 0&&(Qn(a,201),lM(a,wn));let fr=s.scene;fr!==void 0&&(Qn(a,208),Qn(a,fr));let ui=s.ossFilePrefix;ui!==void 0&&(Qn(a,218),xh(a,ui));let Xr=s.serviceVendor;if(Xr!==void 0)for(let ma of Xr){Qn(a,226);let je=q$();kye(ma,je),Qn(a,je.limit),Lye(a,je),xye(je)}}(t,r),function(s){let a=s.bytes,c=s.limit;return a.length===c?a:a.subarray(0,c)}(r)}function Pye(t){return function(s){let a={};e:for(;!Y$(s);){let c=Lh(s);switch(c>>>3){case 0:break e;case 1:a.code=Lh(s);break;case 2:a.msg=X$(s,Lh(s));break;case 3:{let u=Nye(s);a.data=Oye(s),s.limit=u;break}default:$$(s,7&c)}}return a}({bytes:r=t,offset:0,limit:r.length});var r}function Oye(t){let r={};e:for(;!Y$(t);){let s=Lh(t);switch(s>>>3){case 0:break e;case 1:r.requestId=X$(t,Lh(t));break;case 2:r.requestType=Lh(t)>>>0;break;case 3:r.scorePorn=cM(t);break;case 4:r.scoreSexy=cM(t);break;case 5:r.scoreNeutral=cM(t);break;case 6:r.requestScene=Lh(t)>>>0;break;case 7:r.scene=Lh(t)>>>0;break;default:$$(t,7&s)}}return r}function kye(t,r){let s=t.service;s!==void 0&&(Qn(r,8),Qn(r,s));let a=t.vendor;a!==void 0&&(Qn(r,16),Qn(r,a));let c=t.token;c!==void 0&&(Qn(r,26),xh(r,c));let u=t.callbackUrl;u!==void 0&&(Qn(r,34),xh(r,u))}function Nye(t){let r=Lh(t),s=t.limit;return t.limit=t.offset+r,s}function $$(t,r){switch(r){case 0:for(;128&J$(t););break;case 2:oM(t,Lh(t));break;case 5:oM(t,4);break;case 1:oM(t,8);break;default:throw new Error("Unimplemented type: "+r)}}let Dye=new Float32Array(1);new Uint8Array(Dye.buffer);let sM=new Float64Array(1),Ga=new Uint8Array(sM.buffer);function ES(t){return{low:t|=0,high:t>>31,unsigned:t>=0}}let K$=[];function q$(){const t=K$.pop();return t?(t.offset=t.limit=0,t):{bytes:new Uint8Array(64),offset:0,limit:0}}function xye(t){K$.push(t)}function oM(t,r){if(t.offset+r>t.limit)throw new Error("Skip past limit");t.offset+=r}function Y$(t){return t.offset>=t.limit}function vS(t,r){let s=t.bytes,a=t.offset,c=t.limit,u=a+r;if(u>s.length){let h=new Uint8Array(2*u);h.set(s),t.bytes=h}return t.offset=u,u>c&&(t.limit=u),a}function aM(t,r){let s=t.offset;if(s+r>t.limit)throw new Error("Read past limit");return t.offset+=r,s}function X$(t,r){let s=aM(t,r),a=String.fromCharCode,c=t.bytes,u="",h="";for(let m=0;m<r;m++){let y,v,S,R,P=c[m+s];(128&P)==0?h+=a(P):(224&P)==192?m+1>=r?h+=u:(y=c[m+s+1],(192&y)!=128?h+=u:(R=(31&P)<<6|63&y,R<128?h+=u:(h+=a(R),m++))):(240&P)==224?m+2>=r?h+=u:(y=c[m+s+1],v=c[m+s+2],(49344&(y|v<<8))!=32896?h+=u:(R=(15&P)<<12|(63&y)<<6|63&v,R<2048||R>=55296&&R<=57343?h+=u:(h+=a(R),m+=2))):(248&P)==240?m+3>=r?h+=u:(y=c[m+s+1],v=c[m+s+2],S=c[m+s+3],(12632256&(y|v<<8|S<<16))!=8421504?h+=u:(R=(7&P)<<18|(63&y)<<12|(63&v)<<6|63&S,R<65536||R>1114111?h+=u:(R-=65536,h+=a(55296+(R>>10),56320+(1023&R)),m+=3))):h+=u}return h}function xh(t,r){let s=r.length,a=0;for(let h=0;h<s;h++){let m=r.charCodeAt(h);m>=55296&&m<=56319&&h+1<s&&(m=(m<<10)+r.charCodeAt(++h)-56613888),a+=m<128?1:m<2048?2:m<65536?3:4}Qn(t,a);let c=vS(t,a),u=t.bytes;for(let h=0;h<s;h++){let m=r.charCodeAt(h);m>=55296&&m<=56319&&h+1<s&&(m=(m<<10)+r.charCodeAt(++h)-56613888),m<128?u[c++]=m:(m<2048?u[c++]=m>>6&31|192:(m<65536?u[c++]=m>>12&15|224:(u[c++]=m>>18&7|240,u[c++]=m>>12&63|128),u[c++]=m>>6&63|128),u[c++]=63&m|128)}}function Lye(t,r){let s=vS(t,r.limit),a=t.bytes,c=r.bytes;for(let u=0,h=r.limit;u<h;u++)a[u+s]=c[u]}function J$(t){return t.bytes[aM(t,1)]}function Q$(t,r){let s=vS(t,1);t.bytes[s]=r}function cM(t){let r=aM(t,8),s=t.bytes;return Ga[0]=s[r++],Ga[1]=s[r++],Ga[2]=s[r++],Ga[3]=s[r++],Ga[4]=s[r++],Ga[5]=s[r++],Ga[6]=s[r++],Ga[7]=s[r++],sM[0]}function lM(t,r){let s=vS(t,8),a=t.bytes;sM[0]=r,a[s++]=Ga[0],a[s++]=Ga[1],a[s++]=Ga[2],a[s++]=Ga[3],a[s++]=Ga[4],a[s++]=Ga[5],a[s++]=Ga[6],a[s++]=Ga[7]}function Lh(t){let r,s=0,a=0;do r=J$(t),s<32&&(a|=(127&r)<<s),s+=7;while(128&r);return a}function Qn(t,r){for(r>>>=0;r>=128;)Q$(t,127&r|128),r>>>=7;Q$(t,r)}function ng(t,r){let s=r.low>>>0,a=(r.low>>>28|r.high<<4)>>>0,c=r.high>>>24,u=c===0?a===0?s<16384?s<128?1:2:s<1<<21?3:4:a<16384?a<128?5:6:a<1<<21?7:8:c<128?9:10,h=vS(t,u),m=t.bytes;switch(u){case 10:m[h+9]=c>>>7&1;case 9:m[h+8]=u!==9?128|c:127&c;case 8:m[h+7]=u!==8?a>>>21|128:a>>>21&127;case 7:m[h+6]=u!==7?a>>>14|128:a>>>14&127;case 6:m[h+5]=u!==6?a>>>7|128:a>>>7&127;case 5:m[h+4]=u!==5?128|a:127&a;case 4:m[h+3]=u!==4?s>>>21|128:s>>>21&127;case 3:m[h+2]=u!==3?s>>>14|128:s>>>14&127;case 2:m[h+1]=u!==2?s>>>7|128:s>>>7&127;case 1:m[h]=u!==1?128|s:127&s}}function Z$(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}const Mye=new Map([["moderation",1],["supervise",2]]);class Uye extends Ur{get connectionState(){return this._connectionState}set connectionState(r){if(this._connectionState===r)return;const s=this._connectionState;this._connectionState=r,this.emit(cs.CONNECTION_STATE_CHANGE,s,r)}get inspectType(){return this._inspectType}set inspectType(r){var s;this._inspectMode=lc(s=r.map(a=>Mye.get(a)||0)).call(s,(a,c)=>a+c),this._inspectType=r}get quality(){return this._quality}set quality(r){this._quality=r>1?1:r<.1?.1:r,this.qualityTimer&&(window.clearTimeout(this.qualityTimer),this.qualityTimer=null),this._quality>=1||(this.qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this.qualityRatio},6e4))}constructor(r){super(),K(this,"name","AgoraRTCVideoContentInspect"),K(this,"_connectionState",vu.CONNECTING),K(this,"_innerConnectionState",void 0),K(this,"sequence",0),K(this,"inspectStartTime",void 0),K(this,"workerManagerConnection",void 0),K(this,"workerConnection",void 0),K(this,"workerMessageLengthLimit",void 0),K(this,"inspectIntervalMinimum",void 0),K(this,"qualityRatio",void 0),K(this,"_connectInfo",void 0),K(this,"_cancelTokenSource",la.CancelToken.source()),K(this,"_retryConfig",void 0),K(this,"wmSequence",0),K(this,"inspectInterval",void 0),K(this,"inspectTimer",null),K(this,"ossFilePrefix",void 0),K(this,"extraInfo",void 0),K(this,"_inspectType",void 0),K(this,"_inspectMode",void 0),K(this,"_quality",1),K(this,"qualityTimer",null),K(this,"_inspectId",void 0),K(this,"_needWorkUrlOnly",!1),K(this,"inspectImage",()=>{if(this.connectionState!==vu.CONNECTED)throw new Oe(te.OPERATION_ABORTED,"content inspect service connection status is ".concat(this.connectionState));this.inspectTimer&&(window.clearInterval(this.inspectTimer),this.inspectTimer=null),this.inspectTimer=window.setInterval(()=>{this.connectionState===vu.CONNECTED?this.requestToInspectImage():x.debug("[".concat(this._inspectId,"] Inspect State is not connected , "),this.connectionState)},this.inspectInterval<this.inspectIntervalMinimum?this.inspectIntervalMinimum:this.inspectInterval),this.requestToInspectImage()}),this._inspectId=dr(5,"inspect-"),this.workerMessageLengthLimit=oe("VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT"),this.inspectIntervalMinimum=oe("VIDEO_INSPECT_INTERVAL_MINIMUM"),this.qualityRatio=oe("VIDEO_INSPECT_QUALITY_RATIO"),this.inspectInterval=r.interval,this.ossFilePrefix=r.ossFilePrefix,this.extraInfo=r.extraInfo,this.inspectType=r.inspectType,this.inspectStartTime=Number(Date.now()),this.workerManagerConnection=new UT("worker-manager-"+this._inspectId,Pi),this.on(cs.STATE_CHANGE,(s,a)=>{this._innerConnectionState=s,x.debug("[".concat(this._inspectId,"] Inspect operation :").concat(Su[s]," ").concat(a||""))}),this.handleWorkerManagerEvents(),this.workerConnection=new UT("worker-"+this._inspectId,Pi),this.handleWorkerEvents()}async init(r,s){this.emit(cs.STATE_CHANGE,Su.CONNECT_AP),this._connectInfo=r;const a=this._cancelTokenSource.token;return this._retryConfig=s,new dt((c,u)=>{this.on(cs.CONNECTION_STATE_CHANGE,(h,m)=>{m===vu.CONNECTED&&c()}),this.requestAP(r,a,s).then(h=>{this.connectWorkerManager(h)}).catch(h=>{u(h)})})}async requestAP(r,s,a){const c=oe("WEBCS_DOMAIN").map(m=>"https://".concat(m,"/api/v1")),u=await function(m,y,v,S){let{appId:R,areaCode:P,cname:N,sid:G,token:F,uid:j}=y;lS++;const X="image_moderation_api",ee={service_name:X,json_body:JSON.stringify({appId:R,areaCode:P,cname:N,command:"allocateEdge",requestId:lS,seq:lS,sid:G,token:F,ts:Date.now(),uid:j+""})};let he,Se,Te=m[0];return _d(async()=>{he=Date.now();const ye=await bd(Te,{data:ee,cancelToken:v,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(Se=Date.now()-he,ye.code!==0){const mt=new Oe(te.UNEXPECTED_RESPONSE,"image inspect ap error, code"+ye.code,{retry:!0,responseTime:Se});throw x.error(mt.toString()),mt}const Ne=JSON.parse(ye.json_body);if(Ne.code!==200){const mt=new Oe(te.UNEXPECTED_RESPONSE,"image inspect ap error, code: ".concat(Ne.code,", reason: ").concat(Ne.reason),{code:Ne.code,responseTime:Se});throw x.error(mt.toString()),mt}if(!Ne.servers||!Array.isArray(Ne.servers)||Ne.servers.length===0){const mt=new Oe(te.UNEXPECTED_RESPONSE,"image inspect ap empty server",{code:Ne.code,responseTime:Se});throw x.error(mt.toString()),mt}const Ye=oe("VIDEO_INSPECT_WORKER_MANAGER_HOST"),ht=oe("VIDEO_INSPECT_WORKER_MANAGER_PORT");return{addressList:Ne.servers.map(mt=>{let{address:Tn,wss:wn}=mt;if(Tn&&wn)return"wss://".concat(Tn.replace(/\./g,"-"),".").concat(Ye,":").concat(ht||wn)}).filter(mt=>!!mt),workerToken:Ne.workerToken,vid:Ne.vid,responseTime:Se}},(ye,Ne)=>(It.apworkerEvent(G,{success:!0,sc:200,serviceName:X,responseDetail:JSON.stringify(ye.addressList),firstSuccess:Ne===0,responseTime:Se,serverIp:m[Ne%m.length]}),!1),(ye,Ne)=>(It.apworkerEvent(G,{success:!1,sc:ye.data&&ye.data.code||200,serviceName:X,responseTime:Se,serverIp:m[Ne%m.length]}),!!(ye.code!==te.OPERATION_ABORTED&&ye.code!==te.UNEXPECTED_RESPONSE||ye.data&&ye.data.retry)&&(Te=m[(Ne+1)%m.length],!0)),S)}(c,r,s,a);this.emit(cs.STATE_CHANGE,Su.AP_CONNECTED);const{addressList:h}=u;return this.wmSequence++,h}async connectWorkerManager(r){let s=arguments.length>1&&arguments[1]!==void 0&&arguments[1];this._needWorkUrlOnly=s,this.emit(cs.STATE_CHANGE,Su.CONNECT_WORKER_MANAGER),await this.workerManagerConnection.init(r,1e4)}async connectWorker(r){await this.workerConnection.init([r])}handleWorkerManagerEvents(){this.workerManagerConnection.on(en.CONNECTED,async()=>{this.emit(cs.STATE_CHANGE,Su.WORKER_MANAGER_CONNECTED,this.workerManagerConnection.url),this.workerManagerConnection.sendMessage({appId:this._connectInfo.appId,cname:this._connectInfo.cname,uid:this._connectInfo.uid+"",sdkVersion:"4.23.2",sid:this._connectInfo.sid,seq:this.wmSequence,ts:Number(Date.now()),requestId:Math.floor(1e12*Math.random()),allocate:!0,clientRequest:{command:"join"}},!0)}),this.workerManagerConnection.on(en.CLOSED,()=>{this._innerConnectionState<Su.GET_WORKER_MANAGER_RESPONSE&&x.debug("[".concat(this._inspectId,"] Inspect worker manager is closed before connecting worker"))}),this.workerManagerConnection.on(en.FAILED,()=>{this._innerConnectionState<Su.GET_WORKER_MANAGER_RESPONSE&&x.debug("[".concat(this._inspectId,"] Connecting inspect worker manager is failed before connecting worker"))}),this.workerManagerConnection.on(en.RECONNECTING,()=>{this._innerConnectionState<Su.GET_WORKER_MANAGER_RESPONSE&&x.debug("[".concat(this._inspectId,"] Inspect worker manager is reconnecting before connecting worker"))}),this.workerManagerConnection.on(en.ON_MESSAGE,async r=>{this.emit(cs.STATE_CHANGE,Su.GET_WORKER_MANAGER_RESPONSE);const s=this.workerManagerConnection.url;this.workerManagerConnection.close();const a=JSON.parse(r.data);if(a.code!==200)throw x.error("[".concat(this._inspectId,"] Unexpected code ").concat(a.code," from worker manager")),new Oe(te.UNEXPECTED_RESPONSE,"response code of worker is unexpected",a);if(!(a.serverResponse&&a.serverResponse.portWss&&s))throw x.error("[".concat(this._inspectId,"] Unexpected content from worker manager : ").concat(JSON.stringify(a))),new Oe(te.UNEXPECTED_RESPONSE,"response content of worker is unexpected",a);{const c=oe("VIDEO_INSPECT_WORKER_PORT")||a.serverResponse.portWss,u=s.replace(/:\d+\/?$/,":".concat(c));this.emit(cs.STATE_CHANGE,Su.CONNECT_WORKER,u),this._needWorkUrlOnly?this.emit(cs.REQUEST_NEW_WORKER_URL,u):await this.connectWorker(u)}}),this.workerManagerConnection.on(en.WILL_RECONNECT,(r,s,a)=>{a(r)}),this.workerManagerConnection.on(en.REQUEST_NEW_URLS,(r,s)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(r).catch(s)})}handleWorkerEvents(){this.workerConnection.on(en.CONNECTED,async()=>{this.emit(cs.STATE_CHANGE,Su.WORKER_CONNECTED,this.workerConnection.url),this.connectionState=vu.CONNECTED}),this.workerConnection.on(en.ON_MESSAGE,async r=>{if(r.data instanceof ArrayBuffer){const a=Pye(new Uint8Array(r.data));if(oe("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")&&x.debug("[".concat(this._inspectId,"] Response message for worker of inspect content "),JSON.stringify(a)),a.code===200){if(Array.isArray(this.inspectType)&&this.inspectType.length===1&&this.inspectType[0]==="supervise")return void this.emit(cs.INSPECT_RESULT,void 0,void 0);if(a.data&&a.data.scorePorn&&a.data.scoreSexy&&a.data.scoreNeutral){var s;const c={porn:a.data.scorePorn,sexy:a.data.scoreSexy,neutral:a.data.scoreNeutral},u=lc(s=Object.keys(c)).call(s,(m,y)=>c[m]>c[y]?m:y,"porn"),h=Object.keys(c).find(m=>m===u);this.emit(cs.INSPECT_RESULT,h)}else this.emit(cs.INSPECT_RESULT,void 0,new Oe(te.UNEXPECTED_RESPONSE,a.code+"","There is an unexpected data on message"))}else this.emit(cs.INSPECT_RESULT,void 0,new Oe(te.UNEXPECTED_RESPONSE,a.code+"",a.msg))}else x.error("[".concat(this._inspectId,"] Unexpected message type from worker")),this.emit(cs.INSPECT_RESULT,void 0,new Oe(te.UNEXPECTED_RESPONSE,"invalid worker message type"))}),this.workerConnection.on(en.CLOSED,()=>{this.connectionState=vu.CLOSED}),this.workerConnection.on(en.FAILED,()=>{this.connectionState=vu.CLOSED}),this.workerConnection.on(en.RECONNECTING,()=>{this.connectionState=this.connectionState===vu.CONNECTED?vu.RECONNECTING:vu.CONNECTING}),this.workerConnection.on(en.WILL_RECONNECT,(r,s,a)=>{r==="recover"&&a(r),a("tryNext")}),this.workerConnection.on(en.REQUEST_NEW_URLS,(r,s)=>{this.workerManagerConnection.close(),this.once(cs.REQUEST_NEW_WORKER_URL,a=>{r([a])}),this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(a=>{this.connectWorkerManager(a,!0)}).catch(a=>{s(a)})})}async requestToInspectImage(){this.sequence++;const r=Hc(this,cs.CLIENT_LOCAL_VIDEO_TRACK),s={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(r){if(!r.isPlaying)return void this.emit(cs.INSPECT_RESULT,void 0,new Oe(te.INVALID_OPERATION,"Only the track being played can be inspected"));const a=await this.generateRequestData(r,s);this.workerConnection.sendMessage(a,!0,!0)}else this.emit(cs.INSPECT_RESULT,void 0,new Oe(te.INVALID_OPERATION,"Only the track being published can be inspected"))}async generateRequestData(r,s){let{appId:a,cname:c,cid:u,vid:h,sid:m,uid:y}=s;const v=Date.now(),S=await r.getCurrentFrameImage("image/jpeg",this.quality),R=await xz(S,a,c),P=this.sequence+"-"+u+"-"+y+"-"+v+"-"+dr(12,""),N={appId:a,cid:u,cname:c,deviceId:"",elapse:(G=Number(v-this.inspectStartTime),{low:G|=0,high:G>>31,unsigned:G>=0}),fileSize:R.byteLength,jpgEncryption:2,height:S.height,width:S.width,jpg:R,networkType:6,osType:7,requestId:P,sdkVersion:"4.23.2",sequence:this.sequence,sid:m,timestamp:a7(v),uid:y,vid:h,service:this._inspectMode,callbackData:this.extraInfo,ossFilePrefix:this.ossFilePrefix};var G;this.extraInfo===void 0&&delete N.callbackData,this.ossFilePrefix===void 0&&delete N.ossFilePrefix;const F=Aye(N);if(F.byteLength<this.workerMessageLengthLimit){if(oe("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")){const j=function(X){for(var ee=1;ee<arguments.length;ee++){var he=arguments[ee]!=null?arguments[ee]:{};ee%2?Z$(Object(he),!0).forEach(function(Se){K(X,Se,he[Se])}):Object.getOwnPropertyDescriptors?Object.defineProperties(X,Object.getOwnPropertyDescriptors(he)):Z$(Object(he)).forEach(function(Se){Object.defineProperty(X,Se,Object.getOwnPropertyDescriptor(he,Se))})}return X}({},N);delete j.jpg,x.debug("[".concat(this._inspectId,"] Request message for worker of inspect content "),JSON.stringify(j))}return F}{const j=this.quality*this.qualityRatio;return this.quality=j,await this.generateRequestData(r,{appId:a,cname:c,cid:u,vid:h,sid:m,uid:y})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=la.CancelToken.source(),this.workerManagerConnection&&this.workerManagerConnection.close(),this.workerConnection&&this.workerConnection.close(),this.inspectTimer&&window.clearInterval(this.inspectTimer),this.inspectTimer=null,this.connectionState=vu.CLOSED,this.emit(cs.STATE_CHANGE,Su.CLOSED)}}const Vye={name:"ContentInspect",create:function(t){let{config:r}=t;return function(s){if(!s)throw new Oe(te.INVALID_PARAMS,"inspectConfig is necessary.");if(!s.inspectType||!Array.isArray(s.inspectType))throw new Oe(te.INVALID_PARAMS,"inspectConfig.inspectType is necessary and is an instance of Array.");{const a=[...new Set(s.inspectType)];a.forEach(c=>{var u;if(!ot(u=["supervise","moderation"]).call(u,c))throw new Oe(te.INVALID_PARAMS,"".concat(c," is not a valid inspect type."))}),s.inspectType=a}if(s&&s.extraInfo&&s.extraInfo.length>1024)throw new Oe(te.INVALID_PARAMS,"inspectConfig.extraInfo length cannot exceed 1024 bytes")}(r),new Uye(r)}};var eK=l(yt.Object.getOwnPropertySymbols),Fye=Wn,jye=ra.indexOf,Bye=Of,uM=ie([].indexOf),tK=!!uM&&1/uM([1],1,-0)<0;Fye({target:"Array",proto:!0,forced:tK||!Bye("indexOf")},{indexOf:function(t){var r=arguments.length>1?arguments[1]:void 0;return tK?uM(this,t,r)||0:jye(this,t,r)}});var Wye=cc("Array").indexOf,zye=O,Gye=Wye,dM=Array.prototype,Hye=function(t){var r=t.indexOf;return t===dM||zye(dM,t)&&r===dM.indexOf?Gye:r},nK=l(Hye);function $ye(t,r){if(t==null)return{};var s,a,c=function(h,m){if(h==null)return{};var y,v,S={},R=bH(h);for(v=0;v<R.length;v++)y=R[v],nK(m).call(m,y)>=0||(S[y]=h[y]);return S}(t,r);if(eK){var u=eK(t);for(a=0;a<u.length;a++)s=u[a],nK(r).call(r,s)>=0||Object.prototype.propertyIsEnumerable.call(t,s)&&(c[s]=t[s])}return c}let rK=class{get localCapabilities(){return Gr(this._localCapabilities)}get rtpCapabilities(){return Gr(this._rtpCapabilities)}get candidates(){return Gr(this._candidates)}get iceParameters(){return Gr(this._iceParameters)}get dtlsParameters(){return Gr(this._dtlsParameters)}constructor(t){K(this,"sessionDesc",void 0),K(this,"_localCapabilities",void 0),K(this,"_rtpCapabilities",void 0),K(this,"_candidates",void 0),K(this,"_iceParameters",void 0),K(this,"_dtlsParameters",void 0),K(this,"setup",void 0),K(this,"currentMidIndex",void 0),K(this,"cname","o/i14u9pJrxRKAsu"),K(this,"firefoxSsrcMidMap",new Map),t=Gr(t);const{remoteIceParameters:r,remoteDtlsParameters:s,candidates:a,remoteRTPCapabilities:c,localCapabilities:u,direction:h,setup:m,videoCodec:y,audioCodec:v}=t;let S;this.setup=m,S=h===Vo.RECEIVE_ONLY?Ba(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`):Ba(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`),this._rtpCapabilities=c,this._candidates=a,this._iceParameters=r,this._dtlsParameters=s,this._localCapabilities=u;const R=h===Vo.RECEIVE_ONLY?this.rtpCapabilities.send:this.rtpCapabilities.recv,P=h===Vo.RECEIVE_ONLY?this._localCapabilities.recv:this._localCapabilities.send,N=h===Vo.RECEIVE_ONLY?c.send.videoCodecs:jT(_t.VIDEO,R,P,y),G=h===Vo.RECEIVE_ONLY?c.send.audioCodecs:jT(_t.AUDIO,R,P,v);for(const F of S.mediaDescriptions)F.attributes.iceUfrag=r.iceUfrag,F.attributes.icePwd=r.icePwd,F.attributes.fingerprints=s.fingerprints,F.attributes.candidates=a,F.attributes.setup=this.setup,F.media.mediaType==="application"&&(F.attributes.sctpPort="5000"),F.media.mediaType==="video"&&(F.media.fmts=N.map(j=>j.payloadType.toString(10)),F.attributes.payloads=N,F.attributes.extmaps=R.videoExtensions),F.media.mediaType==="audio"&&(F.media.fmts=G.map(j=>j.payloadType.toString(10)),F.attributes.payloads=G,F.attributes.extmaps=R.audioExtensions,cS(F));this.sessionDesc=S,this.currentMidIndex=S.mediaDescriptions.length-1}toString(){return Bm(this.sessionDesc)}hasMid(t){return Array.isArray(t)?t.every(r=>this.hasMid(r)):this.sessionDesc.mediaDescriptions.some(r=>r.attributes.mid===t)}send(t,r,s,a,c){s=s.replace(/ /g,"-");const{ssrcs:u,ssrcGroups:h}=Y_(r,this.cname,oe("SYNC_GROUP")?s:void 0),m=this.findPreloadMediaDesc(u);if(m){if(Br()&&this.firefoxSsrcMidMap.set(u[0].ssrcId,m.attributes.mid),c&&(c.twcc||c.remb)){const y=this.sessionDesc.mediaDescriptions.indexOf(m);return this.sessionDesc.mediaDescriptions[y]=this.mungSendMediaDesc(m,c),{mid:m.attributes.mid,needExchangeSDP:!0}}return{mid:m.attributes.mid,needExchangeSDP:!1}}{const y=this.findAvailableMediaIndex(t,u,a);let v;return y===-1?(v=this.createOrRecycleSendMedia(t,u,h,"sendonly",a,c),this.updateBundleMids()):(v=Gr(this.sessionDesc.mediaDescriptions[y]),v.attributes.direction="sendonly",v.attributes.ssrcs=u,v.attributes.ssrcGroups=h,this.sessionDesc.mediaDescriptions[y]=this.mungSendMediaDesc(v,c)),Br()&&this.firefoxSsrcMidMap.set(u[0].ssrcId,v.attributes.mid),{needExchangeSDP:!0,mid:v.attributes.mid}}}stopSending(t){const r=this.sessionDesc.mediaDescriptions.filter(s=>s.attributes.mid&&t.indexOf(s.attributes.mid)!==-1);if(r.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");r.forEach(s=>{s.attributes.ssrcs=[]}),this.updateBundleMids()}receive(t,r,s){const a=[];return t.forEach(c=>{const u=c._mediaStreamTrack.kind,h=this.findAvailableRecvMediaIndex(u);let m,y=!1;h===-1?(y=!0,m=this.createOrRecycleRecvMedia(c,[],"recvonly",r,s),this.updateBundleMids()):(m=Gr(this.sessionDesc.mediaDescriptions[h]),m.attributes.direction="recvonly"),a.push({mid:m.attributes.mid,needCreateTransceiver:y})}),a}stopReceiving(t){const r=this.sessionDesc.mediaDescriptions.filter(s=>t.indexOf(s.attributes.mid)!==-1);if(r.length!==t.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");r.forEach(s=>{s.media.port="0",s.attributes.direction="inactive"}),this.updateBundleMids()}addRemoteCandidate(t){const{foundation:r,protocol:s,address:a,port:c,type:u,relatedAddress:h,relatedPort:m,priority:y}=new RTCIceCandidate(t),v={foundation:r??"",componentId:"1",transport:s??"",priority:y?y+"":"",connectionAddress:a??"",port:c?c+"":"",type:u?u+"":"",relAddr:h??"",relPort:m?m+"":"",extension:{}};this.candidates.some(S=>S.priority===v.priority&&S.connectionAddress===v.connectionAddress&&S.port===v.port)||(this._candidates.push(v),this.sessionDesc.mediaDescriptions.forEach(S=>{S.attributes.candidates=this.candidates}))}clearRemoteCandidate(){this._candidates=[],this.sessionDesc.mediaDescriptions[0].attributes.candidates=this._candidates}createOrRecycleRecvMedia(t,r,s,a,c){const u=t._mediaStreamTrack.kind,h=this.rtpCapabilities.recv,m=jT(u,h,this.localCapabilities.send,u===_t.AUDIO?c:a),y=u===_t.VIDEO?h.videoExtensions:h.audioExtensions,v="".concat(++this.currentMidIndex);let S={media:{mediaType:u,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:m.map(P=>P.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:y,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:r,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:m,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:s,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(v)}};S=this.mungRecvMediaDsec(S,t);const R=this.findFirstClosedMedia(u);if(R){const P=this.sessionDesc.mediaDescriptions.indexOf(R);this.sessionDesc.mediaDescriptions[P]=S}else this.sessionDesc.mediaDescriptions.push(S);return S}muteRemote(t){const r=this.sessionDesc.mediaDescriptions.filter(s=>ot(t).call(t,s.attributes.mid||""));if(r.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");r.forEach(s=>{s.attributes.direction="inactive"})}unmuteRemote(t){const r=this.sessionDesc.mediaDescriptions.filter(s=>ot(t).call(t,s.attributes.mid||""));if(r.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");r.forEach(s=>{s.attributes.direction="recvonly"})}findAvailableMediaIndex(t,r,s){return this.sessionDesc.mediaDescriptions.findIndex(a=>{const c=a.media.mediaType===t&&a.media.port!=="0"&&(a.attributes.direction==="sendonly"||a.attributes.direction==="sendrecv")&&a.attributes.ssrcs.length===0;if(Br()){if(c){const u=this.firefoxSsrcMidMap.get(r[0].ssrcId);return!(u||a.attributes.mid!=="0"&&a.attributes.mid!=="1")||!(!u||u!==a.attributes.mid)}return!1}return c&&a.attributes.mid===s})}findAvailableRecvMediaIndex(t){return this.sessionDesc.mediaDescriptions.findIndex(r=>{const s=r.media.mediaType===t&&r.media.port!=="0"&&(r.attributes.direction==="recvonly"||r.attributes.direction==="sendrecv");return r.attributes.mid!=="0"&&r.attributes.mid!=="1"&&s})}predictReceivingMids(t){const r=[];for(let s=0;s<t;s++)r.push((this.currentMidIndex+s+1).toString(10));return r}restartICE(t){t=Gr(t),this._iceParameters=t,this.sessionDesc.mediaDescriptions.forEach(r=>{r.attributes.iceUfrag=t.iceUfrag,r.attributes.icePwd=t.icePwd})}createOrRecycleSendMedia(t,r,s,a,c,u){const h=this.rtpCapabilities.send,m=t===_t.VIDEO?h.videoCodecs:h.audioCodecs,y=t===_t.VIDEO?h.videoExtensions:h.audioExtensions;Br()&&(c="".concat(++this.currentMidIndex));let v={media:{mediaType:t,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:m.map(R=>R.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:y,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:r,ssrcGroups:s,rtcpFeedbackWildcards:[],payloads:m,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:a,rtcpMux:!0,rtcpRsize:!0,mid:c}};v=this.mungSendMediaDesc(v,u);const S=this.findFirstClosedMedia(t);if(S){const R=this.sessionDesc.mediaDescriptions.indexOf(S);this.sessionDesc.mediaDescriptions[R]=v}else this.sessionDesc.mediaDescriptions.push(v);return v}mungRecvMediaDsec(t,r,s){const a=Gr(t);return h2(a),aS(a,r),f2(a,r),KH(a),IP(a,s,this.localCapabilities.send),a}mungSendMediaDesc(t,r){const s=Gr(t);return IP(s,r,this.localCapabilities.recv),cS(s),s}updateRecvMedia(t,r){const s=this.sessionDesc.mediaDescriptions.findIndex(a=>a.attributes.mid===t);if(s!==-1){const a=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[s],r);this.sessionDesc.mediaDescriptions[s]=a}}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(t=>t.media.port!=="0").map(t=>t.attributes.mid)}findPreloadMediaDesc(t){return this.sessionDesc.mediaDescriptions.find(r=>{var s;return((s=r.attributes)===null||s===void 0||(s=s.ssrcs[0])===null||s===void 0?void 0:s.ssrcId)===t[0].ssrcId})}findFirstClosedMedia(t){return this.sessionDesc.mediaDescriptions.find(r=>Br()?r.media.port==="0"&&r.media.mediaType===t:r.media.port==="0")}};const Kye=["sdp"];var yr;function iK(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}function rg(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?iK(Object(s),!0).forEach(function(a){K(t,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):iK(Object(s)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))})}return t}let sK=(yr=class xS extends AH{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var r,s;return(r=(s=this.peerConnection.getReceivers()[0])===null||s===void 0||(s=s.transport)===null||s===void 0?void 0:s.state)!==null&&r!==void 0?r:null}get localCodecs(){return[]}set isInRestartIce(r){this._isInRestartIce=r}get isInRestartIce(){return this._isInRestartIce}constructor(r,s,a){super(r,s),K(this,"direction",void 0),K(this,"name",void 0),K(this,"store",void 0),K(this,"spec",void 0),K(this,"peerConnection",void 0),K(this,"initialOffer",void 0),K(this,"transport",void 0),K(this,"statsFilter",void 0),K(this,"localCandidateCount",0),K(this,"_isInRestartIce",!1),K(this,"mutex",void 0),K(this,"onLocalCandidate",void 0),K(this,"remoteSDP",void 0),K(this,"pendingCandidates",[]),K(this,"localCapabilities",void 0),K(this,"isReady",!1),K(this,"restartCnt",0),K(this,"curTurnServerIndex",0),this.store=s,this.spec=r,this.mutex=new js("P2PConnection-mutex",s.clientId),this.peerConnection=new RTCPeerConnection(xS.resolvePCConfiguration(r,s.p2pTransport),{optional:[{googDscp:!0}]}),this.direction=a??Vo.SEND_ONLY,this.name=this.direction===Vo.SEND_ONLY?"sendP2PConnection":"recvP2PConnection",this.statsFilter=RL(this.peerConnection,oe("STATS_UPDATE_INTERVAL"),void 0,Br()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1}async establish(r){try{const s=await YH();if(this.localCapabilities=AP(s),r){const{sdp:a}=r,c=$ye(r,Kye),u=function(){const S={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},R=FT(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"sendonly"),P={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},N={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},G={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(bu(R,S,"videoExtensions",P,N,G),bu(R,S,"videoCodecs",P,N,G),bu(R,S,"audioExtensions",P,N,G),bu(R,S,"audioCodecs",P,N,G),oe("RAISE_H264_BASELINE_PRIORITY")){const F=G.videoCodecs.findIndex(j=>j.rtpMap&&j.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&j.fmtp&&j.fmtp.parameters["profile-level-id"]==="42001f");if(F!==-1){const j=G.videoCodecs.findIndex(X=>X.rtpMap&&X.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(j<F){x.debug("raising H264 baseline profile priority");const X=G.videoCodecs[F];G.videoCodecs.splice(F,1),G.videoCodecs.splice(j,0,X)}j!==-1&&oe("FILTER_SEND_H264_BASELINE")&&(P.videoCodecs=P.videoCodecs.filter(X=>!(X.rtpMap&&X.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&X.fmtp&&X.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:P,recv:N,sendrecv:G}}({},{},a);this.remoteSDP=new rK({remoteIceParameters:c.iceParameters,remoteDtlsParameters:c.dtlsParameters,candidates:[],remoteRTPCapabilities:u,localCapabilities:this.localCapabilities,direction:this.direction,setup:"actpass",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()}),this.isReady=!0;const h=await this.peerConnection.createAnswer();if(!h.sdp)throw new Error("Cannot get answer sdp when trying to establish PeerConnection.");const m=$m(h.sdp);await this.peerConnection.setLocalDescription(h);const y=await XH({},{},h.sdp);this.localCapabilities=AP(y);const v=this.peerConnection.getTransceivers()[0];return v!=null&&v.receiver&&v.receiver.transport&&this.tryBindTransportEvents(v.receiver.transport),rg(rg({},m),{},{sdp:h.sdp})}{this.peerConnection.addTransceiver("video",{direction:"sendonly"}),this.peerConnection.addTransceiver("audio",{direction:"sendonly"});const a=await this.peerConnection.createOffer();if(!a.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const c=$m(a.sdp);return this.initialOffer=a,rg(rg({},c),{},{sdp:a.sdp})}}catch(s){throw new Le(te.GET_LOCAL_CONNECTION_PARAMS_FAILED,s.toString())}}async connect(r){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");await this.peerConnection.setLocalDescription(this.initialOffer);const{sdp:s,iceParameters:a,dtlsParameters:c}=r,u=await XH({},{},s);this.remoteSDP=new rK({remoteIceParameters:a,remoteDtlsParameters:c,candidates:[],remoteRTPCapabilities:u,localCapabilities:this.localCapabilities,direction:this.direction,setup:"active",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()});const h=this.peerConnection.getTransceivers()[0];h!=null&&h.sender&&h.sender.transport&&this.tryBindTransportEvents(h.sender.transport)}catch(s){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(s.toString()))}}async addRemoteCandidate(r){try{r&&this.pendingCandidates.push(r),this.peerConnection.remoteDescription&&this.isReady&&(this.pendingCandidates.forEach(s=>{this.peerConnection.addIceCandidate(s)}),this.pendingCandidates=[])}catch(s){throw new Le(te.ADD_CANDIDATE_FAILED,"P2PConnection.addRemoteCandidate failed; ".concat(s.toString()))}}send(r,s,a){var c=this;return Tl(function*(){const u=yield kn(c.mutex.lock("From P2PConnection.send"));try{if(!c.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const h=[],m=c.remoteSDP.receive(r,s,a);r.forEach((j,X)=>{if(m[X].needCreateTransceiver){const ee=c.peerConnection.addTransceiver(j._mediaStreamTrack,{direction:"sendonly"});h.push(ee),j._updateRtpTransceiver(ee)}else{const ee=c.peerConnection.getTransceivers().find(he=>he.mid===m[X].mid);if(!ee)throw new Error("cannot find transceiver when sendPeerconnection send, mid is ".concat(m[X].mid));h.push(ee),j._updateRtpTransceiver(ee)}}),Br()&&oe("SIMULCAST")===!0&&(yield kn(c.applySimulcastForFirefox(h,r)));const y=m.map(j=>j.mid),v=yield kn(c.peerConnection.createOffer()),S=c.mungSendOfferSDP(v.sdp,r,y),R=Ba(S),P=y.map(j=>{const X=R.mediaDescriptions.find(ee=>ee.attributes.mid===j);if(!X)throw new Error("Cannot extract ssrc from mediaDescription.");return GH(X,oe("USE_PUB_RTX"))}),N=h.map((j,X)=>{const ee=y[X];return{localSSRC:P[X],id:ee}});yield kn(c.peerConnection.setLocalDescription({type:"offer",sdp:S}));try{yield N}catch(j){const X=c.remoteSDP.toString();throw yield kn(c.peerConnection.setLocalDescription({type:"offer",sdp:S})),yield kn(c.peerConnection.setRemoteDescription({type:"answer",sdp:X})),yield kn(c.stopSending(y,!0)),j}yield kn(c.applySimulcastEncodings(h,r)),yield kn(c.applySendEncodings(h,r));const G=c.remoteSDP.toString(),F=c.logSDPExchange(S,"offer","local","send");return F==null||F(G),yield kn(c.setRemoteDescription({type:"answer",sdp:G})),h.map((j,X)=>{const ee=y[X];return{localSSRC:P[X],id:ee}})}catch(h){throw h instanceof Le?h:new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(h.toString()))}finally{u()}})()}async stopSending(r,s){const a=s?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const c=this.peerConnection.getTransceivers().filter(y=>r.indexOf(y.mid)!==-1);if(c.length!==r.length)throw new Error("Transceivers' length (".concat(c.length,") doesn't match mids' length (").concat(r.length,") when trying to call P2PConnection.stopSending."));c.map(y=>{var v;y.direction="inactive",(v=y.stop)===null||v===void 0||v.call(y)});const u=await this.peerConnection.createOffer(),h=this.logSDPExchange(u.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(u),this.remoteSDP.stopReceiving(r);const m=this.remoteSDP.toString();h==null||h(m),await this.setRemoteDescription({type:"answer",sdp:m})}catch(c){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(c.toString()))}finally{a&&a()}}async receive(r,s,a,c){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(r," before remoteSDP created."));const{mid:u,needExchangeSDP:h}=this.remoteSDP.send(r,s,a,c);if(h){const y=this.remoteSDP.toString(),v=this.logSDPExchange(y,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:y});const S=await this.peerConnection.createAnswer(),R=this.mungReceiveAnswerSDP(S.sdp,u,r);v==null||v(R||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:R}),x.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(r," by exchanging SDP."))}else x.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(r," no need to exchange SDP."));const m=this.peerConnection.getTransceivers().find(y=>y.mid===u);if(!m||m.mid===null)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:m.receiver.track,mid:m.mid,transceiver:m}}catch(u){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(u.toString()))}}async mockReceive(r,s,a,c){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(r," before remoteSDP created."));const{mid:u,needExchangeSDP:h}=this.remoteSDP.send(r,s,a,c);if(h){const m=this.remoteSDP.toString(),y=this.logSDPExchange(m,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:m});const v=await this.peerConnection.createAnswer(),S=this.mungReceiveAnswerSDP(v.sdp,u,r);y==null||y(S||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:S}),x.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(r," by exchanging SDP."))}else x.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(r," no need to exchange SDP."))}catch(u){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(u.toString()))}}async stopReceiving(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(r);const s=this.remoteSDP.toString(),a=this.logSDPExchange(s,"offer","remote","stopReceiving");await this.setRemoteDescription({type:"offer",sdp:s});const c=await this.peerConnection.createAnswer();a==null||a(c.sdp||""),await this.peerConnection.setLocalDescription(c)}catch(s){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(s.toString()))}}async restartICE(r){try{if(this.store.p2pTransport===B_.Auto&&(this.store.p2pTransport=B_.SdRtn,Vn().supportPCSetConfiguration&&this.peerConnection.setConfiguration(xS.resolvePCConfiguration(this.spec,this.store.p2pTransport))),this.restartCnt>3&&(this.restartCnt=0,Vn().supportPCSetConfiguration&&this.peerConnection.setConfiguration(xS.resolvePCConfiguration(this.spec,this.store.p2pTransport,++this.curTurnServerIndex))),!r){this.restartCnt++,this.isReady=!1;const s=await this.peerConnection.createOffer({iceRestart:!0});if(!s.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const{iceParameters:a}=$m(s.sdp);return this.store.descriptionStart(),this.direction===Vo.SEND_ONLY&&await this.peerConnection.setLocalDescription(s),a}if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");if(this.remoteSDP.restartICE(r),this.store.descriptionStart(),this.direction===Vo.RECEIVE_ONLY){this.restartCnt++,await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()});const s=await this.peerConnection.createAnswer();if(!s.sdp)throw new Error("Cannot get answer sdp when trying to iceRestart.");const{iceParameters:a}=$m(s.sdp);return await this.peerConnection.setLocalDescription(s),a}await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()}),this.isReady=!0}catch(s){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(s.toString()))}}close(){var r;this.peerConnection.close(),this.peerConnection.onicecandidate=null,(r=this.onConnectionStateChange)===null||r===void 0||r.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.transport=void 0,this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(r){return this.statsFilter.getVideoIsReady(r)}async updateEncoderConfig(r,s){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const a=await this.peerConnection.createOffer(),c=this.mungSendOfferSDP(a.sdp,[s],[r]);this.remoteSDP.updateRecvMedia(r,s);const u=this.remoteSDP.toString(),h=this.logSDPExchange(c,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:c}),h==null||h(u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(a){throw new Le(te.EXCHANGE_SDP_FAILED,a.toString())}}async updateSendParameters(r,s){const a=this.peerConnection.getTransceivers().filter(c=>c.mid===r);a.length===1&&(this.isVP8Simulcast(s)?Br()||await this.applySimulcastEncodings(a,[s]):await this.applySendEncodings(a,[s]))}setStatsRemoteVideoIsReady(r,s){this.statsFilter.setVideoIsReady2(r,s)}async replaceTrack(r,s){const a=this.peerConnection.getTransceivers().find(c=>c.mid===s);a&&await a.sender.replaceTrack(r._mediaStreamTrack)}async getSelectedCandidatePair(){const r=this.peerConnection.getReceivers();if(r.length>0&&r[0].transport&&r[0].transport.iceTransport&&r[0].transport.iceTransport.getSelectedCandidatePair&&r[0].transport.iceTransport.getSelectedCandidatePair()){const s=r[0].transport.iceTransport,{local:a,remote:c}=s.getSelectedCandidatePair();return{local:rg(rg({},Sh),{},{candidateType:a.type,protocol:a.protocol,address:a.address,port:a.port}),remote:rg(rg({},Sh),{},{candidateType:c.type,protocol:c.protocol,address:c.address,port:c.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var r,s;ot(r=["connected","completed"]).call(r,this.peerConnection.iceConnectionState)&&(this.isReady=!1),(s=this.onICEConnectionStateChange)===null||s===void 0||s.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var r;this.peerConnection.connectionState==="connected"&&(this.restartCnt=0),(r=this.onConnectionStateChange)===null||r===void 0||r.call(this,this.peerConnection.connectionState)},this.startICECandidate()}startICECandidate(){this.peerConnection.onicecandidate||(this.localCandidateCount=0,this.peerConnection.onicecandidate=r=>{if(r.candidate){var s;r.candidate.candidate&&((s=this.onLocalCandidate)===null||s===void 0||s.call(this,r.candidate.toJSON())),this.localCandidateCount+=1}else x.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount)})}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(r,s){let a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const c={iceServers:[]};var u;return r.iceServers?c.iceServers=r.iceServers:r.turnServer&&r.turnServer.mode!=="off"&&(RT(r.turnServer.servers)?c.iceServers=r.turnServer.servers:(c.iceServers&&c.iceServers.push(...xS.turnServerConfigToIceServers(r.turnServer.servers,s,a)),oe("USE_TURN_SERVER_OF_GATEWAY")&&c.iceServers&&r.turnServer.serversFromGateway&&c.iceServers.push(...xS.turnServerConfigToIceServers(r.turnServer.serversFromGateway,s,a)),ot(u=[B_.Relay,B_.SdRtn]).call(u,s)&&(c.iceTransportPolicy="relay"),oe("FORCE_TURN_TCP")?c.iceTransportPolicy="relay":r.turnServer.servers.concat(r.turnServer.serversFromGateway||[]).forEach(h=>{h.forceturn&&(c.iceTransportPolicy="relay")}))),oe("ENABLE_ENCODED_TRANSFORM")&&Vn().supportWebRTCEncodedTransform&&(c.encodedInsertableStreams=!0),x.debug("P2PConnection p2pTransport is ".concat(s)),c}static turnServerConfigToIceServers(r,s){let a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const c=[],u=r.filter(m=>m.tcpport);x.debug("P2PConnection turnServers is ".concat(u,", current index is ").concat(a));const h=u.length>a?u[a]:u[0];switch(s){case B_.SdRtn:const m=r.filter(v=>{var S;return ot(S=v.username).call(S,"glb:")&&v.turnServerURL==v.turnServerURL}),y=m.length>a?m[a]:m[0];y&&(c.push({username:y.username,credential:y.password,credentialType:"password",urls:"turn:".concat(Gm(y.turnServerURL),":").concat(y.tcpport,"?transport=udp")}),c.push({username:y.username,credential:y.password,credentialType:"password",urls:"turns:".concat(Gm(y.turnServerURL),":").concat(y.tcpport,"?transport=tcp")}));break;case B_.Relay:h&&(c.push({username:h.username,credential:h.password,credentialType:"password",urls:"turn:".concat(h.turnServerURL,":").concat(h.tcpport,"?transport=udp")}),c.push({username:h.username,credential:h.password,credentialType:"password",urls:"turns:".concat(Gm(h.turnServerURL),":").concat(h.tcpport,"?transport=tcp")}));break;default:h&&(c.push({username:h.username,credential:h.password,credentialType:"password",urls:"turn:".concat(h.turnServerURL,":").concat(h.tcpport,"?transport=udp")}),c.push({username:h.username,credential:h.password,credentialType:"password",urls:"turns:".concat(Gm(h.turnServerURL),":").concat(h.tcpport,"?transport=tcp")}),c.push({username:h.username,credential:h.password,credentialType:"password",urls:"stun:".concat(h.turnServerURL,":").concat(h.tcpport)}))}return c}tryBindTransportEvents(r){if(r){this.transport=r,r.onstatechange=()=>{var a;r!=null&&r.state&&((a=this.onDTLSTransportStateChange)===null||a===void 0||a.call(this,r.state))},r.onerror=a=>{var c;(c=this.onDTLSTransportError)===null||c===void 0||c.call(this,"error"in a?a.error:a)};const s=r.iceTransport;s&&(s.onstatechange=()=>{const a=r==null?void 0:r.iceTransport.state;var c;a&&((c=this.onICETransportStateChange)===null||c===void 0||c.call(this,a))},s.getSelectedCandidatePair&&(s.onselectedcandidatepairchange=()=>{if(s.getSelectedCandidatePair()){const{local:a,remote:c}=s.getSelectedCandidatePair();x.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:a.type,protocol:a.protocol}),", remote ").concat(JSON.stringify({candidateType:c.type,protocol:c.protocol,address:c.address,port:c.port})," )"))}}))}}tryUnbindTransportEvents(){this.transport&&(this.transport.onstatechange=null,this.transport.onerror=null,this.transport.iceTransport&&(this.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(r,s){var a;if(s||(s=this.peerConnection.getSenders().find(S=>S.track===r._mediaStreamTrack)),!s)return x.warn("[".concat(r.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(r))return x.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!Vn().supportSetRtpSenderParameters)return x.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const c={},u={};switch(r._optimizationMode){case"motion":c.degradationPreference="maintain-framerate";break;case"detail":c.degradationPreference="maintain-resolution";break;default:c.degradationPreference="balanced"}if(r._encoderConfig){var h;const{bitrateMax:S,frameRate:R,scaleResolutionDownBy:P}=r._encoderConfig;S&&(u.maxBitrate=1e3*S),ot(h=r._hints).call(h,hr.LOW_STREAM)&&(R&&(u.maxFramerate=_c(R)),P&&P>=1&&(u.scaleResolutionDownBy=P))}if(oe("DSCP_TYPE")&&np()){var m;const S=oe("DSCP_TYPE");ot(m=["very-low","low","medium","high"]).call(m,S)&&(u.networkPriority=S)}const y=s.getParameters(),v=(a=y.encodings)===null||a===void 0?void 0:a[0];Br()&&!v&&(c.encodings=[u]),v&&Object.assign(v,u),Object.assign(y,c),x.debug("[".concat(r.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(y.encodings))),await s.setParameters(y)}async applySendEncodings(r,s){try{if(!Vn().supportSetRtpSenderParameters||r.length!==s.length)return;for(let a=0;a<r.length;a++){const c=r[a],u=s[a];u instanceof Sr&&!this.isVP8Simulcast(u)&&await this.updateRtpSenderEncodings(u,c.sender)}}catch{x.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(r,s,a){const c=Ba(r);return s.forEach((u,h)=>{const m=a[h],y=c.mediaDescriptions.find(v=>v.attributes.mid===m);y&&(aS(y,u),qH(y,u,this.store.codec))}),Bm(c)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=r=>{var s;(s=this.onFirstAudioReceived)===null||s===void 0||s.call(this,r)},this.statsFilter.onFirstVideoReceived=r=>{var s;(s=this.onFirstVideoReceived)===null||s===void 0||s.call(this,r)},this.statsFilter.onFirstAudioDecoded=r=>{var s;(s=this.onFirstAudioDecoded)===null||s===void 0||s.call(this,r)},this.statsFilter.onFirstVideoDecoded=(r,s,a)=>{var c;(c=this.onFirstVideoDecoded)===null||c===void 0||c.call(this,r,s,a)},this.statsFilter.onSelectedLocalCandidateChanged=(r,s)=>{var a;(a=this.onSelectedLocalCandidateChanged)===null||a===void 0||a.call(this,r,s)},this.statsFilter.onSelectedRemoteCandidateChanged=(r,s)=>{var a;(a=this.onSelectedRemoteCandidateChanged)===null||a===void 0||a.call(this,r,s)},this.statsFilter.onFirstVideoDecodedTimeout=r=>{var s;(s=this.onFirstVideoDecodedTimeout)===null||s===void 0||s.call(this,r)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(r,s){if(r.length===s.length)for(let y=0;y<r.length;y++){var a,c,u,h,m;const v=r[y],S=s[y];if(S instanceof Sr&&!ot(a=S._hints).call(a,hr.LOW_STREAM)&&(c=S._encoderConfig)!==null&&c!==void 0&&c.bitrateMax&&((u=S._encoderConfig)===null||u===void 0?void 0:u.bitrateMax)>200&&(h=S._scalabilityMode)!==null&&h!==void 0&&h.numSpatialLayers&&((m=S._scalabilityMode)===null||m===void 0?void 0:m.numSpatialLayers)>1&&this.store.codec==="vp8"){const R={},P={high:1e3*(S._encoderConfig.bitrateMax-50),medium:5e4};R.encodings=[{rid:"m",active:!0,maxBitrate:P.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:P.high}];const N=v.sender.getParameters();await v.sender.setParameters(Object.assign(N,R))}}}async applySimulcastEncodings(r,s){if(!Br()&&r.length===s.length)for(let a=0;a<r.length;a++){const c=s[a];if(c instanceof Sr&&this.isVP8Simulcast(c)){const u=r[a],h={},m={high:1e3*(c._encoderConfig.bitrateMax-50),medium:5e4};h.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:m.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:m.medium,scaleResolutionDownBy:4}];const y=u.sender.getParameters();await u.sender.setParameters(Object.assign(y,h))}}}isVP8Simulcast(r){var s,a,c,u,h;return!!(r instanceof Sr&&oe("SIMULCAST")&&this.store.codec==="vp8"&&!ot(s=r._hints).call(s,hr.LOW_STREAM)&&(a=r._encoderConfig)!==null&&a!==void 0&&a.bitrateMax&&((c=r._encoderConfig)===null||c===void 0?void 0:c.bitrateMax)>200&&(u=r._scalabilityMode)!==null&&u!==void 0&&u.numSpatialLayers&&((h=r._scalabilityMode)===null||h===void 0?void 0:h.numSpatialLayers)>1)}logSDPExchange(r,s,a,c){if(oe("SDP_LOGGING"))return x.upload("[".concat(this.store.clientId,"] exchanging ").concat(a," ").concat(s," SDP during P2PConnection.").concat(c,`
`),r),s==="offer"?u=>{this.logSDPExchange(u,"answer",a==="local"?"remote":"local",c)}:void 0}async muteLocal(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const s=this.peerConnection.getTransceivers().filter(h=>h.mid&&r.indexOf(h.mid)!==-1);if(s.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length.");s.map(h=>{h.direction="inactive"});const a=await this.peerConnection.createOffer(),c=this.logSDPExchange(a.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(a),this.remoteSDP.muteRemote(r);const u=this.remoteSDP.toString();c==null||c(u),await this.setRemoteDescription({type:"answer",sdp:u})}catch(s){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(s.toString()))}}async unmuteLocal(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const s=this.peerConnection.getTransceivers().filter(h=>h.mid&&r.indexOf(h.mid)!==-1);if(s.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length.");s.map(async h=>{h.direction="sendonly"});const a=await this.peerConnection.createOffer(),c=this.logSDPExchange(a.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(a),this.remoteSDP.unmuteRemote(r);const u=this.remoteSDP.toString();c==null||c(u),await this.setRemoteDescription({type:"answer",sdp:u})}catch(s){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(s.toString()))}}async getRemoteSSRC(r,s){var a,c;if(s=(a=s)!==null&&a!==void 0?a:(c=this.currentRemoteDescription)===null||c===void 0?void 0:c.sdp){var u;const h=(u=Ba(s).mediaDescriptions.find(m=>m.attributes.mid===r))===null||u===void 0?void 0:u.attributes.ssrcs;return h==null?void 0:h[0].ssrcId}}async setRemoteDescription(r){var s;await this.peerConnection.setRemoteDescription(r),ot(s=["connected","completed"]).call(s,this.peerConnection.iceConnectionState)||(this.isReady=!0,this.addRemoteCandidate())}mungReceiveAnswerSDP(r,s,a){const c=Ba(r),u=c.mediaDescriptions.find(h=>h.attributes.mid===s);return u&&a===_t.AUDIO&&u.media.mediaType==="audio"&&cS(u),Bm(c)}},Tt(yr.prototype,"establish",[Iu],Object.getOwnPropertyDescriptor(yr.prototype,"establish"),yr.prototype),Tt(yr.prototype,"connect",[Iu],Object.getOwnPropertyDescriptor(yr.prototype,"connect"),yr.prototype),Tt(yr.prototype,"receive",[Iu],Object.getOwnPropertyDescriptor(yr.prototype,"receive"),yr.prototype),Tt(yr.prototype,"mockReceive",[Iu],Object.getOwnPropertyDescriptor(yr.prototype,"mockReceive"),yr.prototype),Tt(yr.prototype,"stopReceiving",[Iu],Object.getOwnPropertyDescriptor(yr.prototype,"stopReceiving"),yr.prototype),Tt(yr.prototype,"restartICE",[Iu],Object.getOwnPropertyDescriptor(yr.prototype,"restartICE"),yr.prototype),Tt(yr.prototype,"close",[Iu],Object.getOwnPropertyDescriptor(yr.prototype,"close"),yr.prototype),Tt(yr.prototype,"updateEncoderConfig",[Iu],Object.getOwnPropertyDescriptor(yr.prototype,"updateEncoderConfig"),yr.prototype),Tt(yr.prototype,"updateSendParameters",[Iu],Object.getOwnPropertyDescriptor(yr.prototype,"updateSendParameters"),yr.prototype),Tt(yr.prototype,"replaceTrack",[Iu],Object.getOwnPropertyDescriptor(yr.prototype,"replaceTrack"),yr.prototype),Tt(yr.prototype,"muteLocal",[Iu],Object.getOwnPropertyDescriptor(yr.prototype,"muteLocal"),yr.prototype),Tt(yr.prototype,"unmuteLocal",[Iu],Object.getOwnPropertyDescriptor(yr.prototype,"unmuteLocal"),yr.prototype),yr);function Iu(t,r,s){const a=t[r];if(typeof a!="function")throw new Error("Cannot use mutex on object property.");return s.value=async function(){const c=this.mutex,u=await c.lock("From P2PConnection.".concat(r));try{for(var h=arguments.length,m=new Array(h),y=0;y<h;y++)m[y]=arguments[y];return await a.apply(this,m)}finally{u()}},s}let wd=function(t){return t.SEND_ONLY="SEND_ONLY",t.RECEIVE_ONLY="RECEIVE_ONLY",t}({});var oK,aK,cK,lK,uK,dK,hK,fK,pK,mK,gK,xr;function _K(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}function uO(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?_K(Object(s),!0).forEach(function(a){K(t,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):_K(Object(s)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))})}return t}let qye=(oK=Cd(wd.SEND_ONLY),aK=Cd(wd.SEND_ONLY),cK=Cd(),lK=Cd(wd.RECEIVE_ONLY),uK=Cd(wd.RECEIVE_ONLY),dK=Cd(wd.RECEIVE_ONLY),hK=Cd(wd.RECEIVE_ONLY),fK=Cd(wd.RECEIVE_ONLY),pK=Cd(wd.RECEIVE_ONLY),mK=Cd(),gK=Cd(wd.RECEIVE_ONLY),xr=class extends Ur{get state(){return this._state}set state(t){const r=this._state;this._state=t,this.emit(xt.StateChange,r,this._state)}constructor(t,r){super(),K(this,"isPlanB",!1),K(this,"store",void 0),K(this,"statsUploader",void 0),K(this,"sendConnection",void 0),K(this,"recvConnection",void 0),K(this,"localTrackMap",new Map),K(this,"remoteUserMap",new Map),K(this,"localDataChannels",[]),K(this,"pendingLocalTracks",[]),K(this,"pendingRemoteTracks",[]),K(this,"statsCollector",void 0),K(this,"dtlsFailedCount",0),K(this,"sendMutex",void 0),K(this,"recvMutex",void 0),K(this,"_state",qn.Disconnected),K(this,"_restartStates",["disconnected","failed"]),K(this,"reconnectInterval",void 0),K(this,"uploadUnplinkStarted",!1),K(this,"uploadDownlinkStarted",!1),K(this,"uplinkStateUploadInterval",void 0),K(this,"downlinkStatsUploadInterval",void 0),K(this,"handleMuteLocalTrack",async(s,a,c)=>{const u=await this.sendMutex.lock("Locking from P2PChannel2.handleMuteLocalTrack");try{if(!this.sendConnection||this.state!==qn.Connected)return void c(new Le(te.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established."));const y=this.filterTobeMutedTracks(s);if(y.length===0)return void a();const v=y.find(N=>N[0]==="videoLowTrack");v&&v[1].track._originMediaStreamTrack.stop(),await this.sendConnection.muteLocal(y.map(N=>{let[,{id:G}]=N;return G}));let S=!1;var h,m;s.trackMediaType==="video"?S=!((h=this.localTrackMap.get(Ke.LocalAudioTrack))===null||h===void 0||!h.track._muted):S=((m=this.localTrackMap.get(Ke.LocalVideoTrack))===null||m===void 0?void 0:m.id)===void 0;const R=this.createMuteMessage(y);await ur(this,xt.RequestMuteLocal,R);const P=s.trackMediaType==="video"?zm.MUTE_LOCAL_VIDEO:zm.MUTE_LOCAL_AUDIO;await ur(this,xt.RequestP2PMuteLocal,{action:P,message:R,isMuteAll:S}),a()}catch(y){c(y)}finally{u()}}),K(this,"handleUnmuteLocalTrack",async(s,a,c)=>{const u=await this.sendMutex.lock("Locking from P2PChannel2.handleUnmuteLocalTrack");try{if(!this.sendConnection||this.state!==qn.Connected)return void c(new Le(te.INVALID_OPERATION,"Cannot call P2PChannel2.handleUnmuteLocalTrack before sendConnection established."));const h=this.filterTobeUnmutedTracks(s);if(h.length===0)return void a();await this.sendConnection.unmuteLocal(h.map(v=>{let[,{id:S}]=v;return S}));const m=this.createUnmuteMessage(h),y=s.trackMediaType==="video"?zm.UNMUTE_LOCAL_VIDEO:zm.UNMUTE_LOCAL_AUDIO;await ur(this,xt.RequestP2PMuteLocal,{action:y,message:m}),a()}catch(h){c(h)}finally{u()}}),K(this,"handleUpdateVideoEncoder",async(s,a,c,u)=>{let h;typeof u=="boolean"&&u||(h=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoEncoder"));try{const y=this.localTrackMap.get(Ke.LocalVideoTrack);if(!this.sendConnection||!y||y.track!==s||this.state!==qn.Connected)return void a();const{id:v,track:S}=y;v&&(await this.sendConnection.updateSendParameters(v,S),await this.sendConnection.updateEncoderConfig(v,S),this.emit(xt.UpdateVideoEncoder,S)),a()}catch(y){c(y)}finally{var m;(m=h)===null||m===void 0||m()}}),K(this,"handleUpdateVideoSendParameters",async(s,a,c)=>{const u=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoSendParameters");try{const h=this.localTrackMap.get(Ke.LocalVideoTrack);if(!this.sendConnection||!h||h.track!==s||this.state!==qn.Connected)return void a();const{id:m,track:y}=h;m&&await this.sendConnection.updateSendParameters(m,y),a()}catch(h){c(h)}finally{u()}}),K(this,"handleReplaceTrack",async(s,a,c,u)=>{let h;x.debug("[".concat(this.store.clientId,"] P2PChannel2 handleReplaceTrack for [track-id-").concat(s.getTrackId(),"]")),typeof u=="boolean"&&u||(h=await this.sendMutex.lock("From P2PChannel2.handleReplaceTrack"));try{var m;const v=Array.from(this.localTrackMap.entries()).find(S=>{let[,{track:R}]=S;return s===R});if(!this.sendConnection||!v||v[1].id===void 0||this.state!==qn.Connected)return void a();if(await((m=this.sendConnection)===null||m===void 0?void 0:m.replaceTrack(s,v[1].id)),v[0]===Ke.LocalVideoTrack&&Vn().supportDualStreamEncoding){const S=this.localTrackMap.get(Ke.LocalVideoLowTrack);if(S){const R=s._mediaStreamTrack.clone();S.track._originMediaStreamTrack.stop(),S.track._mediaStreamTrack=R,S.track._originMediaStreamTrack=R,await new dt((P,N)=>{this.handleReplaceTrack(S.track,P,N,!0)})}}a()}catch(v){c(v)}finally{var y;(y=h)===null||y===void 0||y()}}),K(this,"handleGetLocalVideoStats",s=>{s(this.statsCollector.getLocalVideoTrackStats())}),K(this,"handleGetLocalAudioStats",s=>{s(this.statsCollector.getLocalAudioTrackStats())}),K(this,"handleGetRemoteVideoStats",s=>this.statsCollector.getRemoteVideoTrackStats(s.uid)[s.uid]),K(this,"handleGetRemoteAudioStats",s=>this.statsCollector.getRemoteAudioTrackStats(s.uid)[s.uid]),this.store=t,this.statsCollector=r,this.statsCollector.addP2PChannel(this),this.statsUploader=new L9(t),this.bindStatsUploaderEvents(),this.sendMutex=new js("P2PChannel2-send-mutex",t.clientId),this.recvMutex=new js("P2PChannel2-recv-mutex",t.clientId),this.reconnectInterval=window.setInterval(()=>{[this.sendConnection,this.recvConnection].forEach(s=>{s&&(s.iceConnectionState!=="disconnected"&&s.iceConnectionState!=="failed"||this.handleDisconnect(s.direction))})},oe("ICE_RESTART_INTERVAL"))}async startP2PConnection(t,r){throw new Le(te.NOT_SUPPORTED,"p2p mode does not support startP2PConnection.")}async connect(t){throw new Le(te.NOT_SUPPORTED,"p2p mode does not support connect.")}async startP2P(t,r){let s;try{if(r){this.recvConnection&&(x.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset recvConnection.")),this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection)),s=await this.recvMutex.lock("From P2PChannel.startP2P"),this.recvConnection=new sK(t,this.store,Vo.RECEIVE_ONLY),this.bindConnectionEvents(this.recvConnection);const a=await this.recvConnection.establish(r);return{iceParameters:a.iceParameters,dtlsParameters:a.dtlsParameters,sdp:a.sdp}}{this.state=qn.New,this.sendConnection&&(x.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset sendConnection.")),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection)),s=await this.sendMutex.lock("From P2PChannel.startP2P"),this.sendConnection=new sK(t,this.store),this.store.peerConnectionStart(),this.bindConnectionEvents(this.sendConnection);const a=await this.sendConnection.establish();return{iceParameters:a.iceParameters,dtlsParameters:a.dtlsParameters,sdp:a.sdp}}}finally{s&&s()}}async p2pConnect(t){if(!this.sendConnection)throw new Le(te.UNEXPECTED_ERROR,"Cannot P2PChannel2.p2pConnect before P2PChannel2.startP2PConnection .");this.store.peerConnectionStart(),await this.sendConnection.connect(t),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=qn.Connected}async addRemoteCandidate(t,r){if(r===Vo.RECEIVE_ONLY){if(!this.sendConnection)throw new Le(te.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.sendConnection.addRemoteCandidate(t)}else{if(!this.recvConnection)throw new Le(te.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.recvConnection.addRemoteCandidate(t)}}publish(t,r,s){var a=this;return Tl(function*(){const c=yield kn(a.sendMutex.lock("From P2PChannel.publish"));try{if(!a.sendConnection||a.state!==qn.Connected){a.throwIfTrackTypeNotMatch(t);const v=t.filter(S=>a.pendingLocalTracks.indexOf(S)===-1);return void(a.pendingLocalTracks=a.pendingLocalTracks.concat(v))}a.store.pubId=a.store.pubId+1,zs.markPublishStart(a.store.clientId,a.store.pubId);const u=a.filterTobePublishedTracks(t,r,s);if(u.length===0)return void(yield kn(a.tryToUnmuteAudio(t)));u.forEach(v=>{let{track:S,type:R}=v;const P=Date.now();a.store.publish(S.getTrackId(),R===Ke.LocalAudioTrack?"audio":"video",P)}),a.bindLocalTrackEvents(u);const h=yield kn(a.sendConnection.send(u.map(v=>{let{track:S}=v;return S}),a.store.codec,a.store.audioCodec)),m=(yield kn(h.next())).value,y=a.createGatewayPublishMessage(u,m);try{yield y}catch(v){throw h.throw(v),(v==null?void 0:v.code)===te.WS_ABORT&&u.forEach(S=>{let{track:R}=S;a.pendingLocalTracks.indexOf(R)===-1&&a.pendingLocalTracks.push(R)}),a.unbindLocalTrackEvents(u),v}yield kn(h.next()),u.forEach(v=>{let{type:S}=v;a.statsCollector.addLocalStats(S)}),a.statsUploader.startUploadOutboundStats(),a.assignLocalTracks(u,m),u.forEach(v=>{let{track:S,type:R}=v;const P=Date.now();a.store.publish(S.getTrackId(),R===Ke.LocalAudioTrack?"audio":"video",void 0,P)}),a.startUploadUplinkState()}finally{c()}})()}async unpublish(t){if(!this.sendConnection||this.state!==qn.Connected)return void(t.length===0?this.pendingLocalTracks.length=0:this.pendingLocalTracks=this.pendingLocalTracks.filter(c=>!ot(t).call(t,c)));const r=this.filterTobeUnpublishedTracks(t);if(r.length===0)return;const s=r.find(c=>c[0]==="videoLowTrack");s&&s[1].track.close();const a=this.createGatewayUnpublishMessage(r);if(await this.sendConnection.stopSending(r.map(c=>{let[,{id:u}]=c;return u})),this.withdrawLocalTracks(r),this.unbindLocalTrackEvents(r.map(c=>{let[u,{track:h}]=c;return{type:u,track:h}})),r.forEach(c=>{let[u]=c;this.statsCollector.removeLocalStats(u)}),this.localTrackMap.size===0&&(this.statsUploader.stopUploadOutboundStats(),this.stopUploadUplinkState()),this.sendConnection&&this.state===qn.Connected)return s&&s[1].track.close(),a;t.forEach(c=>{const u=this.pendingLocalTracks.indexOf(c);u!==-1&&this.pendingLocalTracks.splice(u,1)})}startUploadUplinkState(){if(this.uploadUnplinkStarted)return;this.uploadUnplinkStarted=!0,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval);const t=()=>{const r=[],s=[];Array.from(this.localTrackMap.entries()).forEach(a=>{let[c,{track:u,ssrcs:h}]=a;const m={stream_type:Fge(u,c),ssrcs:h};u._muted||!u._enabled?r.push(m):s.push(m)}),r.length>0&&r.forEach(a=>{ur(this,xt.RequestMuteLocal,[a])}),s.length>0&&s.forEach(a=>{ur(this,xt.RequestUnmuteLocal,[a])})};t(),this.uplinkStateUploadInterval=window.setInterval(()=>{t()},3e3)}stopUploadUplinkState(){this.uploadUnplinkStarted&&(this.uploadUnplinkStarted=!1,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval))}publishLowStream(t){return Tl(function*(){throw new Le(te.NOT_SUPPORTED,"p2p mode does not support publishLowStream.")})()}async republish(){this.pendingLocalTracks.length>0&&(x.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await ks(this,xt.RequestRePublish,this.pendingLocalTracks),this.emit(xt.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[])}async unpublishLowStream(){throw new Le(te.NOT_SUPPORTED,"p2p mode does not support unpublishLowStream.")}async subscribe(t,r,s,a){var c;if(!this.recvConnection)throw new Le(te.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");if((c=this.remoteUserMap.get(t))!==null&&c!==void 0&&c.has(r))return;const{track:u,mid:h,transceiver:m}=await this.recvConnection.receive(r,[{ssrcId:s}],String(t.uid),a);r===_t.AUDIO?(t._audioTrack?t._audioTrack._updateOriginMediaStreamTrack(u):(t._audioTrack=new Zv(u,t.uid,t._uintid,this.store),x.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(t._audioTrack.getTrackId()))),m&&t._audioTrack._updateRtpTransceiver(m),this.bindRemoteTrackEvents(t,t._audioTrack)):(t._videoSSRC=s,t._videoTrack?t._videoTrack._updateOriginMediaStreamTrack(u):(t._videoTrack=new Qv(u,t.uid,t._uintid,this.store),x.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(t._videoTrack.getTrackId()))),m&&t._videoTrack._updateRtpTransceiver(m),this.bindRemoteTrackEvents(t,t._videoTrack));const y=this.remoteUserMap.get(t);y?y.set(r,h):this.remoteUserMap.set(t,new Map([[r,h]])),this.statsCollector.addRemoteStats(t.uid),this.statsUploader.startUploadInboundStats(),this.startUploadDownlinkState();const v=this.pendingRemoteTracks.findIndex(S=>{let{user:R,kind:P}=S;return R.uid===t.uid&&r===P});v!==-1&&(this.pendingRemoteTracks.splice(v,1),this.emit(xt.MediaReconnectEnd,t.uid))}async mockSubscribe(t,r,s,a){if(!this.recvConnection)throw new Le(te.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");await this.recvConnection.mockReceive(r,[{ssrcId:s}],String(t.uid),a)}async unsubscribe(t,r,s){const a=this.pendingRemoteTracks.filter(u=>{let{user:h,kind:m}=u;return r!==void 0?h.uid===t.uid&&r===m:h.uid===t.uid});if(a.forEach(u=>{const h=this.pendingRemoteTracks.indexOf(u);this.pendingRemoteTracks.splice(h,1)}),this.recvConnection||s||a.forEach(u=>{let{kind:h}=u;var m;if(h===_t.AUDIO)(m=t._audioTrack)===null||m===void 0||m._destroy(),t._audioTrack=void 0;else if(h===_t.VIDEO){var y;(y=t._videoTrack)===null||y===void 0||y._destroy(),t._videoTrack=void 0}}),!this.recvConnection)return;const c=this.filterTobeUnSubscribedTracks(t,r);c.length!==0&&(await this.recvConnection.stopReceiving(c.map(u=>{let[,{id:h}]=u;return h})),this.withdrawRemoteTracks(c),this.remoteUserMap.size===0&&(this.statsUploader.stopUploadInboundStats(),this.stopUploadDownlinkState()),c.forEach(u=>{let[h,{kind:m}]=u;var y,v;if(m===_t.VIDEO&&h._videoSSRC&&((y=this.recvConnection)===null||y===void 0||y.setStatsRemoteVideoIsReady(h._videoSSRC,!1)),m===_t.VIDEO)this.unbindRemoteTrackEvents(h._videoTrack),s||((v=h._videoTrack)===null||v===void 0||v._destroy(),h._videoTrack=void 0);else if(m===_t.AUDIO){var S;this.unbindRemoteTrackEvents(h._audioTrack),!s&&((S=h._audioTrack)===null||S===void 0||S._destroy(),h._audioTrack=void 0)}}),c.forEach(u=>{let[,{kind:h}]=u;ur(this,xt.RequestP2PMuteRemote,h)}))}startUploadDownlinkState(){if(this.uploadDownlinkStarted)return;this.uploadDownlinkStarted=!0,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval);const t=()=>Array.from(this.remoteUserMap.entries()).forEach(r=>{let[,s]=r;[_t.VIDEO,_t.AUDIO].forEach(a=>{s.has(a)?ur(this,xt.RequestP2PUnmuteRemote,a):ur(this,xt.RequestP2PMuteRemote,a)})});t(),this.downlinkStatsUploadInterval=window.setInterval(()=>{t()},3e3)}stopUploadDownlinkState(){this.uploadDownlinkStarted&&(this.uploadDownlinkStarted=!1,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval))}getAllDataChannels(){return this.localDataChannels}async massSubscribe(t){throw new Le(te.NOT_SUPPORTED,"p2p mode does not support massSubscribe.")}async massSubscribeNoLock(t){throw new Le(te.NOT_SUPPORTED,"p2p mode does not support massSubscribeNoLock.")}async massUnsubscribe(t){throw new Le(te.NOT_SUPPORTED,"p2p mode does not support massUnsubscribe.")}async massUnsubscribeNoLock(t){throw new Le(te.NOT_SUPPORTED,"p2p mode does not support massUnsubscribeNoLock.")}async muteRemote(t,r){if(!this.recvConnection)return;const s=this.remoteUserMap.get(t);if(!s)return void x.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(t.uid,"."));if(!s.get(r))return void x.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(t.uid," media type ").concat(r,"."));const a=r===_t.VIDEO?t._videoSSRC:t._audioSSRC;a!==void 0&&this.recvConnection.setStatsRemoteVideoIsReady(a,!1)}async unmuteRemote(t,r){return this.unmuteRemoteNoLock(t,r)}async unmuteRemoteNoLock(t,r){if(!this.recvConnection)return;const s=this.remoteUserMap.get(t);if(!s)return void x.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(t.uid,"."));s.get(r)||x.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(t.uid," media type ").concat(r,"."))}getAllTracks(t){const r=this.localTrackMap.get(Ke.LocalAudioTrack);if((r==null?void 0:r.track)instanceof Li){const s=r.track;return Array.from(this.localTrackMap.entries()).filter(a=>{let[c]=a;return c!==Ke.LocalAudioTrack}).filter(a=>{let[c]=a;return!(t&&c===Ke.LocalVideoLowTrack)}).map(a=>{let[,{track:c}]=a;return c}).concat(s.trackList)}return Array.from(this.localTrackMap.entries()).filter(s=>{let[a]=s;return!(t&&a===Ke.LocalVideoLowTrack)}).map(s=>{let[,{track:a}]=s;return a})}reportPublishEvent(t,r,s,a,c){if(t){const h=this.localTrackMap.get(Ke.LocalAudioTrack),m=a?this.localTrackMap.get(Ke.LocalVideoLowTrack):this.localTrackMap.get(Ke.LocalVideoTrack);It.publish(this.store.sessionId,{eventElapse:zs.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:t,ec:r,audioName:h==null?void 0:h.track.getTrackLabel(),videoName:m==null?void 0:m.track.getTrackLabel(),screenshare:(m==null?void 0:m.track._hints.indexOf(hr.SCREEN_TRACK))!==-1,audio:!!h,video:!!m,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:c})}else{var u;s||(s=[]);const h=s.find(y=>y instanceof Yr),m=a?(u=this.localTrackMap.get(Ke.LocalVideoTrack))===null||u===void 0?void 0:u.track:s.find(y=>y instanceof Sr);It.publish(this.store.sessionId,{eventElapse:zs.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:t,ec:r,audioName:h==null?void 0:h.getTrackLabel(),videoName:m==null?void 0:m.getTrackLabel(),screenshare:(m==null?void 0:m._hints.indexOf(hr.SCREEN_TRACK))!==-1,audio:!!h,video:!!m,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:c})}}reportSubscribeEvent(t,r,s,a){const c=a===_t.VIDEO?s._videoSSRC:s._audioSSRC;c&&It.subscribe(this.store.sessionId,{succ:t,ec:r,video:a===_t.VIDEO,audio:a===_t.AUDIO,peerid:s.uid,subscribeRequestid:a===_t.VIDEO?s._videoSSRC:s._audioSSRC,p2pid:this.store.p2pId,eventElapse:zs.measureFromSubscribeStart(this.store.clientId,c)})}reset(){x.debug("[".concat(this.store.clientId,"] P2PChannel2.reset")),this.sendMutex=new js("P2PChannel2-send-mutex",this.store.clientId),this.sendMutex=new js("P2PChannel2-recv-mutex",this.store.clientId),this.sendConnection&&(this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0),this.recvConnection&&(this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const t=this.localTrackMap.get(Ke.LocalAudioTrack);if((t==null?void 0:t.track)instanceof Li){if(t.track.trackList.length>0){const r=t.track;t.track.trackList.forEach(s=>{r.removeAudioTrack(s)})}t.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.reconnectInterval&&(window.clearInterval(this.reconnectInterval),this.reconnectInterval=void 0),this.state=qn.Disconnected}getStats(t){var r,s;return t?(s=this.recvConnection)===null||s===void 0?void 0:s.getStats():(r=this.sendConnection)===null||r===void 0?void 0:r.getStats()}getRemoteVideoIsReady(t){var r;return((r=this.recvConnection)===null||r===void 0?void 0:r.getRemoteVideoIsReady(t))||!1}getLocalAudioVolume(){const t=this.localTrackMap.get(Ke.LocalAudioTrack);if(t)return t.track.getVolumeLevel()}getLocalVideoSize(){const t=this.localTrackMap.get(Ke.LocalVideoTrack);if(t)return{width:t.track.videoWidth||0,height:t.track.videoHeight||0}}getEncoderConfig(t){const r=this.localTrackMap.get(t);return r&&r.track instanceof Sr||r&&r.track instanceof Yr?r.track._encoderConfig:void 0}getLocalMedia(t){return this.localTrackMap.get(t)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(t,r){if(!t)return this.remoteUserMap.size>0;const s=this.remoteUserMap.get(t);return!!s&&(!r||s.has(r))}async hasRemoteMediaWithLock(t,r){if(!t)return this.remoteUserMap.size>0;const s=this.remoteUserMap.get(t);return!!s&&(!r||s.has(r))}getRemoteMedia(t){var r;const s=Array.from(Kc(r=this.remoteUserMap).call(r)).find(a=>a.uid===t);return s?{audioTrack:s.audioTrack,audioSSRC:s._audioSSRC,videoTrack:s.videoTrack,videoSSRC:s._videoSSRC}:{}}getAudioLevels(){let t=Array.from(this.remoteUserMap.entries()).map(s=>{let[a]=s;return{uid:a.uid,level:a.audioTrack?100*a.audioTrack._source.getAccurateVolumeLevel():0}});const r=this.localTrackMap.get(Ke.LocalAudioTrack);return r&&t.push({level:100*r.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),t=uT(t).call(t,(s,a)=>s.level-a.level),t}async disconnectForReconnect(){this.sendConnection&&this.recvConnection&&(x.debug("[".concat(this.store.clientId,"] P2PChannel2.disconnectForReconnect closing P2PConnection")),this.state=qn.Reconnecting,oe("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(t=>{let[r]=t;var s;r._videoTrack&&r._videoTrack._player&&((s=r._videoTrack._player.getVideoElement())===null||s===void 0||s.pause(),r._videoTrack._player.isKeepLastFrame=!0,r._videoTrack._originMediaStreamTrack.stop())}),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0,this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0,this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(t=>{var r;let[s,{track:a}]=t;switch(s){case Ke.LocalVideoTrack:ot(r=a._hints).call(r,hr.LOW_STREAM)?a.close():this.pendingLocalTracks.push(a);break;case Ke.LocalAudioTrack:a instanceof Li?this.pendingLocalTracks=this.pendingLocalTracks.concat(a.trackList):this.pendingLocalTracks.push(a);case Ke.LocalVideoLowTrack:}}),this.emit(xt.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(t=>{let[r,s]=t;Array.from(Kc(s).call(s)).forEach(a=>{this.setPendingRemoteMedia(r,a)}),this.emit(xt.MediaReconnectStart,r.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),x.debug("[".concat(this.store.clientId,"] P2PChannel2 disconnected, waiting to reconnect.")))}hasPendingRemoteMedia(t,r){for(const s of this.pendingRemoteTracks){const{user:a,kind:c}=s;if((t instanceof qm?t.uid:t)===a.uid&&r===c)return!0}return!1}setPendingRemoteMedia(t,r){this.hasPendingRemoteMedia(t,r)||this.pendingRemoteTracks.push({user:t,kind:r})}async restartICE(t,r){let s,a;if(t===Vo.SEND_ONLY){if(!this.sendConnection)throw new Le(te.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established.");s=await this.sendMutex.lock("From P2PChannel.restartICE"),a=this.sendConnection}else{if(!this.recvConnection)throw new Le(te.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before recvConnection established.");s=await this.recvMutex.lock("From P2PChannel.restartICE"),a=this.recvConnection}try{if(r){const c=await a.restartICE(r);return a.isInRestartIce=!1,c}{const c=await a.restartICE();if(c){const u=await ks(this,xt.RequestP2PRestartICE,{direction:Vo.RECEIVE_ONLY,iceParameter:c});await a.restartICE(u),a.isInRestartIce=!1}}}finally{s()}}getUplinkNetworkQuality(){if(!this.sendConnection)return 0;const t=this.sendConnection.getStats(),r=this.localTrackMap.get(Ke.LocalVideoTrack),s=this.localTrackMap.get(Ke.LocalAudioTrack),a=t.videoSend.find(N=>{var G;return N.ssrc===(r==null||(G=r.ssrcs)===null||G===void 0?void 0:G[0].ssrcId)}),c=t.audioSend.find(N=>{var G;return N.ssrc===(s==null||(G=s.ssrcs)===null||G===void 0?void 0:G[0].ssrcId)});if(!a||!c)return 1;const u=Hc(this,xt.NeedSignalRTT),h=a?a.rttMs:void 0,m=c?c.rttMs:void 0,y=h&&m?(h+m)/2:h||m,v=(y&&u?(y+u)/2:y||u)||0,S=100*t.sendPacketLossRate*.7/50+.3*v/1500,R=S<.17?1:S<.36?2:S<.59?3:S<.1?4:5,P=r==null?void 0:r.track;if(P&&P._encoderConfig&&P._hints.indexOf(hr.SCREEN_TRACK)===-1){const N=P._encoderConfig.bitrateMax,G=t.bitrate.actualEncoded;if(N&&G){const F=(1e3*N-G)/(1e3*N);return EH[F<.15?0:F<.3?1:F<.45?2:F<.6?3:4][R]}}return R}getDownlinkNetworkQuality(){if(!this.recvConnection)return 0;const t=this.recvConnection.getStats();let r=0;return Array.from(this.remoteUserMap.entries()).forEach(s=>{let[a]=s;const c=a._audioSSRC,u=a._videoSSRC,h=t.audioRecv.find(G=>G.ssrc===c),m=t.videoRecv.find(G=>G.ssrc===u);if(!h&&!m)return void(r+=1);const y=Hc(this,xt.NeedSignalRTT),v=t.rtt,S=(v&&y?(v+y)/2:v||y)||0,R=h?h.jitterMs:void 0,P=t.recvPacketLossRate;let N=.7*P*100/50+.3*S/1500;R&&(N=.6*P*100/50+.2*S/1500+.2*R/400),r+=N<.1?1:N<.17?2:N<.36?3:N<.59?4:5}),this.remoteUserMap.size>0?Math.round(r/this.remoteUserMap.size):r}async muteLocalTrack(t){return new dt((r,s)=>{this.handleMuteLocalTrack(t,r,s)})}filterTobePublishedTracks(t,r,s){const a=[],c=Vn(),u=this.getAllTracks();t=Fv(t=t.filter(y=>u.indexOf(y)===-1));let h=!1,m=!1;for(const y of t){if(y instanceof Sr&&(this.localTrackMap.has(Ke.LocalVideoTrack)||h?new Le(te.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(a.push({track:y,type:Ke.LocalVideoTrack}),h=!0),r)){const v=this.getLowVideoTrack(y,s);a.push({track:v,type:Ke.LocalVideoLowTrack})}if(y instanceof Yr){const v=this.localTrackMap.get(Ke.LocalAudioTrack);if(v){if(!(v.track instanceof Li))throw new Le(te.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(y._bypassWebAudio)throw new Le(te.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");v.track.addAudioTrack(y),this.bindLocalAudioTrackEvents(y,!0)}else if(m){const S=a.find(R=>{let{type:P}=R;return P===Ke.LocalAudioTrack});if(!(S.track instanceof Li))throw new Le(te.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(y._bypassWebAudio)throw new Le(te.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");S.track.addAudioTrack(y)}else{if(!c.webAudioMediaStreamDest||y instanceof Li||y._bypassWebAudio)a.push({track:y,type:Ke.LocalAudioTrack});else{const S=new Li;S.addAudioTrack(y),a.push({track:S,type:Ke.LocalAudioTrack})}m=!0}}}return a}filterTobeUnpublishedTracks(t){const r=[],s=this.getAllTracks();t=Fv(t=t.filter(a=>s.indexOf(a)!==-1));for(const a of t){if(a instanceof Yr){const c=this.localTrackMap.get(Ke.LocalAudioTrack);if(!c)continue;c.track instanceof Li?(c.track.removeAudioTrack(a),this.unbindLocalAudioTrackEvents(a),c.track.trackList.length===0&&(r.push([Ke.LocalAudioTrack,c]),c.track.close())):r.push([Ke.LocalAudioTrack,c])}if(a instanceof Sr){const c=this.localTrackMap.get(Ke.LocalVideoTrack);if(!c)continue;r.push([Ke.LocalVideoTrack,c]);const u=this.localTrackMap.get(Ke.LocalVideoLowTrack);u&&r.push([Ke.LocalVideoLowTrack,u])}}return r}bindLocalTrackEvents(t){t.forEach(r=>{let{track:s,type:a}=r;switch(a){case Ke.LocalVideoTrack:s.addListener(St.GET_STATS,this.handleGetLocalVideoStats),s.addListener(St.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),s.addListener(St.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),s.addListener(St.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),s.addListener(St.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),s.addListener(St.NEED_REPLACE_TRACK,this.handleReplaceTrack),s.addListener(St.NEED_MUTE_TRACK,this.handleMuteLocalTrack),s.addListener(St.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Ke.LocalAudioTrack:this.bindLocalAudioTrackEvents(s);case Ke.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(t,r){t instanceof Li?t.trackList.forEach(s=>{s.addListener(St.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),s.addListener(St.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),s.addListener(St.GET_STATS,this.handleGetLocalAudioStats),s.addListener(St.NEED_MUTE_TRACK,this.handleMuteLocalTrack),s.addListener(St.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(t.addListener(St.GET_STATS,this.handleGetLocalAudioStats),t.addListener(St.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.addListener(St.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.addListener(St.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.addListener(St.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),r||t.addListener(St.NEED_REPLACE_TRACK,this.handleReplaceTrack))}unbindLocalTrackEvents(t){t||(t=Array.from(this.localTrackMap.entries()).map(r=>{let[s,{track:a}]=r;return{track:a,type:s}})),t.forEach(r=>{let{track:s,type:a}=r;switch(a){case Ke.LocalVideoTrack:s.off(St.GET_STATS,this.handleGetLocalVideoStats),s.off(St.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),s.off(St.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),s.off(St.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),s.off(St.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),s.off(St.NEED_REPLACE_TRACK,this.handleReplaceTrack),s.off(St.NEED_MUTE_TRACK,this.handleMuteLocalTrack),s.off(St.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Ke.LocalAudioTrack:this.unbindLocalAudioTrackEvents(s);case Ke.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(t){t instanceof Li?t.trackList.forEach(r=>{r.off(St.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),r.off(St.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),r.off(St.GET_STATS,this.handleGetLocalAudioStats),r.off(St.NEED_MUTE_TRACK,this.handleMuteLocalTrack),r.off(St.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(t.off(St.GET_STATS,this.handleGetLocalAudioStats),t.off(St.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(St.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(St.NEED_REPLACE_TRACK,this.handleReplaceTrack),t.off(St.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(St.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(t,r){r instanceof Qv&&r.addListener(St.GET_STATS,s=>{s(this.handleGetRemoteVideoStats(t))}),r instanceof Zv&&r.addListener(St.GET_STATS,s=>{s(this.handleGetRemoteAudioStats(t))})}unbindRemoteTrackEvents(t){t&&t.removeAllListeners(St.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(t=>{let[r,s]=t;s.has(_t.AUDIO)&&this.unbindRemoteTrackEvents(r._audioTrack),s.has(_t.VIDEO)&&this.unbindRemoteTrackEvents(r._videoTrack)})}createGatewayPublishMessage(t,r){return t.map((s,a)=>{var c;let u,{track:h,type:m}=s;switch(m){case Ke.LocalAudioTrack:u=Yn.Audio;break;case Ke.LocalVideoTrack:u=ot(c=h._hints).call(c,hr.SCREEN_TRACK)?Yn.Screen:Yn.High;break;case Ke.LocalVideoLowTrack:u=Yn.Low}return{kind:m===Ke.LocalAudioTrack?_t.AUDIO:_t.VIDEO,stream_type:u,mid:r[a].id,ssrcs:r[a].localSSRC,isMuted:h.muted||!h.enabled}})}createGatewayUnpublishMessage(t){return t.map(r=>{var s;let a,[c,{track:u,ssrcs:h,id:m}]=r;switch(c){case Ke.LocalVideoTrack:a=ot(s=u._hints).call(s,hr.SCREEN_TRACK)?Yn.Screen:Yn.High;break;case Ke.LocalAudioTrack:a=Yn.Audio;break;case Ke.LocalVideoLowTrack:a=Yn.Low}return{stream_type:a,ssrcs:h,mid:m}})}assignLocalTracks(t,r){t.forEach((s,a)=>{let{track:c,type:u}=s;this.localTrackMap.set(u,{track:c,id:r[a].id,ssrcs:r[a].localSSRC})})}withdrawLocalTracks(t){t.forEach(r=>{let[s]=r;this.localTrackMap.delete(s)})}bindConnectionEvents(t){t.onConnectionStateChange=async r=>{var s;x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: ").concat(t.name,".onConnectionStateChange(").concat(r,")")),this.emit(xt.PeerConnectionStateChange,r),r!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),r==="connected"&&(t.isInRestartIce=!1),ot(s=this._restartStates).call(s,r)&&!t.isInRestartIce&&(r==="disconnected"&&await ps(800),t.iceConnectionState!=="disconnected"&&t.iceConnectionState!=="failed"||this.handleDisconnect(t.direction))},t.onICEConnectionStateChange=r=>{r!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(r,")")),It.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:r,tag:zr.TRACER}).onSuccess(),this.emit(xt.IceConnectionStateChange,r)},t.onICETransportStateChange=r=>{x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(r,")"))},t.onDTLSTransportStateChange=r=>{x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(r,")"))},t.onDTLSTransportError=r=>{x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(r,")"))},t.onFirstAudioDecoded=r=>{var s;const a=Array.from(Kc(s=this.remoteUserMap).call(s)).find(u=>u._audioSSRC===r);var c;a&&(this.store.subscribe(a.uid,"audio",void 0,void 0,void 0,Date.now()),(c=a.audioTrack)===null||c===void 0||c.emit(Kv.FIRST_FRAME_DECODED),It.firstRemoteFrame(this.store.sessionId,Xi.FIRST_AUDIO_DECODE,Nr.FIRST_AUDIO_DECODE,{peer:a._uintid,subscribeElapse:zs.measureFromSubscribeStart(this.store.clientId,r),subscribeRequestid:r,p2pid:this.store.p2pId}))},t.onFirstAudioReceived=r=>{var s;const a=Array.from(Kc(s=this.remoteUserMap).call(s)).find(c=>c._audioSSRC===r);a&&It.firstRemoteFrame(this.store.sessionId,Xi.FIRST_AUDIO_RECEIVED,Nr.FIRST_AUDIO_RECEIVED,{peer:a._uintid,subscribeElapse:zs.measureFromSubscribeStart(this.store.clientId,r),subscribeRequestid:r,p2pid:this.store.p2pId})},t.onFirstVideoDecoded=(r,s,a)=>{this.reportVideoFirstFrameDecoded(r,s,a)},t.onFirstVideoReceived=r=>{var s;const a=Array.from(Kc(s=this.remoteUserMap).call(s)).find(c=>c._videoSSRC===r);a&&It.firstRemoteFrame(this.store.sessionId,Xi.FIRST_VIDEO_RECEIVED,Nr.FIRST_VIDEO_RECEIVED,{peer:a._uintid,subscribeElapse:zs.measureFromSubscribeStart(this.store.clientId,r),subscribeRequestid:r,p2pid:this.store.p2pId})},t.onSelectedLocalCandidateChanged=(r,s)=>{const a=r.candidateType==="relay",c=s.candidateType==="relay";s.candidateType!=="unknown"&&a===c||this.emit(xt.ConnectionTypeChange,a),x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(Hm(s))," -> ").concat(JSON.stringify(Hm(r)),")"))},t.onSelectedRemoteCandidateChanged=(r,s)=>{x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(Hm(s))," -> ").concat(JSON.stringify(Hm(r)),")"))},t.onFirstVideoDecodedTimeout=r=>{this.reportVideoFirstFrameDecoded(r,void 0,void 0,!0)},t.onLocalCandidate=r=>{this.emit(xt.LocalCandidate,{candidate:r,direction:t.direction})}}unbindConnectionEvents(t){t.onConnectionStateChange=void 0,t.onICEConnectionStateChange=void 0,t.onICETransportStateChange=void 0,t.onDTLSTransportStateChange=void 0,t.onDTLSTransportError=void 0,t.onFirstAudioDecoded=void 0,t.onFirstAudioReceived=void 0,t.onFirstVideoDecoded=void 0,t.onFirstVideoReceived=void 0,t.onSelectedLocalCandidateChanged=void 0,t.onSelectedRemoteCandidateChanged=void 0,t.onFirstVideoDecodedTimeout=void 0,t.onLocalCandidate=void 0}async handleDisconnect(t){const r=t===Vo.SEND_ONLY?this.sendConnection:this.recvConnection;r&&!r.isInRestartIce&&(r.isInRestartIce=!0,x.debug("[".concat(this.store.clientId,"] [P2PChannel-").concat(r.name,"] start use restartICE")),t===Vo.SEND_ONLY?this.restartICE(t):ks(this,xt.RequestP2PRestartICE,{direction:Vo.SEND_ONLY}))}filterTobeMutedTracks(t){const r=[];if(this.getAllTracks().indexOf(t)===-1)return r;const s=this.localTrackMap.get(Ke.LocalAudioTrack);if(t instanceof Yr&&(s==null?void 0:s.track)instanceof Li)return s.track.isActive||r.push([Ke.LocalAudioTrack,s]),r;const a=Array.from(this.localTrackMap.entries()).find(c=>{let[,{track:u}]=c;return t===u});if(a&&(r.push(a),a[0]===Ke.LocalVideoTrack)){const c=this.localTrackMap.get(Ke.LocalVideoLowTrack);c&&r.push([Ke.LocalVideoLowTrack,c])}return r}filterTobeUnmutedTracks(t){const r=[],s=this.localTrackMap.get(Ke.LocalAudioTrack);if(t instanceof Yr&&(s==null?void 0:s.track)instanceof Li)return s.track.isActive&&r.push([Ke.LocalAudioTrack,s]),r;const a=Array.from(this.localTrackMap.entries()).find(c=>{let[,{track:u}]=c;return t===u});if(a)if(a[0]===Ke.LocalVideoTrack){r.push(a);const c=this.localTrackMap.get(Ke.LocalVideoLowTrack);c&&r.push([Ke.LocalVideoLowTrack,c])}else r.push(a);return r}createMuteMessage(t){return t.map(r=>{var s;let a,[c,{track:u,ssrcs:h,id:m}]=r;switch(c){case Ke.LocalAudioTrack:a=Yn.Audio;break;case Ke.LocalVideoTrack:a=ot(s=u._hints).call(s,hr.SCREEN_TRACK)?Yn.Screen:Yn.High;break;case Ke.LocalVideoLowTrack:a=Yn.Low}return{stream_type:a,ssrcs:h,mid:m}})}createUnmuteMessage(t){return t.map(r=>{var s;let a,[c,{track:u,ssrcs:h,id:m}]=r;switch(c){case Ke.LocalAudioTrack:a=Yn.Audio;break;case Ke.LocalVideoTrack:a=ot(s=u._hints).call(s,hr.SCREEN_TRACK)?Yn.Screen:Yn.High;break;case Ke.LocalVideoLowTrack:a=Yn.Low}return{stream_type:a,ssrcs:h,mid:m}})}filterTobeUnSubscribedTracks(t,r){const s=[],a=this.remoteUserMap.get(t);if(!a)return s;if(r){const c=a.get(r);if(!c)return s;s.push([t,{kind:r,id:c}])}else Array.from(a.entries()).forEach(c=>{let[u,h]=c;s.push([t,{kind:u,id:h}])});return s}createUnsubscribeMessage(t){const r=[];return t.forEach(s=>{let[a,{kind:c,id:u}]=s;switch(c){case _t.VIDEO:return void(a._videoSSRC&&r.push({stream_type:_t.VIDEO,ssrcId:a._videoSSRC}));case _t.AUDIO:return void(a._audioSSRC&&r.push({stream_type:_t.AUDIO,ssrcId:a._audioSSRC}))}}),r}withdrawRemoteTracks(t){t.forEach(r=>{let[s,{kind:a}]=r;const c=this.remoteUserMap.get(s);c&&(c.delete(a),Array.from(c.entries()).length===0&&this.remoteUserMap.delete(s))})}async updateBitrateLimit(t){const r=this.localTrackMap.get(Ke.LocalVideoTrack),s=this.localTrackMap.get(Ke.LocalVideoLowTrack);r&&(await r.track.setBitrateLimit(t.uplink),await new dt((a,c)=>{this.handleUpdateVideoEncoder(r.track,a,c,!0)})),s&&t.low_stream_uplink&&(await s.track.setBitrateLimit({max_bitrate:t.low_stream_uplink.bitrate,min_bitrate:t.low_stream_uplink.bitrate||0}),await new dt((a,c)=>{this.handleUpdateVideoEncoder(s.track,a,c,!0)}))}isP2PDisconnected(){if(this.sendConnection&&this.recvConnection){const t=this.sendConnection.peerConnectionState,r=this.recvConnection.peerConnectionState;return t!=="connected"&&r!=="connected"}return!0}async tryToUnmuteAudio(t){for(let r=0;r<t.length;r++)if(t[r]instanceof Yr){const s=this.filterTobeUnmutedTracks(t[r]);if(s.length===0)continue;const a=this.createUnmuteMessage(s);return void await ur(this,xt.RequestUnmuteLocal,a)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=t=>this.getStats(t),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()).filter(t=>{let[,{ssrcs:r}]=t;return!!r}),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=t=>{var r;return!((r=this.recvConnection)===null||r===void 0||!r.getRemoteVideoIsReady(t))},this.statsUploader.requestUpload=(t,r)=>this.emit(xt.RequestUpload,t,r),this.statsUploader.requestUploadStats=t=>this.emit(xt.RequestUploadStats,t),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await ps(vL(this.dtlsFailedCount,Pi)),this.emit(xt.RequestReconnect)}async reconnectP2P(){}canPublishLowStream(){return this.localTrackMap.has(Ke.LocalVideoTrack)||this.pendingLocalTracks.some(t=>t instanceof Sr)}throwIfTrackTypeNotMatch(t){if(t.filter(r=>r instanceof Sr).length>1)throw new Le(te.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t.filter(r=>r instanceof Yr).length>1&&(t.some(r=>r instanceof Yr&&r._bypassWebAudio)||!Vn().webAudioMediaStreamDest))throw new Le(te.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const r of t){if(r instanceof Sr&&this.pendingLocalTracks.some(s=>s instanceof Sr))throw new Le(te.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(r instanceof Yr&&this.pendingLocalTracks.some(s=>s instanceof Yr)&&(!Vn().webAudioMediaStreamDest||r._bypassWebAudio||this.pendingLocalTracks.some(s=>s instanceof Yr&&s._bypassWebAudio)))throw new Le(te.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(t,r){const s=!oe("DISABLE_DUAL_STREAM_USE_ENCODING")&&Vn().supportDualStreamEncoding,a=uO(uO({},{width:160,height:120,framerate:15,bitrate:50}),r);let c;c=s?t._mediaStreamTrack.clone():P2(t,a);const u=dr(8,"track-low-"),h=new Sr(c,uO(uO({},s&&{scaleResolutionDownBy:d2(a,t)}),{},{frameRate:a.framerate,bitrateMax:a.bitrate,bitrateMin:a.bitrate}),void 0,void 0,u);return h.on(W_.TRANSCEIVER_UPDATED,m=>{t._updateRtpTransceiver(m,Hv.LOW_STREAM)}),h._hints.push(hr.LOW_STREAM),t.addListener(St.NEED_CLOSE,()=>{h.close()}),h}async globalLock(){return this.recvMutex.lock("From P2PChannel2.globalLock")}reportVideoFirstFrameDecoded(t,r,s,a){var c;const u=Array.from(Kc(c=this.remoteUserMap).call(c)).find(h=>h._videoSSRC===t);if(u){a||this.store.subscribe(u.uid,"video",void 0,void 0,void 0,void 0,Date.now());const h=this.store.keyMetrics,m=h.subscribe.find(y=>y.userId===u.uid&&y.type==="video");It.firstRemoteVideoDecode(this.store.sessionId,Xi.FIRST_VIDEO_DECODE,Nr.FIRST_VIDEO_DECODE,{peer:u._uintid,videowidth:r,videoheight:s,subscribeElapse:zs.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId,apEnd:h.requestAPEnd||0,apStart:h.requestAPStart||0,joinGwEnd:h.joinGatewayEnd||0,joinGwStart:h.joinGatewayStart||0,pcEnd:h.peerConnectionEnd||0,pcStart:h.peerConnectionStart||0,subscriberEnd:(m==null?void 0:m.subscribeEnd)||0,subscriberStart:(m==null?void 0:m.subscribeStart)||0,videoAddNotify:(m==null?void 0:m.streamAdded)||0,state:a?1:0})}}async remoteMediaSsrcChanged(t,r,s){if(!this.recvConnection)return!1;const a=this.remoteUserMap.get(t);if(!a)return!1;const c=a.get(r);if(!c)return!1;const u=await this.recvConnection.getRemoteSSRC(c);return u!==void 0&&u!==s}isPreSubScribe(t){return!1}async publishDataChannel(t){throw new Le(te.NOT_SUPPORTED)}async unpublishDataChannel(t){throw new Le(te.NOT_SUPPORTED)}async subscribeDataChannel(t,r){throw new Le(te.NOT_SUPPORTED)}async unsubscribeDataChannel(t,r){throw new Le(te.NOT_SUPPORTED)}hasPendingRemoteDataChannel(t,r){throw new Le(te.NOT_SUPPORTED)}setPendingRemoteDataChannel(t,r){throw new Le(te.NOT_SUPPORTED)}async preConnect(t){throw new Le(te.NOT_SUPPORTED)}getEstablishParams(){throw new Le(te.NOT_SUPPORTED)}async reSubscribe(t){throw new Le(te.NOT_SUPPORTED)}async updateVideoStreamParameter(t,r){throw new Le(te.NOT_SUPPORTED)}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(t=>{let[r,{track:s}]=t;r===Ke.LocalVideoLowTrack?s._updateRtpTransceiver(void 0,Hv.LOW_STREAM):s._updateRtpTransceiver(void 0)})}},Tt(xr.prototype,"p2pConnect",[oK],Object.getOwnPropertyDescriptor(xr.prototype,"p2pConnect"),xr.prototype),Tt(xr.prototype,"unpublish",[aK],Object.getOwnPropertyDescriptor(xr.prototype,"unpublish"),xr.prototype),Tt(xr.prototype,"unpublishLowStream",[cK],Object.getOwnPropertyDescriptor(xr.prototype,"unpublishLowStream"),xr.prototype),Tt(xr.prototype,"subscribe",[lK],Object.getOwnPropertyDescriptor(xr.prototype,"subscribe"),xr.prototype),Tt(xr.prototype,"mockSubscribe",[uK],Object.getOwnPropertyDescriptor(xr.prototype,"mockSubscribe"),xr.prototype),Tt(xr.prototype,"unsubscribe",[dK],Object.getOwnPropertyDescriptor(xr.prototype,"unsubscribe"),xr.prototype),Tt(xr.prototype,"muteRemote",[hK],Object.getOwnPropertyDescriptor(xr.prototype,"muteRemote"),xr.prototype),Tt(xr.prototype,"unmuteRemote",[fK],Object.getOwnPropertyDescriptor(xr.prototype,"unmuteRemote"),xr.prototype),Tt(xr.prototype,"hasRemoteMediaWithLock",[pK],Object.getOwnPropertyDescriptor(xr.prototype,"hasRemoteMediaWithLock"),xr.prototype),Tt(xr.prototype,"disconnectForReconnect",[mK],Object.getOwnPropertyDescriptor(xr.prototype,"disconnectForReconnect"),xr.prototype),Tt(xr.prototype,"remoteMediaSsrcChanged",[gK],Object.getOwnPropertyDescriptor(xr.prototype,"remoteMediaSsrcChanged"),xr.prototype),xr);function Cd(t){return function(r,s,a){const c=r[s];if(typeof c!="function")throw new Error("Cannot use mutex on object property.");return a.value=async function(){for(var u=arguments.length,h=new Array(u),m=0;m<u;m++)h[m]=arguments[m];switch(t){case wd.SEND_ONLY:{const y=await this.sendMutex.lock("From P2PChannel2.".concat(s));try{return await c.apply(this,h)}finally{y()}}case wd.RECEIVE_ONLY:{const y=await this.recvMutex.lock("From P2PChannel2.".concat(s));try{return await c.apply(this,h)}finally{y()}}default:{const y=await this.sendMutex.lock("From P2PChannel2.".concat(s)),v=await this.recvMutex.lock("From P2PChannel2.".concat(s));try{return await c.apply(this,h)}finally{y(),v()}}}},a}}class ly extends Ur{constructor(r,s){super(),K(this,"signal",void 0),K(this,"token",void 0),K(this,"tokenTimeout",void 0),K(this,"tokenInterval",void 0),K(this,"_sequence",0),K(this,"userMap",new Map),K(this,"encoder",new TextEncoder),this.signal=r,this.token=s;const a=()=>{this.signal.connectionState===pr.CONNECTED&&this.check(),this.userMap.size===0?this.tokenInterval=window.setTimeout(a,1e3):this.tokenInterval=window.setTimeout(a,3*oe("P2P_TOKEN_INTERVAL"))};a()}async send(r,s,a,c,u){var h,m,y;if(this.userMap.size===0)return;const v=Array.from(zc(h=this.userMap).call(h))[0].token;typeof s!="string"&&(s=JSON.stringify(s)),c=(m=c)!==null&&m!==void 0?m:dr(6,""),u=(y=u)!==null&&y!==void 0?y:this._sequence++;const S={_id:c,_type:r,_seq:u,_message:s,token:"".concat(this.token,"_").concat(v)};oe("SHOW_P2P_LOG")&&x.debug("send message",S,"noNeedResponse : ".concat(a)),this.splitMessage(JSON.stringify(S)).forEach(P=>{this.signal.request(zt.DATA_STREAM,{payload:jm(this.encoder.encode(P))})});const R=new dt((P,N)=>{const G=window.setTimeout(()=>{this.off("res-@".concat(c,"_ack"),F),this.off("res-@".concat(c),X),this.off(iS.ABORT,j),x.debug("[external-signal] request timeout, type: ".concat(r,", requestId: ").concat(c)),this.userMap.size===0?N(new Le(te.INVALID_REMOTE_USER)):N(new Le(te.TIMEOUT))},oe("EXTERNAL_SIGNAL_REQUEST_TIMEOUT")),F=()=>{G&&window.clearTimeout(G),this.off(iS.ABORT,j),a&&P()},j=()=>{G&&window.clearTimeout(G),this.off("res-@".concat(c,"_ack"),F),this.off("res-@".concat(c),X),N(new Le(te.EXTERNAL_SIGNAL_ABORT,"type: ".concat(r,", requestId: ").concat(c)))};this.once(iS.ABORT,j),this.once("res-@".concat(c,"_ack"),F);const X=(he,Se)=>{ee=!0,G&&window.clearTimeout(G),this.off("res-@".concat(c,"_ack"),F),this.off(iS.ABORT,j),he==="success"?P(Se):N(new Le(te.P2P_MESSAGE_FAILED,"request ".concat(r," failed, requestId: ").concat(c)))};let ee=!1;a||(this.once("res-@".concat(c),X),ps(oe("SIGNAL_REQUEST_TIMEOUT")).then(()=>{ee||x.warning("external_signal request timeout, type: ".concat(r,", requestId: ").concat(c,", ").concat(S))}))});try{return await R}catch(P){if(P.code===te.TIMEOUT)return await this.send(r,s,a,c,u);throw P}}onMessage(r){var s;const{_uid:a}=r;let c,u=this.userMap.get(a);if(u)c=u.splitMessageMap;else{if(this.userMap.size>0||!("_type"in r)||r._type!==li.CHECK)return;const{token:v}=r;c=new Map,u={uid:a,isStart:!0,token:v,splitMessageMap:c,nextExpectedSequenceNumber:0,receivedMessagesMap:new Map},this.userMap.set(a,u),this.signal.emit(vn.ON_USER_ONLINE,{uid:a}),this.handleUserOnline()}if("id"in r&&"total"in r){var h;const{id:v,total:S}=r,R=(h=c.get(v))!==null&&h!==void 0?h:[];if(R.push(r),c.has(v)||c.set(v,R),R.length!==S)return;{const P=uT(R).call(R,(N,G)=>N.index-G.index).map(N=>N.payload).join("");c.delete(v),(r=JSON.parse(P))._uid=a}}const{_type:m,token:y}=r;if(ot(s=[li.ACK,li.CHECK]).call(s,m))return m===li.CHECK&&this.handleCheckToken(u,y),void this.receiveMessage(r);y==="".concat(u.token,"_").concat(this.token)?this.handleReceivedMessage(r):x.debug('Receive unexpected message", '.concat(y,", cur_token: ").concat(u.token,"_").concat(this.token),r)}check(){const r={_id:dr(6,""),token:this.token,_type:li.CHECK};oe("SHOW_P2P_LOG")&&x.debug("send message",r),this.signal.request(zt.DATA_STREAM,{payload:jm(this.encoder.encode(JSON.stringify(r)))})}ack(r){const s={_id:r,_type:li.ACK,token:this.token};oe("SHOW_P2P_LOG")&&x.debug("send message",s),this.signal.request(zt.DATA_STREAM,{payload:jm(this.encoder.encode(JSON.stringify(s)))})}response(r,s,a){this.send(li.RESPONSE,JSON.stringify({success:!a,message:s}),!0,r)}handleReceivedMessage(r){const s=()=>{this.userMap.forEach(v=>{const{receivedMessagesMap:S,nextExpectedSequenceNumber:R}=v;for(;S.has(R);){const P=S.get(R);S.delete(R),this.receiveMessage(P),v.nextExpectedSequenceNumber++}})};if(!r)return void s();const{_uid:a,_seq:c}=r,u=this.userMap.get(a),{receivedMessagesMap:h,isStart:m,nextExpectedSequenceNumber:y}=u;if(c<y)return this.ack(r._id),void x.debug("[external-signal] receive old message, seq: ".concat(c,", ").concat(r._message));h.set(c,r),m&&c===y&&(this.receiveMessage(r),h.delete(y),u.nextExpectedSequenceNumber++,s())}receiveMessage(r){const{_id:s,_type:a,_message:c,_uid:u}=r;if(oe("SHOW_P2P_LOG")&&x.debug("receive message",r),s){let h;switch(r._type!==li.ACK&&(c&&(h=JSON.parse(c)),this.ack(r._id)),r._type){case li.CANDIDATE:case li.CONTROL:this.signal.emit(a,h,u);break;case li.PUBLISH:case li.UNPUBLISH:case li.RESTART_ICE:case li.CALL:h.uid=u,ks(this.signal,a,h).then(m=>{this.response(r._id,m)}).catch(()=>{this.response(r._id,void 0,!0)});break;case li.ACK:this.getListeners("res-@".concat(s,"_ack")).length>0&&this.emit("res-@".concat(s,"_ack"));break;case li.RESPONSE:{const{success:m,message:y}=h;this.emit("res-@".concat(s),m?"success":"failed",y);break}}}}splitMessage(r){if(r.length<ly.MAX_MESSAGE_SIZE)return[r];const s=[],{remoteToken:a}=JSON.parse(r),c=dr(6,"");let u=0,h=800;const m=Math.ceil(r.length/h);for(;r.length>0;){u++;const y={id:c,index:u,total:m,payload:r.slice(0,h),token:"".concat(this.token,"_").concat(a)};JSON.stringify(y).length>ly.MAX_MESSAGE_SIZE?h-=50:(s.push(y),r=r.slice(h))}return s.map(y=>JSON.stringify(y))}handleCheckToken(r,s){return r.token!==s?(x.debug("token changed, from ".concat(r.token," to ").concat(s)),this.reset(r.uid,s),!1):(this.tokenTimeout&&(window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0),this.tokenTimeout=window.setTimeout(()=>{x.debug("token timeout, ".concat(s)),this.reset(r.uid)},oe("MAX_P2P_TIMEOUT")),!0)}async handleUserOnline(){const r=await ks(this.signal,li.CALL,void 0),s=await this.send(li.CALL,r);this.signal.emit($t.P2P_CONNECTION,s,!0)}async reset(r,s){const a=this.userMap.get(r);a&&(this.emit(iS.ABORT),this.signal.emit(vn.ON_USER_OFFLINE,{uid:a.uid,reason:fge.P2P_TOKEN_CHANGED}),this._sequence=0,this.userMap.clear(),s||(x.debug("change local token from ".concat(s," to ").concat(s)),this.token=dr(6,"")))}clear(){this._sequence=0,this.userMap.clear(),this.tokenInterval&&window.clearTimeout(this.tokenInterval),this.tokenInterval=void 0,this.tokenTimeout&&window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0,this.emit(iS.ABORT)}}K(ly,"MAX_SIZE",1),K(ly,"MAX_MESSAGE_SIZE",1024);class Yye extends Ur{get connectionState(){return this._connectionState}set connectionState(r){r!==this._connectionState&&(this._connectionState=r,r===pr.CONNECTED?this.emit($t.WS_CONNECTED):r===pr.RECONNECTING?this.emit($t.WS_RECONNECTING,this._websocketReconnectReason):r===pr.CLOSED&&this.emit($t.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(r,s){super(),K(this,"_disconnectedReason",void 0),K(this,"_websocketReconnectReason",void 0),K(this,"_connectionState",pr.CLOSED),K(this,"reconnectToken",void 0),K(this,"p2pToken",void 0),K(this,"websocket",void 0),K(this,"openConnectionTime",void 0),K(this,"clientId",void 0),K(this,"lastMsgTime",Date.now()),K(this,"uploadCache",[]),K(this,"uploadCacheInterval",void 0),K(this,"rttRolling",new K8(5)),K(this,"pingpongTimer",void 0),K(this,"pingpongTimeoutCount",0),K(this,"joinResponse",void 0),K(this,"multiIpOption",void 0),K(this,"initError",void 0),K(this,"spec",void 0),K(this,"store",void 0),K(this,"_external_signal",void 0),K(this,"onWebsocketMessage",a=>{if(a.data instanceof ArrayBuffer)return void this.emit($t.ON_BINARY_DATA,a.data);const c=JSON.parse(a.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(c,"_id")){const u="res-@".concat(c._id);this.emit(u,c._result,c._message)}else if(Object.prototype.hasOwnProperty.call(c,"_type")){switch(c._type){case vn.ON_DATA_STREAM:return void this.handleDataStream(c._message);case vn.MUTE_AUDIO:case vn.MUTE_VIDEO:case vn.ON_P2P_LOST:case vn.ON_USER_ONLINE:return;case vn.ON_USER_OFFLINE:const{uid:u}=c._message;return x.debug("[".concat(this.clientId,"] user-offline uid: ").concat(u)),void this._external_signal.reset(u)}if(this.emit(c._type,c._message),c._type===vn.ON_NOTIFICATION&&this.handleNotification(c._message),c._type===vn.ON_USER_BANNED)switch(c._message.error_code){case 14:this.close(Kn.UID_BANNED);break;case 15:this.close(Kn.IP_BANNED);break;case 16:this.close(Kn.CHANNEL_BANNED)}if(c._type===vn.ON_USER_LICENSE_BANNED)switch(c._message.error_code){case Ut.ERR_LICENSE_MISSING:this.close(Kn.LICENSE_MISSING);break;case Ut.ERR_LICENSE_EXPIRED:this.close(Kn.LICENSE_EXPIRED);break;case Ut.ERR_LICENSE_MINUTES_EXCEEDED:this.close(Kn.LICENSE_MINUTES_EXCEEDED);break;case Ut.ERR_LICENSE_PERIOD_INVALID:this.close(Kn.LICENSE_PERIOD_INVALID);break;case Ut.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(Kn.LICENSE_MULTIPLE_SDK_SERVICE);break;case Ut.ERR_LICENSE_ILLEGAL:this.close(Kn.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=r.clientId,this.spec=r,this.store=s,this.websocket=new l2("gateway-".concat(this.clientId),this.spec.retryConfig,!0,oe("JOIN_GATEWAY_USE_DUAL_DOMAIN"),oe("JOIN_GATEWAY_USE_443PORT_ONLY"),s),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===pr.CONNECTED&&this.reconnect("retry",Os.OFFLINE)}),this.p2pToken=dr(6,""),this._external_signal=new ly(this,this.p2pToken)}async request(r,s,a,c){const u=dr(6,""),h={_id:u,_type:r,_message:s},m=this.websocket.connectionID,y=()=>new dt((G,F)=>{if(this.connectionState===pr.CONNECTED)return G();const j=()=>{this.off($t.WS_CLOSED,X),G()},X=()=>{this.off($t.WS_CONNECTED,j),F(new Le(te.WS_ABORT))};this.once($t.WS_CONNECTED,j),this.once($t.WS_CLOSED,X)});if(this.connectionState!==pr.CONNECTING&&this.connectionState!==pr.RECONNECTING||r===zt.JOIN||r===zt.REJOIN||await y(),this.websocket.sendMessage(h,!0),c)return;const v=new dt((G,F)=>{let j=!1;const X=(he,Se)=>{j=!0,G({isSuccess:he==="success",message:Se||{}}),this.off($t.WS_CLOSED,ee),this.off($t.WS_RECONNECTING,ee),this.emit($t.REQUEST_SUCCESS,r,s)};this.once("res-@".concat(u),X);const ee=()=>{F(new Le(te.WS_ABORT,"type: ".concat(r))),this.off($t.WS_CLOSED,ee),this.off($t.WS_RECONNECTING,ee),this.off("res-@".concat(u),X)};this.once($t.WS_CLOSED,ee),this.once($t.WS_RECONNECTING,ee),ps(oe("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==m||j||(x.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(r)),this.emit($t.REQUEST_TIMEOUT,r,s))})});let S=null;try{S=await v}catch(G){if(this.connectionState===pr.CLOSED||r===zt.LEAVE)throw new Le(te.WS_ABORT);return!this.spec.forceWaitGatewayResponse||a?G.throw():r===zt.JOIN||r===zt.REJOIN?null:(await y(),await this.request(r,s))}if(S.isSuccess)return S.message;const R=Number(S.message.error_code||S.message.code),P=MT(R),N=new Le(te.UNEXPECTED_RESPONSE,"".concat(P.desc,": ").concat(S.message.error_str),{code:R,data:S.message,desc:P.desc});return P.action==="success"?S.message:(x.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(r,", error_code: ").concat(R,", message: ").concat(P.desc,", action: ").concat(P.action)),R===Ut.ERR_TOO_MANY_BROADCASTERS?((r===zt.JOIN||r===zt.REJOIN)&&(this.initError=N,this.close()),N.throw()):P.action==="failed"?N.throw():P.action==="quit"?(this.initError=N,this.close(),N.throw()):(R===Ut.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=S.message.option,x.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",Os.MULTI_IP)):this.reconnect(P.action,Os.SERVER_ERROR),r===zt.JOIN||r===zt.REJOIN?null:await this.request(r,s)))}waitMessage(r,s){return new dt(a=>{const c=u=>{(!s||s(u))&&(this.off(r,c),a(u))};this.on(r,c)})}uploadWRTCStats(r){if(!this.store.sessionId)return void x.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const s={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:r};this.upload(xT.WRTC_STATS,s)}upload(r,s){const a={_type:r,_message:s};try{this.websocket.sendMessage(a)}catch{const u=oe("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(a),this.uploadCache.length>u&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==pr.CONNECTED)return;const h=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(h._type,h._message)},oe("UPLOAD_CACHE_INTERVAL")||2e3))}}send(r,s){const a={_type:r,_message:s};this.websocket.sendMessage(a)}async sendExtensionMessage(r,s,a){return await this._external_signal.send(r,s,a)}init(r){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new dt((s,a)=>{this.once($t.WS_CONNECTED,()=>s(this.joinResponse)),this.once($t.WS_CLOSED,()=>a(this.initError||new Le(te.WS_ABORT))),this.connectionState=pr.CONNECTING,this.websocket.init(r).catch(a)})}close(r){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._external_signal.clear(),this._disconnectedReason=r||Kn.LEAVE,this.connectionState=pr.CLOSED,x.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close(),this.p2pToken=dr(6,""),this._external_signal.clear(),this._external_signal=new ly(this,this.p2pToken)}async join(){if(!this.joinResponse){this.emit($t.ABORT_P2P_EXECUTION);const r=await ks(this,$t.REQUEST_JOIN_INFO),s=await this.request(zt.JOIN,r);if(!s)return this.emit($t.REPORT_JOIN_GATEWAY,te.TIMEOUT,this.url||""),!1;this.joinResponse=s,this.emit($t.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=pr.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}reconnect(r,s){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(r,s)}handleDataStream(r){try{var s;const a=F_(r.payload),c=new TextDecoder().decode(a),u=JSON.parse(c);"total"in u&&"id"in u||ot(s=Object.values(li)).call(s,u._type)?(u._uid=r.uid,this._external_signal.onMessage(u)):this.emit(vn.ON_DATA_STREAM,r)}catch{this.emit(vn.ON_DATA_STREAM,r)}}handleNotification(r){x.debug("[".concat(this.clientId,"] receive notification: "),r);const s=MT(r.code);if(s.action!=="success"){if(s.action!=="failed")return s.action==="quit"?(s.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(Kn.UID_BANNED),void this.close()):void this.reconnect(s.action,Os.SERVER_ERROR);x.error("[".concat(this.clientId,"] ignore error: "),s.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const r=oe("PING_PONG_TIME_OUT"),s=Date.now();this.pingpongTimeoutCount>=r&&(x.warning("[".concat(this.clientId,"] PINGPONG Timeout. Last Socket Message: ").concat(s-this.lastMsgTime,"ms")),s-this.lastMsgTime>oe("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",Os.TIMEOUT):this.request(zt.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const a=Date.now()-s;this.rttRolling.add(a),oe("REPORT_STATS")&&this.send(zt.PING_BACK,{pingpongElapse:a})}).catch(a=>{})}handleWebsocketEvents(){this.websocket.on(en.RECONNECT_CREATE_CONNECTION,r=>{this.emit($t.WS_RECONNECT_CREATE_CONNECTION,r)}),this.websocket.on(en.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(en.CLOSED,()=>{this.connectionState=pr.CLOSED}),this.websocket.on(en.FAILED,()=>{this._disconnectedReason=Kn.NETWORK_ERROR,this.connectionState=pr.CLOSED}),this.websocket.on(en.RECONNECTING,r=>{this._websocketReconnectReason=r,this.joinResponse=void 0,this.connectionState===pr.CONNECTED?this.connectionState=pr.RECONNECTING:this.connectionState=pr.CONNECTING}),this.websocket.on(en.WILL_RECONNECT,(r,s,a)=>{r!=="retry"?(x.debug("".concat(this.clientId," websocket will_connect event, renewSession reconnectMode is ").concat(r)),this.reconnectToken=void 0):x.debug("".concat(this.clientId," reconnect mode is retry, no need to renew session")),a(r)}),this.websocket.on(en.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.join().catch(r=>{if(this.emit($t.REPORT_JOIN_GATEWAY,r,this.url||""),r instanceof Le&&r.code===te.UNEXPECTED_RESPONSE&&r.data.code===Ut.ERR_NO_AUTHORIZED)return x.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",Os.SERVER_ERROR);x.error("[".concat(this.clientId,"] join gateway request failed"),r.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",Os.SERVER_ERROR):(this.initError=r,this.close())})}),this.websocket.on(en.REQUEST_NEW_URLS,(r,s)=>{ks(this,$t.REQUEST_RECOVER,this.multiIpOption).then(r).catch(s)}),this.websocket.on(en.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(vn.ON_TOKEN_PRIVILEGE_DID_EXPIRE)})}}const Xye={name:"P2PChannel",create:function(t){let{store:r,statsCollector:s}=t;return new qye(r,s)},createSubmodule:function(t){let{store:r,spec:s}=t;return new Yye(s,r)}};function yK(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}function EK(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?yK(Object(s),!0).forEach(function(a){K(t,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):yK(Object(s)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))})}return t}class Jye{constructor(r){K(this,"sessionDesc",void 0),K(this,"localCapabilities",void 0),K(this,"rtpCapabilities",void 0),K(this,"candidates",void 0),K(this,"_originCandidates",void 0),K(this,"iceParameters",void 0),K(this,"dtlsParameters",void 0),K(this,"setup",void 0),K(this,"currentMidIndex",void 0),K(this,"cname",void 0),r=Gr(r);const{iceParameters:s,dtlsParameters:a,candidates:c,rtpCapabilities:u,setup:h,localCapabilities:m,sdkCodec:y,cname:v}=r,S=Ba(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE audio video
a=msid-semantic: WMS
a=ice-lite
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:audio
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:video
`);this.rtpCapabilities=u,this.candidates=c,this._originCandidates=Gr(c),this.iceParameters=s,this.dtlsParameters=a,this.setup=h,this.localCapabilities=m,this.cname=v;for(let R=0;R<S.mediaDescriptions.length;R++){const P=S.mediaDescriptions[R];if(P.attributes.iceUfrag=s.iceUfrag,P.attributes.icePwd=s.icePwd,P.attributes.fingerprints=a.fingerprints,P.attributes.candidates=c,P.attributes.setup=h,P.media.mediaType==="video"){P.media.fmts=u.videoCodecs.map(G=>G.payloadType.toString(10));let N=u.videoCodecs.filter(G=>{var F,j;return(F=G.rtpMap)===null||F===void 0?void 0:ot(j=F.encodingName.toLowerCase()).call(j,y)});N.length===0&&(N=u.videoCodecs),P.attributes.payloads=N,P.attributes.extmaps=u.videoExtensions}P.media.mediaType==="audio"&&(P.media.fmts=u.audioCodecs.map(N=>N.payloadType.toString(10)),P.attributes.payloads=u.audioCodecs,P.attributes.extmaps=u.audioExtensions),S.mediaDescriptions[R]=this.mungMediaDesc(P)}this.sessionDesc=S,this.currentMidIndex=S.mediaDescriptions.length-1}toString(){return Bm(this.sessionDesc)}send(r,s,a){const{ssrcs:c,ssrcGroups:u}=Y_(s,this.cname),h=this.sessionDesc.mediaDescriptions.find(v=>r===_t.VIDEO?v.media.mediaType==="video":v.media.mediaType==="audio"),m=c[0].attributes.label,y=c[0].attributes.mslabel;return h.attributes.ssrcs=h.attributes.ssrcs.concat(c),h.attributes.ssrcGroups=h.attributes.ssrcGroups.concat(u),{id:m,mslabel:y}}batchSend(r){return r.map(s=>{let{kind:a,ssrcMsg:c}=s;return this.send(a,c,void 0)})}stopSending(r){this.sessionDesc.mediaDescriptions.forEach(s=>{const a=[],c=[],u=[];s.attributes.ssrcs.forEach(h=>{ot(r).call(r,h.attributes.label||"")?u.push(h):a.push(h)}),s.attributes.ssrcGroups.forEach(h=>{var m;ot(m=u.map(y=>y.ssrcId)).call(m,h.ssrcIds[0])||c.push(h)}),s.attributes.ssrcs=a,s.attributes.ssrcGroups=c})}mute(r){const s=this.sessionDesc.mediaDescriptions.find(a=>a.attributes.mid===r);if(!s)throw new Error("mediaDescription not found with ".concat(r," in remote SDP when calling RemoteSDP.mute."));s.attributes.direction="inactive"}unmute(r){const s=this.sessionDesc.mediaDescriptions.find(a=>a.attributes.mid===r);if(!s)throw new Error("mediaDescription not found with ".concat(r," in remote SDP when calling RemoteSDP.unmute."));s.attributes.direction="sendonly"}receive(r,s,a){r.forEach((c,u)=>{const h=c._mediaStreamTrack,m=this.sessionDesc.mediaDescriptions.findIndex(v=>v.attributes.mid===h.kind),y=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[m],c);this.sessionDesc.mediaDescriptions[m]=y})}stopReceiving(r){}updateCandidates(r){const s=this._originCandidates.filter(c=>c.transport==="udp"),a=[];if(s.forEach(c=>{a.push(EK(EK({},c),{},{foundation:"tcpcandidate",priority:Number(c.priority)-1+"",transport:"tcp",port:Number(c.port)+90+""}))}),s.length!==0){switch(r){case Ws.TCP_RELAY:this.candidates=a;break;case Ws.UDP_TCP_RELAY:case Ws.RELAY:this.candidates=[...s,...a];break;default:this.candidates=s}for(const c of this.sessionDesc.mediaDescriptions)c.attributes.candidates=this.candidates}}restartICE(r){r=Gr(r),this.iceParameters=r,this.sessionDesc.mediaDescriptions.forEach(s=>{s.attributes.iceUfrag=r.iceUfrag,s.attributes.icePwd=r.icePwd})}predictReceivingMids(r){const s=[];for(let a=0;a<r;a++)s.push((this.currentMidIndex+a+1).toString(10));return s}mungRecvMediaDsec(r,s){const a=Gr(r);return aS(a,s),f2(a,s),a}updateRecvMedia(r,s){const a=this.sessionDesc.mediaDescriptions.findIndex(c=>c.attributes.mid===r);if(a!==-1){const c=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[a],s);this.sessionDesc.mediaDescriptions[a]=c}}bumpMid(r){this.currentMidIndex+=r}updateTrackLabel(r,s,a){const c=this.sessionDesc.mediaDescriptions.find(h=>r===_t.VIDEO?h.attributes.mid==="video":h.attributes.mid==="audio");if(c){const h=c.attributes.ssrcs.find(m=>m.attributes.label===s);var u;h&&(h.attributes.label=a,(u=h.attributes.msid)===null||u===void 0||u.replace(s,a))}}mungMediaDesc(r){const s=Gr(r);return h2(s),function(a){const c=a.attributes.extmaps.find(u=>RP(u.extensionName));c&&a.attributes.extmaps.splice(a.attributes.extmaps.indexOf(c),1),a.attributes.payloads.forEach(u=>{const h=u.rtcpFeedbacks.findIndex(m=>m.type==="transport-cc");h!==-1&&u.rtcpFeedbacks.splice(h,1)})}(s),s}getSSRC(r){for(const s of this.sessionDesc.mediaDescriptions)for(const a of s.attributes.ssrcs)if(a.attributes.label===r)return[a]}}var cr;function vK(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}function dO(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?vK(Object(s),!0).forEach(function(a){K(t,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):vK(Object(s)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))})}return t}let Qye=(cr=class Zw extends PH{get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.videoCodecs.map(r=>r.rtpMap&&r.rtpMap.encodingName.toLowerCase()||"").filter(r=>{var s;return ot(s=Object.keys(tP)).call(s,r)}))]}constructor(r,s){super(r,s),K(this,"store",void 0),K(this,"peerConnection",void 0),K(this,"remoteSDP",void 0),K(this,"initialOffer",void 0),K(this,"statsFilter",void 0),K(this,"useRTX",!1),K(this,"localCapabilities",void 0),K(this,"localCandidateCount",0),K(this,"allCandidatesReceived",!1),K(this,"establishPromise",void 0),K(this,"mutex",void 0),this.store=s,this.mutex=new js("P2PConnection-mutex",s.clientId),this.peerConnection=new RTCPeerConnection(Zw.resolvePCConfiguration(r),{optional:[{googDscp:!0}]}),this.statsFilter=RL(this.peerConnection,oe("STATS_UPDATE_INTERVAL"),void 0,Br()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async establish(){try{const r=await this.peerConnection.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});if(!r.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const s=$m(r.sdp),a=FT(r.sdp,{filterRTX:!this.useRTX,filterVideoFec:oe("FILTER_VIDEO_FEC"),filterAudioFec:oe("FILTER_AUDIO_FEC"),filterAudioCodec:["opus"]});return this.localCapabilities=a,this.initialOffer=r,dO(dO({},s),{},{rtpCapabilities:{send:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},recv:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},sendrecv:a},offerSDP:r.sdp})}catch(r){throw new Le(te.GET_LOCAL_CONNECTION_PARAMS_FAILED,r.toString())}}async updateRemoteConnect(){}async connect(r){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.remoteSDP=new Jye(dO(dO({},r),{},{rtpCapabilities:r.rtpCapabilities.send,localCapabilities:this.localCapabilities,sdkCodec:this.store.codec}));const s=this.remoteSDP.toString();await this.peerConnection.setLocalDescription(this.initialOffer),await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}catch(s){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(s.toString()))}}async updateRemoteRTPCapabilities(r,s){throw new Le(te.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}getPreMedia(r){}send(r,s){var a=this;return Tl(function*(){const c=yield kn(a.mutex.lock());try{if(!a.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const u=r.map(P=>a.peerConnection.addTrack(P._mediaStreamTrack)),h=yield kn(a.peerConnection.createOffer()),m=Ba(h.sdp),y=r.map(P=>{const N=P._mediaStreamTrack,G=m.mediaDescriptions.find(F=>F.attributes.mid===N.kind);if(!G)throw new Error("Cannot extract ssrc from mediaDescription.");return function(F,j,X){const ee=F.attributes.ssrcs.filter(Se=>Se.attributes.label===j),he=F.attributes.ssrcGroups;if(ee.length===0)throw new Error("Cannot extract ssrc from plan-b SDP.");if(he&&ee.length>1){const Se=he.find(Te=>Te.ssrcIds.indexOf(ee[0].ssrcId)!==-1);return Se?[{ssrcId:Se.ssrcIds[0],rtx:X?Se.ssrcIds[1]:void 0}]:[{ssrcId:ee[0].ssrcId}]}return[{ssrcId:ee[0].ssrcId}]}(G,N.id,a.useRTX)});let v;try{v=yield y}catch(P){throw u.forEach(N=>{Ps()&&N.replaceTrack(null),a.peerConnection.removeTrack(N)}),P}const S=a.mungSendOfferSDP(h.sdp,r);a.remoteSDP.receive(r,s,v);const R=a.remoteSDP.toString();return yield kn(a.peerConnection.setLocalDescription({type:"offer",sdp:S})),yield kn(a.applySendEncodings(u,r)),yield kn(a.peerConnection.setRemoteDescription({type:"answer",sdp:R})),r.map((P,N)=>{const G=P._mediaStreamTrack.id;return{localSSRC:y[N],id:G}})}catch(u){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(u.toString()))}finally{c()}})()}async stopSending(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const s=this.peerConnection.getSenders().filter(u=>{var h;return r.indexOf(((h=u.track)===null||h===void 0?void 0:h.id)||"")!==-1});if(s.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");s.map(u=>{Ps()&&u.replaceTrack(null),this.peerConnection.removeTrack(u)});const a=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(a),this.remoteSDP.stopReceiving(r);const c=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:c})}catch(s){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(s.toString()))}}async receive(r,s,a,c){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(r," before remoteSDP created."));const{id:u,mslabel:h}=this.remoteSDP.send(r,s,c),m=new dt((S,R)=>{const P=setTimeout(()=>{R(new Error("Cannot receive track, id: ".concat(u)))},1e4),N=G=>{const F=Nn();if((F.name==="Safari"&&Number(F.version)===11||Lo())&&G.track.id!==u&&G.streams[0].id===h){var j;const X=G.streams[0].getTracks()[0];return(j=this.remoteSDP)===null||j===void 0||j.updateTrackLabel(r,u,G.track.id),this.peerConnection.removeEventListener("track",N),clearTimeout(P),void S(X)}if(G.track.id===u)return this.peerConnection.removeEventListener("track",N),clearTimeout(P),void S(G.track)};this.peerConnection.addEventListener("track",N)}),y=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:y});const v=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(v),{track:await m,id:u}}catch(u){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(u.toString()))}}async stopReceiving(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(r);const s=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:s});const a=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(a)}catch(s){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(s.toString()))}}async muteRemote(r){}async unmuteRemote(r){}async muteLocal(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const s=this.peerConnection.getSenders().filter(a=>{var c;return r.indexOf(((c=a.track)===null||c===void 0?void 0:c.id)||"")!==-1});if(s.length!==r.length)throw new Error("sender' length doesn't match mids' length.");s.map(a=>{if(Ps()&&a.track)a.track.enabled=!1;else{const c=a.getParameters();c.encodings.forEach(u=>u.active=!1),a.setParameters(c)}})}catch(s){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(s.toString()))}}async unmuteLocal(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const s=this.peerConnection.getSenders().filter(u=>{var h;return r.indexOf(((h=u.track)===null||h===void 0?void 0:h.id)||"")!==-1});if(s.length!==r.length)throw new Error("Senders' length doesn't match mids' length.");s.map(async u=>{if(Ps()&&u.track)u.track.enabled=!0;else{const h=u.getParameters();h.encodings.forEach(m=>m.active=!0),await u.setParameters(h)}});const a=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(a);const c=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:c})}catch(s){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(s.toString()))}}restartICE(r){var s=this;return Tl(function*(){const a=yield kn(s.mutex.lock("From P2PConnection.restartICE"));try{if(!s.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");const c=Vn().supportPCSetConfiguration;if(r===Ws.RELAY&&!c)return;if(c){const v=s.peerConnection.getConfiguration(),S=r===Ws.RELAY?"relay":"all";v.iceTransportPolicy!==S&&(x.debug("[".concat(s.store.clientId,"] restartICE change iceTransportPolicy from [").concat(v.iceTransportPolicy,"] to [").concat(S,"]")),v.iceTransportPolicy=S,s.peerConnection.setConfiguration(v))}r!==Ws.RELAY&&s.remoteSDP.updateCandidates(r);const u=yield kn(s.peerConnection.createOffer({iceRestart:!0}));if(!u.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const h=$m(u.sdp),{remoteIceParameters:m}=yield h.iceParameters;s.remoteSDP.restartICE(m);const y=s.remoteSDP.toString();yield kn(s.peerConnection.setLocalDescription(u)),yield kn(s.peerConnection.setRemoteDescription({type:"answer",sdp:y}))}catch(c){x.warning("[".concat(s.store.clientId,"] restart ICE failed, abort operation"),c)}finally{a()}})()}close(){var r;this.peerConnection.close(),(r=this.onConnectionStateChange)===null||r===void 0||r.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(r){return this.statsFilter.getVideoIsReady(r)}async updateEncoderConfig(r,s){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const a=await this.peerConnection.createOffer(),c=this.mungSendOfferSDP(a.sdp,[s]);this.remoteSDP.updateRecvMedia(s._mediaStreamTrack.kind,s);const u=this.remoteSDP.toString();await this.peerConnection.setLocalDescription({type:"offer",sdp:c}),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(a){throw new Le(te.EXCHANGE_SDP_FAILED,a.toString())}}async updateSendParameters(r,s){const a=this.peerConnection.getSenders().filter(c=>{var u;return((u=c.track)===null||u===void 0?void 0:u.id)===r});a.length===1&&await this.applySendEncodings(a,[s])}setStatsRemoteVideoIsReady(r,s){this.statsFilter.setVideoIsReady2(r,s)}async replaceTrack(r,s){const a=this.peerConnection.getSenders().find(c=>{var u;return((u=c.track)===null||u===void 0?void 0:u.id)===s});a&&await a.replaceTrack(r._mediaStreamTrack)}createDataChannels(r,s){throw new Le(te.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}stopDataChannels(r){throw new Le(te.NOT_SUPPORTED,"Planb mode does not support stopDataChannels.")}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var r;(r=this.onICEConnectionStateChange)===null||r===void 0||r.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var r;(r=this.onConnectionStateChange)===null||r===void 0||r.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=r=>{r.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,x.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,x.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},oe("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(r){const s={iceServers:[],sdpSemantics:"plan-b"};return r.iceServers?s.iceServers=r.iceServers:r.turnServer&&r.turnServer.mode!=="off"&&(RT(r.turnServer.servers)?s.iceServers=r.turnServer.servers:(s.iceServers&&s.iceServers.push(...Zw.turnServerConfigToIceServers(r.turnServer.servers)),oe("USE_TURN_SERVER_OF_GATEWAY")&&s.iceServers&&r.turnServer.serversFromGateway&&s.iceServers.push(...Zw.turnServerConfigToIceServers(r.turnServer.serversFromGateway)),r.turnServer.servers.concat(r.turnServer.serversFromGateway||[]).forEach(a=>{a.forceturn&&(s.iceTransportPolicy="relay")}))),s}static turnServerConfigToIceServers(r){const s=[];return r.forEach(a=>{a.security?a.tcpport&&s.push({username:a.username,credential:a.password,credentialType:"password",urls:"turns:".concat(a.turnServerURL,":").concat(a.tcpport,"?transport=tcp")}):(a.udpport&&s.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":").concat(a.udpport,"?transport=udp")}),a.tcpport&&s.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":").concat(a.tcpport,"?transport=tcp")}))}),s}async updateRtpSenderEncodings(r,s){var a;if(s||(s=this.peerConnection.getSenders().find(v=>{var S;return((S=v.track)===null||S===void 0?void 0:S.id)===r._mediaStreamTrack.id})),!s)return x.warn("[".concat(r.getTrackId(),"] no rtpSender found}"));if(!Vn().supportSetRtpSenderParameters)return x.warn("Browser not support set rtp-sender parameters");const c={},u={};if(r instanceof Sr)switch(r._optimizationMode){case"motion":c.degradationPreference="maintain-framerate";break;case"detail":c.degradationPreference="maintain-resolution";break;default:c.degradationPreference="balanced"}if(oe("DSCP_TYPE")&&np()){var h;const v=oe("DSCP_TYPE");ot(h=["very-low","low","medium","high"]).call(h,v)&&(u.networkPriority=v)}const m=s.getParameters(),y=(a=m.encodings)===null||a===void 0?void 0:a[0];y&&Object.assign(y,u),Object.assign(m,c),x.debug("[".concat(r.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(m.encodings))),await s.setParameters(m)}async applySendEncodings(r,s){try{if(!Vn().supportSetRtpSenderParameters||r.length!==s.length)return;for(let a=0;a<r.length;a++){const c=r[a],u=s[a];c&&u&&await this.updateRtpSenderEncodings(u,c)}}catch{x.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(r,s){const a=Ba(r);return s.forEach((c,u)=>{const h=c._mediaStreamTrack,m=a.mediaDescriptions.find(y=>y.attributes.mid===h.kind);m&&aS(m,c)}),Bm(a)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=r=>{var s;(s=this.onFirstAudioReceived)===null||s===void 0||s.call(this,r)},this.statsFilter.onFirstVideoReceived=r=>{var s;(s=this.onFirstVideoReceived)===null||s===void 0||s.call(this,r)},this.statsFilter.onFirstAudioDecoded=r=>{var s;(s=this.onFirstAudioDecoded)===null||s===void 0||s.call(this,r)},this.statsFilter.onFirstVideoDecoded=(r,s,a)=>{var c;(c=this.onFirstVideoDecoded)===null||c===void 0||c.call(this,r,s,a)},this.statsFilter.onSelectedLocalCandidateChanged=(r,s)=>{var a;(a=this.onSelectedLocalCandidateChanged)===null||a===void 0||a.call(this,r,s)},this.statsFilter.onSelectedRemoteCandidateChanged=(r,s)=>{var a;(a=this.onSelectedRemoteCandidateChanged)===null||a===void 0||a.call(this,r,s)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0}async batchReceive(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const s=this.remoteSDP.batchSend(r).map((u,h)=>{let{id:m,mslabel:y}=u;const{kind:v}=r[h];return new dt((S,R)=>{const P=setTimeout(()=>{R(new Error("Cannot receive track, id: ".concat(m)))},1e4),N=G=>{const F=Nn();if(F.name==="Safari"&&Number(F.version)===11&&G.track.id!==m&&G.streams[0].id===y){var j;const X=G.streams[0].getTracks()[0];return(j=this.remoteSDP)===null||j===void 0||j.updateTrackLabel(v,m,G.track.id),this.peerConnection.removeEventListener("track",N),clearTimeout(P),void S({track:X,id:m})}if(G.track.id===m)return this.peerConnection.removeEventListener("track",N),clearTimeout(P),void S({track:G.track,id:m})};this.peerConnection.addEventListener("track",N)})}),a=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:a});const c=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(c),await dt.all(s)}catch(s){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(s.toString()))}}async getRemoteSSRC(r){if(!this.remoteSDP)return;const s=this.remoteSDP.getSSRC(r);return s==null?void 0:s[0].ssrcId}setConfiguration(r){if(Vn().supportPCSetConfiguration){const s=Zw.resolvePCConfiguration(r);this.peerConnection.setConfiguration(s)}}},Tt(cr.prototype,"connect",[kl],Object.getOwnPropertyDescriptor(cr.prototype,"connect"),cr.prototype),Tt(cr.prototype,"stopSending",[kl],Object.getOwnPropertyDescriptor(cr.prototype,"stopSending"),cr.prototype),Tt(cr.prototype,"receive",[kl],Object.getOwnPropertyDescriptor(cr.prototype,"receive"),cr.prototype),Tt(cr.prototype,"stopReceiving",[kl],Object.getOwnPropertyDescriptor(cr.prototype,"stopReceiving"),cr.prototype),Tt(cr.prototype,"muteRemote",[kl],Object.getOwnPropertyDescriptor(cr.prototype,"muteRemote"),cr.prototype),Tt(cr.prototype,"unmuteRemote",[kl],Object.getOwnPropertyDescriptor(cr.prototype,"unmuteRemote"),cr.prototype),Tt(cr.prototype,"muteLocal",[kl],Object.getOwnPropertyDescriptor(cr.prototype,"muteLocal"),cr.prototype),Tt(cr.prototype,"unmuteLocal",[kl],Object.getOwnPropertyDescriptor(cr.prototype,"unmuteLocal"),cr.prototype),Tt(cr.prototype,"close",[kl],Object.getOwnPropertyDescriptor(cr.prototype,"close"),cr.prototype),Tt(cr.prototype,"updateEncoderConfig",[kl],Object.getOwnPropertyDescriptor(cr.prototype,"updateEncoderConfig"),cr.prototype),Tt(cr.prototype,"updateSendParameters",[kl],Object.getOwnPropertyDescriptor(cr.prototype,"updateSendParameters"),cr.prototype),Tt(cr.prototype,"replaceTrack",[kl],Object.getOwnPropertyDescriptor(cr.prototype,"replaceTrack"),cr.prototype),Tt(cr.prototype,"getRemoteSSRC",[kl],Object.getOwnPropertyDescriptor(cr.prototype,"getRemoteSSRC"),cr.prototype),cr);function kl(t,r,s){const a=t[r];if(typeof a!="function")throw new Error("Cannot use mutex on object property.");return s.value=async function(){const c=this.mutex,u=await c.lock("Locking from P2PConnection.".concat(r));try{for(var h=arguments.length,m=new Array(h),y=0;y<h;y++)m[y]=arguments[y];return await a.apply(this,m)}finally{u()}},s}const Zye={name:"PlanBConnection",create:function(t){let{store:r,spec:s}=t;return new Qye(s,r)}},eEe={interceptLocalAudioFrame:async function(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!Vn().supportWebRTCEncodedTransform)return void x.warning("browser not support audio encoded transform");if(uP.has(t)||!t.track)return;const s={track:t.track};if(tp()){if(!t.createEncodedStreams)return void x.warning("browser not support createEncodedStreams() API");let c=null;try{c=t.createEncodedStreams()}catch(h){return void x.error("create audio-encoded-streams error",h&&h.message)}const u=new TransformStream({transform(h,m){s.controller||(s.controller=m),t.track&&t.track.id!==s.track.id&&(x.debug("audio track changed: ".concat(s.track.id," => ").concat(t.track.id)),s.track.removeEventListener("ended",a),s.track=t.track,s.track.addEventListener("ended",a));const y=r.metadata&&r.metadata();y?function(v,S){const{chunk:R,controller:P}=S,N=oe("ENABLE_AUDIO_PTS_METADATA")?op.AUDIO_64_BIT_PTS:op.METADATA;R.data=function(G,F,j){const X=j.byteLength,ee=X+XL+fH,he=qL+YL+ee,Se=new ArrayBuffer(G.byteLength+he),Te=new DataView(Se);Te.setUint8(0,hH),Te.setUint16(1,ee),Te.setUint8(3,F),Te.setUint16(4,X);for(let Ne=0;Ne<X;Ne++)Te.setUint8(6+Ne,j[Ne]);const ye=new Uint8Array(Te.buffer);return ye.set(new Uint8Array(G),he),ye.buffer}(R.data,N,v),P.enqueue(R)}(y,{chunk:h,controller:m}):m.enqueue(h)}});c.readable.pipeThrough(u).pipeTo(c.writable)}else if(Ps()){if(typeof RTCRtpScriptTransform>"u")return void x.warning("browser not support RTCRtpScriptTransform");const c=lP(),u=new MessageChannel;await new dt(m=>c.onmessage=y=>{y.data==="registered"&&m(void 0)});const h=new RTCRtpScriptTransform(c,{name:"audio-metadata-tx",port:u.port2},[u.port2]);t.transform=h,await new dt(m=>c.onmessage=y=>{y.data==="started"&&m(void 0)}),u.port1.onmessage=m=>{var y;if(m.data.transformed&&t.track&&((y=t.track)===null||y===void 0?void 0:y.id)!==s.track.id)x.debug("audio track changed: ".concat(s.track.id," => ").concat(t.track.id)),s.track.removeEventListener("ended",a),s.track=t.track,s.track.addEventListener("ended",a);else if(m.data.getMetadata){const v=r.metadata&&r.metadata();v&&u.port1.postMessage({metadata:v})}},s.worker=c}function a(){if(t.track){if(this.id!==t.track.id)return;t.track.removeEventListener("ended",a)}const c=uP.get(t);if(c){uP.delete(t);try{var u,h;(u=c.controller)===null||u===void 0||u.terminate(),(h=c.worker)===null||h===void 0||h.terminate()}catch(m){x.warning(m&&m.message)}}}uP.set(t,s),t.track.addEventListener("ended",a)},interceptRemoteAudioFrame:async function(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!Vn().supportWebRTCEncodedTransform)return void x.warning("browser not support audio encoded transform");if(gP.has(t))return;const s={track:t.track,onMetadata:r.onMetadata};if(tp()){if(!t.createEncodedStreams)return void x.warning("browser not support createEncodedStreams() API");cL(zn.CHROME,87,116)||(r.enableTopn=!1);let c=null;try{c=t.createEncodedStreams()}catch(h){return void x.error("create audio-encoded-streams error",h&&h.message)}const u=new TransformStream({transform(h,m){s.controller||(s.controller=m),t.track&&t.track.id!==s.track.id&&(x.debug("audio track changed: ".concat(s.track.id," => ").concat(t.track.id)),s.track.removeEventListener("ended",a),s.track=t.track,s.track.addEventListener("ended",a)),r.enableTopn?function(y,v,S){var R;const P=pH(new DataView(v.data));if(!P)return S.enqueue(v);const N=y.track.id;xme.set(N,y.track);const G=(R=P.tlv.find(Se=>Se.tag===op.AUDIO_LEVEL))===null||R===void 0?void 0:R.value;let F=0;typeof G=="number"&&(F=127-G);const j=Math.round(Math.pow(10,F/60)-1),{selected:X,speaker:ee}=function(Se,Te){let ye=eS.get(Se);if(ye||(ye=function(Ne){const Ye=new gH;return eS.set(Ne,Ye),Ed||(Ed=new Nme(oe("TOPN_SILENCE_THRESHOLD")||500),Ed.on("ActiveSpeakerChanged",ht=>{ht!=null&&(fP=ht)})),Ed.addSpeakers([Ye]),Ye}(Se)),eS.size<=_H)return{selected:!0,speaker:ye};if(!Ed)throw new Error("no active speaker detector");return Ed.levelChanged(ye.id,Te),$_=Ed.loudest.map(Ne=>Ne.id),fP&&!ot($_).call($_,fP)&&$_.length>=_H&&$_.pop(),{selected:ot($_).call($_,ye.id)||ye.id===fP,speaker:ye}}(y,j),he=function(Se,Te,ye){const Ne=vd.get(Se)||new Dme(Se,Te);return Ne.score=ye,vd.set(Se,Ne),function(Ye){if(pP.set(Ye,!0),!mP)return void(mP=Date.now());const ht=Date.now();ht-mP>1e3&&(pP.get(Ye)?pP.set(Ye,!1):(yH(Ye),pP.delete(Ye)),mP=ht)}(Se),Ne}(N,y.track,ee.energyScore);he.addSample(X),he.active&&(v.data=P.frame.buffer,S.enqueue(v))}(t,h,m):r.enableMetadata?function(y,v,S){const R=pH(new DataView(y.data));if(!R)return v.enqueue(y);const P=R.tlv.find(N=>N.tag===op.METADATA||N.tag===op.AUDIO_64_BIT_PTS);P&&S&&P.value instanceof Uint8Array&&S(P.value),y.data=R.frame.buffer,v.enqueue(y)}(h,m,r.onMetadata):m.enqueue(h)}});c.readable.pipeThrough(u).pipeTo(c.writable)}else if(Ps()){if(typeof RTCRtpScriptTransform>"u")return void x.warning("browser not support RTCRtpScriptTransform");const c=lP(),u=new MessageChannel;await new dt(m=>c.onmessage=y=>{y.data==="registered"&&m(void 0)});const h=new RTCRtpScriptTransform(c,{name:"audio-metadata-rx",port:u.port2},[u.port2]);t.transform=h,await new dt(m=>c.onmessage=y=>{y.data==="started"&&m(void 0)}),u.port1.onmessage=m=>{var y;m.data.transformed&&t.track&&((y=t.track)===null||y===void 0?void 0:y.id)!==s.track.id?(x.debug("audio track changed: ".concat(s.track.id," => ").concat(t.track.id)),s.track.removeEventListener("ended",a),s.track=t.track,s.track.addEventListener("ended",a)):m.data.metadata&&s.onMetadata&&s.onMetadata(m.data.metadata)},s.worker=c}function a(){t.track.removeEventListener("ended",a),function(c){const u=gP.get(c);if(u){(function(y){const v=eS.get(y);v&&(eS.delete(y),Ed&&(Ed.removeSpeakers([v]),eS.size===0&&(Ed.destroy(),Ed=null)))})(c),yH(c.track.id),gP.delete(c);try{var h,m;(h=u.controller)===null||h===void 0||h.terminate(),(m=u.worker)===null||m===void 0||m.terminate()}catch(y){x.warning(y&&y.message)}}}(t)}gP.set(t,s),t.track.addEventListener("ended",a)},interceptLocalVideoFrame:async function(t,r){if(!Vn().supportWebRTCEncodedTransform)return void x.warning("browser not support video encoded transform");if(_P.has(t)||!t.track)return;const s={track:t.track};if(tp()){if(!t.createEncodedStreams)return void x.warning("browser not support createEncodedStreams() API");let c=null;try{c=t.createEncodedStreams()}catch(m){return void x.error("create video-encoded-streams error",m&&m.message)}const u=[];r.on("sei-to-send",m=>{u.push(m)});const h=new TransformStream({transform(m,y){s.controller||(s.controller=y),t.track&&t.track.id!==s.track.id&&(x.debug("video track changed: ".concat(s.track.id," => ").concat(t.track.id)),s.track.removeEventListener("ended",a),s.track=t.track,s.track.addEventListener("ended",a));const v=u.shift();v&&(m.data=function(S,R){const P=function(ee){const he=ee.length;let Se=[],Te=0;for(;Te<he;)Te+2<he&&ee[Te]===0&&ee[Te+1]===0&&(ee[Te+2]===0||ee[Te+2]===1||ee[Te+2]===2||ee[Te+2]===3)?(Se.push(ee[Te],ee[Te+1],3,ee[Te+2]),Te+=3):(Se.push(ee[Te]),Te++);return new Uint8Array(Se)}(R),N=P.length,G=Math.floor(N/255),F=N%255,j=new Uint8Array(6+G+1+N+S.byteLength);j[0]=0,j[1]=0,j[2]=0,j[3]=1,j[4]=6,j[5]=101;let X=0;for(;X<G;)j[6+X]=255,X++;return j[6+X]=F,X++,j.set(P,6+X),j.set(new Uint8Array(S),6+X+N),j.buffer}(m.data,v)),y.enqueue(m)}});c.readable.pipeThrough(h).pipeTo(c.writable)}else{if(!Ps())return;{if(typeof RTCRtpScriptTransform>"u")return void x.warning("browser not support RTCRtpScriptTransform");const c=lP(),u=new MessageChannel;await new dt(m=>c.onmessage=y=>{y.data==="registered"&&m(void 0)});const h=new RTCRtpScriptTransform(c,{name:"sei-tx",port:u.port2},[u.port2]);t.transform=h,await new dt(m=>c.onmessage=y=>{y.data==="started"&&m(void 0)}),r.on("sei-to-send",m=>{u.port1.postMessage({sei:m})}),u.port1.onmessage=m=>{var y;m.data.transformed&&t.track&&((y=t.track)===null||y===void 0?void 0:y.id)!==s.track.id&&(x.debug("video track changed: ".concat(s.track.id," => ").concat(t.track.id)),s.track.removeEventListener("ended",a),s.track=t.track,s.track.addEventListener("ended",a))},s.worker=c}}function a(){if(t.track){if(this.id!==t.track.id)return;t.track.removeEventListener("ended",a)}const c=_P.get(t);if(c){_P.delete(t);try{var u,h;(u=c.controller)===null||u===void 0||u.terminate(),(h=c.worker)===null||h===void 0||h.terminate()}catch(m){x.warning(m&&m.message)}}}_P.set(t,s),t.track.addEventListener("ended",a)},interceptRemoteVideoFrame:async function(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!Vn().supportWebRTCEncodedTransform)return void x.warning("browser not support video encoded transform");if(!t.track)return;if(DT.has(t)){const c=DT.get(t);return void(c&&(c.onSei=r.onSei))}const s={track:t.track,onSei:r.onSei};if(tp()){if(!t.createEncodedStreams)return void x.warning("browser not support createEncodedStreams() API");let c=null;try{c=t.createEncodedStreams()}catch(h){return void x.error("create video-encoded-streams error",h&&h.message)}const u=new TransformStream({transform(h,m){s.controller||(s.controller=m),t.track&&t.track.id!==s.track.id&&(x.debug("video track changed: ".concat(s.track.id," => ").concat(t.track.id)),s.track.removeEventListener("ended",a),s.track=t.track,s.track.addEventListener("ended",a));const y=function(v){const S=new DataView(v.data);let R=0;for(;R+4<v.data.byteLength;){if(S.getUint8(R+0)===0&&S.getUint8(R+1)===0&&S.getUint8(R+2)===0&&S.getUint8(R+3)===1&&S.getUint8(R+4)===6){let P=R+6,N=0,G=0;for(;(G=S.getUint8(P++))===255;)N+=255;N+=G;const F=Lme(v.data,P,N);return new Uint8Array(F)}R++}return null}(h);y&&s.onSei&&s.onSei(y),m.enqueue(h)}});c.readable.pipeThrough(u).pipeTo(c.writable)}else if(Ps()){if(typeof RTCRtpScriptTransform>"u")return void x.warning("browser not support RTCRtpScriptTransform");const c=lP(),u=new MessageChannel;await new dt(m=>c.onmessage=y=>{y.data==="registered"&&m(void 0)});const h=new RTCRtpScriptTransform(c,{name:"sei-rx",port:u.port2},[u.port2]);t.transform=h,await new dt(m=>c.onmessage=y=>{y.data==="started"&&m(void 0)}),u.port1.onmessage=m=>{var y;m.data.transformed&&t.track&&((y=t.track)===null||y===void 0?void 0:y.id)!==s.track.id?(x.debug("video track changed: ".concat(s.track.id," => ").concat(t.track.id)),s.track.removeEventListener("ended",a),s.track=t.track,s.track.addEventListener("ended",a)):m.data.sei&&s.onSei&&s.onSei(m.data.sei)},s.worker=c}function a(){if(t.track){if(this.id!==t.track.id)return;t.track.removeEventListener("ended",a)}(function(c){const u=DT.get(c);if(u){DT.delete(c);try{var h,m;(h=u.controller)===null||h===void 0||h.terminate(),(m=u.worker)===null||m===void 0||m.terminate()}catch(y){x.warning(y&&y.message)}}})(t)}DT.set(t,s),t.track.addEventListener("ended",a)}},tEe={name:"InterceptFrame",create:()=>eEe};IL(),tr("PROCESS_ID","process-".concat(dr(8,""),"-").concat(dr(4,""),"-").concat(dr(4,""),"-").concat(dr(4,""),"-").concat(dr(12,""))),function(){let t;try{t=window.localStorage.getItem("websdk_ng_global_parameter")}catch(r){return void x.error("Error loading sdk config",r.message)}if(t)try{const r=JSON.parse(window.atob(t)),s=Date.now();x.debug("Loading global parameters from cache",r),Object.keys(r).forEach(a=>{if(Object.prototype.hasOwnProperty.call(vr,a)){const{value:c,expires:u}=r[a];if(u&&u<=s)return;yd[a]=c,vr[a]=c}})}catch(r){x.error("Error loading mutableParamsCache: ".concat(t),r.message)}}(),Array.isArray(yd.AREAS)&&yd.AREAS.length>0&&y2(yd.AREAS,!0);const SK=(t,r,s)=>{x.debug("setParameter key:".concat(t,", value:").concat(JSON.stringify(r))),tr(t,r,s)};Km(wye,!1),Km(Iye,!1),Km(o_e,!1),Km(Vye,!1),Km(Sye,!1),Km(Xye,!1),Km(Zye,!1),Km(tEe,!1);const Oi=function(t){const r=new Ur,s=t,a={getListeners:r.getListeners.bind(r),on:(c,u)=>(function(h,m){h===Ch.SECURITY_POLICY_VIOLATION&&t$(m,!0)}(c,u),r.on.bind(r)(c,u)),addListener:r.addListener.bind(r),once:r.once.bind(r),off:r.off.bind(r),removeAllListeners:r.removeAllListeners.bind(r),emit:r.emit.bind(r),safeEmit:r.safeEmit.bind(r)};return e$(e$({},s),a)}({__TRACK_LIST__:Gv,VERSION:wl,BUILD:OL,ESM_BUNDLER:!1,ESM:!1,UMD:!0,DEV:!1,setParameter:SK,getParameter:oe,getSupportedCodec:async function(){let t={audio:[],video:[]};try{let r=new RTCPeerConnection;const s=await async function(a){let c;return Vn().supportUnifiedPlan?(a.addTransceiver("video",{direction:"recvonly"}),a.addTransceiver("audio",{direction:"recvonly"}),c=(await a.createOffer()).sdp):c=(await a.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0})).sdp,c}(r);if(!s)return t;r.close(),r=null,t=function(a){const c={video:[],audio:[]};return a.match(/ VP8/i)&&c.video.push("VP8"),a.match(/ VP9/i)&&c.video.push("VP9"),a.match(/ AV1/i)&&c.video.push("AV1"),a.match(/ H264/i)&&c.video.push("H264"),a.match(/ H265/i)&&c.video.push("H265"),a.match(/ opus/i)&&c.audio.push("OPUS"),a.match(/ PCMU/i)&&c.audio.push("PCMU"),a.match(/ PCMA/i)&&c.audio.push("PCMA"),a.match(/ G722/i)&&c.audio.push("G722"),c}(s)}catch(r){throw new Oe(te.CREATE_OFFER_FAILED,r.toString&&r.toString()).print()}return t},checkSystemRequirements:function(){const t=It.reportApiInvoke(null,{name:Ai.CHECK_SYSTEM_REQUIREMENTS,options:[],tag:zr.TRACER});let r=!1;try{const u=window.RTCPeerConnection,h=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia,m=window.WebSocket;r=!!(u&&h&&m),r&&hL()&&b8(75)&&new u().close()}catch(u){return x.error("check system requirement failed: ",u),!1}let s=!1;const a=Nn();a.name===zn.CHROME&&Number(a.version)>=58&&(gd.engine.name!=="WebKit"||function(){const u=Nn();if($A()){if(u.os===Yi.MAC_OS)return!0;if(u.os===Yi.IOS){const h=gd.os.version&&gd.os.version.split(".");if(h&&Number(h[0])===14&&h[1]&&Number(h[1])>=3||h&&Number(h[0])>14)return!0}}return!1}())&&(s=!0),(a.name===zn.FIREFOX&&Number(a.version)>=56||a.name===zn.OPERA&&Number(a.version)>=45||a.name===zn.SAFARI&&Number(a.version)>=11||a.name==="WebKit"&&(Lo()||gu())&&a.osVersion&&Number(a.osVersion.split(".")[0])>=11||A8()||Nn().name===zn.QQ)&&(s=!0),x.debug("checkSystemRequirements, api:",r,"browser",s);const c=r&&s;return t.onSuccess(c),c},getDevices:function(t){return Qc.enumerateDevices(!0,!0,t)},getMicrophones:function(t){return Qc.getRecordingDevices(t)},getCameras:function(t){return Qc.getCamerasDevices(t)},getElectronScreenSources:bz,getPlaybackDevices:function(t){return Qc.getSpeakers(t)},createClient:function(){var t;let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{codec:"vp8",audioCodec:"opus",mode:"rtc"};const s=dr(5,"client-"),a=It.reportApiInvoke(null,{id:s,name:Ai.CREATE_CLIENT,options:[r],tag:zr.TRACER});try{(function(c){Bi(c.codec,"config.codec",["vp8","vp9","av1","h264","h265"]),Bi(c.mode,"config.mode",["rtc","live","p2p"]),c.audioCodec!==void 0&&Bi(c.audioCodec,"config.audioCodec",["opus","pcmu","pcma","g722"]),c.proxyServer!==void 0&&fs(c.proxyServer,"config.proxyServer",1,1e4),c.turnServer!==void 0&&M8(c.turnServer),c.httpRetryConfig!==void 0&&L8(c.httpRetryConfig),c.websocketRetryConfig!==void 0&&L8(c.websocketRetryConfig)})(r)}catch(c){throw a.onError(c),c}return(w8(16,0)||C8(16,0,!0))&&(r.codec==="vp9"&&(r.codec="vp8",x.debug("browser not support vp9, force use vp8")),tr("UNSUPPORTED_VIDEO_CODEC",["vp9"])),r.audioCodec===void 0&&(r.audioCodec="opus"),a.onSuccess(),new a_e(wu(wu({forceWaitGatewayResponse:!0},r),{},{role:ot(t=["rtc","p2p"]).call(t,r.mode)?"host":r.role||"audience"}),s)},createCameraVideoTrack:async function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const r=oe("CAMERA_CAPTURE_CONFIG"),s=dr(8,"track-cam-"),a=It.reportApiInvoke(null,{id:s,tag:zr.TRACER,name:Ai.CREATE_CAM_VIDEO_TRACK,options:[Dr({},t),r]});r&&(t.encoderConfig=r);const c=aP(t);let u=null;x.info("start create camera video track with config",JSON.stringify(t),"trackId",s);try{u=(await Jc({video:c},s)).getVideoTracks()[0]||null}catch(m){throw a.onError(m),m}if(!u){const m=new Le(te.UNEXPECTED_ERROR,"can not find track in media stream");return a.onError(m),m.throw(x)}t.optimizationMode&&KL(s,u,t,bh(t.encoderConfig));const h=new $L(u,t,c,t.scalabiltyMode?rP(t.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t.optimizationMode,s);return a.onSuccess(h.getTrackId()),x.info("create camera video success, trackId:",s),h},createCustomVideoTrack:function(t){const r=dr(8,"track-cus-"),s=It.reportApiInvoke(null,{id:r,tag:zr.TRACER,name:Ai.CREATE_CUSTOM_VIDEO_TRACK,options:[t]}),a=new Sr(t.mediaStreamTrack,{width:t.width,height:t.height,frameRate:t.frameRate,bitrateMax:t.bitrateMax,bitrateMin:t.bitrateMin},t.scalabiltyMode?rP(t.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t.optimizationMode,r,[hr.CUSTOM_TRACK]);return s.onSuccess(a.getTrackId()),x.info("create custom video track success with config",t,"trackId",a.getTrackId()),a},createScreenVideoTrack:async function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"disable";const s=typeof r=="object"?function(P){return Nz(P)}(r):void 0;s&&(r="auto");const a=dr(8,"track-scr-v-"),c=It.reportApiInvoke(null,{id:a,tag:zr.TRACER,name:Ai.CREATE_SCREEN_VIDEO_TRACK,options:[Dr({},t),r]});t.encoderConfig?typeof t.encoderConfig=="string"||t.encoderConfig.width&&t.encoderConfig.height||(t.encoderConfig.width={max:1920},t.encoderConfig.height={max:1080}):t.encoderConfig="1080p_2";const u=function(P){const N={};P.screenSourceType&&(N.mediaSource=P.screenSourceType),P.extensionId&&tp()&&(N.extensionId=P.extensionId);const{displaySurface:G,selfBrowserSurface:F,surfaceSwitching:j,systemAudio:X,preferCurrentTab:ee}=P;(bT(107)||lL(107)||uL(93))&&(G&&(Bi(G,"displaySurface",["browser","window","monitor"]),N.displaySurface=G),F?(Bi(F,"selfBrowserSurface",["exclude","include"]),N.selfBrowserSurface=F):N.selfBrowserSurface="include",j&&(Bi(j,"surfaceSwitching",["exclude","include"]),N.surfaceSwitching=j)),(bT(105)||lL(105)||uL(91))&&X&&(Bi(X,"systemAudio",["exclude","include"]),N.systemAudio=X),(bT(94)||lL(94)||uL(80))&&ee&&(N.preferCurrentTab=!0),P.electronScreenSourceId&&(N.sourceId=P.electronScreenSourceId);const he=P.encoderConfig?LL(P.encoderConfig):null;return N.mandatory={chromeMediaSource:"desktop",maxWidth:he?he.width:void 0,maxHeight:he?he.height:void 0},he&&(he.frameRate&&(typeof he.frameRate=="number"?(N.mandatory.maxFrameRate=he.frameRate,N.mandatory.minFrameRate=he.frameRate):(N.mandatory.maxFrameRate=he.frameRate.max||he.frameRate.ideal||he.frameRate.exact||void 0,N.mandatory.minFrameRate=he.frameRate.min||he.frameRate.ideal||he.frameRate.exact||void 0),N.frameRate=he.frameRate),he.width&&(N.width=he.width),he.height&&(N.height=he.height)),N}(t);let h=null,m=null;const y=Vn();if(!y.supportShareAudio&&r==="enable"){const P=new Le(te.NOT_SUPPORTED,"your browser or platform is not support share-screen with audio");return c.onError(P),P.throw(x)}x.info("start create screen video track with config",t,"withAudio",r,"trackId",a);const v=y.supportShareAudio&&r!=="disable";try{const P=await Jc({screen:u,screenAudio:v?s||!0:void 0},a);h=P.getVideoTracks()[0]||null,m=P.getAudioTracks()[0]||null}catch(P){throw c.onError(P),P}if(!h){const P=new Le(te.UNEXPECTED_ERROR,"can not find track in media stream");return c.onError(P),P.throw(x)}if(!m&&r==="enable"){h&&h.stop();const P=new Le(te.SHARE_AUDIO_NOT_ALLOWED);return c.onError(P),P.throw(x)}t.optimizationMode||(t.optimizationMode="detail"),t.optimizationMode&&(KL(a,h,t,t.encoderConfig&&LL(t.encoderConfig)||void 0),t.encoderConfig&&typeof t.encoderConfig!="string"&&(t.encoderConfig.bitrateMin=t.encoderConfig.bitrateMax));const S=new Sr(h,t.encoderConfig?LL(t.encoderConfig):{},t.scalabiltyMode?rP(t.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t.optimizationMode,a,[hr.SCREEN_TRACK]);if(!m)return c.onSuccess(S.getTrackId()),x.info("create screen video track success","video:",S.getTrackId()),S;const R=new Yr(m,void 0,dr(8,"track-scr-a-"),!1);return c.onSuccess([S.getTrackId(),R.getTrackId()]),x.info("create screen video track success","video:",S.getTrackId(),"audio:",R.getTrackId()),[S,R]},createMicrophoneAndCameraTracks:async function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const s=oe("CAMERA_CAPTURE_CONFIG"),a=dr(8,"track-mic-"),c=dr(8,"track-cam-"),u=It.reportApiInvoke(null,{id:"".concat(a,"-").concat(c),tag:zr.TRACER,name:Ai.CREATE_MIC_AND_CAM_TRACKS,options:[t,r,s]});s&&(r.encoderConfig=s);const h=aP(r),m=Dz(t);let y=null,v=null;x.info("start create camera video track(".concat(c,") and microphone audio track(").concat(a,") with config, audio: ").concat(JSON.stringify(t),", video: ").concat(JSON.stringify(r)));try{const P=await Jc({audio:m,video:h},"".concat(a,"-").concat(c));y=P.getAudioTracks()[0],v=P.getVideoTracks()[0]}catch(P){throw u.onError(P),P}if(!y||!v){const P=new Le(te.UNEXPECTED_ERROR,"can not find tracks in media stream");return u.onError(P),P.throw(x)}r.optimizationMode&&KL(c,v,r,bh(r.encoderConfig));const S=new cP(y,t,m,a),R=new $L(v,r,h,r.scalabiltyMode?rP(r.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},r.optimizationMode,c);return u.onSuccess([S.getTrackId(),R.getTrackId()]),x.info("create camera video track(".concat(c,") and microphone audio track(").concat(a,") success")),[S,R]},createMicrophoneAudioTrack:async function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const r=dr(8,"track-mic-"),s=It.reportApiInvoke(null,{id:r,tag:zr.TRACER,name:Ai.CREATE_MIC_AUDIO_TRACK,options:[t]}),a=Dz(t);let c=null;x.info("start create microphone audio track with config",JSON.stringify(t),"trackId",r);try{c=(await Jc({audio:a},r)).getAudioTracks()[0]||null}catch(h){throw s.onError(h),h}if(!c){const h=new Le(te.UNEXPECTED_ERROR,"can not find track in media stream");return s.onError(h),h.throw(x)}const u=new cP(c,t,a,r);return s.onSuccess(u.getTrackId()),x.info("create microphone audio track success, trackId:",r),u},createCustomAudioTrack:function(t){const r=dr(8,"track-cus-"),s=It.reportApiInvoke(null,{id:r,tag:zr.TRACER,name:Ai.CREATE_CUSTOM_AUDIO_TRACK,options:[t]}),a=new Yr(t.mediaStreamTrack,t.encoderConfig?iP(t.encoderConfig):{},r,!1);return x.info("create custom audio track success with config",t,"trackId",a.getTrackId()),s.onSuccess(a.getTrackId()),a},createBufferSourceAudioTrack:async function(t){var r;const{cacheOnlineFile:s,encoderConfig:a}=t;let{source:c}=t;const u={source:c instanceof AudioBuffer?"AudioBuffer":c instanceof File?(r=File.name)!==null&&r!==void 0?r:"File":c,cacheOnlineFile:s,encoderConfig:a},h=dr(8,"track-buf-"),m=It.reportApiInvoke(null,{id:h,tag:zr.TRACER,name:Ai.CREATE_BUFFER_AUDIO_TRACK,options:[u]});if(oe("DISABLE_WEBAUDIO"))throw new Le(te.NOT_SUPPORTED,"can not create BufferSourceAudioTrack when WebAudio disabled");x.info("start create buffer source audio track with config",JSON.stringify(u),"trackId",h);const y=c;if(!(c instanceof AudioBuffer))try{c=await async function(R,P){let N=null;if(typeof R=="string"){const F=EG.get(R);if(F)return x.debug("use cached audio resource: ",R),F;try{N=(await _d(()=>la.get(R,{responseType:"arraybuffer"}),void 0,void 0,{maxRetryCount:3})).data}catch(j){throw new Le(te.FETCH_AUDIO_FILE_FAILED,j.toString())}}else N=await new dt((j,X)=>{const ee=new FileReader;ee.onload=he=>{he.target?j(he.target.result):X(new Le(te.READ_LOCAL_AUDIO_FILE_ERROR))},ee.onerror=()=>{X(new Le(te.READ_LOCAL_AUDIO_FILE_ERROR))},ee.readAsArrayBuffer(R)});const G=await function(F){const j=Xv();return new dt((X,ee)=>{j.decodeAudioData(F,he=>{X(he)},he=>{ee(new Le(te.DECODE_AUDIO_FILE_FAILED,he.toString()))})})}(N);return typeof R=="string"&&P&&EG.set(R,G),G}(c,s)}catch(R){return m.onError(R),R.throw(x)}const v=new Ime(c),S=new Rme(y,v,a?iP(a):{},h);return x.info("create buffer source audio track success, trackId:",h),m.onSuccess(S.getTrackId()),S},setAppType:function(t){if(x.debug("setAppType: ".concat(t)),!(Number.isInteger(t)&&t>=0))throw x.debug("Invalid appType"),new Oe(te.INVALID_PARAMS,"invalid app type",t);tr("APP_TYPE",Math.floor(t))},setLogLevel:function(t){x.setLogLevel(t)},enableLogUpload:function(){oe("USE_NEW_LOG")?tr("UPLOAD_LOG",!0):x.enableLogUpload()},disableLogUpload:function(){oe("USE_NEW_LOG")?tr("UPLOAD_LOG",!1):x.disableLogUpload()},createChannelMediaRelayConfiguration:function(){return new E9},checkAudioTrackIsActive:async function(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const s=It.reportApiInvoke(null,{tag:zr.TRACER,name:Ai.CHECK_AUDIO_TRACK_IS_ACTIVE,options:[r]});if(!(t instanceof Yr||t instanceof Zv)){const y=new Oe(te.INVALID_TRACK,"the parameter is not a audio track");return s.onError(y),y.throw()}r&&r<1e3&&(r=1e3);const a=t instanceof Yr?t.getTrackLabel():"remote_track",c=t.getVolumeLevel();let u=c,h=c;const m=Date.now();return new dt(y=>{const v=setInterval(()=>{const S=t.getVolumeLevel();u=S>u?S:u,h=S<h?S:h;const R=u-h>1e-4,P=Date.now()-m;if(R||P>r){clearInterval(v);const N=R,G={duration:P,deviceLabel:a,maxVolumeLevel:u,result:N};x.info("[track-".concat(t.getTrackId(),"] check audio track active completed. ").concat(JSON.stringify(G))),s.onSuccess(G),y(N)}},200)})},checkVideoTrackIsActive:async function(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const s=It.reportApiInvoke(null,{tag:zr.TRACER,name:Ai.CHECK_VIDEO_TRACK_IS_ACTIVE,options:[r]});if(!(t instanceof Sr||t instanceof Qv)){const R=new Oe(te.INVALID_TRACK,"the parameter is not a video track");return s.onError(R),R.throw()}r&&r<1e3&&(r=1e3);const a=t instanceof Sr?t.getTrackLabel():"remote_track",c=t.getMediaStreamTrack(!0),u=document.createElement("video");u.style.width="1px",u.style.height="1px",u.setAttribute("muted",""),u.muted=!0,u.setAttribute("playsinline",""),u.controls=!1,(Ps()||$A())&&(u.style.opacity="0.01",u.style.position="fixed",u.style.left="0",u.style.top="0",document.body.appendChild(u)),u.srcObject=new MediaStream([c]),u.play();const h=document.createElement("canvas");h.width=160,h.height=120;let m=0,y=0;try{const R=Date.now();m=await function(P,N,G,F){let j,X=0,ee=null;return new dt((he,Se)=>{function Te(){X>F&&j&&(j(),he(X));const ye=G.getContext("2d");if(!ye){const ht=new Oe(te.UNEXPECTED_ERROR,"can not get canvas 2d context.");return x.error(ht.toString()),void Se(ht)}ye.drawImage(P,0,0,160,120);const Ne=ye.getImageData(0,0,G.width,G.height),Ye=Math.floor(Ne.data.length/3);if(ee){for(let ht=0;ht<Ye;ht+=3)if(Ne.data[ht]!==ee[ht])return X+=1,void(ee=Ne.data);ee=Ne.data}else ee=Ne.data}setTimeout(()=>{j&&(j(),he(X))},N),j=jL(()=>{Te()},30)})}(u,r,h,4),y=Date.now()-R}catch(R){throw s.onError(R),R}$ge===zn.SAFARI&&(u.pause(),u.remove()),u.srcObject=null;const v=m>4,S={duration:y,changedPicNum:m,deviceLabel:a,result:v};return x.info("[track-".concat(t.getTrackId(),"] check video track active completed. ").concat(JSON.stringify(S))),s.onSuccess(S),v},setArea:y2,audioElementPlayCenter:ua,resumeAudioContext:function(){ua.autoResumeAfterInterruption(!0)},processExternalMediaAEC:function(t){l_e.processExternalMediaAEC(t)},registerExtensions:function(t){const r=oe("PLUGIN_INFO")||[];t.forEach(s=>{"name"in s&&!ot(r).call(r,s.name)&&r.push(s.name);const a=s;a.__registered__=!0,a.logger.hookLog=x.extLog,a.reporter.hookApiInvoke=It.extApiInvoke,a.parameters&&Object.keys(a.parameters).forEach(c=>{a.parameters[c]=oe(c)})}),SK("PLUGIN_INFO",r)},ChannelMediaRelayError:nS,ChannelMediaRelayEvent:cp,ChannelMediaRelayState:Wa,RemoteStreamFallbackType:Eme,RemoteStreamType:yme,ConnectionDisconnectedReason:Kn,AudienceLatencyLevelType:Ype,AREAS:Gn,preload:async function(t,r,s,a){return $9(t,r,s,a)}});return Object.defineProperties(Oi,{onAudioAutoplayFailed:{get:()=>Zc.onAudioAutoplayFailed,set:t=>{Zc.onAudioAutoplayFailed=t}},onAutoplayFailed:{get:()=>Zc.onAutoplayFailed,set:t=>{Zc.onAutoplayFailed=t}},_onSecurityPolicyViolation:{value:void 0,writable:!0},_cspEventHandlerPointer:{value:void 0,writable:!0},onSecurityPolicyViolation:{get:()=>Oi._onSecurityPolicyViolation,set(t){Oi._onSecurityPolicyViolation=t,t$(t)}},__CLIENT_LIST__:{get:()=>oe("SHOW_GLOBAL_CLIENT_LIST")?K_:[]}}),Qc.on(z_.CAMERA_DEVICE_CHANGED,t=>{x.info("camera device changed",JSON.stringify(t)),Oi.onCameraChanged&&Oi.onCameraChanged(t),Oi.safeEmit(Ch.CAMERA_CHANGED,t)}),Qc.on(z_.RECORDING_DEVICE_CHANGED,t=>{x.info("microphone device changed",JSON.stringify(t)),Oi.onMicrophoneChanged&&Oi.onMicrophoneChanged(t),Oi.safeEmit(Ch.MICROPHONE_CHANGED,t)}),Qc.on(z_.PLAYOUT_DEVICE_CHANGED,t=>{x.debug("playout device changed",JSON.stringify(t)),Oi.onPlaybackDeviceChanged&&Oi.onPlaybackDeviceChanged(t),Oi.safeEmit(Ch.PLAYBACK_DEVICE_CHANGED,t)}),ua.onAutoplayFailed=()=>{x.info("detect audio element autoplay failed"),Zc.onAudioAutoplayFailed&&Zc.onAudioAutoplayFailed()},nr.on("autoplay-failed",()=>{x.info("detect webaudio autoplay failed"),Zc.onAudioAutoplayFailed&&Zc.onAudioAutoplayFailed(),Oi.safeEmit(Ch.AUTOPLAY_FAILED)}),nr.on(gs.STATE_CHANGE,(t,r)=>{x.info("audio context state changed: ".concat(r," => ").concat(t)),Oi.onAudioContextStateChanged&&Oi.onAudioContextStateChanged(t,r),Oi.safeEmit(Ch.AUDIO_CONTEXT_STATE_CHANGED,t,r)}),yi.on(Vv.NETWORK_STATE_CHANGE,(t,r)=>{x.info("[network-indicator] network state changed, ".concat(r," => ").concat(t))}),window&&(window.__ARTC__=Oi),Oi})}(Dk)),Dk.exports}var tze=eze();const YC=Ug(tze),nze="a2a7f4eb05284449b1063eb71d8301dc",rze=YC.createClient({mode:"rtc",codec:"vp8"});let Dw=null;const uae=D.createContext(null),dae=({children:n,appId:e=nze,channel:i=null,token:o=null,uid:l=null,enabled:d=!0,startMuted:p=!0,onClientReady:_=()=>{}})=>{const[E,b]=D.useState(!1),[C,I]=D.useState(!1),[O,L]=D.useState([]),[V,B]=D.useState(null),[W,Z]=D.useState(null),[$,se]=D.useState(null),[ue,re]=D.useState(!1),[pe,q]=D.useState(!1),[Q,J]=D.useState(!1),[ie,me]=D.useState(null),[de,le]=D.useState(!1),xe=wc(),We=D.useRef(rze),$e=D.useRef({appId:e,channel:i,uid:l,enabled:d}),ve=D.useRef(!1),_e=D.useRef(null);D.useRef(null),D.useEffect(()=>{$e.current={appId:e,channel:i,uid:l,enabled:d}},[e,i,l,d]),D.useEffect(()=>{Z(i)},[i]),D.useEffect(()=>{if(!We.current)return;const tt=ut=>{Y.log(`Connection state changed to: ${ut}`),ut==="DISCONNECTED"?(b(!1),Y.log("Disconnected from Agora")):ut==="CONNECTED"&&(b(!0),B(null))};return We.current.on("connection-state-change",tt),()=>{We.current.off("connection-state-change",tt)}},[]),D.useEffect(()=>{if(!i||!d)return;const tt=async(Mt,Zt)=>{Y.log(`User published: ${Mt.uid}, mediaType: ${Zt}`);try{await We.current.subscribe(Mt,Zt),Zt==="audio"&&Mt.audioTrack.play(),L(an=>an.some(Ht=>Ht.uid===Mt.uid)?an:[...an,Mt])}catch(an){Y.error("Error subscribing to user:",an)}},ut=(Mt,Zt)=>{Y.log(`User unpublished: ${Mt.uid}, mediaType: ${Zt}`),Zt==="audio"&&Mt.audioTrack&&Mt.audioTrack.stop()},Ze=Mt=>{Y.log(`User joined: ${Mt.uid}`),L(Zt=>Zt.some(an=>an.uid===Mt.uid)?Zt:[...Zt,Mt])},bt=Mt=>{Y.log(`User left: ${Mt.uid}`),L(Zt=>Zt.filter(an=>an.uid!==Mt.uid))};return We.current.on("user-published",tt),We.current.on("user-unpublished",ut),We.current.on("user-joined",Ze),We.current.on("user-left",bt),(async()=>{if(ve.current){Y.log("Already initializing, skipping duplicate initialization");return}ve.current=!0;try{if(E&&_e.current===i){Y.log(`Already joined to channel ${i}`),re(!0),_(We.current);return}if(We.current.connectionState==="CONNECTING"||We.current.connectionState==="CONNECTED")if(_e.current&&_e.current!==i){Y.log("Connected to different channel, leaving first");try{await we()}catch(Mt){Y.error("Error leaving channel:",Mt)}}else{b(!0),re(!0),_e.current=i,Dw=i,_(We.current);return}Y.log(`Joining channel ${i}`),await ke(),Y.log("Join channel completed")}catch(Mt){Y.error("Error during initialization:",Mt)}finally{ve.current=!1}})(),()=>{Y.log("Cleaning up event listeners"),We.current.off("user-published",tt),We.current.off("user-unpublished",ut),We.current.off("user-joined",Ze),We.current.off("user-left",bt)}},[i,d,l,_,E]);const Ee=async()=>{if(!d||$)return $;Y.log("Initializing microphone");try{const tt=await YC.createMicrophoneAudioTrack();return await tt.setMuted(p),se(tt),Y.log("Microphone initialized successfully"),tt}catch(tt){return Y.error("Error initializing microphone:",tt),B("Failed to initialize microphone. Please check your permissions."),null}};D.useEffect(()=>{(async()=>{if(i)try{const bt=await Rg(i);bt&&bt.voiceDisabled?(Y.log("Voice is disabled for this space"),le(!0),E&&await we()):le(!1)}catch(Ze){Y.error("Error checking if voice is disabled:",Ze)}})();const ut=Ze=>{Ze.detail&&typeof Ze.detail.voiceDisabled=="boolean"&&(Y.log("Voice setting changed:",Ze.detail.voiceDisabled),le(Ze.detail.voiceDisabled),Ze.detail.voiceDisabled&&E?we():!Ze.detail.voiceDisabled&&!E&&d&&i&&ke())};return window.addEventListener("SpaceVoiceSettingChanged",ut),()=>{window.removeEventListener("SpaceVoiceSettingChanged",ut)}},[i,E,d]);const ke=async()=>{if(!d)return Y.log("Agora is disabled, not joining channel"),!1;if(de)return Y.log("Voice is disabled for this space, not joining channel"),B("Voice chat is disabled for this space"),!1;if(!i)return Y.error("AgoraProvider: No channel specified"),B("No channel specified"),!1;if(Y.log(`joinChannel called for channel ${i} with UID ${l}`),Y.log("Current state:",{isJoined:E,isJoining:pe,connectionState:We.current.connectionState,joinedChannel:_e.current}),E&&_e.current===i)return Y.log(`Already joined to channel: ${i}`),!0;if(pe)return Y.log("AgoraProvider: Already in the process of joining"),!1;if(We.current.connectionState==="CONNECTED")if(_e.current&&_e.current!==i){Y.log("Connected to different channel, leaving first");try{await we()}catch(tt){Y.error("Error leaving channel:",tt)}}else return Y.log("Client already connected, setting joined state to true"),b(!0),re(!0),_e.current=i,Dw=i,_(We.current),!0;if(We.current.connectionState==="CONNECTING")return Y.log("Client already connecting, waiting for connection"),q(!0),new Promise(tt=>{const ut=setInterval(()=>{We.current.connectionState==="CONNECTED"&&(clearInterval(ut),b(!0),q(!1),re(!0),_e.current=i,Dw=i,_(We.current),tt(!0))},500);setTimeout(()=>{clearInterval(ut),Y.log("AgoraProvider: Connection timeout, considering join failed"),q(!1),tt(!1)},1e4)});try{if(Y.log(`Joining channel: ${i} with UID: ${l||"random"}`),Y.log(`Using appId: ${e}, Type: ${typeof e}, Length: ${e.length}`),!e||e.trim()===""){const ut="AgoraProvider: App ID is empty or invalid";return Y.error(ut),B(ut),q(!1),!1}q(!0);const tt=l||Math.floor(Math.random()*1e6);return await We.current.join(e,i,o,tt),Y.log(`Joined channel successfully with UID: ${We.current.uid}`),b(!0),q(!1),re(!0),_e.current=i,Dw=i,_(We.current),!0}catch(tt){return Y.error("Error joining channel:",tt),B(`Error joining channel: ${tt.toString()}`),q(!1),!1}},we=async()=>{if(E)try{$&&await We.current.unpublish($),await We.current.leave(),Dw=null,_e.current=null,Y.log("Left channel successfully"),b(!1),L([])}catch(tt){Y.error("Error leaving channel:",tt),B(tt.message||"Failed to leave channel")}};D.useEffect(()=>()=>{$&&$.close()},[]),D.useEffect(()=>{d&&i&&(!E||_e.current!==i)&&ke()},[d,i,E]);const be=()=>{if(!$)return!1;try{return $.isActive&&!$.muted}catch(tt){return Y.error("Error checking microphone status:",tt),!1}};D.useEffect(()=>{const tt=()=>{const Ze=be();Ze!==C&&(Y.log("Syncing microphone state:",{actualStatus:Ze,currentState:C}),I(Ze),window.dispatchEvent(new CustomEvent("VoiceToggled",{detail:{enabled:Ze}})),window.agoraClient&&(window.agoraClient.isVoiceEnabled=Ze,window.agoraClient.microphoneTrack=$))};$&&tt();const ut=setInterval(tt,1e3);return()=>{clearInterval(ut)}},[$,C]);const Ie=async()=>{var tt;if(de)return Y.log("Voice is disabled for this space, cannot toggle"),xe({title:"Voice Chat Disabled",description:"Voice chat has been disabled for this space by the owner.",status:"info",duration:3e3,isClosable:!0}),!1;try{const ut=C!==void 0?C:$?!$.muted:!1;if(Y.log("AgoraProvider: Toggling voice, current state:",{isVoiceEnabled:C,currentState:ut,hasMicTrack:!!$,trackMuted:$==null?void 0:$.muted}),!$&&(Y.log("AgoraProvider: No microphone track, initializing..."),!await Ee()))return Y.error("AgoraProvider: Failed to initialize microphone"),ut;const Ze=!ut;if(Y.log("AgoraProvider: New voice state will be:",Ze),ut){if($)try{Y.log("AgoraProvider: Muting microphone track"),await $.setMuted(!0),$.muted||(Y.warn("AgoraProvider: Track not muted after setMuted(true), trying again"),await $.setEnabled(!1)),Y.log("AgoraProvider: Microphone track muted successfully, muted state:",$.muted)}catch(bt){return Y.error("Error muting track:",bt),ut}}else if($)try{We.current&&E&&!((tt=We.current.localTracks)!=null&&tt.includes($))&&(Y.log("AgoraProvider: Publishing microphone track"),await We.current.publish($),Y.log("AgoraProvider: Microphone track published successfully")),Y.log("AgoraProvider: Unmuting microphone track"),await $.setMuted(!1),$.muted&&(Y.warn("AgoraProvider: Track still muted after setMuted(false), trying again"),await $.setEnabled(!0)),Y.log("AgoraProvider: Microphone track unmuted successfully, muted state:",$.muted)}catch(bt){return Y.error("Error unmuting track:",bt),ut}return I(Ze),Ze}catch(ut){return Y.error("Error toggling voice:",ut),C}},Me=async tt=>{try{se(tt),Y.log("Microphone track updated successfully")}catch(ut){throw Y.error("Error updating microphone track:",ut),ut}},ze=async()=>{if(!We.current||!i)return Y.error("AgoraProvider: Voice chat not connected"),!1;try{if(Q)return Y.log("AgoraProvider: Stopping screen share"),ie&&(Array.isArray(ie)?(await We.current.unpublish(ie),ie.forEach(tt=>tt.close())):(await We.current.unpublish(ie),ie.close()),me(null)),J(!1),Y.log("AgoraProvider: Screen sharing stopped"),typeof window<"u"&&(window.agoraClient||(window.agoraClient={}),window.agoraClient.isScreenSharing=!1,window.agoraClient.screenTrack=null,window.dispatchEvent(new CustomEvent("ScreenShareToggled",{detail:{enabled:!1}}))),!1;Y.log("AgoraProvider: Starting screen share");try{const tt=await YC.createScreenVideoTrack({encoderConfig:"1080p_1",optimizationMode:"detail"});return Y.log("AgoraProvider: Screen track created:",tt),tt.on("track-ended",()=>{Y.log("AgoraProvider: Screen sharing ended by browser UI"),We.current.unpublish(tt),tt.close(),me(null),J(!1),typeof window<"u"&&(window.agoraClient||(window.agoraClient={}),window.agoraClient.isScreenSharing=!1,window.agoraClient.screenTrack=null,window.dispatchEvent(new CustomEvent("ScreenShareToggled",{detail:{enabled:!1}})))}),await We.current.publish(tt),me(tt),J(!0),Y.log("AgoraProvider: Screen sharing started"),typeof window<"u"&&(window.agoraClient||(window.agoraClient={}),window.agoraClient.isScreenSharing=!0,window.agoraClient.screenTrack=tt,window.dispatchEvent(new CustomEvent("ScreenShareToggled",{detail:{enabled:!0}}))),!0}catch(tt){return Y.error("AgoraProvider: Error creating screen track:",tt),J(!1),me(null),!1}}catch(tt){return Y.error("AgoraProvider: Error toggling screen share:",tt),J(!1),me(null),!1}};D.useEffect(()=>{if(Y.log("AgoraProvider: Initializing window.agoraClient"),typeof window<"u"){window.agoraClient={isVoiceEnabled:!1,isJoined:!1,client:We.current,isScreenSharing:!1,screenTrack:null};const tt=Ze=>{Y.log("AgoraProvider: Received ToggleScreenShare event"),ze().then(bt=>{Ze.detail&&Ze.detail.callback&&Ze.detail.callback(!0,bt)}).catch(bt=>{Y.error("AgoraProvider: Error handling ToggleScreenShare event:",bt),Ze.detail&&Ze.detail.callback&&Ze.detail.callback(!1,Q)})},ut=Ze=>{Y.log("AgoraProvider: Received JoinVoiceChat event"),ke().then(bt=>{Ze.detail&&Ze.detail.callback&&Ze.detail.callback(bt)}).catch(bt=>{Y.error("AgoraProvider: Error handling JoinVoiceChat event:",bt),Ze.detail&&Ze.detail.callback&&Ze.detail.callback(!1)})};return window.addEventListener("ToggleScreenShare",tt),window.addEventListener("JoinVoiceChat",ut),()=>{window.removeEventListener("ToggleScreenShare",tt),window.removeEventListener("JoinVoiceChat",ut),typeof window<"u"&&window.agoraClient&&(Y.log("AgoraProvider: Cleaning up window.agoraClient"),window.agoraClient=null)}}return()=>{typeof window<"u"&&window.agoraClient&&(Y.log("AgoraProvider: Cleaning up window.agoraClient"),window.agoraClient=null)}},[]),D.useEffect(()=>{Y.log("AgoraProvider: Voice enabled state changed:",C),typeof window<"u"&&(window.agoraClient||(window.agoraClient={}),window.agoraClient.isVoiceEnabled=C,window.agoraClient.microphoneTrack=$,window.agoraClient.client=We.current,window.dispatchEvent(new CustomEvent("VoiceToggled",{detail:{enabled:C}})),Y.log("AgoraProvider: Updated window.agoraClient and dispatched event:",{isVoiceEnabled:C}))},[C,$]);const Je={client:We.current,isJoined:E,isVoiceEnabled:C,users:O,error:V,channel:W,appId:e,toggleVoice:Ie,leaveChannel:we,joinChannel:ke,microphoneTrack:$,isReady:ue,createMicrophoneTrack:Me,isScreenSharing:Q,screenTrack:ie,toggleScreenShare:ze,voiceDisabled:de};return w.jsx(uae.Provider,{value:Je,children:n})},hae=()=>{const n=D.useContext(uae);if(!n)throw new Error("useAgoraContext must be used within an AgoraProvider");return n};dae.propTypes={children:mn.node.isRequired,appId:mn.string.isRequired,channel:mn.string.isRequired,token:mn.string,uid:mn.oneOfType([mn.string,mn.number])};const ize=()=>{var ve,_e;const{client:n,isVoiceEnabled:e,isJoined:i,users:o,error:l,microphoneTrack:d,isReady:p,channel:_,appId:E,toggleVoice:b,joinChannel:C,leaveChannel:I,createMicrophoneTrack:O,isScreenSharing:L,screenTrack:V,toggleScreenShare:B,voiceDisabled:W}=hae(),[Z,$]=D.useState(e!==void 0?e:((ve=window.agoraClient)==null?void 0:ve.isVoiceEnabled)||!1),[se,ue]=D.useState(L!==void 0?L:((_e=window.agoraClient)==null?void 0:_e.isScreenSharing)||!1),[re,pe]=D.useState(W!==void 0?W:!1),[q,Q]=D.useState(!0);D.useEffect(()=>{var Ee;e!==void 0?$(e):((Ee=window.agoraClient)==null?void 0:Ee.isVoiceEnabled)!==void 0?$(window.agoraClient.isVoiceEnabled):d&&$(!d.muted)},[e,d]),D.useEffect(()=>{var Ee;L!==void 0?ue(L):((Ee=window.agoraClient)==null?void 0:Ee.isScreenSharing)!==void 0&&ue(window.agoraClient.isScreenSharing)},[L]),D.useEffect(()=>{W!==void 0&&pe(W)},[W]);const J=D.useRef({isVoiceEnabled:Z,isScreenSharing:se,isJoined:i,users:o,error:l,isReady:p,channel:_,appId:E,voiceDisabled:re});D.useEffect(()=>{J.current={isVoiceEnabled:Z,isScreenSharing:se,isJoined:i,users:o,error:l,isReady:p,channel:_,appId:E,voiceDisabled:re}},[Z,se,i,o,l,p,_,E,re]),D.useEffect(()=>{const Ee=setTimeout(()=>{Q(!1)},5e3);return()=>clearTimeout(Ee)},[]),D.useEffect(()=>{p&&Q(!1)},[p]),D.useEffect(()=>{console.log("useVoiceChat context:",{contextIsVoiceEnabled:e,localVoiceEnabled:Z,contextIsScreenSharing:L,localScreenSharing:se,isJoined:i,users:o.length,error:l,isReady:p,channel:_,appId:E,hasMicrophoneTrack:!!d,trackMuted:d==null?void 0:d.muted,hasScreenTrack:!!V})},[e,Z,L,se,i,o,l,p,_,E,d,V]);const ie=async()=>{try{console.log("useVoiceChat: Toggling voice from:",Z);const Ee=await b();if(console.log("useVoiceChat: Toggle result:",Ee),Ee!==void 0)$(Ee);else{const ke=!Z;$(ke),window.agoraClient&&(window.agoraClient.isVoiceEnabled=ke)}return Ee!==void 0?Ee:!Z}catch(Ee){return console.error("useVoiceChat: Error toggling voice:",Ee),Z}},me=async()=>{try{console.log("useVoiceChat: Toggling screen share from:",se);const Ee=await B();if(console.log("useVoiceChat: Screen share toggle result:",Ee),Ee!==void 0)ue(Ee);else{const ke=!se;ue(ke),window.agoraClient&&(window.agoraClient.isScreenSharing=ke)}return Ee!==void 0?Ee:!se}catch(Ee){return console.error("useVoiceChat: Error toggling screen share:",Ee),se}},de=async()=>{Z&&d&&await ie()},le=async()=>{!Z&&d&&await ie()},xe=Ee=>o.some(ke=>{var we;return ke.uid===Ee&&((we=ke.audioTrack)==null?void 0:we.isPlaying)}),We=D.useCallback(()=>{if(!d||!Z)return 0;try{return d.getVolumeLevel()}catch(Ee){return console.error("Error getting volume level:",Ee),0}},[d,Z]);return{isVoiceEnabled:Z,isScreenSharing:se,isJoined:i,users:o,error:l,toggleVoice:ie,toggleScreenShare:me,mute:de,unmute:le,isUserSpeaking:xe,getVolumeLevel:We,microphoneTrack:d,screenTrack:V,isLoading:q,channel:_,appId:E,joinChannel:C,leaveChannel:I,client:n,setMicrophoneDevice:async Ee=>{try{if(!Ee){console.error("No device ID provided");return}if(!n||!i){console.error("Client not initialized or not joined to a channel");return}d&&(Z&&await n.unpublish(d),await d.close());const ke=await YC.createMicrophoneAudioTrack({microphoneId:Ee,encoderConfig:"music_standard"});O&&await O(ke),Z&&await n.publish(ke),console.log("Microphone device changed successfully")}catch(ke){throw console.error("Error changing microphone device:",ke),ke}},voiceDisabled:re}},sze=({size:n="md",tooltipPlacement:e="top",defaultMuted:i=!0,joinOnClick:o=!0,className:l="voice-button"})=>{const{isVoiceEnabled:d,toggleVoice:p,isJoined:_,joinChannel:E,channel:b,client:C,voiceDisabled:I}=ize(),[O,L]=D.useState(!1),[V,B]=D.useState(!1);D.useEffect(()=>{const $=()=>{Y.log("VoiceButton: Player instantiated, showing button"),B(!0)};return window.addEventListener("PlayerInstantiated",$),window.isPlayerInstantiated&&(Y.log("VoiceButton: Player was already instantiated"),B(!0)),()=>{window.removeEventListener("PlayerInstantiated",$)}},[]),D.useEffect(()=>{console.log("VoiceButton: State:",{isVoiceEnabled:d,isJoined:_,channel:b,hasClient:!!C,clientState:C==null?void 0:C.connectionState,windowAgoraClient:window.agoraClient,isPlayerReady:V,voiceDisabled:I})},[d,_,b,C,V,I]);const W=async()=>{if(!(O||I)){L(!0),console.log("VoiceButton: Handling click, current state:",{isVoiceEnabled:d,isJoined:_});try{if(!_&&o)try{console.log("VoiceButton: Not joined, attempting to join channel"),await E(),console.log("VoiceButton: Joined channel successfully")}catch(se){se.message&&se.message.includes("already in connecting/connected state")?console.log("VoiceButton: Already connected to channel"):console.error("VoiceButton: Error joining channel:",se)}console.log("VoiceButton: Toggling voice state from:",d);const $=await p();console.log("VoiceButton: Voice toggled, new state:",$)}catch($){console.error("VoiceButton: Error toggling voice:",$)}finally{L(!1)}}},Z=()=>I?"Voice chat is disabled for this space":V?O?"Processing...":_?d?"Turn microphone off":"Turn microphone on":"Connecting to voice chat...":"Waiting for player to be ready...";return!V||I?null:w.jsx(Mp,{label:Z(),placement:e,hasArrow:!0,children:w.jsxs(ft,{position:"relative",cursor:"pointer",onClick:W,children:[w.jsx(zl,{size:n,borderRadius:"full",bg:d?"green.500":"red.500",icon:d?w.jsx(IF,{color:"white"}):w.jsx(RF,{color:"white"}),borderWidth:"1px",borderColor:"whiteAlpha.300",className:l,"data-testid":"voice-button"}),O&&w.jsx(ft,{position:"absolute",top:"0",left:"0",right:"0",bottom:"0",display:"flex",alignItems:"center",justifyContent:"center",bg:"rgba(0, 0, 0, 0.6)",borderRadius:"full",children:w.jsx(jd,{size:"sm",color:"white"})})]})})},oze=fi.createContext({user:null}),aze=({userNickname:n})=>{const{client:e,channel:i,screenTrack:o,isScreenSharing:l,toggleScreenShare:d}=hae(),[p,_]=D.useState([]),[E,b]=D.useState(!1),[C,I]=D.useState(!0);D.useRef({});const O=D.useRef(null);D.useRef(null);const{user:L}=D.useContext(oze)||{user:null},[V,B]=D.useState({}),W=D.useRef(o),[Z,$]=D.useState(null),{isOpen:se,onOpen:ue,onClose:re}=hf(),[pe,q]=D.useState(!1),Q=D.useRef(null),J=D.useRef(null);D.useEffect(()=>{W.current=o},[o]),D.useEffect(()=>{if(!e||!i){b(!1);return}const xe=setTimeout(()=>{I(!1)},5e3);console.log("Setting up screen share display with existing client:",e),console.log("Current channel:",i);const We=e.connectionState;if(console.log("Current connection state:",We),We==="CONNECTED")b(!0),I(!1);else{b(!1);const $e=ve=>{console.log("Connection state changed:",ve),ve==="CONNECTED"?(b(!0),I(!1)):b(!1)};return e.on("connection-state-change",$e),()=>{e.off("connection-state-change",$e),clearTimeout(xe)}}return()=>{clearTimeout(xe)}},[e,i]),D.useEffect(()=>{const xe=async()=>{const We={...V};let $e=!1;for(const ve of p){if(V[ve.uid])continue;let _e=null,Ee=ve.uid;if(typeof Ee=="string"&&(Ee.includes("-")?(_e=Ee.split("-")[0],Ee=Ee.split("-")[1]):Ee.includes("_")&&(_e=Ee.split("_")[0],Ee=Ee.split("_")[1])),Ee)try{console.log("Trying to fetch nickname for user ID:",Ee);const ke=await Fu(Ee);ke&&ke.Nickname?(console.log("Found nickname in Firebase for user ID:",Ee,"Nickname:",ke.Nickname),We[ve.uid]=ke.Nickname,$e=!0):_e?(console.log("Using extracted name for user ID:",Ee,"Name:",_e),We[ve.uid]=_e,$e=!0):(We[ve.uid]="User",$e=!0)}catch(ke){console.error("Error fetching user profile:",ke),_e?(We[ve.uid]=_e,$e=!0):(We[ve.uid]="User",$e=!0)}else _e?(We[ve.uid]=_e,$e=!0):(We[ve.uid]="User",$e=!0)}$e&&B(We)};p.length>0&&xe()},[p,V]),D.useEffect(()=>{if(!e||!i||!E)return;console.log("Setting up screen share event handlers");const xe=async(ve,_e)=>{if(console.log("User published:",ve.uid,_e,ve),_e==="video"){console.log("Remote video track detected:",ve.uid);try{await e.subscribe(ve,_e),console.log("Subscribed to remote video track:",ve.uid),_(Ee=>Ee.some(ke=>ke.uid===ve.uid)?Ee:[...Ee,ve])}catch(Ee){console.error("Error subscribing to remote video track:",Ee)}}},We=(ve,_e)=>{if(console.log("User unpublished:",ve.uid,_e),_e==="video"){if(console.log("Remote video track unpublished:",ve.uid),ve.videoTrack)try{ve.videoTrack.stop()}catch(Ee){console.error("Error stopping video track:",Ee)}if(_(Ee=>Ee.filter(ke=>ke.uid!==ve.uid)),l&&W.current&&O.current)try{console.log("Ensuring local screen track is still playing after remote user unpublished"),W.current.play(O.current)}catch(Ee){console.error("Error replaying local screen track:",Ee)}}},$e=ve=>{console.log("User left:",ve.uid);const _e=p.find(Ee=>Ee.uid===ve.uid);if(_e&&_e.videoTrack)try{_e.videoTrack.stop()}catch(Ee){console.error("Error stopping video track:",Ee)}if(_(Ee=>Ee.filter(ke=>ke.uid!==ve.uid)),l&&W.current&&O.current)try{console.log("Ensuring local screen track is still playing after remote user left"),W.current.play(O.current)}catch(Ee){console.error("Error replaying local screen track:",Ee)}};return e.on("user-published",xe),e.on("user-unpublished",We),e.on("user-left",$e),()=>{e.off("user-published",xe),e.off("user-unpublished",We),e.off("user-left",$e)}},[e,i,E,p,l]),D.useEffect(()=>{if(console.log("Remote screens changed:",p.length,p),p.forEach(xe=>{if(xe.videoTrack)try{console.log("Playing video track for:",xe.uid),xe.videoTrack.play(`video-container-${xe.uid}`)}catch(We){console.error("Error playing video track:",We)}}),l&&W.current&&O.current)try{console.log("Ensuring local screen track is still playing after remote screens changed"),W.current.play(O.current)}catch(xe){console.error("Error replaying local screen track:",xe)}},[p,l]),D.useEffect(()=>{if(console.log("Local screen sharing state changed:",l,o),l&&o&&O.current)try{console.log("Playing local screen track"),o.play(O.current)}catch(xe){console.error("Error playing local screen track:",xe)}},[l,o]),D.useEffect(()=>()=>{if(p.forEach(xe=>{if(xe.videoTrack)try{xe.videoTrack.stop()}catch(We){console.error("Error stopping video track on unmount:",We)}}),o)try{o.stop()}catch(xe){console.error("Error stopping local screen track on unmount:",xe)}},[p,o]);const ie=()=>{console.log("Stopping local screen share"),d()},me=xe=>(console.log("Getting display name for UID:",xe,"type:",typeof xe),l&&L&&(xe===L.uid||xe===(e==null?void 0:e.uid))?n||"You":V[xe]?V[xe]:typeof xe=="string"?xe.includes("-")?xe.split("-")[0]:xe.includes("_")?xe.split("_")[0]:xe:"User"),de=xe=>{console.log("Opening modal for remote screen",xe),$(xe),ue()},le=()=>{console.log("Opening modal for local screen"),$({isLocal:!0}),ue()};return D.useEffect(()=>{se&&Z?(console.log("Modal opened, activeScreen:",Z),setTimeout(()=>{if(Z.isLocal&&W.current)try{console.log("Playing local screen in modal"),W.current.play("modal-screen-container"),q(!0)}catch(xe){console.error("Error playing local screen in modal:",xe)}else if(Z.videoTrack)try{console.log("Playing remote screen in modal"),Z.videoTrack.play("modal-screen-container"),q(!0)}catch(xe){console.error("Error playing remote screen in modal:",xe)}},500)):se||(q(!1),$(null),setTimeout(()=>{if(l&&W.current)try{W.current.play("local-screen-container")}catch(xe){console.error("Error playing local screen in small container:",xe)}p.forEach(xe=>{if(xe.videoTrack)try{xe.videoTrack.play(`video-container-${xe.uid}`)}catch(We){console.error(`Error playing remote screen ${xe.uid} in small container:`,We)}})},500))},[se,Z,l,p]),!E||C&&p.length===0&&!l||p.length===0&&!l?null:w.jsxs(w.Fragment,{children:[!se&&w.jsxs(ft,{position:"fixed",top:"20px",left:"20px",zIndex:1e4,overflow:"visible",ref:Q,children:[l&&o&&w.jsxs(ft,{position:"relative",mb:4,borderRadius:"md",overflow:"hidden",boxShadow:"xl",bg:"black",width:"200px",height:"120px",cursor:"pointer",transition:"all 0.2s",_hover:{filter:"brightness(0.8)",transform:"scale(1.05)"},onClick:le,children:[w.jsx(ft,{id:"local-screen-container",width:"100%",height:"100%",position:"relative"}),w.jsx(ft,{position:"absolute",bottom:2,left:2,color:"white",fontSize:"xs",bg:"rgba(0,0,0,0.5)",px:2,py:1,borderRadius:"md",zIndex:5,children:n?`${n}'s Screen`:"Your Screen"})]}),p.map(xe=>{const We=V[xe.uid]||me(xe.uid);return w.jsxs(ft,{position:"relative",mb:4,borderRadius:"md",overflow:"hidden",boxShadow:"xl",bg:"black",width:"200px",height:"120px",cursor:"pointer",transition:"all 0.2s",_hover:{filter:"brightness(0.8)",transform:"scale(1.05)"},onClick:()=>de(xe),children:[w.jsx(ft,{id:`video-container-${xe.uid}`,width:"100%",height:"100%",position:"relative"}),w.jsx(ft,{position:"absolute",bottom:2,left:2,color:"white",fontSize:"xs",bg:"rgba(0,0,0,0.5)",px:2,py:1,borderRadius:"md",zIndex:5,children:`${We}'s Screen`})]},xe.uid)})]}),se&&w.jsx(ft,{position:"fixed",top:"0",left:"0",width:"100vw",height:"100vh",bg:"rgba(0,0,0,0.8)",zIndex:1e4,display:"flex",justifyContent:"center",alignItems:"center",onClick:re,children:w.jsxs(ft,{width:"80vw",height:"80vh",bg:"black",borderRadius:"md",overflow:"hidden",position:"relative",onClick:xe=>xe.stopPropagation(),children:[!pe&&w.jsxs(ft,{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",color:"white",textAlign:"center",children:[w.jsx(jd,{size:"xl"}),w.jsx(nt,{mt:4,children:"Loading screen share..."})]}),w.jsx(ft,{id:"modal-screen-container",width:"100%",height:"100%",position:"relative",ref:J}),w.jsx(ft,{position:"absolute",top:2,right:2,color:"white",bg:"rgba(0,0,0,0.5)",borderRadius:"full",width:"30px",height:"30px",display:"flex",justifyContent:"center",alignItems:"center",cursor:"pointer",onClick:re,children:""}),w.jsx(ft,{position:"absolute",bottom:4,left:4,color:"white",fontSize:"sm",bg:"rgba(0,0,0,0.5)",px:3,py:2,borderRadius:"md",children:Z!=null&&Z.isLocal?n?`${n}'s Screen`:"Your Screen":`${V[Z==null?void 0:Z.uid]||me(Z==null?void 0:Z.uid)}'s Screen`}),(Z==null?void 0:Z.isLocal)&&w.jsx(ft,{position:"absolute",bottom:4,right:4,children:w.jsx(br,{colorScheme:"red",size:"sm",onClick:ie,children:"Stop Sharing"})})]})})]})},cze=({onClose:n})=>{const e=wc(),[i,o]=D.useState(!1),[l,d]=D.useState(!1);D.useEffect(()=>{const E=()=>{window.agoraClient&&d(!!window.agoraClient.isScreenSharing)};E();const b=setInterval(E,1e3),C=()=>{E()};return window.addEventListener("ScreenShareToggled",C),()=>{clearInterval(b),window.removeEventListener("ScreenShareToggled",C)}},[]);const p=async E=>{if(E.preventDefault(),E.stopPropagation(),n&&n(),!window.agoraClient||!window.agoraClient.client){e({title:"Screen sharing not available",description:"Voice chat must be connected to use screen sharing",status:"warning",duration:3e3,isClosable:!0});return}try{if(o(!0),window.agoraClient.isJoined)_();else{console.log("ScreenShareMenuOption: Not joined to voice chat, joining automatically");const b=new CustomEvent("JoinVoiceChat",{detail:{callback:C=>{if(!C){console.error("ScreenShareMenuOption: Failed to join voice chat"),e({title:"Connection failed",description:"Could not connect to voice chat",status:"error",duration:3e3,isClosable:!0}),o(!1);return}_()}}});window.dispatchEvent(b)}}catch(b){console.error("Error in screen share handler:",b),o(!1),e({title:"Screen sharing error",description:b.message||"Failed to toggle screen sharing",status:"error",duration:5e3,isClosable:!0})}},_=async()=>{try{const E=new CustomEvent("ToggleScreenShare",{detail:{callback:(b,C)=>{o(!1),b?(d(C),e(C?{title:"Screen sharing started",status:"success",duration:3e3,isClosable:!0}:{title:"Screen sharing stopped",status:"info",duration:3e3,isClosable:!0})):e({title:"Screen sharing error",description:"Failed to toggle screen sharing",status:"error",duration:5e3,isClosable:!0})}}});window.dispatchEvent(E)}catch(E){console.error("Error toggling screen share:",E),o(!1),e({title:"Screen sharing error",description:E.message||"Failed to toggle screen sharing",status:"error",duration:5e3,isClosable:!0})}};return w.jsx(nt,{fontSize:"md",cursor:"pointer",_hover:{bg:"whiteAlpha.200"},p:2,borderRadius:"md",onClick:p,color:l?"red.300":"white",children:i?"Connecting...":l?"Stop Screen Sharing":"Share Screen"})};function lze({open:n,onClose:e}){const[i,o]=D.useState(0);return w.jsxs(so,{isOpen:n,onClose:e,size:"md",isCentered:!0,children:[w.jsx(ao,{backdropFilter:"blur(4px)"}),w.jsxs(oo,{bg:"rgba(23, 25, 35, 0.95)",color:"white",borderRadius:"md",boxShadow:"0 4px 20px rgba(0, 0, 0, 0.5)",maxW:"600px",h:"350px",overflow:"hidden",children:[w.jsx(ec,{borderBottom:"1px solid",borderColor:"whiteAlpha.200",py:2,fontSize:"md",fontWeight:"600",children:"Controls"}),w.jsx(zo,{size:"sm",color:"whiteAlpha.700",_hover:{color:"white",bg:"whiteAlpha.100"}}),w.jsx(wo,{p:0,display:"flex",children:w.jsxs(pR,{orientation:"vertical",variant:"unstyled",index:i,onChange:o,display:"flex",flexGrow:1,children:[w.jsxs(mR,{bg:"rgba(0, 0, 0, 0.2)",w:"80px",py:4,borderRight:"1px solid",borderColor:"whiteAlpha.200",children:[w.jsxs(Sc,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[w.jsx(In,{as:M8e,mb:1}),w.jsx(nt,{fontSize:"xs",children:"Movement"})]}),w.jsxs(Sc,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[w.jsx(In,{as:U8e,mb:1}),w.jsx(nt,{fontSize:"xs",children:"Camera"})]}),w.jsxs(Sc,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[w.jsx(In,{as:x8e,mb:1}),w.jsx(nt,{fontSize:"xs",children:"Actions"})]}),w.jsxs(Sc,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[w.jsx(In,{as:L8e,mb:1}),w.jsx(nt,{fontSize:"xs",children:"Tips"})]})]}),w.jsxs(eN,{flexGrow:1,display:"flex",flexDirection:"column",children:[w.jsxs(xl,{p:4,display:"flex",flexDirection:"column",h:"100%",children:[w.jsx(nt,{fontSize:"sm",fontWeight:"600",mb:3,color:"blue.300",children:"Movement Controls"}),w.jsxs(Ar,{wrap:"wrap",gap:3,children:[w.jsx(Dl,{keyLabel:"W",description:"Move Forward"}),w.jsx(Dl,{keyLabel:"A",description:"Move Left"}),w.jsx(Dl,{keyLabel:"S",description:"Move Backward"}),w.jsx(Dl,{keyLabel:"D",description:"Move Right"}),w.jsx(Dl,{keyLabel:"Shift",description:"Run"}),w.jsx(Dl,{keyLabel:"Space",description:"Jump / Double Jump"})]})]}),w.jsxs(xl,{p:4,display:"flex",flexDirection:"column",h:"100%",children:[w.jsx(nt,{fontSize:"sm",fontWeight:"600",mb:3,color:"blue.300",children:"Camera Controls"}),w.jsxs(Ar,{wrap:"wrap",gap:3,children:[w.jsx(Dl,{keyLabel:"Mouse",description:"Look Around"}),w.jsx(Dl,{keyLabel:"Click + Drag",description:"Rotate Camera"}),w.jsx(Dl,{keyLabel:"Scroll",description:"Zoom In/Out"})]})]}),w.jsxs(xl,{p:4,display:"flex",flexDirection:"column",h:"100%",children:[w.jsx(nt,{fontSize:"sm",fontWeight:"600",mb:3,color:"blue.300",children:"Action Controls"}),w.jsxs(Ar,{wrap:"wrap",gap:3,children:[w.jsx(Dl,{keyLabel:"E",description:"Interact"}),w.jsx(Dl,{keyLabel:"F",description:"Emote Menu"}),w.jsx(Dl,{keyLabel:"T",description:"Chat"}),w.jsx(Dl,{keyLabel:"M",description:"Mute Mic"})]})]}),w.jsxs(xl,{p:4,display:"flex",flexDirection:"column",h:"100%",children:[w.jsx(nt,{fontSize:"sm",fontWeight:"600",mb:3,color:"blue.300",children:"Tips & Tricks"}),w.jsxs(Jr,{align:"stretch",spacing:2,children:[w.jsx(nt,{fontSize:"xs",children:" Double-tap Shift to auto-run"}),w.jsx(nt,{fontSize:"xs",children:" Press ESC to access settings"}),w.jsx(nt,{fontSize:"xs",children:" Click on players to view their profile"}),w.jsx(nt,{fontSize:"xs",children:" Use the minimap to navigate"})]})]})]})]})})]})]})}const Dl=({keyLabel:n,description:e})=>w.jsx(ft,{bg:"whiteAlpha.100",borderRadius:"md",p:2,minW:"120px",maxW:"180px",children:w.jsxs(wi,{spacing:2,children:[w.jsx(ft,{bg:"whiteAlpha.200",borderRadius:"md",px:2,py:1,fontSize:"xs",fontWeight:"bold",minW:"30px",textAlign:"center",children:n}),w.jsx(nt,{fontSize:"xs",children:e})]})}),uze=()=>{const[n,e]=D.useState([]),[i,o]=D.useState(""),[l,d]=D.useState(0),[p,_]=D.useState(100),[E,b]=D.useState(100),[C,I]=D.useState(!0),[O,L]=D.useState(!0),[V,B]=D.useState(!1);D.useEffect(()=>{(async()=>{try{await navigator.mediaDevices.getUserMedia({audio:!0});const re=await YC.getMicrophones();e(re),re.length>0&&o(re[0].deviceId)}catch(re){console.error("Error getting audio devices:",re)}})()},[]),D.useEffect(()=>{const ue=setInterval(()=>{d(V?Math.random()*50:0)},100);return()=>clearInterval(ue)},[V]);const W=ue=>{const re=ue.target.value;o(re),console.log("Microphone changed to:",re)},Z=ue=>{_(ue),console.log("Microphone volume set to:",ue)},$=ue=>{b(ue),console.log("Speaker volume set to:",ue)},se=()=>{B(!V)};return w.jsxs(Jr,{spacing:6,align:"stretch",children:[w.jsxs(Mr,{children:[w.jsxs(ns,{children:["Microphone",w.jsx(Ip,{ml:2,colorScheme:V?"green":"red",children:V?"Enabled":"Muted"})]}),w.jsxs(Ire,{value:i,onChange:W,bg:"gray.700",borderColor:"gray.600",_hover:{borderColor:"gray.500"},children:[n.map(ue=>w.jsx("option",{value:ue.deviceId,children:ue.label||`Microphone ${ue.deviceId.slice(0,5)}...`},ue.deviceId)),n.length===0&&w.jsx("option",{value:"",children:"No microphones found"})]})]}),w.jsxs(ft,{children:[w.jsx(nt,{mb:2,children:"Microphone Level"}),w.jsx(C0,{value:l,colorScheme:"green",size:"sm",borderRadius:"md",hasStripe:l>20,isAnimated:l>20})]}),w.jsxs(Mr,{children:[w.jsxs(ns,{children:["Microphone Volume: ",p,"%"]}),w.jsxs(UV,{value:p,onChange:Z,min:0,max:100,step:1,colorScheme:"blue",children:[w.jsx(FV,{bg:"gray.700",children:w.jsx(jV,{})}),w.jsx(VV,{boxSize:6})]})]}),w.jsxs(Mr,{children:[w.jsxs(ns,{children:["Speaker Volume: ",E,"%"]}),w.jsxs(UV,{value:E,onChange:$,min:0,max:100,step:1,colorScheme:"blue",children:[w.jsx(FV,{bg:"gray.700",children:w.jsx(jV,{})}),w.jsx(VV,{boxSize:6})]})]}),w.jsxs(Mr,{display:"flex",alignItems:"center",children:[w.jsx(ns,{mb:"0",children:"Microphone Enabled"}),w.jsx(of,{isChecked:V,onChange:se,colorScheme:"green",size:"lg"})]}),w.jsxs(Mr,{display:"flex",alignItems:"center",children:[w.jsx(ns,{mb:"0",children:"Echo Cancellation"}),w.jsx(of,{isChecked:C,onChange:()=>I(!C),colorScheme:"green",size:"lg"})]}),w.jsxs(Mr,{display:"flex",alignItems:"center",children:[w.jsx(ns,{mb:"0",children:"Noise Suppression"}),w.jsx(of,{isChecked:O,onChange:()=>L(!O),colorScheme:"green",size:"lg"})]}),w.jsxs(Cp,{status:"info",borderRadius:"md",children:[w.jsx(Rp,{}),"Note: These settings will be applied when you join a voice chat."]})]})};function dze({open:n,onClose:e,containerRef:i}){return w.jsx($l,{containerRef:i,children:w.jsxs(so,{isOpen:n,onClose:e,size:"lg",isCentered:!0,children:[w.jsx(ao,{}),w.jsxs(oo,{bg:"gray.900",color:"white",borderRadius:"lg",children:[w.jsx(ec,{children:"Settings"}),w.jsx(zo,{size:"lg",bg:"gray.700",color:"white",borderRadius:"full",_hover:{bg:"gray.600"},_focus:{boxShadow:"none"}}),w.jsx(wo,{children:w.jsxs(pR,{variant:"enclosed",children:[w.jsxs(mR,{mb:4,children:[w.jsx(Sc,{_selected:{color:"white",borderBottom:"2px solid white"},children:"Audio"}),w.jsx(Sc,{_selected:{color:"white",borderBottom:"2px solid white"},children:"Graphics"})]}),w.jsxs(eN,{children:[w.jsx(xl,{children:w.jsx(ft,{p:4,bg:"gray.800",borderRadius:"md",children:w.jsx(uze,{})})}),w.jsx(xl,{children:w.jsx(ft,{p:4,bg:"gray.800",borderRadius:"md",children:"Graphics settings content goes here."})})]})]})})]})]})})}function hze(n){return Or({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"circle",attr:{cx:"12",cy:"8",r:"7"}},{tag:"polyline",attr:{points:"8.21 13.89 7 23 12 20 17 23 15.79 13.88"}}]})(n)}function fze(n){return Or({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"}},{tag:"circle",attr:{cx:"12",cy:"13",r:"4"}}]})(n)}function d0(n){return Or({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"rect",attr:{x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2"}},{tag:"circle",attr:{cx:"8.5",cy:"8.5",r:"1.5"}},{tag:"polyline",attr:{points:"21 15 16 10 5 21"}}]})(n)}function fae(n){return Or({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"circle",attr:{cx:"12",cy:"12",r:"10"}},{tag:"line",attr:{x1:"12",y1:"16",x2:"12",y2:"12"}},{tag:"line",attr:{x1:"12",y1:"8",x2:"12.01",y2:"8"}}]})(n)}function pze(n){return Or({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"}},{tag:"path",attr:{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"}}]})(n)}function mze(n){return Or({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"circle",attr:{cx:"12",cy:"12",r:"3"}},{tag:"path",attr:{d:"M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"}}]})(n)}function gze(n){return Or({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polygon",attr:{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"}}]})(n)}function EC(n){return Or({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polyline",attr:{points:"3 6 5 6 21 6"}},{tag:"path",attr:{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"}},{tag:"line",attr:{x1:"10",y1:"11",x2:"10",y2:"17"}},{tag:"line",attr:{x1:"14",y1:"11",x2:"14",y2:"17"}}]})(n)}function PF(n){return Or({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}},{tag:"polyline",attr:{points:"17 8 12 3 7 8"}},{tag:"line",attr:{x1:"12",y1:"3",x2:"12",y2:"15"}}]})(n)}function zQ(n){return Or({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"}},{tag:"circle",attr:{cx:"9",cy:"7",r:"4"}},{tag:"path",attr:{d:"M23 21v-2a4 4 0 0 0-3-3.87"}},{tag:"path",attr:{d:"M16 3.13a4 4 0 0 1 0 7.75"}}]})(n)}function YS(n){return Or({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polygon",attr:{points:"23 7 16 12 23 17 23 7"}},{tag:"rect",attr:{x:"1",y:"5",width:"15",height:"14",rx:"2",ry:"2"}}]})(n)}function _ze(n){return Or({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polygon",attr:{points:"11 5 6 9 2 9 2 15 6 15 11 19 11 5"}},{tag:"path",attr:{d:"M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"}}]})(n)}const yze=async()=>{try{Y.log("tagsFirestore: Fetching all tags");const n=Yp(gr,"tags"),e=await Ky(n),i=[];return e.forEach(o=>{i.push({id:o.id,...o.data()})}),i}catch(n){throw Y.error("tagsFirestore: Error fetching tags:",n),n}},Eze=async n=>{try{Y.log(`tagsFirestore: Fetching tag with ID: ${n}`);const e=$r(gr,"tags",n),i=await To(e);return i.exists()?{id:i.id,...i.data()}:(Y.warn(`tagsFirestore: Tag with ID ${n} not found`),null)}catch(e){throw Y.error(`tagsFirestore: Error fetching tag with ID ${n}:`,e),e}},vze=async({id:n,name:e,color:i,description:o})=>{try{Y.log(`tagsFirestore: Creating new tag: ${e}`);const l={name:e,color:i||"#808080",description:o||"",createdAt:new Date,updatedAt:new Date};let d;if(n){const p=$r(gr,"tags",n);await M0(p,l),d=n}else{const p=Yp(gr,"tags");d=(await RBe(p,l)).id}return{id:d,...l}}catch(l){throw Y.error("tagsFirestore: Error creating tag:",l),l}},Sze=async(n,e)=>{try{Y.log(`tagsFirestore: Adding tag ${e} to space ${n}`);const i=$r(gr,"tags",e);if(!(await To(i)).exists())throw new Error(`Tag with ID ${e} does not exist`);const l=$r(gr,"spaces",n);return await Co(l,{tags:IBe(e)}),!0}catch(i){throw Y.error(`tagsFirestore: Error adding tag ${e} to space ${n}:`,i),i}},bze=async(n,e)=>{try{Y.log(`tagsFirestore: Removing tag ${e} from space ${n}`);const i=$r(gr,"spaces",n);return await Co(i,{tags:ABe(e)}),!0}catch(i){throw Y.error(`tagsFirestore: Error removing tag ${e} from space ${n}:`,i),i}},Tze=async n=>{try{Y.log(`tagsFirestore: Getting tags for space ${n}`);const e=$r(gr,"spaces",n),i=await To(e);if(!i.exists())throw new Error(`Space with ID ${n} not found`);const l=i.data().tags||[];if(l.length===0)return[];const d=[];for(const p of l){const _=await Eze(p);_&&d.push(_)}return d}catch(e){throw Y.error(`tagsFirestore: Error getting tags for space ${n}:`,e),e}},wze=async()=>{Y.log("tagsFirestore: Initializing default tags");const n=[{id:"collaboration",name:"Collaboration",color:"#4287f5",description:"Spaces designed for team collaboration and meetings"},{id:"social",name:"Social",color:"#f54242",description:"Social gathering and networking spaces"},{id:"education",name:"Education",color:"#42f581",description:"Learning and educational environments"},{id:"events",name:"Events",color:"#f5a742",description:"Spaces optimized for hosting events"},{id:"showcase",name:"Showcase",color:"#9f42f5",description:"Spaces for exhibiting content and creations"},{id:"entertainment",name:"Entertainment",color:"#f542b3",description:"Entertainment and leisure spaces"},{id:"productivity",name:"Productivity",color:"#42dbf5",description:"Spaces focused on work and productivity"},{id:"featured",name:"Featured",color:"#f5f242",description:"Featured and highlighted spaces"}];try{let e=0,i=0;for(const o of n){Y.log(`tagsFirestore: Processing tag: ${o.name}`);const l=$r(gr,"tags",o.id);(await To(l)).exists()?(Y.log(`tagsFirestore: Tag ${o.id} already exists, skipping`),i++):(await vze(o),e++,Y.log(`tagsFirestore: Created tag: ${o.name}`))}return Y.log(`tagsFirestore: Tags initialization complete. Created: ${e}, Skipped: ${i}`),{created:e,skipped:i}}catch(e){throw Y.error("tagsFirestore: Error initializing default tags:",e),e}},pae=({spaceID:n})=>{const[e,i]=D.useState([]),[o,l]=D.useState([]),[d,p]=D.useState(!0),[_,E]=D.useState(!1),[b,C]=D.useState(!1),[I,O]=D.useState(null),{isOpen:L,onOpen:V,onClose:B}=hf(),W=wc(),{user:Z}=D.useContext(Go),$=(Z==null?void 0:Z.groups)&&(Z.groups.includes("disruptiveAdmin")||Z.groups.includes("admin"));D.useEffect(()=>{se()},[n]);const se=async()=>{p(!0);try{let J=[];try{J=await yze(),i(J)}catch(ie){Y.error("SpaceTagsManager: Error loading available tags:",ie),i([]),W({title:"Error loading tags",description:"Failed to load available tags. Please try again later.",status:"error",duration:3e3,isClosable:!0})}if(n)try{const ie=await Tze(n);l(ie)}catch(ie){Y.error("SpaceTagsManager: Error loading space tags:",ie),l([]),W({title:"Error loading space tags",description:"Failed to load this space's tags. Please try again later.",status:"error",duration:3e3,isClosable:!0})}}catch(J){Y.error("SpaceTagsManager: Error in loadTags:",J),W({title:"Error loading tags",description:"Failed to load tags. Please try again later.",status:"error",duration:3e3,isClosable:!0})}finally{p(!1)}},ue=async()=>{C(!0),O(null);try{const J=await wze();console.log("Tag initialization result:",J),O(J),W({title:"Tags initialized",description:`Successfully created ${J.created} tags. Skipped ${J.skipped} existing tags.`,status:"success",duration:4e3,isClosable:!0}),await se()}catch(J){Y.error("SpaceTagsManager: Error initializing tags:",J),O(!1),W({title:"Error initializing tags",description:"Failed to initialize tags. Please try again later.",status:"error",duration:4e3,isClosable:!0})}finally{C(!1)}},re=async J=>{if(!(!n||!J)){E(!0);try{await Sze(n,J);const ie=e.find(me=>me.id===J);ie&&l(me=>[...me,ie]),W({title:"Tag added",description:"Tag has been added to the space.",status:"success",duration:2e3,isClosable:!0})}catch(ie){Y.error(`SpaceTagsManager: Error adding tag ${J} to space:`,ie),W({title:"Error adding tag",description:"Failed to add tag to the space.",status:"error",duration:3e3,isClosable:!0})}finally{E(!1)}}},pe=async J=>{if(!(!n||!J)){E(!0);try{await bze(n,J),l(ie=>ie.filter(me=>me.id!==J)),W({title:"Tag removed",description:"Tag has been removed from the space.",status:"info",duration:2e3,isClosable:!0})}catch(ie){Y.error(`SpaceTagsManager: Error removing tag ${J} from space:`,ie),W({title:"Error removing tag",description:"Failed to remove tag from the space.",status:"error",duration:3e3,isClosable:!0})}finally{E(!1)}}},q=()=>{const J=o.map(ie=>ie.id);return e.filter(ie=>!J.includes(ie.id))},Q=q().length===0;return w.jsxs(ft,{children:[w.jsx(Ar,{mb:3,justifyContent:"space-between",alignItems:"center",children:w.jsxs(wi,{spacing:2,ml:"auto",children:[$&&w.jsx(br,{size:"xs",leftIcon:w.jsx(dWe,{}),onClick:V,variant:"outline",colorScheme:"purple",children:"Admin"}),w.jsxs(dR,{children:[w.jsx(hR,{as:br,size:"xs",leftIcon:w.jsx(uWe,{}),rightIcon:w.jsx(Moe,{}),isDisabled:d||_||Q,children:Q?"No Available Tags":"Add Tag"}),w.jsx(fR,{zIndex:1e3,bg:"gray.800",borderColor:"gray.700",color:"white",children:q().length>0?q().map(J=>w.jsx(Dd,{onClick:()=>re(J.id),icon:w.jsx(ft,{width:"12px",height:"12px",borderRadius:"full",bg:J.color||"#888"}),_hover:{bg:"gray.700"},_focus:{bg:"gray.700"},_active:{bg:"gray.700"},_focusVisible:{bg:"gray.700"},bg:"gray.800",color:"white",children:J.name},J.id)):w.jsx(Dd,{isDisabled:!0,bg:"gray.800",color:"gray.400",children:"No available tags to add"})})]})]})}),d?w.jsx(Ar,{justify:"center",py:4,children:w.jsx(jd,{size:"sm",color:"blue.300"})}):e.length===0?w.jsx(ft,{children:w.jsxs(nt,{fontSize:"sm",color:"red.400",mb:2,children:["No tags have been created in the system yet.",$?" Use the Admin button to initialize tags.":" Ask an admin to initialize tags."]})}):o.length===0?w.jsx(nt,{fontSize:"sm",color:"gray.400",fontStyle:"italic",children:"No tags assigned to this space."}):w.jsx(Vre,{spacing:2,children:o.map(J=>w.jsx(u4,{children:w.jsxs(Dre,{size:"md",borderRadius:"full",variant:"subtle",colorScheme:"gray",boxShadow:`0 0 0 1px ${J.color||"#888"}`,children:[w.jsx(ft,{width:"8px",height:"8px",borderRadius:"full",bg:J.color||"#888",mr:1}),w.jsx(xre,{children:J.name}),w.jsx(Mre,{onClick:()=>pe(J.id),isDisabled:_})]})},J.id))}),w.jsxs(so,{isOpen:L,onClose:B,size:"md",children:[w.jsx(ao,{backdropFilter:"blur(4px)"}),w.jsxs(oo,{bg:"gray.800",color:"white",children:[w.jsx(ec,{fontSize:"md",children:"Tag System Administration"}),w.jsx(zo,{}),w.jsxs(wo,{children:[w.jsx(nt,{fontSize:"sm",mb:4,children:"Initialize the default tags in your Firestore database. This will create a set of predefined tags if they don't already exist."}),I&&w.jsxs(Cp,{status:"success",mb:4,borderRadius:"md",size:"sm",children:[w.jsx(Rp,{}),w.jsxs(nt,{fontSize:"sm",children:["Tags initialized. Created: ",w.jsx("b",{children:I.created}),", Skipped: ",w.jsx("b",{children:I.skipped})]})]}),w.jsx(br,{colorScheme:"blue",onClick:ue,isLoading:b,loadingText:"Initializing...",size:"sm",width:"full",children:"Initialize Default Tags"})]}),w.jsx(zp,{children:w.jsx(br,{variant:"ghost",size:"sm",onClick:B,children:"Close"})})]})]})]})};pae.propTypes={spaceID:mn.string.isRequired};const Cze=({isOpen:n,onClose:e})=>{const{spaceID:i}=ba(),[o,l]=D.useState(0),[d,p]=D.useState(""),[_,E]=D.useState(""),[b,C]=D.useState(!1),[I,O]=D.useState(null),[L,V]=D.useState(null),[B,W]=D.useState(!1),[Z,$]=D.useState(0),[se,ue]=D.useState(null),re=D.useRef(null),[pe,q]=D.useState(null),[Q,J]=D.useState(null),[ie,me]=D.useState(!1),[de,le]=D.useState(0),[xe,We]=D.useState(null),$e=D.useRef(null),[ve,_e]=D.useState([]),[Ee,ke]=D.useState([]),[we,be]=D.useState(!1),[Ie,Me]=D.useState(!1),[ze,Je]=D.useState(!0),[tt,ut]=D.useState(!1),[Ze,bt]=D.useState(!1),[on,Mt]=D.useState(""),[Zt,an]=D.useState(""),[Ht,jn]=D.useState(""),[Wt,Re]=D.useState(!1),{setHLSStreamUrl:Fe,savedStreamData:Ge}=Zoe(),at=wc();D.useEffect(()=>{n&&i&&yt()},[n,i]);const yt=async()=>{try{const Ot=await Rg(i);Ot.logoUrl&&ue(Ot.logoUrl),Ot.backgroundUrl&&We(Ot.backgroundUrl),Ot.voiceDisabled!==void 0&&Me(Ot.voiceDisabled),Ot.accessibleToAllUsers!==void 0&&Je(Ot.accessibleToAllUsers),p(Ot.name||""),E(Ot.description||"");try{const On=await Doe(i);if(On){Mt(On.streamUrl||""),an(On.rtmpUrl||""),jn(On.streamKey||"");const or=On.enabled===!0;bt(or),Y.log("SpaceManageModal: Directly loaded streaming enabled state from Firebase:",{enabled:or,rawValue:On.enabled})}else bt(!1),Y.log("SpaceManageModal: No stream data found in Firebase, defaulting enabled to false")}catch(On){if(Y.error("Error fetching stream data directly:",On),Ge){Mt(Ge.streamUrl||""),an(Ge.rtmpUrl||""),jn(Ge.streamKey||"");const or=Ge.enabled===!0;bt(or),Y.log("SpaceManageModal: Loaded streaming enabled state from savedStreamData:",{enabled:or,rawValue:Ge.enabled})}else bt(!1),Y.log("SpaceManageModal: No savedStreamData available, defaulting enabled to false")}vt(Ot)}catch(Ot){Y.error("Error fetching space data:",Ot),at({title:"Error",description:"Failed to load space data",status:"error",duration:3e3,isClosable:!0})}};D.useEffect(()=>{if(Ge){if(!Wt){Mt(Ge.streamUrl||""),an(Ge.rtmpUrl||""),jn(Ge.streamKey||"");const Ot=Ge.enabled===!0;bt(Ot),Y.log("SpaceManageModal: Updated streaming enabled state from savedStreamData:",{enabled:Ot,rawValue:Ge.enabled})}}else n&&!Wt&&Y.log("SpaceManageModal: No savedStreamData available but NOT defaulting enabled to false (preserving current state)")},[Ge,Wt,n]);const vt=async Ot=>{if(i&&n){be(!0);try{const On=hF(),or=`space_${i}_owners`,Fi=_1(Yp(On,"users"),rQ("groups","array-contains",or)),Cc=await Ky(Fi),us=[];for(const co of Cc.docs){const Es=co.data(),ds=await Fu(co.id);us.push({uid:co.id,email:Es.email,displayName:Es.displayName||ds.Nickname||"Unknown User",photoURL:Es.photoURL||ds.photoURL,firstName:ds.firstName,lastName:ds.lastName})}_e(us);const Ta=`space_${i}_hosts`,Io=_1(Yp(On,"users"),rQ("groups","array-contains",Ta)),wa=await Ky(Io),Ca=[];for(const co of wa.docs){const Es=co.data(),ds=await Fu(co.id);Ca.push({uid:co.id,email:Es.email,displayName:Es.displayName||ds.Nickname||"Unknown User",photoURL:Es.photoURL||ds.photoURL,firstName:ds.firstName,lastName:ds.lastName})}ke(Ca)}catch(On){Y.error("Error fetching space users:",On),at({title:"Error",description:"Failed to load space users",status:"error",duration:3e3,isClosable:!0})}finally{be(!1)}}};D.useEffect(()=>{i&&n&&o===4&&vt()},[i,n,o]);const Gt=Ot=>{const On=Ot.target.files[0];if(On){if(!On.type.startsWith("image/")){at({title:"Invalid file type",description:"Please select an image file",status:"error",duration:5e3,isClosable:!0});return}O(On);const or=new FileReader;or.onloadend=()=>{V(or.result)},or.readAsDataURL(On)}},gn=Ot=>{const On=Ot.target.files[0];if(On){if(!On.type.startsWith("image/")){at({title:"Invalid file type",description:"Please select an image file",status:"error",duration:5e3,isClosable:!0});return}q(On);const or=new FileReader;or.onloadend=()=>{J(or.result)},or.readAsDataURL(On)}},Pn=async()=>{if(!I){at({title:"No file selected",description:"Please select a file to upload",status:"warning",duration:5e3,isClosable:!0});return}try{W(!0);const Ot=setInterval(()=>{$(or=>{const Fi=or+10;return Fi>=90?90:Fi})},300),On=await rWe(i,I);clearInterval(Ot),$(100),ue(On),at({title:"Upload successful",description:"Space logo has been updated",status:"success",duration:5e3,isClosable:!0}),setTimeout(()=>{O(null),V(null),$(0),W(!1)},1e3),window.dispatchEvent(new CustomEvent("SpaceLogoUpdated",{detail:{logoUrl:On}}))}catch(Ot){console.error("Error uploading logo:",Ot),at({title:"Upload failed",description:Ot.message||"An error occurred during upload",status:"error",duration:5e3,isClosable:!0}),W(!1),$(0)}},un=async()=>{if(!pe){at({title:"No file selected",description:"Please select a file to upload",status:"warning",duration:5e3,isClosable:!0});return}try{me(!0);const Ot=setInterval(()=>{le(or=>{const Fi=or+10;return Fi>=90?90:Fi})},300),On=await sWe(i,pe);clearInterval(Ot),le(100),We(On),at({title:"Upload successful",description:"Space background has been updated",status:"success",duration:5e3,isClosable:!0}),setTimeout(()=>{q(null),J(null),le(0),me(!1)},1e3),window.dispatchEvent(new CustomEvent("SpaceBackgroundUpdated",{detail:{backgroundUrl:On}}))}catch(Ot){console.error("Error uploading background:",Ot),at({title:"Upload failed",description:Ot.message||"An error occurred during upload",status:"error",duration:5e3,isClosable:!0}),me(!1),le(0)}},wt=async()=>{if(se)try{W(!0),await iWe(i),ue(null),at({title:"Logo removed",description:"Space logo has been removed",status:"info",duration:5e3,isClosable:!0}),W(!1),window.dispatchEvent(new CustomEvent("SpaceLogoUpdated",{detail:{logoUrl:null}}))}catch(Ot){console.error("Error deleting logo:",Ot),at({title:"Deletion failed",description:Ot.message||"An error occurred during deletion",status:"error",duration:5e3,isClosable:!0}),W(!1)}},lr=async()=>{if(xe)try{me(!0),await oWe(i),We(null),at({title:"Background removed",description:"Space background has been removed",status:"info",duration:5e3,isClosable:!0}),me(!1),window.dispatchEvent(new CustomEvent("SpaceBackgroundUpdated",{detail:{backgroundUrl:null}}))}catch(Ot){console.error("Error deleting background:",Ot),at({title:"Deletion failed",description:Ot.message||"An error occurred during deletion",status:"error",duration:5e3,isClosable:!0}),me(!1)}},Dt=()=>{re.current&&re.current.click()},qt=()=>{$e.current&&$e.current.click()},Qr=async()=>{ut(!0);try{await aWe(i,{voiceDisabled:!Ie}),Me(!Ie),at({title:"Settings Updated",description:`Voice chat has been ${Ie?"enabled":"disabled"} for this space.`,status:"success",duration:3e3,isClosable:!0})}catch(Ot){Y.error("Error updating voice settings:",Ot),at({title:"Error",description:"Failed to update voice settings",status:"error",duration:3e3,isClosable:!0})}finally{ut(!1)}},Hi=async()=>{ut(!0);try{await cWe(i,!ze),Je(!ze),at({title:"Settings Updated",description:`Space is now ${ze?"not accessible":"accessible"} to all users.`,status:"success",duration:3e3,isClosable:!0})}catch(Ot){Y.error("Error updating accessibility settings:",Ot),at({title:"Error",description:"Failed to update accessibility settings",status:"error",duration:3e3,isClosable:!0})}finally{ut(!1)}},Vs=async()=>{if(i){C(!0);try{const Ot=hF(),On=$r(Ot,"spaces",i);await Co(On,{name:d,description:_}),at({title:"Success",description:"Space details updated successfully",status:"success",duration:3e3,isClosable:!0}),window.dispatchEvent(new CustomEvent("SpaceDetailsUpdated",{detail:{name:d,description:_}}))}catch(Ot){Y.error("Error updating space details:",Ot),at({title:"Error",description:"Failed to update space details",status:"error",duration:3e3,isClosable:!0})}finally{C(!1)}}},ai=async()=>{if(i){Re(!0);try{const Ot={enabled:Ze,streamUrl:on,rtmpUrl:Zt,streamKey:Ht,playerIndex:"0",updatedAt:new Date().toISOString()};Y.log("SpaceManageModal: Saving stream settings to Firebase:",{enabled:Ze,url:on,hasRtmp:!!Zt,hasKey:!!Ht});try{await gF(i,Ot),Y.log("SpaceManageModal: Successfully updated stream settings in Firebase directly")}catch(On){throw Y.error("SpaceManageModal: Error updating stream settings directly in Firebase:",On),On}await Fe(on,0,{enabled:Ze,rtmpUrl:Zt,streamKey:Ht}),window.dispatchEvent(new CustomEvent("StreamSettingsChanged",{detail:{enabled:Ze,spaceId:i}})),at({title:"Success",description:`Stream settings updated successfully. Streaming is now ${Ze?"enabled":"disabled"}.`,status:"success",duration:3e3,isClosable:!0}),setTimeout(()=>{yt()},500)}catch(Ot){Y.error("Error updating stream settings:",Ot),at({title:"Error",description:"Failed to update stream settings",status:"error",duration:3e3,isClosable:!0})}finally{Re(!1)}}};return w.jsxs(so,{isOpen:n,onClose:e,size:"lg",isCentered:!0,children:[w.jsx(ao,{backdropFilter:"blur(4px)"}),w.jsxs(oo,{bg:"rgba(23, 25, 35, 0.95)",color:"white",borderRadius:"md",boxShadow:"0 4px 20px rgba(0, 0, 0, 0.5)",maxW:"800px",maxH:"90vh",overflow:"hidden",children:[w.jsx(ec,{borderBottom:"1px solid",borderColor:"whiteAlpha.200",py:2,fontSize:"md",fontWeight:"600",children:"Manage Space"}),w.jsx(zo,{size:"sm",color:"whiteAlpha.700",_hover:{color:"white",bg:"whiteAlpha.100"}}),w.jsx(wo,{p:0,display:"flex",overflow:"hidden",children:w.jsxs(pR,{orientation:"vertical",variant:"unstyled",index:o,onChange:l,display:"flex",width:"100%",height:"100%",children:[w.jsxs(mR,{bg:"rgba(0, 0, 0, 0.2)",w:"80px",py:4,borderRight:"1px solid",borderColor:"whiteAlpha.200",flexShrink:0,children:[w.jsxs(Sc,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[w.jsx(In,{as:fae,mb:1}),w.jsx(nt,{fontSize:"xs",children:"Details"})]}),w.jsxs(Sc,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[w.jsx(In,{as:d0,mb:1}),w.jsx(nt,{fontSize:"xs",children:"Logo"})]}),w.jsxs(Sc,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[w.jsx(In,{as:fze,mb:1}),w.jsx(nt,{fontSize:"xs",children:"Background"})]}),w.jsxs(Sc,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[w.jsx(In,{as:mze,mb:1}),w.jsx(nt,{fontSize:"xs",children:"Settings"})]}),w.jsxs(Sc,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[w.jsx(In,{as:zQ,mb:1}),w.jsx(nt,{fontSize:"xs",children:"Users"})]}),w.jsxs(Sc,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[w.jsx(In,{as:YS,mb:1}),w.jsx(nt,{fontSize:"xs",children:"Stream"})]})]}),w.jsxs(eN,{flexGrow:1,display:"flex",flexDirection:"column",overflowY:"auto",css:{"&::-webkit-scrollbar":{width:"8px"},"&::-webkit-scrollbar-track":{background:"rgba(0,0,0,0.1)"},"&::-webkit-scrollbar-thumb":{background:"rgba(255,255,255,0.3)",borderRadius:"4px"}},children:[w.jsxs(xl,{p:4,display:"flex",flexDirection:"column",children:[w.jsx(nt,{fontSize:"sm",fontWeight:"600",mb:3,color:"blue.300",children:"Space Details"}),w.jsxs(Jr,{spacing:4,align:"stretch",children:[w.jsxs(Mr,{children:[w.jsx(ns,{fontSize:"xs",children:"Space Name"}),w.jsx(pi,{value:d,onChange:Ot=>p(Ot.target.value),placeholder:"Enter space name",size:"sm",bg:"whiteAlpha.100",borderColor:"whiteAlpha.200",_hover:{borderColor:"whiteAlpha.300"},_focus:{borderColor:"blue.300",boxShadow:"0 0 0 1px #63B3ED"},color:"white",maxLength:100})]}),w.jsxs(Mr,{children:[w.jsx(ns,{fontSize:"xs",children:"Description"}),w.jsx(Ure,{value:_,onChange:Ot=>E(Ot.target.value),placeholder:"Enter space description",size:"sm",bg:"whiteAlpha.100",borderColor:"whiteAlpha.200",_hover:{borderColor:"whiteAlpha.300"},_focus:{borderColor:"blue.300",boxShadow:"0 0 0 1px #63B3ED"},rows:4,resize:"vertical",maxLength:500})]}),w.jsxs(Mr,{children:[w.jsx(ns,{fontSize:"xs",children:"Space Tags"}),w.jsx(ft,{p:3,bg:"whiteAlpha.50",borderWidth:"1px",borderColor:"whiteAlpha.200",borderRadius:"md",children:i?w.jsx(pae,{spaceID:i}):w.jsxs(Cp,{status:"warning",variant:"subtle",borderRadius:"md",children:[w.jsx(Rp,{}),w.jsx($S,{fontSize:"sm",children:"Space ID missing"}),w.jsx(KS,{fontSize:"xs",children:"Unable to load tags without a valid space ID."})]})})]}),w.jsx(br,{colorScheme:"blue",size:"sm",onClick:Vs,isLoading:b,loadingText:"Saving...",alignSelf:"flex-start",mt:2,children:"Save Details"})]})]}),w.jsxs(xl,{p:4,display:"flex",flexDirection:"column",children:[w.jsx(nt,{fontSize:"sm",fontWeight:"600",mb:3,color:"blue.300",children:"Space Logo"}),w.jsx(nt,{fontSize:"xs",mb:4,children:"Upload a logo for your space. This will be displayed during loading."}),(se||L)&&w.jsxs(Ar,{direction:{base:"column",md:"row"},gap:4,mb:4,children:[se&&w.jsxs(ft,{borderWidth:"1px",borderRadius:"md",p:3,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",flex:"1",children:[w.jsx(nt,{fontSize:"xs",fontWeight:"medium",mb:2,children:"Current Logo"}),w.jsx(Yh,{src:se,alt:"Space Logo",maxH:"120px",mx:"auto",objectFit:"contain"}),w.jsx(br,{mt:3,colorScheme:"red",leftIcon:w.jsx(In,{as:EC}),onClick:wt,isLoading:B,loadingText:"Removing...",size:"xs",variant:"ghost",children:"Remove Logo"})]}),L&&w.jsxs(ft,{borderWidth:"1px",borderRadius:"md",p:3,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",flex:"1",children:[w.jsx(nt,{fontSize:"xs",fontWeight:"medium",mb:2,children:"Preview"}),w.jsx(Yh,{src:L,alt:"Preview",maxH:"120px",mx:"auto",objectFit:"contain"})]})]}),w.jsxs(Mr,{children:[w.jsx(ns,{fontSize:"xs",children:"Upload New Logo"}),w.jsx(pi,{type:"file",accept:"image/*",onChange:Gt,ref:re,display:"none"}),B&&w.jsxs(ft,{mt:3,mb:3,children:[w.jsxs(nt,{fontSize:"xs",mb:1,children:["Uploading... ",Z,"%"]}),w.jsx(C0,{value:Z,size:"xs",colorScheme:"blue",borderRadius:"full"})]}),w.jsxs(wi,{mt:3,spacing:3,children:[w.jsx(br,{colorScheme:"blue",leftIcon:w.jsx(In,{as:d0}),onClick:Dt,isDisabled:B,size:"sm",variant:"outline",children:"Browse"}),w.jsx(br,{colorScheme:"green",leftIcon:w.jsx(In,{as:PF}),onClick:Pn,isLoading:B,loadingText:"Uploading...",isDisabled:!I||B,size:"sm",children:"Upload"})]}),w.jsx(E0,{fontSize:"xs",color:"whiteAlpha.700",mt:2,children:"Recommended: PNG format with transparent background. Max height: 400px."})]})]}),w.jsxs(xl,{p:4,display:"flex",flexDirection:"column",children:[w.jsx(nt,{fontSize:"sm",fontWeight:"600",mb:3,color:"blue.300",children:"Loading Background"}),w.jsx(nt,{fontSize:"xs",mb:4,children:"Upload a background image for your space. This will be displayed during loading."}),(xe||Q)&&w.jsxs(Ar,{direction:{base:"column",md:"row"},gap:4,mb:4,children:[xe&&w.jsxs(ft,{borderWidth:"1px",borderRadius:"md",p:3,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",flex:"1",children:[w.jsx(nt,{fontSize:"xs",fontWeight:"medium",mb:2,children:"Current Background"}),w.jsx(Yh,{src:xe,alt:"Space Background",maxH:"120px",mx:"auto",objectFit:"contain"}),w.jsx(br,{mt:3,colorScheme:"red",leftIcon:w.jsx(In,{as:EC}),onClick:lr,isLoading:ie,loadingText:"Removing...",size:"xs",variant:"ghost",children:"Remove Background"})]}),Q&&w.jsxs(ft,{borderWidth:"1px",borderRadius:"md",p:3,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",flex:"1",children:[w.jsx(nt,{fontSize:"xs",fontWeight:"medium",mb:2,children:"Preview"}),w.jsx(Yh,{src:Q,alt:"Preview",maxH:"120px",mx:"auto",objectFit:"contain"})]})]}),w.jsxs(Mr,{children:[w.jsx(ns,{fontSize:"xs",children:"Upload New Background"}),w.jsx(pi,{type:"file",accept:"image/*",onChange:gn,ref:$e,display:"none"}),ie&&w.jsxs(ft,{mt:3,mb:3,children:[w.jsxs(nt,{fontSize:"xs",mb:1,children:["Uploading... ",de,"%"]}),w.jsx(C0,{value:de,size:"xs",colorScheme:"blue",borderRadius:"full"})]}),w.jsxs(wi,{mt:3,spacing:3,children:[w.jsx(br,{colorScheme:"blue",leftIcon:w.jsx(In,{as:d0}),onClick:qt,isDisabled:ie,size:"sm",variant:"outline",children:"Browse"}),w.jsx(br,{colorScheme:"green",leftIcon:w.jsx(In,{as:PF}),onClick:un,isLoading:ie,loadingText:"Uploading...",isDisabled:!pe||ie,size:"sm",children:"Upload"})]}),w.jsx(E0,{fontSize:"xs",color:"whiteAlpha.700",mt:2,children:"Recommended: High-quality image (1920x1080 or higher) that works well with the frosted glass overlay."})]})]}),w.jsxs(xl,{p:4,display:"flex",flexDirection:"column",children:[w.jsx(nt,{fontSize:"sm",fontWeight:"600",mb:3,color:"blue.300",children:"Space Settings"}),w.jsx(nt,{fontSize:"xs",mb:4,children:"Configure settings for your space."}),w.jsxs(Jr,{spacing:4,align:"stretch",children:[w.jsx(ft,{borderWidth:"1px",borderRadius:"md",p:3,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",children:w.jsxs(wi,{justify:"space-between",align:"center",children:[w.jsxs(ft,{children:[w.jsxs(wi,{mb:1,spacing:2,children:[w.jsxs(ft,{position:"relative",w:"16px",h:"16px",children:[w.jsx(In,{as:_ze,color:Ie?"red.400":"green.400"}),Ie&&w.jsx(ft,{position:"absolute",top:"50%",left:"0",right:"0",height:"2px",bg:"red.400",transform:"rotate(45deg)",transformOrigin:"center"})]}),w.jsx(nt,{fontSize:"sm",fontWeight:"600",children:"Voice Chat"})]}),w.jsx(nt,{fontSize:"xs",color:"whiteAlpha.800",children:Ie?"Voice chat is currently disabled for all users in this space.":"Voice chat is currently enabled for all users in this space."})]}),w.jsx(of,{isChecked:!Ie,onChange:Qr,colorScheme:"green",size:"md",isDisabled:tt})]})}),w.jsx(ft,{borderWidth:"1px",borderRadius:"md",p:3,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",children:w.jsxs(wi,{justify:"space-between",align:"center",children:[w.jsxs(ft,{children:[w.jsxs(wi,{mb:1,spacing:2,children:[w.jsx(ft,{position:"relative",w:"16px",h:"16px",children:w.jsx(In,{as:zQ,color:ze?"green.400":"red.400"})}),w.jsx(nt,{fontSize:"sm",fontWeight:"600",children:"Public Access"})]}),w.jsx(nt,{fontSize:"xs",color:"whiteAlpha.800",children:ze?"This space is accessible to all users in the 'users' group.":"This space is only accessible to specific users."}),w.jsx(nt,{fontSize:"xs",color:"blue.300",mt:1,children:"Note: Space owners and hosts will always have access regardless of this setting."})]}),w.jsx(of,{isChecked:ze,onChange:Hi,colorScheme:"green",size:"md",isDisabled:tt})]})}),w.jsxs(Cp,{status:"info",variant:"subtle",bg:"whiteAlpha.100",borderRadius:"md",borderWidth:"1px",borderColor:"blue.800",children:[w.jsx(Rp,{color:"blue.300"}),w.jsxs(ft,{children:[w.jsx($S,{fontSize:"xs",fontWeight:"medium",children:"Coming Soon"}),w.jsx(KS,{fontSize:"xs",children:"Additional space configuration options will be available in a future update."})]})]})]})]}),w.jsxs(xl,{p:4,display:"flex",flexDirection:"column",children:[w.jsx(nt,{fontSize:"sm",fontWeight:"600",mb:3,color:"blue.300",children:"Manage Users"}),w.jsx(nt,{fontSize:"xs",mb:4,children:"View and manage the owners and hosts of this space."}),we?w.jsx(Ar,{justify:"center",align:"center",h:"200px",children:w.jsx(jd,{color:"blue.300"})}):w.jsxs(Jr,{spacing:4,align:"stretch",children:[w.jsxs(ft,{children:[w.jsxs(wi,{mb:2,children:[w.jsx(In,{as:hze,color:"green.400"}),w.jsx(nt,{fontSize:"sm",fontWeight:"600",children:"Owners"}),w.jsx(Ip,{colorScheme:"green",ml:2,children:ve.length})]}),w.jsx(ft,{borderWidth:"1px",borderRadius:"md",p:2,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",maxH:"120px",overflowY:"auto",css:{"&::-webkit-scrollbar":{width:"4px"},"&::-webkit-scrollbar-track":{background:"rgba(0,0,0,0.1)"},"&::-webkit-scrollbar-thumb":{background:"rgba(255,255,255,0.3)",borderRadius:"2px"}},children:ve.length===0?w.jsx(nt,{fontSize:"xs",color:"whiteAlpha.600",children:"No owners found"}):w.jsx(Jr,{spacing:1,align:"stretch",children:ve.map(Ot=>w.jsxs(wi,{spacing:2,p:1,borderRadius:"md",_hover:{bg:"whiteAlpha.100"},children:[w.jsx(zl,{size:"xs",src:Ot.photoURL,name:Ot.displayName}),w.jsxs(ft,{children:[w.jsx(nt,{fontSize:"xs",children:Ot.displayName}),w.jsx(nt,{fontSize:"xs",color:"whiteAlpha.600",children:Ot.firstName&&Ot.lastName?`${Ot.firstName} ${Ot.lastName}`:"Full name not available"})]}),w.jsx(Yk,{}),w.jsx(Ip,{colorScheme:"green",variant:"solid",fontSize:"2xs",children:"Owner"})]},Ot.uid))})})]}),w.jsxs(ft,{children:[w.jsxs(wi,{mb:2,children:[w.jsx(In,{as:gze,color:"purple.400"}),w.jsx(nt,{fontSize:"sm",fontWeight:"600",children:"Hosts"}),w.jsx(Ip,{colorScheme:"purple",ml:2,children:Ee.length})]}),w.jsx(ft,{borderWidth:"1px",borderRadius:"md",p:2,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",maxH:"120px",overflowY:"auto",css:{"&::-webkit-scrollbar":{width:"4px"},"&::-webkit-scrollbar-track":{background:"rgba(0,0,0,0.1)"},"&::-webkit-scrollbar-thumb":{background:"rgba(255,255,255,0.3)",borderRadius:"2px"}},children:Ee.length===0?w.jsx(nt,{fontSize:"xs",color:"whiteAlpha.600",children:"No hosts found"}):w.jsx(Jr,{spacing:1,align:"stretch",children:Ee.map(Ot=>w.jsxs(wi,{spacing:2,p:1,borderRadius:"md",_hover:{bg:"whiteAlpha.100"},children:[w.jsx(zl,{size:"xs",src:Ot.photoURL,name:Ot.displayName}),w.jsxs(ft,{children:[w.jsx(nt,{fontSize:"xs",children:Ot.displayName}),w.jsx(nt,{fontSize:"xs",color:"whiteAlpha.600",children:Ot.firstName&&Ot.lastName?`${Ot.firstName} ${Ot.lastName}`:"Full name not available"})]}),w.jsx(Yk,{}),w.jsx(Ip,{colorScheme:"purple",variant:"solid",fontSize:"2xs",children:"Host"})]},Ot.uid))})})]}),w.jsx(rf,{borderColor:"whiteAlpha.200"}),w.jsxs(Cp,{status:"info",variant:"subtle",bg:"whiteAlpha.100",borderRadius:"md",borderWidth:"1px",borderColor:"blue.800",py:2,fontSize:"xs",children:[w.jsx(Rp,{color:"blue.300",boxSize:4}),w.jsxs(ft,{children:[w.jsx($S,{fontSize:"xs",fontWeight:"medium",children:"Coming Soon"}),w.jsx(KS,{fontSize:"xs",children:"User management features like adding/removing hosts and owners will be available in a future update."})]})]})]})]}),w.jsxs(xl,{p:4,display:"flex",flexDirection:"column",children:[w.jsx(nt,{fontSize:"sm",fontWeight:"600",mb:3,color:"blue.300",children:"Stream Settings"}),w.jsxs(Jr,{spacing:4,align:"stretch",children:[w.jsx(ft,{borderWidth:"1px",borderRadius:"md",p:3,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",children:w.jsxs(wi,{justify:"space-between",align:"center",children:[w.jsx(ft,{children:w.jsxs(wi,{mb:1,spacing:2,children:[w.jsx(ft,{position:"relative",w:"16px",h:"16px",children:w.jsx(In,{as:YS,color:Ze?"green.400":"red.400"})}),w.jsx(nt,{fontSize:"sm",fontWeight:"600",children:"Streaming Enabled"})]})}),w.jsx(of,{isChecked:Ze,onChange:async()=>{const Ot=!Ze;bt(Ot),Re(!0);try{Y.log("SpaceManageModal: Auto-saving streaming enabled state:",Ot);const On={enabled:Ot,streamUrl:on||"",rtmpUrl:Zt||"",streamKey:Ht||"",playerIndex:"0",updatedAt:new Date().toISOString()};try{await gF(i,On),Y.log("SpaceManageModal: Successfully updated streaming enabled state in Firebase directly")}catch(or){throw Y.error("SpaceManageModal: Error updating streaming state directly in Firebase:",or),or}await Fe(on,0,{enabled:Ot,rtmpUrl:Zt,streamKey:Ht}),window.dispatchEvent(new CustomEvent("StreamSettingsChanged",{detail:{enabled:Ot,spaceId:i}})),at({title:"Streaming "+(Ot?"Enabled":"Disabled"),description:`Streaming is now ${Ot?"enabled":"disabled"}.`,status:"success",duration:2e3,isClosable:!0})}catch(On){Y.error("Error auto-saving streaming state:",On),bt(!Ot),at({title:"Error",description:"Failed to update streaming status",status:"error",duration:3e3,isClosable:!0})}finally{Re(!1),setTimeout(()=>{yt()},500)}},colorScheme:"green",size:"md",isDisabled:Wt})]})}),w.jsxs(ft,{borderWidth:"1px",borderRadius:"md",p:4,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",children:[w.jsx(nt,{fontSize:"sm",fontWeight:"600",mb:3,children:"Stream Configuration"}),w.jsxs(Mr,{mb:4,children:[w.jsx(ns,{fontSize:"xs",children:"Stream URL"}),w.jsx(pi,{value:on,onChange:Ot=>Mt(Ot.target.value),placeholder:"https://example.com/stream.m3u8",size:"sm",bg:"whiteAlpha.100",borderColor:"whiteAlpha.200",_hover:{borderColor:"whiteAlpha.300"},_focus:{borderColor:"blue.300",boxShadow:"0 0 0 1px #63B3ED"},color:"white",isDisabled:Wt})]}),w.jsx(rf,{my:3,borderColor:"whiteAlpha.200"}),w.jsx(nt,{fontSize:"sm",fontWeight:"600",mb:3,children:"RTMP Configuration"}),w.jsxs(Mr,{mb:3,children:[w.jsx(ns,{fontSize:"xs",children:"RTMP URL"}),w.jsx(pi,{value:Zt,onChange:Ot=>an(Ot.target.value),placeholder:"rtmp://example.com/live",size:"sm",bg:"whiteAlpha.100",borderColor:"whiteAlpha.200",_hover:{borderColor:"whiteAlpha.300"},_focus:{borderColor:"blue.300",boxShadow:"0 0 0 1px #63B3ED"},color:"white",isDisabled:Wt})]}),w.jsxs(Mr,{mb:3,children:[w.jsx(ns,{fontSize:"xs",children:"Stream Key"}),w.jsx(pi,{value:Ht,onChange:Ot=>jn(Ot.target.value),placeholder:"xxxxxxxxxxxxxxxxxxxxxxxx",size:"sm",bg:"whiteAlpha.100",borderColor:"whiteAlpha.200",_hover:{borderColor:"whiteAlpha.300"},_focus:{borderColor:"blue.300",boxShadow:"0 0 0 1px #63B3ED"},color:"white",isDisabled:Wt,type:"password"})]})]}),w.jsx(br,{colorScheme:"blue",size:"sm",onClick:ai,isLoading:Wt,loadingText:"Saving...",alignSelf:"flex-start",mt:2,display:Ze?"inline-flex":"none",children:"Save Stream Settings"}),w.jsxs(Cp,{status:"info",variant:"subtle",bg:"whiteAlpha.100",borderRadius:"md",borderWidth:"1px",borderColor:"blue.800",mt:2,mb:8,children:[w.jsx(Rp,{color:"blue.300"}),w.jsxs(ft,{children:[w.jsx($S,{fontSize:"xs",fontWeight:"medium",children:"HLS Streaming"}),w.jsx(KS,{fontSize:"xs",children:"After saving, the stream will be available on all screens. Player index: 0"})]})]})]})]})]})]})})]})]})},Rze=({onTogglePlayerList:n,spaceID:e})=>{const{fullscreenRef:i}=Bd(),[o,l]=D.useState(!0),[d,p]=D.useState(!1),[_,E]=D.useState(!1),[b,C]=D.useState(!1),[I,O]=D.useState(!1),[L,V]=D.useState(!1),[B,W]=D.useState(null),[Z,$]=D.useState(!1),[se,ue]=D.useState(!1),[re,pe]=D.useState(!1),[q,Q]=D.useState(!1),J=wc(),{user:ie}=D.useContext(Go),me=(ie==null?void 0:ie.Nickname)||"Unknown",[de,le]=D.useState(!1),xe=async()=>{if(ie!=null&&ie.uid&&e)try{const be=await Fu(ie.uid);let Ie=!1,Me=!1;if(be.groups){const Je=`space_${e}_owners`,tt=`space_${e}_hosts`;Ie=be.groups.includes(Je),Me=be.groups.includes(tt)}const ze=await moe(ie.uid,"disruptiveAdmin");if(Q(ze),W({rpmURL:be.rpmURL?be.rpmURL.replace(".glb",".png?scene=fullbody-portrait-closeupfront&w=640&q=75"):null}),ue(Ie||ze),pe(Me),!Ie&&!ze&&Z){$(!1);const Je=new CustomEvent("editModeChanged",{detail:{enabled:!1}});window.dispatchEvent(Je),J({title:"Edit Mode Disabled",description:"You don't have permission to edit this space.",status:"warning",duration:5e3,isClosable:!0,position:"top"})}}catch(be){console.error("Error fetching profile data:",be),ue(!1),pe(!1),Q(!1)}else ue(!1),pe(!1),Q(!1)};D.useEffect(()=>{xe()},[ie==null?void 0:ie.uid,e,Z]),D.useEffect(()=>{const be=()=>{l(!0)};return window.addEventListener("PlayerInstantiated",be),()=>{window.removeEventListener("PlayerInstantiated",be)}},[]),D.useEffect(()=>{(async()=>{try{window.agoraClient&&typeof window.agoraClient.voiceDisabled=="boolean"&&le(window.agoraClient.voiceDisabled)}catch(Me){console.error("Error checking if voice is disabled:",Me)}})();const Ie=Me=>{Me.detail&&typeof Me.detail.voiceDisabled=="boolean"&&(console.log("Voice setting changed:",Me.detail.voiceDisabled),le(Me.detail.voiceDisabled))};return window.addEventListener("SpaceVoiceSettingChanged",Ie),()=>{window.removeEventListener("SpaceVoiceSettingChanged",Ie)}},[]);const We=()=>E(!_),$e=()=>C(!b),ve=()=>{V(!L),ke()},_e=()=>{O(!1),xe()},Ee=be=>{be.stopPropagation(),typeof n=="function"&&(Y.log("CanvasMainMenu: Toggling player list"),n())},ke=()=>{p(!1)},we=be=>{if(be.stopPropagation(),!se){J({title:"Permission Denied",description:"You don't have permission to edit this space. Only space owners can use Edit Mode.",status:"error",duration:5e3,isClosable:!0,position:"top"});return}const Ie=!Z;$(Ie);const Me=new CustomEvent("editModeChanged",{detail:{enabled:Ie}});window.dispatchEvent(Me),J({title:Ie?"Edit Mode Enabled":"Edit Mode Disabled",description:Ie?"You can now make changes to the scene.":"Scene editing is now disabled.",status:Ie?"info":"success",duration:3e3,isClosable:!0,position:"top"})};return w.jsxs(w.Fragment,{children:[w.jsxs(dR,{isOpen:d,onClose:()=>p(!1),children:[w.jsx(hR,{as:Wo,icon:w.jsx(mWe,{}),"aria-label":"Main menu",variant:"ghost",color:"white",bg:d?"whiteAlpha.400":"whiteAlpha.200",_hover:{bg:d?"whiteAlpha.500":"whiteAlpha.300"},size:"md",onClick:()=>p(!d)}),w.jsx($l,{containerRef:i,children:w.jsx(fR,{bg:"rgba(0,0,0,0.4)",backdropFilter:"blur(10px)",border:"none",boxShadow:"lg",color:"white",width:"300px",p:4,borderRadius:"xl",zIndex:9999,transform:"none !important",children:w.jsxs(Jr,{align:"stretch",spacing:4,children:[w.jsxs(wi,{children:[w.jsx(zl,{size:"md",src:B==null?void 0:B.rpmURL,bg:"white",name:" ",borderWidth:"1px",borderColor:"whiteAlpha.300"}),w.jsxs(Jr,{align:"start",spacing:0,children:[w.jsxs(wi,{children:[w.jsx(nt,{fontWeight:"bold",children:me}),se&&!q&&w.jsx(Mp,{label:"Owner",placement:"top",hasArrow:!0,zIndex:1e4,openDelay:300,gutter:8,portalProps:{containerRef:i},children:w.jsx(ft,{display:"inline-block",children:w.jsx(In,{as:CF,color:"green.400",boxSize:3})})}),!se&&re&&!q&&w.jsx(Mp,{label:"Host",placement:"top",hasArrow:!0,zIndex:1e4,openDelay:300,gutter:8,portalProps:{containerRef:i},children:w.jsx(ft,{display:"inline-block",children:w.jsx(In,{as:AF,color:"purple.400",boxSize:3})})}),q&&w.jsx(Mp,{label:"Admin",placement:"top",hasArrow:!0,zIndex:1e4,openDelay:300,gutter:8,portalProps:{containerRef:i},children:w.jsx(ft,{display:"inline-block",children:w.jsx(In,{as:F8e,color:"blue.400",boxSize:3})})})]}),w.jsx(nt,{fontSize:"sm",color:"whiteAlpha.800",children:"Spaces Metaverse"})]})]}),w.jsxs(wi,{spacing:4,justify:"center",children:[w.jsx(Wo,{icon:w.jsx(B8e,{}),variant:"ghost",colorScheme:"whiteAlpha",size:"sm","aria-label":"People",_hover:{bg:"whiteAlpha.200"},onClick:Ee}),se&&w.jsx(Wo,{icon:w.jsx(N8e,{}),variant:"ghost",colorScheme:Z?"green":"whiteAlpha",size:"sm","aria-label":"Edit Mode",_hover:{bg:"whiteAlpha.200"},onClick:we}),w.jsx(Wo,{icon:w.jsx(ft,{w:"4",h:"4"}),variant:"ghost",colorScheme:"whiteAlpha",size:"sm","aria-label":"Action 3",_hover:{bg:"whiteAlpha.200"}}),w.jsx(Wo,{icon:w.jsx(ft,{w:"4",h:"4"}),variant:"ghost",colorScheme:"whiteAlpha",size:"sm","aria-label":"Action 4",_hover:{bg:"whiteAlpha.200"}})]}),w.jsx(rf,{borderColor:"whiteAlpha.300"}),w.jsxs(Jr,{align:"stretch",spacing:2,children:[se&&w.jsxs(wi,{p:2,borderRadius:"md",_hover:{bg:"whiteAlpha.200"},onClick:be=>be.stopPropagation(),justify:"space-between",children:[w.jsx(nt,{fontSize:"md",children:"Edit Mode"}),w.jsx(of,{id:"edit-mode-toggle",isChecked:Z,onChange:we,colorScheme:"green",sx:{"& .chakra-switch__track":{bg:Z?"green.500":"black"}}})]}),se&&w.jsx(nt,{fontSize:"md",cursor:"pointer",_hover:{bg:"whiteAlpha.200"},p:2,borderRadius:"md",onClick:ve,children:"Manage Space"}),ie&&e&&!de&&w.jsx(cze,{onClose:ke}),w.jsx(nt,{fontSize:"md",cursor:"pointer",_hover:{bg:"whiteAlpha.200"},p:2,borderRadius:"md",onClick:We,children:"Settings"}),w.jsx(nt,{fontSize:"md",cursor:"pointer",_hover:{bg:"whiteAlpha.200"},p:2,borderRadius:"md",onClick:$e,children:"Controls"}),w.jsx(nt,{fontSize:"md",cursor:"pointer",_hover:{bg:"whiteAlpha.200"},p:2,borderRadius:"md",children:"Help"}),w.jsx(nt,{fontSize:"md",cursor:"pointer",_hover:{bg:"whiteAlpha.200"},p:2,borderRadius:"md",color:"red.300",children:"Leave"})]})]})})})]}),b&&w.jsx(lze,{open:b,onClose:$e}),_&&w.jsx(dze,{open:_,onClose:We}),I&&w.jsx(aae,{open:I,onClose:_e}),w.jsx(Cze,{isOpen:L,onClose:ve})]})},Ize=({isOpen:n,onClose:e,mediaScreenId:i,onImageChange:o})=>{const{spaceID:l}=ba(),d=Ef(),p=wc(),_=D.useRef(null),E=D.useRef(null),b=D.useRef(),[C,I]=D.useState(null),[O,L]=D.useState(""),[V,B]=D.useState(!1),[W,Z]=D.useState(0),[$,se]=D.useState(null),[ue,re]=D.useState(!0),[pe,q]=D.useState(!1),[Q,J]=D.useState(!1),[ie,me]=D.useState(0),[de,le]=D.useState("image"),[xe,We]=D.useState(""),[$e,ve]=D.useState(!1);D.useEffect(()=>{(async()=>{if(n&&i&&l){re(!0);try{const bt=await kp(l,i);if(bt&&(bt.imageUrl||bt.videoUrl)){se(bt);const on=bt.mediaType==="video";le(on?"video":"image"),ve(bt.displayAsVideo||!1),on&&bt.videoUrl&&(We(bt.videoUrl),me(1))}else se(null)}catch(bt){Y.error("Error fetching existing image:",bt),se(null)}finally{re(!1)}}})()},[n,i,l]),D.useEffect(()=>{n||(I(null),L(""),Z(0),We(""))},[n]);const _e=D.useCallback(Ze=>{Ze.preventDefault(),Ze.stopPropagation(),J(!0)},[]),Ee=D.useCallback(Ze=>{Ze.preventDefault(),Ze.stopPropagation(),J(!1)},[]),ke=D.useCallback(Ze=>{Ze.preventDefault(),Ze.stopPropagation()},[]),we=D.useCallback(Ze=>{if(Ze.preventDefault(),Ze.stopPropagation(),J(!1),Ze.dataTransfer.files&&Ze.dataTransfer.files.length>0){const bt=Ze.dataTransfer.files[0];be(bt)}},[]);D.useEffect(()=>{const Ze=E.current;if(Ze)return Ze.addEventListener("dragenter",_e),Ze.addEventListener("dragleave",Ee),Ze.addEventListener("dragover",ke),Ze.addEventListener("drop",we),()=>{Ze.removeEventListener("dragenter",_e),Ze.removeEventListener("dragleave",Ee),Ze.removeEventListener("dragover",ke),Ze.removeEventListener("drop",we)}},[_e,Ee,ke,we]);const be=Ze=>{if(!Ze)return;if(!Ze.type.startsWith("image/")){p({title:"Invalid file type",description:"Please select an image file (PNG, JPEG, etc.)",status:"error",duration:5e3,isClosable:!0});return}I(Ze);const bt=new FileReader;bt.onloadend=()=>{L(bt.result)},bt.readAsDataURL(Ze)},Ie=Ze=>{const bt=Ze.target.files[0];be(bt)},Me=async Ze=>{const bt=Ze.target.checked;if(ve(bt),$)try{await h8e(l,i,bt),bt?d("SetMediaScreenImage",{mediaScreenId:i,imageUrl:null,videoUrl:$.videoUrl||null,mediaType:$.mediaType||"image",displayAsVideo:!0}):d("SetMediaScreenImage",{mediaScreenId:i,imageUrl:$.imageUrl||null,videoUrl:$.videoUrl||null,mediaType:$.mediaType||"image",displayAsVideo:!1}),se({...$,displayAsVideo:bt}),p({title:"Display mode updated",description:`The media screen will now be displayed as ${bt?"video":"image"}`,status:"success",duration:3e3,isClosable:!0}),Y.log(`Updated display mode for media screen ${i} to ${bt?"video":"image"}`),o&&o({type:"update",mediaScreenId:i,displayAsVideo:bt})}catch(on){Y.error("Error updating display mode:",on),p({title:"Update failed",description:on.message||"An error occurred while updating the display mode",status:"error",duration:5e3,isClosable:!0}),ve(!bt)}},ze=async()=>{if(de==="image"&&!C){p({title:"No file selected",description:"Please select an image to upload",status:"warning",duration:5e3,isClosable:!0});return}if(de==="video"&&!xe){p({title:"No video URL",description:"Please enter a video URL",status:"warning",duration:5e3,isClosable:!0});return}try{B(!0);const Ze=setInterval(()=>{Z(Zt=>{const an=Zt+10;return an>=90?90:an})},300);let bt;de==="image"?bt=await LQ(l,i,C,{mediaType:de,displayAsVideo:$e}):(bt=xe,await LQ(l,i,null,{mediaType:"video",directUrl:xe,displayAsVideo:$e})),clearInterval(Ze),Z(100);let on=null,Mt=null;de==="image"?(on=$e?null:bt,Mt=($==null?void 0:$.videoUrl)||null):(on=!$e&&($!=null&&$.imageUrl)?$.imageUrl:null,Mt=bt),d("SetMediaScreenImage",{mediaScreenId:i,imageUrl:on,videoUrl:Mt,mediaType:de,displayAsVideo:$e}),Y.log(`Uploaded and sent ${de} for media screen ${i} (display as video: ${$e})`),o&&o({type:"upload",mediaScreenId:i,imageUrl:de==="image"?bt:$==null?void 0:$.imageUrl,videoUrl:de==="video"?bt:$==null?void 0:$.videoUrl,mediaType:de,displayAsVideo:$e}),p({title:"Upload successful",description:`The ${de} has been uploaded and applied to the media screen`,status:"success",duration:5e3,isClosable:!0}),setTimeout(()=>{I(null),L(""),B(!1),Z(0),e()},1e3)}catch(Ze){Y.error(`Error uploading ${de}:`,Ze),p({title:"Upload failed",description:Ze.message||`An error occurred while uploading the ${de}`,status:"error",duration:5e3,isClosable:!0}),B(!1),Z(0)}},Je=async()=>{q(!1);try{B(!0),await d8e(l,i),d("SetMediaScreenImage",{mediaScreenId:i,imageUrl:de==="image"?null:($==null?void 0:$.imageUrl)||null,videoUrl:de==="video"?null:($==null?void 0:$.videoUrl)||null,mediaType:null,displayAsVideo:!1}),Y.log(`Deleted ${de} for media screen ${i}`),o&&o({type:"delete",mediaScreenId:i}),p({title:`${de==="image"?"Image":"Video"} deleted`,description:`The ${de} has been removed from the media screen`,status:"success",duration:5e3,isClosable:!0}),se(null),B(!1),We(""),ve(!1),setTimeout(()=>{e()},500)}catch(Ze){Y.error(`Error deleting ${de}:`,Ze),p({title:"Deletion failed",description:Ze.message||`An error occurred while deleting the ${de}`,status:"error",duration:5e3,isClosable:!0}),B(!1)}},tt=()=>{V||(I(null),L(""),Z(0),e())},ut=Ze=>{me(Ze),le(Ze===0?"image":"video")};return w.jsxs(w.Fragment,{children:[w.jsxs(so,{isOpen:n,onClose:tt,size:"xl",children:[w.jsx(ao,{backdropFilter:"blur(10px)"}),w.jsxs(oo,{bg:"gray.800",color:"white",maxW:"900px",children:[w.jsx(ec,{children:"Media Screen Content"}),w.jsx(zo,{isDisabled:V}),w.jsxs(ft,{px:6,pb:2,children:[w.jsxs(Ar,{justify:"space-between",align:"center",bg:"gray.700",p:4,borderRadius:"md",mb:4,children:[w.jsxs(wi,{spacing:4,children:[w.jsx(nt,{fontWeight:"medium",children:"Display as:"}),w.jsxs(wi,{spacing:2,children:[w.jsx(In,{as:d0,color:$e?"gray.400":"green.300"}),w.jsx(of,{colorScheme:"purple",size:"md",isChecked:$e,onChange:Me}),w.jsx(In,{as:YS,color:$e?"purple.300":"gray.400"})]})]}),w.jsx(Ip,{colorScheme:$e?"purple":"green",fontSize:"sm",px:2,py:1,borderRadius:"md",children:$e?"Video Output":"Image Output"})]}),w.jsxs(nt,{fontSize:"sm",color:"gray.400",mb:1,children:["Media Screen ID: ",w.jsx("strong",{children:i})]}),w.jsx(nt,{fontSize:"xs",color:"gray.500",mb:2,children:"The toggle above controls how the content will be displayed in the 3D space, regardless of the content type you upload."}),w.jsx(rf,{mb:4})]}),w.jsx(wo,{children:w.jsxs(Ar,{children:[w.jsx(pR,{orientation:"vertical",variant:"solid-rounded",colorScheme:"blue",index:ie,onChange:ut,h:"100%",minW:"120px",mr:4,children:w.jsxs(mR,{children:[w.jsxs(Sc,{_selected:{color:"white",bg:"blue.500"},mb:2,py:6,justifyContent:"flex-start",children:[w.jsx(In,{as:d0,mr:2})," Image"]}),w.jsxs(Sc,{_selected:{color:"white",bg:"blue.500"},py:6,justifyContent:"flex-start",children:[w.jsx(In,{as:YS,mr:2})," Video"]})]})}),w.jsx(ft,{flex:"1",children:ue?w.jsx(Ar,{justify:"center",align:"center",h:"150px",children:w.jsx(jd,{size:"xl",color:"blue.400"})}):w.jsxs(w.Fragment,{children:[w.jsx(ft,{children:ie===0?w.jsxs(Jr,{spacing:4,align:"stretch",children:[$&&$.imageUrl&&de==="image"&&w.jsxs(ft,{children:[w.jsx(nt,{fontWeight:"semibold",mb:2,children:"Current Image:"}),w.jsxs(Ar,{children:[w.jsx(ft,{borderWidth:"1px",borderRadius:"md",overflow:"hidden",mb:2,maxW:"200px",mr:4,children:w.jsx(Yh,{src:$.imageUrl,alt:"Current image",maxHeight:"150px",width:"100%",objectFit:"contain"})}),w.jsxs(Jr,{align:"flex-start",spacing:2,children:[w.jsxs(nt,{fontSize:"xs",color:"gray.400",children:["Uploaded: ",new Date($.uploadedAt).toLocaleString()]}),w.jsxs(nt,{fontSize:"xs",color:"gray.400",children:["Display Mode: ",$.displayAsVideo?"Video":"Image"]}),w.jsx(br,{size:"sm",colorScheme:"red",variant:"outline",leftIcon:w.jsx(In,{as:EC}),onClick:()=>q(!0),isDisabled:V,children:"Delete"})]})]}),w.jsx(rf,{my:4})]}),w.jsx(nt,{fontWeight:"semibold",mb:2,children:$&&$.imageUrl&&de==="image"?"Replace with new image:":"Upload new image:"}),w.jsxs(ft,{ref:E,borderWidth:"2px",borderRadius:"md",borderStyle:"dashed",borderColor:Q?"blue.400":"gray.500",bg:Q?"blue.900":"gray.700",p:6,textAlign:"center",transition:"all 0.2s",_hover:{borderColor:"blue.400",bg:"gray.600"},cursor:"pointer",onClick:()=>_.current.click(),children:[O?w.jsx(ft,{borderRadius:"md",overflow:"hidden",maxH:"200px",children:w.jsx(Yh,{src:O,alt:"Preview",maxHeight:"200px",width:"100%",objectFit:"contain"})}):w.jsxs(Jr,{spacing:2,children:[w.jsx(In,{as:PF,boxSize:"24px",color:"gray.400"}),w.jsx(nt,{children:"Drag and drop an image here, or click to browse"}),w.jsx(nt,{fontSize:"xs",color:"gray.400",children:"Supports PNG, JPG, JPEG, GIF"})]}),w.jsx(pi,{type:"file",accept:"image/*",onChange:Ie,ref:_,display:"none"})]}),C&&w.jsxs(nt,{fontSize:"sm",children:["Selected file: ",C.name," (",Math.round(C.size/1024)," KB)"]})]}):w.jsxs(Jr,{spacing:4,align:"stretch",children:[$&&$.videoUrl&&de==="video"&&w.jsxs(ft,{children:[w.jsx(nt,{fontWeight:"semibold",mb:2,children:"Current Video URL:"}),w.jsxs(Ar,{children:[w.jsx(ft,{borderWidth:"1px",borderRadius:"md",p:3,mb:2,flex:"1",mr:4,bg:"gray.700",children:w.jsx(nt,{fontSize:"sm",wordBreak:"break-all",children:$.videoUrl})}),w.jsxs(Jr,{align:"flex-start",spacing:2,children:[w.jsxs(nt,{fontSize:"xs",color:"gray.400",children:["Added: ",new Date($.uploadedAt).toLocaleString()]}),w.jsxs(nt,{fontSize:"xs",color:"gray.400",children:["Display Mode: ",$.displayAsVideo?"Video":"Image"]}),w.jsx(br,{size:"sm",colorScheme:"red",variant:"outline",leftIcon:w.jsx(In,{as:EC}),onClick:()=>q(!0),isDisabled:V,children:"Delete"})]})]}),w.jsx(rf,{my:4})]}),w.jsx(nt,{fontWeight:"semibold",mb:2,children:$&&$.videoUrl&&de==="video"?"Replace with new video:":"Add video URL:"}),w.jsx(ft,{p:3,bg:"blue.900",borderRadius:"md",mb:4,borderLeftWidth:"4px",borderLeftColor:"blue.400",children:w.jsxs(wi,{children:[w.jsx(In,{as:fae,color:"blue.300"}),w.jsx(nt,{fontSize:"sm",fontWeight:"medium",children:'After entering a URL, click the "Save Video URL" button at the bottom to save your changes.'})]})}),w.jsxs(Mr,{children:[w.jsx(ns,{fontSize:"sm",children:"Video URL"}),w.jsx(pi,{placeholder:"Enter video URL (YouTube, Vimeo, etc.)",value:xe,onChange:Ze=>We(Ze.target.value),bg:"gray.700",borderColor:"gray.600",_hover:{borderColor:"blue.400"},_focus:{borderColor:"blue.400",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},size:"lg"}),w.jsx(nt,{fontSize:"xs",color:"gray.400",mt:1,children:"Enter a URL from YouTube, Vimeo, or other video hosting services"})]}),w.jsxs(ft,{mt:4,p:4,bg:"gray.700",borderRadius:"md",children:[w.jsxs(wi,{children:[w.jsx(In,{as:YS,color:"blue.300"}),w.jsx(nt,{fontWeight:"medium",children:"Video Support"})]}),w.jsx(nt,{fontSize:"sm",mt:2,color:"gray.300",children:"Video playback will be implemented in a future update. For now, you can add the URL which will be stored with the media screen."}),w.jsx(nt,{fontSize:"sm",mt:2,color:"yellow.300",fontWeight:"medium",children:'Important: Click the "Upload" button at the bottom to save your video URL.'})]}),xe&&w.jsxs(ft,{mt:4,p:4,bg:"gray.900",borderRadius:"md",borderWidth:"1px",borderColor:"blue.500",children:[w.jsxs(wi,{mb:2,children:[w.jsx(In,{as:pze,color:"blue.300"}),w.jsx(nt,{fontWeight:"medium",children:"URL Preview"})]}),w.jsx(nt,{fontSize:"sm",wordBreak:"break-all",color:"gray.300",children:xe}),w.jsx(nt,{fontSize:"xs",color:"gray.400",mt:2,children:"This URL will be saved when you click the Upload button below"})]})]})}),V&&w.jsxs(ft,{mt:4,children:[w.jsxs(nt,{mb:2,children:["Uploading: ",W,"%"]}),w.jsx(C0,{value:W,colorScheme:"blue",size:"sm",borderRadius:"md"})]})]})})]})}),w.jsxs(zp,{children:[w.jsx(br,{variant:"ghost",mr:3,onClick:tt,isDisabled:V,children:"Cancel"}),w.jsx(br,{colorScheme:"blue",onClick:ze,isLoading:V,loadingText:"Uploading",isDisabled:de==="image"&&!C||de==="video"&&!xe||V||ue,leftIcon:w.jsx(In,{as:de==="image"?d0:YS}),size:"lg",px:6,children:de==="image"?"Upload Image":"Save Video URL"})]})]})]}),w.jsx(mMe,{isOpen:pe,leastDestructiveRef:b,onClose:()=>q(!1),children:w.jsx(ao,{children:w.jsxs(gMe,{bg:"gray.800",color:"white",children:[w.jsxs(ec,{fontSize:"lg",fontWeight:"bold",children:["Delete ",de==="video"?"Video":"Image"]}),w.jsxs(wo,{children:["Are you sure you want to delete this ",de,"? This will revert the media screen to its blank state."]}),w.jsxs(zp,{children:[w.jsx(br,{ref:b,onClick:()=>q(!1),children:"Cancel"}),w.jsx(br,{colorScheme:"red",onClick:Je,ml:3,leftIcon:w.jsx(In,{as:EC}),children:"Delete"})]})]})})})]})},Aze=n=>{const[e,i]=D.useState(null),[o,l]=D.useState(""),[d,p]=D.useState(null),[_,E]=D.useState(!1),b=vf(),{spaceID:C}=ba(),I=D.useCallback(V=>{var B,W;try{if(!V)return null;if(V.includes("youtube.com")||V.includes("youtu.be")){let Z="";return V.includes("youtube.com/watch")?Z=new URLSearchParams(new URL(V).search).get("v"):V.includes("youtu.be/")&&(Z=V.split("youtu.be/")[1].split("?")[0]),Z?`https://www.youtube.com/embed/${Z}?autoplay=1`:V}if(V.includes("vimeo.com")){if(V.includes("player.vimeo.com/video"))return V;const Z=(W=(B=V.split("vimeo.com/")[1])==null?void 0:B.split("?")[0])==null?void 0:W.split("/")[0];return Z?`https://player.vimeo.com/video/${Z}?autoplay=1`:V}return V}catch(Z){return Y.error("Error converting to embed URL:",Z),V}},[]),O=D.useCallback(()=>{setTimeout(()=>{E(!1),Y.log("Video processing state reset")},100)},[]);D.useEffect(()=>{let V=!0,B=null;const Z=b("PlayMediaScreenVideo",async $=>{try{console.log("[DEBUG] PlayMediaScreenVideo event received:",$,"isEditMode:",n),console.log("PlayMediaScreenVideo event received:",$);const{mediaScreenId:se,videoUrl:ue}=$||{};if(!se){Y.error("Media screen ID is missing in Unity event data."),O();return}if(n){console.log(`[DEBUG] Edit mode is active for screen ${se}, setting ID but not playing video`),Y.log("Edit mode is active, setting media screen ID but not playing video"),p(se);return}if(E(!0),B=setTimeout(()=>{V&&(Y.warn("Video processing timeout reached, resetting state"),E(!1))},5e3),ue){if(console.log(`Using direct video URL from event: ${ue}`),V)try{const re=I(ue);console.log(`Setting video URL to: ${re} (original: ${ue})`),i(re),l(`Media Screen ${se}`),p(se),Y.log("Media screen video URL set directly from event:",re)}catch(re){Y.error("Error setting video URL from direct URL:",re)}finally{O(),clearTimeout(B)}return}console.log(`Fetching media screen data for ID: ${se}`);try{const re=await kp(C,se);if(console.log("Media screen data from Firestore:",re),!re||!re.videoUrl){Y.error("No video URL found for media screen:",se),O(),clearTimeout(B);return}if(!re.displayAsVideo){Y.log("Media screen is not set to display as video:",se),console.log("displayAsVideo flag is false for this media screen"),O(),clearTimeout(B);return}if(V)try{const pe=I(re.videoUrl);console.log(`Setting video URL to: ${pe} (original: ${re.videoUrl})`),i(pe),l(re.title||`Media Screen ${se}`),p(se),Y.log("Media screen video URL set to:",pe)}catch(pe){Y.error("Error setting video URL from Firestore:",pe)}finally{O(),clearTimeout(B)}}catch(re){Y.error(`Error fetching media screen data for ${se}:`,re),O(),clearTimeout(B)}}catch(se){Y.error("Error handling media screen video play:",se),console.error("Error handling media screen video play:",se),O(),clearTimeout(B)}});return()=>{V=!1,B&&clearTimeout(B),Z()}},[b,C,n,I,O]);const L=D.useCallback(()=>{i(null),l(""),p(null),E(!1),Y.log("Video player state reset")},[]);return[e,o,d,L,_]},Pze=()=>{const{spaceID:n}=ba(),e=Ef(),i=vf(),[o,l]=D.useState(!1);D.useEffect(()=>{if(window.isPlayerInstantiated){Y.log("useMediaScreenThumbnails: Unity already ready (via window flag)"),l(!0);return}const b=()=>{Y.log("useMediaScreenThumbnails: Unity is now ready (PlayerInstantiated event)"),l(!0)};return window.addEventListener("PlayerInstantiated",b),()=>{window.removeEventListener("PlayerInstantiated",b)}},[]);const d=D.useCallback(async b=>{try{return b.includes("vimeo.com")?await p(b):b.includes("youtube.com")||b.includes("youtu.be")?await _(b):"https://via.placeholder.com/640x360?text=Video"}catch(C){return Y.error(`Error fetching thumbnail for ${b}:`,C),"https://via.placeholder.com/640x360?text=Error"}},[]),p=async b=>{try{const C=`https://vimeo.com/api/oembed.json?url=${encodeURIComponent(b)}`,I=await fetch(C);if(!I.ok)throw new Error(`Failed to fetch Vimeo thumbnail: ${I.statusText}`);const O=await I.json(),L=O.thumbnail_url.replace(/_\d+x\d+/,""),V=["640x360","295x166"];let B=null;for(let W of V){const Z=`https://i.vimeocdn.com/filter/overlay?src0=${encodeURIComponent(`${L}_${W}`)}&src1=http://f.vimeocdn.com/p/images/crawler_play.png`;try{if((await fetch(Z,{method:"HEAD"})).ok){B=Z;break}}catch($){Y.warn(`Failed to validate thumbnail URL: ${Z}`,$)}}return B||O.thumbnail_url}catch(C){return Y.error(`Error fetching Vimeo thumbnail: ${C.message}`),"https://via.placeholder.com/640x360?text=Vimeo+Video"}},_=async b=>{let C="";if(b.includes("youtube.com/watch")?C=new URLSearchParams(new URL(b).search).get("v"):b.includes("youtu.be/")&&(C=b.split("youtu.be/")[1].split("?")[0]),!C)throw new Error("Could not extract YouTube video ID");const I=`https://img.youtube.com/vi/${C}/maxresdefault.jpg`;try{if((await fetch(I,{method:"HEAD"})).ok)return I}catch(O){Y.warn(`Failed to validate maxresdefault thumbnail for YouTube video ${C}`,O)}return`https://img.youtube.com/vi/${C}/hqdefault.jpg`},E=D.useCallback(async b=>{try{if(!n||!b)return;Y.log(`Refreshing thumbnail for media screen ${b}`);const C=await kp(n,b);if(!C){Y.log(`No media screen found with ID ${b}`);return}if(Y.log("Media screen data:",C),!C.displayAsVideo||!C.videoUrl){Y.log(`Media screen ${b} is not set to display as video or has no video URL`);return}const I=await d(C.videoUrl);e("SetMediaScreenThumbnail",{mediaScreenId:b,thumbnailUrl:I}),Y.log(`Sent refreshed thumbnail for media screen ${b}: ${I}`)}catch(C){Y.error(`Error refreshing thumbnail for media screen ${b}:`,C)}},[n,d,e]);D.useEffect(()=>{if(!o){Y.log("useMediaScreenThumbnails: Waiting for Unity to be ready before setting up thumbnail listeners");return}Y.log("useMediaScreenThumbnails: Unity is ready, now setting up thumbnail listeners");const C=i("SetMediaScreenThumbnail",async I=>{try{const{mediaScreenId:O,thumbnailUrl:L}=I;L==="refresh"&&O&&(console.log(`Received request to refresh thumbnail for media screen ${O}`),await E(O))}catch(O){console.error("Error handling SetMediaScreenThumbnail event:",O)}});return()=>{C()}},[i,E,o]),D.useEffect(()=>{if(!o){Y.log("useMediaScreenThumbnails: Waiting for Unity to be ready before fetching thumbnails");return}Y.log("useMediaScreenThumbnails: Unity is ready, now fetching thumbnails");const b=async()=>{try{if(!n)throw new Error("spaceID is not defined.");Y.log("Fetching media screens for thumbnails...");const I=await I3(n);Y.log("All media screens:",I);const O=I.filter(B=>B.displayAsVideo&&B.videoUrl);if(Y.log("Media screens set to display as videos:",O),O.length===0){Y.log("No media screens set to display as videos found.");return}Y.log(`Found ${O.length} media screens set to display as videos.`);const L=O.map(async B=>{try{const W=await d(B.videoUrl);return Y.log(`Fetched thumbnail for ${B.id}: ${W}`),{mediaScreenId:B.id,thumbnailUrl:W}}catch(W){return Y.error(`Error processing thumbnail for media screen ${B.id}:`,W),{mediaScreenId:B.id,thumbnailUrl:"https://via.placeholder.com/640x360?text=Error"}}}),V=await Promise.all(L);Y.log("Fetched Media Screen Thumbnails",V),V.forEach(({mediaScreenId:B,thumbnailUrl:W})=>{e("SetMediaScreenThumbnail",{mediaScreenId:B,thumbnailUrl:W}),Y.log(`Sent thumbnail to Unity for media screen ${B}: ${W}`)})}catch(I){Y.error("Error fetching media screen thumbnails:",I)}};b();const C=setInterval(b,5*60*1e3);return()=>{clearInterval(C)}},[e,n,d,o])},GQ={iframeContainer:{position:"relative",paddingBottom:"56.25%",height:0,overflow:"hidden",width:"100%",pointerEvents:"auto !important"},iframe:{position:"absolute",top:0,left:0,width:"100%",height:"100%",border:"none",pointerEvents:"auto !important",zIndex:1e4}},Oze=()=>w.jsx("style",{dangerouslySetInnerHTML:{__html:`
        /* Disable pointer events on Unity elements when modal is open */
        body.unity-input-disabled #unity-container,
        body.unity-input-disabled #unity-canvas {
          pointer-events: none !important;
        }
        
        /* Make sure the modal is above Unity */
        .chakra-modal__overlay {
          z-index: 1001 !important;
          pointer-events: auto !important;
        }
        
        .chakra-modal__content {
          z-index: 1002 !important;
          pointer-events: auto !important;
        }
        
        /* Make sure the iframe is visible and interactive */
        .video-iframe {
          z-index: 1003 !important;
          pointer-events: auto !important;
        }
        
        /* Make sure the close button is accessible */
        .chakra-modal__close-btn {
          z-index: 1004 !important;
        }
        
        /* Ensure the iframe container allows clicks */
        .iframe-container {
          pointer-events: auto !important;
        }
        
        /* Remove the full-screen blocker */
      `}}),kze=({videoUrl:n,videoTitle:e,mediaScreenId:i,isOpen:o,onClose:l})=>{const{fullscreenRef:d}=Bd();return LN(o,`video-modal-${i}`),D.useEffect(()=>{if(o){const p=b=>{b.target.classList&&b.target.classList.contains("chakra-modal__overlay")&&(b.stopPropagation(),b.preventDefault())};document.addEventListener("mousemove",p,!0),document.addEventListener("mousedown",p,!0),document.addEventListener("mouseup",p,!0),document.addEventListener("click",p,!0),document.addEventListener("wheel",p,!0);const _=document.getElementById("unity-canvas"),E=document.getElementById("unity-container");if(_&&(_.style.pointerEvents="none"),E&&(E.style.pointerEvents="none"),document.body.classList.add("unity-input-disabled"),window.unityInstance)try{window.unityInstance.SendMessage("WebGLInputManager","Disable"),window.unityInstance.SendMessage("CameraController","DisableInput","VideoModal")}catch(b){console.error("Error disabling Unity input:",b)}return()=>{if(document.removeEventListener("mousemove",p,!0),document.removeEventListener("mousedown",p,!0),document.removeEventListener("mouseup",p,!0),document.removeEventListener("click",p,!0),document.removeEventListener("wheel",p,!0),_&&(_.style.pointerEvents="auto"),E&&(E.style.pointerEvents="auto"),document.body.classList.remove("unity-input-disabled"),window.unityInstance)try{window.unityInstance.SendMessage("WebGLInputManager","Enable"),window.unityInstance.SendMessage("CameraController","EnableInput","VideoModal")}catch(b){console.error("Error re-enabling Unity input:",b)}}}},[o]),w.jsxs(w.Fragment,{children:[w.jsx(Oze,{}),w.jsxs(so,{isOpen:o,onClose:l,size:"xl",isCentered:!0,portalProps:{containerRef:d},closeOnOverlayClick:!0,closeOnEsc:!0,id:`video-modal-${i}`,children:[w.jsx(ao,{bg:"rgba(0, 0, 0, 0.8)",onClick:p=>{p.target===p.currentTarget&&(l(),p.stopPropagation(),p.preventDefault())},onMouseMove:p=>{p.target===p.currentTarget&&(p.stopPropagation(),p.preventDefault())},onMouseDown:p=>{p.target===p.currentTarget&&(p.stopPropagation(),p.preventDefault())},onMouseUp:p=>{p.target===p.currentTarget&&(p.stopPropagation(),p.preventDefault())},onWheel:p=>{p.target===p.currentTarget&&(p.stopPropagation(),p.preventDefault())},style:{pointerEvents:"auto"}}),w.jsxs(oo,{bg:"gray.900",color:"white",borderRadius:"lg",overflow:"hidden",maxWidth:"80vw",maxHeight:"80vh",className:"video-modal-content",children:[w.jsx(zo,{size:"lg",bg:"gray.700",color:"white",borderRadius:"full",zIndex:"10004",_hover:{bg:"gray.600"},position:"absolute",top:"10px",right:"10px"}),w.jsx(wo,{p:0,width:"100%",children:n?w.jsx(ft,{className:"iframe-container",style:GQ.iframeContainer,children:w.jsx("iframe",{className:"video-iframe",src:n,style:GQ.iframe,allow:"autoplay; fullscreen",allowFullScreen:!0,title:e||"Video Player"})}):w.jsxs(Ar,{direction:"column",align:"center",justify:"center",h:"400px",children:[w.jsx(jd,{size:"xl",mb:4}),w.jsx(nt,{children:"Unable to load video"}),w.jsx(nt,{fontSize:"sm",color:"gray.400",mt:2,children:"No video URL provided"})]})})]})]})]})},Gs=(...n)=>{},Nze=()=>{const{isOpen:n,onOpen:e,onClose:i}=hf(),[o,l]=D.useState(null),[d,p]=D.useState("image"),_=D.useRef(null);LN(n,"image-viewer-modal");const E=D.useCallback(I=>{I.stopPropagation()},[]);return D.useEffect(()=>{if(n&&_.current){const I=_.current;I.addEventListener("mousemove",E),I.addEventListener("mousedown",E),I.addEventListener("mouseup",E),I.addEventListener("wheel",E);const O=document.getElementById("unity-canvas");return O&&(O.style.pointerEvents="none"),()=>{I.removeEventListener("mousemove",E),I.removeEventListener("mousedown",E),I.removeEventListener("mouseup",E),I.removeEventListener("wheel",E),O&&(O.style.pointerEvents="auto")}}},[n,E]),{isOpen:n,currentImageUrl:o,currentMediaType:d,openImageViewer:(I,O="image")=>{console.log(`[DEBUG] Opening image viewer with URL: ${I} and original media type: ${O}`);const L=typeof I=="string"&&(I.match(/\.(jpeg|jpg|gif|png|webp)($|\?)/i)||I.includes("firebasestorage")&&!I.includes("video")),V=L?"image":O;console.log(`[DEBUG] Detected URL as ${L?"image":"non-image"}, using media type: ${V}`),l(I),p(V),e()},closeImageViewer:()=>{i(),setTimeout(()=>{l(null),p("image")},300)},modalContentRef:_,preventPropagation:E}},Dze=()=>w.jsx("style",{dangerouslySetInnerHTML:{__html:`
        body.unity-input-disabled #unity-container,
        body.unity-input-disabled #unity-canvas {
          pointer-events: none !important;
        }
        
        .image-viewer-modal-content {
          pointer-events: auto !important;
        }
        
        .chakra-modal__overlay {
          pointer-events: auto !important;
        }
      `}}),FU=n=>{if(!n)return null;try{if(n.includes("firebasestorage.googleapis.com")){const e=new URL(n),i=e.searchParams.get("alt"),o=e.searchParams.get("token");return e.search="",i&&e.searchParams.set("alt",i),o&&e.searchParams.set("token",o),Gs(`Cleaned Firebase URL from ${n} to ${e.toString()}`),e.toString()}return n}catch(e){return console.error("Error cleaning Firebase URL:",e),n}},xze=()=>{const{spaceID:n}=ba(),[e,i]=D.useState(!1),[o,l]=D.useState([]),[d,p]=D.useState(null),{isOpen:_,onOpen:E,onClose:b}=hf(),[C,I]=D.useState({}),[O,L]=D.useState(0);D.useRef(null);const V=Ef(),{fullscreenRef:B}=Bd(),W=vf(),[Z,$]=D.useState(!1),{isOpen:se,currentImageUrl:ue,currentMediaType:re,openImageViewer:pe,closeImageViewer:q,modalContentRef:Q,preventPropagation:J}=Nze(),[ie,me,de,le,xe]=Aze(e),{isOpen:We,onOpen:$e,onClose:ve}=hf();Pze(),eae(),D.useEffect(()=>{if(window.isPlayerInstantiated){$(!0);return}const be=()=>{$(!0)};return window.addEventListener("PlayerInstantiated",be),()=>{window.removeEventListener("PlayerInstantiated",be)}},[]);const _e=D.useCallback(be=>{if(Array.isArray(o)&&o.length>0){const Ie=o.find(Me=>Me.mediaScreenId===be);if(Ie){const Me=Ie.imageUrl,ze=Ie.videoUrl;return{screen:Ie,imageUrl:Me,videoUrl:ze,mediaType:Ie.mediaType||"image",displayAsVideo:Ie.displayAsVideo||!1}}}else console.warn("mediaScreens is not an array or is empty:",o);if(ue){let Ie=null;return Array.isArray(o)&&(Ie=o.find(Me=>Me.mediaScreenId===be)),{screen:Ie||{mediaScreenId:be},imageUrl:ue,videoUrl:null,mediaType:(Ie==null?void 0:Ie.mediaType)||"image",displayAsVideo:(Ie==null?void 0:Ie.displayAsVideo)||!1}}return n&&be&&kp(n,be).then(Ie=>{Ie&&l(Me=>Array.isArray(Me)&&Me.some(Je=>Je.mediaScreenId===be)?Me.map(Je=>Je.mediaScreenId===be?{...Je,imageUrl:Ie.imageUrl,videoUrl:Ie.videoUrl,mediaType:Ie.mediaType||"image",displayAsVideo:Ie.displayAsVideo||!1,hasImage:!!Ie.imageUrl,source:"firestore-fetch",lastUpdated:new Date().toISOString()}:Je):[...Array.isArray(Me)?Me:[],{mediaScreenId:be,imageUrl:Ie.imageUrl,videoUrl:Ie.videoUrl,mediaType:Ie.mediaType||"image",displayAsVideo:Ie.displayAsVideo||!1,hasImage:!!Ie.imageUrl,source:"firestore-fetch",firstDetected:new Date().toISOString(),lastUpdated:new Date().toISOString()}])}).catch(Ie=>{console.error(`Error fetching media screen data for ${be}:`,Ie)}),console.warn("No screen data found for:",be),null},[o,ue,n,l]),Ee=D.useCallback(be=>{if(console.log(`[DEBUG] Processing click on screen: ${be}, isEditMode: ${e}`),p(be),e)console.log(`[DEBUG] Opening upload modal for screen: ${be} in edit mode`),E();else{const Ie=_e(be);if(Ie){if(console.log(`[DEBUG] Screen data for ${be}:`,Ie),Gs("Screen data details:",{mediaScreenId:be,imageUrl:Ie.imageUrl,videoUrl:Ie.videoUrl,mediaType:Ie.mediaType,displayAsVideo:Ie.displayAsVideo}),We&&de===be)return;if(Ie.displayAsVideo&&Ie.videoUrl)Gs(`Opening video player for: ${Ie.videoUrl}`),V("PlayMediaScreenVideo",{mediaScreenId:be,videoUrl:Ie.videoUrl});else if(Ie.imageUrl){Gs(`Opening viewer modal with ${Ie.mediaType}: ${Ie.imageUrl}`);const ze=FU(Ie.imageUrl);pe(ze,Ie.mediaType||"image")}else n&&kp(n,be).then(ze=>{if(ze){if(ze.displayAsVideo&&ze.videoUrl)Gs(`Opening video player for: ${ze.videoUrl}`),V("PlayMediaScreenVideo",{mediaScreenId:be,videoUrl:ze.videoUrl});else if(ze.imageUrl){Gs(`Opening viewer modal with image: ${ze.imageUrl}`);const Je=FU(ze.imageUrl);pe(Je,ze.mediaType||"image")}l(Je=>Array.isArray(Je)&&Je.some(ut=>ut.mediaScreenId===be)?Je.map(ut=>ut.mediaScreenId===be?{...ut,...ze,mediaScreenId:be,source:"firestore-click",lastUpdated:new Date().toISOString()}:ut):[...Array.isArray(Je)?Je:[],{...ze,mediaScreenId:be,source:"firestore-click",firstDetected:new Date().toISOString(),lastUpdated:new Date().toISOString()}])}}).catch(ze=>{console.error(`Error fetching media screen data for ${be}:`,ze)})}else n&&kp(n,be).then(Me=>{if(Me){if(Me.displayAsVideo&&Me.videoUrl)Gs(`Opening video player for: ${Me.videoUrl}`),V("PlayMediaScreenVideo",{mediaScreenId:be,videoUrl:Me.videoUrl});else if(Me.imageUrl){Gs(`Opening viewer modal with image: ${Me.imageUrl}`);const ze=FU(Me.imageUrl);pe(ze,Me.mediaType||"image")}l(ze=>Array.isArray(ze)&&ze.some(tt=>tt.mediaScreenId===be)?ze.map(tt=>tt.mediaScreenId===be?{...tt,...Me,mediaScreenId:be,source:"firestore-click",lastUpdated:new Date().toISOString()}:tt):[...Array.isArray(ze)?ze:[],{...Me,mediaScreenId:be,source:"firestore-click",firstDetected:new Date().toISOString(),lastUpdated:new Date().toISOString()}])}}).catch(Me=>{console.error(`Error fetching media screen data for ${be}:`,Me)})}},[e,E,_e,We,de,V,pe,n]);D.useEffect(()=>{if(!Z)return;const be=async()=>{if(n)try{const Me=await I3(n),ze={};Me.forEach(Je=>{Je.id&&Je.imageUrl&&(ze[Je.id]=Je.imageUrl)}),l(Je=>Je.map(tt=>{const ut=!!ze[tt.mediaScreenId],Ze=ze[tt.mediaScreenId],bt=tt.mediaType||"image";return{...tt,hasImage:ut,imageUrl:Ze,mediaType:bt}}))}catch(Me){console.error("Error fetching media screen images:",Me)}};be();let Ie=null;return e&&(Ie=setInterval(be,5e3)),()=>{Ie&&clearInterval(Ie)}},[n,e,O,Z]);const ke=be=>{l(Ie=>Ie.map(Me=>{if(Me.mediaScreenId===be.mediaScreenId){if(be.type==="upload")return{...Me,hasImage:!0,imageUrl:be.imageUrl,mediaType:be.mediaType||"image"};if(be.type==="delete")return{...Me,hasImage:!1,imageUrl:null,mediaType:null}}return Me})),be.type==="delete"?(setTimeout(()=>{l(Ie=>Ie.filter(Me=>Me.mediaScreenId!==be.mediaScreenId))},100),setTimeout(()=>{l(Ie=>Ie.filter(Me=>Me.mediaScreenId!==be.mediaScreenId))},1500)):setTimeout(()=>{l(Ie=>Ie.some(ze=>ze.mediaScreenId===be.mediaScreenId)?Ie.map(ze=>ze.mediaScreenId===be.mediaScreenId?{...ze,imageUrl:be.imageUrl,hasImage:!0,mediaType:be.mediaType||"image"}:ze):[...Ie,{mediaScreenId:be.mediaScreenId,imageUrl:be.imageUrl,hasImage:!0,mediaType:be.mediaType||"image",source:"delayed-update",firstDetected:new Date().toISOString(),lastUpdated:new Date().toISOString()}])},1e3)};D.useEffect(()=>{const be=Ie=>{const Me=Ie.detail.enabled;i(Me),Me?V("SetMediaScreenEditMode",{enabled:!0,showUploadIcon:!0}):V("SetMediaScreenEditMode",{enabled:!1,showUploadIcon:!1})};return window.addEventListener("editModeChanged",be),()=>{window.removeEventListener("editModeChanged",be)}},[V]),D.useEffect(()=>(window.JsSendMediaScreenClick=function(be){console.log("Unity: MediaScreenClick received with data:",be);try{const Ie=JSON.parse(be),Me=new CustomEvent("MediaScreenClick",{detail:JSON.stringify(Ie)});window.dispatchEvent(Me)}catch(Ie){console.error("Error processing MediaScreenClick data:",Ie)}},window.handleMediaScreenClick=function(be){console.log("Direct call to handleMediaScreenClick with ID:",be),Ee(be)},window.TestJavaScriptFromUnity=function(be){console.log("Unity called TestJavaScriptFromUnity with:",be),alert("Unity called JavaScript: "+be)},()=>{delete window.JsSendMediaScreenClick,delete window.handleMediaScreenClick,delete window.TestJavaScriptFromUnity}),[Ee]),D.useEffect(()=>{const be=ze=>{try{const Je=JSON.parse(ze.detail);Y.log(`MediaScreen registered: ${Je.mediaScreenId}`),Gs("MediaScreen registered from Unity:",Je),l(ut=>ut.some(bt=>bt.mediaScreenId===Je.mediaScreenId)?ut.map(bt=>bt.mediaScreenId===Je.mediaScreenId?{...bt,...Je,source:"event",lastUpdated:new Date().toISOString()}:bt):[...ut,{...Je,source:"event",firstDetected:new Date().toISOString(),lastUpdated:new Date().toISOString()}]),e&&V("SetMediaScreenEditMode",{mediaScreenId:Je.mediaScreenId,enabled:!0,showUploadIcon:!0});const tt=Je.mediaScreenId;tt&&kp(n,tt).then(ut=>{ut&&(Gs(`Media screen data for ${tt}:`,ut),ut.displayAsVideo&&ut.videoUrl&&(Gs(`Media screen ${tt} should display as video, sending null imageUrl`),V("SetMediaScreenImage",{mediaScreenId:tt,imageUrl:null,displayAsVideo:!0})))}).catch(ut=>{console.error(`Error fetching media screen data for ${tt}:`,ut)})}catch(Je){console.error("Error handling MediaScreen registration:",Je)}},Ie=ze=>{try{Gs("MediaScreenClick event received:",ze);let Je;if(typeof ze=="string")Je=ze,Gs("MediaScreenClick: Direct call with ID:",Je);else{Gs("MediaScreenClick: Event from Unity:",ze),Gs("MediaScreenClick: Event detail:",ze.detail);try{Je=JSON.parse(ze.detail).mediaScreenId,Gs("MediaScreenClick: Parsed mediaScreenId:",Je)}catch(tt){if(console.error("MediaScreenClick: Error parsing event detail:",tt),ze.detail&&ze.detail.mediaScreenId)Je=ze.detail.mediaScreenId,Gs("MediaScreenClick: Using direct mediaScreenId from detail:",Je);else throw new Error("Could not extract mediaScreenId from event")}}Y.log(`MediaScreen clicked: ${Je}`),Gs("MediaScreen clicked:",Je),Ee(Je)}catch(Je){console.error("Error handling MediaScreen click:",Je)}},Me=ze=>{if(ze.detail&&ze.detail.eventName==="RegisterMediaScreen")be({detail:ze.detail.eventData});else if(ze.detail&&ze.detail.eventName==="MediaScreenClick")Ie({detail:ze.detail.eventData});else if(ze.detail&&ze.detail.eventName==="SetMediaScreenImage")try{const Je=JSON.parse(ze.detail.eventData);Je.mediaScreenId&&(Gs("SetMediaScreenImage event received:",Je),l(tt=>Array.isArray(tt)&&tt.some(Ze=>Ze.mediaScreenId===Je.mediaScreenId)?tt.map(Ze=>Ze.mediaScreenId===Je.mediaScreenId?{...Ze,imageUrl:Je.imageUrl,hasImage:!!Je.imageUrl,displayAsVideo:Je.displayAsVideo||!1,lastUpdated:new Date().toISOString()}:Ze):[...Array.isArray(tt)?tt:[],{mediaScreenId:Je.mediaScreenId,imageUrl:Je.imageUrl,hasImage:!!Je.imageUrl,displayAsVideo:Je.displayAsVideo||!1,source:"set-media-screen-image",firstDetected:new Date().toISOString(),lastUpdated:new Date().toISOString()}]))}catch(Je){console.error("Error handling SetMediaScreenImage event:",Je)}};return window.addEventListener("RegisterMediaScreen",be),window.addEventListener("MediaScreenClick",Ie),window.addEventListener("reactUnityEvent",Me),()=>{window.removeEventListener("RegisterMediaScreen",be),window.removeEventListener("MediaScreenClick",Ie),window.removeEventListener("reactUnityEvent",Me)}},[e,E,V,o,se,We,pe,Ee,n]),D.useEffect(()=>{const be=Ie=>{try{Gs("Direct MediaScreenClick event received:",Ie);let Me;if(Ie.detail)try{Me=JSON.parse(Ie.detail).mediaScreenId}catch(ze){console.error("Error parsing MediaScreenClick event detail:",ze);return}if(!Me){console.error("No mediaScreenId found in MediaScreenClick event");return}Gs(`Direct handler: Processing click for media screen ${Me}`),Ee(Me)}catch(Me){console.error("Error in direct MediaScreenClick handler:",Me)}};return window.addEventListener("MediaScreenClick",be),()=>{window.removeEventListener("MediaScreenClick",be)}},[Ee]),D.useEffect(()=>{ie&&$e()},[ie,$e]);const we=()=>{le(),ve()};return D.useEffect(()=>{const Ie=W("RegisterMediaScreen",Me=>{try{if(Y.log("Direct RegisterMediaScreen event received with data:",Me),!Me||!Me.mediaScreenId){Y.warn("RegisterMediaScreen event received with invalid data");return}const ze=Me.mediaScreenId;Y.log(`Media screen registered directly: ${ze}`),l(Je=>Je.some(ut=>ut.mediaScreenId===ze)?Je.map(ut=>ut.mediaScreenId===ze?{...ut,...Me,source:"direct-event",lastUpdated:new Date().toISOString()}:ut):[...Je,{...Me,source:"direct-event",firstDetected:new Date().toISOString(),lastUpdated:new Date().toISOString()}]),e&&V("SetMediaScreenEditMode",{mediaScreenId:ze,enabled:!0,showUploadIcon:!0})}catch(ze){console.error("Error handling direct RegisterMediaScreen event:",ze)}});return()=>{Ie()}},[W,e,V]),D.useEffect(()=>{const Ie=W("MediaScreenClick",Me=>{try{if(Y.log("Direct MediaScreenClick event received with data:",Me),!Me||!Me.mediaScreenId){Y.warn("MediaScreenClick event received with invalid data");return}const ze=Me.mediaScreenId;Y.log(`Media screen clicked directly: ${ze}`),Ee(ze)}catch(ze){console.error("Error handling direct MediaScreenClick event:",ze)}});return()=>{Ie()}},[W,Ee]),D.useEffect(()=>{e&&de&&(console.log(`[DEBUG] Detected currentVideoMediaScreenId change in edit mode: ${de}`),p(de),E(),le())},[e,de,E,le]),w.jsxs(w.Fragment,{children:[w.jsx(Ize,{isOpen:_,onClose:b,mediaScreenId:d,onImageChange:ke}),w.jsx(Dze,{}),w.jsx($l,{containerRef:B,children:w.jsxs(so,{isOpen:se,onClose:q,size:"lg",isCentered:!0,portalProps:{containerRef:B},id:"image-viewer-modal",blockScrollOnMount:!0,children:[w.jsx(ao,{bg:"rgba(0, 0, 0, 0.8)",onClick:J,onMouseMove:J,onMouseDown:J,onMouseUp:J,onWheel:J}),w.jsxs(oo,{ref:Q,bg:"gray.900",color:"white",borderRadius:"lg",overflow:"hidden",maxWidth:"80vw",maxHeight:"80vh",display:"flex",justifyContent:"center",alignItems:"center",position:"relative",zIndex:"10000",className:"image-viewer-modal-content",onClick:J,onMouseMove:J,onMouseDown:J,onMouseUp:J,onWheel:J,children:[w.jsx(zo,{size:"lg",bg:"gray.700",color:"white",borderRadius:"full",zIndex:"modal",_hover:{bg:"gray.600"},_focus:{boxShadow:"none"},position:"absolute",top:"10px",right:"10px"}),w.jsx(wo,{p:0,width:"100%",onClick:J,onMouseMove:J,onMouseDown:J,onMouseUp:J,onWheel:J,children:ue?w.jsx(ft,{position:"relative",width:"100%",height:"100%",display:"flex",justifyContent:"center",alignItems:"center",onClick:J,onMouseMove:J,onMouseDown:J,onMouseUp:J,onWheel:J,children:re==="image"?w.jsx(Yh,{src:ue,maxWidth:"100%",maxHeight:"80vh",objectFit:"contain",alt:"Media Screen Image",onLoad:()=>console.log("Image loaded successfully:",ue),onError:be=>console.error("Error loading image:",be,ue),onClick:J}):w.jsxs(ft,{width:"100%",textAlign:"center",onClick:J,onMouseMove:J,onMouseDown:J,onMouseUp:J,onWheel:J,children:[w.jsx(nt,{mb:4,fontSize:"lg",children:"Video URL:"}),w.jsx(nt,{p:3,bg:"gray.800",borderRadius:"md",fontSize:"sm",wordBreak:"break-all",maxWidth:"100%",children:ue}),w.jsx(nt,{mt:4,fontSize:"sm",color:"gray.400",children:"Video playback will be implemented in a future update"})]})}):w.jsx(Ar,{direction:"column",align:"center",justify:"center",h:"400px",onClick:J,onMouseMove:J,onMouseDown:J,onMouseUp:J,onWheel:J,children:w.jsx(nt,{children:"No image available"})})})]})]})}),w.jsx(kze,{videoUrl:ie,videoTitle:me,mediaScreenId:de,isOpen:We,onClose:we})]})},mae=({backgroundUrl:n=null,containerRef:e})=>{const[i,o]=D.useState(!1),[l,d]=D.useState(n),p=D.useRef(null),_=D.useRef(null);return D.useEffect(()=>{const E=b=>{const{backgroundUrl:C}=b.detail;d(C),p.current&&(C?(p.current.style.backgroundImage=`url('${C}')`,p.current.style.display="block",_.current&&(_.current.style.display="block")):(p.current.style.display="none",_.current&&(_.current.style.display="none")))};return window.addEventListener("SpaceBackgroundUpdated",E),()=>{window.removeEventListener("SpaceBackgroundUpdated",E)}},[]),D.useEffect(()=>{d(n),p.current&&n!==l&&(p.current.style.backgroundImage=`url('${n}')`)},[n]),D.useEffect(()=>{if(!e||!e.current)return;const E=document.createElement("div");p.current=E,Object.assign(E.style,{position:"absolute",top:"0",left:"0",width:"100%",height:"100%",backgroundImage:l?`url('${l}')`:"none",backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat",zIndex:"20",transition:"opacity 1.5s ease-in-out",pointerEvents:"none",display:l?"block":"none"});const b=document.createElement("div");_.current=b,Object.assign(b.style,{position:"absolute",top:"0",left:"0",width:"100%",height:"100%",backdropFilter:"blur(5px)",backgroundColor:"rgba(255, 255, 255, 0.08)",zIndex:"21",transition:"opacity 1.5s ease-in-out",pointerEvents:"none",display:l?"block":"none"}),e.current.appendChild(E),e.current.appendChild(b);const C=()=>{console.log("PersistentBackground: Player instantiated event received"),o(!0),E.style.opacity="0",b.style.opacity="0",setTimeout(()=>{e.current&&e.current.contains(E)&&e.current.removeChild(E),e.current&&e.current.contains(b)&&e.current.removeChild(b)},1500)};if(window.isPlayerInstantiated)console.log("PersistentBackground: Player was already instantiated"),C();else{Ud.subscribe(Md.playerInstantiated,C);const I=()=>C();window.addEventListener("PlayerInstantiated",I);const O=setTimeout(()=>{console.log("PersistentBackground: Forcing background removal after timeout"),C()},3e4);return()=>{Ud.unsubscribe(Md.playerInstantiated,C),window.removeEventListener("PlayerInstantiated",I),clearTimeout(O),e.current&&e.current.contains(E)&&e.current.removeChild(E),e.current&&e.current.contains(b)&&e.current.removeChild(b)}}},[l,e]),null};mae.propTypes={backgroundUrl:mn.string,containerRef:mn.shape({current:mn.instanceOf(Element)})};const HQ="https://www.spacesmetaverse.com/assets/images/SpacesLogo_Loader.png",gae=({containerRef:n})=>{const{spaceID:e}=ba(),[i,o]=D.useState(!1),[l,d]=D.useState(!1),[p,_]=D.useState(0),[E,b]=D.useState("Initialising World"),[C,I]=D.useState(null),O=D.useRef(null),L=D.useRef(null),V=D.useRef(null),B=D.useRef(null),W=D.useRef(null),Z=D.useRef(null);D.useEffect(()=>(Y.log("PersistentLoader: Component mounted with spaceID:",e),Y.log("PersistentLoader: Container ref:",n),()=>{Y.log("PersistentLoader: Component unmounting")}),[]);const{error:$}=ba(),[se,ue]=D.useState(!1);return D.useEffect(()=>{$&&(Y.error("PersistentLoader: Unity error detected:",$),ue(!0),setTimeout(()=>{if(O.current){const re=O.current.querySelector("div:first-child");re&&(re.textContent="Reconnecting...")}},3e3))},[$]),D.useEffect(()=>{(async()=>{if(e){Y.log(`PersistentLoader: Fetching logo for space ${e}`);try{const pe=await Rg(e);pe&&pe.logoUrl?(Y.log(`PersistentLoader: Found logo URL: ${pe.logoUrl}`),I(pe.logoUrl)):Y.log(`PersistentLoader: No logo URL found for space ${e}`)}catch(pe){Y.error("PersistentLoader: Error fetching space logo:",pe)}}else Y.warn("PersistentLoader: No spaceID provided, cannot fetch logo")})()},[e]),D.useEffect(()=>{const re=pe=>{const{logoUrl:q}=pe.detail;Y.log(`PersistentLoader: Logo update event received with URL: ${q}`),I(q),L.current?q?(Y.log("PersistentLoader: Updating logo element with new URL"),L.current.src=q,V.current.style.display="flex"):(Y.log("PersistentLoader: Hiding logo element (no URL)"),V.current.style.display="none"):Y.warn("PersistentLoader: Logo ref is null during update")};return Y.log("PersistentLoader: Adding SpaceLogoUpdated event listener"),window.addEventListener("SpaceLogoUpdated",re),()=>{Y.log("PersistentLoader: Removing SpaceLogoUpdated event listener"),window.removeEventListener("SpaceLogoUpdated",re)}},[]),D.useEffect(()=>{if(!n||!n.current){Y.error("PersistentLoader: Container ref is null or has no current property");return}Y.log("PersistentLoader: Creating loader elements");const re=document.createElement("div");if(O.current=re,Object.assign(re.style,{position:"absolute",top:"60%",left:"50%",transform:"translate(-50%, -50%)",width:"300px",padding:"16px",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",zIndex:"50",transition:"opacity 0.8s ease-in-out",pointerEvents:"none",color:"white",fontFamily:"Arial, sans-serif",backgroundColor:"rgba(0, 0, 0, 0.4)",backdropFilter:"blur(10px)",WebkitBackdropFilter:"blur(10px)",borderRadius:"12px",boxShadow:"0 0 20px rgba(0, 0, 0, 0.3), inset 0 0 1px rgba(255, 255, 255, 0.3)",border:"1px solid rgba(255, 255, 255, 0.1)",opacity:"0"}),C){Y.log(`PersistentLoader: Creating logo element with URL: ${C}`);const ve=document.createElement("div");V.current=ve,Object.assign(ve.style,{position:"absolute",top:"37.5%",left:"50%",transform:"translate(-50%, -50%)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:"50",transition:"opacity 0.8s ease-in-out",pointerEvents:"none",padding:"8px",width:"280px",opacity:"0"});const _e=document.createElement("img");L.current=_e,_e.src=C,_e.alt="Space Logo",_e.style.maxHeight="100px",_e.style.maxWidth="100%",_e.style.objectFit="contain",_e.style.filter="drop-shadow(0 0 8px rgba(0, 0, 0, 0.7))",ve.appendChild(_e),n.current.appendChild(ve),Y.log("PersistentLoader: Logo container added to main container")}else Y.log("PersistentLoader: No logo URL available, skipping logo creation");const pe=document.createElement("style");pe.textContent=`
      @keyframes progress-glow {
        0% { background-position: 0% 50%; }
        50% { background-position: 100% 50%; }
        100% { background-position: 0% 50%; }
      }
    `,document.head.appendChild(pe),Y.log("PersistentLoader: Animation styles added to document head");const q=document.createElement("div");q.style.fontSize="16px",q.style.fontWeight="bold",q.style.textAlign="center",q.style.marginBottom="16px",q.style.color="#ffffff",q.textContent="Initialising World";const Q=document.createElement("div");Q.style.width="240px",Q.style.height="100px",Q.style.position="relative",Q.style.marginBottom="15px",Q.style.padding="0px",Q.style.overflow="hidden",Q.style.boxSizing="border-box",Q.style.transition="opacity 0.8s ease-in-out",Q.style.opacity="0";const J=document.createElement("div");J.style.width="100%",J.style.height="100%",J.style.position="absolute",J.style.top="0",J.style.left="0",J.style.maskImage=`url(${HQ})`,J.style.maskSize="contain",J.style.maskPosition="center",J.style.maskRepeat="no-repeat",J.style.webkitMaskImage=`url(${HQ})`,J.style.webkitMaskSize="contain",J.style.webkitMaskPosition="center",J.style.webkitMaskRepeat="no-repeat",J.style.background="linear-gradient(to right, #4facfe 0%, #00f2fe 15%, white 15%, white 100%)",J.style.backgroundSize="100% 100%",J.style.transition="background 0.5s ease-out",B.current=J,W.current=null,Q.appendChild(J);const ie=document.createElement("div");ie.style.marginTop="8px",ie.style.fontSize="14px",ie.style.fontWeight="bold",ie.style.color="#ffffff",ie.textContent="0%",re.appendChild(q),re.appendChild(Q),re.appendChild(ie),n.current.appendChild(re),Y.log("PersistentLoader: Loader element added to container"),setTimeout(()=>{V.current&&(V.current.style.opacity="1"),re.style.opacity="1",Q.style.opacity="1"},500);const me=ve=>{_(ve);const _e=Math.round(ve*100),Ee=`linear-gradient(to right, #4facfe 0%, #00f2fe ${_e}%, white ${_e}%, white 100%)`;J.style.background=Ee,ie.textContent=`${_e}%`,Y.log(`PersistentLoader: Progress updated to ${_e}%`)},de=ve=>{b(ve),q.textContent=ve,Y.log(`PersistentLoader: Loading stage updated to "${ve}"`)},le=[{stage:"Initialising World",progress:.33},{stage:"Loading Assets",progress:.66},{stage:"Loading User",progress:1}];se&&(le[0].stage="Connecting to Space",le[1].stage="Reconnecting...",le[2].stage="Please Wait"),de(le[0].stage),me(.25);const xe=ve=>{const _e=ve.detail.progress;Y.log(`PersistentLoader: Progress event received with value: ${_e}`),me(_e),_e<.33?de(le[0].stage):_e<.66?de(le[1].stage):de(le[2].stage)},We=()=>{Y.log("PersistentLoader: First scene loaded event received"),o(!0),de(le[1].stage),me(.66)},$e=()=>{if(Y.log("PersistentLoader: Player instantiated event received"),Z.current&&(clearInterval(Z.current),Y.log("PersistentLoader: Progress interval cleared")),d(!0),de(le[2].stage),me(1),se){Y.log("PersistentLoader: Keeping loader visible due to Unity error");return}re.style.transition="all 0.5s ease-in-out",Q.style.transition="opacity 1.2s ease-in-out",q.style.transition="opacity 0.4s ease-in-out",ie.style.transition="opacity 0.4s ease-in-out",V.current&&(V.current.style.transition="opacity 0.5s ease-in-out"),re.style.backgroundColor="rgba(0, 0, 0, 0)",re.style.backdropFilter="blur(0px)",re.style.WebkitBackdropFilter="blur(0px)",re.style.boxShadow="0 0 0 rgba(0, 0, 0, 0)",re.style.border="1px solid rgba(255, 255, 255, 0)",q.style.opacity="0",ie.style.opacity="0",V.current&&(V.current.style.opacity="0"),setTimeout(()=>{Q.style.opacity="0",setTimeout(()=>{n.current&&n.current.contains(re)?(n.current.removeChild(re),Y.log("PersistentLoader: Loader element removed after fade")):Y.warn("PersistentLoader: Could not remove loader element (not found in container)"),V.current&&n.current&&n.current.contains(V.current)?(n.current.removeChild(V.current),Y.log("PersistentLoader: Logo container removed after fade")):V.current&&Y.warn("PersistentLoader: Could not remove logo container (not found in container)")},1300)},400)};if(window.isPlayerInstantiated)Y.log("PersistentLoader: Player was already instantiated"),$e();else{Y.log("PersistentLoader: Subscribing to playerInstantiated event"),Ud.subscribe(Md.playerInstantiated,$e);const ve=()=>$e();Y.log("PersistentLoader: Adding PlayerInstantiated event listener"),window.addEventListener("PlayerInstantiated",ve),Y.log("PersistentLoader: Adding firstSceneLoaded event listener"),Ud.subscribe(Md.firstSceneLoaded,We),Y.log("PersistentLoader: Adding UnityProgress event listener"),window.addEventListener("UnityProgress",xe),Z.current=setInterval(()=>{l||_(Ee=>{const ke=Math.min(Ee+.02,.95);return me(ke),ke<.33&&E!==le[0].stage?de(le[0].stage):ke>=.33&&ke<.66&&E!==le[1].stage?de(le[1].stage):ke>=.66&&E!==le[2].stage&&de(le[2].stage),ke})},300);const _e=setTimeout(()=>{Y.log("PersistentLoader: Forcing loader removal after timeout"),$e()},6e4);return()=>{Y.log("PersistentLoader: Cleaning up event listeners"),Ud.unsubscribe(Md.playerInstantiated,$e),window.removeEventListener("PlayerInstantiated",ve),Ud.unsubscribe(Md.firstSceneLoaded,We),window.removeEventListener("UnityProgress",xe),clearInterval(Z.current),clearTimeout(_e),n.current&&n.current.contains(re)&&(n.current.removeChild(re),Y.log("PersistentLoader: Loader element removed during cleanup")),V.current&&n.current&&n.current.contains(V.current)&&(n.current.removeChild(V.current),Y.log("PersistentLoader: Logo container removed during cleanup"))}}},[C,n]),null};gae.propTypes={containerRef:mn.shape({current:mn.instanceOf(Element)})};const Lze=({size:n="md",tooltipPlacement:e="top",className:i="livestream-button"})=>{const[o,l]=D.useState(!1),[d,p]=D.useState(!1),{savedStreamData:_,reloadStreamData:E}=Zoe(),{spaceID:b}=ba(),{user:C}=D.useContext(Go),I=wc(),[O,L]=D.useState(!1),V=WK((_==null?void 0:_.rtmpUrl)||""),B=WK((_==null?void 0:_.streamKey)||"");D.useEffect(()=>{if(b){Y.log("LiveStreamButton: Forcing reload of stream data"),E();const $=()=>{Y.log("LiveStreamButton: Stream settings changed, reloading data"),E()};return window.addEventListener("StreamSettingsChanged",$),()=>{window.removeEventListener("StreamSettingsChanged",$)}}},[b,E]),D.useEffect(()=>{(async()=>{if(!(C!=null&&C.uid)||!b){L(!1);return}try{const se=await MBe(C.uid,"disruptiveAdmin"),ue=await BBe(C,b);L(se||ue)}catch(se){Y.error("Error checking user permissions:",se),L(!1)}})()},[C==null?void 0:C.uid,b]),D.useEffect(()=>{Y.log("LiveStreamButton: Current streaming data:",{enabled:_==null?void 0:_.enabled,hasRtmpUrl:!!(_!=null&&_.rtmpUrl),hasStreamKey:!!(_!=null&&_.streamKey),hasPermission:O,isPlayerReady:d})},[_,O,d]),D.useEffect(()=>{const $=()=>{Y.log("LiveStreamButton: Player instantiated, showing button"),p(!0)};return window.addEventListener("PlayerInstantiated",$),window.isPlayerInstantiated&&(Y.log("LiveStreamButton: Player was already instantiated"),p(!0)),()=>{window.removeEventListener("PlayerInstantiated",$)}},[]);const W=()=>{window.dispatchEvent(new Event("modal-opened")),l(!0)},Z=()=>{window.dispatchEvent(new Event("modal-closed")),l(!1)};return!d||!O||(_==null?void 0:_.enabled)!==!0?(Y.log("LiveStreamButton: Not rendering button because:",{playerNotReady:!d,noPermission:!O,streamingDisabled:(_==null?void 0:_.enabled)!==!0,enabledValue:_==null?void 0:_.enabled}),null):w.jsxs(w.Fragment,{children:[w.jsx(Mp,{label:"Live Stream Info",placement:e,hasArrow:!0,children:w.jsx(zl,{size:n,borderRadius:"full",bg:"black",icon:w.jsx(G8e,{color:"white"}),borderWidth:"1px",borderColor:"whiteAlpha.300",className:i,"data-testid":"livestream-button",cursor:"pointer",onClick:W})}),w.jsxs(so,{isOpen:o,onClose:Z,isCentered:!0,size:"md",children:[w.jsx(ao,{backdropFilter:"blur(4px)"}),w.jsxs(oo,{bg:"rgba(23, 25, 35, 0.95)",color:"white",borderRadius:"md",boxShadow:"0 4px 20px rgba(0, 0, 0, 0.5)",children:[w.jsx(ec,{borderBottom:"1px solid",borderColor:"whiteAlpha.200",py:2,fontSize:"md",fontWeight:"600",children:"Live Stream Info"}),w.jsx(zo,{size:"sm",color:"whiteAlpha.700",_hover:{color:"white",bg:"whiteAlpha.100"}}),w.jsx(wo,{p:4,children:_!=null&&_.rtmpUrl&&(_!=null&&_.streamKey)?w.jsxs(ft,{children:[w.jsx(nt,{fontSize:"sm",mb:4,color:"white",children:"Copy these details to your streaming software (OBS, Streamlabs, etc.)"}),w.jsxs(ft,{mb:4,children:[w.jsx(nt,{fontSize:"xs",fontWeight:"600",mb:1,color:"white",children:"RTMP URL"}),w.jsx(Ar,{children:w.jsxs(Sg,{size:"sm",children:[w.jsx(pi,{value:_.rtmpUrl,isReadOnly:!0,bg:"whiteAlpha.100",borderColor:"whiteAlpha.200",_hover:{borderColor:"whiteAlpha.300"},pr:"2.5rem",color:"white"}),w.jsx(Kk,{children:w.jsx(Wo,{"aria-label":"Copy RTMP URL",icon:V.hasCopied?w.jsx(FQ,{}):w.jsx(jQ,{}),size:"xs",colorScheme:V.hasCopied?"green":"blue",onClick:()=>{V.onCopy(),I({title:"RTMP URL copied",status:"success",duration:2e3,isClosable:!0,position:"top"})}})})]})})]}),w.jsxs(ft,{mb:4,children:[w.jsx(nt,{fontSize:"xs",fontWeight:"600",mb:1,color:"white",children:"Stream Key"}),w.jsx(Ar,{children:w.jsxs(Sg,{size:"sm",children:[w.jsx(pi,{value:_.streamKey,isReadOnly:!0,bg:"whiteAlpha.100",borderColor:"whiteAlpha.200",_hover:{borderColor:"whiteAlpha.300"},pr:"2.5rem",type:"password",color:"white"}),w.jsx(Kk,{children:w.jsx(Wo,{"aria-label":"Copy Stream Key",icon:B.hasCopied?w.jsx(FQ,{}):w.jsx(jQ,{}),size:"xs",colorScheme:B.hasCopied?"green":"blue",onClick:()=>{B.onCopy(),I({title:"Stream Key copied",status:"success",duration:2e3,isClosable:!0,position:"top"})}})})]})})]}),w.jsx(nt,{fontSize:"xs",color:"whiteAlpha.800",mt:4,children:"Stream to this RTMP server using the Stream Key above. View and manage stream settings in the Space Manager."})]}):w.jsxs(ft,{textAlign:"center",p:4,children:[w.jsx(nt,{color:"white",children:"No stream configuration found for this space."}),w.jsx(nt,{fontSize:"xs",mt:2,color:"whiteAlpha.800",children:"Configure streaming in the Space Manager under Stream tab."})]})})]})]})]})},_ae=({settings:n})=>{const{placePrefab:e,directPlacePrefab:i,isUnityLoaded:o}=nae(),l=wc(),[d,p]=D.useState({x:0,y:1,z:0}),[_,E]=D.useState({x:0,y:0,z:0}),[b,C]=D.useState({x:1,y:1,z:1}),[I,O]=D.useState("TestPrefab"),[L,V]=D.useState(!1),[B,W]=D.useState(!1),Z=n==null?void 0:n.spaceID,{saveObject:$,isLoading:se}=w8e(Z);D.useEffect(()=>{const q=Q=>{W(Q.detail.enabled)};return window.addEventListener("editModeChanged",q),()=>{window.removeEventListener("editModeChanged",q)}},[]);const ue=(q,Q)=>{p(J=>({...J,[q]:parseFloat(Q)}))},re=async()=>{Y.log("Placing prefab with values:",{prefabName:I,position:d,rotation:_,scale:b,useDirect:L,spaceId:Z});let q;if(L?(q=i(I,d,_,b),Y.log("Used direct method to place prefab")):(q=e(I,d,_,b),Y.log("Used hook method to place prefab")),q)if(Z&&B){const Q=await $(I,d,_,b);l(Q?{title:"Success",description:"Prefab placed and saved to space",status:"success",duration:3e3,isClosable:!0}:{title:"Warning",description:"Prefab placed but failed to save to space",status:"warning",duration:3e3,isClosable:!0})}else l({title:"Success",description:"Prefab placed",status:"success",duration:3e3,isClosable:!0});else l({title:"Error",description:"Failed to place prefab",status:"error",duration:3e3,isClosable:!0})},pe=()=>{const q={x:(Math.random()*10-5).toFixed(2),y:(Math.random()*2).toFixed(2),z:(Math.random()*10-5).toFixed(2)};p({x:parseFloat(q.x),y:parseFloat(q.y),z:parseFloat(q.z)}),Y.log("Set random position:",q)};return B?w.jsxs(ft,{className:"prefab-placer",bg:"rgba(0, 0, 0, 0.7)",color:"white",p:4,borderRadius:"md",maxW:"300px",boxShadow:"0 4px 6px rgba(0, 0, 0, 0.1)",children:[w.jsx(nt,{fontWeight:"bold",mb:2,children:"Place Prefab in Unity"}),w.jsxs(ft,{mb:3,children:[w.jsx(nt,{fontSize:"sm",children:"Prefab Name:"}),w.jsx("input",{type:"text",value:I,onChange:q=>O(q.target.value),style:{width:"100%",padding:"8px",marginTop:"4px",background:"rgba(255, 255, 255, 0.1)",border:"1px solid rgba(255, 255, 255, 0.3)",borderRadius:"4px",color:"white"}})]}),w.jsxs(Ar,{direction:"column",gap:2,mb:3,children:[w.jsx(nt,{fontSize:"sm",children:"Position:"}),w.jsxs(Ar,{gap:2,children:[w.jsxs(ft,{children:[w.jsx(nt,{fontSize:"xs",children:"X"}),w.jsxs(pk,{value:d.x,onChange:q=>ue("x",q),step:.5,precision:2,size:"sm",children:[w.jsx(gk,{bg:"rgba(255, 255, 255, 0.1)",borderColor:"rgba(255, 255, 255, 0.3)"}),w.jsxs(mk,{children:[w.jsx(yk,{}),w.jsx(_k,{})]})]})]}),w.jsxs(ft,{children:[w.jsx(nt,{fontSize:"xs",children:"Y"}),w.jsxs(pk,{value:d.y,onChange:q=>ue("y",q),step:.5,precision:2,size:"sm",children:[w.jsx(gk,{bg:"rgba(255, 255, 255, 0.1)",borderColor:"rgba(255, 255, 255, 0.3)"}),w.jsxs(mk,{children:[w.jsx(yk,{}),w.jsx(_k,{})]})]})]}),w.jsxs(ft,{children:[w.jsx(nt,{fontSize:"xs",children:"Z"}),w.jsxs(pk,{value:d.z,onChange:q=>ue("z",q),step:.5,precision:2,size:"sm",children:[w.jsx(gk,{bg:"rgba(255, 255, 255, 0.1)",borderColor:"rgba(255, 255, 255, 0.3)"}),w.jsxs(mk,{children:[w.jsx(yk,{}),w.jsx(_k,{})]})]})]})]}),w.jsx(br,{onClick:pe,size:"xs",colorScheme:"blue",variant:"outline",mt:1,children:"Random Position"})]}),w.jsxs(Mr,{display:"flex",alignItems:"center",mb:3,children:[w.jsx(ns,{htmlFor:"use-direct",mb:"0",fontSize:"sm",children:"Use Direct Method"}),w.jsx(of,{id:"use-direct",colorScheme:"green",isChecked:L,onChange:q=>V(q.target.checked)})]}),w.jsx(br,{onClick:re,colorScheme:"green",width:"100%",isDisabled:!o||se,children:se?"Loading...":"Place Prefab"}),!o&&w.jsx(nt,{fontSize:"xs",color:"red.300",mt:1,children:"Waiting for Unity to load..."}),!Z&&w.jsx(nt,{fontSize:"xs",color:"yellow.300",mt:1,children:"No space ID available - prefabs won't be saved"})]}):null};_ae.propTypes={settings:mn.shape({spaceID:mn.string})};const Mze="a2a7f4eb05284449b1063eb71d8301dc",jU=()=>document.querySelector("canvas")||document.getElementById("unity-canvas"),A3=D.forwardRef(({settings:n},e)=>{const{unityProvider:i,isLoaded:o,error:l}=ba(),d=c8e();u8e();const p=Ef(),_=C8e(d),{user:E}=D.useContext(Go),[b,C]=D.useState(!1),[I,O]=D.useState(window.devicePixelRatio),[L,V]=l8e();tae().find(ke=>ke.isLocalPlayer);const[W,Z]=D.useState(!0),[$,se]=D.useState(!0),[ue,re]=D.useState(!1),[pe,q]=D.useState(!1),[Q,J]=D.useState(!1);D.useEffect(()=>{Q?(console.log("WebGLRenderer: Modal opened, disabling Unity keyboard capture"),Ld(!0)):(console.log("WebGLRenderer: Modal closed, enabling Unity keyboard capture"),o&&!pe&&Ld(!1).then(()=>{setTimeout(()=>{vy(!0)},100)}))},[Q,o,pe]);const ie=n.spaceID||"default",me=D.useMemo(()=>{const be=new URLSearchParams(window.location.search).get("sessionId")||ie;return console.log("WebGLRenderer: Using session ID:",be),be},[ie]),[de,le]=D.useState(null);D.useEffect(()=>{E!=null&&E.uid&&Fu(E.uid).then(ke=>{le(ke),console.log("WebGLRenderer: User profile loaded:",(ke==null?void 0:ke.Nickname)||"Unknown")}).catch(ke=>{console.error("Error fetching user profile:",ke)})},[E==null?void 0:E.uid]),D.useEffect(()=>{if(l||!E){Y.log("WebGLRenderer: User not logged in or Unity error, showing sign-in modal");const ke=setTimeout(()=>{q(!0),J(!0)},1e3);return()=>clearTimeout(ke)}else q(!1)},[l,E]),D.useEffect(()=>{console.log("WebGLRenderer: Setting up player instantiation listener");const ke=()=>{console.log("WebGLRenderer: Player instantiated event received"),se(!0),window.dispatchEvent(new CustomEvent("PlayerInstantiated")),window.isPlayerInstantiated=!0};window.isPlayerInstantiated&&(console.log("WebGLRenderer: Player was already instantiated from previous mount"),se(!0)),Ud.subscribe(Md.playerInstantiated,ke);const we=setTimeout(()=>{$||(console.log("WebGLRenderer: Forcing player instantiation after timeout"),se(!0),window.isPlayerInstantiated=!0,window.dispatchEvent(new CustomEvent("PlayerInstantiated")))},5e3);return()=>{Ud.unsubscribe(Md.playerInstantiated,ke),clearTimeout(we)}},[$]),D.useEffect(()=>{const ke=()=>{console.log("WebGLRenderer: Modal opened"),J(!0)},we=()=>{console.log("WebGLRenderer: Modal closed"),J(!1)};return window.addEventListener("modal-opened",ke),window.addEventListener("modal-closed",we),()=>{window.removeEventListener("modal-opened",ke),window.removeEventListener("modal-closed",we)}},[]),D.useEffect(()=>{J(L!==null)},[L]),D.useEffect(()=>{o||d?setTimeout(()=>{C(!0),Y.log("WebGLRenderer: Unity is ready to receive messages.")},5e3):Y.warn("WebGLRenderer: Unity is NOT ready yet.")},[o,d]),D.useEffect(()=>{o&&i&&setTimeout(()=>{if(window.unityInstance)try{console.log("WebGLRenderer: Disabling Unity keyboard capture on initialization"),window.unityInstance.SendMessage("WebGLInput","SetCaptureAllKeyboardInput",!1)}catch(ke){console.error("WebGLRenderer: Error disabling Unity keyboard capture:",ke)}},1e3)},[o,i]),D.useEffect(()=>{const ke=document.getElementById("webgl-root");return ke?(console.log("WebGLRenderer: Found webgl-root element, ensuring it is visible"),ke.style.display="block",ke.getAttribute("data-space-id")!==ie&&(ke.setAttribute("data-space-id",ie),console.log(`WebGLRenderer: Set data-space-id attribute to ${ie}`))):console.error("WebGLRenderer: Could not find webgl-root element"),()=>{}},[ie]),D.useEffect(()=>{const ke=()=>{const Ie=jU();Ie?(console.log("WebGLRenderer: Configuring Unity canvas for keyboard input"),Ie.tabIndex=1,Ie.style.outline="none",Ie.addEventListener("click",()=>{console.log("WebGLRenderer: Unity canvas clicked, enabling keyboard capture"),Q||vy(!0)}),console.log("WebGLRenderer: Unity canvas configured with tabIndex=1")):console.warn("WebGLRenderer: Could not find Unity canvas to configure")};ke();const we=setTimeout(ke,1e3),be=()=>{console.log("WebGLRenderer: Received unityReady event, configuring canvas"),ke()};return window.addEventListener("unityReady",be),()=>{clearTimeout(we),window.removeEventListener("unityReady",be)}},[o,Q]);const xe=D.useCallback(()=>{console.log("WebGLRenderer: Unity canvas clicked, enabling keyboard capture"),Q||vy(!0)},[Q]);D.useEffect(()=>{if(o&&i){const ke=jU();if(ke)return console.log("WebGLRenderer: Adding click handler to Unity canvas"),ke.addEventListener("click",xe),()=>{ke.removeEventListener("click",xe)}}},[o,i,xe]),D.useEffect(()=>{if(o&&i){console.log("WebGLRenderer: Setting up global click handler for focus management");const ke=we=>{if(Q){console.log("WebGLRenderer: Modal is open, not refocusing Unity on click");return}if(we.target.tagName==="INPUT"||we.target.tagName==="TEXTAREA"||we.target.tagName==="SELECT"||we.target.tagName==="BUTTON"){console.log("WebGLRenderer: Clicked on form element, not refocusing Unity");return}if(we.target.closest(".chakra-modal__content")||we.target.closest('[role="dialog"]')||we.target.closest('[role="menu"]')||we.target.closest(".chakra-popover__content")||we.target.closest('[role="tooltip"]')){console.log("WebGLRenderer: Clicked inside modal/dialog content, not refocusing Unity");return}const be=jU();if(be&&(we.target===be||be.contains(we.target)))return;if(we.target.closest(".webgl-overlay")||we.target.closest(".game-ui")||we.target.closest(".player-list")||we.target.closest(".unity-ui-overlay")){console.log("WebGLRenderer: Clicked on UI overlay that should allow keyboard events"),setTimeout(()=>{Q||vy(!0)},50);return}console.log("WebGLRenderer: Clicked outside forms/modals/special UI, refocusing Unity canvas"),setTimeout(()=>{be&&!Q&&((be.tabIndex===void 0||be.tabIndex<0)&&(be.tabIndex=1),be.focus(),vy(!0))},50)};return document.addEventListener("click",ke,!0),()=>{document.removeEventListener("click",ke,!0)}}},[o,i,Q]),D.useEffect(()=>{const ke=we=>{Y.log("WebGLRenderer: Received 'sendUserToUnity' event"),p("FirebaseUserFromReact",we)};return Ud.subscribe(Md.sendUserToUnity,ke),()=>Ud.unsubscribe(Md.sendUserToUnity,ke)},[p]);const{setFullscreenRef:We,fullscreenRef:$e}=Bd();D.useEffect(()=>{We(e.current)},[e,We]);const ve=()=>{Z(!W)},_e=E&&n.enableVoiceChat;console.log("WebGLRenderer: Render with state:",{user:!!E,userId:E==null?void 0:E.uid,isPlayerInstantiated:$,showVoiceChat:_e,sessionId:me}),D.useEffect(()=>{const ke=we=>{re(we.detail.enabled)};return window.addEventListener("editModeChanged",ke),()=>{window.removeEventListener("editModeChanged",ke)}},[]),eae(),p8e();const Ee=D.useRef(null);return w.jsxs(ft,{className:"webgl-renderer",children:[n.urlLoadingBackground&&w.jsx(mae,{backgroundUrl:n.urlLoadingBackground,containerRef:Ee}),!pe&&w.jsx(gae,{containerRef:Ee}),pe&&w.jsx(ft,{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",zIndex:"100",width:"100%",height:"100%",display:"flex",justifyContent:"center",alignItems:"center",children:w.jsx(UN,{mode:"button",label:"Sign In",initialIsOpen:!0,buttonProps:{size:"lg",colorScheme:"blue"}})}),w.jsx(XF,{containerRef:$e.current?$e:document.body,children:w.jsxs("div",{ref:e,style:{width:"100%",height:"100%",aspectRatio:"auto",position:"absolute"},children:[w.jsxs(ft,{position:"absolute",zIndex:"10",top:4,right:4,display:"flex",alignItems:"center",gap:2,children:[n.showAuthButton&&w.jsx(I8e,{}),E&&w.jsx(Lze,{size:"md"}),_e&&w.jsxs(dae,{appId:Mze,channel:me,uid:E==null?void 0:E.uid,enabled:!0,children:[w.jsx(sze,{size:"md",defaultMuted:!0,joinOnClick:!0}),w.jsx(aze,{userNickname:de==null?void 0:de.Nickname})]}),w.jsx($8e,{}),w.jsx(ft,{position:"relative",zIndex:"9999",children:w.jsx(Rze,{onTogglePlayerList:ve,spaceID:ie})})]}),w.jsxs(ft,{ref:Ee,position:"relative",overflow:"hidden",width:"100%",height:"100%",bgRepeat:"no-repeat",bgSize:"cover",bgPosition:"center",bgColor:"#666666",children:[w.jsx(ft,{position:"absolute",top:"0",left:"0",width:"100%",height:"100%",backdropFilter:"blur(8px)",backgroundColor:"rgba(255, 255, 255, 0.1)",zIndex:"0"}),w.jsx(ft,{..._,width:"100%",height:"100%",position:"absolute",zIndex:"1",children:i?w.jsx(Qoe.Unity,{unityProvider:i,style:{width:"100%",height:"100%"},devicePixelRatio:I,tabIndex:1}):w.jsx(ft,{width:"100%",height:"100%"})}),w.jsx(ft,{position:"absolute",zIndex:"6",width:"100%",height:"100%",style:{display:"none"},children:w.jsx(R8e,{})})]}),w.jsx(ft,{..._,position:"absolute",zIndex:"2",top:4,left:4,display:"flex",alignItems:"flex-start",gap:3,height:"50px",children:n.showDisruptiveLogo&&w.jsx(Yh,{src:n.urlDisruptiveLogo,width:"100px",alt:"Disruptive Logo"})}),w.jsx(ft,{..._,position:"absolute",zIndex:"2",bottom:4,left:4,display:"flex",alignItems:"flex-start",gap:3,children:E&&w.jsx(_ae,{settings:n})}),w.jsxs(ft,{..._,position:"absolute",zIndex:"2",bottom:4,right:4,display:"flex",alignItems:"flex-start",gap:3,children:[n.showHelpButton&&w.jsx(A8e,{}),w.jsx(Y8e,{})]}),w.jsx(X8e,{}),w.jsx(J8e,{isOpen:L!==null,onClose:()=>{console.log(" Closing nameplate modal"),V()},playerName:(L==null?void 0:L.playerName)||"Unknown Player",playerId:(L==null?void 0:L.playerId)||"Unknown ID"}),w.jsx(Q8e,{isVisible:W,onToggleVisibility:Z,spaceID:ie}),w.jsx(xze,{})]})})]})});A3.displayName="WebGLRenderer";A3.propTypes={settings:mn.shape({urlLoadingBackground:mn.string,showAuthButton:mn.bool,showDisruptiveLogo:mn.bool,urlDisruptiveLogo:mn.string,showHelpButton:mn.bool,enableVoiceChat:mn.bool,spaceID:mn.string})};typeof window<"u"&&!window.MultipleView&&(console.log("Defining fallback MultipleView class - scripts may not be loaded yet"),window.MultipleView=class{constructor(){console.log("HISPlayer: Fallback MultipleView constructor called"),this.multiView={getPlayer:()=>(console.log("HISPlayer: getPlayer called from fallback"),{isPlaying:!1,play:()=>(console.log("HISPlayer: play called"),!0),pause:()=>(console.log("HISPlayer: pause called"),!0),mute:e=>(console.log("HISPlayer: mute called with state:",e),!0),isMuted:!1,seek:e=>(console.log("HISPlayer: seek called with time:",e),!0),setVolume:e=>(console.log("HISPlayer: setVolume called with volume:",e),!0),getVolume:()=>(console.log("HISPlayer: getVolume called"),1),getCurrentTime:()=>(console.log("HISPlayer: getCurrentTime called"),0),getDuration:()=>(console.log("HISPlayer: getDuration called"),100)}),initialize:()=>(console.log("HISPlayer: initialize called"),!0),setUnityContext:e=>(console.log("HISPlayer: setUnityContext called with:",e),window.hisPlayerContextId=e,!0),release:()=>(console.log("HISPlayer: release called"),!0),setProperties:e=>(console.log("HISPlayer: setProperties called with:",e),!0),setMultiPaths:e=>(console.log("HISPlayer: setMultiPaths called with:",e),window._hisplayer_paths=e,!0)}}});if(typeof window<"u"&&!window._hisPlayerInitialized){if(Y.log("WebGLLoader: Initializing HISPlayer functions"),window._hisPlayerInitialized=!0,window._hisplayer_event_queue=window._hisplayer_event_queue||[],window._hisplayer_error_queue=window._hisplayer_error_queue||[],!document.getElementById("hisplayer-error")){const n=document.createElement("div");n.id="hisplayer-error",n.style.position="absolute",n.style.top="10px",n.style.left="50%",n.style.transform="translateX(-50%)",n.style.color="red",n.style.zIndex="9999",document.body.appendChild(n),Y.log("WebGLLoader: Created hisplayer-error div")}window.isErrorQueueEmpty=window.isErrorQueueEmpty||function(){return window._hisplayer_error_queue.length===0},window.getNextError=window.getNextError||function(){return window._hisplayer_error_queue.length>0?window._hisplayer_error_queue.shift():""},window.isEventQueueEmpty=window.isEventQueueEmpty||function(){return window._hisplayer_event_queue.length===0},window.getNextEvent=window.getNextEvent||function(){return window._hisplayer_event_queue.length>0?window._hisplayer_event_queue.shift():""},window.setUpContext=window.setUpContext||function(n){console.log("HISPlayer: setUpContext called with contextId:",n),window.hisPlayerContextId=n;try{if(window.MultipleView){console.log("HISPlayer: Creating MultipleView instance");const e=new window.MultipleView;if(e&&e.multiView&&typeof e.multiView.setUnityContext=="function")return e.multiView.setUnityContext(n),window._hisplayer_instance=e,console.log("HISPlayer: Successfully set Unity context ID"),!0;console.error("HISPlayer: Player initialization failed - missing expected methods")}else{console.error("HISPlayer: MultipleView class not found"),window.MultipleView=class{constructor(){console.log("HISPlayer: Backup MultipleView constructor called"),this.multiView={getPlayer:()=>(console.log("HISPlayer: getPlayer called from backup"),{isPlaying:!1,play:()=>!0,pause:()=>!0,mute:()=>!0,isMuted:!1,seek:()=>!0,setVolume:()=>!0,getVolume:()=>1,getCurrentTime:()=>0,getDuration:()=>100}),initialize:()=>!0,setUnityContext:o=>(window.hisPlayerContextId=o,!0),release:()=>!0,setProperties:()=>!0,setMultiPaths:()=>!0}}},console.log("HISPlayer: Trying again with backup MultipleView");const e=new window.MultipleView;return e.multiView.setUnityContext(n),window._hisplayer_instance=e,!0}}catch(e){console.error("HISPlayer: Error in setUpContext:",e);const i=document.getElementById("hisplayer-error");i&&(i.innerHTML="Error: "+e.message)}return!1}}const P3=({spaceID:n,overrideSettings:e})=>{const i=D.useRef(null),[o,l]=D.useState(!0),[d,p]=D.useState({spaceID:n,loaderUrl:"",dataUrl:"",frameworkUrl:"",codeUrl:""}),[_,E]=D.useState({urlDisruptiveLogo:"gs://disruptive-metaverse.appspot.com/common/images/Disruptive-logo-white-p-500.png",urlLoadingBackground:"",showDisruptiveLogo:null,showAuthButton:null,showHelpButton:null,enableVoiceChat:!0,spaceID:n});return D.useEffect(()=>{(async()=>{try{const C=await Rg(n);if(C){p(L=>({...L,spaceID:n,loaderUrl:C.loaderUrl,dataUrl:C.dataUrl,frameworkUrl:C.frameworkUrl,codeUrl:C.codeUrl}));const I=await Ok(_.urlDisruptiveLogo);let O="";if(C.backgroundUrl)O=C.backgroundUrl;else if(C.backgroundGsUrl)try{O=await Ok(C.backgroundGsUrl)}catch(L){Y.warn("WebGLLoader: Error fetching background from GS URL:",L)}else if(C.gsUrlLoadingBackground)try{O=await Ok(C.gsUrlLoadingBackground)}catch(L){Y.warn("WebGLLoader: Error fetching background from legacy GS URL:",L)}E(L=>({...L,urlLoadingBackground:O,showAuthButton:C.showAuthButton!==void 0?C.showAuthButton:!0,showDisruptiveLogo:C.showDisruptiveLogo!==void 0?C.showDisruptiveLogo:!0,showHelpButton:C.showHelpButton!==void 0?C.showHelpButton:!0,enableVoiceChat:C.enableVoiceChat!==void 0?C.enableVoiceChat:!0,urlDisruptiveLogo:I,spaceID:n,...e||{}})),l(!1)}else Y.error(`WebGLLoader: No configuration found for spaceID: ${n}`)}catch(C){Y.error("WebGLLoader: Error fetching space data:",C)}finally{l(!1)}})()},[n,_.urlDisruptiveLogo,e]),D.useEffect(()=>{o||(Y.log("WebGLLoader: Unity config from Firebase",d),Y.log("WebGLLoader: Space settings from Firebase",_))},[o]),w.jsx(w.Fragment,{children:o?w.jsx("div",{className:"flex justify-center items-center h-full mt-12",children:"Getting space data..."}):w.jsx(a8e,{...d,children:w.jsx(A3,{ref:i,settings:_})})})};P3.propTypes={spaceID:mn.string.isRequired,overrideSettings:mn.object};function $Q(){const n=document.getElementById("webgl-root");if(n){const e=n.getAttribute("data-space-id"),i=n.getAttribute("data-theme")||"default",o=()=>{const[l,d]=D.useState(null);return D.useEffect(()=>{FC(i).then(d)},[]),l?w.jsx(z1,{theme:l,children:w.jsx(NN,{children:w.jsx(E3,{children:w.jsx(P3,{spaceID:e})})})}):w.jsx("div",{children:"Loading theme..."})};try{w1.createRoot(n).render(w.jsx(o,{}))}catch(l){console.warn("Error initializing WebGL:",l)}}}typeof window<"u"&&(document.readyState==="loading"?document.addEventListener("DOMContentLoaded",$Q):$Q());const Uze=(n,e)=>{try{const i=Yp(gr,`spaces/${n}/chatMessages`),o=new Date,l=_1(i,EBe("timestamp","asc"),SBe(o));return hoe(l,d=>{const p=[];d.docChanges().forEach(_=>{if(_.type==="added"){const E=_.doc.data();console.log("Firestore document data:",E),p.push({id:_.doc.id,...E})}}),p.length>0&&e(p)})}catch(i){throw Y.error("Error subscribing to space chat messages:",i),i}};function Wd(n){const e=Object.prototype.toString.call(n);return n instanceof Date||typeof n=="object"&&e==="[object Date]"?new n.constructor(+n):typeof n=="number"||e==="[object Number]"||typeof n=="string"||e==="[object String]"?new Date(n):new Date(NaN)}function Xy(n,e){return n instanceof Date?new n.constructor(e):new Date(e)}const yae=6048e5,Vze=864e5;let Fze={};function jN(){return Fze}function XC(n,e){var _,E,b,C;const i=jN(),o=(e==null?void 0:e.weekStartsOn)??((E=(_=e==null?void 0:e.locale)==null?void 0:_.options)==null?void 0:E.weekStartsOn)??i.weekStartsOn??((C=(b=i.locale)==null?void 0:b.options)==null?void 0:C.weekStartsOn)??0,l=Wd(n),d=l.getDay(),p=(d<o?7:0)+d-o;return l.setDate(l.getDate()-p),l.setHours(0,0,0,0),l}function T1(n){return XC(n,{weekStartsOn:1})}function Eae(n){const e=Wd(n),i=e.getFullYear(),o=Xy(n,0);o.setFullYear(i+1,0,4),o.setHours(0,0,0,0);const l=T1(o),d=Xy(n,0);d.setFullYear(i,0,4),d.setHours(0,0,0,0);const p=T1(d);return e.getTime()>=l.getTime()?i+1:e.getTime()>=p.getTime()?i:i-1}function KQ(n){const e=Wd(n);return e.setHours(0,0,0,0),e}function qQ(n){const e=Wd(n),i=new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds()));return i.setUTCFullYear(e.getFullYear()),+n-+i}function jze(n,e){const i=KQ(n),o=KQ(e),l=+i-qQ(i),d=+o-qQ(o);return Math.round((l-d)/Vze)}function Bze(n){const e=Eae(n),i=Xy(n,0);return i.setFullYear(e,0,4),i.setHours(0,0,0,0),T1(i)}function Wze(n){return n instanceof Date||typeof n=="object"&&Object.prototype.toString.call(n)==="[object Date]"}function zze(n){if(!Wze(n)&&typeof n!="number")return!1;const e=Wd(n);return!isNaN(Number(e))}function Gze(n){const e=Wd(n),i=Xy(n,0);return i.setFullYear(e.getFullYear(),0,1),i.setHours(0,0,0,0),i}const Hze={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},$ze=(n,e,i)=>{let o;const l=Hze[n];return typeof l=="string"?o=l:e===1?o=l.one:o=l.other.replace("{{count}}",e.toString()),i!=null&&i.addSuffix?i.comparison&&i.comparison>0?"in "+o:o+" ago":o};function BU(n){return(e={})=>{const i=e.width?String(e.width):n.defaultWidth;return n.formats[i]||n.formats[n.defaultWidth]}}const Kze={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},qze={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},Yze={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},Xze={date:BU({formats:Kze,defaultWidth:"full"}),time:BU({formats:qze,defaultWidth:"full"}),dateTime:BU({formats:Yze,defaultWidth:"full"})},Jze={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},Qze=(n,e,i,o)=>Jze[n];function xw(n){return(e,i)=>{const o=i!=null&&i.context?String(i.context):"standalone";let l;if(o==="formatting"&&n.formattingValues){const p=n.defaultFormattingWidth||n.defaultWidth,_=i!=null&&i.width?String(i.width):p;l=n.formattingValues[_]||n.formattingValues[p]}else{const p=n.defaultWidth,_=i!=null&&i.width?String(i.width):n.defaultWidth;l=n.values[_]||n.values[p]}const d=n.argumentCallback?n.argumentCallback(e):e;return l[d]}}const Zze={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},eGe={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},tGe={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},nGe={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},rGe={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},iGe={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},sGe=(n,e)=>{const i=Number(n),o=i%100;if(o>20||o<10)switch(o%10){case 1:return i+"st";case 2:return i+"nd";case 3:return i+"rd"}return i+"th"},oGe={ordinalNumber:sGe,era:xw({values:Zze,defaultWidth:"wide"}),quarter:xw({values:eGe,defaultWidth:"wide",argumentCallback:n=>n-1}),month:xw({values:tGe,defaultWidth:"wide"}),day:xw({values:nGe,defaultWidth:"wide"}),dayPeriod:xw({values:rGe,defaultWidth:"wide",formattingValues:iGe,defaultFormattingWidth:"wide"})};function Lw(n){return(e,i={})=>{const o=i.width,l=o&&n.matchPatterns[o]||n.matchPatterns[n.defaultMatchWidth],d=e.match(l);if(!d)return null;const p=d[0],_=o&&n.parsePatterns[o]||n.parsePatterns[n.defaultParseWidth],E=Array.isArray(_)?cGe(_,I=>I.test(p)):aGe(_,I=>I.test(p));let b;b=n.valueCallback?n.valueCallback(E):E,b=i.valueCallback?i.valueCallback(b):b;const C=e.slice(p.length);return{value:b,rest:C}}}function aGe(n,e){for(const i in n)if(Object.prototype.hasOwnProperty.call(n,i)&&e(n[i]))return i}function cGe(n,e){for(let i=0;i<n.length;i++)if(e(n[i]))return i}function lGe(n){return(e,i={})=>{const o=e.match(n.matchPattern);if(!o)return null;const l=o[0],d=e.match(n.parsePattern);if(!d)return null;let p=n.valueCallback?n.valueCallback(d[0]):d[0];p=i.valueCallback?i.valueCallback(p):p;const _=e.slice(l.length);return{value:p,rest:_}}}const uGe=/^(\d+)(th|st|nd|rd)?/i,dGe=/\d+/i,hGe={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},fGe={any:[/^b/i,/^(a|c)/i]},pGe={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},mGe={any:[/1/i,/2/i,/3/i,/4/i]},gGe={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},_Ge={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},yGe={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},EGe={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},vGe={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},SGe={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},bGe={ordinalNumber:lGe({matchPattern:uGe,parsePattern:dGe,valueCallback:n=>parseInt(n,10)}),era:Lw({matchPatterns:hGe,defaultMatchWidth:"wide",parsePatterns:fGe,defaultParseWidth:"any"}),quarter:Lw({matchPatterns:pGe,defaultMatchWidth:"wide",parsePatterns:mGe,defaultParseWidth:"any",valueCallback:n=>n+1}),month:Lw({matchPatterns:gGe,defaultMatchWidth:"wide",parsePatterns:_Ge,defaultParseWidth:"any"}),day:Lw({matchPatterns:yGe,defaultMatchWidth:"wide",parsePatterns:EGe,defaultParseWidth:"any"}),dayPeriod:Lw({matchPatterns:vGe,defaultMatchWidth:"any",parsePatterns:SGe,defaultParseWidth:"any"})},TGe={code:"en-US",formatDistance:$ze,formatLong:Xze,formatRelative:Qze,localize:oGe,match:bGe,options:{weekStartsOn:0,firstWeekContainsDate:1}};function wGe(n){const e=Wd(n);return jze(e,Gze(e))+1}function CGe(n){const e=Wd(n),i=+T1(e)-+Bze(e);return Math.round(i/yae)+1}function vae(n,e){var C,I,O,L;const i=Wd(n),o=i.getFullYear(),l=jN(),d=(e==null?void 0:e.firstWeekContainsDate)??((I=(C=e==null?void 0:e.locale)==null?void 0:C.options)==null?void 0:I.firstWeekContainsDate)??l.firstWeekContainsDate??((L=(O=l.locale)==null?void 0:O.options)==null?void 0:L.firstWeekContainsDate)??1,p=Xy(n,0);p.setFullYear(o+1,0,d),p.setHours(0,0,0,0);const _=XC(p,e),E=Xy(n,0);E.setFullYear(o,0,d),E.setHours(0,0,0,0);const b=XC(E,e);return i.getTime()>=_.getTime()?o+1:i.getTime()>=b.getTime()?o:o-1}function RGe(n,e){var _,E,b,C;const i=jN(),o=(e==null?void 0:e.firstWeekContainsDate)??((E=(_=e==null?void 0:e.locale)==null?void 0:_.options)==null?void 0:E.firstWeekContainsDate)??i.firstWeekContainsDate??((C=(b=i.locale)==null?void 0:b.options)==null?void 0:C.firstWeekContainsDate)??1,l=vae(n,e),d=Xy(n,0);return d.setFullYear(l,0,o),d.setHours(0,0,0,0),XC(d,e)}function IGe(n,e){const i=Wd(n),o=+XC(i,e)-+RGe(i,e);return Math.round(o/yae)+1}function Ti(n,e){const i=n<0?"-":"",o=Math.abs(n).toString().padStart(e,"0");return i+o}const lg={y(n,e){const i=n.getFullYear(),o=i>0?i:1-i;return Ti(e==="yy"?o%100:o,e.length)},M(n,e){const i=n.getMonth();return e==="M"?String(i+1):Ti(i+1,2)},d(n,e){return Ti(n.getDate(),e.length)},a(n,e){const i=n.getHours()/12>=1?"pm":"am";switch(e){case"a":case"aa":return i.toUpperCase();case"aaa":return i;case"aaaaa":return i[0];case"aaaa":default:return i==="am"?"a.m.":"p.m."}},h(n,e){return Ti(n.getHours()%12||12,e.length)},H(n,e){return Ti(n.getHours(),e.length)},m(n,e){return Ti(n.getMinutes(),e.length)},s(n,e){return Ti(n.getSeconds(),e.length)},S(n,e){const i=e.length,o=n.getMilliseconds(),l=Math.trunc(o*Math.pow(10,i-3));return Ti(l,e.length)}},PS={midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},YQ={G:function(n,e,i){const o=n.getFullYear()>0?1:0;switch(e){case"G":case"GG":case"GGG":return i.era(o,{width:"abbreviated"});case"GGGGG":return i.era(o,{width:"narrow"});case"GGGG":default:return i.era(o,{width:"wide"})}},y:function(n,e,i){if(e==="yo"){const o=n.getFullYear(),l=o>0?o:1-o;return i.ordinalNumber(l,{unit:"year"})}return lg.y(n,e)},Y:function(n,e,i,o){const l=vae(n,o),d=l>0?l:1-l;if(e==="YY"){const p=d%100;return Ti(p,2)}return e==="Yo"?i.ordinalNumber(d,{unit:"year"}):Ti(d,e.length)},R:function(n,e){const i=Eae(n);return Ti(i,e.length)},u:function(n,e){const i=n.getFullYear();return Ti(i,e.length)},Q:function(n,e,i){const o=Math.ceil((n.getMonth()+1)/3);switch(e){case"Q":return String(o);case"QQ":return Ti(o,2);case"Qo":return i.ordinalNumber(o,{unit:"quarter"});case"QQQ":return i.quarter(o,{width:"abbreviated",context:"formatting"});case"QQQQQ":return i.quarter(o,{width:"narrow",context:"formatting"});case"QQQQ":default:return i.quarter(o,{width:"wide",context:"formatting"})}},q:function(n,e,i){const o=Math.ceil((n.getMonth()+1)/3);switch(e){case"q":return String(o);case"qq":return Ti(o,2);case"qo":return i.ordinalNumber(o,{unit:"quarter"});case"qqq":return i.quarter(o,{width:"abbreviated",context:"standalone"});case"qqqqq":return i.quarter(o,{width:"narrow",context:"standalone"});case"qqqq":default:return i.quarter(o,{width:"wide",context:"standalone"})}},M:function(n,e,i){const o=n.getMonth();switch(e){case"M":case"MM":return lg.M(n,e);case"Mo":return i.ordinalNumber(o+1,{unit:"month"});case"MMM":return i.month(o,{width:"abbreviated",context:"formatting"});case"MMMMM":return i.month(o,{width:"narrow",context:"formatting"});case"MMMM":default:return i.month(o,{width:"wide",context:"formatting"})}},L:function(n,e,i){const o=n.getMonth();switch(e){case"L":return String(o+1);case"LL":return Ti(o+1,2);case"Lo":return i.ordinalNumber(o+1,{unit:"month"});case"LLL":return i.month(o,{width:"abbreviated",context:"standalone"});case"LLLLL":return i.month(o,{width:"narrow",context:"standalone"});case"LLLL":default:return i.month(o,{width:"wide",context:"standalone"})}},w:function(n,e,i,o){const l=IGe(n,o);return e==="wo"?i.ordinalNumber(l,{unit:"week"}):Ti(l,e.length)},I:function(n,e,i){const o=CGe(n);return e==="Io"?i.ordinalNumber(o,{unit:"week"}):Ti(o,e.length)},d:function(n,e,i){return e==="do"?i.ordinalNumber(n.getDate(),{unit:"date"}):lg.d(n,e)},D:function(n,e,i){const o=wGe(n);return e==="Do"?i.ordinalNumber(o,{unit:"dayOfYear"}):Ti(o,e.length)},E:function(n,e,i){const o=n.getDay();switch(e){case"E":case"EE":case"EEE":return i.day(o,{width:"abbreviated",context:"formatting"});case"EEEEE":return i.day(o,{width:"narrow",context:"formatting"});case"EEEEEE":return i.day(o,{width:"short",context:"formatting"});case"EEEE":default:return i.day(o,{width:"wide",context:"formatting"})}},e:function(n,e,i,o){const l=n.getDay(),d=(l-o.weekStartsOn+8)%7||7;switch(e){case"e":return String(d);case"ee":return Ti(d,2);case"eo":return i.ordinalNumber(d,{unit:"day"});case"eee":return i.day(l,{width:"abbreviated",context:"formatting"});case"eeeee":return i.day(l,{width:"narrow",context:"formatting"});case"eeeeee":return i.day(l,{width:"short",context:"formatting"});case"eeee":default:return i.day(l,{width:"wide",context:"formatting"})}},c:function(n,e,i,o){const l=n.getDay(),d=(l-o.weekStartsOn+8)%7||7;switch(e){case"c":return String(d);case"cc":return Ti(d,e.length);case"co":return i.ordinalNumber(d,{unit:"day"});case"ccc":return i.day(l,{width:"abbreviated",context:"standalone"});case"ccccc":return i.day(l,{width:"narrow",context:"standalone"});case"cccccc":return i.day(l,{width:"short",context:"standalone"});case"cccc":default:return i.day(l,{width:"wide",context:"standalone"})}},i:function(n,e,i){const o=n.getDay(),l=o===0?7:o;switch(e){case"i":return String(l);case"ii":return Ti(l,e.length);case"io":return i.ordinalNumber(l,{unit:"day"});case"iii":return i.day(o,{width:"abbreviated",context:"formatting"});case"iiiii":return i.day(o,{width:"narrow",context:"formatting"});case"iiiiii":return i.day(o,{width:"short",context:"formatting"});case"iiii":default:return i.day(o,{width:"wide",context:"formatting"})}},a:function(n,e,i){const l=n.getHours()/12>=1?"pm":"am";switch(e){case"a":case"aa":return i.dayPeriod(l,{width:"abbreviated",context:"formatting"});case"aaa":return i.dayPeriod(l,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return i.dayPeriod(l,{width:"narrow",context:"formatting"});case"aaaa":default:return i.dayPeriod(l,{width:"wide",context:"formatting"})}},b:function(n,e,i){const o=n.getHours();let l;switch(o===12?l=PS.noon:o===0?l=PS.midnight:l=o/12>=1?"pm":"am",e){case"b":case"bb":return i.dayPeriod(l,{width:"abbreviated",context:"formatting"});case"bbb":return i.dayPeriod(l,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return i.dayPeriod(l,{width:"narrow",context:"formatting"});case"bbbb":default:return i.dayPeriod(l,{width:"wide",context:"formatting"})}},B:function(n,e,i){const o=n.getHours();let l;switch(o>=17?l=PS.evening:o>=12?l=PS.afternoon:o>=4?l=PS.morning:l=PS.night,e){case"B":case"BB":case"BBB":return i.dayPeriod(l,{width:"abbreviated",context:"formatting"});case"BBBBB":return i.dayPeriod(l,{width:"narrow",context:"formatting"});case"BBBB":default:return i.dayPeriod(l,{width:"wide",context:"formatting"})}},h:function(n,e,i){if(e==="ho"){let o=n.getHours()%12;return o===0&&(o=12),i.ordinalNumber(o,{unit:"hour"})}return lg.h(n,e)},H:function(n,e,i){return e==="Ho"?i.ordinalNumber(n.getHours(),{unit:"hour"}):lg.H(n,e)},K:function(n,e,i){const o=n.getHours()%12;return e==="Ko"?i.ordinalNumber(o,{unit:"hour"}):Ti(o,e.length)},k:function(n,e,i){let o=n.getHours();return o===0&&(o=24),e==="ko"?i.ordinalNumber(o,{unit:"hour"}):Ti(o,e.length)},m:function(n,e,i){return e==="mo"?i.ordinalNumber(n.getMinutes(),{unit:"minute"}):lg.m(n,e)},s:function(n,e,i){return e==="so"?i.ordinalNumber(n.getSeconds(),{unit:"second"}):lg.s(n,e)},S:function(n,e){return lg.S(n,e)},X:function(n,e,i){const o=n.getTimezoneOffset();if(o===0)return"Z";switch(e){case"X":return JQ(o);case"XXXX":case"XX":return yy(o);case"XXXXX":case"XXX":default:return yy(o,":")}},x:function(n,e,i){const o=n.getTimezoneOffset();switch(e){case"x":return JQ(o);case"xxxx":case"xx":return yy(o);case"xxxxx":case"xxx":default:return yy(o,":")}},O:function(n,e,i){const o=n.getTimezoneOffset();switch(e){case"O":case"OO":case"OOO":return"GMT"+XQ(o,":");case"OOOO":default:return"GMT"+yy(o,":")}},z:function(n,e,i){const o=n.getTimezoneOffset();switch(e){case"z":case"zz":case"zzz":return"GMT"+XQ(o,":");case"zzzz":default:return"GMT"+yy(o,":")}},t:function(n,e,i){const o=Math.trunc(n.getTime()/1e3);return Ti(o,e.length)},T:function(n,e,i){const o=n.getTime();return Ti(o,e.length)}};function XQ(n,e=""){const i=n>0?"-":"+",o=Math.abs(n),l=Math.trunc(o/60),d=o%60;return d===0?i+String(l):i+String(l)+e+Ti(d,2)}function JQ(n,e){return n%60===0?(n>0?"-":"+")+Ti(Math.abs(n)/60,2):yy(n,e)}function yy(n,e=""){const i=n>0?"-":"+",o=Math.abs(n),l=Ti(Math.trunc(o/60),2),d=Ti(o%60,2);return i+l+e+d}const QQ=(n,e)=>{switch(n){case"P":return e.date({width:"short"});case"PP":return e.date({width:"medium"});case"PPP":return e.date({width:"long"});case"PPPP":default:return e.date({width:"full"})}},Sae=(n,e)=>{switch(n){case"p":return e.time({width:"short"});case"pp":return e.time({width:"medium"});case"ppp":return e.time({width:"long"});case"pppp":default:return e.time({width:"full"})}},AGe=(n,e)=>{const i=n.match(/(P+)(p+)?/)||[],o=i[1],l=i[2];if(!l)return QQ(n,e);let d;switch(o){case"P":d=e.dateTime({width:"short"});break;case"PP":d=e.dateTime({width:"medium"});break;case"PPP":d=e.dateTime({width:"long"});break;case"PPPP":default:d=e.dateTime({width:"full"});break}return d.replace("{{date}}",QQ(o,e)).replace("{{time}}",Sae(l,e))},PGe={p:Sae,P:AGe},OGe=/^D+$/,kGe=/^Y+$/,NGe=["D","DD","YY","YYYY"];function DGe(n){return OGe.test(n)}function xGe(n){return kGe.test(n)}function LGe(n,e,i){const o=MGe(n,e,i);if(console.warn(o),NGe.includes(n))throw new RangeError(o)}function MGe(n,e,i){const o=n[0]==="Y"?"years":"days of the month";return`Use \`${n.toLowerCase()}\` instead of \`${n}\` (in \`${e}\`) for formatting ${o} to the input \`${i}\`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md`}const UGe=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,VGe=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,FGe=/^'([^]*?)'?$/,jGe=/''/g,BGe=/[a-zA-Z]/;function WGe(n,e,i){var C,I,O,L;const o=jN(),l=o.locale??TGe,d=o.firstWeekContainsDate??((I=(C=o.locale)==null?void 0:C.options)==null?void 0:I.firstWeekContainsDate)??1,p=o.weekStartsOn??((L=(O=o.locale)==null?void 0:O.options)==null?void 0:L.weekStartsOn)??0,_=Wd(n);if(!zze(_))throw new RangeError("Invalid time value");let E=e.match(VGe).map(V=>{const B=V[0];if(B==="p"||B==="P"){const W=PGe[B];return W(V,l.formatLong)}return V}).join("").match(UGe).map(V=>{if(V==="''")return{isToken:!1,value:"'"};const B=V[0];if(B==="'")return{isToken:!1,value:zGe(V)};if(YQ[B])return{isToken:!0,value:V};if(B.match(BGe))throw new RangeError("Format string contains an unescaped latin alphabet character `"+B+"`");return{isToken:!1,value:V}});l.localize.preprocessor&&(E=l.localize.preprocessor(_,E));const b={firstWeekContainsDate:d,weekStartsOn:p,locale:l};return E.map(V=>{if(!V.isToken)return V.value;const B=V.value;(xGe(B)||DGe(B))&&LGe(B,e,String(n));const W=YQ[B[0]];return W(_,B,l.localize,b)}).join("")}function zGe(n){const e=n.match(FGe);return e?e[1].replace(jGe,"'"):n}const GGe=mf(ft),bae=({name:n,timestamp:e,text:i,isCurrentUser:o})=>{console.log("Message props:",{name:n,timestamp:e,text:i,isCurrentUser:o});const l=e&&e.toDate?WGe(e.toDate(),"HH:mm"):"Invalid date";return w.jsxs(GGe,{display:"flex",flexDirection:"column",alignItems:o?"flex-end":"flex-start",initial:{opacity:0},animate:{opacity:1},transition:{duration:.5},children:[w.jsxs(ft,{w:"auto",maxW:"80%",bg:o?"secondary.500":"primary.200",color:o?"white":"black",p:"10px",borderRadius:"10px",alignSelf:o?"flex-end":"flex-start",wordBreak:"break-word",children:[w.jsx(nt,{fontWeight:"bold",children:n}),w.jsx(nt,{children:i})]}),w.jsx(nt,{color:"copy.light",fontSize:"xs",mt:"4px",mx:"6px",mb:"10px",textAlign:o?"right":"left",children:l})]})};bae.propTypes={name:mn.string.isRequired,timestamp:mn.object,text:mn.string.isRequired,isCurrentUser:mn.bool.isRequired};const HGe=({spaceID:n})=>{const[e,i]=D.useState([]),{user:o}=D.useContext(Go),l=D.useRef(null);return D.useEffect(()=>{const d=Uze(n,p=>{console.log("New messages received:",p),i(_=>[..._,...p]),Y.log("Messages updated:",p)});return()=>d()},[n]),D.useEffect(()=>{l.current&&l.current.scrollIntoView({behavior:"smooth"})},[e]),w.jsxs(ft,{className:"messages-container",display:"flex",flexDirection:"column",my:"10px",overflowY:"auto",maxHeight:"80vh",children:[e.map(d=>{const p=d.uid===(o==null?void 0:o.uid);return w.jsx(bae,{name:d.user,timestamp:d.timestamp,text:d.text,isCurrentUser:p},d.id)}),w.jsx("div",{ref:l})]})},$Ge=({spaceID:n})=>{},Tae=({spaceID:n})=>{const{user:e}=D.useContext(Go);return e?w.jsxs(ft,{children:[w.jsx(ft,{height:"400px",overflowY:"auto",border:"1px solid #ccc",backgroundColor:"tertiaryAlpha.600",padding:"10px",children:w.jsx(HGe,{spaceID:n})}),w.jsx(ft,{mt:"8px",children:w.jsx($Ge,{spaceID:n})})]}):(console.log("No user found, returning login message"),w.jsx(ft,{children:w.jsx(nt,{children:"Please log in to view the chat."})}))},$O=document.getElementById("chat-root");if($O){const n=$O.getAttribute("data-space-id"),e=$O.getAttribute("data-theme")||"default",i=()=>{const[o,l]=D.useState(null);return D.useEffect(()=>{FC(e).then(l)},[]),o?w.jsx(z1,{theme:o,children:w.jsx(NN,{children:w.jsx(Tae,{spaceID:n})})}):w.jsx("div",{children:"Loading theme..."})};w1.createRoot($O).render(w.jsx(i,{}))}else console.error("Root element 'chat-root' not found.");class KGe extends D.Component{constructor(e){super(e),this.state={hasError:!1}}static getDerivedStateFromError(e){return{hasError:!0}}componentDidCatch(e,i){console.error("WebGL Error:",e,i)}render(){return this.state.hasError?w.jsx(ft,{p:4,bg:"red.100",color:"red.900",borderRadius:"md",children:w.jsx(nt,{children:"WebGL component error. Please refresh the page."})}):this.props.children}}const KO=document.getElementById("root");if(KO){const n=KO.getAttribute("data-space-id"),e=KO.getAttribute("data-theme")||"default",i=()=>{const[o,l]=D.useState(null);return D.useEffect(()=>{FC(e).then(l);const d=()=>{document.hidden||FC(e).then(l)};return document.addEventListener("visibilitychange",d),()=>{document.removeEventListener("visibilitychange",d)}},[]),o?w.jsx(z1,{theme:o,children:w.jsx(NN,{children:w.jsx(E3,{children:w.jsxs(Jr,{spacing:4,align:"stretch",children:[w.jsxs(Ar,{justify:"space-between",align:"center",p:4,bg:"gray.700",m:0,position:"relative",zIndex:"100",children:[w.jsx(nt,{fontSize:"xl",fontWeight:"bold",color:"white",children:"LOGO"}),w.jsx(ft,{zIndex:"100",position:"relative",children:w.jsx(Yoe,{})})]}),w.jsx(wV,{maxW:"container.xl",p:0,zIndex:"1",children:w.jsx(rne,{ratio:16/9,bg:"blue.100",m:0,children:w.jsx(ft,{id:"webgl-root","data-space-id":n,w:"100%",m:0,children:w.jsx(KGe,{children:w.jsx(P3,{spaceID:n})})})})}),w.jsx(wV,{maxW:"container.xl",p:0,children:w.jsx(Tae,{spaceID:n})})]})})})}):w.jsx("div",{children:"Loading theme..."})};w1.createRoot(KO).render(w.jsx(i,{}))}else console.error("Root element 'root' not found.");export{CEe as a,JSe as b,Gi as c,qSe as d,YGe as e,qGe as f,jSe as g,Du as i,qh as m,YRe as t};
