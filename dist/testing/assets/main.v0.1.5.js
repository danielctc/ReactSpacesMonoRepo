function fEe(n,e){for(var i=0;i<e.length;i++){const o=e[i];if(typeof o!="string"&&!Array.isArray(o)){for(const l in o)if(l!=="default"&&!(l in n)){const u=Object.getOwnPropertyDescriptor(o,l);u&&Object.defineProperty(n,l,u.get?u:{enumerable:!0,get:()=>o[l]})}}}return Object.freeze(Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}))}var ky=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Yg(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var vM={exports:{}},wT={},SM={exports:{}},Tr={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var AK;function mEe(){if(AK)return Tr;AK=1;var n=Symbol.for("react.element"),e=Symbol.for("react.portal"),i=Symbol.for("react.fragment"),o=Symbol.for("react.strict_mode"),l=Symbol.for("react.profiler"),u=Symbol.for("react.provider"),f=Symbol.for("react.context"),_=Symbol.for("react.forward_ref"),E=Symbol.for("react.suspense"),b=Symbol.for("react.memo"),C=Symbol.for("react.lazy"),I=Symbol.iterator;function P(Pe){return Pe===null||typeof Pe!="object"?null:(Pe=I&&Pe[I]||Pe["@@iterator"],typeof Pe=="function"?Pe:null)}var L={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},M=Object.assign,F={};function B(Pe,Te,ke){this.props=Pe,this.context=Te,this.refs=F,this.updater=ke||L}B.prototype.isReactComponent={},B.prototype.setState=function(Pe,Te){if(typeof Pe!="object"&&typeof Pe!="function"&&Pe!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,Pe,Te,"setState")},B.prototype.forceUpdate=function(Pe){this.updater.enqueueForceUpdate(this,Pe,"forceUpdate")};function Z(){}Z.prototype=B.prototype;function K(Pe,Te,ke){this.props=Pe,this.context=Te,this.refs=F,this.updater=ke||L}var re=K.prototype=new Z;re.constructor=K,M(re,B.prototype),re.isPureReactComponent=!0;var ae=Array.isArray,ne=Object.prototype.hasOwnProperty,pe={current:null},X={key:!0,ref:!0,__self:!0,__source:!0};function J(Pe,Te,ke){var Ue,Be={},qe=null,$e=null;if(Te!=null)for(Ue in Te.ref!==void 0&&($e=Te.ref),Te.key!==void 0&&(qe=""+Te.key),Te)ne.call(Te,Ue)&&!X.hasOwnProperty(Ue)&&(Be[Ue]=Te[Ue]);var st=arguments.length-2;if(st===1)Be.children=ke;else if(1<st){for(var Je=Array(st),Rt=0;Rt<st;Rt++)Je[Rt]=arguments[Rt+2];Be.children=Je}if(Pe&&Pe.defaultProps)for(Ue in st=Pe.defaultProps,st)Be[Ue]===void 0&&(Be[Ue]=st[Ue]);return{$$typeof:n,type:Pe,key:qe,ref:$e,props:Be,_owner:pe.current}}function Y(Pe,Te){return{$$typeof:n,type:Pe.type,key:Te,ref:Pe.ref,props:Pe.props,_owner:Pe._owner}}function ie(Pe){return typeof Pe=="object"&&Pe!==null&&Pe.$$typeof===n}function le(Pe){var Te={"=":"=0",":":"=2"};return"$"+Pe.replace(/[=:]/g,function(ke){return Te[ke]})}var de=/\/+/g;function ue(Pe,Te){return typeof Pe=="object"&&Pe!==null&&Pe.key!=null?le(""+Pe.key):Te.toString(36)}function Oe(Pe,Te,ke,Ue,Be){var qe=typeof Pe;(qe==="undefined"||qe==="boolean")&&(Pe=null);var $e=!1;if(Pe===null)$e=!0;else switch(qe){case"string":case"number":$e=!0;break;case"object":switch(Pe.$$typeof){case n:case e:$e=!0}}if($e)return $e=Pe,Be=Be($e),Pe=Ue===""?"."+ue($e,0):Ue,ae(Be)?(ke="",Pe!=null&&(ke=Pe.replace(de,"$&/")+"/"),Oe(Be,Te,ke,"",function(Rt){return Rt})):Be!=null&&(ie(Be)&&(Be=Y(Be,ke+(!Be.key||$e&&$e.key===Be.key?"":(""+Be.key).replace(de,"$&/")+"/")+Pe)),Te.push(Be)),1;if($e=0,Ue=Ue===""?".":Ue+":",ae(Pe))for(var st=0;st<Pe.length;st++){qe=Pe[st];var Je=Ue+ue(qe,st);$e+=Oe(qe,Te,ke,Je,Be)}else if(Je=P(Pe),typeof Je=="function")for(Pe=Je.call(Pe),st=0;!(qe=Pe.next()).done;)qe=qe.value,Je=Ue+ue(qe,st++),$e+=Oe(qe,Te,ke,Je,Be);else if(qe==="object")throw Te=String(Pe),Error("Objects are not valid as a React child (found: "+(Te==="[object Object]"?"object with keys {"+Object.keys(Pe).join(", ")+"}":Te)+"). If you meant to render a collection of children, use an array instead.");return $e}function Ve(Pe,Te,ke){if(Pe==null)return Pe;var Ue=[],Be=0;return Oe(Pe,Ue,"","",function(qe){return Te.call(ke,qe,Be++)}),Ue}function xe(Pe){if(Pe._status===-1){var Te=Pe._result;Te=Te(),Te.then(function(ke){(Pe._status===0||Pe._status===-1)&&(Pe._status=1,Pe._result=ke)},function(ke){(Pe._status===0||Pe._status===-1)&&(Pe._status=2,Pe._result=ke)}),Pe._status===-1&&(Pe._status=0,Pe._result=Te)}if(Pe._status===1)return Pe._result.default;throw Pe._result}var Re={current:null},ve={transition:null},be={ReactCurrentDispatcher:Re,ReactCurrentBatchConfig:ve,ReactCurrentOwner:pe};function We(){throw Error("act(...) is not supported in production builds of React.")}return Tr.Children={map:Ve,forEach:function(Pe,Te,ke){Ve(Pe,function(){Te.apply(this,arguments)},ke)},count:function(Pe){var Te=0;return Ve(Pe,function(){Te++}),Te},toArray:function(Pe){return Ve(Pe,function(Te){return Te})||[]},only:function(Pe){if(!ie(Pe))throw Error("React.Children.only expected to receive a single React element child.");return Pe}},Tr.Component=B,Tr.Fragment=i,Tr.Profiler=l,Tr.PureComponent=K,Tr.StrictMode=o,Tr.Suspense=E,Tr.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=be,Tr.act=We,Tr.cloneElement=function(Pe,Te,ke){if(Pe==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+Pe+".");var Ue=M({},Pe.props),Be=Pe.key,qe=Pe.ref,$e=Pe._owner;if(Te!=null){if(Te.ref!==void 0&&(qe=Te.ref,$e=pe.current),Te.key!==void 0&&(Be=""+Te.key),Pe.type&&Pe.type.defaultProps)var st=Pe.type.defaultProps;for(Je in Te)ne.call(Te,Je)&&!X.hasOwnProperty(Je)&&(Ue[Je]=Te[Je]===void 0&&st!==void 0?st[Je]:Te[Je])}var Je=arguments.length-2;if(Je===1)Ue.children=ke;else if(1<Je){st=Array(Je);for(var Rt=0;Rt<Je;Rt++)st[Rt]=arguments[Rt+2];Ue.children=st}return{$$typeof:n,type:Pe.type,key:Be,ref:qe,props:Ue,_owner:$e}},Tr.createContext=function(Pe){return Pe={$$typeof:f,_currentValue:Pe,_currentValue2:Pe,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},Pe.Provider={$$typeof:u,_context:Pe},Pe.Consumer=Pe},Tr.createElement=J,Tr.createFactory=function(Pe){var Te=J.bind(null,Pe);return Te.type=Pe,Te},Tr.createRef=function(){return{current:null}},Tr.forwardRef=function(Pe){return{$$typeof:_,render:Pe}},Tr.isValidElement=ie,Tr.lazy=function(Pe){return{$$typeof:C,_payload:{_status:-1,_result:Pe},_init:xe}},Tr.memo=function(Pe,Te){return{$$typeof:b,type:Pe,compare:Te===void 0?null:Te}},Tr.startTransition=function(Pe){var Te=ve.transition;ve.transition={};try{Pe()}finally{ve.transition=Te}},Tr.unstable_act=We,Tr.useCallback=function(Pe,Te){return Re.current.useCallback(Pe,Te)},Tr.useContext=function(Pe){return Re.current.useContext(Pe)},Tr.useDebugValue=function(){},Tr.useDeferredValue=function(Pe){return Re.current.useDeferredValue(Pe)},Tr.useEffect=function(Pe,Te){return Re.current.useEffect(Pe,Te)},Tr.useId=function(){return Re.current.useId()},Tr.useImperativeHandle=function(Pe,Te,ke){return Re.current.useImperativeHandle(Pe,Te,ke)},Tr.useInsertionEffect=function(Pe,Te){return Re.current.useInsertionEffect(Pe,Te)},Tr.useLayoutEffect=function(Pe,Te){return Re.current.useLayoutEffect(Pe,Te)},Tr.useMemo=function(Pe,Te){return Re.current.useMemo(Pe,Te)},Tr.useReducer=function(Pe,Te,ke){return Re.current.useReducer(Pe,Te,ke)},Tr.useRef=function(Pe){return Re.current.useRef(Pe)},Tr.useState=function(Pe){return Re.current.useState(Pe)},Tr.useSyncExternalStore=function(Pe,Te,ke){return Re.current.useSyncExternalStore(Pe,Te,ke)},Tr.useTransition=function(){return Re.current.useTransition()},Tr.version="18.3.1",Tr}var PK;function Ju(){return PK||(PK=1,SM.exports=mEe()),SM.exports}/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var OK;function gEe(){if(OK)return wT;OK=1;var n=Ju(),e=Symbol.for("react.element"),i=Symbol.for("react.fragment"),o=Object.prototype.hasOwnProperty,l=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,u={key:!0,ref:!0,__self:!0,__source:!0};function f(_,E,b){var C,I={},P=null,L=null;b!==void 0&&(P=""+b),E.key!==void 0&&(P=""+E.key),E.ref!==void 0&&(L=E.ref);for(C in E)o.call(E,C)&&!u.hasOwnProperty(C)&&(I[C]=E[C]);if(_&&_.defaultProps)for(C in E=_.defaultProps,E)I[C]===void 0&&(I[C]=E[C]);return{$$typeof:e,type:_,key:P,ref:L,props:I,_owner:l.current}}return wT.Fragment=i,wT.jsx=f,wT.jsxs=f,wT}var kK;function _Ee(){return kK||(kK=1,vM.exports=gEe()),vM.exports}var S=_Ee(),k=Ju();const gi=Yg(k),NK=fEe({__proto__:null,default:gi},[k]);var TO={},bM={exports:{}},ul={},wM={exports:{}},TM={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var DK;function yEe(){return DK||(DK=1,function(n){function e(ve,be){var We=ve.length;ve.push(be);e:for(;0<We;){var Pe=We-1>>>1,Te=ve[Pe];if(0<l(Te,be))ve[Pe]=be,ve[We]=Te,We=Pe;else break e}}function i(ve){return ve.length===0?null:ve[0]}function o(ve){if(ve.length===0)return null;var be=ve[0],We=ve.pop();if(We!==be){ve[0]=We;e:for(var Pe=0,Te=ve.length,ke=Te>>>1;Pe<ke;){var Ue=2*(Pe+1)-1,Be=ve[Ue],qe=Ue+1,$e=ve[qe];if(0>l(Be,We))qe<Te&&0>l($e,Be)?(ve[Pe]=$e,ve[qe]=We,Pe=qe):(ve[Pe]=Be,ve[Ue]=We,Pe=Ue);else if(qe<Te&&0>l($e,We))ve[Pe]=$e,ve[qe]=We,Pe=qe;else break e}}return be}function l(ve,be){var We=ve.sortIndex-be.sortIndex;return We!==0?We:ve.id-be.id}if(typeof performance=="object"&&typeof performance.now=="function"){var u=performance;n.unstable_now=function(){return u.now()}}else{var f=Date,_=f.now();n.unstable_now=function(){return f.now()-_}}var E=[],b=[],C=1,I=null,P=3,L=!1,M=!1,F=!1,B=typeof setTimeout=="function"?setTimeout:null,Z=typeof clearTimeout=="function"?clearTimeout:null,K=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function re(ve){for(var be=i(b);be!==null;){if(be.callback===null)o(b);else if(be.startTime<=ve)o(b),be.sortIndex=be.expirationTime,e(E,be);else break;be=i(b)}}function ae(ve){if(F=!1,re(ve),!M)if(i(E)!==null)M=!0,xe(ne);else{var be=i(b);be!==null&&Re(ae,be.startTime-ve)}}function ne(ve,be){M=!1,F&&(F=!1,Z(J),J=-1),L=!0;var We=P;try{for(re(be),I=i(E);I!==null&&(!(I.expirationTime>be)||ve&&!le());){var Pe=I.callback;if(typeof Pe=="function"){I.callback=null,P=I.priorityLevel;var Te=Pe(I.expirationTime<=be);be=n.unstable_now(),typeof Te=="function"?I.callback=Te:I===i(E)&&o(E),re(be)}else o(E);I=i(E)}if(I!==null)var ke=!0;else{var Ue=i(b);Ue!==null&&Re(ae,Ue.startTime-be),ke=!1}return ke}finally{I=null,P=We,L=!1}}var pe=!1,X=null,J=-1,Y=5,ie=-1;function le(){return!(n.unstable_now()-ie<Y)}function de(){if(X!==null){var ve=n.unstable_now();ie=ve;var be=!0;try{be=X(!0,ve)}finally{be?ue():(pe=!1,X=null)}}else pe=!1}var ue;if(typeof K=="function")ue=function(){K(de)};else if(typeof MessageChannel<"u"){var Oe=new MessageChannel,Ve=Oe.port2;Oe.port1.onmessage=de,ue=function(){Ve.postMessage(null)}}else ue=function(){B(de,0)};function xe(ve){X=ve,pe||(pe=!0,ue())}function Re(ve,be){J=B(function(){ve(n.unstable_now())},be)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(ve){ve.callback=null},n.unstable_continueExecution=function(){M||L||(M=!0,xe(ne))},n.unstable_forceFrameRate=function(ve){0>ve||125<ve?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Y=0<ve?Math.floor(1e3/ve):5},n.unstable_getCurrentPriorityLevel=function(){return P},n.unstable_getFirstCallbackNode=function(){return i(E)},n.unstable_next=function(ve){switch(P){case 1:case 2:case 3:var be=3;break;default:be=P}var We=P;P=be;try{return ve()}finally{P=We}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=function(){},n.unstable_runWithPriority=function(ve,be){switch(ve){case 1:case 2:case 3:case 4:case 5:break;default:ve=3}var We=P;P=ve;try{return be()}finally{P=We}},n.unstable_scheduleCallback=function(ve,be,We){var Pe=n.unstable_now();switch(typeof We=="object"&&We!==null?(We=We.delay,We=typeof We=="number"&&0<We?Pe+We:Pe):We=Pe,ve){case 1:var Te=-1;break;case 2:Te=250;break;case 5:Te=1073741823;break;case 4:Te=1e4;break;default:Te=5e3}return Te=We+Te,ve={id:C++,callback:be,priorityLevel:ve,startTime:We,expirationTime:Te,sortIndex:-1},We>Pe?(ve.sortIndex=We,e(b,ve),i(E)===null&&ve===i(b)&&(F?(Z(J),J=-1):F=!0,Re(ae,We-Pe))):(ve.sortIndex=Te,e(E,ve),M||L||(M=!0,xe(ne))),ve},n.unstable_shouldYield=le,n.unstable_wrapCallback=function(ve){var be=P;return function(){var We=P;P=be;try{return ve.apply(this,arguments)}finally{P=We}}}}(TM)),TM}var xK;function EEe(){return xK||(xK=1,wM.exports=yEe()),wM.exports}/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var LK;function vEe(){if(LK)return ul;LK=1;var n=Ju(),e=EEe();function i(p){for(var g="https://reactjs.org/docs/error-decoder.html?invariant="+p,T=1;T<arguments.length;T++)g+="&args[]="+encodeURIComponent(arguments[T]);return"Minified React error #"+p+"; visit "+g+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var o=new Set,l={};function u(p,g){f(p,g),f(p+"Capture",g)}function f(p,g){for(l[p]=g,p=0;p<g.length;p++)o.add(g[p])}var _=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),E=Object.prototype.hasOwnProperty,b=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,C={},I={};function P(p){return E.call(I,p)?!0:E.call(C,p)?!1:b.test(p)?I[p]=!0:(C[p]=!0,!1)}function L(p,g,T,N){if(T!==null&&T.type===0)return!1;switch(typeof g){case"function":case"symbol":return!0;case"boolean":return N?!1:T!==null?!T.acceptsBooleans:(p=p.toLowerCase().slice(0,5),p!=="data-"&&p!=="aria-");default:return!1}}function M(p,g,T,N){if(g===null||typeof g>"u"||L(p,g,T,N))return!0;if(N)return!1;if(T!==null)switch(T.type){case 3:return!g;case 4:return g===!1;case 5:return isNaN(g);case 6:return isNaN(g)||1>g}return!1}function F(p,g,T,N,V,$,he){this.acceptsBooleans=g===2||g===3||g===4,this.attributeName=N,this.attributeNamespace=V,this.mustUseProperty=T,this.propertyName=p,this.type=g,this.sanitizeURL=$,this.removeEmptyString=he}var B={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(p){B[p]=new F(p,0,!1,p,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(p){var g=p[0];B[g]=new F(g,1,!1,p[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(p){B[p]=new F(p,2,!1,p.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(p){B[p]=new F(p,2,!1,p,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(p){B[p]=new F(p,3,!1,p.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(p){B[p]=new F(p,3,!0,p,null,!1,!1)}),["capture","download"].forEach(function(p){B[p]=new F(p,4,!1,p,null,!1,!1)}),["cols","rows","size","span"].forEach(function(p){B[p]=new F(p,6,!1,p,null,!1,!1)}),["rowSpan","start"].forEach(function(p){B[p]=new F(p,5,!1,p.toLowerCase(),null,!1,!1)});var Z=/[\-:]([a-z])/g;function K(p){return p[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(p){var g=p.replace(Z,K);B[g]=new F(g,1,!1,p,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(p){var g=p.replace(Z,K);B[g]=new F(g,1,!1,p,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(p){var g=p.replace(Z,K);B[g]=new F(g,1,!1,p,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(p){B[p]=new F(p,1,!1,p.toLowerCase(),null,!1,!1)}),B.xlinkHref=new F("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(p){B[p]=new F(p,1,!1,p.toLowerCase(),null,!0,!0)});function re(p,g,T,N){var V=B.hasOwnProperty(g)?B[g]:null;(V!==null?V.type!==0:N||!(2<g.length)||g[0]!=="o"&&g[0]!=="O"||g[1]!=="n"&&g[1]!=="N")&&(M(g,T,V,N)&&(T=null),N||V===null?P(g)&&(T===null?p.removeAttribute(g):p.setAttribute(g,""+T)):V.mustUseProperty?p[V.propertyName]=T===null?V.type===3?!1:"":T:(g=V.attributeName,N=V.attributeNamespace,T===null?p.removeAttribute(g):(V=V.type,T=V===3||V===4&&T===!0?"":""+T,N?p.setAttributeNS(N,g,T):p.setAttribute(g,T))))}var ae=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,ne=Symbol.for("react.element"),pe=Symbol.for("react.portal"),X=Symbol.for("react.fragment"),J=Symbol.for("react.strict_mode"),Y=Symbol.for("react.profiler"),ie=Symbol.for("react.provider"),le=Symbol.for("react.context"),de=Symbol.for("react.forward_ref"),ue=Symbol.for("react.suspense"),Oe=Symbol.for("react.suspense_list"),Ve=Symbol.for("react.memo"),xe=Symbol.for("react.lazy"),Re=Symbol.for("react.offscreen"),ve=Symbol.iterator;function be(p){return p===null||typeof p!="object"?null:(p=ve&&p[ve]||p["@@iterator"],typeof p=="function"?p:null)}var We=Object.assign,Pe;function Te(p){if(Pe===void 0)try{throw Error()}catch(T){var g=T.stack.trim().match(/\n( *(at )?)/);Pe=g&&g[1]||""}return`
`+Pe+p}var ke=!1;function Ue(p,g){if(!p||ke)return"";ke=!0;var T=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(g)if(g=function(){throw Error()},Object.defineProperty(g.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(g,[])}catch(ot){var N=ot}Reflect.construct(p,[],g)}else{try{g.call()}catch(ot){N=ot}p.call(g.prototype)}else{try{throw Error()}catch(ot){N=ot}p()}}catch(ot){if(ot&&N&&typeof ot.stack=="string"){for(var V=ot.stack.split(`
`),$=N.stack.split(`
`),he=V.length-1,Ce=$.length-1;1<=he&&0<=Ce&&V[he]!==$[Ce];)Ce--;for(;1<=he&&0<=Ce;he--,Ce--)if(V[he]!==$[Ce]){if(he!==1||Ce!==1)do if(he--,Ce--,0>Ce||V[he]!==$[Ce]){var Me=`
`+V[he].replace(" at new "," at ");return p.displayName&&Me.includes("<anonymous>")&&(Me=Me.replace("<anonymous>",p.displayName)),Me}while(1<=he&&0<=Ce);break}}}finally{ke=!1,Error.prepareStackTrace=T}return(p=p?p.displayName||p.name:"")?Te(p):""}function Be(p){switch(p.tag){case 5:return Te(p.type);case 16:return Te("Lazy");case 13:return Te("Suspense");case 19:return Te("SuspenseList");case 0:case 2:case 15:return p=Ue(p.type,!1),p;case 11:return p=Ue(p.type.render,!1),p;case 1:return p=Ue(p.type,!0),p;default:return""}}function qe(p){if(p==null)return null;if(typeof p=="function")return p.displayName||p.name||null;if(typeof p=="string")return p;switch(p){case X:return"Fragment";case pe:return"Portal";case Y:return"Profiler";case J:return"StrictMode";case ue:return"Suspense";case Oe:return"SuspenseList"}if(typeof p=="object")switch(p.$$typeof){case le:return(p.displayName||"Context")+".Consumer";case ie:return(p._context.displayName||"Context")+".Provider";case de:var g=p.render;return p=p.displayName,p||(p=g.displayName||g.name||"",p=p!==""?"ForwardRef("+p+")":"ForwardRef"),p;case Ve:return g=p.displayName||null,g!==null?g:qe(p.type)||"Memo";case xe:g=p._payload,p=p._init;try{return qe(p(g))}catch{}}return null}function $e(p){var g=p.type;switch(p.tag){case 24:return"Cache";case 9:return(g.displayName||"Context")+".Consumer";case 10:return(g._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return p=g.render,p=p.displayName||p.name||"",g.displayName||(p!==""?"ForwardRef("+p+")":"ForwardRef");case 7:return"Fragment";case 5:return g;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return qe(g);case 8:return g===J?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof g=="function")return g.displayName||g.name||null;if(typeof g=="string")return g}return null}function st(p){switch(typeof p){case"boolean":case"number":case"string":case"undefined":return p;case"object":return p;default:return""}}function Je(p){var g=p.type;return(p=p.nodeName)&&p.toLowerCase()==="input"&&(g==="checkbox"||g==="radio")}function Rt(p){var g=Je(p)?"checked":"value",T=Object.getOwnPropertyDescriptor(p.constructor.prototype,g),N=""+p[g];if(!p.hasOwnProperty(g)&&typeof T<"u"&&typeof T.get=="function"&&typeof T.set=="function"){var V=T.get,$=T.set;return Object.defineProperty(p,g,{configurable:!0,get:function(){return V.call(this)},set:function(he){N=""+he,$.call(this,he)}}),Object.defineProperty(p,g,{enumerable:T.enumerable}),{getValue:function(){return N},setValue:function(he){N=""+he},stopTracking:function(){p._valueTracker=null,delete p[g]}}}}function kt(p){p._valueTracker||(p._valueTracker=Rt(p))}function He(p){if(!p)return!1;var g=p._valueTracker;if(!g)return!0;var T=g.getValue(),N="";return p&&(N=Je(p)?p.checked?"true":"false":p.value),p=N,p!==T?(g.setValue(p),!0):!1}function ut(p){if(p=p||(typeof document<"u"?document:void 0),typeof p>"u")return null;try{return p.activeElement||p.body}catch{return p.body}}function mt(p,g){var T=g.checked;return We({},g,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:T??p._wrapperState.initialChecked})}function Lt(p,g){var T=g.defaultValue==null?"":g.defaultValue,N=g.checked!=null?g.checked:g.defaultChecked;T=st(g.value!=null?g.value:T),p._wrapperState={initialChecked:N,initialValue:T,controlled:g.type==="checkbox"||g.type==="radio"?g.checked!=null:g.value!=null}}function Xt(p,g){g=g.checked,g!=null&&re(p,"checked",g,!1)}function $t(p,g){Xt(p,g);var T=st(g.value),N=g.type;if(T!=null)N==="number"?(T===0&&p.value===""||p.value!=T)&&(p.value=""+T):p.value!==""+T&&(p.value=""+T);else if(N==="submit"||N==="reset"){p.removeAttribute("value");return}g.hasOwnProperty("value")?je(p,g.type,T):g.hasOwnProperty("defaultValue")&&je(p,g.type,st(g.defaultValue)),g.checked==null&&g.defaultChecked!=null&&(p.defaultChecked=!!g.defaultChecked)}function we(p,g,T){if(g.hasOwnProperty("value")||g.hasOwnProperty("defaultValue")){var N=g.type;if(!(N!=="submit"&&N!=="reset"||g.value!==void 0&&g.value!==null))return;g=""+p._wrapperState.initialValue,T||g===p.value||(p.value=g),p.defaultValue=g}T=p.name,T!==""&&(p.name=""),p.defaultChecked=!!p._wrapperState.initialChecked,T!==""&&(p.name=T)}function je(p,g,T){(g!=="number"||ut(p.ownerDocument)!==p)&&(T==null?p.defaultValue=""+p._wrapperState.initialValue:p.defaultValue!==""+T&&(p.defaultValue=""+T))}var Ke=Array.isArray;function gt(p,g,T,N){if(p=p.options,g){g={};for(var V=0;V<T.length;V++)g["$"+T[V]]=!0;for(T=0;T<p.length;T++)V=g.hasOwnProperty("$"+p[T].value),p[T].selected!==V&&(p[T].selected=V),V&&N&&(p[T].defaultSelected=!0)}else{for(T=""+st(T),g=null,V=0;V<p.length;V++){if(p[V].value===T){p[V].selected=!0,N&&(p[V].defaultSelected=!0);return}g!==null||p[V].disabled||(g=p[V])}g!==null&&(g.selected=!0)}}function Et(p,g){if(g.dangerouslySetInnerHTML!=null)throw Error(i(91));return We({},g,{value:void 0,defaultValue:void 0,children:""+p._wrapperState.initialValue})}function Tt(p,g){var T=g.value;if(T==null){if(T=g.children,g=g.defaultValue,T!=null){if(g!=null)throw Error(i(92));if(Ke(T)){if(1<T.length)throw Error(i(93));T=T[0]}g=T}g==null&&(g=""),T=g}p._wrapperState={initialValue:st(T)}}function Kt(p,g){var T=st(g.value),N=st(g.defaultValue);T!=null&&(T=""+T,T!==p.value&&(p.value=T),g.defaultValue==null&&p.defaultValue!==T&&(p.defaultValue=T)),N!=null&&(p.defaultValue=""+N)}function gn(p){var g=p.textContent;g===p._wrapperState.initialValue&&g!==""&&g!==null&&(p.value=g)}function Sn(p){switch(p){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function sn(p,g){return p==null||p==="http://www.w3.org/1999/xhtml"?Sn(g):p==="http://www.w3.org/2000/svg"&&g==="foreignObject"?"http://www.w3.org/1999/xhtml":p}var wt,ir=function(p){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(g,T,N,V){MSApp.execUnsafeLocalFunction(function(){return p(g,T,N,V)})}:p}(function(p,g){if(p.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in p)p.innerHTML=g;else{for(wt=wt||document.createElement("div"),wt.innerHTML="<svg>"+g.valueOf().toString()+"</svg>",g=wt.firstChild;p.firstChild;)p.removeChild(p.firstChild);for(;g.firstChild;)p.appendChild(g.firstChild)}});function Vt(p,g){if(g){var T=p.firstChild;if(T&&T===p.lastChild&&T.nodeType===3){T.nodeValue=g;return}}p.textContent=g}var zt={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},_n=["Webkit","ms","Moz","O"];Object.keys(zt).forEach(function(p){_n.forEach(function(g){g=g+p.charAt(0).toUpperCase()+p.substring(1),zt[g]=zt[p]})});function Ui(p,g,T){return g==null||typeof g=="boolean"||g===""?"":T||typeof g!="number"||g===0||zt.hasOwnProperty(p)&&zt[p]?(""+g).trim():g+"px"}function Ts(p,g){p=p.style;for(var T in g)if(g.hasOwnProperty(T)){var N=T.indexOf("--")===0,V=Ui(T,g[T],N);T==="float"&&(T="cssFloat"),N?p.setProperty(T,V):p[T]=V}}var ui=We({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function na(p,g){if(g){if(ui[p]&&(g.children!=null||g.dangerouslySetInnerHTML!=null))throw Error(i(137,p));if(g.dangerouslySetInnerHTML!=null){if(g.children!=null)throw Error(i(60));if(typeof g.dangerouslySetInnerHTML!="object"||!("__html"in g.dangerouslySetInnerHTML))throw Error(i(61))}if(g.style!=null&&typeof g.style!="object")throw Error(i(62))}}function dc(p,g){if(p.indexOf("-")===-1)return typeof g.is=="string";switch(p){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var oo=null;function ao(p){return p=p.target||p.srcElement||window,p.correspondingUseElement&&(p=p.correspondingUseElement),p.nodeType===3?p.parentNode:p}var xc=null,Cs=null,La=null;function Vo(p){if(p=Cm(p)){if(typeof xc!="function")throw Error(i(280));var g=p.stateNode;g&&(g=Rm(g),xc(p.stateNode,p.type,g))}}function Ma(p){Cs?La?La.push(p):La=[p]:Cs=p}function hc(){if(Cs){var p=Cs,g=La;if(La=Cs=null,Vo(p),g)for(p=0;p<g.length;p++)Vo(g[p])}}function wl(p,g){return p(g)}function Ua(){}var pc=!1;function Eo(p,g,T){if(pc)return p(g,T);pc=!0;try{return wl(p,g,T)}finally{pc=!1,(Cs!==null||La!==null)&&(Ua(),hc())}}function Vi(p,g){var T=p.stateNode;if(T===null)return null;var N=Rm(T);if(N===null)return null;T=N[g];e:switch(g){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(N=!N.disabled)||(p=p.type,N=!(p==="button"||p==="input"||p==="select"||p==="textarea")),p=!N;break e;default:p=!1}if(p)return null;if(T&&typeof T!="function")throw Error(i(231,g,typeof T));return T}var vt=!1;if(_)try{var pn={};Object.defineProperty(pn,"passive",{get:function(){vt=!0}}),window.addEventListener("test",pn,pn),window.removeEventListener("test",pn,pn)}catch{vt=!1}function Sr(p,g,T,N,V,$,he,Ce,Me){var ot=Array.prototype.slice.call(arguments,3);try{g.apply(T,ot)}catch(xt){this.onError(xt)}}var yi=!1,jo=null,vo=!1,iu=null,kp={onError:function(p){yi=!0,jo=p}};function Tl(p,g,T,N,V,$,he,Ce,Me){yi=!1,jo=null,Sr.apply(kp,arguments)}function su(p,g,T,N,V,$,he,Ce,Me){if(Tl.apply(this,arguments),yi){if(yi){var ot=jo;yi=!1,jo=null}else throw Error(i(198));vo||(vo=!0,iu=ot)}}function Ai(p){var g=p,T=p;if(p.alternate)for(;g.return;)g=g.return;else{p=g;do g=p,(g.flags&4098)!==0&&(T=g.return),p=g.return;while(p)}return g.tag===3?T:null}function So(p){if(p.tag===13){var g=p.memoizedState;if(g===null&&(p=p.alternate,p!==null&&(g=p.memoizedState)),g!==null)return g.dehydrated}return null}function Gi(p){if(Ai(p)!==p)throw Error(i(188))}function th(p){var g=p.alternate;if(!g){if(g=Ai(p),g===null)throw Error(i(188));return g!==p?null:p}for(var T=p,N=g;;){var V=T.return;if(V===null)break;var $=V.alternate;if($===null){if(N=V.return,N!==null){T=N;continue}break}if(V.child===$.child){for($=V.child;$;){if($===T)return Gi(V),p;if($===N)return Gi(V),g;$=$.sibling}throw Error(i(188))}if(T.return!==N.return)T=V,N=$;else{for(var he=!1,Ce=V.child;Ce;){if(Ce===T){he=!0,T=V,N=$;break}if(Ce===N){he=!0,N=V,T=$;break}Ce=Ce.sibling}if(!he){for(Ce=$.child;Ce;){if(Ce===T){he=!0,T=$,N=V;break}if(Ce===N){he=!0,N=$,T=V;break}Ce=Ce.sibling}if(!he)throw Error(i(189))}}if(T.alternate!==N)throw Error(i(190))}if(T.tag!==3)throw Error(i(188));return T.stateNode.current===T?p:g}function nh(p){return p=th(p),p!==null?fc(p):null}function fc(p){if(p.tag===5||p.tag===6)return p;for(p=p.child;p!==null;){var g=fc(p);if(g!==null)return g;p=p.sibling}return null}var rh=e.unstable_scheduleCallback,rd=e.unstable_cancelCallback,ra=e.unstable_shouldYield,ih=e.unstable_requestPaint,Xr=e.unstable_now,Pi=e.unstable_getCurrentPriorityLevel,Lc=e.unstable_ImmediatePriority,Cl=e.unstable_UserBlockingPriority,Va=e.unstable_NormalPriority,Np=e.unstable_LowPriority,sh=e.unstable_IdlePriority,ou=null,Fo=null;function um(p){if(Fo&&typeof Fo.onCommitFiberRoot=="function")try{Fo.onCommitFiberRoot(ou,p,void 0,(p.current.flags&128)===128)}catch{}}var bo=Math.clz32?Math.clz32:oh,Dp=Math.log,Rl=Math.LN2;function oh(p){return p>>>=0,p===0?32:31-(Dp(p)/Rl|0)|0}var ah=64,br=4194304;function au(p){switch(p&-p){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return p&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return p&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return p}}function cu(p,g){var T=p.pendingLanes;if(T===0)return 0;var N=0,V=p.suspendedLanes,$=p.pingedLanes,he=T&268435455;if(he!==0){var Ce=he&~V;Ce!==0?N=au(Ce):($&=he,$!==0&&(N=au($)))}else he=T&~V,he!==0?N=au(he):$!==0&&(N=au($));if(N===0)return 0;if(g!==0&&g!==N&&(g&V)===0&&(V=N&-N,$=g&-g,V>=$||V===16&&($&4194240)!==0))return g;if((N&4)!==0&&(N|=T&16),g=p.entangledLanes,g!==0)for(p=p.entanglements,g&=N;0<g;)T=31-bo(g),V=1<<T,N|=p[T],g&=~V;return N}function id(p,g){switch(p){case 1:case 2:case 4:return g+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return g+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function mc(p,g){for(var T=p.suspendedLanes,N=p.pingedLanes,V=p.expirationTimes,$=p.pendingLanes;0<$;){var he=31-bo($),Ce=1<<he,Me=V[he];Me===-1?((Ce&T)===0||(Ce&N)!==0)&&(V[he]=id(Ce,g)):Me<=g&&(p.expiredLanes|=Ce),$&=~Ce}}function ia(p){return p=p.pendingLanes&-1073741825,p!==0?p:p&1073741824?1073741824:0}function sd(){var p=ah;return ah<<=1,(ah&4194240)===0&&(ah=64),p}function Il(p){for(var g=[],T=0;31>T;T++)g.push(p);return g}function lu(p,g,T){p.pendingLanes|=g,g!==536870912&&(p.suspendedLanes=0,p.pingedLanes=0),p=p.eventTimes,g=31-bo(g),p[g]=T}function ni(p,g){var T=p.pendingLanes&~g;p.pendingLanes=g,p.suspendedLanes=0,p.pingedLanes=0,p.expiredLanes&=g,p.mutableReadLanes&=g,p.entangledLanes&=g,g=p.entanglements;var N=p.eventTimes;for(p=p.expirationTimes;0<T;){var V=31-bo(T),$=1<<V;g[V]=0,N[V]=-1,p[V]=-1,T&=~$}}function gc(p,g){var T=p.entangledLanes|=g;for(p=p.entanglements;T;){var N=31-bo(T),V=1<<N;V&g|p[N]&g&&(p[N]|=g),T&=~V}}var hr=0;function Mc(p){return p&=-p,1<p?4<p?(p&268435455)!==0?16:536870912:4:1}var dm,uu,ch,xp,hm,Lp=!1,sa=[],gs=null,oa=null,aa=null,du=new Map,ca=new Map,la=[],pm="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Uc(p,g){switch(p){case"focusin":case"focusout":gs=null;break;case"dragenter":case"dragleave":oa=null;break;case"mouseover":case"mouseout":aa=null;break;case"pointerover":case"pointerout":du.delete(g.pointerId);break;case"gotpointercapture":case"lostpointercapture":ca.delete(g.pointerId)}}function Rs(p,g,T,N,V,$){return p===null||p.nativeEvent!==$?(p={blockedOn:g,domEventName:T,eventSystemFlags:N,nativeEvent:$,targetContainers:[V]},g!==null&&(g=Cm(g),g!==null&&uu(g)),p):(p.eventSystemFlags|=N,g=p.targetContainers,V!==null&&g.indexOf(V)===-1&&g.push(V),p)}function od(p,g,T,N,V){switch(g){case"focusin":return gs=Rs(gs,p,g,T,N,V),!0;case"dragenter":return oa=Rs(oa,p,g,T,N,V),!0;case"mouseover":return aa=Rs(aa,p,g,T,N,V),!0;case"pointerover":var $=V.pointerId;return du.set($,Rs(du.get($)||null,p,g,T,N,V)),!0;case"gotpointercapture":return $=V.pointerId,ca.set($,Rs(ca.get($)||null,p,g,T,N,V)),!0}return!1}function Mp(p){var g=Gp(p.target);if(g!==null){var T=Ai(g);if(T!==null){if(g=T.tag,g===13){if(g=So(T),g!==null){p.blockedOn=g,hm(p.priority,function(){ch(T)});return}}else if(g===3&&T.stateNode.current.memoizedState.isDehydrated){p.blockedOn=T.tag===3?T.stateNode.containerInfo:null;return}}}p.blockedOn=null}function Al(p){if(p.blockedOn!==null)return!1;for(var g=p.targetContainers;0<g.length;){var T=Ar(p.domEventName,p.eventSystemFlags,g[0],p.nativeEvent);if(T===null){T=p.nativeEvent;var N=new T.constructor(T.type,T);oo=N,T.target.dispatchEvent(N),oo=null}else return g=Cm(T),g!==null&&uu(g),p.blockedOn=T,!1;g.shift()}return!0}function hu(p,g,T){Al(p)&&T.delete(g)}function fm(){Lp=!1,gs!==null&&Al(gs)&&(gs=null),oa!==null&&Al(oa)&&(oa=null),aa!==null&&Al(aa)&&(aa=null),du.forEach(hu),ca.forEach(hu)}function ja(p,g){p.blockedOn===g&&(p.blockedOn=null,Lp||(Lp=!0,e.unstable_scheduleCallback(e.unstable_NormalPriority,fm)))}function Fa(p){function g(V){return ja(V,p)}if(0<sa.length){ja(sa[0],p);for(var T=1;T<sa.length;T++){var N=sa[T];N.blockedOn===p&&(N.blockedOn=null)}}for(gs!==null&&ja(gs,p),oa!==null&&ja(oa,p),aa!==null&&ja(aa,p),du.forEach(g),ca.forEach(g),T=0;T<la.length;T++)N=la[T],N.blockedOn===p&&(N.blockedOn=null);for(;0<la.length&&(T=la[0],T.blockedOn===null);)Mp(T),T.blockedOn===null&&la.shift()}var Pl=ae.ReactCurrentBatchConfig,Se=!0;function De(p,g,T,N){var V=hr,$=Pl.transition;Pl.transition=null;try{hr=1,nn(p,g,T,N)}finally{hr=V,Pl.transition=$}}function it(p,g,T,N){var V=hr,$=Pl.transition;Pl.transition=null;try{hr=4,nn(p,g,T,N)}finally{hr=V,Pl.transition=$}}function nn(p,g,T,N){if(Se){var V=Ar(p,g,T,N);if(V===null)wE(p,g,N,er,T),Uc(p,N);else if(od(V,p,g,T,N))N.stopPropagation();else if(Uc(p,N),g&4&&-1<pm.indexOf(p)){for(;V!==null;){var $=Cm(V);if($!==null&&dm($),$=Ar(p,g,T,N),$===null&&wE(p,g,N,er,T),$===V)break;V=$}V!==null&&N.stopPropagation()}else wE(p,g,N,null,T)}}var er=null;function Ar(p,g,T,N){if(er=null,p=ao(N),p=Gp(p),p!==null)if(g=Ai(p),g===null)p=null;else if(T=g.tag,T===13){if(p=So(g),p!==null)return p;p=null}else if(T===3){if(g.stateNode.current.memoizedState.isDehydrated)return g.tag===3?g.stateNode.containerInfo:null;p=null}else g!==p&&(p=null);return er=p,null}function Jr(p){switch(p){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Pi()){case Lc:return 1;case Cl:return 4;case Va:case Np:return 16;case sh:return 536870912;default:return 16}default:return 16}}var mn=null,Gr=null,Oi=null;function Ys(){if(Oi)return Oi;var p,g=Gr,T=g.length,N,V="value"in mn?mn.value:mn.textContent,$=V.length;for(p=0;p<T&&g[p]===V[p];p++);var he=T-p;for(N=1;N<=he&&g[T-N]===V[$-N];N++);return Oi=V.slice(p,1<N?1-N:void 0)}function ua(p){var g=p.keyCode;return"charCode"in p?(p=p.charCode,p===0&&g===13&&(p=13)):p=g,p===10&&(p=13),32<=p||p===13?p:0}function da(){return!0}function ad(){return!1}function os(p){function g(T,N,V,$,he){this._reactName=T,this._targetInst=V,this.type=N,this.nativeEvent=$,this.target=he,this.currentTarget=null;for(var Ce in p)p.hasOwnProperty(Ce)&&(T=p[Ce],this[Ce]=T?T($):$[Ce]);return this.isDefaultPrevented=($.defaultPrevented!=null?$.defaultPrevented:$.returnValue===!1)?da:ad,this.isPropagationStopped=ad,this}return We(g.prototype,{preventDefault:function(){this.defaultPrevented=!0;var T=this.nativeEvent;T&&(T.preventDefault?T.preventDefault():typeof T.returnValue!="unknown"&&(T.returnValue=!1),this.isDefaultPrevented=da)},stopPropagation:function(){var T=this.nativeEvent;T&&(T.stopPropagation?T.stopPropagation():typeof T.cancelBubble!="unknown"&&(T.cancelBubble=!0),this.isPropagationStopped=da)},persist:function(){},isPersistent:da}),g}var Ol={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(p){return p.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},lh=os(Ol),Vc=We({},Ol,{view:0,detail:0}),n_=os(Vc),mm,cd,ha,pu=We({},Vc,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:jc,button:0,buttons:0,relatedTarget:function(p){return p.relatedTarget===void 0?p.fromElement===p.srcElement?p.toElement:p.fromElement:p.relatedTarget},movementX:function(p){return"movementX"in p?p.movementX:(p!==ha&&(ha&&p.type==="mousemove"?(mm=p.screenX-ha.screenX,cd=p.screenY-ha.screenY):cd=mm=0,ha=p),mm)},movementY:function(p){return"movementY"in p?p.movementY:cd}}),gm=os(pu),r_=We({},pu,{dataTransfer:0}),mE=os(r_),_m=We({},Vc,{relatedTarget:0}),ym=os(_m),ld=We({},Ol,{animationName:0,elapsedTime:0,pseudoElement:0}),ud=os(ld),dd=We({},Ol,{clipboardData:function(p){return"clipboardData"in p?p.clipboardData:window.clipboardData}}),i_=os(dd),gE=We({},Ol,{data:0}),Hn=os(gE),Em={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},pa={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},_E={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function yE(p){var g=this.nativeEvent;return g.getModifierState?g.getModifierState(p):(p=_E[p])?!!g[p]:!1}function jc(){return yE}var A=We({},Vc,{key:function(p){if(p.key){var g=Em[p.key]||p.key;if(g!=="Unidentified")return g}return p.type==="keypress"?(p=ua(p),p===13?"Enter":String.fromCharCode(p)):p.type==="keydown"||p.type==="keyup"?pa[p.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:jc,charCode:function(p){return p.type==="keypress"?ua(p):0},keyCode:function(p){return p.type==="keydown"||p.type==="keyup"?p.keyCode:0},which:function(p){return p.type==="keypress"?ua(p):p.type==="keydown"||p.type==="keyup"?p.keyCode:0}}),z=os(A),se=We({},pu,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),ge=os(se),Qe=We({},Vc,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:jc}),dt=os(Qe),Gt=We({},Ol,{propertyName:0,elapsedTime:0,pseudoElement:0}),ri=os(Gt),Ei=We({},pu,{deltaX:function(p){return"deltaX"in p?p.deltaX:"wheelDeltaX"in p?-p.wheelDeltaX:0},deltaY:function(p){return"deltaY"in p?p.deltaY:"wheelDeltaY"in p?-p.wheelDeltaY:"wheelDelta"in p?-p.wheelDelta:0},deltaZ:0,deltaMode:0}),Pr=os(Ei),co=[9,13,27,32],Is=_&&"CompositionEvent"in window,_c=null;_&&"documentMode"in document&&(_c=document.documentMode);var fa=_&&"TextEvent"in window&&!_c,Up=_&&(!Is||_c&&8<_c&&11>=_c),vm=" ",yc=!1;function jR(p,g){switch(p){case"keyup":return co.indexOf(g.keyCode)!==-1;case"keydown":return g.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function FR(p){return p=p.detail,typeof p=="object"&&"data"in p?p.data:null}var Sm=!1;function YN(p,g){switch(p){case"compositionend":return FR(g);case"keypress":return g.which!==32?null:(yc=!0,vm);case"textInput":return p=g.data,p===vm&&yc?null:p;default:return null}}function BR(p,g){if(Sm)return p==="compositionend"||!Is&&jR(p,g)?(p=Ys(),Oi=Gr=mn=null,Sm=!1,p):null;switch(p){case"paste":return null;case"keypress":if(!(g.ctrlKey||g.altKey||g.metaKey)||g.ctrlKey&&g.altKey){if(g.char&&1<g.char.length)return g.char;if(g.which)return String.fromCharCode(g.which)}return null;case"compositionend":return Up&&g.locale!=="ko"?null:g.data;default:return null}}var XN={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function WR(p){var g=p&&p.nodeName&&p.nodeName.toLowerCase();return g==="input"?!!XN[p.type]:g==="textarea"}function ab(p,g,T,N){Ma(N),g=TE(g,"onChange"),0<g.length&&(T=new lh("onChange","change",null,T,N),p.push({event:T,listeners:g}))}var Vp=null,s_=null;function JN(p){fb(p,0)}function jp(p){var g=Hp(p);if(He(g))return p}function QN(p,g){if(p==="change")return g}var zR=!1;if(_){var cb;if(_){var Fc="oninput"in document;if(!Fc){var GR=document.createElement("div");GR.setAttribute("oninput","return;"),Fc=typeof GR.oninput=="function"}cb=Fc}else cb=!1;zR=cb&&(!document.documentMode||9<document.documentMode)}function HR(){Vp&&(Vp.detachEvent("onpropertychange",Ba),s_=Vp=null)}function Ba(p){if(p.propertyName==="value"&&jp(s_)){var g=[];ab(g,s_,p,ao(p)),Eo(JN,g)}}function ZN(p,g,T){p==="focusin"?(HR(),Vp=g,s_=T,Vp.attachEvent("onpropertychange",Ba)):p==="focusout"&&HR()}function eD(p){if(p==="selectionchange"||p==="keyup"||p==="keydown")return jp(s_)}function tD(p,g){if(p==="click")return jp(g)}function nD(p,g){if(p==="input"||p==="change")return jp(g)}function $R(p,g){return p===g&&(p!==0||1/p===1/g)||p!==p&&g!==g}var kl=typeof Object.is=="function"?Object.is:$R;function o_(p,g){if(kl(p,g))return!0;if(typeof p!="object"||p===null||typeof g!="object"||g===null)return!1;var T=Object.keys(p),N=Object.keys(g);if(T.length!==N.length)return!1;for(N=0;N<T.length;N++){var V=T[N];if(!E.call(g,V)||!kl(p[V],g[V]))return!1}return!0}function KR(p){for(;p&&p.firstChild;)p=p.firstChild;return p}function lb(p,g){var T=KR(p);p=0;for(var N;T;){if(T.nodeType===3){if(N=p+T.textContent.length,p<=g&&N>=g)return{node:T,offset:g-p};p=N}e:{for(;T;){if(T.nextSibling){T=T.nextSibling;break e}T=T.parentNode}T=void 0}T=KR(T)}}function qR(p,g){return p&&g?p===g?!0:p&&p.nodeType===3?!1:g&&g.nodeType===3?qR(p,g.parentNode):"contains"in p?p.contains(g):p.compareDocumentPosition?!!(p.compareDocumentPosition(g)&16):!1:!1}function YR(){for(var p=window,g=ut();g instanceof p.HTMLIFrameElement;){try{var T=typeof g.contentWindow.location.href=="string"}catch{T=!1}if(T)p=g.contentWindow;else break;g=ut(p.document)}return g}function a_(p){var g=p&&p.nodeName&&p.nodeName.toLowerCase();return g&&(g==="input"&&(p.type==="text"||p.type==="search"||p.type==="tel"||p.type==="url"||p.type==="password")||g==="textarea"||p.contentEditable==="true")}function ub(p){var g=YR(),T=p.focusedElem,N=p.selectionRange;if(g!==T&&T&&T.ownerDocument&&qR(T.ownerDocument.documentElement,T)){if(N!==null&&a_(T)){if(g=N.start,p=N.end,p===void 0&&(p=g),"selectionStart"in T)T.selectionStart=g,T.selectionEnd=Math.min(p,T.value.length);else if(p=(g=T.ownerDocument||document)&&g.defaultView||window,p.getSelection){p=p.getSelection();var V=T.textContent.length,$=Math.min(N.start,V);N=N.end===void 0?$:Math.min(N.end,V),!p.extend&&$>N&&(V=N,N=$,$=V),V=lb(T,$);var he=lb(T,N);V&&he&&(p.rangeCount!==1||p.anchorNode!==V.node||p.anchorOffset!==V.offset||p.focusNode!==he.node||p.focusOffset!==he.offset)&&(g=g.createRange(),g.setStart(V.node,V.offset),p.removeAllRanges(),$>N?(p.addRange(g),p.extend(he.node,he.offset)):(g.setEnd(he.node,he.offset),p.addRange(g)))}}for(g=[],p=T;p=p.parentNode;)p.nodeType===1&&g.push({element:p,left:p.scrollLeft,top:p.scrollTop});for(typeof T.focus=="function"&&T.focus(),T=0;T<g.length;T++)p=g[T],p.element.scrollLeft=p.left,p.element.scrollTop=p.top}}var rD=_&&"documentMode"in document&&11>=document.documentMode,lt=null,db=null,c_=null,hb=!1;function XR(p,g,T){var N=T.window===T?T.document:T.nodeType===9?T:T.ownerDocument;hb||lt==null||lt!==ut(N)||(N=lt,"selectionStart"in N&&a_(N)?N={start:N.selectionStart,end:N.selectionEnd}:(N=(N.ownerDocument&&N.ownerDocument.defaultView||window).getSelection(),N={anchorNode:N.anchorNode,anchorOffset:N.anchorOffset,focusNode:N.focusNode,focusOffset:N.focusOffset}),c_&&o_(c_,N)||(c_=N,N=TE(db,"onSelect"),0<N.length&&(g=new lh("onSelect","select",null,g,T),p.push({event:g,listeners:N}),g.target=lt)))}function EE(p,g){var T={};return T[p.toLowerCase()]=g.toLowerCase(),T["Webkit"+p]="webkit"+g,T["Moz"+p]="moz"+g,T}var bm={animationend:EE("Animation","AnimationEnd"),animationiteration:EE("Animation","AnimationIteration"),animationstart:EE("Animation","AnimationStart"),transitionend:EE("Transition","TransitionEnd")},pb={},JR={};_&&(JR=document.createElement("div").style,"AnimationEvent"in window||(delete bm.animationend.animation,delete bm.animationiteration.animation,delete bm.animationstart.animation),"TransitionEvent"in window||delete bm.transitionend.transition);function Fp(p){if(pb[p])return pb[p];if(!bm[p])return p;var g=bm[p],T;for(T in g)if(g.hasOwnProperty(T)&&T in JR)return pb[p]=g[T];return p}var Bp=Fp("animationend"),QR=Fp("animationiteration"),ZR=Fp("animationstart"),eI=Fp("transitionend"),tI=new Map,vE="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function uh(p,g){tI.set(p,g),u(g,[p])}for(var SE=0;SE<vE.length;SE++){var Ec=vE[SE],iD=Ec.toLowerCase(),l_=Ec[0].toUpperCase()+Ec.slice(1);uh(iD,"on"+l_)}uh(Bp,"onAnimationEnd"),uh(QR,"onAnimationIteration"),uh(ZR,"onAnimationStart"),uh("dblclick","onDoubleClick"),uh("focusin","onFocus"),uh("focusout","onBlur"),uh(eI,"onTransitionEnd"),f("onMouseEnter",["mouseout","mouseover"]),f("onMouseLeave",["mouseout","mouseover"]),f("onPointerEnter",["pointerout","pointerover"]),f("onPointerLeave",["pointerout","pointerover"]),u("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),u("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),u("onBeforeInput",["compositionend","keypress","textInput","paste"]),u("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),u("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),u("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var u_="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),sD=new Set("cancel close invalid load scroll toggle".split(" ").concat(u_));function nI(p,g,T){var N=p.type||"unknown-event";p.currentTarget=T,su(N,g,void 0,p),p.currentTarget=null}function fb(p,g){g=(g&4)!==0;for(var T=0;T<p.length;T++){var N=p[T],V=N.event;N=N.listeners;e:{var $=void 0;if(g)for(var he=N.length-1;0<=he;he--){var Ce=N[he],Me=Ce.instance,ot=Ce.currentTarget;if(Ce=Ce.listener,Me!==$&&V.isPropagationStopped())break e;nI(V,Ce,ot),$=Me}else for(he=0;he<N.length;he++){if(Ce=N[he],Me=Ce.instance,ot=Ce.currentTarget,Ce=Ce.listener,Me!==$&&V.isPropagationStopped())break e;nI(V,Ce,ot),$=Me}}}if(vo)throw p=iu,vo=!1,iu=null,p}function ji(p,g){var T=g[f_];T===void 0&&(T=g[f_]=new Set);var N=p+"__bubble";T.has(N)||(rI(g,p,2,!1),T.add(N))}function mb(p,g,T){var N=0;g&&(N|=4),rI(T,p,N,g)}var bE="_reactListening"+Math.random().toString(36).slice(2);function Wp(p){if(!p[bE]){p[bE]=!0,o.forEach(function(T){T!=="selectionchange"&&(sD.has(T)||mb(T,!1,p),mb(T,!0,p))});var g=p.nodeType===9?p:p.ownerDocument;g===null||g[bE]||(g[bE]=!0,mb("selectionchange",!1,g))}}function rI(p,g,T,N){switch(Jr(g)){case 1:var V=De;break;case 4:V=it;break;default:V=nn}T=V.bind(null,g,T,p),V=void 0,!vt||g!=="touchstart"&&g!=="touchmove"&&g!=="wheel"||(V=!0),N?V!==void 0?p.addEventListener(g,T,{capture:!0,passive:V}):p.addEventListener(g,T,!0):V!==void 0?p.addEventListener(g,T,{passive:V}):p.addEventListener(g,T,!1)}function wE(p,g,T,N,V){var $=N;if((g&1)===0&&(g&2)===0&&N!==null)e:for(;;){if(N===null)return;var he=N.tag;if(he===3||he===4){var Ce=N.stateNode.containerInfo;if(Ce===V||Ce.nodeType===8&&Ce.parentNode===V)break;if(he===4)for(he=N.return;he!==null;){var Me=he.tag;if((Me===3||Me===4)&&(Me=he.stateNode.containerInfo,Me===V||Me.nodeType===8&&Me.parentNode===V))return;he=he.return}for(;Ce!==null;){if(he=Gp(Ce),he===null)return;if(Me=he.tag,Me===5||Me===6){N=$=he;continue e}Ce=Ce.parentNode}}N=N.return}Eo(function(){var ot=$,xt=ao(T),Mt=[];e:{var Dt=tI.get(p);if(Dt!==void 0){var en=lh,cn=p;switch(p){case"keypress":if(ua(T)===0)break e;case"keydown":case"keyup":en=z;break;case"focusin":cn="focus",en=ym;break;case"focusout":cn="blur",en=ym;break;case"beforeblur":case"afterblur":en=ym;break;case"click":if(T.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":en=gm;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":en=mE;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":en=dt;break;case Bp:case QR:case ZR:en=ud;break;case eI:en=ri;break;case"scroll":en=n_;break;case"wheel":en=Pr;break;case"copy":case"cut":case"paste":en=i_;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":en=ge}var ln=(g&4)!==0,cs=!ln&&p==="scroll",et=ln?Dt!==null?Dt+"Capture":null:Dt;ln=[];for(var Fe=ot,rt;Fe!==null;){rt=Fe;var Ft=rt.stateNode;if(rt.tag===5&&Ft!==null&&(rt=Ft,et!==null&&(Ft=Vi(Fe,et),Ft!=null&&ln.push(wm(Fe,Ft,rt)))),cs)break;Fe=Fe.return}0<ln.length&&(Dt=new en(Dt,cn,null,T,xt),Mt.push({event:Dt,listeners:ln}))}}if((g&7)===0){e:{if(Dt=p==="mouseover"||p==="pointerover",en=p==="mouseout"||p==="pointerout",Dt&&T!==oo&&(cn=T.relatedTarget||T.fromElement)&&(Gp(cn)||cn[Bc]))break e;if((en||Dt)&&(Dt=xt.window===xt?xt:(Dt=xt.ownerDocument)?Dt.defaultView||Dt.parentWindow:window,en?(cn=T.relatedTarget||T.toElement,en=ot,cn=cn?Gp(cn):null,cn!==null&&(cs=Ai(cn),cn!==cs||cn.tag!==5&&cn.tag!==6)&&(cn=null)):(en=null,cn=ot),en!==cn)){if(ln=gm,Ft="onMouseLeave",et="onMouseEnter",Fe="mouse",(p==="pointerout"||p==="pointerover")&&(ln=ge,Ft="onPointerLeave",et="onPointerEnter",Fe="pointer"),cs=en==null?Dt:Hp(en),rt=cn==null?Dt:Hp(cn),Dt=new ln(Ft,Fe+"leave",en,T,xt),Dt.target=cs,Dt.relatedTarget=rt,Ft=null,Gp(xt)===ot&&(ln=new ln(et,Fe+"enter",cn,T,xt),ln.target=rt,ln.relatedTarget=cs,Ft=ln),cs=Ft,en&&cn)t:{for(ln=en,et=cn,Fe=0,rt=ln;rt;rt=zp(rt))Fe++;for(rt=0,Ft=et;Ft;Ft=zp(Ft))rt++;for(;0<Fe-rt;)ln=zp(ln),Fe--;for(;0<rt-Fe;)et=zp(et),rt--;for(;Fe--;){if(ln===et||et!==null&&ln===et.alternate)break t;ln=zp(ln),et=zp(et)}ln=null}else ln=null;en!==null&&d_(Mt,Dt,en,ln,!1),cn!==null&&cs!==null&&d_(Mt,cs,cn,ln,!0)}}e:{if(Dt=ot?Hp(ot):window,en=Dt.nodeName&&Dt.nodeName.toLowerCase(),en==="select"||en==="input"&&Dt.type==="file")var un=QN;else if(WR(Dt))if(zR)un=nD;else{un=eD;var bn=ZN}else(en=Dt.nodeName)&&en.toLowerCase()==="input"&&(Dt.type==="checkbox"||Dt.type==="radio")&&(un=tD);if(un&&(un=un(p,ot))){ab(Mt,un,T,xt);break e}bn&&bn(p,Dt,ot),p==="focusout"&&(bn=Dt._wrapperState)&&bn.controlled&&Dt.type==="number"&&je(Dt,"number",Dt.value)}switch(bn=ot?Hp(ot):window,p){case"focusin":(WR(bn)||bn.contentEditable==="true")&&(lt=bn,db=ot,c_=null);break;case"focusout":c_=db=lt=null;break;case"mousedown":hb=!0;break;case"contextmenu":case"mouseup":case"dragend":hb=!1,XR(Mt,T,xt);break;case"selectionchange":if(rD)break;case"keydown":case"keyup":XR(Mt,T,xt)}var In;if(Is)e:{switch(p){case"compositionstart":var Bn="onCompositionStart";break e;case"compositionend":Bn="onCompositionEnd";break e;case"compositionupdate":Bn="onCompositionUpdate";break e}Bn=void 0}else Sm?jR(p,T)&&(Bn="onCompositionEnd"):p==="keydown"&&T.keyCode===229&&(Bn="onCompositionStart");Bn&&(Up&&T.locale!=="ko"&&(Sm||Bn!=="onCompositionStart"?Bn==="onCompositionEnd"&&Sm&&(In=Ys()):(mn=xt,Gr="value"in mn?mn.value:mn.textContent,Sm=!0)),bn=TE(ot,Bn),0<bn.length&&(Bn=new Hn(Bn,p,null,T,xt),Mt.push({event:Bn,listeners:bn}),In?Bn.data=In:(In=FR(T),In!==null&&(Bn.data=In)))),(In=fa?YN(p,T):BR(p,T))&&(ot=TE(ot,"onBeforeInput"),0<ot.length&&(xt=new Hn("onBeforeInput","beforeinput",null,T,xt),Mt.push({event:xt,listeners:ot}),xt.data=In))}fb(Mt,g)})}function wm(p,g,T){return{instance:p,listener:g,currentTarget:T}}function TE(p,g){for(var T=g+"Capture",N=[];p!==null;){var V=p,$=V.stateNode;V.tag===5&&$!==null&&(V=$,$=Vi(p,T),$!=null&&N.unshift(wm(p,$,V)),$=Vi(p,g),$!=null&&N.push(wm(p,$,V))),p=p.return}return N}function zp(p){if(p===null)return null;do p=p.return;while(p&&p.tag!==5);return p||null}function d_(p,g,T,N,V){for(var $=g._reactName,he=[];T!==null&&T!==N;){var Ce=T,Me=Ce.alternate,ot=Ce.stateNode;if(Me!==null&&Me===N)break;Ce.tag===5&&ot!==null&&(Ce=ot,V?(Me=Vi(T,$),Me!=null&&he.unshift(wm(T,Me,Ce))):V||(Me=Vi(T,$),Me!=null&&he.push(wm(T,Me,Ce)))),T=T.return}he.length!==0&&p.push({event:g,listeners:he})}var oD=/\r\n?/g,aD=/\u0000|\uFFFD/g;function iI(p){return(typeof p=="string"?p:""+p).replace(oD,`
`).replace(aD,"")}function CE(p,g,T){if(g=iI(g),iI(p)!==g&&T)throw Error(i(425))}function RE(){}var IE=null,h_=null;function gb(p,g){return p==="textarea"||p==="noscript"||typeof g.children=="string"||typeof g.children=="number"||typeof g.dangerouslySetInnerHTML=="object"&&g.dangerouslySetInnerHTML!==null&&g.dangerouslySetInnerHTML.__html!=null}var p_=typeof setTimeout=="function"?setTimeout:void 0,cD=typeof clearTimeout=="function"?clearTimeout:void 0,sI=typeof Promise=="function"?Promise:void 0,lD=typeof queueMicrotask=="function"?queueMicrotask:typeof sI<"u"?function(p){return sI.resolve(null).then(p).catch(uD)}:p_;function uD(p){setTimeout(function(){throw p})}function _b(p,g){var T=g,N=0;do{var V=T.nextSibling;if(p.removeChild(T),V&&V.nodeType===8)if(T=V.data,T==="/$"){if(N===0){p.removeChild(V),Fa(g);return}N--}else T!=="$"&&T!=="$?"&&T!=="$!"||N++;T=V}while(T);Fa(g)}function dh(p){for(;p!=null;p=p.nextSibling){var g=p.nodeType;if(g===1||g===3)break;if(g===8){if(g=p.data,g==="$"||g==="$!"||g==="$?")break;if(g==="/$")return null}}return p}function oI(p){p=p.previousSibling;for(var g=0;p;){if(p.nodeType===8){var T=p.data;if(T==="$"||T==="$!"||T==="$?"){if(g===0)return p;g--}else T==="/$"&&g++}p=p.previousSibling}return null}var Tm=Math.random().toString(36).slice(2),fu="__reactFiber$"+Tm,hh="__reactProps$"+Tm,Bc="__reactContainer$"+Tm,f_="__reactEvents$"+Tm,dD="__reactListeners$"+Tm,hD="__reactHandles$"+Tm;function Gp(p){var g=p[fu];if(g)return g;for(var T=p.parentNode;T;){if(g=T[Bc]||T[fu]){if(T=g.alternate,g.child!==null||T!==null&&T.child!==null)for(p=oI(p);p!==null;){if(T=p[fu])return T;p=oI(p)}return g}p=T,T=p.parentNode}return null}function Cm(p){return p=p[fu]||p[Bc],!p||p.tag!==5&&p.tag!==6&&p.tag!==13&&p.tag!==3?null:p}function Hp(p){if(p.tag===5||p.tag===6)return p.stateNode;throw Error(i(33))}function Rm(p){return p[hh]||null}var yb=[],Im=-1;function Wc(p){return{current:p}}function Fi(p){0>Im||(p.current=yb[Im],yb[Im]=null,Im--)}function ki(p,g){Im++,yb[Im]=p.current,p.current=g}var ph={},Bo=Wc(ph),Wa=Wc(!1),$p=ph;function Kp(p,g){var T=p.type.contextTypes;if(!T)return ph;var N=p.stateNode;if(N&&N.__reactInternalMemoizedUnmaskedChildContext===g)return N.__reactInternalMemoizedMaskedChildContext;var V={},$;for($ in T)V[$]=g[$];return N&&(p=p.stateNode,p.__reactInternalMemoizedUnmaskedChildContext=g,p.__reactInternalMemoizedMaskedChildContext=V),V}function za(p){return p=p.childContextTypes,p!=null}function AE(){Fi(Wa),Fi(Bo)}function aI(p,g,T){if(Bo.current!==ph)throw Error(i(168));ki(Bo,g),ki(Wa,T)}function PE(p,g,T){var N=p.stateNode;if(g=g.childContextTypes,typeof N.getChildContext!="function")return T;N=N.getChildContext();for(var V in N)if(!(V in g))throw Error(i(108,$e(p)||"Unknown",V));return We({},T,N)}function OE(p){return p=(p=p.stateNode)&&p.__reactInternalMemoizedMergedChildContext||ph,$p=Bo.current,ki(Bo,p),ki(Wa,Wa.current),!0}function cI(p,g,T){var N=p.stateNode;if(!N)throw Error(i(169));T?(p=PE(p,g,$p),N.__reactInternalMemoizedMergedChildContext=p,Fi(Wa),Fi(Bo),ki(Bo,p)):Fi(Wa),ki(Wa,T)}var zc=null,kE=!1,Eb=!1;function lI(p){zc===null?zc=[p]:zc.push(p)}function pD(p){kE=!0,lI(p)}function fh(){if(!Eb&&zc!==null){Eb=!0;var p=0,g=hr;try{var T=zc;for(hr=1;p<T.length;p++){var N=T[p];do N=N(!0);while(N!==null)}zc=null,kE=!1}catch(V){throw zc!==null&&(zc=zc.slice(p+1)),rh(Lc,fh),V}finally{hr=g,Eb=!1}}return null}var Am=[],hd=0,m_=null,NE=0,Gc=[],vc=0,qp=null,pd=1,fd="";function md(p,g){Am[hd++]=NE,Am[hd++]=m_,m_=p,NE=g}function DE(p,g,T){Gc[vc++]=pd,Gc[vc++]=fd,Gc[vc++]=qp,qp=p;var N=pd;p=fd;var V=32-bo(N)-1;N&=~(1<<V),T+=1;var $=32-bo(g)+V;if(30<$){var he=V-V%5;$=(N&(1<<he)-1).toString(32),N>>=he,V-=he,pd=1<<32-bo(g)+V|T<<V|N,fd=$+p}else pd=1<<$|T<<V|N,fd=p}function xE(p){p.return!==null&&(md(p,1),DE(p,1,0))}function g_(p){for(;p===m_;)m_=Am[--hd],Am[hd]=null,NE=Am[--hd],Am[hd]=null;for(;p===qp;)qp=Gc[--vc],Gc[vc]=null,fd=Gc[--vc],Gc[vc]=null,pd=Gc[--vc],Gc[vc]=null}var Ga=null,Ha=null,vi=!1,ma=null;function uI(p,g){var T=wc(5,null,null,0);T.elementType="DELETED",T.stateNode=g,T.return=p,g=p.deletions,g===null?(p.deletions=[T],p.flags|=16):g.push(T)}function dI(p,g){switch(p.tag){case 5:var T=p.type;return g=g.nodeType!==1||T.toLowerCase()!==g.nodeName.toLowerCase()?null:g,g!==null?(p.stateNode=g,Ga=p,Ha=dh(g.firstChild),!0):!1;case 6:return g=p.pendingProps===""||g.nodeType!==3?null:g,g!==null?(p.stateNode=g,Ga=p,Ha=null,!0):!1;case 13:return g=g.nodeType!==8?null:g,g!==null?(T=qp!==null?{id:pd,overflow:fd}:null,p.memoizedState={dehydrated:g,treeContext:T,retryLane:1073741824},T=wc(18,null,null,0),T.stateNode=g,T.return=p,p.child=T,Ga=p,Ha=null,!0):!1;default:return!1}}function LE(p){return(p.mode&1)!==0&&(p.flags&128)===0}function vb(p){if(vi){var g=Ha;if(g){var T=g;if(!dI(p,g)){if(LE(p))throw Error(i(418));g=dh(T.nextSibling);var N=Ga;g&&dI(p,g)?uI(N,T):(p.flags=p.flags&-4097|2,vi=!1,Ga=p)}}else{if(LE(p))throw Error(i(418));p.flags=p.flags&-4097|2,vi=!1,Ga=p}}}function hI(p){for(p=p.return;p!==null&&p.tag!==5&&p.tag!==3&&p.tag!==13;)p=p.return;Ga=p}function __(p){if(p!==Ga)return!1;if(!vi)return hI(p),vi=!0,!1;var g;if((g=p.tag!==3)&&!(g=p.tag!==5)&&(g=p.type,g=g!=="head"&&g!=="body"&&!gb(p.type,p.memoizedProps)),g&&(g=Ha)){if(LE(p))throw pI(),Error(i(418));for(;g;)uI(p,g),g=dh(g.nextSibling)}if(hI(p),p.tag===13){if(p=p.memoizedState,p=p!==null?p.dehydrated:null,!p)throw Error(i(317));e:{for(p=p.nextSibling,g=0;p;){if(p.nodeType===8){var T=p.data;if(T==="/$"){if(g===0){Ha=dh(p.nextSibling);break e}g--}else T!=="$"&&T!=="$!"&&T!=="$?"||g++}p=p.nextSibling}Ha=null}}else Ha=Ga?dh(p.stateNode.nextSibling):null;return!0}function pI(){for(var p=Ha;p;)p=dh(p.nextSibling)}function Pm(){Ha=Ga=null,vi=!1}function Sb(p){ma===null?ma=[p]:ma.push(p)}var fD=ae.ReactCurrentBatchConfig;function y_(p,g,T){if(p=T.ref,p!==null&&typeof p!="function"&&typeof p!="object"){if(T._owner){if(T=T._owner,T){if(T.tag!==1)throw Error(i(309));var N=T.stateNode}if(!N)throw Error(i(147,p));var V=N,$=""+p;return g!==null&&g.ref!==null&&typeof g.ref=="function"&&g.ref._stringRef===$?g.ref:(g=function(he){var Ce=V.refs;he===null?delete Ce[$]:Ce[$]=he},g._stringRef=$,g)}if(typeof p!="string")throw Error(i(284));if(!T._owner)throw Error(i(290,p))}return p}function ME(p,g){throw p=Object.prototype.toString.call(g),Error(i(31,p==="[object Object]"?"object with keys {"+Object.keys(g).join(", ")+"}":p))}function bb(p){var g=p._init;return g(p._payload)}function mh(p){function g(et,Fe){if(p){var rt=et.deletions;rt===null?(et.deletions=[Fe],et.flags|=16):rt.push(Fe)}}function T(et,Fe){if(!p)return null;for(;Fe!==null;)g(et,Fe),Fe=Fe.sibling;return null}function N(et,Fe){for(et=new Map;Fe!==null;)Fe.key!==null?et.set(Fe.key,Fe):et.set(Fe.index,Fe),Fe=Fe.sibling;return et}function V(et,Fe){return et=wd(et,Fe),et.index=0,et.sibling=null,et}function $(et,Fe,rt){return et.index=rt,p?(rt=et.alternate,rt!==null?(rt=rt.index,rt<Fe?(et.flags|=2,Fe):rt):(et.flags|=2,Fe)):(et.flags|=1048576,Fe)}function he(et){return p&&et.alternate===null&&(et.flags|=2),et}function Ce(et,Fe,rt,Ft){return Fe===null||Fe.tag!==6?(Fe=sw(rt,et.mode,Ft),Fe.return=et,Fe):(Fe=V(Fe,rt),Fe.return=et,Fe)}function Me(et,Fe,rt,Ft){var un=rt.type;return un===X?xt(et,Fe,rt.props.children,Ft,rt.key):Fe!==null&&(Fe.elementType===un||typeof un=="object"&&un!==null&&un.$$typeof===xe&&bb(un)===Fe.type)?(Ft=V(Fe,rt.props),Ft.ref=y_(et,Fe,rt),Ft.return=et,Ft):(Ft=bv(rt.type,rt.key,rt.props,null,et.mode,Ft),Ft.ref=y_(et,Fe,rt),Ft.return=et,Ft)}function ot(et,Fe,rt,Ft){return Fe===null||Fe.tag!==4||Fe.stateNode.containerInfo!==rt.containerInfo||Fe.stateNode.implementation!==rt.implementation?(Fe=ow(rt,et.mode,Ft),Fe.return=et,Fe):(Fe=V(Fe,rt.children||[]),Fe.return=et,Fe)}function xt(et,Fe,rt,Ft,un){return Fe===null||Fe.tag!==7?(Fe=af(rt,et.mode,Ft,un),Fe.return=et,Fe):(Fe=V(Fe,rt),Fe.return=et,Fe)}function Mt(et,Fe,rt){if(typeof Fe=="string"&&Fe!==""||typeof Fe=="number")return Fe=sw(""+Fe,et.mode,rt),Fe.return=et,Fe;if(typeof Fe=="object"&&Fe!==null){switch(Fe.$$typeof){case ne:return rt=bv(Fe.type,Fe.key,Fe.props,null,et.mode,rt),rt.ref=y_(et,null,Fe),rt.return=et,rt;case pe:return Fe=ow(Fe,et.mode,rt),Fe.return=et,Fe;case xe:var Ft=Fe._init;return Mt(et,Ft(Fe._payload),rt)}if(Ke(Fe)||be(Fe))return Fe=af(Fe,et.mode,rt,null),Fe.return=et,Fe;ME(et,Fe)}return null}function Dt(et,Fe,rt,Ft){var un=Fe!==null?Fe.key:null;if(typeof rt=="string"&&rt!==""||typeof rt=="number")return un!==null?null:Ce(et,Fe,""+rt,Ft);if(typeof rt=="object"&&rt!==null){switch(rt.$$typeof){case ne:return rt.key===un?Me(et,Fe,rt,Ft):null;case pe:return rt.key===un?ot(et,Fe,rt,Ft):null;case xe:return un=rt._init,Dt(et,Fe,un(rt._payload),Ft)}if(Ke(rt)||be(rt))return un!==null?null:xt(et,Fe,rt,Ft,null);ME(et,rt)}return null}function en(et,Fe,rt,Ft,un){if(typeof Ft=="string"&&Ft!==""||typeof Ft=="number")return et=et.get(rt)||null,Ce(Fe,et,""+Ft,un);if(typeof Ft=="object"&&Ft!==null){switch(Ft.$$typeof){case ne:return et=et.get(Ft.key===null?rt:Ft.key)||null,Me(Fe,et,Ft,un);case pe:return et=et.get(Ft.key===null?rt:Ft.key)||null,ot(Fe,et,Ft,un);case xe:var bn=Ft._init;return en(et,Fe,rt,bn(Ft._payload),un)}if(Ke(Ft)||be(Ft))return et=et.get(rt)||null,xt(Fe,et,Ft,un,null);ME(Fe,Ft)}return null}function cn(et,Fe,rt,Ft){for(var un=null,bn=null,In=Fe,Bn=Fe=0,Ns=null;In!==null&&Bn<rt.length;Bn++){In.index>Bn?(Ns=In,In=null):Ns=In.sibling;var Or=Dt(et,In,rt[Bn],Ft);if(Or===null){In===null&&(In=Ns);break}p&&In&&Or.alternate===null&&g(et,In),Fe=$(Or,Fe,Bn),bn===null?un=Or:bn.sibling=Or,bn=Or,In=Ns}if(Bn===rt.length)return T(et,In),vi&&md(et,Bn),un;if(In===null){for(;Bn<rt.length;Bn++)In=Mt(et,rt[Bn],Ft),In!==null&&(Fe=$(In,Fe,Bn),bn===null?un=In:bn.sibling=In,bn=In);return vi&&md(et,Bn),un}for(In=N(et,In);Bn<rt.length;Bn++)Ns=en(In,et,Bn,rt[Bn],Ft),Ns!==null&&(p&&Ns.alternate!==null&&In.delete(Ns.key===null?Bn:Ns.key),Fe=$(Ns,Fe,Bn),bn===null?un=Ns:bn.sibling=Ns,bn=Ns);return p&&In.forEach(function(Rh){return g(et,Rh)}),vi&&md(et,Bn),un}function ln(et,Fe,rt,Ft){var un=be(rt);if(typeof un!="function")throw Error(i(150));if(rt=un.call(rt),rt==null)throw Error(i(151));for(var bn=un=null,In=Fe,Bn=Fe=0,Ns=null,Or=rt.next();In!==null&&!Or.done;Bn++,Or=rt.next()){In.index>Bn?(Ns=In,In=null):Ns=In.sibling;var Rh=Dt(et,In,Or.value,Ft);if(Rh===null){In===null&&(In=Ns);break}p&&In&&Rh.alternate===null&&g(et,In),Fe=$(Rh,Fe,Bn),bn===null?un=Rh:bn.sibling=Rh,bn=Rh,In=Ns}if(Or.done)return T(et,In),vi&&md(et,Bn),un;if(In===null){for(;!Or.done;Bn++,Or=rt.next())Or=Mt(et,Or.value,Ft),Or!==null&&(Fe=$(Or,Fe,Bn),bn===null?un=Or:bn.sibling=Or,bn=Or);return vi&&md(et,Bn),un}for(In=N(et,In);!Or.done;Bn++,Or=rt.next())Or=en(In,et,Bn,Or.value,Ft),Or!==null&&(p&&Or.alternate!==null&&In.delete(Or.key===null?Bn:Or.key),Fe=$(Or,Fe,Bn),bn===null?un=Or:bn.sibling=Or,bn=Or);return p&&In.forEach(function(OD){return g(et,OD)}),vi&&md(et,Bn),un}function cs(et,Fe,rt,Ft){if(typeof rt=="object"&&rt!==null&&rt.type===X&&rt.key===null&&(rt=rt.props.children),typeof rt=="object"&&rt!==null){switch(rt.$$typeof){case ne:e:{for(var un=rt.key,bn=Fe;bn!==null;){if(bn.key===un){if(un=rt.type,un===X){if(bn.tag===7){T(et,bn.sibling),Fe=V(bn,rt.props.children),Fe.return=et,et=Fe;break e}}else if(bn.elementType===un||typeof un=="object"&&un!==null&&un.$$typeof===xe&&bb(un)===bn.type){T(et,bn.sibling),Fe=V(bn,rt.props),Fe.ref=y_(et,bn,rt),Fe.return=et,et=Fe;break e}T(et,bn);break}else g(et,bn);bn=bn.sibling}rt.type===X?(Fe=af(rt.props.children,et.mode,Ft,rt.key),Fe.return=et,et=Fe):(Ft=bv(rt.type,rt.key,rt.props,null,et.mode,Ft),Ft.ref=y_(et,Fe,rt),Ft.return=et,et=Ft)}return he(et);case pe:e:{for(bn=rt.key;Fe!==null;){if(Fe.key===bn)if(Fe.tag===4&&Fe.stateNode.containerInfo===rt.containerInfo&&Fe.stateNode.implementation===rt.implementation){T(et,Fe.sibling),Fe=V(Fe,rt.children||[]),Fe.return=et,et=Fe;break e}else{T(et,Fe);break}else g(et,Fe);Fe=Fe.sibling}Fe=ow(rt,et.mode,Ft),Fe.return=et,et=Fe}return he(et);case xe:return bn=rt._init,cs(et,Fe,bn(rt._payload),Ft)}if(Ke(rt))return cn(et,Fe,rt,Ft);if(be(rt))return ln(et,Fe,rt,Ft);ME(et,rt)}return typeof rt=="string"&&rt!==""||typeof rt=="number"?(rt=""+rt,Fe!==null&&Fe.tag===6?(T(et,Fe.sibling),Fe=V(Fe,rt),Fe.return=et,et=Fe):(T(et,Fe),Fe=sw(rt,et.mode,Ft),Fe.return=et,et=Fe),he(et)):T(et,Fe)}return cs}var Om=mh(!0),fI=mh(!1),UE=Wc(null),E_=null,km=null,VE=null;function wb(){VE=km=E_=null}function Tb(p){var g=UE.current;Fi(UE),p._currentValue=g}function Cb(p,g,T){for(;p!==null;){var N=p.alternate;if((p.childLanes&g)!==g?(p.childLanes|=g,N!==null&&(N.childLanes|=g)):N!==null&&(N.childLanes&g)!==g&&(N.childLanes|=g),p===T)break;p=p.return}}function gd(p,g){E_=p,VE=km=null,p=p.dependencies,p!==null&&p.firstContext!==null&&((p.lanes&g)!==0&&(Ka=!0),p.firstContext=null)}function Hc(p){var g=p._currentValue;if(VE!==p)if(p={context:p,memoizedValue:g,next:null},km===null){if(E_===null)throw Error(i(308));km=p,E_.dependencies={lanes:0,firstContext:p}}else km=km.next=p;return g}var Yp=null;function Rb(p){Yp===null?Yp=[p]:Yp.push(p)}function mI(p,g,T,N){var V=g.interleaved;return V===null?(T.next=T,Rb(g)):(T.next=V.next,V.next=T),g.interleaved=T,_d(p,N)}function _d(p,g){p.lanes|=g;var T=p.alternate;for(T!==null&&(T.lanes|=g),T=p,p=p.return;p!==null;)p.childLanes|=g,T=p.alternate,T!==null&&(T.childLanes|=g),T=p,p=p.return;return T.tag===3?T.stateNode:null}var gh=!1;function v_(p){p.updateQueue={baseState:p.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function gI(p,g){p=p.updateQueue,g.updateQueue===p&&(g.updateQueue={baseState:p.baseState,firstBaseUpdate:p.firstBaseUpdate,lastBaseUpdate:p.lastBaseUpdate,shared:p.shared,effects:p.effects})}function mu(p,g){return{eventTime:p,lane:g,tag:0,payload:null,callback:null,next:null}}function _h(p,g,T){var N=p.updateQueue;if(N===null)return null;if(N=N.shared,(Lr&2)!==0){var V=N.pending;return V===null?g.next=g:(g.next=V.next,V.next=g),N.pending=g,_d(p,T)}return V=N.interleaved,V===null?(g.next=g,Rb(N)):(g.next=V.next,V.next=g),N.interleaved=g,_d(p,T)}function S_(p,g,T){if(g=g.updateQueue,g!==null&&(g=g.shared,(T&4194240)!==0)){var N=g.lanes;N&=p.pendingLanes,T|=N,g.lanes=T,gc(p,T)}}function _I(p,g){var T=p.updateQueue,N=p.alternate;if(N!==null&&(N=N.updateQueue,T===N)){var V=null,$=null;if(T=T.firstBaseUpdate,T!==null){do{var he={eventTime:T.eventTime,lane:T.lane,tag:T.tag,payload:T.payload,callback:T.callback,next:null};$===null?V=$=he:$=$.next=he,T=T.next}while(T!==null);$===null?V=$=g:$=$.next=g}else V=$=g;T={baseState:N.baseState,firstBaseUpdate:V,lastBaseUpdate:$,shared:N.shared,effects:N.effects},p.updateQueue=T;return}p=T.lastBaseUpdate,p===null?T.firstBaseUpdate=g:p.next=g,T.lastBaseUpdate=g}function jE(p,g,T,N){var V=p.updateQueue;gh=!1;var $=V.firstBaseUpdate,he=V.lastBaseUpdate,Ce=V.shared.pending;if(Ce!==null){V.shared.pending=null;var Me=Ce,ot=Me.next;Me.next=null,he===null?$=ot:he.next=ot,he=Me;var xt=p.alternate;xt!==null&&(xt=xt.updateQueue,Ce=xt.lastBaseUpdate,Ce!==he&&(Ce===null?xt.firstBaseUpdate=ot:Ce.next=ot,xt.lastBaseUpdate=Me))}if($!==null){var Mt=V.baseState;he=0,xt=ot=Me=null,Ce=$;do{var Dt=Ce.lane,en=Ce.eventTime;if((N&Dt)===Dt){xt!==null&&(xt=xt.next={eventTime:en,lane:0,tag:Ce.tag,payload:Ce.payload,callback:Ce.callback,next:null});e:{var cn=p,ln=Ce;switch(Dt=g,en=T,ln.tag){case 1:if(cn=ln.payload,typeof cn=="function"){Mt=cn.call(en,Mt,Dt);break e}Mt=cn;break e;case 3:cn.flags=cn.flags&-65537|128;case 0:if(cn=ln.payload,Dt=typeof cn=="function"?cn.call(en,Mt,Dt):cn,Dt==null)break e;Mt=We({},Mt,Dt);break e;case 2:gh=!0}}Ce.callback!==null&&Ce.lane!==0&&(p.flags|=64,Dt=V.effects,Dt===null?V.effects=[Ce]:Dt.push(Ce))}else en={eventTime:en,lane:Dt,tag:Ce.tag,payload:Ce.payload,callback:Ce.callback,next:null},xt===null?(ot=xt=en,Me=Mt):xt=xt.next=en,he|=Dt;if(Ce=Ce.next,Ce===null){if(Ce=V.shared.pending,Ce===null)break;Dt=Ce,Ce=Dt.next,Dt.next=null,V.lastBaseUpdate=Dt,V.shared.pending=null}}while(!0);if(xt===null&&(Me=Mt),V.baseState=Me,V.firstBaseUpdate=ot,V.lastBaseUpdate=xt,g=V.shared.interleaved,g!==null){V=g;do he|=V.lane,V=V.next;while(V!==g)}else $===null&&(V.shared.lanes=0);tf|=he,p.lanes=he,p.memoizedState=Mt}}function yI(p,g,T){if(p=g.effects,g.effects=null,p!==null)for(g=0;g<p.length;g++){var N=p[g],V=N.callback;if(V!==null){if(N.callback=null,N=T,typeof V!="function")throw Error(i(191,V));V.call(N)}}}var b_={},gu=Wc(b_),w_=Wc(b_),Nm=Wc(b_);function Xp(p){if(p===b_)throw Error(i(174));return p}function Ib(p,g){switch(ki(Nm,g),ki(w_,p),ki(gu,b_),p=g.nodeType,p){case 9:case 11:g=(g=g.documentElement)?g.namespaceURI:sn(null,"");break;default:p=p===8?g.parentNode:g,g=p.namespaceURI||null,p=p.tagName,g=sn(g,p)}Fi(gu),ki(gu,g)}function Jp(){Fi(gu),Fi(w_),Fi(Nm)}function EI(p){Xp(Nm.current);var g=Xp(gu.current),T=sn(g,p.type);g!==T&&(ki(w_,p),ki(gu,T))}function Dm(p){w_.current===p&&(Fi(gu),Fi(w_))}var Hi=Wc(0);function yh(p){for(var g=p;g!==null;){if(g.tag===13){var T=g.memoizedState;if(T!==null&&(T=T.dehydrated,T===null||T.data==="$?"||T.data==="$!"))return g}else if(g.tag===19&&g.memoizedProps.revealOrder!==void 0){if((g.flags&128)!==0)return g}else if(g.child!==null){g.child.return=g,g=g.child;continue}if(g===p)break;for(;g.sibling===null;){if(g.return===null||g.return===p)return null;g=g.return}g.sibling.return=g.return,g=g.sibling}return null}var Ab=[];function Pb(){for(var p=0;p<Ab.length;p++)Ab[p]._workInProgressVersionPrimary=null;Ab.length=0}var FE=ae.ReactCurrentDispatcher,Ob=ae.ReactCurrentBatchConfig,_u=0,Xi=null,As=null,Ps=null,xm=!1,T_=!1,C_=0,mD=0;function Wo(){throw Error(i(321))}function kb(p,g){if(g===null)return!1;for(var T=0;T<g.length&&T<p.length;T++)if(!kl(p[T],g[T]))return!1;return!0}function Lm(p,g,T,N,V,$){if(_u=$,Xi=g,g.memoizedState=null,g.updateQueue=null,g.lanes=0,FE.current=p===null||p.memoizedState===null?yD:OI,p=T(N,V),T_){$=0;do{if(T_=!1,C_=0,25<=$)throw Error(i(301));$+=1,Ps=As=null,g.updateQueue=null,FE.current=ED,p=T(N,V)}while(T_)}if(FE.current=GE,g=As!==null&&As.next!==null,_u=0,Ps=As=Xi=null,xm=!1,g)throw Error(i(300));return p}function Nb(){var p=C_!==0;return C_=0,p}function ga(){var p={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Ps===null?Xi.memoizedState=Ps=p:Ps=Ps.next=p,Ps}function $a(){if(As===null){var p=Xi.alternate;p=p!==null?p.memoizedState:null}else p=As.next;var g=Ps===null?Xi.memoizedState:Ps.next;if(g!==null)Ps=g,As=p;else{if(p===null)throw Error(i(310));As=p,p={memoizedState:As.memoizedState,baseState:As.baseState,baseQueue:As.baseQueue,queue:As.queue,next:null},Ps===null?Xi.memoizedState=Ps=p:Ps=Ps.next=p}return Ps}function Eh(p,g){return typeof g=="function"?g(p):g}function Qp(p){var g=$a(),T=g.queue;if(T===null)throw Error(i(311));T.lastRenderedReducer=p;var N=As,V=N.baseQueue,$=T.pending;if($!==null){if(V!==null){var he=V.next;V.next=$.next,$.next=he}N.baseQueue=V=$,T.pending=null}if(V!==null){$=V.next,N=N.baseState;var Ce=he=null,Me=null,ot=$;do{var xt=ot.lane;if((_u&xt)===xt)Me!==null&&(Me=Me.next={lane:0,action:ot.action,hasEagerState:ot.hasEagerState,eagerState:ot.eagerState,next:null}),N=ot.hasEagerState?ot.eagerState:p(N,ot.action);else{var Mt={lane:xt,action:ot.action,hasEagerState:ot.hasEagerState,eagerState:ot.eagerState,next:null};Me===null?(Ce=Me=Mt,he=N):Me=Me.next=Mt,Xi.lanes|=xt,tf|=xt}ot=ot.next}while(ot!==null&&ot!==$);Me===null?he=N:Me.next=Ce,kl(N,g.memoizedState)||(Ka=!0),g.memoizedState=N,g.baseState=he,g.baseQueue=Me,T.lastRenderedState=N}if(p=T.interleaved,p!==null){V=p;do $=V.lane,Xi.lanes|=$,tf|=$,V=V.next;while(V!==p)}else V===null&&(T.lanes=0);return[g.memoizedState,T.dispatch]}function Mm(p){var g=$a(),T=g.queue;if(T===null)throw Error(i(311));T.lastRenderedReducer=p;var N=T.dispatch,V=T.pending,$=g.memoizedState;if(V!==null){T.pending=null;var he=V=V.next;do $=p($,he.action),he=he.next;while(he!==V);kl($,g.memoizedState)||(Ka=!0),g.memoizedState=$,g.baseQueue===null&&(g.baseState=$),T.lastRenderedState=$}return[$,N]}function vI(){}function Db(p,g){var T=Xi,N=$a(),V=g(),$=!kl(N.memoizedState,V);if($&&(N.memoizedState=V,Ka=!0),N=N.queue,$c(bI.bind(null,T,N,p),[p]),N.getSnapshot!==g||$||Ps!==null&&Ps.memoizedState.tag&1){if(T.flags|=2048,R_(9,xb.bind(null,T,N,V,g),void 0,null),lo===null)throw Error(i(349));(_u&30)!==0||SI(T,g,V)}return V}function SI(p,g,T){p.flags|=16384,p={getSnapshot:g,value:T},g=Xi.updateQueue,g===null?(g={lastEffect:null,stores:null},Xi.updateQueue=g,g.stores=[p]):(T=g.stores,T===null?g.stores=[p]:T.push(p))}function xb(p,g,T,N){g.value=T,g.getSnapshot=N,wI(g)&&BE(p)}function bI(p,g,T){return T(function(){wI(g)&&BE(p)})}function wI(p){var g=p.getSnapshot;p=p.value;try{var T=g();return!kl(p,T)}catch{return!0}}function BE(p){var g=_d(p,1);g!==null&&Xc(g,p,1,-1)}function WE(p){var g=ga();return typeof p=="function"&&(p=p()),g.memoizedState=g.baseState=p,p={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Eh,lastRenderedState:p},g.queue=p,p=p.dispatch=_D.bind(null,Xi,p),[g.memoizedState,p]}function R_(p,g,T,N){return p={tag:p,create:g,destroy:T,deps:N,next:null},g=Xi.updateQueue,g===null?(g={lastEffect:null,stores:null},Xi.updateQueue=g,g.lastEffect=p.next=p):(T=g.lastEffect,T===null?g.lastEffect=p.next=p:(N=T.next,T.next=p,p.next=N,g.lastEffect=p)),p}function TI(){return $a().memoizedState}function I_(p,g,T,N){var V=ga();Xi.flags|=p,V.memoizedState=R_(1|g,T,void 0,N===void 0?null:N)}function Um(p,g,T,N){var V=$a();N=N===void 0?null:N;var $=void 0;if(As!==null){var he=As.memoizedState;if($=he.destroy,N!==null&&kb(N,he.deps)){V.memoizedState=R_(g,T,$,N);return}}Xi.flags|=p,V.memoizedState=R_(1|g,T,$,N)}function CI(p,g){return I_(8390656,8,p,g)}function $c(p,g){return Um(2048,8,p,g)}function Zp(p,g){return Um(4,2,p,g)}function vh(p,g){return Um(4,4,p,g)}function Lb(p,g){if(typeof g=="function")return p=p(),g(p),function(){g(null)};if(g!=null)return p=p(),g.current=p,function(){g.current=null}}function Mb(p,g,T){return T=T!=null?T.concat([p]):null,Um(4,4,Lb.bind(null,g,p),T)}function yd(){}function zE(p,g){var T=$a();g=g===void 0?null:g;var N=T.memoizedState;return N!==null&&g!==null&&kb(g,N[1])?N[0]:(T.memoizedState=[p,g],p)}function RI(p,g){var T=$a();g=g===void 0?null:g;var N=T.memoizedState;return N!==null&&g!==null&&kb(g,N[1])?N[0]:(p=p(),T.memoizedState=[p,g],p)}function Ub(p,g,T){return(_u&21)===0?(p.baseState&&(p.baseState=!1,Ka=!0),p.memoizedState=T):(kl(T,g)||(T=sd(),Xi.lanes|=T,tf|=T,p.baseState=!0),g)}function gD(p,g){var T=hr;hr=T!==0&&4>T?T:4,p(!0);var N=Ob.transition;Ob.transition={};try{p(!1),g()}finally{hr=T,Ob.transition=N}}function Vb(){return $a().memoizedState}function II(p,g,T){var N=Yc(p);if(T={lane:N,action:T,hasEagerState:!1,eagerState:null,next:null},Ed(p))AI(g,T);else if(T=mI(p,g,T,N),T!==null){var V=Co();Xc(T,p,N,V),PI(T,g,N)}}function _D(p,g,T){var N=Yc(p),V={lane:N,action:T,hasEagerState:!1,eagerState:null,next:null};if(Ed(p))AI(g,V);else{var $=p.alternate;if(p.lanes===0&&($===null||$.lanes===0)&&($=g.lastRenderedReducer,$!==null))try{var he=g.lastRenderedState,Ce=$(he,T);if(V.hasEagerState=!0,V.eagerState=Ce,kl(Ce,he)){var Me=g.interleaved;Me===null?(V.next=V,Rb(g)):(V.next=Me.next,Me.next=V),g.interleaved=V;return}}catch{}finally{}T=mI(p,g,V,N),T!==null&&(V=Co(),Xc(T,p,N,V),PI(T,g,N))}}function Ed(p){var g=p.alternate;return p===Xi||g!==null&&g===Xi}function AI(p,g){T_=xm=!0;var T=p.pending;T===null?g.next=g:(g.next=T.next,T.next=g),p.pending=g}function PI(p,g,T){if((T&4194240)!==0){var N=g.lanes;N&=p.pendingLanes,T|=N,g.lanes=T,gc(p,T)}}var GE={readContext:Hc,useCallback:Wo,useContext:Wo,useEffect:Wo,useImperativeHandle:Wo,useInsertionEffect:Wo,useLayoutEffect:Wo,useMemo:Wo,useReducer:Wo,useRef:Wo,useState:Wo,useDebugValue:Wo,useDeferredValue:Wo,useTransition:Wo,useMutableSource:Wo,useSyncExternalStore:Wo,useId:Wo,unstable_isNewReconciler:!1},yD={readContext:Hc,useCallback:function(p,g){return ga().memoizedState=[p,g===void 0?null:g],p},useContext:Hc,useEffect:CI,useImperativeHandle:function(p,g,T){return T=T!=null?T.concat([p]):null,I_(4194308,4,Lb.bind(null,g,p),T)},useLayoutEffect:function(p,g){return I_(4194308,4,p,g)},useInsertionEffect:function(p,g){return I_(4,2,p,g)},useMemo:function(p,g){var T=ga();return g=g===void 0?null:g,p=p(),T.memoizedState=[p,g],p},useReducer:function(p,g,T){var N=ga();return g=T!==void 0?T(g):g,N.memoizedState=N.baseState=g,p={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:p,lastRenderedState:g},N.queue=p,p=p.dispatch=II.bind(null,Xi,p),[N.memoizedState,p]},useRef:function(p){var g=ga();return p={current:p},g.memoizedState=p},useState:WE,useDebugValue:yd,useDeferredValue:function(p){return ga().memoizedState=p},useTransition:function(){var p=WE(!1),g=p[0];return p=gD.bind(null,p[1]),ga().memoizedState=p,[g,p]},useMutableSource:function(){},useSyncExternalStore:function(p,g,T){var N=Xi,V=ga();if(vi){if(T===void 0)throw Error(i(407));T=T()}else{if(T=g(),lo===null)throw Error(i(349));(_u&30)!==0||SI(N,g,T)}V.memoizedState=T;var $={value:T,getSnapshot:g};return V.queue=$,CI(bI.bind(null,N,$,p),[p]),N.flags|=2048,R_(9,xb.bind(null,N,$,T,g),void 0,null),T},useId:function(){var p=ga(),g=lo.identifierPrefix;if(vi){var T=fd,N=pd;T=(N&~(1<<32-bo(N)-1)).toString(32)+T,g=":"+g+"R"+T,T=C_++,0<T&&(g+="H"+T.toString(32)),g+=":"}else T=mD++,g=":"+g+"r"+T.toString(32)+":";return p.memoizedState=g},unstable_isNewReconciler:!1},OI={readContext:Hc,useCallback:zE,useContext:Hc,useEffect:$c,useImperativeHandle:Mb,useInsertionEffect:Zp,useLayoutEffect:vh,useMemo:RI,useReducer:Qp,useRef:TI,useState:function(){return Qp(Eh)},useDebugValue:yd,useDeferredValue:function(p){var g=$a();return Ub(g,As.memoizedState,p)},useTransition:function(){var p=Qp(Eh)[0],g=$a().memoizedState;return[p,g]},useMutableSource:vI,useSyncExternalStore:Db,useId:Vb,unstable_isNewReconciler:!1},ED={readContext:Hc,useCallback:zE,useContext:Hc,useEffect:$c,useImperativeHandle:Mb,useInsertionEffect:Zp,useLayoutEffect:vh,useMemo:RI,useReducer:Mm,useRef:TI,useState:function(){return Mm(Eh)},useDebugValue:yd,useDeferredValue:function(p){var g=$a();return As===null?g.memoizedState=p:Ub(g,As.memoizedState,p)},useTransition:function(){var p=Mm(Eh)[0],g=$a().memoizedState;return[p,g]},useMutableSource:vI,useSyncExternalStore:Db,useId:Vb,unstable_isNewReconciler:!1};function Sc(p,g){if(p&&p.defaultProps){g=We({},g),p=p.defaultProps;for(var T in p)g[T]===void 0&&(g[T]=p[T]);return g}return g}function HE(p,g,T,N){g=p.memoizedState,T=T(N,g),T=T==null?g:We({},g,T),p.memoizedState=T,p.lanes===0&&(p.updateQueue.baseState=T)}var $E={isMounted:function(p){return(p=p._reactInternals)?Ai(p)===p:!1},enqueueSetState:function(p,g,T){p=p._reactInternals;var N=Co(),V=Yc(p),$=mu(N,V);$.payload=g,T!=null&&($.callback=T),g=_h(p,$,V),g!==null&&(Xc(g,p,V,N),S_(g,p,V))},enqueueReplaceState:function(p,g,T){p=p._reactInternals;var N=Co(),V=Yc(p),$=mu(N,V);$.tag=1,$.payload=g,T!=null&&($.callback=T),g=_h(p,$,V),g!==null&&(Xc(g,p,V,N),S_(g,p,V))},enqueueForceUpdate:function(p,g){p=p._reactInternals;var T=Co(),N=Yc(p),V=mu(T,N);V.tag=2,g!=null&&(V.callback=g),g=_h(p,V,N),g!==null&&(Xc(g,p,N,T),S_(g,p,N))}};function jb(p,g,T,N,V,$,he){return p=p.stateNode,typeof p.shouldComponentUpdate=="function"?p.shouldComponentUpdate(N,$,he):g.prototype&&g.prototype.isPureReactComponent?!o_(T,N)||!o_(V,$):!0}function kI(p,g,T){var N=!1,V=ph,$=g.contextType;return typeof $=="object"&&$!==null?$=Hc($):(V=za(g)?$p:Bo.current,N=g.contextTypes,$=(N=N!=null)?Kp(p,V):ph),g=new g(T,$),p.memoizedState=g.state!==null&&g.state!==void 0?g.state:null,g.updater=$E,p.stateNode=g,g._reactInternals=p,N&&(p=p.stateNode,p.__reactInternalMemoizedUnmaskedChildContext=V,p.__reactInternalMemoizedMaskedChildContext=$),g}function NI(p,g,T,N){p=g.state,typeof g.componentWillReceiveProps=="function"&&g.componentWillReceiveProps(T,N),typeof g.UNSAFE_componentWillReceiveProps=="function"&&g.UNSAFE_componentWillReceiveProps(T,N),g.state!==p&&$E.enqueueReplaceState(g,g.state,null)}function Fb(p,g,T,N){var V=p.stateNode;V.props=T,V.state=p.memoizedState,V.refs={},v_(p);var $=g.contextType;typeof $=="object"&&$!==null?V.context=Hc($):($=za(g)?$p:Bo.current,V.context=Kp(p,$)),V.state=p.memoizedState,$=g.getDerivedStateFromProps,typeof $=="function"&&(HE(p,g,$,T),V.state=p.memoizedState),typeof g.getDerivedStateFromProps=="function"||typeof V.getSnapshotBeforeUpdate=="function"||typeof V.UNSAFE_componentWillMount!="function"&&typeof V.componentWillMount!="function"||(g=V.state,typeof V.componentWillMount=="function"&&V.componentWillMount(),typeof V.UNSAFE_componentWillMount=="function"&&V.UNSAFE_componentWillMount(),g!==V.state&&$E.enqueueReplaceState(V,V.state,null),jE(p,T,V,N),V.state=p.memoizedState),typeof V.componentDidMount=="function"&&(p.flags|=4194308)}function Vm(p,g){try{var T="",N=g;do T+=Be(N),N=N.return;while(N);var V=T}catch($){V=`
Error generating stack: `+$.message+`
`+$.stack}return{value:p,source:g,stack:V,digest:null}}function Bb(p,g,T){return{value:p,source:null,stack:T??null,digest:g??null}}function Wb(p,g){try{console.error(g.value)}catch(T){setTimeout(function(){throw T})}}var vD=typeof WeakMap=="function"?WeakMap:Map;function zb(p,g,T){T=mu(-1,T),T.tag=3,T.payload={element:null};var N=g.value;return T.callback=function(){uv||(uv=!0,ew=N),Wb(p,g)},T}function vd(p,g,T){T=mu(-1,T),T.tag=3;var N=p.type.getDerivedStateFromError;if(typeof N=="function"){var V=g.value;T.payload=function(){return N(V)},T.callback=function(){Wb(p,g)}}var $=p.stateNode;return $!==null&&typeof $.componentDidCatch=="function"&&(T.callback=function(){Wb(p,g),typeof N!="function"&&(Sh===null?Sh=new Set([this]):Sh.add(this));var he=g.stack;this.componentDidCatch(g.value,{componentStack:he!==null?he:""})}),T}function DI(p,g,T){var N=p.pingCache;if(N===null){N=p.pingCache=new vD;var V=new Set;N.set(g,V)}else V=N.get(g),V===void 0&&(V=new Set,N.set(g,V));V.has(T)||(V.add(T),p=rA.bind(null,p,g,T),g.then(p,p))}function xI(p){do{var g;if((g=p.tag===13)&&(g=p.memoizedState,g=g!==null?g.dehydrated!==null:!0),g)return p;p=p.return}while(p!==null);return null}function LI(p,g,T,N,V){return(p.mode&1)===0?(p===g?p.flags|=65536:(p.flags|=128,T.flags|=131072,T.flags&=-52805,T.tag===1&&(T.alternate===null?T.tag=17:(g=mu(-1,1),g.tag=2,_h(T,g,1))),T.lanes|=1),p):(p.flags|=65536,p.lanes=V,p)}var SD=ae.ReactCurrentOwner,Ka=!1;function _a(p,g,T,N){g.child=p===null?fI(g,null,T,N):Om(g,p.child,T,N)}function KE(p,g,T,N,V){T=T.render;var $=g.ref;return gd(g,V),N=Lm(p,g,T,N,$,V),T=Nb(),p!==null&&!Ka?(g.updateQueue=p.updateQueue,g.flags&=-2053,p.lanes&=~V,yu(p,g,V)):(vi&&T&&xE(g),g.flags|=1,_a(p,g,N,V),g.child)}function MI(p,g,T,N,V){if(p===null){var $=T.type;return typeof $=="function"&&!wh($)&&$.defaultProps===void 0&&T.compare===null&&T.defaultProps===void 0?(g.tag=15,g.type=$,UI(p,g,$,N,V)):(p=bv(T.type,null,N,g,g.mode,V),p.ref=g.ref,p.return=g,g.child=p)}if($=p.child,(p.lanes&V)===0){var he=$.memoizedProps;if(T=T.compare,T=T!==null?T:o_,T(he,N)&&p.ref===g.ref)return yu(p,g,V)}return g.flags|=1,p=wd($,N),p.ref=g.ref,p.return=g,g.child=p}function UI(p,g,T,N,V){if(p!==null){var $=p.memoizedProps;if(o_($,N)&&p.ref===g.ref)if(Ka=!1,g.pendingProps=N=$,(p.lanes&V)!==0)(p.flags&131072)!==0&&(Ka=!0);else return g.lanes=p.lanes,yu(p,g,V)}return Gb(p,g,T,N,V)}function VI(p,g,T){var N=g.pendingProps,V=N.children,$=p!==null?p.memoizedState:null;if(N.mode==="hidden")if((g.mode&1)===0)g.memoizedState={baseLanes:0,cachePool:null,transitions:null},ki(Nl,bc),bc|=T;else{if((T&1073741824)===0)return p=$!==null?$.baseLanes|T:T,g.lanes=g.childLanes=1073741824,g.memoizedState={baseLanes:p,cachePool:null,transitions:null},g.updateQueue=null,ki(Nl,bc),bc|=p,null;g.memoizedState={baseLanes:0,cachePool:null,transitions:null},N=$!==null?$.baseLanes:T,ki(Nl,bc),bc|=N}else $!==null?(N=$.baseLanes|T,g.memoizedState=null):N=T,ki(Nl,bc),bc|=N;return _a(p,g,V,T),g.child}function jI(p,g){var T=g.ref;(p===null&&T!==null||p!==null&&p.ref!==T)&&(g.flags|=512,g.flags|=2097152)}function Gb(p,g,T,N,V){var $=za(T)?$p:Bo.current;return $=Kp(g,$),gd(g,V),T=Lm(p,g,T,N,$,V),N=Nb(),p!==null&&!Ka?(g.updateQueue=p.updateQueue,g.flags&=-2053,p.lanes&=~V,yu(p,g,V)):(vi&&N&&xE(g),g.flags|=1,_a(p,g,T,V),g.child)}function FI(p,g,T,N,V){if(za(T)){var $=!0;OE(g)}else $=!1;if(gd(g,V),g.stateNode===null)ZE(p,g),kI(g,T,N),Fb(g,T,N,V),N=!0;else if(p===null){var he=g.stateNode,Ce=g.memoizedProps;he.props=Ce;var Me=he.context,ot=T.contextType;typeof ot=="object"&&ot!==null?ot=Hc(ot):(ot=za(T)?$p:Bo.current,ot=Kp(g,ot));var xt=T.getDerivedStateFromProps,Mt=typeof xt=="function"||typeof he.getSnapshotBeforeUpdate=="function";Mt||typeof he.UNSAFE_componentWillReceiveProps!="function"&&typeof he.componentWillReceiveProps!="function"||(Ce!==N||Me!==ot)&&NI(g,he,N,ot),gh=!1;var Dt=g.memoizedState;he.state=Dt,jE(g,N,he,V),Me=g.memoizedState,Ce!==N||Dt!==Me||Wa.current||gh?(typeof xt=="function"&&(HE(g,T,xt,N),Me=g.memoizedState),(Ce=gh||jb(g,T,Ce,N,Dt,Me,ot))?(Mt||typeof he.UNSAFE_componentWillMount!="function"&&typeof he.componentWillMount!="function"||(typeof he.componentWillMount=="function"&&he.componentWillMount(),typeof he.UNSAFE_componentWillMount=="function"&&he.UNSAFE_componentWillMount()),typeof he.componentDidMount=="function"&&(g.flags|=4194308)):(typeof he.componentDidMount=="function"&&(g.flags|=4194308),g.memoizedProps=N,g.memoizedState=Me),he.props=N,he.state=Me,he.context=ot,N=Ce):(typeof he.componentDidMount=="function"&&(g.flags|=4194308),N=!1)}else{he=g.stateNode,gI(p,g),Ce=g.memoizedProps,ot=g.type===g.elementType?Ce:Sc(g.type,Ce),he.props=ot,Mt=g.pendingProps,Dt=he.context,Me=T.contextType,typeof Me=="object"&&Me!==null?Me=Hc(Me):(Me=za(T)?$p:Bo.current,Me=Kp(g,Me));var en=T.getDerivedStateFromProps;(xt=typeof en=="function"||typeof he.getSnapshotBeforeUpdate=="function")||typeof he.UNSAFE_componentWillReceiveProps!="function"&&typeof he.componentWillReceiveProps!="function"||(Ce!==Mt||Dt!==Me)&&NI(g,he,N,Me),gh=!1,Dt=g.memoizedState,he.state=Dt,jE(g,N,he,V);var cn=g.memoizedState;Ce!==Mt||Dt!==cn||Wa.current||gh?(typeof en=="function"&&(HE(g,T,en,N),cn=g.memoizedState),(ot=gh||jb(g,T,ot,N,Dt,cn,Me)||!1)?(xt||typeof he.UNSAFE_componentWillUpdate!="function"&&typeof he.componentWillUpdate!="function"||(typeof he.componentWillUpdate=="function"&&he.componentWillUpdate(N,cn,Me),typeof he.UNSAFE_componentWillUpdate=="function"&&he.UNSAFE_componentWillUpdate(N,cn,Me)),typeof he.componentDidUpdate=="function"&&(g.flags|=4),typeof he.getSnapshotBeforeUpdate=="function"&&(g.flags|=1024)):(typeof he.componentDidUpdate!="function"||Ce===p.memoizedProps&&Dt===p.memoizedState||(g.flags|=4),typeof he.getSnapshotBeforeUpdate!="function"||Ce===p.memoizedProps&&Dt===p.memoizedState||(g.flags|=1024),g.memoizedProps=N,g.memoizedState=cn),he.props=N,he.state=cn,he.context=Me,N=ot):(typeof he.componentDidUpdate!="function"||Ce===p.memoizedProps&&Dt===p.memoizedState||(g.flags|=4),typeof he.getSnapshotBeforeUpdate!="function"||Ce===p.memoizedProps&&Dt===p.memoizedState||(g.flags|=1024),N=!1)}return qE(p,g,T,N,$,V)}function qE(p,g,T,N,V,$){jI(p,g);var he=(g.flags&128)!==0;if(!N&&!he)return V&&cI(g,T,!1),yu(p,g,$);N=g.stateNode,SD.current=g;var Ce=he&&typeof T.getDerivedStateFromError!="function"?null:N.render();return g.flags|=1,p!==null&&he?(g.child=Om(g,p.child,null,$),g.child=Om(g,null,Ce,$)):_a(p,g,Ce,$),g.memoizedState=N.state,V&&cI(g,T,!0),g.child}function Hb(p){var g=p.stateNode;g.pendingContext?aI(p,g.pendingContext,g.pendingContext!==g.context):g.context&&aI(p,g.context,!1),Ib(p,g.containerInfo)}function BI(p,g,T,N,V){return Pm(),Sb(V),g.flags|=256,_a(p,g,T,N),g.child}var $b={dehydrated:null,treeContext:null,retryLane:0};function jm(p){return{baseLanes:p,cachePool:null,transitions:null}}function YE(p,g,T){var N=g.pendingProps,V=Hi.current,$=!1,he=(g.flags&128)!==0,Ce;if((Ce=he)||(Ce=p!==null&&p.memoizedState===null?!1:(V&2)!==0),Ce?($=!0,g.flags&=-129):(p===null||p.memoizedState!==null)&&(V|=1),ki(Hi,V&1),p===null)return vb(g),p=g.memoizedState,p!==null&&(p=p.dehydrated,p!==null)?((g.mode&1)===0?g.lanes=1:p.data==="$!"?g.lanes=8:g.lanes=1073741824,null):(he=N.children,p=N.fallback,$?(N=g.mode,$=g.child,he={mode:"hidden",children:he},(N&1)===0&&$!==null?($.childLanes=0,$.pendingProps=he):$=Th(he,N,0,null),p=af(p,N,T,null),$.return=g,p.return=g,$.sibling=p,g.child=$,g.child.memoizedState=jm(T),g.memoizedState=$b,p):XE(g,he));if(V=p.memoizedState,V!==null&&(Ce=V.dehydrated,Ce!==null))return WI(p,g,he,N,Ce,V,T);if($){$=N.fallback,he=g.mode,V=p.child,Ce=V.sibling;var Me={mode:"hidden",children:N.children};return(he&1)===0&&g.child!==V?(N=g.child,N.childLanes=0,N.pendingProps=Me,g.deletions=null):(N=wd(V,Me),N.subtreeFlags=V.subtreeFlags&14680064),Ce!==null?$=wd(Ce,$):($=af($,he,T,null),$.flags|=2),$.return=g,N.return=g,N.sibling=$,g.child=N,N=$,$=g.child,he=p.child.memoizedState,he=he===null?jm(T):{baseLanes:he.baseLanes|T,cachePool:null,transitions:he.transitions},$.memoizedState=he,$.childLanes=p.childLanes&~T,g.memoizedState=$b,N}return $=p.child,p=$.sibling,N=wd($,{mode:"visible",children:N.children}),(g.mode&1)===0&&(N.lanes=T),N.return=g,N.sibling=null,p!==null&&(T=g.deletions,T===null?(g.deletions=[p],g.flags|=16):T.push(p)),g.child=N,g.memoizedState=null,N}function XE(p,g){return g=Th({mode:"visible",children:g},p.mode,0,null),g.return=p,p.child=g}function ef(p,g,T,N){return N!==null&&Sb(N),Om(g,p.child,null,T),p=XE(g,g.pendingProps.children),p.flags|=2,g.memoizedState=null,p}function WI(p,g,T,N,V,$,he){if(T)return g.flags&256?(g.flags&=-257,N=Bb(Error(i(422))),ef(p,g,he,N)):g.memoizedState!==null?(g.child=p.child,g.flags|=128,null):($=N.fallback,V=g.mode,N=Th({mode:"visible",children:N.children},V,0,null),$=af($,V,he,null),$.flags|=2,N.return=g,$.return=g,N.sibling=$,g.child=N,(g.mode&1)!==0&&Om(g,p.child,null,he),g.child.memoizedState=jm(he),g.memoizedState=$b,$);if((g.mode&1)===0)return ef(p,g,he,null);if(V.data==="$!"){if(N=V.nextSibling&&V.nextSibling.dataset,N)var Ce=N.dgst;return N=Ce,$=Error(i(419)),N=Bb($,N,void 0),ef(p,g,he,N)}if(Ce=(he&p.childLanes)!==0,Ka||Ce){if(N=lo,N!==null){switch(he&-he){case 4:V=2;break;case 16:V=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:V=32;break;case 536870912:V=268435456;break;default:V=0}V=(V&(N.suspendedLanes|he))!==0?0:V,V!==0&&V!==$.retryLane&&($.retryLane=V,_d(p,V),Xc(N,p,V,-1))}return rw(),N=Bb(Error(i(421))),ef(p,g,he,N)}return V.data==="$?"?(g.flags|=128,g.child=p.child,g=Ev.bind(null,p),V._reactRetry=g,null):(p=$.treeContext,Ha=dh(V.nextSibling),Ga=g,vi=!0,ma=null,p!==null&&(Gc[vc++]=pd,Gc[vc++]=fd,Gc[vc++]=qp,pd=p.id,fd=p.overflow,qp=g),g=XE(g,N.children),g.flags|=4096,g)}function zI(p,g,T){p.lanes|=g;var N=p.alternate;N!==null&&(N.lanes|=g),Cb(p.return,g,T)}function JE(p,g,T,N,V){var $=p.memoizedState;$===null?p.memoizedState={isBackwards:g,rendering:null,renderingStartTime:0,last:N,tail:T,tailMode:V}:($.isBackwards=g,$.rendering=null,$.renderingStartTime=0,$.last=N,$.tail=T,$.tailMode=V)}function QE(p,g,T){var N=g.pendingProps,V=N.revealOrder,$=N.tail;if(_a(p,g,N.children,T),N=Hi.current,(N&2)!==0)N=N&1|2,g.flags|=128;else{if(p!==null&&(p.flags&128)!==0)e:for(p=g.child;p!==null;){if(p.tag===13)p.memoizedState!==null&&zI(p,T,g);else if(p.tag===19)zI(p,T,g);else if(p.child!==null){p.child.return=p,p=p.child;continue}if(p===g)break e;for(;p.sibling===null;){if(p.return===null||p.return===g)break e;p=p.return}p.sibling.return=p.return,p=p.sibling}N&=1}if(ki(Hi,N),(g.mode&1)===0)g.memoizedState=null;else switch(V){case"forwards":for(T=g.child,V=null;T!==null;)p=T.alternate,p!==null&&yh(p)===null&&(V=T),T=T.sibling;T=V,T===null?(V=g.child,g.child=null):(V=T.sibling,T.sibling=null),JE(g,!1,V,T,$);break;case"backwards":for(T=null,V=g.child,g.child=null;V!==null;){if(p=V.alternate,p!==null&&yh(p)===null){g.child=V;break}p=V.sibling,V.sibling=T,T=V,V=p}JE(g,!0,T,null,$);break;case"together":JE(g,!1,null,null,void 0);break;default:g.memoizedState=null}return g.child}function ZE(p,g){(g.mode&1)===0&&p!==null&&(p.alternate=null,g.alternate=null,g.flags|=2)}function yu(p,g,T){if(p!==null&&(g.dependencies=p.dependencies),tf|=g.lanes,(T&g.childLanes)===0)return null;if(p!==null&&g.child!==p.child)throw Error(i(153));if(g.child!==null){for(p=g.child,T=wd(p,p.pendingProps),g.child=T,T.return=g;p.sibling!==null;)p=p.sibling,T=T.sibling=wd(p,p.pendingProps),T.return=g;T.sibling=null}return g.child}function GI(p,g,T){switch(g.tag){case 3:Hb(g),Pm();break;case 5:EI(g);break;case 1:za(g.type)&&OE(g);break;case 4:Ib(g,g.stateNode.containerInfo);break;case 10:var N=g.type._context,V=g.memoizedProps.value;ki(UE,N._currentValue),N._currentValue=V;break;case 13:if(N=g.memoizedState,N!==null)return N.dehydrated!==null?(ki(Hi,Hi.current&1),g.flags|=128,null):(T&g.child.childLanes)!==0?YE(p,g,T):(ki(Hi,Hi.current&1),p=yu(p,g,T),p!==null?p.sibling:null);ki(Hi,Hi.current&1);break;case 19:if(N=(T&g.childLanes)!==0,(p.flags&128)!==0){if(N)return QE(p,g,T);g.flags|=128}if(V=g.memoizedState,V!==null&&(V.rendering=null,V.tail=null,V.lastEffect=null),ki(Hi,Hi.current),N)break;return null;case 22:case 23:return g.lanes=0,VI(p,g,T)}return yu(p,g,T)}var HI,ev,Kb,$I;HI=function(p,g){for(var T=g.child;T!==null;){if(T.tag===5||T.tag===6)p.appendChild(T.stateNode);else if(T.tag!==4&&T.child!==null){T.child.return=T,T=T.child;continue}if(T===g)break;for(;T.sibling===null;){if(T.return===null||T.return===g)return;T=T.return}T.sibling.return=T.return,T=T.sibling}},ev=function(){},Kb=function(p,g,T,N){var V=p.memoizedProps;if(V!==N){p=g.stateNode,Xp(gu.current);var $=null;switch(T){case"input":V=mt(p,V),N=mt(p,N),$=[];break;case"select":V=We({},V,{value:void 0}),N=We({},N,{value:void 0}),$=[];break;case"textarea":V=Et(p,V),N=Et(p,N),$=[];break;default:typeof V.onClick!="function"&&typeof N.onClick=="function"&&(p.onclick=RE)}na(T,N);var he;T=null;for(ot in V)if(!N.hasOwnProperty(ot)&&V.hasOwnProperty(ot)&&V[ot]!=null)if(ot==="style"){var Ce=V[ot];for(he in Ce)Ce.hasOwnProperty(he)&&(T||(T={}),T[he]="")}else ot!=="dangerouslySetInnerHTML"&&ot!=="children"&&ot!=="suppressContentEditableWarning"&&ot!=="suppressHydrationWarning"&&ot!=="autoFocus"&&(l.hasOwnProperty(ot)?$||($=[]):($=$||[]).push(ot,null));for(ot in N){var Me=N[ot];if(Ce=V!=null?V[ot]:void 0,N.hasOwnProperty(ot)&&Me!==Ce&&(Me!=null||Ce!=null))if(ot==="style")if(Ce){for(he in Ce)!Ce.hasOwnProperty(he)||Me&&Me.hasOwnProperty(he)||(T||(T={}),T[he]="");for(he in Me)Me.hasOwnProperty(he)&&Ce[he]!==Me[he]&&(T||(T={}),T[he]=Me[he])}else T||($||($=[]),$.push(ot,T)),T=Me;else ot==="dangerouslySetInnerHTML"?(Me=Me?Me.__html:void 0,Ce=Ce?Ce.__html:void 0,Me!=null&&Ce!==Me&&($=$||[]).push(ot,Me)):ot==="children"?typeof Me!="string"&&typeof Me!="number"||($=$||[]).push(ot,""+Me):ot!=="suppressContentEditableWarning"&&ot!=="suppressHydrationWarning"&&(l.hasOwnProperty(ot)?(Me!=null&&ot==="onScroll"&&ji("scroll",p),$||Ce===Me||($=[])):($=$||[]).push(ot,Me))}T&&($=$||[]).push("style",T);var ot=$;(g.updateQueue=ot)&&(g.flags|=4)}},$I=function(p,g,T,N){T!==N&&(g.flags|=4)};function A_(p,g){if(!vi)switch(p.tailMode){case"hidden":g=p.tail;for(var T=null;g!==null;)g.alternate!==null&&(T=g),g=g.sibling;T===null?p.tail=null:T.sibling=null;break;case"collapsed":T=p.tail;for(var N=null;T!==null;)T.alternate!==null&&(N=T),T=T.sibling;N===null?g||p.tail===null?p.tail=null:p.tail.sibling=null:N.sibling=null}}function zo(p){var g=p.alternate!==null&&p.alternate.child===p.child,T=0,N=0;if(g)for(var V=p.child;V!==null;)T|=V.lanes|V.childLanes,N|=V.subtreeFlags&14680064,N|=V.flags&14680064,V.return=p,V=V.sibling;else for(V=p.child;V!==null;)T|=V.lanes|V.childLanes,N|=V.subtreeFlags,N|=V.flags,V.return=p,V=V.sibling;return p.subtreeFlags|=N,p.childLanes=T,g}function tv(p,g,T){var N=g.pendingProps;switch(g_(g),g.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return zo(g),null;case 1:return za(g.type)&&AE(),zo(g),null;case 3:return N=g.stateNode,Jp(),Fi(Wa),Fi(Bo),Pb(),N.pendingContext&&(N.context=N.pendingContext,N.pendingContext=null),(p===null||p.child===null)&&(__(g)?g.flags|=4:p===null||p.memoizedState.isDehydrated&&(g.flags&256)===0||(g.flags|=1024,ma!==null&&(mv(ma),ma=null))),ev(p,g),zo(g),null;case 5:Dm(g);var V=Xp(Nm.current);if(T=g.type,p!==null&&g.stateNode!=null)Kb(p,g,T,N,V),p.ref!==g.ref&&(g.flags|=512,g.flags|=2097152);else{if(!N){if(g.stateNode===null)throw Error(i(166));return zo(g),null}if(p=Xp(gu.current),__(g)){N=g.stateNode,T=g.type;var $=g.memoizedProps;switch(N[fu]=g,N[hh]=$,p=(g.mode&1)!==0,T){case"dialog":ji("cancel",N),ji("close",N);break;case"iframe":case"object":case"embed":ji("load",N);break;case"video":case"audio":for(V=0;V<u_.length;V++)ji(u_[V],N);break;case"source":ji("error",N);break;case"img":case"image":case"link":ji("error",N),ji("load",N);break;case"details":ji("toggle",N);break;case"input":Lt(N,$),ji("invalid",N);break;case"select":N._wrapperState={wasMultiple:!!$.multiple},ji("invalid",N);break;case"textarea":Tt(N,$),ji("invalid",N)}na(T,$),V=null;for(var he in $)if($.hasOwnProperty(he)){var Ce=$[he];he==="children"?typeof Ce=="string"?N.textContent!==Ce&&($.suppressHydrationWarning!==!0&&CE(N.textContent,Ce,p),V=["children",Ce]):typeof Ce=="number"&&N.textContent!==""+Ce&&($.suppressHydrationWarning!==!0&&CE(N.textContent,Ce,p),V=["children",""+Ce]):l.hasOwnProperty(he)&&Ce!=null&&he==="onScroll"&&ji("scroll",N)}switch(T){case"input":kt(N),we(N,$,!0);break;case"textarea":kt(N),gn(N);break;case"select":case"option":break;default:typeof $.onClick=="function"&&(N.onclick=RE)}N=V,g.updateQueue=N,N!==null&&(g.flags|=4)}else{he=V.nodeType===9?V:V.ownerDocument,p==="http://www.w3.org/1999/xhtml"&&(p=Sn(T)),p==="http://www.w3.org/1999/xhtml"?T==="script"?(p=he.createElement("div"),p.innerHTML="<script><\/script>",p=p.removeChild(p.firstChild)):typeof N.is=="string"?p=he.createElement(T,{is:N.is}):(p=he.createElement(T),T==="select"&&(he=p,N.multiple?he.multiple=!0:N.size&&(he.size=N.size))):p=he.createElementNS(p,T),p[fu]=g,p[hh]=N,HI(p,g,!1,!1),g.stateNode=p;e:{switch(he=dc(T,N),T){case"dialog":ji("cancel",p),ji("close",p),V=N;break;case"iframe":case"object":case"embed":ji("load",p),V=N;break;case"video":case"audio":for(V=0;V<u_.length;V++)ji(u_[V],p);V=N;break;case"source":ji("error",p),V=N;break;case"img":case"image":case"link":ji("error",p),ji("load",p),V=N;break;case"details":ji("toggle",p),V=N;break;case"input":Lt(p,N),V=mt(p,N),ji("invalid",p);break;case"option":V=N;break;case"select":p._wrapperState={wasMultiple:!!N.multiple},V=We({},N,{value:void 0}),ji("invalid",p);break;case"textarea":Tt(p,N),V=Et(p,N),ji("invalid",p);break;default:V=N}na(T,V),Ce=V;for($ in Ce)if(Ce.hasOwnProperty($)){var Me=Ce[$];$==="style"?Ts(p,Me):$==="dangerouslySetInnerHTML"?(Me=Me?Me.__html:void 0,Me!=null&&ir(p,Me)):$==="children"?typeof Me=="string"?(T!=="textarea"||Me!=="")&&Vt(p,Me):typeof Me=="number"&&Vt(p,""+Me):$!=="suppressContentEditableWarning"&&$!=="suppressHydrationWarning"&&$!=="autoFocus"&&(l.hasOwnProperty($)?Me!=null&&$==="onScroll"&&ji("scroll",p):Me!=null&&re(p,$,Me,he))}switch(T){case"input":kt(p),we(p,N,!1);break;case"textarea":kt(p),gn(p);break;case"option":N.value!=null&&p.setAttribute("value",""+st(N.value));break;case"select":p.multiple=!!N.multiple,$=N.value,$!=null?gt(p,!!N.multiple,$,!1):N.defaultValue!=null&&gt(p,!!N.multiple,N.defaultValue,!0);break;default:typeof V.onClick=="function"&&(p.onclick=RE)}switch(T){case"button":case"input":case"select":case"textarea":N=!!N.autoFocus;break e;case"img":N=!0;break e;default:N=!1}}N&&(g.flags|=4)}g.ref!==null&&(g.flags|=512,g.flags|=2097152)}return zo(g),null;case 6:if(p&&g.stateNode!=null)$I(p,g,p.memoizedProps,N);else{if(typeof N!="string"&&g.stateNode===null)throw Error(i(166));if(T=Xp(Nm.current),Xp(gu.current),__(g)){if(N=g.stateNode,T=g.memoizedProps,N[fu]=g,($=N.nodeValue!==T)&&(p=Ga,p!==null))switch(p.tag){case 3:CE(N.nodeValue,T,(p.mode&1)!==0);break;case 5:p.memoizedProps.suppressHydrationWarning!==!0&&CE(N.nodeValue,T,(p.mode&1)!==0)}$&&(g.flags|=4)}else N=(T.nodeType===9?T:T.ownerDocument).createTextNode(N),N[fu]=g,g.stateNode=N}return zo(g),null;case 13:if(Fi(Hi),N=g.memoizedState,p===null||p.memoizedState!==null&&p.memoizedState.dehydrated!==null){if(vi&&Ha!==null&&(g.mode&1)!==0&&(g.flags&128)===0)pI(),Pm(),g.flags|=98560,$=!1;else if($=__(g),N!==null&&N.dehydrated!==null){if(p===null){if(!$)throw Error(i(318));if($=g.memoizedState,$=$!==null?$.dehydrated:null,!$)throw Error(i(317));$[fu]=g}else Pm(),(g.flags&128)===0&&(g.memoizedState=null),g.flags|=4;zo(g),$=!1}else ma!==null&&(mv(ma),ma=null),$=!0;if(!$)return g.flags&65536?g:null}return(g.flags&128)!==0?(g.lanes=T,g):(N=N!==null,N!==(p!==null&&p.memoizedState!==null)&&N&&(g.child.flags|=8192,(g.mode&1)!==0&&(p===null||(Hi.current&1)!==0?ks===0&&(ks=3):rw())),g.updateQueue!==null&&(g.flags|=4),zo(g),null);case 4:return Jp(),ev(p,g),p===null&&Wp(g.stateNode.containerInfo),zo(g),null;case 10:return Tb(g.type._context),zo(g),null;case 17:return za(g.type)&&AE(),zo(g),null;case 19:if(Fi(Hi),$=g.memoizedState,$===null)return zo(g),null;if(N=(g.flags&128)!==0,he=$.rendering,he===null)if(N)A_($,!1);else{if(ks!==0||p!==null&&(p.flags&128)!==0)for(p=g.child;p!==null;){if(he=yh(p),he!==null){for(g.flags|=128,A_($,!1),N=he.updateQueue,N!==null&&(g.updateQueue=N,g.flags|=4),g.subtreeFlags=0,N=T,T=g.child;T!==null;)$=T,p=N,$.flags&=14680066,he=$.alternate,he===null?($.childLanes=0,$.lanes=p,$.child=null,$.subtreeFlags=0,$.memoizedProps=null,$.memoizedState=null,$.updateQueue=null,$.dependencies=null,$.stateNode=null):($.childLanes=he.childLanes,$.lanes=he.lanes,$.child=he.child,$.subtreeFlags=0,$.deletions=null,$.memoizedProps=he.memoizedProps,$.memoizedState=he.memoizedState,$.updateQueue=he.updateQueue,$.type=he.type,p=he.dependencies,$.dependencies=p===null?null:{lanes:p.lanes,firstContext:p.firstContext}),T=T.sibling;return ki(Hi,Hi.current&1|2),g.child}p=p.sibling}$.tail!==null&&Xr()>Wm&&(g.flags|=128,N=!0,A_($,!1),g.lanes=4194304)}else{if(!N)if(p=yh(he),p!==null){if(g.flags|=128,N=!0,T=p.updateQueue,T!==null&&(g.updateQueue=T,g.flags|=4),A_($,!0),$.tail===null&&$.tailMode==="hidden"&&!he.alternate&&!vi)return zo(g),null}else 2*Xr()-$.renderingStartTime>Wm&&T!==1073741824&&(g.flags|=128,N=!0,A_($,!1),g.lanes=4194304);$.isBackwards?(he.sibling=g.child,g.child=he):(T=$.last,T!==null?T.sibling=he:g.child=he,$.last=he)}return $.tail!==null?(g=$.tail,$.rendering=g,$.tail=g.sibling,$.renderingStartTime=Xr(),g.sibling=null,T=Hi.current,ki(Hi,N?T&1|2:T&1),g):(zo(g),null);case 22:case 23:return M_(),N=g.memoizedState!==null,p!==null&&p.memoizedState!==null!==N&&(g.flags|=8192),N&&(g.mode&1)!==0?(bc&1073741824)!==0&&(zo(g),g.subtreeFlags&6&&(g.flags|=8192)):zo(g),null;case 24:return null;case 25:return null}throw Error(i(156,g.tag))}function bD(p,g){switch(g_(g),g.tag){case 1:return za(g.type)&&AE(),p=g.flags,p&65536?(g.flags=p&-65537|128,g):null;case 3:return Jp(),Fi(Wa),Fi(Bo),Pb(),p=g.flags,(p&65536)!==0&&(p&128)===0?(g.flags=p&-65537|128,g):null;case 5:return Dm(g),null;case 13:if(Fi(Hi),p=g.memoizedState,p!==null&&p.dehydrated!==null){if(g.alternate===null)throw Error(i(340));Pm()}return p=g.flags,p&65536?(g.flags=p&-65537|128,g):null;case 19:return Fi(Hi),null;case 4:return Jp(),null;case 10:return Tb(g.type._context),null;case 22:case 23:return M_(),null;case 24:return null;default:return null}}var nv=!1,Go=!1,KI=typeof WeakSet=="function"?WeakSet:Set,on=null;function Fm(p,g){var T=p.ref;if(T!==null)if(typeof T=="function")try{T(null)}catch(N){Ji(p,g,N)}else T.current=null}function P_(p,g,T){try{T()}catch(N){Ji(p,g,N)}}var qI=!1;function qb(p,g){if(IE=Se,p=YR(),a_(p)){if("selectionStart"in p)var T={start:p.selectionStart,end:p.selectionEnd};else e:{T=(T=p.ownerDocument)&&T.defaultView||window;var N=T.getSelection&&T.getSelection();if(N&&N.rangeCount!==0){T=N.anchorNode;var V=N.anchorOffset,$=N.focusNode;N=N.focusOffset;try{T.nodeType,$.nodeType}catch{T=null;break e}var he=0,Ce=-1,Me=-1,ot=0,xt=0,Mt=p,Dt=null;t:for(;;){for(var en;Mt!==T||V!==0&&Mt.nodeType!==3||(Ce=he+V),Mt!==$||N!==0&&Mt.nodeType!==3||(Me=he+N),Mt.nodeType===3&&(he+=Mt.nodeValue.length),(en=Mt.firstChild)!==null;)Dt=Mt,Mt=en;for(;;){if(Mt===p)break t;if(Dt===T&&++ot===V&&(Ce=he),Dt===$&&++xt===N&&(Me=he),(en=Mt.nextSibling)!==null)break;Mt=Dt,Dt=Mt.parentNode}Mt=en}T=Ce===-1||Me===-1?null:{start:Ce,end:Me}}else T=null}T=T||{start:0,end:0}}else T=null;for(h_={focusedElem:p,selectionRange:T},Se=!1,on=g;on!==null;)if(g=on,p=g.child,(g.subtreeFlags&1028)!==0&&p!==null)p.return=g,on=p;else for(;on!==null;){g=on;try{var cn=g.alternate;if((g.flags&1024)!==0)switch(g.tag){case 0:case 11:case 15:break;case 1:if(cn!==null){var ln=cn.memoizedProps,cs=cn.memoizedState,et=g.stateNode,Fe=et.getSnapshotBeforeUpdate(g.elementType===g.type?ln:Sc(g.type,ln),cs);et.__reactInternalSnapshotBeforeUpdate=Fe}break;case 3:var rt=g.stateNode.containerInfo;rt.nodeType===1?rt.textContent="":rt.nodeType===9&&rt.documentElement&&rt.removeChild(rt.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(i(163))}}catch(Ft){Ji(g,g.return,Ft)}if(p=g.sibling,p!==null){p.return=g.return,on=p;break}on=g.return}return cn=qI,qI=!1,cn}function O_(p,g,T){var N=g.updateQueue;if(N=N!==null?N.lastEffect:null,N!==null){var V=N=N.next;do{if((V.tag&p)===p){var $=V.destroy;V.destroy=void 0,$!==void 0&&P_(g,T,$)}V=V.next}while(V!==N)}}function k_(p,g){if(g=g.updateQueue,g=g!==null?g.lastEffect:null,g!==null){var T=g=g.next;do{if((T.tag&p)===p){var N=T.create;T.destroy=N()}T=T.next}while(T!==g)}}function Yb(p){var g=p.ref;if(g!==null){var T=p.stateNode;switch(p.tag){case 5:p=T;break;default:p=T}typeof g=="function"?g(p):g.current=p}}function YI(p){var g=p.alternate;g!==null&&(p.alternate=null,YI(g)),p.child=null,p.deletions=null,p.sibling=null,p.tag===5&&(g=p.stateNode,g!==null&&(delete g[fu],delete g[hh],delete g[f_],delete g[dD],delete g[hD])),p.stateNode=null,p.return=null,p.dependencies=null,p.memoizedProps=null,p.memoizedState=null,p.pendingProps=null,p.stateNode=null,p.updateQueue=null}function Xb(p){return p.tag===5||p.tag===3||p.tag===4}function XI(p){e:for(;;){for(;p.sibling===null;){if(p.return===null||Xb(p.return))return null;p=p.return}for(p.sibling.return=p.return,p=p.sibling;p.tag!==5&&p.tag!==6&&p.tag!==18;){if(p.flags&2||p.child===null||p.tag===4)continue e;p.child.return=p,p=p.child}if(!(p.flags&2))return p.stateNode}}function Jb(p,g,T){var N=p.tag;if(N===5||N===6)p=p.stateNode,g?T.nodeType===8?T.parentNode.insertBefore(p,g):T.insertBefore(p,g):(T.nodeType===8?(g=T.parentNode,g.insertBefore(p,T)):(g=T,g.appendChild(p)),T=T._reactRootContainer,T!=null||g.onclick!==null||(g.onclick=RE));else if(N!==4&&(p=p.child,p!==null))for(Jb(p,g,T),p=p.sibling;p!==null;)Jb(p,g,T),p=p.sibling}function rv(p,g,T){var N=p.tag;if(N===5||N===6)p=p.stateNode,g?T.insertBefore(p,g):T.appendChild(p);else if(N!==4&&(p=p.child,p!==null))for(rv(p,g,T),p=p.sibling;p!==null;)rv(p,g,T),p=p.sibling}var wo=null,Kc=!1;function Eu(p,g,T){for(T=T.child;T!==null;)JI(p,g,T),T=T.sibling}function JI(p,g,T){if(Fo&&typeof Fo.onCommitFiberUnmount=="function")try{Fo.onCommitFiberUnmount(ou,T)}catch{}switch(T.tag){case 5:Go||Fm(T,g);case 6:var N=wo,V=Kc;wo=null,Eu(p,g,T),wo=N,Kc=V,wo!==null&&(Kc?(p=wo,T=T.stateNode,p.nodeType===8?p.parentNode.removeChild(T):p.removeChild(T)):wo.removeChild(T.stateNode));break;case 18:wo!==null&&(Kc?(p=wo,T=T.stateNode,p.nodeType===8?_b(p.parentNode,T):p.nodeType===1&&_b(p,T),Fa(p)):_b(wo,T.stateNode));break;case 4:N=wo,V=Kc,wo=T.stateNode.containerInfo,Kc=!0,Eu(p,g,T),wo=N,Kc=V;break;case 0:case 11:case 14:case 15:if(!Go&&(N=T.updateQueue,N!==null&&(N=N.lastEffect,N!==null))){V=N=N.next;do{var $=V,he=$.destroy;$=$.tag,he!==void 0&&(($&2)!==0||($&4)!==0)&&P_(T,g,he),V=V.next}while(V!==N)}Eu(p,g,T);break;case 1:if(!Go&&(Fm(T,g),N=T.stateNode,typeof N.componentWillUnmount=="function"))try{N.props=T.memoizedProps,N.state=T.memoizedState,N.componentWillUnmount()}catch(Ce){Ji(T,g,Ce)}Eu(p,g,T);break;case 21:Eu(p,g,T);break;case 22:T.mode&1?(Go=(N=Go)||T.memoizedState!==null,Eu(p,g,T),Go=N):Eu(p,g,T);break;default:Eu(p,g,T)}}function QI(p){var g=p.updateQueue;if(g!==null){p.updateQueue=null;var T=p.stateNode;T===null&&(T=p.stateNode=new KI),g.forEach(function(N){var V=iA.bind(null,p,N);T.has(N)||(T.add(N),N.then(V,V))})}}function ya(p,g){var T=g.deletions;if(T!==null)for(var N=0;N<T.length;N++){var V=T[N];try{var $=p,he=g,Ce=he;e:for(;Ce!==null;){switch(Ce.tag){case 5:wo=Ce.stateNode,Kc=!1;break e;case 3:wo=Ce.stateNode.containerInfo,Kc=!0;break e;case 4:wo=Ce.stateNode.containerInfo,Kc=!0;break e}Ce=Ce.return}if(wo===null)throw Error(i(160));JI($,he,V),wo=null,Kc=!1;var Me=V.alternate;Me!==null&&(Me.return=null),V.return=null}catch(ot){Ji(V,g,ot)}}if(g.subtreeFlags&12854)for(g=g.child;g!==null;)Qb(g,p),g=g.sibling}function Qb(p,g){var T=p.alternate,N=p.flags;switch(p.tag){case 0:case 11:case 14:case 15:if(ya(g,p),qa(p),N&4){try{O_(3,p,p.return),k_(3,p)}catch(ln){Ji(p,p.return,ln)}try{O_(5,p,p.return)}catch(ln){Ji(p,p.return,ln)}}break;case 1:ya(g,p),qa(p),N&512&&T!==null&&Fm(T,T.return);break;case 5:if(ya(g,p),qa(p),N&512&&T!==null&&Fm(T,T.return),p.flags&32){var V=p.stateNode;try{Vt(V,"")}catch(ln){Ji(p,p.return,ln)}}if(N&4&&(V=p.stateNode,V!=null)){var $=p.memoizedProps,he=T!==null?T.memoizedProps:$,Ce=p.type,Me=p.updateQueue;if(p.updateQueue=null,Me!==null)try{Ce==="input"&&$.type==="radio"&&$.name!=null&&Xt(V,$),dc(Ce,he);var ot=dc(Ce,$);for(he=0;he<Me.length;he+=2){var xt=Me[he],Mt=Me[he+1];xt==="style"?Ts(V,Mt):xt==="dangerouslySetInnerHTML"?ir(V,Mt):xt==="children"?Vt(V,Mt):re(V,xt,Mt,ot)}switch(Ce){case"input":$t(V,$);break;case"textarea":Kt(V,$);break;case"select":var Dt=V._wrapperState.wasMultiple;V._wrapperState.wasMultiple=!!$.multiple;var en=$.value;en!=null?gt(V,!!$.multiple,en,!1):Dt!==!!$.multiple&&($.defaultValue!=null?gt(V,!!$.multiple,$.defaultValue,!0):gt(V,!!$.multiple,$.multiple?[]:"",!1))}V[hh]=$}catch(ln){Ji(p,p.return,ln)}}break;case 6:if(ya(g,p),qa(p),N&4){if(p.stateNode===null)throw Error(i(162));V=p.stateNode,$=p.memoizedProps;try{V.nodeValue=$}catch(ln){Ji(p,p.return,ln)}}break;case 3:if(ya(g,p),qa(p),N&4&&T!==null&&T.memoizedState.isDehydrated)try{Fa(g.containerInfo)}catch(ln){Ji(p,p.return,ln)}break;case 4:ya(g,p),qa(p);break;case 13:ya(g,p),qa(p),V=p.child,V.flags&8192&&($=V.memoizedState!==null,V.stateNode.isHidden=$,!$||V.alternate!==null&&V.alternate.memoizedState!==null||(lv=Xr())),N&4&&QI(p);break;case 22:if(xt=T!==null&&T.memoizedState!==null,p.mode&1?(Go=(ot=Go)||xt,ya(g,p),Go=ot):ya(g,p),qa(p),N&8192){if(ot=p.memoizedState!==null,(p.stateNode.isHidden=ot)&&!xt&&(p.mode&1)!==0)for(on=p,xt=p.child;xt!==null;){for(Mt=on=xt;on!==null;){switch(Dt=on,en=Dt.child,Dt.tag){case 0:case 11:case 14:case 15:O_(4,Dt,Dt.return);break;case 1:Fm(Dt,Dt.return);var cn=Dt.stateNode;if(typeof cn.componentWillUnmount=="function"){N=Dt,T=Dt.return;try{g=N,cn.props=g.memoizedProps,cn.state=g.memoizedState,cn.componentWillUnmount()}catch(ln){Ji(N,T,ln)}}break;case 5:Fm(Dt,Dt.return);break;case 22:if(Dt.memoizedState!==null){N_(Mt);continue}}en!==null?(en.return=Dt,on=en):N_(Mt)}xt=xt.sibling}e:for(xt=null,Mt=p;;){if(Mt.tag===5){if(xt===null){xt=Mt;try{V=Mt.stateNode,ot?($=V.style,typeof $.setProperty=="function"?$.setProperty("display","none","important"):$.display="none"):(Ce=Mt.stateNode,Me=Mt.memoizedProps.style,he=Me!=null&&Me.hasOwnProperty("display")?Me.display:null,Ce.style.display=Ui("display",he))}catch(ln){Ji(p,p.return,ln)}}}else if(Mt.tag===6){if(xt===null)try{Mt.stateNode.nodeValue=ot?"":Mt.memoizedProps}catch(ln){Ji(p,p.return,ln)}}else if((Mt.tag!==22&&Mt.tag!==23||Mt.memoizedState===null||Mt===p)&&Mt.child!==null){Mt.child.return=Mt,Mt=Mt.child;continue}if(Mt===p)break e;for(;Mt.sibling===null;){if(Mt.return===null||Mt.return===p)break e;xt===Mt&&(xt=null),Mt=Mt.return}xt===Mt&&(xt=null),Mt.sibling.return=Mt.return,Mt=Mt.sibling}}break;case 19:ya(g,p),qa(p),N&4&&QI(p);break;case 21:break;default:ya(g,p),qa(p)}}function qa(p){var g=p.flags;if(g&2){try{e:{for(var T=p.return;T!==null;){if(Xb(T)){var N=T;break e}T=T.return}throw Error(i(160))}switch(N.tag){case 5:var V=N.stateNode;N.flags&32&&(Vt(V,""),N.flags&=-33);var $=XI(p);rv(p,$,V);break;case 3:case 4:var he=N.stateNode.containerInfo,Ce=XI(p);Jb(p,Ce,he);break;default:throw Error(i(161))}}catch(Me){Ji(p,p.return,Me)}p.flags&=-3}g&4096&&(p.flags&=-4097)}function Bm(p,g,T){on=p,Zb(p)}function Zb(p,g,T){for(var N=(p.mode&1)!==0;on!==null;){var V=on,$=V.child;if(V.tag===22&&N){var he=V.memoizedState!==null||nv;if(!he){var Ce=V.alternate,Me=Ce!==null&&Ce.memoizedState!==null||Go;Ce=nv;var ot=Go;if(nv=he,(Go=Me)&&!ot)for(on=V;on!==null;)he=on,Me=he.child,he.tag===22&&he.memoizedState!==null?ZI(V):Me!==null?(Me.return=he,on=Me):ZI(V);for(;$!==null;)on=$,Zb($),$=$.sibling;on=V,nv=Ce,Go=ot}iv(p)}else(V.subtreeFlags&8772)!==0&&$!==null?($.return=V,on=$):iv(p)}}function iv(p){for(;on!==null;){var g=on;if((g.flags&8772)!==0){var T=g.alternate;try{if((g.flags&8772)!==0)switch(g.tag){case 0:case 11:case 15:Go||k_(5,g);break;case 1:var N=g.stateNode;if(g.flags&4&&!Go)if(T===null)N.componentDidMount();else{var V=g.elementType===g.type?T.memoizedProps:Sc(g.type,T.memoizedProps);N.componentDidUpdate(V,T.memoizedState,N.__reactInternalSnapshotBeforeUpdate)}var $=g.updateQueue;$!==null&&yI(g,$,N);break;case 3:var he=g.updateQueue;if(he!==null){if(T=null,g.child!==null)switch(g.child.tag){case 5:T=g.child.stateNode;break;case 1:T=g.child.stateNode}yI(g,he,T)}break;case 5:var Ce=g.stateNode;if(T===null&&g.flags&4){T=Ce;var Me=g.memoizedProps;switch(g.type){case"button":case"input":case"select":case"textarea":Me.autoFocus&&T.focus();break;case"img":Me.src&&(T.src=Me.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(g.memoizedState===null){var ot=g.alternate;if(ot!==null){var xt=ot.memoizedState;if(xt!==null){var Mt=xt.dehydrated;Mt!==null&&Fa(Mt)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(i(163))}Go||g.flags&512&&Yb(g)}catch(Dt){Ji(g,g.return,Dt)}}if(g===p){on=null;break}if(T=g.sibling,T!==null){T.return=g.return,on=T;break}on=g.return}}function N_(p){for(;on!==null;){var g=on;if(g===p){on=null;break}var T=g.sibling;if(T!==null){T.return=g.return,on=T;break}on=g.return}}function ZI(p){for(;on!==null;){var g=on;try{switch(g.tag){case 0:case 11:case 15:var T=g.return;try{k_(4,g)}catch(Me){Ji(g,T,Me)}break;case 1:var N=g.stateNode;if(typeof N.componentDidMount=="function"){var V=g.return;try{N.componentDidMount()}catch(Me){Ji(g,V,Me)}}var $=g.return;try{Yb(g)}catch(Me){Ji(g,$,Me)}break;case 5:var he=g.return;try{Yb(g)}catch(Me){Ji(g,he,Me)}}}catch(Me){Ji(g,g.return,Me)}if(g===p){on=null;break}var Ce=g.sibling;if(Ce!==null){Ce.return=g.return,on=Ce;break}on=g.return}}var wD=Math.ceil,sv=ae.ReactCurrentDispatcher,ov=ae.ReactCurrentOwner,qc=ae.ReactCurrentBatchConfig,Lr=0,lo=null,as=null,Os=0,bc=0,Nl=Wc(0),ks=0,To=null,tf=0,av=0,cv=0,D_=null,Ea=null,lv=0,Wm=1/0,vu=null,uv=!1,ew=null,Sh=null,zm=!1,Su=null,dv=0,nf=0,tw=null,x_=-1,hv=0;function Co(){return(Lr&6)!==0?Xr():x_!==-1?x_:x_=Xr()}function Yc(p){return(p.mode&1)===0?1:(Lr&2)!==0&&Os!==0?Os&-Os:fD.transition!==null?(hv===0&&(hv=sd()),hv):(p=hr,p!==0||(p=window.event,p=p===void 0?16:Jr(p.type)),p)}function Xc(p,g,T,N){if(50<nf)throw nf=0,tw=null,Error(i(185));lu(p,T,N),((Lr&2)===0||p!==lo)&&(p===lo&&((Lr&2)===0&&(av|=T),ks===4&&Sd(p,Os)),Ho(p,N),T===1&&Lr===0&&(g.mode&1)===0&&(Wm=Xr()+500,kE&&fh()))}function Ho(p,g){var T=p.callbackNode;mc(p,g);var N=cu(p,p===lo?Os:0);if(N===0)T!==null&&rd(T),p.callbackNode=null,p.callbackPriority=0;else if(g=N&-N,p.callbackPriority!==g){if(T!=null&&rd(T),g===1)p.tag===0?pD(rf.bind(null,p)):lI(rf.bind(null,p)),lD(function(){(Lr&6)===0&&fh()}),T=null;else{switch(Mc(N)){case 1:T=Lc;break;case 4:T=Cl;break;case 16:T=Va;break;case 536870912:T=sh;break;default:T=Va}T=U_(T,pv.bind(null,p))}p.callbackPriority=g,p.callbackNode=T}}function pv(p,g){if(x_=-1,hv=0,(Lr&6)!==0)throw Error(i(327));var T=p.callbackNode;if(Gm()&&p.callbackNode!==T)return null;var N=cu(p,p===lo?Os:0);if(N===0)return null;if((N&30)!==0||(N&p.expiredLanes)!==0||g)g=bu(p,N);else{g=N;var V=Lr;Lr|=2;var $=eA();(lo!==p||Os!==g)&&(vu=null,Wm=Xr()+500,bh(p,g));do try{TD();break}catch(Ce){nw(p,Ce)}while(!0);wb(),sv.current=$,Lr=V,as!==null?g=0:(lo=null,Os=0,g=ks)}if(g!==0){if(g===2&&(V=ia(p),V!==0&&(N=V,g=fv(p,V))),g===1)throw T=To,bh(p,0),Sd(p,N),Ho(p,Xr()),T;if(g===6)Sd(p,N);else{if(V=p.current.alternate,(N&30)===0&&!gv(V)&&(g=bu(p,N),g===2&&($=ia(p),$!==0&&(N=$,g=fv(p,$))),g===1))throw T=To,bh(p,0),Sd(p,N),Ho(p,Xr()),T;switch(p.finishedWork=V,p.finishedLanes=N,g){case 0:case 1:throw Error(i(345));case 2:sf(p,Ea,vu);break;case 3:if(Sd(p,N),(N&130023424)===N&&(g=lv+500-Xr(),10<g)){if(cu(p,0)!==0)break;if(V=p.suspendedLanes,(V&N)!==N){Co(),p.pingedLanes|=p.suspendedLanes&V;break}p.timeoutHandle=p_(sf.bind(null,p,Ea,vu),g);break}sf(p,Ea,vu);break;case 4:if(Sd(p,N),(N&4194240)===N)break;for(g=p.eventTimes,V=-1;0<N;){var he=31-bo(N);$=1<<he,he=g[he],he>V&&(V=he),N&=~$}if(N=V,N=Xr()-N,N=(120>N?120:480>N?480:1080>N?1080:1920>N?1920:3e3>N?3e3:4320>N?4320:1960*wD(N/1960))-N,10<N){p.timeoutHandle=p_(sf.bind(null,p,Ea,vu),N);break}sf(p,Ea,vu);break;case 5:sf(p,Ea,vu);break;default:throw Error(i(329))}}}return Ho(p,Xr()),p.callbackNode===T?pv.bind(null,p):null}function fv(p,g){var T=D_;return p.current.memoizedState.isDehydrated&&(bh(p,g).flags|=256),p=bu(p,g),p!==2&&(g=Ea,Ea=T,g!==null&&mv(g)),p}function mv(p){Ea===null?Ea=p:Ea.push.apply(Ea,p)}function gv(p){for(var g=p;;){if(g.flags&16384){var T=g.updateQueue;if(T!==null&&(T=T.stores,T!==null))for(var N=0;N<T.length;N++){var V=T[N],$=V.getSnapshot;V=V.value;try{if(!kl($(),V))return!1}catch{return!1}}}if(T=g.child,g.subtreeFlags&16384&&T!==null)T.return=g,g=T;else{if(g===p)break;for(;g.sibling===null;){if(g.return===null||g.return===p)return!0;g=g.return}g.sibling.return=g.return,g=g.sibling}}return!0}function Sd(p,g){for(g&=~cv,g&=~av,p.suspendedLanes|=g,p.pingedLanes&=~g,p=p.expirationTimes;0<g;){var T=31-bo(g),N=1<<T;p[T]=-1,g&=~N}}function rf(p){if((Lr&6)!==0)throw Error(i(327));Gm();var g=cu(p,0);if((g&1)===0)return Ho(p,Xr()),null;var T=bu(p,g);if(p.tag!==0&&T===2){var N=ia(p);N!==0&&(g=N,T=fv(p,N))}if(T===1)throw T=To,bh(p,0),Sd(p,g),Ho(p,Xr()),T;if(T===6)throw Error(i(345));return p.finishedWork=p.current.alternate,p.finishedLanes=g,sf(p,Ea,vu),Ho(p,Xr()),null}function L_(p,g){var T=Lr;Lr|=1;try{return p(g)}finally{Lr=T,Lr===0&&(Wm=Xr()+500,kE&&fh())}}function bd(p){Su!==null&&Su.tag===0&&(Lr&6)===0&&Gm();var g=Lr;Lr|=1;var T=qc.transition,N=hr;try{if(qc.transition=null,hr=1,p)return p()}finally{hr=N,qc.transition=T,Lr=g,(Lr&6)===0&&fh()}}function M_(){bc=Nl.current,Fi(Nl)}function bh(p,g){p.finishedWork=null,p.finishedLanes=0;var T=p.timeoutHandle;if(T!==-1&&(p.timeoutHandle=-1,cD(T)),as!==null)for(T=as.return;T!==null;){var N=T;switch(g_(N),N.tag){case 1:N=N.type.childContextTypes,N!=null&&AE();break;case 3:Jp(),Fi(Wa),Fi(Bo),Pb();break;case 5:Dm(N);break;case 4:Jp();break;case 13:Fi(Hi);break;case 19:Fi(Hi);break;case 10:Tb(N.type._context);break;case 22:case 23:M_()}T=T.return}if(lo=p,as=p=wd(p.current,null),Os=bc=g,ks=0,To=null,cv=av=tf=0,Ea=D_=null,Yp!==null){for(g=0;g<Yp.length;g++)if(T=Yp[g],N=T.interleaved,N!==null){T.interleaved=null;var V=N.next,$=T.pending;if($!==null){var he=$.next;$.next=V,N.next=he}T.pending=N}Yp=null}return p}function nw(p,g){do{var T=as;try{if(wb(),FE.current=GE,xm){for(var N=Xi.memoizedState;N!==null;){var V=N.queue;V!==null&&(V.pending=null),N=N.next}xm=!1}if(_u=0,Ps=As=Xi=null,T_=!1,C_=0,ov.current=null,T===null||T.return===null){ks=1,To=g,as=null;break}e:{var $=p,he=T.return,Ce=T,Me=g;if(g=Os,Ce.flags|=32768,Me!==null&&typeof Me=="object"&&typeof Me.then=="function"){var ot=Me,xt=Ce,Mt=xt.tag;if((xt.mode&1)===0&&(Mt===0||Mt===11||Mt===15)){var Dt=xt.alternate;Dt?(xt.updateQueue=Dt.updateQueue,xt.memoizedState=Dt.memoizedState,xt.lanes=Dt.lanes):(xt.updateQueue=null,xt.memoizedState=null)}var en=xI(he);if(en!==null){en.flags&=-257,LI(en,he,Ce,$,g),en.mode&1&&DI($,ot,g),g=en,Me=ot;var cn=g.updateQueue;if(cn===null){var ln=new Set;ln.add(Me),g.updateQueue=ln}else cn.add(Me);break e}else{if((g&1)===0){DI($,ot,g),rw();break e}Me=Error(i(426))}}else if(vi&&Ce.mode&1){var cs=xI(he);if(cs!==null){(cs.flags&65536)===0&&(cs.flags|=256),LI(cs,he,Ce,$,g),Sb(Vm(Me,Ce));break e}}$=Me=Vm(Me,Ce),ks!==4&&(ks=2),D_===null?D_=[$]:D_.push($),$=he;do{switch($.tag){case 3:$.flags|=65536,g&=-g,$.lanes|=g;var et=zb($,Me,g);_I($,et);break e;case 1:Ce=Me;var Fe=$.type,rt=$.stateNode;if(($.flags&128)===0&&(typeof Fe.getDerivedStateFromError=="function"||rt!==null&&typeof rt.componentDidCatch=="function"&&(Sh===null||!Sh.has(rt)))){$.flags|=65536,g&=-g,$.lanes|=g;var Ft=vd($,Ce,g);_I($,Ft);break e}}$=$.return}while($!==null)}nA(T)}catch(un){g=un,as===T&&T!==null&&(as=T=T.return);continue}break}while(!0)}function eA(){var p=sv.current;return sv.current=GE,p===null?GE:p}function rw(){(ks===0||ks===3||ks===2)&&(ks=4),lo===null||(tf&268435455)===0&&(av&268435455)===0||Sd(lo,Os)}function bu(p,g){var T=Lr;Lr|=2;var N=eA();(lo!==p||Os!==g)&&(vu=null,bh(p,g));do try{tA();break}catch(V){nw(p,V)}while(!0);if(wb(),Lr=T,sv.current=N,as!==null)throw Error(i(261));return lo=null,Os=0,ks}function tA(){for(;as!==null;)_v(as)}function TD(){for(;as!==null&&!ra();)_v(as)}function _v(p){var g=vv(p.alternate,p,bc);p.memoizedProps=p.pendingProps,g===null?nA(p):as=g,ov.current=null}function nA(p){var g=p;do{var T=g.alternate;if(p=g.return,(g.flags&32768)===0){if(T=tv(T,g,bc),T!==null){as=T;return}}else{if(T=bD(T,g),T!==null){T.flags&=32767,as=T;return}if(p!==null)p.flags|=32768,p.subtreeFlags=0,p.deletions=null;else{ks=6,as=null;return}}if(g=g.sibling,g!==null){as=g;return}as=g=p}while(g!==null);ks===0&&(ks=5)}function sf(p,g,T){var N=hr,V=qc.transition;try{qc.transition=null,hr=1,CD(p,g,T,N)}finally{qc.transition=V,hr=N}return null}function CD(p,g,T,N){do Gm();while(Su!==null);if((Lr&6)!==0)throw Error(i(327));T=p.finishedWork;var V=p.finishedLanes;if(T===null)return null;if(p.finishedWork=null,p.finishedLanes=0,T===p.current)throw Error(i(177));p.callbackNode=null,p.callbackPriority=0;var $=T.lanes|T.childLanes;if(ni(p,$),p===lo&&(as=lo=null,Os=0),(T.subtreeFlags&2064)===0&&(T.flags&2064)===0||zm||(zm=!0,U_(Va,function(){return Gm(),null})),$=(T.flags&15990)!==0,(T.subtreeFlags&15990)!==0||$){$=qc.transition,qc.transition=null;var he=hr;hr=1;var Ce=Lr;Lr|=4,ov.current=null,qb(p,T),Qb(T,p),ub(h_),Se=!!IE,h_=IE=null,p.current=T,Bm(T),ih(),Lr=Ce,hr=he,qc.transition=$}else p.current=T;if(zm&&(zm=!1,Su=p,dv=V),$=p.pendingLanes,$===0&&(Sh=null),um(T.stateNode),Ho(p,Xr()),g!==null)for(N=p.onRecoverableError,T=0;T<g.length;T++)V=g[T],N(V.value,{componentStack:V.stack,digest:V.digest});if(uv)throw uv=!1,p=ew,ew=null,p;return(dv&1)!==0&&p.tag!==0&&Gm(),$=p.pendingLanes,($&1)!==0?p===tw?nf++:(nf=0,tw=p):nf=0,fh(),null}function Gm(){if(Su!==null){var p=Mc(dv),g=qc.transition,T=hr;try{if(qc.transition=null,hr=16>p?16:p,Su===null)var N=!1;else{if(p=Su,Su=null,dv=0,(Lr&6)!==0)throw Error(i(331));var V=Lr;for(Lr|=4,on=p.current;on!==null;){var $=on,he=$.child;if((on.flags&16)!==0){var Ce=$.deletions;if(Ce!==null){for(var Me=0;Me<Ce.length;Me++){var ot=Ce[Me];for(on=ot;on!==null;){var xt=on;switch(xt.tag){case 0:case 11:case 15:O_(8,xt,$)}var Mt=xt.child;if(Mt!==null)Mt.return=xt,on=Mt;else for(;on!==null;){xt=on;var Dt=xt.sibling,en=xt.return;if(YI(xt),xt===ot){on=null;break}if(Dt!==null){Dt.return=en,on=Dt;break}on=en}}}var cn=$.alternate;if(cn!==null){var ln=cn.child;if(ln!==null){cn.child=null;do{var cs=ln.sibling;ln.sibling=null,ln=cs}while(ln!==null)}}on=$}}if(($.subtreeFlags&2064)!==0&&he!==null)he.return=$,on=he;else e:for(;on!==null;){if($=on,($.flags&2048)!==0)switch($.tag){case 0:case 11:case 15:O_(9,$,$.return)}var et=$.sibling;if(et!==null){et.return=$.return,on=et;break e}on=$.return}}var Fe=p.current;for(on=Fe;on!==null;){he=on;var rt=he.child;if((he.subtreeFlags&2064)!==0&&rt!==null)rt.return=he,on=rt;else e:for(he=Fe;on!==null;){if(Ce=on,(Ce.flags&2048)!==0)try{switch(Ce.tag){case 0:case 11:case 15:k_(9,Ce)}}catch(un){Ji(Ce,Ce.return,un)}if(Ce===he){on=null;break e}var Ft=Ce.sibling;if(Ft!==null){Ft.return=Ce.return,on=Ft;break e}on=Ce.return}}if(Lr=V,fh(),Fo&&typeof Fo.onPostCommitFiberRoot=="function")try{Fo.onPostCommitFiberRoot(ou,p)}catch{}N=!0}return N}finally{hr=T,qc.transition=g}}return!1}function yv(p,g,T){g=Vm(T,g),g=zb(p,g,1),p=_h(p,g,1),g=Co(),p!==null&&(lu(p,1,g),Ho(p,g))}function Ji(p,g,T){if(p.tag===3)yv(p,p,T);else for(;g!==null;){if(g.tag===3){yv(g,p,T);break}else if(g.tag===1){var N=g.stateNode;if(typeof g.type.getDerivedStateFromError=="function"||typeof N.componentDidCatch=="function"&&(Sh===null||!Sh.has(N))){p=Vm(T,p),p=vd(g,p,1),g=_h(g,p,1),p=Co(),g!==null&&(lu(g,1,p),Ho(g,p));break}}g=g.return}}function rA(p,g,T){var N=p.pingCache;N!==null&&N.delete(g),g=Co(),p.pingedLanes|=p.suspendedLanes&T,lo===p&&(Os&T)===T&&(ks===4||ks===3&&(Os&130023424)===Os&&500>Xr()-lv?bh(p,0):cv|=T),Ho(p,g)}function iw(p,g){g===0&&((p.mode&1)===0?g=1:(g=br,br<<=1,(br&130023424)===0&&(br=4194304)));var T=Co();p=_d(p,g),p!==null&&(lu(p,g,T),Ho(p,T))}function Ev(p){var g=p.memoizedState,T=0;g!==null&&(T=g.retryLane),iw(p,T)}function iA(p,g){var T=0;switch(p.tag){case 13:var N=p.stateNode,V=p.memoizedState;V!==null&&(T=V.retryLane);break;case 19:N=p.stateNode;break;default:throw Error(i(314))}N!==null&&N.delete(g),iw(p,T)}var vv;vv=function(p,g,T){if(p!==null)if(p.memoizedProps!==g.pendingProps||Wa.current)Ka=!0;else{if((p.lanes&T)===0&&(g.flags&128)===0)return Ka=!1,GI(p,g,T);Ka=(p.flags&131072)!==0}else Ka=!1,vi&&(g.flags&1048576)!==0&&DE(g,NE,g.index);switch(g.lanes=0,g.tag){case 2:var N=g.type;ZE(p,g),p=g.pendingProps;var V=Kp(g,Bo.current);gd(g,T),V=Lm(null,g,N,p,V,T);var $=Nb();return g.flags|=1,typeof V=="object"&&V!==null&&typeof V.render=="function"&&V.$$typeof===void 0?(g.tag=1,g.memoizedState=null,g.updateQueue=null,za(N)?($=!0,OE(g)):$=!1,g.memoizedState=V.state!==null&&V.state!==void 0?V.state:null,v_(g),V.updater=$E,g.stateNode=V,V._reactInternals=g,Fb(g,N,p,T),g=qE(null,g,N,!0,$,T)):(g.tag=0,vi&&$&&xE(g),_a(null,g,V,T),g=g.child),g;case 16:N=g.elementType;e:{switch(ZE(p,g),p=g.pendingProps,V=N._init,N=V(N._payload),g.type=N,V=g.tag=of(N),p=Sc(N,p),V){case 0:g=Gb(null,g,N,p,T);break e;case 1:g=FI(null,g,N,p,T);break e;case 11:g=KE(null,g,N,p,T);break e;case 14:g=MI(null,g,N,Sc(N.type,p),T);break e}throw Error(i(306,N,""))}return g;case 0:return N=g.type,V=g.pendingProps,V=g.elementType===N?V:Sc(N,V),Gb(p,g,N,V,T);case 1:return N=g.type,V=g.pendingProps,V=g.elementType===N?V:Sc(N,V),FI(p,g,N,V,T);case 3:e:{if(Hb(g),p===null)throw Error(i(387));N=g.pendingProps,$=g.memoizedState,V=$.element,gI(p,g),jE(g,N,null,T);var he=g.memoizedState;if(N=he.element,$.isDehydrated)if($={element:N,isDehydrated:!1,cache:he.cache,pendingSuspenseBoundaries:he.pendingSuspenseBoundaries,transitions:he.transitions},g.updateQueue.baseState=$,g.memoizedState=$,g.flags&256){V=Vm(Error(i(423)),g),g=BI(p,g,N,T,V);break e}else if(N!==V){V=Vm(Error(i(424)),g),g=BI(p,g,N,T,V);break e}else for(Ha=dh(g.stateNode.containerInfo.firstChild),Ga=g,vi=!0,ma=null,T=fI(g,null,N,T),g.child=T;T;)T.flags=T.flags&-3|4096,T=T.sibling;else{if(Pm(),N===V){g=yu(p,g,T);break e}_a(p,g,N,T)}g=g.child}return g;case 5:return EI(g),p===null&&vb(g),N=g.type,V=g.pendingProps,$=p!==null?p.memoizedProps:null,he=V.children,gb(N,V)?he=null:$!==null&&gb(N,$)&&(g.flags|=32),jI(p,g),_a(p,g,he,T),g.child;case 6:return p===null&&vb(g),null;case 13:return YE(p,g,T);case 4:return Ib(g,g.stateNode.containerInfo),N=g.pendingProps,p===null?g.child=Om(g,null,N,T):_a(p,g,N,T),g.child;case 11:return N=g.type,V=g.pendingProps,V=g.elementType===N?V:Sc(N,V),KE(p,g,N,V,T);case 7:return _a(p,g,g.pendingProps,T),g.child;case 8:return _a(p,g,g.pendingProps.children,T),g.child;case 12:return _a(p,g,g.pendingProps.children,T),g.child;case 10:e:{if(N=g.type._context,V=g.pendingProps,$=g.memoizedProps,he=V.value,ki(UE,N._currentValue),N._currentValue=he,$!==null)if(kl($.value,he)){if($.children===V.children&&!Wa.current){g=yu(p,g,T);break e}}else for($=g.child,$!==null&&($.return=g);$!==null;){var Ce=$.dependencies;if(Ce!==null){he=$.child;for(var Me=Ce.firstContext;Me!==null;){if(Me.context===N){if($.tag===1){Me=mu(-1,T&-T),Me.tag=2;var ot=$.updateQueue;if(ot!==null){ot=ot.shared;var xt=ot.pending;xt===null?Me.next=Me:(Me.next=xt.next,xt.next=Me),ot.pending=Me}}$.lanes|=T,Me=$.alternate,Me!==null&&(Me.lanes|=T),Cb($.return,T,g),Ce.lanes|=T;break}Me=Me.next}}else if($.tag===10)he=$.type===g.type?null:$.child;else if($.tag===18){if(he=$.return,he===null)throw Error(i(341));he.lanes|=T,Ce=he.alternate,Ce!==null&&(Ce.lanes|=T),Cb(he,T,g),he=$.sibling}else he=$.child;if(he!==null)he.return=$;else for(he=$;he!==null;){if(he===g){he=null;break}if($=he.sibling,$!==null){$.return=he.return,he=$;break}he=he.return}$=he}_a(p,g,V.children,T),g=g.child}return g;case 9:return V=g.type,N=g.pendingProps.children,gd(g,T),V=Hc(V),N=N(V),g.flags|=1,_a(p,g,N,T),g.child;case 14:return N=g.type,V=Sc(N,g.pendingProps),V=Sc(N.type,V),MI(p,g,N,V,T);case 15:return UI(p,g,g.type,g.pendingProps,T);case 17:return N=g.type,V=g.pendingProps,V=g.elementType===N?V:Sc(N,V),ZE(p,g),g.tag=1,za(N)?(p=!0,OE(g)):p=!1,gd(g,T),kI(g,N,V),Fb(g,N,V,T),qE(null,g,N,!0,p,T);case 19:return QE(p,g,T);case 22:return VI(p,g,T)}throw Error(i(156,g.tag))};function U_(p,g){return rh(p,g)}function Sv(p,g,T,N){this.tag=p,this.key=T,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=g,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=N,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function wc(p,g,T,N){return new Sv(p,g,T,N)}function wh(p){return p=p.prototype,!(!p||!p.isReactComponent)}function of(p){if(typeof p=="function")return wh(p)?1:0;if(p!=null){if(p=p.$$typeof,p===de)return 11;if(p===Ve)return 14}return 2}function wd(p,g){var T=p.alternate;return T===null?(T=wc(p.tag,g,p.key,p.mode),T.elementType=p.elementType,T.type=p.type,T.stateNode=p.stateNode,T.alternate=p,p.alternate=T):(T.pendingProps=g,T.type=p.type,T.flags=0,T.subtreeFlags=0,T.deletions=null),T.flags=p.flags&14680064,T.childLanes=p.childLanes,T.lanes=p.lanes,T.child=p.child,T.memoizedProps=p.memoizedProps,T.memoizedState=p.memoizedState,T.updateQueue=p.updateQueue,g=p.dependencies,T.dependencies=g===null?null:{lanes:g.lanes,firstContext:g.firstContext},T.sibling=p.sibling,T.index=p.index,T.ref=p.ref,T}function bv(p,g,T,N,V,$){var he=2;if(N=p,typeof p=="function")wh(p)&&(he=1);else if(typeof p=="string")he=5;else e:switch(p){case X:return af(T.children,V,$,g);case J:he=8,V|=8;break;case Y:return p=wc(12,T,g,V|2),p.elementType=Y,p.lanes=$,p;case ue:return p=wc(13,T,g,V),p.elementType=ue,p.lanes=$,p;case Oe:return p=wc(19,T,g,V),p.elementType=Oe,p.lanes=$,p;case Re:return Th(T,V,$,g);default:if(typeof p=="object"&&p!==null)switch(p.$$typeof){case ie:he=10;break e;case le:he=9;break e;case de:he=11;break e;case Ve:he=14;break e;case xe:he=16,N=null;break e}throw Error(i(130,p==null?p:typeof p,""))}return g=wc(he,T,g,V),g.elementType=p,g.type=N,g.lanes=$,g}function af(p,g,T,N){return p=wc(7,p,N,g),p.lanes=T,p}function Th(p,g,T,N){return p=wc(22,p,N,g),p.elementType=Re,p.lanes=T,p.stateNode={isHidden:!1},p}function sw(p,g,T){return p=wc(6,p,null,g),p.lanes=T,p}function ow(p,g,T){return g=wc(4,p.children!==null?p.children:[],p.key,g),g.lanes=T,g.stateNode={containerInfo:p.containerInfo,pendingChildren:null,implementation:p.implementation},g}function RD(p,g,T,N,V){this.tag=g,this.containerInfo=p,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Il(0),this.expirationTimes=Il(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Il(0),this.identifierPrefix=N,this.onRecoverableError=V,this.mutableSourceEagerHydrationData=null}function aw(p,g,T,N,V,$,he,Ce,Me){return p=new RD(p,g,T,Ce,Me),g===1?(g=1,$===!0&&(g|=8)):g=0,$=wc(3,null,null,g),p.current=$,$.stateNode=p,$.memoizedState={element:N,isDehydrated:T,cache:null,transitions:null,pendingSuspenseBoundaries:null},v_($),p}function ID(p,g,T){var N=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:pe,key:N==null?null:""+N,children:p,containerInfo:g,implementation:T}}function sA(p){if(!p)return ph;p=p._reactInternals;e:{if(Ai(p)!==p||p.tag!==1)throw Error(i(170));var g=p;do{switch(g.tag){case 3:g=g.stateNode.context;break e;case 1:if(za(g.type)){g=g.stateNode.__reactInternalMemoizedMergedChildContext;break e}}g=g.return}while(g!==null);throw Error(i(171))}if(p.tag===1){var T=p.type;if(za(T))return PE(p,T,g)}return g}function wv(p,g,T,N,V,$,he,Ce,Me){return p=aw(T,N,!0,p,V,$,he,Ce,Me),p.context=sA(null),T=p.current,N=Co(),V=Yc(T),$=mu(N,V),$.callback=g??null,_h(T,$,V),p.current.lanes=V,lu(p,V,N),Ho(p,N),p}function V_(p,g,T,N){var V=g.current,$=Co(),he=Yc(V);return T=sA(T),g.context===null?g.context=T:g.pendingContext=T,g=mu($,he),g.payload={element:p},N=N===void 0?null:N,N!==null&&(g.callback=N),p=_h(V,g,he),p!==null&&(Xc(p,V,he,$),S_(p,V,he)),he}function Tv(p){if(p=p.current,!p.child)return null;switch(p.child.tag){case 5:return p.child.stateNode;default:return p.child.stateNode}}function cw(p,g){if(p=p.memoizedState,p!==null&&p.dehydrated!==null){var T=p.retryLane;p.retryLane=T!==0&&T<g?T:g}}function lw(p,g){cw(p,g),(p=p.alternate)&&cw(p,g)}function j_(){return null}var Dl=typeof reportError=="function"?reportError:function(p){console.error(p)};function Cv(p){this._internalRoot=p}Rv.prototype.render=Cv.prototype.render=function(p){var g=this._internalRoot;if(g===null)throw Error(i(409));V_(p,g,null,null)},Rv.prototype.unmount=Cv.prototype.unmount=function(){var p=this._internalRoot;if(p!==null){this._internalRoot=null;var g=p.containerInfo;bd(function(){V_(null,p,null,null)}),g[Bc]=null}};function Rv(p){this._internalRoot=p}Rv.prototype.unstable_scheduleHydration=function(p){if(p){var g=xp();p={blockedOn:null,target:p,priority:g};for(var T=0;T<la.length&&g!==0&&g<la[T].priority;T++);la.splice(T,0,p),T===0&&Mp(p)}};function uw(p){return!(!p||p.nodeType!==1&&p.nodeType!==9&&p.nodeType!==11)}function Hm(p){return!(!p||p.nodeType!==1&&p.nodeType!==9&&p.nodeType!==11&&(p.nodeType!==8||p.nodeValue!==" react-mount-point-unstable "))}function dw(){}function AD(p,g,T,N,V){if(V){if(typeof N=="function"){var $=N;N=function(){var ot=Tv(he);$.call(ot)}}var he=wv(g,N,p,0,null,!1,!1,"",dw);return p._reactRootContainer=he,p[Bc]=he.current,Wp(p.nodeType===8?p.parentNode:p),bd(),he}for(;V=p.lastChild;)p.removeChild(V);if(typeof N=="function"){var Ce=N;N=function(){var ot=Tv(Me);Ce.call(ot)}}var Me=aw(p,0,!1,null,null,!1,!1,"",dw);return p._reactRootContainer=Me,p[Bc]=Me.current,Wp(p.nodeType===8?p.parentNode:p),bd(function(){V_(g,Me,T,N)}),Me}function cf(p,g,T,N,V){var $=T._reactRootContainer;if($){var he=$;if(typeof V=="function"){var Ce=V;V=function(){var Me=Tv(he);Ce.call(Me)}}V_(g,he,p,V)}else he=AD(T,g,p,V,N);return Tv(he)}dm=function(p){switch(p.tag){case 3:var g=p.stateNode;if(g.current.memoizedState.isDehydrated){var T=au(g.pendingLanes);T!==0&&(gc(g,T|1),Ho(g,Xr()),(Lr&6)===0&&(Wm=Xr()+500,fh()))}break;case 13:bd(function(){var N=_d(p,1);if(N!==null){var V=Co();Xc(N,p,1,V)}}),lw(p,1)}},uu=function(p){if(p.tag===13){var g=_d(p,134217728);if(g!==null){var T=Co();Xc(g,p,134217728,T)}lw(p,134217728)}},ch=function(p){if(p.tag===13){var g=Yc(p),T=_d(p,g);if(T!==null){var N=Co();Xc(T,p,g,N)}lw(p,g)}},xp=function(){return hr},hm=function(p,g){var T=hr;try{return hr=p,g()}finally{hr=T}},xc=function(p,g,T){switch(g){case"input":if($t(p,T),g=T.name,T.type==="radio"&&g!=null){for(T=p;T.parentNode;)T=T.parentNode;for(T=T.querySelectorAll("input[name="+JSON.stringify(""+g)+'][type="radio"]'),g=0;g<T.length;g++){var N=T[g];if(N!==p&&N.form===p.form){var V=Rm(N);if(!V)throw Error(i(90));He(N),$t(N,V)}}}break;case"textarea":Kt(p,T);break;case"select":g=T.value,g!=null&&gt(p,!!T.multiple,g,!1)}},wl=L_,Ua=bd;var Ch={usingClientEntryPoint:!1,Events:[Cm,Hp,Rm,Ma,hc,L_]},Td={findFiberByHostInstance:Gp,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},PD={bundleType:Td.bundleType,version:Td.version,rendererPackageName:Td.rendererPackageName,rendererConfig:Td.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:ae.ReactCurrentDispatcher,findHostInstanceByFiber:function(p){return p=nh(p),p===null?null:p.stateNode},findFiberByHostInstance:Td.findFiberByHostInstance||j_,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Iv=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Iv.isDisabled&&Iv.supportsFiber)try{ou=Iv.inject(PD),Fo=Iv}catch{}}return ul.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Ch,ul.createPortal=function(p,g){var T=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!uw(g))throw Error(i(200));return ID(p,g,null,T)},ul.createRoot=function(p,g){if(!uw(p))throw Error(i(299));var T=!1,N="",V=Dl;return g!=null&&(g.unstable_strictMode===!0&&(T=!0),g.identifierPrefix!==void 0&&(N=g.identifierPrefix),g.onRecoverableError!==void 0&&(V=g.onRecoverableError)),g=aw(p,1,!1,null,null,T,!1,N,V),p[Bc]=g.current,Wp(p.nodeType===8?p.parentNode:p),new Cv(g)},ul.findDOMNode=function(p){if(p==null)return null;if(p.nodeType===1)return p;var g=p._reactInternals;if(g===void 0)throw typeof p.render=="function"?Error(i(188)):(p=Object.keys(p).join(","),Error(i(268,p)));return p=nh(g),p=p===null?null:p.stateNode,p},ul.flushSync=function(p){return bd(p)},ul.hydrate=function(p,g,T){if(!Hm(g))throw Error(i(200));return cf(null,p,g,!0,T)},ul.hydrateRoot=function(p,g,T){if(!uw(p))throw Error(i(405));var N=T!=null&&T.hydratedSources||null,V=!1,$="",he=Dl;if(T!=null&&(T.unstable_strictMode===!0&&(V=!0),T.identifierPrefix!==void 0&&($=T.identifierPrefix),T.onRecoverableError!==void 0&&(he=T.onRecoverableError)),g=wv(g,null,p,1,T??null,V,!1,$,he),p[Bc]=g.current,Wp(p),N)for(p=0;p<N.length;p++)T=N[p],V=T._getVersion,V=V(T._source),g.mutableSourceEagerHydrationData==null?g.mutableSourceEagerHydrationData=[T,V]:g.mutableSourceEagerHydrationData.push(T,V);return new Rv(g)},ul.render=function(p,g,T){if(!Hm(g))throw Error(i(200));return cf(null,p,g,!1,T)},ul.unmountComponentAtNode=function(p){if(!Hm(p))throw Error(i(40));return p._reactRootContainer?(bd(function(){cf(null,null,p,!1,function(){p._reactRootContainer=null,p[Bc]=null})}),!0):!1},ul.unstable_batchedUpdates=L_,ul.unstable_renderSubtreeIntoContainer=function(p,g,T,N){if(!Hm(T))throw Error(i(200));if(p==null||p._reactInternals===void 0)throw Error(i(38));return cf(p,g,T,!1,N)},ul.version="18.3.1-next-f1338f8080-20240426",ul}var MK;function TZ(){if(MK)return bM.exports;MK=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(e){console.error(e)}}return n(),bM.exports=vEe(),bM.exports}var UK;function SEe(){if(UK)return TO;UK=1;var n=TZ();return TO.createRoot=n.createRoot,TO.hydrateRoot=n.hydrateRoot,TO}var bEe=SEe();const P1=Yg(bEe);function wEe(n,e,i,o){return n.addEventListener(e,i,o),()=>{n.removeEventListener(e,i,o)}}function O1(n){return n!=null&&typeof n=="object"&&"nodeType"in n&&n.nodeType===Node.ELEMENT_NODE}function TEe(){return!!(globalThis!=null&&globalThis.document)}function CZ(n){return n.parentElement&&CZ(n.parentElement)?!0:n.hidden}function CEe(n){const e=n.getAttribute("contenteditable");return e!=="false"&&e!=null}function REe(n){return!!n.getAttribute("disabled")||!!n.getAttribute("aria-disabled")}function IEe(n){var e;return((e=RZ(n))==null?void 0:e.defaultView)??window}function RZ(n){return O1(n)?n.ownerDocument:document}function AEe(n){return n.view??window}function PEe(n){return RZ(n).activeElement}function OEe(n){const e=AEe(n);return typeof e.PointerEvent<"u"&&n instanceof e.PointerEvent?n.pointerType==="mouse":n instanceof e.MouseEvent}function IZ(n){return!!n.touches}function kEe(n){return IZ(n)&&n.touches.length>1}function NEe(n,e="page"){const i=n.touches[0]||n.changedTouches[0];return{x:i[`${e}X`],y:i[`${e}Y`]}}function DEe(n,e="page"){return{x:n[`${e}X`],y:n[`${e}Y`]}}function AZ(n,e="page"){return IZ(n)?NEe(n,e):DEe(n,e)}function xEe(n){return e=>{const i=OEe(e);(!i||i&&e.button===0)&&n(e)}}function LEe(n,e=!1){function i(l){n(l,{point:AZ(l)})}return e?xEe(i):i}function ik(n,e,i,o){return wEe(n,e,LEe(i,e==="pointerdown"),o)}function MEe(n,...e){if(n==null)throw new TypeError("Cannot convert undefined or null to object");const i={...n};for(const o of e)if(o!=null)for(const l in o)Object.prototype.hasOwnProperty.call(o,l)&&(l in i&&delete i[l],i[l]=o[l]);return i}const nr=n=>n?"":void 0,zf=n=>n?!0:void 0;function UEe(n){return Array.isArray(n)}function Ku(n){const e=typeof n;return n!=null&&(e==="object"||e==="function")&&!UEe(n)}function VEe(n){const e=n==null?0:n.length;return e?n[e-1]:void 0}function jEe(n){const e=parseFloat(n.toString()),i=n.toString().replace(String(e),"");return{unitless:!i,value:e,unit:i}}function XU(n){if(n==null)return n;const{unitless:e}=jEe(n);return e||typeof n=="number"?`${n}px`:n}const PZ=(n,e)=>parseInt(n[1],10)>parseInt(e[1],10)?1:-1,Uj=n=>Object.fromEntries(Object.entries(n).sort(PZ));function VK(n){const e=Uj(n);return Object.assign(Object.values(e),e)}function FEe(n){const e=Object.keys(Uj(n));return new Set(e)}function jK(n){if(!n)return n;n=XU(n)??n;const e=-.02;return typeof n=="number"?`${n+e}`:n.replace(/(\d+\.?\d*)/u,i=>`${parseFloat(i)+e}`)}function HT(n,e){const i=["@media screen"];return n&&i.push("and",`(min-width: ${XU(n)})`),e&&i.push("and",`(max-width: ${XU(e)})`),i.join(" ")}function BEe(n){if(!n)return null;n.base=n.base??"0px";const e=VK(n),i=Object.entries(n).sort(PZ).map(([u,f],_,E)=>{let[,b]=E[_+1]??[];return b=parseFloat(b)>0?jK(b):void 0,{_minW:jK(f),breakpoint:u,minW:f,maxW:b,maxWQuery:HT(null,b),minWQuery:HT(f),minMaxQuery:HT(f,b)}}),o=FEe(n),l=Array.from(o.values());return{keys:o,normalized:e,isResponsive(u){const f=Object.keys(u);return f.length>0&&f.every(_=>o.has(_))},asObject:Uj(n),asArray:VK(n),details:i,get(u){return i.find(f=>f.breakpoint===u)},media:[null,...e.map(u=>HT(u)).slice(1)],toArrayValue(u){if(!Ku(u))throw new Error("toArrayValue: value must be an object");const f=l.map(_=>u[_]??null);for(;VEe(f)===null;)f.pop();return f},toObjectValue(u){if(!Array.isArray(u))throw new Error("toObjectValue: value must be an array");return u.reduce((f,_,E)=>{const b=l[E];return b!=null&&_!=null&&(f[b]=_),f},{})}}}function OZ(...n){return function(...i){n.forEach(o=>o==null?void 0:o(...i))}}function Nn(...n){return function(i){n.some(o=>(o==null||o(i),i==null?void 0:i.defaultPrevented))}}function k1(n){return k.Children.toArray(n).filter(e=>k.isValidElement(e))}function N1(n){const e=Object.assign({},n);for(let i in e)e[i]===void 0&&delete e[i];return e}function WEe(n,e){return`${n} returned \`undefined\`. Seems you forgot to wrap component within ${e}`}function Ii(n={}){const{name:e,strict:i=!0,hookName:o="useContext",providerName:l="Provider",errorMessage:u,defaultValue:f}=n,_=k.createContext(f);_.displayName=e;function E(){var C;const b=k.useContext(_);if(!b&&i){const I=new Error(u??WEe(o,l));throw I.name="ContextError",(C=Error.captureStackTrace)==null||C.call(Error,I,E),I}return b}return[_.Provider,E,_]}const fn=(...n)=>n.filter(Boolean).join(" "),kZ=n=>n.hasAttribute("tabindex"),zEe=n=>kZ(n)&&n.tabIndex===-1;function Fk(n){if(!O1(n)||CZ(n)||REe(n))return!1;const{localName:e}=n;if(["input","select","textarea","button"].indexOf(e)>=0)return!0;const o={a:()=>n.hasAttribute("href"),audio:()=>n.hasAttribute("controls"),video:()=>n.hasAttribute("controls")};return e in o?o[e]():CEe(n)?!0:kZ(n)}function GEe(n){return n?O1(n)&&Fk(n)&&!zEe(n):!1}const HEe=["input:not(:disabled):not([disabled])","select:not(:disabled):not([disabled])","textarea:not(:disabled):not([disabled])","embed","iframe","object","a[href]","area[href]","button:not(:disabled):not([disabled])","[tabindex]","audio[controls]","video[controls]","*[tabindex]:not([aria-disabled])","*[contenteditable]"],$Ee=HEe.join(),KEe=n=>n.offsetWidth>0&&n.offsetHeight>0;function NZ(n){const e=Array.from(n.querySelectorAll($Ee));return e.unshift(n),e.filter(i=>Fk(i)&&KEe(i))}function qEe(n,e,i,o){const l=typeof e=="string"?e.split("."):[e];for(o=0;o<l.length&&n;o+=1)n=n[l[o]];return n===void 0?i:n}const YEe=n=>{const e=new WeakMap;return(o,l,u,f)=>{if(typeof o>"u")return n(o,l,u);e.has(o)||e.set(o,new Map);const _=e.get(o);if(_.has(l))return _.get(l);const E=n(o,l,u,f);return _.set(l,E),E}},DZ=YEe(qEe),XEe=n=>n.default||n;function Vj(n){const{wasSelected:e,enabled:i,isSelected:o,mode:l="unmount"}=n;return!!(!i||o||l==="keepMounted"&&e)}function JEe(n){const e=parseFloat(n);return typeof e!="number"||Number.isNaN(e)?0:e}function jj(n,e){let i=JEe(n);const o=10**(e??10);return i=Math.round(i*o)/o,e?i.toFixed(e):i.toString()}function JU(n){if(!Number.isFinite(n))return 0;let e=1,i=0;for(;Math.round(n*e)/e!==n;)e*=10,i+=1;return i}function FK(n,e,i){return(n-e)*100/(i-e)}function QEe(n,e,i){return(i-e)*n+e}function BK(n,e,i){const o=Math.round((n-e)/i)*i+e,l=JU(i);return jj(o,l)}function sk(n,e,i){return n==null?n:(i<e&&console.warn("clamp: max cannot be less than min"),Math.min(Math.max(n,e),i))}function q0(n,e=[]){const i=Object.assign({},n);for(const o of e)o in i&&delete i[o];return i}function xZ(n,e){const i={};for(const o of e)o in n&&(i[o]=n[o]);return i}function D1(n,e){return Array.isArray(n)?n.map(i=>i===null?null:e(i)):Ku(n)?Object.keys(n).reduce((i,o)=>(i[o]=e(n[o]),i),{}):n!=null?e(n):null}const ZEe=n=>typeof n=="function";function gl(n,...e){return ZEe(n)?n(...e):n}function eve(n){const e=n.ownerDocument.defaultView||window,{overflow:i,overflowX:o,overflowY:l}=e.getComputedStyle(n);return/auto|scroll|overlay|hidden/.test(i+l+o)}function tve(n){return n.localName==="html"?n:n.assignedSlot||n.parentElement||n.ownerDocument.documentElement}function LZ(n){return["html","body","#document"].includes(n.localName)?n.ownerDocument.body:O1(n)&&eve(n)?n:LZ(tve(n))}function nve(n,e){const i={},o={};for(const[l,u]of Object.entries(n))e.includes(l)?i[l]=u:o[l]=u;return[i,o]}function rve(n,...e){const i=Object.getOwnPropertyDescriptors(n),o=Object.keys(i),l=f=>{const _={};for(let E=0;E<f.length;E++){const b=f[E];i[b]&&(Object.defineProperty(_,b,i[b]),delete i[b])}return _},u=f=>l(Array.isArray(f)?f:o.filter(f));return e.map(u).concat(l(o))}function WK(n,e,i={}){const{stop:o,getKey:l}=i;function u(f,_=[]){if(Ku(f)||Array.isArray(f)){const E={};for(const[b,C]of Object.entries(f)){const I=(l==null?void 0:l(b))??b,P=[..._,I];if(o!=null&&o(f,P))return e(f,_);E[I]=u(C,P)}return E}return e(f,_)}return u(n)}var $T={exports:{}};$T.exports;var zK;function ive(){return zK||(zK=1,function(n,e){var i=200,o="__lodash_hash_undefined__",l=800,u=16,f=9007199254740991,_="[object Arguments]",E="[object Array]",b="[object AsyncFunction]",C="[object Boolean]",I="[object Date]",P="[object Error]",L="[object Function]",M="[object GeneratorFunction]",F="[object Map]",B="[object Number]",Z="[object Null]",K="[object Object]",re="[object Proxy]",ae="[object RegExp]",ne="[object Set]",pe="[object String]",X="[object Undefined]",J="[object WeakMap]",Y="[object ArrayBuffer]",ie="[object DataView]",le="[object Float32Array]",de="[object Float64Array]",ue="[object Int8Array]",Oe="[object Int16Array]",Ve="[object Int32Array]",xe="[object Uint8Array]",Re="[object Uint8ClampedArray]",ve="[object Uint16Array]",be="[object Uint32Array]",We=/[\\^$.*+?()[\]{}|]/g,Pe=/^\[object .+?Constructor\]$/,Te=/^(?:0|[1-9]\d*)$/,ke={};ke[le]=ke[de]=ke[ue]=ke[Oe]=ke[Ve]=ke[xe]=ke[Re]=ke[ve]=ke[be]=!0,ke[_]=ke[E]=ke[Y]=ke[C]=ke[ie]=ke[I]=ke[P]=ke[L]=ke[F]=ke[B]=ke[K]=ke[ae]=ke[ne]=ke[pe]=ke[J]=!1;var Ue=typeof ky=="object"&&ky&&ky.Object===Object&&ky,Be=typeof self=="object"&&self&&self.Object===Object&&self,qe=Ue||Be||Function("return this")(),$e=e&&!e.nodeType&&e,st=$e&&!0&&n&&!n.nodeType&&n,Je=st&&st.exports===$e,Rt=Je&&Ue.process,kt=function(){try{var Se=st&&st.require&&st.require("util").types;return Se||Rt&&Rt.binding&&Rt.binding("util")}catch{}}(),He=kt&&kt.isTypedArray;function ut(Se,De,it){switch(it.length){case 0:return Se.call(De);case 1:return Se.call(De,it[0]);case 2:return Se.call(De,it[0],it[1]);case 3:return Se.call(De,it[0],it[1],it[2])}return Se.apply(De,it)}function mt(Se,De){for(var it=-1,nn=Array(Se);++it<Se;)nn[it]=De(it);return nn}function Lt(Se){return function(De){return Se(De)}}function Xt(Se,De){return Se==null?void 0:Se[De]}function $t(Se,De){return function(it){return Se(De(it))}}var we=Array.prototype,je=Function.prototype,Ke=Object.prototype,gt=qe["__core-js_shared__"],Et=je.toString,Tt=Ke.hasOwnProperty,Kt=function(){var Se=/[^.]+$/.exec(gt&&gt.keys&&gt.keys.IE_PROTO||"");return Se?"Symbol(src)_1."+Se:""}(),gn=Ke.toString,Sn=Et.call(Object),sn=RegExp("^"+Et.call(Tt).replace(We,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),wt=Je?qe.Buffer:void 0,ir=qe.Symbol,Vt=qe.Uint8Array;wt&&wt.allocUnsafe;var zt=$t(Object.getPrototypeOf,Object),_n=Object.create,Ui=Ke.propertyIsEnumerable,Ts=we.splice,ui=ir?ir.toStringTag:void 0,na=function(){try{var Se=mc(Object,"defineProperty");return Se({},"",{}),Se}catch{}}(),dc=wt?wt.isBuffer:void 0,oo=Math.max,ao=Date.now,xc=mc(qe,"Map"),Cs=mc(Object,"create"),La=function(){function Se(){}return function(De){if(!Uc(De))return{};if(_n)return _n(De);Se.prototype=De;var it=new Se;return Se.prototype=void 0,it}}();function Vo(Se){var De=-1,it=Se==null?0:Se.length;for(this.clear();++De<it;){var nn=Se[De];this.set(nn[0],nn[1])}}function Ma(){this.__data__=Cs?Cs(null):{},this.size=0}function hc(Se){var De=this.has(Se)&&delete this.__data__[Se];return this.size-=De?1:0,De}function wl(Se){var De=this.__data__;if(Cs){var it=De[Se];return it===o?void 0:it}return Tt.call(De,Se)?De[Se]:void 0}function Ua(Se){var De=this.__data__;return Cs?De[Se]!==void 0:Tt.call(De,Se)}function pc(Se,De){var it=this.__data__;return this.size+=this.has(Se)?0:1,it[Se]=Cs&&De===void 0?o:De,this}Vo.prototype.clear=Ma,Vo.prototype.delete=hc,Vo.prototype.get=wl,Vo.prototype.has=Ua,Vo.prototype.set=pc;function Eo(Se){var De=-1,it=Se==null?0:Se.length;for(this.clear();++De<it;){var nn=Se[De];this.set(nn[0],nn[1])}}function Vi(){this.__data__=[],this.size=0}function vt(Se){var De=this.__data__,it=ih(De,Se);if(it<0)return!1;var nn=De.length-1;return it==nn?De.pop():Ts.call(De,it,1),--this.size,!0}function pn(Se){var De=this.__data__,it=ih(De,Se);return it<0?void 0:De[it][1]}function Sr(Se){return ih(this.__data__,Se)>-1}function yi(Se,De){var it=this.__data__,nn=ih(it,Se);return nn<0?(++this.size,it.push([Se,De])):it[nn][1]=De,this}Eo.prototype.clear=Vi,Eo.prototype.delete=vt,Eo.prototype.get=pn,Eo.prototype.has=Sr,Eo.prototype.set=yi;function jo(Se){var De=-1,it=Se==null?0:Se.length;for(this.clear();++De<it;){var nn=Se[De];this.set(nn[0],nn[1])}}function vo(){this.size=0,this.__data__={hash:new Vo,map:new(xc||Eo),string:new Vo}}function iu(Se){var De=id(this,Se).delete(Se);return this.size-=De?1:0,De}function kp(Se){return id(this,Se).get(Se)}function Tl(Se){return id(this,Se).has(Se)}function su(Se,De){var it=id(this,Se),nn=it.size;return it.set(Se,De),this.size+=it.size==nn?0:1,this}jo.prototype.clear=vo,jo.prototype.delete=iu,jo.prototype.get=kp,jo.prototype.has=Tl,jo.prototype.set=su;function Ai(Se){var De=this.__data__=new Eo(Se);this.size=De.size}function So(){this.__data__=new Eo,this.size=0}function Gi(Se){var De=this.__data__,it=De.delete(Se);return this.size=De.size,it}function th(Se){return this.__data__.get(Se)}function nh(Se){return this.__data__.has(Se)}function fc(Se,De){var it=this.__data__;if(it instanceof Eo){var nn=it.__data__;if(!xc||nn.length<i-1)return nn.push([Se,De]),this.size=++it.size,this;it=this.__data__=new jo(nn)}return it.set(Se,De),this.size=it.size,this}Ai.prototype.clear=So,Ai.prototype.delete=Gi,Ai.prototype.get=th,Ai.prototype.has=nh,Ai.prototype.set=fc;function rh(Se,De){var it=oa(Se),nn=!it&&gs(Se),er=!it&&!nn&&ca(Se),Ar=!it&&!nn&&!er&&Mp(Se),Jr=it||nn||er||Ar,mn=Jr?mt(Se.length,String):[],Gr=mn.length;for(var Oi in Se)Jr&&(Oi=="length"||er&&(Oi=="offset"||Oi=="parent")||Ar&&(Oi=="buffer"||Oi=="byteLength"||Oi=="byteOffset")||Il(Oi,Gr))||mn.push(Oi);return mn}function rd(Se,De,it){(it!==void 0&&!sa(Se[De],it)||it===void 0&&!(De in Se))&&Xr(Se,De,it)}function ra(Se,De,it){var nn=Se[De];(!(Tt.call(Se,De)&&sa(nn,it))||it===void 0&&!(De in Se))&&Xr(Se,De,it)}function ih(Se,De){for(var it=Se.length;it--;)if(sa(Se[it][0],De))return it;return-1}function Xr(Se,De,it){De=="__proto__"&&na?na(Se,De,{configurable:!0,enumerable:!0,value:it,writable:!0}):Se[De]=it}var Pi=cu();function Lc(Se){return Se==null?Se===void 0?X:Z:ui&&ui in Object(Se)?ia(Se):dm(Se)}function Cl(Se){return Rs(Se)&&Lc(Se)==_}function Va(Se){if(!Uc(Se)||gc(Se))return!1;var De=la(Se)?sn:Pe;return De.test(Lp(Se))}function Np(Se){return Rs(Se)&&pm(Se.length)&&!!ke[Lc(Se)]}function sh(Se){if(!Uc(Se))return Mc(Se);var De=hr(Se),it=[];for(var nn in Se)nn=="constructor"&&(De||!Tt.call(Se,nn))||it.push(nn);return it}function ou(Se,De,it,nn,er){Se!==De&&Pi(De,function(Ar,Jr){if(er||(er=new Ai),Uc(Ar))Fo(Se,De,Jr,it,ou,nn,er);else{var mn=nn?nn(ch(Se,Jr),Ar,Jr+"",Se,De,er):void 0;mn===void 0&&(mn=Ar),rd(Se,Jr,mn)}},hu)}function Fo(Se,De,it,nn,er,Ar,Jr){var mn=ch(Se,it),Gr=ch(De,it),Oi=Jr.get(Gr);if(Oi){rd(Se,it,Oi);return}var Ys=Ar?Ar(mn,Gr,it+"",Se,De,Jr):void 0,ua=Ys===void 0;if(ua){var da=oa(Gr),ad=!da&&ca(Gr),os=!da&&!ad&&Mp(Gr);Ys=Gr,da||ad||os?oa(mn)?Ys=mn:du(mn)?Ys=ah(mn):ad?(ua=!1,Ys=Dp(Gr)):os?(ua=!1,Ys=oh(Gr)):Ys=[]:od(Gr)||gs(Gr)?(Ys=mn,gs(mn)?Ys=Al(mn):(!Uc(mn)||la(mn))&&(Ys=sd(Gr))):ua=!1}ua&&(Jr.set(Gr,Ys),er(Ys,Gr,nn,Ar,Jr),Jr.delete(Gr)),rd(Se,it,Ys)}function um(Se,De){return xp(uu(Se,De,Fa),Se+"")}var bo=na?function(Se,De){return na(Se,"toString",{configurable:!0,enumerable:!1,value:ja(De),writable:!0})}:Fa;function Dp(Se,De){return Se.slice()}function Rl(Se){var De=new Se.constructor(Se.byteLength);return new Vt(De).set(new Vt(Se)),De}function oh(Se,De){var it=Rl(Se.buffer);return new Se.constructor(it,Se.byteOffset,Se.length)}function ah(Se,De){var it=-1,nn=Se.length;for(De||(De=Array(nn));++it<nn;)De[it]=Se[it];return De}function br(Se,De,it,nn){var er=!it;it||(it={});for(var Ar=-1,Jr=De.length;++Ar<Jr;){var mn=De[Ar],Gr=void 0;Gr===void 0&&(Gr=Se[mn]),er?Xr(it,mn,Gr):ra(it,mn,Gr)}return it}function au(Se){return um(function(De,it){var nn=-1,er=it.length,Ar=er>1?it[er-1]:void 0,Jr=er>2?it[2]:void 0;for(Ar=Se.length>3&&typeof Ar=="function"?(er--,Ar):void 0,Jr&&lu(it[0],it[1],Jr)&&(Ar=er<3?void 0:Ar,er=1),De=Object(De);++nn<er;){var mn=it[nn];mn&&Se(De,mn,nn,Ar)}return De})}function cu(Se){return function(De,it,nn){for(var er=-1,Ar=Object(De),Jr=nn(De),mn=Jr.length;mn--;){var Gr=Jr[++er];if(it(Ar[Gr],Gr,Ar)===!1)break}return De}}function id(Se,De){var it=Se.__data__;return ni(De)?it[typeof De=="string"?"string":"hash"]:it.map}function mc(Se,De){var it=Xt(Se,De);return Va(it)?it:void 0}function ia(Se){var De=Tt.call(Se,ui),it=Se[ui];try{Se[ui]=void 0;var nn=!0}catch{}var er=gn.call(Se);return nn&&(De?Se[ui]=it:delete Se[ui]),er}function sd(Se){return typeof Se.constructor=="function"&&!hr(Se)?La(zt(Se)):{}}function Il(Se,De){var it=typeof Se;return De=De??f,!!De&&(it=="number"||it!="symbol"&&Te.test(Se))&&Se>-1&&Se%1==0&&Se<De}function lu(Se,De,it){if(!Uc(it))return!1;var nn=typeof De;return(nn=="number"?aa(it)&&Il(De,it.length):nn=="string"&&De in it)?sa(it[De],Se):!1}function ni(Se){var De=typeof Se;return De=="string"||De=="number"||De=="symbol"||De=="boolean"?Se!=="__proto__":Se===null}function gc(Se){return!!Kt&&Kt in Se}function hr(Se){var De=Se&&Se.constructor,it=typeof De=="function"&&De.prototype||Ke;return Se===it}function Mc(Se){var De=[];if(Se!=null)for(var it in Object(Se))De.push(it);return De}function dm(Se){return gn.call(Se)}function uu(Se,De,it){return De=oo(De===void 0?Se.length-1:De,0),function(){for(var nn=arguments,er=-1,Ar=oo(nn.length-De,0),Jr=Array(Ar);++er<Ar;)Jr[er]=nn[De+er];er=-1;for(var mn=Array(De+1);++er<De;)mn[er]=nn[er];return mn[De]=it(Jr),ut(Se,this,mn)}}function ch(Se,De){if(!(De==="constructor"&&typeof Se[De]=="function")&&De!="__proto__")return Se[De]}var xp=hm(bo);function hm(Se){var De=0,it=0;return function(){var nn=ao(),er=u-(nn-it);if(it=nn,er>0){if(++De>=l)return arguments[0]}else De=0;return Se.apply(void 0,arguments)}}function Lp(Se){if(Se!=null){try{return Et.call(Se)}catch{}try{return Se+""}catch{}}return""}function sa(Se,De){return Se===De||Se!==Se&&De!==De}var gs=Cl(function(){return arguments}())?Cl:function(Se){return Rs(Se)&&Tt.call(Se,"callee")&&!Ui.call(Se,"callee")},oa=Array.isArray;function aa(Se){return Se!=null&&pm(Se.length)&&!la(Se)}function du(Se){return Rs(Se)&&aa(Se)}var ca=dc||Pl;function la(Se){if(!Uc(Se))return!1;var De=Lc(Se);return De==L||De==M||De==b||De==re}function pm(Se){return typeof Se=="number"&&Se>-1&&Se%1==0&&Se<=f}function Uc(Se){var De=typeof Se;return Se!=null&&(De=="object"||De=="function")}function Rs(Se){return Se!=null&&typeof Se=="object"}function od(Se){if(!Rs(Se)||Lc(Se)!=K)return!1;var De=zt(Se);if(De===null)return!0;var it=Tt.call(De,"constructor")&&De.constructor;return typeof it=="function"&&it instanceof it&&Et.call(it)==Sn}var Mp=He?Lt(He):Np;function Al(Se){return br(Se,hu(Se))}function hu(Se){return aa(Se)?rh(Se):sh(Se)}var fm=au(function(Se,De,it,nn){ou(Se,De,it,nn)});function ja(Se){return function(){return Se}}function Fa(Se){return Se}function Pl(){return!1}n.exports=fm}($T,$T.exports)),$T.exports}var sve=ive();const sp=Yg(sve);function ro(n,e=[]){const i=k.useRef(n);return k.useEffect(()=>{i.current=n}),k.useCallback((...o)=>{var l;return(l=i.current)==null?void 0:l.call(i,...o)},e)}function Uy(n,e,i,o){const l=ro(i);return k.useEffect(()=>{const u=typeof n=="function"?n():n??document;if(!(!i||!u))return u.addEventListener(e,l,o),()=>{u.removeEventListener(e,l,o)}},[e,n,o,l,i]),()=>{const u=typeof n=="function"?n():n??document;u==null||u.removeEventListener(e,l,o)}}function MZ(n){const{isOpen:e,ref:i}=n,[o,l]=k.useState(e),[u,f]=k.useState(!1);return k.useEffect(()=>{u||(l(e),f(!0))},[e,u,o]),Uy(()=>i.current,"animationend",()=>{l(e)}),{present:!(e?!1:!o),onComplete(){var C;const E=IEe(i.current),b=new E.CustomEvent("animationend",{bubbles:!0});(C=i.current)==null||C.dispatchEvent(b)}}}var CM,GK;function ove(){return GK||(GK=1,CM=function(){var n=document.getSelection();if(!n.rangeCount)return function(){};for(var e=document.activeElement,i=[],o=0;o<n.rangeCount;o++)i.push(n.getRangeAt(o));switch(e.tagName.toUpperCase()){case"INPUT":case"TEXTAREA":e.blur();break;default:e=null;break}return n.removeAllRanges(),function(){n.type==="Caret"&&n.removeAllRanges(),n.rangeCount||i.forEach(function(l){n.addRange(l)}),e&&e.focus()}}),CM}var RM,HK;function ave(){if(HK)return RM;HK=1;var n=ove(),e={"text/plain":"Text","text/html":"Url",default:"Text"},i="Copy to clipboard: #{key}, Enter";function o(u){var f=(/mac os x/i.test(navigator.userAgent)?"":"Ctrl")+"+C";return u.replace(/#{\s*key\s*}/g,f)}function l(u,f){var _,E,b,C,I,P,L=!1;f||(f={}),_=f.debug||!1;try{b=n(),C=document.createRange(),I=document.getSelection(),P=document.createElement("span"),P.textContent=u,P.ariaHidden="true",P.style.all="unset",P.style.position="fixed",P.style.top=0,P.style.clip="rect(0, 0, 0, 0)",P.style.whiteSpace="pre",P.style.webkitUserSelect="text",P.style.MozUserSelect="text",P.style.msUserSelect="text",P.style.userSelect="text",P.addEventListener("copy",function(F){if(F.stopPropagation(),f.format)if(F.preventDefault(),typeof F.clipboardData>"u"){_&&console.warn("unable to use e.clipboardData"),_&&console.warn("trying IE specific stuff"),window.clipboardData.clearData();var B=e[f.format]||e.default;window.clipboardData.setData(B,u)}else F.clipboardData.clearData(),F.clipboardData.setData(f.format,u);f.onCopy&&(F.preventDefault(),f.onCopy(F.clipboardData))}),document.body.appendChild(P),C.selectNodeContents(P),I.addRange(C);var M=document.execCommand("copy");if(!M)throw new Error("copy command was unsuccessful");L=!0}catch(F){_&&console.error("unable to copy using execCommand: ",F),_&&console.warn("trying IE specific stuff");try{window.clipboardData.setData(f.format||"text",u),f.onCopy&&f.onCopy(window.clipboardData),L=!0}catch(B){_&&console.error("unable to copy using clipboardData: ",B),_&&console.error("falling back to prompt"),E=o("message"in f?f.message:i),window.prompt(E,u)}}finally{I&&(typeof I.removeRange=="function"?I.removeRange(C):I.removeAllRanges()),P&&document.body.removeChild(P),b()}return L}return RM=l,RM}var cve=ave();const $K=Yg(cve);function KK(n,e={}){const[i,o]=k.useState(!1),[l,u]=k.useState(n);k.useEffect(()=>u(n),[n]);const{timeout:f=1500,..._}=typeof e=="number"?{timeout:e}:e,E=k.useCallback(b=>{const C=typeof b=="string"?b:l;"clipboard"in navigator?navigator.clipboard.writeText(C).then(()=>o(!0)).catch(()=>o($K(C,_))):o($K(C,_))},[l,_]);return k.useEffect(()=>{let b=null;return i&&(b=window.setTimeout(()=>{o(!1)},f)),()=>{b&&window.clearTimeout(b)}},[f,i]),{value:l,setValue:u,onCopy:E,hasCopied:i}}function UZ(n){const{value:e,defaultValue:i,onChange:o,shouldUpdate:l=(P,L)=>P!==L}=n,u=ro(o),f=ro(l),[_,E]=k.useState(i),b=e!==void 0,C=b?e:_,I=ro(P=>{const M=typeof P=="function"?P(C):P;f(C,M)&&(b||E(M),u(M))},[b,u,C,f]);return[C,I]}function lve(n={}){const{onChange:e,precision:i,defaultValue:o,value:l,step:u=1,min:f=Number.MIN_SAFE_INTEGER,max:_=Number.MAX_SAFE_INTEGER,keepWithinRange:E=!0}=n,b=ro(e),[C,I]=k.useState(()=>o==null?"":IM(o,u,i)??""),P=typeof l<"u",L=P?l:C,M=VZ(Sg(L),u),F=i??M,B=k.useCallback(ie=>{ie!==L&&(P||I(ie.toString()),b==null||b(ie.toString(),Sg(ie)))},[b,P,L]),Z=k.useCallback(ie=>{let le=ie;return E&&(le=sk(le,f,_)),jj(le,F)},[F,E,_,f]),K=k.useCallback((ie=u)=>{let le;L===""?le=Sg(ie):le=Sg(L)+ie,le=Z(le),B(le)},[Z,u,B,L]),re=k.useCallback((ie=u)=>{let le;L===""?le=Sg(-ie):le=Sg(L)-ie,le=Z(le),B(le)},[Z,u,B,L]),ae=k.useCallback(()=>{let ie;o==null?ie="":ie=IM(o,u,i)??f,B(ie)},[o,i,u,B,f]),ne=k.useCallback(ie=>{const le=IM(ie,u,F)??f;B(le)},[F,u,B,f]),pe=Sg(L);return{isOutOfRange:pe>_||pe<f,isAtMax:pe===_,isAtMin:pe===f,precision:F,value:L,valueAsNumber:pe,update:B,reset:ae,increment:K,decrement:re,clamp:Z,cast:ne,setValue:I}}function Sg(n){return parseFloat(n.toString().replace(/[^\w.-]+/g,""))}function VZ(n,e){return Math.max(JU(e),JU(n))}function IM(n,e,i){const o=Sg(n);if(Number.isNaN(o))return;const l=VZ(o,e);return jj(o,i??l)}function Xd(n={}){const{onClose:e,onOpen:i,isOpen:o,id:l}=n,u=ro(i),f=ro(e),[_,E]=k.useState(n.defaultIsOpen||!1),b=o!==void 0?o:_,C=o!==void 0,I=k.useId(),P=l??`disclosure-${I}`,L=k.useCallback(()=>{C||E(!1),f==null||f()},[C,f]),M=k.useCallback(()=>{C||E(!0),u==null||u()},[C,u]),F=k.useCallback(()=>{b?L():M()},[b,M,L]);function B(K={}){return{...K,"aria-expanded":b,"aria-controls":P,onClick(re){var ae;(ae=K.onClick)==null||ae.call(K,re),F()}}}function Z(K={}){return{...K,hidden:!b,id:P}}return{isOpen:b,onOpen:M,onClose:L,onToggle:F,isControlled:C,getButtonProps:B,getDisclosureProps:Z}}const dp=globalThis!=null&&globalThis.document?k.useLayoutEffect:k.useEffect,Xf=(n,e)=>{const i=k.useRef(!1),o=k.useRef(!1);k.useEffect(()=>{if(i.current&&o.current)return n();o.current=!0},e),k.useEffect(()=>(i.current=!0,()=>{i.current=!1}),[])};function uve(n){const e=n.current;if(!e)return!1;const i=PEe(e);return!i||e.contains(i)?!1:!!GEe(i)}function jZ(n,e){const{shouldFocus:i,visible:o,focusRef:l}=e,u=i&&!o;Xf(()=>{if(!u||uve(n))return;const f=(l==null?void 0:l.current)||n.current;let _;if(f)return _=requestAnimationFrame(()=>{f.focus({preventScroll:!0})}),()=>{cancelAnimationFrame(_)}},[u,n,l])}const dve={preventScroll:!0,shouldFocus:!1};function hve(n,e=dve){const{focusRef:i,preventScroll:o,shouldFocus:l,visible:u}=e,f=pve(n)?n.current:n,_=l&&u,E=k.useRef(_),b=k.useRef(u);dp(()=>{!b.current&&u&&(E.current=_),b.current=u},[u,_]);const C=k.useCallback(()=>{if(!(!u||!f||!E.current)&&(E.current=!1,!f.contains(document.activeElement)))if(i!=null&&i.current)requestAnimationFrame(()=>{var I;(I=i.current)==null||I.focus({preventScroll:o})});else{const I=NZ(f);I.length>0&&requestAnimationFrame(()=>{I[0].focus({preventScroll:o})})}},[u,o,f,i]);Xf(()=>{C()},[C]),Uy(f,"transitionend",C)}function pve(n){return"current"in n}function fve(n){return"current"in n}const FZ=()=>typeof window<"u";function mve(){const n=navigator.userAgentData;return(n==null?void 0:n.platform)??navigator.platform}const gve=n=>FZ()&&n.test(navigator.vendor),_ve=n=>FZ()&&n.test(mve()),yve=()=>_ve(/mac|iphone|ipad|ipod/i),Eve=()=>yve()&&gve(/apple/i);function vve(n){const{ref:e,elements:i,enabled:o}=n,l=()=>{var u;return((u=e.current)==null?void 0:u.ownerDocument)??document};Uy(l,"pointerdown",u=>{var b,C;if(!Eve()||!o)return;const f=((C=(b=u.composedPath)==null?void 0:b.call(u))==null?void 0:C[0])??u.target,E=(i??[e]).some(I=>{const P=fve(I)?I.current:I;return(P==null?void 0:P.contains(f))||P===f});l().activeElement!==f&&E&&(u.preventDefault(),f.focus())})}function Sve(n,e){const i=k.useId();return k.useMemo(()=>n||[e,i].filter(Boolean).join("-"),[n,e,i])}function bve(n,...e){const i=Sve(n);return k.useMemo(()=>e.map(o=>`${o}-${i}`),[i,e])}function wve(n,e){const i=ro(n);k.useEffect(()=>{let o=null;const l=()=>i();return e!==null&&(o=window.setInterval(l,e)),()=>{o&&window.clearInterval(o)}},[e,i])}function BZ(n){const e=k.useRef(null);return e.current=n,e}function Tve(n,e){if(n!=null){if(typeof n=="function"){n(e);return}try{n.current=e}catch{throw new Error(`Cannot assign value '${e}' to ref '${n}'`)}}}function zi(...n){return e=>{n.forEach(i=>{Tve(i,e)})}}function Cve(...n){return k.useMemo(()=>zi(...n),n)}function WZ(n){const{ref:e,handler:i,enabled:o=!0}=n,l=ro(i),f=k.useRef({isPointerDown:!1,ignoreEmulatedMouseEvents:!1}).current;k.useEffect(()=>{if(!o)return;const _=I=>{AM(I,e)&&(f.isPointerDown=!0)},E=I=>{if(f.ignoreEmulatedMouseEvents){f.ignoreEmulatedMouseEvents=!1;return}f.isPointerDown&&i&&AM(I,e)&&(f.isPointerDown=!1,l(I))},b=I=>{f.ignoreEmulatedMouseEvents=!0,i&&f.isPointerDown&&AM(I,e)&&(f.isPointerDown=!1,l(I))},C=zZ(e.current);return C.addEventListener("mousedown",_,!0),C.addEventListener("mouseup",E,!0),C.addEventListener("touchstart",_,!0),C.addEventListener("touchend",b,!0),()=>{C.removeEventListener("mousedown",_,!0),C.removeEventListener("mouseup",E,!0),C.removeEventListener("touchstart",_,!0),C.removeEventListener("touchend",b,!0)}},[i,e,l,f,o])}function AM(n,e){var o,l;const i=((o=n.composedPath)==null?void 0:o.call(n)[0])??n.target;return i&&!zZ(i).contains(i)?!1:!((l=e.current)!=null&&l.contains(i))}function zZ(n){return(n==null?void 0:n.ownerDocument)??document}function Rve(n,e){const i=ro(n);k.useEffect(()=>{if(e==null)return;let o=null;return o=window.setTimeout(()=>{i()},e),()=>{o&&window.clearTimeout(o)}},[e,i])}const GZ=1/60*1e3,Ive=typeof performance<"u"?()=>performance.now():()=>Date.now(),HZ=typeof window<"u"?n=>window.requestAnimationFrame(n):n=>setTimeout(()=>n(Ive()),GZ);function Ave(n){let e=[],i=[],o=0,l=!1,u=!1;const f=new WeakSet,_={schedule:(E,b=!1,C=!1)=>{const I=C&&l,P=I?e:i;return b&&f.add(E),P.indexOf(E)===-1&&(P.push(E),I&&l&&(o=e.length)),E},cancel:E=>{const b=i.indexOf(E);b!==-1&&i.splice(b,1),f.delete(E)},process:E=>{if(l){u=!0;return}if(l=!0,[e,i]=[i,e],i.length=0,o=e.length,o)for(let b=0;b<o;b++){const C=e[b];C(E),f.has(C)&&(_.schedule(C),n())}l=!1,u&&(u=!1,_.process(E))}};return _}const Pve=40;let QU=!0,AC=!1,ZU=!1;const a0={delta:0,timestamp:0},aR=["read","update","preRender","render","postRender"],x1=aR.reduce((n,e)=>(n[e]=Ave(()=>AC=!0),n),{}),Ove=aR.reduce((n,e)=>{const i=x1[e];return n[e]=(o,l=!1,u=!1)=>(AC||Dve(),i.schedule(o,l,u)),n},{}),kve=aR.reduce((n,e)=>(n[e]=x1[e].cancel,n),{});aR.reduce((n,e)=>(n[e]=()=>x1[e].process(a0),n),{});const Nve=n=>x1[n].process(a0),$Z=n=>{AC=!1,a0.delta=QU?GZ:Math.max(Math.min(n-a0.timestamp,Pve),1),a0.timestamp=n,ZU=!0,aR.forEach(Nve),ZU=!1,AC&&(QU=!1,HZ($Z))},Dve=()=>{AC=!0,QU=!0,ZU||HZ($Z)},qK=()=>a0;var xve=Object.defineProperty,Lve=(n,e,i)=>e in n?xve(n,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):n[e]=i,Bd=(n,e,i)=>(Lve(n,typeof e!="symbol"?e+"":e,i),i);class Mve{constructor(e,i,o){if(Bd(this,"history",[]),Bd(this,"startEvent",null),Bd(this,"lastEvent",null),Bd(this,"lastEventInfo",null),Bd(this,"handlers",{}),Bd(this,"removeListeners",()=>{}),Bd(this,"threshold",3),Bd(this,"win"),Bd(this,"updatePoint",()=>{if(!(this.lastEvent&&this.lastEventInfo))return;const _=PM(this.lastEventInfo,this.history),E=this.startEvent!==null,b=Fve(_.offset,{x:0,y:0})>=this.threshold;if(!E&&!b)return;const{timestamp:C}=qK();this.history.push({..._.point,timestamp:C});const{onStart:I,onMove:P}=this.handlers;E||(I==null||I(this.lastEvent,_),this.startEvent=this.lastEvent),P==null||P(this.lastEvent,_)}),Bd(this,"onPointerMove",(_,E)=>{this.lastEvent=_,this.lastEventInfo=E,Ove.update(this.updatePoint,!0)}),Bd(this,"onPointerUp",(_,E)=>{const b=PM(E,this.history),{onEnd:C,onSessionEnd:I}=this.handlers;I==null||I(_,b),this.end(),!(!C||!this.startEvent)&&(C==null||C(_,b))}),this.win=e.view??window,kEe(e))return;this.handlers=i,o&&(this.threshold=o),e.stopPropagation(),e.preventDefault();const l={point:AZ(e)},{timestamp:u}=qK();this.history=[{...l.point,timestamp:u}];const{onSessionStart:f}=i;f==null||f(e,PM(l,this.history)),this.removeListeners=jve(ik(this.win,"pointermove",this.onPointerMove),ik(this.win,"pointerup",this.onPointerUp),ik(this.win,"pointercancel",this.onPointerUp))}updateHandlers(e){this.handlers=e}end(){var e;(e=this.removeListeners)==null||e.call(this),kve.update(this.updatePoint)}}function YK(n,e){return{x:n.x-e.x,y:n.y-e.y}}function PM(n,e){return{point:n.point,delta:YK(n.point,e[e.length-1]),offset:YK(n.point,e[0]),velocity:Vve(e,.1)}}const Uve=n=>n*1e3;function Vve(n,e){if(n.length<2)return{x:0,y:0};let i=n.length-1,o=null;const l=n[n.length-1];for(;i>=0&&(o=n[i],!(l.timestamp-o.timestamp>Uve(e)));)i--;if(!o)return{x:0,y:0};const u=(l.timestamp-o.timestamp)/1e3;if(u===0)return{x:0,y:0};const f={x:(l.x-o.x)/u,y:(l.y-o.y)/u};return f.x===1/0&&(f.x=0),f.y===1/0&&(f.y=0),f}function jve(...n){return e=>n.reduce((i,o)=>o(i),e)}function OM(n,e){return Math.abs(n-e)}function XK(n){return"x"in n&&"y"in n}function Fve(n,e){if(typeof n=="number"&&typeof e=="number")return OM(n,e);if(XK(n)&&XK(e)){const i=OM(n.x,e.x),o=OM(n.y,e.y);return Math.sqrt(i**2+o**2)}return 0}function Bve(n,e){const{onPan:i,onPanStart:o,onPanEnd:l,onPanSessionStart:u,onPanSessionEnd:f,threshold:_}=e,E=!!(i||o||l||u||f),b=k.useRef(null),C=BZ({onSessionStart:u,onSessionEnd:f,onStart:o,onMove:i,onEnd(I,P){b.current=null,l==null||l(I,P)}});k.useEffect(()=>{var I;(I=b.current)==null||I.updateHandlers(C.current)}),k.useEffect(()=>{const I=n.current;if(!I||!E)return;function P(L){b.current=new Mve(L,C.current,_)}return ik(I,"pointerdown",P)},[n,E,C,_]),k.useEffect(()=>()=>{var I;(I=b.current)==null||I.end(),b.current=null},[])}const ko={open:(n,e)=>`${n}[data-open], ${n}[open], ${n}[data-state=open] ${e}`,closed:(n,e)=>`${n}[data-closed], ${n}[data-state=closed] ${e}`,hover:(n,e)=>`${n}:hover ${e}, ${n}[data-hover] ${e}`,focus:(n,e)=>`${n}:focus ${e}, ${n}[data-focus] ${e}`,focusVisible:(n,e)=>`${n}:focus-visible ${e}`,focusWithin:(n,e)=>`${n}:focus-within ${e}`,active:(n,e)=>`${n}:active ${e}, ${n}[data-active] ${e}`,disabled:(n,e)=>`${n}:disabled ${e}, ${n}[data-disabled] ${e}`,invalid:(n,e)=>`${n}:invalid ${e}, ${n}[data-invalid] ${e}`,checked:(n,e)=>`${n}:checked ${e}, ${n}[data-checked] ${e}`,placeholderShown:(n,e)=>`${n}:placeholder-shown ${e}`},qh=n=>KZ(e=>n(e,"&"),"[role=group]","[data-group]",".group"),Af=n=>KZ(e=>n(e,"~ &"),"[data-peer]",".peer"),KZ=(n,...e)=>e.map(n).join(", "),c0={_hover:"&:hover, &[data-hover]",_active:"&:active, &[data-active]",_focus:"&:focus, &[data-focus]",_highlighted:"&[data-highlighted]",_focusWithin:"&:focus-within, &[data-focus-within]",_focusVisible:"&:focus-visible, &[data-focus-visible]",_disabled:"&:disabled, &[disabled], &[aria-disabled=true], &[data-disabled]",_readOnly:"&[aria-readonly=true], &[readonly], &[data-readonly]",_before:"&::before",_after:"&::after",_empty:"&:empty, &[data-empty]",_expanded:"&[aria-expanded=true], &[data-expanded], &[data-state=expanded]",_checked:"&[aria-checked=true], &[data-checked], &[data-state=checked]",_grabbed:"&[aria-grabbed=true], &[data-grabbed]",_pressed:"&[aria-pressed=true], &[data-pressed]",_invalid:"&[aria-invalid=true], &[data-invalid]",_valid:"&[data-valid], &[data-state=valid]",_loading:"&[data-loading], &[aria-busy=true]",_selected:"&[aria-selected=true], &[data-selected]",_hidden:"&[hidden], &[data-hidden]",_autofill:"&:-webkit-autofill",_even:"&:nth-of-type(even)",_odd:"&:nth-of-type(odd)",_first:"&:first-of-type",_firstLetter:"&::first-letter",_last:"&:last-of-type",_notFirst:"&:not(:first-of-type)",_notLast:"&:not(:last-of-type)",_visited:"&:visited",_activeLink:"&[aria-current=page]",_activeStep:"&[aria-current=step]",_indeterminate:"&:indeterminate, &[aria-checked=mixed], &[data-indeterminate], &[data-state=indeterminate]",_groupOpen:qh(ko.open),_groupClosed:qh(ko.closed),_groupHover:qh(ko.hover),_peerHover:Af(ko.hover),_groupFocus:qh(ko.focus),_peerFocus:Af(ko.focus),_groupFocusVisible:qh(ko.focusVisible),_peerFocusVisible:Af(ko.focusVisible),_groupActive:qh(ko.active),_peerActive:Af(ko.active),_groupDisabled:qh(ko.disabled),_peerDisabled:Af(ko.disabled),_groupInvalid:qh(ko.invalid),_peerInvalid:Af(ko.invalid),_groupChecked:qh(ko.checked),_peerChecked:Af(ko.checked),_groupFocusWithin:qh(ko.focusWithin),_peerFocusWithin:Af(ko.focusWithin),_peerPlaceholderShown:Af(ko.placeholderShown),_placeholder:"&::placeholder, &[data-placeholder]",_placeholderShown:"&:placeholder-shown, &[data-placeholder-shown]",_fullScreen:"&:fullscreen, &[data-fullscreen]",_selection:"&::selection",_rtl:"[dir=rtl] &, &[dir=rtl]",_ltr:"[dir=ltr] &, &[dir=ltr]",_mediaDark:"@media (prefers-color-scheme: dark)",_mediaReduceMotion:"@media (prefers-reduced-motion: reduce)",_dark:".chakra-ui-dark &:not([data-theme]),[data-theme=dark] &:not([data-theme]),&[data-theme=dark]",_light:".chakra-ui-light &:not([data-theme]),[data-theme=light] &:not([data-theme]),&[data-theme=light]",_horizontal:"&[data-orientation=horizontal]",_vertical:"&[data-orientation=vertical]",_open:"&[data-open], &[open], &[data-state=open]",_closed:"&[data-closed], &[data-state=closed]",_complete:"&[data-complete]",_incomplete:"&[data-incomplete]",_current:"&[data-current]"},qZ=Object.keys(c0),Wve=n=>/!(important)?$/.test(n),JK=n=>typeof n=="string"?n.replace(/!(important)?$/,"").trim():n,zve=(n,e)=>i=>{const o=String(e),l=Wve(o),u=JK(o),f=n?`${n}.${u}`:u;let _=Ku(i.__cssMap)&&f in i.__cssMap?i.__cssMap[f].varRef:e;return _=JK(_),l?`${_} !important`:_};function Fj(n){const{scale:e,transform:i,compose:o}=n;return(u,f)=>{const _=zve(e,u)(f);let E=(i==null?void 0:i(_,f))??_;return o&&(E=o(E,f)),E}}const CO=(...n)=>e=>n.reduce((i,o)=>o(i),e);function Bu(n,e){return i=>{const o={property:i,scale:n};return o.transform=Fj({scale:n,transform:e}),o}}const Gve=({rtl:n,ltr:e})=>i=>i.direction==="rtl"?n:e;function Hve(n){const{property:e,scale:i,transform:o}=n;return{scale:i,property:Gve(e),transform:i?Fj({scale:i,compose:o}):o}}const YZ=["rotate(var(--chakra-rotate, 0))","scaleX(var(--chakra-scale-x, 1))","scaleY(var(--chakra-scale-y, 1))","skewX(var(--chakra-skew-x, 0))","skewY(var(--chakra-skew-y, 0))"];function $ve(){return["translateX(var(--chakra-translate-x, 0))","translateY(var(--chakra-translate-y, 0))",...YZ].join(" ")}function Kve(){return["translate3d(var(--chakra-translate-x, 0), var(--chakra-translate-y, 0), 0)",...YZ].join(" ")}const qve={"--chakra-blur":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-brightness":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-contrast":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-grayscale":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-hue-rotate":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-invert":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-saturate":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-sepia":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-drop-shadow":"var(--chakra-empty,/*!*/ /*!*/)",filter:["var(--chakra-blur)","var(--chakra-brightness)","var(--chakra-contrast)","var(--chakra-grayscale)","var(--chakra-hue-rotate)","var(--chakra-invert)","var(--chakra-saturate)","var(--chakra-sepia)","var(--chakra-drop-shadow)"].join(" ")},Yve={backdropFilter:["var(--chakra-backdrop-blur)","var(--chakra-backdrop-brightness)","var(--chakra-backdrop-contrast)","var(--chakra-backdrop-grayscale)","var(--chakra-backdrop-hue-rotate)","var(--chakra-backdrop-invert)","var(--chakra-backdrop-opacity)","var(--chakra-backdrop-saturate)","var(--chakra-backdrop-sepia)"].join(" "),"--chakra-backdrop-blur":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-brightness":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-contrast":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-grayscale":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-hue-rotate":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-invert":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-opacity":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-saturate":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-sepia":"var(--chakra-empty,/*!*/ /*!*/)"};function Xve(n){return{"--chakra-ring-offset-shadow":"var(--chakra-ring-inset) 0 0 0 var(--chakra-ring-offset-width) var(--chakra-ring-offset-color)","--chakra-ring-shadow":"var(--chakra-ring-inset) 0 0 0 calc(var(--chakra-ring-width) + var(--chakra-ring-offset-width)) var(--chakra-ring-color)","--chakra-ring-width":n,boxShadow:["var(--chakra-ring-offset-shadow)","var(--chakra-ring-shadow)","var(--chakra-shadow, 0 0 #0000)"].join(", ")}}const Jve={"row-reverse":{space:"--chakra-space-x-reverse",divide:"--chakra-divide-x-reverse"},"column-reverse":{space:"--chakra-space-y-reverse",divide:"--chakra-divide-y-reverse"}},eV={"to-t":"to top","to-tr":"to top right","to-r":"to right","to-br":"to bottom right","to-b":"to bottom","to-bl":"to bottom left","to-l":"to left","to-tl":"to top left"},Qve=new Set(Object.values(eV)),tV=new Set(["none","-moz-initial","inherit","initial","revert","unset"]),Zve=n=>n.trim();function eSe(n,e){if(n==null||tV.has(n))return n;if(!(nV(n)||tV.has(n)))return`url('${n}')`;const l=/(^[a-z-A-Z]+)\((.*)\)/g.exec(n),u=l==null?void 0:l[1],f=l==null?void 0:l[2];if(!u||!f)return n;const _=u.includes("-gradient")?u:`${u}-gradient`,[E,...b]=f.split(",").map(Zve).filter(Boolean);if((b==null?void 0:b.length)===0)return n;const C=E in eV?eV[E]:E;b.unshift(C);const I=b.map(P=>{if(Qve.has(P))return P;const L=P.indexOf(" "),[M,F]=L!==-1?[P.substr(0,L),P.substr(L+1)]:[P],B=nV(F)?F:F&&F.split(" "),Z=`colors.${M}`,K=Z in e.__cssMap?e.__cssMap[Z].varRef:M;return B?[K,...Array.isArray(B)?B:[B]].join(" "):K});return`${_}(${I.join(", ")})`}const nV=n=>typeof n=="string"&&n.includes("(")&&n.includes(")"),tSe=(n,e)=>eSe(n,e??{});function nSe(n){return/^var\(--.+\)$/.test(n)}const rSe=n=>{const e=parseFloat(n.toString()),i=n.toString().replace(String(e),"");return{unitless:!i,value:e,unit:i}},Yh=n=>e=>`${n}(${e})`,jr={filter(n){return n!=="auto"?n:qve},backdropFilter(n){return n!=="auto"?n:Yve},ring(n){return Xve(jr.px(n))},bgClip(n){return n==="text"?{color:"transparent",backgroundClip:"text"}:{backgroundClip:n}},transform(n){return n==="auto"?$ve():n==="auto-gpu"?Kve():n},vh(n){return n==="$100vh"?"var(--chakra-vh)":n},px(n){if(n==null)return n;const{unitless:e}=rSe(n);return e||typeof n=="number"?`${n}px`:n},fraction(n){return typeof n!="number"||n>1?n:`${n*100}%`},float(n,e){const i={left:"right",right:"left"};return e.direction==="rtl"?i[n]:n},degree(n){if(nSe(n)||n==null)return n;const e=typeof n=="string"&&!n.endsWith("deg");return typeof n=="number"||e?`${n}deg`:n},gradient:tSe,blur:Yh("blur"),opacity:Yh("opacity"),brightness:Yh("brightness"),contrast:Yh("contrast"),dropShadow:Yh("drop-shadow"),grayscale:Yh("grayscale"),hueRotate:n=>Yh("hue-rotate")(jr.degree(n)),invert:Yh("invert"),saturate:Yh("saturate"),sepia:Yh("sepia"),bgImage(n){return n==null||nV(n)||tV.has(n)?n:`url(${n})`},outline(n){const e=String(n)==="0"||String(n)==="none";return n!==null&&e?{outline:"2px solid transparent",outlineOffset:"2px"}:{outline:n}},flexDirection(n){const{space:e,divide:i}=Jve[n]??{},o={flexDirection:n};return e&&(o[e]=1),i&&(o[i]=1),o}},Ge={borderWidths:Bu("borderWidths"),borderStyles:Bu("borderStyles"),colors:Bu("colors"),borders:Bu("borders"),gradients:Bu("gradients",jr.gradient),radii:Bu("radii",jr.px),space:Bu("space",CO(jr.vh,jr.px)),spaceT:Bu("space",CO(jr.vh,jr.px)),degreeT(n){return{property:n,transform:jr.degree}},prop(n,e,i){return{property:n,scale:e,...e&&{transform:Fj({scale:e,transform:i})}}},propT(n,e){return{property:n,transform:e}},sizes:Bu("sizes",CO(jr.vh,jr.px)),sizesT:Bu("sizes",CO(jr.vh,jr.fraction)),shadows:Bu("shadows"),logical:Hve,blur:Bu("blur",jr.blur)},ok={background:Ge.colors("background"),backgroundColor:Ge.colors("backgroundColor"),backgroundImage:Ge.gradients("backgroundImage"),backgroundSize:!0,backgroundPosition:!0,backgroundRepeat:!0,backgroundAttachment:!0,backgroundClip:{transform:jr.bgClip},bgSize:Ge.prop("backgroundSize"),bgPosition:Ge.prop("backgroundPosition"),bg:Ge.colors("background"),bgColor:Ge.colors("backgroundColor"),bgPos:Ge.prop("backgroundPosition"),bgRepeat:Ge.prop("backgroundRepeat"),bgAttachment:Ge.prop("backgroundAttachment"),bgGradient:Ge.gradients("backgroundImage"),bgClip:{transform:jr.bgClip}};Object.assign(ok,{bgImage:ok.backgroundImage,bgImg:ok.backgroundImage});const si={border:Ge.borders("border"),borderWidth:Ge.borderWidths("borderWidth"),borderStyle:Ge.borderStyles("borderStyle"),borderColor:Ge.colors("borderColor"),borderRadius:Ge.radii("borderRadius"),borderTop:Ge.borders("borderTop"),borderBlockStart:Ge.borders("borderBlockStart"),borderTopLeftRadius:Ge.radii("borderTopLeftRadius"),borderStartStartRadius:Ge.logical({scale:"radii",property:{ltr:"borderTopLeftRadius",rtl:"borderTopRightRadius"}}),borderEndStartRadius:Ge.logical({scale:"radii",property:{ltr:"borderBottomLeftRadius",rtl:"borderBottomRightRadius"}}),borderTopRightRadius:Ge.radii("borderTopRightRadius"),borderStartEndRadius:Ge.logical({scale:"radii",property:{ltr:"borderTopRightRadius",rtl:"borderTopLeftRadius"}}),borderEndEndRadius:Ge.logical({scale:"radii",property:{ltr:"borderBottomRightRadius",rtl:"borderBottomLeftRadius"}}),borderRight:Ge.borders("borderRight"),borderInlineEnd:Ge.borders("borderInlineEnd"),borderBottom:Ge.borders("borderBottom"),borderBlockEnd:Ge.borders("borderBlockEnd"),borderBottomLeftRadius:Ge.radii("borderBottomLeftRadius"),borderBottomRightRadius:Ge.radii("borderBottomRightRadius"),borderLeft:Ge.borders("borderLeft"),borderInlineStart:{property:"borderInlineStart",scale:"borders"},borderInlineStartRadius:Ge.logical({scale:"radii",property:{ltr:["borderTopLeftRadius","borderBottomLeftRadius"],rtl:["borderTopRightRadius","borderBottomRightRadius"]}}),borderInlineEndRadius:Ge.logical({scale:"radii",property:{ltr:["borderTopRightRadius","borderBottomRightRadius"],rtl:["borderTopLeftRadius","borderBottomLeftRadius"]}}),borderX:Ge.borders(["borderLeft","borderRight"]),borderInline:Ge.borders("borderInline"),borderY:Ge.borders(["borderTop","borderBottom"]),borderBlock:Ge.borders("borderBlock"),borderTopWidth:Ge.borderWidths("borderTopWidth"),borderBlockStartWidth:Ge.borderWidths("borderBlockStartWidth"),borderTopColor:Ge.colors("borderTopColor"),borderBlockStartColor:Ge.colors("borderBlockStartColor"),borderTopStyle:Ge.borderStyles("borderTopStyle"),borderBlockStartStyle:Ge.borderStyles("borderBlockStartStyle"),borderBottomWidth:Ge.borderWidths("borderBottomWidth"),borderBlockEndWidth:Ge.borderWidths("borderBlockEndWidth"),borderBottomColor:Ge.colors("borderBottomColor"),borderBlockEndColor:Ge.colors("borderBlockEndColor"),borderBottomStyle:Ge.borderStyles("borderBottomStyle"),borderBlockEndStyle:Ge.borderStyles("borderBlockEndStyle"),borderLeftWidth:Ge.borderWidths("borderLeftWidth"),borderInlineStartWidth:Ge.borderWidths("borderInlineStartWidth"),borderLeftColor:Ge.colors("borderLeftColor"),borderInlineStartColor:Ge.colors("borderInlineStartColor"),borderLeftStyle:Ge.borderStyles("borderLeftStyle"),borderInlineStartStyle:Ge.borderStyles("borderInlineStartStyle"),borderRightWidth:Ge.borderWidths("borderRightWidth"),borderInlineEndWidth:Ge.borderWidths("borderInlineEndWidth"),borderRightColor:Ge.colors("borderRightColor"),borderInlineEndColor:Ge.colors("borderInlineEndColor"),borderRightStyle:Ge.borderStyles("borderRightStyle"),borderInlineEndStyle:Ge.borderStyles("borderInlineEndStyle"),borderTopRadius:Ge.radii(["borderTopLeftRadius","borderTopRightRadius"]),borderBottomRadius:Ge.radii(["borderBottomLeftRadius","borderBottomRightRadius"]),borderLeftRadius:Ge.radii(["borderTopLeftRadius","borderBottomLeftRadius"]),borderRightRadius:Ge.radii(["borderTopRightRadius","borderBottomRightRadius"])};Object.assign(si,{rounded:si.borderRadius,roundedTop:si.borderTopRadius,roundedTopLeft:si.borderTopLeftRadius,roundedTopRight:si.borderTopRightRadius,roundedTopStart:si.borderStartStartRadius,roundedTopEnd:si.borderStartEndRadius,roundedBottom:si.borderBottomRadius,roundedBottomLeft:si.borderBottomLeftRadius,roundedBottomRight:si.borderBottomRightRadius,roundedBottomStart:si.borderEndStartRadius,roundedBottomEnd:si.borderEndEndRadius,roundedLeft:si.borderLeftRadius,roundedRight:si.borderRightRadius,roundedStart:si.borderInlineStartRadius,roundedEnd:si.borderInlineEndRadius,borderStart:si.borderInlineStart,borderEnd:si.borderInlineEnd,borderTopStartRadius:si.borderStartStartRadius,borderTopEndRadius:si.borderStartEndRadius,borderBottomStartRadius:si.borderEndStartRadius,borderBottomEndRadius:si.borderEndEndRadius,borderStartRadius:si.borderInlineStartRadius,borderEndRadius:si.borderInlineEndRadius,borderStartWidth:si.borderInlineStartWidth,borderEndWidth:si.borderInlineEndWidth,borderStartColor:si.borderInlineStartColor,borderEndColor:si.borderInlineEndColor,borderStartStyle:si.borderInlineStartStyle,borderEndStyle:si.borderInlineEndStyle});const iSe={color:Ge.colors("color"),textColor:Ge.colors("color"),fill:Ge.colors("fill"),stroke:Ge.colors("stroke"),accentColor:Ge.colors("accentColor"),textFillColor:Ge.colors("textFillColor")},Bk={alignItems:!0,alignContent:!0,justifyItems:!0,justifyContent:!0,flexWrap:!0,flexDirection:{transform:jr.flexDirection},flex:!0,flexFlow:!0,flexGrow:!0,flexShrink:!0,flexBasis:Ge.sizes("flexBasis"),justifySelf:!0,alignSelf:!0,order:!0,placeItems:!0,placeContent:!0,placeSelf:!0,gap:Ge.space("gap"),rowGap:Ge.space("rowGap"),columnGap:Ge.space("columnGap")};Object.assign(Bk,{flexDir:Bk.flexDirection});const Gu={width:Ge.sizesT("width"),inlineSize:Ge.sizesT("inlineSize"),height:Ge.sizes("height"),blockSize:Ge.sizes("blockSize"),boxSize:Ge.sizes(["width","height"]),minWidth:Ge.sizes("minWidth"),minInlineSize:Ge.sizes("minInlineSize"),minHeight:Ge.sizes("minHeight"),minBlockSize:Ge.sizes("minBlockSize"),maxWidth:Ge.sizes("maxWidth"),maxInlineSize:Ge.sizes("maxInlineSize"),maxHeight:Ge.sizes("maxHeight"),maxBlockSize:Ge.sizes("maxBlockSize"),overflow:!0,overflowX:!0,overflowY:!0,overscrollBehavior:!0,overscrollBehaviorX:!0,overscrollBehaviorY:!0,display:!0,aspectRatio:!0,hideFrom:{scale:"breakpoints",transform:(n,e)=>{var l,u;return{[`@media screen and (min-width: ${((u=(l=e.__breakpoints)==null?void 0:l.get(n))==null?void 0:u.minW)??n})`]:{display:"none"}}}},hideBelow:{scale:"breakpoints",transform:(n,e)=>{var l,u;return{[`@media screen and (max-width: ${((u=(l=e.__breakpoints)==null?void 0:l.get(n))==null?void 0:u._minW)??n})`]:{display:"none"}}}},verticalAlign:!0,boxSizing:!0,boxDecorationBreak:!0,float:Ge.propT("float",jr.float),objectFit:!0,objectPosition:!0,visibility:!0,isolation:!0};Object.assign(Gu,{w:Gu.width,h:Gu.height,minW:Gu.minWidth,maxW:Gu.maxWidth,minH:Gu.minHeight,maxH:Gu.maxHeight,overscroll:Gu.overscrollBehavior,overscrollX:Gu.overscrollBehaviorX,overscrollY:Gu.overscrollBehaviorY});const sSe={filter:{transform:jr.filter},blur:Ge.blur("--chakra-blur"),brightness:Ge.propT("--chakra-brightness",jr.brightness),contrast:Ge.propT("--chakra-contrast",jr.contrast),hueRotate:Ge.propT("--chakra-hue-rotate",jr.hueRotate),invert:Ge.propT("--chakra-invert",jr.invert),saturate:Ge.propT("--chakra-saturate",jr.saturate),dropShadow:Ge.propT("--chakra-drop-shadow",jr.dropShadow),backdropFilter:{transform:jr.backdropFilter},backdropBlur:Ge.blur("--chakra-backdrop-blur"),backdropBrightness:Ge.propT("--chakra-backdrop-brightness",jr.brightness),backdropContrast:Ge.propT("--chakra-backdrop-contrast",jr.contrast),backdropHueRotate:Ge.propT("--chakra-backdrop-hue-rotate",jr.hueRotate),backdropInvert:Ge.propT("--chakra-backdrop-invert",jr.invert),backdropSaturate:Ge.propT("--chakra-backdrop-saturate",jr.saturate)},oSe={ring:{transform:jr.ring},ringColor:Ge.colors("--chakra-ring-color"),ringOffset:Ge.prop("--chakra-ring-offset-width"),ringOffsetColor:Ge.colors("--chakra-ring-offset-color"),ringInset:Ge.prop("--chakra-ring-inset")},aSe={appearance:!0,cursor:!0,resize:!0,userSelect:!0,pointerEvents:!0,outline:{transform:jr.outline},outlineOffset:!0,outlineColor:Ge.colors("outlineColor")},XZ={gridGap:Ge.space("gridGap"),gridColumnGap:Ge.space("gridColumnGap"),gridRowGap:Ge.space("gridRowGap"),gridColumn:!0,gridRow:!0,gridAutoFlow:!0,gridAutoColumns:!0,gridColumnStart:!0,gridColumnEnd:!0,gridRowStart:!0,gridRowEnd:!0,gridAutoRows:!0,gridTemplate:!0,gridTemplateColumns:!0,gridTemplateRows:!0,gridTemplateAreas:!0,gridArea:!0};function cSe(n,e,i,o){const l=typeof e=="string"?e.split("."):[e];for(o=0;o<l.length&&n;o+=1)n=n[l[o]];return n===void 0?i:n}const lSe=n=>{const e=new WeakMap;return(o,l,u,f)=>{if(typeof o>"u")return n(o,l,u);e.has(o)||e.set(o,new Map);const _=e.get(o);if(_.has(l))return _.get(l);const E=n(o,l,u,f);return _.set(l,E),E}},uSe=lSe(cSe),dSe={border:"0px",clip:"rect(0, 0, 0, 0)",width:"1px",height:"1px",margin:"-1px",padding:"0px",overflow:"hidden",whiteSpace:"nowrap",position:"absolute"},hSe={position:"static",width:"auto",height:"auto",clip:"auto",padding:"0",margin:"0",overflow:"visible",whiteSpace:"normal"},kM=(n,e,i)=>{const o={},l=uSe(n,e,{});for(const u in l)u in i&&i[u]!=null||(o[u]=l[u]);return o},pSe={srOnly:{transform(n){return n===!0?dSe:n==="focusable"?hSe:{}}},layerStyle:{processResult:!0,transform:(n,e,i)=>kM(e,`layerStyles.${n}`,i)},textStyle:{processResult:!0,transform:(n,e,i)=>kM(e,`textStyles.${n}`,i)},apply:{processResult:!0,transform:(n,e,i)=>kM(e,n,i)}},lC={position:!0,pos:Ge.prop("position"),zIndex:Ge.prop("zIndex","zIndices"),inset:Ge.spaceT("inset"),insetX:Ge.spaceT(["left","right"]),insetInline:Ge.spaceT("insetInline"),insetY:Ge.spaceT(["top","bottom"]),insetBlock:Ge.spaceT("insetBlock"),top:Ge.spaceT("top"),insetBlockStart:Ge.spaceT("insetBlockStart"),bottom:Ge.spaceT("bottom"),insetBlockEnd:Ge.spaceT("insetBlockEnd"),left:Ge.spaceT("left"),insetInlineStart:Ge.logical({scale:"space",property:{ltr:"left",rtl:"right"}}),right:Ge.spaceT("right"),insetInlineEnd:Ge.logical({scale:"space",property:{ltr:"right",rtl:"left"}})};Object.assign(lC,{insetStart:lC.insetInlineStart,insetEnd:lC.insetInlineEnd});const rV={boxShadow:Ge.shadows("boxShadow"),mixBlendMode:!0,blendMode:Ge.prop("mixBlendMode"),backgroundBlendMode:!0,bgBlendMode:Ge.prop("backgroundBlendMode"),opacity:!0};Object.assign(rV,{shadow:rV.boxShadow});const rs={margin:Ge.spaceT("margin"),marginTop:Ge.spaceT("marginTop"),marginBlockStart:Ge.spaceT("marginBlockStart"),marginRight:Ge.spaceT("marginRight"),marginInlineEnd:Ge.spaceT("marginInlineEnd"),marginBottom:Ge.spaceT("marginBottom"),marginBlockEnd:Ge.spaceT("marginBlockEnd"),marginLeft:Ge.spaceT("marginLeft"),marginInlineStart:Ge.spaceT("marginInlineStart"),marginX:Ge.spaceT(["marginInlineStart","marginInlineEnd"]),marginInline:Ge.spaceT("marginInline"),marginY:Ge.spaceT(["marginTop","marginBottom"]),marginBlock:Ge.spaceT("marginBlock"),padding:Ge.space("padding"),paddingTop:Ge.space("paddingTop"),paddingBlockStart:Ge.space("paddingBlockStart"),paddingRight:Ge.space("paddingRight"),paddingBottom:Ge.space("paddingBottom"),paddingBlockEnd:Ge.space("paddingBlockEnd"),paddingLeft:Ge.space("paddingLeft"),paddingInlineStart:Ge.space("paddingInlineStart"),paddingInlineEnd:Ge.space("paddingInlineEnd"),paddingX:Ge.space(["paddingInlineStart","paddingInlineEnd"]),paddingInline:Ge.space("paddingInline"),paddingY:Ge.space(["paddingTop","paddingBottom"]),paddingBlock:Ge.space("paddingBlock")};Object.assign(rs,{m:rs.margin,mt:rs.marginTop,mr:rs.marginRight,me:rs.marginInlineEnd,marginEnd:rs.marginInlineEnd,mb:rs.marginBottom,ml:rs.marginLeft,ms:rs.marginInlineStart,marginStart:rs.marginInlineStart,mx:rs.marginX,my:rs.marginY,p:rs.padding,pt:rs.paddingTop,py:rs.paddingY,px:rs.paddingX,pb:rs.paddingBottom,pl:rs.paddingLeft,ps:rs.paddingInlineStart,paddingStart:rs.paddingInlineStart,pr:rs.paddingRight,pe:rs.paddingInlineEnd,paddingEnd:rs.paddingInlineEnd});const fSe={scrollBehavior:!0,scrollSnapAlign:!0,scrollSnapStop:!0,scrollSnapType:!0,scrollMargin:Ge.spaceT("scrollMargin"),scrollMarginTop:Ge.spaceT("scrollMarginTop"),scrollMarginBottom:Ge.spaceT("scrollMarginBottom"),scrollMarginLeft:Ge.spaceT("scrollMarginLeft"),scrollMarginRight:Ge.spaceT("scrollMarginRight"),scrollMarginX:Ge.spaceT(["scrollMarginLeft","scrollMarginRight"]),scrollMarginY:Ge.spaceT(["scrollMarginTop","scrollMarginBottom"]),scrollPadding:Ge.spaceT("scrollPadding"),scrollPaddingTop:Ge.spaceT("scrollPaddingTop"),scrollPaddingBottom:Ge.spaceT("scrollPaddingBottom"),scrollPaddingLeft:Ge.spaceT("scrollPaddingLeft"),scrollPaddingRight:Ge.spaceT("scrollPaddingRight"),scrollPaddingX:Ge.spaceT(["scrollPaddingLeft","scrollPaddingRight"]),scrollPaddingY:Ge.spaceT(["scrollPaddingTop","scrollPaddingBottom"])},mSe={fontFamily:Ge.prop("fontFamily","fonts"),fontSize:Ge.prop("fontSize","fontSizes",jr.px),fontWeight:Ge.prop("fontWeight","fontWeights"),lineHeight:Ge.prop("lineHeight","lineHeights"),letterSpacing:Ge.prop("letterSpacing","letterSpacings"),textAlign:!0,fontStyle:!0,textIndent:!0,wordBreak:!0,overflowWrap:!0,textOverflow:!0,textTransform:!0,whiteSpace:!0,isTruncated:{transform(n){if(n===!0)return{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}}},noOfLines:{static:{overflow:"hidden",textOverflow:"ellipsis",display:"-webkit-box",WebkitBoxOrient:"vertical",WebkitLineClamp:"var(--chakra-line-clamp)"},property:"--chakra-line-clamp"}},gSe={textDecorationColor:Ge.colors("textDecorationColor"),textDecoration:!0,textDecor:{property:"textDecoration"},textDecorationLine:!0,textDecorationStyle:!0,textDecorationThickness:!0,textUnderlineOffset:!0,textShadow:Ge.shadows("textShadow")},_Se={clipPath:!0,transform:Ge.propT("transform",jr.transform),transformOrigin:!0,translateX:Ge.spaceT("--chakra-translate-x"),translateY:Ge.spaceT("--chakra-translate-y"),skewX:Ge.degreeT("--chakra-skew-x"),skewY:Ge.degreeT("--chakra-skew-y"),scaleX:Ge.prop("--chakra-scale-x"),scaleY:Ge.prop("--chakra-scale-y"),scale:Ge.prop(["--chakra-scale-x","--chakra-scale-y"]),rotate:Ge.degreeT("--chakra-rotate")},ySe={listStyleType:!0,listStylePosition:!0,listStylePos:Ge.prop("listStylePosition"),listStyleImage:!0,listStyleImg:Ge.prop("listStyleImage")},ESe={transition:!0,transitionDelay:!0,animation:!0,willChange:!0,transitionDuration:Ge.prop("transitionDuration","transition.duration"),transitionProperty:Ge.prop("transitionProperty","transition.property"),transitionTimingFunction:Ge.prop("transitionTimingFunction","transition.easing")},Bj=sp({},ok,si,iSe,Bk,Gu,sSe,oSe,aSe,XZ,pSe,lC,rV,rs,fSe,mSe,gSe,_Se,ySe,ESe),vSe=Object.assign({},rs,Gu,Bk,XZ,lC),SSe=Object.keys(vSe),bSe=[...Object.keys(Bj),...qZ],wSe={...Bj,...c0},TSe=n=>n in wSe,CSe=n=>e=>{if(!e.__breakpoints)return n;const{isResponsive:i,toArrayValue:o,media:l}=e.__breakpoints,u={};for(const f in n){let _=gl(n[f],e);if(_==null)continue;if(_=Ku(_)&&i(_)?o(_):_,!Array.isArray(_)){u[f]=_;continue}const E=_.slice(0,l.length).length;for(let b=0;b<E;b+=1){const C=l==null?void 0:l[b];if(!C){u[f]=_[b];continue}u[C]=u[C]||{},_[b]!=null&&(u[C][f]=_[b])}}return u};function RSe(n){const e=[];let i="",o=!1;for(let l=0;l<n.length;l++){const u=n[l];u==="("?(o=!0,i+=u):u===")"?(o=!1,i+=u):u===","&&!o?(e.push(i),i=""):i+=u}return i=i.trim(),i&&e.push(i),e}function ISe(n){return/^var\(--.+\)$/.test(n)}const ASe=(n,e)=>n.startsWith("--")&&typeof e=="string"&&!ISe(e),PSe=(n,e)=>{if(e==null)return e;const i=f=>{var _,E;return(E=(_=n.__cssMap)==null?void 0:_[f])==null?void 0:E.varRef},o=f=>i(f)??f,[l,u]=RSe(e);return e=i(l)??o(u)??o(e),e};function OSe(n){const{configs:e={},pseudos:i={},theme:o}=n,l=(u,f=!1)=>{var C;const _=gl(u,o),E=CSe(_)(o);let b={};for(let I in E){const P=E[I];let L=gl(P,o);I in i&&(I=i[I]),ASe(I,L)&&(L=PSe(o,L));let M=e[I];if(M===!0&&(M={property:I}),Ku(L)){b[I]=b[I]??{},b[I]=sp({},b[I],l(L,!0));continue}let F=((C=M==null?void 0:M.transform)==null?void 0:C.call(M,L,o,_))??L;F=M!=null&&M.processResult?l(F,!0):F;const B=gl(M==null?void 0:M.property,o);if(!f&&(M!=null&&M.static)){const Z=gl(M.static,o);b=sp({},b,Z)}if(B&&Array.isArray(B)){for(const Z of B)b[Z]=F;continue}if(B){B==="&"&&Ku(F)?b=sp({},b,F):b[B]=F;continue}if(Ku(F)){b=sp({},b,F);continue}b[I]=F}return b};return l}const JZ=n=>e=>OSe({theme:e,pseudos:c0,configs:Bj})(n);function IHe(n){return n}function AHe(n){return n}function Yi(n){return{definePartsStyle(e){return e},defineMultiStyleConfig(e){return{parts:n,...e}}}}function kSe(n,e,i){var o,l;return((l=(o=n.__cssMap)==null?void 0:o[`${e}.${i}`])==null?void 0:l.varRef)??i}function NSe(n,e){if(Array.isArray(n))return n;if(Ku(n))return e(n);if(n!=null)return[n]}function DSe(n,e){for(let i=e+1;i<n.length;i++)if(n[i]!=null)return i;return-1}function xSe(n){const e=n.__breakpoints;return function(o,l,u,f){var P,L;if(!e)return;const _={},E=NSe(u,e.toArrayValue);if(!E)return _;const b=E.length,C=b===1,I=!!o.parts;for(let M=0;M<b;M++){const F=e.details[M],B=e.details[DSe(E,M)],Z=HT(F.minW,B==null?void 0:B._minW),K=gl((P=o[l])==null?void 0:P[E[M]],f);if(K){if(I){(L=o.parts)==null||L.forEach(re=>{sp(_,{[re]:C?K[re]:{[Z]:K[re]}})});continue}if(!I){C?sp(_,K):_[Z]=K;continue}_[Z]=K}}return _}}function LSe(n){return e=>{const{variant:i,size:o,theme:l}=e,u=xSe(l);return sp({},gl(n.baseStyle??{},e),u(n,"sizes",o,e),u(n,"variants",i,e))}}function Mi(n){return q0(n,["styleConfig","size","variant","colorScheme"])}function QZ(n){return Ku(n)&&n.reference?n.reference:String(n)}const L1=(n,...e)=>e.map(QZ).join(` ${n} `).replace(/calc/g,""),QK=(...n)=>`calc(${L1("+",...n)})`,ZK=(...n)=>`calc(${L1("-",...n)})`,iV=(...n)=>`calc(${L1("*",...n)})`,eq=(...n)=>`calc(${L1("/",...n)})`,tq=n=>{const e=QZ(n);return e!=null&&!Number.isNaN(parseFloat(e))?String(e).startsWith("-")?String(e).slice(1):`-${e}`:iV(e,-1)},Nf=Object.assign(n=>({add:(...e)=>Nf(QK(n,...e)),subtract:(...e)=>Nf(ZK(n,...e)),multiply:(...e)=>Nf(iV(n,...e)),divide:(...e)=>Nf(eq(n,...e)),negate:()=>Nf(tq(n)),toString:()=>n.toString()}),{add:QK,subtract:ZK,multiply:iV,divide:eq,negate:tq});function MSe(n,e="-"){return n.replace(/\s+/g,e)}function USe(n){const e=MSe(n.toString());return jSe(VSe(e))}function VSe(n){return n.includes("\\.")?n:!Number.isInteger(parseFloat(n.toString()))?n.replace(".","\\."):n}function jSe(n){return n.replace(/[!-,/:-@[-^`{-~]/g,"\\$&")}function FSe(n,e=""){return[e,n].filter(Boolean).join("-")}function BSe(n,e){return`var(${n}${e?`, ${e}`:""})`}function WSe(n,e=""){return USe(`--${FSe(n,e)}`)}function Fn(n,e,i){const o=WSe(n,i);return{variable:o,reference:BSe(o,e)}}function zSe(n,e){const i={};for(const o of e){if(Array.isArray(o)){const[l,u]=o;i[l]=Fn(`${n}-${l}`,u);continue}i[o]=Fn(`${n}-${o}`)}return i}const GSe=["colors","borders","borderWidths","borderStyles","fonts","fontSizes","fontWeights","gradients","letterSpacings","lineHeights","radii","space","shadows","sizes","zIndices","transition","blur","breakpoints"];function HSe(n){return xZ(n,GSe)}function $Se(n){return n.semanticTokens}function KSe(n){const{__cssMap:e,__cssVars:i,__breakpoints:o,...l}=n;return l}function qSe(n){const e=HSe(n),i=$Se(n),o=u=>qZ.includes(u)||u==="default",l={};return WK(e,(u,f)=>{u!=null&&(l[f.join(".")]={isSemantic:!1,value:u})}),WK(i,(u,f)=>{u!=null&&(l[f.join(".")]={isSemantic:!0,value:u})},{stop:u=>Object.keys(u).every(o)}),l}function nq(n,e){return Fn(String(n).replace(/\./g,"-"),void 0,e)}function YSe(n){var f;const e=qSe(n),i=(f=n.config)==null?void 0:f.cssVarPrefix;let o={};const l={};function u(_,E){const C=[String(_).split(".")[0],E].join(".");if(!e[C])return E;const{reference:P}=nq(C,i);return P}for(const[_,E]of Object.entries(e)){const{isSemantic:b,value:C}=E,{variable:I,reference:P}=nq(_,i);if(!b){if(_.startsWith("space")){const M=_.split("."),[F,...B]=M,Z=`${F}.-${B.join(".")}`,K=Nf.negate(C),re=Nf.negate(P);l[Z]={value:K,var:I,varRef:re}}o[I]=C,l[_]={value:C,var:I,varRef:P};continue}const L=Ku(C)?C:{default:C};o=sp(o,Object.entries(L).reduce((M,[F,B])=>{if(!B)return M;const Z=u(_,`${B}`);if(F==="default")return M[I]=Z,M;const K=(c0==null?void 0:c0[F])??F;return M[K]={[I]:Z},M},{})),l[_]={value:P,var:I,varRef:P}}return{cssVars:o,cssMap:l}}function XSe(n){const e=KSe(n),{cssMap:i,cssVars:o}=YSe(e);return Object.assign(e,{__cssVars:{...{"--chakra-ring-inset":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-ring-offset-width":"0px","--chakra-ring-offset-color":"#fff","--chakra-ring-color":"rgba(66, 153, 225, 0.6)","--chakra-ring-offset-shadow":"0 0 #0000","--chakra-ring-shadow":"0 0 #0000","--chakra-space-x-reverse":"0","--chakra-space-y-reverse":"0"},...o},__cssMap:i,__breakpoints:BEe(e.breakpoints)}),e}function li(n,e={}){let i=!1;function o(){if(!i){i=!0;return}throw new Error("[anatomy] .part(...) should only be called once. Did you mean to use .extend(...) ?")}function l(...C){o();for(const I of C)e[I]=E(I);return li(n,e)}function u(...C){for(const I of C)I in e||(e[I]=E(I));return li(n,e)}function f(){return Object.fromEntries(Object.entries(e).map(([I,P])=>[I,P.selector]))}function _(){return Object.fromEntries(Object.entries(e).map(([I,P])=>[I,P.className]))}function E(C){const L=`chakra-${(["container","root"].includes(C??"")?[n]:[n,C]).filter(Boolean).join("__")}`;return{className:L,selector:`.${L}`,toString:()=>C}}return{parts:l,toPart:E,extend:u,selectors:f,classnames:_,get keys(){return Object.keys(e)},__type:{}}}const JSe=li("accordion").parts("root","container","button","panel","icon"),QSe=li("alert").parts("title","description","container","icon","spinner"),ZSe=li("avatar").parts("label","badge","container","excessLabel","group"),e0e=li("breadcrumb").parts("link","item","container","separator");li("button").parts();const t0e=li("checkbox").parts("control","icon","container","label");li("progress").parts("track","filledTrack","label");const n0e=li("drawer").parts("overlay","dialogContainer","dialog","header","closeButton","body","footer"),r0e=li("editable").parts("preview","input","textarea"),i0e=li("form").parts("container","requiredIndicator","helperText"),s0e=li("formError").parts("text","icon"),o0e=li("input").parts("addon","field","element","group"),a0e=li("list").parts("container","item","icon"),c0e=li("menu").parts("button","list","item","groupTitle","icon","command","divider"),l0e=li("modal").parts("overlay","dialogContainer","dialog","header","closeButton","body","footer"),u0e=li("numberinput").parts("root","field","stepperGroup","stepper");li("pininput").parts("field");const d0e=li("popover").parts("content","header","body","footer","popper","arrow","closeButton"),h0e=li("progress").parts("label","filledTrack","track"),p0e=li("radio").parts("container","control","label"),f0e=li("select").parts("field","icon"),m0e=li("slider").parts("container","track","thumb","filledTrack","mark"),g0e=li("stat").parts("container","label","helpText","number","icon"),_0e=li("switch").parts("container","track","thumb","label"),y0e=li("table").parts("table","thead","tbody","tr","th","td","tfoot","caption"),E0e=li("tabs").parts("root","tab","tablist","tabpanel","tabpanels","indicator"),v0e=li("tag").parts("container","label","closeButton"),S0e=li("card").parts("container","header","body","footer");li("stepper").parts("stepper","step","title","description","indicator","separator","icon","number");const{definePartsStyle:b0e,defineMultiStyleConfig:w0e}=Yi(JSe.keys),T0e={borderTopWidth:"1px",borderColor:"inherit",_last:{borderBottomWidth:"1px"}},C0e={transitionProperty:"common",transitionDuration:"normal",fontSize:"md",_focusVisible:{boxShadow:"outline"},_hover:{bg:"blackAlpha.50"},_disabled:{opacity:.4,cursor:"not-allowed"},px:"4",py:"2"},R0e={pt:"2",px:"4",pb:"5"},I0e={fontSize:"1.25em"},A0e=b0e({container:T0e,button:C0e,panel:R0e,icon:I0e}),P0e=w0e({baseStyle:A0e});function Ny(n,e,i){return Math.min(Math.max(n,i),e)}class O0e extends Error{constructor(e){super(`Failed to parse color: "${e}"`)}}var KT=O0e;function Wj(n){if(typeof n!="string")throw new KT(n);if(n.trim().toLowerCase()==="transparent")return[0,0,0,0];let e=n.trim();e=V0e.test(n)?D0e(n):n;const i=x0e.exec(e);if(i){const f=Array.from(i).slice(1);return[...f.slice(0,3).map(_=>parseInt(PC(_,2),16)),parseInt(PC(f[3]||"f",2),16)/255]}const o=L0e.exec(e);if(o){const f=Array.from(o).slice(1);return[...f.slice(0,3).map(_=>parseInt(_,16)),parseInt(f[3]||"ff",16)/255]}const l=M0e.exec(e);if(l){const f=Array.from(l).slice(1);return[...f.slice(0,3).map(_=>parseInt(_,10)),parseFloat(f[3]||"1")]}const u=U0e.exec(e);if(u){const[f,_,E,b]=Array.from(u).slice(1).map(parseFloat);if(Ny(0,100,_)!==_)throw new KT(n);if(Ny(0,100,E)!==E)throw new KT(n);return[...j0e(f,_,E),Number.isNaN(b)?1:b]}throw new KT(n)}function k0e(n){let e=5381,i=n.length;for(;i;)e=e*33^n.charCodeAt(--i);return(e>>>0)%2341}const rq=n=>parseInt(n.replace(/_/g,""),36),N0e="1q29ehhb 1n09sgk7 1kl1ekf_ _yl4zsno 16z9eiv3 1p29lhp8 _bd9zg04 17u0____ _iw9zhe5 _to73___ _r45e31e _7l6g016 _jh8ouiv _zn3qba8 1jy4zshs 11u87k0u 1ro9yvyo 1aj3xael 1gz9zjz0 _3w8l4xo 1bf1ekf_ _ke3v___ _4rrkb__ 13j776yz _646mbhl _nrjr4__ _le6mbhl 1n37ehkb _m75f91n _qj3bzfz 1939yygw 11i5z6x8 _1k5f8xs 1509441m 15t5lwgf _ae2th1n _tg1ugcv 1lp1ugcv 16e14up_ _h55rw7n _ny9yavn _7a11xb_ 1ih442g9 _pv442g9 1mv16xof 14e6y7tu 1oo9zkds 17d1cisi _4v9y70f _y98m8kc 1019pq0v 12o9zda8 _348j4f4 1et50i2o _8epa8__ _ts6senj 1o350i2o 1mi9eiuo 1259yrp0 1ln80gnw _632xcoy 1cn9zldc _f29edu4 1n490c8q _9f9ziet 1b94vk74 _m49zkct 1kz6s73a 1eu9dtog _q58s1rz 1dy9sjiq __u89jo3 _aj5nkwg _ld89jo3 13h9z6wx _qa9z2ii _l119xgq _bs5arju 1hj4nwk9 1qt4nwk9 1ge6wau6 14j9zlcw 11p1edc_ _ms1zcxe _439shk6 _jt9y70f _754zsow 1la40eju _oq5p___ _x279qkz 1fa5r3rv _yd2d9ip _424tcku _8y1di2_ _zi2uabw _yy7rn9h 12yz980_ __39ljp6 1b59zg0x _n39zfzp 1fy9zest _b33k___ _hp9wq92 1il50hz4 _io472ub _lj9z3eo 19z9ykg0 _8t8iu3a 12b9bl4a 1ak5yw0o _896v4ku _tb8k8lv _s59zi6t _c09ze0p 1lg80oqn 1id9z8wb _238nba5 1kq6wgdi _154zssg _tn3zk49 _da9y6tc 1sg7cv4f _r12jvtt 1gq5fmkz 1cs9rvci _lp9jn1c _xw1tdnb 13f9zje6 16f6973h _vo7ir40 _bt5arjf _rc45e4t _hr4e100 10v4e100 _hc9zke2 _w91egv_ _sj2r1kk 13c87yx8 _vqpds__ _ni8ggk8 _tj9yqfb 1ia2j4r4 _7x9b10u 1fc9ld4j 1eq9zldr _5j9lhpx _ez9zl6o _md61fzm".split(" ").reduce((n,e)=>{const i=rq(e.substring(0,3)),o=rq(e.substring(3)).toString(16);let l="";for(let u=0;u<6-o.length;u++)l+="0";return n[i]=`${l}${o}`,n},{});function D0e(n){const e=n.toLowerCase().trim(),i=N0e[k0e(e)];if(!i)throw new KT(n);return`#${i}`}const PC=(n,e)=>Array.from(Array(e)).map(()=>n).join(""),x0e=new RegExp(`^#${PC("([a-f0-9])",3)}([a-f0-9])?$`,"i"),L0e=new RegExp(`^#${PC("([a-f0-9]{2})",3)}([a-f0-9]{2})?$`,"i"),M0e=new RegExp(`^rgba?\\(\\s*(\\d+)\\s*${PC(",\\s*(\\d+)\\s*",2)}(?:,\\s*([\\d.]+))?\\s*\\)$`,"i"),U0e=/^hsla?\(\s*([\d.]+)\s*,\s*([\d.]+)%\s*,\s*([\d.]+)%(?:\s*,\s*([\d.]+))?\s*\)$/i,V0e=/^[a-z]+$/i,iq=n=>Math.round(n*255),j0e=(n,e,i)=>{let o=i/100;if(e===0)return[o,o,o].map(iq);const l=(n%360+360)%360/60,u=(1-Math.abs(2*o-1))*(e/100),f=u*(1-Math.abs(l%2-1));let _=0,E=0,b=0;l>=0&&l<1?(_=u,E=f):l>=1&&l<2?(_=f,E=u):l>=2&&l<3?(E=u,b=f):l>=3&&l<4?(E=f,b=u):l>=4&&l<5?(_=f,b=u):l>=5&&l<6&&(_=u,b=f);const C=o-u/2,I=_+C,P=E+C,L=b+C;return[I,P,L].map(iq)};function F0e(n,e,i,o){return`rgba(${Ny(0,255,n).toFixed()}, ${Ny(0,255,e).toFixed()}, ${Ny(0,255,i).toFixed()}, ${parseFloat(Ny(0,1,o).toFixed(3))})`}function B0e(n,e){const[i,o,l,u]=Wj(n);return F0e(i,o,l,u-e)}function W0e(n){const[e,i,o,l]=Wj(n);let u=f=>{const _=Ny(0,255,f).toString(16);return _.length===1?`0${_}`:_};return`#${u(e)}${u(i)}${u(o)}${l<1?u(Math.round(l*255)):""}`}const z0e=n=>Object.keys(n).length===0;function G0e(n,e,i,o,l){for(e=e.split?e.split("."):e,o=0;o<e.length;o++)n=n?n[e[o]]:l;return n===l?i:n}const Nc=(n,e,i)=>{const o=G0e(n,`colors.${e}`,e);try{return W0e(o),o}catch{return i??"#000000"}},H0e=n=>{const[e,i,o]=Wj(n);return(e*299+i*587+o*114)/1e3},$0e=n=>e=>{const i=Nc(e,n);return H0e(i)<128?"dark":"light"},K0e=n=>e=>$0e(n)(e)==="dark",w0=(n,e)=>i=>{const o=Nc(i,n);return B0e(o,1-e)};function sq(n="1rem",e="rgba(255, 255, 255, 0.15)"){return{backgroundImage:`linear-gradient(
    45deg,
    ${e} 25%,
    transparent 25%,
    transparent 50%,
    ${e} 50%,
    ${e} 75%,
    transparent 75%,
    transparent
  )`,backgroundSize:`${n} ${n}`}}const q0e=()=>`#${Math.floor(Math.random()*16777215).toString(16).padEnd(6,"0")}`;function Y0e(n){const e=q0e();return!n||z0e(n)?e:n.string&&n.colors?J0e(n.string,n.colors):n.string&&!n.colors?X0e(n.string):n.colors&&!n.string?Q0e(n.colors):e}function X0e(n){let e=0;if(n.length===0)return e.toString();for(let o=0;o<n.length;o+=1)e=n.charCodeAt(o)+((e<<5)-e),e=e&e;let i="#";for(let o=0;o<3;o+=1){const l=e>>o*8&255;i+=`00${l.toString(16)}`.substr(-2)}return i}function J0e(n,e){let i=0;if(n.length===0)return e[0];for(let o=0;o<n.length;o+=1)i=n.charCodeAt(o)+((i<<5)-i),i=i&i;return i=(i%e.length+e.length)%e.length,e[i]}function Q0e(n){return n[Math.floor(Math.random()*n.length)]}function Vn(n,e){return i=>i.colorMode==="dark"?e:n}function zj(n){const{orientation:e,vertical:i,horizontal:o}=n;return e?e==="vertical"?i:o:{}}function ZZ(n){return Ku(n)&&n.reference?n.reference:String(n)}const M1=(n,...e)=>e.map(ZZ).join(` ${n} `).replace(/calc/g,""),oq=(...n)=>`calc(${M1("+",...n)})`,aq=(...n)=>`calc(${M1("-",...n)})`,sV=(...n)=>`calc(${M1("*",...n)})`,cq=(...n)=>`calc(${M1("/",...n)})`,lq=n=>{const e=ZZ(n);return e!=null&&!Number.isNaN(parseFloat(e))?String(e).startsWith("-")?String(e).slice(1):`-${e}`:sV(e,-1)},Df=Object.assign(n=>({add:(...e)=>Df(oq(n,...e)),subtract:(...e)=>Df(aq(n,...e)),multiply:(...e)=>Df(sV(n,...e)),divide:(...e)=>Df(cq(n,...e)),negate:()=>Df(lq(n)),toString:()=>n.toString()}),{add:oq,subtract:aq,multiply:sV,divide:cq,negate:lq});function Z0e(n){return!Number.isInteger(parseFloat(n.toString()))}function ebe(n,e="-"){return n.replace(/\s+/g,e)}function eee(n){const e=ebe(n.toString());return e.includes("\\.")?n:Z0e(n)?e.replace(".","\\."):n}function tbe(n,e=""){return[e,eee(n)].filter(Boolean).join("-")}function nbe(n,e){return`var(${eee(n)}${e?`, ${e}`:""})`}function rbe(n,e=""){return`--${tbe(n,e)}`}function Mo(n,e){const i=rbe(n,e==null?void 0:e.prefix);return{variable:i,reference:nbe(i,ibe(e==null?void 0:e.fallback))}}function ibe(n){return n==null?void 0:n.reference}const{definePartsStyle:cR,defineMultiStyleConfig:sbe}=Yi(QSe.keys),Xl=Fn("alert-fg"),Jf=Fn("alert-bg"),obe=cR({container:{bg:Jf.reference,px:"4",py:"3"},title:{fontWeight:"bold",lineHeight:"6",marginEnd:"2"},description:{lineHeight:"6"},icon:{color:Xl.reference,flexShrink:0,marginEnd:"3",w:"5",h:"6"},spinner:{color:Xl.reference,flexShrink:0,marginEnd:"3",w:"5",h:"5"}});function Gj(n){const{theme:e,colorScheme:i}=n,o=w0(`${i}.200`,.16)(e);return{light:`colors.${i}.100`,dark:o}}const abe=cR(n=>{const{colorScheme:e}=n,i=Gj(n);return{container:{[Xl.variable]:`colors.${e}.600`,[Jf.variable]:i.light,_dark:{[Xl.variable]:`colors.${e}.200`,[Jf.variable]:i.dark}}}}),cbe=cR(n=>{const{colorScheme:e}=n,i=Gj(n);return{container:{[Xl.variable]:`colors.${e}.600`,[Jf.variable]:i.light,_dark:{[Xl.variable]:`colors.${e}.200`,[Jf.variable]:i.dark},paddingStart:"3",borderStartWidth:"4px",borderStartColor:Xl.reference}}}),lbe=cR(n=>{const{colorScheme:e}=n,i=Gj(n);return{container:{[Xl.variable]:`colors.${e}.600`,[Jf.variable]:i.light,_dark:{[Xl.variable]:`colors.${e}.200`,[Jf.variable]:i.dark},pt:"2",borderTopWidth:"4px",borderTopColor:Xl.reference}}}),ube=cR(n=>{const{colorScheme:e}=n;return{container:{[Xl.variable]:"colors.white",[Jf.variable]:`colors.${e}.600`,_dark:{[Xl.variable]:"colors.gray.900",[Jf.variable]:`colors.${e}.200`},color:Xl.reference}}}),dbe={subtle:abe,"left-accent":cbe,"top-accent":lbe,solid:ube},hbe=sbe({baseStyle:obe,variants:dbe,defaultProps:{variant:"subtle",colorScheme:"blue"}}),tee={px:"1px",.5:"0.125rem",1:"0.25rem",1.5:"0.375rem",2:"0.5rem",2.5:"0.625rem",3:"0.75rem",3.5:"0.875rem",4:"1rem",5:"1.25rem",6:"1.5rem",7:"1.75rem",8:"2rem",9:"2.25rem",10:"2.5rem",12:"3rem",14:"3.5rem",16:"4rem",20:"5rem",24:"6rem",28:"7rem",32:"8rem",36:"9rem",40:"10rem",44:"11rem",48:"12rem",52:"13rem",56:"14rem",60:"15rem",64:"16rem",72:"18rem",80:"20rem",96:"24rem"},pbe={max:"max-content",min:"min-content",full:"100%","3xs":"14rem","2xs":"16rem",xs:"20rem",sm:"24rem",md:"28rem",lg:"32rem",xl:"36rem","2xl":"42rem","3xl":"48rem","4xl":"56rem","5xl":"64rem","6xl":"72rem","7xl":"80rem","8xl":"90rem",prose:"60ch"},fbe={sm:"640px",md:"768px",lg:"1024px",xl:"1280px"},nee={...tee,...pbe,container:fbe},mbe=n=>typeof n=="function";function Dc(n,...e){return mbe(n)?n(...e):n}const{definePartsStyle:ree,defineMultiStyleConfig:gbe}=Yi(ZSe.keys),l0=Fn("avatar-border-color"),uC=Fn("avatar-bg"),OC=Fn("avatar-font-size"),T0=Fn("avatar-size"),_be={borderRadius:"full",border:"0.2em solid",borderColor:l0.reference,[l0.variable]:"white",_dark:{[l0.variable]:"colors.gray.800"}},ybe={bg:uC.reference,fontSize:OC.reference,width:T0.reference,height:T0.reference,lineHeight:"1",[uC.variable]:"colors.gray.200",_dark:{[uC.variable]:"colors.whiteAlpha.400"}},Ebe=n=>{const{name:e,theme:i}=n,o=e?Y0e({string:e}):"colors.gray.400",l=K0e(o)(i);let u="white";return l||(u="gray.800"),{bg:uC.reference,fontSize:OC.reference,color:u,borderColor:l0.reference,verticalAlign:"top",width:T0.reference,height:T0.reference,"&:not([data-loaded])":{[uC.variable]:o},[l0.variable]:"colors.white",_dark:{[l0.variable]:"colors.gray.800"}}},vbe={fontSize:OC.reference,lineHeight:"1"},Sbe=ree(n=>({badge:Dc(_be,n),excessLabel:Dc(ybe,n),container:Dc(Ebe,n),label:vbe}));function _g(n){const e=n!=="100%"?nee[n]:void 0;return ree({container:{[T0.variable]:e??n,[OC.variable]:`calc(${e??n} / 2.5)`},excessLabel:{[T0.variable]:e??n,[OC.variable]:`calc(${e??n} / 2.5)`}})}const bbe={"2xs":_g(4),xs:_g(6),sm:_g(8),md:_g(12),lg:_g(16),xl:_g(24),"2xl":_g(32),full:_g("100%")},wbe=gbe({baseStyle:Sbe,sizes:bbe,defaultProps:{size:"md"}}),io=zSe("badge",["bg","color","shadow"]),Tbe={px:1,textTransform:"uppercase",fontSize:"xs",borderRadius:"sm",fontWeight:"bold",bg:io.bg.reference,color:io.color.reference,boxShadow:io.shadow.reference},Cbe=n=>{const{colorScheme:e,theme:i}=n,o=w0(`${e}.500`,.6)(i);return{[io.bg.variable]:`colors.${e}.500`,[io.color.variable]:"colors.white",_dark:{[io.bg.variable]:o,[io.color.variable]:"colors.whiteAlpha.800"}}},Rbe=n=>{const{colorScheme:e,theme:i}=n,o=w0(`${e}.200`,.16)(i);return{[io.bg.variable]:`colors.${e}.100`,[io.color.variable]:`colors.${e}.800`,_dark:{[io.bg.variable]:o,[io.color.variable]:`colors.${e}.200`}}},Ibe=n=>{const{colorScheme:e,theme:i}=n,o=w0(`${e}.200`,.8)(i);return{[io.color.variable]:`colors.${e}.500`,_dark:{[io.color.variable]:o},[io.shadow.variable]:`inset 0 0 0px 1px ${io.color.reference}`}},Abe={solid:Cbe,subtle:Rbe,outline:Ibe},dC={baseStyle:Tbe,variants:Abe,defaultProps:{variant:"subtle",colorScheme:"gray"}},{defineMultiStyleConfig:Pbe,definePartsStyle:Obe}=Yi(e0e.keys),NM=Fn("breadcrumb-link-decor"),kbe={transitionProperty:"common",transitionDuration:"fast",transitionTimingFunction:"ease-out",outline:"none",color:"inherit",textDecoration:NM.reference,[NM.variable]:"none","&:not([aria-current=page])":{cursor:"pointer",_hover:{[NM.variable]:"underline"},_focusVisible:{boxShadow:"outline"}}},Nbe=Obe({link:kbe}),Dbe=Pbe({baseStyle:Nbe}),xbe={lineHeight:"1.2",borderRadius:"md",fontWeight:"semibold",transitionProperty:"common",transitionDuration:"normal",_focusVisible:{boxShadow:"outline"},_disabled:{opacity:.4,cursor:"not-allowed",boxShadow:"none"},_hover:{_disabled:{bg:"initial"}}},iee=n=>{const{colorScheme:e,theme:i}=n;if(e==="gray")return{color:Vn("gray.800","whiteAlpha.900")(n),_hover:{bg:Vn("gray.100","whiteAlpha.200")(n)},_active:{bg:Vn("gray.200","whiteAlpha.300")(n)}};const o=w0(`${e}.200`,.12)(i),l=w0(`${e}.200`,.24)(i);return{color:Vn(`${e}.600`,`${e}.200`)(n),bg:"transparent",_hover:{bg:Vn(`${e}.50`,o)(n)},_active:{bg:Vn(`${e}.100`,l)(n)}}},Lbe=n=>{const{colorScheme:e}=n,i=Vn("gray.200","whiteAlpha.300")(n);return{border:"1px solid",borderColor:e==="gray"?i:"currentColor",".chakra-button__group[data-attached][data-orientation=horizontal] > &:not(:last-of-type)":{marginEnd:"-1px"},".chakra-button__group[data-attached][data-orientation=vertical] > &:not(:last-of-type)":{marginBottom:"-1px"},...Dc(iee,n)}},Mbe={yellow:{bg:"yellow.400",color:"black",hoverBg:"yellow.500",activeBg:"yellow.600"},cyan:{bg:"cyan.400",color:"black",hoverBg:"cyan.500",activeBg:"cyan.600"}},Ube=n=>{const{colorScheme:e}=n;if(e==="gray"){const _=Vn("gray.100","whiteAlpha.200")(n);return{bg:_,color:Vn("gray.800","whiteAlpha.900")(n),_hover:{bg:Vn("gray.200","whiteAlpha.300")(n),_disabled:{bg:_}},_active:{bg:Vn("gray.300","whiteAlpha.400")(n)}}}const{bg:i=`${e}.500`,color:o="white",hoverBg:l=`${e}.600`,activeBg:u=`${e}.700`}=Mbe[e]??{},f=Vn(i,`${e}.200`)(n);return{bg:f,color:Vn(o,"gray.800")(n),_hover:{bg:Vn(l,`${e}.300`)(n),_disabled:{bg:f}},_active:{bg:Vn(u,`${e}.400`)(n)}}},Vbe=n=>{const{colorScheme:e}=n;return{padding:0,height:"auto",lineHeight:"normal",verticalAlign:"baseline",color:Vn(`${e}.500`,`${e}.200`)(n),_hover:{textDecoration:"underline",_disabled:{textDecoration:"none"}},_active:{color:Vn(`${e}.700`,`${e}.500`)(n)}}},jbe={bg:"none",color:"inherit",display:"inline",lineHeight:"inherit",m:"0",p:"0"},Fbe={ghost:iee,outline:Lbe,solid:Ube,link:Vbe,unstyled:jbe},Bbe={lg:{h:"12",minW:"12",fontSize:"lg",px:"6"},md:{h:"10",minW:"10",fontSize:"md",px:"4"},sm:{h:"8",minW:"8",fontSize:"sm",px:"3"},xs:{h:"6",minW:"6",fontSize:"xs",px:"2"}},Wbe={baseStyle:xbe,variants:Fbe,sizes:Bbe,defaultProps:{variant:"solid",size:"md",colorScheme:"gray"}},{definePartsStyle:Vy,defineMultiStyleConfig:zbe}=Yi(S0e.keys),Wk=Fn("card-bg"),Gf=Fn("card-padding"),see=Fn("card-shadow"),ak=Fn("card-radius"),oee=Fn("card-border-width","0"),aee=Fn("card-border-color"),Gbe=Vy({container:{[Wk.variable]:"colors.chakra-body-bg",backgroundColor:Wk.reference,boxShadow:see.reference,borderRadius:ak.reference,color:"chakra-body-text",borderWidth:oee.reference,borderColor:aee.reference},body:{padding:Gf.reference,flex:"1 1 0%"},header:{padding:Gf.reference},footer:{padding:Gf.reference}}),Hbe={sm:Vy({container:{[ak.variable]:"radii.base",[Gf.variable]:"space.3"}}),md:Vy({container:{[ak.variable]:"radii.md",[Gf.variable]:"space.5"}}),lg:Vy({container:{[ak.variable]:"radii.xl",[Gf.variable]:"space.7"}})},$be={elevated:Vy({container:{[see.variable]:"shadows.base",_dark:{[Wk.variable]:"colors.gray.700"}}}),outline:Vy({container:{[oee.variable]:"1px",[aee.variable]:"colors.chakra-border-color"}}),filled:Vy({container:{[Wk.variable]:"colors.chakra-subtle-bg"}}),unstyled:{body:{[Gf.variable]:0},header:{[Gf.variable]:0},footer:{[Gf.variable]:0}}},Kbe=zbe({baseStyle:Gbe,variants:$be,sizes:Hbe,defaultProps:{variant:"elevated",size:"md"}}),{definePartsStyle:ck,defineMultiStyleConfig:qbe}=Yi(t0e.keys),hC=Fn("checkbox-size"),Ybe=n=>{const{colorScheme:e}=n;return{w:hC.reference,h:hC.reference,transitionProperty:"box-shadow",transitionDuration:"normal",border:"2px solid",borderRadius:"sm",borderColor:"inherit",color:"white",_checked:{bg:Vn(`${e}.500`,`${e}.200`)(n),borderColor:Vn(`${e}.500`,`${e}.200`)(n),color:Vn("white","gray.900")(n),_hover:{bg:Vn(`${e}.600`,`${e}.300`)(n),borderColor:Vn(`${e}.600`,`${e}.300`)(n)},_disabled:{borderColor:Vn("gray.200","transparent")(n),bg:Vn("gray.200","whiteAlpha.300")(n),color:Vn("gray.500","whiteAlpha.500")(n)}},_indeterminate:{bg:Vn(`${e}.500`,`${e}.200`)(n),borderColor:Vn(`${e}.500`,`${e}.200`)(n),color:Vn("white","gray.900")(n)},_disabled:{bg:Vn("gray.100","whiteAlpha.100")(n),borderColor:Vn("gray.100","transparent")(n)},_focusVisible:{boxShadow:"outline"},_invalid:{borderColor:Vn("red.500","red.300")(n)}}},Xbe={_disabled:{cursor:"not-allowed"}},Jbe={userSelect:"none",_disabled:{opacity:.4}},Qbe={transitionProperty:"transform",transitionDuration:"normal"},Zbe=ck(n=>({icon:Qbe,container:Xbe,control:Dc(Ybe,n),label:Jbe})),ewe={sm:ck({control:{[hC.variable]:"sizes.3"},label:{fontSize:"sm"},icon:{fontSize:"3xs"}}),md:ck({control:{[hC.variable]:"sizes.4"},label:{fontSize:"md"},icon:{fontSize:"2xs"}}),lg:ck({control:{[hC.variable]:"sizes.5"},label:{fontSize:"lg"},icon:{fontSize:"2xs"}})},wg=qbe({baseStyle:Zbe,sizes:ewe,defaultProps:{size:"md",colorScheme:"blue"}}),pC=Mo("close-button-size"),TT=Mo("close-button-bg"),twe={w:[pC.reference],h:[pC.reference],borderRadius:"md",transitionProperty:"common",transitionDuration:"normal",_disabled:{opacity:.4,cursor:"not-allowed",boxShadow:"none"},_hover:{[TT.variable]:"colors.blackAlpha.100",_dark:{[TT.variable]:"colors.whiteAlpha.100"}},_active:{[TT.variable]:"colors.blackAlpha.200",_dark:{[TT.variable]:"colors.whiteAlpha.200"}},_focusVisible:{boxShadow:"outline"},bg:TT.reference},nwe={lg:{[pC.variable]:"sizes.10",fontSize:"md"},md:{[pC.variable]:"sizes.8",fontSize:"xs"},sm:{[pC.variable]:"sizes.6",fontSize:"2xs"}},rwe={baseStyle:twe,sizes:nwe,defaultProps:{size:"md"}},{variants:iwe,defaultProps:swe}=dC,owe={fontFamily:"mono",fontSize:"sm",px:"0.2em",borderRadius:"sm",bg:io.bg.reference,color:io.color.reference,boxShadow:io.shadow.reference},awe={baseStyle:owe,variants:iwe,defaultProps:swe},cwe={w:"100%",mx:"auto",maxW:"prose",px:"4"},lwe={baseStyle:cwe},uwe={opacity:.6,borderColor:"inherit"},dwe={borderStyle:"solid"},hwe={borderStyle:"dashed"},pwe={solid:dwe,dashed:hwe},fwe={baseStyle:uwe,variants:pwe,defaultProps:{variant:"solid"}},{definePartsStyle:oV,defineMultiStyleConfig:mwe}=Yi(n0e.keys),DM=Fn("drawer-bg"),xM=Fn("drawer-box-shadow");function kS(n){return oV(n==="full"?{dialog:{maxW:"100vw",h:"100vh"}}:{dialog:{maxW:n}})}const gwe={bg:"blackAlpha.600",zIndex:"modal"},_we={display:"flex",zIndex:"modal",justifyContent:"center"},ywe=n=>{const{isFullHeight:e}=n;return{...e&&{height:"100vh"},zIndex:"modal",maxH:"100vh",color:"inherit",[DM.variable]:"colors.white",[xM.variable]:"shadows.lg",_dark:{[DM.variable]:"colors.gray.700",[xM.variable]:"shadows.dark-lg"},bg:DM.reference,boxShadow:xM.reference}},Ewe={px:"6",py:"4",fontSize:"xl",fontWeight:"semibold"},vwe={position:"absolute",top:"2",insetEnd:"3"},Swe={px:"6",py:"2",flex:"1",overflow:"auto"},bwe={px:"6",py:"4"},wwe=oV(n=>({overlay:gwe,dialogContainer:_we,dialog:Dc(ywe,n),header:Ewe,closeButton:vwe,body:Swe,footer:bwe})),Twe={xs:kS("xs"),sm:kS("md"),md:kS("lg"),lg:kS("2xl"),xl:kS("4xl"),full:kS("full")},Cwe=mwe({baseStyle:wwe,sizes:Twe,defaultProps:{size:"xs"}}),{definePartsStyle:Rwe,defineMultiStyleConfig:Iwe}=Yi(r0e.keys),Awe={borderRadius:"md",py:"1",transitionProperty:"common",transitionDuration:"normal"},Pwe={borderRadius:"md",py:"1",transitionProperty:"common",transitionDuration:"normal",width:"full",_focusVisible:{boxShadow:"outline"},_placeholder:{opacity:.6}},Owe={borderRadius:"md",py:"1",transitionProperty:"common",transitionDuration:"normal",width:"full",_focusVisible:{boxShadow:"outline"},_placeholder:{opacity:.6}},kwe=Rwe({preview:Awe,input:Pwe,textarea:Owe}),Nwe=Iwe({baseStyle:kwe}),{definePartsStyle:Dwe,defineMultiStyleConfig:xwe}=Yi(i0e.keys),u0=Fn("form-control-color"),Lwe={marginStart:"1",[u0.variable]:"colors.red.500",_dark:{[u0.variable]:"colors.red.300"},color:u0.reference},Mwe={mt:"2",[u0.variable]:"colors.gray.600",_dark:{[u0.variable]:"colors.whiteAlpha.600"},color:u0.reference,lineHeight:"normal",fontSize:"sm"},Uwe=Dwe({container:{width:"100%",position:"relative"},requiredIndicator:Lwe,helperText:Mwe}),Vwe=xwe({baseStyle:Uwe}),{definePartsStyle:jwe,defineMultiStyleConfig:Fwe}=Yi(s0e.keys),d0=Fn("form-error-color"),Bwe={[d0.variable]:"colors.red.500",_dark:{[d0.variable]:"colors.red.300"},color:d0.reference,mt:"2",fontSize:"sm",lineHeight:"normal"},Wwe={marginEnd:"0.5em",[d0.variable]:"colors.red.500",_dark:{[d0.variable]:"colors.red.300"},color:d0.reference},zwe=jwe({text:Bwe,icon:Wwe}),Gwe=Fwe({baseStyle:zwe}),Hwe={fontSize:"md",marginEnd:"3",mb:"2",fontWeight:"medium",transitionProperty:"common",transitionDuration:"normal",opacity:1,_disabled:{opacity:.4}},$we={baseStyle:Hwe},Kwe={fontFamily:"heading",fontWeight:"bold"},qwe={"4xl":{fontSize:["6xl",null,"7xl"],lineHeight:1},"3xl":{fontSize:["5xl",null,"6xl"],lineHeight:1},"2xl":{fontSize:["4xl",null,"5xl"],lineHeight:[1.2,null,1]},xl:{fontSize:["3xl",null,"4xl"],lineHeight:[1.33,null,1.2]},lg:{fontSize:["2xl",null,"3xl"],lineHeight:[1.33,null,1.2]},md:{fontSize:"xl",lineHeight:1.2},sm:{fontSize:"md",lineHeight:1.2},xs:{fontSize:"sm",lineHeight:1.2}},Ywe={baseStyle:Kwe,sizes:qwe,defaultProps:{size:"xl"}},{definePartsStyle:Uf,defineMultiStyleConfig:Xwe}=Yi(o0e.keys),HS=Fn("input-height"),$S=Fn("input-font-size"),KS=Fn("input-padding"),qS=Fn("input-border-radius"),Jwe=Uf({addon:{height:HS.reference,fontSize:$S.reference,px:KS.reference,borderRadius:qS.reference},field:{width:"100%",height:HS.reference,fontSize:$S.reference,px:KS.reference,borderRadius:qS.reference,minWidth:0,outline:0,position:"relative",appearance:"none",transitionProperty:"common",transitionDuration:"normal",_disabled:{opacity:.4,cursor:"not-allowed"}}}),yg={lg:{[$S.variable]:"fontSizes.lg",[KS.variable]:"space.4",[qS.variable]:"radii.md",[HS.variable]:"sizes.12"},md:{[$S.variable]:"fontSizes.md",[KS.variable]:"space.4",[qS.variable]:"radii.md",[HS.variable]:"sizes.10"},sm:{[$S.variable]:"fontSizes.sm",[KS.variable]:"space.3",[qS.variable]:"radii.sm",[HS.variable]:"sizes.8"},xs:{[$S.variable]:"fontSizes.xs",[KS.variable]:"space.2",[qS.variable]:"radii.sm",[HS.variable]:"sizes.6"}},Qwe={lg:Uf({field:yg.lg,group:yg.lg}),md:Uf({field:yg.md,group:yg.md}),sm:Uf({field:yg.sm,group:yg.sm}),xs:Uf({field:yg.xs,group:yg.xs})};function Hj(n){const{focusBorderColor:e,errorBorderColor:i}=n;return{focusBorderColor:e||Vn("blue.500","blue.300")(n),errorBorderColor:i||Vn("red.500","red.300")(n)}}const Zwe=Uf(n=>{const{theme:e}=n,{focusBorderColor:i,errorBorderColor:o}=Hj(n);return{field:{border:"1px solid",borderColor:"inherit",bg:"inherit",_hover:{borderColor:Vn("gray.300","whiteAlpha.400")(n)},_readOnly:{boxShadow:"none !important",userSelect:"all"},_invalid:{borderColor:Nc(e,o),boxShadow:`0 0 0 1px ${Nc(e,o)}`},_focusVisible:{zIndex:1,borderColor:Nc(e,i),boxShadow:`0 0 0 1px ${Nc(e,i)}`}},addon:{border:"1px solid",borderColor:Vn("inherit","whiteAlpha.50")(n),bg:Vn("gray.100","whiteAlpha.300")(n)}}}),eTe=Uf(n=>{const{theme:e}=n,{focusBorderColor:i,errorBorderColor:o}=Hj(n);return{field:{border:"2px solid",borderColor:"transparent",bg:Vn("gray.100","whiteAlpha.50")(n),_hover:{bg:Vn("gray.200","whiteAlpha.100")(n)},_readOnly:{boxShadow:"none !important",userSelect:"all"},_invalid:{borderColor:Nc(e,o)},_focusVisible:{bg:"transparent",borderColor:Nc(e,i)}},addon:{border:"2px solid",borderColor:"transparent",bg:Vn("gray.100","whiteAlpha.50")(n)}}}),tTe=Uf(n=>{const{theme:e}=n,{focusBorderColor:i,errorBorderColor:o}=Hj(n);return{field:{borderBottom:"1px solid",borderColor:"inherit",borderRadius:"0",px:"0",bg:"transparent",_readOnly:{boxShadow:"none !important",userSelect:"all"},_invalid:{borderColor:Nc(e,o),boxShadow:`0px 1px 0px 0px ${Nc(e,o)}`},_focusVisible:{borderColor:Nc(e,i),boxShadow:`0px 1px 0px 0px ${Nc(e,i)}`}},addon:{borderBottom:"2px solid",borderColor:"inherit",borderRadius:"0",px:"0",bg:"transparent"}}}),nTe=Uf({field:{bg:"transparent",px:"0",height:"auto"},addon:{bg:"transparent",px:"0",height:"auto"}}),rTe={outline:Zwe,filled:eTe,flushed:tTe,unstyled:nTe},ci=Xwe({baseStyle:Jwe,sizes:Qwe,variants:rTe,defaultProps:{size:"md",variant:"outline"}}),LM=Fn("kbd-bg"),iTe={[LM.variable]:"colors.gray.100",_dark:{[LM.variable]:"colors.whiteAlpha.100"},bg:LM.reference,borderRadius:"md",borderWidth:"1px",borderBottomWidth:"3px",fontSize:"0.8em",fontWeight:"bold",lineHeight:"normal",px:"0.4em",whiteSpace:"nowrap"},sTe={baseStyle:iTe},oTe={transitionProperty:"common",transitionDuration:"fast",transitionTimingFunction:"ease-out",cursor:"pointer",textDecoration:"none",outline:"none",color:"inherit",_hover:{textDecoration:"underline"},_focusVisible:{boxShadow:"outline"}},aTe={baseStyle:oTe},{defineMultiStyleConfig:cTe,definePartsStyle:lTe}=Yi(a0e.keys),uTe={marginEnd:"2",display:"inline",verticalAlign:"text-bottom"},dTe=lTe({icon:uTe}),hTe=cTe({baseStyle:dTe}),{defineMultiStyleConfig:pTe,definePartsStyle:fTe}=Yi(c0e.keys),Xh=Fn("menu-bg"),MM=Fn("menu-shadow"),mTe={[Xh.variable]:"#fff",[MM.variable]:"shadows.sm",_dark:{[Xh.variable]:"colors.gray.700",[MM.variable]:"shadows.dark-lg"},color:"inherit",minW:"3xs",py:"2",zIndex:"dropdown",borderRadius:"md",borderWidth:"1px",bg:Xh.reference,boxShadow:MM.reference},gTe={py:"1.5",px:"3",transitionProperty:"background",transitionDuration:"ultra-fast",transitionTimingFunction:"ease-in",_focus:{[Xh.variable]:"colors.gray.100",_dark:{[Xh.variable]:"colors.whiteAlpha.100"}},_active:{[Xh.variable]:"colors.gray.200",_dark:{[Xh.variable]:"colors.whiteAlpha.200"}},_expanded:{[Xh.variable]:"colors.gray.100",_dark:{[Xh.variable]:"colors.whiteAlpha.100"}},_disabled:{opacity:.4,cursor:"not-allowed"},bg:Xh.reference},_Te={mx:4,my:2,fontWeight:"semibold",fontSize:"sm"},yTe={display:"inline-flex",alignItems:"center",justifyContent:"center",flexShrink:0},ETe={opacity:.6},vTe={border:0,borderBottom:"1px solid",borderColor:"inherit",my:"2",opacity:.6},STe={transitionProperty:"common",transitionDuration:"normal"},bTe=fTe({button:STe,list:mTe,item:gTe,groupTitle:_Te,icon:yTe,command:ETe,divider:vTe}),wTe=pTe({baseStyle:bTe}),{defineMultiStyleConfig:TTe,definePartsStyle:aV}=Yi(l0e.keys),UM=Fn("modal-bg"),VM=Fn("modal-shadow"),CTe={bg:"blackAlpha.600",zIndex:"modal"},RTe=n=>{const{isCentered:e,scrollBehavior:i}=n;return{display:"flex",zIndex:"modal",justifyContent:"center",alignItems:e?"center":"flex-start",overflow:i==="inside"?"hidden":"auto",overscrollBehaviorY:"none"}},ITe=n=>{const{isCentered:e,scrollBehavior:i}=n;return{borderRadius:"md",color:"inherit",my:e?"auto":"16",mx:e?"auto":void 0,zIndex:"modal",maxH:i==="inside"?"calc(100% - 7.5rem)":void 0,[UM.variable]:"colors.white",[VM.variable]:"shadows.lg",_dark:{[UM.variable]:"colors.gray.700",[VM.variable]:"shadows.dark-lg"},bg:UM.reference,boxShadow:VM.reference}},ATe={px:"6",py:"4",fontSize:"xl",fontWeight:"semibold"},PTe={position:"absolute",top:"2",insetEnd:"3"},OTe=n=>{const{scrollBehavior:e}=n;return{px:"6",py:"2",flex:"1",overflow:e==="inside"?"auto":void 0}},kTe={px:"6",py:"4"},NTe=aV(n=>({overlay:CTe,dialogContainer:Dc(RTe,n),dialog:Dc(ITe,n),header:ATe,closeButton:PTe,body:Dc(OTe,n),footer:kTe}));function Wd(n){return aV(n==="full"?{dialog:{maxW:"100vw",minH:"$100vh",my:"0",borderRadius:"0"}}:{dialog:{maxW:n}})}const DTe={xs:Wd("xs"),sm:Wd("sm"),md:Wd("md"),lg:Wd("lg"),xl:Wd("xl"),"2xl":Wd("2xl"),"3xl":Wd("3xl"),"4xl":Wd("4xl"),"5xl":Wd("5xl"),"6xl":Wd("6xl"),full:Wd("full")},xTe=TTe({baseStyle:NTe,sizes:DTe,defaultProps:{size:"md"}}),cee={letterSpacings:{tighter:"-0.05em",tight:"-0.025em",normal:"0",wide:"0.025em",wider:"0.05em",widest:"0.1em"},lineHeights:{normal:"normal",none:1,shorter:1.25,short:1.375,base:1.5,tall:1.625,taller:"2",3:".75rem",4:"1rem",5:"1.25rem",6:"1.5rem",7:"1.75rem",8:"2rem",9:"2.25rem",10:"2.5rem"},fontWeights:{hairline:100,thin:200,light:300,normal:400,medium:500,semibold:600,bold:700,extrabold:800,black:900},fonts:{heading:'-apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"',body:'-apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"',mono:'SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace'},fontSizes:{"3xs":"0.45rem","2xs":"0.625rem",xs:"0.75rem",sm:"0.875rem",md:"1rem",lg:"1.125rem",xl:"1.25rem","2xl":"1.5rem","3xl":"1.875rem","4xl":"2.25rem","5xl":"3rem","6xl":"3.75rem","7xl":"4.5rem","8xl":"6rem","9xl":"8rem"}},{defineMultiStyleConfig:LTe,definePartsStyle:lee}=Yi(u0e.keys),$j=Mo("number-input-stepper-width"),uee=Mo("number-input-input-padding"),MTe=Df($j).add("0.5rem").toString(),jM=Mo("number-input-bg"),FM=Mo("number-input-color"),BM=Mo("number-input-border-color"),UTe={[$j.variable]:"sizes.6",[uee.variable]:MTe},VTe=n=>{var e;return((e=Dc(ci.baseStyle,n))==null?void 0:e.field)??{}},jTe={width:$j.reference},FTe={borderStart:"1px solid",borderStartColor:BM.reference,color:FM.reference,bg:jM.reference,[FM.variable]:"colors.chakra-body-text",[BM.variable]:"colors.chakra-border-color",_dark:{[FM.variable]:"colors.whiteAlpha.800",[BM.variable]:"colors.whiteAlpha.300"},_active:{[jM.variable]:"colors.gray.200",_dark:{[jM.variable]:"colors.whiteAlpha.300"}},_disabled:{opacity:.4,cursor:"not-allowed"}},BTe=lee(n=>({root:UTe,field:Dc(VTe,n)??{},stepperGroup:jTe,stepper:FTe}));function RO(n){var u,f;const e=(u=ci.sizes)==null?void 0:u[n],i={lg:"md",md:"md",sm:"sm",xs:"sm"},o=((f=e.field)==null?void 0:f.fontSize)??"md",l=cee.fontSizes[o];return lee({field:{...e.field,paddingInlineEnd:uee.reference,verticalAlign:"top"},stepper:{fontSize:Df(l).multiply(.75).toString(),_first:{borderTopEndRadius:i[n]},_last:{borderBottomEndRadius:i[n],mt:"-1px",borderTopWidth:1}}})}const WTe={xs:RO("xs"),sm:RO("sm"),md:RO("md"),lg:RO("lg")},zTe=LTe({baseStyle:BTe,sizes:WTe,variants:ci.variants,defaultProps:ci.defaultProps});var aZ;const GTe={...(aZ=ci.baseStyle)==null?void 0:aZ.field,textAlign:"center"},HTe={lg:{fontSize:"lg",w:12,h:12,borderRadius:"md"},md:{fontSize:"md",w:10,h:10,borderRadius:"md"},sm:{fontSize:"sm",w:8,h:8,borderRadius:"sm"},xs:{fontSize:"xs",w:6,h:6,borderRadius:"sm"}};var cZ;const $Te={outline:n=>{var e,i;return((i=Dc((e=ci.variants)==null?void 0:e.outline,n))==null?void 0:i.field)??{}},flushed:n=>{var e,i;return((i=Dc((e=ci.variants)==null?void 0:e.flushed,n))==null?void 0:i.field)??{}},filled:n=>{var e,i;return((i=Dc((e=ci.variants)==null?void 0:e.filled,n))==null?void 0:i.field)??{}},unstyled:((cZ=ci.variants)==null?void 0:cZ.unstyled.field)??{}},KTe={baseStyle:GTe,sizes:HTe,variants:$Te,defaultProps:ci.defaultProps},{defineMultiStyleConfig:qTe,definePartsStyle:YTe}=Yi(d0e.keys),IO=Mo("popper-bg"),XTe=Mo("popper-arrow-bg"),uq=Mo("popper-arrow-shadow-color"),JTe={zIndex:"popover"},QTe={[IO.variable]:"colors.white",bg:IO.reference,[XTe.variable]:IO.reference,[uq.variable]:"colors.gray.200",_dark:{[IO.variable]:"colors.gray.700",[uq.variable]:"colors.whiteAlpha.300"},width:"xs",border:"1px solid",borderColor:"inherit",borderRadius:"md",boxShadow:"sm",zIndex:"inherit",_focusVisible:{outline:0,boxShadow:"outline"}},ZTe={px:3,py:2,borderBottomWidth:"1px"},eCe={px:3,py:2},tCe={px:3,py:2,borderTopWidth:"1px"},nCe={position:"absolute",borderRadius:"md",top:1,insetEnd:2,padding:2},rCe=YTe({popper:JTe,content:QTe,header:ZTe,body:eCe,footer:tCe,closeButton:nCe}),iCe=qTe({baseStyle:rCe}),{defineMultiStyleConfig:sCe,definePartsStyle:qT}=Yi(h0e.keys),oCe=n=>{const{colorScheme:e,theme:i,isIndeterminate:o,hasStripe:l}=n,u=Vn(sq(),sq("1rem","rgba(0,0,0,0.1)"))(n),f=Vn(`${e}.500`,`${e}.200`)(n),_=`linear-gradient(
    to right,
    transparent 0%,
    ${Nc(i,f)} 50%,
    transparent 100%
  )`;return{...!o&&l&&u,...o?{bgImage:_}:{bgColor:f}}},aCe={lineHeight:"1",fontSize:"0.25em",fontWeight:"bold",color:"white"},cCe=n=>({bg:Vn("gray.100","whiteAlpha.300")(n)}),lCe=n=>({transitionProperty:"common",transitionDuration:"slow",...oCe(n)}),uCe=qT(n=>({label:aCe,filledTrack:lCe(n),track:cCe(n)})),dCe={xs:qT({track:{h:"1"}}),sm:qT({track:{h:"2"}}),md:qT({track:{h:"3"}}),lg:qT({track:{h:"4"}})},hCe=sCe({sizes:dCe,baseStyle:uCe,defaultProps:{size:"md",colorScheme:"blue"}}),{defineMultiStyleConfig:pCe,definePartsStyle:lk}=Yi(p0e.keys),fCe=n=>{var i;const e=(i=Dc(wg.baseStyle,n))==null?void 0:i.control;return{...e,borderRadius:"full",_checked:{...e==null?void 0:e._checked,_before:{content:'""',display:"inline-block",pos:"relative",w:"50%",h:"50%",borderRadius:"50%",bg:"currentColor"}}}},mCe=lk(n=>{var e,i;return{label:(e=wg.baseStyle)==null?void 0:e.call(wg,n).label,container:(i=wg.baseStyle)==null?void 0:i.call(wg,n).container,control:fCe(n)}}),gCe={md:lk({control:{w:"4",h:"4"},label:{fontSize:"md"}}),lg:lk({control:{w:"5",h:"5"},label:{fontSize:"lg"}}),sm:lk({control:{width:"3",height:"3"},label:{fontSize:"sm"}})},_Ce=pCe({baseStyle:mCe,sizes:gCe,defaultProps:{size:"md",colorScheme:"blue"}}),{defineMultiStyleConfig:yCe,definePartsStyle:ECe}=Yi(f0e.keys),AO=Fn("select-bg");var lZ;const vCe={...(lZ=ci.baseStyle)==null?void 0:lZ.field,appearance:"none",paddingBottom:"1px",lineHeight:"normal",bg:AO.reference,[AO.variable]:"colors.white",_dark:{[AO.variable]:"colors.gray.700"},"> option, > optgroup":{bg:AO.reference}},SCe={width:"6",height:"100%",insetEnd:"2",position:"relative",color:"currentColor",fontSize:"xl",_disabled:{opacity:.5}},bCe=ECe({field:vCe,icon:SCe}),PO={paddingInlineEnd:"8"};var uZ,dZ,hZ,pZ,fZ,mZ,gZ,_Z;const wCe={lg:{...(uZ=ci.sizes)==null?void 0:uZ.lg,field:{...(dZ=ci.sizes)==null?void 0:dZ.lg.field,...PO}},md:{...(hZ=ci.sizes)==null?void 0:hZ.md,field:{...(pZ=ci.sizes)==null?void 0:pZ.md.field,...PO}},sm:{...(fZ=ci.sizes)==null?void 0:fZ.sm,field:{...(mZ=ci.sizes)==null?void 0:mZ.sm.field,...PO}},xs:{...(gZ=ci.sizes)==null?void 0:gZ.xs,field:{...(_Z=ci.sizes)==null?void 0:_Z.xs.field,...PO},icon:{insetEnd:"1"}}},TCe=yCe({baseStyle:bCe,sizes:wCe,variants:ci.variants,defaultProps:ci.defaultProps}),WM=Fn("skeleton-start-color"),zM=Fn("skeleton-end-color"),CCe={[WM.variable]:"colors.gray.100",[zM.variable]:"colors.gray.400",_dark:{[WM.variable]:"colors.gray.800",[zM.variable]:"colors.gray.600"},background:WM.reference,borderColor:zM.reference,opacity:.7,borderRadius:"sm"},RCe={baseStyle:CCe},GM=Fn("skip-link-bg"),ICe={borderRadius:"md",fontWeight:"semibold",_focusVisible:{boxShadow:"outline",padding:"4",position:"fixed",top:"6",insetStart:"6",[GM.variable]:"colors.white",_dark:{[GM.variable]:"colors.gray.700"},bg:GM.reference}},ACe={baseStyle:ICe},{defineMultiStyleConfig:PCe,definePartsStyle:U1}=Yi(m0e.keys),Yy=Fn("slider-thumb-size"),kC=Fn("slider-track-size"),Tg=Fn("slider-bg"),OCe=n=>{const{orientation:e}=n;return{display:"inline-block",position:"relative",cursor:"pointer",_disabled:{opacity:.6,cursor:"default",pointerEvents:"none"},...zj({orientation:e,vertical:{h:"100%",px:Nf(Yy.reference).divide(2).toString()},horizontal:{w:"100%",py:Nf(Yy.reference).divide(2).toString()}})}},kCe=n=>({...zj({orientation:n.orientation,horizontal:{h:kC.reference},vertical:{w:kC.reference}}),overflow:"hidden",borderRadius:"sm",[Tg.variable]:"colors.gray.200",_dark:{[Tg.variable]:"colors.whiteAlpha.200"},_disabled:{[Tg.variable]:"colors.gray.300",_dark:{[Tg.variable]:"colors.whiteAlpha.300"}},bg:Tg.reference}),NCe=n=>{const{orientation:e}=n;return{...zj({orientation:e,vertical:{left:"50%",transform:"translateX(-50%)",_active:{transform:"translateX(-50%) scale(1.15)"}},horizontal:{top:"50%",transform:"translateY(-50%)",_active:{transform:"translateY(-50%) scale(1.15)"}}}),w:Yy.reference,h:Yy.reference,display:"flex",alignItems:"center",justifyContent:"center",position:"absolute",outline:0,zIndex:1,borderRadius:"full",bg:"white",boxShadow:"base",border:"1px solid",borderColor:"transparent",transitionProperty:"transform",transitionDuration:"normal",_focusVisible:{boxShadow:"outline"},_disabled:{bg:"gray.300"}}},DCe=n=>{const{colorScheme:e}=n;return{width:"inherit",height:"inherit",[Tg.variable]:`colors.${e}.500`,_dark:{[Tg.variable]:`colors.${e}.200`},bg:Tg.reference}},xCe=U1(n=>({container:OCe(n),track:kCe(n),thumb:NCe(n),filledTrack:DCe(n)})),LCe=U1({container:{[Yy.variable]:"sizes.4",[kC.variable]:"sizes.1"}}),MCe=U1({container:{[Yy.variable]:"sizes.3.5",[kC.variable]:"sizes.1"}}),UCe=U1({container:{[Yy.variable]:"sizes.2.5",[kC.variable]:"sizes.0.5"}}),VCe={lg:LCe,md:MCe,sm:UCe},jCe=PCe({baseStyle:xCe,sizes:VCe,defaultProps:{size:"md",colorScheme:"blue"}}),Oy=Mo("spinner-size"),FCe={width:[Oy.reference],height:[Oy.reference]},BCe={xs:{[Oy.variable]:"sizes.3"},sm:{[Oy.variable]:"sizes.4"},md:{[Oy.variable]:"sizes.6"},lg:{[Oy.variable]:"sizes.8"},xl:{[Oy.variable]:"sizes.12"}},WCe={baseStyle:FCe,sizes:BCe,defaultProps:{size:"md"}},{defineMultiStyleConfig:zCe,definePartsStyle:dee}=Yi(g0e.keys),GCe={fontWeight:"medium"},HCe={opacity:.8,marginBottom:"2"},$Ce={verticalAlign:"baseline",fontWeight:"semibold"},KCe={marginEnd:1,w:"3.5",h:"3.5",verticalAlign:"middle"},qCe=dee({container:{},label:GCe,helpText:HCe,number:$Ce,icon:KCe}),YCe={md:dee({label:{fontSize:"sm"},helpText:{fontSize:"sm"},number:{fontSize:"2xl"}})},XCe=zCe({baseStyle:qCe,sizes:YCe,defaultProps:{size:"md"}}),{defineMultiStyleConfig:JCe,definePartsStyle:YT}=Yi(["stepper","step","title","description","indicator","separator","icon","number"]),xf=Fn("stepper-indicator-size"),YS=Fn("stepper-icon-size"),XS=Fn("stepper-title-font-size"),XT=Fn("stepper-description-font-size"),CT=Fn("stepper-accent-color"),QCe=YT(({colorScheme:n})=>({stepper:{display:"flex",justifyContent:"space-between",gap:"4","&[data-orientation=vertical]":{flexDirection:"column",alignItems:"flex-start"},"&[data-orientation=horizontal]":{flexDirection:"row",alignItems:"center"},[CT.variable]:`colors.${n}.500`,_dark:{[CT.variable]:`colors.${n}.200`}},title:{fontSize:XS.reference,fontWeight:"medium"},description:{fontSize:XT.reference,color:"chakra-subtle-text"},number:{fontSize:XS.reference},step:{flexShrink:0,position:"relative",display:"flex",gap:"2","&[data-orientation=horizontal]":{alignItems:"center"},flex:"1","&:last-of-type:not([data-stretch])":{flex:"initial"}},icon:{flexShrink:0,width:YS.reference,height:YS.reference},indicator:{flexShrink:0,borderRadius:"full",width:xf.reference,height:xf.reference,display:"flex",justifyContent:"center",alignItems:"center","&[data-status=active]":{borderWidth:"2px",borderColor:CT.reference},"&[data-status=complete]":{bg:CT.reference,color:"chakra-inverse-text"},"&[data-status=incomplete]":{borderWidth:"2px"}},separator:{bg:"chakra-border-color",flex:"1","&[data-status=complete]":{bg:CT.reference},"&[data-orientation=horizontal]":{width:"100%",height:"2px",marginStart:"2"},"&[data-orientation=vertical]":{width:"2px",position:"absolute",height:"100%",maxHeight:`calc(100% - ${xf.reference} - 8px)`,top:`calc(${xf.reference} + 4px)`,insetStart:`calc(${xf.reference} / 2 - 1px)`}}})),ZCe=JCe({baseStyle:QCe,sizes:{xs:YT({stepper:{[xf.variable]:"sizes.4",[YS.variable]:"sizes.3",[XS.variable]:"fontSizes.xs",[XT.variable]:"fontSizes.xs"}}),sm:YT({stepper:{[xf.variable]:"sizes.6",[YS.variable]:"sizes.4",[XS.variable]:"fontSizes.sm",[XT.variable]:"fontSizes.xs"}}),md:YT({stepper:{[xf.variable]:"sizes.8",[YS.variable]:"sizes.5",[XS.variable]:"fontSizes.md",[XT.variable]:"fontSizes.sm"}}),lg:YT({stepper:{[xf.variable]:"sizes.10",[YS.variable]:"sizes.6",[XS.variable]:"fontSizes.lg",[XT.variable]:"fontSizes.md"}})},defaultProps:{size:"md",colorScheme:"blue"}}),{defineMultiStyleConfig:eRe,definePartsStyle:uk}=Yi(_0e.keys),fC=Mo("switch-track-width"),jy=Mo("switch-track-height"),HM=Mo("switch-track-diff"),tRe=Df.subtract(fC,jy),cV=Mo("switch-thumb-x"),RT=Mo("switch-bg"),nRe=n=>{const{colorScheme:e}=n;return{borderRadius:"full",p:"0.5",width:[fC.reference],height:[jy.reference],transitionProperty:"common",transitionDuration:"fast",[RT.variable]:"colors.gray.300",_dark:{[RT.variable]:"colors.whiteAlpha.400"},_focusVisible:{boxShadow:"outline"},_disabled:{opacity:.4,cursor:"not-allowed"},_checked:{[RT.variable]:`colors.${e}.500`,_dark:{[RT.variable]:`colors.${e}.200`}},bg:RT.reference}},rRe={bg:"white",transitionProperty:"transform",transitionDuration:"normal",borderRadius:"inherit",width:[jy.reference],height:[jy.reference],_checked:{transform:`translateX(${cV.reference})`}},iRe=uk(n=>({container:{[HM.variable]:tRe,[cV.variable]:HM.reference,_rtl:{[cV.variable]:Df(HM).negate().toString()}},track:nRe(n),thumb:rRe})),sRe={sm:uk({container:{[fC.variable]:"1.375rem",[jy.variable]:"sizes.3"}}),md:uk({container:{[fC.variable]:"1.875rem",[jy.variable]:"sizes.4"}}),lg:uk({container:{[fC.variable]:"2.875rem",[jy.variable]:"sizes.6"}})},oRe=eRe({baseStyle:iRe,sizes:sRe,defaultProps:{size:"md",colorScheme:"blue"}}),{defineMultiStyleConfig:aRe,definePartsStyle:h0}=Yi(y0e.keys),cRe=h0({table:{fontVariantNumeric:"lining-nums tabular-nums",borderCollapse:"collapse",width:"full"},th:{fontFamily:"heading",fontWeight:"bold",textTransform:"uppercase",letterSpacing:"wider",textAlign:"start"},td:{textAlign:"start"},caption:{mt:4,fontFamily:"heading",textAlign:"center",fontWeight:"medium"}}),zk={"&[data-is-numeric=true]":{textAlign:"end"}},lRe=h0(n=>{const{colorScheme:e}=n;return{th:{color:Vn("gray.600","gray.400")(n),borderBottom:"1px",borderColor:Vn(`${e}.100`,`${e}.700`)(n),...zk},td:{borderBottom:"1px",borderColor:Vn(`${e}.100`,`${e}.700`)(n),...zk},caption:{color:Vn("gray.600","gray.100")(n)},tfoot:{tr:{"&:last-of-type":{th:{borderBottomWidth:0}}}}}}),uRe=h0(n=>{const{colorScheme:e}=n;return{th:{color:Vn("gray.600","gray.400")(n),borderBottom:"1px",borderColor:Vn(`${e}.100`,`${e}.700`)(n),...zk},td:{borderBottom:"1px",borderColor:Vn(`${e}.100`,`${e}.700`)(n),...zk},caption:{color:Vn("gray.600","gray.100")(n)},tbody:{tr:{"&:nth-of-type(odd)":{"th, td":{borderBottomWidth:"1px",borderColor:Vn(`${e}.100`,`${e}.700`)(n)},td:{background:Vn(`${e}.100`,`${e}.700`)(n)}}}},tfoot:{tr:{"&:last-of-type":{th:{borderBottomWidth:0}}}}}}),dRe={simple:lRe,striped:uRe,unstyled:{}},hRe={sm:h0({th:{px:"4",py:"1",lineHeight:"4",fontSize:"xs"},td:{px:"4",py:"2",fontSize:"sm",lineHeight:"4"},caption:{px:"4",py:"2",fontSize:"xs"}}),md:h0({th:{px:"6",py:"3",lineHeight:"4",fontSize:"xs"},td:{px:"6",py:"4",lineHeight:"5"},caption:{px:"6",py:"2",fontSize:"sm"}}),lg:h0({th:{px:"8",py:"4",lineHeight:"5",fontSize:"sm"},td:{px:"8",py:"5",lineHeight:"6"},caption:{px:"6",py:"2",fontSize:"md"}})},pRe=aRe({baseStyle:cRe,variants:dRe,sizes:hRe,defaultProps:{variant:"simple",size:"md",colorScheme:"gray"}}),fl=Fn("tabs-color"),$d=Fn("tabs-bg"),OO=Fn("tabs-border-color"),{defineMultiStyleConfig:fRe,definePartsStyle:hp}=Yi(E0e.keys),mRe=n=>{const{orientation:e}=n;return{display:e==="vertical"?"flex":"block"}},gRe=n=>{const{isFitted:e}=n;return{flex:e?1:void 0,transitionProperty:"common",transitionDuration:"normal",_focusVisible:{zIndex:1,boxShadow:"outline"},_disabled:{cursor:"not-allowed",opacity:.4}}},_Re=n=>{const{align:e="start",orientation:i}=n;return{justifyContent:{end:"flex-end",center:"center",start:"flex-start"}[e],flexDirection:i==="vertical"?"column":"row"}},yRe={p:4},ERe=hp(n=>({root:mRe(n),tab:gRe(n),tablist:_Re(n),tabpanel:yRe})),vRe={sm:hp({tab:{py:1,px:4,fontSize:"sm"}}),md:hp({tab:{fontSize:"md",py:2,px:4}}),lg:hp({tab:{fontSize:"lg",py:3,px:4}})},SRe=hp(n=>{const{colorScheme:e,orientation:i}=n,o=i==="vertical",l=o?"borderStart":"borderBottom",u=o?"marginStart":"marginBottom";return{tablist:{[l]:"2px solid",borderColor:"inherit"},tab:{[l]:"2px solid",borderColor:"transparent",[u]:"-2px",_selected:{[fl.variable]:`colors.${e}.600`,_dark:{[fl.variable]:`colors.${e}.300`},borderColor:"currentColor"},_active:{[$d.variable]:"colors.gray.200",_dark:{[$d.variable]:"colors.whiteAlpha.300"}},_disabled:{_active:{bg:"none"}},color:fl.reference,bg:$d.reference}}}),bRe=hp(n=>{const{colorScheme:e}=n;return{tab:{borderTopRadius:"md",border:"1px solid",borderColor:"transparent",mb:"-1px",[OO.variable]:"transparent",_selected:{[fl.variable]:`colors.${e}.600`,[OO.variable]:"colors.white",_dark:{[fl.variable]:`colors.${e}.300`,[OO.variable]:"colors.gray.800"},borderColor:"inherit",borderBottomColor:OO.reference},color:fl.reference},tablist:{mb:"-1px",borderBottom:"1px solid",borderColor:"inherit"}}}),wRe=hp(n=>{const{colorScheme:e}=n;return{tab:{border:"1px solid",borderColor:"inherit",[$d.variable]:"colors.gray.50",_dark:{[$d.variable]:"colors.whiteAlpha.50"},mb:"-1px",_notLast:{marginEnd:"-1px"},_selected:{[$d.variable]:"colors.white",[fl.variable]:`colors.${e}.600`,_dark:{[$d.variable]:"colors.gray.800",[fl.variable]:`colors.${e}.300`},borderColor:"inherit",borderTopColor:"currentColor",borderBottomColor:"transparent"},color:fl.reference,bg:$d.reference},tablist:{mb:"-1px",borderBottom:"1px solid",borderColor:"inherit"}}}),TRe=hp(n=>{const{colorScheme:e,theme:i}=n;return{tab:{borderRadius:"full",fontWeight:"semibold",color:"gray.600",_selected:{color:Nc(i,`${e}.700`),bg:Nc(i,`${e}.100`)}}}}),CRe=hp(n=>{const{colorScheme:e}=n;return{tab:{borderRadius:"full",fontWeight:"semibold",[fl.variable]:"colors.gray.600",_dark:{[fl.variable]:"inherit"},_selected:{[fl.variable]:"colors.white",[$d.variable]:`colors.${e}.600`,_dark:{[fl.variable]:"colors.gray.800",[$d.variable]:`colors.${e}.300`}},color:fl.reference,bg:$d.reference}}}),RRe=hp({}),IRe={line:SRe,enclosed:bRe,"enclosed-colored":wRe,"soft-rounded":TRe,"solid-rounded":CRe,unstyled:RRe},ARe=fRe({baseStyle:ERe,sizes:vRe,variants:IRe,defaultProps:{size:"md",variant:"line",colorScheme:"blue"}}),{defineMultiStyleConfig:PRe,definePartsStyle:Fy}=Yi(v0e.keys),dq=Fn("tag-bg"),hq=Fn("tag-color"),$M=Fn("tag-shadow"),dk=Fn("tag-min-height"),hk=Fn("tag-min-width"),pk=Fn("tag-font-size"),fk=Fn("tag-padding-inline"),ORe={fontWeight:"medium",lineHeight:1.2,outline:0,[hq.variable]:io.color.reference,[dq.variable]:io.bg.reference,[$M.variable]:io.shadow.reference,color:hq.reference,bg:dq.reference,boxShadow:$M.reference,borderRadius:"md",minH:dk.reference,minW:hk.reference,fontSize:pk.reference,px:fk.reference,_focusVisible:{[$M.variable]:"shadows.outline"}},kRe={lineHeight:1.2,overflow:"visible"},NRe={fontSize:"lg",w:"5",h:"5",transitionProperty:"common",transitionDuration:"normal",borderRadius:"full",marginStart:"1.5",marginEnd:"-1",opacity:.5,_disabled:{opacity:.4},_focusVisible:{boxShadow:"outline",bg:"rgba(0, 0, 0, 0.14)"},_hover:{opacity:.8},_active:{opacity:1}},DRe=Fy({container:ORe,label:kRe,closeButton:NRe}),xRe={sm:Fy({container:{[dk.variable]:"sizes.5",[hk.variable]:"sizes.5",[pk.variable]:"fontSizes.xs",[fk.variable]:"space.2"},closeButton:{marginEnd:"-2px",marginStart:"0.35rem"}}),md:Fy({container:{[dk.variable]:"sizes.6",[hk.variable]:"sizes.6",[pk.variable]:"fontSizes.sm",[fk.variable]:"space.2"}}),lg:Fy({container:{[dk.variable]:"sizes.8",[hk.variable]:"sizes.8",[pk.variable]:"fontSizes.md",[fk.variable]:"space.3"}})},LRe={subtle:Fy(n=>{var e;return{container:(e=dC.variants)==null?void 0:e.subtle(n)}}),solid:Fy(n=>{var e;return{container:(e=dC.variants)==null?void 0:e.solid(n)}}),outline:Fy(n=>{var e;return{container:(e=dC.variants)==null?void 0:e.outline(n)}})},MRe=PRe({variants:LRe,baseStyle:DRe,sizes:xRe,defaultProps:{size:"md",variant:"subtle",colorScheme:"gray"}});var yZ;const URe={...(yZ=ci.baseStyle)==null?void 0:yZ.field,paddingY:"2",minHeight:"20",lineHeight:"short",verticalAlign:"top"};var EZ;const VRe={outline:n=>{var e;return((e=ci.variants)==null?void 0:e.outline(n).field)??{}},flushed:n=>{var e;return((e=ci.variants)==null?void 0:e.flushed(n).field)??{}},filled:n=>{var e;return((e=ci.variants)==null?void 0:e.filled(n).field)??{}},unstyled:((EZ=ci.variants)==null?void 0:EZ.unstyled.field)??{}};var vZ,SZ,bZ,wZ;const jRe={xs:((vZ=ci.sizes)==null?void 0:vZ.xs.field)??{},sm:((SZ=ci.sizes)==null?void 0:SZ.sm.field)??{},md:((bZ=ci.sizes)==null?void 0:bZ.md.field)??{},lg:((wZ=ci.sizes)==null?void 0:wZ.lg.field)??{}},FRe={baseStyle:URe,sizes:jRe,variants:VRe,defaultProps:{size:"md",variant:"outline"}},kO=Mo("tooltip-bg"),KM=Mo("tooltip-fg"),BRe=Mo("popper-arrow-bg"),WRe={bg:kO.reference,color:KM.reference,[kO.variable]:"colors.gray.700",[KM.variable]:"colors.whiteAlpha.900",_dark:{[kO.variable]:"colors.gray.300",[KM.variable]:"colors.gray.900"},[BRe.variable]:kO.reference,px:"2",py:"0.5",borderRadius:"sm",fontWeight:"medium",fontSize:"sm",boxShadow:"md",maxW:"xs",zIndex:"tooltip"},zRe={baseStyle:WRe},GRe={Accordion:P0e,Alert:hbe,Avatar:wbe,Badge:dC,Breadcrumb:Dbe,Button:Wbe,Checkbox:wg,CloseButton:rwe,Code:awe,Container:lwe,Divider:fwe,Drawer:Cwe,Editable:Nwe,Form:Vwe,FormError:Gwe,FormLabel:$we,Heading:Ywe,Input:ci,Kbd:sTe,Link:aTe,List:hTe,Menu:wTe,Modal:xTe,NumberInput:zTe,PinInput:KTe,Popover:iCe,Progress:hCe,Radio:_Ce,Select:TCe,Skeleton:RCe,SkipLink:ACe,Slider:jCe,Spinner:WCe,Stat:XCe,Switch:oRe,Table:pRe,Tabs:ARe,Tag:MRe,Textarea:FRe,Tooltip:zRe,Card:Kbe,Stepper:ZCe},HRe={none:0,"1px":"1px solid","2px":"2px solid","4px":"4px solid","8px":"8px solid"},$Re={base:"0em",sm:"30em",md:"48em",lg:"62em",xl:"80em","2xl":"96em"},KRe={transparent:"transparent",current:"currentColor",black:"#000000",white:"#FFFFFF",whiteAlpha:{50:"rgba(255, 255, 255, 0.04)",100:"rgba(255, 255, 255, 0.06)",200:"rgba(255, 255, 255, 0.08)",300:"rgba(255, 255, 255, 0.16)",400:"rgba(255, 255, 255, 0.24)",500:"rgba(255, 255, 255, 0.36)",600:"rgba(255, 255, 255, 0.48)",700:"rgba(255, 255, 255, 0.64)",800:"rgba(255, 255, 255, 0.80)",900:"rgba(255, 255, 255, 0.92)"},blackAlpha:{50:"rgba(0, 0, 0, 0.04)",100:"rgba(0, 0, 0, 0.06)",200:"rgba(0, 0, 0, 0.08)",300:"rgba(0, 0, 0, 0.16)",400:"rgba(0, 0, 0, 0.24)",500:"rgba(0, 0, 0, 0.36)",600:"rgba(0, 0, 0, 0.48)",700:"rgba(0, 0, 0, 0.64)",800:"rgba(0, 0, 0, 0.80)",900:"rgba(0, 0, 0, 0.92)"},gray:{50:"#F7FAFC",100:"#EDF2F7",200:"#E2E8F0",300:"#CBD5E0",400:"#A0AEC0",500:"#718096",600:"#4A5568",700:"#2D3748",800:"#1A202C",900:"#171923"},red:{50:"#FFF5F5",100:"#FED7D7",200:"#FEB2B2",300:"#FC8181",400:"#F56565",500:"#E53E3E",600:"#C53030",700:"#9B2C2C",800:"#822727",900:"#63171B"},orange:{50:"#FFFAF0",100:"#FEEBC8",200:"#FBD38D",300:"#F6AD55",400:"#ED8936",500:"#DD6B20",600:"#C05621",700:"#9C4221",800:"#7B341E",900:"#652B19"},yellow:{50:"#FFFFF0",100:"#FEFCBF",200:"#FAF089",300:"#F6E05E",400:"#ECC94B",500:"#D69E2E",600:"#B7791F",700:"#975A16",800:"#744210",900:"#5F370E"},green:{50:"#F0FFF4",100:"#C6F6D5",200:"#9AE6B4",300:"#68D391",400:"#48BB78",500:"#38A169",600:"#2F855A",700:"#276749",800:"#22543D",900:"#1C4532"},teal:{50:"#E6FFFA",100:"#B2F5EA",200:"#81E6D9",300:"#4FD1C5",400:"#38B2AC",500:"#319795",600:"#2C7A7B",700:"#285E61",800:"#234E52",900:"#1D4044"},blue:{50:"#ebf8ff",100:"#bee3f8",200:"#90cdf4",300:"#63b3ed",400:"#4299e1",500:"#3182ce",600:"#2b6cb0",700:"#2c5282",800:"#2a4365",900:"#1A365D"},cyan:{50:"#EDFDFD",100:"#C4F1F9",200:"#9DECF9",300:"#76E4F7",400:"#0BC5EA",500:"#00B5D8",600:"#00A3C4",700:"#0987A0",800:"#086F83",900:"#065666"},purple:{50:"#FAF5FF",100:"#E9D8FD",200:"#D6BCFA",300:"#B794F4",400:"#9F7AEA",500:"#805AD5",600:"#6B46C1",700:"#553C9A",800:"#44337A",900:"#322659"},pink:{50:"#FFF5F7",100:"#FED7E2",200:"#FBB6CE",300:"#F687B3",400:"#ED64A6",500:"#D53F8C",600:"#B83280",700:"#97266D",800:"#702459",900:"#521B41"}},qRe={none:"0",sm:"0.125rem",base:"0.25rem",md:"0.375rem",lg:"0.5rem",xl:"0.75rem","2xl":"1rem","3xl":"1.5rem",full:"9999px"},YRe={xs:"0 0 0 1px rgba(0, 0, 0, 0.05)",sm:"0 1px 2px 0 rgba(0, 0, 0, 0.05)",base:"0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06)",md:"0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)",lg:"0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05)",xl:"0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04)","2xl":"0 25px 50px -12px rgba(0, 0, 0, 0.25)",outline:"0 0 0 3px rgba(66, 153, 225, 0.6)",inner:"inset 0 2px 4px 0 rgba(0,0,0,0.06)",none:"none","dark-lg":"rgba(0, 0, 0, 0.1) 0px 0px 0px 1px, rgba(0, 0, 0, 0.2) 0px 5px 10px, rgba(0, 0, 0, 0.4) 0px 15px 40px"},XRe={common:"background-color, border-color, color, fill, stroke, opacity, box-shadow, transform",colors:"background-color, border-color, color, fill, stroke",dimensions:"width, height",position:"left, right, top, bottom",background:"background-color, background-image, background-position"},JRe={"ease-in":"cubic-bezier(0.4, 0, 1, 1)","ease-out":"cubic-bezier(0, 0, 0.2, 1)","ease-in-out":"cubic-bezier(0.4, 0, 0.2, 1)"},QRe={"ultra-fast":"50ms",faster:"100ms",fast:"150ms",normal:"200ms",slow:"300ms",slower:"400ms","ultra-slow":"500ms"},ZRe={property:XRe,easing:JRe,duration:QRe},eIe={hide:-1,auto:"auto",base:0,docked:10,dropdown:1e3,sticky:1100,banner:1200,overlay:1300,modal:1400,popover:1500,skipLink:1600,toast:1700,tooltip:1800},tIe={none:0,sm:"4px",base:"8px",md:"12px",lg:"16px",xl:"24px","2xl":"40px","3xl":"64px"},nIe={breakpoints:$Re,zIndices:eIe,radii:qRe,blur:tIe,colors:KRe,...cee,sizes:nee,shadows:YRe,space:tee,borders:HRe,transition:ZRe},rIe={colors:{"chakra-body-text":{_light:"gray.800",_dark:"whiteAlpha.900"},"chakra-body-bg":{_light:"white",_dark:"gray.800"},"chakra-border-color":{_light:"gray.200",_dark:"whiteAlpha.300"},"chakra-inverse-text":{_light:"white",_dark:"gray.800"},"chakra-subtle-bg":{_light:"gray.100",_dark:"gray.700"},"chakra-subtle-text":{_light:"gray.600",_dark:"gray.400"},"chakra-placeholder-color":{_light:"gray.500",_dark:"whiteAlpha.400"}}},iIe={global:{body:{fontFamily:"body",color:"chakra-body-text",bg:"chakra-body-bg",transitionProperty:"background-color",transitionDuration:"normal",lineHeight:"base"},"*::placeholder":{color:"chakra-placeholder-color"},"*, *::before, &::after":{borderColor:"chakra-border-color"}}},sIe="ltr",oIe={useSystemColorMode:!1,initialColorMode:"light",cssVarPrefix:"chakra"},aIe={semanticTokens:rIe,direction:sIe,...nIe,components:GRe,styles:iIe,config:oIe};function cIe(n){if(n.sheet)return n.sheet;for(var e=0;e<document.styleSheets.length;e++)if(document.styleSheets[e].ownerNode===n)return document.styleSheets[e]}function lIe(n){var e=document.createElement("style");return e.setAttribute("data-emotion",n.key),n.nonce!==void 0&&e.setAttribute("nonce",n.nonce),e.appendChild(document.createTextNode("")),e.setAttribute("data-s",""),e}var uIe=function(){function n(i){var o=this;this._insertTag=function(l){var u;o.tags.length===0?o.insertionPoint?u=o.insertionPoint.nextSibling:o.prepend?u=o.container.firstChild:u=o.before:u=o.tags[o.tags.length-1].nextSibling,o.container.insertBefore(l,u),o.tags.push(l)},this.isSpeedy=i.speedy===void 0?!0:i.speedy,this.tags=[],this.ctr=0,this.nonce=i.nonce,this.key=i.key,this.container=i.container,this.prepend=i.prepend,this.insertionPoint=i.insertionPoint,this.before=null}var e=n.prototype;return e.hydrate=function(o){o.forEach(this._insertTag)},e.insert=function(o){this.ctr%(this.isSpeedy?65e3:1)===0&&this._insertTag(lIe(this));var l=this.tags[this.tags.length-1];if(this.isSpeedy){var u=cIe(l);try{u.insertRule(o,u.cssRules.length)}catch{}}else l.appendChild(document.createTextNode(o));this.ctr++},e.flush=function(){this.tags.forEach(function(o){var l;return(l=o.parentNode)==null?void 0:l.removeChild(o)}),this.tags=[],this.ctr=0},n}(),rc="-ms-",Gk="-moz-",oi="-webkit-",hee="comm",Kj="rule",qj="decl",dIe="@import",pee="@keyframes",hIe="@layer",pIe=Math.abs,V1=String.fromCharCode,fIe=Object.assign;function mIe(n,e){return ka(n,0)^45?(((e<<2^ka(n,0))<<2^ka(n,1))<<2^ka(n,2))<<2^ka(n,3):0}function fee(n){return n.trim()}function gIe(n,e){return(n=e.exec(n))?n[0]:n}function ai(n,e,i){return n.replace(e,i)}function lV(n,e){return n.indexOf(e)}function ka(n,e){return n.charCodeAt(e)|0}function NC(n,e,i){return n.slice(e,i)}function Zh(n){return n.length}function Yj(n){return n.length}function NO(n,e){return e.push(n),n}function _Ie(n,e){return n.map(e).join("")}var j1=1,C0=1,mee=0,vl=0,fo=0,Y0="";function F1(n,e,i,o,l,u,f){return{value:n,root:e,parent:i,type:o,props:l,children:u,line:j1,column:C0,length:f,return:""}}function IT(n,e){return fIe(F1("",null,null,"",null,null,0),n,{length:-n.length},e)}function yIe(){return fo}function EIe(){return fo=vl>0?ka(Y0,--vl):0,C0--,fo===10&&(C0=1,j1--),fo}function Jl(){return fo=vl<mee?ka(Y0,vl++):0,C0++,fo===10&&(C0=1,j1++),fo}function pp(){return ka(Y0,vl)}function mk(){return vl}function lR(n,e){return NC(Y0,n,e)}function DC(n){switch(n){case 0:case 9:case 10:case 13:case 32:return 5;case 33:case 43:case 44:case 47:case 62:case 64:case 126:case 59:case 123:case 125:return 4;case 58:return 3;case 34:case 39:case 40:case 91:return 2;case 41:case 93:return 1}return 0}function gee(n){return j1=C0=1,mee=Zh(Y0=n),vl=0,[]}function _ee(n){return Y0="",n}function gk(n){return fee(lR(vl-1,uV(n===91?n+2:n===40?n+1:n)))}function vIe(n){for(;(fo=pp())&&fo<33;)Jl();return DC(n)>2||DC(fo)>3?"":" "}function SIe(n,e){for(;--e&&Jl()&&!(fo<48||fo>102||fo>57&&fo<65||fo>70&&fo<97););return lR(n,mk()+(e<6&&pp()==32&&Jl()==32))}function uV(n){for(;Jl();)switch(fo){case n:return vl;case 34:case 39:n!==34&&n!==39&&uV(fo);break;case 40:n===41&&uV(n);break;case 92:Jl();break}return vl}function bIe(n,e){for(;Jl()&&n+fo!==57;)if(n+fo===84&&pp()===47)break;return"/*"+lR(e,vl-1)+"*"+V1(n===47?n:Jl())}function wIe(n){for(;!DC(pp());)Jl();return lR(n,vl)}function TIe(n){return _ee(_k("",null,null,null,[""],n=gee(n),0,[0],n))}function _k(n,e,i,o,l,u,f,_,E){for(var b=0,C=0,I=f,P=0,L=0,M=0,F=1,B=1,Z=1,K=0,re="",ae=l,ne=u,pe=o,X=re;B;)switch(M=K,K=Jl()){case 40:if(M!=108&&ka(X,I-1)==58){lV(X+=ai(gk(K),"&","&\f"),"&\f")!=-1&&(Z=-1);break}case 34:case 39:case 91:X+=gk(K);break;case 9:case 10:case 13:case 32:X+=vIe(M);break;case 92:X+=SIe(mk()-1,7);continue;case 47:switch(pp()){case 42:case 47:NO(CIe(bIe(Jl(),mk()),e,i),E);break;default:X+="/"}break;case 123*F:_[b++]=Zh(X)*Z;case 125*F:case 59:case 0:switch(K){case 0:case 125:B=0;case 59+C:Z==-1&&(X=ai(X,/\f/g,"")),L>0&&Zh(X)-I&&NO(L>32?fq(X+";",o,i,I-1):fq(ai(X," ","")+";",o,i,I-2),E);break;case 59:X+=";";default:if(NO(pe=pq(X,e,i,b,C,l,_,re,ae=[],ne=[],I),u),K===123)if(C===0)_k(X,e,pe,pe,ae,u,I,_,ne);else switch(P===99&&ka(X,3)===110?100:P){case 100:case 108:case 109:case 115:_k(n,pe,pe,o&&NO(pq(n,pe,pe,0,0,l,_,re,l,ae=[],I),ne),l,ne,I,_,o?ae:ne);break;default:_k(X,pe,pe,pe,[""],ne,0,_,ne)}}b=C=L=0,F=Z=1,re=X="",I=f;break;case 58:I=1+Zh(X),L=M;default:if(F<1){if(K==123)--F;else if(K==125&&F++==0&&EIe()==125)continue}switch(X+=V1(K),K*F){case 38:Z=C>0?1:(X+="\f",-1);break;case 44:_[b++]=(Zh(X)-1)*Z,Z=1;break;case 64:pp()===45&&(X+=gk(Jl())),P=pp(),C=I=Zh(re=X+=wIe(mk())),K++;break;case 45:M===45&&Zh(X)==2&&(F=0)}}return u}function pq(n,e,i,o,l,u,f,_,E,b,C){for(var I=l-1,P=l===0?u:[""],L=Yj(P),M=0,F=0,B=0;M<o;++M)for(var Z=0,K=NC(n,I+1,I=pIe(F=f[M])),re=n;Z<L;++Z)(re=fee(F>0?P[Z]+" "+K:ai(K,/&\f/g,P[Z])))&&(E[B++]=re);return F1(n,e,i,l===0?Kj:_,E,b,C)}function CIe(n,e,i){return F1(n,e,i,hee,V1(yIe()),NC(n,2,-2),0)}function fq(n,e,i,o){return F1(n,e,i,qj,NC(n,0,o),NC(n,o+1,-1),o)}function p0(n,e){for(var i="",o=Yj(n),l=0;l<o;l++)i+=e(n[l],l,n,e)||"";return i}function RIe(n,e,i,o){switch(n.type){case hIe:if(n.children.length)break;case dIe:case qj:return n.return=n.return||n.value;case hee:return"";case pee:return n.return=n.value+"{"+p0(n.children,o)+"}";case Kj:n.value=n.props.join(",")}return Zh(i=p0(n.children,o))?n.return=n.value+"{"+i+"}":""}function IIe(n){var e=Yj(n);return function(i,o,l,u){for(var f="",_=0;_<e;_++)f+=n[_](i,o,l,u)||"";return f}}function AIe(n){return function(e){e.root||(e=e.return)&&n(e)}}var mq=function(e){var i=new WeakMap;return function(o){if(i.has(o))return i.get(o);var l=e(o);return i.set(o,l),l}};function yee(n){var e=Object.create(null);return function(i){return e[i]===void 0&&(e[i]=n(i)),e[i]}}var PIe=function(e,i,o){for(var l=0,u=0;l=u,u=pp(),l===38&&u===12&&(i[o]=1),!DC(u);)Jl();return lR(e,vl)},OIe=function(e,i){var o=-1,l=44;do switch(DC(l)){case 0:l===38&&pp()===12&&(i[o]=1),e[o]+=PIe(vl-1,i,o);break;case 2:e[o]+=gk(l);break;case 4:if(l===44){e[++o]=pp()===58?"&\f":"",i[o]=e[o].length;break}default:e[o]+=V1(l)}while(l=Jl());return e},kIe=function(e,i){return _ee(OIe(gee(e),i))},gq=new WeakMap,NIe=function(e){if(!(e.type!=="rule"||!e.parent||e.length<1)){for(var i=e.value,o=e.parent,l=e.column===o.column&&e.line===o.line;o.type!=="rule";)if(o=o.parent,!o)return;if(!(e.props.length===1&&i.charCodeAt(0)!==58&&!gq.get(o))&&!l){gq.set(e,!0);for(var u=[],f=kIe(i,u),_=o.props,E=0,b=0;E<f.length;E++)for(var C=0;C<_.length;C++,b++)e.props[b]=u[E]?f[E].replace(/&\f/g,_[C]):_[C]+" "+f[E]}}},DIe=function(e){if(e.type==="decl"){var i=e.value;i.charCodeAt(0)===108&&i.charCodeAt(2)===98&&(e.return="",e.value="")}};function Eee(n,e){switch(mIe(n,e)){case 5103:return oi+"print-"+n+n;case 5737:case 4201:case 3177:case 3433:case 1641:case 4457:case 2921:case 5572:case 6356:case 5844:case 3191:case 6645:case 3005:case 6391:case 5879:case 5623:case 6135:case 4599:case 4855:case 4215:case 6389:case 5109:case 5365:case 5621:case 3829:return oi+n+n;case 5349:case 4246:case 4810:case 6968:case 2756:return oi+n+Gk+n+rc+n+n;case 6828:case 4268:return oi+n+rc+n+n;case 6165:return oi+n+rc+"flex-"+n+n;case 5187:return oi+n+ai(n,/(\w+).+(:[^]+)/,oi+"box-$1$2"+rc+"flex-$1$2")+n;case 5443:return oi+n+rc+"flex-item-"+ai(n,/flex-|-self/,"")+n;case 4675:return oi+n+rc+"flex-line-pack"+ai(n,/align-content|flex-|-self/,"")+n;case 5548:return oi+n+rc+ai(n,"shrink","negative")+n;case 5292:return oi+n+rc+ai(n,"basis","preferred-size")+n;case 6060:return oi+"box-"+ai(n,"-grow","")+oi+n+rc+ai(n,"grow","positive")+n;case 4554:return oi+ai(n,/([^-])(transform)/g,"$1"+oi+"$2")+n;case 6187:return ai(ai(ai(n,/(zoom-|grab)/,oi+"$1"),/(image-set)/,oi+"$1"),n,"")+n;case 5495:case 3959:return ai(n,/(image-set\([^]*)/,oi+"$1$`$1");case 4968:return ai(ai(n,/(.+:)(flex-)?(.*)/,oi+"box-pack:$3"+rc+"flex-pack:$3"),/s.+-b[^;]+/,"justify")+oi+n+n;case 4095:case 3583:case 4068:case 2532:return ai(n,/(.+)-inline(.+)/,oi+"$1$2")+n;case 8116:case 7059:case 5753:case 5535:case 5445:case 5701:case 4933:case 4677:case 5533:case 5789:case 5021:case 4765:if(Zh(n)-1-e>6)switch(ka(n,e+1)){case 109:if(ka(n,e+4)!==45)break;case 102:return ai(n,/(.+:)(.+)-([^]+)/,"$1"+oi+"$2-$3$1"+Gk+(ka(n,e+3)==108?"$3":"$2-$3"))+n;case 115:return~lV(n,"stretch")?Eee(ai(n,"stretch","fill-available"),e)+n:n}break;case 4949:if(ka(n,e+1)!==115)break;case 6444:switch(ka(n,Zh(n)-3-(~lV(n,"!important")&&10))){case 107:return ai(n,":",":"+oi)+n;case 101:return ai(n,/(.+:)([^;!]+)(;|!.+)?/,"$1"+oi+(ka(n,14)===45?"inline-":"")+"box$3$1"+oi+"$2$3$1"+rc+"$2box$3")+n}break;case 5936:switch(ka(n,e+11)){case 114:return oi+n+rc+ai(n,/[svh]\w+-[tblr]{2}/,"tb")+n;case 108:return oi+n+rc+ai(n,/[svh]\w+-[tblr]{2}/,"tb-rl")+n;case 45:return oi+n+rc+ai(n,/[svh]\w+-[tblr]{2}/,"lr")+n}return oi+n+rc+n+n}return n}var xIe=function(e,i,o,l){if(e.length>-1&&!e.return)switch(e.type){case qj:e.return=Eee(e.value,e.length);break;case pee:return p0([IT(e,{value:ai(e.value,"@","@"+oi)})],l);case Kj:if(e.length)return _Ie(e.props,function(u){switch(gIe(u,/(::plac\w+|:read-\w+)/)){case":read-only":case":read-write":return p0([IT(e,{props:[ai(u,/:(read-\w+)/,":"+Gk+"$1")]})],l);case"::placeholder":return p0([IT(e,{props:[ai(u,/:(plac\w+)/,":"+oi+"input-$1")]}),IT(e,{props:[ai(u,/:(plac\w+)/,":"+Gk+"$1")]}),IT(e,{props:[ai(u,/:(plac\w+)/,rc+"input-$1")]})],l)}return""})}},LIe=[xIe],MIe=function(e){var i=e.key;if(i==="css"){var o=document.querySelectorAll("style[data-emotion]:not([data-s])");Array.prototype.forEach.call(o,function(F){var B=F.getAttribute("data-emotion");B.indexOf(" ")!==-1&&(document.head.appendChild(F),F.setAttribute("data-s",""))})}var l=e.stylisPlugins||LIe,u={},f,_=[];f=e.container||document.head,Array.prototype.forEach.call(document.querySelectorAll('style[data-emotion^="'+i+' "]'),function(F){for(var B=F.getAttribute("data-emotion").split(" "),Z=1;Z<B.length;Z++)u[B[Z]]=!0;_.push(F)});var E,b=[NIe,DIe];{var C,I=[RIe,AIe(function(F){C.insert(F)})],P=IIe(b.concat(l,I)),L=function(B){return p0(TIe(B),P)};E=function(B,Z,K,re){C=K,L(B?B+"{"+Z.styles+"}":Z.styles),re&&(M.inserted[Z.name]=!0)}}var M={key:i,sheet:new uIe({key:i,container:f,nonce:e.nonce,speedy:e.speedy,prepend:e.prepend,insertionPoint:e.insertionPoint}),nonce:e.nonce,inserted:u,registered:{},insert:E};return M.sheet.hydrate(_),M};function Xy(){return Xy=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var o in i)({}).hasOwnProperty.call(i,o)&&(n[o]=i[o])}return n},Xy.apply(null,arguments)}var qM={exports:{}},mi={};/** @license React v16.13.1
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var _q;function UIe(){if(_q)return mi;_q=1;var n=typeof Symbol=="function"&&Symbol.for,e=n?Symbol.for("react.element"):60103,i=n?Symbol.for("react.portal"):60106,o=n?Symbol.for("react.fragment"):60107,l=n?Symbol.for("react.strict_mode"):60108,u=n?Symbol.for("react.profiler"):60114,f=n?Symbol.for("react.provider"):60109,_=n?Symbol.for("react.context"):60110,E=n?Symbol.for("react.async_mode"):60111,b=n?Symbol.for("react.concurrent_mode"):60111,C=n?Symbol.for("react.forward_ref"):60112,I=n?Symbol.for("react.suspense"):60113,P=n?Symbol.for("react.suspense_list"):60120,L=n?Symbol.for("react.memo"):60115,M=n?Symbol.for("react.lazy"):60116,F=n?Symbol.for("react.block"):60121,B=n?Symbol.for("react.fundamental"):60117,Z=n?Symbol.for("react.responder"):60118,K=n?Symbol.for("react.scope"):60119;function re(ne){if(typeof ne=="object"&&ne!==null){var pe=ne.$$typeof;switch(pe){case e:switch(ne=ne.type,ne){case E:case b:case o:case u:case l:case I:return ne;default:switch(ne=ne&&ne.$$typeof,ne){case _:case C:case M:case L:case f:return ne;default:return pe}}case i:return pe}}}function ae(ne){return re(ne)===b}return mi.AsyncMode=E,mi.ConcurrentMode=b,mi.ContextConsumer=_,mi.ContextProvider=f,mi.Element=e,mi.ForwardRef=C,mi.Fragment=o,mi.Lazy=M,mi.Memo=L,mi.Portal=i,mi.Profiler=u,mi.StrictMode=l,mi.Suspense=I,mi.isAsyncMode=function(ne){return ae(ne)||re(ne)===E},mi.isConcurrentMode=ae,mi.isContextConsumer=function(ne){return re(ne)===_},mi.isContextProvider=function(ne){return re(ne)===f},mi.isElement=function(ne){return typeof ne=="object"&&ne!==null&&ne.$$typeof===e},mi.isForwardRef=function(ne){return re(ne)===C},mi.isFragment=function(ne){return re(ne)===o},mi.isLazy=function(ne){return re(ne)===M},mi.isMemo=function(ne){return re(ne)===L},mi.isPortal=function(ne){return re(ne)===i},mi.isProfiler=function(ne){return re(ne)===u},mi.isStrictMode=function(ne){return re(ne)===l},mi.isSuspense=function(ne){return re(ne)===I},mi.isValidElementType=function(ne){return typeof ne=="string"||typeof ne=="function"||ne===o||ne===b||ne===u||ne===l||ne===I||ne===P||typeof ne=="object"&&ne!==null&&(ne.$$typeof===M||ne.$$typeof===L||ne.$$typeof===f||ne.$$typeof===_||ne.$$typeof===C||ne.$$typeof===B||ne.$$typeof===Z||ne.$$typeof===K||ne.$$typeof===F)},mi.typeOf=re,mi}var yq;function VIe(){return yq||(yq=1,qM.exports=UIe()),qM.exports}var YM,Eq;function jIe(){if(Eq)return YM;Eq=1;var n=VIe(),e={childContextTypes:!0,contextType:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromError:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},i={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},o={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},l={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},u={};u[n.ForwardRef]=o,u[n.Memo]=l;function f(M){return n.isMemo(M)?l:u[M.$$typeof]||e}var _=Object.defineProperty,E=Object.getOwnPropertyNames,b=Object.getOwnPropertySymbols,C=Object.getOwnPropertyDescriptor,I=Object.getPrototypeOf,P=Object.prototype;function L(M,F,B){if(typeof F!="string"){if(P){var Z=I(F);Z&&Z!==P&&L(M,Z,B)}var K=E(F);b&&(K=K.concat(b(F)));for(var re=f(M),ae=f(F),ne=0;ne<K.length;++ne){var pe=K[ne];if(!i[pe]&&!(B&&B[pe])&&!(ae&&ae[pe])&&!(re&&re[pe])){var X=C(F,pe);try{_(M,pe,X)}catch{}}}}return M}return YM=L,YM}var FIe=jIe();const BIe=Yg(FIe);var WIe=!0;function vee(n,e,i){var o="";return i.split(" ").forEach(function(l){n[l]!==void 0?e.push(n[l]+";"):l&&(o+=l+" ")}),o}var Xj=function(e,i,o){var l=e.key+"-"+i.name;(o===!1||WIe===!1)&&e.registered[l]===void 0&&(e.registered[l]=i.styles)},Jj=function(e,i,o){Xj(e,i,o);var l=e.key+"-"+i.name;if(e.inserted[i.name]===void 0){var u=i;do e.insert(i===u?"."+l:"",u,e.sheet,!0),u=u.next;while(u!==void 0)}};function zIe(n){for(var e=0,i,o=0,l=n.length;l>=4;++o,l-=4)i=n.charCodeAt(o)&255|(n.charCodeAt(++o)&255)<<8|(n.charCodeAt(++o)&255)<<16|(n.charCodeAt(++o)&255)<<24,i=(i&65535)*1540483477+((i>>>16)*59797<<16),i^=i>>>24,e=(i&65535)*1540483477+((i>>>16)*59797<<16)^(e&65535)*1540483477+((e>>>16)*59797<<16);switch(l){case 3:e^=(n.charCodeAt(o+2)&255)<<16;case 2:e^=(n.charCodeAt(o+1)&255)<<8;case 1:e^=n.charCodeAt(o)&255,e=(e&65535)*1540483477+((e>>>16)*59797<<16)}return e^=e>>>13,e=(e&65535)*1540483477+((e>>>16)*59797<<16),((e^e>>>15)>>>0).toString(36)}var GIe={animationIterationCount:1,aspectRatio:1,borderImageOutset:1,borderImageSlice:1,borderImageWidth:1,boxFlex:1,boxFlexGroup:1,boxOrdinalGroup:1,columnCount:1,columns:1,flex:1,flexGrow:1,flexPositive:1,flexShrink:1,flexNegative:1,flexOrder:1,gridRow:1,gridRowEnd:1,gridRowSpan:1,gridRowStart:1,gridColumn:1,gridColumnEnd:1,gridColumnSpan:1,gridColumnStart:1,msGridRow:1,msGridRowSpan:1,msGridColumn:1,msGridColumnSpan:1,fontWeight:1,lineHeight:1,opacity:1,order:1,orphans:1,scale:1,tabSize:1,widows:1,zIndex:1,zoom:1,WebkitLineClamp:1,fillOpacity:1,floodOpacity:1,stopOpacity:1,strokeDasharray:1,strokeDashoffset:1,strokeMiterlimit:1,strokeOpacity:1,strokeWidth:1},HIe=/[A-Z]|^ms/g,$Ie=/_EMO_([^_]+?)_([^]*?)_EMO_/g,See=function(e){return e.charCodeAt(1)===45},vq=function(e){return e!=null&&typeof e!="boolean"},XM=yee(function(n){return See(n)?n:n.replace(HIe,"-$&").toLowerCase()}),Sq=function(e,i){switch(e){case"animation":case"animationName":if(typeof i=="string")return i.replace($Ie,function(o,l,u){return ep={name:l,styles:u,next:ep},l})}return GIe[e]!==1&&!See(e)&&typeof i=="number"&&i!==0?i+"px":i};function xC(n,e,i){if(i==null)return"";var o=i;if(o.__emotion_styles!==void 0)return o;switch(typeof i){case"boolean":return"";case"object":{var l=i;if(l.anim===1)return ep={name:l.name,styles:l.styles,next:ep},l.name;var u=i;if(u.styles!==void 0){var f=u.next;if(f!==void 0)for(;f!==void 0;)ep={name:f.name,styles:f.styles,next:ep},f=f.next;var _=u.styles+";";return _}return KIe(n,e,i)}case"function":{if(n!==void 0){var E=ep,b=i(n);return ep=E,xC(n,e,b)}break}}var C=i;if(e==null)return C;var I=e[C];return I!==void 0?I:C}function KIe(n,e,i){var o="";if(Array.isArray(i))for(var l=0;l<i.length;l++)o+=xC(n,e,i[l])+";";else for(var u in i){var f=i[u];if(typeof f!="object"){var _=f;e!=null&&e[_]!==void 0?o+=u+"{"+e[_]+"}":vq(_)&&(o+=XM(u)+":"+Sq(u,_)+";")}else if(Array.isArray(f)&&typeof f[0]=="string"&&(e==null||e[f[0]]===void 0))for(var E=0;E<f.length;E++)vq(f[E])&&(o+=XM(u)+":"+Sq(u,f[E])+";");else{var b=xC(n,e,f);switch(u){case"animation":case"animationName":{o+=XM(u)+":"+b+";";break}default:o+=u+"{"+b+"}"}}}return o}var bq=/label:\s*([^\s;{]+)\s*(;|$)/g,ep;function B1(n,e,i){if(n.length===1&&typeof n[0]=="object"&&n[0]!==null&&n[0].styles!==void 0)return n[0];var o=!0,l="";ep=void 0;var u=n[0];if(u==null||u.raw===void 0)o=!1,l+=xC(i,e,u);else{var f=u;l+=f[0]}for(var _=1;_<n.length;_++)if(l+=xC(i,e,n[_]),o){var E=u;l+=E[_]}bq.lastIndex=0;for(var b="",C;(C=bq.exec(l))!==null;)b+="-"+C[1];var I=zIe(l)+b;return{name:I,styles:l,next:ep}}var qIe=function(e){return e()},bee=NK.useInsertionEffect?NK.useInsertionEffect:!1,wee=bee||qIe,wq=bee||k.useLayoutEffect,Qj=k.createContext(typeof HTMLElement<"u"?MIe({key:"css"}):null);Qj.Provider;var YIe=function(){return k.useContext(Qj)},Zj=function(e){return k.forwardRef(function(i,o){var l=k.useContext(Qj);return e(i,l,o)})},R0=k.createContext({}),XIe=function(e,i){if(typeof i=="function"){var o=i(e);return o}return Xy({},e,i)},JIe=mq(function(n){return mq(function(e){return XIe(n,e)})}),QIe=function(e){var i=k.useContext(R0);return e.theme!==i&&(i=JIe(i)(e.theme)),k.createElement(R0.Provider,{value:i},e.children)},eF={}.hasOwnProperty,dV="__EMOTION_TYPE_PLEASE_DO_NOT_USE__",ZIe=function(e,i){var o={};for(var l in i)eF.call(i,l)&&(o[l]=i[l]);return o[dV]=e,o},eAe=function(e){var i=e.cache,o=e.serialized,l=e.isStringTag;return Xj(i,o,l),wee(function(){return Jj(i,o,l)}),null},tAe=Zj(function(n,e,i){var o=n.css;typeof o=="string"&&e.registered[o]!==void 0&&(o=e.registered[o]);var l=n[dV],u=[o],f="";typeof n.className=="string"?f=vee(e.registered,u,n.className):n.className!=null&&(f=n.className+" ");var _=B1(u,void 0,k.useContext(R0));f+=e.key+"-"+_.name;var E={};for(var b in n)eF.call(n,b)&&b!=="css"&&b!==dV&&(E[b]=n[b]);return E.className=f,i&&(E.ref=i),k.createElement(k.Fragment,null,k.createElement(eAe,{cache:e,serialized:_,isStringTag:typeof l=="string"}),k.createElement(l,E))}),nAe=tAe,Tq=function(e,i){var o=arguments;if(i==null||!eF.call(i,"css"))return k.createElement.apply(void 0,o);var l=o.length,u=new Array(l);u[0]=nAe,u[1]=ZIe(e,i);for(var f=2;f<l;f++)u[f]=o[f];return k.createElement.apply(null,u)};(function(n){var e;e||(e=n.JSX||(n.JSX={}))})(Tq||(Tq={}));var W1=Zj(function(n,e){var i=n.styles,o=B1([i],void 0,k.useContext(R0)),l=k.useRef();return wq(function(){var u=e.key+"-global",f=new e.sheet.constructor({key:u,nonce:e.sheet.nonce,container:e.sheet.container,speedy:e.sheet.isSpeedy}),_=!1,E=document.querySelector('style[data-emotion="'+u+" "+o.name+'"]');return e.sheet.tags.length&&(f.before=e.sheet.tags[0]),E!==null&&(_=!0,E.setAttribute("data-emotion",u),f.hydrate([E])),l.current=[f,_],function(){f.flush()}},[e]),wq(function(){var u=l.current,f=u[0],_=u[1];if(_){u[1]=!1;return}if(o.next!==void 0&&Jj(e,o.next,!0),f.tags.length){var E=f.tags[f.tags.length-1].nextElementSibling;f.before=E,f.flush()}e.insert("",o,f,!1)},[e,o.name]),null});function rAe(){for(var n=arguments.length,e=new Array(n),i=0;i<n;i++)e[i]=arguments[i];return B1(e)}function uR(){var n=rAe.apply(void 0,arguments),e="animation-"+n.name;return{name:e,styles:"@keyframes "+e+"{"+n.styles+"}",anim:1,toString:function(){return"_EMO_"+this.name+"_"+this.styles+"_EMO_"}}}const tF=k.createContext({});tF.displayName="ColorModeContext";function z1(){const n=k.useContext(tF);if(n===void 0)throw new Error("useColorMode must be used within a ColorModeProvider");return n}function kg(n,e){const{colorMode:i}=z1();return i==="dark"?e:n}const DO={light:"chakra-ui-light",dark:"chakra-ui-dark"};function iAe(n={}){const{preventTransition:e=!0,nonce:i}=n,o={setDataset:l=>{const u=e?o.preventTransition():void 0;document.documentElement.dataset.theme=l,document.documentElement.style.colorScheme=l,u==null||u()},setClassName(l){document.body.classList.add(l?DO.dark:DO.light),document.body.classList.remove(l?DO.light:DO.dark)},query(){return window.matchMedia("(prefers-color-scheme: dark)")},getSystemTheme(l){return o.query().matches??l==="dark"?"dark":"light"},addListener(l){const u=o.query(),f=_=>{l(_.matches?"dark":"light")};return typeof u.addListener=="function"?u.addListener(f):u.addEventListener("change",f),()=>{typeof u.removeListener=="function"?u.removeListener(f):u.removeEventListener("change",f)}},preventTransition(){const l=document.createElement("style");return l.appendChild(document.createTextNode("*{-webkit-transition:none!important;-moz-transition:none!important;-o-transition:none!important;-ms-transition:none!important;transition:none!important}")),i!==void 0&&(l.nonce=i),document.head.appendChild(l),()=>{window.getComputedStyle(document.body),requestAnimationFrame(()=>{requestAnimationFrame(()=>{document.head.removeChild(l)})})}}};return o}const sAe="chakra-ui-color-mode";function oAe(n){return{ssr:!1,type:"localStorage",get(e){if(!(globalThis!=null&&globalThis.document))return e;let i;try{i=localStorage.getItem(n)||e}catch{}return i||e},set(e){try{localStorage.setItem(n,e)}catch{}}}}const aAe=oAe(sAe),Cq=()=>{},cAe=TEe()?k.useLayoutEffect:k.useEffect;function Rq(n,e){return n.type==="cookie"&&n.ssr?n.get(e):e}const Tee=function(e){const{value:i,children:o,options:{useSystemColorMode:l,initialColorMode:u,disableTransitionOnChange:f}={},colorModeManager:_=aAe}=e,E=YIe(),b=u==="dark"?"dark":"light",[C,I]=k.useState(()=>Rq(_,b)),[P,L]=k.useState(()=>Rq(_)),{getSystemTheme:M,setClassName:F,setDataset:B,addListener:Z}=k.useMemo(()=>iAe({preventTransition:f,nonce:E==null?void 0:E.nonce}),[f,E==null?void 0:E.nonce]),K=u==="system"&&!C?P:C,re=k.useCallback(pe=>{const X=pe==="system"?M():pe;I(X),F(X==="dark"),B(X),_.set(X)},[_,M,F,B]);cAe(()=>{u==="system"&&L(M())},[]),k.useEffect(()=>{const pe=_.get();if(pe){re(pe);return}if(u==="system"){re("system");return}re(b)},[_,b,u,re]);const ae=k.useCallback(()=>{re(K==="dark"?"light":"dark")},[K,re]);k.useEffect(()=>{if(l)return Z(re)},[l,Z,re]);const ne=k.useMemo(()=>({colorMode:i??K,toggleColorMode:i?Cq:ae,setColorMode:i?Cq:re,forced:i!==void 0}),[K,ae,re,i]);return S.jsx(tF.Provider,{value:ne,children:o})};Tee.displayName="ColorModeProvider";const Cee=String.raw,Ree=Cee`
  :root,
  :host {
    --chakra-vh: 100vh;
  }

  @supports (height: -webkit-fill-available) {
    :root,
    :host {
      --chakra-vh: -webkit-fill-available;
    }
  }

  @supports (height: -moz-fill-available) {
    :root,
    :host {
      --chakra-vh: -moz-fill-available;
    }
  }

  @supports (height: 100dvh) {
    :root,
    :host {
      --chakra-vh: 100dvh;
    }
  }
`,lAe=()=>S.jsx(W1,{styles:Ree}),uAe=({scope:n=""})=>S.jsx(W1,{styles:Cee`
      html {
        line-height: 1.5;
        -webkit-text-size-adjust: 100%;
        font-family: system-ui, sans-serif;
        -webkit-font-smoothing: antialiased;
        text-rendering: optimizeLegibility;
        -moz-osx-font-smoothing: grayscale;
        touch-action: manipulation;
      }

      body {
        position: relative;
        min-height: 100%;
        margin: 0;
        font-feature-settings: "kern";
      }

      ${n} :where(*, *::before, *::after) {
        border-width: 0;
        border-style: solid;
        box-sizing: border-box;
        word-wrap: break-word;
      }

      main {
        display: block;
      }

      ${n} hr {
        border-top-width: 1px;
        box-sizing: content-box;
        height: 0;
        overflow: visible;
      }

      ${n} :where(pre, code, kbd,samp) {
        font-family: SFMono-Regular, Menlo, Monaco, Consolas, monospace;
        font-size: 1em;
      }

      ${n} a {
        background-color: transparent;
        color: inherit;
        text-decoration: inherit;
      }

      ${n} abbr[title] {
        border-bottom: none;
        text-decoration: underline;
        -webkit-text-decoration: underline dotted;
        text-decoration: underline dotted;
      }

      ${n} :where(b, strong) {
        font-weight: bold;
      }

      ${n} small {
        font-size: 80%;
      }

      ${n} :where(sub,sup) {
        font-size: 75%;
        line-height: 0;
        position: relative;
        vertical-align: baseline;
      }

      ${n} sub {
        bottom: -0.25em;
      }

      ${n} sup {
        top: -0.5em;
      }

      ${n} img {
        border-style: none;
      }

      ${n} :where(button, input, optgroup, select, textarea) {
        font-family: inherit;
        font-size: 100%;
        line-height: 1.15;
        margin: 0;
      }

      ${n} :where(button, input) {
        overflow: visible;
      }

      ${n} :where(button, select) {
        text-transform: none;
      }

      ${n} :where(
          button::-moz-focus-inner,
          [type="button"]::-moz-focus-inner,
          [type="reset"]::-moz-focus-inner,
          [type="submit"]::-moz-focus-inner
        ) {
        border-style: none;
        padding: 0;
      }

      ${n} fieldset {
        padding: 0.35em 0.75em 0.625em;
      }

      ${n} legend {
        box-sizing: border-box;
        color: inherit;
        display: table;
        max-width: 100%;
        padding: 0;
        white-space: normal;
      }

      ${n} progress {
        vertical-align: baseline;
      }

      ${n} textarea {
        overflow: auto;
      }

      ${n} :where([type="checkbox"], [type="radio"]) {
        box-sizing: border-box;
        padding: 0;
      }

      ${n} input[type="number"]::-webkit-inner-spin-button,
      ${n} input[type="number"]::-webkit-outer-spin-button {
        -webkit-appearance: none !important;
      }

      ${n} input[type="number"] {
        -moz-appearance: textfield;
      }

      ${n} input[type="search"] {
        -webkit-appearance: textfield;
        outline-offset: -2px;
      }

      ${n} input[type="search"]::-webkit-search-decoration {
        -webkit-appearance: none !important;
      }

      ${n} ::-webkit-file-upload-button {
        -webkit-appearance: button;
        font: inherit;
      }

      ${n} details {
        display: block;
      }

      ${n} summary {
        display: list-item;
      }

      template {
        display: none;
      }

      [hidden] {
        display: none !important;
      }

      ${n} :where(
          blockquote,
          dl,
          dd,
          h1,
          h2,
          h3,
          h4,
          h5,
          h6,
          hr,
          figure,
          p,
          pre
        ) {
        margin: 0;
      }

      ${n} button {
        background: transparent;
        padding: 0;
      }

      ${n} fieldset {
        margin: 0;
        padding: 0;
      }

      ${n} :where(ol, ul) {
        margin: 0;
        padding: 0;
      }

      ${n} textarea {
        resize: vertical;
      }

      ${n} :where(button, [role="button"]) {
        cursor: pointer;
      }

      ${n} button::-moz-focus-inner {
        border: 0 !important;
      }

      ${n} table {
        border-collapse: collapse;
      }

      ${n} :where(h1, h2, h3, h4, h5, h6) {
        font-size: inherit;
        font-weight: inherit;
      }

      ${n} :where(button, input, optgroup, select, textarea) {
        padding: 0;
        line-height: inherit;
        color: inherit;
      }

      ${n} :where(img, svg, video, canvas, audio, iframe, embed, object) {
        display: block;
      }

      ${n} :where(img, video) {
        max-width: 100%;
        height: auto;
      }

      [data-js-focus-visible]
        :focus:not([data-focus-visible-added]):not(
          [data-focus-visible-disabled]
        ) {
        outline: none;
        box-shadow: none;
      }

      ${n} select::-ms-expand {
        display: none;
      }

      ${Ree}
    `});function dAe(n){const{cssVarsRoot:e,theme:i,children:o}=n,l=k.useMemo(()=>XSe(i),[i]);return S.jsxs(QIe,{theme:l,children:[S.jsx(hAe,{root:e}),o]})}function hAe({root:n=":host, :root"}){const e=[n,"[data-theme]"].join(",");return S.jsx(W1,{styles:i=>({[e]:i.__cssVars})})}Ii({name:"StylesContext",errorMessage:"useStyles: `styles` is undefined. Seems you forgot to wrap the components in `<StylesProvider />` "});function pAe(){const{colorMode:n}=z1();return S.jsx(W1,{styles:e=>{const i=DZ(e,"styles.global"),o=gl(i,{theme:e,colorMode:n});return o?JZ(o)(e):void 0}})}const[fAe,mAe]=Ii({strict:!1,name:"PortalManagerContext"});function nF(n){const{children:e,zIndex:i}=n;return S.jsx(fAe,{value:{zIndex:i},children:e})}nF.displayName="PortalManager";const rF=k.createContext({getDocument(){return document},getWindow(){return window}});rF.displayName="EnvironmentContext";function gAe({defer:n}={}){const[,e]=k.useReducer(i=>i+1,0);return dp(()=>{n&&e()},[n]),k.useContext(rF)}function Iee(n){const{children:e,environment:i,disabled:o}=n,l=k.useRef(null),u=k.useMemo(()=>i||{getDocument:()=>{var _;return((_=l.current)==null?void 0:_.ownerDocument)??document},getWindow:()=>{var _;return((_=l.current)==null?void 0:_.ownerDocument.defaultView)??window}},[i]),f=!o||!i;return S.jsxs(rF.Provider,{value:u,children:[e,f&&S.jsx("span",{id:"__chakra_env",hidden:!0,ref:l})]})}Iee.displayName="EnvironmentProvider";const _Ae=n=>{const{children:e,colorModeManager:i,portalZIndex:o,resetScope:l,resetCSS:u=!0,theme:f={},environment:_,cssVarsRoot:E,disableEnvironment:b,disableGlobalStyle:C}=n,I=S.jsx(Iee,{environment:_,disabled:b,children:e});return S.jsx(dAe,{theme:f,cssVarsRoot:E,children:S.jsxs(Tee,{colorModeManager:i,options:f.config,children:[u?S.jsx(uAe,{scope:l}):S.jsx(lAe,{}),!C&&S.jsx(pAe,{}),o?S.jsx(nF,{zIndex:o,children:I}):I]})})},iF=k.createContext({});function sF(n){const e=k.useRef(null);return e.current===null&&(e.current=n()),e.current}const dR=k.createContext(null),oF=k.createContext({transformPagePoint:n=>n,isStatic:!1,reducedMotion:"never"});class yAe extends k.Component{getSnapshotBeforeUpdate(e){const i=this.props.childRef.current;if(i&&e.isPresent&&!this.props.isPresent){const o=this.props.sizeRef.current;o.height=i.offsetHeight||0,o.width=i.offsetWidth||0,o.top=i.offsetTop,o.left=i.offsetLeft}return null}componentDidUpdate(){}render(){return this.props.children}}function EAe({children:n,isPresent:e}){const i=k.useId(),o=k.useRef(null),l=k.useRef({width:0,height:0,top:0,left:0}),{nonce:u}=k.useContext(oF);return k.useInsertionEffect(()=>{const{width:f,height:_,top:E,left:b}=l.current;if(e||!o.current||!f||!_)return;o.current.dataset.motionPopId=i;const C=document.createElement("style");return u&&(C.nonce=u),document.head.appendChild(C),C.sheet&&C.sheet.insertRule(`
          [data-motion-pop-id="${i}"] {
            position: absolute !important;
            width: ${f}px !important;
            height: ${_}px !important;
            top: ${E}px !important;
            left: ${b}px !important;
          }
        `),()=>{document.head.removeChild(C)}},[e]),S.jsx(yAe,{isPresent:e,childRef:o,sizeRef:l,children:k.cloneElement(n,{ref:o})})}const vAe=({children:n,initial:e,isPresent:i,onExitComplete:o,custom:l,presenceAffectsLayout:u,mode:f})=>{const _=sF(SAe),E=k.useId(),b=k.useCallback(I=>{_.set(I,!0);for(const P of _.values())if(!P)return;o&&o()},[_,o]),C=k.useMemo(()=>({id:E,initial:e,isPresent:i,custom:l,onExitComplete:b,register:I=>(_.set(I,!1),()=>_.delete(I))}),u?[Math.random(),b]:[i,b]);return k.useMemo(()=>{_.forEach((I,P)=>_.set(P,!1))},[i]),k.useEffect(()=>{!i&&!_.size&&o&&o()},[i]),f==="popLayout"&&(n=S.jsx(EAe,{isPresent:i,children:n})),S.jsx(dR.Provider,{value:C,children:n})};function SAe(){return new Map}function aF(n=!0){const e=k.useContext(dR);if(e===null)return[!0,null];const{isPresent:i,onExitComplete:o,register:l}=e,u=k.useId();k.useEffect(()=>{n&&l(u)},[n]);const f=k.useCallback(()=>n&&o&&o(u),[u,o,n]);return!i&&o?[!1,f]:[!0]}function bAe(){return wAe(k.useContext(dR))}function wAe(n){return n===null?!0:n.isPresent}const xO=n=>n.key||"";function Iq(n){const e=[];return k.Children.forEach(n,i=>{k.isValidElement(i)&&e.push(i)}),e}const cF=typeof window<"u",Aee=cF?k.useLayoutEffect:k.useEffect,X0=({children:n,custom:e,initial:i=!0,onExitComplete:o,presenceAffectsLayout:l=!0,mode:u="sync",propagate:f=!1})=>{const[_,E]=aF(f),b=k.useMemo(()=>Iq(n),[n]),C=f&&!_?[]:b.map(xO),I=k.useRef(!0),P=k.useRef(b),L=sF(()=>new Map),[M,F]=k.useState(b),[B,Z]=k.useState(b);Aee(()=>{I.current=!1,P.current=b;for(let ae=0;ae<B.length;ae++){const ne=xO(B[ae]);C.includes(ne)?L.delete(ne):L.get(ne)!==!0&&L.set(ne,!1)}},[B,C.length,C.join("-")]);const K=[];if(b!==M){let ae=[...b];for(let ne=0;ne<B.length;ne++){const pe=B[ne],X=xO(pe);C.includes(X)||(ae.splice(ne,0,pe),K.push(pe))}u==="wait"&&K.length&&(ae=K),Z(Iq(ae)),F(b);return}const{forceRender:re}=k.useContext(iF);return S.jsx(S.Fragment,{children:B.map(ae=>{const ne=xO(ae),pe=f&&!_?!1:b===B||C.includes(ne),X=()=>{if(L.has(ne))L.set(ne,!0);else return;let J=!0;L.forEach(Y=>{Y||(J=!1)}),J&&(re==null||re(),Z(P.current),f&&(E==null||E()),o&&o())};return S.jsx(vAe,{isPresent:pe,initial:!I.current||i?void 0:!1,custom:pe?void 0:e,presenceAffectsLayout:l,mode:u,onExitComplete:pe?void 0:X,children:ae},ne)})})},Ql=n=>n;let Pee=Ql;function lF(n){let e;return()=>(e===void 0&&(e=n()),e)}const I0=(n,e,i)=>{const o=e-n;return o===0?1:(i-n)/o},Hf=n=>n*1e3,$f=n=>n/1e3,TAe={useManualTiming:!1};function CAe(n){let e=new Set,i=new Set,o=!1,l=!1;const u=new WeakSet;let f={delta:0,timestamp:0,isProcessing:!1};function _(b){u.has(b)&&(E.schedule(b),n()),b(f)}const E={schedule:(b,C=!1,I=!1)=>{const L=I&&o?e:i;return C&&u.add(b),L.has(b)||L.add(b),b},cancel:b=>{i.delete(b),u.delete(b)},process:b=>{if(f=b,o){l=!0;return}o=!0,[e,i]=[i,e],e.forEach(_),e.clear(),o=!1,l&&(l=!1,E.process(b))}};return E}const LO=["read","resolveKeyframes","update","preRender","render","postRender"],RAe=40;function Oee(n,e){let i=!1,o=!0;const l={delta:0,timestamp:0,isProcessing:!1},u=()=>i=!0,f=LO.reduce((Z,K)=>(Z[K]=CAe(u),Z),{}),{read:_,resolveKeyframes:E,update:b,preRender:C,render:I,postRender:P}=f,L=()=>{const Z=performance.now();i=!1,l.delta=o?1e3/60:Math.max(Math.min(Z-l.timestamp,RAe),1),l.timestamp=Z,l.isProcessing=!0,_.process(l),E.process(l),b.process(l),C.process(l),I.process(l),P.process(l),l.isProcessing=!1,i&&e&&(o=!1,n(L))},M=()=>{i=!0,o=!0,l.isProcessing||n(L)};return{schedule:LO.reduce((Z,K)=>{const re=f[K];return Z[K]=(ae,ne=!1,pe=!1)=>(i||M(),re.schedule(ae,ne,pe)),Z},{}),cancel:Z=>{for(let K=0;K<LO.length;K++)f[LO[K]].cancel(Z)},state:l,steps:f}}const{schedule:ss,cancel:jg,state:Aa,steps:JM}=Oee(typeof requestAnimationFrame<"u"?requestAnimationFrame:Ql,!0),kee=k.createContext({strict:!1}),Aq={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},A0={};for(const n in Aq)A0[n]={isEnabled:e=>Aq[n].some(i=>!!e[i])};function IAe(n){for(const e in n)A0[e]={...A0[e],...n[e]}}const AAe=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function Hk(n){return n.startsWith("while")||n.startsWith("drag")&&n!=="draggable"||n.startsWith("layout")||n.startsWith("onTap")||n.startsWith("onPan")||n.startsWith("onLayout")||AAe.has(n)}let Nee=n=>!Hk(n);function PAe(n){n&&(Nee=e=>e.startsWith("on")?!Hk(e):n(e))}try{PAe(require("@emotion/is-prop-valid").default)}catch{}function OAe(n,e,i){const o={};for(const l in n)l==="values"&&typeof n.values=="object"||(Nee(l)||i===!0&&Hk(l)||!e&&!Hk(l)||n.draggable&&l.startsWith("onDrag"))&&(o[l]=n[l]);return o}function kAe(n){if(typeof Proxy>"u")return n;const e=new Map,i=(...o)=>n(...o);return new Proxy(i,{get:(o,l)=>l==="create"?n:(e.has(l)||e.set(l,n(l)),e.get(l))})}const G1=k.createContext({});function LC(n){return typeof n=="string"||Array.isArray(n)}function H1(n){return n!==null&&typeof n=="object"&&typeof n.start=="function"}const uF=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],dF=["initial",...uF];function $1(n){return H1(n.animate)||dF.some(e=>LC(n[e]))}function Dee(n){return!!($1(n)||n.variants)}function NAe(n,e){if($1(n)){const{initial:i,animate:o}=n;return{initial:i===!1||LC(i)?i:void 0,animate:LC(o)?o:void 0}}return n.inherit!==!1?e:{}}function DAe(n){const{initial:e,animate:i}=NAe(n,k.useContext(G1));return k.useMemo(()=>({initial:e,animate:i}),[Pq(e),Pq(i)])}function Pq(n){return Array.isArray(n)?n.join(" "):n}const xAe=Symbol.for("motionComponentSymbol");function JS(n){return n&&typeof n=="object"&&Object.prototype.hasOwnProperty.call(n,"current")}function LAe(n,e,i){return k.useCallback(o=>{o&&n.onMount&&n.onMount(o),e&&(o?e.mount(o):e.unmount()),i&&(typeof i=="function"?i(o):JS(i)&&(i.current=o))},[e])}const hF=n=>n.replace(/([a-z])([A-Z])/gu,"$1-$2").toLowerCase(),MAe="framerAppearId",xee="data-"+hF(MAe),{schedule:pF}=Oee(queueMicrotask,!1),Lee=k.createContext({});function UAe(n,e,i,o,l){var u,f;const{visualElement:_}=k.useContext(G1),E=k.useContext(kee),b=k.useContext(dR),C=k.useContext(oF).reducedMotion,I=k.useRef(null);o=o||E.renderer,!I.current&&o&&(I.current=o(n,{visualState:e,parent:_,props:i,presenceContext:b,blockInitialAnimation:b?b.initial===!1:!1,reducedMotionConfig:C}));const P=I.current,L=k.useContext(Lee);P&&!P.projection&&l&&(P.type==="html"||P.type==="svg")&&VAe(I.current,i,l,L);const M=k.useRef(!1);k.useInsertionEffect(()=>{P&&M.current&&P.update(i,b)});const F=i[xee],B=k.useRef(!!F&&!(!((u=window.MotionHandoffIsComplete)===null||u===void 0)&&u.call(window,F))&&((f=window.MotionHasOptimisedAnimation)===null||f===void 0?void 0:f.call(window,F)));return Aee(()=>{P&&(M.current=!0,window.MotionIsMounted=!0,P.updateFeatures(),pF.render(P.render),B.current&&P.animationState&&P.animationState.animateChanges())}),k.useEffect(()=>{P&&(!B.current&&P.animationState&&P.animationState.animateChanges(),B.current&&(queueMicrotask(()=>{var Z;(Z=window.MotionHandoffMarkAsComplete)===null||Z===void 0||Z.call(window,F)}),B.current=!1))}),P}function VAe(n,e,i,o){const{layoutId:l,layout:u,drag:f,dragConstraints:_,layoutScroll:E,layoutRoot:b}=e;n.projection=new i(n.latestValues,e["data-framer-portal-id"]?void 0:Mee(n.parent)),n.projection.setOptions({layoutId:l,layout:u,alwaysMeasureLayout:!!f||_&&JS(_),visualElement:n,animationType:typeof u=="string"?u:"both",initialPromotionConfig:o,layoutScroll:E,layoutRoot:b})}function Mee(n){if(n)return n.options.allowProjection!==!1?n.projection:Mee(n.parent)}function jAe({preloadedFeatures:n,createVisualElement:e,useRender:i,useVisualState:o,Component:l}){var u,f;n&&IAe(n);function _(b,C){let I;const P={...k.useContext(oF),...b,layoutId:FAe(b)},{isStatic:L}=P,M=DAe(b),F=o(b,L);if(!L&&cF){BAe();const B=WAe(P);I=B.MeasureLayout,M.visualElement=UAe(l,F,P,e,B.ProjectionNode)}return S.jsxs(G1.Provider,{value:M,children:[I&&M.visualElement?S.jsx(I,{visualElement:M.visualElement,...P}):null,i(l,b,LAe(F,M.visualElement,C),F,L,M.visualElement)]})}_.displayName=`motion.${typeof l=="string"?l:`create(${(f=(u=l.displayName)!==null&&u!==void 0?u:l.name)!==null&&f!==void 0?f:""})`}`;const E=k.forwardRef(_);return E[xAe]=l,E}function FAe({layoutId:n}){const e=k.useContext(iF).id;return e&&n!==void 0?e+"-"+n:n}function BAe(n,e){k.useContext(kee).strict}function WAe(n){const{drag:e,layout:i}=A0;if(!e&&!i)return{};const o={...e,...i};return{MeasureLayout:e!=null&&e.isEnabled(n)||i!=null&&i.isEnabled(n)?o.MeasureLayout:void 0,ProjectionNode:o.ProjectionNode}}const zAe=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function fF(n){return typeof n!="string"||n.includes("-")?!1:!!(zAe.indexOf(n)>-1||/[A-Z]/u.test(n))}function Oq(n){const e=[{},{}];return n==null||n.values.forEach((i,o)=>{e[0][o]=i.get(),e[1][o]=i.getVelocity()}),e}function mF(n,e,i,o){if(typeof e=="function"){const[l,u]=Oq(o);e=e(i!==void 0?i:n.custom,l,u)}if(typeof e=="string"&&(e=n.variants&&n.variants[e]),typeof e=="function"){const[l,u]=Oq(o);e=e(i!==void 0?i:n.custom,l,u)}return e}const hV=n=>Array.isArray(n),GAe=n=>!!(n&&typeof n=="object"&&n.mix&&n.toValue),HAe=n=>hV(n)?n[n.length-1]||0:n,ac=n=>!!(n&&n.getVelocity);function yk(n){const e=ac(n)?n.get():n;return GAe(e)?e.toValue():e}function $Ae({scrapeMotionValuesFromProps:n,createRenderState:e,onUpdate:i},o,l,u){const f={latestValues:KAe(o,l,u,n),renderState:e()};return i&&(f.onMount=_=>i({props:o,current:_,...f}),f.onUpdate=_=>i(_)),f}const Uee=n=>(e,i)=>{const o=k.useContext(G1),l=k.useContext(dR),u=()=>$Ae(n,e,o,l);return i?u():sF(u)};function KAe(n,e,i,o){const l={},u=o(n,{});for(const P in u)l[P]=yk(u[P]);let{initial:f,animate:_}=n;const E=$1(n),b=Dee(n);e&&b&&!E&&n.inherit!==!1&&(f===void 0&&(f=e.initial),_===void 0&&(_=e.animate));let C=i?i.initial===!1:!1;C=C||f===!1;const I=C?_:f;if(I&&typeof I!="boolean"&&!H1(I)){const P=Array.isArray(I)?I:[I];for(let L=0;L<P.length;L++){const M=mF(n,P[L]);if(M){const{transitionEnd:F,transition:B,...Z}=M;for(const K in Z){let re=Z[K];if(Array.isArray(re)){const ae=C?re.length-1:0;re=re[ae]}re!==null&&(l[K]=re)}for(const K in F)l[K]=F[K]}}}return l}const J0=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],lE=new Set(J0),Vee=n=>e=>typeof e=="string"&&e.startsWith(n),jee=Vee("--"),qAe=Vee("var(--"),gF=n=>qAe(n)?YAe.test(n.split("/*")[0].trim()):!1,YAe=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu,Fee=(n,e)=>e&&typeof n=="number"?e.transform(n):n,Qf=(n,e,i)=>i>e?e:i<n?n:i,Q0={test:n=>typeof n=="number",parse:parseFloat,transform:n=>n},MC={...Q0,transform:n=>Qf(0,1,n)},MO={...Q0,default:1},hR=n=>({test:e=>typeof e=="string"&&e.endsWith(n)&&e.split(" ").length===1,parse:parseFloat,transform:e=>`${e}${n}`}),bg=hR("deg"),fp=hR("%"),zn=hR("px"),XAe=hR("vh"),JAe=hR("vw"),kq={...fp,parse:n=>fp.parse(n)/100,transform:n=>fp.transform(n*100)},QAe={borderWidth:zn,borderTopWidth:zn,borderRightWidth:zn,borderBottomWidth:zn,borderLeftWidth:zn,borderRadius:zn,radius:zn,borderTopLeftRadius:zn,borderTopRightRadius:zn,borderBottomRightRadius:zn,borderBottomLeftRadius:zn,width:zn,maxWidth:zn,height:zn,maxHeight:zn,top:zn,right:zn,bottom:zn,left:zn,padding:zn,paddingTop:zn,paddingRight:zn,paddingBottom:zn,paddingLeft:zn,margin:zn,marginTop:zn,marginRight:zn,marginBottom:zn,marginLeft:zn,backgroundPositionX:zn,backgroundPositionY:zn},ZAe={rotate:bg,rotateX:bg,rotateY:bg,rotateZ:bg,scale:MO,scaleX:MO,scaleY:MO,scaleZ:MO,skew:bg,skewX:bg,skewY:bg,distance:zn,translateX:zn,translateY:zn,translateZ:zn,x:zn,y:zn,z:zn,perspective:zn,transformPerspective:zn,opacity:MC,originX:kq,originY:kq,originZ:zn},Nq={...Q0,transform:Math.round},_F={...QAe,...ZAe,zIndex:Nq,size:zn,fillOpacity:MC,strokeOpacity:MC,numOctaves:Nq},ePe={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},tPe=J0.length;function nPe(n,e,i){let o="",l=!0;for(let u=0;u<tPe;u++){const f=J0[u],_=n[f];if(_===void 0)continue;let E=!0;if(typeof _=="number"?E=_===(f.startsWith("scale")?1:0):E=parseFloat(_)===0,!E||i){const b=Fee(_,_F[f]);if(!E){l=!1;const C=ePe[f]||f;o+=`${C}(${b}) `}i&&(e[f]=b)}}return o=o.trim(),i?o=i(e,l?"":o):l&&(o="none"),o}function yF(n,e,i){const{style:o,vars:l,transformOrigin:u}=n;let f=!1,_=!1;for(const E in e){const b=e[E];if(lE.has(E)){f=!0;continue}else if(jee(E)){l[E]=b;continue}else{const C=Fee(b,_F[E]);E.startsWith("origin")?(_=!0,u[E]=C):o[E]=C}}if(e.transform||(f||i?o.transform=nPe(e,n.transform,i):o.transform&&(o.transform="none")),_){const{originX:E="50%",originY:b="50%",originZ:C=0}=u;o.transformOrigin=`${E} ${b} ${C}`}}const rPe={offset:"stroke-dashoffset",array:"stroke-dasharray"},iPe={offset:"strokeDashoffset",array:"strokeDasharray"};function sPe(n,e,i=1,o=0,l=!0){n.pathLength=1;const u=l?rPe:iPe;n[u.offset]=zn.transform(-o);const f=zn.transform(e),_=zn.transform(i);n[u.array]=`${f} ${_}`}function Dq(n,e,i){return typeof n=="string"?n:zn.transform(e+i*n)}function oPe(n,e,i){const o=Dq(e,n.x,n.width),l=Dq(i,n.y,n.height);return`${o} ${l}`}function EF(n,{attrX:e,attrY:i,attrScale:o,originX:l,originY:u,pathLength:f,pathSpacing:_=1,pathOffset:E=0,...b},C,I){if(yF(n,b,I),C){n.style.viewBox&&(n.attrs.viewBox=n.style.viewBox);return}n.attrs=n.style,n.style={};const{attrs:P,style:L,dimensions:M}=n;P.transform&&(M&&(L.transform=P.transform),delete P.transform),M&&(l!==void 0||u!==void 0||L.transform)&&(L.transformOrigin=oPe(M,l!==void 0?l:.5,u!==void 0?u:.5)),e!==void 0&&(P.x=e),i!==void 0&&(P.y=i),o!==void 0&&(P.scale=o),f!==void 0&&sPe(P,f,_,E,!1)}const vF=()=>({style:{},transform:{},transformOrigin:{},vars:{}}),Bee=()=>({...vF(),attrs:{}}),SF=n=>typeof n=="string"&&n.toLowerCase()==="svg";function Wee(n,{style:e,vars:i},o,l){Object.assign(n.style,e,l&&l.getProjectionStyles(o));for(const u in i)n.style.setProperty(u,i[u])}const zee=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);function Gee(n,e,i,o){Wee(n,e,void 0,o);for(const l in e.attrs)n.setAttribute(zee.has(l)?l:hF(l),e.attrs[l])}const $k={};function aPe(n){Object.assign($k,n)}function Hee(n,{layout:e,layoutId:i}){return lE.has(n)||n.startsWith("origin")||(e||i!==void 0)&&(!!$k[n]||n==="opacity")}function bF(n,e,i){var o;const{style:l}=n,u={};for(const f in l)(ac(l[f])||e.style&&ac(e.style[f])||Hee(f,n)||((o=i==null?void 0:i.getValue(f))===null||o===void 0?void 0:o.liveStyle)!==void 0)&&(u[f]=l[f]);return u}function $ee(n,e,i){const o=bF(n,e,i);for(const l in n)if(ac(n[l])||ac(e[l])){const u=J0.indexOf(l)!==-1?"attr"+l.charAt(0).toUpperCase()+l.substring(1):l;o[u]=n[l]}return o}function cPe(n,e){try{e.dimensions=typeof n.getBBox=="function"?n.getBBox():n.getBoundingClientRect()}catch{e.dimensions={x:0,y:0,width:0,height:0}}}const xq=["x","y","width","height","cx","cy","r"],lPe={useVisualState:Uee({scrapeMotionValuesFromProps:$ee,createRenderState:Bee,onUpdate:({props:n,prevProps:e,current:i,renderState:o,latestValues:l})=>{if(!i)return;let u=!!n.drag;if(!u){for(const _ in l)if(lE.has(_)){u=!0;break}}if(!u)return;let f=!e;if(e)for(let _=0;_<xq.length;_++){const E=xq[_];n[E]!==e[E]&&(f=!0)}f&&ss.read(()=>{cPe(i,o),ss.render(()=>{EF(o,l,SF(i.tagName),n.transformTemplate),Gee(i,o)})})}})},uPe={useVisualState:Uee({scrapeMotionValuesFromProps:bF,createRenderState:vF})};function Kee(n,e,i){for(const o in e)!ac(e[o])&&!Hee(o,i)&&(n[o]=e[o])}function dPe({transformTemplate:n},e){return k.useMemo(()=>{const i=vF();return yF(i,e,n),Object.assign({},i.vars,i.style)},[e])}function hPe(n,e){const i=n.style||{},o={};return Kee(o,i,n),Object.assign(o,dPe(n,e)),o}function pPe(n,e){const i={},o=hPe(n,e);return n.drag&&n.dragListener!==!1&&(i.draggable=!1,o.userSelect=o.WebkitUserSelect=o.WebkitTouchCallout="none",o.touchAction=n.drag===!0?"none":`pan-${n.drag==="x"?"y":"x"}`),n.tabIndex===void 0&&(n.onTap||n.onTapStart||n.whileTap)&&(i.tabIndex=0),i.style=o,i}function fPe(n,e,i,o){const l=k.useMemo(()=>{const u=Bee();return EF(u,e,SF(o),n.transformTemplate),{...u.attrs,style:{...u.style}}},[e]);if(n.style){const u={};Kee(u,n.style,n),l.style={...u,...l.style}}return l}function mPe(n=!1){return(i,o,l,{latestValues:u},f)=>{const E=(fF(i)?fPe:pPe)(o,u,f,i),b=OAe(o,typeof i=="string",n),C=i!==k.Fragment?{...b,...E,ref:l}:{},{children:I}=o,P=k.useMemo(()=>ac(I)?I.get():I,[I]);return k.createElement(i,{...C,children:P})}}function gPe(n,e){return function(o,{forwardMotionProps:l}={forwardMotionProps:!1}){const f={...fF(o)?lPe:uPe,preloadedFeatures:n,useRender:mPe(l),createVisualElement:e,Component:o};return jAe(f)}}function qee(n,e){if(!Array.isArray(e))return!1;const i=e.length;if(i!==n.length)return!1;for(let o=0;o<i;o++)if(e[o]!==n[o])return!1;return!0}function K1(n,e,i){const o=n.getProps();return mF(o,e,i!==void 0?i:o.custom,n)}const _Pe=lF(()=>window.ScrollTimeline!==void 0);class yPe{constructor(e){this.stop=()=>this.runAll("stop"),this.animations=e.filter(Boolean)}get finished(){return Promise.all(this.animations.map(e=>"finished"in e?e.finished:e))}getAll(e){return this.animations[0][e]}setAll(e,i){for(let o=0;o<this.animations.length;o++)this.animations[o][e]=i}attachTimeline(e,i){const o=this.animations.map(l=>{if(_Pe()&&l.attachTimeline)return l.attachTimeline(e);if(typeof i=="function")return i(l)});return()=>{o.forEach((l,u)=>{l&&l(),this.animations[u].stop()})}}get time(){return this.getAll("time")}set time(e){this.setAll("time",e)}get speed(){return this.getAll("speed")}set speed(e){this.setAll("speed",e)}get startTime(){return this.getAll("startTime")}get duration(){let e=0;for(let i=0;i<this.animations.length;i++)e=Math.max(e,this.animations[i].duration);return e}runAll(e){this.animations.forEach(i=>i[e]())}flatten(){this.runAll("flatten")}play(){this.runAll("play")}pause(){this.runAll("pause")}cancel(){this.runAll("cancel")}complete(){this.runAll("complete")}}class EPe extends yPe{then(e,i){return Promise.all(this.animations).then(e).catch(i)}}function wF(n,e){return n?n[e]||n.default||n:void 0}const pV=2e4;function Yee(n){let e=0;const i=50;let o=n.next(e);for(;!o.done&&e<pV;)e+=i,o=n.next(e);return e>=pV?1/0:e}function TF(n){return typeof n=="function"}function Lq(n,e){n.timeline=e,n.onfinish=null}const CF=n=>Array.isArray(n)&&typeof n[0]=="number",vPe={linearEasing:void 0};function SPe(n,e){const i=lF(n);return()=>{var o;return(o=vPe[e])!==null&&o!==void 0?o:i()}}const Kk=SPe(()=>{try{document.createElement("div").animate({opacity:0},{easing:"linear(0, 1)"})}catch{return!1}return!0},"linearEasing"),Xee=(n,e,i=10)=>{let o="";const l=Math.max(Math.round(e/i),2);for(let u=0;u<l;u++)o+=n(I0(0,l-1,u))+", ";return`linear(${o.substring(0,o.length-2)})`};function Jee(n){return!!(typeof n=="function"&&Kk()||!n||typeof n=="string"&&(n in fV||Kk())||CF(n)||Array.isArray(n)&&n.every(Jee))}const JT=([n,e,i,o])=>`cubic-bezier(${n}, ${e}, ${i}, ${o})`,fV={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:JT([0,.65,.55,1]),circOut:JT([.55,0,1,.45]),backIn:JT([.31,.01,.66,-.59]),backOut:JT([.33,1.53,.69,.99])};function Qee(n,e){if(n)return typeof n=="function"&&Kk()?Xee(n,e):CF(n)?JT(n):Array.isArray(n)?n.map(i=>Qee(i,e)||fV.easeOut):fV[n]}const Hd={x:!1,y:!1};function Zee(){return Hd.x||Hd.y}function bPe(n,e,i){var o;if(n instanceof Element)return[n];if(typeof n=="string"){let l=document;const u=(o=void 0)!==null&&o!==void 0?o:l.querySelectorAll(n);return u?Array.from(u):[]}return Array.from(n)}function ete(n,e){const i=bPe(n),o=new AbortController,l={passive:!0,...e,signal:o.signal};return[i,l,()=>o.abort()]}function Mq(n){return e=>{e.pointerType==="touch"||Zee()||n(e)}}function wPe(n,e,i={}){const[o,l,u]=ete(n,i),f=Mq(_=>{const{target:E}=_,b=e(_);if(typeof b!="function"||!E)return;const C=Mq(I=>{b(I),E.removeEventListener("pointerleave",C)});E.addEventListener("pointerleave",C,l)});return o.forEach(_=>{_.addEventListener("pointerenter",f,l)}),u}const tte=(n,e)=>e?n===e?!0:tte(n,e.parentElement):!1,RF=n=>n.pointerType==="mouse"?typeof n.button!="number"||n.button<=0:n.isPrimary!==!1,TPe=new Set(["BUTTON","INPUT","SELECT","TEXTAREA","A"]);function CPe(n){return TPe.has(n.tagName)||n.tabIndex!==-1}const QT=new WeakSet;function Uq(n){return e=>{e.key==="Enter"&&n(e)}}function QM(n,e){n.dispatchEvent(new PointerEvent("pointer"+e,{isPrimary:!0,bubbles:!0}))}const RPe=(n,e)=>{const i=n.currentTarget;if(!i)return;const o=Uq(()=>{if(QT.has(i))return;QM(i,"down");const l=Uq(()=>{QM(i,"up")}),u=()=>QM(i,"cancel");i.addEventListener("keyup",l,e),i.addEventListener("blur",u,e)});i.addEventListener("keydown",o,e),i.addEventListener("blur",()=>i.removeEventListener("keydown",o),e)};function Vq(n){return RF(n)&&!Zee()}function IPe(n,e,i={}){const[o,l,u]=ete(n,i),f=_=>{const E=_.currentTarget;if(!Vq(_)||QT.has(E))return;QT.add(E);const b=e(_),C=(L,M)=>{window.removeEventListener("pointerup",I),window.removeEventListener("pointercancel",P),!(!Vq(L)||!QT.has(E))&&(QT.delete(E),typeof b=="function"&&b(L,{success:M}))},I=L=>{C(L,i.useGlobalTarget||tte(E,L.target))},P=L=>{C(L,!1)};window.addEventListener("pointerup",I,l),window.addEventListener("pointercancel",P,l)};return o.forEach(_=>{!CPe(_)&&_.getAttribute("tabindex")===null&&(_.tabIndex=0),(i.useGlobalTarget?window:_).addEventListener("pointerdown",f,l),_.addEventListener("focus",b=>RPe(b,l),l)}),u}function APe(n){return n==="x"||n==="y"?Hd[n]?null:(Hd[n]=!0,()=>{Hd[n]=!1}):Hd.x||Hd.y?null:(Hd.x=Hd.y=!0,()=>{Hd.x=Hd.y=!1})}const nte=new Set(["width","height","top","left","right","bottom",...J0]);let Ek;function PPe(){Ek=void 0}const mp={now:()=>(Ek===void 0&&mp.set(Aa.isProcessing||TAe.useManualTiming?Aa.timestamp:performance.now()),Ek),set:n=>{Ek=n,queueMicrotask(PPe)}};function IF(n,e){n.indexOf(e)===-1&&n.push(e)}function AF(n,e){const i=n.indexOf(e);i>-1&&n.splice(i,1)}class PF{constructor(){this.subscriptions=[]}add(e){return IF(this.subscriptions,e),()=>AF(this.subscriptions,e)}notify(e,i,o){const l=this.subscriptions.length;if(l)if(l===1)this.subscriptions[0](e,i,o);else for(let u=0;u<l;u++){const f=this.subscriptions[u];f&&f(e,i,o)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}function rte(n,e){return e?n*(1e3/e):0}const jq=30,OPe=n=>!isNaN(parseFloat(n));class kPe{constructor(e,i={}){this.version="11.18.2",this.canTrackVelocity=null,this.events={},this.updateAndNotify=(o,l=!0)=>{const u=mp.now();this.updatedAt!==u&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(o),this.current!==this.prev&&this.events.change&&this.events.change.notify(this.current),l&&this.events.renderRequest&&this.events.renderRequest.notify(this.current)},this.hasAnimated=!1,this.setCurrent(e),this.owner=i.owner}setCurrent(e){this.current=e,this.updatedAt=mp.now(),this.canTrackVelocity===null&&e!==void 0&&(this.canTrackVelocity=OPe(this.current))}setPrevFrameValue(e=this.current){this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt}onChange(e){return this.on("change",e)}on(e,i){this.events[e]||(this.events[e]=new PF);const o=this.events[e].add(i);return e==="change"?()=>{o(),ss.read(()=>{this.events.change.getSize()||this.stop()})}:o}clearListeners(){for(const e in this.events)this.events[e].clear()}attach(e,i){this.passiveEffect=e,this.stopPassiveEffect=i}set(e,i=!0){!i||!this.passiveEffect?this.updateAndNotify(e,i):this.passiveEffect(e,this.updateAndNotify)}setWithVelocity(e,i,o){this.set(i),this.prev=void 0,this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt-o}jump(e,i=!0){this.updateAndNotify(e),this.prev=e,this.prevUpdatedAt=this.prevFrameValue=void 0,i&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}get(){return this.current}getPrevious(){return this.prev}getVelocity(){const e=mp.now();if(!this.canTrackVelocity||this.prevFrameValue===void 0||e-this.updatedAt>jq)return 0;const i=Math.min(this.updatedAt-this.prevUpdatedAt,jq);return rte(parseFloat(this.current)-parseFloat(this.prevFrameValue),i)}start(e){return this.stop(),new Promise(i=>{this.hasAnimated=!0,this.animation=e(i),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function UC(n,e){return new kPe(n,e)}function NPe(n,e,i){n.hasValue(e)?n.getValue(e).set(i):n.addValue(e,UC(i))}function DPe(n,e){const i=K1(n,e);let{transitionEnd:o={},transition:l={},...u}=i||{};u={...u,...o};for(const f in u){const _=HAe(u[f]);NPe(n,f,_)}}function xPe(n){return!!(ac(n)&&n.add)}function mV(n,e){const i=n.getValue("willChange");if(xPe(i))return i.add(e)}function ite(n){return n.props[xee]}const ste=(n,e,i)=>(((1-3*i+3*e)*n+(3*i-6*e))*n+3*e)*n,LPe=1e-7,MPe=12;function UPe(n,e,i,o,l){let u,f,_=0;do f=e+(i-e)/2,u=ste(f,o,l)-n,u>0?i=f:e=f;while(Math.abs(u)>LPe&&++_<MPe);return f}function pR(n,e,i,o){if(n===e&&i===o)return Ql;const l=u=>UPe(u,0,1,n,i);return u=>u===0||u===1?u:ste(l(u),e,o)}const ote=n=>e=>e<=.5?n(2*e)/2:(2-n(2*(1-e)))/2,ate=n=>e=>1-n(1-e),cte=pR(.33,1.53,.69,.99),OF=ate(cte),lte=ote(OF),ute=n=>(n*=2)<1?.5*OF(n):.5*(2-Math.pow(2,-10*(n-1))),kF=n=>1-Math.sin(Math.acos(n)),dte=ate(kF),hte=ote(kF),pte=n=>/^0[^.\s]+$/u.test(n);function VPe(n){return typeof n=="number"?n===0:n!==null?n==="none"||n==="0"||pte(n):!0}const mC=n=>Math.round(n*1e5)/1e5,NF=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu;function jPe(n){return n==null}const FPe=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu,DF=(n,e)=>i=>!!(typeof i=="string"&&FPe.test(i)&&i.startsWith(n)||e&&!jPe(i)&&Object.prototype.hasOwnProperty.call(i,e)),fte=(n,e,i)=>o=>{if(typeof o!="string")return o;const[l,u,f,_]=o.match(NF);return{[n]:parseFloat(l),[e]:parseFloat(u),[i]:parseFloat(f),alpha:_!==void 0?parseFloat(_):1}},BPe=n=>Qf(0,255,n),ZM={...Q0,transform:n=>Math.round(BPe(n))},Dy={test:DF("rgb","red"),parse:fte("red","green","blue"),transform:({red:n,green:e,blue:i,alpha:o=1})=>"rgba("+ZM.transform(n)+", "+ZM.transform(e)+", "+ZM.transform(i)+", "+mC(MC.transform(o))+")"};function WPe(n){let e="",i="",o="",l="";return n.length>5?(e=n.substring(1,3),i=n.substring(3,5),o=n.substring(5,7),l=n.substring(7,9)):(e=n.substring(1,2),i=n.substring(2,3),o=n.substring(3,4),l=n.substring(4,5),e+=e,i+=i,o+=o,l+=l),{red:parseInt(e,16),green:parseInt(i,16),blue:parseInt(o,16),alpha:l?parseInt(l,16)/255:1}}const gV={test:DF("#"),parse:WPe,transform:Dy.transform},QS={test:DF("hsl","hue"),parse:fte("hue","saturation","lightness"),transform:({hue:n,saturation:e,lightness:i,alpha:o=1})=>"hsla("+Math.round(n)+", "+fp.transform(mC(e))+", "+fp.transform(mC(i))+", "+mC(MC.transform(o))+")"},ic={test:n=>Dy.test(n)||gV.test(n)||QS.test(n),parse:n=>Dy.test(n)?Dy.parse(n):QS.test(n)?QS.parse(n):gV.parse(n),transform:n=>typeof n=="string"?n:n.hasOwnProperty("red")?Dy.transform(n):QS.transform(n)},zPe=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu;function GPe(n){var e,i;return isNaN(n)&&typeof n=="string"&&(((e=n.match(NF))===null||e===void 0?void 0:e.length)||0)+(((i=n.match(zPe))===null||i===void 0?void 0:i.length)||0)>0}const mte="number",gte="color",HPe="var",$Pe="var(",Fq="${}",KPe=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function VC(n){const e=n.toString(),i=[],o={color:[],number:[],var:[]},l=[];let u=0;const _=e.replace(KPe,E=>(ic.test(E)?(o.color.push(u),l.push(gte),i.push(ic.parse(E))):E.startsWith($Pe)?(o.var.push(u),l.push(HPe),i.push(E)):(o.number.push(u),l.push(mte),i.push(parseFloat(E))),++u,Fq)).split(Fq);return{values:i,split:_,indexes:o,types:l}}function _te(n){return VC(n).values}function yte(n){const{split:e,types:i}=VC(n),o=e.length;return l=>{let u="";for(let f=0;f<o;f++)if(u+=e[f],l[f]!==void 0){const _=i[f];_===mte?u+=mC(l[f]):_===gte?u+=ic.transform(l[f]):u+=l[f]}return u}}const qPe=n=>typeof n=="number"?0:n;function YPe(n){const e=_te(n);return yte(n)(e.map(qPe))}const Fg={test:GPe,parse:_te,createTransformer:yte,getAnimatableNone:YPe},XPe=new Set(["brightness","contrast","saturate","opacity"]);function JPe(n){const[e,i]=n.slice(0,-1).split("(");if(e==="drop-shadow")return n;const[o]=i.match(NF)||[];if(!o)return n;const l=i.replace(o,"");let u=XPe.has(e)?1:0;return o!==i&&(u*=100),e+"("+u+l+")"}const QPe=/\b([a-z-]*)\(.*?\)/gu,_V={...Fg,getAnimatableNone:n=>{const e=n.match(QPe);return e?e.map(JPe).join(" "):n}},ZPe={..._F,color:ic,backgroundColor:ic,outlineColor:ic,fill:ic,stroke:ic,borderColor:ic,borderTopColor:ic,borderRightColor:ic,borderBottomColor:ic,borderLeftColor:ic,filter:_V,WebkitFilter:_V},xF=n=>ZPe[n];function Ete(n,e){let i=xF(n);return i!==_V&&(i=Fg),i.getAnimatableNone?i.getAnimatableNone(e):void 0}const eOe=new Set(["auto","none","0"]);function tOe(n,e,i){let o=0,l;for(;o<n.length&&!l;){const u=n[o];typeof u=="string"&&!eOe.has(u)&&VC(u).values.length&&(l=n[o]),o++}if(l&&i)for(const u of e)n[u]=Ete(i,l)}const Bq=n=>n===Q0||n===zn,Wq=(n,e)=>parseFloat(n.split(", ")[e]),zq=(n,e)=>(i,{transform:o})=>{if(o==="none"||!o)return 0;const l=o.match(/^matrix3d\((.+)\)$/u);if(l)return Wq(l[1],e);{const u=o.match(/^matrix\((.+)\)$/u);return u?Wq(u[1],n):0}},nOe=new Set(["x","y","z"]),rOe=J0.filter(n=>!nOe.has(n));function iOe(n){const e=[];return rOe.forEach(i=>{const o=n.getValue(i);o!==void 0&&(e.push([i,o.get()]),o.set(i.startsWith("scale")?1:0))}),e}const P0={width:({x:n},{paddingLeft:e="0",paddingRight:i="0"})=>n.max-n.min-parseFloat(e)-parseFloat(i),height:({y:n},{paddingTop:e="0",paddingBottom:i="0"})=>n.max-n.min-parseFloat(e)-parseFloat(i),top:(n,{top:e})=>parseFloat(e),left:(n,{left:e})=>parseFloat(e),bottom:({y:n},{top:e})=>parseFloat(e)+(n.max-n.min),right:({x:n},{left:e})=>parseFloat(e)+(n.max-n.min),x:zq(4,13),y:zq(5,14)};P0.translateX=P0.x;P0.translateY=P0.y;const By=new Set;let yV=!1,EV=!1;function vte(){if(EV){const n=Array.from(By).filter(o=>o.needsMeasurement),e=new Set(n.map(o=>o.element)),i=new Map;e.forEach(o=>{const l=iOe(o);l.length&&(i.set(o,l),o.render())}),n.forEach(o=>o.measureInitialState()),e.forEach(o=>{o.render();const l=i.get(o);l&&l.forEach(([u,f])=>{var _;(_=o.getValue(u))===null||_===void 0||_.set(f)})}),n.forEach(o=>o.measureEndState()),n.forEach(o=>{o.suspendedScrollY!==void 0&&window.scrollTo(0,o.suspendedScrollY)})}EV=!1,yV=!1,By.forEach(n=>n.complete()),By.clear()}function Ste(){By.forEach(n=>{n.readKeyframes(),n.needsMeasurement&&(EV=!0)})}function sOe(){Ste(),vte()}class LF{constructor(e,i,o,l,u,f=!1){this.isComplete=!1,this.isAsync=!1,this.needsMeasurement=!1,this.isScheduled=!1,this.unresolvedKeyframes=[...e],this.onComplete=i,this.name=o,this.motionValue=l,this.element=u,this.isAsync=f}scheduleResolve(){this.isScheduled=!0,this.isAsync?(By.add(this),yV||(yV=!0,ss.read(Ste),ss.resolveKeyframes(vte))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:e,name:i,element:o,motionValue:l}=this;for(let u=0;u<e.length;u++)if(e[u]===null)if(u===0){const f=l==null?void 0:l.get(),_=e[e.length-1];if(f!==void 0)e[0]=f;else if(o&&i){const E=o.readValue(i,_);E!=null&&(e[0]=E)}e[0]===void 0&&(e[0]=_),l&&f===void 0&&l.set(e[0])}else e[u]=e[u-1]}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(){this.isComplete=!0,this.onComplete(this.unresolvedKeyframes,this.finalKeyframe),By.delete(this)}cancel(){this.isComplete||(this.isScheduled=!1,By.delete(this))}resume(){this.isComplete||this.scheduleResolve()}}const bte=n=>/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(n),oOe=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u;function aOe(n){const e=oOe.exec(n);if(!e)return[,];const[,i,o,l]=e;return[`--${i??o}`,l]}function wte(n,e,i=1){const[o,l]=aOe(n);if(!o)return;const u=window.getComputedStyle(e).getPropertyValue(o);if(u){const f=u.trim();return bte(f)?parseFloat(f):f}return gF(l)?wte(l,e,i+1):l}const Tte=n=>e=>e.test(n),cOe={test:n=>n==="auto",parse:n=>n},Cte=[Q0,zn,fp,bg,JAe,XAe,cOe],Gq=n=>Cte.find(Tte(n));class Rte extends LF{constructor(e,i,o,l,u){super(e,i,o,l,u,!0)}readKeyframes(){const{unresolvedKeyframes:e,element:i,name:o}=this;if(!i||!i.current)return;super.readKeyframes();for(let E=0;E<e.length;E++){let b=e[E];if(typeof b=="string"&&(b=b.trim(),gF(b))){const C=wte(b,i.current);C!==void 0&&(e[E]=C),E===e.length-1&&(this.finalKeyframe=b)}}if(this.resolveNoneKeyframes(),!nte.has(o)||e.length!==2)return;const[l,u]=e,f=Gq(l),_=Gq(u);if(f!==_)if(Bq(f)&&Bq(_))for(let E=0;E<e.length;E++){const b=e[E];typeof b=="string"&&(e[E]=parseFloat(b))}else this.needsMeasurement=!0}resolveNoneKeyframes(){const{unresolvedKeyframes:e,name:i}=this,o=[];for(let l=0;l<e.length;l++)VPe(e[l])&&o.push(l);o.length&&tOe(e,o,i)}measureInitialState(){const{element:e,unresolvedKeyframes:i,name:o}=this;if(!e||!e.current)return;o==="height"&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=P0[o](e.measureViewportBox(),window.getComputedStyle(e.current)),i[0]=this.measuredOrigin;const l=i[i.length-1];l!==void 0&&e.getValue(o,l).jump(l,!1)}measureEndState(){var e;const{element:i,name:o,unresolvedKeyframes:l}=this;if(!i||!i.current)return;const u=i.getValue(o);u&&u.jump(this.measuredOrigin,!1);const f=l.length-1,_=l[f];l[f]=P0[o](i.measureViewportBox(),window.getComputedStyle(i.current)),_!==null&&this.finalKeyframe===void 0&&(this.finalKeyframe=_),!((e=this.removedTransforms)===null||e===void 0)&&e.length&&this.removedTransforms.forEach(([E,b])=>{i.getValue(E).set(b)}),this.resolveNoneKeyframes()}}const Hq=(n,e)=>e==="zIndex"?!1:!!(typeof n=="number"||Array.isArray(n)||typeof n=="string"&&(Fg.test(n)||n==="0")&&!n.startsWith("url("));function lOe(n){const e=n[0];if(n.length===1)return!0;for(let i=0;i<n.length;i++)if(n[i]!==e)return!0}function uOe(n,e,i,o){const l=n[0];if(l===null)return!1;if(e==="display"||e==="visibility")return!0;const u=n[n.length-1],f=Hq(l,e),_=Hq(u,e);return!f||!_?!1:lOe(n)||(i==="spring"||TF(i))&&o}const dOe=n=>n!==null;function q1(n,{repeat:e,repeatType:i="loop"},o){const l=n.filter(dOe),u=e&&i!=="loop"&&e%2===1?0:l.length-1;return!u||o===void 0?l[u]:o}const hOe=40;class Ite{constructor({autoplay:e=!0,delay:i=0,type:o="keyframes",repeat:l=0,repeatDelay:u=0,repeatType:f="loop",..._}){this.isStopped=!1,this.hasAttemptedResolve=!1,this.createdAt=mp.now(),this.options={autoplay:e,delay:i,type:o,repeat:l,repeatDelay:u,repeatType:f,..._},this.updateFinishedPromise()}calcStartTime(){return this.resolvedAt?this.resolvedAt-this.createdAt>hOe?this.resolvedAt:this.createdAt:this.createdAt}get resolved(){return!this._resolved&&!this.hasAttemptedResolve&&sOe(),this._resolved}onKeyframesResolved(e,i){this.resolvedAt=mp.now(),this.hasAttemptedResolve=!0;const{name:o,type:l,velocity:u,delay:f,onComplete:_,onUpdate:E,isGenerator:b}=this.options;if(!b&&!uOe(e,o,l,u))if(f)this.options.duration=0;else{E&&E(q1(e,this.options,i)),_&&_(),this.resolveFinishedPromise();return}const C=this.initPlayback(e,i);C!==!1&&(this._resolved={keyframes:e,finalKeyframe:i,...C},this.onPostResolved())}onPostResolved(){}then(e,i){return this.currentFinishedPromise.then(e,i)}flatten(){this.options.type="keyframes",this.options.ease="linear"}updateFinishedPromise(){this.currentFinishedPromise=new Promise(e=>{this.resolveFinishedPromise=e})}}const Ss=(n,e,i)=>n+(e-n)*i;function eU(n,e,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?n+(e-n)*6*i:i<1/2?e:i<2/3?n+(e-n)*(2/3-i)*6:n}function pOe({hue:n,saturation:e,lightness:i,alpha:o}){n/=360,e/=100,i/=100;let l=0,u=0,f=0;if(!e)l=u=f=i;else{const _=i<.5?i*(1+e):i+e-i*e,E=2*i-_;l=eU(E,_,n+1/3),u=eU(E,_,n),f=eU(E,_,n-1/3)}return{red:Math.round(l*255),green:Math.round(u*255),blue:Math.round(f*255),alpha:o}}function qk(n,e){return i=>i>0?e:n}const tU=(n,e,i)=>{const o=n*n,l=i*(e*e-o)+o;return l<0?0:Math.sqrt(l)},fOe=[gV,Dy,QS],mOe=n=>fOe.find(e=>e.test(n));function $q(n){const e=mOe(n);if(!e)return!1;let i=e.parse(n);return e===QS&&(i=pOe(i)),i}const Kq=(n,e)=>{const i=$q(n),o=$q(e);if(!i||!o)return qk(n,e);const l={...i};return u=>(l.red=tU(i.red,o.red,u),l.green=tU(i.green,o.green,u),l.blue=tU(i.blue,o.blue,u),l.alpha=Ss(i.alpha,o.alpha,u),Dy.transform(l))},gOe=(n,e)=>i=>e(n(i)),fR=(...n)=>n.reduce(gOe),vV=new Set(["none","hidden"]);function _Oe(n,e){return vV.has(n)?i=>i<=0?n:e:i=>i>=1?e:n}function yOe(n,e){return i=>Ss(n,e,i)}function MF(n){return typeof n=="number"?yOe:typeof n=="string"?gF(n)?qk:ic.test(n)?Kq:SOe:Array.isArray(n)?Ate:typeof n=="object"?ic.test(n)?Kq:EOe:qk}function Ate(n,e){const i=[...n],o=i.length,l=n.map((u,f)=>MF(u)(u,e[f]));return u=>{for(let f=0;f<o;f++)i[f]=l[f](u);return i}}function EOe(n,e){const i={...n,...e},o={};for(const l in i)n[l]!==void 0&&e[l]!==void 0&&(o[l]=MF(n[l])(n[l],e[l]));return l=>{for(const u in o)i[u]=o[u](l);return i}}function vOe(n,e){var i;const o=[],l={color:0,var:0,number:0};for(let u=0;u<e.values.length;u++){const f=e.types[u],_=n.indexes[f][l[f]],E=(i=n.values[_])!==null&&i!==void 0?i:0;o[u]=E,l[f]++}return o}const SOe=(n,e)=>{const i=Fg.createTransformer(e),o=VC(n),l=VC(e);return o.indexes.var.length===l.indexes.var.length&&o.indexes.color.length===l.indexes.color.length&&o.indexes.number.length>=l.indexes.number.length?vV.has(n)&&!l.values.length||vV.has(e)&&!o.values.length?_Oe(n,e):fR(Ate(vOe(o,l),l.values),i):qk(n,e)};function Pte(n,e,i){return typeof n=="number"&&typeof e=="number"&&typeof i=="number"?Ss(n,e,i):MF(n)(n,e)}const bOe=5;function Ote(n,e,i){const o=Math.max(e-bOe,0);return rte(i-n(o),e-o)}const Fs={stiffness:100,damping:10,mass:1,velocity:0,duration:800,bounce:.3,visualDuration:.3,restSpeed:{granular:.01,default:2},restDelta:{granular:.005,default:.5},minDuration:.01,maxDuration:10,minDamping:.05,maxDamping:1},qq=.001;function wOe({duration:n=Fs.duration,bounce:e=Fs.bounce,velocity:i=Fs.velocity,mass:o=Fs.mass}){let l,u,f=1-e;f=Qf(Fs.minDamping,Fs.maxDamping,f),n=Qf(Fs.minDuration,Fs.maxDuration,$f(n)),f<1?(l=b=>{const C=b*f,I=C*n,P=C-i,L=SV(b,f),M=Math.exp(-I);return qq-P/L*M},u=b=>{const I=b*f*n,P=I*i+i,L=Math.pow(f,2)*Math.pow(b,2)*n,M=Math.exp(-I),F=SV(Math.pow(b,2),f);return(-l(b)+qq>0?-1:1)*((P-L)*M)/F}):(l=b=>{const C=Math.exp(-b*n),I=(b-i)*n+1;return-.001+C*I},u=b=>{const C=Math.exp(-b*n),I=(i-b)*(n*n);return C*I});const _=5/n,E=COe(l,u,_);if(n=Hf(n),isNaN(E))return{stiffness:Fs.stiffness,damping:Fs.damping,duration:n};{const b=Math.pow(E,2)*o;return{stiffness:b,damping:f*2*Math.sqrt(o*b),duration:n}}}const TOe=12;function COe(n,e,i){let o=i;for(let l=1;l<TOe;l++)o=o-n(o)/e(o);return o}function SV(n,e){return n*Math.sqrt(1-e*e)}const ROe=["duration","bounce"],IOe=["stiffness","damping","mass"];function Yq(n,e){return e.some(i=>n[i]!==void 0)}function AOe(n){let e={velocity:Fs.velocity,stiffness:Fs.stiffness,damping:Fs.damping,mass:Fs.mass,isResolvedFromDuration:!1,...n};if(!Yq(n,IOe)&&Yq(n,ROe))if(n.visualDuration){const i=n.visualDuration,o=2*Math.PI/(i*1.2),l=o*o,u=2*Qf(.05,1,1-(n.bounce||0))*Math.sqrt(l);e={...e,mass:Fs.mass,stiffness:l,damping:u}}else{const i=wOe(n);e={...e,...i,mass:Fs.mass},e.isResolvedFromDuration=!0}return e}function kte(n=Fs.visualDuration,e=Fs.bounce){const i=typeof n!="object"?{visualDuration:n,keyframes:[0,1],bounce:e}:n;let{restSpeed:o,restDelta:l}=i;const u=i.keyframes[0],f=i.keyframes[i.keyframes.length-1],_={done:!1,value:u},{stiffness:E,damping:b,mass:C,duration:I,velocity:P,isResolvedFromDuration:L}=AOe({...i,velocity:-$f(i.velocity||0)}),M=P||0,F=b/(2*Math.sqrt(E*C)),B=f-u,Z=$f(Math.sqrt(E/C)),K=Math.abs(B)<5;o||(o=K?Fs.restSpeed.granular:Fs.restSpeed.default),l||(l=K?Fs.restDelta.granular:Fs.restDelta.default);let re;if(F<1){const ne=SV(Z,F);re=pe=>{const X=Math.exp(-F*Z*pe);return f-X*((M+F*Z*B)/ne*Math.sin(ne*pe)+B*Math.cos(ne*pe))}}else if(F===1)re=ne=>f-Math.exp(-Z*ne)*(B+(M+Z*B)*ne);else{const ne=Z*Math.sqrt(F*F-1);re=pe=>{const X=Math.exp(-F*Z*pe),J=Math.min(ne*pe,300);return f-X*((M+F*Z*B)*Math.sinh(J)+ne*B*Math.cosh(J))/ne}}const ae={calculatedDuration:L&&I||null,next:ne=>{const pe=re(ne);if(L)_.done=ne>=I;else{let X=0;F<1&&(X=ne===0?Hf(M):Ote(re,ne,pe));const J=Math.abs(X)<=o,Y=Math.abs(f-pe)<=l;_.done=J&&Y}return _.value=_.done?f:pe,_},toString:()=>{const ne=Math.min(Yee(ae),pV),pe=Xee(X=>ae.next(ne*X).value,ne,30);return ne+"ms "+pe}};return ae}function Xq({keyframes:n,velocity:e=0,power:i=.8,timeConstant:o=325,bounceDamping:l=10,bounceStiffness:u=500,modifyTarget:f,min:_,max:E,restDelta:b=.5,restSpeed:C}){const I=n[0],P={done:!1,value:I},L=J=>_!==void 0&&J<_||E!==void 0&&J>E,M=J=>_===void 0?E:E===void 0||Math.abs(_-J)<Math.abs(E-J)?_:E;let F=i*e;const B=I+F,Z=f===void 0?B:f(B);Z!==B&&(F=Z-I);const K=J=>-F*Math.exp(-J/o),re=J=>Z+K(J),ae=J=>{const Y=K(J),ie=re(J);P.done=Math.abs(Y)<=b,P.value=P.done?Z:ie};let ne,pe;const X=J=>{L(P.value)&&(ne=J,pe=kte({keyframes:[P.value,M(P.value)],velocity:Ote(re,J,P.value),damping:l,stiffness:u,restDelta:b,restSpeed:C}))};return X(0),{calculatedDuration:null,next:J=>{let Y=!1;return!pe&&ne===void 0&&(Y=!0,ae(J),X(J)),ne!==void 0&&J>=ne?pe.next(J-ne):(!Y&&ae(J),P)}}}const POe=pR(.42,0,1,1),OOe=pR(0,0,.58,1),Nte=pR(.42,0,.58,1),kOe=n=>Array.isArray(n)&&typeof n[0]!="number",NOe={linear:Ql,easeIn:POe,easeInOut:Nte,easeOut:OOe,circIn:kF,circInOut:hte,circOut:dte,backIn:OF,backInOut:lte,backOut:cte,anticipate:ute},Jq=n=>{if(CF(n)){Pee(n.length===4);const[e,i,o,l]=n;return pR(e,i,o,l)}else if(typeof n=="string")return NOe[n];return n};function DOe(n,e,i){const o=[],l=i||Pte,u=n.length-1;for(let f=0;f<u;f++){let _=l(n[f],n[f+1]);if(e){const E=Array.isArray(e)?e[f]||Ql:e;_=fR(E,_)}o.push(_)}return o}function xOe(n,e,{clamp:i=!0,ease:o,mixer:l}={}){const u=n.length;if(Pee(u===e.length),u===1)return()=>e[0];if(u===2&&e[0]===e[1])return()=>e[1];const f=n[0]===n[1];n[0]>n[u-1]&&(n=[...n].reverse(),e=[...e].reverse());const _=DOe(e,o,l),E=_.length,b=C=>{if(f&&C<n[0])return e[0];let I=0;if(E>1)for(;I<n.length-2&&!(C<n[I+1]);I++);const P=I0(n[I],n[I+1],C);return _[I](P)};return i?C=>b(Qf(n[0],n[u-1],C)):b}function LOe(n,e){const i=n[n.length-1];for(let o=1;o<=e;o++){const l=I0(0,e,o);n.push(Ss(i,1,l))}}function MOe(n){const e=[0];return LOe(e,n.length-1),e}function UOe(n,e){return n.map(i=>i*e)}function VOe(n,e){return n.map(()=>e||Nte).splice(0,n.length-1)}function Yk({duration:n=300,keyframes:e,times:i,ease:o="easeInOut"}){const l=kOe(o)?o.map(Jq):Jq(o),u={done:!1,value:e[0]},f=UOe(i&&i.length===e.length?i:MOe(e),n),_=xOe(f,e,{ease:Array.isArray(l)?l:VOe(e,l)});return{calculatedDuration:n,next:E=>(u.value=_(E),u.done=E>=n,u)}}const jOe=n=>{const e=({timestamp:i})=>n(i);return{start:()=>ss.update(e,!0),stop:()=>jg(e),now:()=>Aa.isProcessing?Aa.timestamp:mp.now()}},FOe={decay:Xq,inertia:Xq,tween:Yk,keyframes:Yk,spring:kte},BOe=n=>n/100;class UF extends Ite{constructor(e){super(e),this.holdTime=null,this.cancelTime=null,this.currentTime=0,this.playbackSpeed=1,this.pendingPlayState="running",this.startTime=null,this.state="idle",this.stop=()=>{if(this.resolver.cancel(),this.isStopped=!0,this.state==="idle")return;this.teardown();const{onStop:E}=this.options;E&&E()};const{name:i,motionValue:o,element:l,keyframes:u}=this.options,f=(l==null?void 0:l.KeyframeResolver)||LF,_=(E,b)=>this.onKeyframesResolved(E,b);this.resolver=new f(u,_,i,o,l),this.resolver.scheduleResolve()}flatten(){super.flatten(),this._resolved&&Object.assign(this._resolved,this.initPlayback(this._resolved.keyframes))}initPlayback(e){const{type:i="keyframes",repeat:o=0,repeatDelay:l=0,repeatType:u,velocity:f=0}=this.options,_=TF(i)?i:FOe[i]||Yk;let E,b;_!==Yk&&typeof e[0]!="number"&&(E=fR(BOe,Pte(e[0],e[1])),e=[0,100]);const C=_({...this.options,keyframes:e});u==="mirror"&&(b=_({...this.options,keyframes:[...e].reverse(),velocity:-f})),C.calculatedDuration===null&&(C.calculatedDuration=Yee(C));const{calculatedDuration:I}=C,P=I+l,L=P*(o+1)-l;return{generator:C,mirroredGenerator:b,mapPercentToKeyframes:E,calculatedDuration:I,resolvedDuration:P,totalDuration:L}}onPostResolved(){const{autoplay:e=!0}=this.options;this.play(),this.pendingPlayState==="paused"||!e?this.pause():this.state=this.pendingPlayState}tick(e,i=!1){const{resolved:o}=this;if(!o){const{keyframes:J}=this.options;return{done:!0,value:J[J.length-1]}}const{finalKeyframe:l,generator:u,mirroredGenerator:f,mapPercentToKeyframes:_,keyframes:E,calculatedDuration:b,totalDuration:C,resolvedDuration:I}=o;if(this.startTime===null)return u.next(0);const{delay:P,repeat:L,repeatType:M,repeatDelay:F,onUpdate:B}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,e):this.speed<0&&(this.startTime=Math.min(e-C/this.speed,this.startTime)),i?this.currentTime=e:this.holdTime!==null?this.currentTime=this.holdTime:this.currentTime=Math.round(e-this.startTime)*this.speed;const Z=this.currentTime-P*(this.speed>=0?1:-1),K=this.speed>=0?Z<0:Z>C;this.currentTime=Math.max(Z,0),this.state==="finished"&&this.holdTime===null&&(this.currentTime=C);let re=this.currentTime,ae=u;if(L){const J=Math.min(this.currentTime,C)/I;let Y=Math.floor(J),ie=J%1;!ie&&J>=1&&(ie=1),ie===1&&Y--,Y=Math.min(Y,L+1),!!(Y%2)&&(M==="reverse"?(ie=1-ie,F&&(ie-=F/I)):M==="mirror"&&(ae=f)),re=Qf(0,1,ie)*I}const ne=K?{done:!1,value:E[0]}:ae.next(re);_&&(ne.value=_(ne.value));let{done:pe}=ne;!K&&b!==null&&(pe=this.speed>=0?this.currentTime>=C:this.currentTime<=0);const X=this.holdTime===null&&(this.state==="finished"||this.state==="running"&&pe);return X&&l!==void 0&&(ne.value=q1(E,this.options,l)),B&&B(ne.value),X&&this.finish(),ne}get duration(){const{resolved:e}=this;return e?$f(e.calculatedDuration):0}get time(){return $f(this.currentTime)}set time(e){e=Hf(e),this.currentTime=e,this.holdTime!==null||this.speed===0?this.holdTime=e:this.driver&&(this.startTime=this.driver.now()-e/this.speed)}get speed(){return this.playbackSpeed}set speed(e){const i=this.playbackSpeed!==e;this.playbackSpeed=e,i&&(this.time=$f(this.currentTime))}play(){if(this.resolver.isScheduled||this.resolver.resume(),!this._resolved){this.pendingPlayState="running";return}if(this.isStopped)return;const{driver:e=jOe,onPlay:i,startTime:o}=this.options;this.driver||(this.driver=e(u=>this.tick(u))),i&&i();const l=this.driver.now();this.holdTime!==null?this.startTime=l-this.holdTime:this.startTime?this.state==="finished"&&(this.startTime=l):this.startTime=o??this.calcStartTime(),this.state==="finished"&&this.updateFinishedPromise(),this.cancelTime=this.startTime,this.holdTime=null,this.state="running",this.driver.start()}pause(){var e;if(!this._resolved){this.pendingPlayState="paused";return}this.state="paused",this.holdTime=(e=this.currentTime)!==null&&e!==void 0?e:0}complete(){this.state!=="running"&&this.play(),this.pendingPlayState=this.state="finished",this.holdTime=null}finish(){this.teardown(),this.state="finished";const{onComplete:e}=this.options;e&&e()}cancel(){this.cancelTime!==null&&this.tick(this.cancelTime),this.teardown(),this.updateFinishedPromise()}teardown(){this.state="idle",this.stopDriver(),this.resolveFinishedPromise(),this.updateFinishedPromise(),this.startTime=this.cancelTime=null,this.resolver.cancel()}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(e){return this.startTime=0,this.tick(e,!0)}}const WOe=new Set(["opacity","clipPath","filter","transform"]);function zOe(n,e,i,{delay:o=0,duration:l=300,repeat:u=0,repeatType:f="loop",ease:_="easeInOut",times:E}={}){const b={[e]:i};E&&(b.offset=E);const C=Qee(_,l);return Array.isArray(C)&&(b.easing=C),n.animate(b,{delay:o,duration:l,easing:Array.isArray(C)?"linear":C,fill:"both",iterations:u+1,direction:f==="reverse"?"alternate":"normal"})}const GOe=lF(()=>Object.hasOwnProperty.call(Element.prototype,"animate")),Xk=10,HOe=2e4;function $Oe(n){return TF(n.type)||n.type==="spring"||!Jee(n.ease)}function KOe(n,e){const i=new UF({...e,keyframes:n,repeat:0,delay:0,isGenerator:!0});let o={done:!1,value:n[0]};const l=[];let u=0;for(;!o.done&&u<HOe;)o=i.sample(u),l.push(o.value),u+=Xk;return{times:void 0,keyframes:l,duration:u-Xk,ease:"linear"}}const Dte={anticipate:ute,backInOut:lte,circInOut:hte};function qOe(n){return n in Dte}class Qq extends Ite{constructor(e){super(e);const{name:i,motionValue:o,element:l,keyframes:u}=this.options;this.resolver=new Rte(u,(f,_)=>this.onKeyframesResolved(f,_),i,o,l),this.resolver.scheduleResolve()}initPlayback(e,i){let{duration:o=300,times:l,ease:u,type:f,motionValue:_,name:E,startTime:b}=this.options;if(!_.owner||!_.owner.current)return!1;if(typeof u=="string"&&Kk()&&qOe(u)&&(u=Dte[u]),$Oe(this.options)){const{onComplete:I,onUpdate:P,motionValue:L,element:M,...F}=this.options,B=KOe(e,F);e=B.keyframes,e.length===1&&(e[1]=e[0]),o=B.duration,l=B.times,u=B.ease,f="keyframes"}const C=zOe(_.owner.current,E,e,{...this.options,duration:o,times:l,ease:u});return C.startTime=b??this.calcStartTime(),this.pendingTimeline?(Lq(C,this.pendingTimeline),this.pendingTimeline=void 0):C.onfinish=()=>{const{onComplete:I}=this.options;_.set(q1(e,this.options,i)),I&&I(),this.cancel(),this.resolveFinishedPromise()},{animation:C,duration:o,times:l,type:f,ease:u,keyframes:e}}get duration(){const{resolved:e}=this;if(!e)return 0;const{duration:i}=e;return $f(i)}get time(){const{resolved:e}=this;if(!e)return 0;const{animation:i}=e;return $f(i.currentTime||0)}set time(e){const{resolved:i}=this;if(!i)return;const{animation:o}=i;o.currentTime=Hf(e)}get speed(){const{resolved:e}=this;if(!e)return 1;const{animation:i}=e;return i.playbackRate}set speed(e){const{resolved:i}=this;if(!i)return;const{animation:o}=i;o.playbackRate=e}get state(){const{resolved:e}=this;if(!e)return"idle";const{animation:i}=e;return i.playState}get startTime(){const{resolved:e}=this;if(!e)return null;const{animation:i}=e;return i.startTime}attachTimeline(e){if(!this._resolved)this.pendingTimeline=e;else{const{resolved:i}=this;if(!i)return Ql;const{animation:o}=i;Lq(o,e)}return Ql}play(){if(this.isStopped)return;const{resolved:e}=this;if(!e)return;const{animation:i}=e;i.playState==="finished"&&this.updateFinishedPromise(),i.play()}pause(){const{resolved:e}=this;if(!e)return;const{animation:i}=e;i.pause()}stop(){if(this.resolver.cancel(),this.isStopped=!0,this.state==="idle")return;this.resolveFinishedPromise(),this.updateFinishedPromise();const{resolved:e}=this;if(!e)return;const{animation:i,keyframes:o,duration:l,type:u,ease:f,times:_}=e;if(i.playState==="idle"||i.playState==="finished")return;if(this.time){const{motionValue:b,onUpdate:C,onComplete:I,element:P,...L}=this.options,M=new UF({...L,keyframes:o,duration:l,type:u,ease:f,times:_,isGenerator:!0}),F=Hf(this.time);b.setWithVelocity(M.sample(F-Xk).value,M.sample(F).value,Xk)}const{onStop:E}=this.options;E&&E(),this.cancel()}complete(){const{resolved:e}=this;e&&e.animation.finish()}cancel(){const{resolved:e}=this;e&&e.animation.cancel()}static supports(e){const{motionValue:i,name:o,repeatDelay:l,repeatType:u,damping:f,type:_}=e;if(!i||!i.owner||!(i.owner.current instanceof HTMLElement))return!1;const{onUpdate:E,transformTemplate:b}=i.owner.getProps();return GOe()&&o&&WOe.has(o)&&!E&&!b&&!l&&u!=="mirror"&&f!==0&&_!=="inertia"}}const YOe={type:"spring",stiffness:500,damping:25,restSpeed:10},XOe=n=>({type:"spring",stiffness:550,damping:n===0?2*Math.sqrt(550):30,restSpeed:10}),JOe={type:"keyframes",duration:.8},QOe={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},ZOe=(n,{keyframes:e})=>e.length>2?JOe:lE.has(n)?n.startsWith("scale")?XOe(e[1]):YOe:QOe;function eke({when:n,delay:e,delayChildren:i,staggerChildren:o,staggerDirection:l,repeat:u,repeatType:f,repeatDelay:_,from:E,elapsed:b,...C}){return!!Object.keys(C).length}const VF=(n,e,i,o={},l,u)=>f=>{const _=wF(o,n)||{},E=_.delay||o.delay||0;let{elapsed:b=0}=o;b=b-Hf(E);let C={keyframes:Array.isArray(i)?i:[null,i],ease:"easeOut",velocity:e.getVelocity(),..._,delay:-b,onUpdate:P=>{e.set(P),_.onUpdate&&_.onUpdate(P)},onComplete:()=>{f(),_.onComplete&&_.onComplete()},name:n,motionValue:e,element:u?void 0:l};eke(_)||(C={...C,...ZOe(n,C)}),C.duration&&(C.duration=Hf(C.duration)),C.repeatDelay&&(C.repeatDelay=Hf(C.repeatDelay)),C.from!==void 0&&(C.keyframes[0]=C.from);let I=!1;if((C.type===!1||C.duration===0&&!C.repeatDelay)&&(C.duration=0,C.delay===0&&(I=!0)),I&&!u&&e.get()!==void 0){const P=q1(C.keyframes,_);if(P!==void 0)return ss.update(()=>{C.onUpdate(P),C.onComplete()}),new EPe([])}return!u&&Qq.supports(C)?new Qq(C):new UF(C)};function tke({protectedKeys:n,needsAnimating:e},i){const o=n.hasOwnProperty(i)&&e[i]!==!0;return e[i]=!1,o}function xte(n,e,{delay:i=0,transitionOverride:o,type:l}={}){var u;let{transition:f=n.getDefaultTransition(),transitionEnd:_,...E}=e;o&&(f=o);const b=[],C=l&&n.animationState&&n.animationState.getState()[l];for(const I in E){const P=n.getValue(I,(u=n.latestValues[I])!==null&&u!==void 0?u:null),L=E[I];if(L===void 0||C&&tke(C,I))continue;const M={delay:i,...wF(f||{},I)};let F=!1;if(window.MotionHandoffAnimation){const Z=ite(n);if(Z){const K=window.MotionHandoffAnimation(Z,I,ss);K!==null&&(M.startTime=K,F=!0)}}mV(n,I),P.start(VF(I,P,L,n.shouldReduceMotion&&nte.has(I)?{type:!1}:M,n,F));const B=P.animation;B&&b.push(B)}return _&&Promise.all(b).then(()=>{ss.update(()=>{_&&DPe(n,_)})}),b}function bV(n,e,i={}){var o;const l=K1(n,e,i.type==="exit"?(o=n.presenceContext)===null||o===void 0?void 0:o.custom:void 0);let{transition:u=n.getDefaultTransition()||{}}=l||{};i.transitionOverride&&(u=i.transitionOverride);const f=l?()=>Promise.all(xte(n,l,i)):()=>Promise.resolve(),_=n.variantChildren&&n.variantChildren.size?(b=0)=>{const{delayChildren:C=0,staggerChildren:I,staggerDirection:P}=u;return nke(n,e,C+b,I,P,i)}:()=>Promise.resolve(),{when:E}=u;if(E){const[b,C]=E==="beforeChildren"?[f,_]:[_,f];return b().then(()=>C())}else return Promise.all([f(),_(i.delay)])}function nke(n,e,i=0,o=0,l=1,u){const f=[],_=(n.variantChildren.size-1)*o,E=l===1?(b=0)=>b*o:(b=0)=>_-b*o;return Array.from(n.variantChildren).sort(rke).forEach((b,C)=>{b.notify("AnimationStart",e),f.push(bV(b,e,{...u,delay:i+E(C)}).then(()=>b.notify("AnimationComplete",e)))}),Promise.all(f)}function rke(n,e){return n.sortNodePosition(e)}function ike(n,e,i={}){n.notify("AnimationStart",e);let o;if(Array.isArray(e)){const l=e.map(u=>bV(n,u,i));o=Promise.all(l)}else if(typeof e=="string")o=bV(n,e,i);else{const l=typeof e=="function"?K1(n,e,i.custom):e;o=Promise.all(xte(n,l,i))}return o.then(()=>{n.notify("AnimationComplete",e)})}const ske=dF.length;function Lte(n){if(!n)return;if(!n.isControllingVariants){const i=n.parent?Lte(n.parent)||{}:{};return n.props.initial!==void 0&&(i.initial=n.props.initial),i}const e={};for(let i=0;i<ske;i++){const o=dF[i],l=n.props[o];(LC(l)||l===!1)&&(e[o]=l)}return e}const oke=[...uF].reverse(),ake=uF.length;function cke(n){return e=>Promise.all(e.map(({animation:i,options:o})=>ike(n,i,o)))}function lke(n){let e=cke(n),i=Zq(),o=!0;const l=E=>(b,C)=>{var I;const P=K1(n,C,E==="exit"?(I=n.presenceContext)===null||I===void 0?void 0:I.custom:void 0);if(P){const{transition:L,transitionEnd:M,...F}=P;b={...b,...F,...M}}return b};function u(E){e=E(n)}function f(E){const{props:b}=n,C=Lte(n.parent)||{},I=[],P=new Set;let L={},M=1/0;for(let B=0;B<ake;B++){const Z=oke[B],K=i[Z],re=b[Z]!==void 0?b[Z]:C[Z],ae=LC(re),ne=Z===E?K.isActive:null;ne===!1&&(M=B);let pe=re===C[Z]&&re!==b[Z]&&ae;if(pe&&o&&n.manuallyAnimateOnMount&&(pe=!1),K.protectedKeys={...L},!K.isActive&&ne===null||!re&&!K.prevProp||H1(re)||typeof re=="boolean")continue;const X=uke(K.prevProp,re);let J=X||Z===E&&K.isActive&&!pe&&ae||B>M&&ae,Y=!1;const ie=Array.isArray(re)?re:[re];let le=ie.reduce(l(Z),{});ne===!1&&(le={});const{prevResolvedValues:de={}}=K,ue={...de,...le},Oe=Re=>{J=!0,P.has(Re)&&(Y=!0,P.delete(Re)),K.needsAnimating[Re]=!0;const ve=n.getValue(Re);ve&&(ve.liveStyle=!1)};for(const Re in ue){const ve=le[Re],be=de[Re];if(L.hasOwnProperty(Re))continue;let We=!1;hV(ve)&&hV(be)?We=!qee(ve,be):We=ve!==be,We?ve!=null?Oe(Re):P.add(Re):ve!==void 0&&P.has(Re)?Oe(Re):K.protectedKeys[Re]=!0}K.prevProp=re,K.prevResolvedValues=le,K.isActive&&(L={...L,...le}),o&&n.blockInitialAnimation&&(J=!1),J&&(!(pe&&X)||Y)&&I.push(...ie.map(Re=>({animation:Re,options:{type:Z}})))}if(P.size){const B={};P.forEach(Z=>{const K=n.getBaseTarget(Z),re=n.getValue(Z);re&&(re.liveStyle=!0),B[Z]=K??null}),I.push({animation:B})}let F=!!I.length;return o&&(b.initial===!1||b.initial===b.animate)&&!n.manuallyAnimateOnMount&&(F=!1),o=!1,F?e(I):Promise.resolve()}function _(E,b){var C;if(i[E].isActive===b)return Promise.resolve();(C=n.variantChildren)===null||C===void 0||C.forEach(P=>{var L;return(L=P.animationState)===null||L===void 0?void 0:L.setActive(E,b)}),i[E].isActive=b;const I=f(E);for(const P in i)i[P].protectedKeys={};return I}return{animateChanges:f,setActive:_,setAnimateFunction:u,getState:()=>i,reset:()=>{i=Zq(),o=!0}}}function uke(n,e){return typeof e=="string"?e!==n:Array.isArray(e)?!qee(e,n):!1}function wy(n=!1){return{isActive:n,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function Zq(){return{animate:wy(!0),whileInView:wy(),whileHover:wy(),whileTap:wy(),whileDrag:wy(),whileFocus:wy(),exit:wy()}}class Xg{constructor(e){this.isMounted=!1,this.node=e}update(){}}class dke extends Xg{constructor(e){super(e),e.animationState||(e.animationState=lke(e))}updateAnimationControlsSubscription(){const{animate:e}=this.node.getProps();H1(e)&&(this.unmountControls=e.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:e}=this.node.getProps(),{animate:i}=this.node.prevProps||{};e!==i&&this.updateAnimationControlsSubscription()}unmount(){var e;this.node.animationState.reset(),(e=this.unmountControls)===null||e===void 0||e.call(this)}}let hke=0;class pke extends Xg{constructor(){super(...arguments),this.id=hke++}update(){if(!this.node.presenceContext)return;const{isPresent:e,onExitComplete:i}=this.node.presenceContext,{isPresent:o}=this.node.prevPresenceContext||{};if(!this.node.animationState||e===o)return;const l=this.node.animationState.setActive("exit",!e);i&&!e&&l.then(()=>i(this.id))}mount(){const{register:e}=this.node.presenceContext||{};e&&(this.unmount=e(this.id))}unmount(){}}const fke={animation:{Feature:dke},exit:{Feature:pke}};function jC(n,e,i,o={passive:!0}){return n.addEventListener(e,i,o),()=>n.removeEventListener(e,i)}function mR(n){return{point:{x:n.pageX,y:n.pageY}}}const mke=n=>e=>RF(e)&&n(e,mR(e));function gC(n,e,i,o){return jC(n,e,mke(i),o)}const eY=(n,e)=>Math.abs(n-e);function gke(n,e){const i=eY(n.x,e.x),o=eY(n.y,e.y);return Math.sqrt(i**2+o**2)}class Mte{constructor(e,i,{transformPagePoint:o,contextWindow:l,dragSnapToOrigin:u=!1}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const I=rU(this.lastMoveEventInfo,this.history),P=this.startEvent!==null,L=gke(I.offset,{x:0,y:0})>=3;if(!P&&!L)return;const{point:M}=I,{timestamp:F}=Aa;this.history.push({...M,timestamp:F});const{onStart:B,onMove:Z}=this.handlers;P||(B&&B(this.lastMoveEvent,I),this.startEvent=this.lastMoveEvent),Z&&Z(this.lastMoveEvent,I)},this.handlePointerMove=(I,P)=>{this.lastMoveEvent=I,this.lastMoveEventInfo=nU(P,this.transformPagePoint),ss.update(this.updatePoint,!0)},this.handlePointerUp=(I,P)=>{this.end();const{onEnd:L,onSessionEnd:M,resumeAnimation:F}=this.handlers;if(this.dragSnapToOrigin&&F&&F(),!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const B=rU(I.type==="pointercancel"?this.lastMoveEventInfo:nU(P,this.transformPagePoint),this.history);this.startEvent&&L&&L(I,B),M&&M(I,B)},!RF(e))return;this.dragSnapToOrigin=u,this.handlers=i,this.transformPagePoint=o,this.contextWindow=l||window;const f=mR(e),_=nU(f,this.transformPagePoint),{point:E}=_,{timestamp:b}=Aa;this.history=[{...E,timestamp:b}];const{onSessionStart:C}=i;C&&C(e,rU(_,this.history)),this.removeListeners=fR(gC(this.contextWindow,"pointermove",this.handlePointerMove),gC(this.contextWindow,"pointerup",this.handlePointerUp),gC(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(e){this.handlers=e}end(){this.removeListeners&&this.removeListeners(),jg(this.updatePoint)}}function nU(n,e){return e?{point:e(n.point)}:n}function tY(n,e){return{x:n.x-e.x,y:n.y-e.y}}function rU({point:n},e){return{point:n,delta:tY(n,Ute(e)),offset:tY(n,_ke(e)),velocity:yke(e,.1)}}function _ke(n){return n[0]}function Ute(n){return n[n.length-1]}function yke(n,e){if(n.length<2)return{x:0,y:0};let i=n.length-1,o=null;const l=Ute(n);for(;i>=0&&(o=n[i],!(l.timestamp-o.timestamp>Hf(e)));)i--;if(!o)return{x:0,y:0};const u=$f(l.timestamp-o.timestamp);if(u===0)return{x:0,y:0};const f={x:(l.x-o.x)/u,y:(l.y-o.y)/u};return f.x===1/0&&(f.x=0),f.y===1/0&&(f.y=0),f}const Vte=1e-4,Eke=1-Vte,vke=1+Vte,jte=.01,Ske=0-jte,bke=0+jte;function Zl(n){return n.max-n.min}function wke(n,e,i){return Math.abs(n-e)<=i}function nY(n,e,i,o=.5){n.origin=o,n.originPoint=Ss(e.min,e.max,n.origin),n.scale=Zl(i)/Zl(e),n.translate=Ss(i.min,i.max,n.origin)-n.originPoint,(n.scale>=Eke&&n.scale<=vke||isNaN(n.scale))&&(n.scale=1),(n.translate>=Ske&&n.translate<=bke||isNaN(n.translate))&&(n.translate=0)}function _C(n,e,i,o){nY(n.x,e.x,i.x,o?o.originX:void 0),nY(n.y,e.y,i.y,o?o.originY:void 0)}function rY(n,e,i){n.min=i.min+e.min,n.max=n.min+Zl(e)}function Tke(n,e,i){rY(n.x,e.x,i.x),rY(n.y,e.y,i.y)}function iY(n,e,i){n.min=e.min-i.min,n.max=n.min+Zl(e)}function yC(n,e,i){iY(n.x,e.x,i.x),iY(n.y,e.y,i.y)}function Cke(n,{min:e,max:i},o){return e!==void 0&&n<e?n=o?Ss(e,n,o.min):Math.max(n,e):i!==void 0&&n>i&&(n=o?Ss(i,n,o.max):Math.min(n,i)),n}function sY(n,e,i){return{min:e!==void 0?n.min+e:void 0,max:i!==void 0?n.max+i-(n.max-n.min):void 0}}function Rke(n,{top:e,left:i,bottom:o,right:l}){return{x:sY(n.x,i,l),y:sY(n.y,e,o)}}function oY(n,e){let i=e.min-n.min,o=e.max-n.max;return e.max-e.min<n.max-n.min&&([i,o]=[o,i]),{min:i,max:o}}function Ike(n,e){return{x:oY(n.x,e.x),y:oY(n.y,e.y)}}function Ake(n,e){let i=.5;const o=Zl(n),l=Zl(e);return l>o?i=I0(e.min,e.max-o,n.min):o>l&&(i=I0(n.min,n.max-l,e.min)),Qf(0,1,i)}function Pke(n,e){const i={};return e.min!==void 0&&(i.min=e.min-n.min),e.max!==void 0&&(i.max=e.max-n.min),i}const wV=.35;function Oke(n=wV){return n===!1?n=0:n===!0&&(n=wV),{x:aY(n,"left","right"),y:aY(n,"top","bottom")}}function aY(n,e,i){return{min:cY(n,e),max:cY(n,i)}}function cY(n,e){return typeof n=="number"?n:n[e]||0}const lY=()=>({translate:0,scale:1,origin:0,originPoint:0}),ZS=()=>({x:lY(),y:lY()}),uY=()=>({min:0,max:0}),to=()=>({x:uY(),y:uY()});function Hu(n){return[n("x"),n("y")]}function Fte({top:n,left:e,right:i,bottom:o}){return{x:{min:e,max:i},y:{min:n,max:o}}}function kke({x:n,y:e}){return{top:e.min,right:n.max,bottom:e.max,left:n.min}}function Nke(n,e){if(!e)return n;const i=e({x:n.left,y:n.top}),o=e({x:n.right,y:n.bottom});return{top:i.y,left:i.x,bottom:o.y,right:o.x}}function iU(n){return n===void 0||n===1}function TV({scale:n,scaleX:e,scaleY:i}){return!iU(n)||!iU(e)||!iU(i)}function Cy(n){return TV(n)||Bte(n)||n.z||n.rotate||n.rotateX||n.rotateY||n.skewX||n.skewY}function Bte(n){return dY(n.x)||dY(n.y)}function dY(n){return n&&n!=="0%"}function Jk(n,e,i){const o=n-i,l=e*o;return i+l}function hY(n,e,i,o,l){return l!==void 0&&(n=Jk(n,l,o)),Jk(n,i,o)+e}function CV(n,e=0,i=1,o,l){n.min=hY(n.min,e,i,o,l),n.max=hY(n.max,e,i,o,l)}function Wte(n,{x:e,y:i}){CV(n.x,e.translate,e.scale,e.originPoint),CV(n.y,i.translate,i.scale,i.originPoint)}const pY=.999999999999,fY=1.0000000000001;function Dke(n,e,i,o=!1){const l=i.length;if(!l)return;e.x=e.y=1;let u,f;for(let _=0;_<l;_++){u=i[_],f=u.projectionDelta;const{visualElement:E}=u.options;E&&E.props.style&&E.props.style.display==="contents"||(o&&u.options.layoutScroll&&u.scroll&&u!==u.root&&t0(n,{x:-u.scroll.offset.x,y:-u.scroll.offset.y}),f&&(e.x*=f.x.scale,e.y*=f.y.scale,Wte(n,f)),o&&Cy(u.latestValues)&&t0(n,u.latestValues))}e.x<fY&&e.x>pY&&(e.x=1),e.y<fY&&e.y>pY&&(e.y=1)}function e0(n,e){n.min=n.min+e,n.max=n.max+e}function mY(n,e,i,o,l=.5){const u=Ss(n.min,n.max,l);CV(n,e,i,u,o)}function t0(n,e){mY(n.x,e.x,e.scaleX,e.scale,e.originX),mY(n.y,e.y,e.scaleY,e.scale,e.originY)}function zte(n,e){return Fte(Nke(n.getBoundingClientRect(),e))}function xke(n,e,i){const o=zte(n,i),{scroll:l}=e;return l&&(e0(o.x,l.offset.x),e0(o.y,l.offset.y)),o}const Gte=({current:n})=>n?n.ownerDocument.defaultView:null,Lke=new WeakMap;class Mke{constructor(e){this.openDragLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=to(),this.visualElement=e}start(e,{snapToCursor:i=!1}={}){const{presenceContext:o}=this.visualElement;if(o&&o.isPresent===!1)return;const l=C=>{const{dragSnapToOrigin:I}=this.getProps();I?this.pauseAnimation():this.stopAnimation(),i&&this.snapToCursor(mR(C).point)},u=(C,I)=>{const{drag:P,dragPropagation:L,onDragStart:M}=this.getProps();if(P&&!L&&(this.openDragLock&&this.openDragLock(),this.openDragLock=APe(P),!this.openDragLock))return;this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),Hu(B=>{let Z=this.getAxisMotionValue(B).get()||0;if(fp.test(Z)){const{projection:K}=this.visualElement;if(K&&K.layout){const re=K.layout.layoutBox[B];re&&(Z=Zl(re)*(parseFloat(Z)/100))}}this.originPoint[B]=Z}),M&&ss.postRender(()=>M(C,I)),mV(this.visualElement,"transform");const{animationState:F}=this.visualElement;F&&F.setActive("whileDrag",!0)},f=(C,I)=>{const{dragPropagation:P,dragDirectionLock:L,onDirectionLock:M,onDrag:F}=this.getProps();if(!P&&!this.openDragLock)return;const{offset:B}=I;if(L&&this.currentDirection===null){this.currentDirection=Uke(B),this.currentDirection!==null&&M&&M(this.currentDirection);return}this.updateAxis("x",I.point,B),this.updateAxis("y",I.point,B),this.visualElement.render(),F&&F(C,I)},_=(C,I)=>this.stop(C,I),E=()=>Hu(C=>{var I;return this.getAnimationState(C)==="paused"&&((I=this.getAxisMotionValue(C).animation)===null||I===void 0?void 0:I.play())}),{dragSnapToOrigin:b}=this.getProps();this.panSession=new Mte(e,{onSessionStart:l,onStart:u,onMove:f,onSessionEnd:_,resumeAnimation:E},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:b,contextWindow:Gte(this.visualElement)})}stop(e,i){const o=this.isDragging;if(this.cancel(),!o)return;const{velocity:l}=i;this.startAnimation(l);const{onDragEnd:u}=this.getProps();u&&ss.postRender(()=>u(e,i))}cancel(){this.isDragging=!1;const{projection:e,animationState:i}=this.visualElement;e&&(e.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:o}=this.getProps();!o&&this.openDragLock&&(this.openDragLock(),this.openDragLock=null),i&&i.setActive("whileDrag",!1)}updateAxis(e,i,o){const{drag:l}=this.getProps();if(!o||!UO(e,l,this.currentDirection))return;const u=this.getAxisMotionValue(e);let f=this.originPoint[e]+o[e];this.constraints&&this.constraints[e]&&(f=Cke(f,this.constraints[e],this.elastic[e])),u.set(f)}resolveConstraints(){var e;const{dragConstraints:i,dragElastic:o}=this.getProps(),l=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):(e=this.visualElement.projection)===null||e===void 0?void 0:e.layout,u=this.constraints;i&&JS(i)?this.constraints||(this.constraints=this.resolveRefConstraints()):i&&l?this.constraints=Rke(l.layoutBox,i):this.constraints=!1,this.elastic=Oke(o),u!==this.constraints&&l&&this.constraints&&!this.hasMutatedConstraints&&Hu(f=>{this.constraints!==!1&&this.getAxisMotionValue(f)&&(this.constraints[f]=Pke(l.layoutBox[f],this.constraints[f]))})}resolveRefConstraints(){const{dragConstraints:e,onMeasureDragConstraints:i}=this.getProps();if(!e||!JS(e))return!1;const o=e.current,{projection:l}=this.visualElement;if(!l||!l.layout)return!1;const u=xke(o,l.root,this.visualElement.getTransformPagePoint());let f=Ike(l.layout.layoutBox,u);if(i){const _=i(kke(f));this.hasMutatedConstraints=!!_,_&&(f=Fte(_))}return f}startAnimation(e){const{drag:i,dragMomentum:o,dragElastic:l,dragTransition:u,dragSnapToOrigin:f,onDragTransitionEnd:_}=this.getProps(),E=this.constraints||{},b=Hu(C=>{if(!UO(C,i,this.currentDirection))return;let I=E&&E[C]||{};f&&(I={min:0,max:0});const P=l?200:1e6,L=l?40:1e7,M={type:"inertia",velocity:o?e[C]:0,bounceStiffness:P,bounceDamping:L,timeConstant:750,restDelta:1,restSpeed:10,...u,...I};return this.startAxisValueAnimation(C,M)});return Promise.all(b).then(_)}startAxisValueAnimation(e,i){const o=this.getAxisMotionValue(e);return mV(this.visualElement,e),o.start(VF(e,o,0,i,this.visualElement,!1))}stopAnimation(){Hu(e=>this.getAxisMotionValue(e).stop())}pauseAnimation(){Hu(e=>{var i;return(i=this.getAxisMotionValue(e).animation)===null||i===void 0?void 0:i.pause()})}getAnimationState(e){var i;return(i=this.getAxisMotionValue(e).animation)===null||i===void 0?void 0:i.state}getAxisMotionValue(e){const i=`_drag${e.toUpperCase()}`,o=this.visualElement.getProps(),l=o[i];return l||this.visualElement.getValue(e,(o.initial?o.initial[e]:void 0)||0)}snapToCursor(e){Hu(i=>{const{drag:o}=this.getProps();if(!UO(i,o,this.currentDirection))return;const{projection:l}=this.visualElement,u=this.getAxisMotionValue(i);if(l&&l.layout){const{min:f,max:_}=l.layout.layoutBox[i];u.set(e[i]-Ss(f,_,.5))}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:e,dragConstraints:i}=this.getProps(),{projection:o}=this.visualElement;if(!JS(i)||!o||!this.constraints)return;this.stopAnimation();const l={x:0,y:0};Hu(f=>{const _=this.getAxisMotionValue(f);if(_&&this.constraints!==!1){const E=_.get();l[f]=Ake({min:E,max:E},this.constraints[f])}});const{transformTemplate:u}=this.visualElement.getProps();this.visualElement.current.style.transform=u?u({},""):"none",o.root&&o.root.updateScroll(),o.updateLayout(),this.resolveConstraints(),Hu(f=>{if(!UO(f,e,null))return;const _=this.getAxisMotionValue(f),{min:E,max:b}=this.constraints[f];_.set(Ss(E,b,l[f]))})}addListeners(){if(!this.visualElement.current)return;Lke.set(this.visualElement,this);const e=this.visualElement.current,i=gC(e,"pointerdown",E=>{const{drag:b,dragListener:C=!0}=this.getProps();b&&C&&this.start(E)}),o=()=>{const{dragConstraints:E}=this.getProps();JS(E)&&E.current&&(this.constraints=this.resolveRefConstraints())},{projection:l}=this.visualElement,u=l.addEventListener("measure",o);l&&!l.layout&&(l.root&&l.root.updateScroll(),l.updateLayout()),ss.read(o);const f=jC(window,"resize",()=>this.scalePositionWithinConstraints()),_=l.addEventListener("didUpdate",({delta:E,hasLayoutChanged:b})=>{this.isDragging&&b&&(Hu(C=>{const I=this.getAxisMotionValue(C);I&&(this.originPoint[C]+=E[C].translate,I.set(I.get()+E[C].translate))}),this.visualElement.render())});return()=>{f(),i(),u(),_&&_()}}getProps(){const e=this.visualElement.getProps(),{drag:i=!1,dragDirectionLock:o=!1,dragPropagation:l=!1,dragConstraints:u=!1,dragElastic:f=wV,dragMomentum:_=!0}=e;return{...e,drag:i,dragDirectionLock:o,dragPropagation:l,dragConstraints:u,dragElastic:f,dragMomentum:_}}}function UO(n,e,i){return(e===!0||e===n)&&(i===null||i===n)}function Uke(n,e=10){let i=null;return Math.abs(n.y)>e?i="y":Math.abs(n.x)>e&&(i="x"),i}class Vke extends Xg{constructor(e){super(e),this.removeGroupControls=Ql,this.removeListeners=Ql,this.controls=new Mke(e)}mount(){const{dragControls:e}=this.node.getProps();e&&(this.removeGroupControls=e.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||Ql}unmount(){this.removeGroupControls(),this.removeListeners()}}const gY=n=>(e,i)=>{n&&ss.postRender(()=>n(e,i))};class jke extends Xg{constructor(){super(...arguments),this.removePointerDownListener=Ql}onPointerDown(e){this.session=new Mte(e,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:Gte(this.node)})}createPanHandlers(){const{onPanSessionStart:e,onPanStart:i,onPan:o,onPanEnd:l}=this.node.getProps();return{onSessionStart:gY(e),onStart:gY(i),onMove:o,onEnd:(u,f)=>{delete this.session,l&&ss.postRender(()=>l(u,f))}}}mount(){this.removePointerDownListener=gC(this.node.current,"pointerdown",e=>this.onPointerDown(e))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}const vk={hasAnimatedSinceResize:!0,hasEverUpdated:!1};function _Y(n,e){return e.max===e.min?0:n/(e.max-e.min)*100}const AT={correct:(n,e)=>{if(!e.target)return n;if(typeof n=="string")if(zn.test(n))n=parseFloat(n);else return n;const i=_Y(n,e.target.x),o=_Y(n,e.target.y);return`${i}% ${o}%`}},Fke={correct:(n,{treeScale:e,projectionDelta:i})=>{const o=n,l=Fg.parse(n);if(l.length>5)return o;const u=Fg.createTransformer(n),f=typeof l[0]!="number"?1:0,_=i.x.scale*e.x,E=i.y.scale*e.y;l[0+f]/=_,l[1+f]/=E;const b=Ss(_,E,.5);return typeof l[2+f]=="number"&&(l[2+f]/=b),typeof l[3+f]=="number"&&(l[3+f]/=b),u(l)}};class Bke extends k.Component{componentDidMount(){const{visualElement:e,layoutGroup:i,switchLayoutGroup:o,layoutId:l}=this.props,{projection:u}=e;aPe(Wke),u&&(i.group&&i.group.add(u),o&&o.register&&l&&o.register(u),u.root.didUpdate(),u.addEventListener("animationComplete",()=>{this.safeToRemove()}),u.setOptions({...u.options,onExitComplete:()=>this.safeToRemove()})),vk.hasEverUpdated=!0}getSnapshotBeforeUpdate(e){const{layoutDependency:i,visualElement:o,drag:l,isPresent:u}=this.props,f=o.projection;return f&&(f.isPresent=u,l||e.layoutDependency!==i||i===void 0?f.willUpdate():this.safeToRemove(),e.isPresent!==u&&(u?f.promote():f.relegate()||ss.postRender(()=>{const _=f.getStack();(!_||!_.members.length)&&this.safeToRemove()}))),null}componentDidUpdate(){const{projection:e}=this.props.visualElement;e&&(e.root.didUpdate(),pF.postRender(()=>{!e.currentAnimation&&e.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:e,layoutGroup:i,switchLayoutGroup:o}=this.props,{projection:l}=e;l&&(l.scheduleCheckAfterUnmount(),i&&i.group&&i.group.remove(l),o&&o.deregister&&o.deregister(l))}safeToRemove(){const{safeToRemove:e}=this.props;e&&e()}render(){return null}}function Hte(n){const[e,i]=aF(),o=k.useContext(iF);return S.jsx(Bke,{...n,layoutGroup:o,switchLayoutGroup:k.useContext(Lee),isPresent:e,safeToRemove:i})}const Wke={borderRadius:{...AT,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:AT,borderTopRightRadius:AT,borderBottomLeftRadius:AT,borderBottomRightRadius:AT,boxShadow:Fke};function zke(n,e,i){const o=ac(n)?n:UC(n);return o.start(VF("",o,e,i)),o.animation}function Gke(n){return n instanceof SVGElement&&n.tagName!=="svg"}const Hke=(n,e)=>n.depth-e.depth;class $ke{constructor(){this.children=[],this.isDirty=!1}add(e){IF(this.children,e),this.isDirty=!0}remove(e){AF(this.children,e),this.isDirty=!0}forEach(e){this.isDirty&&this.children.sort(Hke),this.isDirty=!1,this.children.forEach(e)}}function Kke(n,e){const i=mp.now(),o=({timestamp:l})=>{const u=l-i;u>=e&&(jg(o),n(u-e))};return ss.read(o,!0),()=>jg(o)}const $te=["TopLeft","TopRight","BottomLeft","BottomRight"],qke=$te.length,yY=n=>typeof n=="string"?parseFloat(n):n,EY=n=>typeof n=="number"||zn.test(n);function Yke(n,e,i,o,l,u){l?(n.opacity=Ss(0,i.opacity!==void 0?i.opacity:1,Xke(o)),n.opacityExit=Ss(e.opacity!==void 0?e.opacity:1,0,Jke(o))):u&&(n.opacity=Ss(e.opacity!==void 0?e.opacity:1,i.opacity!==void 0?i.opacity:1,o));for(let f=0;f<qke;f++){const _=`border${$te[f]}Radius`;let E=vY(e,_),b=vY(i,_);if(E===void 0&&b===void 0)continue;E||(E=0),b||(b=0),E===0||b===0||EY(E)===EY(b)?(n[_]=Math.max(Ss(yY(E),yY(b),o),0),(fp.test(b)||fp.test(E))&&(n[_]+="%")):n[_]=b}(e.rotate||i.rotate)&&(n.rotate=Ss(e.rotate||0,i.rotate||0,o))}function vY(n,e){return n[e]!==void 0?n[e]:n.borderRadius}const Xke=Kte(0,.5,dte),Jke=Kte(.5,.95,Ql);function Kte(n,e,i){return o=>o<n?0:o>e?1:i(I0(n,e,o))}function SY(n,e){n.min=e.min,n.max=e.max}function Wu(n,e){SY(n.x,e.x),SY(n.y,e.y)}function bY(n,e){n.translate=e.translate,n.scale=e.scale,n.originPoint=e.originPoint,n.origin=e.origin}function wY(n,e,i,o,l){return n-=e,n=Jk(n,1/i,o),l!==void 0&&(n=Jk(n,1/l,o)),n}function Qke(n,e=0,i=1,o=.5,l,u=n,f=n){if(fp.test(e)&&(e=parseFloat(e),e=Ss(f.min,f.max,e/100)-f.min),typeof e!="number")return;let _=Ss(u.min,u.max,o);n===u&&(_-=e),n.min=wY(n.min,e,i,_,l),n.max=wY(n.max,e,i,_,l)}function TY(n,e,[i,o,l],u,f){Qke(n,e[i],e[o],e[l],e.scale,u,f)}const Zke=["x","scaleX","originX"],e1e=["y","scaleY","originY"];function CY(n,e,i,o){TY(n.x,e,Zke,i?i.x:void 0,o?o.x:void 0),TY(n.y,e,e1e,i?i.y:void 0,o?o.y:void 0)}function RY(n){return n.translate===0&&n.scale===1}function qte(n){return RY(n.x)&&RY(n.y)}function IY(n,e){return n.min===e.min&&n.max===e.max}function t1e(n,e){return IY(n.x,e.x)&&IY(n.y,e.y)}function AY(n,e){return Math.round(n.min)===Math.round(e.min)&&Math.round(n.max)===Math.round(e.max)}function Yte(n,e){return AY(n.x,e.x)&&AY(n.y,e.y)}function PY(n){return Zl(n.x)/Zl(n.y)}function OY(n,e){return n.translate===e.translate&&n.scale===e.scale&&n.originPoint===e.originPoint}class n1e{constructor(){this.members=[]}add(e){IF(this.members,e),e.scheduleRender()}remove(e){if(AF(this.members,e),e===this.prevLead&&(this.prevLead=void 0),e===this.lead){const i=this.members[this.members.length-1];i&&this.promote(i)}}relegate(e){const i=this.members.findIndex(l=>e===l);if(i===0)return!1;let o;for(let l=i;l>=0;l--){const u=this.members[l];if(u.isPresent!==!1){o=u;break}}return o?(this.promote(o),!0):!1}promote(e,i){const o=this.lead;if(e!==o&&(this.prevLead=o,this.lead=e,e.show(),o)){o.instance&&o.scheduleRender(),e.scheduleRender(),e.resumeFrom=o,i&&(e.resumeFrom.preserveOpacity=!0),o.snapshot&&(e.snapshot=o.snapshot,e.snapshot.latestValues=o.animationValues||o.latestValues),e.root&&e.root.isUpdating&&(e.isLayoutDirty=!0);const{crossfade:l}=e.options;l===!1&&o.hide()}}exitAnimationComplete(){this.members.forEach(e=>{const{options:i,resumingFrom:o}=e;i.onExitComplete&&i.onExitComplete(),o&&o.options.onExitComplete&&o.options.onExitComplete()})}scheduleRender(){this.members.forEach(e=>{e.instance&&e.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}function r1e(n,e,i){let o="";const l=n.x.translate/e.x,u=n.y.translate/e.y,f=(i==null?void 0:i.z)||0;if((l||u||f)&&(o=`translate3d(${l}px, ${u}px, ${f}px) `),(e.x!==1||e.y!==1)&&(o+=`scale(${1/e.x}, ${1/e.y}) `),i){const{transformPerspective:b,rotate:C,rotateX:I,rotateY:P,skewX:L,skewY:M}=i;b&&(o=`perspective(${b}px) ${o}`),C&&(o+=`rotate(${C}deg) `),I&&(o+=`rotateX(${I}deg) `),P&&(o+=`rotateY(${P}deg) `),L&&(o+=`skewX(${L}deg) `),M&&(o+=`skewY(${M}deg) `)}const _=n.x.scale*e.x,E=n.y.scale*e.y;return(_!==1||E!==1)&&(o+=`scale(${_}, ${E})`),o||"none"}const Ry={type:"projectionFrame",totalNodes:0,resolvedTargetDeltas:0,recalculatedProjection:0},ZT=typeof window<"u"&&window.MotionDebug!==void 0,sU=["","X","Y","Z"],i1e={visibility:"hidden"},kY=1e3;let s1e=0;function oU(n,e,i,o){const{latestValues:l}=e;l[n]&&(i[n]=l[n],e.setStaticValue(n,0),o&&(o[n]=0))}function Xte(n){if(n.hasCheckedOptimisedAppear=!0,n.root===n)return;const{visualElement:e}=n.options;if(!e)return;const i=ite(e);if(window.MotionHasOptimisedAnimation(i,"transform")){const{layout:l,layoutId:u}=n.options;window.MotionCancelOptimisedAnimation(i,"transform",ss,!(l||u))}const{parent:o}=n;o&&!o.hasCheckedOptimisedAppear&&Xte(o)}function Jte({attachResizeListener:n,defaultParent:e,measureScroll:i,checkIsScrollRoot:o,resetTransform:l}){return class{constructor(f={},_=e==null?void 0:e()){this.id=s1e++,this.animationId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.hasCheckedOptimisedAppear=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.updateScheduled=!1,this.scheduleUpdate=()=>this.update(),this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,ZT&&(Ry.totalNodes=Ry.resolvedTargetDeltas=Ry.recalculatedProjection=0),this.nodes.forEach(c1e),this.nodes.forEach(p1e),this.nodes.forEach(f1e),this.nodes.forEach(l1e),ZT&&window.MotionDebug.record(Ry)},this.resolvedRelativeTargetAt=0,this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=f,this.root=_?_.root||_:this,this.path=_?[..._.path,_]:[],this.parent=_,this.depth=_?_.depth+1:0;for(let E=0;E<this.path.length;E++)this.path[E].shouldResetTransform=!0;this.root===this&&(this.nodes=new $ke)}addEventListener(f,_){return this.eventHandlers.has(f)||this.eventHandlers.set(f,new PF),this.eventHandlers.get(f).add(_)}notifyListeners(f,..._){const E=this.eventHandlers.get(f);E&&E.notify(..._)}hasListeners(f){return this.eventHandlers.has(f)}mount(f,_=this.root.hasTreeAnimated){if(this.instance)return;this.isSVG=Gke(f),this.instance=f;const{layoutId:E,layout:b,visualElement:C}=this.options;if(C&&!C.current&&C.mount(f),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),_&&(b||E)&&(this.isLayoutDirty=!0),n){let I;const P=()=>this.root.updateBlockedByResize=!1;n(f,()=>{this.root.updateBlockedByResize=!0,I&&I(),I=Kke(P,250),vk.hasAnimatedSinceResize&&(vk.hasAnimatedSinceResize=!1,this.nodes.forEach(DY))})}E&&this.root.registerSharedNode(E,this),this.options.animate!==!1&&C&&(E||b)&&this.addEventListener("didUpdate",({delta:I,hasLayoutChanged:P,hasRelativeTargetChanged:L,layout:M})=>{if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}const F=this.options.transition||C.getDefaultTransition()||E1e,{onLayoutAnimationStart:B,onLayoutAnimationComplete:Z}=C.getProps(),K=!this.targetLayout||!Yte(this.targetLayout,M)||L,re=!P&&L;if(this.options.layoutRoot||this.resumeFrom&&this.resumeFrom.instance||re||P&&(K||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0),this.setAnimationOrigin(I,re);const ae={...wF(F,"layout"),onPlay:B,onComplete:Z};(C.shouldReduceMotion||this.options.layoutRoot)&&(ae.delay=0,ae.type=!1),this.startAnimation(ae)}else P||DY(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=M})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const f=this.getStack();f&&f.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,jg(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(m1e),this.animationId++)}getTransformTemplate(){const{visualElement:f}=this.options;return f&&f.getProps().transformTemplate}willUpdate(f=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked()){this.options.onExitComplete&&this.options.onExitComplete();return}if(window.MotionCancelOptimisedAnimation&&!this.hasCheckedOptimisedAppear&&Xte(this),!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let C=0;C<this.path.length;C++){const I=this.path[C];I.shouldResetTransform=!0,I.updateScroll("snapshot"),I.options.layoutRoot&&I.willUpdate(!1)}const{layoutId:_,layout:E}=this.options;if(_===void 0&&!E)return;const b=this.getTransformTemplate();this.prevTransformTemplateValue=b?b(this.latestValues,""):void 0,this.updateSnapshot(),f&&this.notifyListeners("willUpdate")}update(){if(this.updateScheduled=!1,this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach(NY);return}this.isUpdating||this.nodes.forEach(d1e),this.isUpdating=!1,this.nodes.forEach(h1e),this.nodes.forEach(o1e),this.nodes.forEach(a1e),this.clearAllSnapshots();const _=mp.now();Aa.delta=Qf(0,1e3/60,_-Aa.timestamp),Aa.timestamp=_,Aa.isProcessing=!0,JM.update.process(Aa),JM.preRender.process(Aa),JM.render.process(Aa),Aa.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,pF.read(this.scheduleUpdate))}clearAllSnapshots(){this.nodes.forEach(u1e),this.sharedNodes.forEach(g1e)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,ss.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){ss.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){this.snapshot||!this.instance||(this.snapshot=this.measure())}updateLayout(){if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let E=0;E<this.path.length;E++)this.path[E].updateScroll();const f=this.layout;this.layout=this.measure(!1),this.layoutCorrected=to(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:_}=this.options;_&&_.notify("LayoutMeasure",this.layout.layoutBox,f?f.layoutBox:void 0)}updateScroll(f="measure"){let _=!!(this.options.layoutScroll&&this.instance);if(this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===f&&(_=!1),_){const E=o(this.instance);this.scroll={animationId:this.root.animationId,phase:f,isRoot:E,offset:i(this.instance),wasRoot:this.scroll?this.scroll.isRoot:E}}}resetTransform(){if(!l)return;const f=this.isLayoutDirty||this.shouldResetTransform||this.options.alwaysMeasureLayout,_=this.projectionDelta&&!qte(this.projectionDelta),E=this.getTransformTemplate(),b=E?E(this.latestValues,""):void 0,C=b!==this.prevTransformTemplateValue;f&&(_||Cy(this.latestValues)||C)&&(l(this.instance,b),this.shouldResetTransform=!1,this.scheduleRender())}measure(f=!0){const _=this.measurePageBox();let E=this.removeElementScroll(_);return f&&(E=this.removeTransform(E)),v1e(E),{animationId:this.root.animationId,measuredBox:_,layoutBox:E,latestValues:{},source:this.id}}measurePageBox(){var f;const{visualElement:_}=this.options;if(!_)return to();const E=_.measureViewportBox();if(!(((f=this.scroll)===null||f===void 0?void 0:f.wasRoot)||this.path.some(S1e))){const{scroll:C}=this.root;C&&(e0(E.x,C.offset.x),e0(E.y,C.offset.y))}return E}removeElementScroll(f){var _;const E=to();if(Wu(E,f),!((_=this.scroll)===null||_===void 0)&&_.wasRoot)return E;for(let b=0;b<this.path.length;b++){const C=this.path[b],{scroll:I,options:P}=C;C!==this.root&&I&&P.layoutScroll&&(I.wasRoot&&Wu(E,f),e0(E.x,I.offset.x),e0(E.y,I.offset.y))}return E}applyTransform(f,_=!1){const E=to();Wu(E,f);for(let b=0;b<this.path.length;b++){const C=this.path[b];!_&&C.options.layoutScroll&&C.scroll&&C!==C.root&&t0(E,{x:-C.scroll.offset.x,y:-C.scroll.offset.y}),Cy(C.latestValues)&&t0(E,C.latestValues)}return Cy(this.latestValues)&&t0(E,this.latestValues),E}removeTransform(f){const _=to();Wu(_,f);for(let E=0;E<this.path.length;E++){const b=this.path[E];if(!b.instance||!Cy(b.latestValues))continue;TV(b.latestValues)&&b.updateSnapshot();const C=to(),I=b.measurePageBox();Wu(C,I),CY(_,b.latestValues,b.snapshot?b.snapshot.layoutBox:void 0,C)}return Cy(this.latestValues)&&CY(_,this.latestValues),_}setTargetDelta(f){this.targetDelta=f,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(f){this.options={...this.options,...f,crossfade:f.crossfade!==void 0?f.crossfade:!0}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==Aa.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(f=!1){var _;const E=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=E.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=E.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=E.isSharedProjectionDirty);const b=!!this.resumingFrom||this!==E;if(!(f||b&&this.isSharedProjectionDirty||this.isProjectionDirty||!((_=this.parent)===null||_===void 0)&&_.isProjectionDirty||this.attemptToResolveRelativeTarget||this.root.updateBlockedByResize))return;const{layout:I,layoutId:P}=this.options;if(!(!this.layout||!(I||P))){if(this.resolvedRelativeTargetAt=Aa.timestamp,!this.targetDelta&&!this.relativeTarget){const L=this.getClosestProjectingParent();L&&L.layout&&this.animationProgress!==1?(this.relativeParent=L,this.forceRelativeParentToResolveTarget(),this.relativeTarget=to(),this.relativeTargetOrigin=to(),yC(this.relativeTargetOrigin,this.layout.layoutBox,L.layout.layoutBox),Wu(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}if(!(!this.relativeTarget&&!this.targetDelta)){if(this.target||(this.target=to(),this.targetWithTransforms=to()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),Tke(this.target,this.relativeTarget,this.relativeParent.target)):this.targetDelta?(this.resumingFrom?this.target=this.applyTransform(this.layout.layoutBox):Wu(this.target,this.layout.layoutBox),Wte(this.target,this.targetDelta)):Wu(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget){this.attemptToResolveRelativeTarget=!1;const L=this.getClosestProjectingParent();L&&!!L.resumingFrom==!!this.resumingFrom&&!L.options.layoutScroll&&L.target&&this.animationProgress!==1?(this.relativeParent=L,this.forceRelativeParentToResolveTarget(),this.relativeTarget=to(),this.relativeTargetOrigin=to(),yC(this.relativeTargetOrigin,this.target,L.target),Wu(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}ZT&&Ry.resolvedTargetDeltas++}}}getClosestProjectingParent(){if(!(!this.parent||TV(this.parent.latestValues)||Bte(this.parent.latestValues)))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return!!((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}calcProjection(){var f;const _=this.getLead(),E=!!this.resumingFrom||this!==_;let b=!0;if((this.isProjectionDirty||!((f=this.parent)===null||f===void 0)&&f.isProjectionDirty)&&(b=!1),E&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(b=!1),this.resolvedRelativeTargetAt===Aa.timestamp&&(b=!1),b)return;const{layout:C,layoutId:I}=this.options;if(this.isTreeAnimating=!!(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!(C||I))return;Wu(this.layoutCorrected,this.layout.layoutBox);const P=this.treeScale.x,L=this.treeScale.y;Dke(this.layoutCorrected,this.treeScale,this.path,E),_.layout&&!_.target&&(this.treeScale.x!==1||this.treeScale.y!==1)&&(_.target=_.layout.layoutBox,_.targetWithTransforms=to());const{target:M}=_;if(!M){this.prevProjectionDelta&&(this.createProjectionDeltas(),this.scheduleRender());return}!this.projectionDelta||!this.prevProjectionDelta?this.createProjectionDeltas():(bY(this.prevProjectionDelta.x,this.projectionDelta.x),bY(this.prevProjectionDelta.y,this.projectionDelta.y)),_C(this.projectionDelta,this.layoutCorrected,M,this.latestValues),(this.treeScale.x!==P||this.treeScale.y!==L||!OY(this.projectionDelta.x,this.prevProjectionDelta.x)||!OY(this.projectionDelta.y,this.prevProjectionDelta.y))&&(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",M)),ZT&&Ry.recalculatedProjection++}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(f=!0){var _;if((_=this.options.visualElement)===null||_===void 0||_.scheduleRender(),f){const E=this.getStack();E&&E.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}createProjectionDeltas(){this.prevProjectionDelta=ZS(),this.projectionDelta=ZS(),this.projectionDeltaWithTransform=ZS()}setAnimationOrigin(f,_=!1){const E=this.snapshot,b=E?E.latestValues:{},C={...this.latestValues},I=ZS();(!this.relativeParent||!this.relativeParent.options.layoutRoot)&&(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!_;const P=to(),L=E?E.source:void 0,M=this.layout?this.layout.source:void 0,F=L!==M,B=this.getStack(),Z=!B||B.members.length<=1,K=!!(F&&!Z&&this.options.crossfade===!0&&!this.path.some(y1e));this.animationProgress=0;let re;this.mixTargetDelta=ae=>{const ne=ae/1e3;xY(I.x,f.x,ne),xY(I.y,f.y,ne),this.setTargetDelta(I),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(yC(P,this.layout.layoutBox,this.relativeParent.layout.layoutBox),_1e(this.relativeTarget,this.relativeTargetOrigin,P,ne),re&&t1e(this.relativeTarget,re)&&(this.isProjectionDirty=!1),re||(re=to()),Wu(re,this.relativeTarget)),F&&(this.animationValues=C,Yke(C,b,this.latestValues,ne,K,Z)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=ne},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(f){this.notifyListeners("animationStart"),this.currentAnimation&&this.currentAnimation.stop(),this.resumingFrom&&this.resumingFrom.currentAnimation&&this.resumingFrom.currentAnimation.stop(),this.pendingAnimation&&(jg(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=ss.update(()=>{vk.hasAnimatedSinceResize=!0,this.currentAnimation=zke(0,kY,{...f,onUpdate:_=>{this.mixTargetDelta(_),f.onUpdate&&f.onUpdate(_)},onComplete:()=>{f.onComplete&&f.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const f=this.getStack();f&&f.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(kY),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const f=this.getLead();let{targetWithTransforms:_,target:E,layout:b,latestValues:C}=f;if(!(!_||!E||!b)){if(this!==f&&this.layout&&b&&Qte(this.options.animationType,this.layout.layoutBox,b.layoutBox)){E=this.target||to();const I=Zl(this.layout.layoutBox.x);E.x.min=f.target.x.min,E.x.max=E.x.min+I;const P=Zl(this.layout.layoutBox.y);E.y.min=f.target.y.min,E.y.max=E.y.min+P}Wu(_,E),t0(_,C),_C(this.projectionDeltaWithTransform,this.layoutCorrected,_,C)}}registerSharedNode(f,_){this.sharedNodes.has(f)||this.sharedNodes.set(f,new n1e),this.sharedNodes.get(f).add(_);const b=_.options.initialPromotionConfig;_.promote({transition:b?b.transition:void 0,preserveFollowOpacity:b&&b.shouldPreserveFollowOpacity?b.shouldPreserveFollowOpacity(_):void 0})}isLead(){const f=this.getStack();return f?f.lead===this:!0}getLead(){var f;const{layoutId:_}=this.options;return _?((f=this.getStack())===null||f===void 0?void 0:f.lead)||this:this}getPrevLead(){var f;const{layoutId:_}=this.options;return _?(f=this.getStack())===null||f===void 0?void 0:f.prevLead:void 0}getStack(){const{layoutId:f}=this.options;if(f)return this.root.sharedNodes.get(f)}promote({needsReset:f,transition:_,preserveFollowOpacity:E}={}){const b=this.getStack();b&&b.promote(this,E),f&&(this.projectionDelta=void 0,this.needsReset=!0),_&&this.setOptions({transition:_})}relegate(){const f=this.getStack();return f?f.relegate(this):!1}resetSkewAndRotation(){const{visualElement:f}=this.options;if(!f)return;let _=!1;const{latestValues:E}=f;if((E.z||E.rotate||E.rotateX||E.rotateY||E.rotateZ||E.skewX||E.skewY)&&(_=!0),!_)return;const b={};E.z&&oU("z",f,b,this.animationValues);for(let C=0;C<sU.length;C++)oU(`rotate${sU[C]}`,f,b,this.animationValues),oU(`skew${sU[C]}`,f,b,this.animationValues);f.render();for(const C in b)f.setStaticValue(C,b[C]),this.animationValues&&(this.animationValues[C]=b[C]);f.scheduleRender()}getProjectionStyles(f){var _,E;if(!this.instance||this.isSVG)return;if(!this.isVisible)return i1e;const b={visibility:""},C=this.getTransformTemplate();if(this.needsReset)return this.needsReset=!1,b.opacity="",b.pointerEvents=yk(f==null?void 0:f.pointerEvents)||"",b.transform=C?C(this.latestValues,""):"none",b;const I=this.getLead();if(!this.projectionDelta||!this.layout||!I.target){const F={};return this.options.layoutId&&(F.opacity=this.latestValues.opacity!==void 0?this.latestValues.opacity:1,F.pointerEvents=yk(f==null?void 0:f.pointerEvents)||""),this.hasProjected&&!Cy(this.latestValues)&&(F.transform=C?C({},""):"none",this.hasProjected=!1),F}const P=I.animationValues||I.latestValues;this.applyTransformsToTarget(),b.transform=r1e(this.projectionDeltaWithTransform,this.treeScale,P),C&&(b.transform=C(P,b.transform));const{x:L,y:M}=this.projectionDelta;b.transformOrigin=`${L.origin*100}% ${M.origin*100}% 0`,I.animationValues?b.opacity=I===this?(E=(_=P.opacity)!==null&&_!==void 0?_:this.latestValues.opacity)!==null&&E!==void 0?E:1:this.preserveOpacity?this.latestValues.opacity:P.opacityExit:b.opacity=I===this?P.opacity!==void 0?P.opacity:"":P.opacityExit!==void 0?P.opacityExit:0;for(const F in $k){if(P[F]===void 0)continue;const{correct:B,applyTo:Z}=$k[F],K=b.transform==="none"?P[F]:B(P[F],I);if(Z){const re=Z.length;for(let ae=0;ae<re;ae++)b[Z[ae]]=K}else b[F]=K}return this.options.layoutId&&(b.pointerEvents=I===this?yk(f==null?void 0:f.pointerEvents)||"":"none"),b}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(f=>{var _;return(_=f.currentAnimation)===null||_===void 0?void 0:_.stop()}),this.root.nodes.forEach(NY),this.root.sharedNodes.clear()}}}function o1e(n){n.updateLayout()}function a1e(n){var e;const i=((e=n.resumeFrom)===null||e===void 0?void 0:e.snapshot)||n.snapshot;if(n.isLead()&&n.layout&&i&&n.hasListeners("didUpdate")){const{layoutBox:o,measuredBox:l}=n.layout,{animationType:u}=n.options,f=i.source!==n.layout.source;u==="size"?Hu(I=>{const P=f?i.measuredBox[I]:i.layoutBox[I],L=Zl(P);P.min=o[I].min,P.max=P.min+L}):Qte(u,i.layoutBox,o)&&Hu(I=>{const P=f?i.measuredBox[I]:i.layoutBox[I],L=Zl(o[I]);P.max=P.min+L,n.relativeTarget&&!n.currentAnimation&&(n.isProjectionDirty=!0,n.relativeTarget[I].max=n.relativeTarget[I].min+L)});const _=ZS();_C(_,o,i.layoutBox);const E=ZS();f?_C(E,n.applyTransform(l,!0),i.measuredBox):_C(E,o,i.layoutBox);const b=!qte(_);let C=!1;if(!n.resumeFrom){const I=n.getClosestProjectingParent();if(I&&!I.resumeFrom){const{snapshot:P,layout:L}=I;if(P&&L){const M=to();yC(M,i.layoutBox,P.layoutBox);const F=to();yC(F,o,L.layoutBox),Yte(M,F)||(C=!0),I.options.layoutRoot&&(n.relativeTarget=F,n.relativeTargetOrigin=M,n.relativeParent=I)}}}n.notifyListeners("didUpdate",{layout:o,snapshot:i,delta:E,layoutDelta:_,hasLayoutChanged:b,hasRelativeTargetChanged:C})}else if(n.isLead()){const{onExitComplete:o}=n.options;o&&o()}n.options.transition=void 0}function c1e(n){ZT&&Ry.totalNodes++,n.parent&&(n.isProjecting()||(n.isProjectionDirty=n.parent.isProjectionDirty),n.isSharedProjectionDirty||(n.isSharedProjectionDirty=!!(n.isProjectionDirty||n.parent.isProjectionDirty||n.parent.isSharedProjectionDirty)),n.isTransformDirty||(n.isTransformDirty=n.parent.isTransformDirty))}function l1e(n){n.isProjectionDirty=n.isSharedProjectionDirty=n.isTransformDirty=!1}function u1e(n){n.clearSnapshot()}function NY(n){n.clearMeasurements()}function d1e(n){n.isLayoutDirty=!1}function h1e(n){const{visualElement:e}=n.options;e&&e.getProps().onBeforeLayoutMeasure&&e.notify("BeforeLayoutMeasure"),n.resetTransform()}function DY(n){n.finishAnimation(),n.targetDelta=n.relativeTarget=n.target=void 0,n.isProjectionDirty=!0}function p1e(n){n.resolveTargetDelta()}function f1e(n){n.calcProjection()}function m1e(n){n.resetSkewAndRotation()}function g1e(n){n.removeLeadSnapshot()}function xY(n,e,i){n.translate=Ss(e.translate,0,i),n.scale=Ss(e.scale,1,i),n.origin=e.origin,n.originPoint=e.originPoint}function LY(n,e,i,o){n.min=Ss(e.min,i.min,o),n.max=Ss(e.max,i.max,o)}function _1e(n,e,i,o){LY(n.x,e.x,i.x,o),LY(n.y,e.y,i.y,o)}function y1e(n){return n.animationValues&&n.animationValues.opacityExit!==void 0}const E1e={duration:.45,ease:[.4,0,.1,1]},MY=n=>typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(n),UY=MY("applewebkit/")&&!MY("chrome/")?Math.round:Ql;function VY(n){n.min=UY(n.min),n.max=UY(n.max)}function v1e(n){VY(n.x),VY(n.y)}function Qte(n,e,i){return n==="position"||n==="preserve-aspect"&&!wke(PY(e),PY(i),.2)}function S1e(n){var e;return n!==n.root&&((e=n.scroll)===null||e===void 0?void 0:e.wasRoot)}const b1e=Jte({attachResizeListener:(n,e)=>jC(n,"resize",e),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),aU={current:void 0},Zte=Jte({measureScroll:n=>({x:n.scrollLeft,y:n.scrollTop}),defaultParent:()=>{if(!aU.current){const n=new b1e({});n.mount(window),n.setOptions({layoutScroll:!0}),aU.current=n}return aU.current},resetTransform:(n,e)=>{n.style.transform=e!==void 0?e:"none"},checkIsScrollRoot:n=>window.getComputedStyle(n).position==="fixed"}),w1e={pan:{Feature:jke},drag:{Feature:Vke,ProjectionNode:Zte,MeasureLayout:Hte}};function jY(n,e,i){const{props:o}=n;n.animationState&&o.whileHover&&n.animationState.setActive("whileHover",i==="Start");const l="onHover"+i,u=o[l];u&&ss.postRender(()=>u(e,mR(e)))}class T1e extends Xg{mount(){const{current:e}=this.node;e&&(this.unmount=wPe(e,i=>(jY(this.node,i,"Start"),o=>jY(this.node,o,"End"))))}unmount(){}}class C1e extends Xg{constructor(){super(...arguments),this.isActive=!1}onFocus(){let e=!1;try{e=this.node.current.matches(":focus-visible")}catch{e=!0}!e||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){!this.isActive||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=fR(jC(this.node.current,"focus",()=>this.onFocus()),jC(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}function FY(n,e,i){const{props:o}=n;n.animationState&&o.whileTap&&n.animationState.setActive("whileTap",i==="Start");const l="onTap"+(i==="End"?"":i),u=o[l];u&&ss.postRender(()=>u(e,mR(e)))}class R1e extends Xg{mount(){const{current:e}=this.node;e&&(this.unmount=IPe(e,i=>(FY(this.node,i,"Start"),(o,{success:l})=>FY(this.node,o,l?"End":"Cancel")),{useGlobalTarget:this.node.props.globalTapTarget}))}unmount(){}}const RV=new WeakMap,cU=new WeakMap,I1e=n=>{const e=RV.get(n.target);e&&e(n)},A1e=n=>{n.forEach(I1e)};function P1e({root:n,...e}){const i=n||document;cU.has(i)||cU.set(i,{});const o=cU.get(i),l=JSON.stringify(e);return o[l]||(o[l]=new IntersectionObserver(A1e,{root:n,...e})),o[l]}function O1e(n,e,i){const o=P1e(e);return RV.set(n,i),o.observe(n),()=>{RV.delete(n),o.unobserve(n)}}const k1e={some:0,all:1};class N1e extends Xg{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:e={}}=this.node.getProps(),{root:i,margin:o,amount:l="some",once:u}=e,f={root:i?i.current:void 0,rootMargin:o,threshold:typeof l=="number"?l:k1e[l]},_=E=>{const{isIntersecting:b}=E;if(this.isInView===b||(this.isInView=b,u&&!b&&this.hasEnteredView))return;b&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",b);const{onViewportEnter:C,onViewportLeave:I}=this.node.getProps(),P=b?C:I;P&&P(E)};return O1e(this.node.current,f,_)}mount(){this.startObserver()}update(){if(typeof IntersectionObserver>"u")return;const{props:e,prevProps:i}=this.node;["amount","margin","root"].some(D1e(e,i))&&this.startObserver()}unmount(){}}function D1e({viewport:n={}},{viewport:e={}}={}){return i=>n[i]!==e[i]}const x1e={inView:{Feature:N1e},tap:{Feature:R1e},focus:{Feature:C1e},hover:{Feature:T1e}},L1e={layout:{ProjectionNode:Zte,MeasureLayout:Hte}},IV={current:null},ene={current:!1};function M1e(){if(ene.current=!0,!!cF)if(window.matchMedia){const n=window.matchMedia("(prefers-reduced-motion)"),e=()=>IV.current=n.matches;n.addListener(e),e()}else IV.current=!1}const U1e=[...Cte,ic,Fg],V1e=n=>U1e.find(Tte(n)),BY=new WeakMap;function j1e(n,e,i){for(const o in e){const l=e[o],u=i[o];if(ac(l))n.addValue(o,l);else if(ac(u))n.addValue(o,UC(l,{owner:n}));else if(u!==l)if(n.hasValue(o)){const f=n.getValue(o);f.liveStyle===!0?f.jump(l):f.hasAnimated||f.set(l)}else{const f=n.getStaticValue(o);n.addValue(o,UC(f!==void 0?f:l,{owner:n}))}}for(const o in i)e[o]===void 0&&n.removeValue(o);return e}const WY=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"];class F1e{scrapeMotionValuesFromProps(e,i,o){return{}}constructor({parent:e,props:i,presenceContext:o,reducedMotionConfig:l,blockInitialAnimation:u,visualState:f},_={}){this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.KeyframeResolver=LF,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.renderScheduledAt=0,this.scheduleRender=()=>{const L=mp.now();this.renderScheduledAt<L&&(this.renderScheduledAt=L,ss.render(this.render,!1,!0))};const{latestValues:E,renderState:b,onUpdate:C}=f;this.onUpdate=C,this.latestValues=E,this.baseTarget={...E},this.initialValues=i.initial?{...E}:{},this.renderState=b,this.parent=e,this.props=i,this.presenceContext=o,this.depth=e?e.depth+1:0,this.reducedMotionConfig=l,this.options=_,this.blockInitialAnimation=!!u,this.isControllingVariants=$1(i),this.isVariantNode=Dee(i),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=!!(e&&e.current);const{willChange:I,...P}=this.scrapeMotionValuesFromProps(i,{},this);for(const L in P){const M=P[L];E[L]!==void 0&&ac(M)&&M.set(E[L],!1)}}mount(e){this.current=e,BY.set(e,this),this.projection&&!this.projection.instance&&this.projection.mount(e),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((i,o)=>this.bindToMotionValue(o,i)),ene.current||M1e(),this.shouldReduceMotion=this.reducedMotionConfig==="never"?!1:this.reducedMotionConfig==="always"?!0:IV.current,this.parent&&this.parent.children.add(this),this.update(this.props,this.presenceContext)}unmount(){BY.delete(this.current),this.projection&&this.projection.unmount(),jg(this.notifyUpdate),jg(this.render),this.valueSubscriptions.forEach(e=>e()),this.valueSubscriptions.clear(),this.removeFromVariantTree&&this.removeFromVariantTree(),this.parent&&this.parent.children.delete(this);for(const e in this.events)this.events[e].clear();for(const e in this.features){const i=this.features[e];i&&(i.unmount(),i.isMounted=!1)}this.current=null}bindToMotionValue(e,i){this.valueSubscriptions.has(e)&&this.valueSubscriptions.get(e)();const o=lE.has(e),l=i.on("change",_=>{this.latestValues[e]=_,this.props.onUpdate&&ss.preRender(this.notifyUpdate),o&&this.projection&&(this.projection.isTransformDirty=!0)}),u=i.on("renderRequest",this.scheduleRender);let f;window.MotionCheckAppearSync&&(f=window.MotionCheckAppearSync(this,e,i)),this.valueSubscriptions.set(e,()=>{l(),u(),f&&f(),i.owner&&i.stop()})}sortNodePosition(e){return!this.current||!this.sortInstanceNodePosition||this.type!==e.type?0:this.sortInstanceNodePosition(this.current,e.current)}updateFeatures(){let e="animation";for(e in A0){const i=A0[e];if(!i)continue;const{isEnabled:o,Feature:l}=i;if(!this.features[e]&&l&&o(this.props)&&(this.features[e]=new l(this)),this.features[e]){const u=this.features[e];u.isMounted?u.update():(u.mount(),u.isMounted=!0)}}}triggerBuild(){this.build(this.renderState,this.latestValues,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):to()}getStaticValue(e){return this.latestValues[e]}setStaticValue(e,i){this.latestValues[e]=i}update(e,i){(e.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=e,this.prevPresenceContext=this.presenceContext,this.presenceContext=i;for(let o=0;o<WY.length;o++){const l=WY[o];this.propEventSubscriptions[l]&&(this.propEventSubscriptions[l](),delete this.propEventSubscriptions[l]);const u="on"+l,f=e[u];f&&(this.propEventSubscriptions[l]=this.on(l,f))}this.prevMotionValues=j1e(this,this.scrapeMotionValuesFromProps(e,this.prevProps,this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue(),this.onUpdate&&this.onUpdate(this)}getProps(){return this.props}getVariant(e){return this.props.variants?this.props.variants[e]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}addVariantChild(e){const i=this.getClosestVariantNode();if(i)return i.variantChildren&&i.variantChildren.add(e),()=>i.variantChildren.delete(e)}addValue(e,i){const o=this.values.get(e);i!==o&&(o&&this.removeValue(e),this.bindToMotionValue(e,i),this.values.set(e,i),this.latestValues[e]=i.get())}removeValue(e){this.values.delete(e);const i=this.valueSubscriptions.get(e);i&&(i(),this.valueSubscriptions.delete(e)),delete this.latestValues[e],this.removeValueFromRenderState(e,this.renderState)}hasValue(e){return this.values.has(e)}getValue(e,i){if(this.props.values&&this.props.values[e])return this.props.values[e];let o=this.values.get(e);return o===void 0&&i!==void 0&&(o=UC(i===null?void 0:i,{owner:this}),this.addValue(e,o)),o}readValue(e,i){var o;let l=this.latestValues[e]!==void 0||!this.current?this.latestValues[e]:(o=this.getBaseTargetFromProps(this.props,e))!==null&&o!==void 0?o:this.readValueFromInstance(this.current,e,this.options);return l!=null&&(typeof l=="string"&&(bte(l)||pte(l))?l=parseFloat(l):!V1e(l)&&Fg.test(i)&&(l=Ete(e,i)),this.setBaseTarget(e,ac(l)?l.get():l)),ac(l)?l.get():l}setBaseTarget(e,i){this.baseTarget[e]=i}getBaseTarget(e){var i;const{initial:o}=this.props;let l;if(typeof o=="string"||typeof o=="object"){const f=mF(this.props,o,(i=this.presenceContext)===null||i===void 0?void 0:i.custom);f&&(l=f[e])}if(o&&l!==void 0)return l;const u=this.getBaseTargetFromProps(this.props,e);return u!==void 0&&!ac(u)?u:this.initialValues[e]!==void 0&&l===void 0?void 0:this.baseTarget[e]}on(e,i){return this.events[e]||(this.events[e]=new PF),this.events[e].add(i)}notify(e,...i){this.events[e]&&this.events[e].notify(...i)}}class tne extends F1e{constructor(){super(...arguments),this.KeyframeResolver=Rte}sortInstanceNodePosition(e,i){return e.compareDocumentPosition(i)&2?1:-1}getBaseTargetFromProps(e,i){return e.style?e.style[i]:void 0}removeValueFromRenderState(e,{vars:i,style:o}){delete i[e],delete o[e]}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:e}=this.props;ac(e)&&(this.childSubscription=e.on("change",i=>{this.current&&(this.current.textContent=`${i}`)}))}}function B1e(n){return window.getComputedStyle(n)}class W1e extends tne{constructor(){super(...arguments),this.type="html",this.renderInstance=Wee}readValueFromInstance(e,i){if(lE.has(i)){const o=xF(i);return o&&o.default||0}else{const o=B1e(e),l=(jee(i)?o.getPropertyValue(i):o[i])||0;return typeof l=="string"?l.trim():l}}measureInstanceViewportBox(e,{transformPagePoint:i}){return zte(e,i)}build(e,i,o){yF(e,i,o.transformTemplate)}scrapeMotionValuesFromProps(e,i,o){return bF(e,i,o)}}class z1e extends tne{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1,this.measureInstanceViewportBox=to}getBaseTargetFromProps(e,i){return e[i]}readValueFromInstance(e,i){if(lE.has(i)){const o=xF(i);return o&&o.default||0}return i=zee.has(i)?i:hF(i),e.getAttribute(i)}scrapeMotionValuesFromProps(e,i,o){return $ee(e,i,o)}build(e,i,o){EF(e,i,this.isSVGTag,o.transformTemplate)}renderInstance(e,i,o,l){Gee(e,i,o,l)}mount(e){this.isSVGTag=SF(e.tagName),super.mount(e)}}const G1e=(n,e)=>fF(n)?new z1e(e):new W1e(e,{allowProjection:n!==k.Fragment}),H1e=gPe({...fke,...x1e,...w1e,...L1e},G1e),Ip=kAe(H1e),$1e=(n,e)=>n.find(i=>i.id===e);function zY(n,e){const i=nne(n,e),o=i?n[i].findIndex(l=>l.id===e):-1;return{position:i,index:o}}function nne(n,e){for(const[i,o]of Object.entries(n))if($1e(o,e))return i}function K1e(n){const e=n.includes("right"),i=n.includes("left");let o="center";return e&&(o="flex-end"),i&&(o="flex-start"),{display:"flex",flexDirection:"column",alignItems:o}}function q1e(n){const i=n==="top"||n==="bottom"?"0 auto":void 0,o=n.includes("top")?"env(safe-area-inset-top, 0px)":void 0,l=n.includes("bottom")?"env(safe-area-inset-bottom, 0px)":void 0,u=n.includes("left")?void 0:"env(safe-area-inset-right, 0px)",f=n.includes("right")?void 0:"env(safe-area-inset-left, 0px)";return{position:"fixed",zIndex:"var(--toast-z-index, 5500)",pointerEvents:"none",display:"flex",flexDirection:"column",margin:i,top:o,bottom:l,right:u,left:f}}var Y1e=/^((children|dangerouslySetInnerHTML|key|ref|autoFocus|defaultValue|defaultChecked|innerHTML|suppressContentEditableWarning|suppressHydrationWarning|valueLink|abbr|accept|acceptCharset|accessKey|action|allow|allowUserMedia|allowPaymentRequest|allowFullScreen|allowTransparency|alt|async|autoComplete|autoPlay|capture|cellPadding|cellSpacing|challenge|charSet|checked|cite|classID|className|cols|colSpan|content|contentEditable|contextMenu|controls|controlsList|coords|crossOrigin|data|dateTime|decoding|default|defer|dir|disabled|disablePictureInPicture|disableRemotePlayback|download|draggable|encType|enterKeyHint|fetchpriority|fetchPriority|form|formAction|formEncType|formMethod|formNoValidate|formTarget|frameBorder|headers|height|hidden|high|href|hrefLang|htmlFor|httpEquiv|id|inputMode|integrity|is|keyParams|keyType|kind|label|lang|list|loading|loop|low|marginHeight|marginWidth|max|maxLength|media|mediaGroup|method|min|minLength|multiple|muted|name|nonce|noValidate|open|optimum|pattern|placeholder|playsInline|poster|preload|profile|radioGroup|readOnly|referrerPolicy|rel|required|reversed|role|rows|rowSpan|sandbox|scope|scoped|scrolling|seamless|selected|shape|size|sizes|slot|span|spellCheck|src|srcDoc|srcLang|srcSet|start|step|style|summary|tabIndex|target|title|translate|type|useMap|value|width|wmode|wrap|about|datatype|inlist|prefix|property|resource|typeof|vocab|autoCapitalize|autoCorrect|autoSave|color|incremental|fallback|inert|itemProp|itemScope|itemType|itemID|itemRef|on|option|results|security|unselectable|accentHeight|accumulate|additive|alignmentBaseline|allowReorder|alphabetic|amplitude|arabicForm|ascent|attributeName|attributeType|autoReverse|azimuth|baseFrequency|baselineShift|baseProfile|bbox|begin|bias|by|calcMode|capHeight|clip|clipPathUnits|clipPath|clipRule|colorInterpolation|colorInterpolationFilters|colorProfile|colorRendering|contentScriptType|contentStyleType|cursor|cx|cy|d|decelerate|descent|diffuseConstant|direction|display|divisor|dominantBaseline|dur|dx|dy|edgeMode|elevation|enableBackground|end|exponent|externalResourcesRequired|fill|fillOpacity|fillRule|filter|filterRes|filterUnits|floodColor|floodOpacity|focusable|fontFamily|fontSize|fontSizeAdjust|fontStretch|fontStyle|fontVariant|fontWeight|format|from|fr|fx|fy|g1|g2|glyphName|glyphOrientationHorizontal|glyphOrientationVertical|glyphRef|gradientTransform|gradientUnits|hanging|horizAdvX|horizOriginX|ideographic|imageRendering|in|in2|intercept|k|k1|k2|k3|k4|kernelMatrix|kernelUnitLength|kerning|keyPoints|keySplines|keyTimes|lengthAdjust|letterSpacing|lightingColor|limitingConeAngle|local|markerEnd|markerMid|markerStart|markerHeight|markerUnits|markerWidth|mask|maskContentUnits|maskUnits|mathematical|mode|numOctaves|offset|opacity|operator|order|orient|orientation|origin|overflow|overlinePosition|overlineThickness|panose1|paintOrder|pathLength|patternContentUnits|patternTransform|patternUnits|pointerEvents|points|pointsAtX|pointsAtY|pointsAtZ|preserveAlpha|preserveAspectRatio|primitiveUnits|r|radius|refX|refY|renderingIntent|repeatCount|repeatDur|requiredExtensions|requiredFeatures|restart|result|rotate|rx|ry|scale|seed|shapeRendering|slope|spacing|specularConstant|specularExponent|speed|spreadMethod|startOffset|stdDeviation|stemh|stemv|stitchTiles|stopColor|stopOpacity|strikethroughPosition|strikethroughThickness|string|stroke|strokeDasharray|strokeDashoffset|strokeLinecap|strokeLinejoin|strokeMiterlimit|strokeOpacity|strokeWidth|surfaceScale|systemLanguage|tableValues|targetX|targetY|textAnchor|textDecoration|textRendering|textLength|to|transform|u1|u2|underlinePosition|underlineThickness|unicode|unicodeBidi|unicodeRange|unitsPerEm|vAlphabetic|vHanging|vIdeographic|vMathematical|values|vectorEffect|version|vertAdvY|vertOriginX|vertOriginY|viewBox|viewTarget|visibility|widths|wordSpacing|writingMode|x|xHeight|x1|x2|xChannelSelector|xlinkActuate|xlinkArcrole|xlinkHref|xlinkRole|xlinkShow|xlinkTitle|xlinkType|xmlBase|xmlns|xmlnsXlink|xmlLang|xmlSpace|y|y1|y2|yChannelSelector|z|zoomAndPan|for|class|autofocus)|(([Dd][Aa][Tt][Aa]|[Aa][Rr][Ii][Aa]|x)-.*))$/,X1e=yee(function(n){return Y1e.test(n)||n.charCodeAt(0)===111&&n.charCodeAt(1)===110&&n.charCodeAt(2)<91}),J1e=X1e,Q1e=function(e){return e!=="theme"},GY=function(e){return typeof e=="string"&&e.charCodeAt(0)>96?J1e:Q1e},HY=function(e,i,o){var l;if(i){var u=i.shouldForwardProp;l=e.__emotion_forwardProp&&u?function(f){return e.__emotion_forwardProp(f)&&u(f)}:u}return typeof l!="function"&&o&&(l=e.__emotion_forwardProp),l},Z1e=function(e){var i=e.cache,o=e.serialized,l=e.isStringTag;return Xj(i,o,l),wee(function(){return Jj(i,o,l)}),null},eNe=function n(e,i){var o=e.__emotion_real===e,l=o&&e.__emotion_base||e,u,f;i!==void 0&&(u=i.label,f=i.target);var _=HY(e,i,o),E=_||GY(l),b=!E("as");return function(){var C=arguments,I=o&&e.__emotion_styles!==void 0?e.__emotion_styles.slice(0):[];if(u!==void 0&&I.push("label:"+u+";"),C[0]==null||C[0].raw===void 0)I.push.apply(I,C);else{var P=C[0];I.push(P[0]);for(var L=C.length,M=1;M<L;M++)I.push(C[M],P[M])}var F=Zj(function(B,Z,K){var re=b&&B.as||l,ae="",ne=[],pe=B;if(B.theme==null){pe={};for(var X in B)pe[X]=B[X];pe.theme=k.useContext(R0)}typeof B.className=="string"?ae=vee(Z.registered,ne,B.className):B.className!=null&&(ae=B.className+" ");var J=B1(I.concat(ne),Z.registered,pe);ae+=Z.key+"-"+J.name,f!==void 0&&(ae+=" "+f);var Y=b&&_===void 0?GY(re):E,ie={};for(var le in B)b&&le==="as"||Y(le)&&(ie[le]=B[le]);return ie.className=ae,K&&(ie.ref=K),k.createElement(k.Fragment,null,k.createElement(Z1e,{cache:Z,serialized:J,isStringTag:typeof re=="string"}),k.createElement(re,ie))});return F.displayName=u!==void 0?u:"Styled("+(typeof l=="string"?l:l.displayName||l.name||"Component")+")",F.defaultProps=e.defaultProps,F.__emotion_real=F,F.__emotion_base=l,F.__emotion_styles=I,F.__emotion_forwardProp=_,Object.defineProperty(F,"toString",{value:function(){return"."+f}}),F.withComponent=function(B,Z){var K=n(B,Xy({},i,Z,{shouldForwardProp:HY(F,Z,!0)}));return K.apply(void 0,I)},F}},tNe=["a","abbr","address","area","article","aside","audio","b","base","bdi","bdo","big","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","data","datalist","dd","del","details","dfn","dialog","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","iframe","img","input","ins","kbd","keygen","label","legend","li","link","main","map","mark","marquee","menu","menuitem","meta","meter","nav","noscript","object","ol","optgroup","option","output","p","param","picture","pre","progress","q","rp","rt","ruby","s","samp","script","section","select","small","source","span","strong","style","sub","summary","sup","table","tbody","td","textarea","tfoot","th","thead","time","title","tr","track","u","ul","var","video","wbr","circle","clipPath","defs","ellipse","foreignObject","g","image","line","linearGradient","mask","path","pattern","polygon","polyline","radialGradient","rect","stop","svg","text","tspan"],AV=eNe.bind(null);tNe.forEach(function(n){AV[n]=AV(n)});const nNe=new Set([...bSe,"textStyle","layerStyle","apply","noOfLines","focusBorderColor","errorBorderColor","as","__css","css","sx"]),rNe=new Set(["htmlWidth","htmlHeight","htmlSize","htmlTranslate"]);function iNe(n){return(rNe.has(n)||!nNe.has(n))&&n[0]!=="_"}const sNe=XEe(AV),oNe=({baseStyle:n})=>e=>{const{theme:i,css:o,__css:l,sx:u,...f}=e,[_]=rve(f,TSe),E=gl(n,e),b=MEe({},l,E,N1(_),u),C=JZ(b)(e.theme);return o?[C,o]:C};function lU(n,e){const{baseStyle:i,...o}=e??{};o.shouldForwardProp||(o.shouldForwardProp=iNe);const l=oNe({baseStyle:i}),u=sNe(n,o)(l);return k.forwardRef(function(E,b){const{children:C,...I}=E,{colorMode:P,forced:L}=z1(),M=L?P:void 0;return k.createElement(u,{ref:b,"data-theme":M,...I},C)})}function aNe(){const n=new Map;return new Proxy(lU,{apply(e,i,o){return lU(...o)},get(e,i){return n.has(i)||n.set(i,lU(i)),n.get(i)}})}const Ut=aNe(),cNe={initial:n=>{const{position:e}=n,i=["top","bottom"].includes(e)?"y":"x";let o=["top-right","bottom-right"].includes(e)?1:-1;return e==="bottom"&&(o=1),{opacity:0,[i]:o*24}},animate:{opacity:1,y:0,x:0,scale:1,transition:{duration:.4,ease:[.4,0,.2,1]}},exit:{opacity:0,scale:.85,transition:{duration:.2,ease:[.4,0,1,1]}}},rne=k.memo(n=>{const{id:e,message:i,onCloseComplete:o,onRequestRemove:l,requestClose:u=!1,position:f="bottom",duration:_=5e3,containerStyle:E,motionVariants:b=cNe,toastSpacing:C="0.5rem"}=n,[I,P]=k.useState(_),L=bAe();Xf(()=>{L||o==null||o()},[L]),Xf(()=>{P(_)},[_]);const M=()=>P(null),F=()=>P(_),B=()=>{L&&l()};k.useEffect(()=>{L&&u&&l()},[L,u,l]),Rve(B,I);const Z=k.useMemo(()=>({pointerEvents:"auto",maxWidth:560,minWidth:300,margin:C,...E}),[E,C]),K=k.useMemo(()=>K1e(f),[f]);return S.jsx(Ip.div,{layout:!0,className:"chakra-toast",variants:b,initial:"initial",animate:"animate",exit:"exit",onHoverStart:M,onHoverEnd:F,custom:{position:f},style:K,children:S.jsx(Ut.div,{role:"status","aria-atomic":"true",className:"chakra-toast__inner",__css:Z,children:gl(i,{id:e,onClose:B})})})});rne.displayName="ToastComponent";function Bt(n){return k.forwardRef(n)}var uU,$Y;function lNe(){if($Y)return uU;$Y=1;var n=typeof Element<"u",e=typeof Map=="function",i=typeof Set=="function",o=typeof ArrayBuffer=="function"&&!!ArrayBuffer.isView;function l(u,f){if(u===f)return!0;if(u&&f&&typeof u=="object"&&typeof f=="object"){if(u.constructor!==f.constructor)return!1;var _,E,b;if(Array.isArray(u)){if(_=u.length,_!=f.length)return!1;for(E=_;E--!==0;)if(!l(u[E],f[E]))return!1;return!0}var C;if(e&&u instanceof Map&&f instanceof Map){if(u.size!==f.size)return!1;for(C=u.entries();!(E=C.next()).done;)if(!f.has(E.value[0]))return!1;for(C=u.entries();!(E=C.next()).done;)if(!l(E.value[1],f.get(E.value[0])))return!1;return!0}if(i&&u instanceof Set&&f instanceof Set){if(u.size!==f.size)return!1;for(C=u.entries();!(E=C.next()).done;)if(!f.has(E.value[0]))return!1;return!0}if(o&&ArrayBuffer.isView(u)&&ArrayBuffer.isView(f)){if(_=u.length,_!=f.length)return!1;for(E=_;E--!==0;)if(u[E]!==f[E])return!1;return!0}if(u.constructor===RegExp)return u.source===f.source&&u.flags===f.flags;if(u.valueOf!==Object.prototype.valueOf&&typeof u.valueOf=="function"&&typeof f.valueOf=="function")return u.valueOf()===f.valueOf();if(u.toString!==Object.prototype.toString&&typeof u.toString=="function"&&typeof f.toString=="function")return u.toString()===f.toString();if(b=Object.keys(u),_=b.length,_!==Object.keys(f).length)return!1;for(E=_;E--!==0;)if(!Object.prototype.hasOwnProperty.call(f,b[E]))return!1;if(n&&u instanceof Element)return!1;for(E=_;E--!==0;)if(!((b[E]==="_owner"||b[E]==="__v"||b[E]==="__o")&&u.$$typeof)&&!l(u[b[E]],f[b[E]]))return!1;return!0}return u!==u&&f!==f}return uU=function(f,_){try{return l(f,_)}catch(E){if((E.message||"").match(/stack|recursion/i))return console.warn("react-fast-compare cannot handle circular refs"),!1;throw E}},uU}var uNe=lNe();const dNe=Yg(uNe);function Z0(){const n=k.useContext(R0);if(!n)throw Error("useTheme: `theme` is undefined. Seems you forgot to wrap your app in `<ChakraProvider />` or `<ThemeProvider />`");return n}function ine(){const n=z1(),e=Z0();return{...n,theme:e}}function hNe(n,e,i){if(e==null)return e;const o=l=>{var u,f;return(f=(u=n.__cssMap)==null?void 0:u[l])==null?void 0:f.value};return o(e)??o(i)??i}function pNe(n,e,i){const o=Array.isArray(e)?e:[e],l=Array.isArray(i)?i:[i];return u=>{const f=l.filter(Boolean),_=o.map((E,b)=>{const C=`${n}.${E}`;return hNe(u,C,f[b]??E)});return Array.isArray(e)?_:_[0]}}function sne(n,e={}){const{styleConfig:i,...o}=e,{theme:l,colorMode:u}=ine(),f=n?DZ(l,`components.${n}`):void 0,_=i||f,E=sp({theme:l,colorMode:u},(_==null?void 0:_.defaultProps)??{},N1(q0(o,["children"])),(C,I)=>C?void 0:I),b=k.useRef({});if(_){const I=LSe(_)(E);dNe(b.current,I)||(b.current=I)}return b.current}function nu(n,e={}){return sne(n,e)}function xa(n,e={}){return sne(n,e)}const KY={path:S.jsxs("g",{stroke:"currentColor",strokeWidth:"1.5",children:[S.jsx("path",{strokeLinecap:"round",fill:"none",d:"M9,9a3,3,0,1,1,4,2.829,1.5,1.5,0,0,0-1,1.415V14.25"}),S.jsx("path",{fill:"currentColor",strokeLinecap:"round",d:"M12,17.25a.375.375,0,1,0,.375.375A.375.375,0,0,0,12,17.25h0"}),S.jsx("circle",{fill:"none",strokeMiterlimit:"10",cx:"12",cy:"12",r:"11.25"})]}),viewBox:"0 0 24 24"},vn=Bt((n,e)=>{const{as:i,viewBox:o,color:l="currentColor",focusable:u=!1,children:f,className:_,__css:E,...b}=n,C=fn("chakra-icon",_),I=nu("Icon",n),P={w:"1em",h:"1em",display:"inline-block",lineHeight:"1em",flexShrink:0,color:l,...E,...I},L={ref:e,focusable:u,className:C,__css:P},M=o??KY.viewBox;if(i&&typeof i!="string")return S.jsx(Ut.svg,{as:i,...L,...b});const F=f??KY.path;return S.jsx(Ut.svg,{verticalAlign:"middle",viewBox:M,...L,...b,children:F})});vn.displayName="Icon";function fNe(n){return S.jsx(vn,{viewBox:"0 0 24 24",...n,children:S.jsx("path",{fill:"currentColor",d:"M12,0A12,12,0,1,0,24,12,12.014,12.014,0,0,0,12,0Zm6.927,8.2-6.845,9.289a1.011,1.011,0,0,1-1.43.188L5.764,13.769a1,1,0,1,1,1.25-1.562l4.076,3.261,6.227-8.451A1,1,0,1,1,18.927,8.2Z"})})}function mNe(n){return S.jsx(vn,{viewBox:"0 0 24 24",...n,children:S.jsx("path",{fill:"currentColor",d:"M12,0A12,12,0,1,0,24,12,12.013,12.013,0,0,0,12,0Zm.25,5a1.5,1.5,0,1,1-1.5,1.5A1.5,1.5,0,0,1,12.25,5ZM14.5,18.5h-4a1,1,0,0,1,0-2h.75a.25.25,0,0,0,.25-.25v-4.5a.25.25,0,0,0-.25-.25H10.5a1,1,0,0,1,0-2h1a2,2,0,0,1,2,2v4.75a.25.25,0,0,0,.25.25h.75a1,1,0,1,1,0,2Z"})})}function qY(n){return S.jsx(vn,{viewBox:"0 0 24 24",...n,children:S.jsx("path",{fill:"currentColor",d:"M11.983,0a12.206,12.206,0,0,0-8.51,3.653A11.8,11.8,0,0,0,0,12.207,11.779,11.779,0,0,0,11.8,24h.214A12.111,12.111,0,0,0,24,11.791h0A11.766,11.766,0,0,0,11.983,0ZM10.5,16.542a1.476,1.476,0,0,1,1.449-1.53h.027a1.527,1.527,0,0,1,1.523,1.47,1.475,1.475,0,0,1-1.449,1.53h-.027A1.529,1.529,0,0,1,10.5,16.542ZM11,12.5v-6a1,1,0,0,1,2,0v6a1,1,0,1,1-2,0Z"})})}const gNe=uR({"0%":{transform:"rotate(0deg)"},"100%":{transform:"rotate(360deg)"}}),nd=Bt((n,e)=>{const i=nu("Spinner",n),{label:o="Loading...",thickness:l="2px",speed:u="0.45s",emptyColor:f="transparent",className:_,...E}=Mi(n),b=fn("chakra-spinner",_),C={display:"inline-block",borderColor:"currentColor",borderStyle:"solid",borderRadius:"99999px",borderWidth:l,borderBottomColor:f,borderLeftColor:f,animation:`${gNe} ${u} linear infinite`,...i};return S.jsx(Ut.div,{ref:e,__css:C,className:b,...E,children:o&&S.jsx(Ut.span,{srOnly:!0,children:o})})});nd.displayName="Spinner";const[_Ne,jF]=Ii({name:"AlertContext",hookName:"useAlertContext",providerName:"<Alert />"}),[yNe,FF]=Ii({name:"AlertStylesContext",hookName:"useAlertStyles",providerName:"<Alert />"}),one={info:{icon:mNe,colorScheme:"blue"},warning:{icon:qY,colorScheme:"orange"},success:{icon:fNe,colorScheme:"green"},error:{icon:qY,colorScheme:"red"},loading:{icon:nd,colorScheme:"blue"}};function ENe(n){return one[n].colorScheme}function vNe(n){return one[n].icon}const op=Bt(function(e,i){const{status:o="info",addRole:l=!0,...u}=Mi(e),f=e.colorScheme??ENe(o),_=xa("Alert",{...e,colorScheme:f}),E={width:"100%",display:"flex",alignItems:"center",position:"relative",overflow:"hidden",..._.container};return S.jsx(_Ne,{value:{status:o},children:S.jsx(yNe,{value:_,children:S.jsx(Ut.div,{"data-status":o,role:l?"alert":void 0,ref:i,...u,className:fn("chakra-alert",e.className),__css:E})})})});op.displayName="Alert";function ap(n){const{status:e}=jF(),i=vNe(e),o=FF(),l=e==="loading"?o.spinner:o.icon;return S.jsx(Ut.span,{display:"inherit","data-status":e,...n,className:fn("chakra-alert__icon",n.className),__css:l,children:n.children||S.jsx(i,{h:"100%",w:"100%"})})}ap.displayName="AlertIcon";const n0=Bt(function(e,i){const o=FF(),{status:l}=jF();return S.jsx(Ut.div,{ref:i,"data-status":l,...e,className:fn("chakra-alert__title",e.className),__css:o.title})});n0.displayName="AlertTitle";const r0=Bt(function(e,i){const{status:o}=jF(),l=FF(),u={display:"inline",...l.description};return S.jsx(Ut.div,{ref:i,"data-status":o,...e,className:fn("chakra-alert__desc",e.className),__css:u})});r0.displayName="AlertDescription";function SNe(n){return S.jsx(vn,{focusable:"false","aria-hidden":!0,...n,children:S.jsx("path",{fill:"currentColor",d:"M.439,21.44a1.5,1.5,0,0,0,2.122,2.121L11.823,14.3a.25.25,0,0,1,.354,0l9.262,9.263a1.5,1.5,0,1,0,2.122-2.121L14.3,12.177a.25.25,0,0,1,0-.354l9.263-9.262A1.5,1.5,0,0,0,21.439.44L12.177,9.7a.25.25,0,0,1-.354,0L2.561.44A1.5,1.5,0,0,0,.439,2.561L9.7,11.823a.25.25,0,0,1,0,.354Z"})})}const BF=Bt(function(e,i){const o=nu("CloseButton",e),{children:l,isDisabled:u,__css:f,..._}=Mi(e),E={outline:0,display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0};return S.jsx(Ut.button,{type:"button","aria-label":"Close",ref:i,disabled:u,__css:{...E,...o,...f},..._,children:l||S.jsx(SNe,{width:"1em",height:"1em"})})});BF.displayName="CloseButton";const bNe=n=>{const{status:e,variant:i="solid",id:o,title:l,isClosable:u,onClose:f,description:_,colorScheme:E,icon:b}=n,C=o?{root:`toast-${o}`,title:`toast-${o}-title`,description:`toast-${o}-description`}:void 0;return S.jsxs(op,{addRole:!1,status:e,variant:i,id:C==null?void 0:C.root,alignItems:"start",borderRadius:"md",boxShadow:"lg",paddingEnd:8,textAlign:"start",width:"auto",colorScheme:E,children:[S.jsx(ap,{children:b}),S.jsxs(Ut.div,{flex:"1",maxWidth:"100%",children:[l&&S.jsx(n0,{id:C==null?void 0:C.title,children:l}),_&&S.jsx(r0,{id:C==null?void 0:C.description,display:"block",children:_})]}),u&&S.jsx(BF,{size:"sm",onClick:f,position:"absolute",insetEnd:1,top:1})]})};function ane(n={}){const{render:e,toastComponent:i=bNe}=n;return l=>typeof e=="function"?e({...l,...n}):S.jsx(i,{...l,...n})}const wNe={top:[],"top-left":[],"top-right":[],"bottom-left":[],bottom:[],"bottom-right":[]},np=TNe(wNe);function TNe(n){let e=n;const i=new Set,o=l=>{e=l(e),i.forEach(u=>u())};return{getState:()=>e,subscribe:l=>(i.add(l),()=>{o(()=>n),i.delete(l)}),removeToast:(l,u)=>{o(f=>({...f,[u]:f[u].filter(_=>_.id!=l)}))},notify:(l,u)=>{const f=CNe(l,u),{position:_,id:E}=f;return o(b=>{const I=_.includes("top")?[f,...b[_]??[]]:[...b[_]??[],f];return{...b,[_]:I}}),E},update:(l,u)=>{l&&o(f=>{const _={...f},{position:E,index:b}=zY(_,l);return E&&b!==-1&&(_[E][b]={..._[E][b],...u,message:ane(u)}),_})},closeAll:({positions:l}={})=>{o(u=>(l??["bottom","bottom-right","bottom-left","top","top-left","top-right"]).reduce((E,b)=>(E[b]=u[b].map(C=>({...C,requestClose:!0})),E),{...u}))},close:l=>{o(u=>{const f=nne(u,l);return f?{...u,[f]:u[f].map(_=>_.id==l?{..._,requestClose:!0}:_)}:u})},isActive:l=>!!zY(np.getState(),l).position}}let YY=0;function CNe(n,e={}){YY+=1;const i=e.id??YY,o=e.position??"bottom";return{id:i,message:n,position:o,duration:e.duration,onCloseComplete:e.onCloseComplete,onRequestRemove:()=>np.removeToast(String(i),o),status:e.status,requestClose:!1,containerStyle:e.containerStyle}}var cne=TZ();const[lne,RNe]=Ii({strict:!1,name:"PortalContext"}),WF="chakra-portal",INe=".chakra-portal",ANe=n=>S.jsx("div",{className:"chakra-portal-zIndex",style:{position:"absolute",zIndex:n.zIndex,top:0,left:0,right:0},children:n.children}),PNe=n=>{const{appendToParentPortal:e,children:i}=n,[o,l]=k.useState(null),u=k.useRef(null),[,f]=k.useState({});k.useEffect(()=>f({}),[]);const _=RNe(),E=mAe();dp(()=>{if(!o)return;const C=o.ownerDocument,I=e?_??C.body:C.body;if(!I)return;u.current=C.createElement("div"),u.current.className=WF,I.appendChild(u.current),f({});const P=u.current;return()=>{I.contains(P)&&I.removeChild(P)}},[o]);const b=E!=null&&E.zIndex?S.jsx(ANe,{zIndex:E==null?void 0:E.zIndex,children:i}):i;return u.current?cne.createPortal(S.jsx(lne,{value:u.current,children:b}),u.current):S.jsx("span",{ref:C=>{C&&l(C)}})},ONe=n=>{const{children:e,containerRef:i,appendToParentPortal:o}=n,l=i.current,u=l??(typeof window<"u"?document.body:void 0),f=k.useMemo(()=>{const E=l==null?void 0:l.ownerDocument.createElement("div");return E&&(E.className=WF),E},[l]),[,_]=k.useState({});return dp(()=>_({}),[]),dp(()=>{if(!(!f||!u))return u.appendChild(f),()=>{u.removeChild(f)}},[f,u]),u&&f?cne.createPortal(S.jsx(lne,{value:o?f:null,children:e}),f):null};function ru(n){const e={appendToParentPortal:!0,...n},{containerRef:i,...o}=e;return i?S.jsx(ONe,{containerRef:i,...o}):S.jsx(PNe,{...o})}ru.className=WF;ru.selector=INe;ru.displayName="Portal";const[kNe,NNe]=Ii({name:"ToastOptionsContext",strict:!1}),DNe=n=>{const e=k.useSyncExternalStore(np.subscribe,np.getState,np.getState),{motionVariants:i,component:o=rne,portalProps:l,animatePresenceProps:u}=n,_=Object.keys(e).map(E=>{const b=e[E];return S.jsx("div",{role:"region","aria-live":"polite","aria-label":`Notifications-${E}`,id:`chakra-toast-manager-${E}`,style:q1e(E),children:S.jsx(X0,{...u,initial:!1,children:b.map(C=>S.jsx(o,{motionVariants:i,...C},C.id))})},E)});return S.jsx(ru,{...l,children:_})},xNe=n=>function({children:i,theme:o=n,toastOptions:l,...u}){return S.jsxs(_Ae,{theme:o,...u,children:[S.jsx(kNe,{value:l==null?void 0:l.defaultOptions,children:i}),S.jsx(DNe,{...l})]})},Y1=xNe(aIe);function XY(n){return n.sort((e,i)=>{const o=e.compareDocumentPosition(i);if(o&Node.DOCUMENT_POSITION_FOLLOWING||o&Node.DOCUMENT_POSITION_CONTAINED_BY)return-1;if(o&Node.DOCUMENT_POSITION_PRECEDING||o&Node.DOCUMENT_POSITION_CONTAINS)return 1;if(o&Node.DOCUMENT_POSITION_DISCONNECTED||o&Node.DOCUMENT_POSITION_IMPLEMENTATION_SPECIFIC)throw Error("Cannot sort the given nodes.");return 0})}const LNe=n=>typeof n=="object"&&"nodeType"in n&&n.nodeType===Node.ELEMENT_NODE;function JY(n,e,i){let o=n+1;return i&&o>=e&&(o=0),o}function QY(n,e,i){let o=n-1;return i&&o<0&&(o=e),o}const dU=typeof window<"u"?k.useLayoutEffect:k.useEffect,ZY=n=>n;var MNe=Object.defineProperty,UNe=(n,e,i)=>e in n?MNe(n,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):n[e]=i,js=(n,e,i)=>(UNe(n,typeof e!="symbol"?e+"":e,i),i);class VNe{constructor(){js(this,"descendants",new Map),js(this,"register",e=>{if(e!=null)return LNe(e)?this.registerNode(e):i=>{this.registerNode(i,e)}}),js(this,"unregister",e=>{this.descendants.delete(e);const i=XY(Array.from(this.descendants.keys()));this.assignIndex(i)}),js(this,"destroy",()=>{this.descendants.clear()}),js(this,"assignIndex",e=>{this.descendants.forEach(i=>{const o=e.indexOf(i.node);i.index=o,i.node.dataset.index=i.index.toString()})}),js(this,"count",()=>this.descendants.size),js(this,"enabledCount",()=>this.enabledValues().length),js(this,"values",()=>Array.from(this.descendants.values()).sort((i,o)=>i.index-o.index)),js(this,"enabledValues",()=>this.values().filter(e=>!e.disabled)),js(this,"item",e=>{if(this.count()!==0)return this.values()[e]}),js(this,"enabledItem",e=>{if(this.enabledCount()!==0)return this.enabledValues()[e]}),js(this,"first",()=>this.item(0)),js(this,"firstEnabled",()=>this.enabledItem(0)),js(this,"last",()=>this.item(this.descendants.size-1)),js(this,"lastEnabled",()=>{const e=this.enabledValues().length-1;return this.enabledItem(e)}),js(this,"indexOf",e=>{var i;return e?((i=this.descendants.get(e))==null?void 0:i.index)??-1:-1}),js(this,"enabledIndexOf",e=>e==null?-1:this.enabledValues().findIndex(i=>i.node.isSameNode(e))),js(this,"next",(e,i=!0)=>{const o=JY(e,this.count(),i);return this.item(o)}),js(this,"nextEnabled",(e,i=!0)=>{const o=this.item(e);if(!o)return;const l=this.enabledIndexOf(o.node),u=JY(l,this.enabledCount(),i);return this.enabledItem(u)}),js(this,"prev",(e,i=!0)=>{const o=QY(e,this.count()-1,i);return this.item(o)}),js(this,"prevEnabled",(e,i=!0)=>{const o=this.item(e);if(!o)return;const l=this.enabledIndexOf(o.node),u=QY(l,this.enabledCount()-1,i);return this.enabledItem(u)}),js(this,"registerNode",(e,i)=>{if(!e||this.descendants.has(e))return;const o=Array.from(this.descendants.keys()).concat(e),l=XY(o);i!=null&&i.disabled&&(i.disabled=!!i.disabled);const u={node:e,index:-1,...i};this.descendants.set(e,u),this.assignIndex(l)})}}function une(){const[n,e]=Ii({name:"DescendantsProvider",errorMessage:"useDescendantsContext must be used within DescendantsProvider"});return[n,e,()=>{const l=k.useRef(new VNe);return dU(()=>()=>l.current.destroy()),l.current},l=>{const u=e(),[f,_]=k.useState(-1),E=k.useRef(null);dU(()=>()=>{E.current&&u.unregister(E.current)},[]),dU(()=>{if(!E.current)return;const C=Number(E.current.dataset.index);f!=C&&!Number.isNaN(C)&&_(C)});const b=ZY(l?u.register(l):u.register);return{descendants:u,index:f,enabledIndex:u.enabledIndexOf(E.current),register:zi(b,E)}}]}const eX={easeIn:[.4,0,1,1],easeOut:[0,0,.2,1]},Wy={enter:{duration:.2,ease:eX.easeOut},exit:{duration:.1,ease:eX.easeIn}},zy={enter:(n,e)=>({...n,delay:typeof e=="number"?e:e==null?void 0:e.enter}),exit:(n,e)=>({...n,delay:typeof e=="number"?e:e==null?void 0:e.exit})},dne=Bt(function(n,e){const{ratio:i=4/3,children:o,className:l,...u}=n,f=k.Children.only(o),_=fn("chakra-aspect-ratio",l);return S.jsx(Ut.div,{ref:e,position:"relative",className:_,_before:{height:0,content:'""',display:"block",paddingBottom:D1(i,E=>`${1/E*100}%`)},__css:{"& > *:not(style)":{overflow:"hidden",position:"absolute",top:"0",right:"0",bottom:"0",left:"0",display:"flex",justifyContent:"center",alignItems:"center",width:"100%",height:"100%"},"& > img, & > video":{objectFit:"cover"}},...u,children:f})});dne.displayName="AspectRatio";const[jNe,FNe]=Ii({name:"AvatarStylesContext",hookName:"useAvatarStyles",providerName:"<Avatar/>"});function BNe(n){const e=n.trim().split(" "),i=e[0]??"",o=e.length>1?e[e.length-1]:"";return i&&o?`${i.charAt(0)}${o.charAt(0)}`:i.charAt(0)}function hne(n){const{name:e,getInitials:i,...o}=n,l=FNe();return S.jsx(Ut.div,{role:"img","aria-label":e,...o,__css:l.label,children:e?i==null?void 0:i(e):null})}hne.displayName="AvatarName";const pne=n=>S.jsxs(Ut.svg,{viewBox:"0 0 128 128",color:"#fff",width:"100%",height:"100%",className:"chakra-avatar__svg",...n,children:[S.jsx("path",{fill:"currentColor",d:"M103,102.1388 C93.094,111.92 79.3504,118 64.1638,118 C48.8056,118 34.9294,111.768 25,101.7892 L25,95.2 C25,86.8096 31.981,80 40.6,80 L87.4,80 C96.019,80 103,86.8096 103,95.2 L103,102.1388 Z"}),S.jsx("path",{fill:"currentColor",d:"M63.9961647,24 C51.2938136,24 41,34.2938136 41,46.9961647 C41,59.7061864 51.2938136,70 63.9961647,70 C76.6985159,70 87,59.7061864 87,46.9961647 C87,34.2938136 76.6985159,24 63.9961647,24"})]});function fne(n){const{loading:e,src:i,srcSet:o,onLoad:l,onError:u,crossOrigin:f,sizes:_,ignoreFallback:E}=n,[b,C]=k.useState("pending");k.useEffect(()=>{C(i?"loading":"pending")},[i]);const I=k.useRef(null),P=k.useCallback(()=>{if(!i)return;L();const M=new Image;M.src=i,f&&(M.crossOrigin=f),o&&(M.srcset=o),_&&(M.sizes=_),e&&(M.loading=e),M.onload=F=>{L(),C("loaded"),l==null||l(F)},M.onerror=F=>{L(),C("failed"),u==null||u(F)},I.current=M},[i,f,o,_,l,u,e]),L=()=>{I.current&&(I.current.onload=null,I.current.onerror=null,I.current=null)};return dp(()=>{if(!E)return b==="loading"&&P(),()=>{L()}},[b,P,E]),E?"loaded":b}const WNe=(n,e)=>n!=="loaded"&&e==="beforeLoadOrError"||n==="failed"&&e==="onError";function mne(n){const{src:e,srcSet:i,onError:o,onLoad:l,getInitials:u,name:f,borderRadius:_,loading:E,iconLabel:b,icon:C=S.jsx(pne,{}),ignoreFallback:I,referrerPolicy:P,crossOrigin:L}=n,F=fne({src:e,onError:o,crossOrigin:L,ignoreFallback:I})==="loaded";return!e||!F?f?S.jsx(hne,{className:"chakra-avatar__initials",getInitials:u,name:f}):k.cloneElement(C,{role:"img","aria-label":b}):S.jsx(Ut.img,{src:e,srcSet:i,alt:f??b,onLoad:l,referrerPolicy:P,crossOrigin:L??void 0,className:"chakra-avatar__img",loading:E,__css:{width:"100%",height:"100%",objectFit:"cover",borderRadius:_}})}mne.displayName="AvatarImage";const zNe={display:"inline-flex",alignItems:"center",justifyContent:"center",textAlign:"center",textTransform:"uppercase",fontWeight:"medium",position:"relative",flexShrink:0},eu=Bt((n,e)=>{const i=xa("Avatar",n),[o,l]=k.useState(!1),{src:u,srcSet:f,name:_,showBorder:E,borderRadius:b="full",onError:C,onLoad:I,getInitials:P=BNe,icon:L=S.jsx(pne,{}),iconLabel:M=" avatar",loading:F,children:B,borderColor:Z,ignoreFallback:K,crossOrigin:re,referrerPolicy:ae,...ne}=Mi(n),pe={borderRadius:b,borderWidth:E?"2px":void 0,...zNe,...i.container};return Z&&(pe.borderColor=Z),S.jsx(Ut.span,{ref:e,...ne,className:fn("chakra-avatar",n.className),"data-loaded":nr(o),__css:pe,children:S.jsxs(jNe,{value:i,children:[S.jsx(mne,{src:u,srcSet:f,loading:F,onLoad:Nn(I,()=>{l(!0)}),onError:C,getInitials:P,name:_,borderRadius:b,icon:L,iconLabel:M,ignoreFallback:K,crossOrigin:re,referrerPolicy:ae}),B]})})});eu.displayName="Avatar";const Vf=Bt(function(e,i){const o=nu("Badge",e),{className:l,...u}=Mi(e);return S.jsx(Ut.span,{ref:i,className:fn("chakra-badge",e.className),...u,__css:{display:"inline-block",whiteSpace:"nowrap",verticalAlign:"middle",...o}})});Vf.displayName="Badge";const ct=Ut("div");ct.displayName="Box";const[OHe,GNe]=Ii({strict:!1,name:"ButtonGroupContext"});function eC(n){const{children:e,className:i,...o}=n,l=k.isValidElement(e)?k.cloneElement(e,{"aria-hidden":!0,focusable:!1}):e,u=fn("chakra-button__icon",i);return S.jsx(Ut.span,{display:"inline-flex",alignSelf:"center",flexShrink:0,...o,className:u,children:l})}eC.displayName="ButtonIcon";function PV(n){const{label:e,placement:i,spacing:o="0.5rem",children:l=S.jsx(nd,{color:"currentColor",width:"1em",height:"1em"}),className:u,__css:f,..._}=n,E=fn("chakra-button__spinner",u),b=i==="start"?"marginEnd":"marginStart",C=k.useMemo(()=>({display:"flex",alignItems:"center",position:e?"relative":"absolute",[b]:e?o:0,fontSize:"1em",lineHeight:"normal",...f}),[f,e,b,o]);return S.jsx(Ut.div,{className:E,..._,__css:C,children:l})}PV.displayName="ButtonSpinner";function HNe(n){const[e,i]=k.useState(!n);return{ref:k.useCallback(u=>{u&&i(u.tagName==="BUTTON")},[]),type:e?"button":void 0}}const jn=Bt((n,e)=>{const i=GNe(),o=nu("Button",{...i,...n}),{isDisabled:l=i==null?void 0:i.isDisabled,isLoading:u,isActive:f,children:_,leftIcon:E,rightIcon:b,loadingText:C,iconSpacing:I="0.5rem",type:P,spinner:L,spinnerPlacement:M="start",className:F,as:B,shouldWrapChildren:Z,...K}=Mi(n),re=k.useMemo(()=>{const X={...o==null?void 0:o._focus,zIndex:1};return{display:"inline-flex",appearance:"none",alignItems:"center",justifyContent:"center",userSelect:"none",position:"relative",whiteSpace:"nowrap",verticalAlign:"middle",outline:"none",...o,...!!i&&{_focus:X}}},[o,i]),{ref:ae,type:ne}=HNe(B),pe={rightIcon:b,leftIcon:E,iconSpacing:I,children:_,shouldWrapChildren:Z};return S.jsxs(Ut.button,{disabled:l||u,ref:Cve(e,ae),as:B,type:P??ne,"data-active":nr(f),"data-loading":nr(u),__css:re,className:fn("chakra-button",F),...K,children:[u&&M==="start"&&S.jsx(PV,{className:"chakra-button__spinner--start",label:C,placement:"start",spacing:I,children:L}),u?C||S.jsx(Ut.span,{opacity:0,children:S.jsx(tX,{...pe})}):S.jsx(tX,{...pe}),u&&M==="end"&&S.jsx(PV,{className:"chakra-button__spinner--end",label:C,placement:"end",spacing:I,children:L})]})});jn.displayName="Button";function tX(n){const{leftIcon:e,rightIcon:i,children:o,iconSpacing:l,shouldWrapChildren:u}=n;return u?S.jsxs("span",{style:{display:"contents"},children:[e&&S.jsx(eC,{marginEnd:l,children:e}),o,i&&S.jsx(eC,{marginStart:l,children:i})]}):S.jsxs(S.Fragment,{children:[e&&S.jsx(eC,{marginEnd:l,children:e}),o,i&&S.jsx(eC,{marginStart:l,children:i})]})}const Do=Bt((n,e)=>{const{icon:i,children:o,isRound:l,"aria-label":u,...f}=n,_=i||o,E=k.isValidElement(_)?k.cloneElement(_,{"aria-hidden":!0,focusable:!1}):null;return S.jsx(jn,{px:"0",py:"0",borderRadius:l?"full":void 0,ref:e,"aria-label":u,...f,children:E})});Do.displayName="IconButton";const gne=Ut("div",{baseStyle:{display:"flex",alignItems:"center",justifyContent:"center"}});gne.displayName="Center";const $Ne={horizontal:{insetStart:"50%",transform:"translateX(-50%)"},vertical:{top:"50%",transform:"translateY(-50%)"},both:{insetStart:"50%",top:"50%",transform:"translate(-50%, -50%)"}};Bt(function(e,i){const{axis:o="both",...l}=e;return S.jsx(Ut.div,{ref:i,__css:$Ne[o],...l,position:"absolute"})});var KNe=()=>typeof document<"u",nX=!1,gR=null,Jy=!1,OV=!1,kV=new Set;function zF(n,e){kV.forEach(i=>i(n,e))}var qNe=typeof window<"u"&&window.navigator!=null?/^Mac/.test(window.navigator.platform):!1;function YNe(n){return!(n.metaKey||!qNe&&n.altKey||n.ctrlKey||n.key==="Control"||n.key==="Shift"||n.key==="Meta")}function rX(n){Jy=!0,YNe(n)&&(gR="keyboard",zF("keyboard",n))}function NS(n){if(gR="pointer",n.type==="mousedown"||n.type==="pointerdown"){Jy=!0;const e=n.composedPath?n.composedPath()[0]:n.target;let i=!1;try{i=e.matches(":focus-visible")}catch{}if(i)return;zF("pointer",n)}}function XNe(n){return n.mozInputSource===0&&n.isTrusted?!0:n.detail===0&&!n.pointerType}function JNe(n){XNe(n)&&(Jy=!0,gR="virtual")}function QNe(n){n.target===window||n.target===document||n.target instanceof Element&&n.target.hasAttribute("tabindex")||(!Jy&&!OV&&(gR="virtual",zF("virtual",n)),Jy=!1,OV=!1)}function ZNe(){Jy=!1,OV=!0}function iX(){return gR!=="pointer"}function eDe(){if(!KNe()||nX)return;const{focus:n}=HTMLElement.prototype;HTMLElement.prototype.focus=function(...i){Jy=!0,n.apply(this,i)},document.addEventListener("keydown",rX,!0),document.addEventListener("keyup",rX,!0),document.addEventListener("click",JNe,!0),window.addEventListener("focus",QNe,!0),window.addEventListener("blur",ZNe,!1),typeof PointerEvent<"u"?(document.addEventListener("pointerdown",NS,!0),document.addEventListener("pointermove",NS,!0),document.addEventListener("pointerup",NS,!0)):(document.addEventListener("mousedown",NS,!0),document.addEventListener("mousemove",NS,!0),document.addEventListener("mouseup",NS,!0)),nX=!0}function tDe(n){eDe(),n(iX());const e=()=>n(iX());return kV.add(e),()=>{kV.delete(e)}}const[nDe,_ne]=Ii({name:"FormControlStylesContext",errorMessage:`useFormControlStyles returned is 'undefined'. Seems you forgot to wrap the components in "<FormControl />" `}),[rDe,eb]=Ii({strict:!1,name:"FormControlContext"});function iDe(n){const{id:e,isRequired:i,isInvalid:o,isDisabled:l,isReadOnly:u,...f}=n,_=k.useId(),E=e||`field-${_}`,b=`${E}-label`,C=`${E}-feedback`,I=`${E}-helptext`,[P,L]=k.useState(!1),[M,F]=k.useState(!1),[B,Z]=k.useState(!1),K=k.useCallback((X={},J=null)=>({id:I,...X,ref:zi(J,Y=>{Y&&F(!0)})}),[I]),re=k.useCallback((X={},J=null)=>({...X,ref:J,"data-focus":nr(B),"data-disabled":nr(l),"data-invalid":nr(o),"data-readonly":nr(u),id:X.id!==void 0?X.id:b,htmlFor:X.htmlFor!==void 0?X.htmlFor:E}),[E,l,B,o,u,b]),ae=k.useCallback((X={},J=null)=>({id:C,...X,ref:zi(J,Y=>{Y&&L(!0)}),"aria-live":"polite"}),[C]),ne=k.useCallback((X={},J=null)=>({...X,...f,ref:J,role:"group","data-focus":nr(B),"data-disabled":nr(l),"data-invalid":nr(o),"data-readonly":nr(u)}),[f,l,B,o,u]),pe=k.useCallback((X={},J=null)=>({...X,ref:J,role:"presentation","aria-hidden":!0,children:X.children||"*"}),[]);return{isRequired:!!i,isInvalid:!!o,isReadOnly:!!u,isDisabled:!!l,isFocused:!!B,onFocus:()=>Z(!0),onBlur:()=>Z(!1),hasFeedbackText:P,setHasFeedbackText:L,hasHelpText:M,setHasHelpText:F,id:E,labelId:b,feedbackId:C,helpTextId:I,htmlProps:f,getHelpTextProps:K,getErrorMessageProps:ae,getRootProps:ne,getLabelProps:re,getRequiredIndicatorProps:pe}}const ur=Bt(function(e,i){const o=xa("Form",e),l=Mi(e),{getRootProps:u,htmlProps:f,..._}=iDe(l),E=fn("chakra-form-control",e.className);return S.jsx(rDe,{value:_,children:S.jsx(nDe,{value:o,children:S.jsx(Ut.div,{...u({},i),className:E,__css:o.container})})})});ur.displayName="FormControl";const Gy=Bt(function(e,i){const o=eb(),l=_ne(),u=fn("chakra-form__helper-text",e.className);return S.jsx(Ut.div,{...o==null?void 0:o.getHelpTextProps(e,i),__css:l.helperText,className:u})});Gy.displayName="FormHelperText";function GF(n){const{isDisabled:e,isInvalid:i,isReadOnly:o,isRequired:l,...u}=HF(n);return{...u,disabled:e,readOnly:o,required:l,"aria-invalid":zf(i),"aria-required":zf(l),"aria-readonly":zf(o)}}function HF(n){const e=eb(),{id:i,disabled:o,readOnly:l,required:u,isRequired:f,isInvalid:_,isReadOnly:E,isDisabled:b,onFocus:C,onBlur:I,...P}=n,L=n["aria-describedby"]?[n["aria-describedby"]]:[];return e!=null&&e.hasFeedbackText&&(e!=null&&e.isInvalid)&&L.push(e.feedbackId),e!=null&&e.hasHelpText&&L.push(e.helpTextId),{...P,"aria-describedby":L.join(" ")||void 0,id:i??(e==null?void 0:e.id),isDisabled:o??b??(e==null?void 0:e.isDisabled),isReadOnly:l??E??(e==null?void 0:e.isReadOnly),isRequired:u??f??(e==null?void 0:e.isRequired),isInvalid:_??(e==null?void 0:e.isInvalid),onFocus:Nn(e==null?void 0:e.onFocus,C),onBlur:Nn(e==null?void 0:e.onBlur,I)}}const sDe={border:"0",clip:"rect(0, 0, 0, 0)",height:"1px",width:"1px",margin:"-1px",padding:"0",overflow:"hidden",whiteSpace:"nowrap",position:"absolute"};function oDe(n={}){const e=HF(n),{isDisabled:i,isReadOnly:o,isRequired:l,isInvalid:u,id:f,onBlur:_,onFocus:E,"aria-describedby":b}=e,{defaultChecked:C,isChecked:I,isFocusable:P,onChange:L,isIndeterminate:M,name:F,value:B,tabIndex:Z=void 0,"aria-label":K,"aria-labelledby":re,"aria-invalid":ae,...ne}=n,pe=q0(ne,["isDisabled","isReadOnly","isRequired","isInvalid","id","onBlur","onFocus","aria-describedby"]),X=ro(L),J=ro(_),Y=ro(E),[ie,le]=k.useState(!1),[de,ue]=k.useState(!1),[Oe,Ve]=k.useState(!1),[xe,Re]=k.useState(!1);k.useEffect(()=>tDe(le),[]);const ve=k.useRef(null),[be,We]=k.useState(!0),[Pe,Te]=k.useState(!!C),ke=I!==void 0,Ue=ke?I:Pe,Be=k.useCallback(Lt=>{if(o||i){Lt.preventDefault();return}ke||Te(Ue?Lt.currentTarget.checked:M?!0:Lt.currentTarget.checked),X==null||X(Lt)},[o,i,Ue,ke,M,X]);dp(()=>{ve.current&&(ve.current.indeterminate=!!M)},[M]),Xf(()=>{i&&ue(!1)},[i,ue]),dp(()=>{const Lt=ve.current;if(!(Lt!=null&&Lt.form))return;const Xt=()=>{Te(!!C)};return Lt.form.addEventListener("reset",Xt),()=>{var $t;return($t=Lt.form)==null?void 0:$t.removeEventListener("reset",Xt)}},[]);const qe=i&&!P,$e=k.useCallback(Lt=>{Lt.key===" "&&Re(!0)},[Re]),st=k.useCallback(Lt=>{Lt.key===" "&&Re(!1)},[Re]);dp(()=>{if(!ve.current)return;ve.current.checked!==Ue&&Te(ve.current.checked)},[ve.current]);const Je=k.useCallback((Lt={},Xt=null)=>{const $t=we=>{de&&we.preventDefault(),Re(!0)};return{...Lt,ref:Xt,"data-active":nr(xe),"data-hover":nr(Oe),"data-checked":nr(Ue),"data-focus":nr(de),"data-focus-visible":nr(de&&ie),"data-indeterminate":nr(M),"data-disabled":nr(i),"data-invalid":nr(u),"data-readonly":nr(o),"aria-hidden":!0,onMouseDown:Nn(Lt.onMouseDown,$t),onMouseUp:Nn(Lt.onMouseUp,()=>Re(!1)),onMouseEnter:Nn(Lt.onMouseEnter,()=>Ve(!0)),onMouseLeave:Nn(Lt.onMouseLeave,()=>Ve(!1))}},[xe,Ue,i,de,ie,Oe,M,u,o]),Rt=k.useCallback((Lt={},Xt=null)=>({...Lt,ref:Xt,"data-active":nr(xe),"data-hover":nr(Oe),"data-checked":nr(Ue),"data-focus":nr(de),"data-focus-visible":nr(de&&ie),"data-indeterminate":nr(M),"data-disabled":nr(i),"data-invalid":nr(u),"data-readonly":nr(o)}),[xe,Ue,i,de,ie,Oe,M,u,o]),kt=k.useCallback((Lt={},Xt=null)=>({...pe,htmlFor:be?f:void 0,...Lt,ref:zi(Xt,$t=>{$t&&We($t.tagName==="LABEL")}),onClick:Nn(Lt.onClick,()=>{var $t;be||(($t=ve.current)==null||$t.click(),requestAnimationFrame(()=>{var we;(we=ve.current)==null||we.focus({preventScroll:!0})}))}),"data-disabled":nr(i),"data-checked":nr(Ue),"data-invalid":nr(u)}),[pe,i,Ue,u,be,f]),He=k.useCallback((Lt={},Xt=null)=>({...Lt,ref:zi(ve,Xt),type:"checkbox",name:F,value:B,id:f,tabIndex:Z,onChange:Nn(Lt.onChange,Be),onBlur:Nn(Lt.onBlur,J,()=>ue(!1)),onFocus:Nn(Lt.onFocus,Y,()=>ue(!0)),onKeyDown:Nn(Lt.onKeyDown,$e),onKeyUp:Nn(Lt.onKeyUp,st),required:l,checked:Ue,disabled:qe,readOnly:o,"aria-label":K,"aria-labelledby":re,"aria-invalid":ae?!!ae:u,"aria-describedby":b,"aria-disabled":i,"aria-checked":M?"mixed":Ue,style:sDe}),[F,B,f,Z,Be,J,Y,$e,st,l,Ue,qe,o,K,re,ae,u,b,i,M]),ut=k.useCallback((Lt={},Xt=null)=>({...Lt,ref:Xt,onMouseDown:Nn(Lt.onMouseDown,aDe),"data-disabled":nr(i),"data-checked":nr(Ue),"data-invalid":nr(u)}),[Ue,i,u]);return{state:{isInvalid:u,isFocused:de,isChecked:Ue,isActive:xe,isHovered:Oe,isIndeterminate:M,isDisabled:i,isReadOnly:o,isRequired:l},getRootProps:kt,getCheckboxProps:Je,getIndicatorProps:Rt,getInputProps:He,getLabelProps:ut,htmlProps:pe}}function aDe(n){n.preventDefault(),n.stopPropagation()}const NV=Bt(function(e,i){const{className:o,centerContent:l,...u}=Mi(e),f=nu("Container",e);return S.jsx(Ut.div,{ref:i,className:fn("chakra-container",o),...u,__css:{...f,...l&&{display:"flex",flexDirection:"column",alignItems:"center"}}})});NV.displayName="Container";const gp=Bt(function(e,i){const{borderLeftWidth:o,borderBottomWidth:l,borderTopWidth:u,borderRightWidth:f,borderWidth:_,borderStyle:E,borderColor:b,...C}=nu("Divider",e),{className:I,orientation:P="horizontal",__css:L,...M}=Mi(e),F={vertical:{borderLeftWidth:o||f||_||"1px",height:"100%"},horizontal:{borderBottomWidth:l||u||_||"1px",width:"100%"}};return S.jsx(Ut.hr,{ref:i,"aria-orientation":P,...M,__css:{...C,border:"0",borderColor:b,borderStyle:E,...F[P],...L},className:fn("chakra-divider",I)})});gp.displayName="Divider";const Cr=Bt(function(e,i){const{direction:o,align:l,justify:u,wrap:f,basis:_,grow:E,shrink:b,...C}=e,I={display:"flex",flexDirection:o,alignItems:l,justifyContent:u,flexWrap:f,flexBasis:_,flexGrow:E,flexShrink:b};return S.jsx(Ut.div,{ref:i,__css:I,...C})});Cr.displayName="Flex";function cDe(n,e){if(n==null)return{};var i={};for(var o in n)if({}.hasOwnProperty.call(n,o)){if(e.indexOf(o)!==-1)continue;i[o]=n[o]}return i}var hU={exports:{}},pU,sX;function lDe(){if(sX)return pU;sX=1;var n="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";return pU=n,pU}var fU,oX;function uDe(){if(oX)return fU;oX=1;var n=lDe();function e(){}function i(){}return i.resetWarningCache=e,fU=function(){function o(f,_,E,b,C,I){if(I!==n){var P=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw P.name="Invariant Violation",P}}o.isRequired=o;function l(){return o}var u={array:o,bigint:o,bool:o,func:o,number:o,object:o,string:o,symbol:o,any:o,arrayOf:l,element:o,elementType:o,instanceOf:l,node:o,objectOf:l,oneOf:l,oneOfType:l,shape:l,exact:l,checkPropTypes:i,resetWarningCache:e};return u.PropTypes=u,u},fU}var aX;function dDe(){return aX||(aX=1,hU.exports=uDe()()),hU.exports}var hDe=dDe();const yn=Yg(hDe);var DV="data-focus-lock",yne="data-focus-lock-disabled",pDe="data-no-focus-lock",fDe="data-autofocus-inside",mDe="data-no-autofocus";function mU(n,e){return typeof n=="function"?n(e):n&&(n.current=e),n}function gDe(n,e){var i=k.useState(function(){return{value:n,callback:e,facade:{get current(){return i.value},set current(o){var l=i.value;l!==o&&(i.value=o,i.callback(o,l))}}}})[0];return i.callback=e,i.facade}var _De=typeof window<"u"?k.useLayoutEffect:k.useEffect,cX=new WeakMap;function Ene(n,e){var i=gDe(null,function(o){return n.forEach(function(l){return mU(l,o)})});return _De(function(){var o=cX.get(i);if(o){var l=new Set(o),u=new Set(n),f=i.current;l.forEach(function(_){u.has(_)||mU(_,null)}),u.forEach(function(_){l.has(_)||mU(_,f)})}cX.set(i,n)},[n]),i}var gU={width:"1px",height:"0px",padding:0,overflow:"hidden",position:"fixed",top:"1px",left:"1px"},rp=function(){return rp=Object.assign||function(e){for(var i,o=1,l=arguments.length;o<l;o++){i=arguments[o];for(var u in i)Object.prototype.hasOwnProperty.call(i,u)&&(e[u]=i[u])}return e},rp.apply(this,arguments)};function _R(n,e){var i={};for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&e.indexOf(o)<0&&(i[o]=n[o]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var l=0,o=Object.getOwnPropertySymbols(n);l<o.length;l++)e.indexOf(o[l])<0&&Object.prototype.propertyIsEnumerable.call(n,o[l])&&(i[o[l]]=n[o[l]]);return i}function yDe(n,e,i){if(i||arguments.length===2)for(var o=0,l=e.length,u;o<l;o++)(u||!(o in e))&&(u||(u=Array.prototype.slice.call(e,0,o)),u[o]=e[o]);return n.concat(u||Array.prototype.slice.call(e))}function vne(n){return n}function Sne(n,e){e===void 0&&(e=vne);var i=[],o=!1,l={read:function(){if(o)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return i.length?i[i.length-1]:n},useMedium:function(u){var f=e(u,o);return i.push(f),function(){i=i.filter(function(_){return _!==f})}},assignSyncMedium:function(u){for(o=!0;i.length;){var f=i;i=[],f.forEach(u)}i={push:function(_){return u(_)},filter:function(){return i}}},assignMedium:function(u){o=!0;var f=[];if(i.length){var _=i;i=[],_.forEach(u),f=i}var E=function(){var C=f;f=[],C.forEach(u)},b=function(){return Promise.resolve().then(E)};b(),i={push:function(C){f.push(C),b()},filter:function(C){return f=f.filter(C),i}}}};return l}function $F(n,e){return e===void 0&&(e=vne),Sne(n,e)}function bne(n){n===void 0&&(n={});var e=Sne(null);return e.options=rp({async:!0,ssr:!1},n),e}var wne=function(n){var e=n.sideCar,i=_R(n,["sideCar"]);if(!e)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var o=e.read();if(!o)throw new Error("Sidecar medium not found");return k.createElement(o,rp({},i))};wne.isSideCarExport=!0;function EDe(n,e){return n.useMedium(e),wne}var Tne=$F({},function(n){var e=n.target,i=n.currentTarget;return{target:e,currentTarget:i}}),Cne=$F(),vDe=$F(),SDe=bne({async:!0,ssr:typeof document<"u"}),bDe=k.createContext(void 0),wDe=[],KF=k.forwardRef(function(e,i){var o,l=k.useState(),u=l[0],f=l[1],_=k.useRef(),E=k.useRef(!1),b=k.useRef(null),C=k.useState({}),I=C[1],P=e.children,L=e.disabled,M=L===void 0?!1:L,F=e.noFocusGuards,B=F===void 0?!1:F,Z=e.persistentFocus,K=Z===void 0?!1:Z,re=e.crossFrame,ae=re===void 0?!0:re,ne=e.autoFocus,pe=ne===void 0?!0:ne;e.allowTextSelection;var X=e.group,J=e.className,Y=e.whiteList,ie=e.hasPositiveIndices,le=e.shards,de=le===void 0?wDe:le,ue=e.as,Oe=ue===void 0?"div":ue,Ve=e.lockProps,xe=Ve===void 0?{}:Ve,Re=e.sideCar,ve=e.returnFocus,be=ve===void 0?!1:ve,We=e.focusOptions,Pe=e.onActivation,Te=e.onDeactivation,ke=k.useState({}),Ue=ke[0],Be=k.useCallback(function(Xt){var $t=Xt.captureFocusRestore;if(!b.current){var we,je=(we=document)==null?void 0:we.activeElement;b.current=je,je!==document.body&&(b.current=$t(je))}_.current&&Pe&&Pe(_.current),E.current=!0,I()},[Pe]),qe=k.useCallback(function(){E.current=!1,Te&&Te(_.current),I()},[Te]),$e=k.useCallback(function(Xt){var $t=b.current;if($t){var we=(typeof $t=="function"?$t():$t)||document.body,je=typeof be=="function"?be(we):be;if(je){var Ke=typeof je=="object"?je:void 0;b.current=null,Xt?Promise.resolve().then(function(){return we.focus(Ke)}):we.focus(Ke)}}},[be]),st=k.useCallback(function(Xt){E.current&&Tne.useMedium(Xt)},[]),Je=Cne.useMedium,Rt=k.useCallback(function(Xt){_.current!==Xt&&(_.current=Xt,f(Xt))},[]),kt=Xy((o={},o[yne]=M&&"disabled",o[DV]=X,o),xe),He=B!==!0,ut=He&&B!=="tail",mt=Ene([i,Rt]),Lt=k.useMemo(function(){return{observed:_,shards:de,enabled:!M,active:E.current}},[M,E.current,de,u]);return gi.createElement(k.Fragment,null,He&&[gi.createElement("div",{key:"guard-first","data-focus-guard":!0,tabIndex:M?-1:0,style:gU}),ie?gi.createElement("div",{key:"guard-nearest","data-focus-guard":!0,tabIndex:M?-1:1,style:gU}):null],!M&&gi.createElement(Re,{id:Ue,sideCar:SDe,observed:u,disabled:M,persistentFocus:K,crossFrame:ae,autoFocus:pe,whiteList:Y,shards:de,onActivation:Be,onDeactivation:qe,returnFocus:$e,focusOptions:We,noFocusGuards:B}),gi.createElement(Oe,Xy({ref:mt},kt,{className:J,onBlur:Je,onFocus:st}),gi.createElement(bDe.Provider,{value:Lt},P)),ut&&gi.createElement("div",{"data-focus-guard":!0,tabIndex:M?-1:0,style:gU}))});KF.propTypes={};function xV(n,e){return xV=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(i,o){return i.__proto__=o,i},xV(n,e)}function TDe(n,e){n.prototype=Object.create(e.prototype),n.prototype.constructor=n,xV(n,e)}function FC(n){"@babel/helpers - typeof";return FC=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},FC(n)}function CDe(n,e){if(FC(n)!="object"||!n)return n;var i=n[Symbol.toPrimitive];if(i!==void 0){var o=i.call(n,e);if(FC(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(n)}function RDe(n){var e=CDe(n,"string");return FC(e)=="symbol"?e:e+""}function IDe(n,e,i){return(e=RDe(e))in n?Object.defineProperty(n,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):n[e]=i,n}function ADe(n,e){function i(o){return o.displayName||o.name||"Component"}return function(l){var u=[],f;function _(){f=n(u.map(function(b){return b.props})),e(f)}var E=function(b){TDe(C,b);function C(){return b.apply(this,arguments)||this}C.peek=function(){return f};var I=C.prototype;return I.componentDidMount=function(){u.push(this),_()},I.componentDidUpdate=function(){_()},I.componentWillUnmount=function(){var L=u.indexOf(this);u.splice(L,1),_()},I.render=function(){return gi.createElement(l,this.props)},C}(k.PureComponent);return IDe(E,"displayName","SideEffect("+i(l)+")"),E}}var Ap=function(n){for(var e=Array(n.length),i=0;i<n.length;++i)e[i]=n[i];return e},Qy=function(n){return Array.isArray(n)?n:[n]},Rne=function(n){return Array.isArray(n)?n[0]:n},PDe=function(n){if(n.nodeType!==Node.ELEMENT_NODE)return!1;var e=window.getComputedStyle(n,null);return!e||!e.getPropertyValue?!1:e.getPropertyValue("display")==="none"||e.getPropertyValue("visibility")==="hidden"},Ine=function(n){return n.parentNode&&n.parentNode.nodeType===Node.DOCUMENT_FRAGMENT_NODE?n.parentNode.host:n.parentNode},Ane=function(n){return n===document||n&&n.nodeType===Node.DOCUMENT_NODE},ODe=function(n){return n.hasAttribute("inert")},kDe=function(n,e){return!n||Ane(n)||!PDe(n)&&!ODe(n)&&e(Ine(n))},Pne=function(n,e){var i=n.get(e);if(i!==void 0)return i;var o=kDe(e,Pne.bind(void 0,n));return n.set(e,o),o},NDe=function(n,e){return n&&!Ane(n)?LDe(n)?e(Ine(n)):!1:!0},One=function(n,e){var i=n.get(e);if(i!==void 0)return i;var o=NDe(e,One.bind(void 0,n));return n.set(e,o),o},kne=function(n){return n.dataset},DDe=function(n){return n.tagName==="BUTTON"},Nne=function(n){return n.tagName==="INPUT"},Dne=function(n){return Nne(n)&&n.type==="radio"},xDe=function(n){return!((Nne(n)||DDe(n))&&(n.type==="hidden"||n.disabled))},LDe=function(n){var e=n.getAttribute(mDe);return![!0,"true",""].includes(e)},qF=function(n){var e;return!!(n&&(!((e=kne(n))===null||e===void 0)&&e.focusGuard))},LV=function(n){return!qF(n)},MDe=function(n){return!!n},UDe=function(n,e){var i=Math.max(0,n.tabIndex),o=Math.max(0,e.tabIndex),l=i-o,u=n.index-e.index;if(l){if(!i)return 1;if(!o)return-1}return l||u},VDe=function(n){return n.tabIndex<0&&!n.hasAttribute("tabindex")?0:n.tabIndex},YF=function(n,e,i){return Ap(n).map(function(o,l){var u=VDe(o);return{node:o,index:l,tabIndex:i&&u===-1?(o.dataset||{}).focusGuard?0:-1:u}}).filter(function(o){return!e||o.tabIndex>=0}).sort(UDe)},jDe=["button:enabled","select:enabled","textarea:enabled","input:enabled","a[href]","area[href]","summary","iframe","object","embed","audio[controls]","video[controls]","[tabindex]","[contenteditable]","[autofocus]"],XF=jDe.join(","),FDe="".concat(XF,", [data-focus-guard]"),xne=function(n,e){return Ap((n.shadowRoot||n).children).reduce(function(i,o){return i.concat(o.matches(e?FDe:XF)?[o]:[],xne(o))},[])},BDe=function(n,e){var i;return n instanceof HTMLIFrameElement&&(!((i=n.contentDocument)===null||i===void 0)&&i.body)?O0([n.contentDocument.body],e):[n]},O0=function(n,e){return n.reduce(function(i,o){var l,u=xne(o,e),f=(l=[]).concat.apply(l,u.map(function(_){return BDe(_,e)}));return i.concat(f,o.parentNode?Ap(o.parentNode.querySelectorAll(XF)).filter(function(_){return _===o}):[])},[])},WDe=function(n){var e=n.querySelectorAll("[".concat(fDe,"]"));return Ap(e).map(function(i){return O0([i])}).reduce(function(i,o){return i.concat(o)},[])},JF=function(n,e){return Ap(n).filter(function(i){return Pne(e,i)}).filter(function(i){return xDe(i)})},lX=function(n,e){return e===void 0&&(e=new Map),Ap(n).filter(function(i){return One(e,i)})},QF=function(n,e,i){return YF(JF(O0(n,i),e),!0,i)},BC=function(n,e){return YF(JF(O0(n),e),!1)},zDe=function(n,e){return JF(WDe(n),e)},Hy=function(n,e){return n.shadowRoot?Hy(n.shadowRoot,e):Object.getPrototypeOf(n).contains!==void 0&&Object.getPrototypeOf(n).contains.call(n,e)?!0:Ap(n.children).some(function(i){var o;if(i instanceof HTMLIFrameElement){var l=(o=i.contentDocument)===null||o===void 0?void 0:o.body;return l?Hy(l,e):!1}return Hy(i,e)})},GDe=function(n){for(var e=new Set,i=n.length,o=0;o<i;o+=1)for(var l=o+1;l<i;l+=1){var u=n[o].compareDocumentPosition(n[l]);(u&Node.DOCUMENT_POSITION_CONTAINED_BY)>0&&e.add(l),(u&Node.DOCUMENT_POSITION_CONTAINS)>0&&e.add(o)}return n.filter(function(f,_){return!e.has(_)})},Lne=function(n){return n.parentNode?Lne(n.parentNode):n},ZF=function(n){var e=Qy(n);return e.filter(Boolean).reduce(function(i,o){var l=o.getAttribute(DV);return i.push.apply(i,l?GDe(Ap(Lne(o).querySelectorAll("[".concat(DV,'="').concat(l,'"]:not([').concat(yne,'="disabled"])')))):[o]),i},[])},HDe=function(n){try{return n()}catch{return}},WC=function(n){if(n===void 0&&(n=document),!(!n||!n.activeElement)){var e=n.activeElement;return e.shadowRoot?WC(e.shadowRoot):e instanceof HTMLIFrameElement&&HDe(function(){return e.contentWindow.document})?WC(e.contentWindow.document):e}},$De=function(n,e){return n===e},KDe=function(n,e){return!!Ap(n.querySelectorAll("iframe")).some(function(i){return $De(i,e)})},Mne=function(n,e){return e===void 0&&(e=WC(Rne(n).ownerDocument)),!e||e.dataset&&e.dataset.focusGuard?!1:ZF(n).some(function(i){return Hy(i,e)||KDe(i,e)})},qDe=function(n){n===void 0&&(n=document);var e=WC(n);return e?Ap(n.querySelectorAll("[".concat(pDe,"]"))).some(function(i){return Hy(i,e)}):!1},YDe=function(n,e){return e.filter(Dne).filter(function(i){return i.name===n.name}).filter(function(i){return i.checked})[0]||n},e4=function(n,e){return Dne(n)&&n.name?YDe(n,e):n},XDe=function(n){var e=new Set;return n.forEach(function(i){return e.add(e4(i,n))}),n.filter(function(i){return e.has(i)})},uX=function(n){return n[0]&&n.length>1?e4(n[0],n):n[0]},dX=function(n,e){return n.indexOf(e4(e,n))},MV="NEW_FOCUS",JDe=function(n,e,i,o,l){var u=n.length,f=n[0],_=n[u-1],E=qF(o);if(!(o&&n.indexOf(o)>=0)){var b=o!==void 0?i.indexOf(o):-1,C=l?i.indexOf(l):b,I=l?n.indexOf(l):-1;if(b===-1)return I!==-1?I:MV;if(I===-1)return MV;var P=b-C,L=i.indexOf(f),M=i.indexOf(_),F=XDe(i),B=o!==void 0?F.indexOf(o):-1,Z=l?F.indexOf(l):B,K=F.filter(function(J){return J.tabIndex>=0}),re=o!==void 0?K.indexOf(o):-1,ae=l?K.indexOf(l):re,ne=re>=0&&ae>=0?ae-re:Z-B;if(!P&&I>=0||e.length===0)return I;var pe=dX(n,e[0]),X=dX(n,e[e.length-1]);if(b<=L&&E&&Math.abs(P)>1)return X;if(b>=M&&E&&Math.abs(P)>1)return pe;if(P&&Math.abs(ne)>1)return I;if(b<=L)return X;if(b>M)return pe;if(P)return Math.abs(P)>1?I:(u+I+P)%u}},QDe=function(n){return function(e){var i,o=(i=kne(e))===null||i===void 0?void 0:i.autofocus;return e.autofocus||o!==void 0&&o!=="false"||n.indexOf(e)>=0}},hX=function(n,e,i){var o=n.map(function(u){var f=u.node;return f}),l=lX(o.filter(QDe(i)));return l&&l.length?uX(l):uX(lX(e))},UV=function(n,e){return e===void 0&&(e=[]),e.push(n),n.parentNode&&UV(n.parentNode.host||n.parentNode,e),e},_U=function(n,e){for(var i=UV(n),o=UV(e),l=0;l<i.length;l+=1){var u=i[l];if(o.indexOf(u)>=0)return u}return!1},Une=function(n,e,i){var o=Qy(n),l=Qy(e),u=o[0],f=!1;return l.filter(Boolean).forEach(function(_){f=_U(f||_,_)||f,i.filter(Boolean).forEach(function(E){var b=_U(u,E);b&&(!f||Hy(b,f)?f=b:f=_U(b,f))})}),f},pX=function(n,e){return n.reduce(function(i,o){return i.concat(zDe(o,e))},[])},ZDe=function(n,e){var i=new Map;return e.forEach(function(o){return i.set(o.node,o)}),n.map(function(o){return i.get(o)}).filter(MDe)},exe=function(n,e){var i=WC(Qy(n).length>0?document:Rne(n).ownerDocument),o=ZF(n).filter(LV),l=Une(i||n,n,o),u=new Map,f=BC(o,u),_=f.filter(function(M){var F=M.node;return LV(F)});if(_[0]){var E=BC([l],u).map(function(M){var F=M.node;return F}),b=ZDe(E,_),C=b.map(function(M){var F=M.node;return F}),I=b.filter(function(M){var F=M.tabIndex;return F>=0}).map(function(M){var F=M.node;return F}),P=JDe(C,I,E,i,e);if(P===MV){var L=hX(f,I,pX(o,u))||hX(f,C,pX(o,u));if(L)return{node:L};console.warn("focus-lock: cannot find any node to move focus into");return}return P===void 0?P:b[P]}},txe=function(n){var e=ZF(n).filter(LV),i=Une(n,n,e),o=YF(O0([i],!0),!0,!0),l=O0(e,!1);return o.map(function(u){var f=u.node,_=u.index;return{node:f,index:_,lockItem:l.indexOf(f)>=0,guard:qF(f)}})},t4=function(n,e){n&&("focus"in n&&n.focus(e),"contentWindow"in n&&n.contentWindow&&n.contentWindow.focus())},yU=0,EU=!1,Vne=function(n,e,i){i===void 0&&(i={});var o=exe(n,e);if(!EU&&o){if(yU>2){console.error("FocusLock: focus-fighting detected. Only one focus management system could be active. See https://github.com/theKashey/focus-lock/#focus-fighting"),EU=!0,setTimeout(function(){EU=!1},1);return}yU++,t4(o.node,i.focusOptions),yU--}};function PT(n){if(!n)return null;if(typeof WeakRef>"u")return function(){return n||null};var e=n?new WeakRef(n):null;return function(){return(e==null?void 0:e.deref())||null}}var nxe=function(n){if(!n)return null;for(var e=[],i=n;i&&i!==document.body;)e.push({current:PT(i),parent:PT(i.parentElement),left:PT(i.previousElementSibling),right:PT(i.nextElementSibling)}),i=i.parentElement;return{element:PT(n),stack:e,ownerDocument:n.ownerDocument}},rxe=function(n){var e,i,o,l,u;if(n)for(var f=n.stack,_=n.ownerDocument,E=new Map,b=0,C=f;b<C.length;b++){var I=C[b],P=(e=I.parent)===null||e===void 0?void 0:e.call(I);if(P&&_.contains(P)){for(var L=(i=I.left)===null||i===void 0?void 0:i.call(I),M=I.current(),F=P.contains(M)?M:void 0,B=(o=I.right)===null||o===void 0?void 0:o.call(I),Z=QF([P],E),K=(u=(l=F??(L==null?void 0:L.nextElementSibling))!==null&&l!==void 0?l:B)!==null&&u!==void 0?u:L;K;){for(var re=0,ae=Z;re<ae.length;re++){var ne=ae[re];if(K!=null&&K.contains(ne.node))return ne.node}K=K.nextElementSibling}if(Z.length)return Z[0].node}}},jne=function(n){var e=nxe(n);return function(){return rxe(e)}},ixe=function(n,e,i){if(!n||!e)return console.error("no element or scope given"),{};var o=Qy(e);if(o.every(function(f){return!Hy(f,n)}))return console.error("Active element is not contained in the scope"),{};var l=i?QF(o,new Map):BC(o,new Map),u=l.findIndex(function(f){var _=f.node;return _===n});if(u!==-1)return{prev:l[u-1],next:l[u+1],first:l[0],last:l[l.length-1]}},sxe=function(n,e){var i=e?QF(Qy(n),new Map):BC(Qy(n),new Map);return{first:i[0],last:i[i.length-1]}},oxe=function(n){return Object.assign({scope:document.body,cycle:!0,onlyTabbable:!0},n)},Fne=function(n,e,i){e===void 0&&(e={});var o=oxe(e),l=ixe(n,o.scope,o.onlyTabbable);if(l){var u=i(l,o.cycle);u&&t4(u.node,o.focusOptions)}},axe=function(n,e){e===void 0&&(e={}),Fne(n,e,function(i,o){var l=i.next,u=i.first;return l||o&&u})},cxe=function(n,e){e===void 0&&(e={}),Fne(n,e,function(i,o){var l=i.prev,u=i.last;return l||o&&u})},Bne=function(n,e,i){var o,l=sxe(n,(o=e.onlyTabbable)!==null&&o!==void 0?o:!0),u=l[i];u&&t4(u.node,e.focusOptions)},lxe=function(n,e){e===void 0&&(e={}),Bne(n,e,"first")},uxe=function(n,e){e===void 0&&(e={}),Bne(n,e,"last")};function n4(n){setTimeout(n,1)}var dxe=function(e){return e&&"current"in e?e.current:e},Wne=function(){return document&&document.activeElement===document.body},hxe=function(){return Wne()||qDe()},f0=null,dl=null,fX=function(){return null},m0=null,zC=!1,r4=!1,pxe=function(){return!0},fxe=function(e){return(f0.whiteList||pxe)(e)},mxe=function(e,i){m0={observerNode:e,portaledElement:i}},gxe=function(e){return m0&&m0.portaledElement===e};function mX(n,e,i,o){var l=null,u=n;do{var f=o[u];if(f.guard)f.node.dataset.focusAutoGuard&&(l=f);else if(f.lockItem){if(u!==n)return;l=null}else break}while((u+=i)!==e);l&&(l.node.tabIndex=0)}var _xe=function(e){return e?!!zC:zC==="meanwhile"},yxe=function n(e,i,o){return i&&(i.host===e&&(!i.activeElement||o.contains(i.activeElement))||i.parentNode&&n(e,i.parentNode,o))},Exe=function(e,i){return i.some(function(o){return yxe(e,o,o)})},zne=function(e){return BC(e,new Map)},vxe=function(e){return!zne([e.parentNode]).some(function(i){return i.node===e})},Qk=function(){var e=!1;if(f0){var i=f0,o=i.observed,l=i.persistentFocus,u=i.autoFocus,f=i.shards,_=i.crossFrame,E=i.focusOptions,b=i.noFocusGuards,C=o||m0&&m0.portaledElement;if(Wne()&&dl&&dl!==document.body&&(!document.body.contains(dl)||vxe(dl))){var I=fX();I&&I.focus()}var P=document&&document.activeElement;if(C){var L=[C].concat(f.map(dxe).filter(Boolean)),M=function(){if(!_xe(_)||!b||!dl||r4)return!1;var re=zne(L),ae=re.findIndex(function(ne){var pe=ne.node;return pe===dl});return ae===0||ae===re.length-1};if((!P||fxe(P))&&(l||M()||!hxe()||!dl&&u)&&(C&&!(Mne(L)||P&&Exe(P,L)||gxe(P))&&(document&&!dl&&P&&!u?(P.blur&&P.blur(),document.body.focus()):(e=Vne(L,dl,{focusOptions:E}),m0={})),dl=document&&document.activeElement,dl!==document.body&&(fX=jne(dl)),zC=!1),document&&P!==document.activeElement&&document.querySelector("[data-focus-auto-guard]")){var F=document&&document.activeElement,B=txe(L),Z=B.map(function(K){var re=K.node;return re}).indexOf(F);Z>-1&&(B.filter(function(K){var re=K.guard,ae=K.node;return re&&ae.dataset.focusAutoGuard}).forEach(function(K){var re=K.node;return re.removeAttribute("tabIndex")}),mX(Z,B.length,1,B),mX(Z,-1,-1,B))}}}return e},Gne=function(e){Qk()&&e&&(e.stopPropagation(),e.preventDefault())},i4=function(){return n4(Qk)},Sxe=function(e){var i=e.target,o=e.currentTarget;o.contains(i)||mxe(o,i)},bxe=function(){return null},Hne=function(){r4=!0},$ne=function(){r4=!1,zC="just",n4(function(){zC="meanwhile"})},wxe=function(){document.addEventListener("focusin",Gne),document.addEventListener("focusout",i4),window.addEventListener("focus",Hne),window.addEventListener("blur",$ne)},Txe=function(){document.removeEventListener("focusin",Gne),document.removeEventListener("focusout",i4),window.removeEventListener("focus",Hne),window.removeEventListener("blur",$ne)};function Cxe(n){return n.filter(function(e){var i=e.disabled;return!i})}var Kne={moveFocusInside:Vne,focusInside:Mne,focusNextElement:axe,focusPrevElement:cxe,focusFirstElement:lxe,focusLastElement:uxe,captureFocusRestore:jne};function Rxe(n){var e=n.slice(-1)[0];e&&!f0&&wxe();var i=f0,o=i&&e&&e.id===i.id;f0=e,i&&!o&&(i.onDeactivation(),n.filter(function(l){var u=l.id;return u===i.id}).length||i.returnFocus(!e)),e?(dl=null,(!o||i.observed!==e.observed)&&e.onActivation(Kne),Qk(),n4(Qk)):(Txe(),dl=null)}Tne.assignSyncMedium(Sxe);Cne.assignMedium(i4);vDe.assignMedium(function(n){return n(Kne)});const Ixe=ADe(Cxe,Rxe)(bxe);var VV=k.forwardRef(function(e,i){return gi.createElement(KF,Xy({sideCar:Ixe,ref:i},e))}),qne=KF.propTypes||{};qne.sideCar;cDe(qne,["sideCar"]);VV.propTypes={};const Axe=VV.default??VV,Yne=n=>{const{initialFocusRef:e,finalFocusRef:i,contentRef:o,restoreFocus:l,children:u,isDisabled:f,autoFocus:_,persistentFocus:E,lockFocusAcrossFrames:b}=n,C=k.useCallback(()=>{e!=null&&e.current?e.current.focus():o!=null&&o.current&&NZ(o.current).length===0&&requestAnimationFrame(()=>{var M;(M=o.current)==null||M.focus()})},[e,o]),I=k.useCallback(()=>{var L;(L=i==null?void 0:i.current)==null||L.focus()},[i]),P=l&&!i;return S.jsx(Axe,{crossFrame:b,persistentFocus:E,autoFocus:_,disabled:f,onActivation:C,onDeactivation:I,returnFocus:P,children:u})};Yne.displayName="FocusLock";const[Pxe,Oxe]=Ii({name:"FormErrorStylesContext",errorMessage:`useFormErrorStyles returned is 'undefined'. Seems you forgot to wrap the components in "<FormError />" `}),tp=Bt((n,e)=>{const i=xa("FormError",n),o=Mi(n),l=eb();return l!=null&&l.isInvalid?S.jsx(Pxe,{value:i,children:S.jsx(Ut.div,{...l==null?void 0:l.getErrorMessageProps(o,e),className:fn("chakra-form__error-message",n.className),__css:{display:"flex",alignItems:"center",...i.text}})}):null});tp.displayName="FormErrorMessage";const kxe=Bt((n,e)=>{const i=Oxe(),o=eb();if(!(o!=null&&o.isInvalid))return null;const l=fn("chakra-form__error-icon",n.className);return S.jsx(vn,{ref:e,"aria-hidden":!0,...n,__css:i.icon,className:l,children:S.jsx("path",{fill:"currentColor",d:"M11.983,0a12.206,12.206,0,0,0-8.51,3.653A11.8,11.8,0,0,0,0,12.207,11.779,11.779,0,0,0,11.8,24h.214A12.111,12.111,0,0,0,24,11.791h0A11.766,11.766,0,0,0,11.983,0ZM10.5,16.542a1.476,1.476,0,0,1,1.449-1.53h.027a1.527,1.527,0,0,1,1.523,1.47,1.475,1.475,0,0,1-1.449,1.53h-.027A1.529,1.529,0,0,1,10.5,16.542ZM11,12.5v-6a1,1,0,0,1,2,0v6a1,1,0,1,1-2,0Z"})})});kxe.displayName="FormErrorIcon";const ei=Bt(function(e,i){const o=nu("FormLabel",e),l=Mi(e),{className:u,children:f,requiredIndicator:_=S.jsx(Xne,{}),optionalIndicator:E=null,...b}=l,C=eb(),I=(C==null?void 0:C.getLabelProps(b,i))??{ref:i,...b};return S.jsxs(Ut.label,{...I,className:fn("chakra-form__label",l.className),__css:{display:"block",textAlign:"start",...o},children:[f,C!=null&&C.isRequired?_:E]})});ei.displayName="FormLabel";const Xne=Bt(function(e,i){const o=eb(),l=_ne();if(!(o!=null&&o.isRequired))return null;const u=fn("chakra-form__required-indicator",e.className);return S.jsx(Ut.span,{...o==null?void 0:o.getRequiredIndicatorProps(e,i),__css:l.requiredIndicator,className:u})});Xne.displayName="RequiredIndicator";const s4=Bt(function(e,i){const{templateAreas:o,gap:l,rowGap:u,columnGap:f,column:_,row:E,autoFlow:b,autoRows:C,templateRows:I,autoColumns:P,templateColumns:L,...M}=e,F={display:"grid",gridTemplateAreas:o,gridGap:l,gridRowGap:u,gridColumnGap:f,gridAutoColumns:P,gridColumn:_,gridRow:E,gridAutoFlow:b,gridAutoRows:C,gridTemplateRows:I,gridTemplateColumns:L};return S.jsx(Ut.div,{ref:i,__css:F,...M})});s4.displayName="Grid";const Jne=Bt(function(e,i){const{columns:o,spacingX:l,spacingY:u,spacing:f,minChildWidth:_,...E}=e,b=Z0(),C=_?Dxe(_,b):xxe(o);return S.jsx(s4,{ref:i,gap:f,columnGap:l,rowGap:u,templateColumns:C,...E})});Jne.displayName="SimpleGrid";function Nxe(n){return typeof n=="number"?`${n}px`:n}function Dxe(n,e){return D1(n,i=>{const o=pNe("sizes",i,Nxe(i))(e);return i===null?null:`repeat(auto-fit, minmax(${o}, 1fr))`})}function xxe(n){return D1(n,e=>e===null?null:`repeat(${e}, minmax(0, 1fr))`)}function Jg(n){const{viewBox:e="0 0 24 24",d:i,displayName:o,defaultProps:l={}}=n,u=k.Children.toArray(n.path),f=Bt((_,E)=>S.jsx(vn,{ref:E,viewBox:e,...l,..._,children:u.length?u:S.jsx("path",{fill:"currentColor",d:i})}));return f.displayName=o,f}const jV=Bt(function(e,i){const{htmlWidth:o,htmlHeight:l,alt:u,...f}=e;return S.jsx("img",{width:o,height:l,ref:i,alt:u,...f})});jV.displayName="NativeImage";const cp=Bt(function(e,i){const{fallbackSrc:o,fallback:l,src:u,srcSet:f,align:_,fit:E,loading:b,ignoreFallback:C,crossOrigin:I,fallbackStrategy:P="beforeLoadOrError",referrerPolicy:L,...M}=e,F=o!==void 0||l!==void 0,B=b!=null||C||!F,Z=fne({...e,crossOrigin:I,ignoreFallback:B}),K=WNe(Z,P),re={ref:i,objectFit:E,objectPosition:_,...B?M:q0(M,["onError","onLoad"])};return K?l||S.jsx(Ut.img,{as:jV,className:"chakra-image__placeholder",src:o,...re}):S.jsx(Ut.img,{as:jV,src:u,srcSet:f,crossOrigin:I,loading:b,referrerPolicy:L,className:"chakra-image",...re})});cp.displayName="Image";const ti=Bt(function(e,i){const{htmlSize:o,...l}=e,u=xa("Input",l),f=Mi(l),_=GF(f),E=fn("chakra-input",e.className);return S.jsx(Ut.input,{size:o,..._,__css:u.field,ref:i,className:E})});ti.displayName="Input";ti.id="Input";const[Lxe,Qne]=Ii({name:"InputGroupStylesContext",errorMessage:`useInputGroupStyles returned is 'undefined'. Seems you forgot to wrap the components in "<InputGroup />" `}),Dg=Bt(function(e,i){const o=xa("Input",e),{children:l,className:u,...f}=Mi(e),_=fn("chakra-input__group",u),E={},b=k1(l),C=o.field;b.forEach(P=>{o&&(C&&P.type.id==="InputLeftElement"&&(E.paddingStart=C.height??C.h),C&&P.type.id==="InputRightElement"&&(E.paddingEnd=C.height??C.h),P.type.id==="InputRightAddon"&&(E.borderEndRadius=0),P.type.id==="InputLeftAddon"&&(E.borderStartRadius=0))});const I=b.map(P=>{var M,F;const L=N1({size:((M=P.props)==null?void 0:M.size)||e.size,variant:((F=P.props)==null?void 0:F.variant)||e.variant});return P.type.id!=="Input"?k.cloneElement(P,L):k.cloneElement(P,Object.assign(L,E,P.props))});return S.jsx(Ut.div,{className:_,ref:i,__css:{width:"100%",display:"flex",position:"relative",isolation:"isolate",...o.group},"data-group":!0,...f,children:S.jsx(Lxe,{value:o,children:I})})});Dg.displayName="InputGroup";const Mxe={left:{marginEnd:"-1px",borderEndRadius:0,borderEndColor:"transparent"},right:{marginStart:"-1px",borderStartRadius:0,borderStartColor:"transparent"}},Uxe=Ut("div",{baseStyle:{flex:"0 0 auto",width:"auto",display:"flex",alignItems:"center",whiteSpace:"nowrap"}}),o4=Bt(function(e,i){const{placement:o="left",...l}=e,u=Mxe[o]??{},f=Qne();return S.jsx(Uxe,{ref:i,...l,__css:{...f.addon,...u}})});o4.displayName="InputAddon";const X1=Bt(function(e,i){return S.jsx(o4,{ref:i,placement:"left",...e,className:fn("chakra-input__left-addon",e.className)})});X1.displayName="InputLeftAddon";X1.id="InputLeftAddon";const Zne=Bt(function(e,i){return S.jsx(o4,{ref:i,placement:"right",...e,className:fn("chakra-input__right-addon",e.className)})});Zne.displayName="InputRightAddon";Zne.id="InputRightAddon";const Vxe=Ut("div",{baseStyle:{display:"flex",alignItems:"center",justifyContent:"center",position:"absolute",top:"0",zIndex:2}}),J1=Bt(function(e,i){const{placement:o="left",...l}=e,u=Qne(),f=u.field,E={[o==="left"?"insetStart":"insetEnd"]:"0",width:(f==null?void 0:f.height)??(f==null?void 0:f.h),height:(f==null?void 0:f.height)??(f==null?void 0:f.h),fontSize:f==null?void 0:f.fontSize,...u.element};return S.jsx(Vxe,{ref:i,__css:E,...l})});J1.id="InputElement";J1.displayName="InputElement";const EC=Bt(function(e,i){const{className:o,...l}=e,u=fn("chakra-input__left-element",o);return S.jsx(J1,{ref:i,placement:"left",className:u,...l})});EC.id="InputLeftElement";EC.displayName="InputLeftElement";const Zk=Bt(function(e,i){const{className:o,...l}=e,u=fn("chakra-input__right-element",o);return S.jsx(J1,{ref:i,placement:"right",className:u,...l})});Zk.id="InputRightElement";Zk.displayName="InputRightElement";const Kl=Bt(function(e,i){const o=nu("Link",e),{className:l,isExternal:u,...f}=Mi(e);return S.jsx(Ut.a,{target:u?"_blank":void 0,rel:u?"noopener":void 0,ref:i,className:fn("chakra-link",l),...f,__css:o})});Kl.displayName="Link";const[jxe,ere]=Ii({name:"ListStylesContext",errorMessage:`useListStyles returned is 'undefined'. Seems you forgot to wrap the components in "<List />" `}),Q1=Bt(function(e,i){const o=xa("List",e),{children:l,styleType:u="none",stylePosition:f,spacing:_,...E}=Mi(e),b=k1(l),I=_?{["& > *:not(style) ~ *:not(style)"]:{mt:_}}:{};return S.jsx(jxe,{value:o,children:S.jsx(Ut.ul,{ref:i,listStyleType:u,listStylePosition:f,role:"list",__css:{...o.container,...I},...E,children:b})})});Q1.displayName="List";const Fxe=Bt((n,e)=>{const{as:i,...o}=n;return S.jsx(Q1,{ref:e,as:"ol",styleType:"decimal",marginStart:"1em",...o})});Fxe.displayName="OrderedList";const Bxe=Bt(function(e,i){const{as:o,...l}=e;return S.jsx(Q1,{ref:i,as:"ul",styleType:"initial",marginStart:"1em",...l})});Bxe.displayName="UnorderedList";const tre=Bt(function(e,i){const o=ere();return S.jsx(Ut.li,{ref:i,...e,__css:o.item})});tre.displayName="ListItem";const Wxe=Bt(function(e,i){const o=ere();return S.jsx(vn,{ref:i,role:"presentation",...e,__css:o.icon})});Wxe.displayName="ListIcon";function zxe(n,e={}){const{ssr:i=!0,fallback:o}=e,{getWindow:l}=gAe(),u=Array.isArray(n)?n:[n];let f=Array.isArray(o)?o:[o];f=f.filter(b=>b!=null);const[_,E]=k.useState(()=>u.map((b,C)=>({media:b,matches:i?!!f[C]:l().matchMedia(b).matches})));return k.useEffect(()=>{const b=l();E(u.map(P=>({media:P,matches:b.matchMedia(P).matches})));const C=u.map(P=>b.matchMedia(P)),I=P=>{E(L=>L.slice().map(M=>M.media===P.media?{...M,matches:P.matches}:M))};return C.forEach(P=>{typeof P.addListener=="function"?P.addListener(I):P.addEventListener("change",I)}),()=>{C.forEach(P=>{typeof P.removeListener=="function"?P.removeListener(I):P.removeEventListener("change",I)})}},[l]),_.map(b=>b.matches)}function Gxe(n,e,i,o){if(e==null)return o;if(!o)return n.find(f=>i(f).toLowerCase().startsWith(e.toLowerCase()));const l=n.filter(u=>i(u).toLowerCase().startsWith(e.toLowerCase()));if(l.length>0){let u;return l.includes(o)?(u=l.indexOf(o)+1,u===l.length&&(u=0),l[u]):(u=n.indexOf(l[0]),n[u])}return o}function Hxe(n){const{key:e}=n;return e.length===1||e.length>1&&/[^a-zA-Z0-9]/.test(e)}function $xe(n={}){const{timeout:e=300,preventDefault:i=()=>!0}=n,[o,l]=k.useState([]),u=k.useRef(void 0),f=()=>{u.current&&(clearTimeout(u.current),u.current=null)},_=()=>{f(),u.current=setTimeout(()=>{l([]),u.current=null},e)};k.useEffect(()=>f,[]);function E(b){return C=>{if(C.key==="Backspace"){const I=[...o];I.pop(),l(I);return}if(Hxe(C)){const I=o.concat(C.key);i(C)&&(C.preventDefault(),C.stopPropagation()),l(I),b(I.join("")),_()}}}return E}var _l="top",Qu="bottom",Zu="right",yl="left",a4="auto",yR=[_l,Qu,Zu,yl],k0="start",GC="end",Kxe="clippingParents",nre="viewport",OT="popper",qxe="reference",gX=yR.reduce(function(n,e){return n.concat([e+"-"+k0,e+"-"+GC])},[]),rre=[].concat(yR,[a4]).reduce(function(n,e){return n.concat([e,e+"-"+k0,e+"-"+GC])},[]),Yxe="beforeRead",Xxe="read",Jxe="afterRead",Qxe="beforeMain",Zxe="main",eLe="afterMain",tLe="beforeWrite",nLe="write",rLe="afterWrite",iLe=[Yxe,Xxe,Jxe,Qxe,Zxe,eLe,tLe,nLe,rLe];function Tp(n){return n?(n.nodeName||"").toLowerCase():null}function tu(n){if(n==null)return window;if(n.toString()!=="[object Window]"){var e=n.ownerDocument;return e&&e.defaultView||window}return n}function Zy(n){var e=tu(n).Element;return n instanceof e||n instanceof Element}function qu(n){var e=tu(n).HTMLElement;return n instanceof e||n instanceof HTMLElement}function c4(n){if(typeof ShadowRoot>"u")return!1;var e=tu(n).ShadowRoot;return n instanceof e||n instanceof ShadowRoot}function sLe(n){var e=n.state;Object.keys(e.elements).forEach(function(i){var o=e.styles[i]||{},l=e.attributes[i]||{},u=e.elements[i];!qu(u)||!Tp(u)||(Object.assign(u.style,o),Object.keys(l).forEach(function(f){var _=l[f];_===!1?u.removeAttribute(f):u.setAttribute(f,_===!0?"":_)}))})}function oLe(n){var e=n.state,i={popper:{position:e.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(e.elements.popper.style,i.popper),e.styles=i,e.elements.arrow&&Object.assign(e.elements.arrow.style,i.arrow),function(){Object.keys(e.elements).forEach(function(o){var l=e.elements[o],u=e.attributes[o]||{},f=Object.keys(e.styles.hasOwnProperty(o)?e.styles[o]:i[o]),_=f.reduce(function(E,b){return E[b]="",E},{});!qu(l)||!Tp(l)||(Object.assign(l.style,_),Object.keys(u).forEach(function(E){l.removeAttribute(E)}))})}}const aLe={name:"applyStyles",enabled:!0,phase:"write",fn:sLe,effect:oLe,requires:["computeStyles"]};function _p(n){return n.split("-")[0]}var $y=Math.max,e1=Math.min,N0=Math.round;function FV(){var n=navigator.userAgentData;return n!=null&&n.brands&&Array.isArray(n.brands)?n.brands.map(function(e){return e.brand+"/"+e.version}).join(" "):navigator.userAgent}function ire(){return!/^((?!chrome|android).)*safari/i.test(FV())}function D0(n,e,i){e===void 0&&(e=!1),i===void 0&&(i=!1);var o=n.getBoundingClientRect(),l=1,u=1;e&&qu(n)&&(l=n.offsetWidth>0&&N0(o.width)/n.offsetWidth||1,u=n.offsetHeight>0&&N0(o.height)/n.offsetHeight||1);var f=Zy(n)?tu(n):window,_=f.visualViewport,E=!ire()&&i,b=(o.left+(E&&_?_.offsetLeft:0))/l,C=(o.top+(E&&_?_.offsetTop:0))/u,I=o.width/l,P=o.height/u;return{width:I,height:P,top:C,right:b+I,bottom:C+P,left:b,x:b,y:C}}function l4(n){var e=D0(n),i=n.offsetWidth,o=n.offsetHeight;return Math.abs(e.width-i)<=1&&(i=e.width),Math.abs(e.height-o)<=1&&(o=e.height),{x:n.offsetLeft,y:n.offsetTop,width:i,height:o}}function sre(n,e){var i=e.getRootNode&&e.getRootNode();if(n.contains(e))return!0;if(i&&c4(i)){var o=e;do{if(o&&n.isSameNode(o))return!0;o=o.parentNode||o.host}while(o)}return!1}function Zf(n){return tu(n).getComputedStyle(n)}function cLe(n){return["table","td","th"].indexOf(Tp(n))>=0}function Qg(n){return((Zy(n)?n.ownerDocument:n.document)||window.document).documentElement}function Z1(n){return Tp(n)==="html"?n:n.assignedSlot||n.parentNode||(c4(n)?n.host:null)||Qg(n)}function _X(n){return!qu(n)||Zf(n).position==="fixed"?null:n.offsetParent}function lLe(n){var e=/firefox/i.test(FV()),i=/Trident/i.test(FV());if(i&&qu(n)){var o=Zf(n);if(o.position==="fixed")return null}var l=Z1(n);for(c4(l)&&(l=l.host);qu(l)&&["html","body"].indexOf(Tp(l))<0;){var u=Zf(l);if(u.transform!=="none"||u.perspective!=="none"||u.contain==="paint"||["transform","perspective"].indexOf(u.willChange)!==-1||e&&u.willChange==="filter"||e&&u.filter&&u.filter!=="none")return l;l=l.parentNode}return null}function ER(n){for(var e=tu(n),i=_X(n);i&&cLe(i)&&Zf(i).position==="static";)i=_X(i);return i&&(Tp(i)==="html"||Tp(i)==="body"&&Zf(i).position==="static")?e:i||lLe(n)||e}function u4(n){return["top","bottom"].indexOf(n)>=0?"x":"y"}function vC(n,e,i){return $y(n,e1(e,i))}function uLe(n,e,i){var o=vC(n,e,i);return o>i?i:o}function ore(){return{top:0,right:0,bottom:0,left:0}}function are(n){return Object.assign({},ore(),n)}function cre(n,e){return e.reduce(function(i,o){return i[o]=n,i},{})}var dLe=function(e,i){return e=typeof e=="function"?e(Object.assign({},i.rects,{placement:i.placement})):e,are(typeof e!="number"?e:cre(e,yR))};function hLe(n){var e,i=n.state,o=n.name,l=n.options,u=i.elements.arrow,f=i.modifiersData.popperOffsets,_=_p(i.placement),E=u4(_),b=[yl,Zu].indexOf(_)>=0,C=b?"height":"width";if(!(!u||!f)){var I=dLe(l.padding,i),P=l4(u),L=E==="y"?_l:yl,M=E==="y"?Qu:Zu,F=i.rects.reference[C]+i.rects.reference[E]-f[E]-i.rects.popper[C],B=f[E]-i.rects.reference[E],Z=ER(u),K=Z?E==="y"?Z.clientHeight||0:Z.clientWidth||0:0,re=F/2-B/2,ae=I[L],ne=K-P[C]-I[M],pe=K/2-P[C]/2+re,X=vC(ae,pe,ne),J=E;i.modifiersData[o]=(e={},e[J]=X,e.centerOffset=X-pe,e)}}function pLe(n){var e=n.state,i=n.options,o=i.element,l=o===void 0?"[data-popper-arrow]":o;l!=null&&(typeof l=="string"&&(l=e.elements.popper.querySelector(l),!l)||sre(e.elements.popper,l)&&(e.elements.arrow=l))}const fLe={name:"arrow",enabled:!0,phase:"main",fn:hLe,effect:pLe,requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function x0(n){return n.split("-")[1]}var mLe={top:"auto",right:"auto",bottom:"auto",left:"auto"};function gLe(n,e){var i=n.x,o=n.y,l=e.devicePixelRatio||1;return{x:N0(i*l)/l||0,y:N0(o*l)/l||0}}function yX(n){var e,i=n.popper,o=n.popperRect,l=n.placement,u=n.variation,f=n.offsets,_=n.position,E=n.gpuAcceleration,b=n.adaptive,C=n.roundOffsets,I=n.isFixed,P=f.x,L=P===void 0?0:P,M=f.y,F=M===void 0?0:M,B=typeof C=="function"?C({x:L,y:F}):{x:L,y:F};L=B.x,F=B.y;var Z=f.hasOwnProperty("x"),K=f.hasOwnProperty("y"),re=yl,ae=_l,ne=window;if(b){var pe=ER(i),X="clientHeight",J="clientWidth";if(pe===tu(i)&&(pe=Qg(i),Zf(pe).position!=="static"&&_==="absolute"&&(X="scrollHeight",J="scrollWidth")),pe=pe,l===_l||(l===yl||l===Zu)&&u===GC){ae=Qu;var Y=I&&pe===ne&&ne.visualViewport?ne.visualViewport.height:pe[X];F-=Y-o.height,F*=E?1:-1}if(l===yl||(l===_l||l===Qu)&&u===GC){re=Zu;var ie=I&&pe===ne&&ne.visualViewport?ne.visualViewport.width:pe[J];L-=ie-o.width,L*=E?1:-1}}var le=Object.assign({position:_},b&&mLe),de=C===!0?gLe({x:L,y:F},tu(i)):{x:L,y:F};if(L=de.x,F=de.y,E){var ue;return Object.assign({},le,(ue={},ue[ae]=K?"0":"",ue[re]=Z?"0":"",ue.transform=(ne.devicePixelRatio||1)<=1?"translate("+L+"px, "+F+"px)":"translate3d("+L+"px, "+F+"px, 0)",ue))}return Object.assign({},le,(e={},e[ae]=K?F+"px":"",e[re]=Z?L+"px":"",e.transform="",e))}function _Le(n){var e=n.state,i=n.options,o=i.gpuAcceleration,l=o===void 0?!0:o,u=i.adaptive,f=u===void 0?!0:u,_=i.roundOffsets,E=_===void 0?!0:_,b={placement:_p(e.placement),variation:x0(e.placement),popper:e.elements.popper,popperRect:e.rects.popper,gpuAcceleration:l,isFixed:e.options.strategy==="fixed"};e.modifiersData.popperOffsets!=null&&(e.styles.popper=Object.assign({},e.styles.popper,yX(Object.assign({},b,{offsets:e.modifiersData.popperOffsets,position:e.options.strategy,adaptive:f,roundOffsets:E})))),e.modifiersData.arrow!=null&&(e.styles.arrow=Object.assign({},e.styles.arrow,yX(Object.assign({},b,{offsets:e.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:E})))),e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-placement":e.placement})}const yLe={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:_Le,data:{}};var VO={passive:!0};function ELe(n){var e=n.state,i=n.instance,o=n.options,l=o.scroll,u=l===void 0?!0:l,f=o.resize,_=f===void 0?!0:f,E=tu(e.elements.popper),b=[].concat(e.scrollParents.reference,e.scrollParents.popper);return u&&b.forEach(function(C){C.addEventListener("scroll",i.update,VO)}),_&&E.addEventListener("resize",i.update,VO),function(){u&&b.forEach(function(C){C.removeEventListener("scroll",i.update,VO)}),_&&E.removeEventListener("resize",i.update,VO)}}const vLe={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:ELe,data:{}};var SLe={left:"right",right:"left",bottom:"top",top:"bottom"};function Sk(n){return n.replace(/left|right|bottom|top/g,function(e){return SLe[e]})}var bLe={start:"end",end:"start"};function EX(n){return n.replace(/start|end/g,function(e){return bLe[e]})}function d4(n){var e=tu(n),i=e.pageXOffset,o=e.pageYOffset;return{scrollLeft:i,scrollTop:o}}function h4(n){return D0(Qg(n)).left+d4(n).scrollLeft}function wLe(n,e){var i=tu(n),o=Qg(n),l=i.visualViewport,u=o.clientWidth,f=o.clientHeight,_=0,E=0;if(l){u=l.width,f=l.height;var b=ire();(b||!b&&e==="fixed")&&(_=l.offsetLeft,E=l.offsetTop)}return{width:u,height:f,x:_+h4(n),y:E}}function TLe(n){var e,i=Qg(n),o=d4(n),l=(e=n.ownerDocument)==null?void 0:e.body,u=$y(i.scrollWidth,i.clientWidth,l?l.scrollWidth:0,l?l.clientWidth:0),f=$y(i.scrollHeight,i.clientHeight,l?l.scrollHeight:0,l?l.clientHeight:0),_=-o.scrollLeft+h4(n),E=-o.scrollTop;return Zf(l||i).direction==="rtl"&&(_+=$y(i.clientWidth,l?l.clientWidth:0)-u),{width:u,height:f,x:_,y:E}}function p4(n){var e=Zf(n),i=e.overflow,o=e.overflowX,l=e.overflowY;return/auto|scroll|overlay|hidden/.test(i+l+o)}function lre(n){return["html","body","#document"].indexOf(Tp(n))>=0?n.ownerDocument.body:qu(n)&&p4(n)?n:lre(Z1(n))}function SC(n,e){var i;e===void 0&&(e=[]);var o=lre(n),l=o===((i=n.ownerDocument)==null?void 0:i.body),u=tu(o),f=l?[u].concat(u.visualViewport||[],p4(o)?o:[]):o,_=e.concat(f);return l?_:_.concat(SC(Z1(f)))}function BV(n){return Object.assign({},n,{left:n.x,top:n.y,right:n.x+n.width,bottom:n.y+n.height})}function CLe(n,e){var i=D0(n,!1,e==="fixed");return i.top=i.top+n.clientTop,i.left=i.left+n.clientLeft,i.bottom=i.top+n.clientHeight,i.right=i.left+n.clientWidth,i.width=n.clientWidth,i.height=n.clientHeight,i.x=i.left,i.y=i.top,i}function vX(n,e,i){return e===nre?BV(wLe(n,i)):Zy(e)?CLe(e,i):BV(TLe(Qg(n)))}function RLe(n){var e=SC(Z1(n)),i=["absolute","fixed"].indexOf(Zf(n).position)>=0,o=i&&qu(n)?ER(n):n;return Zy(o)?e.filter(function(l){return Zy(l)&&sre(l,o)&&Tp(l)!=="body"}):[]}function ILe(n,e,i,o){var l=e==="clippingParents"?RLe(n):[].concat(e),u=[].concat(l,[i]),f=u[0],_=u.reduce(function(E,b){var C=vX(n,b,o);return E.top=$y(C.top,E.top),E.right=e1(C.right,E.right),E.bottom=e1(C.bottom,E.bottom),E.left=$y(C.left,E.left),E},vX(n,f,o));return _.width=_.right-_.left,_.height=_.bottom-_.top,_.x=_.left,_.y=_.top,_}function ure(n){var e=n.reference,i=n.element,o=n.placement,l=o?_p(o):null,u=o?x0(o):null,f=e.x+e.width/2-i.width/2,_=e.y+e.height/2-i.height/2,E;switch(l){case _l:E={x:f,y:e.y-i.height};break;case Qu:E={x:f,y:e.y+e.height};break;case Zu:E={x:e.x+e.width,y:_};break;case yl:E={x:e.x-i.width,y:_};break;default:E={x:e.x,y:e.y}}var b=l?u4(l):null;if(b!=null){var C=b==="y"?"height":"width";switch(u){case k0:E[b]=E[b]-(e[C]/2-i[C]/2);break;case GC:E[b]=E[b]+(e[C]/2-i[C]/2);break}}return E}function HC(n,e){e===void 0&&(e={});var i=e,o=i.placement,l=o===void 0?n.placement:o,u=i.strategy,f=u===void 0?n.strategy:u,_=i.boundary,E=_===void 0?Kxe:_,b=i.rootBoundary,C=b===void 0?nre:b,I=i.elementContext,P=I===void 0?OT:I,L=i.altBoundary,M=L===void 0?!1:L,F=i.padding,B=F===void 0?0:F,Z=are(typeof B!="number"?B:cre(B,yR)),K=P===OT?qxe:OT,re=n.rects.popper,ae=n.elements[M?K:P],ne=ILe(Zy(ae)?ae:ae.contextElement||Qg(n.elements.popper),E,C,f),pe=D0(n.elements.reference),X=ure({reference:pe,element:re,placement:l}),J=BV(Object.assign({},re,X)),Y=P===OT?J:pe,ie={top:ne.top-Y.top+Z.top,bottom:Y.bottom-ne.bottom+Z.bottom,left:ne.left-Y.left+Z.left,right:Y.right-ne.right+Z.right},le=n.modifiersData.offset;if(P===OT&&le){var de=le[l];Object.keys(ie).forEach(function(ue){var Oe=[Zu,Qu].indexOf(ue)>=0?1:-1,Ve=[_l,Qu].indexOf(ue)>=0?"y":"x";ie[ue]+=de[Ve]*Oe})}return ie}function ALe(n,e){e===void 0&&(e={});var i=e,o=i.placement,l=i.boundary,u=i.rootBoundary,f=i.padding,_=i.flipVariations,E=i.allowedAutoPlacements,b=E===void 0?rre:E,C=x0(o),I=C?_?gX:gX.filter(function(M){return x0(M)===C}):yR,P=I.filter(function(M){return b.indexOf(M)>=0});P.length===0&&(P=I);var L=P.reduce(function(M,F){return M[F]=HC(n,{placement:F,boundary:l,rootBoundary:u,padding:f})[_p(F)],M},{});return Object.keys(L).sort(function(M,F){return L[M]-L[F]})}function PLe(n){if(_p(n)===a4)return[];var e=Sk(n);return[EX(n),e,EX(e)]}function OLe(n){var e=n.state,i=n.options,o=n.name;if(!e.modifiersData[o]._skip){for(var l=i.mainAxis,u=l===void 0?!0:l,f=i.altAxis,_=f===void 0?!0:f,E=i.fallbackPlacements,b=i.padding,C=i.boundary,I=i.rootBoundary,P=i.altBoundary,L=i.flipVariations,M=L===void 0?!0:L,F=i.allowedAutoPlacements,B=e.options.placement,Z=_p(B),K=Z===B,re=E||(K||!M?[Sk(B)]:PLe(B)),ae=[B].concat(re).reduce(function(Ue,Be){return Ue.concat(_p(Be)===a4?ALe(e,{placement:Be,boundary:C,rootBoundary:I,padding:b,flipVariations:M,allowedAutoPlacements:F}):Be)},[]),ne=e.rects.reference,pe=e.rects.popper,X=new Map,J=!0,Y=ae[0],ie=0;ie<ae.length;ie++){var le=ae[ie],de=_p(le),ue=x0(le)===k0,Oe=[_l,Qu].indexOf(de)>=0,Ve=Oe?"width":"height",xe=HC(e,{placement:le,boundary:C,rootBoundary:I,altBoundary:P,padding:b}),Re=Oe?ue?Zu:yl:ue?Qu:_l;ne[Ve]>pe[Ve]&&(Re=Sk(Re));var ve=Sk(Re),be=[];if(u&&be.push(xe[de]<=0),_&&be.push(xe[Re]<=0,xe[ve]<=0),be.every(function(Ue){return Ue})){Y=le,J=!1;break}X.set(le,be)}if(J)for(var We=M?3:1,Pe=function(Be){var qe=ae.find(function($e){var st=X.get($e);if(st)return st.slice(0,Be).every(function(Je){return Je})});if(qe)return Y=qe,"break"},Te=We;Te>0;Te--){var ke=Pe(Te);if(ke==="break")break}e.placement!==Y&&(e.modifiersData[o]._skip=!0,e.placement=Y,e.reset=!0)}}const kLe={name:"flip",enabled:!0,phase:"main",fn:OLe,requiresIfExists:["offset"],data:{_skip:!1}};function SX(n,e,i){return i===void 0&&(i={x:0,y:0}),{top:n.top-e.height-i.y,right:n.right-e.width+i.x,bottom:n.bottom-e.height+i.y,left:n.left-e.width-i.x}}function bX(n){return[_l,Zu,Qu,yl].some(function(e){return n[e]>=0})}function NLe(n){var e=n.state,i=n.name,o=e.rects.reference,l=e.rects.popper,u=e.modifiersData.preventOverflow,f=HC(e,{elementContext:"reference"}),_=HC(e,{altBoundary:!0}),E=SX(f,o),b=SX(_,l,u),C=bX(E),I=bX(b);e.modifiersData[i]={referenceClippingOffsets:E,popperEscapeOffsets:b,isReferenceHidden:C,hasPopperEscaped:I},e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-reference-hidden":C,"data-popper-escaped":I})}const DLe={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:NLe};function xLe(n,e,i){var o=_p(n),l=[yl,_l].indexOf(o)>=0?-1:1,u=typeof i=="function"?i(Object.assign({},e,{placement:n})):i,f=u[0],_=u[1];return f=f||0,_=(_||0)*l,[yl,Zu].indexOf(o)>=0?{x:_,y:f}:{x:f,y:_}}function LLe(n){var e=n.state,i=n.options,o=n.name,l=i.offset,u=l===void 0?[0,0]:l,f=rre.reduce(function(C,I){return C[I]=xLe(I,e.rects,u),C},{}),_=f[e.placement],E=_.x,b=_.y;e.modifiersData.popperOffsets!=null&&(e.modifiersData.popperOffsets.x+=E,e.modifiersData.popperOffsets.y+=b),e.modifiersData[o]=f}const MLe={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:LLe};function ULe(n){var e=n.state,i=n.name;e.modifiersData[i]=ure({reference:e.rects.reference,element:e.rects.popper,placement:e.placement})}const VLe={name:"popperOffsets",enabled:!0,phase:"read",fn:ULe,data:{}};function jLe(n){return n==="x"?"y":"x"}function FLe(n){var e=n.state,i=n.options,o=n.name,l=i.mainAxis,u=l===void 0?!0:l,f=i.altAxis,_=f===void 0?!1:f,E=i.boundary,b=i.rootBoundary,C=i.altBoundary,I=i.padding,P=i.tether,L=P===void 0?!0:P,M=i.tetherOffset,F=M===void 0?0:M,B=HC(e,{boundary:E,rootBoundary:b,padding:I,altBoundary:C}),Z=_p(e.placement),K=x0(e.placement),re=!K,ae=u4(Z),ne=jLe(ae),pe=e.modifiersData.popperOffsets,X=e.rects.reference,J=e.rects.popper,Y=typeof F=="function"?F(Object.assign({},e.rects,{placement:e.placement})):F,ie=typeof Y=="number"?{mainAxis:Y,altAxis:Y}:Object.assign({mainAxis:0,altAxis:0},Y),le=e.modifiersData.offset?e.modifiersData.offset[e.placement]:null,de={x:0,y:0};if(pe){if(u){var ue,Oe=ae==="y"?_l:yl,Ve=ae==="y"?Qu:Zu,xe=ae==="y"?"height":"width",Re=pe[ae],ve=Re+B[Oe],be=Re-B[Ve],We=L?-J[xe]/2:0,Pe=K===k0?X[xe]:J[xe],Te=K===k0?-J[xe]:-X[xe],ke=e.elements.arrow,Ue=L&&ke?l4(ke):{width:0,height:0},Be=e.modifiersData["arrow#persistent"]?e.modifiersData["arrow#persistent"].padding:ore(),qe=Be[Oe],$e=Be[Ve],st=vC(0,X[xe],Ue[xe]),Je=re?X[xe]/2-We-st-qe-ie.mainAxis:Pe-st-qe-ie.mainAxis,Rt=re?-X[xe]/2+We+st+$e+ie.mainAxis:Te+st+$e+ie.mainAxis,kt=e.elements.arrow&&ER(e.elements.arrow),He=kt?ae==="y"?kt.clientTop||0:kt.clientLeft||0:0,ut=(ue=le==null?void 0:le[ae])!=null?ue:0,mt=Re+Je-ut-He,Lt=Re+Rt-ut,Xt=vC(L?e1(ve,mt):ve,Re,L?$y(be,Lt):be);pe[ae]=Xt,de[ae]=Xt-Re}if(_){var $t,we=ae==="x"?_l:yl,je=ae==="x"?Qu:Zu,Ke=pe[ne],gt=ne==="y"?"height":"width",Et=Ke+B[we],Tt=Ke-B[je],Kt=[_l,yl].indexOf(Z)!==-1,gn=($t=le==null?void 0:le[ne])!=null?$t:0,Sn=Kt?Et:Ke-X[gt]-J[gt]-gn+ie.altAxis,sn=Kt?Ke+X[gt]+J[gt]-gn-ie.altAxis:Tt,wt=L&&Kt?uLe(Sn,Ke,sn):vC(L?Sn:Et,Ke,L?sn:Tt);pe[ne]=wt,de[ne]=wt-Ke}e.modifiersData[o]=de}}const BLe={name:"preventOverflow",enabled:!0,phase:"main",fn:FLe,requiresIfExists:["offset"]};function WLe(n){return{scrollLeft:n.scrollLeft,scrollTop:n.scrollTop}}function zLe(n){return n===tu(n)||!qu(n)?d4(n):WLe(n)}function GLe(n){var e=n.getBoundingClientRect(),i=N0(e.width)/n.offsetWidth||1,o=N0(e.height)/n.offsetHeight||1;return i!==1||o!==1}function HLe(n,e,i){i===void 0&&(i=!1);var o=qu(e),l=qu(e)&&GLe(e),u=Qg(e),f=D0(n,l,i),_={scrollLeft:0,scrollTop:0},E={x:0,y:0};return(o||!o&&!i)&&((Tp(e)!=="body"||p4(u))&&(_=zLe(e)),qu(e)?(E=D0(e,!0),E.x+=e.clientLeft,E.y+=e.clientTop):u&&(E.x=h4(u))),{x:f.left+_.scrollLeft-E.x,y:f.top+_.scrollTop-E.y,width:f.width,height:f.height}}function $Le(n){var e=new Map,i=new Set,o=[];n.forEach(function(u){e.set(u.name,u)});function l(u){i.add(u.name);var f=[].concat(u.requires||[],u.requiresIfExists||[]);f.forEach(function(_){if(!i.has(_)){var E=e.get(_);E&&l(E)}}),o.push(u)}return n.forEach(function(u){i.has(u.name)||l(u)}),o}function KLe(n){var e=$Le(n);return iLe.reduce(function(i,o){return i.concat(e.filter(function(l){return l.phase===o}))},[])}function qLe(n){var e;return function(){return e||(e=new Promise(function(i){Promise.resolve().then(function(){e=void 0,i(n())})})),e}}function YLe(n){var e=n.reduce(function(i,o){var l=i[o.name];return i[o.name]=l?Object.assign({},l,o,{options:Object.assign({},l.options,o.options),data:Object.assign({},l.data,o.data)}):o,i},{});return Object.keys(e).map(function(i){return e[i]})}var wX={placement:"bottom",modifiers:[],strategy:"absolute"};function TX(){for(var n=arguments.length,e=new Array(n),i=0;i<n;i++)e[i]=arguments[i];return!e.some(function(o){return!(o&&typeof o.getBoundingClientRect=="function")})}function XLe(n){n===void 0&&(n={});var e=n,i=e.defaultModifiers,o=i===void 0?[]:i,l=e.defaultOptions,u=l===void 0?wX:l;return function(_,E,b){b===void 0&&(b=u);var C={placement:"bottom",orderedModifiers:[],options:Object.assign({},wX,u),modifiersData:{},elements:{reference:_,popper:E},attributes:{},styles:{}},I=[],P=!1,L={state:C,setOptions:function(Z){var K=typeof Z=="function"?Z(C.options):Z;F(),C.options=Object.assign({},u,C.options,K),C.scrollParents={reference:Zy(_)?SC(_):_.contextElement?SC(_.contextElement):[],popper:SC(E)};var re=KLe(YLe([].concat(o,C.options.modifiers)));return C.orderedModifiers=re.filter(function(ae){return ae.enabled}),M(),L.update()},forceUpdate:function(){if(!P){var Z=C.elements,K=Z.reference,re=Z.popper;if(TX(K,re)){C.rects={reference:HLe(K,ER(re),C.options.strategy==="fixed"),popper:l4(re)},C.reset=!1,C.placement=C.options.placement,C.orderedModifiers.forEach(function(ie){return C.modifiersData[ie.name]=Object.assign({},ie.data)});for(var ae=0;ae<C.orderedModifiers.length;ae++){if(C.reset===!0){C.reset=!1,ae=-1;continue}var ne=C.orderedModifiers[ae],pe=ne.fn,X=ne.options,J=X===void 0?{}:X,Y=ne.name;typeof pe=="function"&&(C=pe({state:C,options:J,name:Y,instance:L})||C)}}}},update:qLe(function(){return new Promise(function(B){L.forceUpdate(),B(C)})}),destroy:function(){F(),P=!0}};if(!TX(_,E))return L;L.setOptions(b).then(function(B){!P&&b.onFirstUpdate&&b.onFirstUpdate(B)});function M(){C.orderedModifiers.forEach(function(B){var Z=B.name,K=B.options,re=K===void 0?{}:K,ae=B.effect;if(typeof ae=="function"){var ne=ae({state:C,name:Z,instance:L,options:re}),pe=function(){};I.push(ne||pe)}})}function F(){I.forEach(function(B){return B()}),I=[]}return L}}var JLe=[vLe,VLe,yLe,aLe,MLe,kLe,BLe,fLe,DLe],QLe=XLe({defaultModifiers:JLe});const DS=(n,e)=>({var:n,varRef:e?`var(${n}, ${e})`:`var(${n})`}),mo={arrowShadowColor:DS("--popper-arrow-shadow-color"),arrowSize:DS("--popper-arrow-size","8px"),arrowSizeHalf:DS("--popper-arrow-size-half"),arrowBg:DS("--popper-arrow-bg"),transformOrigin:DS("--popper-transform-origin"),arrowOffset:DS("--popper-arrow-offset")};function ZLe(n){if(n.includes("top"))return"1px 1px 0px 0 var(--popper-arrow-shadow-color)";if(n.includes("bottom"))return"-1px -1px 0px 0 var(--popper-arrow-shadow-color)";if(n.includes("right"))return"-1px 1px 0px 0 var(--popper-arrow-shadow-color)";if(n.includes("left"))return"1px -1px 0px 0 var(--popper-arrow-shadow-color)"}const e2e={top:"bottom center","top-start":"bottom left","top-end":"bottom right",bottom:"top center","bottom-start":"top left","bottom-end":"top right",left:"right center","left-start":"right top","left-end":"right bottom",right:"left center","right-start":"left top","right-end":"left bottom"},t2e=n=>e2e[n],CX={scroll:!0,resize:!0};function n2e(n){let e;return typeof n=="object"?e={enabled:!0,options:{...CX,...n}}:e={enabled:n,options:CX},e}const r2e={name:"matchWidth",enabled:!0,phase:"beforeWrite",requires:["computeStyles"],fn:({state:n})=>{n.styles.popper.width=`${n.rects.reference.width}px`},effect:({state:n})=>()=>{const e=n.elements.reference;n.elements.popper.style.width=`${e.offsetWidth}px`}},i2e={name:"transformOrigin",enabled:!0,phase:"write",fn:({state:n})=>{RX(n)},effect:({state:n})=>()=>{RX(n)}},RX=n=>{n.elements.popper.style.setProperty(mo.transformOrigin.var,t2e(n.placement))},s2e={name:"positionArrow",enabled:!0,phase:"afterWrite",fn:({state:n})=>{o2e(n)}},o2e=n=>{var i;if(!n.placement)return;const e=a2e(n.placement);if((i=n.elements)!=null&&i.arrow&&e){Object.assign(n.elements.arrow.style,{[e.property]:e.value,width:mo.arrowSize.varRef,height:mo.arrowSize.varRef,zIndex:-1});const o={[mo.arrowSizeHalf.var]:`calc(${mo.arrowSize.varRef} / 2 - 1px)`,[mo.arrowOffset.var]:`calc(${mo.arrowSizeHalf.varRef} * -1)`};for(const l in o)n.elements.arrow.style.setProperty(l,o[l])}},a2e=n=>{if(n.startsWith("top"))return{property:"bottom",value:mo.arrowOffset.varRef};if(n.startsWith("bottom"))return{property:"top",value:mo.arrowOffset.varRef};if(n.startsWith("left"))return{property:"right",value:mo.arrowOffset.varRef};if(n.startsWith("right"))return{property:"left",value:mo.arrowOffset.varRef}},c2e={name:"innerArrow",enabled:!0,phase:"main",requires:["arrow"],fn:({state:n})=>{IX(n)},effect:({state:n})=>()=>{IX(n)}},IX=n=>{if(!n.elements.arrow)return;const e=n.elements.arrow.querySelector("[data-popper-arrow-inner]");if(!e)return;const i=ZLe(n.placement);i&&e.style.setProperty("--popper-arrow-default-shadow",i),Object.assign(e.style,{transform:"rotate(45deg)",background:mo.arrowBg.varRef,top:0,left:0,width:"100%",height:"100%",position:"absolute",zIndex:"inherit",boxShadow:"var(--popper-arrow-shadow, var(--popper-arrow-default-shadow))"})},l2e={"start-start":{ltr:"left-start",rtl:"right-start"},"start-end":{ltr:"left-end",rtl:"right-end"},"end-start":{ltr:"right-start",rtl:"left-start"},"end-end":{ltr:"right-end",rtl:"left-end"},start:{ltr:"left",rtl:"right"},end:{ltr:"right",rtl:"left"}},u2e={"auto-start":"auto-end","auto-end":"auto-start","top-start":"top-end","top-end":"top-start","bottom-start":"bottom-end","bottom-end":"bottom-start"};function d2e(n,e="ltr"){var o;const i=((o=l2e[n])==null?void 0:o[e])||n;return e==="ltr"?i:u2e[n]??i}function f4(n={}){const{enabled:e=!0,modifiers:i,placement:o="bottom",strategy:l="absolute",arrowPadding:u=8,eventListeners:f=!0,offset:_,gutter:E=8,flip:b=!0,boundary:C="clippingParents",preventOverflow:I=!0,matchWidth:P,direction:L="ltr"}=n,M=k.useRef(null),F=k.useRef(null),B=k.useRef(null),Z=d2e(o,L),K=k.useRef(()=>{}),re=k.useCallback(()=>{var ie;!e||!M.current||!F.current||((ie=K.current)==null||ie.call(K),B.current=QLe(M.current,F.current,{placement:Z,modifiers:[c2e,s2e,i2e,{...r2e,enabled:!!P},{name:"eventListeners",...n2e(f)},{name:"arrow",options:{padding:u}},{name:"offset",options:{offset:_??[0,E]}},{name:"flip",enabled:!!b,options:{padding:8}},{name:"preventOverflow",enabled:!!I,options:{boundary:C}},...i??[]],strategy:l}),B.current.forceUpdate(),K.current=B.current.destroy)},[Z,e,i,P,f,u,_,E,b,I,C,l]);k.useEffect(()=>()=>{var ie;!M.current&&!F.current&&((ie=B.current)==null||ie.destroy(),B.current=null)},[]);const ae=k.useCallback(ie=>{M.current=ie,re()},[re]),ne=k.useCallback((ie={},le=null)=>({...ie,ref:zi(ae,le)}),[ae]),pe=k.useCallback(ie=>{F.current=ie,re()},[re]),X=k.useCallback((ie={},le=null)=>({...ie,ref:zi(pe,le),style:{...ie.style,position:l,minWidth:P?void 0:"max-content",inset:"0 auto auto 0"}}),[l,pe,P]),J=k.useCallback((ie={},le=null)=>{const{size:de,shadowColor:ue,bg:Oe,style:Ve,...xe}=ie;return{...xe,ref:le,"data-popper-arrow":"",style:h2e(ie)}},[]),Y=k.useCallback((ie={},le=null)=>({...ie,ref:le,"data-popper-arrow-inner":""}),[]);return{update(){var ie;(ie=B.current)==null||ie.update()},forceUpdate(){var ie;(ie=B.current)==null||ie.forceUpdate()},transformOrigin:mo.transformOrigin.varRef,referenceRef:ae,popperRef:pe,getPopperProps:X,getArrowProps:J,getArrowInnerProps:Y,getReferenceProps:ne}}function h2e(n){const{size:e,shadowColor:i,bg:o,style:l}=n,u={...l,position:"absolute"};return e&&(u["--popper-arrow-size"]=e),i&&(u["--popper-arrow-shadow-color"]=i),o&&(u["--popper-arrow-bg"]=o),u}function p2e(){const n=k.useRef(new Map),e=n.current,i=k.useCallback((l,u,f,_)=>{n.current.set(f,{type:u,el:l,options:_}),l.addEventListener(u,f,_)},[]),o=k.useCallback((l,u,f,_)=>{l.removeEventListener(u,f,_),n.current.delete(f)},[]);return k.useEffect(()=>()=>{e.forEach((l,u)=>{o(l.el,l.type,u,l.options)})},[o,e]),{add:i,remove:o}}function vU(n){var l,u;const e=((u=(l=n.composedPath)==null?void 0:l.call(n))==null?void 0:u[0])??n.target,{tagName:i,isContentEditable:o}=e;return i!=="INPUT"&&i!=="TEXTAREA"&&o!==!0}function dre(n={}){const{ref:e,isDisabled:i,isFocusable:o,clickOnEnter:l=!0,clickOnSpace:u=!0,onMouseDown:f,onMouseUp:_,onClick:E,onKeyDown:b,onKeyUp:C,tabIndex:I,onMouseOver:P,onMouseLeave:L,...M}=n,[F,B]=k.useState(!0),[Z,K]=k.useState(!1),re=p2e(),ae=Re=>{Re&&Re.tagName!=="BUTTON"&&B(!1)},ne=F?I:I||0,pe=i&&!o,X=k.useCallback(Re=>{if(i){Re.stopPropagation(),Re.preventDefault();return}Re.currentTarget.focus(),E==null||E(Re)},[i,E]),J=k.useCallback(Re=>{Z&&vU(Re)&&(Re.preventDefault(),Re.stopPropagation(),K(!1),re.remove(document,"keyup",J,!1))},[Z,re]),Y=k.useCallback(Re=>{if(b==null||b(Re),i||Re.defaultPrevented||Re.metaKey||!vU(Re.nativeEvent)||F)return;const ve=l&&Re.key==="Enter";u&&Re.key===" "&&(Re.preventDefault(),K(!0)),ve&&(Re.preventDefault(),Re.currentTarget.click()),re.add(document,"keyup",J,!1)},[i,F,b,l,u,re,J]),ie=k.useCallback(Re=>{if(C==null||C(Re),i||Re.defaultPrevented||Re.metaKey||!vU(Re.nativeEvent)||F)return;u&&Re.key===" "&&(Re.preventDefault(),K(!1),Re.currentTarget.click())},[u,F,i,C]),le=k.useCallback(Re=>{Re.button===0&&(K(!1),re.remove(document,"mouseup",le,!1))},[re]),de=k.useCallback(Re=>{if(Re.button!==0)return;if(i){Re.stopPropagation(),Re.preventDefault();return}F||K(!0),Re.currentTarget.focus({preventScroll:!0}),re.add(document,"mouseup",le,!1),f==null||f(Re)},[i,F,f,re,le]),ue=k.useCallback(Re=>{Re.button===0&&(F||K(!1),_==null||_(Re))},[_,F]),Oe=k.useCallback(Re=>{if(i){Re.preventDefault();return}P==null||P(Re)},[i,P]),Ve=k.useCallback(Re=>{Z&&(Re.preventDefault(),K(!1)),L==null||L(Re)},[Z,L]),xe=zi(e,ae);return F?{...M,ref:xe,type:"button","aria-disabled":pe?void 0:i,disabled:pe,onClick:X,onMouseDown:f,onMouseUp:_,onKeyUp:C,onKeyDown:b,onMouseOver:P,onMouseLeave:L}:{...M,ref:xe,role:"button","data-active":nr(Z),"aria-disabled":i?"true":void 0,tabIndex:pe?void 0:ne,onClick:X,onMouseDown:de,onMouseUp:ue,onKeyUp:ie,onKeyDown:Y,onMouseOver:Oe,onMouseLeave:Ve}}const[f2e,m2e,g2e,_2e]=une(),[y2e,vR]=Ii({strict:!1,name:"MenuContext"});function hre(n){return(n==null?void 0:n.ownerDocument)??document}function E2e(n){return hre(n).activeElement===n}function v2e(n={}){const{id:e,closeOnSelect:i=!0,closeOnBlur:o=!0,initialFocusRef:l,autoSelect:u=!0,isLazy:f,isOpen:_,defaultIsOpen:E,onClose:b,onOpen:C,placement:I="bottom-start",lazyBehavior:P="unmount",direction:L,computePositionOnMount:M=!1,...F}=n,B=k.useRef(null),Z=k.useRef(null),K=k.useRef(!0),re=g2e(),ae=k.useCallback(()=>{requestAnimationFrame(()=>{var ke;(ke=B.current)==null||ke.focus({preventScroll:!1})})},[]),ne=k.useCallback(()=>{const ke=setTimeout(()=>{var Ue,Be;if(l)(Ue=l.current)==null||Ue.focus();else if(!re.count())(Be=B.current)==null||Be.focus({preventScroll:!1});else{const qe=re.firstEnabled();qe&&Oe(qe.index)}});be.current.add(ke)},[re,l]),pe=k.useCallback(()=>{const ke=setTimeout(()=>{var Ue;if(!re.count())(Ue=B.current)==null||Ue.focus({preventScroll:!1});else{const Be=re.lastEnabled();Be&&Oe(Be.index)}});be.current.add(ke)},[re]),X=k.useCallback(()=>{C==null||C(),u?ne():ae()},[u,ne,ae,C]),{isOpen:J,onOpen:Y,onClose:ie,onToggle:le}=Xd({isOpen:_,defaultIsOpen:E,onClose:b,onOpen:X});WZ({enabled:J&&o,ref:B,handler:ke=>{var Be,qe,$e;const Ue=((qe=(Be=ke.composedPath)==null?void 0:Be.call(ke))==null?void 0:qe[0])??ke.target;($e=Z.current)!=null&&$e.contains(Ue)||ie()}});const de=f4({...F,enabled:J||M,placement:I,direction:L}),[ue,Oe]=k.useState(-1);jZ(B,{focusRef:Z,visible:J,shouldFocus:!0});const Ve=MZ({isOpen:J,ref:B}),[xe,Re]=bve(e,"menu-button","menu-list"),ve=k.useCallback(()=>{Y(),ae()},[Y,ae]),be=k.useRef(new Set([]));k.useEffect(()=>{const ke=be.current;return()=>{ke.forEach(Ue=>clearTimeout(Ue)),ke.clear()}},[]),Xf(()=>{var ke;J||(Oe(-1),(ke=B.current)==null||ke.scrollTo(0,0))},[J]),Xf(()=>{J&&ue===-1&&ae()},[ue,J]),k.useEffect(()=>{var Ue;if(!J)return;const ke=re.item(ue);(Ue=ke==null?void 0:ke.node)==null||Ue.focus({preventScroll:!K.current})},[re,ue,J]);const We=k.useCallback(()=>{Y(),ne()},[ne,Y]),Pe=k.useCallback(()=>{K.current=!0,Y(),pe()},[Y,pe]),Te=k.useCallback(()=>{var $e,st;const ke=hre(B.current),Ue=($e=B.current)==null?void 0:$e.contains(ke.activeElement);if(!(J&&!Ue))return;const qe=(st=re.item(ue))==null?void 0:st.node;qe==null||qe.focus({preventScroll:!K.current})},[J,ue,re]);return{openAndFocusMenu:ve,openAndFocusFirstItem:We,openAndFocusLastItem:Pe,onTransitionEnd:Te,unstable__animationState:Ve,descendants:re,popper:de,buttonId:xe,menuId:Re,forceUpdate:de.forceUpdate,orientation:"vertical",isOpen:J,onToggle:le,onOpen:Y,onClose:ie,menuRef:B,buttonRef:Z,focusedIndex:ue,closeOnSelect:i,closeOnBlur:o,autoSelect:u,setFocusedIndex:Oe,isLazy:f,lazyBehavior:P,initialFocusRef:l,scrollIntoViewRef:K}}function S2e(n={},e=null){const i=vR(),{onToggle:o,popper:l,openAndFocusFirstItem:u,openAndFocusLastItem:f,scrollIntoViewRef:_}=i,E=k.useCallback(b=>{const C=b.key,P={Enter:u,ArrowDown:u,ArrowUp:f}[C];P&&(_.current=!0,b.preventDefault(),b.stopPropagation(),P(b))},[u,f,_]);return{...n,ref:zi(i.buttonRef,e,l.referenceRef),id:i.buttonId,"data-active":nr(i.isOpen),"aria-expanded":i.isOpen,"aria-haspopup":"menu","aria-controls":i.menuId,onClick:Nn(n.onClick,o),onKeyDown:Nn(n.onKeyDown,E)}}function WV(n){var e;return C2e(n)&&!!((e=n==null?void 0:n.getAttribute("role"))!=null&&e.startsWith("menuitem"))}function b2e(n={},e=null){const i=vR();if(!i)throw new Error("useMenuContext: context is undefined. Seems you forgot to wrap component within <Menu>");const{focusedIndex:o,setFocusedIndex:l,menuRef:u,isOpen:f,onClose:_,menuId:E,isLazy:b,lazyBehavior:C,scrollIntoViewRef:I,unstable__animationState:P}=i,L=m2e(),M=$xe({preventDefault:K=>K.key!==" "&&WV(K.target)}),F=k.useCallback(K=>{if(!K.currentTarget.contains(K.target))return;const re=K.key,ne={Tab:X=>X.preventDefault(),Escape:X=>{X.stopPropagation(),_()},ArrowDown:()=>{I.current=!0;const X=L.nextEnabled(o)??L.firstEnabled();X&&l(X.index)},ArrowUp:()=>{I.current=!0;const X=L.prevEnabled(o)??L.firstEnabled();X&&l(X.index)}}[re];if(ne){K.preventDefault(),ne(K);return}const pe=M(X=>{const J=Gxe(L.values(),X,Y=>{var ie;return((ie=Y==null?void 0:Y.node)==null?void 0:ie.textContent)??""},L.item(o));if(J){const Y=L.indexOf(J.node);l(Y)}});WV(K.target)&&pe(K)},[L,o,M,_,l,I]),B=k.useRef(!1);f&&(B.current=!0);const Z=Vj({wasSelected:B.current,enabled:b,mode:C,isSelected:P.present});return{...n,ref:zi(u,e),children:Z?n.children:null,tabIndex:-1,role:"menu",id:E,style:{...n.style,transformOrigin:"var(--popper-transform-origin)"},"aria-orientation":"vertical",onKeyDown:Nn(n.onKeyDown,F)}}function w2e(n={}){const{popper:e,isOpen:i}=vR();return e.getPopperProps({...n,style:{visibility:i?"visible":"hidden",...n.style}})}function T2e(n={},e=null){const{onMouseEnter:i,onMouseMove:o,onMouseLeave:l,onClick:u,onFocus:f,isDisabled:_,isFocusable:E,closeOnSelect:b,type:C,...I}=n,P=vR(),{setFocusedIndex:L,focusedIndex:M,closeOnSelect:F,onClose:B,menuId:Z,scrollIntoViewRef:K}=P,re=k.useRef(null),ae=`${Z}-menuitem-${k.useId()}`,{index:ne,register:pe}=_2e({disabled:_&&!E}),X=k.useCallback(Oe=>{i==null||i(Oe),!_&&(K.current=!1,L(ne))},[L,ne,_,i,K]),J=k.useCallback(Oe=>{o==null||o(Oe),re.current&&!E2e(re.current)&&X(Oe)},[X,o]),Y=k.useCallback(Oe=>{l==null||l(Oe),!_&&L(-1)},[L,_,l]),ie=k.useCallback(Oe=>{u==null||u(Oe),WV(Oe.currentTarget)&&(b??F)&&B()},[B,u,F,b]),le=k.useCallback(Oe=>{f==null||f(Oe),L(ne)},[L,f,ne]),de=ne===M,ue=dre({onClick:ie,onFocus:le,onMouseEnter:X,onMouseMove:J,onMouseLeave:Y,ref:zi(pe,re,e),isDisabled:_,isFocusable:E});return{...I,...ue,type:C??ue.type,id:ae,role:"menuitem",tabIndex:de?0:-1}}function C2e(n){if(!R2e(n))return!1;const e=n.ownerDocument.defaultView??window;return n instanceof e.HTMLElement}function R2e(n){return n!=null&&typeof n=="object"&&"nodeType"in n&&n.nodeType===Node.ELEMENT_NODE}const[I2e,SR]=Ii({name:"MenuStylesContext",errorMessage:`useMenuStyles returned is 'undefined'. Seems you forgot to wrap the components in "<Menu />" `}),bR=n=>{const{children:e}=n,i=xa("Menu",n),o=Mi(n),{direction:l}=Z0(),{descendants:u,...f}=v2e({...o,direction:l}),_=k.useMemo(()=>f,[f]),{isOpen:E,onClose:b,forceUpdate:C}=_;return S.jsx(f2e,{value:u,children:S.jsx(y2e,{value:_,children:S.jsx(I2e,{value:i,children:gl(e,{isOpen:E,onClose:b,forceUpdate:C})})})})};bR.displayName="Menu";const A2e=Bt((n,e)=>{const i=SR();return S.jsx(Ut.button,{ref:e,...n,__css:{display:"inline-flex",appearance:"none",alignItems:"center",outline:0,...i.button}})}),wR=Bt((n,e)=>{const{children:i,as:o,...l}=n,u=S2e(l,e),f=o||A2e;return S.jsx(f,{...u,className:fn("chakra-menu__menu-button",n.className),children:S.jsx(Ut.span,{__css:{pointerEvents:"none",flex:"1 1 auto",minW:0},children:n.children})})});wR.displayName="MenuButton";const pre=Bt((n,e)=>{const i=SR();return S.jsx(Ut.span,{ref:e,...n,__css:i.command,className:"chakra-menu__command"})});pre.displayName="MenuCommand";const fre=n=>{const{className:e,children:i,...o}=n,l=SR(),u=k.Children.only(i),f=k.isValidElement(u)?k.cloneElement(u,{focusable:"false","aria-hidden":!0,className:fn("chakra-menu__icon",u.props.className)}):null,_=fn("chakra-menu__icon-wrapper",e);return S.jsx(Ut.span,{className:_,...o,__css:l.icon,children:f})};fre.displayName="MenuIcon";const P2e=Bt((n,e)=>{const{type:i,...o}=n,l=SR(),u=o.as||i?i??void 0:"button",f=k.useMemo(()=>({textDecoration:"none",color:"inherit",userSelect:"none",display:"flex",width:"100%",alignItems:"center",textAlign:"start",flex:"0 0 auto",outline:0,...l.item}),[l.item]);return S.jsx(Ut.button,{ref:e,type:u,...o,__css:f})}),Lf=Bt((n,e)=>{const{icon:i,iconSpacing:o="0.75rem",command:l,commandSpacing:u="0.75rem",children:f,..._}=n,E=T2e(_,e),C=i||l?S.jsx("span",{style:{pointerEvents:"none",flex:1},children:f}):f;return S.jsxs(P2e,{...E,className:fn("chakra-menu__menuitem",E.className),children:[i&&S.jsx(fre,{fontSize:"0.8em",marginEnd:o,children:i}),C,l&&S.jsx(pre,{marginStart:u,children:l})]})});Lf.displayName="MenuItem";const O2e={enter:{visibility:"visible",opacity:1,scale:1,transition:{duration:.2,ease:[.4,0,.2,1]}},exit:{transitionEnd:{visibility:"hidden"},opacity:0,scale:.8,transition:{duration:.1,easings:"easeOut"}}},k2e=Ut(Ip.div),TR=Bt(function(e,i){var P;const{rootProps:o,motionProps:l,...u}=e,{isOpen:f,onTransitionEnd:_,unstable__animationState:E}=vR(),b=b2e(u,i),C=w2e(o),I=SR();return S.jsx(Ut.div,{...C,__css:{zIndex:e.zIndex??((P=I.list)==null?void 0:P.zIndex)},children:S.jsx(k2e,{variants:O2e,initial:!1,animate:f?"enter":"exit",__css:{outline:0,...I.list},...l,...b,className:fn("chakra-menu__menu-list",b.className),onUpdate:_,onAnimationComplete:OZ(E.onComplete,b.onAnimationComplete)})})});TR.displayName="MenuList";var N2e=function(n){if(typeof document>"u")return null;var e=Array.isArray(n)?n[0]:n;return e.ownerDocument.body},xS=new WeakMap,jO=new WeakMap,FO={},SU=0,mre=function(n){return n&&(n.host||mre(n.parentNode))},D2e=function(n,e){return e.map(function(i){if(n.contains(i))return i;var o=mre(i);return o&&n.contains(o)?o:(console.error("aria-hidden",i,"in not contained inside",n,". Doing nothing"),null)}).filter(function(i){return!!i})},x2e=function(n,e,i,o){var l=D2e(e,Array.isArray(n)?n:[n]);FO[i]||(FO[i]=new WeakMap);var u=FO[i],f=[],_=new Set,E=new Set(l),b=function(I){!I||_.has(I)||(_.add(I),b(I.parentNode))};l.forEach(b);var C=function(I){!I||E.has(I)||Array.prototype.forEach.call(I.children,function(P){if(_.has(P))C(P);else try{var L=P.getAttribute(o),M=L!==null&&L!=="false",F=(xS.get(P)||0)+1,B=(u.get(P)||0)+1;xS.set(P,F),u.set(P,B),f.push(P),F===1&&M&&jO.set(P,!0),B===1&&P.setAttribute(i,"true"),M||P.setAttribute(o,"true")}catch(Z){console.error("aria-hidden: cannot operate on ",P,Z)}})};return C(e),_.clear(),SU++,function(){f.forEach(function(I){var P=xS.get(I)-1,L=u.get(I)-1;xS.set(I,P),u.set(I,L),P||(jO.has(I)||I.removeAttribute(o),jO.delete(I)),L||I.removeAttribute(i)}),SU--,SU||(xS=new WeakMap,xS=new WeakMap,jO=new WeakMap,FO={})}},L2e=function(n,e,i){i===void 0&&(i="data-aria-hidden");var o=Array.from(Array.isArray(n)?n:[n]),l=N2e(n);return l?(o.push.apply(o,Array.from(l.querySelectorAll("[aria-live]"))),x2e(o,l,i,"aria-hidden")):function(){return null}},M2e=Object.defineProperty,U2e=(n,e,i)=>e in n?M2e(n,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):n[e]=i,V2e=(n,e,i)=>(U2e(n,e+"",i),i);class j2e{constructor(){V2e(this,"modals"),this.modals=new Set}add(e){return this.modals.add(e),this.modals.size}remove(e){this.modals.delete(e)}isTopModal(e){if(!e)return!1;const i=Array.from(this.modals)[this.modals.size-1];return e===i}}const zV=new j2e;function gre(n,e){const[i,o]=k.useState(0);return k.useEffect(()=>{const l=n.current;if(l){if(e){const u=zV.add(l);o(u)}return()=>{zV.remove(l),o(0)}}},[e,n]),i}function F2e(n){const{isOpen:e,onClose:i,id:o,closeOnOverlayClick:l=!0,closeOnEsc:u=!0,useInert:f=!0,onOverlayClick:_,onEsc:E}=n,b=k.useRef(null),C=k.useRef(null),[I,P,L]=W2e(o,"chakra-modal","chakra-modal--header","chakra-modal--body");B2e(b,e&&f);const M=gre(b,e),F=k.useRef(null),B=k.useCallback(Y=>{F.current=Y.target},[]),Z=k.useCallback(Y=>{Y.key==="Escape"&&(Y.stopPropagation(),u&&(i==null||i()),E==null||E())},[u,i,E]),[K,re]=k.useState(!1),[ae,ne]=k.useState(!1),pe=k.useCallback((Y={},ie=null)=>({role:"dialog",...Y,ref:zi(ie,b),id:I,tabIndex:-1,"aria-modal":!0,"aria-labelledby":K?P:void 0,"aria-describedby":ae?L:void 0,onClick:Nn(Y.onClick,le=>le.stopPropagation())}),[L,ae,I,P,K]),X=k.useCallback(Y=>{Y.stopPropagation(),F.current===Y.target&&zV.isTopModal(b.current)&&(l&&(i==null||i()),_==null||_())},[i,l,_]),J=k.useCallback((Y={},ie=null)=>({...Y,ref:zi(ie,C),onClick:Nn(Y.onClick,X),onKeyDown:Nn(Y.onKeyDown,Z),onMouseDown:Nn(Y.onMouseDown,B)}),[Z,B,X]);return{isOpen:e,onClose:i,headerId:P,bodyId:L,setBodyMounted:ne,setHeaderMounted:re,dialogRef:b,overlayRef:C,getDialogProps:pe,getDialogContainerProps:J,index:M}}function B2e(n,e){const i=n.current;k.useEffect(()=>{if(!(!n.current||!e))return L2e(n.current)},[e,n,i])}function W2e(n,...e){const i=k.useId(),o=n||i;return k.useMemo(()=>e.map(l=>`${l}-${o}`),[o,e])}const[z2e,tb]=Ii({name:"ModalStylesContext",errorMessage:`useModalStyles returned is 'undefined'. Seems you forgot to wrap the components in "<Modal />" `}),[G2e,eE]=Ii({strict:!0,name:"ModalContext",errorMessage:"useModalContext: `context` is undefined. Seems you forgot to wrap modal components in `<Modal />`"}),hs=n=>{const e={scrollBehavior:"outside",autoFocus:!0,trapFocus:!0,returnFocusOnClose:!0,blockScrollOnMount:!0,allowPinchZoom:!1,preserveScrollBarGap:!0,motionPreset:"scale",...n,lockFocusAcrossFrames:n.lockFocusAcrossFrames||!0},{portalProps:i,children:o,autoFocus:l,trapFocus:u,initialFocusRef:f,finalFocusRef:_,returnFocusOnClose:E,blockScrollOnMount:b,allowPinchZoom:C,preserveScrollBarGap:I,motionPreset:P,lockFocusAcrossFrames:L,animatePresenceProps:M,onCloseComplete:F}=e,B=xa("Modal",e),K={...F2e(e),autoFocus:l,trapFocus:u,initialFocusRef:f,finalFocusRef:_,returnFocusOnClose:E,blockScrollOnMount:b,allowPinchZoom:C,preserveScrollBarGap:I,motionPreset:P,lockFocusAcrossFrames:L};return S.jsx(G2e,{value:K,children:S.jsx(z2e,{value:B,children:S.jsx(X0,{...M,onExitComplete:F,children:K.isOpen&&S.jsx(ru,{...i,children:o})})})})};hs.displayName="Modal";var bk="right-scroll-bar-position",wk="width-before-scroll-bar",H2e="with-scroll-bars-hidden",$2e="--removed-body-scroll-bar-size",_re=bne(),bU=function(){},eN=k.forwardRef(function(n,e){var i=k.useRef(null),o=k.useState({onScrollCapture:bU,onWheelCapture:bU,onTouchMoveCapture:bU}),l=o[0],u=o[1],f=n.forwardProps,_=n.children,E=n.className,b=n.removeScrollBar,C=n.enabled,I=n.shards,P=n.sideCar,L=n.noIsolation,M=n.inert,F=n.allowPinchZoom,B=n.as,Z=B===void 0?"div":B,K=n.gapMode,re=_R(n,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noIsolation","inert","allowPinchZoom","as","gapMode"]),ae=P,ne=Ene([i,e]),pe=rp(rp({},re),l);return k.createElement(k.Fragment,null,C&&k.createElement(ae,{sideCar:_re,removeScrollBar:b,shards:I,noIsolation:L,inert:M,setCallbacks:u,allowPinchZoom:!!F,lockRef:i,gapMode:K}),f?k.cloneElement(k.Children.only(_),rp(rp({},pe),{ref:ne})):k.createElement(Z,rp({},pe,{className:E,ref:ne}),_))});eN.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1};eN.classNames={fullWidth:wk,zeroRight:bk};var K2e=function(){if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function q2e(){if(!document)return null;var n=document.createElement("style");n.type="text/css";var e=K2e();return e&&n.setAttribute("nonce",e),n}function Y2e(n,e){n.styleSheet?n.styleSheet.cssText=e:n.appendChild(document.createTextNode(e))}function X2e(n){var e=document.head||document.getElementsByTagName("head")[0];e.appendChild(n)}var J2e=function(){var n=0,e=null;return{add:function(i){n==0&&(e=q2e())&&(Y2e(e,i),X2e(e)),n++},remove:function(){n--,!n&&e&&(e.parentNode&&e.parentNode.removeChild(e),e=null)}}},Q2e=function(){var n=J2e();return function(e,i){k.useEffect(function(){return n.add(e),function(){n.remove()}},[e&&i])}},yre=function(){var n=Q2e(),e=function(i){var o=i.styles,l=i.dynamic;return n(o,l),null};return e},Z2e={left:0,top:0,right:0,gap:0},wU=function(n){return parseInt(n||"",10)||0},eMe=function(n){var e=window.getComputedStyle(document.body),i=e[n==="padding"?"paddingLeft":"marginLeft"],o=e[n==="padding"?"paddingTop":"marginTop"],l=e[n==="padding"?"paddingRight":"marginRight"];return[wU(i),wU(o),wU(l)]},tMe=function(n){if(n===void 0&&(n="margin"),typeof window>"u")return Z2e;var e=eMe(n),i=document.documentElement.clientWidth,o=window.innerWidth;return{left:e[0],top:e[1],right:e[2],gap:Math.max(0,o-i+e[2]-e[0])}},nMe=yre(),g0="data-scroll-locked",rMe=function(n,e,i,o){var l=n.left,u=n.top,f=n.right,_=n.gap;return i===void 0&&(i="margin"),`
  .`.concat(H2e,` {
   overflow: hidden `).concat(o,`;
   padding-right: `).concat(_,"px ").concat(o,`;
  }
  body[`).concat(g0,`] {
    overflow: hidden `).concat(o,`;
    overscroll-behavior: contain;
    `).concat([e&&"position: relative ".concat(o,";"),i==="margin"&&`
    padding-left: `.concat(l,`px;
    padding-top: `).concat(u,`px;
    padding-right: `).concat(f,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(_,"px ").concat(o,`;
    `),i==="padding"&&"padding-right: ".concat(_,"px ").concat(o,";")].filter(Boolean).join(""),`
  }
  
  .`).concat(bk,` {
    right: `).concat(_,"px ").concat(o,`;
  }
  
  .`).concat(wk,` {
    margin-right: `).concat(_,"px ").concat(o,`;
  }
  
  .`).concat(bk," .").concat(bk,` {
    right: 0 `).concat(o,`;
  }
  
  .`).concat(wk," .").concat(wk,` {
    margin-right: 0 `).concat(o,`;
  }
  
  body[`).concat(g0,`] {
    `).concat($2e,": ").concat(_,`px;
  }
`)},AX=function(){var n=parseInt(document.body.getAttribute(g0)||"0",10);return isFinite(n)?n:0},iMe=function(){k.useEffect(function(){return document.body.setAttribute(g0,(AX()+1).toString()),function(){var n=AX()-1;n<=0?document.body.removeAttribute(g0):document.body.setAttribute(g0,n.toString())}},[])},sMe=function(n){var e=n.noRelative,i=n.noImportant,o=n.gapMode,l=o===void 0?"margin":o;iMe();var u=k.useMemo(function(){return tMe(l)},[l]);return k.createElement(nMe,{styles:rMe(u,!e,l,i?"":"!important")})},GV=!1;if(typeof window<"u")try{var BO=Object.defineProperty({},"passive",{get:function(){return GV=!0,!0}});window.addEventListener("test",BO,BO),window.removeEventListener("test",BO,BO)}catch{GV=!1}var LS=GV?{passive:!1}:!1,oMe=function(n){return n.tagName==="TEXTAREA"},Ere=function(n,e){if(!(n instanceof Element))return!1;var i=window.getComputedStyle(n);return i[e]!=="hidden"&&!(i.overflowY===i.overflowX&&!oMe(n)&&i[e]==="visible")},aMe=function(n){return Ere(n,"overflowY")},cMe=function(n){return Ere(n,"overflowX")},PX=function(n,e){var i=e.ownerDocument,o=e;do{typeof ShadowRoot<"u"&&o instanceof ShadowRoot&&(o=o.host);var l=vre(n,o);if(l){var u=Sre(n,o),f=u[1],_=u[2];if(f>_)return!0}o=o.parentNode}while(o&&o!==i.body);return!1},lMe=function(n){var e=n.scrollTop,i=n.scrollHeight,o=n.clientHeight;return[e,i,o]},uMe=function(n){var e=n.scrollLeft,i=n.scrollWidth,o=n.clientWidth;return[e,i,o]},vre=function(n,e){return n==="v"?aMe(e):cMe(e)},Sre=function(n,e){return n==="v"?lMe(e):uMe(e)},dMe=function(n,e){return n==="h"&&e==="rtl"?-1:1},hMe=function(n,e,i,o,l){var u=dMe(n,window.getComputedStyle(e).direction),f=u*o,_=i.target,E=e.contains(_),b=!1,C=f>0,I=0,P=0;do{var L=Sre(n,_),M=L[0],F=L[1],B=L[2],Z=F-B-u*M;(M||Z)&&vre(n,_)&&(I+=Z,P+=M),_ instanceof ShadowRoot?_=_.host:_=_.parentNode}while(!E&&_!==document.body||E&&(e.contains(_)||e===_));return(C&&Math.abs(I)<1||!C&&Math.abs(P)<1)&&(b=!0),b},WO=function(n){return"changedTouches"in n?[n.changedTouches[0].clientX,n.changedTouches[0].clientY]:[0,0]},OX=function(n){return[n.deltaX,n.deltaY]},kX=function(n){return n&&"current"in n?n.current:n},pMe=function(n,e){return n[0]===e[0]&&n[1]===e[1]},fMe=function(n){return`
  .block-interactivity-`.concat(n,` {pointer-events: none;}
  .allow-interactivity-`).concat(n,` {pointer-events: all;}
`)},mMe=0,MS=[];function gMe(n){var e=k.useRef([]),i=k.useRef([0,0]),o=k.useRef(),l=k.useState(mMe++)[0],u=k.useState(yre)[0],f=k.useRef(n);k.useEffect(function(){f.current=n},[n]),k.useEffect(function(){if(n.inert){document.body.classList.add("block-interactivity-".concat(l));var F=yDe([n.lockRef.current],(n.shards||[]).map(kX),!0).filter(Boolean);return F.forEach(function(B){return B.classList.add("allow-interactivity-".concat(l))}),function(){document.body.classList.remove("block-interactivity-".concat(l)),F.forEach(function(B){return B.classList.remove("allow-interactivity-".concat(l))})}}},[n.inert,n.lockRef.current,n.shards]);var _=k.useCallback(function(F,B){if("touches"in F&&F.touches.length===2||F.type==="wheel"&&F.ctrlKey)return!f.current.allowPinchZoom;var Z=WO(F),K=i.current,re="deltaX"in F?F.deltaX:K[0]-Z[0],ae="deltaY"in F?F.deltaY:K[1]-Z[1],ne,pe=F.target,X=Math.abs(re)>Math.abs(ae)?"h":"v";if("touches"in F&&X==="h"&&pe.type==="range")return!1;var J=PX(X,pe);if(!J)return!0;if(J?ne=X:(ne=X==="v"?"h":"v",J=PX(X,pe)),!J)return!1;if(!o.current&&"changedTouches"in F&&(re||ae)&&(o.current=ne),!ne)return!0;var Y=o.current||ne;return hMe(Y,B,F,Y==="h"?re:ae)},[]),E=k.useCallback(function(F){var B=F;if(!(!MS.length||MS[MS.length-1]!==u)){var Z="deltaY"in B?OX(B):WO(B),K=e.current.filter(function(ne){return ne.name===B.type&&(ne.target===B.target||B.target===ne.shadowParent)&&pMe(ne.delta,Z)})[0];if(K&&K.should){B.cancelable&&B.preventDefault();return}if(!K){var re=(f.current.shards||[]).map(kX).filter(Boolean).filter(function(ne){return ne.contains(B.target)}),ae=re.length>0?_(B,re[0]):!f.current.noIsolation;ae&&B.cancelable&&B.preventDefault()}}},[]),b=k.useCallback(function(F,B,Z,K){var re={name:F,delta:B,target:Z,should:K,shadowParent:_Me(Z)};e.current.push(re),setTimeout(function(){e.current=e.current.filter(function(ae){return ae!==re})},1)},[]),C=k.useCallback(function(F){i.current=WO(F),o.current=void 0},[]),I=k.useCallback(function(F){b(F.type,OX(F),F.target,_(F,n.lockRef.current))},[]),P=k.useCallback(function(F){b(F.type,WO(F),F.target,_(F,n.lockRef.current))},[]);k.useEffect(function(){return MS.push(u),n.setCallbacks({onScrollCapture:I,onWheelCapture:I,onTouchMoveCapture:P}),document.addEventListener("wheel",E,LS),document.addEventListener("touchmove",E,LS),document.addEventListener("touchstart",C,LS),function(){MS=MS.filter(function(F){return F!==u}),document.removeEventListener("wheel",E,LS),document.removeEventListener("touchmove",E,LS),document.removeEventListener("touchstart",C,LS)}},[]);var L=n.removeScrollBar,M=n.inert;return k.createElement(k.Fragment,null,M?k.createElement(u,{styles:fMe(l)}):null,L?k.createElement(sMe,{gapMode:n.gapMode}):null)}function _Me(n){for(var e=null;n!==null;)n instanceof ShadowRoot&&(e=n.host,n=n.host),n=n.parentNode;return e}const yMe=EDe(_re,gMe);var bre=k.forwardRef(function(n,e){return k.createElement(eN,rp({},n,{ref:e,sideCar:yMe}))});bre.classNames=eN.classNames;function EMe(n){const{autoFocus:e,trapFocus:i,dialogRef:o,initialFocusRef:l,blockScrollOnMount:u,allowPinchZoom:f,finalFocusRef:_,returnFocusOnClose:E,preserveScrollBarGap:b,lockFocusAcrossFrames:C,isOpen:I}=eE(),[P,L]=aF();k.useEffect(()=>{!P&&L&&setTimeout(L)},[P,L]);const M=gre(o,I);return S.jsx(Yne,{autoFocus:e,isDisabled:!i,initialFocusRef:l,finalFocusRef:_,restoreFocus:E,contentRef:o,lockFocusAcrossFrames:C,children:S.jsx(bre,{removeScrollBar:!b,allowPinchZoom:f,enabled:M===1&&u,forwardProps:!0,children:n.children})})}const vMe={initial:({offsetX:n,offsetY:e,transition:i,transitionEnd:o,delay:l})=>({opacity:0,x:n,y:e,transition:(i==null?void 0:i.exit)??zy.exit(Wy.exit,l),transitionEnd:o==null?void 0:o.exit}),enter:({transition:n,transitionEnd:e,delay:i})=>({opacity:1,x:0,y:0,transition:(n==null?void 0:n.enter)??zy.enter(Wy.enter,i),transitionEnd:e==null?void 0:e.enter}),exit:({offsetY:n,offsetX:e,transition:i,transitionEnd:o,reverse:l,delay:u})=>{const f={x:e,y:n};return{opacity:0,transition:(i==null?void 0:i.exit)??zy.exit(Wy.exit,u),...l?{...f,transitionEnd:o==null?void 0:o.exit}:{transitionEnd:{...f,...o==null?void 0:o.exit}}}}},tC={initial:"initial",animate:"enter",exit:"exit",variants:vMe},SMe=k.forwardRef(function(e,i){const{unmountOnExit:o,in:l,reverse:u=!0,className:f,offsetX:_=0,offsetY:E=8,transition:b,transitionEnd:C,delay:I,animatePresenceProps:P,...L}=e,M=o?l&&o:!0,F=l||o?"enter":"exit",B={offsetX:_,offsetY:E,reverse:u,transition:b,transitionEnd:C,delay:I};return S.jsx(X0,{...P,custom:B,children:M&&S.jsx(Ip.div,{ref:i,className:fn("chakra-offset-slide",f),custom:B,...tC,animate:F,...L})})});SMe.displayName="SlideFade";const bMe={exit:({reverse:n,initialScale:e,transition:i,transitionEnd:o,delay:l})=>({opacity:0,...n?{scale:e,transitionEnd:o==null?void 0:o.exit}:{transitionEnd:{scale:e,...o==null?void 0:o.exit}},transition:(i==null?void 0:i.exit)??zy.exit(Wy.exit,l)}),enter:({transitionEnd:n,transition:e,delay:i})=>({opacity:1,scale:1,transition:(e==null?void 0:e.enter)??zy.enter(Wy.enter,i),transitionEnd:n==null?void 0:n.enter})},wre={initial:"exit",animate:"enter",exit:"exit",variants:bMe},wMe=k.forwardRef(function(e,i){const{unmountOnExit:o,in:l,reverse:u=!0,initialScale:f=.95,className:_,transition:E,transitionEnd:b,delay:C,animatePresenceProps:I,...P}=e,L=o?l&&o:!0,M=l||o?"enter":"exit",F={initialScale:f,reverse:u,transition:E,transitionEnd:b,delay:C};return S.jsx(X0,{...I,custom:F,children:L&&S.jsx(Ip.div,{ref:i,className:fn("chakra-offset-slide",_),...wre,animate:M,custom:F,...P})})});wMe.displayName="ScaleFade";const TMe={slideInBottom:{...tC,custom:{offsetY:16,reverse:!0}},slideInRight:{...tC,custom:{offsetX:16,reverse:!0}},slideInTop:{...tC,custom:{offsetY:-16,reverse:!0}},slideInLeft:{...tC,custom:{offsetX:-16,reverse:!0}},scale:{...wre,custom:{initialScale:.95,reverse:!0}},none:{}},CMe=Ut(Ip.section),RMe=n=>TMe[n||"none"],Tre=k.forwardRef((n,e)=>{const{preset:i,motionProps:o=RMe(i),...l}=n;return S.jsx(CMe,{ref:e,...o,...l})});Tre.displayName="ModalTransition";const ps=Bt((n,e)=>{const{className:i,children:o,containerProps:l,motionProps:u,...f}=n,{getDialogProps:_,getDialogContainerProps:E}=eE(),b=_(f,e),C=E(l),I=fn("chakra-modal__content",i),P=tb(),L={display:"flex",flexDirection:"column",position:"relative",width:"100%",outline:0,...P.dialog},M={display:"flex",width:"100vw",height:"$100vh",position:"fixed",left:0,top:0,...P.dialogContainer},{motionPreset:F}=eE();return S.jsx(EMe,{children:S.jsx(Ut.div,{...C,className:"chakra-modal__content-container",tabIndex:-1,__css:M,children:S.jsx(Tre,{preset:F,motionProps:u,className:I,...b,__css:L,children:o})})})});ps.displayName="ModalContent";const bs=Bt((n,e)=>{const{className:i,...o}=n,{bodyId:l,setBodyMounted:u}=eE();k.useEffect(()=>(u(!0),()=>u(!1)),[u]);const f=fn("chakra-modal__body",i),_=tb();return S.jsx(Ut.div,{ref:e,className:f,id:l,...o,__css:_.body})});bs.displayName="ModalBody";const $s=Bt((n,e)=>{const{onClick:i,className:o,...l}=n,{onClose:u}=eE(),f=fn("chakra-modal__close-btn",o),_=tb();return S.jsx(BF,{ref:e,__css:_.closeButton,className:f,onClick:Nn(i,E=>{E.stopPropagation(),u()}),...l})});$s.displayName="ModalCloseButton";const Cp=Bt((n,e)=>{const{className:i,...o}=n,l=fn("chakra-modal__footer",i),u=tb(),f={display:"flex",alignItems:"center",justifyContent:"flex-end",...u.footer};return S.jsx(Ut.footer,{ref:e,...o,__css:f,className:l})});Cp.displayName="ModalFooter";const yo=Bt((n,e)=>{const{className:i,...o}=n,{headerId:l,setHeaderMounted:u}=eE();k.useEffect(()=>(u(!0),()=>u(!1)),[u]);const f=fn("chakra-modal__header",i),_=tb(),E={flex:0,..._.header};return S.jsx(Ut.header,{ref:e,className:f,id:l,...o,__css:E})});yo.displayName="ModalHeader";const IMe={enter:({transition:n,transitionEnd:e,delay:i}={})=>({opacity:1,transition:(n==null?void 0:n.enter)??zy.enter(Wy.enter,i),transitionEnd:e==null?void 0:e.enter}),exit:({transition:n,transitionEnd:e,delay:i}={})=>({opacity:0,transition:(n==null?void 0:n.exit)??zy.exit(Wy.exit,i),transitionEnd:e==null?void 0:e.exit})},Cre={initial:"exit",animate:"enter",exit:"exit",variants:IMe},AMe=k.forwardRef(function(e,i){const{unmountOnExit:o,in:l,className:u,transition:f,transitionEnd:_,delay:E,animatePresenceProps:b,...C}=e,I=l||o?"enter":"exit",P=o?l&&o:!0,L={transition:f,transitionEnd:_,delay:E};return S.jsx(X0,{...b,custom:L,children:P&&S.jsx(Ip.div,{ref:i,className:fn("chakra-fade",u),custom:L,...Cre,animate:I,...C})})});AMe.displayName="Fade";const PMe=Ut(Ip.div),fs=Bt((n,e)=>{const{className:i,transition:o,motionProps:l,...u}=n,f=fn("chakra-modal__overlay",i),E={pos:"fixed",left:"0",top:"0",w:"100vw",h:"100vh",...tb().overlay},{motionPreset:b}=eE(),I=l||(b==="none"?{}:Cre);return S.jsx(PMe,{...I,__css:E,ref:e,className:f,...u})});fs.displayName="ModalOverlay";function OMe(n){const{leastDestructiveRef:e,...i}=n;return S.jsx(hs,{...i,initialFocusRef:e})}const kMe=Bt((n,e)=>S.jsx(ps,{ref:e,role:"alertdialog",...n})),NMe=n=>S.jsx(vn,{viewBox:"0 0 24 24",...n,children:S.jsx("path",{fill:"currentColor",d:"M21,5H3C2.621,5,2.275,5.214,2.105,5.553C1.937,5.892,1.973,6.297,2.2,6.6l9,12 c0.188,0.252,0.485,0.4,0.8,0.4s0.611-0.148,0.8-0.4l9-12c0.228-0.303,0.264-0.708,0.095-1.047C21.725,5.214,21.379,5,21,5z"})}),DMe=n=>S.jsx(vn,{viewBox:"0 0 24 24",...n,children:S.jsx("path",{fill:"currentColor",d:"M12.8,5.4c-0.377-0.504-1.223-0.504-1.6,0l-9,12c-0.228,0.303-0.264,0.708-0.095,1.047 C2.275,18.786,2.621,19,3,19h18c0.379,0,0.725-0.214,0.895-0.553c0.169-0.339,0.133-0.744-0.095-1.047L12.8,5.4z"})});function NX(n,e,i,o){k.useEffect(()=>{if(!n.current||!o)return;const l=n.current.ownerDocument.defaultView??window,u=Array.isArray(e)?e:[e],f=new l.MutationObserver(_=>{for(const E of _)E.type==="attributes"&&E.attributeName&&u.includes(E.attributeName)&&i(E)});return f.observe(n.current,{attributes:!0,attributeFilter:u}),()=>f.disconnect()})}const xMe=50,DX=300;function LMe(n,e){const[i,o]=k.useState(!1),[l,u]=k.useState(null),[f,_]=k.useState(!0),E=k.useRef(null),b=()=>clearTimeout(E.current);wve(()=>{l==="increment"&&n(),l==="decrement"&&e()},i?xMe:null);const C=k.useCallback(()=>{f&&n(),E.current=setTimeout(()=>{_(!1),o(!0),u("increment")},DX)},[n,f]),I=k.useCallback(()=>{f&&e(),E.current=setTimeout(()=>{_(!1),o(!0),u("decrement")},DX)},[e,f]),P=k.useCallback(()=>{_(!0),o(!1),b()},[]);return k.useEffect(()=>()=>b(),[]),{up:C,down:I,stop:P,isSpinning:i}}const MMe=/^[Ee0-9+\-.]$/;function UMe(n){return MMe.test(n)}function VMe(n,e){if(n.key==null)return!0;const i=n.ctrlKey||n.altKey||n.metaKey;return!(n.key.length===1)||i?!0:e(n.key)}function jMe(n={}){const{focusInputOnChange:e=!0,clampValueOnBlur:i=!0,keepWithinRange:o=!0,min:l=Number.MIN_SAFE_INTEGER,max:u=Number.MAX_SAFE_INTEGER,step:f=1,isReadOnly:_,isDisabled:E,isRequired:b,isInvalid:C,pattern:I="[0-9]*(.[0-9]+)?",inputMode:P="decimal",allowMouseWheel:L,id:M,onChange:F,precision:B,name:Z,"aria-describedby":K,"aria-label":re,"aria-labelledby":ae,onFocus:ne,onBlur:pe,onInvalid:X,getAriaValueText:J,isValidCharacter:Y,format:ie,parse:le,...de}=n,ue=ro(ne),Oe=ro(pe),Ve=ro(X),xe=ro(Y??UMe),Re=ro(J),ve=lve(n),{update:be,increment:We,decrement:Pe}=ve,[Te,ke]=k.useState(!1),Ue=!(_||E),Be=k.useRef(null),qe=k.useRef(null),$e=k.useRef(null),st=k.useRef(null),Je=k.useCallback(wt=>wt.split("").filter(xe).join(""),[xe]),Rt=k.useCallback(wt=>(le==null?void 0:le(wt))??wt,[le]),kt=k.useCallback(wt=>((ie==null?void 0:ie(wt))??wt).toString(),[ie]);Xf(()=>{(ve.valueAsNumber>u||ve.valueAsNumber<l)&&(Ve==null||Ve("rangeOverflow",kt(ve.value),ve.valueAsNumber))},[ve.valueAsNumber,ve.value,kt,Ve]),dp(()=>{if(!Be.current)return;if(Be.current.value!=ve.value){const ir=Rt(Be.current.value);ve.setValue(Je(ir))}},[Rt,Je]);const He=k.useCallback((wt=f)=>{Ue&&We(wt)},[We,Ue,f]),ut=k.useCallback((wt=f)=>{Ue&&Pe(wt)},[Pe,Ue,f]),mt=LMe(He,ut);NX($e,"disabled",mt.stop,mt.isSpinning),NX(st,"disabled",mt.stop,mt.isSpinning);const Lt=k.useCallback(wt=>{if(wt.nativeEvent.isComposing)return;const Vt=Rt(wt.currentTarget.value);be(Je(Vt)),qe.current={start:wt.currentTarget.selectionStart,end:wt.currentTarget.selectionEnd}},[be,Je,Rt]),Xt=k.useCallback(wt=>{var ir;ue==null||ue(wt),qe.current&&(wt.currentTarget.selectionStart=qe.current.start??((ir=wt.currentTarget.value)==null?void 0:ir.length),wt.currentTarget.selectionEnd=qe.current.end??wt.currentTarget.selectionStart)},[ue]),$t=k.useCallback(wt=>{if(wt.nativeEvent.isComposing)return;VMe(wt,xe)||wt.preventDefault();const ir=we(wt)*f,Vt=wt.key,_n={ArrowUp:()=>He(ir),ArrowDown:()=>ut(ir),Home:()=>be(l),End:()=>be(u)}[Vt];_n&&(wt.preventDefault(),_n(wt))},[xe,f,He,ut,be,l,u]),we=wt=>{let ir=1;return(wt.metaKey||wt.ctrlKey)&&(ir=.1),wt.shiftKey&&(ir=10),ir},je=k.useMemo(()=>{const wt=Re==null?void 0:Re(ve.value);if(wt!=null)return wt;const ir=ve.value.toString();return ir||void 0},[ve.value,Re]),Ke=k.useCallback(()=>{let wt=ve.value;if(ve.value==="")return;/^[eE]/.test(ve.value.toString())?ve.setValue(""):(ve.valueAsNumber<l&&(wt=l),ve.valueAsNumber>u&&(wt=u),ve.cast(wt))},[ve,u,l]),gt=k.useCallback(()=>{ke(!1),i&&Ke()},[i,ke,Ke]),Et=k.useCallback(()=>{e&&requestAnimationFrame(()=>{var wt;(wt=Be.current)==null||wt.focus()})},[e]),Tt=k.useCallback(wt=>{wt.preventDefault(),mt.up(),Et()},[Et,mt]),Kt=k.useCallback(wt=>{wt.preventDefault(),mt.down(),Et()},[Et,mt]);Uy(()=>Be.current,"wheel",wt=>{var Ui;const Vt=(((Ui=Be.current)==null?void 0:Ui.ownerDocument)??document).activeElement===Be.current;if(!L||!Vt)return;wt.preventDefault();const zt=we(wt)*f,_n=Math.sign(wt.deltaY);_n===-1?He(zt):_n===1&&ut(zt)},{passive:!1});const gn=k.useCallback((wt={},ir=null)=>{const Vt=E||o&&ve.isAtMax;return{...wt,ref:zi(ir,$e),role:"button",tabIndex:-1,onPointerDown:Nn(wt.onPointerDown,zt=>{zt.button!==0||Vt||Tt(zt)}),onPointerLeave:Nn(wt.onPointerLeave,mt.stop),onPointerUp:Nn(wt.onPointerUp,mt.stop),disabled:Vt,"aria-disabled":zf(Vt)}},[ve.isAtMax,o,Tt,mt.stop,E]),Sn=k.useCallback((wt={},ir=null)=>{const Vt=E||o&&ve.isAtMin;return{...wt,ref:zi(ir,st),role:"button",tabIndex:-1,onPointerDown:Nn(wt.onPointerDown,zt=>{zt.button!==0||Vt||Kt(zt)}),onPointerLeave:Nn(wt.onPointerLeave,mt.stop),onPointerUp:Nn(wt.onPointerUp,mt.stop),disabled:Vt,"aria-disabled":zf(Vt)}},[ve.isAtMin,o,Kt,mt.stop,E]),sn=k.useCallback((wt={},ir=null)=>({name:Z,inputMode:P,type:"text",pattern:I,"aria-labelledby":ae,"aria-label":re,"aria-describedby":K,id:M,disabled:E,role:"spinbutton",...wt,readOnly:wt.readOnly??_,"aria-readonly":wt.readOnly??_,"aria-required":wt.required??b,required:wt.required??b,ref:zi(Be,ir),value:kt(ve.value),"aria-valuemin":l,"aria-valuemax":u,"aria-valuenow":Number.isNaN(ve.valueAsNumber)?void 0:ve.valueAsNumber,"aria-invalid":zf(C??ve.isOutOfRange),"aria-valuetext":je,autoComplete:"off",autoCorrect:"off",onChange:Nn(wt.onChange,Lt),onKeyDown:Nn(wt.onKeyDown,$t),onFocus:Nn(wt.onFocus,Xt,()=>ke(!0)),onBlur:Nn(wt.onBlur,Oe,gt)}),[Z,P,I,ae,re,kt,K,M,E,b,_,C,ve.value,ve.valueAsNumber,ve.isOutOfRange,l,u,je,Lt,$t,Xt,Oe,gt]);return{value:kt(ve.value),valueAsNumber:ve.valueAsNumber,isFocused:Te,isDisabled:E,isReadOnly:_,getIncrementButtonProps:gn,getDecrementButtonProps:Sn,getInputProps:sn,htmlProps:de}}const[FMe,tN]=Ii({name:"NumberInputStylesContext",errorMessage:`useNumberInputStyles returned is 'undefined'. Seems you forgot to wrap the components in "<NumberInput />" `}),[BMe,m4]=Ii({name:"NumberInputContext",errorMessage:"useNumberInputContext: `context` is undefined. Seems you forgot to wrap number-input's components within <NumberInput />"}),Bs=Bt(function(e,i){const o=xa("NumberInput",e),l=Mi(e),u=HF(l),{htmlProps:f,..._}=jMe(u),E=k.useMemo(()=>_,[_]);return S.jsx(BMe,{value:E,children:S.jsx(FMe,{value:o,children:S.jsx(Ut.div,{...f,ref:i,className:fn("chakra-numberinput",e.className),__css:{position:"relative",zIndex:0,...o.root}})})})});Bs.displayName="NumberInput";const Ws=Bt(function(e,i){const o=tN();return S.jsx(Ut.div,{"aria-hidden":!0,ref:i,...e,__css:{display:"flex",flexDirection:"column",position:"absolute",top:"0",insetEnd:"0px",margin:"1px",height:"calc(100% - 2px)",zIndex:1,...o.stepperGroup}})});Ws.displayName="NumberInputStepper";const zs=Bt(function(e,i){const{getInputProps:o}=m4(),l=o(e,i),u=tN();return S.jsx(Ut.input,{...l,className:fn("chakra-numberinput__field",e.className),__css:{width:"100%",...u.field}})});zs.displayName="NumberInputField";const Rre=Ut("div",{baseStyle:{display:"flex",justifyContent:"center",alignItems:"center",flex:1,transitionProperty:"common",transitionDuration:"normal",userSelect:"none",cursor:"pointer",lineHeight:"normal"}}),Gs=Bt(function(e,i){const o=tN(),{getDecrementButtonProps:l}=m4(),u=l(e,i);return S.jsx(Rre,{...u,__css:o.stepper,children:e.children??S.jsx(NMe,{})})});Gs.displayName="NumberDecrementStepper";const Hs=Bt(function(e,i){const{getIncrementButtonProps:o}=m4(),l=o(e,i),u=tN();return S.jsx(Rre,{...l,__css:u.stepper,children:e.children??S.jsx(DMe,{})})});Hs.displayName="NumberIncrementStepper";const[WMe,nN]=Ii({name:"PopoverContext",errorMessage:"usePopoverContext: `context` is undefined. Seems you forgot to wrap all popover components within `<Popover />`"}),[zMe,Ire]=Ii({name:"PopoverStylesContext",errorMessage:`usePopoverStyles returned is 'undefined'. Seems you forgot to wrap the components in "<Popover />" `}),US={click:"click",hover:"hover"};function GMe(n={}){const{closeOnBlur:e=!0,closeOnEsc:i=!0,initialFocusRef:o,id:l,returnFocusOnClose:u=!0,autoFocus:f=!0,arrowSize:_,arrowShadowColor:E,trigger:b=US.click,openDelay:C=200,closeDelay:I=200,isLazy:P,lazyBehavior:L="unmount",computePositionOnMount:M,...F}=n,{isOpen:B,onClose:Z,onOpen:K,onToggle:re}=Xd(n),[ae,ne]=k.useState(u);k.useEffect(()=>ne(u),[u]);const pe=k.useRef(null),X=k.useRef(null),J=k.useRef(null),Y=k.useRef(!1),ie=k.useRef(!1);B&&(ie.current=!0);const[le,de]=k.useState(!1),[ue,Oe]=k.useState(!1),Ve=k.useId(),xe=l??Ve,[Re,ve,be,We]=["popover-trigger","popover-content","popover-header","popover-body"].map($t=>`${$t}-${xe}`),{referenceRef:Pe,getArrowProps:Te,getPopperProps:ke,getArrowInnerProps:Ue,forceUpdate:Be}=f4({...F,enabled:B||!!M}),qe=MZ({isOpen:B,ref:J});vve({enabled:B,ref:X}),jZ(J,{focusRef:X,visible:B,shouldFocus:ae&&b===US.click}),hve(J,{focusRef:o,visible:B,shouldFocus:f&&b===US.click}),WZ({enabled:B&&e,ref:J,handler($t){var je;const we=((je=$t.composedPath)==null?void 0:je.call($t)[0])??[$t.target];zO(X.current,we)||(we&&ne(!Fk(we)),Z())}});const $e=Vj({wasSelected:ie.current,enabled:P,mode:L,isSelected:qe.present}),st=k.useCallback(($t={},we=null)=>{const je={...$t,style:{...$t.style,transformOrigin:mo.transformOrigin.varRef,[mo.arrowSize.var]:_?`${_}px`:void 0,[mo.arrowShadowColor.var]:E},ref:zi(J,we),children:$e?$t.children:null,id:ve,tabIndex:-1,role:"dialog",onKeyDown:Nn($t.onKeyDown,Ke=>{Ke.nativeEvent.isComposing||i&&Ke.key==="Escape"&&(Ke.preventDefault(),Ke.stopPropagation(),Z())}),onBlur:Nn($t.onBlur,Ke=>{const gt=xX(Ke),Et=zO(J.current,gt),Tt=zO(X.current,gt),Kt=!Et&&!Tt;gt&&ne(!Fk(gt)),B&&e&&Kt&&Z()}),"aria-labelledby":le?be:void 0,"aria-describedby":ue?We:void 0};return b===US.hover&&(je.role="tooltip",je.onMouseEnter=Nn($t.onMouseEnter,()=>{Y.current=!0}),je.onMouseLeave=Nn($t.onMouseLeave,Ke=>{Ke.nativeEvent.relatedTarget!==null&&(Y.current=!1,setTimeout(()=>Z(),I))})),je},[$e,ve,le,be,ue,We,b,i,Z,B,e,I,E,_]),Je=k.useCallback(($t={},we=null)=>ke({...$t,style:{visibility:B?"visible":"hidden",...$t.style}},we),[B,ke]),Rt=k.useCallback(($t,we=null)=>({...$t,ref:zi(we,pe,Pe)}),[pe,Pe]),kt=k.useRef(void 0),He=k.useRef(void 0),ut=k.useCallback($t=>{pe.current==null&&Pe($t)},[Pe]),mt=k.useCallback(($t={},we=null)=>{const je={...$t,ref:zi(X,we,ut),id:Re,"aria-haspopup":"dialog","aria-expanded":B,"aria-controls":ve};return b===US.click&&(je.onClick=Nn($t.onClick,re)),b===US.hover&&(je.onFocus=Nn($t.onFocus,()=>{kt.current===void 0&&K()}),je.onBlur=Nn($t.onBlur,Ke=>{const gt=xX(Ke),Et=!zO(J.current,gt);B&&e&&Et&&Z()}),je.onKeyDown=Nn($t.onKeyDown,Ke=>{Ke.key==="Escape"&&Z()}),je.onMouseEnter=Nn($t.onMouseEnter,()=>{Y.current=!0,kt.current=window.setTimeout(()=>K(),C)}),je.onMouseLeave=Nn($t.onMouseLeave,()=>{Y.current=!1,kt.current&&(clearTimeout(kt.current),kt.current=void 0),He.current=window.setTimeout(()=>{Y.current===!1&&Z()},I)})),je},[Re,B,ve,b,ut,re,K,e,Z,C,I]);k.useEffect(()=>()=>{kt.current&&clearTimeout(kt.current),He.current&&clearTimeout(He.current)},[]);const Lt=k.useCallback(($t={},we=null)=>({...$t,id:be,ref:zi(we,je=>{de(!!je)})}),[be]),Xt=k.useCallback(($t={},we=null)=>({...$t,id:We,ref:zi(we,je=>{Oe(!!je)})}),[We]);return{forceUpdate:Be,isOpen:B,onAnimationComplete:qe.onComplete,onClose:Z,getAnchorProps:Rt,getArrowProps:Te,getArrowInnerProps:Ue,getPopoverPositionerProps:Je,getPopoverProps:st,getTriggerProps:mt,getHeaderProps:Lt,getBodyProps:Xt}}function zO(n,e){return n===e||(n==null?void 0:n.contains(e))}function xX(n){const e=n.currentTarget.ownerDocument.activeElement;return n.relatedTarget??e}function Are(n){const e=xa("Popover",n),{children:i,...o}=Mi(n),l=Z0(),u=GMe({...o,direction:l.direction});return S.jsx(WMe,{value:u,children:S.jsx(zMe,{value:e,children:gl(i,{isOpen:u.isOpen,onClose:u.onClose,forceUpdate:u.forceUpdate})})})}Are.displayName="Popover";function Pre(n){var i;const e=k.version;return typeof e!="string"||e.startsWith("18.")?n==null?void 0:n.ref:(i=n==null?void 0:n.props)==null?void 0:i.ref}const Ore=Bt(function(e,i){const{getBodyProps:o}=nN(),l=Ire();return S.jsx(Ut.div,{...o(e,i),className:fn("chakra-popover__body",e.className),__css:l.body})});Ore.displayName="PopoverBody";function HMe(n){if(n)return{enter:{...n.enter,visibility:"visible"},exit:{...n.exit,transitionEnd:{visibility:"hidden"}}}}const $Me={exit:{opacity:0,scale:.95,transition:{duration:.1,ease:[.4,0,1,1]}},enter:{scale:1,opacity:1,transition:{duration:.15,ease:[0,0,.2,1]}}},KMe=Ut(Ip.section),kre=Bt(function(e,i){const{variants:o=$Me,...l}=e,{isOpen:u}=nN();return S.jsx(KMe,{ref:i,variants:HMe(o),initial:!1,animate:u?"enter":"exit",...l})});kre.displayName="PopoverTransition";const Nre=Bt(function(e,i){const{rootProps:o,motionProps:l,...u}=e,{getPopoverProps:f,getPopoverPositionerProps:_,onAnimationComplete:E}=nN(),b=Ire(),C={position:"relative",display:"flex",flexDirection:"column",...b.content};return S.jsx(Ut.div,{..._(o),__css:b.popper,className:"chakra-popover__popper",children:S.jsx(kre,{...l,...f(u,i),onAnimationComplete:OZ(E,u.onAnimationComplete),className:fn("chakra-popover__content",e.className),__css:C})})});Nre.displayName="PopoverContent";function Dre(n){const e=k.Children.only(n.children),{getTriggerProps:i}=nN();return S.jsx(S.Fragment,{children:k.cloneElement(e,i(e.props,Pre(e)))})}Dre.displayName="PopoverTrigger";function qMe(n,e,i){return(n-e)*100/(i-e)}uR({"0%":{strokeDasharray:"1, 400",strokeDashoffset:"0"},"50%":{strokeDasharray:"400, 400",strokeDashoffset:"-100"},"100%":{strokeDasharray:"400, 400",strokeDashoffset:"-260"}});uR({"0%":{transform:"rotate(0deg)"},"100%":{transform:"rotate(360deg)"}});const YMe=uR({"0%":{left:"-40%"},"100%":{left:"100%"}}),XMe=uR({from:{backgroundPosition:"1rem 0"},to:{backgroundPosition:"0 0"}});function JMe(n){const{value:e=0,min:i,max:o,valueText:l,getValueText:u,isIndeterminate:f,role:_="progressbar"}=n,E=qMe(e,i,o);return{bind:{"data-indeterminate":f?"":void 0,"aria-valuemax":o,"aria-valuemin":i,"aria-valuenow":f?void 0:e,"aria-valuetext":(()=>{if(e!=null)return typeof u=="function"?u(e,E):l})(),role:_},percent:E,value:e}}const[QMe,ZMe]=Ii({name:"ProgressStylesContext",errorMessage:`useProgressStyles returned is 'undefined'. Seems you forgot to wrap the components in "<Progress />" `}),eUe=Bt((n,e)=>{const{min:i,max:o,value:l,isIndeterminate:u,role:f,..._}=n,E=JMe({value:l,min:i,max:o,isIndeterminate:u,role:f}),C={height:"100%",...ZMe().filledTrack};return S.jsx(Ut.div,{ref:e,style:{width:`${E.percent}%`,..._.style},...E.bind,..._,__css:C})}),Ky=Bt((n,e)=>{var X;const{value:i,min:o=0,max:l=100,hasStripe:u,isAnimated:f,children:_,borderRadius:E,isIndeterminate:b,"aria-label":C,"aria-labelledby":I,"aria-valuetext":P,title:L,role:M,...F}=Mi(n),B=xa("Progress",n),Z=E??((X=B.track)==null?void 0:X.borderRadius),K={animation:`${XMe} 1s linear infinite`},ne={...!b&&u&&f&&K,...b&&{position:"absolute",willChange:"left",minWidth:"50%",animation:`${YMe} 1s ease infinite normal none running`}},pe={overflow:"hidden",position:"relative",...B.track};return S.jsx(Ut.div,{ref:e,borderRadius:Z,__css:pe,...F,children:S.jsxs(QMe,{value:B,children:[S.jsx(eUe,{"aria-label":C,"aria-labelledby":I,"aria-valuetext":P,min:o,max:l,value:i,isIndeterminate:b,css:ne,borderRadius:Z,title:L,role:M}),_]})})});Ky.displayName="Progress";const xre=Bt(function(e,i){const{children:o,placeholder:l,className:u,...f}=e;return S.jsxs(Ut.select,{...f,ref:i,className:fn("chakra-select",u),children:[l&&S.jsx("option",{value:"",children:l}),o]})});xre.displayName="SelectField";const Lre=Bt((n,e)=>{var re;const i=xa("Select",n),{rootProps:o,placeholder:l,icon:u,color:f,height:_,h:E,minH:b,minHeight:C,iconColor:I,iconSize:P,...L}=Mi(n),[M,F]=nve(L,SSe),B=GF(F),Z={width:"100%",height:"fit-content",position:"relative",color:f},K={paddingEnd:"2rem",...i.field,_focus:{zIndex:"unset",...(re=i.field)==null?void 0:re._focus}};return S.jsxs(Ut.div,{className:"chakra-select__wrapper",__css:Z,...M,...o,children:[S.jsx(xre,{ref:e,height:E??_,minH:b??C,placeholder:l,...B,__css:K,children:n.children}),S.jsx(Mre,{"data-disabled":nr(B.disabled),...(I||f)&&{color:I||f},__css:i.icon,...P&&{fontSize:P},children:u})]})});Lre.displayName="Select";const tUe=n=>S.jsx("svg",{viewBox:"0 0 24 24",...n,children:S.jsx("path",{fill:"currentColor",d:"M16.59 8.59L12 13.17 7.41 8.59 6 10l6 6 6-6z"})}),nUe=Ut("div",{baseStyle:{position:"absolute",display:"inline-flex",alignItems:"center",justifyContent:"center",pointerEvents:"none",top:"50%",transform:"translateY(-50%)"}}),Mre=n=>{const{children:e=S.jsx(tUe,{}),...i}=n,o=k.cloneElement(e,{role:"presentation",className:"chakra-select__icon",focusable:!1,"aria-hidden":!0,style:{width:"1em",height:"1em",color:"currentColor"}});return S.jsx(nUe,{...i,className:"chakra-select__icon-wrapper",children:k.isValidElement(e)?o:null})};Mre.displayName="SelectIcon";function TU(n){const{orientation:e,vertical:i,horizontal:o}=n;return e==="vertical"?i:o}function rUe(n){const{orientation:e,thumbPercents:i,isReversed:o}=n,l=L=>({position:"absolute",userSelect:"none",WebkitUserSelect:"none",MozUserSelect:"none",msUserSelect:"none",touchAction:"none",...TU({orientation:e,vertical:{bottom:`calc(${i[L]}% - var(--slider-thumb-size) / 2)`},horizontal:{left:`calc(${i[L]}% - var(--slider-thumb-size) / 2)`}})}),u={position:"relative",touchAction:"none",WebkitTapHighlightColor:"rgba(0,0,0,0)",userSelect:"none",outline:0},f={position:"absolute",...TU({orientation:e,vertical:{left:"50%",transform:"translateX(-50%)",height:"100%"},horizontal:{top:"50%",transform:"translateY(-50%)",width:"100%"}})},_=i.length===1,E=[0,o?100-i[0]:i[0]],b=_?E:i;let C=b[0];!_&&o&&(C=100-C);const I=Math.abs(b[b.length-1]-b[0]),P={...f,...TU({orientation:e,vertical:o?{height:`${I}%`,top:`${C}%`}:{height:`${I}%`,bottom:`${C}%`},horizontal:o?{width:`${I}%`,right:`${C}%`}:{width:`${I}%`,left:`${C}%`}})};return{trackStyle:f,innerTrackStyle:P,rootStyle:u,getThumbStyle:l}}function iUe(n){const{isReversed:e,direction:i,orientation:o}=n;return i==="ltr"||o==="vertical"?e:!e}function sUe(n){const{min:e=0,max:i=100,onChange:o,value:l,defaultValue:u,isReversed:f,direction:_="ltr",orientation:E="horizontal",id:b,isDisabled:C,isReadOnly:I,onChangeStart:P,onChangeEnd:L,step:M=1,getAriaValueText:F,"aria-valuetext":B,"aria-label":Z,"aria-labelledby":K,name:re,focusThumbOnChange:ae=!0,...ne}=n,pe=ro(P),X=ro(L),J=ro(F),Y=iUe({isReversed:f,direction:_,orientation:E}),[ie,le]=UZ({value:l,defaultValue:u??aUe(e,i),onChange:o}),[de,ue]=k.useState(!1),[Oe,Ve]=k.useState(!1),xe=!(C||I),Re=(i-e)/10,ve=M||(i-e)/100,be=sk(ie,e,i),We=i-be+e,Te=FK(Y?We:be,e,i),ke=E==="vertical",Ue=BZ({min:e,max:i,step:M,isDisabled:C,value:be,isInteractive:xe,isReversed:Y,isVertical:ke,eventSource:null,focusThumbOnChange:ae,orientation:E}),Be=k.useRef(null),qe=k.useRef(null),$e=k.useRef(null),st=k.useId(),Je=b??st,[Rt,kt]=[`slider-thumb-${Je}`,`slider-track-${Je}`],He=k.useCallback(Vt=>{var ao;if(!Be.current)return;const zt=Ue.current;zt.eventSource="pointer";const _n=Be.current.getBoundingClientRect(),{clientX:Ui,clientY:Ts}=((ao=Vt.touches)==null?void 0:ao[0])??Vt,ui=ke?_n.bottom-Ts:Ui-_n.left,na=ke?_n.height:_n.width;let dc=ui/na;Y&&(dc=1-dc);let oo=QEe(dc,zt.min,zt.max);return zt.step&&(oo=parseFloat(BK(oo,zt.min,zt.step))),oo=sk(oo,zt.min,zt.max),oo},[ke,Y,Ue]),ut=k.useCallback(Vt=>{const zt=Ue.current;zt.isInteractive&&(Vt=parseFloat(BK(Vt,zt.min,ve)),Vt=sk(Vt,zt.min,zt.max),le(Vt))},[ve,le,Ue]),mt=k.useMemo(()=>({stepUp(Vt=ve){const zt=Y?be-Vt:be+Vt;ut(zt)},stepDown(Vt=ve){const zt=Y?be+Vt:be-Vt;ut(zt)},reset(){ut(u||0)},stepTo(Vt){ut(Vt)}}),[ut,Y,be,ve,u]),Lt=k.useCallback(Vt=>{const zt=Ue.current,Ui={ArrowRight:()=>mt.stepUp(),ArrowUp:()=>mt.stepUp(),ArrowLeft:()=>mt.stepDown(),ArrowDown:()=>mt.stepDown(),PageUp:()=>mt.stepUp(Re),PageDown:()=>mt.stepDown(Re),Home:()=>ut(zt.min),End:()=>ut(zt.max)}[Vt.key];Ui&&(Vt.preventDefault(),Vt.stopPropagation(),Ui(Vt),zt.eventSource="keyboard")},[mt,ut,Re,Ue]),Xt=(J==null?void 0:J(be))??B,{getThumbStyle:$t,rootStyle:we,trackStyle:je,innerTrackStyle:Ke}=k.useMemo(()=>{const Vt=Ue.current;return rUe({isReversed:Y,orientation:Vt.orientation,thumbPercents:[Te]})},[Y,Te,Ue]),gt=k.useCallback(()=>{Ue.current.focusThumbOnChange&&setTimeout(()=>{var zt;return(zt=qe.current)==null?void 0:zt.focus()})},[Ue]);Xf(()=>{const Vt=Ue.current;gt(),Vt.eventSource==="keyboard"&&(X==null||X(Vt.value))},[be,X]);function Et(Vt){const zt=He(Vt);zt!=null&&zt!==Ue.current.value&&le(zt)}Bve($e,{onPanSessionStart(Vt){const zt=Ue.current;zt.isInteractive&&(ue(!0),gt(),Et(Vt),pe==null||pe(zt.value))},onPanSessionEnd(){const Vt=Ue.current;Vt.isInteractive&&(ue(!1),X==null||X(Vt.value))},onPan(Vt){Ue.current.isInteractive&&Et(Vt)}});const Tt=k.useCallback((Vt={},zt=null)=>({...Vt,...ne,ref:zi(zt,$e),tabIndex:-1,"aria-disabled":zf(C),"data-focused":nr(Oe),style:{...Vt.style,...we}}),[ne,C,Oe,we]),Kt=k.useCallback((Vt={},zt=null)=>({...Vt,ref:zi(zt,Be),id:kt,"data-disabled":nr(C),style:{...Vt.style,...je}}),[C,kt,je]),gn=k.useCallback((Vt={},zt=null)=>({...Vt,ref:zt,style:{...Vt.style,...Ke}}),[Ke]),Sn=k.useCallback((Vt={},zt=null)=>({...Vt,ref:zi(zt,qe),role:"slider",tabIndex:xe?0:void 0,id:Rt,"data-active":nr(de),"aria-valuetext":Xt,"aria-valuemin":e,"aria-valuemax":i,"aria-valuenow":be,"aria-orientation":E,"aria-disabled":zf(C),"aria-readonly":zf(I),"aria-label":Z,"aria-labelledby":Z?void 0:K,style:{...Vt.style,...$t(0)},onKeyDown:Nn(Vt.onKeyDown,Lt),onFocus:Nn(Vt.onFocus,()=>Ve(!0)),onBlur:Nn(Vt.onBlur,()=>Ve(!1))}),[xe,Rt,de,Xt,e,i,be,E,C,I,Z,K,$t,Lt]),sn=k.useCallback((Vt,zt=null)=>{const _n=!(Vt.value<e||Vt.value>i),Ui=be>=Vt.value,Ts=FK(Vt.value,e,i),ui={position:"absolute",pointerEvents:"none",...oUe({orientation:E,vertical:{bottom:Y?`${100-Ts}%`:`${Ts}%`},horizontal:{left:Y?`${100-Ts}%`:`${Ts}%`}})};return{...Vt,ref:zt,role:"presentation","aria-hidden":!0,"data-disabled":nr(C),"data-invalid":nr(!_n),"data-highlighted":nr(Ui),style:{...Vt.style,...ui}}},[C,Y,i,e,E,be]),wt=k.useCallback((Vt={},zt=null)=>({...Vt,ref:zt,type:"hidden",value:be,name:re}),[re,be]);return{state:{value:be,isFocused:Oe,isDragging:de},actions:mt,getRootProps:Tt,getTrackProps:Kt,getInnerTrackProps:gn,getThumbProps:Sn,getMarkerProps:sn,getInputProps:wt}}function oUe(n){const{orientation:e,vertical:i,horizontal:o}=n;return e==="vertical"?i:o}function aUe(n,e){return e<n?n:n+(e-n)/2}const[cUe,rN]=Ii({name:"SliderContext",hookName:"useSliderContext",providerName:"<Slider />"}),[lUe,iN]=Ii({name:"SliderStylesContext",hookName:"useSliderStyles",providerName:"<Slider />"}),HV=Bt((n,e)=>{const i={...n,orientation:(n==null?void 0:n.orientation)??"horizontal"},o=xa("Slider",i),l=Mi(i),{direction:u}=Z0();l.direction=u;const{getInputProps:f,getRootProps:_,...E}=sUe(l),b=_(),C=f({},e);return S.jsx(cUe,{value:E,children:S.jsx(lUe,{value:o,children:S.jsxs(Ut.div,{...b,className:fn("chakra-slider",i.className),__css:o.container,children:[i.children,S.jsx("input",{...C})]})})})});HV.displayName="Slider";const $V=Bt((n,e)=>{const{getThumbProps:i}=rN(),o=iN(),l=i(n,e);return S.jsx(Ut.div,{...l,className:fn("chakra-slider__thumb",n.className),__css:o.thumb})});$V.displayName="SliderThumb";const KV=Bt((n,e)=>{const{getTrackProps:i}=rN(),o=iN(),l=i(n,e);return S.jsx(Ut.div,{...l,className:fn("chakra-slider__track",n.className),__css:o.track})});KV.displayName="SliderTrack";const qV=Bt((n,e)=>{const{getInnerTrackProps:i}=rN(),o=iN(),l=i(n,e);return S.jsx(Ut.div,{...l,className:fn("chakra-slider__filled-track",n.className),__css:o.filledTrack})});qV.displayName="SliderFilledTrack";const uUe=Bt((n,e)=>{const{getMarkerProps:i}=rN(),o=iN(),l=i(n,e);return S.jsx(Ut.div,{...l,className:fn("chakra-slider__marker",n.className),__css:o.mark})});uUe.displayName="SliderMark";const $C=Ut("div",{baseStyle:{flex:1,justifySelf:"stretch",alignSelf:"stretch"}});$C.displayName="Spacer";const Ure=n=>S.jsx(Ut.div,{className:"chakra-stack__item",...n,__css:{display:"inline-block",flex:"0 0 auto",minWidth:0,...n.__css}});Ure.displayName="StackItem";function dUe(n){const{spacing:e,direction:i}=n,o={column:{my:e,mx:0,borderLeftWidth:0,borderBottomWidth:"1px"},"column-reverse":{my:e,mx:0,borderLeftWidth:0,borderBottomWidth:"1px"},row:{mx:e,my:0,borderLeftWidth:"1px",borderBottomWidth:0},"row-reverse":{mx:e,my:0,borderLeftWidth:"1px",borderBottomWidth:0}};return{"&":D1(i,l=>o[l])}}const g4=Bt((n,e)=>{const{isInline:i,direction:o,align:l,justify:u,spacing:f="0.5rem",wrap:_,children:E,divider:b,className:C,shouldWrapChildren:I,...P}=n,L=i?"row":o??"column",M=k.useMemo(()=>dUe({spacing:f,direction:L}),[f,L]),F=!!b,B=!I&&!F,Z=k.useMemo(()=>{const re=k1(E);return B?re:re.map((ae,ne)=>{const pe=typeof ae.key<"u"?ae.key:ne,X=ne+1===re.length,Y=I?S.jsx(Ure,{children:ae},pe):ae;if(!F)return Y;const ie=k.cloneElement(b,{__css:M}),le=X?null:ie;return S.jsxs(k.Fragment,{children:[Y,le]},pe)})},[b,M,F,B,I,E]),K=fn("chakra-stack",C);return S.jsx(Ut.div,{ref:e,display:"flex",alignItems:l,justifyContent:u,flexDirection:L,flexWrap:_,gap:F?void 0:f,className:K,...P,children:Z})});g4.displayName="Stack";const Er=Bt((n,e)=>S.jsx(g4,{align:"center",...n,direction:"row",ref:e}));Er.displayName="HStack";const Fr=Bt((n,e)=>S.jsx(g4,{align:"center",...n,direction:"column",ref:e}));Fr.displayName="VStack";const yp=Bt(function(e,i){const o=xa("Switch",e),{spacing:l="0.5rem",children:u,...f}=Mi(e),{getIndicatorProps:_,getInputProps:E,getCheckboxProps:b,getRootProps:C,getLabelProps:I}=oDe(f),P=k.useMemo(()=>({display:"inline-block",position:"relative",verticalAlign:"middle",lineHeight:0,...o.container}),[o.container]),L=k.useMemo(()=>({display:"inline-flex",flexShrink:0,justifyContent:"flex-start",boxSizing:"content-box",cursor:"pointer",...o.track}),[o.track]),M=k.useMemo(()=>({userSelect:"none",marginStart:l,...o.label}),[l,o.label]);return S.jsxs(Ut.label,{...C(),className:fn("chakra-switch",e.className),__css:P,children:[S.jsx("input",{className:"chakra-switch__input",...E({},i)}),S.jsx(Ut.span,{...b(),className:"chakra-switch__track",__css:L,children:S.jsx(Ut.span,{__css:o.thumb,className:"chakra-switch__thumb",..._()})}),u&&S.jsx(Ut.span,{className:"chakra-switch__label",...I(),__css:M,children:u})]})});yp.displayName="Switch";const[hUe,pUe,fUe,mUe]=une();function gUe(n){const{defaultIndex:e,onChange:i,index:o,isManual:l,isLazy:u,lazyBehavior:f="unmount",orientation:_="horizontal",direction:E="ltr",...b}=n,[C,I]=k.useState(e??0),[P,L]=UZ({defaultValue:e??0,value:o,onChange:i});k.useEffect(()=>{o!=null&&I(o)},[o]);const M=fUe(),F=k.useId();return{id:`tabs-${n.id??F}`,selectedIndex:P,focusedIndex:C,setSelectedIndex:L,setFocusedIndex:I,isManual:l,isLazy:u,lazyBehavior:f,orientation:_,descendants:M,direction:E,htmlProps:b}}const[_Ue,sN]=Ii({name:"TabsContext",errorMessage:"useTabsContext: `context` is undefined. Seems you forgot to wrap all tabs components within <Tabs />"});function yUe(n){const{focusedIndex:e,orientation:i,direction:o}=sN(),l=pUe(),u=k.useCallback(f=>{const _=()=>{var re;const K=l.nextEnabled(e);K&&((re=K.node)==null||re.focus())},E=()=>{var re;const K=l.prevEnabled(e);K&&((re=K.node)==null||re.focus())},b=()=>{var re;const K=l.firstEnabled();K&&((re=K.node)==null||re.focus())},C=()=>{var re;const K=l.lastEnabled();K&&((re=K.node)==null||re.focus())},I=i==="horizontal",P=i==="vertical",L=f.key,M=o==="ltr"?"ArrowLeft":"ArrowRight",F=o==="ltr"?"ArrowRight":"ArrowLeft",Z={[M]:()=>I&&E(),[F]:()=>I&&_(),ArrowDown:()=>P&&_(),ArrowUp:()=>P&&E(),Home:b,End:C}[L];Z&&(f.preventDefault(),Z(f))},[l,e,i,o]);return{...n,role:"tablist","aria-orientation":i,onKeyDown:Nn(n.onKeyDown,u)}}function EUe(n){const{isDisabled:e=!1,isFocusable:i=!1,...o}=n,{setSelectedIndex:l,isManual:u,id:f,setFocusedIndex:_,selectedIndex:E}=sN(),{index:b,register:C}=mUe({disabled:e&&!i}),I=b===E,P=()=>{l(b)},L=()=>{_(b),!u&&!(e&&i)&&l(b)};return{...dre({...o,ref:zi(C,n.ref),isDisabled:e,isFocusable:i,onClick:Nn(n.onClick,P)}),id:Vre(f,b),role:"tab",tabIndex:I?0:-1,type:"button","aria-selected":I,"aria-controls":jre(f,b),onFocus:e?void 0:Nn(n.onFocus,L)}}const[vUe,SUe]=Ii({});function bUe(n){const e=sN(),{id:i,selectedIndex:o}=e,u=k1(n.children).map((f,_)=>k.createElement(vUe,{key:f.key??_,value:{isSelected:_===o,id:jre(i,_),tabId:Vre(i,_),selectedIndex:o}},f));return{...n,children:u}}function wUe(n){const{children:e,...i}=n,{isLazy:o,lazyBehavior:l}=sN(),{isSelected:u,id:f,tabId:_}=SUe(),E=k.useRef(!1);u&&(E.current=!0);const b=Vj({wasSelected:E.current,isSelected:u,enabled:o,mode:l});return{tabIndex:0,...i,children:b?e:null,role:"tabpanel","aria-labelledby":_,hidden:!u,id:f}}function Vre(n,e){return`${n}--tab-${e}`}function jre(n,e){return`${n}--tabpanel-${e}`}const[TUe,oN]=Ii({name:"TabsStylesContext",errorMessage:`useTabsStyles returned is 'undefined'. Seems you forgot to wrap the components in "<Tabs />" `}),L0=Bt(function(e,i){const o=xa("Tabs",e),{children:l,className:u,...f}=Mi(e),{htmlProps:_,descendants:E,...b}=gUe(f),C=k.useMemo(()=>b,[b]),{isFitted:I,...P}=_,L={position:"relative",...o.root};return S.jsx(hUe,{value:E,children:S.jsx(_Ue,{value:C,children:S.jsx(TUe,{value:o,children:S.jsx(Ut.div,{className:fn("chakra-tabs",u),ref:i,...P,__css:L,children:l})})})})});L0.displayName="Tabs";const Pa=Bt(function(e,i){const o=oN(),l=EUe({...e,ref:i}),u={outline:"0",display:"flex",alignItems:"center",justifyContent:"center",...o.tab};return S.jsx(Ut.button,{...l,className:fn("chakra-tabs__tab",e.className),__css:u})});Pa.displayName="Tab";const M0=Bt(function(e,i){const o=yUe({...e,ref:i}),l=oN(),u={display:"flex",...l.tablist};return S.jsx(Ut.div,{...o,className:fn("chakra-tabs__tablist",e.className),__css:u})});M0.displayName="TabList";const Oc=Bt(function(e,i){const o=wUe({...e,ref:i}),l=oN();return S.jsx(Ut.div,{outline:"0",...o,className:fn("chakra-tabs__tab-panel",e.className),__css:l.tabpanel})});Oc.displayName="TabPanel";const KC=Bt(function(e,i){const o=bUe(e),l=oN();return S.jsx(Ut.div,{...o,width:"100%",ref:i,className:fn("chakra-tabs__tab-panels",e.className),__css:l.tabpanels})});KC.displayName="TabPanels";const[CUe,Fre]=Ii({name:"TagStylesContext",errorMessage:`useTagStyles returned is 'undefined'. Seems you forgot to wrap the components in "<Tag />" `}),Bre=Bt((n,e)=>{const i=xa("Tag",n),o=Mi(n),l={display:"inline-flex",verticalAlign:"top",alignItems:"center",maxWidth:"100%",...i.container};return S.jsx(CUe,{value:i,children:S.jsx(Ut.span,{ref:e,...o,__css:l})})});Bre.displayName="Tag";const Wre=Bt((n,e)=>{const i=Fre();return S.jsx(Ut.span,{ref:e,noOfLines:1,...n,__css:i.label})});Wre.displayName="TagLabel";const RUe=Bt((n,e)=>S.jsx(vn,{ref:e,verticalAlign:"top",marginEnd:"0.5rem",...n}));RUe.displayName="TagLeftIcon";const IUe=Bt((n,e)=>S.jsx(vn,{ref:e,verticalAlign:"top",marginStart:"0.5rem",...n}));IUe.displayName="TagRightIcon";const zre=n=>S.jsx(vn,{verticalAlign:"inherit",viewBox:"0 0 512 512",...n,children:S.jsx("path",{fill:"currentColor",d:"M289.94 256l95-95A24 24 0 00351 127l-95 95-95-95a24 24 0 00-34 34l95 95-95 95a24 24 0 1034 34l95-95 95 95a24 24 0 0034-34z"})});zre.displayName="TagCloseIcon";const Gre=Bt((n,e)=>{const{isDisabled:i,children:o,...l}=n,f={display:"flex",alignItems:"center",justifyContent:"center",outline:"0",...Fre().closeButton};return S.jsx(Ut.button,{ref:e,"aria-label":"close",...l,type:"button",disabled:i,__css:f,children:o||S.jsx(zre,{})})});Gre.displayName="TagCloseButton";const AUe=["h","minH","height","minHeight"],Hre=Bt((n,e)=>{const i=nu("Textarea",n),{className:o,rows:l,...u}=Mi(n),f=GF(u),_=l?q0(i,AUe):i;return S.jsx(Ut.textarea,{ref:e,rows:l,...f,className:fn("chakra-textarea",o),__css:_})});Hre.displayName="Textarea";function PUe(n,e){const i=n??"bottom",l={"top-start":{ltr:"top-left",rtl:"top-right"},"top-end":{ltr:"top-right",rtl:"top-left"},"bottom-start":{ltr:"bottom-left",rtl:"bottom-right"},"bottom-end":{ltr:"bottom-right",rtl:"bottom-left"}}[i];return(l==null?void 0:l[e])??i}function OUe(n,e){const i=l=>({...e,...l,position:PUe((l==null?void 0:l.position)??(e==null?void 0:e.position),n)}),o=l=>{const u=i(l),f=ane(u);return np.notify(f,u)};return o.update=(l,u)=>{np.update(l,i(u))},o.promise=(l,u)=>{const f=o({...u.loading,status:"loading",duration:null});l.then(_=>o.update(f,{status:"success",duration:5e3,...gl(u.success,_)})).catch(_=>o.update(f,{status:"error",duration:5e3,...gl(u.error,_)}))},o.closeAll=np.closeAll,o.close=np.close,o.isActive=np.isActive,o}function ta(n){const{theme:e}=ine(),i=NNe();return k.useMemo(()=>OUe(e.direction,{...i,...n}),[n,e.direction,i])}const kUe={exit:{scale:.85,opacity:0,transition:{opacity:{duration:.15,easings:"easeInOut"},scale:{duration:.2,easings:"easeInOut"}}},enter:{scale:1,opacity:1,transition:{opacity:{easings:"easeOut",duration:.2},scale:{duration:.2,ease:[.175,.885,.4,1.1]}}}},YV=n=>{var e;return((e=n.current)==null?void 0:e.ownerDocument)||document},Tk=n=>{var e,i;return((i=(e=n.current)==null?void 0:e.ownerDocument)==null?void 0:i.defaultView)||window};function NUe(n={}){const{openDelay:e=0,closeDelay:i=0,closeOnClick:o=!0,closeOnMouseDown:l,closeOnScroll:u,closeOnPointerDown:f=l,closeOnEsc:_=!0,onOpen:E,onClose:b,placement:C,id:I,isOpen:P,defaultIsOpen:L,arrowSize:M=10,arrowShadowColor:F,arrowPadding:B,modifiers:Z,isDisabled:K,gutter:re,offset:ae,direction:ne,...pe}=n,{isOpen:X,onOpen:J,onClose:Y}=Xd({isOpen:P,defaultIsOpen:L,onOpen:E,onClose:b}),{referenceRef:ie,getPopperProps:le,getArrowInnerProps:de,getArrowProps:ue}=f4({enabled:X,placement:C,arrowPadding:B,modifiers:Z,gutter:re,offset:ae,direction:ne}),Oe=k.useId(),xe=`tooltip-${I??Oe}`,Re=k.useRef(null),ve=k.useRef(void 0),be=k.useCallback(()=>{ve.current&&(clearTimeout(ve.current),ve.current=void 0)},[]),We=k.useRef(void 0),Pe=k.useCallback(()=>{We.current&&(clearTimeout(We.current),We.current=void 0)},[]),Te=k.useCallback(()=>{Pe(),Y()},[Y,Pe]),ke=DUe(Re,Te),Ue=k.useCallback(()=>{if(!K&&!ve.current){X&&ke();const He=Tk(Re);ve.current=He.setTimeout(J,e)}},[ke,K,X,J,e]),Be=k.useCallback(()=>{be();const He=Tk(Re);We.current=He.setTimeout(Te,i)},[i,Te,be]),qe=k.useCallback(()=>{X&&o&&Be()},[o,Be,X]),$e=k.useCallback(()=>{X&&f&&Be()},[f,Be,X]),st=k.useCallback(He=>{X&&He.key==="Escape"&&Be()},[X,Be]);Uy(()=>YV(Re),"keydown",_?st:void 0),Uy(()=>{if(!u)return null;const He=Re.current;if(!He)return null;const ut=LZ(He);return ut.localName==="body"?Tk(Re):ut},"scroll",()=>{X&&u&&Te()},{passive:!0,capture:!0}),k.useEffect(()=>{K&&(be(),X&&Y())},[K,X,Y,be]),k.useEffect(()=>()=>{be(),Pe()},[be,Pe]),Uy(()=>Re.current,"pointerleave",Be);const Je=k.useCallback((He={},ut=null)=>({...He,ref:zi(Re,ut,ie),onPointerEnter:Nn(He.onPointerEnter,Lt=>{Lt.pointerType!=="touch"&&Ue()}),onClick:Nn(He.onClick,qe),onPointerDown:Nn(He.onPointerDown,$e),onFocus:Nn(He.onFocus,Ue),onBlur:Nn(He.onBlur,Be),"aria-describedby":X?xe:void 0}),[Ue,Be,$e,X,xe,qe,ie]),Rt=k.useCallback((He={},ut=null)=>le({...He,style:{...He.style,[mo.arrowSize.var]:M?`${M}px`:void 0,[mo.arrowShadowColor.var]:F}},ut),[le,M,F]),kt=k.useCallback((He={},ut=null)=>{const mt={...He.style,position:"relative",transformOrigin:mo.transformOrigin.varRef};return{ref:ut,...pe,...He,id:xe,role:"tooltip",style:mt}},[pe,xe]);return{isOpen:X,show:Ue,hide:Be,getTriggerProps:Je,getTooltipProps:kt,getTooltipPositionerProps:Rt,getArrowProps:ue,getArrowInnerProps:de}}const CU="chakra-ui:close-tooltip";function DUe(n,e){return k.useEffect(()=>{const i=YV(n);return i.addEventListener(CU,e),()=>i.removeEventListener(CU,e)},[e,n]),()=>{const i=YV(n),o=Tk(n);i.dispatchEvent(new o.CustomEvent(CU))}}const xUe=Ut(Ip.div),Kf=Bt((n,e)=>{const i=nu("Tooltip",n),o=Mi(n),l=Z0(),{children:u,label:f,shouldWrapChildren:_,"aria-label":E,hasArrow:b,bg:C,portalProps:I,background:P,backgroundColor:L,bgColor:M,motionProps:F,animatePresenceProps:B,...Z}=o,K=P??L??C??M;if(K){i.bg=K;const ie=kSe(l,"colors",K);i[mo.arrowBg.var]=ie}const re=NUe({...Z,direction:l.direction}),ae=!k.isValidElement(u)||_;let ne;if(ae)ne=S.jsx(Ut.span,{display:"inline-block",tabIndex:0,...re.getTriggerProps(),children:u});else{const ie=k.Children.only(u);ne=k.cloneElement(ie,re.getTriggerProps(ie.props,Pre(ie)))}const pe=!!E,X=re.getTooltipProps({},e),J=pe?q0(X,["role","id"]):X,Y=xZ(X,["role","id"]);return f?S.jsxs(S.Fragment,{children:[ne,S.jsx(X0,{...B,children:re.isOpen&&S.jsx(ru,{...I,children:S.jsx(Ut.div,{...re.getTooltipPositionerProps(),__css:{zIndex:i.zIndex,pointerEvents:"none"},children:S.jsxs(xUe,{variants:kUe,initial:"exit",animate:"enter",exit:"exit",...F,...J,__css:i,children:[f,pe&&S.jsx(Ut.span,{srOnly:!0,...Y,children:E}),b&&S.jsx(Ut.div,{"data-popper-arrow":!0,className:"chakra-tooltip__arrow-wrapper",children:S.jsx(Ut.div,{"data-popper-arrow-inner":!0,className:"chakra-tooltip__arrow",__css:{bg:i.bg}})})]})})})})]}):S.jsx(S.Fragment,{children:u})});Kf.displayName="Tooltip";const qC=Bt(function(e,i){const o=nu("Heading",e),{className:l,...u}=Mi(e);return S.jsx(Ut.h2,{ref:i,className:fn("chakra-heading",e.className),...u,__css:o})});qC.displayName="Heading";const tt=Bt(function(e,i){const o=nu("Text",e),{className:l,align:u,decoration:f,casing:_,...E}=Mi(e),b=N1({textAlign:e.align,textDecoration:e.decoration,textTransform:e.casing});return S.jsx(Ut.p,{ref:i,className:fn("chakra-text",e.className),...b,...E,__css:o})});tt.displayName="Text";const $re=Bt(function(e,i){const{spacing:o="0.5rem",spacingX:l,spacingY:u,children:f,justify:_,direction:E,align:b,className:C,shouldWrapChildren:I,...P}=e,L=k.useMemo(()=>I?k.Children.map(f,(M,F)=>S.jsx(_4,{children:M},F)):f,[f,I]);return S.jsx(Ut.div,{ref:i,className:fn("chakra-wrap",C),...P,children:S.jsx(Ut.ul,{className:"chakra-wrap__list",__css:{display:"flex",flexWrap:"wrap",justifyContent:_,alignItems:b,flexDirection:E,listStyleType:"none",gap:o,columnGap:l,rowGap:u,padding:"0"},children:L})})});$re.displayName="Wrap";const _4=Bt(function(e,i){const{className:o,...l}=e;return S.jsx(Ut.li,{ref:i,__css:{display:"flex",alignItems:"flex-start"},className:fn("chakra-wrap__listitem",o),...l})});_4.displayName="WrapItem";const LUe="modulepreload",MUe=function(n,e){return new URL(n,e).href},LX={},RU=function(e,i,o){let l=Promise.resolve();if(i&&i.length>0){const f=document.getElementsByTagName("link"),_=document.querySelector("meta[property=csp-nonce]"),E=(_==null?void 0:_.nonce)||(_==null?void 0:_.getAttribute("nonce"));l=Promise.allSettled(i.map(b=>{if(b=MUe(b,o),b in LX)return;LX[b]=!0;const C=b.endsWith(".css"),I=C?'[rel="stylesheet"]':"";if(!!o)for(let M=f.length-1;M>=0;M--){const F=f[M];if(F.href===b&&(!C||F.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${b}"]${I}`))return;const L=document.createElement("link");if(L.rel=C?"stylesheet":LUe,C||(L.as="script"),L.crossOrigin="",L.href=b,E&&L.setAttribute("nonce",E),document.head.appendChild(L),C)return new Promise((M,F)=>{L.addEventListener("load",M),L.addEventListener("error",()=>F(new Error(`Unable to preload CSS for ${b}`)))})}))}function u(f){const _=new Event("vite:preloadError",{cancelable:!0});if(_.payload=f,window.dispatchEvent(_),!_.defaultPrevented)throw f}return l.then(f=>{for(const _ of f||[])_.status==="rejected"&&u(_.reason);return e().catch(u)})},GO=()=>{const n=new Date,e=n.getHours().toString().padStart(2,"0"),i=n.getMinutes().toString().padStart(2,"0"),o=n.getSeconds().toString().padStart(2,"0"),l=n.getMilliseconds().toString().padStart(3,"0");return`${e}:${i}:${o}.${l}`},H={log:(...n)=>{{const e=n.map((i,o)=>o===0&&typeof i=="string"?`
${i}`:i);console.log(`[LOG] [${GO()}] `,...e)}},error:(...n)=>{{const e=n.map((i,o)=>o===0&&typeof i=="string"?`
${i}`:i);console.error(`[ERROR] [${GO()}] `,...e)}},warn:(...n)=>{{const e=n.map((i,o)=>o===0&&typeof i=="string"?`
${i}`:i);console.warn(`[WARN] [${GO()}]`,...e)}},trace:n=>{console.trace(`[TRACE] [${GO()}] ${n}`)}};async function YC(n){let e;try{switch(n){case"default":e=await RU(()=>import("./index.v0.1.5.js"),[],import.meta.url);break;default:e=await RU(()=>import("./index.v0.1.5.js"),[],import.meta.url)}return e.default}catch(i){return H.error("Failed to load theme:",i),e=await RU(()=>import("./index.v0.1.5.js"),[],import.meta.url),e.default}}const UUe=()=>{};var MX={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Kre=function(n){const e=[];let i=0;for(let o=0;o<n.length;o++){let l=n.charCodeAt(o);l<128?e[i++]=l:l<2048?(e[i++]=l>>6|192,e[i++]=l&63|128):(l&64512)===55296&&o+1<n.length&&(n.charCodeAt(o+1)&64512)===56320?(l=65536+((l&1023)<<10)+(n.charCodeAt(++o)&1023),e[i++]=l>>18|240,e[i++]=l>>12&63|128,e[i++]=l>>6&63|128,e[i++]=l&63|128):(e[i++]=l>>12|224,e[i++]=l>>6&63|128,e[i++]=l&63|128)}return e},VUe=function(n){const e=[];let i=0,o=0;for(;i<n.length;){const l=n[i++];if(l<128)e[o++]=String.fromCharCode(l);else if(l>191&&l<224){const u=n[i++];e[o++]=String.fromCharCode((l&31)<<6|u&63)}else if(l>239&&l<365){const u=n[i++],f=n[i++],_=n[i++],E=((l&7)<<18|(u&63)<<12|(f&63)<<6|_&63)-65536;e[o++]=String.fromCharCode(55296+(E>>10)),e[o++]=String.fromCharCode(56320+(E&1023))}else{const u=n[i++],f=n[i++];e[o++]=String.fromCharCode((l&15)<<12|(u&63)<<6|f&63)}}return e.join("")},qre={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const i=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,o=[];for(let l=0;l<n.length;l+=3){const u=n[l],f=l+1<n.length,_=f?n[l+1]:0,E=l+2<n.length,b=E?n[l+2]:0,C=u>>2,I=(u&3)<<4|_>>4;let P=(_&15)<<2|b>>6,L=b&63;E||(L=64,f||(P=64)),o.push(i[C],i[I],i[P],i[L])}return o.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(Kre(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):VUe(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();const i=e?this.charToByteMapWebSafe_:this.charToByteMap_,o=[];for(let l=0;l<n.length;){const u=i[n.charAt(l++)],_=l<n.length?i[n.charAt(l)]:0;++l;const b=l<n.length?i[n.charAt(l)]:64;++l;const I=l<n.length?i[n.charAt(l)]:64;if(++l,u==null||_==null||b==null||I==null)throw new jUe;const P=u<<2|_>>4;if(o.push(P),b!==64){const L=_<<4&240|b>>2;if(o.push(L),I!==64){const M=b<<6&192|I;o.push(M)}}}return o},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class jUe extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const FUe=function(n){const e=Kre(n);return qre.encodeByteArray(e,!0)},t1=function(n){return FUe(n).replace(/\./g,"")},Yre=function(n){try{return qre.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function BUe(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const WUe=()=>BUe().__FIREBASE_DEFAULTS__,zUe=()=>{if(typeof process>"u"||typeof MX>"u")return;const n=MX.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},GUe=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=n&&Yre(n[1]);return e&&JSON.parse(e)},aN=()=>{try{return UUe()||WUe()||zUe()||GUe()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},Xre=n=>{var e,i;return(i=(e=aN())===null||e===void 0?void 0:e.emulatorHosts)===null||i===void 0?void 0:i[n]},Jre=n=>{const e=Xre(n);if(!e)return;const i=e.lastIndexOf(":");if(i<=0||i+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const o=parseInt(e.substring(i+1),10);return e[0]==="["?[e.substring(1,i-1),o]:[e.substring(0,i),o]},Qre=()=>{var n;return(n=aN())===null||n===void 0?void 0:n.config},Zre=n=>{var e;return(e=aN())===null||e===void 0?void 0:e[`_${n}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class HUe{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,i)=>{this.resolve=e,this.reject=i})}wrapCallback(e){return(i,o)=>{i?this.reject(i):this.resolve(o),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(i):e(i,o))}}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function eie(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const i={alg:"none",type:"JWT"},o=e||"demo-project",l=n.iat||0,u=n.sub||n.user_id;if(!u)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const f=Object.assign({iss:`https://securetoken.google.com/${o}`,aud:o,iat:l,exp:l+3600,auth_time:l,sub:u,user_id:u,firebase:{sign_in_provider:"custom",identities:{}}},n);return[t1(JSON.stringify(i)),t1(JSON.stringify(f)),""].join(".")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function lc(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function $Ue(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(lc())}function KUe(){var n;const e=(n=aN())===null||n===void 0?void 0:n.forceEnvironment;if(e==="node")return!0;if(e==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function qUe(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function YUe(){const n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function XUe(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function JUe(){const n=lc();return n.indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0}function QUe(){return!KUe()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function ZUe(){try{return typeof indexedDB=="object"}catch{return!1}}function eVe(){return new Promise((n,e)=>{try{let i=!0;const o="validate-browser-context-for-indexeddb-analytics-module",l=self.indexedDB.open(o);l.onsuccess=()=>{l.result.close(),i||self.indexedDB.deleteDatabase(o),n(!0)},l.onupgradeneeded=()=>{i=!1},l.onerror=()=>{var u;e(((u=l.error)===null||u===void 0?void 0:u.message)||"")}}catch(i){e(i)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tVe="FirebaseError";class Pp extends Error{constructor(e,i,o){super(i),this.code=e,this.customData=o,this.name=tVe,Object.setPrototypeOf(this,Pp.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,CR.prototype.create)}}class CR{constructor(e,i,o){this.service=e,this.serviceName=i,this.errors=o}create(e,...i){const o=i[0]||{},l=`${this.service}/${e}`,u=this.errors[e],f=u?nVe(u,o):"Error",_=`${this.serviceName}: ${f} (${l}).`;return new Pp(l,_,o)}}function nVe(n,e){return n.replace(rVe,(i,o)=>{const l=e[o];return l!=null?String(l):`<${o}?>`})}const rVe=/\{\$([^}]+)}/g;function iVe(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function em(n,e){if(n===e)return!0;const i=Object.keys(n),o=Object.keys(e);for(const l of i){if(!o.includes(l))return!1;const u=n[l],f=e[l];if(UX(u)&&UX(f)){if(!em(u,f))return!1}else if(u!==f)return!1}for(const l of o)if(!i.includes(l))return!1;return!0}function UX(n){return n!==null&&typeof n=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function RR(n){const e=[];for(const[i,o]of Object.entries(n))Array.isArray(o)?o.forEach(l=>{e.push(encodeURIComponent(i)+"="+encodeURIComponent(l))}):e.push(encodeURIComponent(i)+"="+encodeURIComponent(o));return e.length?"&"+e.join("&"):""}function nC(n){const e={};return n.replace(/^\?/,"").split("&").forEach(o=>{if(o){const[l,u]=o.split("=");e[decodeURIComponent(l)]=decodeURIComponent(u)}}),e}function rC(n){const e=n.indexOf("?");if(!e)return"";const i=n.indexOf("#",e);return n.substring(e,i>0?i:void 0)}function sVe(n,e){const i=new oVe(n,e);return i.subscribe.bind(i)}class oVe{constructor(e,i){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=i,this.task.then(()=>{e(this)}).catch(o=>{this.error(o)})}next(e){this.forEachObserver(i=>{i.next(e)})}error(e){this.forEachObserver(i=>{i.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,i,o){let l;if(e===void 0&&i===void 0&&o===void 0)throw new Error("Missing Observer.");aVe(e,["next","error","complete"])?l=e:l={next:e,error:i,complete:o},l.next===void 0&&(l.next=IU),l.error===void 0&&(l.error=IU),l.complete===void 0&&(l.complete=IU);const u=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?l.error(this.finalError):l.complete()}catch{}}),this.observers.push(l),u}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let i=0;i<this.observers.length;i++)this.sendOne(i,e)}sendOne(e,i){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{i(this.observers[e])}catch(o){typeof console<"u"&&console.error&&console.error(o)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function aVe(n,e){if(typeof n!="object"||n===null)return!1;for(const i of e)if(i in n&&typeof n[i]=="function")return!0;return!1}function IU(){}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qi(n){return n&&n._delegate?n._delegate:n}class Bg{constructor(e,i,o){this.name=e,this.instanceFactory=i,this.type=o,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Iy="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cVe{constructor(e,i){this.name=e,this.container=i,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const i=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(i)){const o=new HUe;if(this.instancesDeferred.set(i,o),this.isInitialized(i)||this.shouldAutoInitialize())try{const l=this.getOrInitializeService({instanceIdentifier:i});l&&o.resolve(l)}catch{}}return this.instancesDeferred.get(i).promise}getImmediate(e){var i;const o=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),l=(i=e==null?void 0:e.optional)!==null&&i!==void 0?i:!1;if(this.isInitialized(o)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:o})}catch(u){if(l)return null;throw u}else{if(l)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(uVe(e))try{this.getOrInitializeService({instanceIdentifier:Iy})}catch{}for(const[i,o]of this.instancesDeferred.entries()){const l=this.normalizeInstanceIdentifier(i);try{const u=this.getOrInitializeService({instanceIdentifier:l});o.resolve(u)}catch{}}}}clearInstance(e=Iy){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(i=>"INTERNAL"in i).map(i=>i.INTERNAL.delete()),...e.filter(i=>"_delete"in i).map(i=>i._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=Iy){return this.instances.has(e)}getOptions(e=Iy){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:i={}}=e,o=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(o))throw Error(`${this.name}(${o}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const l=this.getOrInitializeService({instanceIdentifier:o,options:i});for(const[u,f]of this.instancesDeferred.entries()){const _=this.normalizeInstanceIdentifier(u);o===_&&f.resolve(l)}return l}onInit(e,i){var o;const l=this.normalizeInstanceIdentifier(i),u=(o=this.onInitCallbacks.get(l))!==null&&o!==void 0?o:new Set;u.add(e),this.onInitCallbacks.set(l,u);const f=this.instances.get(l);return f&&e(f,l),()=>{u.delete(e)}}invokeOnInitCallbacks(e,i){const o=this.onInitCallbacks.get(i);if(o)for(const l of o)try{l(e,i)}catch{}}getOrInitializeService({instanceIdentifier:e,options:i={}}){let o=this.instances.get(e);if(!o&&this.component&&(o=this.component.instanceFactory(this.container,{instanceIdentifier:lVe(e),options:i}),this.instances.set(e,o),this.instancesOptions.set(e,i),this.invokeOnInitCallbacks(o,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,o)}catch{}return o||null}normalizeInstanceIdentifier(e=Iy){return this.component?this.component.multipleInstances?e:Iy:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function lVe(n){return n===Iy?void 0:n}function uVe(n){return n.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dVe{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const i=this.getProvider(e.name);if(i.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);i.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const i=new cVe(e,this);return this.providers.set(e,i),i}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Nr;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(Nr||(Nr={}));const hVe={debug:Nr.DEBUG,verbose:Nr.VERBOSE,info:Nr.INFO,warn:Nr.WARN,error:Nr.ERROR,silent:Nr.SILENT},pVe=Nr.INFO,fVe={[Nr.DEBUG]:"log",[Nr.VERBOSE]:"log",[Nr.INFO]:"info",[Nr.WARN]:"warn",[Nr.ERROR]:"error"},mVe=(n,e,...i)=>{if(e<n.logLevel)return;const o=new Date().toISOString(),l=fVe[e];if(l)console[l](`[${o}]  ${n.name}:`,...i);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class y4{constructor(e){this.name=e,this._logLevel=pVe,this._logHandler=mVe,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in Nr))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?hVe[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,Nr.DEBUG,...e),this._logHandler(this,Nr.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,Nr.VERBOSE,...e),this._logHandler(this,Nr.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,Nr.INFO,...e),this._logHandler(this,Nr.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,Nr.WARN,...e),this._logHandler(this,Nr.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,Nr.ERROR,...e),this._logHandler(this,Nr.ERROR,...e)}}const gVe=(n,e)=>e.some(i=>n instanceof i);let VX,jX;function _Ve(){return VX||(VX=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function yVe(){return jX||(jX=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const tie=new WeakMap,XV=new WeakMap,nie=new WeakMap,AU=new WeakMap,E4=new WeakMap;function EVe(n){const e=new Promise((i,o)=>{const l=()=>{n.removeEventListener("success",u),n.removeEventListener("error",f)},u=()=>{i(xg(n.result)),l()},f=()=>{o(n.error),l()};n.addEventListener("success",u),n.addEventListener("error",f)});return e.then(i=>{i instanceof IDBCursor&&tie.set(i,n)}).catch(()=>{}),E4.set(e,n),e}function vVe(n){if(XV.has(n))return;const e=new Promise((i,o)=>{const l=()=>{n.removeEventListener("complete",u),n.removeEventListener("error",f),n.removeEventListener("abort",f)},u=()=>{i(),l()},f=()=>{o(n.error||new DOMException("AbortError","AbortError")),l()};n.addEventListener("complete",u),n.addEventListener("error",f),n.addEventListener("abort",f)});XV.set(n,e)}let JV={get(n,e,i){if(n instanceof IDBTransaction){if(e==="done")return XV.get(n);if(e==="objectStoreNames")return n.objectStoreNames||nie.get(n);if(e==="store")return i.objectStoreNames[1]?void 0:i.objectStore(i.objectStoreNames[0])}return xg(n[e])},set(n,e,i){return n[e]=i,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function SVe(n){JV=n(JV)}function bVe(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...i){const o=n.call(PU(this),e,...i);return nie.set(o,e.sort?e.sort():[e]),xg(o)}:yVe().includes(n)?function(...e){return n.apply(PU(this),e),xg(tie.get(this))}:function(...e){return xg(n.apply(PU(this),e))}}function wVe(n){return typeof n=="function"?bVe(n):(n instanceof IDBTransaction&&vVe(n),gVe(n,_Ve())?new Proxy(n,JV):n)}function xg(n){if(n instanceof IDBRequest)return EVe(n);if(AU.has(n))return AU.get(n);const e=wVe(n);return e!==n&&(AU.set(n,e),E4.set(e,n)),e}const PU=n=>E4.get(n);function TVe(n,e,{blocked:i,upgrade:o,blocking:l,terminated:u}={}){const f=indexedDB.open(n,e),_=xg(f);return o&&f.addEventListener("upgradeneeded",E=>{o(xg(f.result),E.oldVersion,E.newVersion,xg(f.transaction),E)}),i&&f.addEventListener("blocked",E=>i(E.oldVersion,E.newVersion,E)),_.then(E=>{u&&E.addEventListener("close",()=>u()),l&&E.addEventListener("versionchange",b=>l(b.oldVersion,b.newVersion,b))}).catch(()=>{}),_}const CVe=["get","getKey","getAll","getAllKeys","count"],RVe=["put","add","delete","clear"],OU=new Map;function FX(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(OU.get(e))return OU.get(e);const i=e.replace(/FromIndex$/,""),o=e!==i,l=RVe.includes(i);if(!(i in(o?IDBIndex:IDBObjectStore).prototype)||!(l||CVe.includes(i)))return;const u=async function(f,..._){const E=this.transaction(f,l?"readwrite":"readonly");let b=E.store;return o&&(b=b.index(_.shift())),(await Promise.all([b[i](..._),l&&E.done]))[0]};return OU.set(e,u),u}SVe(n=>({...n,get:(e,i,o)=>FX(e,i)||n.get(e,i,o),has:(e,i)=>!!FX(e,i)||n.has(e,i)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class IVe{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(i=>{if(AVe(i)){const o=i.getImmediate();return`${o.library}/${o.version}`}else return null}).filter(i=>i).join(" ")}}function AVe(n){const e=n.getComponent();return(e==null?void 0:e.type)==="VERSION"}const QV="@firebase/app",BX="0.11.3";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tm=new y4("@firebase/app"),PVe="@firebase/app-compat",OVe="@firebase/analytics-compat",kVe="@firebase/analytics",NVe="@firebase/app-check-compat",DVe="@firebase/app-check",xVe="@firebase/auth",LVe="@firebase/auth-compat",MVe="@firebase/database",UVe="@firebase/data-connect",VVe="@firebase/database-compat",jVe="@firebase/functions",FVe="@firebase/functions-compat",BVe="@firebase/installations",WVe="@firebase/installations-compat",zVe="@firebase/messaging",GVe="@firebase/messaging-compat",HVe="@firebase/performance",$Ve="@firebase/performance-compat",KVe="@firebase/remote-config",qVe="@firebase/remote-config-compat",YVe="@firebase/storage",XVe="@firebase/storage-compat",JVe="@firebase/firestore",QVe="@firebase/vertexai",ZVe="@firebase/firestore-compat",eje="firebase",tje="11.5.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ZV="[DEFAULT]",nje={[QV]:"fire-core",[PVe]:"fire-core-compat",[kVe]:"fire-analytics",[OVe]:"fire-analytics-compat",[DVe]:"fire-app-check",[NVe]:"fire-app-check-compat",[xVe]:"fire-auth",[LVe]:"fire-auth-compat",[MVe]:"fire-rtdb",[UVe]:"fire-data-connect",[VVe]:"fire-rtdb-compat",[jVe]:"fire-fn",[FVe]:"fire-fn-compat",[BVe]:"fire-iid",[WVe]:"fire-iid-compat",[zVe]:"fire-fcm",[GVe]:"fire-fcm-compat",[HVe]:"fire-perf",[$Ve]:"fire-perf-compat",[KVe]:"fire-rc",[qVe]:"fire-rc-compat",[YVe]:"fire-gcs",[XVe]:"fire-gcs-compat",[JVe]:"fire-fst",[ZVe]:"fire-fst-compat",[QVe]:"fire-vertex","fire-js":"fire-js",[eje]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const n1=new Map,rje=new Map,ej=new Map;function WX(n,e){try{n.container.addComponent(e)}catch(i){tm.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,i)}}function tE(n){const e=n.name;if(ej.has(e))return tm.debug(`There were multiple attempts to register component ${e}.`),!1;ej.set(e,n);for(const i of n1.values())WX(i,n);for(const i of rje.values())WX(i,n);return!0}function cN(n,e){const i=n.container.getProvider("heartbeat").getImmediate({optional:!0});return i&&i.triggerHeartbeat(),n.container.getProvider(e)}function $l(n){return n==null?!1:n.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ije={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},Lg=new CR("app","Firebase",ije);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sje{constructor(e,i,o){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},i),this._name=i.name,this._automaticDataCollectionEnabled=i.automaticDataCollectionEnabled,this._container=o,this.container.addComponent(new Bg("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw Lg.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const uE=tje;function rie(n,e={}){let i=n;typeof e!="object"&&(e={name:e});const o=Object.assign({name:ZV,automaticDataCollectionEnabled:!1},e),l=o.name;if(typeof l!="string"||!l)throw Lg.create("bad-app-name",{appName:String(l)});if(i||(i=Qre()),!i)throw Lg.create("no-options");const u=n1.get(l);if(u){if(em(i,u.options)&&em(o,u.config))return u;throw Lg.create("duplicate-app",{appName:l})}const f=new dVe(l);for(const E of ej.values())f.addComponent(E);const _=new sje(i,o,f);return n1.set(l,_),_}function v4(n=ZV){const e=n1.get(n);if(!e&&n===ZV&&Qre())return rie();if(!e)throw Lg.create("no-app",{appName:n});return e}function Ep(n,e,i){var o;let l=(o=nje[n])!==null&&o!==void 0?o:n;i&&(l+=`-${i}`);const u=l.match(/\s|\//),f=e.match(/\s|\//);if(u||f){const _=[`Unable to register library "${l}" with version "${e}":`];u&&_.push(`library name "${l}" contains illegal characters (whitespace or "/")`),u&&f&&_.push("and"),f&&_.push(`version name "${e}" contains illegal characters (whitespace or "/")`),tm.warn(_.join(" "));return}tE(new Bg(`${l}-version`,()=>({library:l,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const oje="firebase-heartbeat-database",aje=1,XC="firebase-heartbeat-store";let kU=null;function iie(){return kU||(kU=TVe(oje,aje,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(XC)}catch(i){console.warn(i)}}}}).catch(n=>{throw Lg.create("idb-open",{originalErrorMessage:n.message})})),kU}async function cje(n){try{const i=(await iie()).transaction(XC),o=await i.objectStore(XC).get(sie(n));return await i.done,o}catch(e){if(e instanceof Pp)tm.warn(e.message);else{const i=Lg.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});tm.warn(i.message)}}}async function zX(n,e){try{const o=(await iie()).transaction(XC,"readwrite");await o.objectStore(XC).put(e,sie(n)),await o.done}catch(i){if(i instanceof Pp)tm.warn(i.message);else{const o=Lg.create("idb-set",{originalErrorMessage:i==null?void 0:i.message});tm.warn(o.message)}}}function sie(n){return`${n.name}!${n.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lje=1024,uje=30;class dje{constructor(e){this.container=e,this._heartbeatsCache=null;const i=this.container.getProvider("app").getImmediate();this._storage=new pje(i),this._heartbeatsCachePromise=this._storage.read().then(o=>(this._heartbeatsCache=o,o))}async triggerHeartbeat(){var e,i;try{const l=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),u=GX();if(((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((i=this._heartbeatsCache)===null||i===void 0?void 0:i.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===u||this._heartbeatsCache.heartbeats.some(f=>f.date===u))return;if(this._heartbeatsCache.heartbeats.push({date:u,agent:l}),this._heartbeatsCache.heartbeats.length>uje){const f=fje(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(f,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(o){tm.warn(o)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const i=GX(),{heartbeatsToSend:o,unsentEntries:l}=hje(this._heartbeatsCache.heartbeats),u=t1(JSON.stringify({version:2,heartbeats:o}));return this._heartbeatsCache.lastSentHeartbeatDate=i,l.length>0?(this._heartbeatsCache.heartbeats=l,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),u}catch(i){return tm.warn(i),""}}}function GX(){return new Date().toISOString().substring(0,10)}function hje(n,e=lje){const i=[];let o=n.slice();for(const l of n){const u=i.find(f=>f.agent===l.agent);if(u){if(u.dates.push(l.date),HX(i)>e){u.dates.pop();break}}else if(i.push({agent:l.agent,dates:[l.date]}),HX(i)>e){i.pop();break}o=o.slice(1)}return{heartbeatsToSend:i,unsentEntries:o}}class pje{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return ZUe()?eVe().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const i=await cje(this.app);return i!=null&&i.heartbeats?i:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){var i;if(await this._canUseIndexedDBPromise){const l=await this.read();return zX(this.app,{lastSentHeartbeatDate:(i=e.lastSentHeartbeatDate)!==null&&i!==void 0?i:l.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){var i;if(await this._canUseIndexedDBPromise){const l=await this.read();return zX(this.app,{lastSentHeartbeatDate:(i=e.lastSentHeartbeatDate)!==null&&i!==void 0?i:l.lastSentHeartbeatDate,heartbeats:[...l.heartbeats,...e.heartbeats]})}else return}}function HX(n){return t1(JSON.stringify({version:2,heartbeats:n})).length}function fje(n){if(n.length===0)return-1;let e=0,i=n[0].date;for(let o=1;o<n.length;o++)n[o].date<i&&(i=n[o].date,e=o);return e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mje(n){tE(new Bg("platform-logger",e=>new IVe(e),"PRIVATE")),tE(new Bg("heartbeat",e=>new dje(e),"PRIVATE")),Ep(QV,BX,n),Ep(QV,BX,"esm2017"),Ep("fire-js","")}mje("");function oie(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const gje=oie,aie=new CR("auth","Firebase",oie());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const r1=new y4("@firebase/auth");function _je(n,...e){r1.logLevel<=Nr.WARN&&r1.warn(`Auth (${uE}): ${n}`,...e)}function Ck(n,...e){r1.logLevel<=Nr.ERROR&&r1.error(`Auth (${uE}): ${n}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Jd(n,...e){throw S4(n,...e)}function vp(n,...e){return S4(n,...e)}function cie(n,e,i){const o=Object.assign(Object.assign({},gje()),{[e]:i});return new CR("auth","Firebase",o).create(e,{appName:n.name})}function qf(n){return cie(n,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function S4(n,...e){if(typeof n!="string"){const i=e[0],o=[...e.slice(1)];return o[0]&&(o[0].appName=n.name),n._errorFactory.create(i,...o)}return aie.create(n,...e)}function Gn(n,e,...i){if(!n)throw S4(e,...i)}function jf(n){const e="INTERNAL ASSERTION FAILED: "+n;throw Ck(e),new Error(e)}function nm(n,e){n||jf(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function tj(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.href)||""}function yje(){return $X()==="http:"||$X()==="https:"}function $X(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Eje(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(yje()||YUe()||"connection"in navigator)?navigator.onLine:!0}function vje(){if(typeof navigator>"u")return null;const n=navigator;return n.languages&&n.languages[0]||n.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class IR{constructor(e,i){this.shortDelay=e,this.longDelay=i,nm(i>e,"Short delay should be less than long delay!"),this.isMobile=$Ue()||XUe()}get(){return Eje()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function b4(n,e){nm(n.emulator,"Emulator should always be set here");const{url:i}=n.emulator;return e?`${i}${e.startsWith("/")?e.slice(1):e}`:i}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lie{static initialize(e,i,o){this.fetchImpl=e,i&&(this.headersImpl=i),o&&(this.responseImpl=o)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;jf("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;jf("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;jf("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Sje={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bje=new IR(3e4,6e4);function om(n,e){return n.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:n.tenantId}):e}async function am(n,e,i,o,l={}){return uie(n,l,async()=>{let u={},f={};o&&(e==="GET"?f=o:u={body:JSON.stringify(o)});const _=RR(Object.assign({key:n.config.apiKey},f)).slice(1),E=await n._getAdditionalHeaders();E["Content-Type"]="application/json",n.languageCode&&(E["X-Firebase-Locale"]=n.languageCode);const b=Object.assign({method:e,headers:E},u);return qUe()||(b.referrerPolicy="no-referrer"),lie.fetch()(die(n,n.config.apiHost,i,_),b)})}async function uie(n,e,i){n._canInitEmulator=!1;const o=Object.assign(Object.assign({},Sje),e);try{const l=new Tje(n),u=await Promise.race([i(),l.promise]);l.clearNetworkTimeout();const f=await u.json();if("needConfirmation"in f)throw HO(n,"account-exists-with-different-credential",f);if(u.ok&&!("errorMessage"in f))return f;{const _=u.ok?f.errorMessage:f.error.message,[E,b]=_.split(" : ");if(E==="FEDERATED_USER_ID_ALREADY_LINKED")throw HO(n,"credential-already-in-use",f);if(E==="EMAIL_EXISTS")throw HO(n,"email-already-in-use",f);if(E==="USER_DISABLED")throw HO(n,"user-disabled",f);const C=o[E]||E.toLowerCase().replace(/[_\s]+/g,"-");if(b)throw cie(n,C,b);Jd(n,C)}}catch(l){if(l instanceof Pp)throw l;Jd(n,"network-request-failed",{message:String(l)})}}async function AR(n,e,i,o,l={}){const u=await am(n,e,i,o,l);return"mfaPendingCredential"in u&&Jd(n,"multi-factor-auth-required",{_serverResponse:u}),u}function die(n,e,i,o){const l=`${e}${i}?${o}`;return n.config.emulator?b4(n.config,l):`${n.config.apiScheme}://${l}`}function wje(n){switch(n){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class Tje{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((i,o)=>{this.timer=setTimeout(()=>o(vp(this.auth,"network-request-failed")),bje.get())})}}function HO(n,e,i){const o={appName:n.name};i.email&&(o.email=i.email),i.phoneNumber&&(o.phoneNumber=i.phoneNumber);const l=vp(n,e,o);return l.customData._tokenResponse=i,l}function KX(n){return n!==void 0&&n.enterprise!==void 0}class Cje{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const i of this.recaptchaEnforcementState)if(i.provider&&i.provider===e)return wje(i.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function Rje(n,e){return am(n,"GET","/v2/recaptchaConfig",om(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Ije(n,e){return am(n,"POST","/v1/accounts:delete",e)}async function hie(n,e){return am(n,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bC(n){if(n)try{const e=new Date(Number(n));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function Aje(n,e=!1){const i=qi(n),o=await i.getIdToken(e),l=w4(o);Gn(l&&l.exp&&l.auth_time&&l.iat,i.auth,"internal-error");const u=typeof l.firebase=="object"?l.firebase:void 0,f=u==null?void 0:u.sign_in_provider;return{claims:l,token:o,authTime:bC(NU(l.auth_time)),issuedAtTime:bC(NU(l.iat)),expirationTime:bC(NU(l.exp)),signInProvider:f||null,signInSecondFactor:(u==null?void 0:u.sign_in_second_factor)||null}}function NU(n){return Number(n)*1e3}function w4(n){const[e,i,o]=n.split(".");if(e===void 0||i===void 0||o===void 0)return Ck("JWT malformed, contained fewer than 3 sections"),null;try{const l=Yre(i);return l?JSON.parse(l):(Ck("Failed to decode base64 JWT payload"),null)}catch(l){return Ck("Caught error parsing JWT payload as JSON",l==null?void 0:l.toString()),null}}function qX(n){const e=w4(n);return Gn(e,"internal-error"),Gn(typeof e.exp<"u","internal-error"),Gn(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function JC(n,e,i=!1){if(i)return e;try{return await e}catch(o){throw o instanceof Pp&&Pje(o)&&n.auth.currentUser===n&&await n.auth.signOut(),o}}function Pje({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Oje{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){var i;if(e){const o=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),o}else{this.errorBackoff=3e4;const l=((i=this.user.stsTokenManager.expirationTime)!==null&&i!==void 0?i:0)-Date.now()-3e5;return Math.max(0,l)}}schedule(e=!1){if(!this.isRunning)return;const i=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},i)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(e==null?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nj{constructor(e,i){this.createdAt=e,this.lastLoginAt=i,this._initializeTime()}_initializeTime(){this.lastSignInTime=bC(this.lastLoginAt),this.creationTime=bC(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function i1(n){var e;const i=n.auth,o=await n.getIdToken(),l=await JC(n,hie(i,{idToken:o}));Gn(l==null?void 0:l.users.length,i,"internal-error");const u=l.users[0];n._notifyReloadListener(u);const f=!((e=u.providerUserInfo)===null||e===void 0)&&e.length?pie(u.providerUserInfo):[],_=Nje(n.providerData,f),E=n.isAnonymous,b=!(n.email&&u.passwordHash)&&!(_!=null&&_.length),C=E?b:!1,I={uid:u.localId,displayName:u.displayName||null,photoURL:u.photoUrl||null,email:u.email||null,emailVerified:u.emailVerified||!1,phoneNumber:u.phoneNumber||null,tenantId:u.tenantId||null,providerData:_,metadata:new nj(u.createdAt,u.lastLoginAt),isAnonymous:C};Object.assign(n,I)}async function kje(n){const e=qi(n);await i1(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function Nje(n,e){return[...n.filter(o=>!e.some(l=>l.providerId===o.providerId)),...e]}function pie(n){return n.map(e=>{var{providerId:i}=e,o=_R(e,["providerId"]);return{providerId:i,uid:o.rawId||"",displayName:o.displayName||null,email:o.email||null,phoneNumber:o.phoneNumber||null,photoURL:o.photoUrl||null}})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Dje(n,e){const i=await uie(n,{},async()=>{const o=RR({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:l,apiKey:u}=n.config,f=die(n,l,"/v1/token",`key=${u}`),_=await n._getAdditionalHeaders();return _["Content-Type"]="application/x-www-form-urlencoded",lie.fetch()(f,{method:"POST",headers:_,body:o})});return{accessToken:i.access_token,expiresIn:i.expires_in,refreshToken:i.refresh_token}}async function xje(n,e){return am(n,"POST","/v2/accounts:revokeToken",om(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _0{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){Gn(e.idToken,"internal-error"),Gn(typeof e.idToken<"u","internal-error"),Gn(typeof e.refreshToken<"u","internal-error");const i="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):qX(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,i)}updateFromIdToken(e){Gn(e.length!==0,"internal-error");const i=qX(e);this.updateTokensAndExpiration(e,null,i)}async getToken(e,i=!1){return!i&&this.accessToken&&!this.isExpired?this.accessToken:(Gn(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,i){const{accessToken:o,refreshToken:l,expiresIn:u}=await Dje(e,i);this.updateTokensAndExpiration(o,l,Number(u))}updateTokensAndExpiration(e,i,o){this.refreshToken=i||null,this.accessToken=e||null,this.expirationTime=Date.now()+o*1e3}static fromJSON(e,i){const{refreshToken:o,accessToken:l,expirationTime:u}=i,f=new _0;return o&&(Gn(typeof o=="string","internal-error",{appName:e}),f.refreshToken=o),l&&(Gn(typeof l=="string","internal-error",{appName:e}),f.accessToken=l),u&&(Gn(typeof u=="number","internal-error",{appName:e}),f.expirationTime=u),f}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new _0,this.toJSON())}_performRefresh(){return jf("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Eg(n,e){Gn(typeof n=="string"||typeof n>"u","internal-error",{appName:e})}class Ff{constructor(e){var{uid:i,auth:o,stsTokenManager:l}=e,u=_R(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new Oje(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=i,this.auth=o,this.stsTokenManager=l,this.accessToken=l.accessToken,this.displayName=u.displayName||null,this.email=u.email||null,this.emailVerified=u.emailVerified||!1,this.phoneNumber=u.phoneNumber||null,this.photoURL=u.photoURL||null,this.isAnonymous=u.isAnonymous||!1,this.tenantId=u.tenantId||null,this.providerData=u.providerData?[...u.providerData]:[],this.metadata=new nj(u.createdAt||void 0,u.lastLoginAt||void 0)}async getIdToken(e){const i=await JC(this,this.stsTokenManager.getToken(this.auth,e));return Gn(i,this.auth,"internal-error"),this.accessToken!==i&&(this.accessToken=i,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),i}getIdTokenResult(e){return Aje(this,e)}reload(){return kje(this)}_assign(e){this!==e&&(Gn(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(i=>Object.assign({},i)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const i=new Ff(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return i.metadata._copy(this.metadata),i}_onReload(e){Gn(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,i=!1){let o=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),o=!0),i&&await i1(this),await this.auth._persistUserIfCurrent(this),o&&this.auth._notifyListenersIfCurrent(this)}async delete(){if($l(this.auth.app))return Promise.reject(qf(this.auth));const e=await this.getIdToken();return await JC(this,Ije(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,i){var o,l,u,f,_,E,b,C;const I=(o=i.displayName)!==null&&o!==void 0?o:void 0,P=(l=i.email)!==null&&l!==void 0?l:void 0,L=(u=i.phoneNumber)!==null&&u!==void 0?u:void 0,M=(f=i.photoURL)!==null&&f!==void 0?f:void 0,F=(_=i.tenantId)!==null&&_!==void 0?_:void 0,B=(E=i._redirectEventId)!==null&&E!==void 0?E:void 0,Z=(b=i.createdAt)!==null&&b!==void 0?b:void 0,K=(C=i.lastLoginAt)!==null&&C!==void 0?C:void 0,{uid:re,emailVerified:ae,isAnonymous:ne,providerData:pe,stsTokenManager:X}=i;Gn(re&&X,e,"internal-error");const J=_0.fromJSON(this.name,X);Gn(typeof re=="string",e,"internal-error"),Eg(I,e.name),Eg(P,e.name),Gn(typeof ae=="boolean",e,"internal-error"),Gn(typeof ne=="boolean",e,"internal-error"),Eg(L,e.name),Eg(M,e.name),Eg(F,e.name),Eg(B,e.name),Eg(Z,e.name),Eg(K,e.name);const Y=new Ff({uid:re,auth:e,email:P,emailVerified:ae,displayName:I,isAnonymous:ne,photoURL:M,phoneNumber:L,tenantId:F,stsTokenManager:J,createdAt:Z,lastLoginAt:K});return pe&&Array.isArray(pe)&&(Y.providerData=pe.map(ie=>Object.assign({},ie))),B&&(Y._redirectEventId=B),Y}static async _fromIdTokenResponse(e,i,o=!1){const l=new _0;l.updateFromServerResponse(i);const u=new Ff({uid:i.localId,auth:e,stsTokenManager:l,isAnonymous:o});return await i1(u),u}static async _fromGetAccountInfoResponse(e,i,o){const l=i.users[0];Gn(l.localId!==void 0,"internal-error");const u=l.providerUserInfo!==void 0?pie(l.providerUserInfo):[],f=!(l.email&&l.passwordHash)&&!(u!=null&&u.length),_=new _0;_.updateFromIdToken(o);const E=new Ff({uid:l.localId,auth:e,stsTokenManager:_,isAnonymous:f}),b={uid:l.localId,displayName:l.displayName||null,photoURL:l.photoUrl||null,email:l.email||null,emailVerified:l.emailVerified||!1,phoneNumber:l.phoneNumber||null,tenantId:l.tenantId||null,providerData:u,metadata:new nj(l.createdAt,l.lastLoginAt),isAnonymous:!(l.email&&l.passwordHash)&&!(u!=null&&u.length)};return Object.assign(E,b),E}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const YX=new Map;function Bf(n){nm(n instanceof Function,"Expected a class definition");let e=YX.get(n);return e?(nm(e instanceof n,"Instance stored in cache mismatched with class"),e):(e=new n,YX.set(n,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fie{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,i){this.storage[e]=i}async _get(e){const i=this.storage[e];return i===void 0?null:i}async _remove(e){delete this.storage[e]}_addListener(e,i){}_removeListener(e,i){}}fie.type="NONE";const XX=fie;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Rk(n,e,i){return`firebase:${n}:${e}:${i}`}class y0{constructor(e,i,o){this.persistence=e,this.auth=i,this.userKey=o;const{config:l,name:u}=this.auth;this.fullUserKey=Rk(this.userKey,l.apiKey,u),this.fullPersistenceKey=Rk("persistence",l.apiKey,u),this.boundEventHandler=i._onStorageEvent.bind(i),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);return e?Ff._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const i=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,i)return this.setCurrentUser(i)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,i,o="authUser"){if(!i.length)return new y0(Bf(XX),e,o);const l=(await Promise.all(i.map(async b=>{if(await b._isAvailable())return b}))).filter(b=>b);let u=l[0]||Bf(XX);const f=Rk(o,e.config.apiKey,e.name);let _=null;for(const b of i)try{const C=await b._get(f);if(C){const I=Ff._fromJSON(e,C);b!==u&&(_=I),u=b;break}}catch{}const E=l.filter(b=>b._shouldAllowMigration);return!u._shouldAllowMigration||!E.length?new y0(u,e,o):(u=E[0],_&&await u._set(f,_.toJSON()),await Promise.all(i.map(async b=>{if(b!==u)try{await b._remove(f)}catch{}})),new y0(u,e,o))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function JX(n){const e=n.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(yie(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(mie(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(vie(e))return"Blackberry";if(Sie(e))return"Webos";if(gie(e))return"Safari";if((e.includes("chrome/")||_ie(e))&&!e.includes("edge/"))return"Chrome";if(Eie(e))return"Android";{const i=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,o=n.match(i);if((o==null?void 0:o.length)===2)return o[1]}return"Other"}function mie(n=lc()){return/firefox\//i.test(n)}function gie(n=lc()){const e=n.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function _ie(n=lc()){return/crios\//i.test(n)}function yie(n=lc()){return/iemobile/i.test(n)}function Eie(n=lc()){return/android/i.test(n)}function vie(n=lc()){return/blackberry/i.test(n)}function Sie(n=lc()){return/webos/i.test(n)}function T4(n=lc()){return/iphone|ipad|ipod/i.test(n)||/macintosh/i.test(n)&&/mobile/i.test(n)}function Lje(n=lc()){var e;return T4(n)&&!!(!((e=window.navigator)===null||e===void 0)&&e.standalone)}function Mje(){return JUe()&&document.documentMode===10}function bie(n=lc()){return T4(n)||Eie(n)||Sie(n)||vie(n)||/windows phone/i.test(n)||yie(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wie(n,e=[]){let i;switch(n){case"Browser":i=JX(lc());break;case"Worker":i=`${JX(lc())}-${n}`;break;default:i=n}const o=e.length?e.join(","):"FirebaseCore-web";return`${i}/JsCore/${uE}/${o}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Uje{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,i){const o=u=>new Promise((f,_)=>{try{const E=e(u);f(E)}catch(E){_(E)}});o.onAbort=i,this.queue.push(o);const l=this.queue.length-1;return()=>{this.queue[l]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const i=[];try{for(const o of this.queue)await o(e),o.onAbort&&i.push(o.onAbort)}catch(o){i.reverse();for(const l of i)try{l()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:o==null?void 0:o.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Vje(n,e={}){return am(n,"GET","/v2/passwordPolicy",om(n,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jje=6;class Fje{constructor(e){var i,o,l,u;const f=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(i=f.minPasswordLength)!==null&&i!==void 0?i:jje,f.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=f.maxPasswordLength),f.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=f.containsLowercaseCharacter),f.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=f.containsUppercaseCharacter),f.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=f.containsNumericCharacter),f.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=f.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(l=(o=e.allowedNonAlphanumericCharacters)===null||o===void 0?void 0:o.join(""))!==null&&l!==void 0?l:"",this.forceUpgradeOnSignin=(u=e.forceUpgradeOnSignin)!==null&&u!==void 0?u:!1,this.schemaVersion=e.schemaVersion}validatePassword(e){var i,o,l,u,f,_;const E={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,E),this.validatePasswordCharacterOptions(e,E),E.isValid&&(E.isValid=(i=E.meetsMinPasswordLength)!==null&&i!==void 0?i:!0),E.isValid&&(E.isValid=(o=E.meetsMaxPasswordLength)!==null&&o!==void 0?o:!0),E.isValid&&(E.isValid=(l=E.containsLowercaseLetter)!==null&&l!==void 0?l:!0),E.isValid&&(E.isValid=(u=E.containsUppercaseLetter)!==null&&u!==void 0?u:!0),E.isValid&&(E.isValid=(f=E.containsNumericCharacter)!==null&&f!==void 0?f:!0),E.isValid&&(E.isValid=(_=E.containsNonAlphanumericCharacter)!==null&&_!==void 0?_:!0),E}validatePasswordLengthOptions(e,i){const o=this.customStrengthOptions.minPasswordLength,l=this.customStrengthOptions.maxPasswordLength;o&&(i.meetsMinPasswordLength=e.length>=o),l&&(i.meetsMaxPasswordLength=e.length<=l)}validatePasswordCharacterOptions(e,i){this.updatePasswordCharacterOptionsStatuses(i,!1,!1,!1,!1);let o;for(let l=0;l<e.length;l++)o=e.charAt(l),this.updatePasswordCharacterOptionsStatuses(i,o>="a"&&o<="z",o>="A"&&o<="Z",o>="0"&&o<="9",this.allowedNonAlphanumericCharacters.includes(o))}updatePasswordCharacterOptionsStatuses(e,i,o,l,u){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=i)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=o)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=l)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=u))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bje{constructor(e,i,o,l){this.app=e,this.heartbeatServiceProvider=i,this.appCheckServiceProvider=o,this.config=l,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new QX(this),this.idTokenSubscription=new QX(this),this.beforeStateQueue=new Uje(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=aie,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=l.sdkClientVersion}_initializeWithPersistence(e,i){return i&&(this._popupRedirectResolver=Bf(i)),this._initializationPromise=this.queue(async()=>{var o,l;if(!this._deleted&&(this.persistenceManager=await y0.create(this,e),!this._deleted)){if(!((o=this._popupRedirectResolver)===null||o===void 0)&&o._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(i),this.lastNotifiedUid=((l=this.currentUser)===null||l===void 0?void 0:l.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const i=await hie(this,{idToken:e}),o=await Ff._fromGetAccountInfoResponse(this,i,e);await this.directlySetCurrentUser(o)}catch(i){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",i),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var i;if($l(this.app)){const f=this.app.settings.authIdToken;return f?new Promise(_=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(f).then(_,_))}):this.directlySetCurrentUser(null)}const o=await this.assertedPersistence.getCurrentUser();let l=o,u=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const f=(i=this.redirectUser)===null||i===void 0?void 0:i._redirectEventId,_=l==null?void 0:l._redirectEventId,E=await this.tryRedirectSignIn(e);(!f||f===_)&&(E!=null&&E.user)&&(l=E.user,u=!0)}if(!l)return this.directlySetCurrentUser(null);if(!l._redirectEventId){if(u)try{await this.beforeStateQueue.runMiddleware(l)}catch(f){l=o,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(f))}return l?this.reloadAndSetCurrentUserOrClear(l):this.directlySetCurrentUser(null)}return Gn(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===l._redirectEventId?this.directlySetCurrentUser(l):this.reloadAndSetCurrentUserOrClear(l)}async tryRedirectSignIn(e){let i=null;try{i=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return i}async reloadAndSetCurrentUserOrClear(e){try{await i1(e)}catch(i){if((i==null?void 0:i.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=vje()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if($l(this.app))return Promise.reject(qf(this));const i=e?qi(e):null;return i&&Gn(i.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(i&&i._clone(this))}async _updateCurrentUser(e,i=!1){if(!this._deleted)return e&&Gn(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),i||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return $l(this.app)?Promise.reject(qf(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return $l(this.app)?Promise.reject(qf(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(Bf(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const i=this._getPasswordPolicyInternal();return i.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):i.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await Vje(this),i=new Fje(e);this.tenantId===null?this._projectPasswordPolicy=i:this._tenantPasswordPolicies[this.tenantId]=i}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new CR("auth","Firebase",e())}onAuthStateChanged(e,i,o){return this.registerStateListener(this.authStateSubscription,e,i,o)}beforeAuthStateChanged(e,i){return this.beforeStateQueue.pushCallback(e,i)}onIdTokenChanged(e,i,o){return this.registerStateListener(this.idTokenSubscription,e,i,o)}authStateReady(){return new Promise((e,i)=>{if(this.currentUser)e();else{const o=this.onAuthStateChanged(()=>{o(),e()},i)}})}async revokeAccessToken(e){if(this.currentUser){const i=await this.currentUser.getIdToken(),o={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:i};this.tenantId!=null&&(o.tenantId=this.tenantId),await xje(this,o)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)===null||e===void 0?void 0:e.toJSON()}}async _setRedirectUser(e,i){const o=await this.getOrInitRedirectPersistenceManager(i);return e===null?o.removeCurrentUser():o.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const i=e&&Bf(e)||this._popupRedirectResolver;Gn(i,this,"argument-error"),this.redirectPersistenceManager=await y0.create(this,[Bf(i._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var i,o;return this._isInitialized&&await this.queue(async()=>{}),((i=this._currentUser)===null||i===void 0?void 0:i._redirectEventId)===e?this._currentUser:((o=this.redirectUser)===null||o===void 0?void 0:o._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,i;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const o=(i=(e=this.currentUser)===null||e===void 0?void 0:e.uid)!==null&&i!==void 0?i:null;this.lastNotifiedUid!==o&&(this.lastNotifiedUid=o,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,i,o,l){if(this._deleted)return()=>{};const u=typeof i=="function"?i:i.next.bind(i);let f=!1;const _=this._isInitialized?Promise.resolve():this._initializationPromise;if(Gn(_,this,"internal-error"),_.then(()=>{f||u(this.currentUser)}),typeof i=="function"){const E=e.addObserver(i,o,l);return()=>{f=!0,E()}}else{const E=e.addObserver(i);return()=>{f=!0,E()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return Gn(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=wie(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const i={"X-Client-Version":this.clientVersion};this.app.options.appId&&(i["X-Firebase-gmpid"]=this.app.options.appId);const o=await((e=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getHeartbeatsHeader());o&&(i["X-Firebase-Client"]=o);const l=await this._getAppCheckToken();return l&&(i["X-Firebase-AppCheck"]=l),i}async _getAppCheckToken(){var e;if($l(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const i=await((e=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getToken());return i!=null&&i.error&&_je(`Error while retrieving App Check token: ${i.error}`),i==null?void 0:i.token}}function Zg(n){return qi(n)}class QX{constructor(e){this.auth=e,this.observer=null,this.addObserver=sVe(i=>this.observer=i)}get next(){return Gn(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let lN={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function Wje(n){lN=n}function Tie(n){return lN.loadJS(n)}function zje(){return lN.recaptchaEnterpriseScript}function Gje(){return lN.gapiScript}function Hje(n){return`__${n}${Math.floor(Math.random()*1e6)}`}class $je{constructor(){this.enterprise=new Kje}ready(e){e()}execute(e,i){return Promise.resolve("token")}render(e,i){return""}}class Kje{ready(e){e()}execute(e,i){return Promise.resolve("token")}render(e,i){return""}}const qje="recaptcha-enterprise",Cie="NO_RECAPTCHA";class Yje{constructor(e){this.type=qje,this.auth=Zg(e)}async verify(e="verify",i=!1){async function o(u){if(!i){if(u.tenantId==null&&u._agentRecaptchaConfig!=null)return u._agentRecaptchaConfig.siteKey;if(u.tenantId!=null&&u._tenantRecaptchaConfigs[u.tenantId]!==void 0)return u._tenantRecaptchaConfigs[u.tenantId].siteKey}return new Promise(async(f,_)=>{Rje(u,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(E=>{if(E.recaptchaKey===void 0)_(new Error("recaptcha Enterprise site key undefined"));else{const b=new Cje(E);return u.tenantId==null?u._agentRecaptchaConfig=b:u._tenantRecaptchaConfigs[u.tenantId]=b,f(b.siteKey)}}).catch(E=>{_(E)})})}function l(u,f,_){const E=window.grecaptcha;KX(E)?E.enterprise.ready(()=>{E.enterprise.execute(u,{action:e}).then(b=>{f(b)}).catch(()=>{f(Cie)})}):_(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new $je().execute("siteKey",{action:"verify"}):new Promise((u,f)=>{o(this.auth).then(_=>{if(!i&&KX(window.grecaptcha))l(_,u,f);else{if(typeof window>"u"){f(new Error("RecaptchaVerifier is only supported in browser"));return}let E=zje();E.length!==0&&(E+=_),Tie(E).then(()=>{l(_,u,f)}).catch(b=>{f(b)})}}).catch(_=>{f(_)})})}}async function ZX(n,e,i,o=!1,l=!1){const u=new Yje(n);let f;if(l)f=Cie;else try{f=await u.verify(i)}catch{f=await u.verify(i,!0)}const _=Object.assign({},e);if(i==="mfaSmsEnrollment"||i==="mfaSmsSignIn"){if("phoneEnrollmentInfo"in _){const E=_.phoneEnrollmentInfo.phoneNumber,b=_.phoneEnrollmentInfo.recaptchaToken;Object.assign(_,{phoneEnrollmentInfo:{phoneNumber:E,recaptchaToken:b,captchaResponse:f,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in _){const E=_.phoneSignInInfo.recaptchaToken;Object.assign(_,{phoneSignInInfo:{recaptchaToken:E,captchaResponse:f,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return _}return o?Object.assign(_,{captchaResp:f}):Object.assign(_,{captchaResponse:f}),Object.assign(_,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(_,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),_}async function s1(n,e,i,o,l){var u;if(!((u=n._getRecaptchaConfig())===null||u===void 0)&&u.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const f=await ZX(n,e,i,i==="getOobCode");return o(n,f)}else return o(n,e).catch(async f=>{if(f.code==="auth/missing-recaptcha-token"){console.log(`${i} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const _=await ZX(n,e,i,i==="getOobCode");return o(n,_)}else return Promise.reject(f)})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Xje(n,e){const i=cN(n,"auth");if(i.isInitialized()){const l=i.getImmediate(),u=i.getOptions();if(em(u,e??{}))return l;Jd(l,"already-initialized")}return i.initialize({options:e})}function Jje(n,e){const i=(e==null?void 0:e.persistence)||[],o=(Array.isArray(i)?i:[i]).map(Bf);e!=null&&e.errorMap&&n._updateErrorMap(e.errorMap),n._initializeWithPersistence(o,e==null?void 0:e.popupRedirectResolver)}function Qje(n,e,i){const o=Zg(n);Gn(/^https?:\/\//.test(e),o,"invalid-emulator-scheme");const l=!1,u=Rie(e),{host:f,port:_}=Zje(e),E=_===null?"":`:${_}`,b={url:`${u}//${f}${E}/`},C=Object.freeze({host:f,port:_,protocol:u.replace(":",""),options:Object.freeze({disableWarnings:l})});if(!o._canInitEmulator){Gn(o.config.emulator&&o.emulatorConfig,o,"emulator-config-failed"),Gn(em(b,o.config.emulator)&&em(C,o.emulatorConfig),o,"emulator-config-failed");return}o.config.emulator=b,o.emulatorConfig=C,o.settings.appVerificationDisabledForTesting=!0,eFe()}function Rie(n){const e=n.indexOf(":");return e<0?"":n.substr(0,e+1)}function Zje(n){const e=Rie(n),i=/(\/\/)?([^?#/]+)/.exec(n.substr(e.length));if(!i)return{host:"",port:null};const o=i[2].split("@").pop()||"",l=/^(\[[^\]]+\])(:|$)/.exec(o);if(l){const u=l[1];return{host:u,port:eJ(o.substr(u.length+1))}}else{const[u,f]=o.split(":");return{host:u,port:eJ(f)}}}function eJ(n){if(!n)return null;const e=Number(n);return isNaN(e)?null:e}function eFe(){function n(){const e=document.createElement("p"),i=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",i.position="fixed",i.width="100%",i.backgroundColor="#ffffff",i.border=".1em solid #000000",i.color="#b50000",i.bottom="0px",i.left="0px",i.margin="0px",i.zIndex="10000",i.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",n):n())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class C4{constructor(e,i){this.providerId=e,this.signInMethod=i}toJSON(){return jf("not implemented")}_getIdTokenResponse(e){return jf("not implemented")}_linkToIdToken(e,i){return jf("not implemented")}_getReauthenticationResolver(e){return jf("not implemented")}}async function tFe(n,e){return am(n,"POST","/v1/accounts:signUp",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function nFe(n,e){return AR(n,"POST","/v1/accounts:signInWithPassword",om(n,e))}async function Iie(n,e){return am(n,"POST","/v1/accounts:sendOobCode",om(n,e))}async function rFe(n,e){return Iie(n,e)}async function iFe(n,e){return Iie(n,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function sFe(n,e){return AR(n,"POST","/v1/accounts:signInWithEmailLink",om(n,e))}async function oFe(n,e){return AR(n,"POST","/v1/accounts:signInWithEmailLink",om(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class QC extends C4{constructor(e,i,o,l=null){super("password",o),this._email=e,this._password=i,this._tenantId=l}static _fromEmailAndPassword(e,i){return new QC(e,i,"password")}static _fromEmailAndCode(e,i,o=null){return new QC(e,i,"emailLink",o)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const i=typeof e=="string"?JSON.parse(e):e;if(i!=null&&i.email&&(i!=null&&i.password)){if(i.signInMethod==="password")return this._fromEmailAndPassword(i.email,i.password);if(i.signInMethod==="emailLink")return this._fromEmailAndCode(i.email,i.password,i.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":const i={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return s1(e,i,"signInWithPassword",nFe);case"emailLink":return sFe(e,{email:this._email,oobCode:this._password});default:Jd(e,"internal-error")}}async _linkToIdToken(e,i){switch(this.signInMethod){case"password":const o={idToken:i,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return s1(e,o,"signUpPassword",tFe);case"emailLink":return oFe(e,{idToken:i,email:this._email,oobCode:this._password});default:Jd(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function E0(n,e){return AR(n,"POST","/v1/accounts:signInWithIdp",om(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const aFe="http://localhost";class nE extends C4{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const i=new nE(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(i.idToken=e.idToken),e.accessToken&&(i.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(i.nonce=e.nonce),e.pendingToken&&(i.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(i.accessToken=e.oauthToken,i.secret=e.oauthTokenSecret):Jd("argument-error"),i}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const i=typeof e=="string"?JSON.parse(e):e,{providerId:o,signInMethod:l}=i,u=_R(i,["providerId","signInMethod"]);if(!o||!l)return null;const f=new nE(o,l);return f.idToken=u.idToken||void 0,f.accessToken=u.accessToken||void 0,f.secret=u.secret,f.nonce=u.nonce,f.pendingToken=u.pendingToken||null,f}_getIdTokenResponse(e){const i=this.buildRequest();return E0(e,i)}_linkToIdToken(e,i){const o=this.buildRequest();return o.idToken=i,E0(e,o)}_getReauthenticationResolver(e){const i=this.buildRequest();return i.autoCreate=!1,E0(e,i)}buildRequest(){const e={requestUri:aFe,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const i={};this.idToken&&(i.id_token=this.idToken),this.accessToken&&(i.access_token=this.accessToken),this.secret&&(i.oauth_token_secret=this.secret),i.providerId=this.providerId,this.nonce&&!this.pendingToken&&(i.nonce=this.nonce),e.postBody=RR(i)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function cFe(n){switch(n){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function lFe(n){const e=nC(rC(n)).link,i=e?nC(rC(e)).deep_link_id:null,o=nC(rC(n)).deep_link_id;return(o?nC(rC(o)).link:null)||o||i||e||n}class R4{constructor(e){var i,o,l,u,f,_;const E=nC(rC(e)),b=(i=E.apiKey)!==null&&i!==void 0?i:null,C=(o=E.oobCode)!==null&&o!==void 0?o:null,I=cFe((l=E.mode)!==null&&l!==void 0?l:null);Gn(b&&C&&I,"argument-error"),this.apiKey=b,this.operation=I,this.code=C,this.continueUrl=(u=E.continueUrl)!==null&&u!==void 0?u:null,this.languageCode=(f=E.languageCode)!==null&&f!==void 0?f:null,this.tenantId=(_=E.tenantId)!==null&&_!==void 0?_:null}static parseLink(e){const i=lFe(e);try{return new R4(i)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nb{constructor(){this.providerId=nb.PROVIDER_ID}static credential(e,i){return QC._fromEmailAndPassword(e,i)}static credentialWithLink(e,i){const o=R4.parseLink(i);return Gn(o,"argument-error"),QC._fromEmailAndCode(e,o.code,o.tenantId)}}nb.PROVIDER_ID="password";nb.EMAIL_PASSWORD_SIGN_IN_METHOD="password";nb.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Aie{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PR extends Aie{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cg extends PR{constructor(){super("facebook.com")}static credential(e){return nE._fromParams({providerId:Cg.PROVIDER_ID,signInMethod:Cg.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Cg.credentialFromTaggedObject(e)}static credentialFromError(e){return Cg.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Cg.credential(e.oauthAccessToken)}catch{return null}}}Cg.FACEBOOK_SIGN_IN_METHOD="facebook.com";Cg.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rg extends PR{constructor(){super("google.com"),this.addScope("profile")}static credential(e,i){return nE._fromParams({providerId:Rg.PROVIDER_ID,signInMethod:Rg.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:i})}static credentialFromResult(e){return Rg.credentialFromTaggedObject(e)}static credentialFromError(e){return Rg.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:i,oauthAccessToken:o}=e;if(!i&&!o)return null;try{return Rg.credential(i,o)}catch{return null}}}Rg.GOOGLE_SIGN_IN_METHOD="google.com";Rg.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ig extends PR{constructor(){super("github.com")}static credential(e){return nE._fromParams({providerId:Ig.PROVIDER_ID,signInMethod:Ig.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Ig.credentialFromTaggedObject(e)}static credentialFromError(e){return Ig.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Ig.credential(e.oauthAccessToken)}catch{return null}}}Ig.GITHUB_SIGN_IN_METHOD="github.com";Ig.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ag extends PR{constructor(){super("twitter.com")}static credential(e,i){return nE._fromParams({providerId:Ag.PROVIDER_ID,signInMethod:Ag.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:i})}static credentialFromResult(e){return Ag.credentialFromTaggedObject(e)}static credentialFromError(e){return Ag.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:i,oauthTokenSecret:o}=e;if(!i||!o)return null;try{return Ag.credential(i,o)}catch{return null}}}Ag.TWITTER_SIGN_IN_METHOD="twitter.com";Ag.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function uFe(n,e){return AR(n,"POST","/v1/accounts:signUp",om(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rE{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,i,o,l=!1){const u=await Ff._fromIdTokenResponse(e,o,l),f=tJ(o);return new rE({user:u,providerId:f,_tokenResponse:o,operationType:i})}static async _forOperation(e,i,o){await e._updateTokensIfNecessary(o,!0);const l=tJ(o);return new rE({user:e,providerId:l,_tokenResponse:o,operationType:i})}}function tJ(n){return n.providerId?n.providerId:"phoneNumber"in n?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class o1 extends Pp{constructor(e,i,o,l){var u;super(i.code,i.message),this.operationType=o,this.user=l,Object.setPrototypeOf(this,o1.prototype),this.customData={appName:e.name,tenantId:(u=e.tenantId)!==null&&u!==void 0?u:void 0,_serverResponse:i.customData._serverResponse,operationType:o}}static _fromErrorAndOperation(e,i,o,l){return new o1(e,i,o,l)}}function Pie(n,e,i,o){return(e==="reauthenticate"?i._getReauthenticationResolver(n):i._getIdTokenResponse(n)).catch(u=>{throw u.code==="auth/multi-factor-auth-required"?o1._fromErrorAndOperation(n,u,e,o):u})}async function dFe(n,e,i=!1){const o=await JC(n,e._linkToIdToken(n.auth,await n.getIdToken()),i);return rE._forOperation(n,"link",o)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function hFe(n,e,i=!1){const{auth:o}=n;if($l(o.app))return Promise.reject(qf(o));const l="reauthenticate";try{const u=await JC(n,Pie(o,l,e,n),i);Gn(u.idToken,o,"internal-error");const f=w4(u.idToken);Gn(f,o,"internal-error");const{sub:_}=f;return Gn(n.uid===_,o,"user-mismatch"),rE._forOperation(n,l,u)}catch(u){throw(u==null?void 0:u.code)==="auth/user-not-found"&&Jd(o,"user-mismatch"),u}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Oie(n,e,i=!1){if($l(n.app))return Promise.reject(qf(n));const o="signIn",l=await Pie(n,o,e),u=await rE._fromIdTokenResponse(n,o,l);return i||await n._updateCurrentUser(u.user),u}async function pFe(n,e){return Oie(Zg(n),e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function kie(n){const e=Zg(n);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}async function fFe(n,e,i){const o=Zg(n);await s1(o,{requestType:"PASSWORD_RESET",email:e,clientType:"CLIENT_TYPE_WEB"},"getOobCode",iFe)}async function mFe(n,e,i){if($l(n.app))return Promise.reject(qf(n));const o=Zg(n),f=await s1(o,{returnSecureToken:!0,email:e,password:i,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",uFe).catch(E=>{throw E.code==="auth/password-does-not-meet-requirements"&&kie(n),E}),_=await rE._fromIdTokenResponse(o,"signIn",f);return await o._updateCurrentUser(_.user),_}function gFe(n,e,i){return $l(n.app)?Promise.reject(qf(n)):pFe(qi(n),nb.credential(e,i)).catch(async o=>{throw o.code==="auth/password-does-not-meet-requirements"&&kie(n),o})}async function Nie(n,e){const i=qi(n),l={requestType:"VERIFY_EMAIL",idToken:await n.getIdToken()},{email:u}=await rFe(i.auth,l);u!==n.email&&await n.reload()}function _Fe(n,e,i,o){return qi(n).onIdTokenChanged(e,i,o)}function yFe(n,e,i){return qi(n).beforeAuthStateChanged(e,i)}function EFe(n,e,i,o){return qi(n).onAuthStateChanged(e,i,o)}function vFe(n){return qi(n).signOut()}const a1="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Die{constructor(e,i){this.storageRetriever=e,this.type=i}_isAvailable(){try{return this.storage?(this.storage.setItem(a1,"1"),this.storage.removeItem(a1),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,i){return this.storage.setItem(e,JSON.stringify(i)),Promise.resolve()}_get(e){const i=this.storage.getItem(e);return Promise.resolve(i?JSON.parse(i):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const SFe=1e3,bFe=10;class xie extends Die{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,i)=>this.onStorageEvent(e,i),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=bie(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const i of Object.keys(this.listeners)){const o=this.storage.getItem(i),l=this.localCache[i];o!==l&&e(i,l,o)}}onStorageEvent(e,i=!1){if(!e.key){this.forAllChangedKeys((f,_,E)=>{this.notifyListeners(f,E)});return}const o=e.key;i?this.detachListener():this.stopPolling();const l=()=>{const f=this.storage.getItem(o);!i&&this.localCache[o]===f||this.notifyListeners(o,f)},u=this.storage.getItem(o);Mje()&&u!==e.newValue&&e.newValue!==e.oldValue?setTimeout(l,bFe):l()}notifyListeners(e,i){this.localCache[e]=i;const o=this.listeners[e];if(o)for(const l of Array.from(o))l(i&&JSON.parse(i))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,i,o)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:i,newValue:o}),!0)})},SFe)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,i){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(i)}_removeListener(e,i){this.listeners[e]&&(this.listeners[e].delete(i),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,i){await super._set(e,i),this.localCache[e]=JSON.stringify(i)}async _get(e){const i=await super._get(e);return this.localCache[e]=JSON.stringify(i),i}async _remove(e){await super._remove(e),delete this.localCache[e]}}xie.type="LOCAL";const wFe=xie;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lie extends Die{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,i){}_removeListener(e,i){}}Lie.type="SESSION";const Mie=Lie;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function TFe(n){return Promise.all(n.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(i){return{fulfilled:!1,reason:i}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uN{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const i=this.receivers.find(l=>l.isListeningto(e));if(i)return i;const o=new uN(e);return this.receivers.push(o),o}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const i=e,{eventId:o,eventType:l,data:u}=i.data,f=this.handlersMap[l];if(!(f!=null&&f.size))return;i.ports[0].postMessage({status:"ack",eventId:o,eventType:l});const _=Array.from(f).map(async b=>b(i.origin,u)),E=await TFe(_);i.ports[0].postMessage({status:"done",eventId:o,eventType:l,response:E})}_subscribe(e,i){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(i)}_unsubscribe(e,i){this.handlersMap[e]&&i&&this.handlersMap[e].delete(i),(!i||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}uN.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function I4(n="",e=10){let i="";for(let o=0;o<e;o++)i+=Math.floor(Math.random()*10);return n+i}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class CFe{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,i,o=50){const l=typeof MessageChannel<"u"?new MessageChannel:null;if(!l)throw new Error("connection_unavailable");let u,f;return new Promise((_,E)=>{const b=I4("",20);l.port1.start();const C=setTimeout(()=>{E(new Error("unsupported_event"))},o);f={messageChannel:l,onMessage(I){const P=I;if(P.data.eventId===b)switch(P.data.status){case"ack":clearTimeout(C),u=setTimeout(()=>{E(new Error("timeout"))},3e3);break;case"done":clearTimeout(u),_(P.data.response);break;default:clearTimeout(C),clearTimeout(u),E(new Error("invalid_response"));break}}},this.handlers.add(f),l.port1.addEventListener("message",f.onMessage),this.target.postMessage({eventType:e,eventId:b,data:i},[l.port2])}).finally(()=>{f&&this.removeMessageHandler(f)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Sp(){return window}function RFe(n){Sp().location.href=n}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Uie(){return typeof Sp().WorkerGlobalScope<"u"&&typeof Sp().importScripts=="function"}async function IFe(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function AFe(){var n;return((n=navigator==null?void 0:navigator.serviceWorker)===null||n===void 0?void 0:n.controller)||null}function PFe(){return Uie()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Vie="firebaseLocalStorageDb",OFe=1,c1="firebaseLocalStorage",jie="fbase_key";class OR{constructor(e){this.request=e}toPromise(){return new Promise((e,i)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{i(this.request.error)})})}}function dN(n,e){return n.transaction([c1],e?"readwrite":"readonly").objectStore(c1)}function kFe(){const n=indexedDB.deleteDatabase(Vie);return new OR(n).toPromise()}function rj(){const n=indexedDB.open(Vie,OFe);return new Promise((e,i)=>{n.addEventListener("error",()=>{i(n.error)}),n.addEventListener("upgradeneeded",()=>{const o=n.result;try{o.createObjectStore(c1,{keyPath:jie})}catch(l){i(l)}}),n.addEventListener("success",async()=>{const o=n.result;o.objectStoreNames.contains(c1)?e(o):(o.close(),await kFe(),e(await rj()))})})}async function nJ(n,e,i){const o=dN(n,!0).put({[jie]:e,value:i});return new OR(o).toPromise()}async function NFe(n,e){const i=dN(n,!1).get(e),o=await new OR(i).toPromise();return o===void 0?null:o.value}function rJ(n,e){const i=dN(n,!0).delete(e);return new OR(i).toPromise()}const DFe=800,xFe=3;class Fie{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await rj(),this.db)}async _withRetries(e){let i=0;for(;;)try{const o=await this._openDb();return await e(o)}catch(o){if(i++>xFe)throw o;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return Uie()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=uN._getInstance(PFe()),this.receiver._subscribe("keyChanged",async(e,i)=>({keyProcessed:(await this._poll()).includes(i.key)})),this.receiver._subscribe("ping",async(e,i)=>["keyChanged"])}async initializeSender(){var e,i;if(this.activeServiceWorker=await IFe(),!this.activeServiceWorker)return;this.sender=new CFe(this.activeServiceWorker);const o=await this.sender._send("ping",{},800);o&&!((e=o[0])===null||e===void 0)&&e.fulfilled&&!((i=o[0])===null||i===void 0)&&i.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||AFe()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await rj();return await nJ(e,a1,"1"),await rJ(e,a1),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,i){return this._withPendingWrite(async()=>(await this._withRetries(o=>nJ(o,e,i)),this.localCache[e]=i,this.notifyServiceWorker(e)))}async _get(e){const i=await this._withRetries(o=>NFe(o,e));return this.localCache[e]=i,i}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(i=>rJ(i,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(l=>{const u=dN(l,!1).getAll();return new OR(u).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const i=[],o=new Set;if(e.length!==0)for(const{fbase_key:l,value:u}of e)o.add(l),JSON.stringify(this.localCache[l])!==JSON.stringify(u)&&(this.notifyListeners(l,u),i.push(l));for(const l of Object.keys(this.localCache))this.localCache[l]&&!o.has(l)&&(this.notifyListeners(l,null),i.push(l));return i}notifyListeners(e,i){this.localCache[e]=i;const o=this.listeners[e];if(o)for(const l of Array.from(o))l(i)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),DFe)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,i){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(i)}_removeListener(e,i){this.listeners[e]&&(this.listeners[e].delete(i),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}Fie.type="LOCAL";const LFe=Fie;new IR(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function MFe(n,e){return e?Bf(e):(Gn(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class A4 extends C4{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return E0(e,this._buildIdpRequest())}_linkToIdToken(e,i){return E0(e,this._buildIdpRequest(i))}_getReauthenticationResolver(e){return E0(e,this._buildIdpRequest())}_buildIdpRequest(e){const i={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(i.idToken=e),i}}function UFe(n){return Oie(n.auth,new A4(n),n.bypassAuthState)}function VFe(n){const{auth:e,user:i}=n;return Gn(i,e,"internal-error"),hFe(i,new A4(n),n.bypassAuthState)}async function jFe(n){const{auth:e,user:i}=n;return Gn(i,e,"internal-error"),dFe(i,new A4(n),n.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bie{constructor(e,i,o,l,u=!1){this.auth=e,this.resolver=o,this.user=l,this.bypassAuthState=u,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(i)?i:[i]}execute(){return new Promise(async(e,i)=>{this.pendingPromise={resolve:e,reject:i};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(o){this.reject(o)}})}async onAuthEvent(e){const{urlResponse:i,sessionId:o,postBody:l,tenantId:u,error:f,type:_}=e;if(f){this.reject(f);return}const E={auth:this.auth,requestUri:i,sessionId:o,tenantId:u||void 0,postBody:l||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(_)(E))}catch(b){this.reject(b)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return UFe;case"linkViaPopup":case"linkViaRedirect":return jFe;case"reauthViaPopup":case"reauthViaRedirect":return VFe;default:Jd(this.auth,"internal-error")}}resolve(e){nm(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){nm(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const FFe=new IR(2e3,1e4);class i0 extends Bie{constructor(e,i,o,l,u){super(e,i,l,u),this.provider=o,this.authWindow=null,this.pollId=null,i0.currentPopupAction&&i0.currentPopupAction.cancel(),i0.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return Gn(e,this.auth,"internal-error"),e}async onExecution(){nm(this.filter.length===1,"Popup operations only handle one event");const e=I4();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(i=>{this.reject(i)}),this.resolver._isIframeWebStorageSupported(this.auth,i=>{i||this.reject(vp(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)===null||e===void 0?void 0:e.associatedEvent)||null}cancel(){this.reject(vp(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,i0.currentPopupAction=null}pollUserCancellation(){const e=()=>{var i,o;if(!((o=(i=this.authWindow)===null||i===void 0?void 0:i.window)===null||o===void 0)&&o.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(vp(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,FFe.get())};e()}}i0.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const BFe="pendingRedirect",Ik=new Map;class WFe extends Bie{constructor(e,i,o=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],i,void 0,o),this.eventId=null}async execute(){let e=Ik.get(this.auth._key());if(!e){try{const o=await zFe(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(o)}catch(i){e=()=>Promise.reject(i)}Ik.set(this.auth._key(),e)}return this.bypassAuthState||Ik.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const i=await this.auth._redirectUserForId(e.eventId);if(i)return this.user=i,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function zFe(n,e){const i=$Fe(e),o=HFe(n);if(!await o._isAvailable())return!1;const l=await o._get(i)==="true";return await o._remove(i),l}function GFe(n,e){Ik.set(n._key(),e)}function HFe(n){return Bf(n._redirectPersistence)}function $Fe(n){return Rk(BFe,n.config.apiKey,n.name)}async function KFe(n,e,i=!1){if($l(n.app))return Promise.reject(qf(n));const o=Zg(n),l=MFe(o,e),f=await new WFe(o,l,i).execute();return f&&!i&&(delete f.user._redirectEventId,await o._persistUserIfCurrent(f.user),await o._setRedirectUser(null,e)),f}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qFe=10*60*1e3;class YFe{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let i=!1;return this.consumers.forEach(o=>{this.isEventForConsumer(e,o)&&(i=!0,this.sendToConsumer(e,o),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!XFe(e)||(this.hasHandledPotentialRedirect=!0,i||(this.queuedRedirectEvent=e,i=!0)),i}sendToConsumer(e,i){var o;if(e.error&&!Wie(e)){const l=((o=e.error.code)===null||o===void 0?void 0:o.split("auth/")[1])||"internal-error";i.onError(vp(this.auth,l))}else i.onAuthEvent(e)}isEventForConsumer(e,i){const o=i.eventId===null||!!e.eventId&&e.eventId===i.eventId;return i.filter.includes(e.type)&&o}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=qFe&&this.cachedEventUids.clear(),this.cachedEventUids.has(iJ(e))}saveEventToCache(e){this.cachedEventUids.add(iJ(e)),this.lastProcessedEventTime=Date.now()}}function iJ(n){return[n.type,n.eventId,n.sessionId,n.tenantId].filter(e=>e).join("-")}function Wie({type:n,error:e}){return n==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function XFe(n){switch(n.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return Wie(n);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function JFe(n,e={}){return am(n,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const QFe=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,ZFe=/^https?/;async function e4e(n){if(n.config.emulator)return;const{authorizedDomains:e}=await JFe(n);for(const i of e)try{if(t4e(i))return}catch{}Jd(n,"unauthorized-domain")}function t4e(n){const e=tj(),{protocol:i,hostname:o}=new URL(e);if(n.startsWith("chrome-extension://")){const f=new URL(n);return f.hostname===""&&o===""?i==="chrome-extension:"&&n.replace("chrome-extension://","")===e.replace("chrome-extension://",""):i==="chrome-extension:"&&f.hostname===o}if(!ZFe.test(i))return!1;if(QFe.test(n))return o===n;const l=n.replace(/\./g,"\\.");return new RegExp("^(.+\\."+l+"|"+l+")$","i").test(o)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const n4e=new IR(3e4,6e4);function sJ(){const n=Sp().___jsl;if(n!=null&&n.H){for(const e of Object.keys(n.H))if(n.H[e].r=n.H[e].r||[],n.H[e].L=n.H[e].L||[],n.H[e].r=[...n.H[e].L],n.CP)for(let i=0;i<n.CP.length;i++)n.CP[i]=null}}function r4e(n){return new Promise((e,i)=>{var o,l,u;function f(){sJ(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{sJ(),i(vp(n,"network-request-failed"))},timeout:n4e.get()})}if(!((l=(o=Sp().gapi)===null||o===void 0?void 0:o.iframes)===null||l===void 0)&&l.Iframe)e(gapi.iframes.getContext());else if(!((u=Sp().gapi)===null||u===void 0)&&u.load)f();else{const _=Hje("iframefcb");return Sp()[_]=()=>{gapi.load?f():i(vp(n,"network-request-failed"))},Tie(`${Gje()}?onload=${_}`).catch(E=>i(E))}}).catch(e=>{throw Ak=null,e})}let Ak=null;function i4e(n){return Ak=Ak||r4e(n),Ak}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const s4e=new IR(5e3,15e3),o4e="__/auth/iframe",a4e="emulator/auth/iframe",c4e={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},l4e=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function u4e(n){const e=n.config;Gn(e.authDomain,n,"auth-domain-config-required");const i=e.emulator?b4(e,a4e):`https://${n.config.authDomain}/${o4e}`,o={apiKey:e.apiKey,appName:n.name,v:uE},l=l4e.get(n.config.apiHost);l&&(o.eid=l);const u=n._getFrameworks();return u.length&&(o.fw=u.join(",")),`${i}?${RR(o).slice(1)}`}async function d4e(n){const e=await i4e(n),i=Sp().gapi;return Gn(i,n,"internal-error"),e.open({where:document.body,url:u4e(n),messageHandlersFilter:i.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:c4e,dontclear:!0},o=>new Promise(async(l,u)=>{await o.restyle({setHideOnLeave:!1});const f=vp(n,"network-request-failed"),_=Sp().setTimeout(()=>{u(f)},s4e.get());function E(){Sp().clearTimeout(_),l(o)}o.ping(E).then(E,()=>{u(f)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const h4e={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},p4e=500,f4e=600,m4e="_blank",g4e="http://localhost";class oJ{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function _4e(n,e,i,o=p4e,l=f4e){const u=Math.max((window.screen.availHeight-l)/2,0).toString(),f=Math.max((window.screen.availWidth-o)/2,0).toString();let _="";const E=Object.assign(Object.assign({},h4e),{width:o.toString(),height:l.toString(),top:u,left:f}),b=lc().toLowerCase();i&&(_=_ie(b)?m4e:i),mie(b)&&(e=e||g4e,E.scrollbars="yes");const C=Object.entries(E).reduce((P,[L,M])=>`${P}${L}=${M},`,"");if(Lje(b)&&_!=="_self")return y4e(e||"",_),new oJ(null);const I=window.open(e||"",_,C);Gn(I,n,"popup-blocked");try{I.focus()}catch{}return new oJ(I)}function y4e(n,e){const i=document.createElement("a");i.href=n,i.target=e;const o=document.createEvent("MouseEvent");o.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),i.dispatchEvent(o)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const E4e="__/auth/handler",v4e="emulator/auth/handler",S4e=encodeURIComponent("fac");async function aJ(n,e,i,o,l,u){Gn(n.config.authDomain,n,"auth-domain-config-required"),Gn(n.config.apiKey,n,"invalid-api-key");const f={apiKey:n.config.apiKey,appName:n.name,authType:i,redirectUrl:o,v:uE,eventId:l};if(e instanceof Aie){e.setDefaultLanguage(n.languageCode),f.providerId=e.providerId||"",iVe(e.getCustomParameters())||(f.customParameters=JSON.stringify(e.getCustomParameters()));for(const[C,I]of Object.entries({}))f[C]=I}if(e instanceof PR){const C=e.getScopes().filter(I=>I!=="");C.length>0&&(f.scopes=C.join(","))}n.tenantId&&(f.tid=n.tenantId);const _=f;for(const C of Object.keys(_))_[C]===void 0&&delete _[C];const E=await n._getAppCheckToken(),b=E?`#${S4e}=${encodeURIComponent(E)}`:"";return`${b4e(n)}?${RR(_).slice(1)}${b}`}function b4e({config:n}){return n.emulator?b4(n,v4e):`https://${n.authDomain}/${E4e}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const DU="webStorageSupport";class w4e{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=Mie,this._completeRedirectFn=KFe,this._overrideRedirectResult=GFe}async _openPopup(e,i,o,l){var u;nm((u=this.eventManagers[e._key()])===null||u===void 0?void 0:u.manager,"_initialize() not called before _openPopup()");const f=await aJ(e,i,o,tj(),l);return _4e(e,f,I4())}async _openRedirect(e,i,o,l){await this._originValidation(e);const u=await aJ(e,i,o,tj(),l);return RFe(u),new Promise(()=>{})}_initialize(e){const i=e._key();if(this.eventManagers[i]){const{manager:l,promise:u}=this.eventManagers[i];return l?Promise.resolve(l):(nm(u,"If manager is not set, promise should be"),u)}const o=this.initAndGetManager(e);return this.eventManagers[i]={promise:o},o.catch(()=>{delete this.eventManagers[i]}),o}async initAndGetManager(e){const i=await d4e(e),o=new YFe(e);return i.register("authEvent",l=>(Gn(l==null?void 0:l.authEvent,e,"invalid-auth-event"),{status:o.onEvent(l.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:o},this.iframes[e._key()]=i,o}_isIframeWebStorageSupported(e,i){this.iframes[e._key()].send(DU,{type:DU},l=>{var u;const f=(u=l==null?void 0:l[0])===null||u===void 0?void 0:u[DU];f!==void 0&&i(!!f),Jd(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const i=e._key();return this.originValidationPromises[i]||(this.originValidationPromises[i]=e4e(e)),this.originValidationPromises[i]}get _shouldInitProactively(){return bie()||gie()||T4()}}const T4e=w4e;var cJ="@firebase/auth",lJ="1.9.1";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class C4e{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)===null||e===void 0?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const i=this.auth.onIdTokenChanged(o=>{e((o==null?void 0:o.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,i),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const i=this.internalListeners.get(e);i&&(this.internalListeners.delete(e),i(),this.updateProactiveRefresh())}assertAuthConfigured(){Gn(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function R4e(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function I4e(n){tE(new Bg("auth",(e,{options:i})=>{const o=e.getProvider("app").getImmediate(),l=e.getProvider("heartbeat"),u=e.getProvider("app-check-internal"),{apiKey:f,authDomain:_}=o.options;Gn(f&&!f.includes(":"),"invalid-api-key",{appName:o.name});const E={apiKey:f,authDomain:_,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:wie(n)},b=new Bje(o,l,u,E);return Jje(b,i),b},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,i,o)=>{e.getProvider("auth-internal").initialize()})),tE(new Bg("auth-internal",e=>{const i=Zg(e.getProvider("auth").getImmediate());return(o=>new C4e(o))(i)},"PRIVATE").setInstantiationMode("EXPLICIT")),Ep(cJ,lJ,R4e(n)),Ep(cJ,lJ,"esm2017")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const A4e=5*60,P4e=Zre("authIdTokenMaxAge")||A4e;let uJ=null;const O4e=n=>async e=>{const i=e&&await e.getIdTokenResult(),o=i&&(new Date().getTime()-Date.parse(i.issuedAtTime))/1e3;if(o&&o>P4e)return;const l=i==null?void 0:i.token;uJ!==l&&(uJ=l,await fetch(n,{method:l?"POST":"DELETE",headers:l?{Authorization:`Bearer ${l}`}:{}}))};function hN(n=v4()){const e=cN(n,"auth");if(e.isInitialized())return e.getImmediate();const i=Xje(n,{popupRedirectResolver:T4e,persistence:[LFe,wFe,Mie]}),o=Zre("authTokenSyncURL");if(o&&typeof isSecureContext=="boolean"&&isSecureContext){const u=new URL(o,location.origin);if(location.origin===u.origin){const f=O4e(u.toString());yFe(i,f,()=>f(i.currentUser)),_Fe(i,_=>f(_))}}const l=Xre("auth");return l&&Qje(i,`http://${l}`),i}function k4e(){var n,e;return(e=(n=document.getElementsByTagName("head"))===null||n===void 0?void 0:n[0])!==null&&e!==void 0?e:document}Wje({loadJS(n){return new Promise((e,i)=>{const o=document.createElement("script");o.setAttribute("src",n),o.onload=e,o.onerror=l=>{const u=vp("internal-error");u.customData=l,i(u)},o.type="text/javascript",o.charset="UTF-8",k4e().appendChild(o)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});I4e("Browser");var dJ=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var Mg,zie;(function(){var n;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(X,J){function Y(){}Y.prototype=J.prototype,X.D=J.prototype,X.prototype=new Y,X.prototype.constructor=X,X.C=function(ie,le,de){for(var ue=Array(arguments.length-2),Oe=2;Oe<arguments.length;Oe++)ue[Oe-2]=arguments[Oe];return J.prototype[le].apply(ie,ue)}}function i(){this.blockSize=-1}function o(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(o,i),o.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function l(X,J,Y){Y||(Y=0);var ie=Array(16);if(typeof J=="string")for(var le=0;16>le;++le)ie[le]=J.charCodeAt(Y++)|J.charCodeAt(Y++)<<8|J.charCodeAt(Y++)<<16|J.charCodeAt(Y++)<<24;else for(le=0;16>le;++le)ie[le]=J[Y++]|J[Y++]<<8|J[Y++]<<16|J[Y++]<<24;J=X.g[0],Y=X.g[1],le=X.g[2];var de=X.g[3],ue=J+(de^Y&(le^de))+ie[0]+3614090360&4294967295;J=Y+(ue<<7&4294967295|ue>>>25),ue=de+(le^J&(Y^le))+ie[1]+3905402710&4294967295,de=J+(ue<<12&4294967295|ue>>>20),ue=le+(Y^de&(J^Y))+ie[2]+606105819&4294967295,le=de+(ue<<17&4294967295|ue>>>15),ue=Y+(J^le&(de^J))+ie[3]+3250441966&4294967295,Y=le+(ue<<22&4294967295|ue>>>10),ue=J+(de^Y&(le^de))+ie[4]+4118548399&4294967295,J=Y+(ue<<7&4294967295|ue>>>25),ue=de+(le^J&(Y^le))+ie[5]+1200080426&4294967295,de=J+(ue<<12&4294967295|ue>>>20),ue=le+(Y^de&(J^Y))+ie[6]+2821735955&4294967295,le=de+(ue<<17&4294967295|ue>>>15),ue=Y+(J^le&(de^J))+ie[7]+4249261313&4294967295,Y=le+(ue<<22&4294967295|ue>>>10),ue=J+(de^Y&(le^de))+ie[8]+1770035416&4294967295,J=Y+(ue<<7&4294967295|ue>>>25),ue=de+(le^J&(Y^le))+ie[9]+2336552879&4294967295,de=J+(ue<<12&4294967295|ue>>>20),ue=le+(Y^de&(J^Y))+ie[10]+4294925233&4294967295,le=de+(ue<<17&4294967295|ue>>>15),ue=Y+(J^le&(de^J))+ie[11]+2304563134&4294967295,Y=le+(ue<<22&4294967295|ue>>>10),ue=J+(de^Y&(le^de))+ie[12]+1804603682&4294967295,J=Y+(ue<<7&4294967295|ue>>>25),ue=de+(le^J&(Y^le))+ie[13]+4254626195&4294967295,de=J+(ue<<12&4294967295|ue>>>20),ue=le+(Y^de&(J^Y))+ie[14]+2792965006&4294967295,le=de+(ue<<17&4294967295|ue>>>15),ue=Y+(J^le&(de^J))+ie[15]+1236535329&4294967295,Y=le+(ue<<22&4294967295|ue>>>10),ue=J+(le^de&(Y^le))+ie[1]+4129170786&4294967295,J=Y+(ue<<5&4294967295|ue>>>27),ue=de+(Y^le&(J^Y))+ie[6]+3225465664&4294967295,de=J+(ue<<9&4294967295|ue>>>23),ue=le+(J^Y&(de^J))+ie[11]+643717713&4294967295,le=de+(ue<<14&4294967295|ue>>>18),ue=Y+(de^J&(le^de))+ie[0]+3921069994&4294967295,Y=le+(ue<<20&4294967295|ue>>>12),ue=J+(le^de&(Y^le))+ie[5]+3593408605&4294967295,J=Y+(ue<<5&4294967295|ue>>>27),ue=de+(Y^le&(J^Y))+ie[10]+38016083&4294967295,de=J+(ue<<9&4294967295|ue>>>23),ue=le+(J^Y&(de^J))+ie[15]+3634488961&4294967295,le=de+(ue<<14&4294967295|ue>>>18),ue=Y+(de^J&(le^de))+ie[4]+3889429448&4294967295,Y=le+(ue<<20&4294967295|ue>>>12),ue=J+(le^de&(Y^le))+ie[9]+568446438&4294967295,J=Y+(ue<<5&4294967295|ue>>>27),ue=de+(Y^le&(J^Y))+ie[14]+3275163606&4294967295,de=J+(ue<<9&4294967295|ue>>>23),ue=le+(J^Y&(de^J))+ie[3]+4107603335&4294967295,le=de+(ue<<14&4294967295|ue>>>18),ue=Y+(de^J&(le^de))+ie[8]+1163531501&4294967295,Y=le+(ue<<20&4294967295|ue>>>12),ue=J+(le^de&(Y^le))+ie[13]+2850285829&4294967295,J=Y+(ue<<5&4294967295|ue>>>27),ue=de+(Y^le&(J^Y))+ie[2]+4243563512&4294967295,de=J+(ue<<9&4294967295|ue>>>23),ue=le+(J^Y&(de^J))+ie[7]+1735328473&4294967295,le=de+(ue<<14&4294967295|ue>>>18),ue=Y+(de^J&(le^de))+ie[12]+2368359562&4294967295,Y=le+(ue<<20&4294967295|ue>>>12),ue=J+(Y^le^de)+ie[5]+4294588738&4294967295,J=Y+(ue<<4&4294967295|ue>>>28),ue=de+(J^Y^le)+ie[8]+2272392833&4294967295,de=J+(ue<<11&4294967295|ue>>>21),ue=le+(de^J^Y)+ie[11]+1839030562&4294967295,le=de+(ue<<16&4294967295|ue>>>16),ue=Y+(le^de^J)+ie[14]+4259657740&4294967295,Y=le+(ue<<23&4294967295|ue>>>9),ue=J+(Y^le^de)+ie[1]+2763975236&4294967295,J=Y+(ue<<4&4294967295|ue>>>28),ue=de+(J^Y^le)+ie[4]+1272893353&4294967295,de=J+(ue<<11&4294967295|ue>>>21),ue=le+(de^J^Y)+ie[7]+4139469664&4294967295,le=de+(ue<<16&4294967295|ue>>>16),ue=Y+(le^de^J)+ie[10]+3200236656&4294967295,Y=le+(ue<<23&4294967295|ue>>>9),ue=J+(Y^le^de)+ie[13]+681279174&4294967295,J=Y+(ue<<4&4294967295|ue>>>28),ue=de+(J^Y^le)+ie[0]+3936430074&4294967295,de=J+(ue<<11&4294967295|ue>>>21),ue=le+(de^J^Y)+ie[3]+3572445317&4294967295,le=de+(ue<<16&4294967295|ue>>>16),ue=Y+(le^de^J)+ie[6]+76029189&4294967295,Y=le+(ue<<23&4294967295|ue>>>9),ue=J+(Y^le^de)+ie[9]+3654602809&4294967295,J=Y+(ue<<4&4294967295|ue>>>28),ue=de+(J^Y^le)+ie[12]+3873151461&4294967295,de=J+(ue<<11&4294967295|ue>>>21),ue=le+(de^J^Y)+ie[15]+530742520&4294967295,le=de+(ue<<16&4294967295|ue>>>16),ue=Y+(le^de^J)+ie[2]+3299628645&4294967295,Y=le+(ue<<23&4294967295|ue>>>9),ue=J+(le^(Y|~de))+ie[0]+4096336452&4294967295,J=Y+(ue<<6&4294967295|ue>>>26),ue=de+(Y^(J|~le))+ie[7]+1126891415&4294967295,de=J+(ue<<10&4294967295|ue>>>22),ue=le+(J^(de|~Y))+ie[14]+2878612391&4294967295,le=de+(ue<<15&4294967295|ue>>>17),ue=Y+(de^(le|~J))+ie[5]+4237533241&4294967295,Y=le+(ue<<21&4294967295|ue>>>11),ue=J+(le^(Y|~de))+ie[12]+1700485571&4294967295,J=Y+(ue<<6&4294967295|ue>>>26),ue=de+(Y^(J|~le))+ie[3]+2399980690&4294967295,de=J+(ue<<10&4294967295|ue>>>22),ue=le+(J^(de|~Y))+ie[10]+4293915773&4294967295,le=de+(ue<<15&4294967295|ue>>>17),ue=Y+(de^(le|~J))+ie[1]+2240044497&4294967295,Y=le+(ue<<21&4294967295|ue>>>11),ue=J+(le^(Y|~de))+ie[8]+1873313359&4294967295,J=Y+(ue<<6&4294967295|ue>>>26),ue=de+(Y^(J|~le))+ie[15]+4264355552&4294967295,de=J+(ue<<10&4294967295|ue>>>22),ue=le+(J^(de|~Y))+ie[6]+2734768916&4294967295,le=de+(ue<<15&4294967295|ue>>>17),ue=Y+(de^(le|~J))+ie[13]+1309151649&4294967295,Y=le+(ue<<21&4294967295|ue>>>11),ue=J+(le^(Y|~de))+ie[4]+4149444226&4294967295,J=Y+(ue<<6&4294967295|ue>>>26),ue=de+(Y^(J|~le))+ie[11]+3174756917&4294967295,de=J+(ue<<10&4294967295|ue>>>22),ue=le+(J^(de|~Y))+ie[2]+718787259&4294967295,le=de+(ue<<15&4294967295|ue>>>17),ue=Y+(de^(le|~J))+ie[9]+3951481745&4294967295,X.g[0]=X.g[0]+J&4294967295,X.g[1]=X.g[1]+(le+(ue<<21&4294967295|ue>>>11))&4294967295,X.g[2]=X.g[2]+le&4294967295,X.g[3]=X.g[3]+de&4294967295}o.prototype.u=function(X,J){J===void 0&&(J=X.length);for(var Y=J-this.blockSize,ie=this.B,le=this.h,de=0;de<J;){if(le==0)for(;de<=Y;)l(this,X,de),de+=this.blockSize;if(typeof X=="string"){for(;de<J;)if(ie[le++]=X.charCodeAt(de++),le==this.blockSize){l(this,ie),le=0;break}}else for(;de<J;)if(ie[le++]=X[de++],le==this.blockSize){l(this,ie),le=0;break}}this.h=le,this.o+=J},o.prototype.v=function(){var X=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);X[0]=128;for(var J=1;J<X.length-8;++J)X[J]=0;var Y=8*this.o;for(J=X.length-8;J<X.length;++J)X[J]=Y&255,Y/=256;for(this.u(X),X=Array(16),J=Y=0;4>J;++J)for(var ie=0;32>ie;ie+=8)X[Y++]=this.g[J]>>>ie&255;return X};function u(X,J){var Y=_;return Object.prototype.hasOwnProperty.call(Y,X)?Y[X]:Y[X]=J(X)}function f(X,J){this.h=J;for(var Y=[],ie=!0,le=X.length-1;0<=le;le--){var de=X[le]|0;ie&&de==J||(Y[le]=de,ie=!1)}this.g=Y}var _={};function E(X){return-128<=X&&128>X?u(X,function(J){return new f([J|0],0>J?-1:0)}):new f([X|0],0>X?-1:0)}function b(X){if(isNaN(X)||!isFinite(X))return I;if(0>X)return B(b(-X));for(var J=[],Y=1,ie=0;X>=Y;ie++)J[ie]=X/Y|0,Y*=4294967296;return new f(J,0)}function C(X,J){if(X.length==0)throw Error("number format error: empty string");if(J=J||10,2>J||36<J)throw Error("radix out of range: "+J);if(X.charAt(0)=="-")return B(C(X.substring(1),J));if(0<=X.indexOf("-"))throw Error('number format error: interior "-" character');for(var Y=b(Math.pow(J,8)),ie=I,le=0;le<X.length;le+=8){var de=Math.min(8,X.length-le),ue=parseInt(X.substring(le,le+de),J);8>de?(de=b(Math.pow(J,de)),ie=ie.j(de).add(b(ue))):(ie=ie.j(Y),ie=ie.add(b(ue)))}return ie}var I=E(0),P=E(1),L=E(16777216);n=f.prototype,n.m=function(){if(F(this))return-B(this).m();for(var X=0,J=1,Y=0;Y<this.g.length;Y++){var ie=this.i(Y);X+=(0<=ie?ie:4294967296+ie)*J,J*=4294967296}return X},n.toString=function(X){if(X=X||10,2>X||36<X)throw Error("radix out of range: "+X);if(M(this))return"0";if(F(this))return"-"+B(this).toString(X);for(var J=b(Math.pow(X,6)),Y=this,ie="";;){var le=ae(Y,J).g;Y=Z(Y,le.j(J));var de=((0<Y.g.length?Y.g[0]:Y.h)>>>0).toString(X);if(Y=le,M(Y))return de+ie;for(;6>de.length;)de="0"+de;ie=de+ie}},n.i=function(X){return 0>X?0:X<this.g.length?this.g[X]:this.h};function M(X){if(X.h!=0)return!1;for(var J=0;J<X.g.length;J++)if(X.g[J]!=0)return!1;return!0}function F(X){return X.h==-1}n.l=function(X){return X=Z(this,X),F(X)?-1:M(X)?0:1};function B(X){for(var J=X.g.length,Y=[],ie=0;ie<J;ie++)Y[ie]=~X.g[ie];return new f(Y,~X.h).add(P)}n.abs=function(){return F(this)?B(this):this},n.add=function(X){for(var J=Math.max(this.g.length,X.g.length),Y=[],ie=0,le=0;le<=J;le++){var de=ie+(this.i(le)&65535)+(X.i(le)&65535),ue=(de>>>16)+(this.i(le)>>>16)+(X.i(le)>>>16);ie=ue>>>16,de&=65535,ue&=65535,Y[le]=ue<<16|de}return new f(Y,Y[Y.length-1]&-2147483648?-1:0)};function Z(X,J){return X.add(B(J))}n.j=function(X){if(M(this)||M(X))return I;if(F(this))return F(X)?B(this).j(B(X)):B(B(this).j(X));if(F(X))return B(this.j(B(X)));if(0>this.l(L)&&0>X.l(L))return b(this.m()*X.m());for(var J=this.g.length+X.g.length,Y=[],ie=0;ie<2*J;ie++)Y[ie]=0;for(ie=0;ie<this.g.length;ie++)for(var le=0;le<X.g.length;le++){var de=this.i(ie)>>>16,ue=this.i(ie)&65535,Oe=X.i(le)>>>16,Ve=X.i(le)&65535;Y[2*ie+2*le]+=ue*Ve,K(Y,2*ie+2*le),Y[2*ie+2*le+1]+=de*Ve,K(Y,2*ie+2*le+1),Y[2*ie+2*le+1]+=ue*Oe,K(Y,2*ie+2*le+1),Y[2*ie+2*le+2]+=de*Oe,K(Y,2*ie+2*le+2)}for(ie=0;ie<J;ie++)Y[ie]=Y[2*ie+1]<<16|Y[2*ie];for(ie=J;ie<2*J;ie++)Y[ie]=0;return new f(Y,0)};function K(X,J){for(;(X[J]&65535)!=X[J];)X[J+1]+=X[J]>>>16,X[J]&=65535,J++}function re(X,J){this.g=X,this.h=J}function ae(X,J){if(M(J))throw Error("division by zero");if(M(X))return new re(I,I);if(F(X))return J=ae(B(X),J),new re(B(J.g),B(J.h));if(F(J))return J=ae(X,B(J)),new re(B(J.g),J.h);if(30<X.g.length){if(F(X)||F(J))throw Error("slowDivide_ only works with positive integers.");for(var Y=P,ie=J;0>=ie.l(X);)Y=ne(Y),ie=ne(ie);var le=pe(Y,1),de=pe(ie,1);for(ie=pe(ie,2),Y=pe(Y,2);!M(ie);){var ue=de.add(ie);0>=ue.l(X)&&(le=le.add(Y),de=ue),ie=pe(ie,1),Y=pe(Y,1)}return J=Z(X,le.j(J)),new re(le,J)}for(le=I;0<=X.l(J);){for(Y=Math.max(1,Math.floor(X.m()/J.m())),ie=Math.ceil(Math.log(Y)/Math.LN2),ie=48>=ie?1:Math.pow(2,ie-48),de=b(Y),ue=de.j(J);F(ue)||0<ue.l(X);)Y-=ie,de=b(Y),ue=de.j(J);M(de)&&(de=P),le=le.add(de),X=Z(X,ue)}return new re(le,X)}n.A=function(X){return ae(this,X).h},n.and=function(X){for(var J=Math.max(this.g.length,X.g.length),Y=[],ie=0;ie<J;ie++)Y[ie]=this.i(ie)&X.i(ie);return new f(Y,this.h&X.h)},n.or=function(X){for(var J=Math.max(this.g.length,X.g.length),Y=[],ie=0;ie<J;ie++)Y[ie]=this.i(ie)|X.i(ie);return new f(Y,this.h|X.h)},n.xor=function(X){for(var J=Math.max(this.g.length,X.g.length),Y=[],ie=0;ie<J;ie++)Y[ie]=this.i(ie)^X.i(ie);return new f(Y,this.h^X.h)};function ne(X){for(var J=X.g.length+1,Y=[],ie=0;ie<J;ie++)Y[ie]=X.i(ie)<<1|X.i(ie-1)>>>31;return new f(Y,X.h)}function pe(X,J){var Y=J>>5;J%=32;for(var ie=X.g.length-Y,le=[],de=0;de<ie;de++)le[de]=0<J?X.i(de+Y)>>>J|X.i(de+Y+1)<<32-J:X.i(de+Y);return new f(le,X.h)}o.prototype.digest=o.prototype.v,o.prototype.reset=o.prototype.s,o.prototype.update=o.prototype.u,zie=o,f.prototype.add=f.prototype.add,f.prototype.multiply=f.prototype.j,f.prototype.modulo=f.prototype.A,f.prototype.compare=f.prototype.l,f.prototype.toNumber=f.prototype.m,f.prototype.toString=f.prototype.toString,f.prototype.getBits=f.prototype.i,f.fromNumber=b,f.fromString=C,Mg=f}).apply(typeof dJ<"u"?dJ:typeof self<"u"?self:typeof window<"u"?window:{});var $O=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var Gie,iC,Hie,Pk,ij,$ie,Kie,qie;(function(){var n,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(A,z,se){return A==Array.prototype||A==Object.prototype||(A[z]=se.value),A};function i(A){A=[typeof globalThis=="object"&&globalThis,A,typeof window=="object"&&window,typeof self=="object"&&self,typeof $O=="object"&&$O];for(var z=0;z<A.length;++z){var se=A[z];if(se&&se.Math==Math)return se}throw Error("Cannot find global object")}var o=i(this);function l(A,z){if(z)e:{var se=o;A=A.split(".");for(var ge=0;ge<A.length-1;ge++){var Qe=A[ge];if(!(Qe in se))break e;se=se[Qe]}A=A[A.length-1],ge=se[A],z=z(ge),z!=ge&&z!=null&&e(se,A,{configurable:!0,writable:!0,value:z})}}function u(A,z){A instanceof String&&(A+="");var se=0,ge=!1,Qe={next:function(){if(!ge&&se<A.length){var dt=se++;return{value:z(dt,A[dt]),done:!1}}return ge=!0,{done:!0,value:void 0}}};return Qe[Symbol.iterator]=function(){return Qe},Qe}l("Array.prototype.values",function(A){return A||function(){return u(this,function(z,se){return se})}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var f=f||{},_=this||self;function E(A){var z=typeof A;return z=z!="object"?z:A?Array.isArray(A)?"array":z:"null",z=="array"||z=="object"&&typeof A.length=="number"}function b(A){var z=typeof A;return z=="object"&&A!=null||z=="function"}function C(A,z,se){return A.call.apply(A.bind,arguments)}function I(A,z,se){if(!A)throw Error();if(2<arguments.length){var ge=Array.prototype.slice.call(arguments,2);return function(){var Qe=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(Qe,ge),A.apply(z,Qe)}}return function(){return A.apply(z,arguments)}}function P(A,z,se){return P=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?C:I,P.apply(null,arguments)}function L(A,z){var se=Array.prototype.slice.call(arguments,1);return function(){var ge=se.slice();return ge.push.apply(ge,arguments),A.apply(this,ge)}}function M(A,z){function se(){}se.prototype=z.prototype,A.aa=z.prototype,A.prototype=new se,A.prototype.constructor=A,A.Qb=function(ge,Qe,dt){for(var Gt=Array(arguments.length-2),ri=2;ri<arguments.length;ri++)Gt[ri-2]=arguments[ri];return z.prototype[Qe].apply(ge,Gt)}}function F(A){const z=A.length;if(0<z){const se=Array(z);for(let ge=0;ge<z;ge++)se[ge]=A[ge];return se}return[]}function B(A,z){for(let se=1;se<arguments.length;se++){const ge=arguments[se];if(E(ge)){const Qe=A.length||0,dt=ge.length||0;A.length=Qe+dt;for(let Gt=0;Gt<dt;Gt++)A[Qe+Gt]=ge[Gt]}else A.push(ge)}}class Z{constructor(z,se){this.i=z,this.j=se,this.h=0,this.g=null}get(){let z;return 0<this.h?(this.h--,z=this.g,this.g=z.next,z.next=null):z=this.i(),z}}function K(A){return/^[\s\xa0]*$/.test(A)}function re(){var A=_.navigator;return A&&(A=A.userAgent)?A:""}function ae(A){return ae[" "](A),A}ae[" "]=function(){};var ne=re().indexOf("Gecko")!=-1&&!(re().toLowerCase().indexOf("webkit")!=-1&&re().indexOf("Edge")==-1)&&!(re().indexOf("Trident")!=-1||re().indexOf("MSIE")!=-1)&&re().indexOf("Edge")==-1;function pe(A,z,se){for(const ge in A)z.call(se,A[ge],ge,A)}function X(A,z){for(const se in A)z.call(void 0,A[se],se,A)}function J(A){const z={};for(const se in A)z[se]=A[se];return z}const Y="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function ie(A,z){let se,ge;for(let Qe=1;Qe<arguments.length;Qe++){ge=arguments[Qe];for(se in ge)A[se]=ge[se];for(let dt=0;dt<Y.length;dt++)se=Y[dt],Object.prototype.hasOwnProperty.call(ge,se)&&(A[se]=ge[se])}}function le(A){var z=1;A=A.split(":");const se=[];for(;0<z&&A.length;)se.push(A.shift()),z--;return A.length&&se.push(A.join(":")),se}function de(A){_.setTimeout(()=>{throw A},0)}function ue(){var A=be;let z=null;return A.g&&(z=A.g,A.g=A.g.next,A.g||(A.h=null),z.next=null),z}class Oe{constructor(){this.h=this.g=null}add(z,se){const ge=Ve.get();ge.set(z,se),this.h?this.h.next=ge:this.g=ge,this.h=ge}}var Ve=new Z(()=>new xe,A=>A.reset());class xe{constructor(){this.next=this.g=this.h=null}set(z,se){this.h=z,this.g=se,this.next=null}reset(){this.next=this.g=this.h=null}}let Re,ve=!1,be=new Oe,We=()=>{const A=_.Promise.resolve(void 0);Re=()=>{A.then(Pe)}};var Pe=()=>{for(var A;A=ue();){try{A.h.call(A.g)}catch(se){de(se)}var z=Ve;z.j(A),100>z.h&&(z.h++,A.next=z.g,z.g=A)}ve=!1};function Te(){this.s=this.s,this.C=this.C}Te.prototype.s=!1,Te.prototype.ma=function(){this.s||(this.s=!0,this.N())},Te.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function ke(A,z){this.type=A,this.g=this.target=z,this.defaultPrevented=!1}ke.prototype.h=function(){this.defaultPrevented=!0};var Ue=function(){if(!_.addEventListener||!Object.defineProperty)return!1;var A=!1,z=Object.defineProperty({},"passive",{get:function(){A=!0}});try{const se=()=>{};_.addEventListener("test",se,z),_.removeEventListener("test",se,z)}catch{}return A}();function Be(A,z){if(ke.call(this,A?A.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,A){var se=this.type=A.type,ge=A.changedTouches&&A.changedTouches.length?A.changedTouches[0]:null;if(this.target=A.target||A.srcElement,this.g=z,z=A.relatedTarget){if(ne){e:{try{ae(z.nodeName);var Qe=!0;break e}catch{}Qe=!1}Qe||(z=null)}}else se=="mouseover"?z=A.fromElement:se=="mouseout"&&(z=A.toElement);this.relatedTarget=z,ge?(this.clientX=ge.clientX!==void 0?ge.clientX:ge.pageX,this.clientY=ge.clientY!==void 0?ge.clientY:ge.pageY,this.screenX=ge.screenX||0,this.screenY=ge.screenY||0):(this.clientX=A.clientX!==void 0?A.clientX:A.pageX,this.clientY=A.clientY!==void 0?A.clientY:A.pageY,this.screenX=A.screenX||0,this.screenY=A.screenY||0),this.button=A.button,this.key=A.key||"",this.ctrlKey=A.ctrlKey,this.altKey=A.altKey,this.shiftKey=A.shiftKey,this.metaKey=A.metaKey,this.pointerId=A.pointerId||0,this.pointerType=typeof A.pointerType=="string"?A.pointerType:qe[A.pointerType]||"",this.state=A.state,this.i=A,A.defaultPrevented&&Be.aa.h.call(this)}}M(Be,ke);var qe={2:"touch",3:"pen",4:"mouse"};Be.prototype.h=function(){Be.aa.h.call(this);var A=this.i;A.preventDefault?A.preventDefault():A.returnValue=!1};var $e="closure_listenable_"+(1e6*Math.random()|0),st=0;function Je(A,z,se,ge,Qe){this.listener=A,this.proxy=null,this.src=z,this.type=se,this.capture=!!ge,this.ha=Qe,this.key=++st,this.da=this.fa=!1}function Rt(A){A.da=!0,A.listener=null,A.proxy=null,A.src=null,A.ha=null}function kt(A){this.src=A,this.g={},this.h=0}kt.prototype.add=function(A,z,se,ge,Qe){var dt=A.toString();A=this.g[dt],A||(A=this.g[dt]=[],this.h++);var Gt=ut(A,z,ge,Qe);return-1<Gt?(z=A[Gt],se||(z.fa=!1)):(z=new Je(z,this.src,dt,!!ge,Qe),z.fa=se,A.push(z)),z};function He(A,z){var se=z.type;if(se in A.g){var ge=A.g[se],Qe=Array.prototype.indexOf.call(ge,z,void 0),dt;(dt=0<=Qe)&&Array.prototype.splice.call(ge,Qe,1),dt&&(Rt(z),A.g[se].length==0&&(delete A.g[se],A.h--))}}function ut(A,z,se,ge){for(var Qe=0;Qe<A.length;++Qe){var dt=A[Qe];if(!dt.da&&dt.listener==z&&dt.capture==!!se&&dt.ha==ge)return Qe}return-1}var mt="closure_lm_"+(1e6*Math.random()|0),Lt={};function Xt(A,z,se,ge,Qe){if(Array.isArray(z)){for(var dt=0;dt<z.length;dt++)Xt(A,z[dt],se,ge,Qe);return null}return se=gn(se),A&&A[$e]?A.K(z,se,b(ge)?!!ge.capture:!1,Qe):$t(A,z,se,!1,ge,Qe)}function $t(A,z,se,ge,Qe,dt){if(!z)throw Error("Invalid event type");var Gt=b(Qe)?!!Qe.capture:!!Qe,ri=Tt(A);if(ri||(A[mt]=ri=new kt(A)),se=ri.add(z,se,ge,Gt,dt),se.proxy)return se;if(ge=we(),se.proxy=ge,ge.src=A,ge.listener=se,A.addEventListener)Ue||(Qe=Gt),Qe===void 0&&(Qe=!1),A.addEventListener(z.toString(),ge,Qe);else if(A.attachEvent)A.attachEvent(gt(z.toString()),ge);else if(A.addListener&&A.removeListener)A.addListener(ge);else throw Error("addEventListener and attachEvent are unavailable.");return se}function we(){function A(se){return z.call(A.src,A.listener,se)}const z=Et;return A}function je(A,z,se,ge,Qe){if(Array.isArray(z))for(var dt=0;dt<z.length;dt++)je(A,z[dt],se,ge,Qe);else ge=b(ge)?!!ge.capture:!!ge,se=gn(se),A&&A[$e]?(A=A.i,z=String(z).toString(),z in A.g&&(dt=A.g[z],se=ut(dt,se,ge,Qe),-1<se&&(Rt(dt[se]),Array.prototype.splice.call(dt,se,1),dt.length==0&&(delete A.g[z],A.h--)))):A&&(A=Tt(A))&&(z=A.g[z.toString()],A=-1,z&&(A=ut(z,se,ge,Qe)),(se=-1<A?z[A]:null)&&Ke(se))}function Ke(A){if(typeof A!="number"&&A&&!A.da){var z=A.src;if(z&&z[$e])He(z.i,A);else{var se=A.type,ge=A.proxy;z.removeEventListener?z.removeEventListener(se,ge,A.capture):z.detachEvent?z.detachEvent(gt(se),ge):z.addListener&&z.removeListener&&z.removeListener(ge),(se=Tt(z))?(He(se,A),se.h==0&&(se.src=null,z[mt]=null)):Rt(A)}}}function gt(A){return A in Lt?Lt[A]:Lt[A]="on"+A}function Et(A,z){if(A.da)A=!0;else{z=new Be(z,this);var se=A.listener,ge=A.ha||A.src;A.fa&&Ke(A),A=se.call(ge,z)}return A}function Tt(A){return A=A[mt],A instanceof kt?A:null}var Kt="__closure_events_fn_"+(1e9*Math.random()>>>0);function gn(A){return typeof A=="function"?A:(A[Kt]||(A[Kt]=function(z){return A.handleEvent(z)}),A[Kt])}function Sn(){Te.call(this),this.i=new kt(this),this.M=this,this.F=null}M(Sn,Te),Sn.prototype[$e]=!0,Sn.prototype.removeEventListener=function(A,z,se,ge){je(this,A,z,se,ge)};function sn(A,z){var se,ge=A.F;if(ge)for(se=[];ge;ge=ge.F)se.push(ge);if(A=A.M,ge=z.type||z,typeof z=="string")z=new ke(z,A);else if(z instanceof ke)z.target=z.target||A;else{var Qe=z;z=new ke(ge,A),ie(z,Qe)}if(Qe=!0,se)for(var dt=se.length-1;0<=dt;dt--){var Gt=z.g=se[dt];Qe=wt(Gt,ge,!0,z)&&Qe}if(Gt=z.g=A,Qe=wt(Gt,ge,!0,z)&&Qe,Qe=wt(Gt,ge,!1,z)&&Qe,se)for(dt=0;dt<se.length;dt++)Gt=z.g=se[dt],Qe=wt(Gt,ge,!1,z)&&Qe}Sn.prototype.N=function(){if(Sn.aa.N.call(this),this.i){var A=this.i,z;for(z in A.g){for(var se=A.g[z],ge=0;ge<se.length;ge++)Rt(se[ge]);delete A.g[z],A.h--}}this.F=null},Sn.prototype.K=function(A,z,se,ge){return this.i.add(String(A),z,!1,se,ge)},Sn.prototype.L=function(A,z,se,ge){return this.i.add(String(A),z,!0,se,ge)};function wt(A,z,se,ge){if(z=A.i.g[String(z)],!z)return!0;z=z.concat();for(var Qe=!0,dt=0;dt<z.length;++dt){var Gt=z[dt];if(Gt&&!Gt.da&&Gt.capture==se){var ri=Gt.listener,Ei=Gt.ha||Gt.src;Gt.fa&&He(A.i,Gt),Qe=ri.call(Ei,ge)!==!1&&Qe}}return Qe&&!ge.defaultPrevented}function ir(A,z,se){if(typeof A=="function")se&&(A=P(A,se));else if(A&&typeof A.handleEvent=="function")A=P(A.handleEvent,A);else throw Error("Invalid listener argument");return 2147483647<Number(z)?-1:_.setTimeout(A,z||0)}function Vt(A){A.g=ir(()=>{A.g=null,A.i&&(A.i=!1,Vt(A))},A.l);const z=A.h;A.h=null,A.m.apply(null,z)}class zt extends Te{constructor(z,se){super(),this.m=z,this.l=se,this.h=null,this.i=!1,this.g=null}j(z){this.h=arguments,this.g?this.i=!0:Vt(this)}N(){super.N(),this.g&&(_.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function _n(A){Te.call(this),this.h=A,this.g={}}M(_n,Te);var Ui=[];function Ts(A){pe(A.g,function(z,se){this.g.hasOwnProperty(se)&&Ke(z)},A),A.g={}}_n.prototype.N=function(){_n.aa.N.call(this),Ts(this)},_n.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var ui=_.JSON.stringify,na=_.JSON.parse,dc=class{stringify(A){return _.JSON.stringify(A,void 0)}parse(A){return _.JSON.parse(A,void 0)}};function oo(){}oo.prototype.h=null;function ao(A){return A.h||(A.h=A.i())}function xc(){}var Cs={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function La(){ke.call(this,"d")}M(La,ke);function Vo(){ke.call(this,"c")}M(Vo,ke);var Ma={},hc=null;function wl(){return hc=hc||new Sn}Ma.La="serverreachability";function Ua(A){ke.call(this,Ma.La,A)}M(Ua,ke);function pc(A){const z=wl();sn(z,new Ua(z))}Ma.STAT_EVENT="statevent";function Eo(A,z){ke.call(this,Ma.STAT_EVENT,A),this.stat=z}M(Eo,ke);function Vi(A){const z=wl();sn(z,new Eo(z,A))}Ma.Ma="timingevent";function vt(A,z){ke.call(this,Ma.Ma,A),this.size=z}M(vt,ke);function pn(A,z){if(typeof A!="function")throw Error("Fn must not be null and must be a function");return _.setTimeout(function(){A()},z)}function Sr(){this.g=!0}Sr.prototype.xa=function(){this.g=!1};function yi(A,z,se,ge,Qe,dt){A.info(function(){if(A.g)if(dt)for(var Gt="",ri=dt.split("&"),Ei=0;Ei<ri.length;Ei++){var Pr=ri[Ei].split("=");if(1<Pr.length){var co=Pr[0];Pr=Pr[1];var Is=co.split("_");Gt=2<=Is.length&&Is[1]=="type"?Gt+(co+"="+Pr+"&"):Gt+(co+"=redacted&")}}else Gt=null;else Gt=dt;return"XMLHTTP REQ ("+ge+") [attempt "+Qe+"]: "+z+`
`+se+`
`+Gt})}function jo(A,z,se,ge,Qe,dt,Gt){A.info(function(){return"XMLHTTP RESP ("+ge+") [ attempt "+Qe+"]: "+z+`
`+se+`
`+dt+" "+Gt})}function vo(A,z,se,ge){A.info(function(){return"XMLHTTP TEXT ("+z+"): "+kp(A,se)+(ge?" "+ge:"")})}function iu(A,z){A.info(function(){return"TIMEOUT: "+z})}Sr.prototype.info=function(){};function kp(A,z){if(!A.g)return z;if(!z)return null;try{var se=JSON.parse(z);if(se){for(A=0;A<se.length;A++)if(Array.isArray(se[A])){var ge=se[A];if(!(2>ge.length)){var Qe=ge[1];if(Array.isArray(Qe)&&!(1>Qe.length)){var dt=Qe[0];if(dt!="noop"&&dt!="stop"&&dt!="close")for(var Gt=1;Gt<Qe.length;Gt++)Qe[Gt]=""}}}}return ui(se)}catch{return z}}var Tl={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},su={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},Ai;function So(){}M(So,oo),So.prototype.g=function(){return new XMLHttpRequest},So.prototype.i=function(){return{}},Ai=new So;function Gi(A,z,se,ge){this.j=A,this.i=z,this.l=se,this.R=ge||1,this.U=new _n(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new th}function th(){this.i=null,this.g="",this.h=!1}var nh={},fc={};function rh(A,z,se){A.L=1,A.v=gc(ia(z)),A.m=se,A.P=!0,rd(A,null)}function rd(A,z){A.F=Date.now(),Xr(A),A.A=ia(A.v);var se=A.A,ge=A.R;Array.isArray(ge)||(ge=[String(ge)]),du(se.i,"t",ge),A.C=0,se=A.j.J,A.h=new th,A.g=gE(A.j,se?z:null,!A.m),0<A.O&&(A.M=new zt(P(A.Y,A,A.g),A.O)),z=A.U,se=A.g,ge=A.ca;var Qe="readystatechange";Array.isArray(Qe)||(Qe&&(Ui[0]=Qe.toString()),Qe=Ui);for(var dt=0;dt<Qe.length;dt++){var Gt=Xt(se,Qe[dt],ge||z.handleEvent,!1,z.h||z);if(!Gt)break;z.g[Gt.key]=Gt}z=A.H?J(A.H):{},A.m?(A.u||(A.u="POST"),z["Content-Type"]="application/x-www-form-urlencoded",A.g.ea(A.A,A.u,A.m,z)):(A.u="GET",A.g.ea(A.A,A.u,null,z)),pc(),yi(A.i,A.u,A.A,A.l,A.R,A.m)}Gi.prototype.ca=function(A){A=A.target;const z=this.M;z&&Oi(A)==3?z.j():this.Y(A)},Gi.prototype.Y=function(A){try{if(A==this.g)e:{const Is=Oi(this.g);var z=this.g.Ba();const _c=this.g.Z();if(!(3>Is)&&(Is!=3||this.g&&(this.h.h||this.g.oa()||Ys(this.g)))){this.J||Is!=4||z==7||(z==8||0>=_c?pc(3):pc(2)),Lc(this);var se=this.g.Z();this.X=se;t:if(ra(this)){var ge=Ys(this.g);A="";var Qe=ge.length,dt=Oi(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){Va(this),Cl(this);var Gt="";break t}this.h.i=new _.TextDecoder}for(z=0;z<Qe;z++)this.h.h=!0,A+=this.h.i.decode(ge[z],{stream:!(dt&&z==Qe-1)});ge.length=0,this.h.g+=A,this.C=0,Gt=this.h.g}else Gt=this.g.oa();if(this.o=se==200,jo(this.i,this.u,this.A,this.l,this.R,Is,se),this.o){if(this.T&&!this.K){t:{if(this.g){var ri,Ei=this.g;if((ri=Ei.g?Ei.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!K(ri)){var Pr=ri;break t}}Pr=null}if(se=Pr)vo(this.i,this.l,se,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Np(this,se);else{this.o=!1,this.s=3,Vi(12),Va(this),Cl(this);break e}}if(this.P){se=!0;let fa;for(;!this.J&&this.C<Gt.length;)if(fa=ih(this,Gt),fa==fc){Is==4&&(this.s=4,Vi(14),se=!1),vo(this.i,this.l,null,"[Incomplete Response]");break}else if(fa==nh){this.s=4,Vi(15),vo(this.i,this.l,Gt,"[Invalid Chunk]"),se=!1;break}else vo(this.i,this.l,fa,null),Np(this,fa);if(ra(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),Is!=4||Gt.length!=0||this.h.h||(this.s=1,Vi(16),se=!1),this.o=this.o&&se,!se)vo(this.i,this.l,Gt,"[Invalid Chunked Response]"),Va(this),Cl(this);else if(0<Gt.length&&!this.W){this.W=!0;var co=this.j;co.g==this&&co.ba&&!co.M&&(co.j.info("Great, no buffering proxy detected. Bytes received: "+Gt.length),r_(co),co.M=!0,Vi(11))}}else vo(this.i,this.l,Gt,null),Np(this,Gt);Is==4&&Va(this),this.o&&!this.J&&(Is==4?ym(this.j,this):(this.o=!1,Xr(this)))}else ua(this.g),se==400&&0<Gt.indexOf("Unknown SID")?(this.s=3,Vi(12)):(this.s=0,Vi(13)),Va(this),Cl(this)}}}catch{}finally{}};function ra(A){return A.g?A.u=="GET"&&A.L!=2&&A.j.Ca:!1}function ih(A,z){var se=A.C,ge=z.indexOf(`
`,se);return ge==-1?fc:(se=Number(z.substring(se,ge)),isNaN(se)?nh:(ge+=1,ge+se>z.length?fc:(z=z.slice(ge,ge+se),A.C=ge+se,z)))}Gi.prototype.cancel=function(){this.J=!0,Va(this)};function Xr(A){A.S=Date.now()+A.I,Pi(A,A.I)}function Pi(A,z){if(A.B!=null)throw Error("WatchDog timer not null");A.B=pn(P(A.ba,A),z)}function Lc(A){A.B&&(_.clearTimeout(A.B),A.B=null)}Gi.prototype.ba=function(){this.B=null;const A=Date.now();0<=A-this.S?(iu(this.i,this.A),this.L!=2&&(pc(),Vi(17)),Va(this),this.s=2,Cl(this)):Pi(this,this.S-A)};function Cl(A){A.j.G==0||A.J||ym(A.j,A)}function Va(A){Lc(A);var z=A.M;z&&typeof z.ma=="function"&&z.ma(),A.M=null,Ts(A.U),A.g&&(z=A.g,A.g=null,z.abort(),z.ma())}function Np(A,z){try{var se=A.j;if(se.G!=0&&(se.g==A||bo(se.h,A))){if(!A.K&&bo(se.h,A)&&se.G==3){try{var ge=se.Da.g.parse(z)}catch{ge=null}if(Array.isArray(ge)&&ge.length==3){var Qe=ge;if(Qe[0]==0){e:if(!se.u){if(se.g)if(se.g.F+3e3<A.F)_m(se),Ol(se);else break e;gm(se),Vi(18)}}else se.za=Qe[1],0<se.za-se.T&&37500>Qe[2]&&se.F&&se.v==0&&!se.C&&(se.C=pn(P(se.Za,se),6e3));if(1>=um(se.h)&&se.ca){try{se.ca()}catch{}se.ca=void 0}}else ud(se,11)}else if((A.K||se.g==A)&&_m(se),!K(z))for(Qe=se.Da.g.parse(z),z=0;z<Qe.length;z++){let Pr=Qe[z];if(se.T=Pr[0],Pr=Pr[1],se.G==2)if(Pr[0]=="c"){se.K=Pr[1],se.ia=Pr[2];const co=Pr[3];co!=null&&(se.la=co,se.j.info("VER="+se.la));const Is=Pr[4];Is!=null&&(se.Aa=Is,se.j.info("SVER="+se.Aa));const _c=Pr[5];_c!=null&&typeof _c=="number"&&0<_c&&(ge=1.5*_c,se.L=ge,se.j.info("backChannelRequestTimeoutMs_="+ge)),ge=se;const fa=A.g;if(fa){const Up=fa.g?fa.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(Up){var dt=ge.h;dt.g||Up.indexOf("spdy")==-1&&Up.indexOf("quic")==-1&&Up.indexOf("h2")==-1||(dt.j=dt.l,dt.g=new Set,dt.h&&(Dp(dt,dt.h),dt.h=null))}if(ge.D){const vm=fa.g?fa.g.getResponseHeader("X-HTTP-Session-Id"):null;vm&&(ge.ya=vm,ni(ge.I,ge.D,vm))}}se.G=3,se.l&&se.l.ua(),se.ba&&(se.R=Date.now()-A.F,se.j.info("Handshake RTT: "+se.R+"ms")),ge=se;var Gt=A;if(ge.qa=i_(ge,ge.J?ge.ia:null,ge.W),Gt.K){Rl(ge.h,Gt);var ri=Gt,Ei=ge.L;Ei&&(ri.I=Ei),ri.B&&(Lc(ri),Xr(ri)),ge.g=Gt}else pu(ge);0<se.i.length&&Vc(se)}else Pr[0]!="stop"&&Pr[0]!="close"||ud(se,7);else se.G==3&&(Pr[0]=="stop"||Pr[0]=="close"?Pr[0]=="stop"?ud(se,7):os(se):Pr[0]!="noop"&&se.l&&se.l.ta(Pr),se.v=0)}}pc(4)}catch{}}var sh=class{constructor(A,z){this.g=A,this.map=z}};function ou(A){this.l=A||10,_.PerformanceNavigationTiming?(A=_.performance.getEntriesByType("navigation"),A=0<A.length&&(A[0].nextHopProtocol=="hq"||A[0].nextHopProtocol=="h2")):A=!!(_.chrome&&_.chrome.loadTimes&&_.chrome.loadTimes()&&_.chrome.loadTimes().wasFetchedViaSpdy),this.j=A?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function Fo(A){return A.h?!0:A.g?A.g.size>=A.j:!1}function um(A){return A.h?1:A.g?A.g.size:0}function bo(A,z){return A.h?A.h==z:A.g?A.g.has(z):!1}function Dp(A,z){A.g?A.g.add(z):A.h=z}function Rl(A,z){A.h&&A.h==z?A.h=null:A.g&&A.g.has(z)&&A.g.delete(z)}ou.prototype.cancel=function(){if(this.i=oh(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const A of this.g.values())A.cancel();this.g.clear()}};function oh(A){if(A.h!=null)return A.i.concat(A.h.D);if(A.g!=null&&A.g.size!==0){let z=A.i;for(const se of A.g.values())z=z.concat(se.D);return z}return F(A.i)}function ah(A){if(A.V&&typeof A.V=="function")return A.V();if(typeof Map<"u"&&A instanceof Map||typeof Set<"u"&&A instanceof Set)return Array.from(A.values());if(typeof A=="string")return A.split("");if(E(A)){for(var z=[],se=A.length,ge=0;ge<se;ge++)z.push(A[ge]);return z}z=[],se=0;for(ge in A)z[se++]=A[ge];return z}function br(A){if(A.na&&typeof A.na=="function")return A.na();if(!A.V||typeof A.V!="function"){if(typeof Map<"u"&&A instanceof Map)return Array.from(A.keys());if(!(typeof Set<"u"&&A instanceof Set)){if(E(A)||typeof A=="string"){var z=[];A=A.length;for(var se=0;se<A;se++)z.push(se);return z}z=[],se=0;for(const ge in A)z[se++]=ge;return z}}}function au(A,z){if(A.forEach&&typeof A.forEach=="function")A.forEach(z,void 0);else if(E(A)||typeof A=="string")Array.prototype.forEach.call(A,z,void 0);else for(var se=br(A),ge=ah(A),Qe=ge.length,dt=0;dt<Qe;dt++)z.call(void 0,ge[dt],se&&se[dt],A)}var cu=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function id(A,z){if(A){A=A.split("&");for(var se=0;se<A.length;se++){var ge=A[se].indexOf("="),Qe=null;if(0<=ge){var dt=A[se].substring(0,ge);Qe=A[se].substring(ge+1)}else dt=A[se];z(dt,Qe?decodeURIComponent(Qe.replace(/\+/g," ")):"")}}}function mc(A){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,A instanceof mc){this.h=A.h,sd(this,A.j),this.o=A.o,this.g=A.g,Il(this,A.s),this.l=A.l;var z=A.i,se=new sa;se.i=z.i,z.g&&(se.g=new Map(z.g),se.h=z.h),lu(this,se),this.m=A.m}else A&&(z=String(A).match(cu))?(this.h=!1,sd(this,z[1]||"",!0),this.o=hr(z[2]||""),this.g=hr(z[3]||"",!0),Il(this,z[4]),this.l=hr(z[5]||"",!0),lu(this,z[6]||"",!0),this.m=hr(z[7]||"")):(this.h=!1,this.i=new sa(null,this.h))}mc.prototype.toString=function(){var A=[],z=this.j;z&&A.push(Mc(z,uu,!0),":");var se=this.g;return(se||z=="file")&&(A.push("//"),(z=this.o)&&A.push(Mc(z,uu,!0),"@"),A.push(encodeURIComponent(String(se)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),se=this.s,se!=null&&A.push(":",String(se))),(se=this.l)&&(this.g&&se.charAt(0)!="/"&&A.push("/"),A.push(Mc(se,se.charAt(0)=="/"?xp:ch,!0))),(se=this.i.toString())&&A.push("?",se),(se=this.m)&&A.push("#",Mc(se,Lp)),A.join("")};function ia(A){return new mc(A)}function sd(A,z,se){A.j=se?hr(z,!0):z,A.j&&(A.j=A.j.replace(/:$/,""))}function Il(A,z){if(z){if(z=Number(z),isNaN(z)||0>z)throw Error("Bad port number "+z);A.s=z}else A.s=null}function lu(A,z,se){z instanceof sa?(A.i=z,la(A.i,A.h)):(se||(z=Mc(z,hm)),A.i=new sa(z,A.h))}function ni(A,z,se){A.i.set(z,se)}function gc(A){return ni(A,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),A}function hr(A,z){return A?z?decodeURI(A.replace(/%25/g,"%2525")):decodeURIComponent(A):""}function Mc(A,z,se){return typeof A=="string"?(A=encodeURI(A).replace(z,dm),se&&(A=A.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),A):null}function dm(A){return A=A.charCodeAt(0),"%"+(A>>4&15).toString(16)+(A&15).toString(16)}var uu=/[#\/\?@]/g,ch=/[#\?:]/g,xp=/[#\?]/g,hm=/[#\?@]/g,Lp=/#/g;function sa(A,z){this.h=this.g=null,this.i=A||null,this.j=!!z}function gs(A){A.g||(A.g=new Map,A.h=0,A.i&&id(A.i,function(z,se){A.add(decodeURIComponent(z.replace(/\+/g," ")),se)}))}n=sa.prototype,n.add=function(A,z){gs(this),this.i=null,A=ca(this,A);var se=this.g.get(A);return se||this.g.set(A,se=[]),se.push(z),this.h+=1,this};function oa(A,z){gs(A),z=ca(A,z),A.g.has(z)&&(A.i=null,A.h-=A.g.get(z).length,A.g.delete(z))}function aa(A,z){return gs(A),z=ca(A,z),A.g.has(z)}n.forEach=function(A,z){gs(this),this.g.forEach(function(se,ge){se.forEach(function(Qe){A.call(z,Qe,ge,this)},this)},this)},n.na=function(){gs(this);const A=Array.from(this.g.values()),z=Array.from(this.g.keys()),se=[];for(let ge=0;ge<z.length;ge++){const Qe=A[ge];for(let dt=0;dt<Qe.length;dt++)se.push(z[ge])}return se},n.V=function(A){gs(this);let z=[];if(typeof A=="string")aa(this,A)&&(z=z.concat(this.g.get(ca(this,A))));else{A=Array.from(this.g.values());for(let se=0;se<A.length;se++)z=z.concat(A[se])}return z},n.set=function(A,z){return gs(this),this.i=null,A=ca(this,A),aa(this,A)&&(this.h-=this.g.get(A).length),this.g.set(A,[z]),this.h+=1,this},n.get=function(A,z){return A?(A=this.V(A),0<A.length?String(A[0]):z):z};function du(A,z,se){oa(A,z),0<se.length&&(A.i=null,A.g.set(ca(A,z),F(se)),A.h+=se.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";const A=[],z=Array.from(this.g.keys());for(var se=0;se<z.length;se++){var ge=z[se];const dt=encodeURIComponent(String(ge)),Gt=this.V(ge);for(ge=0;ge<Gt.length;ge++){var Qe=dt;Gt[ge]!==""&&(Qe+="="+encodeURIComponent(String(Gt[ge]))),A.push(Qe)}}return this.i=A.join("&")};function ca(A,z){return z=String(z),A.j&&(z=z.toLowerCase()),z}function la(A,z){z&&!A.j&&(gs(A),A.i=null,A.g.forEach(function(se,ge){var Qe=ge.toLowerCase();ge!=Qe&&(oa(this,ge),du(this,Qe,se))},A)),A.j=z}function pm(A,z){const se=new Sr;if(_.Image){const ge=new Image;ge.onload=L(Rs,se,"TestLoadImage: loaded",!0,z,ge),ge.onerror=L(Rs,se,"TestLoadImage: error",!1,z,ge),ge.onabort=L(Rs,se,"TestLoadImage: abort",!1,z,ge),ge.ontimeout=L(Rs,se,"TestLoadImage: timeout",!1,z,ge),_.setTimeout(function(){ge.ontimeout&&ge.ontimeout()},1e4),ge.src=A}else z(!1)}function Uc(A,z){const se=new Sr,ge=new AbortController,Qe=setTimeout(()=>{ge.abort(),Rs(se,"TestPingServer: timeout",!1,z)},1e4);fetch(A,{signal:ge.signal}).then(dt=>{clearTimeout(Qe),dt.ok?Rs(se,"TestPingServer: ok",!0,z):Rs(se,"TestPingServer: server error",!1,z)}).catch(()=>{clearTimeout(Qe),Rs(se,"TestPingServer: error",!1,z)})}function Rs(A,z,se,ge,Qe){try{Qe&&(Qe.onload=null,Qe.onerror=null,Qe.onabort=null,Qe.ontimeout=null),ge(se)}catch{}}function od(){this.g=new dc}function Mp(A,z,se){const ge=se||"";try{au(A,function(Qe,dt){let Gt=Qe;b(Qe)&&(Gt=ui(Qe)),z.push(ge+dt+"="+encodeURIComponent(Gt))})}catch(Qe){throw z.push(ge+"type="+encodeURIComponent("_badmap")),Qe}}function Al(A){this.l=A.Ub||null,this.j=A.eb||!1}M(Al,oo),Al.prototype.g=function(){return new hu(this.l,this.j)},Al.prototype.i=function(A){return function(){return A}}({});function hu(A,z){Sn.call(this),this.D=A,this.o=z,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}M(hu,Sn),n=hu.prototype,n.open=function(A,z){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=A,this.A=z,this.readyState=1,Fa(this)},n.send=function(A){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const z={headers:this.u,method:this.B,credentials:this.m,cache:void 0};A&&(z.body=A),(this.D||_).fetch(new Request(this.A,z)).then(this.Sa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,ja(this)),this.readyState=0},n.Sa=function(A){if(this.g&&(this.l=A,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=A.headers,this.readyState=2,Fa(this)),this.g&&(this.readyState=3,Fa(this),this.g)))if(this.responseType==="arraybuffer")A.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof _.ReadableStream<"u"&&"body"in A){if(this.j=A.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;fm(this)}else A.text().then(this.Ra.bind(this),this.ga.bind(this))};function fm(A){A.j.read().then(A.Pa.bind(A)).catch(A.ga.bind(A))}n.Pa=function(A){if(this.g){if(this.o&&A.value)this.response.push(A.value);else if(!this.o){var z=A.value?A.value:new Uint8Array(0);(z=this.v.decode(z,{stream:!A.done}))&&(this.response=this.responseText+=z)}A.done?ja(this):Fa(this),this.readyState==3&&fm(this)}},n.Ra=function(A){this.g&&(this.response=this.responseText=A,ja(this))},n.Qa=function(A){this.g&&(this.response=A,ja(this))},n.ga=function(){this.g&&ja(this)};function ja(A){A.readyState=4,A.l=null,A.j=null,A.v=null,Fa(A)}n.setRequestHeader=function(A,z){this.u.append(A,z)},n.getResponseHeader=function(A){return this.h&&this.h.get(A.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";const A=[],z=this.h.entries();for(var se=z.next();!se.done;)se=se.value,A.push(se[0]+": "+se[1]),se=z.next();return A.join(`\r
`)};function Fa(A){A.onreadystatechange&&A.onreadystatechange.call(A)}Object.defineProperty(hu.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(A){this.m=A?"include":"same-origin"}});function Pl(A){let z="";return pe(A,function(se,ge){z+=ge,z+=":",z+=se,z+=`\r
`}),z}function Se(A,z,se){e:{for(ge in se){var ge=!1;break e}ge=!0}ge||(se=Pl(se),typeof A=="string"?se!=null&&encodeURIComponent(String(se)):ni(A,z,se))}function De(A){Sn.call(this),this.headers=new Map,this.o=A||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}M(De,Sn);var it=/^https?$/i,nn=["POST","PUT"];n=De.prototype,n.Ha=function(A){this.J=A},n.ea=function(A,z,se,ge){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+A);z=z?z.toUpperCase():"GET",this.D=A,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():Ai.g(),this.v=this.o?ao(this.o):ao(Ai),this.g.onreadystatechange=P(this.Ea,this);try{this.B=!0,this.g.open(z,String(A),!0),this.B=!1}catch(dt){er(this,dt);return}if(A=se||"",se=new Map(this.headers),ge)if(Object.getPrototypeOf(ge)===Object.prototype)for(var Qe in ge)se.set(Qe,ge[Qe]);else if(typeof ge.keys=="function"&&typeof ge.get=="function")for(const dt of ge.keys())se.set(dt,ge.get(dt));else throw Error("Unknown input type for opt_headers: "+String(ge));ge=Array.from(se.keys()).find(dt=>dt.toLowerCase()=="content-type"),Qe=_.FormData&&A instanceof _.FormData,!(0<=Array.prototype.indexOf.call(nn,z,void 0))||ge||Qe||se.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[dt,Gt]of se)this.g.setRequestHeader(dt,Gt);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{Gr(this),this.u=!0,this.g.send(A),this.u=!1}catch(dt){er(this,dt)}};function er(A,z){A.h=!1,A.g&&(A.j=!0,A.g.abort(),A.j=!1),A.l=z,A.m=5,Ar(A),mn(A)}function Ar(A){A.A||(A.A=!0,sn(A,"complete"),sn(A,"error"))}n.abort=function(A){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=A||7,sn(this,"complete"),sn(this,"abort"),mn(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),mn(this,!0)),De.aa.N.call(this)},n.Ea=function(){this.s||(this.B||this.u||this.j?Jr(this):this.bb())},n.bb=function(){Jr(this)};function Jr(A){if(A.h&&typeof f<"u"&&(!A.v[1]||Oi(A)!=4||A.Z()!=2)){if(A.u&&Oi(A)==4)ir(A.Ea,0,A);else if(sn(A,"readystatechange"),Oi(A)==4){A.h=!1;try{const Gt=A.Z();e:switch(Gt){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var z=!0;break e;default:z=!1}var se;if(!(se=z)){var ge;if(ge=Gt===0){var Qe=String(A.D).match(cu)[1]||null;!Qe&&_.self&&_.self.location&&(Qe=_.self.location.protocol.slice(0,-1)),ge=!it.test(Qe?Qe.toLowerCase():"")}se=ge}if(se)sn(A,"complete"),sn(A,"success");else{A.m=6;try{var dt=2<Oi(A)?A.g.statusText:""}catch{dt=""}A.l=dt+" ["+A.Z()+"]",Ar(A)}}finally{mn(A)}}}}function mn(A,z){if(A.g){Gr(A);const se=A.g,ge=A.v[0]?()=>{}:null;A.g=null,A.v=null,z||sn(A,"ready");try{se.onreadystatechange=ge}catch{}}}function Gr(A){A.I&&(_.clearTimeout(A.I),A.I=null)}n.isActive=function(){return!!this.g};function Oi(A){return A.g?A.g.readyState:0}n.Z=function(){try{return 2<Oi(this)?this.g.status:-1}catch{return-1}},n.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.Oa=function(A){if(this.g){var z=this.g.responseText;return A&&z.indexOf(A)==0&&(z=z.substring(A.length)),na(z)}};function Ys(A){try{if(!A.g)return null;if("response"in A.g)return A.g.response;switch(A.H){case"":case"text":return A.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in A.g)return A.g.mozResponseArrayBuffer}return null}catch{return null}}function ua(A){const z={};A=(A.g&&2<=Oi(A)&&A.g.getAllResponseHeaders()||"").split(`\r
`);for(let ge=0;ge<A.length;ge++){if(K(A[ge]))continue;var se=le(A[ge]);const Qe=se[0];if(se=se[1],typeof se!="string")continue;se=se.trim();const dt=z[Qe]||[];z[Qe]=dt,dt.push(se)}X(z,function(ge){return ge.join(", ")})}n.Ba=function(){return this.m},n.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function da(A,z,se){return se&&se.internalChannelParams&&se.internalChannelParams[A]||z}function ad(A){this.Aa=0,this.i=[],this.j=new Sr,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=da("failFast",!1,A),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=da("baseRetryDelayMs",5e3,A),this.cb=da("retryDelaySeedMs",1e4,A),this.Wa=da("forwardChannelMaxRetries",2,A),this.wa=da("forwardChannelRequestTimeoutMs",2e4,A),this.pa=A&&A.xmlHttpFactory||void 0,this.Xa=A&&A.Tb||void 0,this.Ca=A&&A.useFetchStreams||!1,this.L=void 0,this.J=A&&A.supportsCrossDomainXhr||!1,this.K="",this.h=new ou(A&&A.concurrentRequestLimit),this.Da=new od,this.P=A&&A.fastHandshake||!1,this.O=A&&A.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=A&&A.Rb||!1,A&&A.xa&&this.j.xa(),A&&A.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&A&&A.detectBufferingProxy||!1,this.ja=void 0,A&&A.longPollingTimeout&&0<A.longPollingTimeout&&(this.ja=A.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}n=ad.prototype,n.la=8,n.G=1,n.connect=function(A,z,se,ge){Vi(0),this.W=A,this.H=z||{},se&&ge!==void 0&&(this.H.OSID=se,this.H.OAID=ge),this.F=this.X,this.I=i_(this,null,this.W),Vc(this)};function os(A){if(lh(A),A.G==3){var z=A.U++,se=ia(A.I);if(ni(se,"SID",A.K),ni(se,"RID",z),ni(se,"TYPE","terminate"),cd(A,se),z=new Gi(A,A.j,z),z.L=2,z.v=gc(ia(se)),se=!1,_.navigator&&_.navigator.sendBeacon)try{se=_.navigator.sendBeacon(z.v.toString(),"")}catch{}!se&&_.Image&&(new Image().src=z.v,se=!0),se||(z.g=gE(z.j,null),z.g.ea(z.v)),z.F=Date.now(),Xr(z)}dd(A)}function Ol(A){A.g&&(r_(A),A.g.cancel(),A.g=null)}function lh(A){Ol(A),A.u&&(_.clearTimeout(A.u),A.u=null),_m(A),A.h.cancel(),A.s&&(typeof A.s=="number"&&_.clearTimeout(A.s),A.s=null)}function Vc(A){if(!Fo(A.h)&&!A.s){A.s=!0;var z=A.Ga;Re||We(),ve||(Re(),ve=!0),be.add(z,A),A.B=0}}function n_(A,z){return um(A.h)>=A.h.j-(A.s?1:0)?!1:A.s?(A.i=z.D.concat(A.i),!0):A.G==1||A.G==2||A.B>=(A.Va?0:A.Wa)?!1:(A.s=pn(P(A.Ga,A,z),ld(A,A.B)),A.B++,!0)}n.Ga=function(A){if(this.s)if(this.s=null,this.G==1){if(!A){this.U=Math.floor(1e5*Math.random()),A=this.U++;const Qe=new Gi(this,this.j,A);let dt=this.o;if(this.S&&(dt?(dt=J(dt),ie(dt,this.S)):dt=this.S),this.m!==null||this.O||(Qe.H=dt,dt=null),this.P)e:{for(var z=0,se=0;se<this.i.length;se++){t:{var ge=this.i[se];if("__data__"in ge.map&&(ge=ge.map.__data__,typeof ge=="string")){ge=ge.length;break t}ge=void 0}if(ge===void 0)break;if(z+=ge,4096<z){z=se;break e}if(z===4096||se===this.i.length-1){z=se+1;break e}}z=1e3}else z=1e3;z=ha(this,Qe,z),se=ia(this.I),ni(se,"RID",A),ni(se,"CVER",22),this.D&&ni(se,"X-HTTP-Session-Id",this.D),cd(this,se),dt&&(this.O?z="headers="+encodeURIComponent(String(Pl(dt)))+"&"+z:this.m&&Se(se,this.m,dt)),Dp(this.h,Qe),this.Ua&&ni(se,"TYPE","init"),this.P?(ni(se,"$req",z),ni(se,"SID","null"),Qe.T=!0,rh(Qe,se,null)):rh(Qe,se,z),this.G=2}}else this.G==3&&(A?mm(this,A):this.i.length==0||Fo(this.h)||mm(this))};function mm(A,z){var se;z?se=z.l:se=A.U++;const ge=ia(A.I);ni(ge,"SID",A.K),ni(ge,"RID",se),ni(ge,"AID",A.T),cd(A,ge),A.m&&A.o&&Se(ge,A.m,A.o),se=new Gi(A,A.j,se,A.B+1),A.m===null&&(se.H=A.o),z&&(A.i=z.D.concat(A.i)),z=ha(A,se,1e3),se.I=Math.round(.5*A.wa)+Math.round(.5*A.wa*Math.random()),Dp(A.h,se),rh(se,ge,z)}function cd(A,z){A.H&&pe(A.H,function(se,ge){ni(z,ge,se)}),A.l&&au({},function(se,ge){ni(z,ge,se)})}function ha(A,z,se){se=Math.min(A.i.length,se);var ge=A.l?P(A.l.Na,A.l,A):null;e:{var Qe=A.i;let dt=-1;for(;;){const Gt=["count="+se];dt==-1?0<se?(dt=Qe[0].g,Gt.push("ofs="+dt)):dt=0:Gt.push("ofs="+dt);let ri=!0;for(let Ei=0;Ei<se;Ei++){let Pr=Qe[Ei].g;const co=Qe[Ei].map;if(Pr-=dt,0>Pr)dt=Math.max(0,Qe[Ei].g-100),ri=!1;else try{Mp(co,Gt,"req"+Pr+"_")}catch{ge&&ge(co)}}if(ri){ge=Gt.join("&");break e}}}return A=A.i.splice(0,se),z.D=A,ge}function pu(A){if(!A.g&&!A.u){A.Y=1;var z=A.Fa;Re||We(),ve||(Re(),ve=!0),be.add(z,A),A.v=0}}function gm(A){return A.g||A.u||3<=A.v?!1:(A.Y++,A.u=pn(P(A.Fa,A),ld(A,A.v)),A.v++,!0)}n.Fa=function(){if(this.u=null,mE(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var A=2*this.R;this.j.info("BP detection timer enabled: "+A),this.A=pn(P(this.ab,this),A)}},n.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,Vi(10),Ol(this),mE(this))};function r_(A){A.A!=null&&(_.clearTimeout(A.A),A.A=null)}function mE(A){A.g=new Gi(A,A.j,"rpc",A.Y),A.m===null&&(A.g.H=A.o),A.g.O=0;var z=ia(A.qa);ni(z,"RID","rpc"),ni(z,"SID",A.K),ni(z,"AID",A.T),ni(z,"CI",A.F?"0":"1"),!A.F&&A.ja&&ni(z,"TO",A.ja),ni(z,"TYPE","xmlhttp"),cd(A,z),A.m&&A.o&&Se(z,A.m,A.o),A.L&&(A.g.I=A.L);var se=A.g;A=A.ia,se.L=1,se.v=gc(ia(z)),se.m=null,se.P=!0,rd(se,A)}n.Za=function(){this.C!=null&&(this.C=null,Ol(this),gm(this),Vi(19))};function _m(A){A.C!=null&&(_.clearTimeout(A.C),A.C=null)}function ym(A,z){var se=null;if(A.g==z){_m(A),r_(A),A.g=null;var ge=2}else if(bo(A.h,z))se=z.D,Rl(A.h,z),ge=1;else return;if(A.G!=0){if(z.o)if(ge==1){se=z.m?z.m.length:0,z=Date.now()-z.F;var Qe=A.B;ge=wl(),sn(ge,new vt(ge,se)),Vc(A)}else pu(A);else if(Qe=z.s,Qe==3||Qe==0&&0<z.X||!(ge==1&&n_(A,z)||ge==2&&gm(A)))switch(se&&0<se.length&&(z=A.h,z.i=z.i.concat(se)),Qe){case 1:ud(A,5);break;case 4:ud(A,10);break;case 3:ud(A,6);break;default:ud(A,2)}}}function ld(A,z){let se=A.Ta+Math.floor(Math.random()*A.cb);return A.isActive()||(se*=2),se*z}function ud(A,z){if(A.j.info("Error code "+z),z==2){var se=P(A.fb,A),ge=A.Xa;const Qe=!ge;ge=new mc(ge||"//www.google.com/images/cleardot.gif"),_.location&&_.location.protocol=="http"||sd(ge,"https"),gc(ge),Qe?pm(ge.toString(),se):Uc(ge.toString(),se)}else Vi(2);A.G=0,A.l&&A.l.sa(z),dd(A),lh(A)}n.fb=function(A){A?(this.j.info("Successfully pinged google.com"),Vi(2)):(this.j.info("Failed to ping google.com"),Vi(1))};function dd(A){if(A.G=0,A.ka=[],A.l){const z=oh(A.h);(z.length!=0||A.i.length!=0)&&(B(A.ka,z),B(A.ka,A.i),A.h.i.length=0,F(A.i),A.i.length=0),A.l.ra()}}function i_(A,z,se){var ge=se instanceof mc?ia(se):new mc(se);if(ge.g!="")z&&(ge.g=z+"."+ge.g),Il(ge,ge.s);else{var Qe=_.location;ge=Qe.protocol,z=z?z+"."+Qe.hostname:Qe.hostname,Qe=+Qe.port;var dt=new mc(null);ge&&sd(dt,ge),z&&(dt.g=z),Qe&&Il(dt,Qe),se&&(dt.l=se),ge=dt}return se=A.D,z=A.ya,se&&z&&ni(ge,se,z),ni(ge,"VER",A.la),cd(A,ge),ge}function gE(A,z,se){if(z&&!A.J)throw Error("Can't create secondary domain capable XhrIo object.");return z=A.Ca&&!A.pa?new De(new Al({eb:se})):new De(A.pa),z.Ha(A.J),z}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function Hn(){}n=Hn.prototype,n.ua=function(){},n.ta=function(){},n.sa=function(){},n.ra=function(){},n.isActive=function(){return!0},n.Na=function(){};function Em(){}Em.prototype.g=function(A,z){return new pa(A,z)};function pa(A,z){Sn.call(this),this.g=new ad(z),this.l=A,this.h=z&&z.messageUrlParams||null,A=z&&z.messageHeaders||null,z&&z.clientProtocolHeaderRequired&&(A?A["X-Client-Protocol"]="webchannel":A={"X-Client-Protocol":"webchannel"}),this.g.o=A,A=z&&z.initMessageHeaders||null,z&&z.messageContentType&&(A?A["X-WebChannel-Content-Type"]=z.messageContentType:A={"X-WebChannel-Content-Type":z.messageContentType}),z&&z.va&&(A?A["X-WebChannel-Client-Profile"]=z.va:A={"X-WebChannel-Client-Profile":z.va}),this.g.S=A,(A=z&&z.Sb)&&!K(A)&&(this.g.m=A),this.v=z&&z.supportsCrossDomainXhr||!1,this.u=z&&z.sendRawJson||!1,(z=z&&z.httpSessionIdParam)&&!K(z)&&(this.g.D=z,A=this.h,A!==null&&z in A&&(A=this.h,z in A&&delete A[z])),this.j=new jc(this)}M(pa,Sn),pa.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},pa.prototype.close=function(){os(this.g)},pa.prototype.o=function(A){var z=this.g;if(typeof A=="string"){var se={};se.__data__=A,A=se}else this.u&&(se={},se.__data__=ui(A),A=se);z.i.push(new sh(z.Ya++,A)),z.G==3&&Vc(z)},pa.prototype.N=function(){this.g.l=null,delete this.j,os(this.g),delete this.g,pa.aa.N.call(this)};function _E(A){La.call(this),A.__headers__&&(this.headers=A.__headers__,this.statusCode=A.__status__,delete A.__headers__,delete A.__status__);var z=A.__sm__;if(z){e:{for(const se in z){A=se;break e}A=void 0}(this.i=A)&&(A=this.i,z=z!==null&&A in z?z[A]:void 0),this.data=z}else this.data=A}M(_E,La);function yE(){Vo.call(this),this.status=1}M(yE,Vo);function jc(A){this.g=A}M(jc,Hn),jc.prototype.ua=function(){sn(this.g,"a")},jc.prototype.ta=function(A){sn(this.g,new _E(A))},jc.prototype.sa=function(A){sn(this.g,new yE)},jc.prototype.ra=function(){sn(this.g,"b")},Em.prototype.createWebChannel=Em.prototype.g,pa.prototype.send=pa.prototype.o,pa.prototype.open=pa.prototype.m,pa.prototype.close=pa.prototype.close,qie=function(){return new Em},Kie=function(){return wl()},$ie=Ma,ij={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},Tl.NO_ERROR=0,Tl.TIMEOUT=8,Tl.HTTP_ERROR=6,Pk=Tl,su.COMPLETE="complete",Hie=su,xc.EventType=Cs,Cs.OPEN="a",Cs.CLOSE="b",Cs.ERROR="c",Cs.MESSAGE="d",Sn.prototype.listen=Sn.prototype.K,iC=xc,De.prototype.listenOnce=De.prototype.L,De.prototype.getLastError=De.prototype.Ka,De.prototype.getLastErrorCode=De.prototype.Ba,De.prototype.getStatus=De.prototype.Z,De.prototype.getResponseJson=De.prototype.Oa,De.prototype.getResponseText=De.prototype.oa,De.prototype.send=De.prototype.ea,De.prototype.setWithCredentials=De.prototype.Ha,Gie=De}).apply(typeof $O<"u"?$O:typeof self<"u"?self:typeof window<"u"?window:{});const hJ="@firebase/firestore",pJ="4.7.10";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sc{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}sc.UNAUTHENTICATED=new sc(null),sc.GOOGLE_CREDENTIALS=new sc("google-credentials-uid"),sc.FIRST_PARTY=new sc("first-party-uid"),sc.MOCK_USER=new sc("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let rb="11.5.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const iE=new y4("@firebase/firestore");function FS(){return iE.logLevel}function an(n,...e){if(iE.logLevel<=Nr.DEBUG){const i=e.map(P4);iE.debug(`Firestore (${rb}): ${n}`,...i)}}function rm(n,...e){if(iE.logLevel<=Nr.ERROR){const i=e.map(P4);iE.error(`Firestore (${rb}): ${n}`,...i)}}function U0(n,...e){if(iE.logLevel<=Nr.WARN){const i=e.map(P4);iE.warn(`Firestore (${rb}): ${n}`,...i)}}function P4(n){if(typeof n=="string")return n;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return function(i){return JSON.stringify(i)}(n)}catch{return n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Yn(n="Unexpected state"){const e=`FIRESTORE (${rb}) INTERNAL ASSERTION FAILED: `+n;throw rm(e),new Error(e)}function _i(n,e){n||Yn()}function rr(n,e){return n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ct={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Qt extends Pp{constructor(e,i){super(e,i),this.code=e,this.message=i,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yf{constructor(){this.promise=new Promise((e,i)=>{this.resolve=e,this.reject=i})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yie{constructor(e,i){this.user=i,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class N4e{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,i){e.enqueueRetryable(()=>i(sc.UNAUTHENTICATED))}shutdown(){}}class D4e{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,i){this.changeListener=i,e.enqueueRetryable(()=>i(this.token.user))}shutdown(){this.changeListener=null}}class x4e{constructor(e){this.t=e,this.currentUser=sc.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,i){_i(this.o===void 0);let o=this.i;const l=E=>this.i!==o?(o=this.i,i(E)):Promise.resolve();let u=new Yf;this.o=()=>{this.i++,this.currentUser=this.u(),u.resolve(),u=new Yf,e.enqueueRetryable(()=>l(this.currentUser))};const f=()=>{const E=u;e.enqueueRetryable(async()=>{await E.promise,await l(this.currentUser)})},_=E=>{an("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=E,this.o&&(this.auth.addAuthTokenListener(this.o),f())};this.t.onInit(E=>_(E)),setTimeout(()=>{if(!this.auth){const E=this.t.getImmediate({optional:!0});E?_(E):(an("FirebaseAuthCredentialsProvider","Auth not yet detected"),u.resolve(),u=new Yf)}},0),f()}getToken(){const e=this.i,i=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(i).then(o=>this.i!==e?(an("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):o?(_i(typeof o.accessToken=="string"),new Yie(o.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return _i(e===null||typeof e=="string"),new sc(e)}}class L4e{constructor(e,i,o){this.l=e,this.h=i,this.P=o,this.type="FirstParty",this.user=sc.FIRST_PARTY,this.T=new Map}I(){return this.P?this.P():null}get headers(){this.T.set("X-Goog-AuthUser",this.l);const e=this.I();return e&&this.T.set("Authorization",e),this.h&&this.T.set("X-Goog-Iam-Authorization-Token",this.h),this.T}}class M4e{constructor(e,i,o){this.l=e,this.h=i,this.P=o}getToken(){return Promise.resolve(new L4e(this.l,this.h,this.P))}start(e,i){e.enqueueRetryable(()=>i(sc.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class fJ{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class U4e{constructor(e,i){this.A=i,this.forceRefresh=!1,this.appCheck=null,this.R=null,this.V=null,$l(e)&&e.settings.appCheckToken&&(this.V=e.settings.appCheckToken)}start(e,i){_i(this.o===void 0);const o=u=>{u.error!=null&&an("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${u.error.message}`);const f=u.token!==this.R;return this.R=u.token,an("FirebaseAppCheckTokenProvider",`Received ${f?"new":"existing"} token.`),f?i(u.token):Promise.resolve()};this.o=u=>{e.enqueueRetryable(()=>o(u))};const l=u=>{an("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=u,this.o&&this.appCheck.addTokenListener(this.o)};this.A.onInit(u=>l(u)),setTimeout(()=>{if(!this.appCheck){const u=this.A.getImmediate({optional:!0});u?l(u):an("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.V)return Promise.resolve(new fJ(this.V));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(i=>i?(_i(typeof i.token=="string"),this.R=i.token,new fJ(i.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function V4e(n){const e=typeof self<"u"&&(self.crypto||self.msCrypto),i=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(i);else for(let o=0;o<n;o++)i[o]=Math.floor(256*Math.random());return i}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Xie(){return new TextEncoder}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jie{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",i=62*Math.floor(4.129032258064516);let o="";for(;o.length<20;){const l=V4e(40);for(let u=0;u<l.length;++u)o.length<20&&l[u]<i&&(o+=e.charAt(l[u]%62))}return o}}function vr(n,e){return n<e?-1:n>e?1:0}function sj(n,e){let i=0;for(;i<n.length&&i<e.length;){const o=n.codePointAt(i),l=e.codePointAt(i);if(o!==l){if(o<128&&l<128)return vr(o,l);{const u=Xie(),f=j4e(u.encode(mJ(n,i)),u.encode(mJ(e,i)));return f!==0?f:vr(o,l)}}i+=o>65535?2:1}return vr(n.length,e.length)}function mJ(n,e){return n.codePointAt(e)>65535?n.substring(e,e+2):n.substring(e,e+1)}function j4e(n,e){for(let i=0;i<n.length&&i<e.length;++i)if(n[i]!==e[i])return vr(n[i],e[i]);return vr(n.length,e.length)}function V0(n,e,i){return n.length===e.length&&n.every((o,l)=>i(o,e[l]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gJ=-62135596800,_J=1e6;class xo{static now(){return xo.fromMillis(Date.now())}static fromDate(e){return xo.fromMillis(e.getTime())}static fromMillis(e){const i=Math.floor(e/1e3),o=Math.floor((e-1e3*i)*_J);return new xo(i,o)}constructor(e,i){if(this.seconds=e,this.nanoseconds=i,i<0)throw new Qt(Ct.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+i);if(i>=1e9)throw new Qt(Ct.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+i);if(e<gJ)throw new Qt(Ct.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new Qt(Ct.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/_J}_compareTo(e){return this.seconds===e.seconds?vr(this.nanoseconds,e.nanoseconds):vr(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds-gJ;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zn{static fromTimestamp(e){return new Zn(e)}static min(){return new Zn(new xo(0,0))}static max(){return new Zn(new xo(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yJ="__name__";class Jh{constructor(e,i,o){i===void 0?i=0:i>e.length&&Yn(),o===void 0?o=e.length-i:o>e.length-i&&Yn(),this.segments=e,this.offset=i,this.len=o}get length(){return this.len}isEqual(e){return Jh.comparator(this,e)===0}child(e){const i=this.segments.slice(this.offset,this.limit());return e instanceof Jh?e.forEach(o=>{i.push(o)}):i.push(e),this.construct(i)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let i=0;i<this.length;i++)if(this.get(i)!==e.get(i))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let i=0;i<this.length;i++)if(this.get(i)!==e.get(i))return!1;return!0}forEach(e){for(let i=this.offset,o=this.limit();i<o;i++)e(this.segments[i])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,i){const o=Math.min(e.length,i.length);for(let l=0;l<o;l++){const u=Jh.compareSegments(e.get(l),i.get(l));if(u!==0)return u}return vr(e.length,i.length)}static compareSegments(e,i){const o=Jh.isNumericId(e),l=Jh.isNumericId(i);return o&&!l?-1:!o&&l?1:o&&l?Jh.extractNumericId(e).compare(Jh.extractNumericId(i)):sj(e,i)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return Mg.fromString(e.substring(4,e.length-2))}}class Ki extends Jh{construct(e,i,o){return new Ki(e,i,o)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const i=[];for(const o of e){if(o.indexOf("//")>=0)throw new Qt(Ct.INVALID_ARGUMENT,`Invalid segment (${o}). Paths must not contain // in them.`);i.push(...o.split("/").filter(l=>l.length>0))}return new Ki(i)}static emptyPath(){return new Ki([])}}const F4e=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Na extends Jh{construct(e,i,o){return new Na(e,i,o)}static isValidIdentifier(e){return F4e.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Na.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===yJ}static keyField(){return new Na([yJ])}static fromServerFormat(e){const i=[];let o="",l=0;const u=()=>{if(o.length===0)throw new Qt(Ct.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);i.push(o),o=""};let f=!1;for(;l<e.length;){const _=e[l];if(_==="\\"){if(l+1===e.length)throw new Qt(Ct.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const E=e[l+1];if(E!=="\\"&&E!=="."&&E!=="`")throw new Qt(Ct.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);o+=E,l+=2}else _==="`"?(f=!f,l++):_!=="."||f?(o+=_,l++):(u(),l++)}if(u(),f)throw new Qt(Ct.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new Na(i)}static emptyPath(){return new Na([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rn{constructor(e){this.path=e}static fromPath(e){return new Rn(Ki.fromString(e))}static fromName(e){return new Rn(Ki.fromString(e).popFirst(5))}static empty(){return new Rn(Ki.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&Ki.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,i){return Ki.comparator(e.path,i.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new Rn(new Ki(e.slice()))}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ZC=-1;function B4e(n,e){const i=n.toTimestamp().seconds,o=n.toTimestamp().nanoseconds+1,l=Zn.fromTimestamp(o===1e9?new xo(i+1,0):new xo(i,o));return new Wg(l,Rn.empty(),e)}function W4e(n){return new Wg(n.readTime,n.key,ZC)}class Wg{constructor(e,i,o){this.readTime=e,this.documentKey=i,this.largestBatchId=o}static min(){return new Wg(Zn.min(),Rn.empty(),ZC)}static max(){return new Wg(Zn.max(),Rn.empty(),ZC)}}function z4e(n,e){let i=n.readTime.compareTo(e.readTime);return i!==0?i:(i=Rn.comparator(n.documentKey,e.documentKey),i!==0?i:vr(n.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const G4e="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class H4e{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function ib(n){if(n.code!==Ct.FAILED_PRECONDITION||n.message!==G4e)throw n;an("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ot{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(i=>{this.isDone=!0,this.result=i,this.nextCallback&&this.nextCallback(i)},i=>{this.isDone=!0,this.error=i,this.catchCallback&&this.catchCallback(i)})}catch(e){return this.next(void 0,e)}next(e,i){return this.callbackAttached&&Yn(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(i,this.error):this.wrapSuccess(e,this.result):new Ot((o,l)=>{this.nextCallback=u=>{this.wrapSuccess(e,u).next(o,l)},this.catchCallback=u=>{this.wrapFailure(i,u).next(o,l)}})}toPromise(){return new Promise((e,i)=>{this.next(e,i)})}wrapUserFunction(e){try{const i=e();return i instanceof Ot?i:Ot.resolve(i)}catch(i){return Ot.reject(i)}}wrapSuccess(e,i){return e?this.wrapUserFunction(()=>e(i)):Ot.resolve(i)}wrapFailure(e,i){return e?this.wrapUserFunction(()=>e(i)):Ot.reject(i)}static resolve(e){return new Ot((i,o)=>{i(e)})}static reject(e){return new Ot((i,o)=>{o(e)})}static waitFor(e){return new Ot((i,o)=>{let l=0,u=0,f=!1;e.forEach(_=>{++l,_.next(()=>{++u,f&&u===l&&i()},E=>o(E))}),f=!0,u===l&&i()})}static or(e){let i=Ot.resolve(!1);for(const o of e)i=i.next(l=>l?Ot.resolve(l):o());return i}static forEach(e,i){const o=[];return e.forEach((l,u)=>{o.push(i.call(this,l,u))}),this.waitFor(o)}static mapArray(e,i){return new Ot((o,l)=>{const u=e.length,f=new Array(u);let _=0;for(let E=0;E<u;E++){const b=E;i(e[b]).next(C=>{f[b]=C,++_,_===u&&o(f)},C=>l(C))}})}static doWhile(e,i){return new Ot((o,l)=>{const u=()=>{e()===!0?i().next(()=>{u()},l):o()};u()})}}function $4e(n){const e=n.match(/Android ([\d.]+)/i),i=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(i)}function sb(n){return n.name==="IndexedDbTransactionError"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pN{constructor(e,i){this.previousValue=e,i&&(i.sequenceNumberHandler=o=>this.oe(o),this._e=o=>i.writeSequenceNumber(o))}oe(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this._e&&this._e(e),e}}pN.ae=-1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const O4=-1;function fN(n){return n==null}function l1(n){return n===0&&1/n==-1/0}function K4e(n){return typeof n=="number"&&Number.isInteger(n)&&!l1(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Qie="";function q4e(n){let e="";for(let i=0;i<n.length;i++)e.length>0&&(e=EJ(e)),e=Y4e(n.get(i),e);return EJ(e)}function Y4e(n,e){let i=e;const o=n.length;for(let l=0;l<o;l++){const u=n.charAt(l);switch(u){case"\0":i+="";break;case Qie:i+="";break;default:i+=u}}return i}function EJ(n){return n+Qie+""}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vJ(n){let e=0;for(const i in n)Object.prototype.hasOwnProperty.call(n,i)&&e++;return e}function e_(n,e){for(const i in n)Object.prototype.hasOwnProperty.call(n,i)&&e(i,n[i])}function Zie(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ws{constructor(e,i){this.comparator=e,this.root=i||Oa.EMPTY}insert(e,i){return new ws(this.comparator,this.root.insert(e,i,this.comparator).copy(null,null,Oa.BLACK,null,null))}remove(e){return new ws(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Oa.BLACK,null,null))}get(e){let i=this.root;for(;!i.isEmpty();){const o=this.comparator(e,i.key);if(o===0)return i.value;o<0?i=i.left:o>0&&(i=i.right)}return null}indexOf(e){let i=0,o=this.root;for(;!o.isEmpty();){const l=this.comparator(e,o.key);if(l===0)return i+o.left.size;l<0?o=o.left:(i+=o.left.size+1,o=o.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((i,o)=>(e(i,o),!1))}toString(){const e=[];return this.inorderTraversal((i,o)=>(e.push(`${i}:${o}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new KO(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new KO(this.root,e,this.comparator,!1)}getReverseIterator(){return new KO(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new KO(this.root,e,this.comparator,!0)}}class KO{constructor(e,i,o,l){this.isReverse=l,this.nodeStack=[];let u=1;for(;!e.isEmpty();)if(u=i?o(e.key,i):1,i&&l&&(u*=-1),u<0)e=this.isReverse?e.left:e.right;else{if(u===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const i={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return i}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Oa{constructor(e,i,o,l,u){this.key=e,this.value=i,this.color=o??Oa.RED,this.left=l??Oa.EMPTY,this.right=u??Oa.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,i,o,l,u){return new Oa(e??this.key,i??this.value,o??this.color,l??this.left,u??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,i,o){let l=this;const u=o(e,l.key);return l=u<0?l.copy(null,null,null,l.left.insert(e,i,o),null):u===0?l.copy(null,i,null,null,null):l.copy(null,null,null,null,l.right.insert(e,i,o)),l.fixUp()}removeMin(){if(this.left.isEmpty())return Oa.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,i){let o,l=this;if(i(e,l.key)<0)l.left.isEmpty()||l.left.isRed()||l.left.left.isRed()||(l=l.moveRedLeft()),l=l.copy(null,null,null,l.left.remove(e,i),null);else{if(l.left.isRed()&&(l=l.rotateRight()),l.right.isEmpty()||l.right.isRed()||l.right.left.isRed()||(l=l.moveRedRight()),i(e,l.key)===0){if(l.right.isEmpty())return Oa.EMPTY;o=l.right.min(),l=l.copy(o.key,o.value,null,null,l.right.removeMin())}l=l.copy(null,null,null,null,l.right.remove(e,i))}return l.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Oa.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Oa.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),i=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,i)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw Yn();const e=this.left.check();if(e!==this.right.check())throw Yn();return e+(this.isRed()?0:1)}}Oa.EMPTY=null,Oa.RED=!0,Oa.BLACK=!1;Oa.EMPTY=new class{constructor(){this.size=0}get key(){throw Yn()}get value(){throw Yn()}get color(){throw Yn()}get left(){throw Yn()}get right(){throw Yn()}copy(e,i,o,l,u){return this}insert(e,i,o){return new Oa(e,i)}remove(e,i){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lo{constructor(e){this.comparator=e,this.data=new ws(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((i,o)=>(e(i),!1))}forEachInRange(e,i){const o=this.data.getIteratorFrom(e[0]);for(;o.hasNext();){const l=o.getNext();if(this.comparator(l.key,e[1])>=0)return;i(l.key)}}forEachWhile(e,i){let o;for(o=i!==void 0?this.data.getIteratorFrom(i):this.data.getIterator();o.hasNext();)if(!e(o.getNext().key))return}firstAfterOrEqual(e){const i=this.data.getIteratorFrom(e);return i.hasNext()?i.getNext().key:null}getIterator(){return new SJ(this.data.getIterator())}getIteratorFrom(e){return new SJ(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let i=this;return i.size<e.size&&(i=e,e=this),e.forEach(o=>{i=i.add(o)}),i}isEqual(e){if(!(e instanceof Lo)||this.size!==e.size)return!1;const i=this.data.getIterator(),o=e.data.getIterator();for(;i.hasNext();){const l=i.getNext().key,u=o.getNext().key;if(this.comparator(l,u)!==0)return!1}return!0}toArray(){const e=[];return this.forEach(i=>{e.push(i)}),e}toString(){const e=[];return this.forEach(i=>e.push(i)),"SortedSet("+e.toString()+")"}copy(e){const i=new Lo(this.comparator);return i.data=e,i}}class SJ{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ql{constructor(e){this.fields=e,e.sort(Na.comparator)}static empty(){return new ql([])}unionWith(e){let i=new Lo(Na.comparator);for(const o of this.fields)i=i.add(o);for(const o of e)i=i.add(o);return new ql(i.toArray())}covers(e){for(const i of this.fields)if(i.isPrefixOf(e))return!0;return!1}isEqual(e){return V0(this.fields,e.fields,(i,o)=>i.isEqual(o))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ese extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Da{constructor(e){this.binaryString=e}static fromBase64String(e){const i=function(l){try{return atob(l)}catch(u){throw typeof DOMException<"u"&&u instanceof DOMException?new ese("Invalid base64 string: "+u):u}}(e);return new Da(i)}static fromUint8Array(e){const i=function(l){let u="";for(let f=0;f<l.length;++f)u+=String.fromCharCode(l[f]);return u}(e);return new Da(i)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(i){return btoa(i)}(this.binaryString)}toUint8Array(){return function(i){const o=new Uint8Array(i.length);for(let l=0;l<i.length;l++)o[l]=i.charCodeAt(l);return o}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return vr(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Da.EMPTY_BYTE_STRING=new Da("");const X4e=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function zg(n){if(_i(!!n),typeof n=="string"){let e=0;const i=X4e.exec(n);if(_i(!!i),i[1]){let l=i[1];l=(l+"000000000").substr(0,9),e=Number(l)}const o=new Date(n);return{seconds:Math.floor(o.getTime()/1e3),nanos:e}}return{seconds:no(n.seconds),nanos:no(n.nanos)}}function no(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function Gg(n){return typeof n=="string"?Da.fromBase64String(n):Da.fromUint8Array(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tse="server_timestamp",nse="__type__",rse="__previous_value__",ise="__local_write_time__";function mN(n){var e,i;return((i=(((e=n==null?void 0:n.mapValue)===null||e===void 0?void 0:e.fields)||{})[nse])===null||i===void 0?void 0:i.stringValue)===tse}function gN(n){const e=n.mapValue.fields[rse];return mN(e)?gN(e):e}function eR(n){const e=zg(n.mapValue.fields[ise].timestampValue);return new xo(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class J4e{constructor(e,i,o,l,u,f,_,E,b){this.databaseId=e,this.appId=i,this.persistenceKey=o,this.host=l,this.ssl=u,this.forceLongPolling=f,this.autoDetectLongPolling=_,this.longPollingOptions=E,this.useFetchStreams=b}}const u1="(default)";class tR{constructor(e,i){this.projectId=e,this.database=i||u1}static empty(){return new tR("","")}get isDefaultDatabase(){return this.database===u1}isEqual(e){return e instanceof tR&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sse="__type__",Q4e="__max__",qO={mapValue:{}},ose="__vector__",d1="value";function Hg(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?mN(n)?4:e3e(n)?9007199254740991:Z4e(n)?10:11:Yn()}function Rp(n,e){if(n===e)return!0;const i=Hg(n);if(i!==Hg(e))return!1;switch(i){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return eR(n).isEqual(eR(e));case 3:return function(l,u){if(typeof l.timestampValue=="string"&&typeof u.timestampValue=="string"&&l.timestampValue.length===u.timestampValue.length)return l.timestampValue===u.timestampValue;const f=zg(l.timestampValue),_=zg(u.timestampValue);return f.seconds===_.seconds&&f.nanos===_.nanos}(n,e);case 5:return n.stringValue===e.stringValue;case 6:return function(l,u){return Gg(l.bytesValue).isEqual(Gg(u.bytesValue))}(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return function(l,u){return no(l.geoPointValue.latitude)===no(u.geoPointValue.latitude)&&no(l.geoPointValue.longitude)===no(u.geoPointValue.longitude)}(n,e);case 2:return function(l,u){if("integerValue"in l&&"integerValue"in u)return no(l.integerValue)===no(u.integerValue);if("doubleValue"in l&&"doubleValue"in u){const f=no(l.doubleValue),_=no(u.doubleValue);return f===_?l1(f)===l1(_):isNaN(f)&&isNaN(_)}return!1}(n,e);case 9:return V0(n.arrayValue.values||[],e.arrayValue.values||[],Rp);case 10:case 11:return function(l,u){const f=l.mapValue.fields||{},_=u.mapValue.fields||{};if(vJ(f)!==vJ(_))return!1;for(const E in f)if(f.hasOwnProperty(E)&&(_[E]===void 0||!Rp(f[E],_[E])))return!1;return!0}(n,e);default:return Yn()}}function nR(n,e){return(n.values||[]).find(i=>Rp(i,e))!==void 0}function j0(n,e){if(n===e)return 0;const i=Hg(n),o=Hg(e);if(i!==o)return vr(i,o);switch(i){case 0:case 9007199254740991:return 0;case 1:return vr(n.booleanValue,e.booleanValue);case 2:return function(u,f){const _=no(u.integerValue||u.doubleValue),E=no(f.integerValue||f.doubleValue);return _<E?-1:_>E?1:_===E?0:isNaN(_)?isNaN(E)?0:-1:1}(n,e);case 3:return bJ(n.timestampValue,e.timestampValue);case 4:return bJ(eR(n),eR(e));case 5:return sj(n.stringValue,e.stringValue);case 6:return function(u,f){const _=Gg(u),E=Gg(f);return _.compareTo(E)}(n.bytesValue,e.bytesValue);case 7:return function(u,f){const _=u.split("/"),E=f.split("/");for(let b=0;b<_.length&&b<E.length;b++){const C=vr(_[b],E[b]);if(C!==0)return C}return vr(_.length,E.length)}(n.referenceValue,e.referenceValue);case 8:return function(u,f){const _=vr(no(u.latitude),no(f.latitude));return _!==0?_:vr(no(u.longitude),no(f.longitude))}(n.geoPointValue,e.geoPointValue);case 9:return wJ(n.arrayValue,e.arrayValue);case 10:return function(u,f){var _,E,b,C;const I=u.fields||{},P=f.fields||{},L=(_=I[d1])===null||_===void 0?void 0:_.arrayValue,M=(E=P[d1])===null||E===void 0?void 0:E.arrayValue,F=vr(((b=L==null?void 0:L.values)===null||b===void 0?void 0:b.length)||0,((C=M==null?void 0:M.values)===null||C===void 0?void 0:C.length)||0);return F!==0?F:wJ(L,M)}(n.mapValue,e.mapValue);case 11:return function(u,f){if(u===qO.mapValue&&f===qO.mapValue)return 0;if(u===qO.mapValue)return 1;if(f===qO.mapValue)return-1;const _=u.fields||{},E=Object.keys(_),b=f.fields||{},C=Object.keys(b);E.sort(),C.sort();for(let I=0;I<E.length&&I<C.length;++I){const P=sj(E[I],C[I]);if(P!==0)return P;const L=j0(_[E[I]],b[C[I]]);if(L!==0)return L}return vr(E.length,C.length)}(n.mapValue,e.mapValue);default:throw Yn()}}function bJ(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return vr(n,e);const i=zg(n),o=zg(e),l=vr(i.seconds,o.seconds);return l!==0?l:vr(i.nanos,o.nanos)}function wJ(n,e){const i=n.values||[],o=e.values||[];for(let l=0;l<i.length&&l<o.length;++l){const u=j0(i[l],o[l]);if(u)return u}return vr(i.length,o.length)}function F0(n){return oj(n)}function oj(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(i){const o=zg(i);return`time(${o.seconds},${o.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?function(i){return Gg(i).toBase64()}(n.bytesValue):"referenceValue"in n?function(i){return Rn.fromName(i).toString()}(n.referenceValue):"geoPointValue"in n?function(i){return`geo(${i.latitude},${i.longitude})`}(n.geoPointValue):"arrayValue"in n?function(i){let o="[",l=!0;for(const u of i.values||[])l?l=!1:o+=",",o+=oj(u);return o+"]"}(n.arrayValue):"mapValue"in n?function(i){const o=Object.keys(i.fields||{}).sort();let l="{",u=!0;for(const f of o)u?u=!1:l+=",",l+=`${f}:${oj(i.fields[f])}`;return l+"}"}(n.mapValue):Yn()}function Ok(n){switch(Hg(n)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=gN(n);return e?16+Ok(e):16;case 5:return 2*n.stringValue.length;case 6:return Gg(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 9:return function(o){return(o.values||[]).reduce((l,u)=>l+Ok(u),0)}(n.arrayValue);case 10:case 11:return function(o){let l=0;return e_(o.fields,(u,f)=>{l+=u.length+Ok(f)}),l}(n.mapValue);default:throw Yn()}}function h1(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function aj(n){return!!n&&"integerValue"in n}function k4(n){return!!n&&"arrayValue"in n}function TJ(n){return!!n&&"nullValue"in n}function CJ(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function kk(n){return!!n&&"mapValue"in n}function Z4e(n){var e,i;return((i=(((e=n==null?void 0:n.mapValue)===null||e===void 0?void 0:e.fields)||{})[sse])===null||i===void 0?void 0:i.stringValue)===ose}function wC(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){const e={mapValue:{fields:{}}};return e_(n.mapValue.fields,(i,o)=>e.mapValue.fields[i]=wC(o)),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let i=0;i<(n.arrayValue.values||[]).length;++i)e.arrayValue.values[i]=wC(n.arrayValue.values[i]);return e}return Object.assign({},n)}function e3e(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue===Q4e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ml{constructor(e){this.value=e}static empty(){return new ml({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let i=this.value;for(let o=0;o<e.length-1;++o)if(i=(i.mapValue.fields||{})[e.get(o)],!kk(i))return null;return i=(i.mapValue.fields||{})[e.lastSegment()],i||null}}set(e,i){this.getFieldsMap(e.popLast())[e.lastSegment()]=wC(i)}setAll(e){let i=Na.emptyPath(),o={},l=[];e.forEach((f,_)=>{if(!i.isImmediateParentOf(_)){const E=this.getFieldsMap(i);this.applyChanges(E,o,l),o={},l=[],i=_.popLast()}f?o[_.lastSegment()]=wC(f):l.push(_.lastSegment())});const u=this.getFieldsMap(i);this.applyChanges(u,o,l)}delete(e){const i=this.field(e.popLast());kk(i)&&i.mapValue.fields&&delete i.mapValue.fields[e.lastSegment()]}isEqual(e){return Rp(this.value,e.value)}getFieldsMap(e){let i=this.value;i.mapValue.fields||(i.mapValue={fields:{}});for(let o=0;o<e.length;++o){let l=i.mapValue.fields[e.get(o)];kk(l)&&l.mapValue.fields||(l={mapValue:{fields:{}}},i.mapValue.fields[e.get(o)]=l),i=l}return i.mapValue.fields}applyChanges(e,i,o){e_(i,(l,u)=>e[l]=u);for(const l of o)delete e[l]}clone(){return new ml(wC(this.value))}}function ase(n){const e=[];return e_(n.fields,(i,o)=>{const l=new Na([i]);if(kk(o)){const u=ase(o.mapValue).fields;if(u.length===0)e.push(l);else for(const f of u)e.push(l.child(f))}else e.push(l)}),new ql(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oc{constructor(e,i,o,l,u,f,_){this.key=e,this.documentType=i,this.version=o,this.readTime=l,this.createTime=u,this.data=f,this.documentState=_}static newInvalidDocument(e){return new oc(e,0,Zn.min(),Zn.min(),Zn.min(),ml.empty(),0)}static newFoundDocument(e,i,o,l){return new oc(e,1,i,Zn.min(),o,l,0)}static newNoDocument(e,i){return new oc(e,2,i,Zn.min(),Zn.min(),ml.empty(),0)}static newUnknownDocument(e,i){return new oc(e,3,i,Zn.min(),Zn.min(),ml.empty(),2)}convertToFoundDocument(e,i){return!this.createTime.isEqual(Zn.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=i,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=ml.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=ml.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=Zn.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof oc&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new oc(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class B0{constructor(e,i){this.position=e,this.inclusive=i}}function RJ(n,e,i){let o=0;for(let l=0;l<n.position.length;l++){const u=e[l],f=n.position[l];if(u.field.isKeyField()?o=Rn.comparator(Rn.fromName(f.referenceValue),i.key):o=j0(f,i.data.field(u.field)),u.dir==="desc"&&(o*=-1),o!==0)break}return o}function IJ(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let i=0;i<n.position.length;i++)if(!Rp(n.position[i],e.position[i]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rR{constructor(e,i="asc"){this.field=e,this.dir=i}}function t3e(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cse{}class go extends cse{constructor(e,i,o){super(),this.field=e,this.op=i,this.value=o}static create(e,i,o){return e.isKeyField()?i==="in"||i==="not-in"?this.createKeyFieldInFilter(e,i,o):new r3e(e,i,o):i==="array-contains"?new o3e(e,o):i==="in"?new a3e(e,o):i==="not-in"?new c3e(e,o):i==="array-contains-any"?new l3e(e,o):new go(e,i,o)}static createKeyFieldInFilter(e,i,o){return i==="in"?new i3e(e,o):new s3e(e,o)}matches(e){const i=e.data.field(this.field);return this.op==="!="?i!==null&&this.matchesComparison(j0(i,this.value)):i!==null&&Hg(this.value)===Hg(i)&&this.matchesComparison(j0(i,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return Yn()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class Qd extends cse{constructor(e,i){super(),this.filters=e,this.op=i,this.ce=null}static create(e,i){return new Qd(e,i)}matches(e){return lse(this)?this.filters.find(i=>!i.matches(e))===void 0:this.filters.find(i=>i.matches(e))!==void 0}getFlattenedFilters(){return this.ce!==null||(this.ce=this.filters.reduce((e,i)=>e.concat(i.getFlattenedFilters()),[])),this.ce}getFilters(){return Object.assign([],this.filters)}}function lse(n){return n.op==="and"}function use(n){return n3e(n)&&lse(n)}function n3e(n){for(const e of n.filters)if(e instanceof Qd)return!1;return!0}function cj(n){if(n instanceof go)return n.field.canonicalString()+n.op.toString()+F0(n.value);if(use(n))return n.filters.map(e=>cj(e)).join(",");{const e=n.filters.map(i=>cj(i)).join(",");return`${n.op}(${e})`}}function dse(n,e){return n instanceof go?function(o,l){return l instanceof go&&o.op===l.op&&o.field.isEqual(l.field)&&Rp(o.value,l.value)}(n,e):n instanceof Qd?function(o,l){return l instanceof Qd&&o.op===l.op&&o.filters.length===l.filters.length?o.filters.reduce((u,f,_)=>u&&dse(f,l.filters[_]),!0):!1}(n,e):void Yn()}function hse(n){return n instanceof go?function(i){return`${i.field.canonicalString()} ${i.op} ${F0(i.value)}`}(n):n instanceof Qd?function(i){return i.op.toString()+" {"+i.getFilters().map(hse).join(" ,")+"}"}(n):"Filter"}class r3e extends go{constructor(e,i,o){super(e,i,o),this.key=Rn.fromName(o.referenceValue)}matches(e){const i=Rn.comparator(e.key,this.key);return this.matchesComparison(i)}}class i3e extends go{constructor(e,i){super(e,"in",i),this.keys=pse("in",i)}matches(e){return this.keys.some(i=>i.isEqual(e.key))}}class s3e extends go{constructor(e,i){super(e,"not-in",i),this.keys=pse("not-in",i)}matches(e){return!this.keys.some(i=>i.isEqual(e.key))}}function pse(n,e){var i;return(((i=e.arrayValue)===null||i===void 0?void 0:i.values)||[]).map(o=>Rn.fromName(o.referenceValue))}class o3e extends go{constructor(e,i){super(e,"array-contains",i)}matches(e){const i=e.data.field(this.field);return k4(i)&&nR(i.arrayValue,this.value)}}class a3e extends go{constructor(e,i){super(e,"in",i)}matches(e){const i=e.data.field(this.field);return i!==null&&nR(this.value.arrayValue,i)}}class c3e extends go{constructor(e,i){super(e,"not-in",i)}matches(e){if(nR(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const i=e.data.field(this.field);return i!==null&&!nR(this.value.arrayValue,i)}}class l3e extends go{constructor(e,i){super(e,"array-contains-any",i)}matches(e){const i=e.data.field(this.field);return!(!k4(i)||!i.arrayValue.values)&&i.arrayValue.values.some(o=>nR(this.value.arrayValue,o))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class u3e{constructor(e,i=null,o=[],l=[],u=null,f=null,_=null){this.path=e,this.collectionGroup=i,this.orderBy=o,this.filters=l,this.limit=u,this.startAt=f,this.endAt=_,this.le=null}}function AJ(n,e=null,i=[],o=[],l=null,u=null,f=null){return new u3e(n,e,i,o,l,u,f)}function N4(n){const e=rr(n);if(e.le===null){let i=e.path.canonicalString();e.collectionGroup!==null&&(i+="|cg:"+e.collectionGroup),i+="|f:",i+=e.filters.map(o=>cj(o)).join(","),i+="|ob:",i+=e.orderBy.map(o=>function(u){return u.field.canonicalString()+u.dir}(o)).join(","),fN(e.limit)||(i+="|l:",i+=e.limit),e.startAt&&(i+="|lb:",i+=e.startAt.inclusive?"b:":"a:",i+=e.startAt.position.map(o=>F0(o)).join(",")),e.endAt&&(i+="|ub:",i+=e.endAt.inclusive?"a:":"b:",i+=e.endAt.position.map(o=>F0(o)).join(",")),e.le=i}return e.le}function D4(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let i=0;i<n.orderBy.length;i++)if(!t3e(n.orderBy[i],e.orderBy[i]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let i=0;i<n.filters.length;i++)if(!dse(n.filters[i],e.filters[i]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!IJ(n.startAt,e.startAt)&&IJ(n.endAt,e.endAt)}function lj(n){return Rn.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dE{constructor(e,i=null,o=[],l=[],u=null,f="F",_=null,E=null){this.path=e,this.collectionGroup=i,this.explicitOrderBy=o,this.filters=l,this.limit=u,this.limitType=f,this.startAt=_,this.endAt=E,this.he=null,this.Pe=null,this.Te=null,this.startAt,this.endAt}}function d3e(n,e,i,o,l,u,f,_){return new dE(n,e,i,o,l,u,f,_)}function _N(n){return new dE(n)}function PJ(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function x4(n){return n.collectionGroup!==null}function v0(n){const e=rr(n);if(e.he===null){e.he=[];const i=new Set;for(const u of e.explicitOrderBy)e.he.push(u),i.add(u.field.canonicalString());const o=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(f){let _=new Lo(Na.comparator);return f.filters.forEach(E=>{E.getFlattenedFilters().forEach(b=>{b.isInequality()&&(_=_.add(b.field))})}),_})(e).forEach(u=>{i.has(u.canonicalString())||u.isKeyField()||e.he.push(new rR(u,o))}),i.has(Na.keyField().canonicalString())||e.he.push(new rR(Na.keyField(),o))}return e.he}function bp(n){const e=rr(n);return e.Pe||(e.Pe=h3e(e,v0(n))),e.Pe}function h3e(n,e){if(n.limitType==="F")return AJ(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map(l=>{const u=l.dir==="desc"?"asc":"desc";return new rR(l.field,u)});const i=n.endAt?new B0(n.endAt.position,n.endAt.inclusive):null,o=n.startAt?new B0(n.startAt.position,n.startAt.inclusive):null;return AJ(n.path,n.collectionGroup,e,n.filters,n.limit,i,o)}}function uj(n,e){const i=n.filters.concat([e]);return new dE(n.path,n.collectionGroup,n.explicitOrderBy.slice(),i,n.limit,n.limitType,n.startAt,n.endAt)}function p1(n,e,i){return new dE(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,i,n.startAt,n.endAt)}function yN(n,e){return D4(bp(n),bp(e))&&n.limitType===e.limitType}function fse(n){return`${N4(bp(n))}|lt:${n.limitType}`}function BS(n){return`Query(target=${function(i){let o=i.path.canonicalString();return i.collectionGroup!==null&&(o+=" collectionGroup="+i.collectionGroup),i.filters.length>0&&(o+=`, filters: [${i.filters.map(l=>hse(l)).join(", ")}]`),fN(i.limit)||(o+=", limit: "+i.limit),i.orderBy.length>0&&(o+=`, orderBy: [${i.orderBy.map(l=>function(f){return`${f.field.canonicalString()} (${f.dir})`}(l)).join(", ")}]`),i.startAt&&(o+=", startAt: ",o+=i.startAt.inclusive?"b:":"a:",o+=i.startAt.position.map(l=>F0(l)).join(",")),i.endAt&&(o+=", endAt: ",o+=i.endAt.inclusive?"a:":"b:",o+=i.endAt.position.map(l=>F0(l)).join(",")),`Target(${o})`}(bp(n))}; limitType=${n.limitType})`}function EN(n,e){return e.isFoundDocument()&&function(o,l){const u=l.key.path;return o.collectionGroup!==null?l.key.hasCollectionId(o.collectionGroup)&&o.path.isPrefixOf(u):Rn.isDocumentKey(o.path)?o.path.isEqual(u):o.path.isImmediateParentOf(u)}(n,e)&&function(o,l){for(const u of v0(o))if(!u.field.isKeyField()&&l.data.field(u.field)===null)return!1;return!0}(n,e)&&function(o,l){for(const u of o.filters)if(!u.matches(l))return!1;return!0}(n,e)&&function(o,l){return!(o.startAt&&!function(f,_,E){const b=RJ(f,_,E);return f.inclusive?b<=0:b<0}(o.startAt,v0(o),l)||o.endAt&&!function(f,_,E){const b=RJ(f,_,E);return f.inclusive?b>=0:b>0}(o.endAt,v0(o),l))}(n,e)}function p3e(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function mse(n){return(e,i)=>{let o=!1;for(const l of v0(n)){const u=f3e(l,e,i);if(u!==0)return u;o=o||l.field.isKeyField()}return 0}}function f3e(n,e,i){const o=n.field.isKeyField()?Rn.comparator(e.key,i.key):function(u,f,_){const E=f.data.field(u),b=_.data.field(u);return E!==null&&b!==null?j0(E,b):Yn()}(n.field,e,i);switch(n.dir){case"asc":return o;case"desc":return-1*o;default:return Yn()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hE{constructor(e,i){this.mapKeyFn=e,this.equalsFn=i,this.inner={},this.innerSize=0}get(e){const i=this.mapKeyFn(e),o=this.inner[i];if(o!==void 0){for(const[l,u]of o)if(this.equalsFn(l,e))return u}}has(e){return this.get(e)!==void 0}set(e,i){const o=this.mapKeyFn(e),l=this.inner[o];if(l===void 0)return this.inner[o]=[[e,i]],void this.innerSize++;for(let u=0;u<l.length;u++)if(this.equalsFn(l[u][0],e))return void(l[u]=[e,i]);l.push([e,i]),this.innerSize++}delete(e){const i=this.mapKeyFn(e),o=this.inner[i];if(o===void 0)return!1;for(let l=0;l<o.length;l++)if(this.equalsFn(o[l][0],e))return o.length===1?delete this.inner[i]:o.splice(l,1),this.innerSize--,!0;return!1}forEach(e){e_(this.inner,(i,o)=>{for(const[l,u]of o)e(l,u)})}isEmpty(){return Zie(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const m3e=new ws(Rn.comparator);function im(){return m3e}const gse=new ws(Rn.comparator);function sC(...n){let e=gse;for(const i of n)e=e.insert(i.key,i);return e}function _se(n){let e=gse;return n.forEach((i,o)=>e=e.insert(i,o.overlayedDocument)),e}function xy(){return TC()}function yse(){return TC()}function TC(){return new hE(n=>n.toString(),(n,e)=>n.isEqual(e))}const g3e=new ws(Rn.comparator),_3e=new Lo(Rn.comparator);function Dr(...n){let e=_3e;for(const i of n)e=e.add(i);return e}const y3e=new Lo(vr);function E3e(){return y3e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function L4(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:l1(e)?"-0":e}}function Ese(n){return{integerValue:""+n}}function v3e(n,e){return K4e(e)?Ese(e):L4(n,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vN{constructor(){this._=void 0}}function S3e(n,e,i){return n instanceof f1?function(l,u){const f={fields:{[nse]:{stringValue:tse},[ise]:{timestampValue:{seconds:l.seconds,nanos:l.nanoseconds}}}};return u&&mN(u)&&(u=gN(u)),u&&(f.fields[rse]=u),{mapValue:f}}(i,e):n instanceof W0?Sse(n,e):n instanceof z0?bse(n,e):function(l,u){const f=vse(l,u),_=OJ(f)+OJ(l.Ie);return aj(f)&&aj(l.Ie)?Ese(_):L4(l.serializer,_)}(n,e)}function b3e(n,e,i){return n instanceof W0?Sse(n,e):n instanceof z0?bse(n,e):i}function vse(n,e){return n instanceof m1?function(o){return aj(o)||function(u){return!!u&&"doubleValue"in u}(o)}(e)?e:{integerValue:0}:null}class f1 extends vN{}class W0 extends vN{constructor(e){super(),this.elements=e}}function Sse(n,e){const i=wse(e);for(const o of n.elements)i.some(l=>Rp(l,o))||i.push(o);return{arrayValue:{values:i}}}class z0 extends vN{constructor(e){super(),this.elements=e}}function bse(n,e){let i=wse(e);for(const o of n.elements)i=i.filter(l=>!Rp(l,o));return{arrayValue:{values:i}}}class m1 extends vN{constructor(e,i){super(),this.serializer=e,this.Ie=i}}function OJ(n){return no(n.integerValue||n.doubleValue)}function wse(n){return k4(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tse{constructor(e,i){this.field=e,this.transform=i}}function w3e(n,e){return n.field.isEqual(e.field)&&function(o,l){return o instanceof W0&&l instanceof W0||o instanceof z0&&l instanceof z0?V0(o.elements,l.elements,Rp):o instanceof m1&&l instanceof m1?Rp(o.Ie,l.Ie):o instanceof f1&&l instanceof f1}(n.transform,e.transform)}class T3e{constructor(e,i){this.version=e,this.transformResults=i}}class Yu{constructor(e,i){this.updateTime=e,this.exists=i}static none(){return new Yu}static exists(e){return new Yu(void 0,e)}static updateTime(e){return new Yu(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Nk(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}class SN{}function Cse(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new M4(n.key,Yu.none()):new kR(n.key,n.data,Yu.none());{const i=n.data,o=ml.empty();let l=new Lo(Na.comparator);for(let u of e.fields)if(!l.has(u)){let f=i.field(u);f===null&&u.length>1&&(u=u.popLast(),f=i.field(u)),f===null?o.delete(u):o.set(u,f),l=l.add(u)}return new t_(n.key,o,new ql(l.toArray()),Yu.none())}}function C3e(n,e,i){n instanceof kR?function(l,u,f){const _=l.value.clone(),E=NJ(l.fieldTransforms,u,f.transformResults);_.setAll(E),u.convertToFoundDocument(f.version,_).setHasCommittedMutations()}(n,e,i):n instanceof t_?function(l,u,f){if(!Nk(l.precondition,u))return void u.convertToUnknownDocument(f.version);const _=NJ(l.fieldTransforms,u,f.transformResults),E=u.data;E.setAll(Rse(l)),E.setAll(_),u.convertToFoundDocument(f.version,E).setHasCommittedMutations()}(n,e,i):function(l,u,f){u.convertToNoDocument(f.version).setHasCommittedMutations()}(0,e,i)}function CC(n,e,i,o){return n instanceof kR?function(u,f,_,E){if(!Nk(u.precondition,f))return _;const b=u.value.clone(),C=DJ(u.fieldTransforms,E,f);return b.setAll(C),f.convertToFoundDocument(f.version,b).setHasLocalMutations(),null}(n,e,i,o):n instanceof t_?function(u,f,_,E){if(!Nk(u.precondition,f))return _;const b=DJ(u.fieldTransforms,E,f),C=f.data;return C.setAll(Rse(u)),C.setAll(b),f.convertToFoundDocument(f.version,C).setHasLocalMutations(),_===null?null:_.unionWith(u.fieldMask.fields).unionWith(u.fieldTransforms.map(I=>I.field))}(n,e,i,o):function(u,f,_){return Nk(u.precondition,f)?(f.convertToNoDocument(f.version).setHasLocalMutations(),null):_}(n,e,i)}function R3e(n,e){let i=null;for(const o of n.fieldTransforms){const l=e.data.field(o.field),u=vse(o.transform,l||null);u!=null&&(i===null&&(i=ml.empty()),i.set(o.field,u))}return i||null}function kJ(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!function(o,l){return o===void 0&&l===void 0||!(!o||!l)&&V0(o,l,(u,f)=>w3e(u,f))}(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}class kR extends SN{constructor(e,i,o,l=[]){super(),this.key=e,this.value=i,this.precondition=o,this.fieldTransforms=l,this.type=0}getFieldMask(){return null}}class t_ extends SN{constructor(e,i,o,l,u=[]){super(),this.key=e,this.data=i,this.fieldMask=o,this.precondition=l,this.fieldTransforms=u,this.type=1}getFieldMask(){return this.fieldMask}}function Rse(n){const e=new Map;return n.fieldMask.fields.forEach(i=>{if(!i.isEmpty()){const o=n.data.field(i);e.set(i,o)}}),e}function NJ(n,e,i){const o=new Map;_i(n.length===i.length);for(let l=0;l<i.length;l++){const u=n[l],f=u.transform,_=e.data.field(u.field);o.set(u.field,b3e(f,_,i[l]))}return o}function DJ(n,e,i){const o=new Map;for(const l of n){const u=l.transform,f=i.data.field(l.field);o.set(l.field,S3e(u,f,e))}return o}class M4 extends SN{constructor(e,i){super(),this.key=e,this.precondition=i,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class I3e extends SN{constructor(e,i){super(),this.key=e,this.precondition=i,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class A3e{constructor(e,i,o,l){this.batchId=e,this.localWriteTime=i,this.baseMutations=o,this.mutations=l}applyToRemoteDocument(e,i){const o=i.mutationResults;for(let l=0;l<this.mutations.length;l++){const u=this.mutations[l];u.key.isEqual(e.key)&&C3e(u,e,o[l])}}applyToLocalView(e,i){for(const o of this.baseMutations)o.key.isEqual(e.key)&&(i=CC(o,e,i,this.localWriteTime));for(const o of this.mutations)o.key.isEqual(e.key)&&(i=CC(o,e,i,this.localWriteTime));return i}applyToLocalDocumentSet(e,i){const o=yse();return this.mutations.forEach(l=>{const u=e.get(l.key),f=u.overlayedDocument;let _=this.applyToLocalView(f,u.mutatedFields);_=i.has(l.key)?null:_;const E=Cse(f,_);E!==null&&o.set(l.key,E),f.isValidDocument()||f.convertToNoDocument(Zn.min())}),o}keys(){return this.mutations.reduce((e,i)=>e.add(i.key),Dr())}isEqual(e){return this.batchId===e.batchId&&V0(this.mutations,e.mutations,(i,o)=>kJ(i,o))&&V0(this.baseMutations,e.baseMutations,(i,o)=>kJ(i,o))}}class U4{constructor(e,i,o,l){this.batch=e,this.commitVersion=i,this.mutationResults=o,this.docVersions=l}static from(e,i,o){_i(e.mutations.length===o.length);let l=function(){return g3e}();const u=e.mutations;for(let f=0;f<u.length;f++)l=l.insert(u[f].key,o[f].version);return new U4(e,i,o,l)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class P3e{constructor(e,i){this.largestBatchId=e,this.mutation=i}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class O3e{constructor(e,i){this.count=e,this.unchangedNames=i}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var ho,zr;function k3e(n){switch(n){case Ct.OK:return Yn();case Ct.CANCELLED:case Ct.UNKNOWN:case Ct.DEADLINE_EXCEEDED:case Ct.RESOURCE_EXHAUSTED:case Ct.INTERNAL:case Ct.UNAVAILABLE:case Ct.UNAUTHENTICATED:return!1;case Ct.INVALID_ARGUMENT:case Ct.NOT_FOUND:case Ct.ALREADY_EXISTS:case Ct.PERMISSION_DENIED:case Ct.FAILED_PRECONDITION:case Ct.ABORTED:case Ct.OUT_OF_RANGE:case Ct.UNIMPLEMENTED:case Ct.DATA_LOSS:return!0;default:return Yn()}}function Ise(n){if(n===void 0)return rm("GRPC error has no .code"),Ct.UNKNOWN;switch(n){case ho.OK:return Ct.OK;case ho.CANCELLED:return Ct.CANCELLED;case ho.UNKNOWN:return Ct.UNKNOWN;case ho.DEADLINE_EXCEEDED:return Ct.DEADLINE_EXCEEDED;case ho.RESOURCE_EXHAUSTED:return Ct.RESOURCE_EXHAUSTED;case ho.INTERNAL:return Ct.INTERNAL;case ho.UNAVAILABLE:return Ct.UNAVAILABLE;case ho.UNAUTHENTICATED:return Ct.UNAUTHENTICATED;case ho.INVALID_ARGUMENT:return Ct.INVALID_ARGUMENT;case ho.NOT_FOUND:return Ct.NOT_FOUND;case ho.ALREADY_EXISTS:return Ct.ALREADY_EXISTS;case ho.PERMISSION_DENIED:return Ct.PERMISSION_DENIED;case ho.FAILED_PRECONDITION:return Ct.FAILED_PRECONDITION;case ho.ABORTED:return Ct.ABORTED;case ho.OUT_OF_RANGE:return Ct.OUT_OF_RANGE;case ho.UNIMPLEMENTED:return Ct.UNIMPLEMENTED;case ho.DATA_LOSS:return Ct.DATA_LOSS;default:return Yn()}}(zr=ho||(ho={}))[zr.OK=0]="OK",zr[zr.CANCELLED=1]="CANCELLED",zr[zr.UNKNOWN=2]="UNKNOWN",zr[zr.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",zr[zr.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",zr[zr.NOT_FOUND=5]="NOT_FOUND",zr[zr.ALREADY_EXISTS=6]="ALREADY_EXISTS",zr[zr.PERMISSION_DENIED=7]="PERMISSION_DENIED",zr[zr.UNAUTHENTICATED=16]="UNAUTHENTICATED",zr[zr.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",zr[zr.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",zr[zr.ABORTED=10]="ABORTED",zr[zr.OUT_OF_RANGE=11]="OUT_OF_RANGE",zr[zr.UNIMPLEMENTED=12]="UNIMPLEMENTED",zr[zr.INTERNAL=13]="INTERNAL",zr[zr.UNAVAILABLE=14]="UNAVAILABLE",zr[zr.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const N3e=new Mg([4294967295,4294967295],0);function xJ(n){const e=Xie().encode(n),i=new zie;return i.update(e),new Uint8Array(i.digest())}function LJ(n){const e=new DataView(n.buffer),i=e.getUint32(0,!0),o=e.getUint32(4,!0),l=e.getUint32(8,!0),u=e.getUint32(12,!0);return[new Mg([i,o],0),new Mg([l,u],0)]}class V4{constructor(e,i,o){if(this.bitmap=e,this.padding=i,this.hashCount=o,i<0||i>=8)throw new oC(`Invalid padding: ${i}`);if(o<0)throw new oC(`Invalid hash count: ${o}`);if(e.length>0&&this.hashCount===0)throw new oC(`Invalid hash count: ${o}`);if(e.length===0&&i!==0)throw new oC(`Invalid padding when bitmap length is 0: ${i}`);this.Ee=8*e.length-i,this.de=Mg.fromNumber(this.Ee)}Ae(e,i,o){let l=e.add(i.multiply(Mg.fromNumber(o)));return l.compare(N3e)===1&&(l=new Mg([l.getBits(0),l.getBits(1)],0)),l.modulo(this.de).toNumber()}Re(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.Ee===0)return!1;const i=xJ(e),[o,l]=LJ(i);for(let u=0;u<this.hashCount;u++){const f=this.Ae(o,l,u);if(!this.Re(f))return!1}return!0}static create(e,i,o){const l=e%8==0?0:8-e%8,u=new Uint8Array(Math.ceil(e/8)),f=new V4(u,l,i);return o.forEach(_=>f.insert(_)),f}insert(e){if(this.Ee===0)return;const i=xJ(e),[o,l]=LJ(i);for(let u=0;u<this.hashCount;u++){const f=this.Ae(o,l,u);this.Ve(f)}}Ve(e){const i=Math.floor(e/8),o=e%8;this.bitmap[i]|=1<<o}}class oC extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bN{constructor(e,i,o,l,u){this.snapshotVersion=e,this.targetChanges=i,this.targetMismatches=o,this.documentUpdates=l,this.resolvedLimboDocuments=u}static createSynthesizedRemoteEventForCurrentChange(e,i,o){const l=new Map;return l.set(e,NR.createSynthesizedTargetChangeForCurrentChange(e,i,o)),new bN(Zn.min(),l,new ws(vr),im(),Dr())}}class NR{constructor(e,i,o,l,u){this.resumeToken=e,this.current=i,this.addedDocuments=o,this.modifiedDocuments=l,this.removedDocuments=u}static createSynthesizedTargetChangeForCurrentChange(e,i,o){return new NR(o,i,Dr(),Dr(),Dr())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dk{constructor(e,i,o,l){this.me=e,this.removedTargetIds=i,this.key=o,this.fe=l}}class Ase{constructor(e,i){this.targetId=e,this.ge=i}}class Pse{constructor(e,i,o=Da.EMPTY_BYTE_STRING,l=null){this.state=e,this.targetIds=i,this.resumeToken=o,this.cause=l}}class MJ{constructor(){this.pe=0,this.ye=UJ(),this.we=Da.EMPTY_BYTE_STRING,this.Se=!1,this.be=!0}get current(){return this.Se}get resumeToken(){return this.we}get De(){return this.pe!==0}get ve(){return this.be}Ce(e){e.approximateByteSize()>0&&(this.be=!0,this.we=e)}Fe(){let e=Dr(),i=Dr(),o=Dr();return this.ye.forEach((l,u)=>{switch(u){case 0:e=e.add(l);break;case 2:i=i.add(l);break;case 1:o=o.add(l);break;default:Yn()}}),new NR(this.we,this.Se,e,i,o)}Me(){this.be=!1,this.ye=UJ()}xe(e,i){this.be=!0,this.ye=this.ye.insert(e,i)}Oe(e){this.be=!0,this.ye=this.ye.remove(e)}Ne(){this.pe+=1}Be(){this.pe-=1,_i(this.pe>=0)}Le(){this.be=!0,this.Se=!0}}class D3e{constructor(e){this.ke=e,this.qe=new Map,this.Qe=im(),this.$e=YO(),this.Ue=YO(),this.Ke=new ws(vr)}We(e){for(const i of e.me)e.fe&&e.fe.isFoundDocument()?this.Ge(i,e.fe):this.ze(i,e.key,e.fe);for(const i of e.removedTargetIds)this.ze(i,e.key,e.fe)}je(e){this.forEachTarget(e,i=>{const o=this.He(i);switch(e.state){case 0:this.Je(i)&&o.Ce(e.resumeToken);break;case 1:o.Be(),o.De||o.Me(),o.Ce(e.resumeToken);break;case 2:o.Be(),o.De||this.removeTarget(i);break;case 3:this.Je(i)&&(o.Le(),o.Ce(e.resumeToken));break;case 4:this.Je(i)&&(this.Ye(i),o.Ce(e.resumeToken));break;default:Yn()}})}forEachTarget(e,i){e.targetIds.length>0?e.targetIds.forEach(i):this.qe.forEach((o,l)=>{this.Je(l)&&i(l)})}Ze(e){const i=e.targetId,o=e.ge.count,l=this.Xe(i);if(l){const u=l.target;if(lj(u))if(o===0){const f=new Rn(u.path);this.ze(i,f,oc.newNoDocument(f,Zn.min()))}else _i(o===1);else{const f=this.et(i);if(f!==o){const _=this.tt(e),E=_?this.nt(_,e,f):1;if(E!==0){this.Ye(i);const b=E===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ke=this.Ke.insert(i,b)}}}}}tt(e){const i=e.ge.unchangedNames;if(!i||!i.bits)return null;const{bits:{bitmap:o="",padding:l=0},hashCount:u=0}=i;let f,_;try{f=Gg(o).toUint8Array()}catch(E){if(E instanceof ese)return U0("Decoding the base64 bloom filter in existence filter failed ("+E.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw E}try{_=new V4(f,l,u)}catch(E){return U0(E instanceof oC?"BloomFilter error: ":"Applying bloom filter failed: ",E),null}return _.Ee===0?null:_}nt(e,i,o){return i.ge.count===o-this.st(e,i.targetId)?0:2}st(e,i){const o=this.ke.getRemoteKeysForTarget(i);let l=0;return o.forEach(u=>{const f=this.ke.it(),_=`projects/${f.projectId}/databases/${f.database}/documents/${u.path.canonicalString()}`;e.mightContain(_)||(this.ze(i,u,null),l++)}),l}ot(e){const i=new Map;this.qe.forEach((u,f)=>{const _=this.Xe(f);if(_){if(u.current&&lj(_.target)){const E=new Rn(_.target.path);this._t(E).has(f)||this.ut(f,E)||this.ze(f,E,oc.newNoDocument(E,e))}u.ve&&(i.set(f,u.Fe()),u.Me())}});let o=Dr();this.Ue.forEach((u,f)=>{let _=!0;f.forEachWhile(E=>{const b=this.Xe(E);return!b||b.purpose==="TargetPurposeLimboResolution"||(_=!1,!1)}),_&&(o=o.add(u))}),this.Qe.forEach((u,f)=>f.setReadTime(e));const l=new bN(e,i,this.Ke,this.Qe,o);return this.Qe=im(),this.$e=YO(),this.Ue=YO(),this.Ke=new ws(vr),l}Ge(e,i){if(!this.Je(e))return;const o=this.ut(e,i.key)?2:0;this.He(e).xe(i.key,o),this.Qe=this.Qe.insert(i.key,i),this.$e=this.$e.insert(i.key,this._t(i.key).add(e)),this.Ue=this.Ue.insert(i.key,this.ct(i.key).add(e))}ze(e,i,o){if(!this.Je(e))return;const l=this.He(e);this.ut(e,i)?l.xe(i,1):l.Oe(i),this.Ue=this.Ue.insert(i,this.ct(i).delete(e)),this.Ue=this.Ue.insert(i,this.ct(i).add(e)),o&&(this.Qe=this.Qe.insert(i,o))}removeTarget(e){this.qe.delete(e)}et(e){const i=this.He(e).Fe();return this.ke.getRemoteKeysForTarget(e).size+i.addedDocuments.size-i.removedDocuments.size}Ne(e){this.He(e).Ne()}He(e){let i=this.qe.get(e);return i||(i=new MJ,this.qe.set(e,i)),i}ct(e){let i=this.Ue.get(e);return i||(i=new Lo(vr),this.Ue=this.Ue.insert(e,i)),i}_t(e){let i=this.$e.get(e);return i||(i=new Lo(vr),this.$e=this.$e.insert(e,i)),i}Je(e){const i=this.Xe(e)!==null;return i||an("WatchChangeAggregator","Detected inactive target",e),i}Xe(e){const i=this.qe.get(e);return i&&i.De?null:this.ke.lt(e)}Ye(e){this.qe.set(e,new MJ),this.ke.getRemoteKeysForTarget(e).forEach(i=>{this.ze(e,i,null)})}ut(e,i){return this.ke.getRemoteKeysForTarget(e).has(i)}}function YO(){return new ws(Rn.comparator)}function UJ(){return new ws(Rn.comparator)}const x3e={asc:"ASCENDING",desc:"DESCENDING"},L3e={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},M3e={and:"AND",or:"OR"};class U3e{constructor(e,i){this.databaseId=e,this.useProto3Json=i}}function dj(n,e){return n.useProto3Json||fN(e)?e:{value:e}}function g1(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function Ose(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function V3e(n,e){return g1(n,e.toTimestamp())}function wp(n){return _i(!!n),Zn.fromTimestamp(function(i){const o=zg(i);return new xo(o.seconds,o.nanos)}(n))}function j4(n,e){return hj(n,e).canonicalString()}function hj(n,e){const i=function(l){return new Ki(["projects",l.projectId,"databases",l.database])}(n).child("documents");return e===void 0?i:i.child(e)}function kse(n){const e=Ki.fromString(n);return _i(Mse(e)),e}function pj(n,e){return j4(n.databaseId,e.path)}function xU(n,e){const i=kse(e);if(i.get(1)!==n.databaseId.projectId)throw new Qt(Ct.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+i.get(1)+" vs "+n.databaseId.projectId);if(i.get(3)!==n.databaseId.database)throw new Qt(Ct.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+i.get(3)+" vs "+n.databaseId.database);return new Rn(Dse(i))}function Nse(n,e){return j4(n.databaseId,e)}function j3e(n){const e=kse(n);return e.length===4?Ki.emptyPath():Dse(e)}function fj(n){return new Ki(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function Dse(n){return _i(n.length>4&&n.get(4)==="documents"),n.popFirst(5)}function VJ(n,e,i){return{name:pj(n,e),fields:i.value.mapValue.fields}}function F3e(n,e){let i;if("targetChange"in e){e.targetChange;const o=function(b){return b==="NO_CHANGE"?0:b==="ADD"?1:b==="REMOVE"?2:b==="CURRENT"?3:b==="RESET"?4:Yn()}(e.targetChange.targetChangeType||"NO_CHANGE"),l=e.targetChange.targetIds||[],u=function(b,C){return b.useProto3Json?(_i(C===void 0||typeof C=="string"),Da.fromBase64String(C||"")):(_i(C===void 0||C instanceof Buffer||C instanceof Uint8Array),Da.fromUint8Array(C||new Uint8Array))}(n,e.targetChange.resumeToken),f=e.targetChange.cause,_=f&&function(b){const C=b.code===void 0?Ct.UNKNOWN:Ise(b.code);return new Qt(C,b.message||"")}(f);i=new Pse(o,l,u,_||null)}else if("documentChange"in e){e.documentChange;const o=e.documentChange;o.document,o.document.name,o.document.updateTime;const l=xU(n,o.document.name),u=wp(o.document.updateTime),f=o.document.createTime?wp(o.document.createTime):Zn.min(),_=new ml({mapValue:{fields:o.document.fields}}),E=oc.newFoundDocument(l,u,f,_),b=o.targetIds||[],C=o.removedTargetIds||[];i=new Dk(b,C,E.key,E)}else if("documentDelete"in e){e.documentDelete;const o=e.documentDelete;o.document;const l=xU(n,o.document),u=o.readTime?wp(o.readTime):Zn.min(),f=oc.newNoDocument(l,u),_=o.removedTargetIds||[];i=new Dk([],_,f.key,f)}else if("documentRemove"in e){e.documentRemove;const o=e.documentRemove;o.document;const l=xU(n,o.document),u=o.removedTargetIds||[];i=new Dk([],u,l,null)}else{if(!("filter"in e))return Yn();{e.filter;const o=e.filter;o.targetId;const{count:l=0,unchangedNames:u}=o,f=new O3e(l,u),_=o.targetId;i=new Ase(_,f)}}return i}function B3e(n,e){let i;if(e instanceof kR)i={update:VJ(n,e.key,e.value)};else if(e instanceof M4)i={delete:pj(n,e.key)};else if(e instanceof t_)i={update:VJ(n,e.key,e.data),updateMask:X3e(e.fieldMask)};else{if(!(e instanceof I3e))return Yn();i={verify:pj(n,e.key)}}return e.fieldTransforms.length>0&&(i.updateTransforms=e.fieldTransforms.map(o=>function(u,f){const _=f.transform;if(_ instanceof f1)return{fieldPath:f.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(_ instanceof W0)return{fieldPath:f.field.canonicalString(),appendMissingElements:{values:_.elements}};if(_ instanceof z0)return{fieldPath:f.field.canonicalString(),removeAllFromArray:{values:_.elements}};if(_ instanceof m1)return{fieldPath:f.field.canonicalString(),increment:_.Ie};throw Yn()}(0,o))),e.precondition.isNone||(i.currentDocument=function(l,u){return u.updateTime!==void 0?{updateTime:V3e(l,u.updateTime)}:u.exists!==void 0?{exists:u.exists}:Yn()}(n,e.precondition)),i}function W3e(n,e){return n&&n.length>0?(_i(e!==void 0),n.map(i=>function(l,u){let f=l.updateTime?wp(l.updateTime):wp(u);return f.isEqual(Zn.min())&&(f=wp(u)),new T3e(f,l.transformResults||[])}(i,e))):[]}function z3e(n,e){return{documents:[Nse(n,e.path)]}}function G3e(n,e){const i={structuredQuery:{}},o=e.path;let l;e.collectionGroup!==null?(l=o,i.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(l=o.popLast(),i.structuredQuery.from=[{collectionId:o.lastSegment()}]),i.parent=Nse(n,l);const u=function(b){if(b.length!==0)return Lse(Qd.create(b,"and"))}(e.filters);u&&(i.structuredQuery.where=u);const f=function(b){if(b.length!==0)return b.map(C=>function(P){return{field:WS(P.field),direction:K3e(P.dir)}}(C))}(e.orderBy);f&&(i.structuredQuery.orderBy=f);const _=dj(n,e.limit);return _!==null&&(i.structuredQuery.limit=_),e.startAt&&(i.structuredQuery.startAt=function(b){return{before:b.inclusive,values:b.position}}(e.startAt)),e.endAt&&(i.structuredQuery.endAt=function(b){return{before:!b.inclusive,values:b.position}}(e.endAt)),{ht:i,parent:l}}function H3e(n){let e=j3e(n.parent);const i=n.structuredQuery,o=i.from?i.from.length:0;let l=null;if(o>0){_i(o===1);const C=i.from[0];C.allDescendants?l=C.collectionId:e=e.child(C.collectionId)}let u=[];i.where&&(u=function(I){const P=xse(I);return P instanceof Qd&&use(P)?P.getFilters():[P]}(i.where));let f=[];i.orderBy&&(f=function(I){return I.map(P=>function(M){return new rR(zS(M.field),function(B){switch(B){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(M.direction))}(P))}(i.orderBy));let _=null;i.limit&&(_=function(I){let P;return P=typeof I=="object"?I.value:I,fN(P)?null:P}(i.limit));let E=null;i.startAt&&(E=function(I){const P=!!I.before,L=I.values||[];return new B0(L,P)}(i.startAt));let b=null;return i.endAt&&(b=function(I){const P=!I.before,L=I.values||[];return new B0(L,P)}(i.endAt)),d3e(e,l,f,u,_,"F",E,b)}function $3e(n,e){const i=function(l){switch(l){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return Yn()}}(e.purpose);return i==null?null:{"goog-listen-tags":i}}function xse(n){return n.unaryFilter!==void 0?function(i){switch(i.unaryFilter.op){case"IS_NAN":const o=zS(i.unaryFilter.field);return go.create(o,"==",{doubleValue:NaN});case"IS_NULL":const l=zS(i.unaryFilter.field);return go.create(l,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const u=zS(i.unaryFilter.field);return go.create(u,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const f=zS(i.unaryFilter.field);return go.create(f,"!=",{nullValue:"NULL_VALUE"});default:return Yn()}}(n):n.fieldFilter!==void 0?function(i){return go.create(zS(i.fieldFilter.field),function(l){switch(l){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return Yn()}}(i.fieldFilter.op),i.fieldFilter.value)}(n):n.compositeFilter!==void 0?function(i){return Qd.create(i.compositeFilter.filters.map(o=>xse(o)),function(l){switch(l){case"AND":return"and";case"OR":return"or";default:return Yn()}}(i.compositeFilter.op))}(n):Yn()}function K3e(n){return x3e[n]}function q3e(n){return L3e[n]}function Y3e(n){return M3e[n]}function WS(n){return{fieldPath:n.canonicalString()}}function zS(n){return Na.fromServerFormat(n.fieldPath)}function Lse(n){return n instanceof go?function(i){if(i.op==="=="){if(CJ(i.value))return{unaryFilter:{field:WS(i.field),op:"IS_NAN"}};if(TJ(i.value))return{unaryFilter:{field:WS(i.field),op:"IS_NULL"}}}else if(i.op==="!="){if(CJ(i.value))return{unaryFilter:{field:WS(i.field),op:"IS_NOT_NAN"}};if(TJ(i.value))return{unaryFilter:{field:WS(i.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:WS(i.field),op:q3e(i.op),value:i.value}}}(n):n instanceof Qd?function(i){const o=i.getFilters().map(l=>Lse(l));return o.length===1?o[0]:{compositeFilter:{op:Y3e(i.op),filters:o}}}(n):Yn()}function X3e(n){const e=[];return n.fields.forEach(i=>e.push(i.canonicalString())),{fieldPaths:e}}function Mse(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ng{constructor(e,i,o,l,u=Zn.min(),f=Zn.min(),_=Da.EMPTY_BYTE_STRING,E=null){this.target=e,this.targetId=i,this.purpose=o,this.sequenceNumber=l,this.snapshotVersion=u,this.lastLimboFreeSnapshotVersion=f,this.resumeToken=_,this.expectedCount=E}withSequenceNumber(e){return new Ng(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,i){return new Ng(this.target,this.targetId,this.purpose,this.sequenceNumber,i,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new Ng(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new Ng(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class J3e{constructor(e){this.Tt=e}}function Q3e(n){const e=H3e({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?p1(e,e.limit,"L"):e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Z3e{constructor(){this.Tn=new e5e}addToCollectionParentIndex(e,i){return this.Tn.add(i),Ot.resolve()}getCollectionParents(e,i){return Ot.resolve(this.Tn.getEntries(i))}addFieldIndex(e,i){return Ot.resolve()}deleteFieldIndex(e,i){return Ot.resolve()}deleteAllFieldIndexes(e){return Ot.resolve()}createTargetIndexes(e,i){return Ot.resolve()}getDocumentsMatchingTarget(e,i){return Ot.resolve(null)}getIndexType(e,i){return Ot.resolve(0)}getFieldIndexes(e,i){return Ot.resolve([])}getNextCollectionGroupToUpdate(e){return Ot.resolve(null)}getMinOffset(e,i){return Ot.resolve(Wg.min())}getMinOffsetFromCollectionGroup(e,i){return Ot.resolve(Wg.min())}updateCollectionGroup(e,i,o){return Ot.resolve()}updateIndexEntries(e,i){return Ot.resolve()}}class e5e{constructor(){this.index={}}add(e){const i=e.lastSegment(),o=e.popLast(),l=this.index[i]||new Lo(Ki.comparator),u=!l.has(o);return this.index[i]=l.add(o),u}has(e){const i=e.lastSegment(),o=e.popLast(),l=this.index[i];return l&&l.has(o)}getEntries(e){return(this.index[e]||new Lo(Ki.comparator)).toArray()}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jJ={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},Use=41943040;class pl{static withCacheSize(e){return new pl(e,pl.DEFAULT_COLLECTION_PERCENTILE,pl.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,i,o){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=i,this.maximumSequenceNumbersToCollect=o}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */pl.DEFAULT_COLLECTION_PERCENTILE=10,pl.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,pl.DEFAULT=new pl(Use,pl.DEFAULT_COLLECTION_PERCENTILE,pl.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),pl.DISABLED=new pl(-1,0,0);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class G0{constructor(e){this.$n=e}next(){return this.$n+=2,this.$n}static Un(){return new G0(0)}static Kn(){return new G0(-1)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const FJ="LruGarbageCollector",t5e=1048576;function BJ([n,e],[i,o]){const l=vr(n,i);return l===0?vr(e,o):l}class n5e{constructor(e){this.Hn=e,this.buffer=new Lo(BJ),this.Jn=0}Yn(){return++this.Jn}Zn(e){const i=[e,this.Yn()];if(this.buffer.size<this.Hn)this.buffer=this.buffer.add(i);else{const o=this.buffer.last();BJ(i,o)<0&&(this.buffer=this.buffer.delete(o).add(i))}}get maxValue(){return this.buffer.last()[0]}}class r5e{constructor(e,i,o){this.garbageCollector=e,this.asyncQueue=i,this.localStore=o,this.Xn=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.er(6e4)}stop(){this.Xn&&(this.Xn.cancel(),this.Xn=null)}get started(){return this.Xn!==null}er(e){an(FJ,`Garbage collection scheduled in ${e}ms`),this.Xn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.Xn=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(i){sb(i)?an(FJ,"Ignoring IndexedDB error during garbage collection: ",i):await ib(i)}await this.er(3e5)})}}class i5e{constructor(e,i){this.tr=e,this.params=i}calculateTargetCount(e,i){return this.tr.nr(e).next(o=>Math.floor(i/100*o))}nthSequenceNumber(e,i){if(i===0)return Ot.resolve(pN.ae);const o=new n5e(i);return this.tr.forEachTarget(e,l=>o.Zn(l.sequenceNumber)).next(()=>this.tr.rr(e,l=>o.Zn(l))).next(()=>o.maxValue)}removeTargets(e,i,o){return this.tr.removeTargets(e,i,o)}removeOrphanedDocuments(e,i){return this.tr.removeOrphanedDocuments(e,i)}collect(e,i){return this.params.cacheSizeCollectionThreshold===-1?(an("LruGarbageCollector","Garbage collection skipped; disabled"),Ot.resolve(jJ)):this.getCacheSize(e).next(o=>o<this.params.cacheSizeCollectionThreshold?(an("LruGarbageCollector",`Garbage collection skipped; Cache size ${o} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),jJ):this.ir(e,i))}getCacheSize(e){return this.tr.getCacheSize(e)}ir(e,i){let o,l,u,f,_,E,b;const C=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(I=>(I>this.params.maximumSequenceNumbersToCollect?(an("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${I}`),l=this.params.maximumSequenceNumbersToCollect):l=I,f=Date.now(),this.nthSequenceNumber(e,l))).next(I=>(o=I,_=Date.now(),this.removeTargets(e,o,i))).next(I=>(u=I,E=Date.now(),this.removeOrphanedDocuments(e,o))).next(I=>(b=Date.now(),FS()<=Nr.DEBUG&&an("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${f-C}ms
	Determined least recently used ${l} in `+(_-f)+`ms
	Removed ${u} targets in `+(E-_)+`ms
	Removed ${I} documents in `+(b-E)+`ms
Total Duration: ${b-C}ms`),Ot.resolve({didRun:!0,sequenceNumbersCollected:l,targetsRemoved:u,documentsRemoved:I})))}}function s5e(n,e){return new i5e(n,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class o5e{constructor(){this.changes=new hE(e=>e.toString(),(e,i)=>e.isEqual(i)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,i){this.assertNotApplied(),this.changes.set(e,oc.newInvalidDocument(e).setReadTime(i))}getEntry(e,i){this.assertNotApplied();const o=this.changes.get(i);return o!==void 0?Ot.resolve(o):this.getFromCache(e,i)}getEntries(e,i){return this.getAllFromCache(e,i)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class a5e{constructor(e,i){this.overlayedDocument=e,this.mutatedFields=i}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class c5e{constructor(e,i,o,l){this.remoteDocumentCache=e,this.mutationQueue=i,this.documentOverlayCache=o,this.indexManager=l}getDocument(e,i){let o=null;return this.documentOverlayCache.getOverlay(e,i).next(l=>(o=l,this.remoteDocumentCache.getEntry(e,i))).next(l=>(o!==null&&CC(o.mutation,l,ql.empty(),xo.now()),l))}getDocuments(e,i){return this.remoteDocumentCache.getEntries(e,i).next(o=>this.getLocalViewOfDocuments(e,o,Dr()).next(()=>o))}getLocalViewOfDocuments(e,i,o=Dr()){const l=xy();return this.populateOverlays(e,l,i).next(()=>this.computeViews(e,i,l,o).next(u=>{let f=sC();return u.forEach((_,E)=>{f=f.insert(_,E.overlayedDocument)}),f}))}getOverlayedDocuments(e,i){const o=xy();return this.populateOverlays(e,o,i).next(()=>this.computeViews(e,i,o,Dr()))}populateOverlays(e,i,o){const l=[];return o.forEach(u=>{i.has(u)||l.push(u)}),this.documentOverlayCache.getOverlays(e,l).next(u=>{u.forEach((f,_)=>{i.set(f,_)})})}computeViews(e,i,o,l){let u=im();const f=TC(),_=function(){return TC()}();return i.forEach((E,b)=>{const C=o.get(b.key);l.has(b.key)&&(C===void 0||C.mutation instanceof t_)?u=u.insert(b.key,b):C!==void 0?(f.set(b.key,C.mutation.getFieldMask()),CC(C.mutation,b,C.mutation.getFieldMask(),xo.now())):f.set(b.key,ql.empty())}),this.recalculateAndSaveOverlays(e,u).next(E=>(E.forEach((b,C)=>f.set(b,C)),i.forEach((b,C)=>{var I;return _.set(b,new a5e(C,(I=f.get(b))!==null&&I!==void 0?I:null))}),_))}recalculateAndSaveOverlays(e,i){const o=TC();let l=new ws((f,_)=>f-_),u=Dr();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,i).next(f=>{for(const _ of f)_.keys().forEach(E=>{const b=i.get(E);if(b===null)return;let C=o.get(E)||ql.empty();C=_.applyToLocalView(b,C),o.set(E,C);const I=(l.get(_.batchId)||Dr()).add(E);l=l.insert(_.batchId,I)})}).next(()=>{const f=[],_=l.getReverseIterator();for(;_.hasNext();){const E=_.getNext(),b=E.key,C=E.value,I=yse();C.forEach(P=>{if(!u.has(P)){const L=Cse(i.get(P),o.get(P));L!==null&&I.set(P,L),u=u.add(P)}}),f.push(this.documentOverlayCache.saveOverlays(e,b,I))}return Ot.waitFor(f)}).next(()=>o)}recalculateAndSaveOverlaysForDocumentKeys(e,i){return this.remoteDocumentCache.getEntries(e,i).next(o=>this.recalculateAndSaveOverlays(e,o))}getDocumentsMatchingQuery(e,i,o,l){return function(f){return Rn.isDocumentKey(f.path)&&f.collectionGroup===null&&f.filters.length===0}(i)?this.getDocumentsMatchingDocumentQuery(e,i.path):x4(i)?this.getDocumentsMatchingCollectionGroupQuery(e,i,o,l):this.getDocumentsMatchingCollectionQuery(e,i,o,l)}getNextDocuments(e,i,o,l){return this.remoteDocumentCache.getAllFromCollectionGroup(e,i,o,l).next(u=>{const f=l-u.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,i,o.largestBatchId,l-u.size):Ot.resolve(xy());let _=ZC,E=u;return f.next(b=>Ot.forEach(b,(C,I)=>(_<I.largestBatchId&&(_=I.largestBatchId),u.get(C)?Ot.resolve():this.remoteDocumentCache.getEntry(e,C).next(P=>{E=E.insert(C,P)}))).next(()=>this.populateOverlays(e,b,u)).next(()=>this.computeViews(e,E,b,Dr())).next(C=>({batchId:_,changes:_se(C)})))})}getDocumentsMatchingDocumentQuery(e,i){return this.getDocument(e,new Rn(i)).next(o=>{let l=sC();return o.isFoundDocument()&&(l=l.insert(o.key,o)),l})}getDocumentsMatchingCollectionGroupQuery(e,i,o,l){const u=i.collectionGroup;let f=sC();return this.indexManager.getCollectionParents(e,u).next(_=>Ot.forEach(_,E=>{const b=function(I,P){return new dE(P,null,I.explicitOrderBy.slice(),I.filters.slice(),I.limit,I.limitType,I.startAt,I.endAt)}(i,E.child(u));return this.getDocumentsMatchingCollectionQuery(e,b,o,l).next(C=>{C.forEach((I,P)=>{f=f.insert(I,P)})})}).next(()=>f))}getDocumentsMatchingCollectionQuery(e,i,o,l){let u;return this.documentOverlayCache.getOverlaysForCollection(e,i.path,o.largestBatchId).next(f=>(u=f,this.remoteDocumentCache.getDocumentsMatchingQuery(e,i,o,u,l))).next(f=>{u.forEach((E,b)=>{const C=b.getKey();f.get(C)===null&&(f=f.insert(C,oc.newInvalidDocument(C)))});let _=sC();return f.forEach((E,b)=>{const C=u.get(E);C!==void 0&&CC(C.mutation,b,ql.empty(),xo.now()),EN(i,b)&&(_=_.insert(E,b))}),_})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class l5e{constructor(e){this.serializer=e,this.dr=new Map,this.Ar=new Map}getBundleMetadata(e,i){return Ot.resolve(this.dr.get(i))}saveBundleMetadata(e,i){return this.dr.set(i.id,function(l){return{id:l.id,version:l.version,createTime:wp(l.createTime)}}(i)),Ot.resolve()}getNamedQuery(e,i){return Ot.resolve(this.Ar.get(i))}saveNamedQuery(e,i){return this.Ar.set(i.name,function(l){return{name:l.name,query:Q3e(l.bundledQuery),readTime:wp(l.readTime)}}(i)),Ot.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class u5e{constructor(){this.overlays=new ws(Rn.comparator),this.Rr=new Map}getOverlay(e,i){return Ot.resolve(this.overlays.get(i))}getOverlays(e,i){const o=xy();return Ot.forEach(i,l=>this.getOverlay(e,l).next(u=>{u!==null&&o.set(l,u)})).next(()=>o)}saveOverlays(e,i,o){return o.forEach((l,u)=>{this.Et(e,i,u)}),Ot.resolve()}removeOverlaysForBatchId(e,i,o){const l=this.Rr.get(o);return l!==void 0&&(l.forEach(u=>this.overlays=this.overlays.remove(u)),this.Rr.delete(o)),Ot.resolve()}getOverlaysForCollection(e,i,o){const l=xy(),u=i.length+1,f=new Rn(i.child("")),_=this.overlays.getIteratorFrom(f);for(;_.hasNext();){const E=_.getNext().value,b=E.getKey();if(!i.isPrefixOf(b.path))break;b.path.length===u&&E.largestBatchId>o&&l.set(E.getKey(),E)}return Ot.resolve(l)}getOverlaysForCollectionGroup(e,i,o,l){let u=new ws((b,C)=>b-C);const f=this.overlays.getIterator();for(;f.hasNext();){const b=f.getNext().value;if(b.getKey().getCollectionGroup()===i&&b.largestBatchId>o){let C=u.get(b.largestBatchId);C===null&&(C=xy(),u=u.insert(b.largestBatchId,C)),C.set(b.getKey(),b)}}const _=xy(),E=u.getIterator();for(;E.hasNext()&&(E.getNext().value.forEach((b,C)=>_.set(b,C)),!(_.size()>=l)););return Ot.resolve(_)}Et(e,i,o){const l=this.overlays.get(o.key);if(l!==null){const f=this.Rr.get(l.largestBatchId).delete(o.key);this.Rr.set(l.largestBatchId,f)}this.overlays=this.overlays.insert(o.key,new P3e(i,o));let u=this.Rr.get(i);u===void 0&&(u=Dr(),this.Rr.set(i,u)),this.Rr.set(i,u.add(o.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class d5e{constructor(){this.sessionToken=Da.EMPTY_BYTE_STRING}getSessionToken(e){return Ot.resolve(this.sessionToken)}setSessionToken(e,i){return this.sessionToken=i,Ot.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class F4{constructor(){this.Vr=new Lo(Zo.mr),this.gr=new Lo(Zo.pr)}isEmpty(){return this.Vr.isEmpty()}addReference(e,i){const o=new Zo(e,i);this.Vr=this.Vr.add(o),this.gr=this.gr.add(o)}yr(e,i){e.forEach(o=>this.addReference(o,i))}removeReference(e,i){this.wr(new Zo(e,i))}Sr(e,i){e.forEach(o=>this.removeReference(o,i))}br(e){const i=new Rn(new Ki([])),o=new Zo(i,e),l=new Zo(i,e+1),u=[];return this.gr.forEachInRange([o,l],f=>{this.wr(f),u.push(f.key)}),u}Dr(){this.Vr.forEach(e=>this.wr(e))}wr(e){this.Vr=this.Vr.delete(e),this.gr=this.gr.delete(e)}vr(e){const i=new Rn(new Ki([])),o=new Zo(i,e),l=new Zo(i,e+1);let u=Dr();return this.gr.forEachInRange([o,l],f=>{u=u.add(f.key)}),u}containsKey(e){const i=new Zo(e,0),o=this.Vr.firstAfterOrEqual(i);return o!==null&&e.isEqual(o.key)}}class Zo{constructor(e,i){this.key=e,this.Cr=i}static mr(e,i){return Rn.comparator(e.key,i.key)||vr(e.Cr,i.Cr)}static pr(e,i){return vr(e.Cr,i.Cr)||Rn.comparator(e.key,i.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class h5e{constructor(e,i){this.indexManager=e,this.referenceDelegate=i,this.mutationQueue=[],this.Fr=1,this.Mr=new Lo(Zo.mr)}checkEmpty(e){return Ot.resolve(this.mutationQueue.length===0)}addMutationBatch(e,i,o,l){const u=this.Fr;this.Fr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const f=new A3e(u,i,o,l);this.mutationQueue.push(f);for(const _ of l)this.Mr=this.Mr.add(new Zo(_.key,u)),this.indexManager.addToCollectionParentIndex(e,_.key.path.popLast());return Ot.resolve(f)}lookupMutationBatch(e,i){return Ot.resolve(this.Or(i))}getNextMutationBatchAfterBatchId(e,i){const o=i+1,l=this.Nr(o),u=l<0?0:l;return Ot.resolve(this.mutationQueue.length>u?this.mutationQueue[u]:null)}getHighestUnacknowledgedBatchId(){return Ot.resolve(this.mutationQueue.length===0?O4:this.Fr-1)}getAllMutationBatches(e){return Ot.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,i){const o=new Zo(i,0),l=new Zo(i,Number.POSITIVE_INFINITY),u=[];return this.Mr.forEachInRange([o,l],f=>{const _=this.Or(f.Cr);u.push(_)}),Ot.resolve(u)}getAllMutationBatchesAffectingDocumentKeys(e,i){let o=new Lo(vr);return i.forEach(l=>{const u=new Zo(l,0),f=new Zo(l,Number.POSITIVE_INFINITY);this.Mr.forEachInRange([u,f],_=>{o=o.add(_.Cr)})}),Ot.resolve(this.Br(o))}getAllMutationBatchesAffectingQuery(e,i){const o=i.path,l=o.length+1;let u=o;Rn.isDocumentKey(u)||(u=u.child(""));const f=new Zo(new Rn(u),0);let _=new Lo(vr);return this.Mr.forEachWhile(E=>{const b=E.key.path;return!!o.isPrefixOf(b)&&(b.length===l&&(_=_.add(E.Cr)),!0)},f),Ot.resolve(this.Br(_))}Br(e){const i=[];return e.forEach(o=>{const l=this.Or(o);l!==null&&i.push(l)}),i}removeMutationBatch(e,i){_i(this.Lr(i.batchId,"removed")===0),this.mutationQueue.shift();let o=this.Mr;return Ot.forEach(i.mutations,l=>{const u=new Zo(l.key,i.batchId);return o=o.delete(u),this.referenceDelegate.markPotentiallyOrphaned(e,l.key)}).next(()=>{this.Mr=o})}qn(e){}containsKey(e,i){const o=new Zo(i,0),l=this.Mr.firstAfterOrEqual(o);return Ot.resolve(i.isEqual(l&&l.key))}performConsistencyCheck(e){return this.mutationQueue.length,Ot.resolve()}Lr(e,i){return this.Nr(e)}Nr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Or(e){const i=this.Nr(e);return i<0||i>=this.mutationQueue.length?null:this.mutationQueue[i]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class p5e{constructor(e){this.kr=e,this.docs=function(){return new ws(Rn.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,i){const o=i.key,l=this.docs.get(o),u=l?l.size:0,f=this.kr(i);return this.docs=this.docs.insert(o,{document:i.mutableCopy(),size:f}),this.size+=f-u,this.indexManager.addToCollectionParentIndex(e,o.path.popLast())}removeEntry(e){const i=this.docs.get(e);i&&(this.docs=this.docs.remove(e),this.size-=i.size)}getEntry(e,i){const o=this.docs.get(i);return Ot.resolve(o?o.document.mutableCopy():oc.newInvalidDocument(i))}getEntries(e,i){let o=im();return i.forEach(l=>{const u=this.docs.get(l);o=o.insert(l,u?u.document.mutableCopy():oc.newInvalidDocument(l))}),Ot.resolve(o)}getDocumentsMatchingQuery(e,i,o,l){let u=im();const f=i.path,_=new Rn(f.child("__id-9223372036854775808__")),E=this.docs.getIteratorFrom(_);for(;E.hasNext();){const{key:b,value:{document:C}}=E.getNext();if(!f.isPrefixOf(b.path))break;b.path.length>f.length+1||z4e(W4e(C),o)<=0||(l.has(C.key)||EN(i,C))&&(u=u.insert(C.key,C.mutableCopy()))}return Ot.resolve(u)}getAllFromCollectionGroup(e,i,o,l){Yn()}qr(e,i){return Ot.forEach(this.docs,o=>i(o))}newChangeBuffer(e){return new f5e(this)}getSize(e){return Ot.resolve(this.size)}}class f5e extends o5e{constructor(e){super(),this.Ir=e}applyChanges(e){const i=[];return this.changes.forEach((o,l)=>{l.isValidDocument()?i.push(this.Ir.addEntry(e,l)):this.Ir.removeEntry(o)}),Ot.waitFor(i)}getFromCache(e,i){return this.Ir.getEntry(e,i)}getAllFromCache(e,i){return this.Ir.getEntries(e,i)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class m5e{constructor(e){this.persistence=e,this.Qr=new hE(i=>N4(i),D4),this.lastRemoteSnapshotVersion=Zn.min(),this.highestTargetId=0,this.$r=0,this.Ur=new F4,this.targetCount=0,this.Kr=G0.Un()}forEachTarget(e,i){return this.Qr.forEach((o,l)=>i(l)),Ot.resolve()}getLastRemoteSnapshotVersion(e){return Ot.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return Ot.resolve(this.$r)}allocateTargetId(e){return this.highestTargetId=this.Kr.next(),Ot.resolve(this.highestTargetId)}setTargetsMetadata(e,i,o){return o&&(this.lastRemoteSnapshotVersion=o),i>this.$r&&(this.$r=i),Ot.resolve()}zn(e){this.Qr.set(e.target,e);const i=e.targetId;i>this.highestTargetId&&(this.Kr=new G0(i),this.highestTargetId=i),e.sequenceNumber>this.$r&&(this.$r=e.sequenceNumber)}addTargetData(e,i){return this.zn(i),this.targetCount+=1,Ot.resolve()}updateTargetData(e,i){return this.zn(i),Ot.resolve()}removeTargetData(e,i){return this.Qr.delete(i.target),this.Ur.br(i.targetId),this.targetCount-=1,Ot.resolve()}removeTargets(e,i,o){let l=0;const u=[];return this.Qr.forEach((f,_)=>{_.sequenceNumber<=i&&o.get(_.targetId)===null&&(this.Qr.delete(f),u.push(this.removeMatchingKeysForTargetId(e,_.targetId)),l++)}),Ot.waitFor(u).next(()=>l)}getTargetCount(e){return Ot.resolve(this.targetCount)}getTargetData(e,i){const o=this.Qr.get(i)||null;return Ot.resolve(o)}addMatchingKeys(e,i,o){return this.Ur.yr(i,o),Ot.resolve()}removeMatchingKeys(e,i,o){this.Ur.Sr(i,o);const l=this.persistence.referenceDelegate,u=[];return l&&i.forEach(f=>{u.push(l.markPotentiallyOrphaned(e,f))}),Ot.waitFor(u)}removeMatchingKeysForTargetId(e,i){return this.Ur.br(i),Ot.resolve()}getMatchingKeysForTargetId(e,i){const o=this.Ur.vr(i);return Ot.resolve(o)}containsKey(e,i){return Ot.resolve(this.Ur.containsKey(i))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vse{constructor(e,i){this.Wr={},this.overlays={},this.Gr=new pN(0),this.zr=!1,this.zr=!0,this.jr=new d5e,this.referenceDelegate=e(this),this.Hr=new m5e(this),this.indexManager=new Z3e,this.remoteDocumentCache=function(l){return new p5e(l)}(o=>this.referenceDelegate.Jr(o)),this.serializer=new J3e(i),this.Yr=new l5e(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.zr=!1,Promise.resolve()}get started(){return this.zr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let i=this.overlays[e.toKey()];return i||(i=new u5e,this.overlays[e.toKey()]=i),i}getMutationQueue(e,i){let o=this.Wr[e.toKey()];return o||(o=new h5e(i,this.referenceDelegate),this.Wr[e.toKey()]=o),o}getGlobalsCache(){return this.jr}getTargetCache(){return this.Hr}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Yr}runTransaction(e,i,o){an("MemoryPersistence","Starting transaction:",e);const l=new g5e(this.Gr.next());return this.referenceDelegate.Zr(),o(l).next(u=>this.referenceDelegate.Xr(l).next(()=>u)).toPromise().then(u=>(l.raiseOnCommittedEvent(),u))}ei(e,i){return Ot.or(Object.values(this.Wr).map(o=>()=>o.containsKey(e,i)))}}class g5e extends H4e{constructor(e){super(),this.currentSequenceNumber=e}}class B4{constructor(e){this.persistence=e,this.ti=new F4,this.ni=null}static ri(e){return new B4(e)}get ii(){if(this.ni)return this.ni;throw Yn()}addReference(e,i,o){return this.ti.addReference(o,i),this.ii.delete(o.toString()),Ot.resolve()}removeReference(e,i,o){return this.ti.removeReference(o,i),this.ii.add(o.toString()),Ot.resolve()}markPotentiallyOrphaned(e,i){return this.ii.add(i.toString()),Ot.resolve()}removeTarget(e,i){this.ti.br(i.targetId).forEach(l=>this.ii.add(l.toString()));const o=this.persistence.getTargetCache();return o.getMatchingKeysForTargetId(e,i.targetId).next(l=>{l.forEach(u=>this.ii.add(u.toString()))}).next(()=>o.removeTargetData(e,i))}Zr(){this.ni=new Set}Xr(e){const i=this.persistence.getRemoteDocumentCache().newChangeBuffer();return Ot.forEach(this.ii,o=>{const l=Rn.fromPath(o);return this.si(e,l).next(u=>{u||i.removeEntry(l,Zn.min())})}).next(()=>(this.ni=null,i.apply(e)))}updateLimboDocument(e,i){return this.si(e,i).next(o=>{o?this.ii.delete(i.toString()):this.ii.add(i.toString())})}Jr(e){return 0}si(e,i){return Ot.or([()=>Ot.resolve(this.ti.containsKey(i)),()=>this.persistence.getTargetCache().containsKey(e,i),()=>this.persistence.ei(e,i)])}}class _1{constructor(e,i){this.persistence=e,this.oi=new hE(o=>q4e(o.path),(o,l)=>o.isEqual(l)),this.garbageCollector=s5e(this,i)}static ri(e,i){return new _1(e,i)}Zr(){}Xr(e){return Ot.resolve()}forEachTarget(e,i){return this.persistence.getTargetCache().forEachTarget(e,i)}nr(e){const i=this.sr(e);return this.persistence.getTargetCache().getTargetCount(e).next(o=>i.next(l=>o+l))}sr(e){let i=0;return this.rr(e,o=>{i++}).next(()=>i)}rr(e,i){return Ot.forEach(this.oi,(o,l)=>this.ar(e,o,l).next(u=>u?Ot.resolve():i(l)))}removeTargets(e,i,o){return this.persistence.getTargetCache().removeTargets(e,i,o)}removeOrphanedDocuments(e,i){let o=0;const l=this.persistence.getRemoteDocumentCache(),u=l.newChangeBuffer();return l.qr(e,f=>this.ar(e,f,i).next(_=>{_||(o++,u.removeEntry(f,Zn.min()))})).next(()=>u.apply(e)).next(()=>o)}markPotentiallyOrphaned(e,i){return this.oi.set(i,e.currentSequenceNumber),Ot.resolve()}removeTarget(e,i){const o=i.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,o)}addReference(e,i,o){return this.oi.set(o,e.currentSequenceNumber),Ot.resolve()}removeReference(e,i,o){return this.oi.set(o,e.currentSequenceNumber),Ot.resolve()}updateLimboDocument(e,i){return this.oi.set(i,e.currentSequenceNumber),Ot.resolve()}Jr(e){let i=e.key.toString().length;return e.isFoundDocument()&&(i+=Ok(e.data.value)),i}ar(e,i,o){return Ot.or([()=>this.persistence.ei(e,i),()=>this.persistence.getTargetCache().containsKey(e,i),()=>{const l=this.oi.get(i);return Ot.resolve(l!==void 0&&l>o)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class W4{constructor(e,i,o,l){this.targetId=e,this.fromCache=i,this.Hi=o,this.Ji=l}static Yi(e,i){let o=Dr(),l=Dr();for(const u of i.docChanges)switch(u.type){case 0:o=o.add(u.doc.key);break;case 1:l=l.add(u.doc.key)}return new W4(e,i.fromCache,o,l)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _5e{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class y5e{constructor(){this.Zi=!1,this.Xi=!1,this.es=100,this.ts=function(){return QUe()?8:$4e(lc())>0?6:4}()}initialize(e,i){this.ns=e,this.indexManager=i,this.Zi=!0}getDocumentsMatchingQuery(e,i,o,l){const u={result:null};return this.rs(e,i).next(f=>{u.result=f}).next(()=>{if(!u.result)return this.ss(e,i,l,o).next(f=>{u.result=f})}).next(()=>{if(u.result)return;const f=new _5e;return this._s(e,i,f).next(_=>{if(u.result=_,this.Xi)return this.us(e,i,f,_.size)})}).next(()=>u.result)}us(e,i,o,l){return o.documentReadCount<this.es?(FS()<=Nr.DEBUG&&an("QueryEngine","SDK will not create cache indexes for query:",BS(i),"since it only creates cache indexes for collection contains","more than or equal to",this.es,"documents"),Ot.resolve()):(FS()<=Nr.DEBUG&&an("QueryEngine","Query:",BS(i),"scans",o.documentReadCount,"local documents and returns",l,"documents as results."),o.documentReadCount>this.ts*l?(FS()<=Nr.DEBUG&&an("QueryEngine","The SDK decides to create cache indexes for query:",BS(i),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,bp(i))):Ot.resolve())}rs(e,i){if(PJ(i))return Ot.resolve(null);let o=bp(i);return this.indexManager.getIndexType(e,o).next(l=>l===0?null:(i.limit!==null&&l===1&&(i=p1(i,null,"F"),o=bp(i)),this.indexManager.getDocumentsMatchingTarget(e,o).next(u=>{const f=Dr(...u);return this.ns.getDocuments(e,f).next(_=>this.indexManager.getMinOffset(e,o).next(E=>{const b=this.cs(i,_);return this.ls(i,b,f,E.readTime)?this.rs(e,p1(i,null,"F")):this.hs(e,b,i,E)}))})))}ss(e,i,o,l){return PJ(i)||l.isEqual(Zn.min())?Ot.resolve(null):this.ns.getDocuments(e,o).next(u=>{const f=this.cs(i,u);return this.ls(i,f,o,l)?Ot.resolve(null):(FS()<=Nr.DEBUG&&an("QueryEngine","Re-using previous result from %s to execute query: %s",l.toString(),BS(i)),this.hs(e,f,i,B4e(l,ZC)).next(_=>_))})}cs(e,i){let o=new Lo(mse(e));return i.forEach((l,u)=>{EN(e,u)&&(o=o.add(u))}),o}ls(e,i,o,l){if(e.limit===null)return!1;if(o.size!==i.size)return!0;const u=e.limitType==="F"?i.last():i.first();return!!u&&(u.hasPendingWrites||u.version.compareTo(l)>0)}_s(e,i,o){return FS()<=Nr.DEBUG&&an("QueryEngine","Using full collection scan to execute query:",BS(i)),this.ns.getDocumentsMatchingQuery(e,i,Wg.min(),o)}hs(e,i,o,l){return this.ns.getDocumentsMatchingQuery(e,o,l).next(u=>(i.forEach(f=>{u=u.insert(f.key,f)}),u))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const z4="LocalStore",E5e=3e8;class v5e{constructor(e,i,o,l){this.persistence=e,this.Ps=i,this.serializer=l,this.Ts=new ws(vr),this.Is=new hE(u=>N4(u),D4),this.Es=new Map,this.ds=e.getRemoteDocumentCache(),this.Hr=e.getTargetCache(),this.Yr=e.getBundleCache(),this.As(o)}As(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new c5e(this.ds,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.ds.setIndexManager(this.indexManager),this.Ps.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",i=>e.collect(i,this.Ts))}}function S5e(n,e,i,o){return new v5e(n,e,i,o)}async function jse(n,e){const i=rr(n);return await i.persistence.runTransaction("Handle user change","readonly",o=>{let l;return i.mutationQueue.getAllMutationBatches(o).next(u=>(l=u,i.As(e),i.mutationQueue.getAllMutationBatches(o))).next(u=>{const f=[],_=[];let E=Dr();for(const b of l){f.push(b.batchId);for(const C of b.mutations)E=E.add(C.key)}for(const b of u){_.push(b.batchId);for(const C of b.mutations)E=E.add(C.key)}return i.localDocuments.getDocuments(o,E).next(b=>({Rs:b,removedBatchIds:f,addedBatchIds:_}))})})}function b5e(n,e){const i=rr(n);return i.persistence.runTransaction("Acknowledge batch","readwrite-primary",o=>{const l=e.batch.keys(),u=i.ds.newChangeBuffer({trackRemovals:!0});return function(_,E,b,C){const I=b.batch,P=I.keys();let L=Ot.resolve();return P.forEach(M=>{L=L.next(()=>C.getEntry(E,M)).next(F=>{const B=b.docVersions.get(M);_i(B!==null),F.version.compareTo(B)<0&&(I.applyToRemoteDocument(F,b),F.isValidDocument()&&(F.setReadTime(b.commitVersion),C.addEntry(F)))})}),L.next(()=>_.mutationQueue.removeMutationBatch(E,I))}(i,o,e,u).next(()=>u.apply(o)).next(()=>i.mutationQueue.performConsistencyCheck(o)).next(()=>i.documentOverlayCache.removeOverlaysForBatchId(o,l,e.batch.batchId)).next(()=>i.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(o,function(_){let E=Dr();for(let b=0;b<_.mutationResults.length;++b)_.mutationResults[b].transformResults.length>0&&(E=E.add(_.batch.mutations[b].key));return E}(e))).next(()=>i.localDocuments.getDocuments(o,l))})}function Fse(n){const e=rr(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",i=>e.Hr.getLastRemoteSnapshotVersion(i))}function w5e(n,e){const i=rr(n),o=e.snapshotVersion;let l=i.Ts;return i.persistence.runTransaction("Apply remote event","readwrite-primary",u=>{const f=i.ds.newChangeBuffer({trackRemovals:!0});l=i.Ts;const _=[];e.targetChanges.forEach((C,I)=>{const P=l.get(I);if(!P)return;_.push(i.Hr.removeMatchingKeys(u,C.removedDocuments,I).next(()=>i.Hr.addMatchingKeys(u,C.addedDocuments,I)));let L=P.withSequenceNumber(u.currentSequenceNumber);e.targetMismatches.get(I)!==null?L=L.withResumeToken(Da.EMPTY_BYTE_STRING,Zn.min()).withLastLimboFreeSnapshotVersion(Zn.min()):C.resumeToken.approximateByteSize()>0&&(L=L.withResumeToken(C.resumeToken,o)),l=l.insert(I,L),function(F,B,Z){return F.resumeToken.approximateByteSize()===0||B.snapshotVersion.toMicroseconds()-F.snapshotVersion.toMicroseconds()>=E5e?!0:Z.addedDocuments.size+Z.modifiedDocuments.size+Z.removedDocuments.size>0}(P,L,C)&&_.push(i.Hr.updateTargetData(u,L))});let E=im(),b=Dr();if(e.documentUpdates.forEach(C=>{e.resolvedLimboDocuments.has(C)&&_.push(i.persistence.referenceDelegate.updateLimboDocument(u,C))}),_.push(T5e(u,f,e.documentUpdates).next(C=>{E=C.Vs,b=C.fs})),!o.isEqual(Zn.min())){const C=i.Hr.getLastRemoteSnapshotVersion(u).next(I=>i.Hr.setTargetsMetadata(u,u.currentSequenceNumber,o));_.push(C)}return Ot.waitFor(_).next(()=>f.apply(u)).next(()=>i.localDocuments.getLocalViewOfDocuments(u,E,b)).next(()=>E)}).then(u=>(i.Ts=l,u))}function T5e(n,e,i){let o=Dr(),l=Dr();return i.forEach(u=>o=o.add(u)),e.getEntries(n,o).next(u=>{let f=im();return i.forEach((_,E)=>{const b=u.get(_);E.isFoundDocument()!==b.isFoundDocument()&&(l=l.add(_)),E.isNoDocument()&&E.version.isEqual(Zn.min())?(e.removeEntry(_,E.readTime),f=f.insert(_,E)):!b.isValidDocument()||E.version.compareTo(b.version)>0||E.version.compareTo(b.version)===0&&b.hasPendingWrites?(e.addEntry(E),f=f.insert(_,E)):an(z4,"Ignoring outdated watch update for ",_,". Current version:",b.version," Watch version:",E.version)}),{Vs:f,fs:l}})}function C5e(n,e){const i=rr(n);return i.persistence.runTransaction("Get next mutation batch","readonly",o=>(e===void 0&&(e=O4),i.mutationQueue.getNextMutationBatchAfterBatchId(o,e)))}function R5e(n,e){const i=rr(n);return i.persistence.runTransaction("Allocate target","readwrite",o=>{let l;return i.Hr.getTargetData(o,e).next(u=>u?(l=u,Ot.resolve(l)):i.Hr.allocateTargetId(o).next(f=>(l=new Ng(e,f,"TargetPurposeListen",o.currentSequenceNumber),i.Hr.addTargetData(o,l).next(()=>l))))}).then(o=>{const l=i.Ts.get(o.targetId);return(l===null||o.snapshotVersion.compareTo(l.snapshotVersion)>0)&&(i.Ts=i.Ts.insert(o.targetId,o),i.Is.set(e,o.targetId)),o})}async function mj(n,e,i){const o=rr(n),l=o.Ts.get(e),u=i?"readwrite":"readwrite-primary";try{i||await o.persistence.runTransaction("Release target",u,f=>o.persistence.referenceDelegate.removeTarget(f,l))}catch(f){if(!sb(f))throw f;an(z4,`Failed to update sequence numbers for target ${e}: ${f}`)}o.Ts=o.Ts.remove(e),o.Is.delete(l.target)}function WJ(n,e,i){const o=rr(n);let l=Zn.min(),u=Dr();return o.persistence.runTransaction("Execute query","readwrite",f=>function(E,b,C){const I=rr(E),P=I.Is.get(C);return P!==void 0?Ot.resolve(I.Ts.get(P)):I.Hr.getTargetData(b,C)}(o,f,bp(e)).next(_=>{if(_)return l=_.lastLimboFreeSnapshotVersion,o.Hr.getMatchingKeysForTargetId(f,_.targetId).next(E=>{u=E})}).next(()=>o.Ps.getDocumentsMatchingQuery(f,e,i?l:Zn.min(),i?u:Dr())).next(_=>(I5e(o,p3e(e),_),{documents:_,gs:u})))}function I5e(n,e,i){let o=n.Es.get(e)||Zn.min();i.forEach((l,u)=>{u.readTime.compareTo(o)>0&&(o=u.readTime)}),n.Es.set(e,o)}class zJ{constructor(){this.activeTargetIds=E3e()}Ds(e){this.activeTargetIds=this.activeTargetIds.add(e)}vs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}bs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class A5e{constructor(){this.ho=new zJ,this.Po={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,i,o){}addLocalQueryTarget(e,i=!0){return i&&this.ho.Ds(e),this.Po[e]||"not-current"}updateQueryState(e,i,o){this.Po[e]=i}removeLocalQueryTarget(e){this.ho.vs(e)}isLocalQueryTarget(e){return this.ho.activeTargetIds.has(e)}clearQueryState(e){delete this.Po[e]}getAllActiveQueryTargets(){return this.ho.activeTargetIds}isActiveQueryTarget(e){return this.ho.activeTargetIds.has(e)}start(){return this.ho=new zJ,Promise.resolve()}handleUserChange(e,i,o){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class P5e{To(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const GJ="ConnectivityMonitor";class HJ{constructor(){this.Io=()=>this.Eo(),this.Ao=()=>this.Ro(),this.Vo=[],this.mo()}To(e){this.Vo.push(e)}shutdown(){window.removeEventListener("online",this.Io),window.removeEventListener("offline",this.Ao)}mo(){window.addEventListener("online",this.Io),window.addEventListener("offline",this.Ao)}Eo(){an(GJ,"Network connectivity changed: AVAILABLE");for(const e of this.Vo)e(0)}Ro(){an(GJ,"Network connectivity changed: UNAVAILABLE");for(const e of this.Vo)e(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let XO=null;function gj(){return XO===null?XO=function(){return 268435456+Math.round(2147483648*Math.random())}():XO++,"0x"+XO.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const LU="RestConnection",O5e={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class k5e{get fo(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const i=e.ssl?"https":"http",o=encodeURIComponent(this.databaseId.projectId),l=encodeURIComponent(this.databaseId.database);this.po=i+"://"+e.host,this.yo=`projects/${o}/databases/${l}`,this.wo=this.databaseId.database===u1?`project_id=${o}`:`project_id=${o}&database_id=${l}`}So(e,i,o,l,u){const f=gj(),_=this.bo(e,i.toUriEncodedString());an(LU,`Sending RPC '${e}' ${f}:`,_,o);const E={"google-cloud-resource-prefix":this.yo,"x-goog-request-params":this.wo};return this.Do(E,l,u),this.vo(e,_,E,o).then(b=>(an(LU,`Received RPC '${e}' ${f}: `,b),b),b=>{throw U0(LU,`RPC '${e}' ${f} failed with error: `,b,"url: ",_,"request:",o),b})}Co(e,i,o,l,u,f){return this.So(e,i,o,l,u)}Do(e,i,o){e["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+rb}(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),i&&i.headers.forEach((l,u)=>e[u]=l),o&&o.headers.forEach((l,u)=>e[u]=l)}bo(e,i){const o=O5e[e];return`${this.po}/v1/${i}:${o}`}terminate(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class N5e{constructor(e){this.Fo=e.Fo,this.Mo=e.Mo}xo(e){this.Oo=e}No(e){this.Bo=e}Lo(e){this.ko=e}onMessage(e){this.qo=e}close(){this.Mo()}send(e){this.Fo(e)}Qo(){this.Oo()}$o(){this.Bo()}Uo(e){this.ko(e)}Ko(e){this.qo(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nc="WebChannelConnection";class D5e extends k5e{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}vo(e,i,o,l){const u=gj();return new Promise((f,_)=>{const E=new Gie;E.setWithCredentials(!0),E.listenOnce(Hie.COMPLETE,()=>{try{switch(E.getLastErrorCode()){case Pk.NO_ERROR:const C=E.getResponseJson();an(nc,`XHR for RPC '${e}' ${u} received:`,JSON.stringify(C)),f(C);break;case Pk.TIMEOUT:an(nc,`RPC '${e}' ${u} timed out`),_(new Qt(Ct.DEADLINE_EXCEEDED,"Request time out"));break;case Pk.HTTP_ERROR:const I=E.getStatus();if(an(nc,`RPC '${e}' ${u} failed with status:`,I,"response text:",E.getResponseText()),I>0){let P=E.getResponseJson();Array.isArray(P)&&(P=P[0]);const L=P==null?void 0:P.error;if(L&&L.status&&L.message){const M=function(B){const Z=B.toLowerCase().replace(/_/g,"-");return Object.values(Ct).indexOf(Z)>=0?Z:Ct.UNKNOWN}(L.status);_(new Qt(M,L.message))}else _(new Qt(Ct.UNKNOWN,"Server responded with status "+E.getStatus()))}else _(new Qt(Ct.UNAVAILABLE,"Connection failed."));break;default:Yn()}}finally{an(nc,`RPC '${e}' ${u} completed.`)}});const b=JSON.stringify(l);an(nc,`RPC '${e}' ${u} sending request:`,l),E.send(i,"POST",b,o,15)})}Wo(e,i,o){const l=gj(),u=[this.po,"/","google.firestore.v1.Firestore","/",e,"/channel"],f=qie(),_=Kie(),E={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},b=this.longPollingOptions.timeoutSeconds;b!==void 0&&(E.longPollingTimeout=Math.round(1e3*b)),this.useFetchStreams&&(E.useFetchStreams=!0),this.Do(E.initMessageHeaders,i,o),E.encodeInitMessageHeaders=!0;const C=u.join("");an(nc,`Creating RPC '${e}' stream ${l}: ${C}`,E);const I=f.createWebChannel(C,E);let P=!1,L=!1;const M=new N5e({Fo:B=>{L?an(nc,`Not sending because RPC '${e}' stream ${l} is closed:`,B):(P||(an(nc,`Opening RPC '${e}' stream ${l} transport.`),I.open(),P=!0),an(nc,`RPC '${e}' stream ${l} sending:`,B),I.send(B))},Mo:()=>I.close()}),F=(B,Z,K)=>{B.listen(Z,re=>{try{K(re)}catch(ae){setTimeout(()=>{throw ae},0)}})};return F(I,iC.EventType.OPEN,()=>{L||(an(nc,`RPC '${e}' stream ${l} transport opened.`),M.Qo())}),F(I,iC.EventType.CLOSE,()=>{L||(L=!0,an(nc,`RPC '${e}' stream ${l} transport closed`),M.Uo())}),F(I,iC.EventType.ERROR,B=>{L||(L=!0,U0(nc,`RPC '${e}' stream ${l} transport errored:`,B),M.Uo(new Qt(Ct.UNAVAILABLE,"The operation could not be completed")))}),F(I,iC.EventType.MESSAGE,B=>{var Z;if(!L){const K=B.data[0];_i(!!K);const re=K,ae=(re==null?void 0:re.error)||((Z=re[0])===null||Z===void 0?void 0:Z.error);if(ae){an(nc,`RPC '${e}' stream ${l} received error:`,ae);const ne=ae.status;let pe=function(Y){const ie=ho[Y];if(ie!==void 0)return Ise(ie)}(ne),X=ae.message;pe===void 0&&(pe=Ct.INTERNAL,X="Unknown error status: "+ne+" with message "+ae.message),L=!0,M.Uo(new Qt(pe,X)),I.close()}else an(nc,`RPC '${e}' stream ${l} received:`,K),M.Ko(K)}}),F(_,$ie.STAT_EVENT,B=>{B.stat===ij.PROXY?an(nc,`RPC '${e}' stream ${l} detected buffering proxy`):B.stat===ij.NOPROXY&&an(nc,`RPC '${e}' stream ${l} detected no buffering proxy`)}),setTimeout(()=>{M.$o()},0),M}}function MU(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wN(n){return new U3e(n,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bse{constructor(e,i,o=1e3,l=1.5,u=6e4){this.Ti=e,this.timerId=i,this.Go=o,this.zo=l,this.jo=u,this.Ho=0,this.Jo=null,this.Yo=Date.now(),this.reset()}reset(){this.Ho=0}Zo(){this.Ho=this.jo}Xo(e){this.cancel();const i=Math.floor(this.Ho+this.e_()),o=Math.max(0,Date.now()-this.Yo),l=Math.max(0,i-o);l>0&&an("ExponentialBackoff",`Backing off for ${l} ms (base delay: ${this.Ho} ms, delay with jitter: ${i} ms, last attempt: ${o} ms ago)`),this.Jo=this.Ti.enqueueAfterDelay(this.timerId,l,()=>(this.Yo=Date.now(),e())),this.Ho*=this.zo,this.Ho<this.Go&&(this.Ho=this.Go),this.Ho>this.jo&&(this.Ho=this.jo)}t_(){this.Jo!==null&&(this.Jo.skipDelay(),this.Jo=null)}cancel(){this.Jo!==null&&(this.Jo.cancel(),this.Jo=null)}e_(){return(Math.random()-.5)*this.Ho}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $J="PersistentStream";class Wse{constructor(e,i,o,l,u,f,_,E){this.Ti=e,this.n_=o,this.r_=l,this.connection=u,this.authCredentialsProvider=f,this.appCheckCredentialsProvider=_,this.listener=E,this.state=0,this.i_=0,this.s_=null,this.o_=null,this.stream=null,this.__=0,this.a_=new Bse(e,i)}u_(){return this.state===1||this.state===5||this.c_()}c_(){return this.state===2||this.state===3}start(){this.__=0,this.state!==4?this.auth():this.l_()}async stop(){this.u_()&&await this.close(0)}h_(){this.state=0,this.a_.reset()}P_(){this.c_()&&this.s_===null&&(this.s_=this.Ti.enqueueAfterDelay(this.n_,6e4,()=>this.T_()))}I_(e){this.E_(),this.stream.send(e)}async T_(){if(this.c_())return this.close(0)}E_(){this.s_&&(this.s_.cancel(),this.s_=null)}d_(){this.o_&&(this.o_.cancel(),this.o_=null)}async close(e,i){this.E_(),this.d_(),this.a_.cancel(),this.i_++,e!==4?this.a_.reset():i&&i.code===Ct.RESOURCE_EXHAUSTED?(rm(i.toString()),rm("Using maximum backoff delay to prevent overloading the backend."),this.a_.Zo()):i&&i.code===Ct.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.A_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.Lo(i)}A_(){}auth(){this.state=1;const e=this.R_(this.i_),i=this.i_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([o,l])=>{this.i_===i&&this.V_(o,l)},o=>{e(()=>{const l=new Qt(Ct.UNKNOWN,"Fetching auth token failed: "+o.message);return this.m_(l)})})}V_(e,i){const o=this.R_(this.i_);this.stream=this.f_(e,i),this.stream.xo(()=>{o(()=>this.listener.xo())}),this.stream.No(()=>{o(()=>(this.state=2,this.o_=this.Ti.enqueueAfterDelay(this.r_,1e4,()=>(this.c_()&&(this.state=3),Promise.resolve())),this.listener.No()))}),this.stream.Lo(l=>{o(()=>this.m_(l))}),this.stream.onMessage(l=>{o(()=>++this.__==1?this.g_(l):this.onNext(l))})}l_(){this.state=5,this.a_.Xo(async()=>{this.state=0,this.start()})}m_(e){return an($J,`close with error: ${e}`),this.stream=null,this.close(4,e)}R_(e){return i=>{this.Ti.enqueueAndForget(()=>this.i_===e?i():(an($J,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class x5e extends Wse{constructor(e,i,o,l,u,f){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",i,o,l,f),this.serializer=u}f_(e,i){return this.connection.Wo("Listen",e,i)}g_(e){return this.onNext(e)}onNext(e){this.a_.reset();const i=F3e(this.serializer,e),o=function(u){if(!("targetChange"in u))return Zn.min();const f=u.targetChange;return f.targetIds&&f.targetIds.length?Zn.min():f.readTime?wp(f.readTime):Zn.min()}(e);return this.listener.p_(i,o)}y_(e){const i={};i.database=fj(this.serializer),i.addTarget=function(u,f){let _;const E=f.target;if(_=lj(E)?{documents:z3e(u,E)}:{query:G3e(u,E).ht},_.targetId=f.targetId,f.resumeToken.approximateByteSize()>0){_.resumeToken=Ose(u,f.resumeToken);const b=dj(u,f.expectedCount);b!==null&&(_.expectedCount=b)}else if(f.snapshotVersion.compareTo(Zn.min())>0){_.readTime=g1(u,f.snapshotVersion.toTimestamp());const b=dj(u,f.expectedCount);b!==null&&(_.expectedCount=b)}return _}(this.serializer,e);const o=$3e(this.serializer,e);o&&(i.labels=o),this.I_(i)}w_(e){const i={};i.database=fj(this.serializer),i.removeTarget=e,this.I_(i)}}class L5e extends Wse{constructor(e,i,o,l,u,f){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",i,o,l,f),this.serializer=u}get S_(){return this.__>0}start(){this.lastStreamToken=void 0,super.start()}A_(){this.S_&&this.b_([])}f_(e,i){return this.connection.Wo("Write",e,i)}g_(e){return _i(!!e.streamToken),this.lastStreamToken=e.streamToken,_i(!e.writeResults||e.writeResults.length===0),this.listener.D_()}onNext(e){_i(!!e.streamToken),this.lastStreamToken=e.streamToken,this.a_.reset();const i=W3e(e.writeResults,e.commitTime),o=wp(e.commitTime);return this.listener.v_(o,i)}C_(){const e={};e.database=fj(this.serializer),this.I_(e)}b_(e){const i={streamToken:this.lastStreamToken,writes:e.map(o=>B3e(this.serializer,o))};this.I_(i)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class M5e{}class U5e extends M5e{constructor(e,i,o,l){super(),this.authCredentials=e,this.appCheckCredentials=i,this.connection=o,this.serializer=l,this.F_=!1}M_(){if(this.F_)throw new Qt(Ct.FAILED_PRECONDITION,"The client has already been terminated.")}So(e,i,o,l){return this.M_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([u,f])=>this.connection.So(e,hj(i,o),l,u,f)).catch(u=>{throw u.name==="FirebaseError"?(u.code===Ct.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),u):new Qt(Ct.UNKNOWN,u.toString())})}Co(e,i,o,l,u){return this.M_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([f,_])=>this.connection.Co(e,hj(i,o),l,f,_,u)).catch(f=>{throw f.name==="FirebaseError"?(f.code===Ct.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),f):new Qt(Ct.UNKNOWN,f.toString())})}terminate(){this.F_=!0,this.connection.terminate()}}class V5e{constructor(e,i){this.asyncQueue=e,this.onlineStateHandler=i,this.state="Unknown",this.x_=0,this.O_=null,this.N_=!0}B_(){this.x_===0&&(this.L_("Unknown"),this.O_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.O_=null,this.k_("Backend didn't respond within 10 seconds."),this.L_("Offline"),Promise.resolve())))}q_(e){this.state==="Online"?this.L_("Unknown"):(this.x_++,this.x_>=1&&(this.Q_(),this.k_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.L_("Offline")))}set(e){this.Q_(),this.x_=0,e==="Online"&&(this.N_=!1),this.L_(e)}L_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}k_(e){const i=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.N_?(rm(i),this.N_=!1):an("OnlineStateTracker",i)}Q_(){this.O_!==null&&(this.O_.cancel(),this.O_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sE="RemoteStore";class j5e{constructor(e,i,o,l,u){this.localStore=e,this.datastore=i,this.asyncQueue=o,this.remoteSyncer={},this.U_=[],this.K_=new Map,this.W_=new Set,this.G_=[],this.z_=u,this.z_.To(f=>{o.enqueueAndForget(async()=>{pE(this)&&(an(sE,"Restarting streams for network reachability change."),await async function(E){const b=rr(E);b.W_.add(4),await DR(b),b.j_.set("Unknown"),b.W_.delete(4),await TN(b)}(this))})}),this.j_=new V5e(o,l)}}async function TN(n){if(pE(n))for(const e of n.G_)await e(!0)}async function DR(n){for(const e of n.G_)await e(!1)}function zse(n,e){const i=rr(n);i.K_.has(e.targetId)||(i.K_.set(e.targetId,e),K4(i)?$4(i):ob(i).c_()&&H4(i,e))}function G4(n,e){const i=rr(n),o=ob(i);i.K_.delete(e),o.c_()&&Gse(i,e),i.K_.size===0&&(o.c_()?o.P_():pE(i)&&i.j_.set("Unknown"))}function H4(n,e){if(n.H_.Ne(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(Zn.min())>0){const i=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(i)}ob(n).y_(e)}function Gse(n,e){n.H_.Ne(e),ob(n).w_(e)}function $4(n){n.H_=new D3e({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),lt:e=>n.K_.get(e)||null,it:()=>n.datastore.serializer.databaseId}),ob(n).start(),n.j_.B_()}function K4(n){return pE(n)&&!ob(n).u_()&&n.K_.size>0}function pE(n){return rr(n).W_.size===0}function Hse(n){n.H_=void 0}async function F5e(n){n.j_.set("Online")}async function B5e(n){n.K_.forEach((e,i)=>{H4(n,e)})}async function W5e(n,e){Hse(n),K4(n)?(n.j_.q_(e),$4(n)):n.j_.set("Unknown")}async function z5e(n,e,i){if(n.j_.set("Online"),e instanceof Pse&&e.state===2&&e.cause)try{await async function(l,u){const f=u.cause;for(const _ of u.targetIds)l.K_.has(_)&&(await l.remoteSyncer.rejectListen(_,f),l.K_.delete(_),l.H_.removeTarget(_))}(n,e)}catch(o){an(sE,"Failed to remove targets %s: %s ",e.targetIds.join(","),o),await y1(n,o)}else if(e instanceof Dk?n.H_.We(e):e instanceof Ase?n.H_.Ze(e):n.H_.je(e),!i.isEqual(Zn.min()))try{const o=await Fse(n.localStore);i.compareTo(o)>=0&&await function(u,f){const _=u.H_.ot(f);return _.targetChanges.forEach((E,b)=>{if(E.resumeToken.approximateByteSize()>0){const C=u.K_.get(b);C&&u.K_.set(b,C.withResumeToken(E.resumeToken,f))}}),_.targetMismatches.forEach((E,b)=>{const C=u.K_.get(E);if(!C)return;u.K_.set(E,C.withResumeToken(Da.EMPTY_BYTE_STRING,C.snapshotVersion)),Gse(u,E);const I=new Ng(C.target,E,b,C.sequenceNumber);H4(u,I)}),u.remoteSyncer.applyRemoteEvent(_)}(n,i)}catch(o){an(sE,"Failed to raise snapshot:",o),await y1(n,o)}}async function y1(n,e,i){if(!sb(e))throw e;n.W_.add(1),await DR(n),n.j_.set("Offline"),i||(i=()=>Fse(n.localStore)),n.asyncQueue.enqueueRetryable(async()=>{an(sE,"Retrying IndexedDB access"),await i(),n.W_.delete(1),await TN(n)})}function $se(n,e){return e().catch(i=>y1(n,i,e))}async function CN(n){const e=rr(n),i=$g(e);let o=e.U_.length>0?e.U_[e.U_.length-1].batchId:O4;for(;G5e(e);)try{const l=await C5e(e.localStore,o);if(l===null){e.U_.length===0&&i.P_();break}o=l.batchId,H5e(e,l)}catch(l){await y1(e,l)}Kse(e)&&qse(e)}function G5e(n){return pE(n)&&n.U_.length<10}function H5e(n,e){n.U_.push(e);const i=$g(n);i.c_()&&i.S_&&i.b_(e.mutations)}function Kse(n){return pE(n)&&!$g(n).u_()&&n.U_.length>0}function qse(n){$g(n).start()}async function $5e(n){$g(n).C_()}async function K5e(n){const e=$g(n);for(const i of n.U_)e.b_(i.mutations)}async function q5e(n,e,i){const o=n.U_.shift(),l=U4.from(o,e,i);await $se(n,()=>n.remoteSyncer.applySuccessfulWrite(l)),await CN(n)}async function Y5e(n,e){e&&$g(n).S_&&await async function(o,l){if(function(f){return k3e(f)&&f!==Ct.ABORTED}(l.code)){const u=o.U_.shift();$g(o).h_(),await $se(o,()=>o.remoteSyncer.rejectFailedWrite(u.batchId,l)),await CN(o)}}(n,e),Kse(n)&&qse(n)}async function KJ(n,e){const i=rr(n);i.asyncQueue.verifyOperationInProgress(),an(sE,"RemoteStore received new credentials");const o=pE(i);i.W_.add(3),await DR(i),o&&i.j_.set("Unknown"),await i.remoteSyncer.handleCredentialChange(e),i.W_.delete(3),await TN(i)}async function X5e(n,e){const i=rr(n);e?(i.W_.delete(2),await TN(i)):e||(i.W_.add(2),await DR(i),i.j_.set("Unknown"))}function ob(n){return n.J_||(n.J_=function(i,o,l){const u=rr(i);return u.M_(),new x5e(o,u.connection,u.authCredentials,u.appCheckCredentials,u.serializer,l)}(n.datastore,n.asyncQueue,{xo:F5e.bind(null,n),No:B5e.bind(null,n),Lo:W5e.bind(null,n),p_:z5e.bind(null,n)}),n.G_.push(async e=>{e?(n.J_.h_(),K4(n)?$4(n):n.j_.set("Unknown")):(await n.J_.stop(),Hse(n))})),n.J_}function $g(n){return n.Y_||(n.Y_=function(i,o,l){const u=rr(i);return u.M_(),new L5e(o,u.connection,u.authCredentials,u.appCheckCredentials,u.serializer,l)}(n.datastore,n.asyncQueue,{xo:()=>Promise.resolve(),No:$5e.bind(null,n),Lo:Y5e.bind(null,n),D_:K5e.bind(null,n),v_:q5e.bind(null,n)}),n.G_.push(async e=>{e?(n.Y_.h_(),await CN(n)):(await n.Y_.stop(),n.U_.length>0&&(an(sE,`Stopping write stream with ${n.U_.length} pending writes`),n.U_=[]))})),n.Y_}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class q4{constructor(e,i,o,l,u){this.asyncQueue=e,this.timerId=i,this.targetTimeMs=o,this.op=l,this.removalCallback=u,this.deferred=new Yf,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(f=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,i,o,l,u){const f=Date.now()+o,_=new q4(e,i,f,l,u);return _.start(o),_}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new Qt(Ct.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Y4(n,e){if(rm("AsyncQueue",`${e}: ${n}`),sb(n))return new Qt(Ct.UNAVAILABLE,`${e}: ${n}`);throw n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class S0{static emptySet(e){return new S0(e.comparator)}constructor(e){this.comparator=e?(i,o)=>e(i,o)||Rn.comparator(i.key,o.key):(i,o)=>Rn.comparator(i.key,o.key),this.keyedMap=sC(),this.sortedSet=new ws(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const i=this.keyedMap.get(e);return i?this.sortedSet.indexOf(i):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((i,o)=>(e(i),!1))}add(e){const i=this.delete(e.key);return i.copy(i.keyedMap.insert(e.key,e),i.sortedSet.insert(e,null))}delete(e){const i=this.get(e);return i?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(i)):this}isEqual(e){if(!(e instanceof S0)||this.size!==e.size)return!1;const i=this.sortedSet.getIterator(),o=e.sortedSet.getIterator();for(;i.hasNext();){const l=i.getNext().key,u=o.getNext().key;if(!l.isEqual(u))return!1}return!0}toString(){const e=[];return this.forEach(i=>{e.push(i.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,i){const o=new S0;return o.comparator=this.comparator,o.keyedMap=e,o.sortedSet=i,o}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qJ{constructor(){this.Z_=new ws(Rn.comparator)}track(e){const i=e.doc.key,o=this.Z_.get(i);o?e.type!==0&&o.type===3?this.Z_=this.Z_.insert(i,e):e.type===3&&o.type!==1?this.Z_=this.Z_.insert(i,{type:o.type,doc:e.doc}):e.type===2&&o.type===2?this.Z_=this.Z_.insert(i,{type:2,doc:e.doc}):e.type===2&&o.type===0?this.Z_=this.Z_.insert(i,{type:0,doc:e.doc}):e.type===1&&o.type===0?this.Z_=this.Z_.remove(i):e.type===1&&o.type===2?this.Z_=this.Z_.insert(i,{type:1,doc:o.doc}):e.type===0&&o.type===1?this.Z_=this.Z_.insert(i,{type:2,doc:e.doc}):Yn():this.Z_=this.Z_.insert(i,e)}X_(){const e=[];return this.Z_.inorderTraversal((i,o)=>{e.push(o)}),e}}class H0{constructor(e,i,o,l,u,f,_,E,b){this.query=e,this.docs=i,this.oldDocs=o,this.docChanges=l,this.mutatedKeys=u,this.fromCache=f,this.syncStateChanged=_,this.excludesMetadataChanges=E,this.hasCachedResults=b}static fromInitialDocuments(e,i,o,l,u){const f=[];return i.forEach(_=>{f.push({type:0,doc:_})}),new H0(e,i,S0.emptySet(i),f,o,l,!0,!1,u)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&yN(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const i=this.docChanges,o=e.docChanges;if(i.length!==o.length)return!1;for(let l=0;l<i.length;l++)if(i[l].type!==o[l].type||!i[l].doc.isEqual(o[l].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class J5e{constructor(){this.ea=void 0,this.ta=[]}na(){return this.ta.some(e=>e.ra())}}class Q5e{constructor(){this.queries=YJ(),this.onlineState="Unknown",this.ia=new Set}terminate(){(function(i,o){const l=rr(i),u=l.queries;l.queries=YJ(),u.forEach((f,_)=>{for(const E of _.ta)E.onError(o)})})(this,new Qt(Ct.ABORTED,"Firestore shutting down"))}}function YJ(){return new hE(n=>fse(n),yN)}async function X4(n,e){const i=rr(n);let o=3;const l=e.query;let u=i.queries.get(l);u?!u.na()&&e.ra()&&(o=2):(u=new J5e,o=e.ra()?0:1);try{switch(o){case 0:u.ea=await i.onListen(l,!0);break;case 1:u.ea=await i.onListen(l,!1);break;case 2:await i.onFirstRemoteStoreListen(l)}}catch(f){const _=Y4(f,`Initialization of query '${BS(e.query)}' failed`);return void e.onError(_)}i.queries.set(l,u),u.ta.push(e),e.sa(i.onlineState),u.ea&&e.oa(u.ea)&&Q4(i)}async function J4(n,e){const i=rr(n),o=e.query;let l=3;const u=i.queries.get(o);if(u){const f=u.ta.indexOf(e);f>=0&&(u.ta.splice(f,1),u.ta.length===0?l=e.ra()?0:1:!u.na()&&e.ra()&&(l=2))}switch(l){case 0:return i.queries.delete(o),i.onUnlisten(o,!0);case 1:return i.queries.delete(o),i.onUnlisten(o,!1);case 2:return i.onLastRemoteStoreUnlisten(o);default:return}}function Z5e(n,e){const i=rr(n);let o=!1;for(const l of e){const u=l.query,f=i.queries.get(u);if(f){for(const _ of f.ta)_.oa(l)&&(o=!0);f.ea=l}}o&&Q4(i)}function eBe(n,e,i){const o=rr(n),l=o.queries.get(e);if(l)for(const u of l.ta)u.onError(i);o.queries.delete(e)}function Q4(n){n.ia.forEach(e=>{e.next()})}var _j,XJ;(XJ=_j||(_j={}))._a="default",XJ.Cache="cache";class Z4{constructor(e,i,o){this.query=e,this.aa=i,this.ua=!1,this.ca=null,this.onlineState="Unknown",this.options=o||{}}oa(e){if(!this.options.includeMetadataChanges){const o=[];for(const l of e.docChanges)l.type!==3&&o.push(l);e=new H0(e.query,e.docs,e.oldDocs,o,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let i=!1;return this.ua?this.la(e)&&(this.aa.next(e),i=!0):this.ha(e,this.onlineState)&&(this.Pa(e),i=!0),this.ca=e,i}onError(e){this.aa.error(e)}sa(e){this.onlineState=e;let i=!1;return this.ca&&!this.ua&&this.ha(this.ca,e)&&(this.Pa(this.ca),i=!0),i}ha(e,i){if(!e.fromCache||!this.ra())return!0;const o=i!=="Offline";return(!this.options.Ta||!o)&&(!e.docs.isEmpty()||e.hasCachedResults||i==="Offline")}la(e){if(e.docChanges.length>0)return!0;const i=this.ca&&this.ca.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!i)&&this.options.includeMetadataChanges===!0}Pa(e){e=H0.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.ua=!0,this.aa.next(e)}ra(){return this.options.source!==_j.Cache}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yse{constructor(e){this.key=e}}class Xse{constructor(e){this.key=e}}class tBe{constructor(e,i){this.query=e,this.fa=i,this.ga=null,this.hasCachedResults=!1,this.current=!1,this.pa=Dr(),this.mutatedKeys=Dr(),this.ya=mse(e),this.wa=new S0(this.ya)}get Sa(){return this.fa}ba(e,i){const o=i?i.Da:new qJ,l=i?i.wa:this.wa;let u=i?i.mutatedKeys:this.mutatedKeys,f=l,_=!1;const E=this.query.limitType==="F"&&l.size===this.query.limit?l.last():null,b=this.query.limitType==="L"&&l.size===this.query.limit?l.first():null;if(e.inorderTraversal((C,I)=>{const P=l.get(C),L=EN(this.query,I)?I:null,M=!!P&&this.mutatedKeys.has(P.key),F=!!L&&(L.hasLocalMutations||this.mutatedKeys.has(L.key)&&L.hasCommittedMutations);let B=!1;P&&L?P.data.isEqual(L.data)?M!==F&&(o.track({type:3,doc:L}),B=!0):this.va(P,L)||(o.track({type:2,doc:L}),B=!0,(E&&this.ya(L,E)>0||b&&this.ya(L,b)<0)&&(_=!0)):!P&&L?(o.track({type:0,doc:L}),B=!0):P&&!L&&(o.track({type:1,doc:P}),B=!0,(E||b)&&(_=!0)),B&&(L?(f=f.add(L),u=F?u.add(C):u.delete(C)):(f=f.delete(C),u=u.delete(C)))}),this.query.limit!==null)for(;f.size>this.query.limit;){const C=this.query.limitType==="F"?f.last():f.first();f=f.delete(C.key),u=u.delete(C.key),o.track({type:1,doc:C})}return{wa:f,Da:o,ls:_,mutatedKeys:u}}va(e,i){return e.hasLocalMutations&&i.hasCommittedMutations&&!i.hasLocalMutations}applyChanges(e,i,o,l){const u=this.wa;this.wa=e.wa,this.mutatedKeys=e.mutatedKeys;const f=e.Da.X_();f.sort((C,I)=>function(L,M){const F=B=>{switch(B){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Yn()}};return F(L)-F(M)}(C.type,I.type)||this.ya(C.doc,I.doc)),this.Ca(o),l=l!=null&&l;const _=i&&!l?this.Fa():[],E=this.pa.size===0&&this.current&&!l?1:0,b=E!==this.ga;return this.ga=E,f.length!==0||b?{snapshot:new H0(this.query,e.wa,u,f,e.mutatedKeys,E===0,b,!1,!!o&&o.resumeToken.approximateByteSize()>0),Ma:_}:{Ma:_}}sa(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({wa:this.wa,Da:new qJ,mutatedKeys:this.mutatedKeys,ls:!1},!1)):{Ma:[]}}xa(e){return!this.fa.has(e)&&!!this.wa.has(e)&&!this.wa.get(e).hasLocalMutations}Ca(e){e&&(e.addedDocuments.forEach(i=>this.fa=this.fa.add(i)),e.modifiedDocuments.forEach(i=>{}),e.removedDocuments.forEach(i=>this.fa=this.fa.delete(i)),this.current=e.current)}Fa(){if(!this.current)return[];const e=this.pa;this.pa=Dr(),this.wa.forEach(o=>{this.xa(o.key)&&(this.pa=this.pa.add(o.key))});const i=[];return e.forEach(o=>{this.pa.has(o)||i.push(new Xse(o))}),this.pa.forEach(o=>{e.has(o)||i.push(new Yse(o))}),i}Oa(e){this.fa=e.gs,this.pa=Dr();const i=this.ba(e.documents);return this.applyChanges(i,!0)}Na(){return H0.fromInitialDocuments(this.query,this.wa,this.mutatedKeys,this.ga===0,this.hasCachedResults)}}const e3="SyncEngine";class nBe{constructor(e,i,o){this.query=e,this.targetId=i,this.view=o}}class rBe{constructor(e){this.key=e,this.Ba=!1}}class iBe{constructor(e,i,o,l,u,f){this.localStore=e,this.remoteStore=i,this.eventManager=o,this.sharedClientState=l,this.currentUser=u,this.maxConcurrentLimboResolutions=f,this.La={},this.ka=new hE(_=>fse(_),yN),this.qa=new Map,this.Qa=new Set,this.$a=new ws(Rn.comparator),this.Ua=new Map,this.Ka=new F4,this.Wa={},this.Ga=new Map,this.za=G0.Kn(),this.onlineState="Unknown",this.ja=void 0}get isPrimaryClient(){return this.ja===!0}}async function sBe(n,e,i=!0){const o=noe(n);let l;const u=o.ka.get(e);return u?(o.sharedClientState.addLocalQueryTarget(u.targetId),l=u.view.Na()):l=await Jse(o,e,i,!0),l}async function oBe(n,e){const i=noe(n);await Jse(i,e,!0,!1)}async function Jse(n,e,i,o){const l=await R5e(n.localStore,bp(e)),u=l.targetId,f=n.sharedClientState.addLocalQueryTarget(u,i);let _;return o&&(_=await aBe(n,e,u,f==="current",l.resumeToken)),n.isPrimaryClient&&i&&zse(n.remoteStore,l),_}async function aBe(n,e,i,o,l){n.Ha=(I,P,L)=>async function(F,B,Z,K){let re=B.view.ba(Z);re.ls&&(re=await WJ(F.localStore,B.query,!1).then(({documents:X})=>B.view.ba(X,re)));const ae=K&&K.targetChanges.get(B.targetId),ne=K&&K.targetMismatches.get(B.targetId)!=null,pe=B.view.applyChanges(re,F.isPrimaryClient,ae,ne);return QJ(F,B.targetId,pe.Ma),pe.snapshot}(n,I,P,L);const u=await WJ(n.localStore,e,!0),f=new tBe(e,u.gs),_=f.ba(u.documents),E=NR.createSynthesizedTargetChangeForCurrentChange(i,o&&n.onlineState!=="Offline",l),b=f.applyChanges(_,n.isPrimaryClient,E);QJ(n,i,b.Ma);const C=new nBe(e,i,f);return n.ka.set(e,C),n.qa.has(i)?n.qa.get(i).push(e):n.qa.set(i,[e]),b.snapshot}async function cBe(n,e,i){const o=rr(n),l=o.ka.get(e),u=o.qa.get(l.targetId);if(u.length>1)return o.qa.set(l.targetId,u.filter(f=>!yN(f,e))),void o.ka.delete(e);o.isPrimaryClient?(o.sharedClientState.removeLocalQueryTarget(l.targetId),o.sharedClientState.isActiveQueryTarget(l.targetId)||await mj(o.localStore,l.targetId,!1).then(()=>{o.sharedClientState.clearQueryState(l.targetId),i&&G4(o.remoteStore,l.targetId),yj(o,l.targetId)}).catch(ib)):(yj(o,l.targetId),await mj(o.localStore,l.targetId,!0))}async function lBe(n,e){const i=rr(n),o=i.ka.get(e),l=i.qa.get(o.targetId);i.isPrimaryClient&&l.length===1&&(i.sharedClientState.removeLocalQueryTarget(o.targetId),G4(i.remoteStore,o.targetId))}async function uBe(n,e,i){const o=_Be(n);try{const l=await function(f,_){const E=rr(f),b=xo.now(),C=_.reduce((L,M)=>L.add(M.key),Dr());let I,P;return E.persistence.runTransaction("Locally write mutations","readwrite",L=>{let M=im(),F=Dr();return E.ds.getEntries(L,C).next(B=>{M=B,M.forEach((Z,K)=>{K.isValidDocument()||(F=F.add(Z))})}).next(()=>E.localDocuments.getOverlayedDocuments(L,M)).next(B=>{I=B;const Z=[];for(const K of _){const re=R3e(K,I.get(K.key).overlayedDocument);re!=null&&Z.push(new t_(K.key,re,ase(re.value.mapValue),Yu.exists(!0)))}return E.mutationQueue.addMutationBatch(L,b,Z,_)}).next(B=>{P=B;const Z=B.applyToLocalDocumentSet(I,F);return E.documentOverlayCache.saveOverlays(L,B.batchId,Z)})}).then(()=>({batchId:P.batchId,changes:_se(I)}))}(o.localStore,e);o.sharedClientState.addPendingMutation(l.batchId),function(f,_,E){let b=f.Wa[f.currentUser.toKey()];b||(b=new ws(vr)),b=b.insert(_,E),f.Wa[f.currentUser.toKey()]=b}(o,l.batchId,i),await xR(o,l.changes),await CN(o.remoteStore)}catch(l){const u=Y4(l,"Failed to persist write");i.reject(u)}}async function Qse(n,e){const i=rr(n);try{const o=await w5e(i.localStore,e);e.targetChanges.forEach((l,u)=>{const f=i.Ua.get(u);f&&(_i(l.addedDocuments.size+l.modifiedDocuments.size+l.removedDocuments.size<=1),l.addedDocuments.size>0?f.Ba=!0:l.modifiedDocuments.size>0?_i(f.Ba):l.removedDocuments.size>0&&(_i(f.Ba),f.Ba=!1))}),await xR(i,o,e)}catch(o){await ib(o)}}function JJ(n,e,i){const o=rr(n);if(o.isPrimaryClient&&i===0||!o.isPrimaryClient&&i===1){const l=[];o.ka.forEach((u,f)=>{const _=f.view.sa(e);_.snapshot&&l.push(_.snapshot)}),function(f,_){const E=rr(f);E.onlineState=_;let b=!1;E.queries.forEach((C,I)=>{for(const P of I.ta)P.sa(_)&&(b=!0)}),b&&Q4(E)}(o.eventManager,e),l.length&&o.La.p_(l),o.onlineState=e,o.isPrimaryClient&&o.sharedClientState.setOnlineState(e)}}async function dBe(n,e,i){const o=rr(n);o.sharedClientState.updateQueryState(e,"rejected",i);const l=o.Ua.get(e),u=l&&l.key;if(u){let f=new ws(Rn.comparator);f=f.insert(u,oc.newNoDocument(u,Zn.min()));const _=Dr().add(u),E=new bN(Zn.min(),new Map,new ws(vr),f,_);await Qse(o,E),o.$a=o.$a.remove(u),o.Ua.delete(e),t3(o)}else await mj(o.localStore,e,!1).then(()=>yj(o,e,i)).catch(ib)}async function hBe(n,e){const i=rr(n),o=e.batch.batchId;try{const l=await b5e(i.localStore,e);eoe(i,o,null),Zse(i,o),i.sharedClientState.updateMutationState(o,"acknowledged"),await xR(i,l)}catch(l){await ib(l)}}async function pBe(n,e,i){const o=rr(n);try{const l=await function(f,_){const E=rr(f);return E.persistence.runTransaction("Reject batch","readwrite-primary",b=>{let C;return E.mutationQueue.lookupMutationBatch(b,_).next(I=>(_i(I!==null),C=I.keys(),E.mutationQueue.removeMutationBatch(b,I))).next(()=>E.mutationQueue.performConsistencyCheck(b)).next(()=>E.documentOverlayCache.removeOverlaysForBatchId(b,C,_)).next(()=>E.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(b,C)).next(()=>E.localDocuments.getDocuments(b,C))})}(o.localStore,e);eoe(o,e,i),Zse(o,e),o.sharedClientState.updateMutationState(e,"rejected",i),await xR(o,l)}catch(l){await ib(l)}}function Zse(n,e){(n.Ga.get(e)||[]).forEach(i=>{i.resolve()}),n.Ga.delete(e)}function eoe(n,e,i){const o=rr(n);let l=o.Wa[o.currentUser.toKey()];if(l){const u=l.get(e);u&&(i?u.reject(i):u.resolve(),l=l.remove(e)),o.Wa[o.currentUser.toKey()]=l}}function yj(n,e,i=null){n.sharedClientState.removeLocalQueryTarget(e);for(const o of n.qa.get(e))n.ka.delete(o),i&&n.La.Ja(o,i);n.qa.delete(e),n.isPrimaryClient&&n.Ka.br(e).forEach(o=>{n.Ka.containsKey(o)||toe(n,o)})}function toe(n,e){n.Qa.delete(e.path.canonicalString());const i=n.$a.get(e);i!==null&&(G4(n.remoteStore,i),n.$a=n.$a.remove(e),n.Ua.delete(i),t3(n))}function QJ(n,e,i){for(const o of i)o instanceof Yse?(n.Ka.addReference(o.key,e),fBe(n,o)):o instanceof Xse?(an(e3,"Document no longer in limbo: "+o.key),n.Ka.removeReference(o.key,e),n.Ka.containsKey(o.key)||toe(n,o.key)):Yn()}function fBe(n,e){const i=e.key,o=i.path.canonicalString();n.$a.get(i)||n.Qa.has(o)||(an(e3,"New document in limbo: "+i),n.Qa.add(o),t3(n))}function t3(n){for(;n.Qa.size>0&&n.$a.size<n.maxConcurrentLimboResolutions;){const e=n.Qa.values().next().value;n.Qa.delete(e);const i=new Rn(Ki.fromString(e)),o=n.za.next();n.Ua.set(o,new rBe(i)),n.$a=n.$a.insert(i,o),zse(n.remoteStore,new Ng(bp(_N(i.path)),o,"TargetPurposeLimboResolution",pN.ae))}}async function xR(n,e,i){const o=rr(n),l=[],u=[],f=[];o.ka.isEmpty()||(o.ka.forEach((_,E)=>{f.push(o.Ha(E,e,i).then(b=>{var C;if((b||i)&&o.isPrimaryClient){const I=b?!b.fromCache:(C=i==null?void 0:i.targetChanges.get(E.targetId))===null||C===void 0?void 0:C.current;o.sharedClientState.updateQueryState(E.targetId,I?"current":"not-current")}if(b){l.push(b);const I=W4.Yi(E.targetId,b);u.push(I)}}))}),await Promise.all(f),o.La.p_(l),await async function(E,b){const C=rr(E);try{await C.persistence.runTransaction("notifyLocalViewChanges","readwrite",I=>Ot.forEach(b,P=>Ot.forEach(P.Hi,L=>C.persistence.referenceDelegate.addReference(I,P.targetId,L)).next(()=>Ot.forEach(P.Ji,L=>C.persistence.referenceDelegate.removeReference(I,P.targetId,L)))))}catch(I){if(!sb(I))throw I;an(z4,"Failed to update sequence numbers: "+I)}for(const I of b){const P=I.targetId;if(!I.fromCache){const L=C.Ts.get(P),M=L.snapshotVersion,F=L.withLastLimboFreeSnapshotVersion(M);C.Ts=C.Ts.insert(P,F)}}}(o.localStore,u))}async function mBe(n,e){const i=rr(n);if(!i.currentUser.isEqual(e)){an(e3,"User change. New user:",e.toKey());const o=await jse(i.localStore,e);i.currentUser=e,function(u,f){u.Ga.forEach(_=>{_.forEach(E=>{E.reject(new Qt(Ct.CANCELLED,f))})}),u.Ga.clear()}(i,"'waitForPendingWrites' promise is rejected due to a user change."),i.sharedClientState.handleUserChange(e,o.removedBatchIds,o.addedBatchIds),await xR(i,o.Rs)}}function gBe(n,e){const i=rr(n),o=i.Ua.get(e);if(o&&o.Ba)return Dr().add(o.key);{let l=Dr();const u=i.qa.get(e);if(!u)return l;for(const f of u){const _=i.ka.get(f);l=l.unionWith(_.view.Sa)}return l}}function noe(n){const e=rr(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=Qse.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=gBe.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=dBe.bind(null,e),e.La.p_=Z5e.bind(null,e.eventManager),e.La.Ja=eBe.bind(null,e.eventManager),e}function _Be(n){const e=rr(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=hBe.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=pBe.bind(null,e),e}class E1{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=wN(e.databaseInfo.databaseId),this.sharedClientState=this.Za(e),this.persistence=this.Xa(e),await this.persistence.start(),this.localStore=this.eu(e),this.gcScheduler=this.tu(e,this.localStore),this.indexBackfillerScheduler=this.nu(e,this.localStore)}tu(e,i){return null}nu(e,i){return null}eu(e){return S5e(this.persistence,new y5e,e.initialUser,this.serializer)}Xa(e){return new Vse(B4.ri,this.serializer)}Za(e){return new A5e}async terminate(){var e,i;(e=this.gcScheduler)===null||e===void 0||e.stop(),(i=this.indexBackfillerScheduler)===null||i===void 0||i.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}E1.provider={build:()=>new E1};class yBe extends E1{constructor(e){super(),this.cacheSizeBytes=e}tu(e,i){_i(this.persistence.referenceDelegate instanceof _1);const o=this.persistence.referenceDelegate.garbageCollector;return new r5e(o,e.asyncQueue,i)}Xa(e){const i=this.cacheSizeBytes!==void 0?pl.withCacheSize(this.cacheSizeBytes):pl.DEFAULT;return new Vse(o=>_1.ri(o,i),this.serializer)}}class Ej{async initialize(e,i){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(i),this.remoteStore=this.createRemoteStore(i),this.eventManager=this.createEventManager(i),this.syncEngine=this.createSyncEngine(i,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=o=>JJ(this.syncEngine,o,1),this.remoteStore.remoteSyncer.handleCredentialChange=mBe.bind(null,this.syncEngine),await X5e(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return function(){return new Q5e}()}createDatastore(e){const i=wN(e.databaseInfo.databaseId),o=function(u){return new D5e(u)}(e.databaseInfo);return function(u,f,_,E){return new U5e(u,f,_,E)}(e.authCredentials,e.appCheckCredentials,o,i)}createRemoteStore(e){return function(o,l,u,f,_){return new j5e(o,l,u,f,_)}(this.localStore,this.datastore,e.asyncQueue,i=>JJ(this.syncEngine,i,0),function(){return HJ.D()?new HJ:new P5e}())}createSyncEngine(e,i){return function(l,u,f,_,E,b,C){const I=new iBe(l,u,f,_,E,b);return C&&(I.ja=!0),I}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,i)}async terminate(){var e,i;await async function(l){const u=rr(l);an(sE,"RemoteStore shutting down."),u.W_.add(5),await DR(u),u.z_.shutdown(),u.j_.set("Unknown")}(this.remoteStore),(e=this.datastore)===null||e===void 0||e.terminate(),(i=this.eventManager)===null||i===void 0||i.terminate()}}Ej.provider={build:()=>new Ej};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class n3{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.iu(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.iu(this.observer.error,e):rm("Uncaught Error in snapshot listener:",e.toString()))}su(){this.muted=!0}iu(e,i){setTimeout(()=>{this.muted||e(i)},0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Kg="FirestoreClient";class EBe{constructor(e,i,o,l,u){this.authCredentials=e,this.appCheckCredentials=i,this.asyncQueue=o,this.databaseInfo=l,this.user=sc.UNAUTHENTICATED,this.clientId=Jie.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=u,this.authCredentials.start(o,async f=>{an(Kg,"Received user=",f.uid),await this.authCredentialListener(f),this.user=f}),this.appCheckCredentials.start(o,f=>(an(Kg,"Received new app check token=",f),this.appCheckCredentialListener(f,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new Yf;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(i){const o=Y4(i,"Failed to shutdown persistence");e.reject(o)}}),e.promise}}async function UU(n,e){n.asyncQueue.verifyOperationInProgress(),an(Kg,"Initializing OfflineComponentProvider");const i=n.configuration;await e.initialize(i);let o=i.initialUser;n.setCredentialChangeListener(async l=>{o.isEqual(l)||(await jse(e.localStore,l),o=l)}),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=e}async function ZJ(n,e){n.asyncQueue.verifyOperationInProgress();const i=await vBe(n);an(Kg,"Initializing OnlineComponentProvider"),await e.initialize(i,n.configuration),n.setCredentialChangeListener(o=>KJ(e.remoteStore,o)),n.setAppCheckTokenChangeListener((o,l)=>KJ(e.remoteStore,l)),n._onlineComponents=e}async function vBe(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){an(Kg,"Using user provided OfflineComponentProvider");try{await UU(n,n._uninitializedComponentsProvider._offline)}catch(e){const i=e;if(!function(l){return l.name==="FirebaseError"?l.code===Ct.FAILED_PRECONDITION||l.code===Ct.UNIMPLEMENTED:!(typeof DOMException<"u"&&l instanceof DOMException)||l.code===22||l.code===20||l.code===11}(i))throw i;U0("Error using user provided cache. Falling back to memory cache: "+i),await UU(n,new E1)}}else an(Kg,"Using default OfflineComponentProvider"),await UU(n,new yBe(void 0));return n._offlineComponents}async function roe(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(an(Kg,"Using user provided OnlineComponentProvider"),await ZJ(n,n._uninitializedComponentsProvider._online)):(an(Kg,"Using default OnlineComponentProvider"),await ZJ(n,new Ej))),n._onlineComponents}function SBe(n){return roe(n).then(e=>e.syncEngine)}async function v1(n){const e=await roe(n),i=e.eventManager;return i.onListen=sBe.bind(null,e.syncEngine),i.onUnlisten=cBe.bind(null,e.syncEngine),i.onFirstRemoteStoreListen=oBe.bind(null,e.syncEngine),i.onLastRemoteStoreUnlisten=lBe.bind(null,e.syncEngine),i}function bBe(n,e,i={}){const o=new Yf;return n.asyncQueue.enqueueAndForget(async()=>function(u,f,_,E,b){const C=new n3({next:P=>{C.su(),f.enqueueAndForget(()=>J4(u,I));const L=P.docs.has(_);!L&&P.fromCache?b.reject(new Qt(Ct.UNAVAILABLE,"Failed to get document because the client is offline.")):L&&P.fromCache&&E&&E.source==="server"?b.reject(new Qt(Ct.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):b.resolve(P)},error:P=>b.reject(P)}),I=new Z4(_N(_.path),C,{includeMetadataChanges:!0,Ta:!0});return X4(u,I)}(await v1(n),n.asyncQueue,e,i,o)),o.promise}function wBe(n,e,i={}){const o=new Yf;return n.asyncQueue.enqueueAndForget(async()=>function(u,f,_,E,b){const C=new n3({next:P=>{C.su(),f.enqueueAndForget(()=>J4(u,I)),P.fromCache&&E.source==="server"?b.reject(new Qt(Ct.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):b.resolve(P)},error:P=>b.reject(P)}),I=new Z4(_,C,{includeMetadataChanges:!0,Ta:!0});return X4(u,I)}(await v1(n),n.asyncQueue,e,i,o)),o.promise}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ioe(n){const e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const eQ=new Map;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function soe(n,e,i){if(!i)throw new Qt(Ct.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function TBe(n,e,i,o){if(e===!0&&o===!0)throw new Qt(Ct.INVALID_ARGUMENT,`${n} and ${i} cannot be used together.`)}function tQ(n){if(!Rn.isDocumentKey(n))throw new Qt(Ct.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function nQ(n){if(Rn.isDocumentKey(n))throw new Qt(Ct.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function RN(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{const e=function(o){return o.constructor?o.constructor.name:null}(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":Yn()}function El(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new Qt(Ct.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const i=RN(n);throw new Qt(Ct.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${i}`)}}return n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ooe="firestore.googleapis.com",rQ=!0;class iQ{constructor(e){var i,o;if(e.host===void 0){if(e.ssl!==void 0)throw new Qt(Ct.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=ooe,this.ssl=rQ}else this.host=e.host,this.ssl=(i=e.ssl)!==null&&i!==void 0?i:rQ;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=Use;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<t5e)throw new Qt(Ct.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}TBe("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=ioe((o=e.experimentalLongPollingOptions)!==null&&o!==void 0?o:{}),function(u){if(u.timeoutSeconds!==void 0){if(isNaN(u.timeoutSeconds))throw new Qt(Ct.INVALID_ARGUMENT,`invalid long polling timeout: ${u.timeoutSeconds} (must not be NaN)`);if(u.timeoutSeconds<5)throw new Qt(Ct.INVALID_ARGUMENT,`invalid long polling timeout: ${u.timeoutSeconds} (minimum allowed value is 5)`);if(u.timeoutSeconds>30)throw new Qt(Ct.INVALID_ARGUMENT,`invalid long polling timeout: ${u.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(o,l){return o.timeoutSeconds===l.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class IN{constructor(e,i,o,l){this._authCredentials=e,this._appCheckCredentials=i,this._databaseId=o,this._app=l,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new iQ({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new Qt(Ct.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new Qt(Ct.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new iQ(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=function(o){if(!o)return new N4e;switch(o.type){case"firstParty":return new M4e(o.sessionIndex||"0",o.iamToken||null,o.authTokenFactory||null);case"provider":return o.client;default:throw new Qt(Ct.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(i){const o=eQ.get(i);o&&(an("ComponentProvider","Removing Datastore"),eQ.delete(i),o.terminate())}(this),Promise.resolve()}}function CBe(n,e,i,o={}){var l;const u=(n=El(n,IN))._getSettings(),f=Object.assign(Object.assign({},u),{emulatorOptions:n._getEmulatorOptions()}),_=`${e}:${i}`;u.host!==ooe&&u.host!==_&&U0("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const E=Object.assign(Object.assign({},u),{host:_,ssl:!1,emulatorOptions:o});if(!em(E,f)&&(n._setSettings(E),o.mockUserToken)){let b,C;if(typeof o.mockUserToken=="string")b=o.mockUserToken,C=sc.MOCK_USER;else{b=eie(o.mockUserToken,(l=n._app)===null||l===void 0?void 0:l.options.projectId);const I=o.mockUserToken.sub||o.mockUserToken.user_id;if(!I)throw new Qt(Ct.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");C=new sc(I)}n._authCredentials=new D4e(new Yie(b,C))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Op{constructor(e,i,o){this.converter=i,this._query=o,this.type="query",this.firestore=e}withConverter(e){return new Op(this.firestore,e,this._query)}}class cc{constructor(e,i,o){this.converter=i,this._key=o,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Ug(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new cc(this.firestore,e,this._key)}}class Ug extends Op{constructor(e,i,o){super(e,i,_N(o)),this._path=o,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new cc(this.firestore,null,new Rn(e))}withConverter(e){return new Ug(this.firestore,e,this._path)}}function Sl(n,e,...i){if(n=qi(n),soe("collection","path",e),n instanceof IN){const o=Ki.fromString(e,...i);return nQ(o),new Ug(n,null,o)}{if(!(n instanceof cc||n instanceof Ug))throw new Qt(Ct.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const o=n._path.child(Ki.fromString(e,...i));return nQ(o),new Ug(n.firestore,null,o)}}function dr(n,e,...i){if(n=qi(n),arguments.length===1&&(e=Jie.newId()),soe("doc","path",e),n instanceof IN){const o=Ki.fromString(e,...i);return tQ(o),new cc(n,null,new Rn(o))}{if(!(n instanceof cc||n instanceof Ug))throw new Qt(Ct.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const o=n._path.child(Ki.fromString(e,...i));return tQ(o),new cc(n.firestore,n instanceof Ug?n.converter:null,new Rn(o))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sQ="AsyncQueue";class oQ{constructor(e=Promise.resolve()){this.Vu=[],this.mu=!1,this.fu=[],this.gu=null,this.pu=!1,this.yu=!1,this.wu=[],this.a_=new Bse(this,"async_queue_retry"),this.Su=()=>{const o=MU();o&&an(sQ,"Visibility state changed to "+o.visibilityState),this.a_.t_()},this.bu=e;const i=MU();i&&typeof i.addEventListener=="function"&&i.addEventListener("visibilitychange",this.Su)}get isShuttingDown(){return this.mu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.Du(),this.vu(e)}enterRestrictedMode(e){if(!this.mu){this.mu=!0,this.yu=e||!1;const i=MU();i&&typeof i.removeEventListener=="function"&&i.removeEventListener("visibilitychange",this.Su)}}enqueue(e){if(this.Du(),this.mu)return new Promise(()=>{});const i=new Yf;return this.vu(()=>this.mu&&this.yu?Promise.resolve():(e().then(i.resolve,i.reject),i.promise)).then(()=>i.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Vu.push(e),this.Cu()))}async Cu(){if(this.Vu.length!==0){try{await this.Vu[0](),this.Vu.shift(),this.a_.reset()}catch(e){if(!sb(e))throw e;an(sQ,"Operation failed with retryable error: "+e)}this.Vu.length>0&&this.a_.Xo(()=>this.Cu())}}vu(e){const i=this.bu.then(()=>(this.pu=!0,e().catch(o=>{this.gu=o,this.pu=!1;const l=function(f){let _=f.message||"";return f.stack&&(_=f.stack.includes(f.message)?f.stack:f.message+`
`+f.stack),_}(o);throw rm("INTERNAL UNHANDLED ERROR: ",l),o}).then(o=>(this.pu=!1,o))));return this.bu=i,i}enqueueAfterDelay(e,i,o){this.Du(),this.wu.indexOf(e)>-1&&(i=0);const l=q4.createAndSchedule(this,e,i,o,u=>this.Fu(u));return this.fu.push(l),l}Du(){this.gu&&Yn()}verifyOperationInProgress(){}async Mu(){let e;do e=this.bu,await e;while(e!==this.bu)}xu(e){for(const i of this.fu)if(i.timerId===e)return!0;return!1}Ou(e){return this.Mu().then(()=>{this.fu.sort((i,o)=>i.targetTimeMs-o.targetTimeMs);for(const i of this.fu)if(i.skipDelay(),e!=="all"&&i.timerId===e)break;return this.Mu()})}Nu(e){this.wu.push(e)}Fu(e){const i=this.fu.indexOf(e);this.fu.splice(i,1)}}function aQ(n){return function(i,o){if(typeof i!="object"||i===null)return!1;const l=i;for(const u of o)if(u in l&&typeof l[u]=="function")return!0;return!1}(n,["next","error","complete"])}class sm extends IN{constructor(e,i,o,l){super(e,i,o,l),this.type="firestore",this._queue=new oQ,this._persistenceKey=(l==null?void 0:l.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new oQ(e),this._firestoreClient=void 0,await e}}}function vj(n,e){const i=typeof n=="object"?n:v4(),o=typeof n=="string"?n:u1,l=cN(i,"firestore").getImmediate({identifier:o});if(!l._initialized){const u=Jre("firestore");u&&CBe(l,...u)}return l}function AN(n){if(n._terminated)throw new Qt(Ct.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||RBe(n),n._firestoreClient}function RBe(n){var e,i,o;const l=n._freezeSettings(),u=function(_,E,b,C){return new J4e(_,E,b,C.host,C.ssl,C.experimentalForceLongPolling,C.experimentalAutoDetectLongPolling,ioe(C.experimentalLongPollingOptions),C.useFetchStreams)}(n._databaseId,((e=n._app)===null||e===void 0?void 0:e.options.appId)||"",n._persistenceKey,l);n._componentsProvider||!((i=l.localCache)===null||i===void 0)&&i._offlineComponentProvider&&(!((o=l.localCache)===null||o===void 0)&&o._onlineComponentProvider)&&(n._componentsProvider={_offline:l.localCache._offlineComponentProvider,_online:l.localCache._onlineComponentProvider}),n._firestoreClient=new EBe(n._authCredentials,n._appCheckCredentials,n._queue,u,n._componentsProvider&&function(_){const E=_==null?void 0:_._online.build();return{_offline:_==null?void 0:_._offline.build(E),_online:E}}(n._componentsProvider))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $0{constructor(e){this._byteString=e}static fromBase64String(e){try{return new $0(Da.fromBase64String(e))}catch(i){throw new Qt(Ct.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+i)}}static fromUint8Array(e){return new $0(Da.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PN{constructor(...e){for(let i=0;i<e.length;++i)if(e[i].length===0)throw new Qt(Ct.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Na(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class LR{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class r3{constructor(e,i){if(!isFinite(e)||e<-90||e>90)throw new Qt(Ct.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(i)||i<-180||i>180)throw new Qt(Ct.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+i);this._lat=e,this._long=i}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return vr(this._lat,e._lat)||vr(this._long,e._long)}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class i3{constructor(e){this._values=(e||[]).map(i=>i)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(o,l){if(o.length!==l.length)return!1;for(let u=0;u<o.length;++u)if(o[u]!==l[u])return!1;return!0}(this._values,e._values)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const IBe=/^__.*__$/;class ABe{constructor(e,i,o){this.data=e,this.fieldMask=i,this.fieldTransforms=o}toMutation(e,i){return this.fieldMask!==null?new t_(e,this.data,this.fieldMask,i,this.fieldTransforms):new kR(e,this.data,i,this.fieldTransforms)}}class aoe{constructor(e,i,o){this.data=e,this.fieldMask=i,this.fieldTransforms=o}toMutation(e,i){return new t_(e,this.data,this.fieldMask,i,this.fieldTransforms)}}function coe(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Yn()}}class ON{constructor(e,i,o,l,u,f){this.settings=e,this.databaseId=i,this.serializer=o,this.ignoreUndefinedProperties=l,u===void 0&&this.Bu(),this.fieldTransforms=u||[],this.fieldMask=f||[]}get path(){return this.settings.path}get Lu(){return this.settings.Lu}ku(e){return new ON(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}qu(e){var i;const o=(i=this.path)===null||i===void 0?void 0:i.child(e),l=this.ku({path:o,Qu:!1});return l.$u(e),l}Uu(e){var i;const o=(i=this.path)===null||i===void 0?void 0:i.child(e),l=this.ku({path:o,Qu:!1});return l.Bu(),l}Ku(e){return this.ku({path:void 0,Qu:!0})}Wu(e){return S1(e,this.settings.methodName,this.settings.Gu||!1,this.path,this.settings.zu)}contains(e){return this.fieldMask.find(i=>e.isPrefixOf(i))!==void 0||this.fieldTransforms.find(i=>e.isPrefixOf(i.field))!==void 0}Bu(){if(this.path)for(let e=0;e<this.path.length;e++)this.$u(this.path.get(e))}$u(e){if(e.length===0)throw this.Wu("Document fields must not be empty");if(coe(this.Lu)&&IBe.test(e))throw this.Wu('Document fields cannot begin and end with "__"')}}class PBe{constructor(e,i,o){this.databaseId=e,this.ignoreUndefinedProperties=i,this.serializer=o||wN(e)}ju(e,i,o,l=!1){return new ON({Lu:e,methodName:i,zu:o,path:Na.emptyPath(),Qu:!1,Gu:l},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function MR(n){const e=n._freezeSettings(),i=wN(n._databaseId);return new PBe(n._databaseId,!!e.ignoreUndefinedProperties,i)}function loe(n,e,i,o,l,u={}){const f=n.ju(u.merge||u.mergeFields?2:0,e,i,l);a3("Data must be an object, but it was:",f,o);const _=hoe(o,f);let E,b;if(u.merge)E=new ql(f.fieldMask),b=f.fieldTransforms;else if(u.mergeFields){const C=[];for(const I of u.mergeFields){const P=Sj(e,I,i);if(!f.contains(P))throw new Qt(Ct.INVALID_ARGUMENT,`Field '${P}' is specified in your field mask but missing from your input data.`);foe(C,P)||C.push(P)}E=new ql(C),b=f.fieldTransforms.filter(I=>E.covers(I.field))}else E=null,b=f.fieldTransforms;return new ABe(new ml(_),E,b)}class kN extends LR{_toFieldTransform(e){if(e.Lu!==2)throw e.Lu===1?e.Wu(`${this._methodName}() can only appear at the top level of your update data`):e.Wu(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof kN}}function uoe(n,e,i){return new ON({Lu:3,zu:e.settings.zu,methodName:n._methodName,Qu:i},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}class s3 extends LR{constructor(e,i){super(e),this.Hu=i}_toFieldTransform(e){const i=uoe(this,e,!0),o=this.Hu.map(u=>fE(u,i)),l=new W0(o);return new Tse(e.path,l)}isEqual(e){return e instanceof s3&&em(this.Hu,e.Hu)}}class o3 extends LR{constructor(e,i){super(e),this.Hu=i}_toFieldTransform(e){const i=uoe(this,e,!0),o=this.Hu.map(u=>fE(u,i)),l=new z0(o);return new Tse(e.path,l)}isEqual(e){return e instanceof o3&&em(this.Hu,e.Hu)}}function OBe(n,e,i,o){const l=n.ju(1,e,i);a3("Data must be an object, but it was:",l,o);const u=[],f=ml.empty();e_(o,(E,b)=>{const C=c3(e,E,i);b=qi(b);const I=l.Uu(C);if(b instanceof kN)u.push(C);else{const P=fE(b,I);P!=null&&(u.push(C),f.set(C,P))}});const _=new ql(u);return new aoe(f,_,l.fieldTransforms)}function kBe(n,e,i,o,l,u){const f=n.ju(1,e,i),_=[Sj(e,o,i)],E=[l];if(u.length%2!=0)throw new Qt(Ct.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let P=0;P<u.length;P+=2)_.push(Sj(e,u[P])),E.push(u[P+1]);const b=[],C=ml.empty();for(let P=_.length-1;P>=0;--P)if(!foe(b,_[P])){const L=_[P];let M=E[P];M=qi(M);const F=f.Uu(L);if(M instanceof kN)b.push(L);else{const B=fE(M,F);B!=null&&(b.push(L),C.set(L,B))}}const I=new ql(b);return new aoe(C,I,f.fieldTransforms)}function doe(n,e,i,o=!1){return fE(i,n.ju(o?4:3,e))}function fE(n,e){if(poe(n=qi(n)))return a3("Unsupported field value:",e,n),hoe(n,e);if(n instanceof LR)return function(o,l){if(!coe(l.Lu))throw l.Wu(`${o._methodName}() can only be used with update() and set()`);if(!l.path)throw l.Wu(`${o._methodName}() is not currently supported inside arrays`);const u=o._toFieldTransform(l);u&&l.fieldTransforms.push(u)}(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.Qu&&e.Lu!==4)throw e.Wu("Nested arrays are not supported");return function(o,l){const u=[];let f=0;for(const _ of o){let E=fE(_,l.Ku(f));E==null&&(E={nullValue:"NULL_VALUE"}),u.push(E),f++}return{arrayValue:{values:u}}}(n,e)}return function(o,l){if((o=qi(o))===null)return{nullValue:"NULL_VALUE"};if(typeof o=="number")return v3e(l.serializer,o);if(typeof o=="boolean")return{booleanValue:o};if(typeof o=="string")return{stringValue:o};if(o instanceof Date){const u=xo.fromDate(o);return{timestampValue:g1(l.serializer,u)}}if(o instanceof xo){const u=new xo(o.seconds,1e3*Math.floor(o.nanoseconds/1e3));return{timestampValue:g1(l.serializer,u)}}if(o instanceof r3)return{geoPointValue:{latitude:o.latitude,longitude:o.longitude}};if(o instanceof $0)return{bytesValue:Ose(l.serializer,o._byteString)};if(o instanceof cc){const u=l.databaseId,f=o.firestore._databaseId;if(!f.isEqual(u))throw l.Wu(`Document reference is for database ${f.projectId}/${f.database} but should be for database ${u.projectId}/${u.database}`);return{referenceValue:j4(o.firestore._databaseId||l.databaseId,o._key.path)}}if(o instanceof i3)return function(f,_){return{mapValue:{fields:{[sse]:{stringValue:ose},[d1]:{arrayValue:{values:f.toArray().map(b=>{if(typeof b!="number")throw _.Wu("VectorValues must only contain numeric values.");return L4(_.serializer,b)})}}}}}}(o,l);throw l.Wu(`Unsupported field value: ${RN(o)}`)}(n,e)}function hoe(n,e){const i={};return Zie(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):e_(n,(o,l)=>{const u=fE(l,e.qu(o));u!=null&&(i[o]=u)}),{mapValue:{fields:i}}}function poe(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof xo||n instanceof r3||n instanceof $0||n instanceof cc||n instanceof LR||n instanceof i3)}function a3(n,e,i){if(!poe(i)||!function(l){return typeof l=="object"&&l!==null&&(Object.getPrototypeOf(l)===Object.prototype||Object.getPrototypeOf(l)===null)}(i)){const o=RN(i);throw o==="an object"?e.Wu(n+" a custom object"):e.Wu(n+" "+o)}}function Sj(n,e,i){if((e=qi(e))instanceof PN)return e._internalPath;if(typeof e=="string")return c3(n,e);throw S1("Field path arguments must be of type string or ",n,!1,void 0,i)}const NBe=new RegExp("[~\\*/\\[\\]]");function c3(n,e,i){if(e.search(NBe)>=0)throw S1(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,i);try{return new PN(...e.split("."))._internalPath}catch{throw S1(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,i)}}function S1(n,e,i,o,l){const u=o&&!o.isEmpty(),f=l!==void 0;let _=`Function ${e}() called with invalid data`;i&&(_+=" (via `toFirestore()`)"),_+=". ";let E="";return(u||f)&&(E+=" (found",u&&(E+=` in field ${o}`),f&&(E+=` in document ${l}`),E+=")"),new Qt(Ct.INVALID_ARGUMENT,_+n+E)}function foe(n,e){return n.some(i=>i.isEqual(e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class l3{constructor(e,i,o,l,u){this._firestore=e,this._userDataWriter=i,this._key=o,this._document=l,this._converter=u}get id(){return this._key.path.lastSegment()}get ref(){return new cc(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new DBe(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const i=this._document.data.field(NN("DocumentSnapshot.get",e));if(i!==null)return this._userDataWriter.convertValue(i)}}}class DBe extends l3{data(){return super.data()}}function NN(n,e){return typeof e=="string"?c3(n,e):e instanceof PN?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function moe(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new Qt(Ct.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class u3{}class DN extends u3{}function b1(n,e,...i){let o=[];e instanceof u3&&o.push(e),o=o.concat(i),function(u){const f=u.filter(E=>E instanceof d3).length,_=u.filter(E=>E instanceof xN).length;if(f>1||f>0&&_>0)throw new Qt(Ct.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(o);for(const l of o)n=l._apply(n);return n}class xN extends DN{constructor(e,i,o){super(),this._field=e,this._op=i,this._value=o,this.type="where"}static _create(e,i,o){return new xN(e,i,o)}_apply(e){const i=this._parse(e);return goe(e._query,i),new Op(e.firestore,e.converter,uj(e._query,i))}_parse(e){const i=MR(e.firestore);return function(u,f,_,E,b,C,I){let P;if(b.isKeyField()){if(C==="array-contains"||C==="array-contains-any")throw new Qt(Ct.INVALID_ARGUMENT,`Invalid Query. You can't perform '${C}' queries on documentId().`);if(C==="in"||C==="not-in"){uQ(I,C);const M=[];for(const F of I)M.push(lQ(E,u,F));P={arrayValue:{values:M}}}else P=lQ(E,u,I)}else C!=="in"&&C!=="not-in"&&C!=="array-contains-any"||uQ(I,C),P=doe(_,f,I,C==="in"||C==="not-in");return go.create(b,C,P)}(e._query,"where",i,e.firestore._databaseId,this._field,this._op,this._value)}}function cQ(n,e,i){const o=e,l=NN("where",n);return xN._create(l,o,i)}class d3 extends u3{constructor(e,i){super(),this.type=e,this._queryConstraints=i}static _create(e,i){return new d3(e,i)}_parse(e){const i=this._queryConstraints.map(o=>o._parse(e)).filter(o=>o.getFilters().length>0);return i.length===1?i[0]:Qd.create(i,this._getOperator())}_apply(e){const i=this._parse(e);return i.getFilters().length===0?e:(function(l,u){let f=l;const _=u.getFlattenedFilters();for(const E of _)goe(f,E),f=uj(f,E)}(e._query,i),new Op(e.firestore,e.converter,uj(e._query,i)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}class h3 extends DN{constructor(e,i){super(),this._field=e,this._direction=i,this.type="orderBy"}static _create(e,i){return new h3(e,i)}_apply(e){const i=function(l,u,f){if(l.startAt!==null)throw new Qt(Ct.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(l.endAt!==null)throw new Qt(Ct.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new rR(u,f)}(e._query,this._field,this._direction);return new Op(e.firestore,e.converter,function(l,u){const f=l.explicitOrderBy.concat([u]);return new dE(l.path,l.collectionGroup,f,l.filters.slice(),l.limit,l.limitType,l.startAt,l.endAt)}(e._query,i))}}function xBe(n,e="asc"){const i=e,o=NN("orderBy",n);return h3._create(o,i)}class p3 extends DN{constructor(e,i,o){super(),this.type=e,this._limit=i,this._limitType=o}static _create(e,i,o){return new p3(e,i,o)}_apply(e){return new Op(e.firestore,e.converter,p1(e._query,this._limit,this._limitType))}}function LBe(n){return p3._create("limit",n,"F")}class f3 extends DN{constructor(e,i,o){super(),this.type=e,this._docOrFields=i,this._inclusive=o}static _create(e,i,o){return new f3(e,i,o)}_apply(e){const i=UBe(e,this.type,this._docOrFields,this._inclusive);return new Op(e.firestore,e.converter,function(l,u){return new dE(l.path,l.collectionGroup,l.explicitOrderBy.slice(),l.filters.slice(),l.limit,l.limitType,u,l.endAt)}(e._query,i))}}function MBe(...n){return f3._create("startAt",n,!0)}function UBe(n,e,i,o){if(i[0]=qi(i[0]),i[0]instanceof l3)return function(u,f,_,E,b){if(!E)throw new Qt(Ct.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${_}().`);const C=[];for(const I of v0(u))if(I.field.isKeyField())C.push(h1(f,E.key));else{const P=E.data.field(I.field);if(mN(P))throw new Qt(Ct.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+I.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(P===null){const L=I.field.canonicalString();throw new Qt(Ct.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${L}' (used as the orderBy) does not exist.`)}C.push(P)}return new B0(C,b)}(n._query,n.firestore._databaseId,e,i[0]._document,o);{const l=MR(n.firestore);return function(f,_,E,b,C,I){const P=f.explicitOrderBy;if(C.length>P.length)throw new Qt(Ct.INVALID_ARGUMENT,`Too many arguments provided to ${b}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const L=[];for(let M=0;M<C.length;M++){const F=C[M];if(P[M].field.isKeyField()){if(typeof F!="string")throw new Qt(Ct.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${b}(), but got a ${typeof F}`);if(!x4(f)&&F.indexOf("/")!==-1)throw new Qt(Ct.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${b}() must be a plain document ID, but '${F}' contains a slash.`);const B=f.path.child(Ki.fromString(F));if(!Rn.isDocumentKey(B))throw new Qt(Ct.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${b}() must result in a valid document path, but '${B}' is not because it contains an odd number of segments.`);const Z=new Rn(B);L.push(h1(_,Z))}else{const B=doe(E,b,F);L.push(B)}}return new B0(L,I)}(n._query,n.firestore._databaseId,l,e,i,o)}}function lQ(n,e,i){if(typeof(i=qi(i))=="string"){if(i==="")throw new Qt(Ct.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!x4(e)&&i.indexOf("/")!==-1)throw new Qt(Ct.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${i}' contains a '/' character.`);const o=e.path.child(Ki.fromString(i));if(!Rn.isDocumentKey(o))throw new Qt(Ct.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${o}' is not because it has an odd number of segments (${o.length}).`);return h1(n,new Rn(o))}if(i instanceof cc)return h1(n,i._key);throw new Qt(Ct.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${RN(i)}.`)}function uQ(n,e){if(!Array.isArray(n)||n.length===0)throw new Qt(Ct.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function goe(n,e){const i=function(l,u){for(const f of l)for(const _ of f.getFlattenedFilters())if(u.indexOf(_.op)>=0)return _.op;return null}(n.filters,function(l){switch(l){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(i!==null)throw i===e.op?new Qt(Ct.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new Qt(Ct.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${i.toString()}' filters.`)}class VBe{convertValue(e,i="none"){switch(Hg(e)){case 0:return null;case 1:return e.booleanValue;case 2:return no(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,i);case 5:return e.stringValue;case 6:return this.convertBytes(Gg(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,i);case 11:return this.convertObject(e.mapValue,i);case 10:return this.convertVectorValue(e.mapValue);default:throw Yn()}}convertObject(e,i){return this.convertObjectMap(e.fields,i)}convertObjectMap(e,i="none"){const o={};return e_(e,(l,u)=>{o[l]=this.convertValue(u,i)}),o}convertVectorValue(e){var i,o,l;const u=(l=(o=(i=e.fields)===null||i===void 0?void 0:i[d1].arrayValue)===null||o===void 0?void 0:o.values)===null||l===void 0?void 0:l.map(f=>no(f.doubleValue));return new i3(u)}convertGeoPoint(e){return new r3(no(e.latitude),no(e.longitude))}convertArray(e,i){return(e.values||[]).map(o=>this.convertValue(o,i))}convertServerTimestamp(e,i){switch(i){case"previous":const o=gN(e);return o==null?null:this.convertValue(o,i);case"estimate":return this.convertTimestamp(eR(e));default:return null}}convertTimestamp(e){const i=zg(e);return new xo(i.seconds,i.nanos)}convertDocumentKey(e,i){const o=Ki.fromString(e);_i(Mse(o));const l=new tR(o.get(1),o.get(3)),u=new Rn(o.popFirst(5));return l.isEqual(i)||rm(`Document ${u} contains a document reference within a different database (${l.projectId}/${l.database}) which is not supported. It will be treated as a reference in the current database (${i.projectId}/${i.database}) instead.`),u}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _oe(n,e,i){let o;return o=n?i&&(i.merge||i.mergeFields)?n.toFirestore(e,i):n.toFirestore(e):e,o}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aC{constructor(e,i){this.hasPendingWrites=e,this.fromCache=i}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class yoe extends l3{constructor(e,i,o,l,u,f){super(e,i,o,l,f),this._firestore=e,this._firestoreImpl=e,this.metadata=u}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const i=new xk(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(i,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,i={}){if(this._document){const o=this._document.data.field(NN("DocumentSnapshot.get",e));if(o!==null)return this._userDataWriter.convertValue(o,i.serverTimestamps)}}}class xk extends yoe{data(e={}){return super.data(e)}}class Eoe{constructor(e,i,o,l){this._firestore=e,this._userDataWriter=i,this._snapshot=l,this.metadata=new aC(l.hasPendingWrites,l.fromCache),this.query=o}get docs(){const e=[];return this.forEach(i=>e.push(i)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,i){this._snapshot.docs.forEach(o=>{e.call(i,new xk(this._firestore,this._userDataWriter,o.key,o,new aC(this._snapshot.mutatedKeys.has(o.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const i=!!e.includeMetadataChanges;if(i&&this._snapshot.excludesMetadataChanges)throw new Qt(Ct.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===i||(this._cachedChanges=function(l,u){if(l._snapshot.oldDocs.isEmpty()){let f=0;return l._snapshot.docChanges.map(_=>{const E=new xk(l._firestore,l._userDataWriter,_.doc.key,_.doc,new aC(l._snapshot.mutatedKeys.has(_.doc.key),l._snapshot.fromCache),l.query.converter);return _.doc,{type:"added",doc:E,oldIndex:-1,newIndex:f++}})}{let f=l._snapshot.oldDocs;return l._snapshot.docChanges.filter(_=>u||_.type!==3).map(_=>{const E=new xk(l._firestore,l._userDataWriter,_.doc.key,_.doc,new aC(l._snapshot.mutatedKeys.has(_.doc.key),l._snapshot.fromCache),l.query.converter);let b=-1,C=-1;return _.type!==0&&(b=f.indexOf(_.doc.key),f=f.delete(_.doc.key)),_.type!==1&&(f=f.add(_.doc),C=f.indexOf(_.doc.key)),{type:jBe(_.type),doc:E,oldIndex:b,newIndex:C}})}}(this,i),this._cachedChangesIncludeMetadataChanges=i),this._cachedChanges}}function jBe(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Yn()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _o(n){n=El(n,cc);const e=El(n.firestore,sm);return bBe(AN(e),n._key).then(i=>Soe(e,n,i))}class m3 extends VBe{constructor(e){super(),this.firestore=e}convertBytes(e){return new $0(e)}convertReference(e){const i=this.convertDocumentKey(e,this.firestore._databaseId);return new cc(this.firestore,null,i)}}function ed(n){n=El(n,Op);const e=El(n.firestore,sm),i=AN(e),o=new m3(e);return moe(n._query),wBe(i,n._query).then(l=>new Eoe(e,o,n,l))}function qg(n,e,i){n=El(n,cc);const o=El(n.firestore,sm),l=_oe(n.converter,e,i);return LN(o,[loe(MR(o),"setDoc",n._key,l,n.converter!==null,i).toMutation(n._key,Yu.none())])}function ms(n,e,i,...o){n=El(n,cc);const l=El(n.firestore,sm),u=MR(l);let f;return f=typeof(e=qi(e))=="string"||e instanceof PN?kBe(u,"updateDoc",n._key,e,i,o):OBe(u,"updateDoc",n._key,e),LN(l,[f.toMutation(n._key,Yu.exists(!0))])}function FBe(n){return LN(El(n.firestore,sm),[new M4(n._key,Yu.none())])}function BBe(n,e){const i=El(n.firestore,sm),o=dr(n),l=_oe(n.converter,e);return LN(i,[loe(MR(n.firestore),"addDoc",o._key,l,n.converter!==null,{}).toMutation(o._key,Yu.exists(!1))]).then(()=>o)}function voe(n,...e){var i,o,l;n=qi(n);let u={includeMetadataChanges:!1,source:"default"},f=0;typeof e[f]!="object"||aQ(e[f])||(u=e[f],f++);const _={includeMetadataChanges:u.includeMetadataChanges,source:u.source};if(aQ(e[f])){const I=e[f];e[f]=(i=I.next)===null||i===void 0?void 0:i.bind(I),e[f+1]=(o=I.error)===null||o===void 0?void 0:o.bind(I),e[f+2]=(l=I.complete)===null||l===void 0?void 0:l.bind(I)}let E,b,C;if(n instanceof cc)b=El(n.firestore,sm),C=_N(n._key.path),E={next:I=>{e[f]&&e[f](Soe(b,n,I))},error:e[f+1],complete:e[f+2]};else{const I=El(n,Op);b=El(I.firestore,sm),C=I._query;const P=new m3(b);E={next:L=>{e[f]&&e[f](new Eoe(b,P,I,L))},error:e[f+1],complete:e[f+2]},moe(n._query)}return function(P,L,M,F){const B=new n3(F),Z=new Z4(L,B,M);return P.asyncQueue.enqueueAndForget(async()=>X4(await v1(P),Z)),()=>{B.su(),P.asyncQueue.enqueueAndForget(async()=>J4(await v1(P),Z))}}(AN(b),C,_,E)}function LN(n,e){return function(o,l){const u=new Yf;return o.asyncQueue.enqueueAndForget(async()=>uBe(await SBe(o),l,u)),u.promise}(AN(n),e)}function Soe(n,e,i){const o=i.docs.get(e._key),l=new m3(n);return new yoe(n,l,e._key,o,new aC(i.hasPendingWrites,i.fromCache),e.converter)}function WBe(...n){return new s3("arrayUnion",n)}function zBe(...n){return new o3("arrayRemove",n)}(function(e,i=!0){(function(l){rb=l})(uE),tE(new Bg("firestore",(o,{instanceIdentifier:l,options:u})=>{const f=o.getProvider("app").getImmediate(),_=new sm(new x4e(o.getProvider("auth-internal")),new U4e(f,o.getProvider("app-check-internal")),function(b,C){if(!Object.prototype.hasOwnProperty.apply(b.options,["projectId"]))throw new Qt(Ct.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new tR(b.options.projectId,C)}(f,l),f);return u=Object.assign({useFetchStreams:i},u),_._setSettings(u),_},"PUBLIC").setMultipleInstances(!0)),Ep(hJ,pJ,e),Ep(hJ,pJ,"esm2017")})();var GBe="firebase",HBe="11.5.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Ep(GBe,HBe,"app");const $Be=[{key:"VITE_FIREBASE_API_KEY",value:void 0},{key:"VITE_FIREBASE_AUTH_DOMAIN",value:void 0},{key:"VITE_FIREBASE_PROJECT_ID",value:void 0},{key:"VITE_FIREBASE_STORAGE_BUCKET",value:void 0},{key:"VITE_FIREBASE_MESSAGING_SENDER_ID",value:void 0},{key:"VITE_FIREBASE_APP_ID",value:void 0}],bj=$Be.filter(n=>!n.value);if(bj.length>0){const e=`Missing environment variables: ${bj.map(i=>i.key).join(", ")}. Using fallback values. For production, it's recommended to set up your .env file.`;H.warn(e),console.warn(e)}const KBe={apiKey:"AIzaSyCaxoNKRIMaXhotGzdAjXc5gkARoqtS3bU",authDomain:"disruptive-metaverse.firebaseapp.com",projectId:"disruptive-metaverse",storageBucket:"disruptive-metaverse.appspot.com",messagingSenderId:"294433070603",appId:"1:294433070603:web:136cddd196eea9614fb10e"},qBe=bj.length>0;H.log(`Firebase initializing with ${qBe?"fallback":"environment"} configuration`);let VU,g3,Dn;try{VU=rie(KBe),g3=hN(VU),Dn=vj(VU),H.log("Firebase initialized successfully")}catch(n){H.error("Failed to initialize Firebase:",n),console.error("Failed to initialize Firebase:",n)}const $u=n=>!0,dQ=(n,e)=>{const o=(n+e.charAt(0)).toLowerCase().replace(/[^a-z0-9]/g,"").substring(0,11),l=Math.floor(1e3+Math.random()*9e3);return o+l},iR=async n=>{try{if(!n||typeof n!="string"||n.trim()==="")return H.error("userFirestore: Invalid username provided to isUsernameTaken"),!0;const e=n.toLowerCase().trim();H.log(`userFirestore: Checking if username "${e}" is taken`);const i=Sl(Dn,"users"),o=b1(i,LBe(100)),l=await ed(o);let u=!1;return l.forEach(f=>{const _=f.data();_.username&&_.username.toLowerCase()===e&&(u=!0)}),H.log(`userFirestore: Username "${e}" is ${u?"taken":"available"}`),u}catch(e){return H.error("userFirestore: Error checking username availability:",e),!0}},YBe=async(n,e)=>{let i=dQ(n,e),o=0;const l=10;for(;o<l;){if(!await iR(i))return i;i=dQ(n,e),o++}return i+Math.floor(Math.random()*100)},td=async n=>{try{H.log("userFirestore: Get user PUBLIC profile data for user ID: "+n);const e=dr(Dn,"users",n),i=await _o(e);if(i.exists()){const o=i.data();return H.log("userFirestore: Found PUBLIC Profile for : "+o.Nickname),delete o.email,delete o.emailVerified,o}else return H.error("userFirestore: user profile document not found"),null}catch(e){throw H.error("userFirestore: Error fetching user public profile data:",e),e}},XBe=async(n,e,i)=>{try{if(H.log("userFirestore: Starting registerUser process"),H.log("userFirestore: Fields in additionalData:",Object.keys(i||{}).join(", ")),!i)throw H.error("userFirestore: additionalData is null or undefined"),new Error("Registration data is missing");const o={firstName:i.firstName||"",lastName:i.lastName||"",companyName:i.companyName||"",linkedInProfile:i.linkedInProfile||"",username:i.username||"",Nickname:i.Nickname||"",rpmURL:i.rpmURL||"https://models.readyplayer.me/67c8408d38f7924e15a8bd0a.glb"};H.log("userFirestore: Critical fields captured for registration"),H.log("userFirestore: Creating user auth record");const u=(await mFe(g3,n,e)).user;await Nie(u),H.log("userFirestore: Verification email sent"),H.log("userFirestore: Waiting for Cloud Function to create initial document..."),await new Promise(L=>setTimeout(L,5e3));const f=dr(Dn,"users",u.uid),_=await _o(f);if(_.exists()){H.log("userFirestore: Found document created by Cloud Function, updating with missing fields");const L=_.data(),M={};L.firstName||(M.firstName=o.firstName),L.lastName||(M.lastName=o.lastName),L.Nickname||(M.Nickname=o.Nickname),L.username||(M.username=o.username),L.companyName||(M.companyName=o.companyName),L.linkedInProfile||(M.linkedInProfile=o.linkedInProfile),L.rpmURL||(M.rpmURL=o.rpmURL),Object.keys(M).length>0&&(H.log("userFirestore: Updating document with fields:",Object.keys(M).join(", ")),await ms(f,{...M,lastUpdated:new Date}))}else{H.error("userFirestore: Cloud Function failed to create user document, creating manually"),await qg(f,{...o,id:u.uid,groups:["users"],createdAt:new Date,lastUpdated:new Date});const L=dr(Dn,"users",u.uid,"private","data");await qg(L,{email:u.email,emailVerified:!1})}const E=await _o(f);if(!E.exists())throw new Error("User document does not exist even after creation attempts");let b=E.data();b.firstName||(b.firstName=o.firstName),b.lastName||(b.lastName=o.lastName),b.Nickname||(b.Nickname=o.Nickname),b.username||(b.username=o.username),b.companyName||(b.companyName=o.companyName);let C=!1,I={};for(const L in o)(!b[L]||b[L]==="")&&(I[L]=o[L],C=!0);(!b.groups||!b.groups.includes("users"))&&(I.groups=b.groups?[...b.groups,"users"]:["users"],C=!0,H.log("userFirestore: Adding user to users group")),C&&(H.log("userFirestore: Updating user document with missing fields"),H.log("userFirestore: Fields being updated:",Object.keys(I).join(", ")),await ms(f,I),b=(await _o(f)).data());const P={...u,...b,firstName:o.firstName,lastName:o.lastName,Nickname:o.Nickname,username:o.username,companyName:o.companyName,linkedInProfile:o.linkedInProfile};return H.log("userFirestore: Registration complete, returning user data"),H.log("userFirestore: Fields included in return data:",Object.keys(P).join(", ")),P}catch(o){throw H.error("userFirestore: Error creating user:",o),o}},boe=async(n,e)=>{try{H.log(`userFirestore: Updating rpmURL for user ID: ${n}`);const i=dr(Dn,"users",n);await ms(i,{rpmURL:e,lastUpdated:new Date().toISOString()}),H.log("userFirestore: rpmURL updated successfully.")}catch(i){throw H.error("userFirestore: Error updating rpmURL:",i),i}},JBe=async(n,e)=>{try{const i=await td(n);return i&&i.groups?i.groups.includes(e):!1}catch(i){return H.error("userFirestore: Error checking group membership:",i),!1}},QBe=async(n,e)=>{try{if($u(e),await iR(e))throw new Error("Username is already taken");const o=dr(Dn,"users",n);return await ms(o,{username:e,lastUpdated:new Date}),H.log(`userFirestore: Username updated for user ${n}`),!0}catch(i){throw H.error("userFirestore: Error updating username:",i),i}};var ZBe={};const w1=()=>{const n=typeof process<"u"&&ZBe&&!1;return typeof window<"u"&&new URLSearchParams(window.location.search).has("dev_mode"),n},e6e=(n,e)=>{if(!w1())return H.warn(" SECURITY WARNING: Permission override attempted outside of development environment"),!1},t6e=(n,e)=>{if(!w1())return H.warn(" SECURITY WARNING: Permission override attempted outside of development environment"),!1},_3=typeof w1=="function"?w1():!1;_3&&H.warn(" SECURITY WARNING: Permission overrides are ENABLED. This should only happen in development.");const n6e=async(n,e)=>{if(_3)return e6e();if(!n||!n.uid)return!1;try{if(n.groups){const l=`space_${e}_owners`;if(n.groups.includes(l))return console.log(`User ${n.uid} is an owner via groups property`),!0}const o=hN().currentUser;if(o&&o.uid===n.uid)try{const u=(await o.getIdTokenResult(!0)).claims.groups||[],f=`space_${e}_owners`;if(u.includes(f))return console.log(`User ${n.uid} is an owner via Firebase token claims`),!0}catch(l){console.error("Error getting token result:",l)}return!1}catch(i){return H.error("Error checking space owner permissions:",i),!1}},MN=async(n,e)=>{if(_3)return t6e();try{if(H.log(`userPermissions: Checking if user ${n} belongs to group ${e}`),e==="users")return H.log(`userPermissions: TESTING MODE - Always allowing access to 'users' group for user ${n}`),!0;if(n){const i=await td(n);if(H.log(`userPermissions: User profile for ${n}:`,i),i&&i.groups&&Array.isArray(i.groups)){if(H.log(`userPermissions: User ${n} has groups:`,i.groups),i.groups.includes(e))return H.log(`userPermissions: User ${n} belongs to group ${e} (from user document)`),!0}else H.log(`userPermissions: User ${n} has no groups or groups is not an array`);if(e==="disruptiveAdmin")try{const l=hN().currentUser;if(l&&l.uid===n){const u=await l.getIdTokenResult();if(H.log(`userPermissions: Token claims for ${n}:`,u.claims),u.claims&&u.claims.groups&&Array.isArray(u.claims.groups)&&u.claims.groups.includes(e))return H.log(`userPermissions: User ${n} belongs to group ${e} (from token claims)`),!0}}catch(o){H.error("userPermissions: Error checking token claims:",o)}}return H.log(`userPermissions: User ${n} does not belong to group ${e}`),!1}catch(i){return H.error("userPermissions: Error checking if user belongs to group:",i),!1}},r6e=["email","name","rpmURL","Nickname","username","created_on","height_cm","companyName","firstName","lastName","linkedInProfile","groups"],qd={sendUserToUnity:"sendUserToUnity"};class i6e{constructor(){this.events={}}subscribe(e,i){this.events[e]||(this.events[e]=[]),this.events[e].push(i)}publish(e,i){const o=this.events[e];o?(o.forEach(l=>{l(i)}),H.log(`EventBus: Published event '${e}'`)):H.log(`EventBus: No subscribers for event '${e}'`)}unsubscribe(e,i){var l;const o=(l=this.events[e])==null?void 0:l.indexOf(i);o>-1&&this.events[e].splice(o,1)}}const Yd=new i6e;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const woe="firebasestorage.googleapis.com",Toe="storageBucket",s6e=2*60*1e3,o6e=10*60*1e3;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qs extends Pp{constructor(e,i,o=0){super(jU(e),`Firebase Storage: ${i} (${jU(e)})`),this.status_=o,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,qs.prototype)}get status(){return this.status_}set status(e){this.status_=e}_codeEquals(e){return jU(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message=`${this._baseMessage}
${this.customData.serverResponse}`:this.message=this._baseMessage}}var Ks;(function(n){n.UNKNOWN="unknown",n.OBJECT_NOT_FOUND="object-not-found",n.BUCKET_NOT_FOUND="bucket-not-found",n.PROJECT_NOT_FOUND="project-not-found",n.QUOTA_EXCEEDED="quota-exceeded",n.UNAUTHENTICATED="unauthenticated",n.UNAUTHORIZED="unauthorized",n.UNAUTHORIZED_APP="unauthorized-app",n.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",n.INVALID_CHECKSUM="invalid-checksum",n.CANCELED="canceled",n.INVALID_EVENT_NAME="invalid-event-name",n.INVALID_URL="invalid-url",n.INVALID_DEFAULT_BUCKET="invalid-default-bucket",n.NO_DEFAULT_BUCKET="no-default-bucket",n.CANNOT_SLICE_BLOB="cannot-slice-blob",n.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",n.NO_DOWNLOAD_URL="no-download-url",n.INVALID_ARGUMENT="invalid-argument",n.INVALID_ARGUMENT_COUNT="invalid-argument-count",n.APP_DELETED="app-deleted",n.INVALID_ROOT_OPERATION="invalid-root-operation",n.INVALID_FORMAT="invalid-format",n.INTERNAL_ERROR="internal-error",n.UNSUPPORTED_ENVIRONMENT="unsupported-environment"})(Ks||(Ks={}));function jU(n){return"storage/"+n}function y3(){const n="An unknown error occurred, please check the error payload for server response.";return new qs(Ks.UNKNOWN,n)}function a6e(n){return new qs(Ks.OBJECT_NOT_FOUND,"Object '"+n+"' does not exist.")}function c6e(n){return new qs(Ks.QUOTA_EXCEEDED,"Quota for bucket '"+n+"' exceeded, please view quota on https://firebase.google.com/pricing/.")}function l6e(){const n="User is not authenticated, please authenticate using Firebase Authentication and try again.";return new qs(Ks.UNAUTHENTICATED,n)}function u6e(){return new qs(Ks.UNAUTHORIZED_APP,"This app does not have permission to access Firebase Storage on this project.")}function d6e(n){return new qs(Ks.UNAUTHORIZED,"User does not have permission to access '"+n+"'.")}function h6e(){return new qs(Ks.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function p6e(){return new qs(Ks.CANCELED,"User canceled the upload/download.")}function f6e(n){return new qs(Ks.INVALID_URL,"Invalid URL '"+n+"'.")}function m6e(n){return new qs(Ks.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+n+"'.")}function g6e(){return new qs(Ks.NO_DEFAULT_BUCKET,"No default bucket found. Did you set the '"+Toe+"' property when initializing the app?")}function _6e(){return new qs(Ks.CANNOT_SLICE_BLOB,"Cannot slice blob for upload. Please retry the upload.")}function y6e(){return new qs(Ks.NO_DOWNLOAD_URL,"The given file does not have any download URLs.")}function E6e(n){return new qs(Ks.UNSUPPORTED_ENVIRONMENT,`${n} is missing. Make sure to install the required polyfills. See https://firebase.google.com/docs/web/environments-js-sdk#polyfills for more information.`)}function wj(n){return new qs(Ks.INVALID_ARGUMENT,n)}function Coe(){return new qs(Ks.APP_DELETED,"The Firebase app was deleted.")}function v6e(n){return new qs(Ks.INVALID_ROOT_OPERATION,"The operation '"+n+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}function RC(n,e){return new qs(Ks.INVALID_FORMAT,"String does not match format '"+n+"': "+e)}function kT(n){throw new qs(Ks.INTERNAL_ERROR,"Internal error: "+n)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yl{constructor(e,i){this.bucket=e,this.path_=i}get path(){return this.path_}get isRoot(){return this.path.length===0}fullServerUrl(){const e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(e,i){let o;try{o=Yl.makeFromUrl(e,i)}catch{return new Yl(e,"")}if(o.path==="")return o;throw m6e(e)}static makeFromUrl(e,i){let o=null;const l="([A-Za-z0-9.\\-_]+)";function u(ae){ae.path.charAt(ae.path.length-1)==="/"&&(ae.path_=ae.path_.slice(0,-1))}const f="(/(.*))?$",_=new RegExp("^gs://"+l+f,"i"),E={bucket:1,path:3};function b(ae){ae.path_=decodeURIComponent(ae.path)}const C="v[A-Za-z0-9_]+",I=i.replace(/[.]/g,"\\."),P="(/([^?#]*).*)?$",L=new RegExp(`^https?://${I}/${C}/b/${l}/o${P}`,"i"),M={bucket:1,path:3},F=i===woe?"(?:storage.googleapis.com|storage.cloud.google.com)":i,B="([^?#]*)",Z=new RegExp(`^https?://${F}/${l}/${B}`,"i"),re=[{regex:_,indices:E,postModify:u},{regex:L,indices:M,postModify:b},{regex:Z,indices:{bucket:1,path:2},postModify:b}];for(let ae=0;ae<re.length;ae++){const ne=re[ae],pe=ne.regex.exec(e);if(pe){const X=pe[ne.indices.bucket];let J=pe[ne.indices.path];J||(J=""),o=new Yl(X,J),ne.postModify(o);break}}if(o==null)throw f6e(e);return o}}class S6e{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(e=!1){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function b6e(n,e,i){let o=1,l=null,u=null,f=!1,_=0;function E(){return _===2}let b=!1;function C(...B){b||(b=!0,e.apply(null,B))}function I(B){l=setTimeout(()=>{l=null,n(L,E())},B)}function P(){u&&clearTimeout(u)}function L(B,...Z){if(b){P();return}if(B){P(),C.call(null,B,...Z);return}if(E()||f){P(),C.call(null,B,...Z);return}o<64&&(o*=2);let re;_===1?(_=2,re=0):re=(o+Math.random())*1e3,I(re)}let M=!1;function F(B){M||(M=!0,P(),!b&&(l!==null?(B||(_=2),clearTimeout(l),I(0)):B||(_=1)))}return I(0),u=setTimeout(()=>{f=!0,F(!0)},i),F}function w6e(n){n(!1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function T6e(n){return n!==void 0}function C6e(n){return typeof n=="object"&&!Array.isArray(n)}function E3(n){return typeof n=="string"||n instanceof String}function hQ(n){return v3()&&n instanceof Blob}function v3(){return typeof Blob<"u"}function pQ(n,e,i,o){if(o<e)throw wj(`Invalid value for '${n}'. Expected ${e} or greater.`);if(o>i)throw wj(`Invalid value for '${n}'. Expected ${i} or less.`)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function UN(n,e,i){let o=e;return i==null&&(o=`https://${e}`),`${i}://${o}/v0${n}`}function Roe(n){const e=encodeURIComponent;let i="?";for(const o in n)if(n.hasOwnProperty(o)){const l=e(o)+"="+e(n[o]);i=i+l+"&"}return i=i.slice(0,-1),i}var qy;(function(n){n[n.NO_ERROR=0]="NO_ERROR",n[n.NETWORK_ERROR=1]="NETWORK_ERROR",n[n.ABORT=2]="ABORT"})(qy||(qy={}));/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function R6e(n,e){const i=n>=500&&n<600,l=[408,429].indexOf(n)!==-1,u=e.indexOf(n)!==-1;return i||l||u}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class I6e{constructor(e,i,o,l,u,f,_,E,b,C,I,P=!0){this.url_=e,this.method_=i,this.headers_=o,this.body_=l,this.successCodes_=u,this.additionalRetryCodes_=f,this.callback_=_,this.errorCallback_=E,this.timeout_=b,this.progressCallback_=C,this.connectionFactory_=I,this.retry=P,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((L,M)=>{this.resolve_=L,this.reject_=M,this.start_()})}start_(){const e=(o,l)=>{if(l){o(!1,new JO(!1,null,!0));return}const u=this.connectionFactory_();this.pendingConnection_=u;const f=_=>{const E=_.loaded,b=_.lengthComputable?_.total:-1;this.progressCallback_!==null&&this.progressCallback_(E,b)};this.progressCallback_!==null&&u.addUploadProgressListener(f),u.send(this.url_,this.method_,this.body_,this.headers_).then(()=>{this.progressCallback_!==null&&u.removeUploadProgressListener(f),this.pendingConnection_=null;const _=u.getErrorCode()===qy.NO_ERROR,E=u.getStatus();if(!_||R6e(E,this.additionalRetryCodes_)&&this.retry){const C=u.getErrorCode()===qy.ABORT;o(!1,new JO(!1,null,C));return}const b=this.successCodes_.indexOf(E)!==-1;o(!0,new JO(b,u))})},i=(o,l)=>{const u=this.resolve_,f=this.reject_,_=l.connection;if(l.wasSuccessCode)try{const E=this.callback_(_,_.getResponse());T6e(E)?u(E):u()}catch(E){f(E)}else if(_!==null){const E=y3();E.serverResponse=_.getErrorText(),this.errorCallback_?f(this.errorCallback_(_,E)):f(E)}else if(l.canceled){const E=this.appDelete_?Coe():p6e();f(E)}else{const E=h6e();f(E)}};this.canceled_?i(!1,new JO(!1,null,!0)):this.backoffId_=b6e(e,i,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,this.backoffId_!==null&&w6e(this.backoffId_),this.pendingConnection_!==null&&this.pendingConnection_.abort()}}class JO{constructor(e,i,o){this.wasSuccessCode=e,this.connection=i,this.canceled=!!o}}function A6e(n,e){e!==null&&e.length>0&&(n.Authorization="Firebase "+e)}function P6e(n,e){n["X-Firebase-Storage-Version"]="webjs/"+(e??"AppManager")}function O6e(n,e){e&&(n["X-Firebase-GMPID"]=e)}function k6e(n,e){e!==null&&(n["X-Firebase-AppCheck"]=e)}function N6e(n,e,i,o,l,u,f=!0){const _=Roe(n.urlParams),E=n.url+_,b=Object.assign({},n.headers);return O6e(b,e),A6e(b,i),P6e(b,u),k6e(b,o),new I6e(E,n.method,b,n.body,n.successCodes,n.additionalRetryCodes,n.handler,n.errorHandler,n.timeout,n.progressCallback,l,f)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function D6e(){return typeof BlobBuilder<"u"?BlobBuilder:typeof WebKitBlobBuilder<"u"?WebKitBlobBuilder:void 0}function x6e(...n){const e=D6e();if(e!==void 0){const i=new e;for(let o=0;o<n.length;o++)i.append(n[o]);return i.getBlob()}else{if(v3())return new Blob(n);throw new qs(Ks.UNSUPPORTED_ENVIRONMENT,"This browser doesn't seem to support creating Blobs")}}function L6e(n,e,i){return n.webkitSlice?n.webkitSlice(e,i):n.mozSlice?n.mozSlice(e,i):n.slice?n.slice(e,i):null}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function M6e(n){if(typeof atob>"u")throw E6e("base-64");return atob(n)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lp={RAW:"raw",BASE64:"base64",BASE64URL:"base64url",DATA_URL:"data_url"};class FU{constructor(e,i){this.data=e,this.contentType=i||null}}function U6e(n,e){switch(n){case lp.RAW:return new FU(Ioe(e));case lp.BASE64:case lp.BASE64URL:return new FU(Aoe(n,e));case lp.DATA_URL:return new FU(j6e(e),F6e(e))}throw y3()}function Ioe(n){const e=[];for(let i=0;i<n.length;i++){let o=n.charCodeAt(i);if(o<=127)e.push(o);else if(o<=2047)e.push(192|o>>6,128|o&63);else if((o&64512)===55296)if(!(i<n.length-1&&(n.charCodeAt(i+1)&64512)===56320))e.push(239,191,189);else{const u=o,f=n.charCodeAt(++i);o=65536|(u&1023)<<10|f&1023,e.push(240|o>>18,128|o>>12&63,128|o>>6&63,128|o&63)}else(o&64512)===56320?e.push(239,191,189):e.push(224|o>>12,128|o>>6&63,128|o&63)}return new Uint8Array(e)}function V6e(n){let e;try{e=decodeURIComponent(n)}catch{throw RC(lp.DATA_URL,"Malformed data URL.")}return Ioe(e)}function Aoe(n,e){switch(n){case lp.BASE64:{const l=e.indexOf("-")!==-1,u=e.indexOf("_")!==-1;if(l||u)throw RC(n,"Invalid character '"+(l?"-":"_")+"' found: is it base64url encoded?");break}case lp.BASE64URL:{const l=e.indexOf("+")!==-1,u=e.indexOf("/")!==-1;if(l||u)throw RC(n,"Invalid character '"+(l?"+":"/")+"' found: is it base64 encoded?");e=e.replace(/-/g,"+").replace(/_/g,"/");break}}let i;try{i=M6e(e)}catch(l){throw l.message.includes("polyfill")?l:RC(n,"Invalid character found")}const o=new Uint8Array(i.length);for(let l=0;l<i.length;l++)o[l]=i.charCodeAt(l);return o}class Poe{constructor(e){this.base64=!1,this.contentType=null;const i=e.match(/^data:([^,]+)?,/);if(i===null)throw RC(lp.DATA_URL,"Must be formatted 'data:[<mediatype>][;base64],<data>");const o=i[1]||null;o!=null&&(this.base64=B6e(o,";base64"),this.contentType=this.base64?o.substring(0,o.length-7):o),this.rest=e.substring(e.indexOf(",")+1)}}function j6e(n){const e=new Poe(n);return e.base64?Aoe(lp.BASE64,e.rest):V6e(e.rest)}function F6e(n){return new Poe(n).contentType}function B6e(n,e){return n.length>=e.length?n.substring(n.length-e.length)===e:!1}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pg{constructor(e,i){let o=0,l="";hQ(e)?(this.data_=e,o=e.size,l=e.type):e instanceof ArrayBuffer?(i?this.data_=new Uint8Array(e):(this.data_=new Uint8Array(e.byteLength),this.data_.set(new Uint8Array(e))),o=this.data_.length):e instanceof Uint8Array&&(i?this.data_=e:(this.data_=new Uint8Array(e.length),this.data_.set(e)),o=e.length),this.size_=o,this.type_=l}size(){return this.size_}type(){return this.type_}slice(e,i){if(hQ(this.data_)){const o=this.data_,l=L6e(o,e,i);return l===null?null:new Pg(l)}else{const o=new Uint8Array(this.data_.buffer,e,i-e);return new Pg(o,!0)}}static getBlob(...e){if(v3()){const i=e.map(o=>o instanceof Pg?o.data_:o);return new Pg(x6e.apply(null,i))}else{const i=e.map(f=>E3(f)?U6e(lp.RAW,f).data:f.data_);let o=0;i.forEach(f=>{o+=f.byteLength});const l=new Uint8Array(o);let u=0;return i.forEach(f=>{for(let _=0;_<f.length;_++)l[u++]=f[_]}),new Pg(l,!0)}}uploadData(){return this.data_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ooe(n){let e;try{e=JSON.parse(n)}catch{return null}return C6e(e)?e:null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function W6e(n){if(n.length===0)return null;const e=n.lastIndexOf("/");return e===-1?"":n.slice(0,e)}function z6e(n,e){const i=e.split("/").filter(o=>o.length>0).join("/");return n.length===0?i:n+"/"+i}function koe(n){const e=n.lastIndexOf("/",n.length-2);return e===-1?n:n.slice(e+1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function G6e(n,e){return e}class Pc{constructor(e,i,o,l){this.server=e,this.local=i||e,this.writable=!!o,this.xform=l||G6e}}let QO=null;function H6e(n){return!E3(n)||n.length<2?n:koe(n)}function Noe(){if(QO)return QO;const n=[];n.push(new Pc("bucket")),n.push(new Pc("generation")),n.push(new Pc("metageneration")),n.push(new Pc("name","fullPath",!0));function e(u,f){return H6e(f)}const i=new Pc("name");i.xform=e,n.push(i);function o(u,f){return f!==void 0?Number(f):f}const l=new Pc("size");return l.xform=o,n.push(l),n.push(new Pc("timeCreated")),n.push(new Pc("updated")),n.push(new Pc("md5Hash",null,!0)),n.push(new Pc("cacheControl",null,!0)),n.push(new Pc("contentDisposition",null,!0)),n.push(new Pc("contentEncoding",null,!0)),n.push(new Pc("contentLanguage",null,!0)),n.push(new Pc("contentType",null,!0)),n.push(new Pc("metadata","customMetadata",!0)),QO=n,QO}function $6e(n,e){function i(){const o=n.bucket,l=n.fullPath,u=new Yl(o,l);return e._makeStorageReference(u)}Object.defineProperty(n,"ref",{get:i})}function K6e(n,e,i){const o={};o.type="file";const l=i.length;for(let u=0;u<l;u++){const f=i[u];o[f.local]=f.xform(o,e[f.server])}return $6e(o,n),o}function Doe(n,e,i){const o=Ooe(e);return o===null?null:K6e(n,o,i)}function q6e(n,e,i,o){const l=Ooe(e);if(l===null||!E3(l.downloadTokens))return null;const u=l.downloadTokens;if(u.length===0)return null;const f=encodeURIComponent;return u.split(",").map(b=>{const C=n.bucket,I=n.fullPath,P="/b/"+f(C)+"/o/"+f(I),L=UN(P,i,o),M=Roe({alt:"media",token:b});return L+M})[0]}function Y6e(n,e){const i={},o=e.length;for(let l=0;l<o;l++){const u=e[l];u.writable&&(i[u.server]=n[u.local])}return JSON.stringify(i)}class S3{constructor(e,i,o,l){this.url=e,this.method=i,this.handler=o,this.timeout=l,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xoe(n){if(!n)throw y3()}function X6e(n,e){function i(o,l){const u=Doe(n,l,e);return xoe(u!==null),u}return i}function J6e(n,e){function i(o,l){const u=Doe(n,l,e);return xoe(u!==null),q6e(u,l,n.host,n._protocol)}return i}function Loe(n){function e(i,o){let l;return i.getStatus()===401?i.getErrorText().includes("Firebase App Check token is invalid")?l=u6e():l=l6e():i.getStatus()===402?l=c6e(n.bucket):i.getStatus()===403?l=d6e(n.path):l=o,l.status=i.getStatus(),l.serverResponse=o.serverResponse,l}return e}function Moe(n){const e=Loe(n);function i(o,l){let u=e(o,l);return o.getStatus()===404&&(u=a6e(n.path)),u.serverResponse=l.serverResponse,u}return i}function Q6e(n,e,i){const o=e.fullServerUrl(),l=UN(o,n.host,n._protocol),u="GET",f=n.maxOperationRetryTime,_=new S3(l,u,J6e(n,i),f);return _.errorHandler=Moe(e),_}function Z6e(n,e){const i=e.fullServerUrl(),o=UN(i,n.host,n._protocol),l="DELETE",u=n.maxOperationRetryTime;function f(E,b){}const _=new S3(o,l,f,u);return _.successCodes=[200,204],_.errorHandler=Moe(e),_}function eWe(n,e){return n&&n.contentType||e&&e.type()||"application/octet-stream"}function tWe(n,e,i){const o=Object.assign({},i);return o.fullPath=n.path,o.size=e.size(),o.contentType||(o.contentType=eWe(null,e)),o}function nWe(n,e,i,o,l){const u=e.bucketOnlyServerUrl(),f={"X-Goog-Upload-Protocol":"multipart"};function _(){let re="";for(let ae=0;ae<2;ae++)re=re+Math.random().toString().slice(2);return re}const E=_();f["Content-Type"]="multipart/related; boundary="+E;const b=tWe(e,o,l),C=Y6e(b,i),I="--"+E+`\r
Content-Type: application/json; charset=utf-8\r
\r
`+C+`\r
--`+E+`\r
Content-Type: `+b.contentType+`\r
\r
`,P=`\r
--`+E+"--",L=Pg.getBlob(I,o,P);if(L===null)throw _6e();const M={name:b.fullPath},F=UN(u,n.host,n._protocol),B="POST",Z=n.maxUploadRetryTime,K=new S3(F,B,X6e(n,i),Z);return K.urlParams=M,K.headers=f,K.body=L.uploadData(),K.errorHandler=Loe(e),K}class rWe{constructor(){this.sent_=!1,this.xhr_=new XMLHttpRequest,this.initXhr(),this.errorCode_=qy.NO_ERROR,this.sendPromise_=new Promise(e=>{this.xhr_.addEventListener("abort",()=>{this.errorCode_=qy.ABORT,e()}),this.xhr_.addEventListener("error",()=>{this.errorCode_=qy.NETWORK_ERROR,e()}),this.xhr_.addEventListener("load",()=>{e()})})}send(e,i,o,l){if(this.sent_)throw kT("cannot .send() more than once");if(this.sent_=!0,this.xhr_.open(i,e,!0),l!==void 0)for(const u in l)l.hasOwnProperty(u)&&this.xhr_.setRequestHeader(u,l[u].toString());return o!==void 0?this.xhr_.send(o):this.xhr_.send(),this.sendPromise_}getErrorCode(){if(!this.sent_)throw kT("cannot .getErrorCode() before sending");return this.errorCode_}getStatus(){if(!this.sent_)throw kT("cannot .getStatus() before sending");try{return this.xhr_.status}catch{return-1}}getResponse(){if(!this.sent_)throw kT("cannot .getResponse() before sending");return this.xhr_.response}getErrorText(){if(!this.sent_)throw kT("cannot .getErrorText() before sending");return this.xhr_.statusText}abort(){this.xhr_.abort()}getResponseHeader(e){return this.xhr_.getResponseHeader(e)}addUploadProgressListener(e){this.xhr_.upload!=null&&this.xhr_.upload.addEventListener("progress",e)}removeUploadProgressListener(e){this.xhr_.upload!=null&&this.xhr_.upload.removeEventListener("progress",e)}}class iWe extends rWe{initXhr(){this.xhr_.responseType="text"}}function b3(){return new iWe}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oE{constructor(e,i){this._service=e,i instanceof Yl?this._location=i:this._location=Yl.makeFromUrl(i,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,i){return new oE(e,i)}get root(){const e=new Yl(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return koe(this._location.path)}get storage(){return this._service}get parent(){const e=W6e(this._location.path);if(e===null)return null;const i=new Yl(this._location.bucket,e);return new oE(this._service,i)}_throwIfRoot(e){if(this._location.path==="")throw v6e(e)}}function sWe(n,e,i){n._throwIfRoot("uploadBytes");const o=nWe(n.storage,n._location,Noe(),new Pg(e,!0),i);return n.storage.makeRequestWithTokens(o,b3).then(l=>({metadata:l,ref:n}))}function oWe(n){n._throwIfRoot("getDownloadURL");const e=Q6e(n.storage,n._location,Noe());return n.storage.makeRequestWithTokens(e,b3).then(i=>{if(i===null)throw y6e();return i})}function aWe(n){n._throwIfRoot("deleteObject");const e=Z6e(n.storage,n._location);return n.storage.makeRequestWithTokens(e,b3)}function cWe(n,e){const i=z6e(n._location.path,e),o=new Yl(n._location.bucket,i);return new oE(n.storage,o)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function lWe(n){return/^[A-Za-z]+:\/\//.test(n)}function uWe(n,e){return new oE(n,e)}function Uoe(n,e){if(n instanceof w3){const i=n;if(i._bucket==null)throw g6e();const o=new oE(i,i._bucket);return e!=null?Uoe(o,e):o}else return e!==void 0?cWe(n,e):n}function dWe(n,e){if(e&&lWe(e)){if(n instanceof w3)return uWe(n,e);throw wj("To use ref(service, url), the first argument must be a Storage instance.")}else return Uoe(n,e)}function fQ(n,e){const i=e==null?void 0:e[Toe];return i==null?null:Yl.makeFromBucketSpec(i,n)}function hWe(n,e,i,o={}){n.host=`${e}:${i}`,n._protocol="http";const{mockUserToken:l}=o;l&&(n._overrideAuthToken=typeof l=="string"?l:eie(l,n.app.options.projectId))}class w3{constructor(e,i,o,l,u){this.app=e,this._authProvider=i,this._appCheckProvider=o,this._url=l,this._firebaseVersion=u,this._bucket=null,this._host=woe,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=s6e,this._maxUploadRetryTime=o6e,this._requests=new Set,l!=null?this._bucket=Yl.makeFromBucketSpec(l,this._host):this._bucket=fQ(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,this._url!=null?this._bucket=Yl.makeFromBucketSpec(this._url,e):this._bucket=fQ(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){pQ("time",0,Number.POSITIVE_INFINITY,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){pQ("time",0,Number.POSITIVE_INFINITY,e),this._maxOperationRetryTime=e}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const e=this._authProvider.getImmediate({optional:!0});if(e){const i=await e.getToken();if(i!==null)return i.accessToken}return null}async _getAppCheckToken(){if($l(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=this._appCheckProvider.getImmediate({optional:!0});return e?(await e.getToken()).token:null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(e=>e.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new oE(this,e)}_makeRequest(e,i,o,l,u=!0){if(this._deleted)return new S6e(Coe());{const f=N6e(e,this._appId,o,l,i,this._firebaseVersion,u);return this._requests.add(f),f.getPromise().then(()=>this._requests.delete(f),()=>this._requests.delete(f)),f}}async makeRequestWithTokens(e,i){const[o,l]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(e,i,o,l).getPromise()}}const mQ="@firebase/storage",gQ="0.13.7";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Voe="storage";function VN(n,e,i){return n=qi(n),sWe(n,e,i)}function UR(n){return n=qi(n),oWe(n)}function jN(n){return n=qi(n),aWe(n)}function cm(n,e){return n=qi(n),dWe(n,e)}function lm(n=v4(),e){n=qi(n);const o=cN(n,Voe).getImmediate({identifier:e}),l=Jre("storage");return l&&pWe(o,...l),o}function pWe(n,e,i,o={}){hWe(n,e,i,o)}function fWe(n,{instanceIdentifier:e}){const i=n.getProvider("app").getImmediate(),o=n.getProvider("auth-internal"),l=n.getProvider("app-check-internal");return new w3(i,o,l,e,uE)}function mWe(){tE(new Bg(Voe,fWe,"PUBLIC").setMultipleInstances(!0)),Ep(mQ,gQ,""),Ep(mQ,gQ,"esm2017")}mWe();const Lk=async n=>{const e=lm(),i=cm(e,n);try{return await UR(i)}catch(o){throw H.error("Failed to fetch HTTP URL from gs:// URL:","/src/packages/shared/firebase/firebaseStorage.js",o),o}};let aE={};const Xu=async n=>{try{const e=dr(Dn,"spaces",n),i=await _o(e);if(i.exists()){let o=i.data();const l=o.name,u=o.description;if(o.webglBuildId){const f=dr(Dn,"webglBuilds",o.webglBuildId),_=await _o(f);if(_.exists()){const E=_.data();o={...o,...E,name:l||E.name,description:u||E.description}}else H.warn(`spacesFirestore: No document found for webglBuildId: ${o.webglBuildId}`)}return o=await gWe(o),o=_We(o),console.log("Space data:",o),H.log(`spacesFirestore: Caching space data for: ${n}`),aE[n]=o,o}else return H.warn(`spacesFirestore: No document found for item ID: ${n}`),null}catch(e){throw H.error("spacesFirestore: Error fetching item data:",e),e}},gWe=async n=>{const i=["gsUrlCode","gsUrlData","gsUrlFramework","gsUrlLoader","gsUrlLoadingBackground"].map(async o=>{const l=n[o];l&&l.startsWith("gs://")&&(n[o]=await Lk(l))});return await Promise.all(i),n},_We=n=>{const{gsUrlCode:e,gsUrlData:i,gsUrlFramework:o,gsUrlLoader:l,...u}=n;return{...u,codeUrl:e,dataUrl:i,frameworkUrl:o,loaderUrl:l}};let BU={};const joe=async n=>{H.log("spacesFirestore: Get Videos from Firestore for space: ",n);try{if(BU[n])return H.log("spacesFirestore: Returning cached videos for space:",n),BU[n];const e=Sl(Dn,`spaces/${n}/videos`),i=await ed(e),o=[];return i.forEach(l=>{o.push({id:l.id,...l.data()})}),BU[n]=o,o}catch(e){throw H.error("spacesFirestore: Error fetching Space videos from Firestore:",e),e}},yWe=async(n,e)=>{try{if(!n||!e)throw new Error("Missing required parameters: spaceId and logoFile");if(!e.type.startsWith("image/"))throw new Error("File must be an image");const i=lm(),o=Date.now(),l=e.name.split(".").pop(),u=`logo_${o}.${l}`,f=cm(i,`spaces/${n}/logo/${u}`);H.log(`Uploading logo for space ${n}`);const _=await VN(f,e),E=await UR(_.ref),b=dr(Dn,"spaces",n);return await ms(b,{logoUrl:E,logoGsUrl:`gs://${_.ref.bucket}/${_.ref.fullPath}`,logoFileName:u,updatedAt:new Date().toISOString()}),H.log(`Successfully uploaded logo for space ${n}`),E}catch(i){throw H.error("Error uploading space logo:",i),i}},EWe=async n=>{try{const e=dr(Dn,"spaces",n),i=await _o(e);if(!i.exists())return H.warn(`No space found with ID: ${n}`),!1;const o=i.data();if(o.logoGsUrl){const l=lm(),u=cm(l,o.logoGsUrl);try{await jN(u),H.log(`Deleted logo file from storage: ${o.logoGsUrl}`)}catch(f){H.warn(`Could not delete logo file from storage: ${f.message}`)}}return await ms(e,{logoUrl:null,logoGsUrl:null,logoFileName:null,updatedAt:new Date().toISOString()}),H.log(`Successfully removed logo for space ${n}`),!0}catch(e){throw H.error("Error deleting space logo:",e),e}},vWe=async(n,e)=>{try{if(!n||!e)throw new Error("Missing required parameters: spaceId and backgroundFile");if(!e.type.startsWith("image/"))throw new Error("File must be an image");const i=lm(),o=Date.now(),l=e.name.split(".").pop(),u=`background_${o}.${l}`,f=cm(i,`spaces/${n}/background/${u}`);H.log(`Uploading background for space ${n}`);const _=await VN(f,e),E=await UR(_.ref),b=dr(Dn,"spaces",n);return await ms(b,{backgroundUrl:E,backgroundGsUrl:`gs://${_.ref.bucket}/${_.ref.fullPath}`,backgroundFileName:u,gsUrlLoadingBackground:`gs://${_.ref.bucket}/${_.ref.fullPath}`,updatedAt:new Date().toISOString()}),H.log(`Successfully uploaded background for space ${n}`),E}catch(i){throw H.error("Error uploading space background:",i),i}},SWe=async n=>{try{const e=dr(Dn,"spaces",n),i=await _o(e);if(!i.exists())return H.warn(`No space found with ID: ${n}`),!1;const o=i.data();if(o.backgroundGsUrl){const l=lm(),u=cm(l,o.backgroundGsUrl);try{await jN(u),H.log(`Deleted background file from storage: ${o.backgroundGsUrl}`)}catch(f){H.warn(`Could not delete background file from storage: ${f.message}`)}}return await ms(e,{backgroundUrl:null,backgroundGsUrl:null,backgroundFileName:null,gsUrlLoadingBackground:null,updatedAt:new Date().toISOString()}),H.log(`Successfully removed background references for space ${n}`),!0}catch(e){throw H.error("Error deleting space background:",e),e}},bWe=async(n,e)=>{try{H.log(`spacesFirestore: Updating settings for space: ${n}`,e);const i=dr(Dn,"spaces",n),o=await _o(i);if(!o.exists())throw new Error(`Space with ID ${n} not found`);const l=o.data(),u={...e,accessibleToAllUsers:e.accessibleToAllUsers!==void 0?e.accessibleToAllUsers:l.accessibleToAllUsers!==void 0?l.accessibleToAllUsers:!0,updatedAt:new Date().toISOString()};await ms(i,u),aE[n]&&delete aE[n],H.log(`spacesFirestore: Successfully updated settings for space: ${n}`)}catch(i){throw H.error(`spacesFirestore: Error updating settings for space: ${n}`,i),i}},wWe=async(n,e)=>{try{H.log(`spacesFirestore: Setting accessibleToAllUsers=${e} for space: ${n}`);const i=dr(Dn,"spaces",n);if(!(await _o(i)).exists())throw new Error(`Space with ID ${n} not found`);await ms(i,{accessibleToAllUsers:e,updatedAt:new Date().toISOString()}),aE[n]&&delete aE[n],typeof window<"u"&&window.dispatchEvent(new CustomEvent("SpaceAccessibilityChanged",{detail:{spaceId:n,accessibleToAllUsers:e}})),H.log(`spacesFirestore: Successfully updated accessibleToAllUsers for space: ${n}`)}catch(i){throw H.error(`spacesFirestore: Error updating accessibleToAllUsers for space: ${n}`,i),i}},Tj=async(n,e)=>{try{H.log(`spacesFirestore: Updating HLS stream for space: ${n}`,e);const i=dr(Dn,"spaces",n);if(!(await _o(i)).exists())throw new Error(`Space with ID ${n} not found`);const{streamUrl:l,playerIndex:u="0",enabled:f=!0,rtmpUrl:_="",streamKey:E=""}=e,b={HLSStreamURL:{streamUrl:l,playerIndex:u,enabled:f,rtmpUrl:_,streamKey:E,updatedAt:new Date().toISOString()},updatedAt:new Date().toISOString()};return await ms(i,b),aE[n]&&delete aE[n],typeof window<"u"&&window.dispatchEvent(new CustomEvent("SpaceHLSStreamUpdated",{detail:{spaceId:n,streamUrl:l,playerIndex:u,enabled:f,rtmpUrl:_,streamKey:E}})),H.log(`spacesFirestore: Successfully updated HLS stream for space: ${n}`),!0}catch(i){throw H.error(`spacesFirestore: Error updating HLS stream for space: ${n}`,i),i}},Foe=async n=>{try{H.log(`spacesFirestore: Getting HLS stream for space: ${n}`);const e=dr(Dn,"spaces",n),i=await _o(e);if(!i.exists())return H.warn(`spacesFirestore: Space with ID ${n} not found`),null;const o=i.data();return o.HLSStreamURL?(H.log(`spacesFirestore: Found HLS stream for space: ${n}`,o.HLSStreamURL),o.HLSStreamURL):(H.log(`spacesFirestore: No HLS stream found for space: ${n}`),null)}catch(e){throw H.error(`spacesFirestore: Error getting HLS stream for space: ${n}`,e),e}},TWe=async(n,e)=>{try{if(!n||!e)throw new Error("Missing required parameters: spaceId and videoFile");if(!e.type.startsWith("video/"))throw new Error("File must be a video");const i=5*1024*1024;if(e.size>i)throw new Error("Video file must be smaller than 5MB");const o=lm(),l=Date.now(),u=e.name.split(".").pop(),f=`video_bg_${l}.${u}`,_=cm(o,`spaces/${n}/video_background/${f}`);H.log(`Uploading video background for space ${n}`);const E=await VN(_,e),b=await UR(E.ref),C=dr(Dn,"spaces",n);return await ms(C,{videoBackgroundUrl:b,videoBackgroundGsUrl:`gs://${E.ref.bucket}/${E.ref.fullPath}`,videoBackgroundFileName:f,updatedAt:new Date().toISOString()}),H.log(`Successfully uploaded video background for space ${n}`),b}catch(i){throw H.error("Error uploading space video background:",i),i}},CWe=async n=>{try{if(!n)throw new Error("Missing required parameter: spaceId");const e=dr(Dn,"spaces",n),i=await _o(e);if(!i.exists())throw new Error(`Space with ID ${n} not found`);const o=i.data();if(!o.videoBackgroundGsUrl){H.log(`No video background found for space ${n}`);return}const l=lm(),f=o.videoBackgroundGsUrl.replace("gs://",""),[_,...E]=f.split("/"),b=E.join("/"),C=cm(l,b);try{await jN(C),H.log(`Deleted video background file from storage for space ${n}`)}catch(I){H.error(`Failed to delete video background file, it may not exist: ${I.message}`)}await ms(e,{videoBackgroundUrl:null,videoBackgroundGsUrl:null,videoBackgroundFileName:null,updatedAt:new Date().toISOString()}),H.log(`Successfully removed video background for space ${n}`)}catch(e){throw H.error("Error deleting space video background:",e),e}},Uo=k.createContext(null),Boe=k.createContext(null),FN=({children:n})=>{const[e,i]=k.useState(null),o=k.useRef(null),[l,u]=k.useState(!0),[f,_]=k.useState(!1),E=hN(),b=ne=>ne?ne.Nickname?ne.Nickname:`${ne.firstName} ${ne.lastName}`:"Anon";k.useEffect(()=>{const ne=EFe(E,async pe=>{if(H.log("UserProvider: Firebase onAuthStateChanged() fired"),pe)try{const X=await td(pe.uid),J=b(X),Y={uid:pe.uid,email:pe.email,emailVerified:pe.emailVerified,...X,displayName:J};H.log(`UserProvider: User authenticated: ${pe.uid}`),i(Y),o.current=Y,L(Y)}catch(X){H.error("UserProvider: Error fetching user profile data:",X)}else i(null),o.current=null;u(!1)});return()=>{ne&&ne()}},[]);const C=async(ne,pe,X)=>{try{_(!0),H.log("UserProvider: Starting registration process"),H.log("UserProvider: Registration includes fields:",Object.keys(X||{}).join(", "));const J={...X},Y=["firstName","lastName","username","companyName","linkedInProfile"],ie=Y.filter(Re=>!J[Re]);ie.length>0&&H.warn(`UserProvider: Registration missing fields: ${ie.join(", ")}`);const le=J.firstName&&J.lastName?`${J.firstName}${J.lastName.charAt(0).toUpperCase()}`:"";H.log("UserProvider: Generated default nickname for registration");const de={firstName:"",lastName:"",companyName:"",linkedInProfile:"",username:"",Nickname:J.Nickname||le,groups:["users"],rpmURL:"https://models.readyplayer.me/67c8408d38f7924e15a8bd0a.glb",...J};H.log("UserProvider: Prepared registration data with fields:",Object.keys(de).join(", "));const ue=await XBe(ne,pe,de);H.log("UserProvider: Registration successful, received user data");const Oe=Y.filter(Re=>!ue[Re]);Oe.length>0&&H.warn(`UserProvider: Returned user data missing fields: ${Oe.join(", ")}`),["firstName","lastName","Nickname","username","companyName"].forEach(Re=>{ue[Re]||(H.warn(`UserProvider: ${Re} is missing in returned data, using original value`),ue[Re]=de[Re])});const xe={uid:ue.uid,email:ue.email,...ue,displayName:b(ue)};return H.log("UserProvider: Created user object with fields:",Object.keys(xe).join(", ")),i(xe),o.current=xe,H.log("UserProvider: User registered successfully with groups:",de.groups),await new Promise(Re=>setTimeout(Re,2e3)),_(!1),xe}catch(J){throw _(!1),H.error("UserProvider: Error during registration:",J),J}},I=async(ne,pe,X)=>{try{if(H.log("UserProvider: Signing in user"),!X)throw new Error("CAPTCHA verification is required");const Y=(await gFe(E,ne,pe)).user;return H.log("UserProvider: User signed in successfully:",Y.email),Y}catch(J){throw H.error("UserProvider: Error signing in:",J),J}},P=async()=>{try{await vFe(E),i(null),H.log("UserProvider: User signed out.")}catch(ne){throw H.error("UserProvider: Error signing out:",ne),ne}},L=()=>{const ne=o.current;if(ne){const pe=M(ne);H.log("UserProvider: sendUserToUnity() using the eventBus",pe),Yd.publish(qd.sendUserToUnity,pe)}else H.log("UserProvider: No current user to send to Unity.")},M=ne=>{const pe={};return[...r6e,"uid"].forEach(J=>{ne.hasOwnProperty(J)&&(pe[J]=ne[J])}),pe},F=async ne=>!e||!e.uid?!1:await MN(e.uid,ne),B=async ne=>{if(!e||!e.uid)return!1;try{const pe=await Xu(ne);if(pe.usersAllowed.includes(e.uid)||pe.userAdmin.includes(e.uid)||pe.usersModerators.includes(e.uid))return!0;if(e.groups&&Array.isArray(e.groups)){const J=`space_${ne}_owners`,Y=`space_${ne}_hosts`;if(e.groups.includes(J)||e.groups.includes(Y))return H.log(`UserProvider: User ${e.uid} has access to space ${ne} as owner/host`),!0}return pe.accessibleToAllUsers===!0&&e.groups?e.groups.includes("users"):!1}catch(pe){return H.error("UserProvider: Error verifying user access to space:",pe),!1}},Z=async ne=>{if(!e||!e.uid)return!1;try{return(await Xu(ne)).userAdmin.includes(e.uid)}catch(pe){return H.error("UserProvider: Error verifying user admin status for space:",pe),!1}},K=async ne=>{if(!e||!e.uid)return!1;try{return(await Xu(ne)).usersModerators.includes(e.uid)}catch(pe){return H.error("UserProvider: Error verifying user moderator status for space:",pe),!1}},re=async()=>{try{const ne=E.currentUser;return ne&&!ne.emailVerified?(await Nie(ne),H.log("UserProvider: Verification email resent to:",ne.email),!0):!1}catch(ne){throw H.error("UserProvider: Error resending verification email:",ne),ne}},ae=async()=>{try{const ne=E.currentUser;if(!ne)return H.warn("UserProvider: updateUser called but no current user exists"),null;H.log("UserProvider: Updating user data from Firestore");const pe=await td(ne.uid);if(!pe)return H.error("UserProvider: Failed to fetch updated user profile"),null;const X=b(pe),J={uid:ne.uid,email:ne.email,emailVerified:ne.emailVerified,...pe,displayName:X};return H.log("UserProvider: User data updated with fields:",Object.keys(J).join(", ")),i(J),o.current=J,L(J),J}catch(ne){throw H.error("UserProvider: Error updating user data:",ne),ne}};return S.jsx(Boe.Provider,{value:{registrationInProgress:f},children:S.jsx(Uo.Provider,{value:{user:e,loading:l,register:C,signIn:I,signOut:P,sendUserToUnity:L,isUserInGroup:F,userHasAccessToSpace:B,userIsAdminOfSpace:Z,userIsModeratorOfSpace:K,resendVerificationEmail:re,updateUser:ae},children:n})})},RWe=()=>{const n=k.useContext(Boe);if(n===void 0)throw new Error("useRegistration must be used within a UserProvider");return n},Woe=k.createContext(),Zd=()=>k.useContext(Woe),T3=({children:n})=>{const[e,i]=k.useState(!1),o=k.useRef(null),[l,u]=k.useState(!1);k.useEffect(()=>{const E=()=>{const b=/iPhone|iPad|iPod|Android/i.test(navigator.userAgent);u(b)};return E(),window.addEventListener("resize",E),()=>window.removeEventListener("resize",E)},[]);const f=k.useCallback(E=>{o.current=E},[]),_=k.useCallback(()=>{const E=o.current;if(!E)return;const b=document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement;if(l){console.log("Attempting mobile fullscreen...");const C=E.querySelector("video")||E;if(/iPhone|iPad|iPod/i.test(navigator.userAgent)){if(C.webkitEnterFullscreen)try{C.webkitEnterFullscreen(),i(!0);return}catch(I){console.error("iOS fullscreen error:",I)}try{if(C.webkitRequestFullscreen){C.webkitRequestFullscreen(),i(!0);return}}catch(I){console.error("iOS fallback fullscreen error:",I)}}if(/Android/i.test(navigator.userAgent))try{b?(document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.msExitFullscreen&&document.msExitFullscreen(),i(!1)):(E.requestFullscreen?E.requestFullscreen():E.webkitRequestFullscreen?E.webkitRequestFullscreen():E.mozRequestFullScreen?E.mozRequestFullScreen():E.msRequestFullscreen&&E.msRequestFullscreen(),i(!0));return}catch(I){console.error("Android fullscreen error:",I)}}try{b?document.exitFullscreen?document.exitFullscreen().then(()=>{i(!1)}).catch(C=>console.error("Error exiting fullscreen:",C)):document.webkitExitFullscreen?(document.webkitExitFullscreen(),i(!1)):document.mozCancelFullScreen?(document.mozCancelFullScreen(),i(!1)):document.msExitFullscreen&&(document.msExitFullscreen(),i(!1)):E.requestFullscreen?E.requestFullscreen().then(()=>{i(!0)}).catch(C=>console.error("Error entering fullscreen:",C)):E.webkitRequestFullscreen?(E.webkitRequestFullscreen(),i(!0)):E.mozRequestFullScreen?(E.mozRequestFullScreen(),i(!0)):E.msRequestFullscreen&&(E.msRequestFullscreen(),i(!0))}catch(C){console.error("Fullscreen error:",C)}},[l]);return k.useEffect(()=>{const E=()=>{const b=document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement;i(!!b)};return document.addEventListener("fullscreenchange",E),document.addEventListener("webkitfullscreenchange",E),document.addEventListener("mozfullscreenchange",E),document.addEventListener("MSFullscreenChange",E),()=>{document.removeEventListener("fullscreenchange",E),document.removeEventListener("webkitfullscreenchange",E),document.removeEventListener("mozfullscreenchange",E),document.removeEventListener("MSFullscreenChange",E)}},[]),S.jsx(Woe.Provider,{value:{isFullscreen:e,toggleFullscreen:_,fullscreenRef:o,setFullscreenRef:f,isMobile:l},children:S.jsx("div",{ref:f,style:{position:"relative",zIndex:1,width:"100%",height:"100%",overflow:"hidden"},children:n})})},IWe=Jg({d:"M0,12a1.5,1.5,0,0,0,1.5,1.5h8.75a.25.25,0,0,1,.25.25V22.5a1.5,1.5,0,0,0,3,0V13.75a.25.25,0,0,1,.25-.25H22.5a1.5,1.5,0,0,0,0-3H13.75a.25.25,0,0,1-.25-.25V1.5a1.5,1.5,0,0,0-3,0v8.75a.25.25,0,0,1-.25.25H1.5A1.5,1.5,0,0,0,0,12Z",displayName:"AddIcon"}),AWe=Jg({viewBox:"0 0 14 14",d:"M14,7.77 L14,6.17 L12.06,5.53 L11.61,4.44 L12.49,2.6 L11.36,1.47 L9.55,2.38 L8.46,1.93 L7.77,0.01 L6.17,0.01 L5.54,1.95 L4.43,2.4 L2.59,1.52 L1.46,2.65 L2.37,4.46 L1.92,5.55 L0,6.23 L0,7.82 L1.94,8.46 L2.39,9.55 L1.51,11.39 L2.64,12.52 L4.45,11.61 L5.54,12.06 L6.23,13.98 L7.82,13.98 L8.45,12.04 L9.56,11.59 L11.4,12.47 L12.53,11.34 L11.61,9.53 L12.08,8.44 L14,7.75 L14,7.77 Z M7,10 C5.34,10 4,8.66 4,7 C4,5.34 5.34,4 7,4 C8.66,4 10,5.34 10,7 C10,8.66 8.66,10 7,10 Z",displayName:"SettingsIcon"}),PWe=Jg({d:"M19.5,9.5h-.75V6.75a6.75,6.75,0,0,0-13.5,0V9.5H4.5a2,2,0,0,0-2,2V22a2,2,0,0,0,2,2h15a2,2,0,0,0,2-2V11.5A2,2,0,0,0,19.5,9.5Zm-9.5,6a2,2,0,1,1,3,1.723V19.5a1,1,0,0,1-2,0V17.223A1.994,1.994,0,0,1,10,15.5ZM7.75,6.75a4.25,4.25,0,0,1,8.5,0V9a.5.5,0,0,1-.5.5H8.25a.5.5,0,0,1-.5-.5Z",displayName:"LockIcon"}),zoe=Jg({displayName:"ChevronDownIcon",d:"M16.59 8.59L12 13.17 7.41 8.59 6 10l6 6 6-6z"}),_Q=Jg({displayName:"EmailIcon",path:S.jsxs("g",{fill:"currentColor",children:[S.jsx("path",{d:"M11.114,14.556a1.252,1.252,0,0,0,1.768,0L22.568,4.87a.5.5,0,0,0-.281-.849A1.966,1.966,0,0,0,22,4H2a1.966,1.966,0,0,0-.289.021.5.5,0,0,0-.281.849Z"}),S.jsx("path",{d:"M23.888,5.832a.182.182,0,0,0-.2.039l-6.2,6.2a.251.251,0,0,0,0,.354l5.043,5.043a.75.75,0,1,1-1.06,1.061l-5.043-5.043a.25.25,0,0,0-.354,0l-2.129,2.129a2.75,2.75,0,0,1-3.888,0L7.926,13.488a.251.251,0,0,0-.354,0L2.529,18.531a.75.75,0,0,1-1.06-1.061l5.043-5.043a.251.251,0,0,0,0-.354l-6.2-6.2a.18.18,0,0,0-.2-.039A.182.182,0,0,0,0,6V18a2,2,0,0,0,2,2H22a2,2,0,0,0,2-2V6A.181.181,0,0,0,23.888,5.832Z"})]})}),OWe=Jg({displayName:"CloseIcon",d:"M.439,21.44a1.5,1.5,0,0,0,2.122,2.121L11.823,14.3a.25.25,0,0,1,.354,0l9.262,9.263a1.5,1.5,0,1,0,2.122-2.121L14.3,12.177a.25.25,0,0,1,0-.354l9.263-9.262A1.5,1.5,0,0,0,21.439.44L12.177,9.7a.25.25,0,0,1-.354,0L2.561.44A1.5,1.5,0,0,0,.439,2.561L9.7,11.823a.25.25,0,0,1,0,.354Z"}),kWe=Jg({displayName:"QuestionOutlineIcon",path:S.jsxs("g",{stroke:"currentColor",strokeWidth:"1.5",children:[S.jsx("path",{strokeLinecap:"round",fill:"none",d:"M9,9a3,3,0,1,1,4,2.829,1.5,1.5,0,0,0-1,1.415V14.25"}),S.jsx("path",{fill:"none",strokeLinecap:"round",d:"M12,17.25a.375.375,0,1,0,.375.375A.375.375,0,0,0,12,17.25h0"}),S.jsx("circle",{fill:"none",strokeMiterlimit:"10",cx:"12",cy:"12",r:"11.25"})]})}),NWe=Jg({displayName:"HamburgerIcon",viewBox:"0 0 24 24",d:"M 3 5 A 1.0001 1.0001 0 1 0 3 7 L 21 7 A 1.0001 1.0001 0 1 0 21 5 L 3 5 z M 3 11 A 1.0001 1.0001 0 1 0 3 13 L 21 13 A 1.0001 1.0001 0 1 0 21 11 L 3 11 z M 3 17 A 1.0001 1.0001 0 1 0 3 19 L 21 19 A 1.0001 1.0001 0 1 0 21 17 L 3 17 z"});var VR=n=>n.type==="checkbox",Ly=n=>n instanceof Date,kc=n=>n==null;const Goe=n=>typeof n=="object";var so=n=>!kc(n)&&!Array.isArray(n)&&Goe(n)&&!Ly(n),DWe=n=>so(n)&&n.target?VR(n.target)?n.target.checked:n.target.value:n,xWe=n=>n.substring(0,n.search(/\.\d+(\.|$)/))||n,LWe=(n,e)=>n.has(xWe(e)),MWe=n=>{const e=n.constructor&&n.constructor.prototype;return so(e)&&e.hasOwnProperty("isPrototypeOf")},C3=typeof window<"u"&&typeof window.HTMLElement<"u"&&typeof document<"u";function zu(n){let e;const i=Array.isArray(n),o=typeof FileList<"u"?n instanceof FileList:!1;if(n instanceof Date)e=new Date(n);else if(n instanceof Set)e=new Set(n);else if(!(C3&&(n instanceof Blob||o))&&(i||so(n)))if(e=i?[]:{},!i&&!MWe(n))e=n;else for(const l in n)n.hasOwnProperty(l)&&(e[l]=zu(n[l]));else return n;return e}var BN=n=>Array.isArray(n)?n.filter(Boolean):[],po=n=>n===void 0,hn=(n,e,i)=>{if(!e||!so(n))return i;const o=BN(e.split(/[,[\].]+?/)).reduce((l,u)=>kc(l)?l:l[u],n);return po(o)||o===n?po(n[e])?i:n[e]:o},Qh=n=>typeof n=="boolean",R3=n=>/^\w*$/.test(n),Hoe=n=>BN(n.replace(/["|']|\]/g,"").split(/\.|\[/)),is=(n,e,i)=>{let o=-1;const l=R3(e)?[e]:Hoe(e),u=l.length,f=u-1;for(;++o<u;){const _=l[o];let E=i;if(o!==f){const b=n[_];E=so(b)||Array.isArray(b)?b:isNaN(+l[o+1])?{}:[]}if(_==="__proto__"||_==="constructor"||_==="prototype")return;n[_]=E,n=n[_]}return n};const yQ={BLUR:"blur",FOCUS_OUT:"focusout"},Kd={onBlur:"onBlur",onChange:"onChange",onSubmit:"onSubmit",onTouched:"onTouched",all:"all"},Pf={max:"max",min:"min",maxLength:"maxLength",minLength:"minLength",pattern:"pattern",required:"required",validate:"validate"};gi.createContext(null);var UWe=(n,e,i,o=!0)=>{const l={defaultValues:e._defaultValues};for(const u in n)Object.defineProperty(l,u,{get:()=>{const f=u;return e._proxyFormState[f]!==Kd.all&&(e._proxyFormState[f]=!o||Kd.all),n[f]}});return l},hl=n=>so(n)&&!Object.keys(n).length,VWe=(n,e,i,o)=>{i(n);const{name:l,...u}=n;return hl(u)||Object.keys(u).length>=Object.keys(e).length||Object.keys(u).find(f=>e[f]===Kd.all)},Mk=n=>Array.isArray(n)?n:[n];function jWe(n){const e=gi.useRef(n);e.current=n,gi.useEffect(()=>{const i=!n.disabled&&e.current.subject&&e.current.subject.subscribe({next:e.current.next});return()=>{i&&i.unsubscribe()}},[n.disabled])}var up=n=>typeof n=="string",FWe=(n,e,i,o,l)=>up(n)?(o&&e.watch.add(n),hn(i,n,l)):Array.isArray(n)?n.map(u=>(o&&e.watch.add(u),hn(i,u))):(o&&(e.watchAll=!0),i),BWe=(n,e,i,o,l)=>e?{...i[n],types:{...i[n]&&i[n].types?i[n].types:{},[o]:l||!0}}:{},EQ=n=>({isOnSubmit:!n||n===Kd.onSubmit,isOnBlur:n===Kd.onBlur,isOnChange:n===Kd.onChange,isOnAll:n===Kd.all,isOnTouch:n===Kd.onTouched}),vQ=(n,e,i)=>!i&&(e.watchAll||e.watch.has(n)||[...e.watch].some(o=>n.startsWith(o)&&/^\.\w+/.test(n.slice(o.length))));const IC=(n,e,i,o)=>{for(const l of i||Object.keys(n)){const u=hn(n,l);if(u){const{_f:f,..._}=u;if(f){if(f.refs&&f.refs[0]&&e(f.refs[0],l)&&!o)return!0;if(f.ref&&e(f.ref,f.name)&&!o)return!0;if(IC(_,e))break}else if(so(_)&&IC(_,e))break}}};var WWe=(n,e,i)=>{const o=Mk(hn(n,i));return is(o,"root",e[i]),is(n,i,o),n},I3=n=>n.type==="file",ip=n=>typeof n=="function",T1=n=>{if(!C3)return!1;const e=n?n.ownerDocument:0;return n instanceof(e&&e.defaultView?e.defaultView.HTMLElement:HTMLElement)},Uk=n=>up(n),A3=n=>n.type==="radio",C1=n=>n instanceof RegExp;const SQ={value:!1,isValid:!1},bQ={value:!0,isValid:!0};var $oe=n=>{if(Array.isArray(n)){if(n.length>1){const e=n.filter(i=>i&&i.checked&&!i.disabled).map(i=>i.value);return{value:e,isValid:!!e.length}}return n[0].checked&&!n[0].disabled?n[0].attributes&&!po(n[0].attributes.value)?po(n[0].value)||n[0].value===""?bQ:{value:n[0].value,isValid:!0}:bQ:SQ}return SQ};const wQ={isValid:!1,value:null};var Koe=n=>Array.isArray(n)?n.reduce((e,i)=>i&&i.checked&&!i.disabled?{isValid:!0,value:i.value}:e,wQ):wQ;function TQ(n,e,i="validate"){if(Uk(n)||Array.isArray(n)&&n.every(Uk)||Qh(n)&&!n)return{type:i,message:Uk(n)?n:"",ref:e}}var VS=n=>so(n)&&!C1(n)?n:{value:n,message:""},CQ=async(n,e,i,o,l,u)=>{const{ref:f,refs:_,required:E,maxLength:b,minLength:C,min:I,max:P,pattern:L,validate:M,name:F,valueAsNumber:B,mount:Z}=n._f,K=hn(i,F);if(!Z||e.has(F))return{};const re=_?_[0]:f,ae=de=>{l&&re.reportValidity&&(re.setCustomValidity(Qh(de)?"":de||""),re.reportValidity())},ne={},pe=A3(f),X=VR(f),J=pe||X,Y=(B||I3(f))&&po(f.value)&&po(K)||T1(f)&&f.value===""||K===""||Array.isArray(K)&&!K.length,ie=BWe.bind(null,F,o,ne),le=(de,ue,Oe,Ve=Pf.maxLength,xe=Pf.minLength)=>{const Re=de?ue:Oe;ne[F]={type:de?Ve:xe,message:Re,ref:f,...ie(de?Ve:xe,Re)}};if(u?!Array.isArray(K)||!K.length:E&&(!J&&(Y||kc(K))||Qh(K)&&!K||X&&!$oe(_).isValid||pe&&!Koe(_).isValid)){const{value:de,message:ue}=Uk(E)?{value:!!E,message:E}:VS(E);if(de&&(ne[F]={type:Pf.required,message:ue,ref:re,...ie(Pf.required,ue)},!o))return ae(ue),ne}if(!Y&&(!kc(I)||!kc(P))){let de,ue;const Oe=VS(P),Ve=VS(I);if(!kc(K)&&!isNaN(K)){const xe=f.valueAsNumber||K&&+K;kc(Oe.value)||(de=xe>Oe.value),kc(Ve.value)||(ue=xe<Ve.value)}else{const xe=f.valueAsDate||new Date(K),Re=We=>new Date(new Date().toDateString()+" "+We),ve=f.type=="time",be=f.type=="week";up(Oe.value)&&K&&(de=ve?Re(K)>Re(Oe.value):be?K>Oe.value:xe>new Date(Oe.value)),up(Ve.value)&&K&&(ue=ve?Re(K)<Re(Ve.value):be?K<Ve.value:xe<new Date(Ve.value))}if((de||ue)&&(le(!!de,Oe.message,Ve.message,Pf.max,Pf.min),!o))return ae(ne[F].message),ne}if((b||C)&&!Y&&(up(K)||u&&Array.isArray(K))){const de=VS(b),ue=VS(C),Oe=!kc(de.value)&&K.length>+de.value,Ve=!kc(ue.value)&&K.length<+ue.value;if((Oe||Ve)&&(le(Oe,de.message,ue.message),!o))return ae(ne[F].message),ne}if(L&&!Y&&up(K)){const{value:de,message:ue}=VS(L);if(C1(de)&&!K.match(de)&&(ne[F]={type:Pf.pattern,message:ue,ref:f,...ie(Pf.pattern,ue)},!o))return ae(ue),ne}if(M){if(ip(M)){const de=await M(K,i),ue=TQ(de,re);if(ue&&(ne[F]={...ue,...ie(Pf.validate,ue.message)},!o))return ae(ue.message),ne}else if(so(M)){let de={};for(const ue in M){if(!hl(de)&&!o)break;const Oe=TQ(await M[ue](K,i),re,ue);Oe&&(de={...Oe,...ie(ue,Oe.message)},ae(Oe.message),o&&(ne[F]=de))}if(!hl(de)&&(ne[F]={ref:re,...de},!o))return ne}}return ae(!0),ne};function zWe(n,e){const i=e.slice(0,-1).length;let o=0;for(;o<i;)n=po(n)?o++:n[e[o++]];return n}function GWe(n){for(const e in n)if(n.hasOwnProperty(e)&&!po(n[e]))return!1;return!0}function No(n,e){const i=Array.isArray(e)?e:R3(e)?[e]:Hoe(e),o=i.length===1?n:zWe(n,i),l=i.length-1,u=i[l];return o&&delete o[u],l!==0&&(so(o)&&hl(o)||Array.isArray(o)&&GWe(o))&&No(n,i.slice(0,-1)),n}var WU=()=>{let n=[];return{get observers(){return n},next:l=>{for(const u of n)u.next&&u.next(l)},subscribe:l=>(n.push(l),{unsubscribe:()=>{n=n.filter(u=>u!==l)}}),unsubscribe:()=>{n=[]}}},Cj=n=>kc(n)||!Goe(n);function Og(n,e){if(Cj(n)||Cj(e))return n===e;if(Ly(n)&&Ly(e))return n.getTime()===e.getTime();const i=Object.keys(n),o=Object.keys(e);if(i.length!==o.length)return!1;for(const l of i){const u=n[l];if(!o.includes(l))return!1;if(l!=="ref"){const f=e[l];if(Ly(u)&&Ly(f)||so(u)&&so(f)||Array.isArray(u)&&Array.isArray(f)?!Og(u,f):u!==f)return!1}}return!0}var qoe=n=>n.type==="select-multiple",HWe=n=>A3(n)||VR(n),zU=n=>T1(n)&&n.isConnected,Yoe=n=>{for(const e in n)if(ip(n[e]))return!0;return!1};function R1(n,e={}){const i=Array.isArray(n);if(so(n)||i)for(const o in n)Array.isArray(n[o])||so(n[o])&&!Yoe(n[o])?(e[o]=Array.isArray(n[o])?[]:{},R1(n[o],e[o])):kc(n[o])||(e[o]=!0);return e}function Xoe(n,e,i){const o=Array.isArray(n);if(so(n)||o)for(const l in n)Array.isArray(n[l])||so(n[l])&&!Yoe(n[l])?po(e)||Cj(i[l])?i[l]=Array.isArray(n[l])?R1(n[l],[]):{...R1(n[l])}:Xoe(n[l],kc(e)?{}:e[l],i[l]):i[l]=!Og(n[l],e[l]);return i}var NT=(n,e)=>Xoe(n,e,R1(e)),Joe=(n,{valueAsNumber:e,valueAsDate:i,setValueAs:o})=>po(n)?n:e?n===""?NaN:n&&+n:i&&up(n)?new Date(n):o?o(n):n;function GU(n){const e=n.ref;return I3(e)?e.files:A3(e)?Koe(n.refs).value:qoe(e)?[...e.selectedOptions].map(({value:i})=>i):VR(e)?$oe(n.refs).value:Joe(po(e.value)?n.ref.value:e.value,n)}var $We=(n,e,i,o)=>{const l={};for(const u of n){const f=hn(e,u);f&&is(l,u,f._f)}return{criteriaMode:i,names:[...n],fields:l,shouldUseNativeValidation:o}},DT=n=>po(n)?n:C1(n)?n.source:so(n)?C1(n.value)?n.value.source:n.value:n;const RQ="AsyncFunction";var KWe=n=>!!n&&!!n.validate&&!!(ip(n.validate)&&n.validate.constructor.name===RQ||so(n.validate)&&Object.values(n.validate).find(e=>e.constructor.name===RQ)),qWe=n=>n.mount&&(n.required||n.min||n.max||n.maxLength||n.minLength||n.pattern||n.validate);function IQ(n,e,i){const o=hn(n,i);if(o||R3(i))return{error:o,name:i};const l=i.split(".");for(;l.length;){const u=l.join("."),f=hn(e,u),_=hn(n,u);if(f&&!Array.isArray(f)&&i!==u)return{name:i};if(_&&_.type)return{name:u,error:_};l.pop()}return{name:i}}var YWe=(n,e,i,o,l)=>l.isOnAll?!1:!i&&l.isOnTouch?!(e||n):(i?o.isOnBlur:l.isOnBlur)?!n:(i?o.isOnChange:l.isOnChange)?n:!0,XWe=(n,e)=>!BN(hn(n,e)).length&&No(n,e);const JWe={mode:Kd.onSubmit,reValidateMode:Kd.onChange,shouldFocusError:!0};function QWe(n={}){let e={...JWe,...n},i={submitCount:0,isDirty:!1,isLoading:ip(e.defaultValues),isValidating:!1,isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,touchedFields:{},dirtyFields:{},validatingFields:{},errors:e.errors||{},disabled:e.disabled||!1},o={},l=so(e.defaultValues)||so(e.values)?zu(e.defaultValues||e.values)||{}:{},u=e.shouldUnregister?{}:zu(l),f={action:!1,mount:!1,watch:!1},_={mount:new Set,disabled:new Set,unMount:new Set,array:new Set,watch:new Set},E,b=0;const C={isDirty:!1,dirtyFields:!1,validatingFields:!1,touchedFields:!1,isValidating:!1,isValid:!1,errors:!1},I={values:WU(),array:WU(),state:WU()},P=EQ(e.mode),L=EQ(e.reValidateMode),M=e.criteriaMode===Kd.all,F=we=>je=>{clearTimeout(b),b=setTimeout(we,je)},B=async we=>{if(!e.disabled&&(C.isValid||we)){const je=e.resolver?hl((await J()).errors):await ie(o,!0);je!==i.isValid&&I.state.next({isValid:je})}},Z=(we,je)=>{!e.disabled&&(C.isValidating||C.validatingFields)&&((we||Array.from(_.mount)).forEach(Ke=>{Ke&&(je?is(i.validatingFields,Ke,je):No(i.validatingFields,Ke))}),I.state.next({validatingFields:i.validatingFields,isValidating:!hl(i.validatingFields)}))},K=(we,je=[],Ke,gt,Et=!0,Tt=!0)=>{if(gt&&Ke&&!e.disabled){if(f.action=!0,Tt&&Array.isArray(hn(o,we))){const Kt=Ke(hn(o,we),gt.argA,gt.argB);Et&&is(o,we,Kt)}if(Tt&&Array.isArray(hn(i.errors,we))){const Kt=Ke(hn(i.errors,we),gt.argA,gt.argB);Et&&is(i.errors,we,Kt),XWe(i.errors,we)}if(C.touchedFields&&Tt&&Array.isArray(hn(i.touchedFields,we))){const Kt=Ke(hn(i.touchedFields,we),gt.argA,gt.argB);Et&&is(i.touchedFields,we,Kt)}C.dirtyFields&&(i.dirtyFields=NT(l,u)),I.state.next({name:we,isDirty:de(we,je),dirtyFields:i.dirtyFields,errors:i.errors,isValid:i.isValid})}else is(u,we,je)},re=(we,je)=>{is(i.errors,we,je),I.state.next({errors:i.errors})},ae=we=>{i.errors=we,I.state.next({errors:i.errors,isValid:!1})},ne=(we,je,Ke,gt)=>{const Et=hn(o,we);if(Et){const Tt=hn(u,we,po(Ke)?hn(l,we):Ke);po(Tt)||gt&&gt.defaultChecked||je?is(u,we,je?Tt:GU(Et._f)):Ve(we,Tt),f.mount&&B()}},pe=(we,je,Ke,gt,Et)=>{let Tt=!1,Kt=!1;const gn={name:we};if(!e.disabled){const Sn=!!(hn(o,we)&&hn(o,we)._f&&hn(o,we)._f.disabled);if(!Ke||gt){C.isDirty&&(Kt=i.isDirty,i.isDirty=gn.isDirty=de(),Tt=Kt!==gn.isDirty);const sn=Sn||Og(hn(l,we),je);Kt=!!(!Sn&&hn(i.dirtyFields,we)),sn||Sn?No(i.dirtyFields,we):is(i.dirtyFields,we,!0),gn.dirtyFields=i.dirtyFields,Tt=Tt||C.dirtyFields&&Kt!==!sn}if(Ke){const sn=hn(i.touchedFields,we);sn||(is(i.touchedFields,we,Ke),gn.touchedFields=i.touchedFields,Tt=Tt||C.touchedFields&&sn!==Ke)}Tt&&Et&&I.state.next(gn)}return Tt?gn:{}},X=(we,je,Ke,gt)=>{const Et=hn(i.errors,we),Tt=C.isValid&&Qh(je)&&i.isValid!==je;if(e.delayError&&Ke?(E=F(()=>re(we,Ke)),E(e.delayError)):(clearTimeout(b),E=null,Ke?is(i.errors,we,Ke):No(i.errors,we)),(Ke?!Og(Et,Ke):Et)||!hl(gt)||Tt){const Kt={...gt,...Tt&&Qh(je)?{isValid:je}:{},errors:i.errors,name:we};i={...i,...Kt},I.state.next(Kt)}},J=async we=>{Z(we,!0);const je=await e.resolver(u,e.context,$We(we||_.mount,o,e.criteriaMode,e.shouldUseNativeValidation));return Z(we),je},Y=async we=>{const{errors:je}=await J(we);if(we)for(const Ke of we){const gt=hn(je,Ke);gt?is(i.errors,Ke,gt):No(i.errors,Ke)}else i.errors=je;return je},ie=async(we,je,Ke={valid:!0})=>{for(const gt in we){const Et=we[gt];if(Et){const{_f:Tt,...Kt}=Et;if(Tt){const gn=_.array.has(Tt.name),Sn=Et._f&&KWe(Et._f);Sn&&C.validatingFields&&Z([gt],!0);const sn=await CQ(Et,_.disabled,u,M,e.shouldUseNativeValidation&&!je,gn);if(Sn&&C.validatingFields&&Z([gt]),sn[Tt.name]&&(Ke.valid=!1,je))break;!je&&(hn(sn,Tt.name)?gn?WWe(i.errors,sn,Tt.name):is(i.errors,Tt.name,sn[Tt.name]):No(i.errors,Tt.name))}!hl(Kt)&&await ie(Kt,je,Ke)}}return Ke.valid},le=()=>{for(const we of _.unMount){const je=hn(o,we);je&&(je._f.refs?je._f.refs.every(Ke=>!zU(Ke)):!zU(je._f.ref))&&qe(we)}_.unMount=new Set},de=(we,je)=>!e.disabled&&(we&&je&&is(u,we,je),!Og(Pe(),l)),ue=(we,je,Ke)=>FWe(we,_,{...f.mount?u:po(je)?l:up(we)?{[we]:je}:je},Ke,je),Oe=we=>BN(hn(f.mount?u:l,we,e.shouldUnregister?hn(l,we,[]):[])),Ve=(we,je,Ke={})=>{const gt=hn(o,we);let Et=je;if(gt){const Tt=gt._f;Tt&&(!Tt.disabled&&is(u,we,Joe(je,Tt)),Et=T1(Tt.ref)&&kc(je)?"":je,qoe(Tt.ref)?[...Tt.ref.options].forEach(Kt=>Kt.selected=Et.includes(Kt.value)):Tt.refs?VR(Tt.ref)?Tt.refs.length>1?Tt.refs.forEach(Kt=>(!Kt.defaultChecked||!Kt.disabled)&&(Kt.checked=Array.isArray(Et)?!!Et.find(gn=>gn===Kt.value):Et===Kt.value)):Tt.refs[0]&&(Tt.refs[0].checked=!!Et):Tt.refs.forEach(Kt=>Kt.checked=Kt.value===Et):I3(Tt.ref)?Tt.ref.value="":(Tt.ref.value=Et,Tt.ref.type||I.values.next({name:we,values:{...u}})))}(Ke.shouldDirty||Ke.shouldTouch)&&pe(we,Et,Ke.shouldTouch,Ke.shouldDirty,!0),Ke.shouldValidate&&We(we)},xe=(we,je,Ke)=>{for(const gt in je){const Et=je[gt],Tt=`${we}.${gt}`,Kt=hn(o,Tt);(_.array.has(we)||so(Et)||Kt&&!Kt._f)&&!Ly(Et)?xe(Tt,Et,Ke):Ve(Tt,Et,Ke)}},Re=(we,je,Ke={})=>{const gt=hn(o,we),Et=_.array.has(we),Tt=zu(je);is(u,we,Tt),Et?(I.array.next({name:we,values:{...u}}),(C.isDirty||C.dirtyFields)&&Ke.shouldDirty&&I.state.next({name:we,dirtyFields:NT(l,u),isDirty:de(we,Tt)})):gt&&!gt._f&&!kc(Tt)?xe(we,Tt,Ke):Ve(we,Tt,Ke),vQ(we,_)&&I.state.next({...i}),I.values.next({name:f.mount?we:void 0,values:{...u}})},ve=async we=>{f.mount=!0;const je=we.target;let Ke=je.name,gt=!0;const Et=hn(o,Ke),Tt=()=>je.type?GU(Et._f):DWe(we),Kt=gn=>{gt=Number.isNaN(gn)||Ly(gn)&&isNaN(gn.getTime())||Og(gn,hn(u,Ke,gn))};if(Et){let gn,Sn;const sn=Tt(),wt=we.type===yQ.BLUR||we.type===yQ.FOCUS_OUT,ir=!qWe(Et._f)&&!e.resolver&&!hn(i.errors,Ke)&&!Et._f.deps||YWe(wt,hn(i.touchedFields,Ke),i.isSubmitted,L,P),Vt=vQ(Ke,_,wt);is(u,Ke,sn),wt?(Et._f.onBlur&&Et._f.onBlur(we),E&&E(0)):Et._f.onChange&&Et._f.onChange(we);const zt=pe(Ke,sn,wt,!1),_n=!hl(zt)||Vt;if(!wt&&I.values.next({name:Ke,type:we.type,values:{...u}}),ir)return C.isValid&&(e.mode==="onBlur"&&wt?B():wt||B()),_n&&I.state.next({name:Ke,...Vt?{}:zt});if(!wt&&Vt&&I.state.next({...i}),e.resolver){const{errors:Ui}=await J([Ke]);if(Kt(sn),gt){const Ts=IQ(i.errors,o,Ke),ui=IQ(Ui,o,Ts.name||Ke);gn=ui.error,Ke=ui.name,Sn=hl(Ui)}}else Z([Ke],!0),gn=(await CQ(Et,_.disabled,u,M,e.shouldUseNativeValidation))[Ke],Z([Ke]),Kt(sn),gt&&(gn?Sn=!1:C.isValid&&(Sn=await ie(o,!0)));gt&&(Et._f.deps&&We(Et._f.deps),X(Ke,Sn,gn,zt))}},be=(we,je)=>{if(hn(i.errors,je)&&we.focus)return we.focus(),1},We=async(we,je={})=>{let Ke,gt;const Et=Mk(we);if(e.resolver){const Tt=await Y(po(we)?we:Et);Ke=hl(Tt),gt=we?!Et.some(Kt=>hn(Tt,Kt)):Ke}else we?(gt=(await Promise.all(Et.map(async Tt=>{const Kt=hn(o,Tt);return await ie(Kt&&Kt._f?{[Tt]:Kt}:Kt)}))).every(Boolean),!(!gt&&!i.isValid)&&B()):gt=Ke=await ie(o);return I.state.next({...!up(we)||C.isValid&&Ke!==i.isValid?{}:{name:we},...e.resolver||!we?{isValid:Ke}:{},errors:i.errors}),je.shouldFocus&&!gt&&IC(o,be,we?Et:_.mount),gt},Pe=we=>{const je={...f.mount?u:l};return po(we)?je:up(we)?hn(je,we):we.map(Ke=>hn(je,Ke))},Te=(we,je)=>({invalid:!!hn((je||i).errors,we),isDirty:!!hn((je||i).dirtyFields,we),error:hn((je||i).errors,we),isValidating:!!hn(i.validatingFields,we),isTouched:!!hn((je||i).touchedFields,we)}),ke=we=>{we&&Mk(we).forEach(je=>No(i.errors,je)),I.state.next({errors:we?i.errors:{}})},Ue=(we,je,Ke)=>{const gt=(hn(o,we,{_f:{}})._f||{}).ref,Et=hn(i.errors,we)||{},{ref:Tt,message:Kt,type:gn,...Sn}=Et;is(i.errors,we,{...Sn,...je,ref:gt}),I.state.next({name:we,errors:i.errors,isValid:!1}),Ke&&Ke.shouldFocus&&gt&&gt.focus&&gt.focus()},Be=(we,je)=>ip(we)?I.values.subscribe({next:Ke=>we(ue(void 0,je),Ke)}):ue(we,je,!0),qe=(we,je={})=>{for(const Ke of we?Mk(we):_.mount)_.mount.delete(Ke),_.array.delete(Ke),je.keepValue||(No(o,Ke),No(u,Ke)),!je.keepError&&No(i.errors,Ke),!je.keepDirty&&No(i.dirtyFields,Ke),!je.keepTouched&&No(i.touchedFields,Ke),!je.keepIsValidating&&No(i.validatingFields,Ke),!e.shouldUnregister&&!je.keepDefaultValue&&No(l,Ke);I.values.next({values:{...u}}),I.state.next({...i,...je.keepDirty?{isDirty:de()}:{}}),!je.keepIsValid&&B()},$e=({disabled:we,name:je,field:Ke,fields:gt})=>{(Qh(we)&&f.mount||we||_.disabled.has(je))&&(we?_.disabled.add(je):_.disabled.delete(je),pe(je,GU(Ke?Ke._f:hn(gt,je)._f),!1,!1,!0))},st=(we,je={})=>{let Ke=hn(o,we);const gt=Qh(je.disabled)||Qh(e.disabled);return is(o,we,{...Ke||{},_f:{...Ke&&Ke._f?Ke._f:{ref:{name:we}},name:we,mount:!0,...je}}),_.mount.add(we),Ke?$e({field:Ke,disabled:Qh(je.disabled)?je.disabled:e.disabled,name:we}):ne(we,!0,je.value),{...gt?{disabled:je.disabled||e.disabled}:{},...e.progressive?{required:!!je.required,min:DT(je.min),max:DT(je.max),minLength:DT(je.minLength),maxLength:DT(je.maxLength),pattern:DT(je.pattern)}:{},name:we,onChange:ve,onBlur:ve,ref:Et=>{if(Et){st(we,je),Ke=hn(o,we);const Tt=po(Et.value)&&Et.querySelectorAll&&Et.querySelectorAll("input,select,textarea")[0]||Et,Kt=HWe(Tt),gn=Ke._f.refs||[];if(Kt?gn.find(Sn=>Sn===Tt):Tt===Ke._f.ref)return;is(o,we,{_f:{...Ke._f,...Kt?{refs:[...gn.filter(zU),Tt,...Array.isArray(hn(l,we))?[{}]:[]],ref:{type:Tt.type,name:we}}:{ref:Tt}}}),ne(we,!1,void 0,Tt)}else Ke=hn(o,we,{}),Ke._f&&(Ke._f.mount=!1),(e.shouldUnregister||je.shouldUnregister)&&!(LWe(_.array,we)&&f.action)&&_.unMount.add(we)}}},Je=()=>e.shouldFocusError&&IC(o,be,_.mount),Rt=we=>{Qh(we)&&(I.state.next({disabled:we}),IC(o,(je,Ke)=>{const gt=hn(o,Ke);gt&&(je.disabled=gt._f.disabled||we,Array.isArray(gt._f.refs)&&gt._f.refs.forEach(Et=>{Et.disabled=gt._f.disabled||we}))},0,!1))},kt=(we,je)=>async Ke=>{let gt;Ke&&(Ke.preventDefault&&Ke.preventDefault(),Ke.persist&&Ke.persist());let Et=zu(u);if(_.disabled.size)for(const Tt of _.disabled)is(Et,Tt,void 0);if(I.state.next({isSubmitting:!0}),e.resolver){const{errors:Tt,values:Kt}=await J();i.errors=Tt,Et=Kt}else await ie(o);if(No(i.errors,"root"),hl(i.errors)){I.state.next({errors:{}});try{await we(Et,Ke)}catch(Tt){gt=Tt}}else je&&await je({...i.errors},Ke),Je(),setTimeout(Je);if(I.state.next({isSubmitted:!0,isSubmitting:!1,isSubmitSuccessful:hl(i.errors)&&!gt,submitCount:i.submitCount+1,errors:i.errors}),gt)throw gt},He=(we,je={})=>{hn(o,we)&&(po(je.defaultValue)?Re(we,zu(hn(l,we))):(Re(we,je.defaultValue),is(l,we,zu(je.defaultValue))),je.keepTouched||No(i.touchedFields,we),je.keepDirty||(No(i.dirtyFields,we),i.isDirty=je.defaultValue?de(we,zu(hn(l,we))):de()),je.keepError||(No(i.errors,we),C.isValid&&B()),I.state.next({...i}))},ut=(we,je={})=>{const Ke=we?zu(we):l,gt=zu(Ke),Et=hl(we),Tt=Et?l:gt;if(je.keepDefaultValues||(l=Ke),!je.keepValues){if(je.keepDirtyValues){const Kt=new Set([..._.mount,...Object.keys(NT(l,u))]);for(const gn of Array.from(Kt))hn(i.dirtyFields,gn)?is(Tt,gn,hn(u,gn)):Re(gn,hn(Tt,gn))}else{if(C3&&po(we))for(const Kt of _.mount){const gn=hn(o,Kt);if(gn&&gn._f){const Sn=Array.isArray(gn._f.refs)?gn._f.refs[0]:gn._f.ref;if(T1(Sn)){const sn=Sn.closest("form");if(sn){sn.reset();break}}}}o={}}u=e.shouldUnregister?je.keepDefaultValues?zu(l):{}:zu(Tt),I.array.next({values:{...Tt}}),I.values.next({values:{...Tt}})}_={mount:je.keepDirtyValues?_.mount:new Set,unMount:new Set,array:new Set,disabled:new Set,watch:new Set,watchAll:!1,focus:""},f.mount=!C.isValid||!!je.keepIsValid||!!je.keepDirtyValues,f.watch=!!e.shouldUnregister,I.state.next({submitCount:je.keepSubmitCount?i.submitCount:0,isDirty:Et?!1:je.keepDirty?i.isDirty:!!(je.keepDefaultValues&&!Og(we,l)),isSubmitted:je.keepIsSubmitted?i.isSubmitted:!1,dirtyFields:Et?{}:je.keepDirtyValues?je.keepDefaultValues&&u?NT(l,u):i.dirtyFields:je.keepDefaultValues&&we?NT(l,we):je.keepDirty?i.dirtyFields:{},touchedFields:je.keepTouched?i.touchedFields:{},errors:je.keepErrors?i.errors:{},isSubmitSuccessful:je.keepIsSubmitSuccessful?i.isSubmitSuccessful:!1,isSubmitting:!1})},mt=(we,je)=>ut(ip(we)?we(u):we,je);return{control:{register:st,unregister:qe,getFieldState:Te,handleSubmit:kt,setError:Ue,_executeSchema:J,_getWatch:ue,_getDirty:de,_updateValid:B,_removeUnmounted:le,_updateFieldArray:K,_updateDisabledField:$e,_getFieldArray:Oe,_reset:ut,_resetDefaultValues:()=>ip(e.defaultValues)&&e.defaultValues().then(we=>{mt(we,e.resetOptions),I.state.next({isLoading:!1})}),_updateFormState:we=>{i={...i,...we}},_disableForm:Rt,_subjects:I,_proxyFormState:C,_setErrors:ae,get _fields(){return o},get _formValues(){return u},get _state(){return f},set _state(we){f=we},get _defaultValues(){return l},get _names(){return _},set _names(we){_=we},get _formState(){return i},set _formState(we){i=we},get _options(){return e},set _options(we){e={...e,...we}}},trigger:We,register:st,handleSubmit:kt,watch:Be,setValue:Re,getValues:Pe,reset:mt,resetField:He,clearErrors:ke,unregister:qe,setError:Ue,setFocus:(we,je={})=>{const Ke=hn(o,we),gt=Ke&&Ke._f;if(gt){const Et=gt.refs?gt.refs[0]:gt.ref;Et.focus&&(Et.focus(),je.shouldSelect&&ip(Et.select)&&Et.select())}},getFieldState:Te}}function Qoe(n={}){const e=gi.useRef(void 0),i=gi.useRef(void 0),[o,l]=gi.useState({isDirty:!1,isValidating:!1,isLoading:ip(n.defaultValues),isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,submitCount:0,dirtyFields:{},touchedFields:{},validatingFields:{},errors:n.errors||{},disabled:n.disabled||!1,defaultValues:ip(n.defaultValues)?void 0:n.defaultValues});e.current||(e.current={...QWe(n),formState:o});const u=e.current.control;return u._options=n,jWe({subject:u._subjects.state,next:f=>{VWe(f,u._proxyFormState,u._updateFormState)&&l({...u._formState})}}),gi.useEffect(()=>u._disableForm(n.disabled),[u,n.disabled]),gi.useEffect(()=>{if(u._proxyFormState.isDirty){const f=u._getDirty();f!==o.isDirty&&u._subjects.state.next({isDirty:f})}},[u,o.isDirty]),gi.useEffect(()=>{n.values&&!Og(n.values,i.current)?(u._reset(n.values,u._options.resetOptions),i.current=n.values,l(f=>({...f}))):u._resetDefaultValues()},[n.values,u]),gi.useEffect(()=>{n.errors&&u._setErrors(n.errors)},[n.errors,u]),gi.useEffect(()=>{u._state.mount||(u._updateValid(),u._state.mount=!0),u._state.watch&&(u._state.watch=!1,u._subjects.state.next({...u._formState})),u._removeUnmounted()}),gi.useEffect(()=>{n.shouldUnregister&&u._subjects.values.next({values:u._getWatch()})},[n.shouldUnregister,u]),e.current.formState=UWe(o,u),e.current}var ZWe=["sitekey","onChange","theme","type","tabindex","onExpired","onErrored","size","stoken","grecaptcha","badge","hl","isolated"];function Rj(){return Rj=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])}return n},Rj.apply(this,arguments)}function eze(n,e){if(n==null)return{};var i={},o=Object.keys(n),l,u;for(u=0;u<o.length;u++)l=o[u],!(e.indexOf(l)>=0)&&(i[l]=n[l]);return i}function ZO(n){if(n===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}function tze(n,e){n.prototype=Object.create(e.prototype),n.prototype.constructor=n,Ij(n,e)}function Ij(n,e){return Ij=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(o,l){return o.__proto__=l,o},Ij(n,e)}var WN=function(n){tze(e,n);function e(){var o;return o=n.call(this)||this,o.handleExpired=o.handleExpired.bind(ZO(o)),o.handleErrored=o.handleErrored.bind(ZO(o)),o.handleChange=o.handleChange.bind(ZO(o)),o.handleRecaptchaRef=o.handleRecaptchaRef.bind(ZO(o)),o}var i=e.prototype;return i.getCaptchaFunction=function(l){return this.props.grecaptcha?this.props.grecaptcha.enterprise?this.props.grecaptcha.enterprise[l]:this.props.grecaptcha[l]:null},i.getValue=function(){var l=this.getCaptchaFunction("getResponse");return l&&this._widgetId!==void 0?l(this._widgetId):null},i.getWidgetId=function(){return this.props.grecaptcha&&this._widgetId!==void 0?this._widgetId:null},i.execute=function(){var l=this.getCaptchaFunction("execute");if(l&&this._widgetId!==void 0)return l(this._widgetId);this._executeRequested=!0},i.executeAsync=function(){var l=this;return new Promise(function(u,f){l.executionResolve=u,l.executionReject=f,l.execute()})},i.reset=function(){var l=this.getCaptchaFunction("reset");l&&this._widgetId!==void 0&&l(this._widgetId)},i.forceReset=function(){var l=this.getCaptchaFunction("reset");l&&l()},i.handleExpired=function(){this.props.onExpired?this.props.onExpired():this.handleChange(null)},i.handleErrored=function(){this.props.onErrored&&this.props.onErrored(),this.executionReject&&(this.executionReject(),delete this.executionResolve,delete this.executionReject)},i.handleChange=function(l){this.props.onChange&&this.props.onChange(l),this.executionResolve&&(this.executionResolve(l),delete this.executionReject,delete this.executionResolve)},i.explicitRender=function(){var l=this.getCaptchaFunction("render");if(l&&this._widgetId===void 0){var u=document.createElement("div");this._widgetId=l(u,{sitekey:this.props.sitekey,callback:this.handleChange,theme:this.props.theme,type:this.props.type,tabindex:this.props.tabindex,"expired-callback":this.handleExpired,"error-callback":this.handleErrored,size:this.props.size,stoken:this.props.stoken,hl:this.props.hl,badge:this.props.badge,isolated:this.props.isolated}),this.captcha.appendChild(u)}this._executeRequested&&this.props.grecaptcha&&this._widgetId!==void 0&&(this._executeRequested=!1,this.execute())},i.componentDidMount=function(){this.explicitRender()},i.componentDidUpdate=function(){this.explicitRender()},i.handleRecaptchaRef=function(l){this.captcha=l},i.render=function(){var l=this.props;l.sitekey,l.onChange,l.theme,l.type,l.tabindex,l.onExpired,l.onErrored,l.size,l.stoken,l.grecaptcha,l.badge,l.hl,l.isolated;var u=eze(l,ZWe);return k.createElement("div",Rj({},u,{ref:this.handleRecaptchaRef}))},e}(k.Component);WN.displayName="ReCAPTCHA";WN.propTypes={sitekey:yn.string.isRequired,onChange:yn.func,grecaptcha:yn.object,theme:yn.oneOf(["dark","light"]),type:yn.oneOf(["image","audio"]),tabindex:yn.number,onExpired:yn.func,onErrored:yn.func,size:yn.oneOf(["compact","normal","invisible"]),stoken:yn.string,hl:yn.string,badge:yn.oneOf(["bottomright","bottomleft","inline"]),isolated:yn.bool};WN.defaultProps={onChange:function(){},theme:"light",type:"image",tabindex:0,size:"normal",badge:"bottomright"};function Aj(){return Aj=Object.assign||function(n){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])}return n},Aj.apply(this,arguments)}function nze(n,e){if(n==null)return{};var i={},o=Object.keys(n),l,u;for(u=0;u<o.length;u++)l=o[u],!(e.indexOf(l)>=0)&&(i[l]=n[l]);return i}function rze(n,e){n.prototype=Object.create(e.prototype),n.prototype.constructor=n,n.__proto__=e}var zd={},ize=0;function sze(n,e){return e=e||{},function(o){var l=o.displayName||o.name||"Component",u=function(_){rze(E,_);function E(C,I){var P;return P=_.call(this,C,I)||this,P.state={},P.__scriptURL="",P}var b=E.prototype;return b.asyncScriptLoaderGetScriptLoaderID=function(){return this.__scriptLoaderID||(this.__scriptLoaderID="async-script-loader-"+ize++),this.__scriptLoaderID},b.setupScriptURL=function(){return this.__scriptURL=typeof n=="function"?n():n,this.__scriptURL},b.asyncScriptLoaderHandleLoad=function(I){var P=this;this.setState(I,function(){return P.props.asyncScriptOnLoad&&P.props.asyncScriptOnLoad(P.state)})},b.asyncScriptLoaderTriggerOnScriptLoaded=function(){var I=zd[this.__scriptURL];if(!I||!I.loaded)throw new Error("Script is not loaded.");for(var P in I.observers)I.observers[P](I);delete window[e.callbackName]},b.componentDidMount=function(){var I=this,P=this.setupScriptURL(),L=this.asyncScriptLoaderGetScriptLoaderID(),M=e,F=M.globalName,B=M.callbackName,Z=M.scriptId;if(F&&typeof window[F]<"u"&&(zd[P]={loaded:!0,observers:{}}),zd[P]){var K=zd[P];if(K&&(K.loaded||K.errored)){this.asyncScriptLoaderHandleLoad(K);return}K.observers[L]=function(X){return I.asyncScriptLoaderHandleLoad(X)};return}var re={};re[L]=function(X){return I.asyncScriptLoaderHandleLoad(X)},zd[P]={loaded:!1,observers:re};var ae=document.createElement("script");ae.src=P,ae.async=!0;for(var ne in e.attributes)ae.setAttribute(ne,e.attributes[ne]);Z&&(ae.id=Z);var pe=function(J){if(zd[P]){var Y=zd[P],ie=Y.observers;for(var le in ie)J(ie[le])&&delete ie[le]}};B&&typeof window<"u"&&(window[B]=function(){return I.asyncScriptLoaderTriggerOnScriptLoaded()}),ae.onload=function(){var X=zd[P];X&&(X.loaded=!0,pe(function(J){return B?!1:(J(X),!0)}))},ae.onerror=function(){var X=zd[P];X&&(X.errored=!0,pe(function(J){return J(X),!0}))},document.body.appendChild(ae)},b.componentWillUnmount=function(){var I=this.__scriptURL;if(e.removeOnUnmount===!0)for(var P=document.getElementsByTagName("script"),L=0;L<P.length;L+=1)P[L].src.indexOf(I)>-1&&P[L].parentNode&&P[L].parentNode.removeChild(P[L]);var M=zd[I];M&&(delete M.observers[this.asyncScriptLoaderGetScriptLoaderID()],e.removeOnUnmount===!0&&delete zd[I])},b.render=function(){var I=e.globalName,P=this.props;P.asyncScriptOnLoad;var L=P.forwardedRef,M=nze(P,["asyncScriptOnLoad","forwardedRef"]);return I&&typeof window<"u"&&(M[I]=typeof window[I]<"u"?window[I]:void 0),M.ref=L,k.createElement(o,M)},E}(k.Component),f=k.forwardRef(function(_,E){return k.createElement(u,Aj({},_,{forwardedRef:E}))});return f.displayName="AsyncScriptLoader("+l+")",f.propTypes={asyncScriptOnLoad:yn.func},BIe(f,o)}}var Pj="onloadcallback",oze="grecaptcha";function Oj(){return typeof window<"u"&&window.recaptchaOptions||{}}function aze(){var n=Oj(),e=n.useRecaptchaNet?"recaptcha.net":"www.google.com";return n.enterprise?"https://"+e+"/recaptcha/enterprise.js?onload="+Pj+"&render=explicit":"https://"+e+"/recaptcha/api.js?onload="+Pj+"&render=explicit"}const Zoe=sze(aze,{callbackName:Pj,globalName:oze,attributes:Oj().nonce?{nonce:Oj().nonce}:{}})(WN),zN=(n,e="generic-modal")=>{k.useEffect(()=>{if(!window.unityInstance)return;const i=()=>{try{window.unityInstance.SendMessage("WebGLInputManager","Disable"),H.log(`Unity input disabled for ${e}`),document.body.classList.add("unity-input-disabled"),window.unityInputDisabled=!0,window.unityInputDisabledBy=e}catch(l){H.error(`Failed to disable Unity input for ${e}:`,l)}},o=()=>{try{window.unityInputDisabledBy===e?(window.unityInstance.SendMessage("WebGLInputManager","Enable"),H.log(`Unity input re-enabled (was disabled by ${e})`),document.body.classList.remove("unity-input-disabled"),window.unityInputDisabled=!1,window.unityInputDisabledBy=null):H.log(`Not re-enabling Unity input for ${e} because it was disabled by ${window.unityInputDisabledBy}`)}catch(l){H.error(`Failed to enable Unity input for ${e}:`,l)}};return n?i():o(),()=>{n&&o()}},[n,e])},eae=({isOpen:n,onClose:e,userData:i,onConfirm:o,fullscreenRef:l})=>{const[u,f]=k.useState((i==null?void 0:i.username)||""),[_,E]=k.useState((i==null?void 0:i.Nickname)||""),[b,C]=k.useState(!1),[I,P]=k.useState(null),[L,M]=k.useState(!1),F=ta(),B=ae=>!(!ae||ae.trim()===""||!/^[a-z0-9]{1,15}$/.test(ae)),Z=async ae=>{var ne,pe;if(!B(ae))return!ae||ae.trim()===""?P("Username cannot be empty"):P("Username must be 1-15 characters, lowercase letters and numbers only"),!1;C(!0),P(null);try{let X=!1,J=0;const Y=3;for(;J<Y;)try{X=await iR(ae);break}catch(ie){if(H.error(`Attempt ${J+1}: Error checking username:`,ie),J++,J>=Y)throw ie;await new Promise(le=>setTimeout(le,1e3))}return X?(P("Username is already taken"),!1):!0}catch(X){return H.error("Error checking username after retries:",X),X.code==="permission-denied"||(ne=X.message)!=null&&ne.includes("permissions")?P("Username check unavailable. Please try again or pick a unique name."):P("Error checking username availability. Please try again."),X.code==="permission-denied"||((pe=X.message)==null?void 0:pe.includes("permissions"))}finally{C(!1)}};k.useEffect(()=>{if(!u){P("Username cannot be empty");return}if(u!==(i==null?void 0:i.username)){const ae=setTimeout(async()=>{await Z(u)},500);return()=>clearTimeout(ae)}},[u]),k.useEffect(()=>{if(i&&i.firstName&&i.lastName){const ae=`${i.firstName}${i.lastName.charAt(0).toUpperCase()}`;E(ae)}},[i]);const K=async()=>{M(!0);try{if(!await Z(u)){M(!1);return}if(_.length>15){P("Display Name must be at most 15 characters"),M(!1);return}$u(_),H.log("UsernameConfirmation: Preparing to confirm user registration");const ne=i.firstName&&i.lastName?`${i.firstName}${i.lastName.charAt(0).toUpperCase()}`:"",pe={...i,firstName:i.firstName||"",lastName:i.lastName||"",companyName:i.companyName||"",linkedInProfile:i.linkedInProfile||"",username:u,Nickname:_||ne,email:i.email,password:i.password};H.log("UsernameConfirmation: Processed registration data with fields:",Object.keys(pe).join(", ")),await o(pe),e()}catch(ae){H.error("Error during username confirmation:",ae),F({title:"Error",description:"An error occurred. Please try again.",status:"error",duration:3e3,isClosable:!0})}finally{M(!1)}},re=()=>{L||e()};return S.jsxs(hs,{isOpen:n,onClose:re,size:"md",portalProps:{containerRef:l},isCentered:!0,motionPreset:"slideInBottom",closeOnOverlayClick:!L,closeOnEsc:!L,children:[S.jsx(fs,{bg:"blackAlpha.800",backdropFilter:"blur(5px)"}),S.jsxs(ps,{bg:"gray.800",borderRadius:"xl",boxShadow:"xl",color:"white",maxW:"md",mx:4,position:"relative",children:[S.jsxs(yo,{children:[S.jsx(qC,{size:"lg",mb:2,children:"Customize Your Profile"}),S.jsx(tt,{fontSize:"sm",color:"gray.400",children:"Set your username and nickname"})]}),S.jsx($s,{color:"gray.400",isDisabled:L}),S.jsx(bs,{children:S.jsxs(Fr,{spacing:6,align:"stretch",children:[S.jsxs(ur,{isInvalid:!!I,children:[S.jsx(ei,{children:"Username"}),S.jsxs(Dg,{children:[S.jsx(X1,{bg:"gray.700",color:"gray.400",border:"none",children:"@"}),S.jsx(ti,{placeholder:"username",value:u,onChange:ae=>f(ae.target.value.toLowerCase()),bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},maxLength:15})]}),I?S.jsx(tp,{children:I}):S.jsx(Gy,{color:"gray.400",children:"Lowercase letters and numbers only, max 15 characters"})]}),S.jsxs(ur,{children:[S.jsx(ei,{children:"Nickname"}),S.jsx(ti,{placeholder:"Nickname",value:_,onChange:ae=>E(ae.target.value),bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},maxLength:15}),S.jsx(Gy,{color:"gray.400",children:"This is the name shown to others, max 15 characters"})]})]})}),S.jsx(Cp,{children:S.jsxs(Cr,{gap:3,width:"100%",children:[S.jsx(jn,{variant:"outline",onClick:re,flex:"1",isDisabled:L,children:"Back"}),S.jsx(jn,{colorScheme:"blue",onClick:K,isLoading:L||b,isDisabled:!!I||!u||L,flex:"2",children:"Finish"})]})})]})]})};eae.propTypes={isOpen:yn.bool.isRequired,onClose:yn.func.isRequired,userData:yn.object.isRequired,onConfirm:yn.func.isRequired,fullscreenRef:yn.object};const cze="6Le4oQUrAAAAAHe0GMH5Z0tpuqTV2qqDzK9Yk4Uv";function GN({mode:n,label:e,buttonProps:i={},isOpen:o,onClose:l}){const{register:u,handleSubmit:f,formState:{errors:_}}=Qoe(),{register:E}=k.useContext(Uo),b=ta(),{fullscreenRef:C}=Zd(),[I,P]=k.useState(!1),[L,M]=k.useState(!1),[F,B]=k.useState(null),Z=k.useRef(null),[K,re]=k.useState(!1),[ae,ne]=k.useState(null),[pe,X]=k.useState(!1),J=o!==void 0?o:I,Y=l||(()=>P(!1));zN(J||K),k.useEffect(()=>{!J&&Z.current&&(Z.current.reset(),B(null))},[J]);const ie=Ve=>{B(Ve)},le=async Ve=>{H.log("Register.jsx: Processing registration form submission");const{email:xe,password:Re,confirmPassword:ve,...be}=Ve;if(H.log("Register.jsx: Registration data fields:",Object.keys(be).join(", ")),!F){b({title:"Verification Required",description:"Please complete the reCAPTCHA verification.",status:"error",duration:3e3,isClosable:!0,position:"top"});return}if(Re!==ve){b({title:"Error",description:"Passwords do not match.",status:"error",duration:3e3,isClosable:!0,position:"top"});return}$u(be.firstName),$u(be.lastName),$u(be.companyName),M(!0);try{const We=await YBe(be.firstName||"",be.lastName||""),Pe=be.firstName&&be.lastName?`${be.firstName}${be.lastName.charAt(0).toUpperCase()}`:"";Pe&&$u(Pe),H.log("Register.jsx: Generated username and nickname for new user");const Te={...be,firstName:be.firstName||"",lastName:be.lastName||"",companyName:be.companyName||"",linkedInProfile:be.linkedInProfile||"",email:xe,password:Re,username:We,Nickname:Pe,captchaToken:F};H.log("Register.jsx: Prepared registration data with fields:",Object.keys(Te).join(", ")),ne(Te),re(!0)}catch(We){H.error("User: Registration Error:",We);let Pe="An error occurred during registration. Please try again.",Te=!1;We.code==="auth/email-already-in-use"?(Pe="This email address is already registered. Please sign in instead.",Te=!0):We.code==="auth/invalid-email"?Pe="The email address is not valid. Please check and try again.":We.code==="auth/weak-password"?Pe="The password is too weak. Please choose a stronger password.":We.message&&(Pe=We.message),b({title:"Registration Failed",description:S.jsxs(S.Fragment,{children:[Pe,Te&&S.jsx(tt,{mt:2,children:S.jsx(Kl,{color:"blue.400",onClick:()=>{Y(),window.dispatchEvent(new CustomEvent("openSignInModal"))},children:"Go to Sign In"})})]}),status:"error",duration:5e3,isClosable:!0,position:"top"})}finally{M(!1),Z.current&&Z.current.reset()}},de=async Ve=>{M(!0);try{H.log("Register.jsx: Completing registration with confirmed username");const{email:xe,password:Re,...ve}=Ve,be={...ve,firstName:ve.firstName||"",lastName:ve.lastName||"",companyName:ve.companyName||"",linkedInProfile:ve.linkedInProfile||"",username:ve.username||"",Nickname:ve.Nickname||""};H.log("Register.jsx: Final registration data includes fields:",Object.keys(be).join(", "));const We=await E(xe,Re,be);Y(),re(!1),H.log("User: Registration process complete."),b({title:"Registration Successful",description:"Please check your email for a verification link. You'll need to verify your email before signing in.",status:"success",duration:8e3,isClosable:!0,position:"top"}),ne(null),X(!1)}catch(xe){H.error("User: Registration Error during final step:",xe);let Re="An error occurred during registration. Please try again.";xe.code==="auth/email-already-in-use"?Re="This email address is already in use. Please try another one.":xe.message&&(Re=xe.message),b({title:"Registration Failed",description:Re,status:"error",duration:5e3,isClosable:!0,position:"top"}),re(!1),ne(null),X(!1)}finally{M(!1)}},ue=()=>{l?l():P(!I)},Oe=n==="link"?S.jsx(Kl,{variant:"header",onClick:ue,children:e}):S.jsx(jn,{onClick:ue,...i,children:e});return S.jsxs(S.Fragment,{children:[!o&&Oe,S.jsxs(hs,{isOpen:J&&!K,onClose:Y,size:"md",portalProps:{containerRef:C},isCentered:!0,motionPreset:"slideInBottom",blockScrollOnMount:!1,children:[S.jsx(fs,{bg:"blackAlpha.800",backdropFilter:"blur(5px)"}),S.jsxs(ps,{bg:"gray.800",borderRadius:"xl",boxShadow:"xl",color:"white",maxW:"md",mx:4,position:"relative",zIndex:9999,sx:{isolation:"isolate","& input":{position:"relative",zIndex:1e4,isolation:"isolate"},"& *":{pointerEvents:"auto !important"}},onKeyDown:Ve=>{Ve.stopPropagation()},children:[S.jsxs(yo,{p:8,textAlign:"center",children:[S.jsx(qC,{size:"lg",mb:2,children:"Create Account"}),S.jsx(tt,{fontSize:"sm",color:"gray.400",children:"Fill in your details to get started"})]}),S.jsx($s,{color:"gray.400"}),S.jsx(bs,{px:8,children:S.jsx("form",{onSubmit:f(le),children:S.jsxs(Fr,{spacing:4,children:[S.jsxs(ur,{isInvalid:_.companyName,isRequired:!0,children:[S.jsx(ti,{placeholder:"Company Name",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...u("companyName",{required:"Company name is required",setValueAs:Ve=>Ve===""?"":Ve})}),S.jsx(tp,{children:_.companyName&&_.companyName.message})]}),S.jsxs(Cr,{gap:4,w:"100%",children:[S.jsxs(ur,{isInvalid:_.firstName,isRequired:!0,children:[S.jsx(ti,{placeholder:"First Name",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...u("firstName",{required:"First name is required",setValueAs:Ve=>Ve===""?"":Ve})}),S.jsx(tp,{children:_.firstName&&_.firstName.message})]}),S.jsxs(ur,{isInvalid:_.lastName,isRequired:!0,children:[S.jsx(ti,{placeholder:"Last Name",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...u("lastName",{required:"Last name is required",setValueAs:Ve=>Ve===""?"":Ve})}),S.jsx(tp,{children:_.lastName&&_.lastName.message})]})]}),S.jsxs(ur,{isInvalid:_.email,isRequired:!0,children:[S.jsx(ti,{type:"email",placeholder:"Work Email Address",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...u("email",{required:"Email is required",pattern:{value:/^[^@ \t\r\n]+@[^@ \t\r\n]+\.[^@ \t\r\n]+$/,message:"Invalid email address"}})}),S.jsx(tp,{children:_.email&&_.email.message})]}),S.jsxs(Cr,{gap:4,w:"100%",children:[S.jsxs(ur,{isInvalid:_.password,isRequired:!0,children:[S.jsx(ti,{type:"password",placeholder:"Password",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...u("password",{required:"Password is required",minLength:{value:8,message:"Password must be at least 8 characters long"}})}),S.jsx(tp,{children:_.password&&_.password.message})]}),S.jsxs(ur,{isInvalid:_.confirmPassword,isRequired:!0,children:[S.jsx(ti,{type:"password",placeholder:"Confirm Password",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...u("confirmPassword",{required:"Confirm password is required"})}),S.jsx(tp,{children:_.confirmPassword&&_.confirmPassword.message})]})]}),S.jsx(ur,{children:S.jsx(ti,{placeholder:"LinkedIn Profile (optional)",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...u("linkedInProfile",{setValueAs:Ve=>Ve===""?"":Ve})})}),S.jsx(ct,{width:"100%",display:"flex",justifyContent:"center",my:4,children:S.jsx(Zoe,{ref:Z,sitekey:cze,onChange:ie,theme:"dark"})})]})})}),S.jsxs(Cp,{px:8,pb:8,flexDirection:"column",gap:4,children:[S.jsx(jn,{type:"submit",colorScheme:"blue",size:"lg",width:"100%",onClick:f(le),isLoading:L,loadingText:"Processing",isDisabled:!F,children:"Next: Set Your Username"}),S.jsxs(tt,{fontSize:"sm",color:"gray.400",textAlign:"center",children:["Already have an account?"," ",S.jsx(Kl,{color:"blue.400",onClick:()=>{Y(),window.dispatchEvent(new CustomEvent("openSignInModal"))},children:"Sign In"})]})]})]})]}),K&&S.jsx(eae,{isOpen:K,onClose:()=>re(!1),userData:ae,onConfirm:de,fullscreenRef:C,isRegistering:pe})]})}GN.propTypes={mode:yn.oneOf(["button","link"]),label:yn.string,buttonProps:yn.object,isOpen:yn.bool,onClose:yn.func};const lze="6Le4oQUrAAAAAHe0GMH5Z0tpuqTV2qqDzK9Yk4Uv";function HN({mode:n="button",label:e="Sign In",buttonProps:i={},initialIsOpen:o=!1}){const{signIn:l}=k.useContext(Uo),{fullscreenRef:u}=Zd(),f=ta(),{register:_,handleSubmit:E,formState:{errors:b}}=Qoe(),[C,I]=k.useState(!1),[P,L]=k.useState(o),[M,F]=k.useState(!1),[B,Z]=k.useState(!1),[K,re]=k.useState(""),[ae,ne]=k.useState(!1),[pe,X]=k.useState(null),J=k.useRef(null);zN(P||B),k.useEffect(()=>{const xe=()=>{L(!0)};return window.addEventListener("openSignInModal",xe),()=>{window.removeEventListener("openSignInModal",xe)}},[]);const Y=xe=>{X(xe)},ie=async xe=>{if(!pe){f({title:"Verification Required",description:"Please complete the reCAPTCHA verification.",status:"error",duration:3e3,isClosable:!0,position:"top"});return}I(!0);try{await l(xe.email,xe.password,pe),H.log("User: Sign-in process complete."),L(!1),window.location.reload()}catch(Re){H.error("User: SignIn Error:",Re);const ve=Re.message||"An error occurred while logging in. Please check your credentials.",be=ve.includes("verify your email");f({title:be?"Email Verification Required":"Error",description:ve,status:be?"warning":"error",duration:1e4,isClosable:!0,position:"top",container:u.current})}finally{I(!1),J.current&&J.current.reset()}},le=async()=>{if(!K){f({title:"Email Required",description:"Please enter your email address to reset your password.",status:"warning",duration:3e3,isClosable:!0,position:"top",container:u.current});return}try{ne(!0),await fFe(g3,K),f({title:"Password Reset Email Sent",description:"Check your email for instructions to reset your password.",status:"success",duration:5e3,isClosable:!0,position:"top",container:u.current}),Z(!1)}catch(xe){H.error("User: Reset Password Error:",xe),f({title:"Error",description:xe.message||"Failed to send password reset email. Please try again.",status:"error",duration:5e3,isClosable:!0,position:"top",container:u.current})}finally{ne(!1)}},de=()=>L(xe=>!xe),ue=()=>{L(!1),F(!0)},Oe=()=>{Z(!0)},Ve=n==="link"?S.jsx(Kl,{variant:"header",onClick:de,children:e}):S.jsx(jn,{onClick:de,...i,children:e});return S.jsxs(S.Fragment,{children:[Ve,S.jsxs(hs,{isOpen:P,onClose:de,size:"md",portalProps:{containerRef:u},isCentered:!0,motionPreset:"slideInBottom",blockScrollOnMount:!1,children:[S.jsx(fs,{bg:"blackAlpha.800",backdropFilter:"blur(5px)"}),S.jsx("form",{onSubmit:E(ie),children:S.jsxs(ps,{bg:"gray.800",borderRadius:"xl",boxShadow:"xl",color:"white",maxW:"md",mx:4,position:"relative",zIndex:9999,sx:{isolation:"isolate","& input":{position:"relative",zIndex:1e4,isolation:"isolate"},"& *":{pointerEvents:"auto !important"}},onKeyDown:xe=>{xe.stopPropagation()},children:[S.jsxs(yo,{p:8,textAlign:"center",children:[S.jsx(qC,{size:"lg",mb:2,children:"Welcome Back"}),S.jsx(tt,{fontSize:"sm",color:"gray.400",children:"Enter your credentials to access your account"})]}),S.jsx($s,{color:"gray.400"}),S.jsx(bs,{px:8,pb:8,children:S.jsxs(Fr,{spacing:4,children:[S.jsxs(ur,{isInvalid:b.email,children:[S.jsxs(Dg,{children:[S.jsx(EC,{pointerEvents:"none",children:S.jsx(_Q,{color:"gray.500"})}),S.jsx(ti,{type:"email",placeholder:"Email",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},..._("email",{required:"Email is required."})})]}),S.jsx(tp,{children:b.email&&b.email.message})]}),S.jsxs(ur,{isInvalid:b.password,children:[S.jsxs(Dg,{children:[S.jsx(EC,{pointerEvents:"none",children:S.jsx(PWe,{color:"gray.500"})}),S.jsx(ti,{type:"password",placeholder:"Password",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},..._("password",{required:"Password is required."})})]}),S.jsx(tp,{children:b.password&&b.password.message})]}),S.jsx(ct,{alignSelf:"flex-end",children:S.jsx(Kl,{color:"blue.400",fontSize:"sm",onClick:Oe,children:"Forgot Password?"})}),S.jsx(Cr,{width:"100%",justifyContent:"center",my:4,children:S.jsx(Zoe,{ref:J,sitekey:lze,onChange:Y,theme:"dark"})})]})}),S.jsxs(Cp,{px:8,pb:8,flexDirection:"column",gap:4,children:[S.jsx(jn,{type:"submit",colorScheme:"blue",size:"lg",width:"100%",isLoading:C,loadingText:"Signing In",isDisabled:!pe,children:"Sign In"}),S.jsxs(tt,{fontSize:"sm",color:"gray.400",textAlign:"center",children:["Don't have an account?"," ",S.jsx(Kl,{color:"blue.400",onClick:ue,children:"Sign Up"})]})]})]})})]}),S.jsxs(hs,{isOpen:B,onClose:()=>Z(!1),size:"md",portalProps:{containerRef:u},isCentered:!0,motionPreset:"slideInBottom",blockScrollOnMount:!1,children:[S.jsx(fs,{bg:"blackAlpha.800",backdropFilter:"blur(5px)"}),S.jsxs(ps,{bg:"gray.800",borderRadius:"xl",boxShadow:"xl",color:"white",maxW:"md",mx:4,position:"relative",zIndex:9999,sx:{isolation:"isolate","& input":{position:"relative",zIndex:1e4,isolation:"isolate"},"& *":{pointerEvents:"auto !important"}},onKeyDown:xe=>{xe.stopPropagation()},children:[S.jsxs(yo,{p:8,textAlign:"center",children:[S.jsx(qC,{size:"lg",mb:2,children:"Reset Password"}),S.jsx(tt,{fontSize:"sm",color:"gray.400",children:"Enter your email to receive password reset instructions"})]}),S.jsx($s,{color:"gray.400"}),S.jsx(bs,{px:8,pb:4,children:S.jsx(ur,{children:S.jsxs(Dg,{children:[S.jsx(EC,{pointerEvents:"none",children:S.jsx(_Q,{color:"gray.500"})}),S.jsx(ti,{type:"email",placeholder:"Email",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},value:K,onChange:xe=>re(xe.target.value)})]})})}),S.jsxs(Cp,{px:8,pb:8,flexDirection:"column",gap:4,children:[S.jsx(jn,{colorScheme:"blue",size:"lg",width:"100%",onClick:le,isLoading:ae,loadingText:"Sending",children:"Send Reset Link"}),S.jsxs(tt,{fontSize:"sm",color:"gray.400",textAlign:"center",children:["Remember your password?"," ",S.jsx(Kl,{color:"blue.400",onClick:()=>Z(!1),children:"Back to Sign In"})]})]})]})]}),S.jsx(GN,{mode:"link",isOpen:M,onClose:()=>F(!1)})]})}HN.propTypes={mode:yn.oneOf(["button","link"]),label:yn.string,buttonProps:yn.object,initialIsOpen:yn.bool};function P3({mode:n="button",label:e="Sign Out"}){const i=ta(),{signOut:o}=k.useContext(Uo),{fullscreenRef:l}=Zd(),u=async()=>{try{await o(),i({title:"Logged Out",description:"You have been successfully logged out.",status:"success",duration:3e3,isClosable:!0,position:"top",container:l.current}),window.location.href="/"}catch(_){console.error("SignOut Error:",_),i({title:"Error",description:"An error occurred while logging out.",status:"error",duration:3e3,isClosable:!0,position:"top",container:l.current})}},f=n==="link"?S.jsx(Kl,{variant:"header",onClick:u,style:{cursor:"pointer"},children:e}):null;return S.jsx(S.Fragment,{children:f})}P3.propTypes={mode:yn.oneOf(["button","link"]),label:yn.string};const K0=()=>window.unityInstance||window.gameInstance||window.reactUnityInstance,O3=()=>{document.body.classList.add("unity-focused");const n=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight","Space","PageUp","PageDown","Home","End"],e=o=>{if(n.includes(o.key)){const l=o.target.tagName==="INPUT"||o.target.tagName==="TEXTAREA"||o.target.isContentEditable,u=document.querySelector("canvas")||document.getElementById("unity-canvas"),f=o.target.closest("canvas")||o.target.closest("#webgl-root"),_=document.activeElement===u;!l&&(f||_)&&o.preventDefault()}},i=o=>{document.querySelector("canvas")||document.getElementById("unity-canvas"),document.getElementById("unity-container")||document.getElementById("webgl-root"),o.target.closest("canvas")||o.target.closest("#webgl-root")?document.body.classList.add("unity-focused"):document.body.classList.remove("unity-focused")};return document.addEventListener("keydown",e),document.addEventListener("click",i),()=>{document.body.classList.remove("unity-focused"),document.removeEventListener("keydown",e),document.removeEventListener("click",i)}},tae=()=>{document.body.classList.remove("unity-focused")};function I1(n){return console.log(`Setting Unity keyboard capture: ${n}`),n?(document.body.classList.add("unity-focused"),window.unityKeyboardEnabled=!0):(document.body.classList.remove("unity-focused"),window.unityKeyboardEnabled=!1),n?O3():tae(),new Promise(e=>{try{const i=K0();if(i){try{n?i.SendMessage("WebGLInput","EnableKeyboardCapture"):i.SendMessage("WebGLInput","DisableKeyboardCapture"),console.log(`Unity keyboard capture ${n?"enabled":"disabled"} (using Unity preferred method)`),e(!0);return}catch(o){console.warn("Failed to use Unity preferred keyboard method, falling back to SetCaptureAllKeyboardInput",o)}try{i.SendMessage("WebGLInput","SetCaptureAllKeyboardInput",n),console.log(`Unity keyboard capture ${n?"enabled":"disabled"} (using fallback method)`),e(!0);return}catch(o){console.warn("Failed to use SetCaptureAllKeyboardInput, trying module method",o)}if(i.Module){!n&&i.Module.WebGLInputHandler&&!window._originalWebGLInputHandler&&(window._originalWebGLInputHandler=i.Module.WebGLInputHandler),n&&window._originalWebGLInputHandler?(i.Module.WebGLInputHandler=window._originalWebGLInputHandler,window._originalWebGLInputHandler=null):n||(i.Module.WebGLInputHandler=null),console.log(`Unity keyboard capture ${n?"enabled":"disabled"} (using Module method)`),e(!0);return}}else console.warn("Unity instance not available, cannot set keyboard capture"),window.__pendingKeyboardCaptureState=n,document.getElementById("webgl-root")&&(console.log("webgl-root detected, will poll for Unity instance"),kj(n)),e(!1)}catch(i){console.error("Error setting Unity keyboard capture:",i),e(!1)}})}function kj(n){window.__unityInstancePoller&&clearTimeout(window.__unityInstancePoller);const e=20;let i=0;const o=()=>{i++;const l=K0();if(l){console.log(`Unity instance found after ${i} attempts`);try{n?l.SendMessage("WebGLInput","EnableKeyboardCapture"):l.SendMessage("WebGLInput","DisableKeyboardCapture"),console.log(`Applied pending keyboard state: ${n}`),window.__pendingKeyboardCaptureState=null}catch(u){console.warn("Failed to apply pending keyboard state with preferred method, trying fallback",u);try{l.SendMessage("WebGLInput","SetCaptureAllKeyboardInput",n),console.log(`Applied pending keyboard state: ${n} (fallback method)`),window.__pendingKeyboardCaptureState=null}catch(f){console.error("Failed to apply pending keyboard state with fallback method",f)}}}else if(i<e){const u=Math.min(500*Math.pow(1.2,i),5e3);console.log(`Unity instance not found (attempt ${i}/${e}), retrying in ${u}ms`),window.__unityInstancePoller=setTimeout(o,u)}else console.warn(`Unity instance still not found after ${e} attempts, giving up`)};window.__unityInstancePoller=setTimeout(o,500)}function uze(){const n=K0();if(!n)return!1;const e=document.querySelector("canvas")||document.getElementById("unity-canvas");return!!(e&&document.activeElement===e||n.Module&&n.Module.WebGLInputHandler)}function s0(n=!0){return console.log("Focusing Unity canvas"),n?O3():tae(),new Promise(e=>{try{const i=document.querySelector("canvas")||document.getElementById("unity-canvas");if(i){try{i.focus({preventScroll:!0})}catch{i.focus()}if(i.style.pointerEvents="auto",n){I1(!0).then(e);return}e(!0)}else console.warn("Unity canvas not found"),e(!1)}catch(i){console.error("Error focusing Unity canvas:",i),e(!1)}})}function Mf(n=!0){return console.log(`${n?"Blocking":"Unblocking"} Unity keyboard input`),O3(),new Promise(e=>{try{if(n)I1(!1).then(i=>{var u;i&&console.log("Successfully disabled Unity keyboard capture");const o=document.querySelector("canvas")||document.getElementById("unity-canvas");o&&(o.blur(),o.style.pointerEvents="none"),window.__keyEventHandler||(window.__keyEventHandler=f=>{window.__blockKeyboardInput&&!["INPUT","TEXTAREA","SELECT"].includes(f.target.tagName)&&f.stopPropagation()},document.addEventListener("keydown",window.__keyEventHandler,!0),document.addEventListener("keyup",window.__keyEventHandler,!0),document.addEventListener("keypress",window.__keyEventHandler,!0)),window.__blockKeyboardInput=!0;const l=K0();(u=l==null?void 0:l.Module)!=null&&u.WebGLInputHandler&&(window._savedWebGLInputHandler=l.Module.WebGLInputHandler,l.Module.WebGLInputHandler=null),e(!0)});else{window.__blockKeyboardInput=!1,window.__keyEventHandler&&(document.removeEventListener("keydown",window.__keyEventHandler,!0),document.removeEventListener("keyup",window.__keyEventHandler,!0),document.removeEventListener("keypress",window.__keyEventHandler,!0),window.__keyEventHandler=null);const i=K0();i!=null&&i.Module&&window._savedWebGLInputHandler&&(i.Module.WebGLInputHandler=window._savedWebGLInputHandler,window._savedWebGLInputHandler=null);const o=document.querySelector("canvas")||document.getElementById("unity-canvas");o&&(o.style.pointerEvents="auto"),I1(!0).then(l=>{l&&console.log("Successfully re-enabled Unity keyboard capture"),e(!0)})}}catch(i){console.error("Error in blockUnityKeyboardInput:",i),e(!1)}})}function dze(n){if(n){if(console.log("Registering Unity instance"),window.unityInstance=n,typeof window.__pendingKeyboardCaptureState=="boolean")try{const e=window.__pendingKeyboardCaptureState;console.log(`Applying pending keyboard state: ${e}`);try{e?n.SendMessage("WebGLInput","EnableKeyboardCapture"):n.SendMessage("WebGLInput","DisableKeyboardCapture"),console.log(`Applied pending keyboard state: ${e} (Unity preferred method)`),window.__pendingKeyboardCaptureState=null}catch(i){console.warn("Failed to apply pending keyboard state with preferred method, trying fallback",i);try{n.SendMessage("WebGLInput","SetCaptureAllKeyboardInput",e),console.log(`Applied pending keyboard state: ${e} (fallback method)`),window.__pendingKeyboardCaptureState=null}catch(o){console.error("Failed to apply pending keyboard state with fallback method",o)}}}catch(e){console.error("Error applying pending keyboard state:",e)}window.__unityInstancePoller&&(clearTimeout(window.__unityInstancePoller),window.__unityInstancePoller=null)}}function hze(){if(console.log("Initializing Unity keyboard helpers"),window.setUnityKeyboardCapture=I1,window.focusUnity=s0,window.blockUnityKeyboardInput=Mf,window.hasUnityKeyboardFocus=uze,window.getUnityInstance=K0,window.registerUnityInstance=dze,document.getElementById("webgl-root")){const n=new MutationObserver(e=>{for(const i of e)if(i.addedNodes.length)for(let o=0;o<i.addedNodes.length;o++){const l=i.addedNodes[o];if(l.nodeName==="CANVAS"||l.querySelector&&l.querySelector("canvas")){console.log("Canvas detected, Unity might be loading. Setting up instance detection."),kj(!0),n.disconnect();break}}});n.observe(document.body,{childList:!0,subtree:!0}),document.querySelector("canvas")&&(console.log("Canvas already exists, Unity might be loaded. Starting instance detection."),kj(!0))}if(typeof window<"u"&&typeof require=="function")try{const n=require("react");window.useUnityKeyboardFocus=function(){const[i,o]=n.useState(!1);return n.useEffect(()=>(i?(console.log("useUnityKeyboardFocus: Blocking Unity keyboard input"),Mf(!0),window.dispatchEvent(new CustomEvent("modal-opened"))):(console.log("useUnityKeyboardFocus: Unblocking Unity keyboard input"),Mf(!1),window.dispatchEvent(new CustomEvent("modal-closed"))),()=>{i&&(console.log("useUnityKeyboardFocus: Cleanup - unblocking Unity keyboard input"),Mf(!1),window.dispatchEvent(new CustomEvent("modal-closed")))}),[i]),[i,o]},console.log("Created useUnityKeyboardFocus hook globally")}catch(n){console.warn("Could not create React hook, React might not be available yet:",n)}}typeof window<"u"&&setTimeout(hze,0);const pze=({isOpen:n,onClose:e,user:i,profileImageUrl:o})=>{const[l,u]=k.useState(!1),[f,_]=k.useState({Nickname:(i==null?void 0:i.Nickname)||"",username:(i==null?void 0:i.username)||"",companyName:(i==null?void 0:i.companyName)||"",firstName:(i==null?void 0:i.firstName)||"",lastName:(i==null?void 0:i.lastName)||"",linkedInProfile:(i==null?void 0:i.linkedInProfile)||""}),[E,b]=k.useState(!1),[C,I]=k.useState(!1),[P,L]=k.useState(""),[M,F]=k.useState(!1),B=ta(),{sendUserToUnity:Z,updateUser:K}=k.useContext(Uo),re=k.useRef(null);k.useEffect(()=>{_({Nickname:(i==null?void 0:i.Nickname)||"",username:(i==null?void 0:i.username)||"",companyName:(i==null?void 0:i.companyName)||"",firstName:(i==null?void 0:i.firstName)||"",lastName:(i==null?void 0:i.lastName)||"",linkedInProfile:(i==null?void 0:i.linkedInProfile)||""})},[i]),k.useEffect(()=>(n?(console.log("ProfileModal: Modal opened, blocking Unity keyboard input"),Mf(!0),window.dispatchEvent(new CustomEvent("modal-opened"))):(console.log("ProfileModal: Modal closed, unblocking Unity keyboard input"),Mf(!1).then(()=>{setTimeout(()=>{s0(!0)},100)}),window.dispatchEvent(new CustomEvent("modal-closed"))),()=>{n&&(console.log("ProfileModal: Cleanup on unmount, unblocking Unity keyboard input"),Mf(!1),window.dispatchEvent(new CustomEvent("modal-closed")))}),[n]),k.useEffect(()=>{if(l&&re.current){const Y=()=>{re.current.focus(),I(!0),Mf(!0)};Y();const ie=setTimeout(Y,100),le=setTimeout(Y,300);return()=>{clearTimeout(ie),clearTimeout(le)}}else I(!1)},[l]),k.useEffect(()=>{const ie=setTimeout(async()=>{if(f.username&&f.username!==(i==null?void 0:i.username)){F(!0),L("");try{if(!/^[a-z0-9]{1,15}$/.test(f.username)){L("Username must be 1-15 characters, lowercase letters and numbers only"),F(!1);return}$u(f.username),await iR(f.username)&&L("Username is already taken")}catch(le){H.error("Error checking username:",le),L("Error checking username availability")}finally{F(!1)}}},500);return()=>clearTimeout(ie)},[f.username,i==null?void 0:i.username]);const ae=()=>{u(!1),I(!1),e()},ne=Y=>{const{name:ie,value:le}=Y.target;if(ie==="username"){const de=le.toLowerCase().replace(/[^a-z0-9]/g,"");_(ue=>({...ue,[ie]:de}))}else _(de=>({...de,[ie]:le}))},pe=async()=>{if(f.Nickname.trim()===""){B({title:"Error",description:"Display Name cannot be empty",status:"error",duration:3e3,isClosable:!0});return}if($u(f.Nickname),f.firstName&&$u(f.firstName),f.lastName&&$u(f.lastName),f.companyName&&$u(f.companyName),P){B({title:"Error",description:P,status:"error",duration:3e3,isClosable:!0});return}b(!0);try{if(f.username!==i.username&&($u(f.username),await iR(f.username))){L("Username is already taken"),B({title:"Error",description:"Username is already taken",status:"error",duration:3e3,isClosable:!0}),b(!1);return}const Y=dr(Dn,"users",i.uid);if(f.username!==i.username)try{if(H.log("ProfileModal: Updating username from",i.username,"to",f.username),!await QBe(i.uid,f.username))throw new Error("Failed to update username");H.log("ProfileModal: Username updated successfully")}catch(ie){H.error("Error updating username:",ie),B({title:"Error",description:"Failed to update username: "+(ie.message||"Please try again"),status:"error",duration:3e3,isClosable:!0}),b(!1);return}H.log("ProfileModal: Updating user profile");try{const ie={Nickname:f.Nickname,companyName:f.companyName,firstName:f.firstName,lastName:f.lastName,linkedInProfile:f.linkedInProfile,username:f.username,lastUpdated:new Date().toISOString()};await ms(Y,ie),H.log("ProfileModal: Profile updated successfully");const le=voe(Y,de=>{if(de.exists()&&de.data().Nickname===f.Nickname){try{Z()}catch(Oe){H.error("Error sending user to Unity:",Oe)}le()}},de=>{H.error("Error in profile update listener:",de)});try{await K()}catch(de){H.error("Error updating user context:",de)}_({Nickname:f.Nickname,username:f.username,companyName:f.companyName,firstName:f.firstName,lastName:f.lastName,linkedInProfile:f.linkedInProfile}),B({title:"Success",description:"Profile updated successfully",status:"success",duration:3e3,isClosable:!0}),u(!1)}catch(ie){H.error("Error updating profile data:",ie),B({title:"Error",description:"Failed to update profile: "+(ie.message||"Please try again"),status:"error",duration:3e3,isClosable:!0})}}catch(Y){H.error("Error in handleSave:",Y),B({title:"Error",description:"An unexpected error occurred: "+(Y.message||"Please try again"),status:"error",duration:3e3,isClosable:!0})}finally{b(!1)}},X=()=>S.jsxs(Fr,{spacing:4,align:"stretch",w:"100%",children:[S.jsxs(Cr,{direction:"column",align:"center",gap:2,children:[S.jsx(tt,{fontSize:"2xl",fontWeight:"bold",children:i.Nickname}),S.jsxs(tt,{fontSize:"md",color:"gray.400",children:["@",i.username]})]}),S.jsxs(Fr,{spacing:3,align:"stretch",bg:"gray.700",p:4,borderRadius:"md",children:[S.jsxs(Cr,{direction:"column",children:[S.jsx(tt,{color:"gray.400",fontSize:"sm",children:"Company"}),S.jsx(tt,{children:i.companyName||"Not specified"})]}),S.jsxs(Cr,{direction:"column",children:[S.jsx(tt,{color:"gray.400",fontSize:"sm",children:"Full Name"}),S.jsx(tt,{children:`${i.firstName||""} ${i.lastName||""}`.trim()||"Not specified"})]}),S.jsxs(Cr,{direction:"column",children:[S.jsx(tt,{color:"gray.400",fontSize:"sm",children:"LinkedIn"}),S.jsx(tt,{children:i.linkedInProfile||"Not specified"})]})]}),S.jsx(jn,{onClick:()=>u(!0),size:"sm",variant:"outline",_hover:{bg:"gray.700"},color:"white",borderColor:"gray.600",children:"Edit Profile"})]}),J=()=>S.jsxs(Fr,{spacing:4,align:"stretch",w:"100%",children:[S.jsxs(ur,{children:[S.jsx(ei,{color:"gray.400",fontSize:"sm",children:"Display Name"}),S.jsx(ti,{ref:re,name:"Nickname",value:f.Nickname,onChange:ne,onFocus:()=>{I(!0),Mf(!0)},placeholder:"Enter display name",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},maxLength:15})]}),S.jsxs(ur,{isInvalid:!!P,children:[S.jsx(ei,{color:"gray.400",fontSize:"sm",children:"Username"}),S.jsxs(Dg,{children:[S.jsx(X1,{bg:"gray.700",color:"gray.400",border:"none",children:"@"}),S.jsx(ti,{name:"username",value:f.username,onChange:ne,placeholder:"username",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},maxLength:15,isDisabled:M})]}),P&&S.jsx(tt,{color:"red.400",fontSize:"sm",mt:1,children:P}),S.jsx(Gy,{color:"gray.400",children:"Lowercase letters and numbers only, max 15 characters"})]}),S.jsxs(ur,{children:[S.jsx(ei,{color:"gray.400",fontSize:"sm",children:"Company Name"}),S.jsx(ti,{name:"companyName",value:f.companyName,onChange:ne,placeholder:"Enter company name",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"}})]}),S.jsxs(Cr,{gap:4,children:[S.jsxs(ur,{children:[S.jsx(ei,{color:"gray.400",fontSize:"sm",children:"First Name"}),S.jsx(ti,{name:"firstName",value:f.firstName,onChange:ne,placeholder:"Enter first name",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"}})]}),S.jsxs(ur,{children:[S.jsx(ei,{color:"gray.400",fontSize:"sm",children:"Last Name"}),S.jsx(ti,{name:"lastName",value:f.lastName,onChange:ne,placeholder:"Enter last name",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"}})]})]}),S.jsxs(ur,{children:[S.jsx(ei,{color:"gray.400",fontSize:"sm",children:"LinkedIn Profile"}),S.jsx(ti,{name:"linkedInProfile",value:f.linkedInProfile,onChange:ne,placeholder:"Enter LinkedIn profile URL",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"}})]}),S.jsxs(Cr,{gap:2,justify:"flex-end",mt:2,children:[S.jsx(jn,{onClick:()=>{_({Nickname:(i==null?void 0:i.Nickname)||"",username:(i==null?void 0:i.username)||"",companyName:(i==null?void 0:i.companyName)||"",firstName:(i==null?void 0:i.firstName)||"",lastName:(i==null?void 0:i.lastName)||"",linkedInProfile:(i==null?void 0:i.linkedInProfile)||""}),u(!1),L("")},variant:"outline",size:"sm",isDisabled:E,color:"white",borderColor:"gray.600",_hover:{bg:"gray.700"},children:"Cancel"}),S.jsx(jn,{onClick:pe,colorScheme:"blue",size:"sm",isLoading:E||M,isDisabled:!!P||M,children:"Save Changes"})]})]});return S.jsxs(hs,{isOpen:n,onClose:ae,isCentered:!0,closeOnOverlayClick:!l,trapFocus:!0,blockScrollOnMount:!1,size:"md",children:[S.jsx(fs,{backdropFilter:"blur(10px)"}),S.jsxs(ps,{bg:"gray.800",color:"white",children:[S.jsx(yo,{children:"Profile"}),S.jsx($s,{}),S.jsx(bs,{pb:6,children:S.jsxs(Fr,{spacing:6,children:[S.jsx(eu,{src:o,size:"2xl",borderRadius:"full"}),l?J():X(),!l&&S.jsx(jn,{variant:"ghost",size:"sm",colorScheme:"blue",width:"100%",onClick:()=>window.open("https://support.spacesmetaverse.com/","_blank"),children:"Visit Support Site"})]})})]})]})},ek={bg:"white",color:"black",borderRadius:"full",px:"6",py:"2",height:"auto",fontSize:"md",fontWeight:"medium",_hover:{bg:"gray.100"},display:"flex",alignItems:"center",gap:2},nae=()=>{var C;const{user:n,updateUser:e}=k.useContext(Uo),[i,o]=k.useState(!0),{isOpen:l,onOpen:u,onClose:f}=Xd();k.useEffect(()=>{const I=setTimeout(()=>{o(!1)},500);return()=>clearTimeout(I)},[]);const _=()=>{f(),e()},E=n!=null&&n.rpmURL?n.rpmURL.replace(".glb",".png?scene=fullbody-portrait-closeupfront&w=640&q=75"):null,b=(C=n==null?void 0:n.groups)==null?void 0:C.includes("disruptiveAdmin");return i?null:S.jsx(Cr,{align:"center",gap:"4",children:n?S.jsxs(S.Fragment,{children:[S.jsx(pze,{isOpen:l,onClose:_,user:n,profileImageUrl:E}),S.jsxs(bR,{children:[S.jsx(wR,{as:ct,cursor:"pointer",children:S.jsx(Cr,{align:"center",height:"40px",px:4,borderRadius:"full",border:"1px solid rgba(255, 255, 255, 0.3)",transition:"all 0.2s",sx:{"&:hover":{border:"2px solid white"}},children:S.jsxs(Cr,{align:"center",gap:"3",children:[S.jsx(ct,{width:"28px",height:"28px",borderRadius:"full",overflow:"hidden",bg:"white",display:"flex",alignItems:"center",justifyContent:"center",children:S.jsx(eu,{src:E,width:"100%",height:"100%",borderRadius:"full"})}),S.jsx(tt,{color:"white",fontWeight:"medium",children:n.Nickname}),S.jsx(ct,{display:"flex",alignItems:"center",height:"28px",children:S.jsx(zoe,{color:"white",w:4,h:4})})]})})}),S.jsx(ru,{children:S.jsxs(TR,{bg:"gray.800",borderColor:"gray.700",zIndex:9999,children:[S.jsxs(ct,{p:4,display:"flex",alignItems:"center",gap:3,children:[S.jsx(eu,{src:E,size:"md",borderRadius:"full"}),S.jsx(tt,{fontSize:"xl",fontWeight:"bold",color:"white",children:n.Nickname})]}),S.jsx(gp,{borderColor:"gray.700"}),b&&S.jsx(Lf,{as:"a",href:"/myadmin",_hover:{bg:"gray.700"},color:"white",bg:"gray.800",children:"My Admin"}),S.jsx(Lf,{_hover:{bg:"gray.700"},color:"white",bg:"gray.800",children:"My Spaces"}),S.jsx(Lf,{onClick:u,_hover:{bg:"gray.700"},color:"white",bg:"gray.800",children:"View Profile"}),S.jsx(gp,{borderColor:"gray.700"}),S.jsx(Lf,{_hover:{bg:"gray.700"},color:"white",bg:"gray.800",children:"Support"}),S.jsx(Lf,{_hover:{bg:"gray.700"},color:"white",bg:"gray.800",children:S.jsx(P3,{mode:"link",label:"Log out",linkProps:{color:"white",_hover:{textDecoration:"none"}}})})]})})]})]}):S.jsxs(S.Fragment,{children:[S.jsx(GN,{mode:"button",label:"Register",buttonProps:{...ek,width:["100%","auto"]},customButton:S.jsxs(jn,{...ek,children:[S.jsx(ct,{as:"span",fontSize:"xl",children:""}),"Register"]})}),S.jsx(HN,{mode:"button",label:"Sign In",buttonProps:{...ek,width:["100%","auto"]},customButton:S.jsxs(jn,{...ek,children:[S.jsx(ct,{as:"span",fontSize:"xl",children:""}),"Sign In"]})})]})})},fze=()=>{const{registrationInProgress:n}=RWe();return n?S.jsxs(hs,{isOpen:!0,onClose:()=>{},closeOnEsc:!1,closeOnOverlayClick:!1,isCentered:!0,motionPreset:"none",size:"full",children:[S.jsx(fs,{bg:"rgba(0,0,0,0.8)",backdropFilter:"blur(8px)"}),S.jsx(ps,{bg:"transparent",boxShadow:"none",maxW:"100%",maxH:"100%",display:"flex",alignItems:"center",justifyContent:"center",children:S.jsxs(Cr,{direction:"column",align:"center",justify:"center",p:8,maxW:"md",textAlign:"center",children:[S.jsx(nd,{size:"xl",thickness:"4px",speed:"0.8s",color:"blue.400",mb:6}),S.jsx(tt,{fontSize:"2xl",fontWeight:"bold",color:"white",mb:4,children:"Creating Your Account"}),S.jsx(tt,{fontSize:"md",color:"gray.300",mb:3,children:"Please wait while we set up your profile with Spaces Metaverse"}),S.jsx(tt,{fontSize:"sm",color:"gray.400",mb:1,children:"This typically takes 5-10 seconds to complete"}),S.jsx(tt,{fontSize:"sm",color:"gray.400",children:"Please do not refresh or close this page"})]})})]}):null},HU=document.getElementById("header-auth-root");if(HU){const n=HU.getAttribute("data-theme")||"default",e=()=>{const[i,o]=k.useState(null);return k.useEffect(()=>{YC(n).then(o)},[]),i?S.jsx(Y1,{theme:i,children:S.jsx(FN,{children:S.jsxs(T3,{children:[S.jsx(nae,{}),S.jsx(fze,{})]})})}):S.jsx("div",{children:"Loading theme..."})};P1.createRoot(HU).render(S.jsx(e,{}))}else console.error("Root element 'header-auth-root' not found.");var $U={},xT={},LT={},AQ;function mze(){if(AQ)return LT;AQ=1,Object.defineProperty(LT,"__esModule",{value:!0}),LT.useUnityCanvasId=void 0;var n=Ju(),e=0,i="react-unity-webgl-canvas",o=function(l){if(l.id!==void 0)return l.id;var u=(0,n.useMemo)(function(){return[i,++e].join("-")},[]);return u};return LT.useUnityCanvasId=o,LT}var Of={},MT={},PQ;function rae(){if(PQ)return MT;PQ=1,Object.defineProperty(MT,"__esModule",{value:!0}),MT.UnityLoaderStatus=void 0;var n;return function(e){e.Idle="Idle",e.Loading="Loading",e.Loaded="Loaded",e.Error="Error"}(n||(MT.UnityLoaderStatus=n={})),MT}var UT={},OQ;function k3(){return OQ||(OQ=1,Object.defineProperty(UT,"__esModule",{value:!0}),UT.isBrowserEnvironment=void 0,UT.isBrowserEnvironment=typeof window<"u"&&typeof document<"u"),UT}var kQ;function gze(){if(kQ)return Of;kQ=1;var n=Of&&Of.__awaiter||function(f,_,E,b){function C(I){return I instanceof E?I:new E(function(P){P(I)})}return new(E||(E=Promise))(function(I,P){function L(B){try{F(b.next(B))}catch(Z){P(Z)}}function M(B){try{F(b.throw(B))}catch(Z){P(Z)}}function F(B){B.done?I(B.value):C(B.value).then(L,M)}F((b=b.apply(f,_||[])).next())})},e=Of&&Of.__generator||function(f,_){var E={label:0,sent:function(){if(I[0]&1)throw I[1];return I[1]},trys:[],ops:[]},b,C,I,P=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return P.next=L(0),P.throw=L(1),P.return=L(2),typeof Symbol=="function"&&(P[Symbol.iterator]=function(){return this}),P;function L(F){return function(B){return M([F,B])}}function M(F){if(b)throw new TypeError("Generator is already executing.");for(;P&&(P=0,F[0]&&(E=0)),E;)try{if(b=1,C&&(I=F[0]&2?C.return:F[0]?C.throw||((I=C.return)&&I.call(C),0):C.next)&&!(I=I.call(C,F[1])).done)return I;switch(C=0,I&&(F=[F[0]&2,I.value]),F[0]){case 0:case 1:I=F;break;case 4:return E.label++,{value:F[1],done:!1};case 5:E.label++,C=F[1],F=[0];continue;case 7:F=E.ops.pop(),E.trys.pop();continue;default:if(I=E.trys,!(I=I.length>0&&I[I.length-1])&&(F[0]===6||F[0]===2)){E=0;continue}if(F[0]===3&&(!I||F[1]>I[0]&&F[1]<I[3])){E.label=F[1];break}if(F[0]===6&&E.label<I[1]){E.label=I[1],I=F;break}if(I&&E.label<I[2]){E.label=I[2],E.ops.push(F);break}I[2]&&E.ops.pop(),E.trys.pop();continue}F=_.call(f,E)}catch(B){F=[6,B],C=0}finally{b=I=0}if(F[0]&5)throw F[1];return{value:F[0]?F[1]:void 0,done:!0}}};Object.defineProperty(Of,"__esModule",{value:!0}),Of.useUnityInstance=void 0;var i=Ju(),o=rae(),l=k3(),u=function(f,_,E,b){(0,i.useEffect)(function(){(function(){return n(void 0,void 0,void 0,function(){var C,I;return e(this,function(P){switch(P.label){case 0:if(l.isBrowserEnvironment===!1)return[2];if(f!==o.UnityLoaderStatus.Loaded||_===null)return b.setUnityInstance(null),b.setInitialisationError(null),[2];P.label=1;case 1:return P.trys.push([1,3,,4]),[4,window.createUnityInstance(_,E,b.setLoadingProgression)];case 2:return C=P.sent(),b.setUnityInstance(C),b.setInitialisationError(null),[3,4];case 3:return I=P.sent(),b.setUnityInstance(null),b.setInitialisationError(I),[3,4];case 4:return[2]}})})})()},[f,_,E,b])};return Of.useUnityInstance=u,Of}var VT={},NQ;function _ze(){if(NQ)return VT;NQ=1,Object.defineProperty(VT,"__esModule",{value:!0}),VT.useUnityArguments=void 0;var n=Ju(),e=function(i){return(0,n.useMemo)(function(){return{dataUrl:i.unityProvider.unityConfig.dataUrl,frameworkUrl:i.unityProvider.unityConfig.frameworkUrl,codeUrl:i.unityProvider.unityConfig.codeUrl,streamingAssetsUrl:i.unityProvider.unityConfig.streamingAssetsUrl,memoryUrl:i.unityProvider.unityConfig.memoryUrl,symbolsUrl:i.unityProvider.unityConfig.symbolsUrl,workerUrl:i.unityProvider.unityConfig.workerUrl,companyName:i.unityProvider.unityConfig.companyName,productName:i.unityProvider.unityConfig.productName,productVersion:i.unityProvider.unityConfig.productVersion,webglContextAttributes:i.unityProvider.unityConfig.webglContextAttributes||{},cacheControl:i.unityProvider.unityConfig.cacheControl||function(){return"must-revalidate"},devicePixelRatio:i.devicePixelRatio||1,autoSyncPersistentDataPath:i.autoSyncPersistentDataPath,matchWebGLToCanvasSize:typeof i.matchWebGLToCanvasSize=="boolean"?i.matchWebGLToCanvasSize:!0,disabledCanvasEvents:i.disabledCanvasEvents||["contextmenu","dragstart"],print:function(o){},printErr:function(o){}}},[])};return VT.useUnityArguments=e,VT}var jT={},DQ;function yze(){if(DQ)return jT;DQ=1,Object.defineProperty(jT,"__esModule",{value:!0}),jT.useUnityLoader=void 0;var n=Ju(),e=k3(),i=rae(),o=function(l){var u=(0,n.useState)(i.UnityLoaderStatus.Loading),f=u[0],_=u[1];return(0,n.useEffect)(function(){if(e.isBrowserEnvironment!==!1){if(l.loaderUrl===null){_(i.UnityLoaderStatus.Idle);return}var E=window.document.querySelector('script[src="'.concat(l.loaderUrl,'"]'));E===null?(E=window.document.createElement("script"),E.type="text/javascript",E.src=l.loaderUrl,E.async=!0,E.setAttribute("data-status","loading"),window.document.body.appendChild(E),E.addEventListener("load",function(){return E==null?void 0:E.setAttribute("data-status","loaded")}),E.addEventListener("error",function(){return E==null?void 0:E.setAttribute("data-status","error")})):_(E.getAttribute("data-status")==="loaded"?i.UnityLoaderStatus.Loaded:i.UnityLoaderStatus.Error);var b=function(C){return _(C.type==="load"?i.UnityLoaderStatus.Loaded:i.UnityLoaderStatus.Error)};return E.addEventListener("load",b),E.addEventListener("error",b),function(){E!==null&&(E.removeEventListener("load",b),E.removeEventListener("error",b),window.document.body.removeChild(E))}}},[l.loaderUrl]),f};return jT.useUnityLoader=o,jT}var xQ;function Eze(){if(xQ)return xT;xQ=1,Object.defineProperty(xT,"__esModule",{value:!0}),xT.Unity=void 0;var n=Ju(),e=Ju(),i=mze(),o=gze(),l=_ze(),u=yze(),f=(0,e.forwardRef)(function(_,E){var b=(0,e.useRef)(null),C=(0,i.useUnityCanvasId)(_),I=(0,l.useUnityArguments)(_),P=(0,u.useUnityLoader)(_.unityProvider.unityConfig);return(0,o.useUnityInstance)(P,b.current,I,_.unityProvider),(0,n.useImperativeHandle)(E,function(){return b.current}),(0,n.createElement)("canvas",{ref:b,id:C,style:_.style,className:_.className,tabIndex:_.tabIndex})});return xT.Unity=f,xT}var kf={},FT={},LQ;function iae(){if(LQ)return FT;LQ=1,Object.defineProperty(FT,"__esModule",{value:!0}),FT.errorMessages=void 0;var n={genericNoUnityInstance:"No Unity Instance found.",requestFullscreenNoUnityInstance:"Unable to Set Fullscreen while Unity is not Instantiated.",requestPointerLockNoUnityInstanceOrCanvas:"Unable to Request Pointer Lock while Unity is not Instantiated or the Canvas is not found.",sendMessageNoUnityInstance:"Unable to Send Message while Unity is not Instantiated.",quitNoUnityInstance:"Unable to Quit Unity while Unity is not Instantiated.",screenshotNoUnityInstanceOrCanvas:"Unable to Take Screenshot while Unity is not Instantiated or Canvas is not available.",noEventListener:"Unable to find Event Listener in Event System for Event"};return FT.errorMessages=n,FT}var Ty={},MQ;function vze(){if(MQ)return Ty;MQ=1;var n=Ty&&Ty.__spreadArray||function(_,E,b){if(b||arguments.length===2)for(var C=0,I=E.length,P;C<I;C++)(P||!(C in E))&&(P||(P=Array.prototype.slice.call(E,0,C)),P[C]=E[C]);return _.concat(P||Array.prototype.slice.call(E))};Object.defineProperty(Ty,"__esModule",{value:!0}),Ty.useEventSystem=void 0;var e=Ju(),i=iae(),o=k3(),l=[],u=function(_){for(var E=[],b=1;b<arguments.length;b++)E[b-1]=arguments[b];var C=void 0;return l.forEach(function(I){C=I.apply(void 0,n([_],E,!1))}),C};o.isBrowserEnvironment===!0&&(window.dispatchReactUnityEvent=u);var f=function(){var _=(0,e.useRef)([]),E=(0,e.useCallback)(function(I,P){_.current=n(n([],_.current,!0),[{eventName:I,callback:P}],!1)},[_]),b=(0,e.useCallback)(function(I,P){_.current=_.current.filter(function(L){return L.eventName!==I&&L.callback!==P})},[_]),C=(0,e.useCallback)(function(I){for(var P=[],L=1;L<arguments.length;L++)P[L-1]=arguments[L];var M=_.current.find(function(F){return F.eventName===I});if(typeof M>"u"){console.warn(i.errorMessages.noEventListener,{eventName:I});return}return M.callback.apply(M,P)},[_]);return(0,e.useEffect)(function(){return l.push(C),function(){l.splice(l.indexOf(C),1)}},[C]),{addEventListener:E,removeEventListener:b}};return Ty.useEventSystem=f,Ty}var BT={},UQ;function Sze(){if(UQ)return BT;UQ=1,Object.defineProperty(BT,"__esModule",{value:!0}),BT.useNullableState=void 0;var n=Ju(),e=function(i){return(0,n.useState)(i||null)};return BT.useNullableState=e,BT}var VQ;function bze(){if(VQ)return kf;VQ=1;var n=kf&&kf.__awaiter||function(_,E,b,C){function I(P){return P instanceof b?P:new b(function(L){L(P)})}return new(b||(b=Promise))(function(P,L){function M(Z){try{B(C.next(Z))}catch(K){L(K)}}function F(Z){try{B(C.throw(Z))}catch(K){L(K)}}function B(Z){Z.done?P(Z.value):I(Z.value).then(M,F)}B((C=C.apply(_,E||[])).next())})},e=kf&&kf.__generator||function(_,E){var b={label:0,sent:function(){if(P[0]&1)throw P[1];return P[1]},trys:[],ops:[]},C,I,P,L=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return L.next=M(0),L.throw=M(1),L.return=M(2),typeof Symbol=="function"&&(L[Symbol.iterator]=function(){return this}),L;function M(B){return function(Z){return F([B,Z])}}function F(B){if(C)throw new TypeError("Generator is already executing.");for(;L&&(L=0,B[0]&&(b=0)),b;)try{if(C=1,I&&(P=B[0]&2?I.return:B[0]?I.throw||((P=I.return)&&P.call(I),0):I.next)&&!(P=P.call(I,B[1])).done)return P;switch(I=0,P&&(B=[B[0]&2,P.value]),B[0]){case 0:case 1:P=B;break;case 4:return b.label++,{value:B[1],done:!1};case 5:b.label++,I=B[1],B=[0];continue;case 7:B=b.ops.pop(),b.trys.pop();continue;default:if(P=b.trys,!(P=P.length>0&&P[P.length-1])&&(B[0]===6||B[0]===2)){b=0;continue}if(B[0]===3&&(!P||B[1]>P[0]&&B[1]<P[3])){b.label=B[1];break}if(B[0]===6&&b.label<P[1]){b.label=P[1],P=B;break}if(P&&b.label<P[2]){b.label=P[2],b.ops.push(B);break}P[2]&&b.ops.pop(),b.trys.pop();continue}B=E.call(_,b)}catch(Z){B=[6,Z],I=0}finally{C=P=0}if(B[0]&5)throw B[1];return{value:B[0]?B[1]:void 0,done:!0}}};Object.defineProperty(kf,"__esModule",{value:!0}),kf.useUnityContext=void 0;var i=Ju(),o=iae(),l=vze(),u=Sze(),f=function(_){var E=(0,u.useNullableState)(),b=E[0],C=E[1],I=(0,i.useState)(0),P=I[0],L=I[1],M=(0,i.useState)(!1),F=M[0],B=M[1],Z=(0,u.useNullableState)(),K=Z[0],re=Z[1],ae=(0,l.useEventSystem)(),ne=(0,i.useRef)({setLoadingProgression:L,setInitialisationError:re,setUnityInstance:C,setIsLoaded:B,unityConfig:_}),pe=(0,i.useCallback)(function(de){if(b===null){console.warn(o.errorMessages.requestFullscreenNoUnityInstance);return}b.SetFullscreen(de===!0?1:0)},[b]),X=(0,i.useCallback)(function(){if(b===null||typeof b.Module.canvas>"u"){console.warn(o.errorMessages.requestPointerLockNoUnityInstanceOrCanvas);return}return b.Module.canvas.requestPointerLock()},[b]),J=(0,i.useCallback)(function(de,ue,Oe){if(b===null){console.warn(o.errorMessages.sendMessageNoUnityInstance);return}b.SendMessage(de,ue,Oe)},[b]),Y=(0,i.useCallback)(function(de,ue){if(b===null||typeof b.Module.canvas>"u"){console.warn(o.errorMessages.screenshotNoUnityInstanceOrCanvas);return}return b.Module.canvas.toDataURL(de,ue)},[b]),ie=(0,i.useCallback)(function(){return b===null?(console.warn(o.errorMessages.quitNoUnityInstance),Promise.reject()):b.Quit()},[b]),le=(0,i.useCallback)(function(){return n(void 0,void 0,void 0,function(){var de;return e(this,function(ue){switch(ue.label){case 0:return b===null||typeof b.Module.canvas>"u"?(console.warn(o.errorMessages.genericNoUnityInstance),[2,Promise.reject()]):(de=b.Module.canvas,document.body.appendChild(de),de.style.display="none",[4,ie()]);case 1:return ue.sent(),de.remove(),[2]}})})},[b]);return(0,i.useEffect)(function(){B(P===1)},[P]),{unityProvider:ne.current,loadingProgression:P,initialisationError:K,isLoaded:F,UNSAFE__unityInstance:b,requestFullscreen:pe,requestPointerLock:X,sendMessage:J,takeScreenshot:Y,unload:ie,UNSAFE__detachAndUnloadImmediate:le,addEventListener:ae.addEventListener,removeEventListener:ae.removeEventListener}};return kf.useUnityContext=f,kf}var jQ;function wze(){return jQ||(jQ=1,function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.useUnityContext=n.Unity=void 0;var e=Eze();Object.defineProperty(n,"Unity",{enumerable:!0,get:function(){return e.Unity}});var i=bze();Object.defineProperty(n,"useUnityContext",{enumerable:!0,get:function(){return i.useUnityContext}})}($U)),$U}var sae=wze();const Gd="[UnityProvider]",Nj=k.createContext(),Tze=({spaceID:n,children:e,loaderUrl:i,dataUrl:o,frameworkUrl:l,codeUrl:u,loadingBackground:f,showLoginButton:_,showDisruptiveLogo:E})=>{H.log(`${Gd} Initializing with spaceID:`,n),H.log(`${Gd} Unity URLs:`,{loaderUrl:i,dataUrl:o,frameworkUrl:l,codeUrl:u});const{unityProvider:b,loadingProgression:C,isLoaded:I,sendMessage:P,addEventListener:L,removeEventListener:M,error:F}=sae.useUnityContext({loaderUrl:i,dataUrl:o,frameworkUrl:l,codeUrl:u}),B={unityProvider:b,loadingProgression:C,isLoaded:I,sendMessage:P,addEventListener:L,removeEventListener:M,error:F,spaceID:n},Z=k.useRef(null),K=k.useRef(Date.now());k.useEffect(()=>{const pe=()=>{document.hidden?(H.log(`${Gd} Page hidden, starting keep-alive`),re()):(H.log(`${Gd} Page visible, stopping keep-alive`),ae())};return document.addEventListener("visibilitychange",pe),()=>{document.removeEventListener("visibilitychange",pe),ae()}},[]),k.useEffect(()=>{const pe=()=>{K.current=Date.now(),document.hidden&&P("WebGLInputManager","KeepAlive")};return window.addEventListener("mousemove",pe),window.addEventListener("keydown",pe),window.addEventListener("touchstart",pe),()=>{window.removeEventListener("mousemove",pe),window.removeEventListener("keydown",pe),window.removeEventListener("touchstart",pe)}},[P]);const re=()=>{Z.current||(Z.current=setInterval(()=>{I&&document.hidden&&(P("WebGLInputManager","KeepAlive"),H.debug(`${Gd} Sent keep-alive message`))},1e4))},ae=()=>{Z.current&&(clearInterval(Z.current),Z.current=null)};k.useEffect(()=>(H.log(`${Gd} Component mounted`),()=>{H.log(`${Gd} Component unmounting`),ae()}),[]),k.useEffect(()=>{H.log(`${Gd} Loading progress:`,C)},[C]),k.useEffect(()=>{I&&(H.log(`${Gd} Unity instance loaded for:`,n),document.hidden&&re())},[I,n]),k.useEffect(()=>{F&&H.error(`${Gd} Unity error:`,F)},[F]),H.log(`${Gd} Rendering provider with instance:`,B),k.useEffect(()=>{H.log("UnityProvider: Unity build URLs:",{loaderUrl:i,dataUrl:o,frameworkUrl:l,codeUrl:u})},[i,o,l,u]);const ne=[];if(i||ne.push("loaderUrl"),o||ne.push("dataUrl"),l||ne.push("frameworkUrl"),u||ne.push("codeUrl"),ne.length>0)return H.error(`UnityProvider: Missing required Unity build URLs: ${ne.join(", ")}`),S.jsx(Nj.Provider,{value:{unityProvider:null,loadingProgression:0,isLoaded:!1,sendMessage:()=>{},addEventListener:()=>{},removeEventListener:()=>{},error:new Error(`Missing required Unity build URLs: ${ne.join(", ")}`),spaceID:n},children:e});try{return k.useEffect(()=>{H.log("UnityProvider: Unity context created:",b),b?H.log("UnityProvider: Unity provider is available"):H.error("UnityProvider: Unity provider is not available"),I?H.log("UnityProvider: Unity is loaded"):H.log("UnityProvider: Unity is not loaded yet")},[b,I]),S.jsx(Nj.Provider,{value:B,children:e})}catch(pe){return H.error("UnityProvider: Error creating Unity context:",pe),S.jsxs("div",{style:{padding:"20px",color:"red",backgroundColor:"#ffeeee",border:"1px solid red",borderRadius:"5px"},children:[S.jsx("h3",{children:"Unity Error"}),S.jsxs("p",{children:["Error creating Unity context: ",pe.message]}),S.jsx("p",{children:"Please check the console for more details."})]})}},ea=()=>k.useContext(Nj),uc=()=>{const{sendMessage:n,isLoaded:e}=ea(),i=k.useRef([]),o=k.useCallback(()=>{if(e)for(;i.current.length>0;){const{eventName:u,data:f}=i.current.shift();H.log("useSendUnityEvent: Processing queued event to Unity:",u,f);try{n("ReactIncomingEvent","HandleEvent",JSON.stringify({eventName:u,data:JSON.stringify(f)}))}catch(_){H.error("useSendUnityEvent: Error sending event to Unity:",_),i.current.unshift({eventName:u,data:f});break}}},[n,e]);return k.useEffect(()=>{const u=setInterval(()=>{o()},1e3);return()=>clearInterval(u)},[o]),k.useCallback((u,f)=>{H.log("useSendUnityEvent: Queuing event for Unity:",u),i.current.push({eventName:u,data:f}),o()},[o])},bl=()=>{const{addEventListener:n,removeEventListener:e}=ea();return k.useCallback((i,o)=>{const l=u=>{H.log(i+" unity message received.");let f=null;if(u)try{f=JSON.parse(u)}catch(_){H.warn("Failed to parse JSON data from Unity message:",_)}o(f)};return n(i,l),()=>{e(i,l)}},[n,e])},oae=()=>{const[n,e]=k.useState({}),[i,o]=k.useState(!1),[l,u]=k.useState(null),[f,_]=k.useState(0),E=uc(),b=bl(),{spaceID:C,sendMessage:I,isLoaded:P}=ea(),L=k.useCallback((Z,K)=>{if(!Z)return;H.log(`useHLSStream: Sending stream URL to Unity: ${Z} for player ${K}`);const re={identifier:"LiveProjector",playerIndex:K.toString(),streamUrl:Z};if(E("SetHLSStream",re),P&&I)try{H.log("useHLSStream: Sending with ReactIncomingEvent approach"),I("ReactIncomingEvent","HandleEvent",JSON.stringify({eventName:"SetHLSStream",data:JSON.stringify(re)})),H.log("useHLSStream: Sending with direct HLSStream approach"),I("HLSStream","SetHLSStream",JSON.stringify({identifier:"LiveProjector",playerIndex:K.toString(),streamUrl:Z})),H.log("useHLSStream: Sending with most direct approach possible"),I("LiveProjector","SetStreamUrl",Z),I("HLSStreamClient","SetStreamUrl",JSON.stringify({Index:K.toString(),Url:Z}))}catch(ae){H.error("useHLSStream: Error with direct message:",ae)}else H.warn("useHLSStream: Unity not loaded, could not send direct message")},[E,I,P]);k.useEffect(()=>{C&&M(C)},[C]);const M=async Z=>{try{if(!Z){H.warn("useHLSStream: Cannot load stream from Firebase - no spaceID");return}o(!0),H.log(`useHLSStream: Loading stream from Firebase for space ${Z}`);const K=await Foe(Z);if(K&&K.streamUrl)if(H.log(`useHLSStream: Loaded stream data from Firebase for space ${Z}`,K),u(K),P)H.log("useHLSStream: Unity is loaded, sending stream URL to Unity after delay"),setTimeout(()=>{L(K.streamUrl,K.playerIndex||"0")},500),setTimeout(()=>{H.log("useHLSStream: Sending backup stream URL to Unity after longer delay"),L(K.streamUrl,K.playerIndex||"0")},2e3);else{H.warn("useHLSStream: Unity is not loaded yet, will try again later");const re=setInterval(()=>{P&&(H.log("useHLSStream: Unity is now loaded, sending stream URL to Unity"),L(K.streamUrl,K.playerIndex||"0"),clearInterval(re))},1e3);setTimeout(()=>{clearInterval(re)},3e4)}else H.log(`useHLSStream: No saved stream found for space ${Z}`),u(null)}catch(K){H.error(`useHLSStream: Error loading stream from Firebase for space ${Z}`,K)}finally{o(!1)}},F=k.useCallback(async()=>{C&&(H.log(`useHLSStream: Forcing reload of stream data for space ${C}`),_(Z=>Z+1),await M(C))},[C]),B=k.useCallback(async(Z,K=0,re={})=>{try{if(!Z||!Z.trim()){H.error("useHLSStream: Invalid stream URL");return}o(!0),H.log(`useHLSStream: Setting HLS stream URL for LiveProjector[${K}]`,Z);const{enabled:ae=!0,rtmpUrl:ne="",streamKey:pe="",skipSendToUnity:X=!1}=re;if(X||L(Z,K),C)try{const J={streamUrl:Z,playerIndex:K.toString(),enabled:ae,rtmpUrl:ne,streamKey:pe,updatedAt:new Date().toISOString()};H.log(`useHLSStream: Saving stream URL to Firebase for space ${C}`,J),await Tj(C,J),u(J)}catch(J){throw H.error(`useHLSStream: Error saving stream URL to Firebase for space ${C}`,J),J}else H.warn("useHLSStream: No spaceID available, stream URL not saved to Firebase")}finally{o(!1)}},[L,C]);return k.useEffect(()=>{const K=b("SetHLSStream",re=>{if(re)try{H.log("useHLSStream: Received player status update",re);const{identifier:ae,playerIndex:ne,isReady:pe,isPlaying:X}=re,J=`${ae}_${ne}`;e(Y=>({...Y,[J]:{identifier:ae,playerIndex:ne,isReady:pe,isPlaying:X}}))}catch(ae){H.error("useHLSStream: Error handling player status update",ae)}});return()=>{K()}},[b]),k.useEffect(()=>{if(l&&l.streamUrl){H.log("useHLSStream: Resending saved stream URL to Unity");const Z=setTimeout(()=>{L(l.streamUrl,l.playerIndex||"0")},1e3);return()=>clearTimeout(Z)}},[l,n,L,f]),k.useEffect(()=>{const Z=K=>{if(K.detail){if(H.log("useHLSStream: Received stream update event",K.detail),C===K.detail.spaceId)H.log(`useHLSStream: Stream update is for our space ${C}, loading stream data`),M(C);else if(K.detail.streamUrl){H.log(`useHLSStream: Using stream URL directly from event: ${K.detail.streamUrl}`);const re=K.detail.playerIndex||"0";L(K.detail.streamUrl,re),u(K.detail)}}};return window.addEventListener("SpaceHLSStreamUpdated",Z),window.addEventListener("SpaceStreamUpdated",Z),()=>{window.removeEventListener("SpaceHLSStreamUpdated",Z),window.removeEventListener("SpaceStreamUpdated",Z)}},[C,L]),{setHLSStreamUrl:B,playerStatus:n,isLoading:i,savedStreamData:l,reloadStreamData:F}},Cze=()=>{const[n,e]=k.useState(!1),i=bl();return k.useEffect(()=>{const l=i("FirstSceneLoaded",()=>{H.log("FirstSceneLoaded unity message received."),e(!0)});return()=>{l()}},[i]),n},Rze=()=>{const[n,e]=k.useState(null),i=bl();return console.log(" Nameplate click hook initialized"),k.useEffect(()=>{console.log(" Setting up nameplate click listener...");const u=i("OpenNameplateModal",f=>{if(console.log(" Nameplate click detected!",f),!f){console.warn(" Received empty data in nameplate click handler");return}try{const _=typeof f=="string"?JSON.parse(f):f;e({playerName:_.playerName,playerId:_.playerId,uid:_.uid,isLocalPlayer:_.isLocalPlayer}),console.log(" Processed nameplate data:",_)}catch(_){console.error(" Error processing nameplate data:",_)}});return()=>{console.log(" Cleaning up nameplate click listener"),typeof u=="function"&&u()}},[i]),[n,()=>{console.log(" Resetting nameplate data"),e(null)}]},Ize=()=>{const n=bl(),{sendUserToUnity:e}=k.useContext(Uo);return k.useEffect(()=>{const o=n("RequestUserForUnity",()=>{H.log("React: Request from Unity to send user data"),e()});return()=>{o()}},[n,e]),!0},FQ=async(n,e,i,o={})=>{try{const{mediaType:l="image",displayAsVideo:u=!1,directUrl:f=null}=o;if(!n||!e)throw new Error("Missing required parameters: spaceId and mediaScreenId");let _=null;if(i){if(!i.type.startsWith("image/"))throw new Error("File must be an image");const E=lm(),b=Date.now(),C=i.name.split(".").pop(),I=`${e}_${b}.${C}`,P=cm(E,`spaces/${n}/mediaScreens/${I}`);H.log(`Uploading image for media screen ${e} in space ${n}`);const L=await VN(P,i);_=await UR(L.ref);const M=dr(Dn,`spaces/${n}/mediaScreens`,e);await qg(M,{imageUrl:_,gsUrl:`gs://${L.ref.bucket}/${L.ref.fullPath}`,fileName:I,mediaType:l,displayAsVideo:u,uploadedAt:new Date().toISOString(),updatedAt:new Date().toISOString()},{merge:!0})}else if(f){_=f;const E=dr(Dn,`spaces/${n}/mediaScreens`,e);await qg(E,{videoUrl:f,mediaType:l,displayAsVideo:u,uploadedAt:new Date().toISOString(),updatedAt:new Date().toISOString()},{merge:!0})}else throw new Error("Either imageFile or directUrl must be provided");return H.log(`Successfully uploaded ${l} for media screen ${e} (display as video: ${u})`),_}catch(l){throw H.error(`Error uploading media screen ${(o==null?void 0:o.mediaType)||"image"}:`,l),l}},N3=async n=>{H.log(`Getting media screen images for space: ${n}`);try{const e=Sl(Dn,`spaces/${n}/mediaScreens`),i=await ed(e),o=[];return i.forEach(l=>{o.push({id:l.id,...l.data()})}),o}catch(e){throw H.error("Error fetching media screen images from Firestore:",e),e}},Wf=async(n,e)=>{try{const i=dr(Dn,`spaces/${n}/mediaScreens`,e),o=await _o(i);return o.exists()?{id:o.id,...o.data()}:(H.warn(`No media screen found with ID: ${e}`),null)}catch(i){throw H.error("Error fetching media screen image:",i),i}},Aze=async(n,e)=>{try{const i=await Wf(n,e);if(!i)return H.warn(`No media screen found with ID: ${e} to delete`),!1;if(i.gsUrl){const l=lm(),u=cm(l,i.gsUrl);try{await jN(u),H.log(`Deleted file from storage: ${i.gsUrl}`)}catch(f){H.warn(`Could not delete file from storage: ${f.message}`)}}const o=dr(Dn,`spaces/${n}/mediaScreens`,e);return i.mediaType==="video"?(await ms(o,{videoUrl:null,mediaType:null,displayAsVideo:!1,deletedAt:new Date().toISOString(),updatedAt:new Date().toISOString()}),H.log(`Successfully removed video for media screen ${e}`)):(await ms(o,{imageUrl:null,gsUrl:null,fileName:null,mediaType:null,displayAsVideo:!1,deletedAt:new Date().toISOString(),updatedAt:new Date().toISOString()}),H.log(`Successfully removed image for media screen ${e}`)),!0}catch(i){throw H.error("Error deleting media screen image:",i),i}},Pze=async(n,e,i)=>{try{if(!n||!e||typeof i!="boolean")throw new Error("Missing or invalid required parameters");const o=await Wf(n,e);if(!o||!o.imageUrl&&!o.videoUrl)return H.warn(`No media screen content found with ID: ${e} to update`),!1;const l=dr(Dn,`spaces/${n}/mediaScreens`,e);return await ms(l,{displayAsVideo:i,updatedAt:new Date().toISOString()}),H.log(`Successfully updated display mode for media screen ${e} to ${i?"video":"image"}`),!0}catch(o){throw H.error("Error updating media screen display mode:",o),o}},Oze=n=>{if(!n)return null;try{if(n.includes("firebasestorage.googleapis.com")){const e=new URL(n),i=e.searchParams.get("alt"),o=e.searchParams.get("token");return e.search="",i&&e.searchParams.set("alt",i),o&&e.searchParams.set("token",o),console.log(`Cleaned Firebase URL from ${n} to ${e.toString()}`),e.toString()}return n}catch(e){return console.error("Error cleaning Firebase URL:",e),n}},aae=()=>{const{spaceID:n}=ea(),e=uc(),[i,o]=k.useState(!1);k.useEffect(()=>{if(window.isPlayerInstantiated){H.log("useUnityMediaScreenImages: Unity already ready (via window flag)"),o(!0);return}const l=()=>{H.log("useUnityMediaScreenImages: Unity is now ready (PlayerInstantiated event)"),o(!0)};return window.addEventListener("PlayerInstantiated",l),()=>{window.removeEventListener("PlayerInstantiated",l)}},[]),k.useEffect(()=>{if(!i){H.log("useUnityMediaScreenImages: Waiting for Unity to be ready before loading media screens");return}H.log("useUnityMediaScreenImages: Unity is ready, now loading media screens"),(async()=>{try{if(!n)throw new Error("spaceID is not defined.");const u=await N3(n);H.log("Fetched Media Screen Images",u),u.forEach(f=>{const{id:_,imageUrl:E,displayAsVideo:b,videoUrl:C}=f;let I=null;(!b||!C)&&(I=E?Oze(E):null),e("SetMediaScreenImage",{mediaScreenId:_,imageUrl:I,videoUrl:C||null,displayAsVideo:b||!1,timestamp:Date.now()}),H.log(`Sent media screen data for ${_} to Unity (displayAsVideo: ${b})`),b&&C&&(e("SetMediaScreenDisplayMode",{mediaScreenId:_,displayAsVideo:!0,videoUrl:C,timestamp:Date.now()}),H.log(`Set display mode to video for screen ${_}`))})}catch(u){H.error("Error fetching media screen images:",u)}})()},[e,n,i])},kze=()=>{const{spaceID:n}=ea(),e=uc(),[i,o]=k.useState(!1);k.useEffect(()=>{if(window.isPlayerInstantiated){H.log("useUnityThumbnails: Unity already ready (via window flag)"),o(!0);return}const l=()=>{H.log("useUnityThumbnails: Unity is now ready (PlayerInstantiated event)"),o(!0)};return window.addEventListener("PlayerInstantiated",l),()=>{window.removeEventListener("PlayerInstantiated",l)}},[]),k.useEffect(()=>{if(!i){H.log("useUnityThumbnails: Waiting for Unity to be ready before loading thumbnails");return}H.log("useUnityThumbnails: Unity is ready, now loading thumbnails"),(async()=>{try{if(!n)throw new Error("spaceID is not defined.");const u=await joe(n),f=async b=>{const C=`https://vimeo.com/api/oembed.json?url=${b}`,I=await fetch(C);if(!I.ok)throw new Error(`Failed to fetch thumbnail: ${I.statusText}`);const P=await I.json(),L=P.thumbnail_url.replace(/_\d+x\d+/,""),M=["640x360","295x166"];let F=null;for(let B of M){const Z=`https://i.vimeocdn.com/filter/overlay?src0=${encodeURIComponent(`${L}_${B}`)}&src1=http://f.vimeocdn.com/p/images/crawler_play.png`;try{if((await fetch(Z,{method:"HEAD"})).ok){F=Z;break}}catch(K){console.warn(`Failed to validate thumbnail URL: ${Z}`,K)}}return F||P.thumbnail_url},_=u.map(async b=>{const C=await f(b.url);return{gameObjectName:b.id,thumbnailUrl:C}}),E=await Promise.all(_);H.log("Fetched Thumbnails",E),E.forEach(({gameObjectName:b,thumbnailUrl:C})=>{e("SetThumbnail",{gameObjectName:b,thumbnailUrl:C})})}catch(u){H.error("Error fetching thumbnails:",u)}})()},[e,n,i])},cae=()=>{const[n,e]=k.useState([]),i=bl();return k.useEffect(()=>{let o=!0,l=null;const u=()=>{window.unityInstance&&(H.log("Requesting fresh player list"),window.unityInstance.SendMessage("NetworkManager","RequestPlayerList"))},f=L=>{if(o){H.log("UpdatePlayerList unity message received.");try{let M=[];if(typeof L=="object"&&L!==null?M=L.players||[]:M=JSON.parse(L).players||[],Array.isArray(M)){const F=Array.from(new Map(M.map(B=>[B.playerId,B])).values());e(F),l&&(clearTimeout(l),l=null)}}catch(M){H.error("Error handling player list data:",M),l||(l=setTimeout(u,1e3))}}},_=()=>{H.log("Player disconnected, requesting fresh player list"),u()},E=()=>{H.log("Player left, requesting fresh player list"),u()};u();const b=i("UpdatePlayerList",f),C=i("PlayerDisconnected",_),I=i("PlayerLeft",E),P=setInterval(u,5e3);return()=>{o=!1,l&&clearTimeout(l),typeof b=="function"&&b(),typeof C=="function"&&C(),typeof I=="function"&&I(),clearInterval(P)}},[i]),n},lae=()=>{const n=uc(),{isLoaded:e}=ea(),[i,o]=k.useState(!1);k.useEffect(()=>{if(window.isPlayerInstantiated){H.log("usePlacePrefab: Unity already ready (via window flag)"),o(!0);return}const f=()=>{H.log("usePlacePrefab: Unity is now ready (PlayerInstantiated event)"),o(!0)};return window.addEventListener("PlayerInstantiated",f),()=>{window.removeEventListener("PlayerInstantiated",f)}},[]);const l=k.useCallback((f,_,E,b)=>{const C=_||{x:0,y:1,z:0},I=E||{x:0,y:0,z:0},P=b||{x:1,y:1,z:1};try{const L={prefabName:f||"TestPrefab",position:C,rotation:I,scale:P};return H.log("Sending prefab placement to Unity:",L),n("PlacePrefab",L),!0}catch(L){return H.error("Error placing prefab:",L),!1}},[n]),u=k.useCallback((f,_,E,b)=>{const C=_||{x:0,y:1,z:0},I=E||{x:0,y:0,z:0},P=b||{x:1,y:1,z:1};if(!window.unityInstance)return H.error("Unity not loaded, cannot place prefab directly"),!1;try{const L={prefabName:f||"TestPrefab",position:C,rotation:I,scale:P},M={eventName:"PlacePrefab",data:JSON.stringify(L)};return H.log("Directly sending prefab placement to Unity:",L),window.unityInstance.SendMessage("ReactIncomingEvent","HandleEvent",JSON.stringify(M)),!0}catch(L){return H.error("Error directly placing prefab:",L),!1}},[]);return{placePrefab:l,directPlacePrefab:u,isUnityLoaded:i&&e}},uae=()=>{const n=uc(),e=k.useCallback((o,l,u,f,_,E)=>{const b=u||{x:0,y:1.5,z:0},C=f||{x:0,y:0,z:0},I=_||{x:1,y:1,z:1};try{const P={portalId:o,prefabName:l||"PortalObjectPrefab",position:b,rotation:C,scale:I,initialImageUrl:E};return H.log("Sending portal placement to Unity:",P),n("PlacePortalPrefab",P),!0}catch(P){return H.error("Error placing portal:",P),!1}},[n]),i=k.useCallback((o,l,u,f,_,E)=>{const b=u||{x:0,y:1.5,z:0},C=f||{x:0,y:0,z:0},I=_||{x:1,y:1,z:1};try{const P={portalId:o,prefabName:l||"PortalObjectPrefab",position:b,rotation:C,scale:I,initialImageUrl:E},L={eventName:"PlacePortalPrefab",data:JSON.stringify(P)};return H.log("Directly sending portal placement to Unity:",P),window.unityInstance.SendMessage("ReactIncomingEvent","HandleEvent",JSON.stringify(L)),!0}catch(P){return H.error("Error directly placing portal:",P),!1}},[]);return{placePortal:e,directPlacePortal:i,isUnityLoaded:!0}},dae=()=>{const n=uc(),e=k.useCallback((o,l,u,f,_)=>{const E=u||{x:0,y:0,z:0},b=f||{x:0,y:0,z:0},C=_||{x:1,y:1,z:1};try{const I={hotspotId:o,glbUrl:l,position:E,rotation:b,scale:C};return H.log("Sending seating hotspot placement to Unity:",I),n("SeatingHotspot",I),!0}catch(I){return H.error("Error placing seating hotspot:",I),!1}},[n]),i=k.useCallback((o,l,u,f,_)=>{const E=u||{x:0,y:0,z:0},b=f||{x:0,y:0,z:0},C=_||{x:1,y:1,z:1};try{const I={hotspotId:o,glbUrl:l,position:E,rotation:b,scale:C},P={eventName:"SeatingHotspot",data:JSON.stringify(I)};return H.log("Directly sending seating hotspot placement to Unity:",I),window.unityInstance.SendMessage("ReactIncomingEvent","HandleEvent",JSON.stringify(P)),!0}catch(I){return H.error("Error directly placing seating hotspot:",I),!1}},[]);return{placeCatalogueItem:e,directPlaceCatalogueItem:i,isUnityLoaded:!0}},Nze=n=>{const[e,i]=k.useState(null),o=bl(),{spaceID:l}=ea();return k.useEffect(()=>{let f=!0;const E=o("PlayVideo",async b=>{try{const{gameObjectName:C}=b;if(!C){H.error("Game object name is missing in Unity event data.");return}const I=await joe(l);H.log("SPACES VIDEOS",I);const P=I.find(L=>L.id===C);P&&f?(i(P.url),H.log("Video URL set to:",P.url)):console.error("Video not found for game object:",C)}catch(C){console.error("Error fetching space videos:",C)}});return()=>{f=!1,E()}},[o,l,n]),[e,()=>{i(null)}]};let tk;const Dze=new Uint8Array(16);function xze(){if(!tk&&(tk=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!tk))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return tk(Dze)}const Ia=[];for(let n=0;n<256;++n)Ia.push((n+256).toString(16).slice(1));function Lze(n,e=0){return Ia[n[e+0]]+Ia[n[e+1]]+Ia[n[e+2]]+Ia[n[e+3]]+"-"+Ia[n[e+4]]+Ia[n[e+5]]+"-"+Ia[n[e+6]]+Ia[n[e+7]]+"-"+Ia[n[e+8]]+Ia[n[e+9]]+"-"+Ia[n[e+10]]+Ia[n[e+11]]+Ia[n[e+12]]+Ia[n[e+13]]+Ia[n[e+14]]+Ia[n[e+15]]}const Mze=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),BQ={randomUUID:Mze};function Uze(n,e,i){if(BQ.randomUUID&&!n)return BQ.randomUUID();n=n||{};const o=n.random||(n.rng||xze)();return o[6]=o[6]&15|64,o[8]=o[8]&63|128,Lze(o)}const $N="spaces",KN="objects",Vze=async(n,e,i)=>{try{const o=dr(Dn,$N,n,KN,e),l={...i,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),spaceId:n,objectId:e};return await qg(o,l),H.log(`Saved object ${e} to space ${n}`),!0}catch(o){return H.error("Error saving object to space:",o),!1}},WQ=async n=>{try{const e=Sl(Dn,$N,n,KN),i=await ed(e),o=[];return i.forEach(l=>{o.push({id:l.id,...l.data()})}),H.log(`Retrieved ${o.length} objects for space ${n}`),o}catch(e){return H.error("Error getting space objects:",e),[]}},jze=async(n,e)=>{try{const i=dr(Dn,$N,n,KN,e);return await FBe(i),H.log(`Deleted object ${e} from space ${n}`),!0}catch(i){return H.error("Error deleting space object:",i),!1}},Fze=async(n,e,i)=>{try{const o=dr(Dn,$N,n,KN,e),l={...i,updatedAt:new Date().toISOString()};return await ms(o,l),H.log(`Updated object ${e} in space ${n}`),!0}catch(o){return H.error("Error updating space object:",o),!1}},Bze=n=>{const[e,i]=k.useState([]),[o,l]=k.useState(!0),{placePrefab:u,isUnityLoaded:f}=lae();k.useEffect(()=>{(async()=>{if(H.log(`useSpaceObjects: loadObjects called for spaceId: ${n}`),!n){H.log("useSpaceObjects: No spaceId provided, skipping loadObjects."),l(!1);return}H.log(`useSpaceObjects: Setting isLoading to true for spaceId: ${n}`),l(!0);try{H.log(`useSpaceObjects: Attempting to getSpaceObjects for spaceId: ${n}`);const P=await WQ(n);H.log(`useSpaceObjects: Got ${(P==null?void 0:P.length)||0} objects for spaceId: ${n}`,P),i(P),H.log(`useSpaceObjects: Attempting to place ${(P==null?void 0:P.length)||0} objects in Unity for spaceId: ${n}`),P&&P.length>0?(P.forEach((L,M)=>{H.log(`useSpaceObjects: Placing object ${M+1}/${P.length}: ${L.prefabName} (ID: ${L.id||L.objectId})`,L),u(L.prefabName,L.position,L.rotation,L.scale)}),H.log(`useSpaceObjects: Finished placing objects in Unity for spaceId: ${n}`)):H.log(`useSpaceObjects: No objects to place in Unity for spaceId: ${n}`)}catch(P){H.error(`useSpaceObjects: Error in loadObjects for spaceId: ${n}:`,P)}finally{H.log(`useSpaceObjects: Setting isLoading to false in finally block for spaceId: ${n}`),l(!1)}})()},[n,u]);const _=k.useCallback(async(I,P,L,M,F={})=>{if(!n)return!1;const B=Uze(),Z={prefabName:I,position:P,rotation:L,scale:M,objectId:B,...F};H.log("useSpaceObjects: Saving object with data:",Z);const K=await Vze(n,B,Z);return K?(i(re=>[...re,{id:B,...Z}]),H.log("useSpaceObjects: Object saved successfully, local state updated.",{objectId:B})):H.error("useSpaceObjects: Failed to save object to Firestore.",{spaceId:n,objectId:B,prefabName:I}),K},[n]),E=k.useCallback(async I=>{if(!n)return!1;const P=await jze(n,I);return P&&i(L=>L.filter(M=>M.id!==I)),P},[n]),b=k.useCallback(async(I,P)=>{if(!n)return!1;const L=await Fze(n,I,P);return L&&i(M=>M.map(F=>F.id===I?{...F,...P}:F)),L},[n]),C=k.useCallback(async()=>{if(n){l(!0);try{const I=await WQ(n);i(I),I.forEach(P=>{u(P.prefabName,P.position,P.rotation,P.scale)})}catch(I){H.error("Error reloading space objects:",I)}finally{l(!1)}}},[n,u]);return{objects:e,isLoading:o,saveObject:_,deleteObject:E,updateObject:b,reloadObjects:C,isUnityLoaded:f}},Wze=()=>{const[n,e]=k.useState(null),[i,o]=k.useState(!1),[l,u]=k.useState(null),f=bl(),_=uc();k.useEffect(()=>f("KickPlayerResult",I=>{H.log("KickPlayerResult event received:",I),I?(e(I),o(!1),I.success?u(null):u(I.errorMessage||"Failed to kick player")):(H.error("Invalid KickPlayerResult data from Unity"),u("Invalid result from Unity"),o(!1))}),[f]);const E=k.useCallback((C,I)=>{var P;try{if(!C){u("Player UID is required");return}o(!0),u(null),e(null);const L={uid:C,requestedBy:I||((P=window.currentUser)==null?void 0:P.uid)};H.log("Sending KickPlayer event to Unity:",L),_("KickPlayer",L)}catch(L){H.error("Error kicking player:",L),u(L.message||"Failed to send kick request"),o(!1)}},[_]),b=k.useCallback(()=>{e(null),u(null),o(!1)},[]);return{kickPlayer:E,isKicking:i,kickResult:n,error:l,resetKickState:b}},zze=n=>{const{placePortal:e}=uae();k.useEffect(()=>{const i=async()=>{try{const o=Sl(Dn,"spaces",n,"portals"),l=await ed(o);if(l.empty){H.log("useSpacePortals: No portals found for space:",n);return}H.log(`useSpacePortals: Found ${l.size} portals for space ${n}`),l.forEach(u=>{const f=u.data();H.log(`useSpacePortals: Placing portal ${f.portalId} in Unity:`,f),e(f.portalId,f.prefabName,f.position,f.rotation,f.scale)})}catch(o){H.error("useSpacePortals: Error loading portals:",o)}};if(window.unityInstance)H.log("useSpacePortals: Unity is ready, loading portals"),i();else{const o=()=>{H.log("useSpacePortals: Unity ready event received, loading portals"),i()};return window.addEventListener("PlayerInstantiated",o),()=>{window.removeEventListener("PlayerInstantiated",o)}}},[n,e])},Gze=()=>{const[n,e]=k.useState(null),i=bl();return k.useEffect(()=>{console.log("Setting up portal click listener...");const u=i("PortalClicked",f=>{console.log("Portal click event received:",f);try{const _=typeof f=="string"?JSON.parse(f):f;console.log("Parsed portal data:",_),e(_)}catch(_){console.error("Error parsing portal click data:",_,"Data:",f)}});return()=>{console.log("Cleaning up portal click listener"),typeof u=="function"&&u()}},[i]),{clickedPortal:n,clearClickedPortal:()=>{console.log("Clearing clicked portal state"),e(null)}}},Hze=()=>{const n=bl();k.useEffect(()=>{console.log("Setting up portal navigation listener...");const i=n("PortalNavigate",o=>{console.log(" PORTAL CLICKED BY PLAYER (non-edit mode)");try{const l=typeof o=="string"?JSON.parse(o):o;console.log("Portal data:",l);const u=l.portalId.split("_");if(u.length>=3){const f=u[2];console.log("Navigating to space:",f),window.location.href=`/?spaceId=${f}`}else console.error("Invalid portal ID format:",l.portalId)}catch(l){console.error("Error handling portal navigation:",l)}});return()=>{console.log("Cleaning up portal navigation listener"),typeof i=="function"&&i()}},[n])},$ze=n=>{const{placeCatalogueItem:e}=dae();k.useEffect(()=>{const i=async()=>{try{const o=Sl(Dn,"spaces",n,"catalogue"),l=await ed(o);if(l.empty){H.log("useSpaceCatalogueItems: No catalogue items found for space:",n);return}H.log(`useSpaceCatalogueItems: Found ${l.size} items for space ${n}`),l.forEach(u=>{const f=u.data();H.log(`useSpaceCatalogueItems: Placing item ${f.itemId} in Unity:`,f),e(f.itemId,f.glbUrl,f.position,f.rotation,f.scale)})}catch(o){H.error("useSpaceCatalogueItems: Error loading catalogue items:",o)}};if(window.unityInstance)H.log("useSpaceCatalogueItems: Unity is ready, loading catalogue items"),i();else{const o=()=>{H.log("useSpaceCatalogueItems: Unity ready event received, loading catalogue items"),i()};return window.addEventListener("PlayerInstantiated",o),()=>{window.removeEventListener("PlayerInstantiated",o)}}},[n,e])},hae=()=>{const[n,e]=k.useState(null),i=bl();return k.useEffect(()=>{H.log("Setting up seating hotspot click listener...");const u=i("SeatingHotspotClicked",async f=>{H.log(" Seating hotspot click event received from Unity:",f);try{const _=typeof f=="string"?JSON.parse(f):f;H.log(" Parsed Unity click data:",_);const E=_.hotspotId.split("_");if(E.length>=3){const b=E.slice(1,-1).join("_");H.log(" Extracted spaceId:",b);const C=dr(Dn,"spaces",b,"catalogue",_.hotspotId);H.log(" Fetching from Firebase path:",`spaces/${b}/catalogue/${_.hotspotId}`);const I=await _o(C);if(I.exists()){const P=I.data();H.log(" Fetched Firebase data:",P),H.log(" Firebase position:",P.position),H.log(" Unity position:",_.position);const L={..._,position:P.position||_.position,rotation:P.rotation||_.rotation,scale:P.scale||_.scale};H.log(" Combined data being set:",L),e(L)}else H.warn(" Item not found in Firebase:",_.hotspotId),e(_)}else H.error(" Invalid hotspot ID format:",_.hotspotId),e(_)}catch(_){H.error(" Error handling seating hotspot click:",_,"Data:",f)}});return()=>{H.log("Cleaning up seating hotspot click listener"),typeof u=="function"&&u()}},[i]),{clickedItem:n,clearClickedItem:()=>{H.log("Clearing clicked item state"),e(null)}}},Kze=n=>({opacity:1});function qze(){const{loadingProgression:n,isLoaded:e,error:i}=ea(),{user:o}=k.useContext(Uo),[l,u]=k.useState(!1),[f,_]=k.useState(!1),[E,b]=k.useState(!1),[C,I]=k.useState(!1),P=k.useRef(!1),L=k.useRef(!1),M=k.useRef(null),F=k.useRef(null),B=k.useRef(null),Z=bl(),K=k.useRef(null),re=k.useRef(null),ae=k.useRef(null);k.useRef(null),k.useEffect(()=>{u(!o&&n===0)},[o,n]),k.useEffect(()=>{const X=document.createElement("style");return X.textContent=`
      /* Set initial Unity canvas styles */
      #unity-canvas, #unity-container {
        opacity: 0 !important;
        transition: opacity 1s ease-in-out;
        z-index: 1 !important; /* Ensure Unity is below our loader */
      }
      
      /* Loader overlay styles */
      .loader-overlay {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        z-index: 99999 !important; /* Extremely high z-index */
        display: flex;
        align-items: center;
        justify-content: center;
        transition: opacity 1.5s ease-in-out;
        pointer-events: auto !important;
        transform: translateZ(0); /* Create stacking context */
      }
      
      /* Loader content styles */
      .loader-content {
        background-color: rgba(0, 0, 0, 0.8);
        padding: 1rem;
        border-radius: 0.5rem;
        color: white;
        text-align: center;
        z-index: 100000 !important; /* Even higher z-index */
      }
    `,document.head.appendChild(X),K.current=X,()=>{K.current&&document.head.removeChild(K.current)}},[]),k.useEffect(()=>{const X=()=>{const J=document.getElementById("unity-canvas"),Y=document.getElementById("unity-container");J&&(M.current=J,J.style.zIndex="1"),Y&&(F.current=Y,Y.style.zIndex="1"),J&&Y&&ae.current&&(clearInterval(ae.current),ae.current=null)};return X(),ae.current=setInterval(X,100),()=>{ae.current&&(clearInterval(ae.current),ae.current=null)}},[]),k.useEffect(()=>{window.isFirstSceneLoaded&&(L.current=!0,I(!0));const J=Z("FirstSceneLoaded",()=>{L.current=!0,I(!0),window.isFirstSceneLoaded=!0}),Y=setTimeout(()=>{L.current||(L.current=!0,I(!0),window.isFirstSceneLoaded=!0)},1e4);return()=>{J(),clearTimeout(Y)}},[Z]),k.useEffect(()=>{window.isPlayerInstantiated&&(P.current=!0,b(!0),L.current||(L.current=!0,I(!0),window.isFirstSceneLoaded=!0));const X=()=>{P.current=!0,b(!0),L.current||(L.current=!0,I(!0),window.isFirstSceneLoaded=!0)};window.addEventListener("PlayerInstantiated",X);const J=Z("PlayerInstantiated",X),Y=setTimeout(()=>{P.current||(P.current=!0,b(!0),L.current||(L.current=!0,I(!0),window.isFirstSceneLoaded=!0))},2e4);return()=>{window.removeEventListener("PlayerInstantiated",X),J(),clearTimeout(Y)}},[Z]),k.useEffect(()=>(C&&E&&(console.log("LoaderProgress: Both conditions met, showing Unity canvas"),re.current&&clearTimeout(re.current),re.current=setTimeout(()=>{M.current&&(M.current.style.opacity="1",M.current.style.removeProperty("opacity")),F.current&&(F.current.style.opacity="1",F.current.style.removeProperty("opacity")),B.current&&(B.current.style.opacity="0",B.current.style.pointerEvents="none",setTimeout(()=>{B.current&&(B.current.style.display="none")},1500))},2e3)),()=>{re.current&&clearTimeout(re.current)}),[C,E]);const ne=()=>e?e&&!C&&!E?"Scene initializing":C&&!E?"Player initializing":"Ready":"World loading",pe=()=>e?e&&!C&&!E?85:C&&!E?95:100:n*80;return S.jsx(S.Fragment,{children:l?S.jsx(ct,{position:"absolute",zIndex:"99999",width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",style:{transform:"translateZ(0)"},children:S.jsxs(Fr,{spacing:4,padding:6,borderRadius:"md",backgroundColor:"rgba(0, 0, 0, 0.8)",color:"white",children:[S.jsx(tt,{fontSize:"xl",fontWeight:"bold",children:"Sign In Required"}),S.jsx(tt,{textAlign:"center",children:"Please sign in to enter The Disruptive Spaces"}),S.jsx(jn,{colorScheme:"blue",size:"lg",width:"200px",onClick:()=>_(!0),children:"Sign In"})]})}):S.jsx(ct,{ref:B,className:"loader-overlay",style:{transform:"translateZ(0)",zIndex:99999},children:S.jsxs(Cr,{className:"loader-content",flexDirection:"column",alignItems:"center",width:"300px",style:{zIndex:1e5},children:[S.jsx(tt,{fontWeight:"bold",children:"Entering The Spaces Metaverse"}),S.jsx(tt,{fontSize:"sm",children:ne()}),S.jsx(Ky,{value:pe(),size:"lg",width:"100%",marginY:2})]})})})}function Yze(){const{user:n}=k.useContext(Uo);return S.jsx("div",{children:n!==null?S.jsx("div",{children:S.jsx(P3,{})}):S.jsxs("div",{children:[S.jsx(GN,{}),S.jsx(HN,{})]})})}function Xze(){const{fullscreenRef:n}=Zd(),[e,i]=k.useState(!1),o=()=>{i(!e)};return S.jsxs(S.Fragment,{children:[S.jsx(Kf,{label:"Help",hasArrow:!0,placement:"top",closeOnClick:!0,portalProps:{containerRef:n},children:S.jsx(Do,{"aria-label":"Controller Help",icon:S.jsx(kWe,{}),onClick:o,variant:"iconButton"})}),S.jsxs(hs,{isOpen:e,onClose:o,size:"md",portalProps:{containerRef:n},children:[S.jsx(fs,{}),S.jsxs(ps,{children:[S.jsx(yo,{children:"Notes"}),S.jsx($s,{}),S.jsx(bs,{children:S.jsx(tt,{variant:"formIntro",children:"The help button is showing so we can see the blur and transparency styles on the button."})}),S.jsx(Cp,{children:S.jsx(jn,{variant:"primary",onClick:o,children:"Close"})})]})]})]})}var pae={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},zQ=gi.createContext&&gi.createContext(pae),Vg=function(){return Vg=Object.assign||function(n){for(var e,i=1,o=arguments.length;i<o;i++){e=arguments[i];for(var l in e)Object.prototype.hasOwnProperty.call(e,l)&&(n[l]=e[l])}return n},Vg.apply(this,arguments)},Jze=function(n,e){var i={};for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&e.indexOf(o)<0&&(i[o]=n[o]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var l=0,o=Object.getOwnPropertySymbols(n);l<o.length;l++)e.indexOf(o[l])<0&&Object.prototype.propertyIsEnumerable.call(n,o[l])&&(i[o[l]]=n[o[l]]);return i};function fae(n){return n&&n.map(function(e,i){return gi.createElement(e.tag,Vg({key:i},e.attr),fae(e.child))})}function xr(n){return function(e){return gi.createElement(Qze,Vg({attr:Vg({},n.attr)},e),fae(n.child))}}function Qze(n){var e=function(i){var o=n.attr,l=n.size,u=n.title,f=Jze(n,["attr","size","title"]),_=l||i.size||"1em",E;return i.className&&(E=i.className),n.className&&(E=(E?E+" ":"")+n.className),gi.createElement("svg",Vg({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},i.attr,o,f,{className:E,style:Vg(Vg({color:n.color||i.color},i.style),n.style),height:_,width:_,xmlns:"http://www.w3.org/2000/svg"}),u&&gi.createElement("title",null,u),n.children)};return zQ!==void 0?gi.createElement(zQ.Consumer,null,function(i){return e(i)}):e(pae)}function mae(n){return xr({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"}}]})(n)}function GQ(n){return xr({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M173.898 439.404l-166.4-166.4c-9.997-9.997-9.997-26.206 0-36.204l36.203-36.204c9.997-9.998 26.207-9.998 36.204 0L192 312.69 432.095 72.596c9.997-9.997 26.207-9.997 36.204 0l36.203 36.204c9.997 9.997 9.997 26.206 0 36.204l-294.4 294.401c-9.998 9.997-26.207 9.997-36.204-.001z"}}]})(n)}function HQ(n){return xr({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M320 448v40c0 13.255-10.745 24-24 24H24c-13.255 0-24-10.745-24-24V120c0-13.255 10.745-24 24-24h72v296c0 30.879 25.121 56 56 56h168zm0-344V0H152c-13.255 0-24 10.745-24 24v368c0 13.255 10.745 24 24 24h272c13.255 0 24-10.745 24-24V128H344c-13.2 0-24-10.8-24-24zm120.971-31.029L375.029 7.029A24 24 0 0 0 358.059 0H352v96h96v-6.059a24 24 0 0 0-7.029-16.97z"}}]})(n)}function Dj(n){return xr({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M528 448H112c-8.8 0-16 7.2-16 16v32c0 8.8 7.2 16 16 16h416c8.8 0 16-7.2 16-16v-32c0-8.8-7.2-16-16-16zm64-320c-26.5 0-48 21.5-48 48 0 7.1 1.6 13.7 4.4 19.8L476 239.2c-15.4 9.2-35.3 4-44.2-11.6L350.3 85C361 76.2 368 63 368 48c0-26.5-21.5-48-48-48s-48 21.5-48 48c0 15 7 28.2 17.7 37l-81.5 142.6c-8.9 15.6-28.9 20.8-44.2 11.6l-72.3-43.4c2.7-6 4.4-12.7 4.4-19.8 0-26.5-21.5-48-48-48S0 149.5 0 176s21.5 48 48 48c2.6 0 5.2-.4 7.7-.8L128 416h384l72.3-192.8c2.5.4 5.1.8 7.7.8 26.5 0 48-21.5 48-48s-21.5-48-48-48z"}}]})(n)}function Zze(n){return xr({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M488.6 250.2L392 214V105.5c0-15-9.3-28.4-23.4-33.7l-100-37.5c-8.1-3.1-17.1-3.1-25.3 0l-100 37.5c-14.1 5.3-23.4 18.7-23.4 33.7V214l-96.6 36.2C9.3 255.5 0 268.9 0 283.9V394c0 13.6 7.7 26.1 19.9 32.2l100 50c10.1 5.1 22.1 5.1 32.2 0l103.9-52 103.9 52c10.1 5.1 22.1 5.1 32.2 0l100-50c12.2-6.1 19.9-18.6 19.9-32.2V283.9c0-15-9.3-28.4-23.4-33.7zM358 214.8l-85 31.9v-68.2l85-37v73.3zM154 104.1l102-38.2 102 38.2v.6l-102 41.4-102-41.4v-.6zm84 291.1l-85 42.5v-79.1l85-38.8v75.4zm0-112l-102 41.4-102-41.4v-.6l102-38.2 102 38.2v.6zm240 112l-85 42.5v-79.1l85-38.8v75.4zm0-112l-102 41.4-102-41.4v-.6l102-38.2 102 38.2v.6z"}}]})(n)}function e8e(n){return xr({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M402.6 83.2l90.2 90.2c3.8 3.8 3.8 10 0 13.8L274.4 405.6l-92.8 10.3c-12.4 1.4-22.9-9.1-21.5-21.5l10.3-92.8L388.8 83.2c3.8-3.8 10-3.8 13.8 0zm162-22.9l-48.8-48.8c-15.2-15.2-39.9-15.2-55.2 0l-35.4 35.4c-3.8 3.8-3.8 10 0 13.8l90.2 90.2c3.8 3.8 10 3.8 13.8 0l35.4-35.4c15.2-15.3 15.2-40 0-55.2zM384 346.2V448H64V128h229.8c3.2 0 6.2-1.3 8.5-3.5l40-40c7.6-7.6 2.2-20.5-8.5-20.5H48C21.5 64 0 85.5 0 112v352c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V306.2c0-10.7-12.9-16-20.5-8.5l-40 40c-2.2 2.3-3.5 5.3-3.5 8.5z"}}]})(n)}function t8e(n){return xr({attr:{viewBox:"0 0 192 512"},child:[{tag:"path",attr:{d:"M96 184c39.8 0 72 32.2 72 72s-32.2 72-72 72-72-32.2-72-72 32.2-72 72-72zM24 80c0 39.8 32.2 72 72 72s72-32.2 72-72S135.8 8 96 8 24 40.2 24 80zm0 352c0 39.8 32.2 72 72 72s72-32.2 72-72-32.2-72-72-72-72 32.2-72 72z"}}]})(n)}function n8e(n){return xr({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M480.07 96H160a160 160 0 1 0 114.24 272h91.52A160 160 0 1 0 480.07 96zM248 268a12 12 0 0 1-12 12h-52v52a12 12 0 0 1-12 12h-24a12 12 0 0 1-12-12v-52H84a12 12 0 0 1-12-12v-24a12 12 0 0 1 12-12h52v-52a12 12 0 0 1 12-12h24a12 12 0 0 1 12 12v52h52a12 12 0 0 1 12 12zm216 76a40 40 0 1 1 40-40 40 40 0 0 1-40 40zm64-96a40 40 0 1 1 40-40 40 40 0 0 1-40 40z"}}]})(n)}function gae(n){return xr({attr:{viewBox:"0 0 496 512"},child:[{tag:"path",attr:{d:"M336.5 160C322 70.7 287.8 8 248 8s-74 62.7-88.5 152h177zM152 256c0 22.2 1.2 43.5 3.3 64h185.3c2.1-20.5 3.3-41.8 3.3-64s-1.2-43.5-3.3-64H155.3c-2.1 20.5-3.3 41.8-3.3 64zm324.7-96c-28.6-67.9-86.5-120.4-158-141.6 24.4 33.8 41.2 84.7 50 141.6h108zM177.2 18.4C105.8 39.6 47.8 92.1 19.3 160h108c8.7-56.9 25.5-107.8 49.9-141.6zM487.4 192H372.7c2.1 21 3.3 42.5 3.3 64s-1.2 43-3.3 64h114.6c5.5-20.5 8.6-41.8 8.6-64s-3.1-43.5-8.5-64zM120 256c0-21.5 1.2-43 3.3-64H8.6C3.2 212.5 0 233.8 0 256s3.2 43.5 8.6 64h114.6c-2-21-3.2-42.5-3.2-64zm39.5 96c14.5 89.3 48.7 152 88.5 152s74-62.7 88.5-152h-177zm159.3 141.6c71.4-21.2 129.4-73.7 158-141.6h-108c-8.8 56.9-25.6 107.8-50 141.6zM19.3 352c28.6 67.9 86.5 120.4 158 141.6-24.4-33.8-41.2-84.7-50-141.6h-108z"}}]})(n)}function r8e(n){return xr({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M256 8C119.043 8 8 119.083 8 256c0 136.997 111.043 248 248 248s248-111.003 248-248C504 119.083 392.957 8 256 8zm0 110c23.196 0 42 18.804 42 42s-18.804 42-42 42-42-18.804-42-42 18.804-42 42-42zm56 254c0 6.627-5.373 12-12 12h-88c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h12v-64h-12c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h64c6.627 0 12 5.373 12 12v100h12c6.627 0 12 5.373 12 12v24z"}}]})(n)}function i8e(n){return xr({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M528 448H48c-26.51 0-48-21.49-48-48V112c0-26.51 21.49-48 48-48h480c26.51 0 48 21.49 48 48v288c0 26.51-21.49 48-48 48zM128 180v-40c0-6.627-5.373-12-12-12H76c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm-336 96v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm-336 96v-40c0-6.627-5.373-12-12-12H76c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm288 0v-40c0-6.627-5.373-12-12-12H172c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h232c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12z"}}]})(n)}function xj(n){return xr({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M633.82 458.1l-157.8-121.96C488.61 312.13 496 285.01 496 256v-48c0-8.84-7.16-16-16-16h-16c-8.84 0-16 7.16-16 16v48c0 17.92-3.96 34.8-10.72 50.2l-26.55-20.52c3.1-9.4 5.28-19.22 5.28-29.67V96c0-53.02-42.98-96-96-96s-96 42.98-96 96v45.36L45.47 3.37C38.49-2.05 28.43-.8 23.01 6.18L3.37 31.45C-2.05 38.42-.8 48.47 6.18 53.9l588.36 454.73c6.98 5.43 17.03 4.17 22.46-2.81l19.64-25.27c5.41-6.97 4.16-17.02-2.82-22.45zM400 464h-56v-33.77c11.66-1.6 22.85-4.54 33.67-8.31l-50.11-38.73c-6.71.4-13.41.87-20.35.2-55.85-5.45-98.74-48.63-111.18-101.85L144 241.31v6.85c0 89.64 63.97 169.55 152 181.69V464h-56c-8.84 0-16 7.16-16 16v16c0 8.84 7.16 16 16 16h160c8.84 0 16-7.16 16-16v-16c0-8.84-7.16-16-16-16z"}}]})(n)}function Lj(n){return xr({attr:{viewBox:"0 0 352 512"},child:[{tag:"path",attr:{d:"M176 352c53.02 0 96-42.98 96-96V96c0-53.02-42.98-96-96-96S80 42.98 80 96v160c0 53.02 42.98 96 96 96zm160-160h-16c-8.84 0-16 7.16-16 16v48c0 74.8-64.49 134.82-140.79 127.38C96.71 376.89 48 317.11 48 250.3V208c0-8.84-7.16-16-16-16H16c-8.84 0-16 7.16-16 16v40.16c0 89.64 63.97 169.55 152 181.69V464H96c-8.84 0-16 7.16-16 16v16c0 8.84 7.16 16 16 16h160c8.84 0 16-7.16 16-16v-16c0-8.84-7.16-16-16-16h-56v-33.77C285.71 418.47 352 344.9 352 256v-48c0-8.84-7.16-16-16-16z"}}]})(n)}function s8e(n){return xr({attr:{viewBox:"0 0 384 512"},child:[{tag:"path",attr:{d:"M0 352a160 160 0 0 0 160 160h64a160 160 0 0 0 160-160V224H0zM176 0h-16A160 160 0 0 0 0 160v32h176zm48 0h-16v192h176v-32A160 160 0 0 0 224 0z"}}]})(n)}function o8e(n){return xr({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M416 208H272V64c0-17.67-14.33-32-32-32h-32c-17.67 0-32 14.33-32 32v144H32c-17.67 0-32 14.33-32 32v32c0 17.67 14.33 32 32 32h144v144c0 17.67 14.33 32 32 32h32c17.67 0 32-14.33 32-32V304h144c17.67 0 32-14.33 32-32v-32c0-17.67-14.33-32-32-32z"}}]})(n)}function a8e(n){return xr({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M466.5 83.7l-192-80a48.15 48.15 0 0 0-36.9 0l-192 80C27.7 91.1 16 108.6 16 128c0 198.5 114.5 335.7 221.5 380.3 11.8 4.9 25.1 4.9 36.9 0C360.1 472.6 496 349.3 496 128c0-19.4-11.7-36.9-29.5-44.3zM256.1 446.3l-.1-381 175.9 73.3c-3.3 151.4-82.1 261.1-175.8 307.7z"}}]})(n)}function Mj(n){return xr({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M259.3 17.8L194 150.2 47.9 171.5c-26.2 3.8-36.7 36.1-17.7 54.6l105.7 103-25 145.5c-4.5 26.3 23.2 46 46.4 33.7L288 439.6l130.7 68.7c23.2 12.2 50.9-7.4 46.4-33.7l-25-145.5 105.7-103c19-18.5 8.5-50.8-17.7-54.6L382 150.2 316.7 17.8c-11.7-23.6-45.6-23.9-57.4 0z"}}]})(n)}function c8e(n){return xr({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M624 208H432c-8.8 0-16 7.2-16 16v32c0 8.8 7.2 16 16 16h192c8.8 0 16-7.2 16-16v-32c0-8.8-7.2-16-16-16zm-400 48c70.7 0 128-57.3 128-128S294.7 0 224 0 96 57.3 96 128s57.3 128 128 128zm89.6 32h-16.7c-22.2 10.2-46.9 16-72.9 16s-50.6-5.8-72.9-16h-16.7C60.2 288 0 348.2 0 422.4V464c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48v-41.6c0-74.2-60.2-134.4-134.4-134.4z"}}]})(n)}function l8e(n){return xr({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M96 224c35.3 0 64-28.7 64-64s-28.7-64-64-64-64 28.7-64 64 28.7 64 64 64zm448 0c35.3 0 64-28.7 64-64s-28.7-64-64-64-64 28.7-64 64 28.7 64 64 64zm32 32h-64c-17.6 0-33.5 7.1-45.1 18.6 40.3 22.1 68.9 62 75.1 109.4h66c17.7 0 32-14.3 32-32v-32c0-35.3-28.7-64-64-64zm-256 0c61.9 0 112-50.1 112-112S381.9 32 320 32 208 82.1 208 144s50.1 112 112 112zm76.8 32h-8.3c-20.8 10-43.9 16-68.5 16s-47.6-6-68.5-16h-8.3C179.6 288 128 339.6 128 403.2V432c0 26.5 21.5 48 48 48h288c26.5 0 48-21.5 48-48v-28.8c0-63.6-51.6-115.2-115.2-115.2zm-223.7-13.4C161.5 263.1 145.6 256 128 256H64c-35.3 0-64 28.7-64 64v32c0 17.7 14.3 32 32 32h65.9c6.3-47.4 34.9-87.3 75.2-109.4z"}}]})(n)}function u8e(n){return xr({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M215.03 71.05L126.06 160H24c-13.26 0-24 10.74-24 24v144c0 13.25 10.74 24 24 24h102.06l88.97 88.95c15.03 15.03 40.97 4.47 40.97-16.97V88.02c0-21.46-25.96-31.98-40.97-16.97zM461.64 256l45.64-45.64c6.3-6.3 6.3-16.52 0-22.82l-22.82-22.82c-6.3-6.3-16.52-6.3-22.82 0L416 210.36l-45.64-45.64c-6.3-6.3-16.52-6.3-22.82 0l-22.82 22.82c-6.3 6.3-6.3 16.52 0 22.82L370.36 256l-45.63 45.63c-6.3 6.3-6.3 16.52 0 22.82l22.82 22.82c6.3 6.3 16.52 6.3 22.82 0L416 301.64l45.64 45.64c6.3 6.3 16.52 6.3 22.82 0l22.82-22.82c6.3-6.3 6.3-16.52 0-22.82L461.64 256z"}}]})(n)}function d8e(n){return xr({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M634.91 154.88C457.74-8.99 182.19-8.93 5.09 154.88c-6.66 6.16-6.79 16.59-.35 22.98l34.24 33.97c6.14 6.1 16.02 6.23 22.4.38 145.92-133.68 371.3-133.71 517.25 0 6.38 5.85 16.26 5.71 22.4-.38l34.24-33.97c6.43-6.39 6.3-16.82-.36-22.98zM320 352c-35.35 0-64 28.65-64 64s28.65 64 64 64 64-28.65 64-64-28.65-64-64-64zm202.67-83.59c-115.26-101.93-290.21-101.82-405.34 0-6.9 6.1-7.12 16.69-.57 23.15l34.44 33.99c6 5.92 15.66 6.32 22.05.8 83.95-72.57 209.74-72.41 293.49 0 6.39 5.52 16.05 5.13 22.05-.8l34.44-33.99c6.56-6.46 6.33-17.06-.56-23.15z"}}]})(n)}function _ae({open:n,onClose:e}){const i=k.useRef(null),o=uc(),{user:l}=k.useContext(Uo),u=E=>{i.current&&!i.current.contains(E.target)&&e()},f=async E=>{const b=_(E);if((b==null?void 0:b.source)==="readyplayerme"&&(b.eventName==="v1.frame.ready"&&i.current.contentWindow.postMessage(JSON.stringify({target:"readyplayerme",type:"subscribe",eventName:"v1.**"}),"*"),b.eventName==="v1.avatar.exported")){const C=b.data.url;if(console.log(`Avatar URL: ${C}`),o("AvatarUrlFromReact",{url:C}),l&&l.uid)try{await boe(l.uid,C),e()}catch(I){console.error("Error updating RPM URL:",I)}else console.error("No authenticated user found to update rpmURL.")}},_=E=>{try{return JSON.parse(E.data)}catch{return null}};return k.useEffect(()=>(n&&(document.addEventListener("mousedown",u),window.addEventListener("message",f)),()=>{document.removeEventListener("mousedown",u),window.removeEventListener("message",f)}),[n]),n&&S.jsx(ru,{children:S.jsx(ct,{position:"fixed",top:"0",left:"0",width:"100%",height:"100%",bg:"rgba(0, 0, 0, 0.8)",zIndex:1e4,display:"flex",justifyContent:"center",alignItems:"center",onClick:E=>E.stopPropagation(),children:S.jsx(ct,{position:"relative",maxWidth:"1080px",maxHeight:"800px",width:"90%",height:"90%",children:S.jsx("iframe",{ref:i,src:"https://spacesmetaverse.readyplayer.me/avatar?frameApi",title:"Ready Player Me",width:"100%",height:"100%",style:{border:"none",borderRadius:"8px"},allow:"camera *; microphone *; clipboard-write"})})})})}function h8e({isOpen:n,onClose:e}){const[i,o]=k.useState(!1),[l,u]=k.useState(null),{user:f}=k.useContext(Uo),_=uc(),E=M=>{M.stopPropagation(),o(!0)},b=()=>{o(!1),e()},C=async M=>{if(u(M),f&&f.uid)try{await boe(f.uid,M.url),_("AvatarUrlFromReact",{url:M.url}),e()}catch(F){console.error("Error updating RPM URL:",F)}else console.error("No authenticated user found to update rpmURL.")},I=kg("gray.200","whiteAlpha.300"),P="rgba(0, 0, 0, 0.3)",L=[{id:1,url:"https://models.readyplayer.me/67c8408d38f7924e15a8bd0a.glb",name:"Default Avatar 1"},{id:2,url:"https://models.readyplayer.me/67c8576838e3cf57cc697c15.glb",name:"Default Avatar 2"},{id:3,url:"https://models.readyplayer.me/67c884144c4878c55e515ff5.glb",name:"Default Avatar 3"},{id:4,url:"https://models.readyplayer.me/67c885af25f4d62e75c0ff1e.glb",name:"Default Avatar 4"},{id:5,url:"https://models.readyplayer.me/67c8860f4c4878c55e5189b6.glb",name:"Default Avatar 5"},{id:6,url:"https://models.readyplayer.me/67c8869db6d0b438b7abd822.glb",name:"Default Avatar 6"},{id:7,url:"https://models.readyplayer.me/67c886ed28ee0e0bfac89688.glb",name:"Default Avatar 7"},{id:8,url:"https://models.readyplayer.me/67c88731795ea3e2e6ea84db.glb",name:"Default Avatar 8"},{id:9,url:"https://models.readyplayer.me/67c8878b0cdc0f22383f0f8f.glb",name:"Default Avatar 9"}];return S.jsxs(S.Fragment,{children:[S.jsx(ru,{children:S.jsxs(hs,{isOpen:n,onClose:e,isCentered:!0,size:"xl",zIndex:9999,children:[S.jsx(fs,{bg:"rgba(0, 0, 0, 0.7)"}),S.jsxs(ps,{bg:"gray.800",color:"white",maxW:"900px",children:[S.jsx(yo,{fontSize:"lg",children:"Customise Your Avatar"}),S.jsx($s,{color:"white",_hover:{bg:"transparent",color:"whiteAlpha.800"},_focus:{boxShadow:"none"},size:"lg",position:"absolute",right:2,top:2}),S.jsx(bs,{pb:4,children:S.jsxs(Fr,{spacing:4,align:"stretch",children:[S.jsx(tt,{fontSize:"sm",children:"Choose from our collection or create your own unique avatar"}),S.jsxs(Jne,{columns:5,spacing:2,children:[S.jsx(ct,{position:"relative",cursor:"pointer",borderWidth:"2px",borderStyle:"dashed",borderColor:I,borderRadius:"lg",overflow:"hidden",onClick:E,_hover:{bg:P},transition:"all 0.2s",display:"flex",alignItems:"center",justifyContent:"center",aspectRatio:"1",children:S.jsxs(Fr,{spacing:1,children:[S.jsx(vn,{as:o8e,boxSize:4}),S.jsx(tt,{fontSize:"xs",children:"Create Custom Avatar"})]})}),L.map(M=>S.jsxs(ct,{position:"relative",cursor:"pointer",borderWidth:"2px",borderColor:(l==null?void 0:l.id)===M.id?"blue.400":I,borderRadius:"lg",overflow:"hidden",onClick:()=>C(M),_hover:{bg:P},transition:"all 0.2s",aspectRatio:"1",children:[S.jsx(cp,{src:M.url.replace(".glb",".png?scene=fullbody-portrait-closeupfront&w=640&q=75"),alt:M.name,width:"100%",height:"100%",objectFit:"cover"}),S.jsx(ct,{position:"absolute",bottom:"0",left:"0",right:"0",p:1,bg:"rgba(0, 0, 0, 0.7)",children:S.jsx(tt,{fontSize:"xs",children:M.name})})]},M.id))]})]})})]})]})}),i&&S.jsx(_ae,{open:i,onClose:b})]})}function p8e(){const{fullscreenRef:n}=Zd(),[e,i]=k.useState(!1),[o,l]=k.useState(!1),[u,f]=k.useState(!1),[_,E]=k.useState(!1),{user:b}=k.useContext(Uo),[C,I]=k.useState(null),[P,L]=k.useState(!0),M=(K,re)=>!K||!re?"?":`${K.charAt(0)}${re.charAt(0)}`.toUpperCase(),F=async()=>{if(b!=null&&b.uid){L(!0);try{const K=await td(b.uid);I({rpmURL:K.rpmURL?K.rpmURL.replace(".glb",".png?scene=fullbody-portrait-closeupfront&w=640&q=75"):null,firstName:K.firstName,lastName:K.lastName})}catch(K){console.error("Error fetching profile data:",K)}finally{L(!1)}}};k.useEffect(()=>{F()},[b==null?void 0:b.uid]),k.useEffect(()=>{const K=()=>{i(!0)};return window.addEventListener("PlayerInstantiated",K),()=>{window.removeEventListener("PlayerInstantiated",K)}},[]);const B=()=>l(!o),Z=()=>{l(!1),F()};return e?S.jsxs(S.Fragment,{children:[S.jsx(Kf,{label:"Edit Avatar",hasArrow:!0,placement:"top",closeOnClick:!0,isOpen:_,portalProps:{containerRef:n},children:S.jsxs(ct,{position:"relative",onMouseEnter:()=>{f(!0),E(!0)},onMouseLeave:()=>{f(!1),E(!1)},cursor:"pointer",onClick:B,children:[S.jsx(eu,{src:P||C==null?void 0:C.rpmURL,size:"md",borderRadius:"full",bg:"white",name:P?M(C==null?void 0:C.firstName,C==null?void 0:C.lastName):" ",borderWidth:"1px",borderColor:"whiteAlpha.300"}),u&&S.jsx(ct,{position:"absolute",top:"0",left:"0",right:"0",bottom:"0",display:"flex",alignItems:"center",justifyContent:"center",bg:"rgba(0, 0, 0, 0.4)",borderRadius:"full",children:S.jsx(tt,{fontSize:"xs",fontWeight:"bold",color:"white",children:"Edit"})})]})}),S.jsx(h8e,{isOpen:o,onClose:Z})]}):null}function f8e(n){return xr({attr:{viewBox:"0 0 1024 1024"},child:[{tag:"path",attr:{d:"M391 240.9c-.8-6.6-8.9-9.4-13.6-4.7l-43.7 43.7L200 146.3a8.03 8.03 0 0 0-11.3 0l-42.4 42.3a8.03 8.03 0 0 0 0 11.3L280 333.6l-43.9 43.9a8.01 8.01 0 0 0 4.7 13.6L401 410c5.1.6 9.5-3.7 8.9-8.9L391 240.9zm10.1 373.2L240.8 633c-6.6.8-9.4 8.9-4.7 13.6l43.9 43.9L146.3 824a8.03 8.03 0 0 0 0 11.3l42.4 42.3c3.1 3.1 8.2 3.1 11.3 0L333.7 744l43.7 43.7A8.01 8.01 0 0 0 391 783l18.9-160.1c.6-5.1-3.7-9.4-8.8-8.8zm221.8-204.2L783.2 391c6.6-.8 9.4-8.9 4.7-13.6L744 333.6 877.7 200c3.1-3.1 3.1-8.2 0-11.3l-42.4-42.3a8.03 8.03 0 0 0-11.3 0L690.3 279.9l-43.7-43.7a8.01 8.01 0 0 0-13.6 4.7L614.1 401c-.6 5.2 3.7 9.5 8.8 8.9zM744 690.4l43.9-43.9a8.01 8.01 0 0 0-4.7-13.6L623 614c-5.1-.6-9.5 3.7-8.9 8.9L633 783.1c.8 6.6 8.9 9.4 13.6 4.7l43.7-43.7L824 877.7c3.1 3.1 8.2 3.1 11.3 0l42.4-42.3c3.1-3.1 3.1-8.2 0-11.3L744 690.4z"}}]})(n)}function m8e(n){return xr({attr:{viewBox:"0 0 1024 1024"},child:[{tag:"path",attr:{d:"M290 236.4l43.9-43.9a8.01 8.01 0 0 0-4.7-13.6L169 160c-5.1-.6-9.5 3.7-8.9 8.9L179 329.1c.8 6.6 8.9 9.4 13.6 4.7l43.7-43.7L370 423.7c3.1 3.1 8.2 3.1 11.3 0l42.4-42.3c3.1-3.1 3.1-8.2 0-11.3L290 236.4zm352.7 187.3c3.1 3.1 8.2 3.1 11.3 0l133.7-133.6 43.7 43.7a8.01 8.01 0 0 0 13.6-4.7L863.9 169c.6-5.1-3.7-9.5-8.9-8.9L694.8 179c-6.6.8-9.4 8.9-4.7 13.6l43.9 43.9L600.3 370a8.03 8.03 0 0 0 0 11.3l42.4 42.4zM845 694.9c-.8-6.6-8.9-9.4-13.6-4.7l-43.7 43.7L654 600.3a8.03 8.03 0 0 0-11.3 0l-42.4 42.3a8.03 8.03 0 0 0 0 11.3L734 787.6l-43.9 43.9a8.01 8.01 0 0 0 4.7 13.6L855 864c5.1.6 9.5-3.7 8.9-8.9L845 694.9zm-463.7-94.6a8.03 8.03 0 0 0-11.3 0L236.3 733.9l-43.7-43.7a8.01 8.01 0 0 0-13.6 4.7L160.1 855c-.6 5.1 3.7 9.5 8.9 8.9L329.2 845c6.6-.8 9.4-8.9 4.7-13.6L290 787.6 423.7 654c3.1-3.1 3.1-8.2 0-11.3l-42.4-42.4z"}}]})(n)}function g8e(){const{isFullscreen:n,toggleFullscreen:e,fullscreenRef:i,isMobile:o}=Zd(),l=ta();k.useEffect(()=>{const f=_=>{console.error("Fullscreen error:",_),l({title:"Fullscreen Error",description:"Could not enter fullscreen mode. Try tapping the button again or use the browser's fullscreen option.",status:"error",duration:5e3,isClosable:!0,position:"top"})};return document.addEventListener("fullscreenerror",f),document.addEventListener("webkitfullscreenerror",f),document.addEventListener("mozfullscreenerror",f),document.addEventListener("MSFullscreenError",f),()=>{document.removeEventListener("fullscreenerror",f),document.removeEventListener("webkitfullscreenerror",f),document.removeEventListener("mozfullscreenerror",f),document.removeEventListener("MSFullscreenError",f)}},[l]);const u=()=>{i.current?(o&&/iPhone|iPad|iPod/i.test(navigator.userAgent)&&!n&&l({title:"Mobile Fullscreen",description:"Tap the button again if fullscreen doesn't activate. For iOS, you may need to use the browser's share button and 'Add to Home Screen' for the best experience.",status:"info",duration:5e3,isClosable:!0,position:"top"}),e()):(console.error("Fullscreen target not set"),l({title:"Fullscreen Error",description:"Could not find fullscreen target element.",status:"error",duration:3e3,isClosable:!0,position:"top"}))};return S.jsx(Kf,{label:n?"Exit Fullscreen":"Enter Fullscreen",hasArrow:!0,placement:"bottom",closeOnClick:!0,portalProps:{containerRef:i},children:S.jsx(Do,{"aria-label":n?"Exit Fullscreen":"Enter Fullscreen",icon:n?S.jsx(f8e,{}):S.jsx(m8e,{}),onClick:u,variant:"iconButton",size:o?"lg":"md"})})}const $Q={iframeContainer:{position:"relative",paddingBottom:"56.25%",height:0,overflow:"hidden",width:"100%"},iframe:{position:"absolute",top:0,left:0,width:"100%",height:"100%",border:"none"}};function _8e(){const{isOpen:n,onOpen:e,onClose:i}=Xd(),{fullscreenRef:o}=Zd(),[l,u]=Nze(!1);k.useEffect(()=>{H.log("VideoPlayer: Current video URL:",l),l&&(H.log("VideoPlayer: Opening modal for video URL:",l),e())},[l,e]);const f=()=>{H.log("VideoPlayer: Closing modal"),u(),i()};return S.jsx(ru,{containerRef:o,children:S.jsxs(hs,{isOpen:n,onClose:f,size:"lg",isCentered:!0,portalProps:{containerRef:o},children:[S.jsx(fs,{bg:"rgba(0, 0, 0, 0.8)"}),S.jsxs(ps,{bg:"gray.900",color:"white",borderRadius:"lg",overflow:"hidden",maxWidth:"80vw",maxHeight:"80vh",display:"flex",justifyContent:"center",alignItems:"center",position:"relative",zIndex:"modal",children:[S.jsx($s,{size:"lg",bg:"gray.700",color:"white",borderRadius:"full",zIndex:"modal",_hover:{bg:"gray.600"},_focus:{boxShadow:"none"},position:"absolute",top:"10px",right:"10px"}),S.jsx(bs,{p:0,width:"100%",children:l&&S.jsx(ct,{style:$Q.iframeContainer,children:S.jsx("iframe",{src:l,style:$Q.iframe,allow:"autoplay; fullscreen",allowFullScreen:!0,title:"Video Player"})})})]})]})})}function y8e({isOpen:n,onClose:e,playerName:i,playerId:o,uid:l}){const[u,f]=k.useState(null),[_,E]=k.useState(!0),[b,C]=k.useState(null);return k.useEffect(()=>{n&&(async()=>{if(E(!0),C(null),!l){H.warn("NameplateModal: No UID provided for player:",i),C("No user ID available for this player"),E(!1);return}try{H.log("NameplateModal: Fetching profile for UID:",l);const P=await td(l);P?f({firstName:P.firstName,lastName:P.lastName,linkedinUrl:P.linkedinUrl,websiteUrl:P.websiteUrl,rpmURL:P.rpmURL?P.rpmURL.replace(".glb",".png?scene=fullbody-portrait-closeupfront&w=640&q=75"):null}):C("Could not find profile data for this player")}catch(P){H.error("Error fetching profile data:",P),C("Error loading profile data")}finally{E(!1)}})()},[l,n,i]),S.jsxs(hs,{isOpen:n,onClose:e,isCentered:!0,size:"md",children:[S.jsx(fs,{backdropFilter:"blur(10px)"}),S.jsxs(ps,{bg:"gray.900",color:"white",borderRadius:"xl",children:[S.jsx(yo,{children:"Player Info"}),S.jsx($s,{}),S.jsx(bs,{pb:6,children:_?S.jsx(gne,{py:8,children:S.jsx(nd,{size:"xl",color:"blue.400"})}):b?S.jsxs(op,{status:"warning",variant:"solid",borderRadius:"md",children:[S.jsx(ap,{}),b]}):S.jsxs(Fr,{spacing:4,align:"center",children:[S.jsx(eu,{size:"2xl",src:u==null?void 0:u.rpmURL,bg:"whiteAlpha.300",name:i,borderWidth:"2px",borderColor:"whiteAlpha.300"}),S.jsxs(Fr,{spacing:1,children:[S.jsx(tt,{fontSize:"2xl",fontWeight:"bold",children:i}),(u==null?void 0:u.firstName)&&S.jsxs(tt,{fontSize:"md",color:"gray.400",children:[u.firstName," ",u.lastName]}),S.jsxs(tt,{fontSize:"xs",color:"gray.500",mt:1,children:["ID: ",o]})]}),((u==null?void 0:u.linkedinUrl)||(u==null?void 0:u.websiteUrl))&&S.jsxs(S.Fragment,{children:[S.jsx(gp,{borderColor:"whiteAlpha.300"}),S.jsxs(Er,{spacing:4,pt:2,children:[(u==null?void 0:u.linkedinUrl)&&S.jsx(Kl,{href:u.linkedinUrl,isExternal:!0,children:S.jsx(Do,{icon:S.jsx(mae,{}),variant:"ghost",colorScheme:"linkedin",size:"lg","aria-label":"LinkedIn profile",_hover:{bg:"whiteAlpha.200"}})}),(u==null?void 0:u.websiteUrl)&&S.jsx(Kl,{href:u.websiteUrl,isExternal:!0,children:S.jsx(Do,{icon:S.jsx(gae,{}),variant:"ghost",colorScheme:"blue",size:"lg","aria-label":"Personal website",_hover:{bg:"whiteAlpha.200"}})})]})]})]})})]})]})}const E8e=({isVisible:n,onToggleVisibility:e,spaceID:i})=>{const[o]=zxe("(max-width: 768px)"),[l,u]=k.useState(!1);k.useEffect(()=>{(()=>{const ut=navigator.userAgent||navigator.vendor||window.opera,Lt=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(ut);u(Lt),Lt&&H.log("UnityPlayerList: Mobile browser detected, component will not render")})()},[]);const f=o||l,_=cae(),[E,b]=k.useState(!1),[C,I]=k.useState([]),[P,L]=k.useState(!1),[M,F]=k.useState({}),[B,Z]=k.useState({}),[K,re]=k.useState(null),[ae,ne]=k.useState(!1),[pe,X]=k.useState(!1),J=ta(),[Y,ie]=k.useState(null),{isOpen:le,onOpen:de,onClose:ue}=Xd(),[Oe,Ve]=k.useState(null),xe=window.currentUser||{};k.useEffect(()=>{var He;H.log("Current user info:",{uid:xe==null?void 0:xe.uid,groups:xe==null?void 0:xe.groups,isAdmin:(He=xe==null?void 0:xe.groups)==null?void 0:He.includes("disruptiveAdmin")})},[xe]),k.useEffect(()=>{if(xe&&xe.groups&&xe.groups.includes("disruptiveAdmin")){H.log("Current user is disruptiveAdmin (from groups)"),ne(!0);return}(async()=>{if(xe&&xe.uid)try{const ut=await MN(xe.uid,"disruptiveAdmin");H.log("Current user disruptiveAdmin status:",ut),ne(ut)}catch(ut){console.error("UnityPlayerList: Error checking disruptiveAdmin status:",ut),ne(!1)}})()},[xe]);const ve=(()=>{if(i)return i;if(window.spaceID)return window.spaceID;const ut=(window.location.pathname||"").split("/"),mt=ut[ut.length-1];if(mt&&mt.length>5)return mt;const Lt=document.body.getAttribute("data-space-id");if(Lt)return Lt;const Xt=localStorage.getItem("currentSpaceId");return Xt||"fallback-space-id"})();k.useEffect(()=>{(async()=>{try{const mt=await Xu(ve);mt&&mt.voiceDisabled?(console.log("UnityPlayerList: Voice is disabled for this space"),X(!0)):X(!1)}catch(mt){console.error("UnityPlayerList: Error checking if voice is disabled:",mt)}})();const ut=mt=>{mt.detail&&typeof mt.detail.voiceDisabled=="boolean"&&(console.log("UnityPlayerList: Voice setting changed:",mt.detail.voiceDisabled),X(mt.detail.voiceDisabled))};return window.addEventListener("SpaceVoiceSettingChanged",ut),()=>{window.removeEventListener("SpaceVoiceSettingChanged",ut)}},[ve]),k.useEffect(()=>{const He={};_.forEach(ut=>{if(ut.uid){if(ut.isLocalPlayer&&window.agoraClient&&window.agoraClient.client)He[ut.uid]=window.agoraClient.client.uid;else if(window.agoraClient&&window.agoraClient.client&&window.agoraClient.client.remoteUsers){const mt=window.agoraClient.client.remoteUsers,Lt=mt.find(Xt=>String(Xt.uid)===String(ut.uid));if(Lt)He[ut.uid]=Lt.uid;else{const Xt=mt.find($t=>typeof $t.uid=="string"&&$t.uid.includes(ut.uid));if(Xt)He[ut.uid]=Xt.uid;else{const $t=mt.find(we=>typeof ut.uid=="string"&&ut.uid.includes(String(we.uid)));if($t)He[ut.uid]=$t.uid;else{const we=mt.filter(je=>!(typeof je.uid=="string"&&je.uid.startsWith("screen-")));we.length===1&&!ut.isLocalPlayer&&(He[ut.uid]=we[0].uid)}}}}}}),Z(He)},[_]);const be=()=>{if(window.agoraClient&&typeof window.agoraClient.isVoiceEnabled=="boolean"){const He=window.agoraClient.isVoiceEnabled;He!==P&&L(He)}if(window.agoraClient&&window.agoraClient.client&&window.agoraClient.client.remoteUsers){const He=window.agoraClient.client.remoteUsers,ut={};He.forEach(mt=>{typeof mt.uid=="string"&&mt.uid.startsWith("screen-")||(ut[mt.uid]=!!mt.audioTrack&&!mt.audioTrack.muted)}),JSON.stringify(ut)!==JSON.stringify(M)&&F(ut)}};k.useEffect(()=>{const He=setInterval(be,500),ut=mt=>{mt.detail&&typeof mt.detail.enabled=="boolean"&&L(mt.detail.enabled)};return window.addEventListener("VoiceToggled",ut),be(),()=>{clearInterval(He),window.removeEventListener("VoiceToggled",ut)}},[]),k.useEffect(()=>{const He=()=>{H.log("UnityPlayerList: Player instantiated, showing list"),b(!0)};return window.addEventListener("PlayerInstantiated",He),window.isPlayerInstantiated&&(H.log("UnityPlayerList: Player was already instantiated"),b(!0)),()=>{window.removeEventListener("PlayerInstantiated",He)}},[]),k.useEffect(()=>{(async()=>{const ut=await Promise.all(_.map(async mt=>{if(mt.uid)try{const Lt=await td(mt.uid);let Xt=null;if(Lt.groups){const $t=`space_${ve}_owners`,we=`space_${ve}_hosts`;Lt.groups.includes($t)?Xt="owner":Lt.groups.includes(we)&&(Xt="host")}return Te({uid:mt.uid})&&re(Xt),{...mt,firstName:Lt.firstName,lastName:Lt.lastName,linkedInProfile:Lt.linkedInProfile,websiteUrl:Lt.websiteUrl,rpmURL:Lt.rpmURL?Lt.rpmURL.replace(".glb",".png?scene=fullbody-portrait-closeupfront&w=640&q=75"):null,role:Xt}}catch(Lt){return H.error(`Error fetching data for player ${mt.playerName}:`,Lt),mt}return mt}));I(ut)})()},[_,ve]);const We=[...C].sort((He,ut)=>He.isLocalPlayer?-1:ut.isLocalPlayer?1:0),Pe=()=>{H.log("UnityPlayerList: Toggling visibility"),e&&e()},Te=He=>!!(He.isLocalPlayer||xe&&(xe.uid&&He.uid===xe.uid||xe.uid&&He.id===xe.uid)),ke=He=>{try{if(Te(He))return window.agoraClient&&typeof window.agoraClient.isVoiceEnabled=="boolean"?window.agoraClient.isVoiceEnabled:P;if(He.uid){if(M[He.uid])return!0;const ut=B[He.uid];if(ut&&M[ut])return!0;const mt=parseInt(He.uid);if(!isNaN(mt)&&M[mt])return!0}return!1}catch(ut){return console.error("Error in hasActiveMic:",ut),!1}},Ue=({player:He})=>{const ut=He.role;return ut==="owner"?S.jsxs(Er,{spacing:1,bg:"green.900",p:2,borderRadius:"md",px:3,boxShadow:"0 0 10px rgba(72, 187, 120, 0.5)",border:"1px solid",borderColor:"green.400",children:[S.jsx(vn,{as:Dj,color:"green.400",boxSize:5}),S.jsx(Vf,{colorScheme:"green",variant:"solid",fontSize:"md",px:2,children:"Owner"})]}):ut==="host"?S.jsxs(Er,{spacing:1,bg:"purple.900",p:2,borderRadius:"md",px:3,boxShadow:"0 0 10px rgba(159, 122, 234, 0.5)",border:"1px solid",borderColor:"purple.400",children:[S.jsx(vn,{as:Mj,color:"purple.400",boxSize:5}),S.jsx(Vf,{colorScheme:"purple",variant:"solid",fontSize:"md",px:2,children:"Host"})]}):null},{kickPlayer:Be,isKicking:qe,kickResult:$e,error:st,resetKickState:Je}=Wze();k.useEffect(()=>{$e!=null&&$e.success&&Y&&(J({title:"Remove Successful",description:`${Y} has been removed from the space.`,status:"success",duration:3e3,isClosable:!0}),ie(null),Je())},[$e,Y,J,Je]),k.useEffect(()=>{st&&(J({title:"Error Removing Player",description:st,status:"error",duration:3e3,isClosable:!0}),ie(null),Je())},[st,J,Je]);const Rt=()=>{Oe&&(ie(Oe.playerName),Be(Oe.uid,xe==null?void 0:xe.uid),J({title:"Processing",description:`Removing ${Oe.playerName}...`,status:"info",duration:2e3,isClosable:!0}),Ve(null),ue())},kt=(He,ut)=>{console.log(`Action "${He}" triggered for player: ${ut.playerName}`);const mt=We.find(Xt=>Xt.isLocalPlayer);if(!((mt==null?void 0:mt.role)==="owner")){J({title:"Permission Denied",description:"You don't have permission to perform this action.",status:"error",duration:3e3,isClosable:!0}),console.error("Permission denied: User attempted to perform action without proper permissions");return}switch(He){case"remove":Ve(ut),de();break;default:console.log(`Unhandled action: ${He}`);break}};return S.jsxs(S.Fragment,{children:[S.jsxs(ct,{position:"absolute",top:"100px",right:"20px",zIndex:"1",bg:"rgba(0,0,0,0.4)",p:4,borderRadius:"md",color:"white",minWidth:"200px",maxHeight:"300px",visibility:E&&n&&!f?"visible":"hidden",role:"group",children:[S.jsx(ct,{position:"absolute",top:2,right:2,opacity:0,_groupHover:{opacity:1},transition:"opacity 0.2s",children:S.jsx(Do,{icon:S.jsx(OWe,{boxSize:3}),size:"xs","aria-label":"Close list",variant:"unstyled",color:"white",onClick:Pe,_hover:{opacity:.8}})}),S.jsxs(tt,{fontWeight:"bold",mb:2,fontSize:"sm",children:["People Online: ",_.length]}),S.jsx(ct,{maxHeight:"200px",overflowY:"auto",css:{"&::-webkit-scrollbar":{width:"4px"},"&::-webkit-scrollbar-track":{background:"rgba(0,0,0,0.1)"},"&::-webkit-scrollbar-thumb":{background:"rgba(255,255,255,0.3)",borderRadius:"2px"}},children:S.jsx(Fr,{align:"stretch",spacing:1,width:"100%",children:We.map((He,ut)=>{const mt=Te(He),Lt=!pe&&ke(He);He.uid||He.id;const Xt=We.find(Ke=>Ke.isLocalPlayer);Xt!=null&&Xt.uid||(Xt==null||Xt.id);const $t=He.role==="owner",je=(Xt==null?void 0:Xt.role)==="owner"&&!mt&&!$t;return S.jsx(ct,{children:S.jsxs(Are,{placement:"left",trigger:"hover",children:[S.jsx(Dre,{children:S.jsxs(Er,{width:"100%",spacing:2,p:1,borderRadius:"md",_hover:{bg:"whiteAlpha.200"},transition:"background 0.2s",children:[S.jsx(eu,{size:"xs",src:He.rpmURL,bg:"whiteAlpha.400",name:" ",borderWidth:"1px",borderColor:"whiteAlpha.300"}),S.jsx(tt,{fontSize:"xs",children:He.playerName}),He.role==="owner"&&S.jsx(vn,{as:Dj,color:"green.400",boxSize:2.5}),He.role==="host"&&S.jsx(vn,{as:Mj,color:"purple.400",boxSize:2.5}),S.jsx($C,{}),!pe&&(Lt?S.jsx(ct,{color:"green.400",children:S.jsx(Lj,{})}):S.jsx(ct,{color:"red.400",children:S.jsx(xj,{})})),mt?S.jsx(tt,{fontSize:"xs",color:"gray.300",ml:1,children:"(you)"}):je?S.jsxs(bR,{children:[S.jsx(wR,{as:Do,"aria-label":"Options",icon:S.jsx(t8e,{}),variant:"ghost",size:"xs",color:"gray.300",ml:1,minW:"16px",h:"16px",p:0}),S.jsx(TR,{bg:"rgba(0,0,0,0.8)",borderColor:"whiteAlpha.300",minW:"120px",zIndex:10001,children:S.jsx(Lf,{icon:S.jsx(c8e,{}),onClick:()=>kt("remove",He),bg:"black",color:"white",_hover:{bg:"gray.800"},fontSize:"sm",children:"Remove"})})]}):null]})}),S.jsx(Nre,{bg:"rgba(0,0,0,0.8)",border:"none",boxShadow:"dark-lg",color:"white",p:4,width:"auto",minWidth:"250px",ml:"-20px",position:"absolute",left:"-250px",top:"-100px",transform:"none !important",zIndex:1e4,children:S.jsx(Ore,{children:S.jsxs(Fr,{align:"center",spacing:3,children:[S.jsx(eu,{size:"xl",src:He.rpmURL,bg:"whiteAlpha.400",name:" ",borderWidth:"2px",borderColor:"whiteAlpha.300"}),S.jsx(tt,{fontSize:"xl",fontWeight:"bold",children:He.playerName}),S.jsx(Ue,{player:He}),He.firstName&&S.jsxs(tt,{fontSize:"sm",color:"gray.300",children:[He.firstName," ",He.lastName]}),S.jsxs(Er,{spacing:4,pt:2,children:[He.linkedInProfile&&S.jsx(Kl,{href:He.linkedInProfile,isExternal:!0,children:S.jsx(Do,{icon:S.jsx(mae,{}),variant:"ghost",colorScheme:"whiteAlpha",size:"md","aria-label":"LinkedIn profile",_hover:{bg:"whiteAlpha.200"}})}),He.websiteUrl&&S.jsx(Kl,{href:He.websiteUrl,isExternal:!0,children:S.jsx(Do,{icon:S.jsx(gae,{}),variant:"ghost",colorScheme:"whiteAlpha",size:"md","aria-label":"Personal website",_hover:{bg:"whiteAlpha.200"}})}),!pe&&S.jsx(Do,{icon:Lt?S.jsx(Lj,{}):S.jsx(xj,{}),variant:"ghost",colorScheme:Lt?"green":"red",size:"md","aria-label":"Microphone status",isDisabled:!0}),pe&&S.jsx(Do,{icon:S.jsx(u8e,{}),variant:"ghost",colorScheme:"red",size:"md","aria-label":"Voice chat disabled",isDisabled:!0,title:"Voice chat is disabled for this space"})]})]})})})]})},ut)})})})]}),S.jsxs(hs,{isOpen:le,onClose:ue,isCentered:!0,children:[S.jsx(fs,{}),S.jsxs(ps,{bg:"gray.800",color:"white",children:[S.jsx(yo,{children:"Confirm Removal"}),S.jsx($s,{}),S.jsx(bs,{children:S.jsxs(tt,{children:["Remove ",Oe==null?void 0:Oe.playerName," from the room?"]})}),S.jsxs(Cp,{children:[S.jsx(jn,{colorScheme:"red",onClick:Rt,isLoading:qe,mr:3,children:"Remove"}),S.jsx(jn,{bg:"white",color:"gray.800",onClick:ue,_hover:{bg:"gray.200"},children:"Cancel"})]})]})]})]})};var Vk={exports:{}},v8e=Vk.exports,KQ;function S8e(){return KQ||(KQ=1,function(n,e){(function(i,o){n.exports=o()})(v8e,function(){function i(t,r){return r.forEach(function(s){s&&typeof s!="string"&&!Array.isArray(s)&&Object.keys(s).forEach(function(a){if(a!=="default"&&!(a in t)){var c=Object.getOwnPropertyDescriptor(s,a);Object.defineProperty(t,a,c.get?c:{enumerable:!0,get:function(){return s[a]}})}})}),Object.freeze(t)}var o=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof ky<"u"?ky:typeof self<"u"?self:{};function l(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var u=function(t){try{return!!t()}catch{return!0}},f=!u(function(){var t=(function(){}).bind();return typeof t!="function"||t.hasOwnProperty("prototype")}),_=f,E=Function.prototype,b=E.call,C=_&&E.bind.bind(b,b),I=_?C:function(t){return function(){return b.apply(t,arguments)}},P=I({}.isPrototypeOf),L=function(t){return t&&t.Math==Math&&t},M=L(typeof globalThis=="object"&&globalThis)||L(typeof window=="object"&&window)||L(typeof self=="object"&&self)||L(typeof o=="object"&&o)||function(){return this}()||o||Function("return this")(),F=f,B=Function.prototype,Z=B.apply,K=B.call,re=typeof Reflect=="object"&&Reflect.apply||(F?K.bind(Z):function(){return K.apply(Z,arguments)}),ae=I,ne=ae({}.toString),pe=ae("".slice),X=function(t){return pe(ne(t),8,-1)},J=X,Y=I,ie=function(t){if(J(t)==="Function")return Y(t)},le=typeof document=="object"&&document.all,de={all:le,IS_HTMLDDA:le===void 0&&le!==void 0},ue=de.all,Oe=de.IS_HTMLDDA?function(t){return typeof t=="function"||t===ue}:function(t){return typeof t=="function"},Ve={},xe=!u(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!=7}),Re=f,ve=Function.prototype.call,be=Re?ve.bind(ve):function(){return ve.apply(ve,arguments)},We={},Pe={}.propertyIsEnumerable,Te=Object.getOwnPropertyDescriptor,ke=Te&&!Pe.call({1:2},1);We.f=ke?function(t){var r=Te(this,t);return!!r&&r.enumerable}:Pe;var Ue,Be,qe=function(t,r){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:r}},$e=u,st=X,Je=Object,Rt=I("".split),kt=$e(function(){return!Je("z").propertyIsEnumerable(0)})?function(t){return st(t)=="String"?Rt(t,""):Je(t)}:Je,He=function(t){return t==null},ut=He,mt=TypeError,Lt=function(t){if(ut(t))throw mt("Can't call method on "+t);return t},Xt=kt,$t=Lt,we=function(t){return Xt($t(t))},je=Oe,Ke=de.all,gt=de.IS_HTMLDDA?function(t){return typeof t=="object"?t!==null:je(t)||t===Ke}:function(t){return typeof t=="object"?t!==null:je(t)},Et={},Tt=Et,Kt=M,gn=Oe,Sn=function(t){return gn(t)?t:void 0},sn=function(t,r){return arguments.length<2?Sn(Tt[t])||Sn(Kt[t]):Tt[t]&&Tt[t][r]||Kt[t]&&Kt[t][r]},wt=typeof navigator<"u"&&String(navigator.userAgent)||"",ir=M,Vt=wt,zt=ir.process,_n=ir.Deno,Ui=zt&&zt.versions||_n&&_n.version,Ts=Ui&&Ui.v8;Ts&&(Be=(Ue=Ts.split("."))[0]>0&&Ue[0]<4?1:+(Ue[0]+Ue[1])),!Be&&Vt&&(!(Ue=Vt.match(/Edge\/(\d+)/))||Ue[1]>=74)&&(Ue=Vt.match(/Chrome\/(\d+)/))&&(Be=+Ue[1]);var ui=Be,na=ui,dc=u,oo=M.String,ao=!!Object.getOwnPropertySymbols&&!dc(function(){var t=Symbol();return!oo(t)||!(Object(t)instanceof Symbol)||!Symbol.sham&&na&&na<41}),xc=ao&&!Symbol.sham&&typeof Symbol.iterator=="symbol",Cs=sn,La=Oe,Vo=P,Ma=Object,hc=xc?function(t){return typeof t=="symbol"}:function(t){var r=Cs("Symbol");return La(r)&&Vo(r.prototype,Ma(t))},wl=String,Ua=function(t){try{return wl(t)}catch{return"Object"}},pc=Oe,Eo=Ua,Vi=TypeError,vt=function(t){if(pc(t))return t;throw Vi(Eo(t)+" is not a function")},pn=vt,Sr=He,yi=function(t,r){var s=t[r];return Sr(s)?void 0:pn(s)},jo=be,vo=Oe,iu=gt,kp=TypeError,Tl={exports:{}},su=M,Ai=Object.defineProperty,So=function(t,r){try{Ai(su,t,{value:r,configurable:!0,writable:!0})}catch{su[t]=r}return r},Gi="__core-js_shared__",th=M[Gi]||So(Gi,{}),nh=th;(Tl.exports=function(t,r){return nh[t]||(nh[t]=r!==void 0?r:{})})("versions",[]).push({version:"3.31.1",mode:"pure",copyright:" 2014-2023 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.31.1/LICENSE",source:"https://github.com/zloirock/core-js"});var fc=Tl.exports,rh=Lt,rd=Object,ra=function(t){return rd(rh(t))},ih=ra,Xr=I({}.hasOwnProperty),Pi=Object.hasOwn||function(t,r){return Xr(ih(t),r)},Lc=I,Cl=0,Va=Math.random(),Np=Lc(1 .toString),sh=function(t){return"Symbol("+(t===void 0?"":t)+")_"+Np(++Cl+Va,36)},ou=fc,Fo=Pi,um=sh,bo=ao,Dp=xc,Rl=M.Symbol,oh=ou("wks"),ah=Dp?Rl.for||Rl:Rl&&Rl.withoutSetter||um,br=function(t){return Fo(oh,t)||(oh[t]=bo&&Fo(Rl,t)?Rl[t]:ah("Symbol."+t)),oh[t]},au=be,cu=gt,id=hc,mc=yi,ia=function(t,r){var s,a;if(vo(s=t.toString)&&!iu(a=jo(s,t))||vo(s=t.valueOf)&&!iu(a=jo(s,t)))return a;throw kp("Can't convert object to primitive value")},sd=TypeError,Il=br("toPrimitive"),lu=function(t,r){if(!cu(t)||id(t))return t;var s,a=mc(t,Il);if(a){if(s=au(a,t,r),!cu(s)||id(s))return s;throw sd("Can't convert object to primitive value")}return ia(t)},ni=hc,gc=function(t){var r=lu(t,"string");return ni(r)?r:r+""},hr=gt,Mc=M.document,dm=hr(Mc)&&hr(Mc.createElement),uu=function(t){return dm?Mc.createElement(t):{}},ch=uu,xp=!xe&&!u(function(){return Object.defineProperty(ch("div"),"a",{get:function(){return 7}}).a!=7}),hm=xe,Lp=be,sa=We,gs=qe,oa=we,aa=gc,du=Pi,ca=xp,la=Object.getOwnPropertyDescriptor;Ve.f=hm?la:function(t,r){if(t=oa(t),r=aa(r),ca)try{return la(t,r)}catch{}if(du(t,r))return gs(!Lp(sa.f,t,r),t[r])};var pm=u,Uc=Oe,Rs=/#|\.prototype\./,od=function(t,r){var s=Al[Mp(t)];return s==fm||s!=hu&&(Uc(r)?pm(r):!!r)},Mp=od.normalize=function(t){return String(t).replace(Rs,".").toLowerCase()},Al=od.data={},hu=od.NATIVE="N",fm=od.POLYFILL="P",ja=od,Fa=vt,Pl=f,Se=ie(ie.bind),De=function(t,r){return Fa(t),r===void 0?t:Pl?Se(t,r):function(){return t.apply(r,arguments)}},it={},nn=xe&&u(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!=42}),er=gt,Ar=String,Jr=TypeError,mn=function(t){if(er(t))return t;throw Jr(Ar(t)+" is not an object")},Gr=xe,Oi=xp,Ys=nn,ua=mn,da=gc,ad=TypeError,os=Object.defineProperty,Ol=Object.getOwnPropertyDescriptor,lh="enumerable",Vc="configurable",n_="writable";it.f=Gr?Ys?function(t,r,s){if(ua(t),r=da(r),ua(s),typeof t=="function"&&r==="prototype"&&"value"in s&&n_ in s&&!s[n_]){var a=Ol(t,r);a&&a[n_]&&(t[r]=s.value,s={configurable:Vc in s?s[Vc]:a[Vc],enumerable:lh in s?s[lh]:a[lh],writable:!1})}return os(t,r,s)}:os:function(t,r,s){if(ua(t),r=da(r),ua(s),Oi)try{return os(t,r,s)}catch{}if("get"in s||"set"in s)throw ad("Accessors not supported");return"value"in s&&(t[r]=s.value),t};var mm=it,cd=qe,ha=xe?function(t,r,s){return mm.f(t,r,cd(1,s))}:function(t,r,s){return t[r]=s,t},pu=M,gm=re,r_=ie,mE=Oe,_m=Ve.f,ym=ja,ld=Et,ud=De,dd=ha,i_=Pi,gE=function(t){var r=function(s,a,c){if(this instanceof r){switch(arguments.length){case 0:return new t;case 1:return new t(s);case 2:return new t(s,a)}return new t(s,a,c)}return gm(t,this,arguments)};return r.prototype=t.prototype,r},Hn=function(t,r){var s,a,c,d,h,m,y,v,w,R=t.target,O=t.global,D=t.stat,G=t.proto,j=O?pu:D?pu[R]:(pu[R]||{}).prototype,W=O?ld:ld[R]||dd(ld,R,{})[R],Q=W.prototype;for(d in r)a=!(s=ym(O?d:R+(D?".":"#")+d,t.forced))&&j&&i_(j,d),m=W[d],a&&(y=t.dontCallGetSet?(w=_m(j,d))&&w.value:j[d]),h=a&&y?y:r[d],a&&typeof m==typeof h||(v=t.bind&&a?ud(h,pu):t.wrap&&a?gE(h):G&&mE(h)?r_(h):h,(t.sham||h&&h.sham||m&&m.sham)&&dd(v,"sham",!0),dd(W,d,v),G&&(i_(ld,c=R+"Prototype")||dd(ld,c,{}),dd(ld[c],d,h),t.real&&Q&&(s||!Q[d])&&dd(Q,d,h)))},Em=Math.ceil,pa=Math.floor,_E=Math.trunc||function(t){var r=+t;return(r>0?pa:Em)(r)},yE=_E,jc=function(t){var r=+t;return r!=r||r===0?0:yE(r)},A=jc,z=Math.max,se=Math.min,ge=function(t,r){var s=A(t);return s<0?z(s+r,0):se(s,r)},Qe=jc,dt=Math.min,Gt=function(t){return t>0?dt(Qe(t),9007199254740991):0},ri=Gt,Ei=function(t){return ri(t.length)},Pr=we,co=ge,Is=Ei,_c=function(t){return function(r,s,a){var c,d=Pr(r),h=Is(d),m=co(a,h);if(t&&s!=s){for(;h>m;)if((c=d[m++])!=c)return!0}else for(;h>m;m++)if((t||m in d)&&d[m]===s)return t||m||0;return!t&&-1}},fa={includes:_c(!0),indexOf:_c(!1)},Up=fa.includes;Hn({target:"Array",proto:!0,forced:u(function(){return!Array(1).includes()})},{includes:function(t){return Up(this,t,arguments.length>1?arguments[1]:void 0)}});var vm=Et,yc=function(t){return vm[t+"Prototype"]},jR=yc("Array").includes,FR=gt,Sm=X,YN=br("match"),BR=function(t){var r;return FR(t)&&((r=t[YN])!==void 0?!!r:Sm(t)=="RegExp")},XN=BR,WR=TypeError,ab={};ab[br("toStringTag")]="z";var Vp=String(ab)==="[object z]",s_=Vp,JN=Oe,jp=X,QN=br("toStringTag"),zR=Object,cb=jp(function(){return arguments}())=="Arguments",Fc=s_?jp:function(t){var r,s,a;return t===void 0?"Undefined":t===null?"Null":typeof(s=function(c,d){try{return c[d]}catch{}}(r=zR(t),QN))=="string"?s:cb?jp(r):(a=jp(r))=="Object"&&JN(r.callee)?"Arguments":a},GR=Fc,HR=String,Ba=function(t){if(GR(t)==="Symbol")throw TypeError("Cannot convert a Symbol value to a string");return HR(t)},ZN=br("match"),eD=Hn,tD=function(t){if(XN(t))throw WR("The method doesn't accept regular expressions");return t},nD=Lt,$R=Ba,kl=function(t){var r=/./;try{"/./"[t](r)}catch{try{return r[ZN]=!1,"/./"[t](r)}catch{}}return!1},o_=I("".indexOf);eD({target:"String",proto:!0,forced:!kl("includes")},{includes:function(t){return!!~o_($R(nD(this)),$R(tD(t)),arguments.length>1?arguments[1]:void 0)}});var KR=yc("String").includes,lb=P,qR=jR,YR=KR,a_=Array.prototype,ub=String.prototype,rD=function(t){var r=t.includes;return t===a_||lb(a_,t)&&r===a_.includes?qR:typeof t=="string"||t===ub||lb(ub,t)&&r===ub.includes?YR:r},lt=l(rD),db=vt,c_=ra,hb=kt,XR=Ei,EE=TypeError,bm=function(t){return function(r,s,a,c){db(s);var d=c_(r),h=hb(d),m=XR(d),y=t?m-1:0,v=t?-1:1;if(a<2)for(;;){if(y in h){c=h[y],y+=v;break}if(y+=v,t?y<0:m<=y)throw EE("Reduce of empty array with no initial value")}for(;t?y>=0:m>y;y+=v)y in h&&(c=s(c,h[y],y,d));return c}},pb={left:bm(!1)},JR=u,Fp=function(t,r){var s=[][t];return!!s&&JR(function(){s.call(null,r||function(){return 1},1)})},Bp=typeof process<"u"&&X(process)=="process",QR=pb.left;Hn({target:"Array",proto:!0,forced:!Bp&&ui>79&&ui<83||!Fp("reduce")},{reduce:function(t){var r=arguments.length;return QR(this,t,r,r>1?arguments[1]:void 0)}});var ZR=yc("Array").reduce,eI=P,tI=ZR,vE=Array.prototype,uh=function(t){var r=t.reduce;return t===vE||eI(vE,t)&&r===vE.reduce?tI:r},SE=uh,Ec=l(SE),iD=X,l_=Array.isArray||function(t){return iD(t)=="Array"},u_=Hn,sD=l_,nI=I([].reverse),fb=[1,2];u_({target:"Array",proto:!0,forced:String(fb)===String(fb.reverse())},{reverse:function(){return sD(this)&&(this.length=this.length),nI(this)}});var ji=yc("Array").reverse,mb=P,bE=ji,Wp=Array.prototype,rI=function(t){var r=t.reverse;return t===Wp||mb(Wp,t)&&r===Wp.reverse?bE:r},wE=rI,wm=l(wE),TE=sh,zp=fc("keys"),d_=function(t){return zp[t]||(zp[t]=TE(t))},oD=!u(function(){function t(){}return t.prototype.constructor=null,Object.getPrototypeOf(new t)!==t.prototype}),aD=Pi,iI=Oe,CE=ra,RE=oD,IE=d_("IE_PROTO"),h_=Object,gb=h_.prototype,p_=RE?h_.getPrototypeOf:function(t){var r=CE(t);if(aD(r,IE))return r[IE];var s=r.constructor;return iI(s)&&r instanceof s?s.prototype:r instanceof h_?gb:null},cD=I,sI=vt,lD=Oe,uD=String,_b=TypeError,dh=function(t,r,s){try{return cD(sI(Object.getOwnPropertyDescriptor(t,r)[s]))}catch{}},oI=mn,Tm=function(t){if(typeof t=="object"||lD(t))return t;throw _b("Can't set "+uD(t)+" as a prototype")},fu=Object.setPrototypeOf||("__proto__"in{}?function(){var t,r=!1,s={};try{(t=dh(Object.prototype,"__proto__","set"))(s,[]),r=s instanceof Array}catch{}return function(a,c){return oI(a),Tm(c),r?t(a,c):a.__proto__=c,a}}():void 0),hh={},Bc={},f_=Pi,dD=we,hD=fa.indexOf,Gp=Bc,Cm=I([].push),Hp=function(t,r){var s,a=dD(t),c=0,d=[];for(s in a)!f_(Gp,s)&&f_(a,s)&&Cm(d,s);for(;r.length>c;)f_(a,s=r[c++])&&(~hD(d,s)||Cm(d,s));return d},Rm=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],yb=Hp,Im=Rm.concat("length","prototype");hh.f=Object.getOwnPropertyNames||function(t){return yb(t,Im)};var Wc={};Wc.f=Object.getOwnPropertySymbols;var Fi=sn,ki=hh,ph=Wc,Bo=mn,Wa=I([].concat),$p=Fi("Reflect","ownKeys")||function(t){var r=ki.f(Bo(t)),s=ph.f;return s?Wa(r,s(t)):r},Kp=Pi,za=$p,AE=Ve,aI=it,PE={},OE=Hp,cI=Rm,zc=Object.keys||function(t){return OE(t,cI)},kE=xe,Eb=nn,lI=it,pD=mn,fh=we,Am=zc;PE.f=kE&&!Eb?Object.defineProperties:function(t,r){pD(t);for(var s,a=fh(r),c=Am(r),d=c.length,h=0;d>h;)lI.f(t,s=c[h++],a[s]);return t};var hd,m_=sn("document","documentElement"),NE=mn,Gc=PE,vc=Rm,qp=Bc,pd=m_,fd=uu,md="prototype",DE="script",xE=d_("IE_PROTO"),g_=function(){},Ga=function(t){return"<"+DE+">"+t+"</"+DE+">"},Ha=function(t){t.write(Ga("")),t.close();var r=t.parentWindow.Object;return t=null,r},vi=function(){try{hd=new ActiveXObject("htmlfile")}catch{}var t,r,s;vi=typeof document<"u"?document.domain&&hd?Ha(hd):(r=fd("iframe"),s="java"+DE+":",r.style.display="none",pd.appendChild(r),r.src=String(s),(t=r.contentWindow.document).open(),t.write(Ga("document.F=Object")),t.close(),t.F):Ha(hd);for(var a=vc.length;a--;)delete vi[md][vc[a]];return vi()};qp[xE]=!0;var ma=Object.create||function(t,r){var s;return t!==null?(g_[md]=NE(t),s=new g_,g_[md]=null,s[xE]=t):s=vi(),r===void 0?s:Gc.f(s,r)},uI=gt,dI=ha,LE=Error,vb=I("".replace),hI=String(LE("zxcasd").stack),__=/\n\s*at [^:]*:[^\n]*/,pI=__.test(hI),Pm=qe,Sb=!u(function(){var t=Error("a");return!("stack"in t)||(Object.defineProperty(t,"stack",Pm(1,7)),t.stack!==7)}),fD=ha,y_=function(t,r){if(pI&&typeof t=="string"&&!LE.prepareStackTrace)for(;r--;)t=vb(t,__,"");return t},ME=Sb,bb=Error.captureStackTrace,mh={},Om=mh,fI=br("iterator"),UE=Array.prototype,E_=function(t){return t!==void 0&&(Om.Array===t||UE[fI]===t)},km=Fc,VE=yi,wb=He,Tb=mh,Cb=br("iterator"),gd=function(t){if(!wb(t))return VE(t,Cb)||VE(t,"@@iterator")||Tb[km(t)]},Hc=be,Yp=vt,Rb=mn,mI=Ua,_d=gd,gh=TypeError,v_=function(t,r){var s=arguments.length<2?_d(t):r;if(Yp(s))return Rb(Hc(s,t));throw gh(mI(t)+" is not iterable")},gI=be,mu=mn,_h=yi,S_=function(t,r,s){var a,c;mu(t);try{if(!(a=_h(t,"return"))){if(r==="throw")throw s;return s}a=gI(a,t)}catch(d){c=!0,a=d}if(r==="throw")throw s;if(c)throw a;return mu(a),s},_I=De,jE=be,yI=mn,b_=Ua,gu=E_,w_=Ei,Nm=P,Xp=v_,Ib=gd,Jp=S_,EI=TypeError,Dm=function(t,r){this.stopped=t,this.result=r},Hi=Dm.prototype,yh=function(t,r,s){var a,c,d,h,m,y,v,w=s&&s.that,R=!(!s||!s.AS_ENTRIES),O=!(!s||!s.IS_RECORD),D=!(!s||!s.IS_ITERATOR),G=!(!s||!s.INTERRUPTED),j=_I(r,w),W=function(ee){return a&&Jp(a,"normal",ee),new Dm(!0,ee)},Q=function(ee){return R?(yI(ee),G?j(ee[0],ee[1],W):j(ee[0],ee[1])):G?j(ee,W):j(ee)};if(O)a=t.iterator;else if(D)a=t;else{if(!(c=Ib(t)))throw EI(b_(t)+" is not iterable");if(gu(c)){for(d=0,h=w_(t);h>d;d++)if((m=Q(t[d]))&&Nm(Hi,m))return m;return new Dm(!1)}a=Xp(t,c)}for(y=O?t.next:a.next;!(v=jE(y,a)).done;){try{m=Q(v.value)}catch(ee){Jp(a,"throw",ee)}if(typeof m=="object"&&m&&Nm(Hi,m))return m}return new Dm(!1)},Ab=Ba,Pb=Hn,FE=P,Ob=p_,_u=fu,Xi=function(t,r,s){for(var a=za(r),c=aI.f,d=AE.f,h=0;h<a.length;h++){var m=a[h];Kp(t,m)||s&&Kp(s,m)||c(t,m,d(r,m))}},As=ma,Ps=ha,xm=qe,T_=function(t,r){uI(r)&&"cause"in r&&dI(t,"cause",r.cause)},C_=function(t,r,s,a){ME&&(bb?bb(t,r):fD(t,"stack",y_(s,a)))},mD=yh,Wo=function(t,r){return t===void 0?arguments.length<2?"":r:Ab(t)},kb=br("toStringTag"),Lm=Error,Nb=[].push,ga=function(t,r){var s,a=FE($a,this);_u?s=_u(Lm(),a?Ob(this):$a):(s=a?this:As($a),Ps(s,kb,"Error")),r!==void 0&&Ps(s,"message",Wo(r)),C_(s,ga,s.stack,1),arguments.length>2&&T_(s,arguments[2]);var c=[];return mD(t,Nb,{that:c}),Ps(s,"errors",c),s};_u?_u(ga,Lm):Xi(ga,Lm,{name:!0});var $a=ga.prototype=As(Lm.prototype,{constructor:xm(1,ga),message:xm(1,""),name:xm(1,"AggregateError")});Pb({global:!0},{AggregateError:ga});var Eh,Qp,Mm,vI=Oe,Db=M.WeakMap,SI=vI(Db)&&/native code/.test(String(Db)),xb=M,bI=gt,wI=ha,BE=Pi,WE=th,R_=d_,TI=Bc,I_="Object already initialized",Um=xb.TypeError,CI=xb.WeakMap;if(SI||WE.state){var $c=WE.state||(WE.state=new CI);$c.get=$c.get,$c.has=$c.has,$c.set=$c.set,Eh=function(t,r){if($c.has(t))throw Um(I_);return r.facade=t,$c.set(t,r),r},Qp=function(t){return $c.get(t)||{}},Mm=function(t){return $c.has(t)}}else{var Zp=R_("state");TI[Zp]=!0,Eh=function(t,r){if(BE(t,Zp))throw Um(I_);return r.facade=t,wI(t,Zp,r),r},Qp=function(t){return BE(t,Zp)?t[Zp]:{}},Mm=function(t){return BE(t,Zp)}}var vh,Lb,Mb,yd={set:Eh,get:Qp,has:Mm,enforce:function(t){return Mm(t)?Qp(t):Eh(t,{})},getterFor:function(t){return function(r){var s;if(!bI(r)||(s=Qp(r)).type!==t)throw Um("Incompatible receiver, "+t+" required");return s}}},zE=xe,RI=Pi,Ub=Function.prototype,gD=zE&&Object.getOwnPropertyDescriptor,Vb=RI(Ub,"name"),II={PROPER:Vb&&(function(){}).name==="something",CONFIGURABLE:Vb&&(!zE||zE&&gD(Ub,"name").configurable)},_D=ha,Ed=function(t,r,s,a){return a&&a.enumerable?t[r]=s:_D(t,r,s),t},AI=u,PI=Oe,GE=gt,yD=ma,OI=p_,ED=Ed,Sc=br("iterator"),HE=!1;[].keys&&("next"in(Mb=[].keys())?(Lb=OI(OI(Mb)))!==Object.prototype&&(vh=Lb):HE=!0);var $E=!GE(vh)||AI(function(){var t={};return vh[Sc].call(t)!==t});PI((vh=$E?{}:yD(vh))[Sc])||ED(vh,Sc,function(){return this});var jb={IteratorPrototype:vh,BUGGY_SAFARI_ITERATORS:HE},kI=Fc,NI=Vp?{}.toString:function(){return"[object "+kI(this)+"]"},Fb=Vp,Vm=it.f,Bb=ha,Wb=Pi,vD=NI,zb=br("toStringTag"),vd=function(t,r,s,a){if(t){var c=s?t:t.prototype;Wb(c,zb)||Vm(c,zb,{configurable:!0,value:r}),a&&!Fb&&Bb(c,"toString",vD)}},DI=jb.IteratorPrototype,xI=ma,LI=qe,SD=vd,Ka=mh,_a=function(){return this},KE=function(t,r,s,a){var c=r+" Iterator";return t.prototype=xI(DI,{next:LI(+!a,s)}),SD(t,c,!1,!0),Ka[c]=_a,t},MI=Hn,UI=be,VI=II,jI=KE,Gb=p_,FI=vd,qE=Ed,Hb=mh,BI=jb,$b=VI.PROPER,jm=BI.BUGGY_SAFARI_ITERATORS,YE=br("iterator"),XE="keys",ef="values",WI="entries",zI=function(){return this},JE=function(t,r,s,a,c,d,h){jI(s,r,a);var m,y,v,w=function(Q){if(Q===c&&j)return j;if(!jm&&Q in D)return D[Q];switch(Q){case XE:case ef:case WI:return function(){return new s(this,Q)}}return function(){return new s(this)}},R=r+" Iterator",O=!1,D=t.prototype,G=D[YE]||D["@@iterator"]||c&&D[c],j=!jm&&G||w(c),W=r=="Array"&&D.entries||G;if(W&&(m=Gb(W.call(new t)))!==Object.prototype&&m.next&&(FI(m,R,!0,!0),Hb[R]=zI),$b&&c==ef&&G&&G.name!==ef&&(O=!0,j=function(){return UI(G,this)}),c)if(y={values:w(ef),keys:d?j:w(XE),entries:w(WI)},h)for(v in y)(jm||O||!(v in D))&&qE(D,v,y[v]);else MI({target:r,proto:!0,forced:jm||O},y);return h&&D[YE]!==j&&qE(D,YE,j,{}),Hb[r]=j,y},QE=function(t,r){return{value:t,done:r}},ZE=we,yu=mh,GI=yd;it.f;var HI=JE,ev=QE,Kb="Array Iterator",$I=GI.set,A_=GI.getterFor(Kb);HI(Array,"Array",function(t,r){$I(this,{type:Kb,target:ZE(t),index:0,kind:r})},function(){var t=A_(this),r=t.target,s=t.kind,a=t.index++;return!r||a>=r.length?(t.target=void 0,ev(void 0,!0)):ev(s=="keys"?a:s=="values"?r[a]:[a,r[a]],!1)},"values"),yu.Arguments=yu.Array;var zo=it,tv=function(t,r,s){return zo.f(t,r,s)},bD=sn,nv=tv,Go=xe,KI=br("species"),on=P,Fm=TypeError,P_=function(t,r){if(on(r,t))return t;throw Fm("Incorrect invocation")},qI=Oe,qb=th,O_=I(Function.toString);qI(qb.inspectSource)||(qb.inspectSource=function(t){return O_(t)});var k_=qb.inspectSource,Yb=I,YI=u,Xb=Oe,XI=Fc,Jb=k_,rv=function(){},wo=[],Kc=sn("Reflect","construct"),Eu=/^\s*(?:class|function)\b/,JI=Yb(Eu.exec),QI=!Eu.exec(rv),ya=function(t){if(!Xb(t))return!1;try{return Kc(rv,wo,t),!0}catch{return!1}},Qb=function(t){if(!Xb(t))return!1;switch(XI(t)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return QI||!!JI(Eu,Jb(t))}catch{return!0}};Qb.sham=!0;var qa,Bm,Zb,iv,N_=!Kc||YI(function(){var t;return ya(ya.call)||!ya(Object)||!ya(function(){t=!0})||t})?Qb:ya,ZI=N_,wD=Ua,sv=TypeError,ov=mn,qc=function(t){if(ZI(t))return t;throw sv(wD(t)+" is not a constructor")},Lr=He,lo=br("species"),as=function(t,r){var s,a=ov(t).constructor;return a===void 0||Lr(s=ov(a)[lo])?r:qc(s)},Os=I([].slice),bc=TypeError,Nl=function(t,r){if(t<r)throw bc("Not enough arguments");return t},ks=/(?:ipad|iphone|ipod).*applewebkit/i.test(wt),To=M,tf=re,av=De,cv=Oe,D_=Pi,Ea=u,lv=m_,Wm=Os,vu=uu,uv=Nl,ew=ks,Sh=Bp,zm=To.setImmediate,Su=To.clearImmediate,dv=To.process,nf=To.Dispatch,tw=To.Function,x_=To.MessageChannel,hv=To.String,Co=0,Yc={},Xc="onreadystatechange";Ea(function(){qa=To.location});var Ho=function(t){if(D_(Yc,t)){var r=Yc[t];delete Yc[t],r()}},pv=function(t){return function(){Ho(t)}},fv=function(t){Ho(t.data)},mv=function(t){To.postMessage(hv(t),qa.protocol+"//"+qa.host)};zm&&Su||(zm=function(t){uv(arguments.length,1);var r=cv(t)?t:tw(t),s=Wm(arguments,1);return Yc[++Co]=function(){tf(r,void 0,s)},Bm(Co),Co},Su=function(t){delete Yc[t]},Sh?Bm=function(t){dv.nextTick(pv(t))}:nf&&nf.now?Bm=function(t){nf.now(pv(t))}:x_&&!ew?(iv=(Zb=new x_).port2,Zb.port1.onmessage=fv,Bm=av(iv.postMessage,iv)):To.addEventListener&&cv(To.postMessage)&&!To.importScripts&&qa&&qa.protocol!=="file:"&&!Ea(mv)?(Bm=mv,To.addEventListener("message",fv,!1)):Bm=Xc in vu("script")?function(t){lv.appendChild(vu("script"))[Xc]=function(){lv.removeChild(this),Ho(t)}}:function(t){setTimeout(pv(t),0)});var gv={set:zm,clear:Su},Sd=function(){this.head=null,this.tail=null};Sd.prototype={add:function(t){var r={item:t,next:null},s=this.tail;s?s.next=r:this.head=r,this.tail=r},get:function(){var t=this.head;if(t)return(this.head=t.next)===null&&(this.tail=null),t.item}};var rf,L_,bd,M_,bh,nw=Sd,eA=/ipad|iphone|ipod/i.test(wt)&&typeof Pebble<"u",rw=/web0s(?!.*chrome)/i.test(wt),bu=M,tA=De,TD=Ve.f,_v=gv.set,nA=nw,sf=ks,CD=eA,Gm=rw,yv=Bp,Ji=bu.MutationObserver||bu.WebKitMutationObserver,rA=bu.document,iw=bu.process,Ev=bu.Promise,iA=TD(bu,"queueMicrotask"),vv=iA&&iA.value;if(!vv){var U_=new nA,Sv=function(){var t,r;for(yv&&(t=iw.domain)&&t.exit();r=U_.get();)try{r()}catch(s){throw U_.head&&rf(),s}t&&t.enter()};sf||yv||Gm||!Ji||!rA?!CD&&Ev&&Ev.resolve?((M_=Ev.resolve(void 0)).constructor=Ev,bh=tA(M_.then,M_),rf=function(){bh(Sv)}):yv?rf=function(){iw.nextTick(Sv)}:(_v=tA(_v,bu),rf=function(){_v(Sv)}):(L_=!0,bd=rA.createTextNode(""),new Ji(Sv).observe(bd,{characterData:!0}),rf=function(){bd.data=L_=!L_}),vv=function(t){U_.head||rf(),U_.add(t)}}var wc=vv,wh=function(t){try{return{error:!1,value:t()}}catch(r){return{error:!0,value:r}}},of=M.Promise,wd=typeof Deno=="object"&&Deno&&typeof Deno.version=="object",bv=!wd&&!Bp&&typeof window=="object"&&typeof document=="object",af=M,Th=of,sw=Oe,ow=ja,RD=k_,aw=br,ID=bv,sA=wd,wv=ui,V_=Th&&Th.prototype,Tv=aw("species"),cw=sw(af.PromiseRejectionEvent),lw=ow("Promise",function(){var t=RD(Th),r=t!==String(Th);if(!r&&wv===66||!V_.catch||!V_.finally)return!0;if(!wv||wv<51||!/native code/.test(t)){var s=new Th(function(c){c(1)}),a=function(c){c(function(){},function(){})};if((s.constructor={})[Tv]=a,!(s.then(function(){})instanceof a))return!0}return!r&&(ID||sA)&&!cw}),j_={CONSTRUCTOR:lw,REJECTION_EVENT:cw},Dl={},Cv=vt,Rv=TypeError,uw=function(t){var r,s;this.promise=new t(function(a,c){if(r!==void 0||s!==void 0)throw Rv("Bad Promise constructor");r=a,s=c}),this.resolve=Cv(r),this.reject=Cv(s)};Dl.f=function(t){return new uw(t)};var Hm,dw,AD=Hn,cf=Bp,Ch=M,Td=be,PD=Ed,Iv=vd,p=function(t){var r=bD(t);Go&&r&&!r[KI]&&nv(r,KI,{configurable:!0,get:function(){return this}})},g=vt,T=Oe,N=gt,V=P_,$=as,he=gv.set,Ce=wc,Me=function(t,r){try{arguments.length==1?console.error(t):console.error(t,r)}catch{}},ot=wh,xt=nw,Mt=yd,Dt=of,en=j_,cn=Dl,ln="Promise",cs=en.CONSTRUCTOR,et=en.REJECTION_EVENT,Fe=Mt.getterFor(ln),rt=Mt.set,Ft=Dt&&Dt.prototype,un=Dt,bn=Ft,In=Ch.TypeError,Bn=Ch.document,Ns=Ch.process,Or=cn.f,Rh=Or,OD=!!(Bn&&Bn.createEvent&&Ch.dispatchEvent),L3="unhandledrejection",M3=function(t){var r;return!(!N(t)||!T(r=t.then))&&r},U3=function(t,r){var s,a,c,d=r.value,h=r.state==1,m=h?t.ok:t.fail,y=t.resolve,v=t.reject,w=t.domain;try{m?(h||(r.rejection===2&&Uae(r),r.rejection=1),m===!0?s=d:(w&&w.enter(),s=m(d),w&&(w.exit(),c=!0)),s===t.promise?v(In("Promise-chain cycle")):(a=M3(s))?Td(a,s,y,v):y(s)):v(d)}catch(R){w&&!c&&w.exit(),v(R)}},V3=function(t,r){t.notified||(t.notified=!0,Ce(function(){for(var s,a=t.reactions;s=a.get();)U3(s,t);t.notified=!1,r&&!t.rejection&&Mae(t)}))},j3=function(t,r,s){var a,c;OD?((a=Bn.createEvent("Event")).promise=r,a.reason=s,a.initEvent(t,!1,!0),Ch.dispatchEvent(a)):a={promise:r,reason:s},!et&&(c=Ch["on"+t])?c(a):t===L3&&Me("Unhandled promise rejection",s)},Mae=function(t){Td(he,Ch,function(){var r,s=t.facade,a=t.value;if(F3(t)&&(r=ot(function(){cf?Ns.emit("unhandledRejection",a,s):j3(L3,s,a)}),t.rejection=cf||F3(t)?2:1,r.error))throw r.value})},F3=function(t){return t.rejection!==1&&!t.parent},Uae=function(t){Td(he,Ch,function(){var r=t.facade;cf?Ns.emit("rejectionHandled",r):j3("rejectionhandled",r,t.value)})},Av=function(t,r,s){return function(a){t(r,a,s)}},Pv=function(t,r,s){t.done||(t.done=!0,s&&(t=s),t.value=r,t.state=2,V3(t,!0))},kD=function(t,r,s){if(!t.done){t.done=!0,s&&(t=s);try{if(t.facade===r)throw In("Promise can't be resolved itself");var a=M3(r);a?Ce(function(){var c={done:!1};try{Td(a,r,Av(kD,c,t),Av(Pv,c,t))}catch(d){Pv(c,d,t)}}):(t.value=r,t.state=1,V3(t,!1))}catch(c){Pv({done:!1},c,t)}}};cs&&(bn=(un=function(t){V(this,bn),g(t),Td(Hm,this);var r=Fe(this);try{t(Av(kD,r),Av(Pv,r))}catch(s){Pv(r,s)}}).prototype,(Hm=function(t){rt(this,{type:ln,done:!1,notified:!1,parent:!1,reactions:new xt,rejection:!1,state:0,value:void 0})}).prototype=PD(bn,"then",function(t,r){var s=Fe(this),a=Or($(this,un));return s.parent=!0,a.ok=!T(t)||t,a.fail=T(r)&&r,a.domain=cf?Ns.domain:void 0,s.state==0?s.reactions.add(a):Ce(function(){U3(a,s)}),a.promise}),dw=function(){var t=new Hm,r=Fe(t);this.promise=t,this.resolve=Av(kD,r),this.reject=Av(Pv,r)},cn.f=Or=function(t){return t===un||t===void 0?new dw(t):Rh(t)}),AD({global:!0,wrap:!0,forced:cs},{Promise:un}),Iv(un,ln,!1,!0),p(ln);var B3=br("iterator"),W3=!1;try{var Vae=0,z3={next:function(){return{done:!!Vae++}},return:function(){W3=!0}};z3[B3]=function(){return this},Array.from(z3,function(){throw 2})}catch{}var jae=of,Fae=function(t,r){if(!W3)return!1;var s=!1;try{var a={};a[B3]=function(){return{next:function(){return{done:s=!0}}}},t(a)}catch{}return s},oA=j_.CONSTRUCTOR||!Fae(function(t){jae.all(t).then(void 0,function(){})}),Bae=be,Wae=vt,zae=Dl,Gae=wh,Hae=yh;Hn({target:"Promise",stat:!0,forced:oA},{all:function(t){var r=this,s=zae.f(r),a=s.resolve,c=s.reject,d=Gae(function(){var h=Wae(r.resolve),m=[],y=0,v=1;Hae(t,function(w){var R=y++,O=!1;v++,Bae(h,r,w).then(function(D){O||(O=!0,m[R]=D,--v||a(m))},c)}),--v||a(m)});return d.error&&c(d.value),s.promise}});var $ae=Hn,Kae=j_.CONSTRUCTOR;of&&of.prototype,$ae({target:"Promise",proto:!0,forced:Kae,real:!0},{catch:function(t){return this.then(void 0,t)}});var qae=be,Yae=vt,Xae=Dl,Jae=wh,Qae=yh;Hn({target:"Promise",stat:!0,forced:oA},{race:function(t){var r=this,s=Xae.f(r),a=s.reject,c=Jae(function(){var d=Yae(r.resolve);Qae(t,function(h){qae(d,r,h).then(s.resolve,a)})});return c.error&&a(c.value),s.promise}});var Zae=be,ece=Dl;Hn({target:"Promise",stat:!0,forced:j_.CONSTRUCTOR},{reject:function(t){var r=ece.f(this);return Zae(r.reject,void 0,t),r.promise}});var tce=mn,nce=gt,rce=Dl,G3=function(t,r){if(tce(t),nce(r)&&r.constructor===t)return r;var s=rce.f(t);return(0,s.resolve)(r),s.promise},ice=Hn,sce=of,oce=j_.CONSTRUCTOR,ace=G3,cce=sn("Promise"),lce=!oce;ice({target:"Promise",stat:!0,forced:!0},{resolve:function(t){return ace(lce&&this===cce?sce:this,t)}});var uce=be,dce=vt,hce=Dl,pce=wh,fce=yh;Hn({target:"Promise",stat:!0,forced:oA},{allSettled:function(t){var r=this,s=hce.f(r),a=s.resolve,c=s.reject,d=pce(function(){var h=dce(r.resolve),m=[],y=0,v=1;fce(t,function(w){var R=y++,O=!1;v++,uce(h,r,w).then(function(D){O||(O=!0,m[R]={status:"fulfilled",value:D},--v||a(m))},function(D){O||(O=!0,m[R]={status:"rejected",reason:D},--v||a(m))})}),--v||a(m)});return d.error&&c(d.value),s.promise}});var mce=be,gce=vt,_ce=sn,yce=Dl,Ece=wh,vce=yh,H3="No one promise resolved";Hn({target:"Promise",stat:!0,forced:oA},{any:function(t){var r=this,s=_ce("AggregateError"),a=yce.f(r),c=a.resolve,d=a.reject,h=Ece(function(){var m=gce(r.resolve),y=[],v=0,w=1,R=!1;vce(t,function(O){var D=v++,G=!1;w++,mce(m,r,O).then(function(j){G||R||(R=!0,c(j))},function(j){G||R||(G=!0,y[D]=j,--w||d(new s(y,H3)))})}),--w||d(new s(y,H3))});return h.error&&d(h.value),a.promise}});var Sce=Hn,ND=of,bce=u,wce=sn,Tce=Oe,Cce=as,$3=G3,Rce=ND&&ND.prototype;Sce({target:"Promise",proto:!0,real:!0,forced:!!ND&&bce(function(){Rce.finally.call({then:function(){}},function(){})})},{finally:function(t){var r=Cce(this,wce("Promise")),s=Tce(t);return this.then(s?function(a){return $3(r,t()).then(function(){return a})}:t,s?function(a){return $3(r,t()).then(function(){throw a})}:t)}});var DD=I,Ice=jc,Ace=Ba,Pce=Lt,Oce=DD("".charAt),K3=DD("".charCodeAt),kce=DD("".slice),q3=function(t){return function(r,s){var a,c,d=Ace(Pce(r)),h=Ice(s),m=d.length;return h<0||h>=m?t?"":void 0:(a=K3(d,h))<55296||a>56319||h+1===m||(c=K3(d,h+1))<56320||c>57343?t?Oce(d,h):a:t?kce(d,h,h+2):c-56320+(a-55296<<10)+65536}},xD={codeAt:q3(!1),charAt:q3(!0)},Nce=xD.charAt,Dce=Ba,Y3=yd,xce=JE,X3=QE,J3="String Iterator",Lce=Y3.set,Mce=Y3.getterFor(J3);xce(String,"String",function(t){Lce(this,{type:J3,string:Dce(t),index:0})},function(){var t,r=Mce(this),s=r.string,a=r.index;return a>=s.length?X3(void 0,!0):(t=Nce(s,a),r.index+=t.length,X3(t,!1))});var Uce=Et.Promise,Vce={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},jce=M,Fce=Fc,Bce=ha,Q3=mh,Z3=br("toStringTag");for(var LD in Vce){var e5=jce[LD],MD=e5&&e5.prototype;MD&&Fce(MD)!==Z3&&Bce(MD,Z3,LD),Q3[LD]=Q3.Array}var t5=Uce,pt=l(t5),Wce=yc("Array").values,zce=Fc,Gce=Pi,Hce=P,$ce=Wce,UD=Array.prototype,Kce={DOMTokenList:!0,NodeList:!0},qce=function(t){var r=t.values;return t===UD||Hce(UD,t)&&r===UD.values||Gce(Kce,zce(t))?$ce:r},Jc=l(qce),Yce=u,Xce=br("iterator"),VD=!Yce(function(){var t=new URL("b?a=1&b=2&c=3","http://a"),r=t.searchParams,s=new URLSearchParams("a=1&a=2"),a="";return t.pathname="c%20d",r.forEach(function(c,d){r.delete("b"),a+=d+c}),s.delete("a",2),!t.toJSON||!s.has("a",1)||s.has("a",2)||!r.size&&!0||!r.sort||t.href!=="http://a/c%20d?a=1&c=3"||r.get("c")!=="3"||String(new URLSearchParams("?a=1"))!=="a=1"||!r[Xce]||new URL("https://a@b").username!=="a"||new URLSearchParams(new URLSearchParams("a=b")).get("a")!=="b"||new URL("http://").host!=="xn--e1aybc"||new URL("http://a#").hash!=="#%D0%B1"||a!=="a1c3"||new URL("http://x",void 0).host!=="x"}),Jce=Ed,Qce=gc,Zce=it,ele=qe,aA=function(t,r,s){var a=Qce(r);a in t?Zce.f(t,a,ele(0,s)):t[a]=s},n5=ge,tle=Ei,nle=aA,rle=Array,ile=Math.max,jD=function(t,r,s){for(var a=tle(t),c=n5(r,a),d=n5(s===void 0?a:s,a),h=rle(ile(d-c,0)),m=0;c<d;c++,m++)nle(h,m,t[c]);return h.length=m,h},r5=jD,sle=Math.floor,FD=function(t,r){var s=t.length,a=sle(s/2);return s<8?ole(t,r):ale(t,FD(r5(t,0,a),r),FD(r5(t,a),r),r)},ole=function(t,r){for(var s,a,c=t.length,d=1;d<c;){for(a=d,s=t[d];a&&r(t[a-1],s)>0;)t[a]=t[--a];a!==d++&&(t[a]=s)}return t},ale=function(t,r,s,a){for(var c=r.length,d=s.length,h=0,m=0;h<c||m<d;)t[h+m]=h<c&&m<d?a(r[h],s[m])<=0?r[h++]:s[m++]:h<c?r[h++]:s[m++];return t},i5=FD,BD=Hn,Ov=M,cA=be,Ih=I,kv=xe,s5=VD,o5=Ed,cle=tv,lle=function(t,r,s){for(var a in r)s&&s.unsafe&&t[a]?t[a]=r[a]:Jce(t,a,r[a],s);return t},ule=vd,dle=KE,WD=yd,a5=P_,zD=Oe,hle=Pi,ple=De,fle=Fc,mle=mn,c5=gt,Tc=Ba,gle=ma,l5=qe,GD=v_,_le=gd,Nv=Nl,yle=i5,Ele=br("iterator"),hw="URLSearchParams",u5=hw+"Iterator",d5=WD.set,wu=WD.getterFor(hw),vle=WD.getterFor(u5),Sle=Object.getOwnPropertyDescriptor,HD=function(t){if(!kv)return Ov[t];var r=Sle(Ov,t);return r&&r.value},h5=HD("fetch"),lA=HD("Request"),pw=HD("Headers"),$D=lA&&lA.prototype,p5=pw&&pw.prototype,ble=Ov.RegExp,wle=Ov.TypeError,f5=Ov.decodeURIComponent,Tle=Ov.encodeURIComponent,Cle=Ih("".charAt),m5=Ih([].join),F_=Ih([].push),KD=Ih("".replace),Rle=Ih([].shift),g5=Ih([].splice),_5=Ih("".split),Ile=Ih("".slice),Ale=/\+/g,y5=Array(4),Ple=function(t){return y5[t-1]||(y5[t-1]=ble("((?:%[\\da-f]{2}){"+t+"})","gi"))},Ole=function(t){try{return f5(t)}catch{return t}},E5=function(t){var r=KD(t,Ale," "),s=4;try{return f5(r)}catch{for(;s;)r=KD(r,Ple(s--),Ole);return r}},kle=/[!'()~]|%20/g,Nle={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},Dle=function(t){return Nle[t]},v5=function(t){return KD(Tle(t),kle,Dle)},qD=dle(function(t,r){d5(this,{type:u5,iterator:GD(wu(t).entries),kind:r})},"Iterator",function(){var t=vle(this),r=t.kind,s=t.iterator.next(),a=s.value;return s.done||(s.value=r==="keys"?a.key:r==="values"?a.value:[a.key,a.value]),s},!0),S5=function(t){this.entries=[],this.url=null,t!==void 0&&(c5(t)?this.parseObject(t):this.parseQuery(typeof t=="string"?Cle(t,0)==="?"?Ile(t,1):t:Tc(t)))};S5.prototype={type:hw,bindURL:function(t){this.url=t,this.update()},parseObject:function(t){var r,s,a,c,d,h,m,y=_le(t);if(y)for(s=(r=GD(t,y)).next;!(a=cA(s,r)).done;){if(d=(c=GD(mle(a.value))).next,(h=cA(d,c)).done||(m=cA(d,c)).done||!cA(d,c).done)throw wle("Expected sequence with length 2");F_(this.entries,{key:Tc(h.value),value:Tc(m.value)})}else for(var v in t)hle(t,v)&&F_(this.entries,{key:v,value:Tc(t[v])})},parseQuery:function(t){if(t)for(var r,s,a=_5(t,"&"),c=0;c<a.length;)(r=a[c++]).length&&(s=_5(r,"="),F_(this.entries,{key:E5(Rle(s)),value:E5(m5(s,"="))}))},serialize:function(){for(var t,r=this.entries,s=[],a=0;a<r.length;)t=r[a++],F_(s,v5(t.key)+"="+v5(t.value));return m5(s,"&")},update:function(){this.entries.length=0,this.parseQuery(this.url.query)},updateURL:function(){this.url&&this.url.update()}};var uA=function(){a5(this,Dv);var t=d5(this,new S5(arguments.length>0?arguments[0]:void 0));kv||(this.size=t.entries.length)},Dv=uA.prototype;if(lle(Dv,{append:function(t,r){var s=wu(this);Nv(arguments.length,2),F_(s.entries,{key:Tc(t),value:Tc(r)}),kv||this.length++,s.updateURL()},delete:function(t){for(var r=wu(this),s=Nv(arguments.length,1),a=r.entries,c=Tc(t),d=s<2?void 0:arguments[1],h=d===void 0?d:Tc(d),m=0;m<a.length;){var y=a[m];if(y.key!==c||h!==void 0&&y.value!==h)m++;else if(g5(a,m,1),h!==void 0)break}kv||(this.size=a.length),r.updateURL()},get:function(t){var r=wu(this).entries;Nv(arguments.length,1);for(var s=Tc(t),a=0;a<r.length;a++)if(r[a].key===s)return r[a].value;return null},getAll:function(t){var r=wu(this).entries;Nv(arguments.length,1);for(var s=Tc(t),a=[],c=0;c<r.length;c++)r[c].key===s&&F_(a,r[c].value);return a},has:function(t){for(var r=wu(this).entries,s=Nv(arguments.length,1),a=Tc(t),c=s<2?void 0:arguments[1],d=c===void 0?c:Tc(c),h=0;h<r.length;){var m=r[h++];if(m.key===a&&(d===void 0||m.value===d))return!0}return!1},set:function(t,r){var s=wu(this);Nv(arguments.length,1);for(var a,c=s.entries,d=!1,h=Tc(t),m=Tc(r),y=0;y<c.length;y++)(a=c[y]).key===h&&(d?g5(c,y--,1):(d=!0,a.value=m));d||F_(c,{key:h,value:m}),kv||(this.size=c.length),s.updateURL()},sort:function(){var t=wu(this);yle(t.entries,function(r,s){return r.key>s.key?1:-1}),t.updateURL()},forEach:function(t){for(var r,s=wu(this).entries,a=ple(t,arguments.length>1?arguments[1]:void 0),c=0;c<s.length;)a((r=s[c++]).value,r.key,this)},keys:function(){return new qD(this,"keys")},values:function(){return new qD(this,"values")},entries:function(){return new qD(this,"entries")}},{enumerable:!0}),o5(Dv,Ele,Dv.entries,{}),o5(Dv,"toString",function(){return wu(this).serialize()},{enumerable:!0}),kv&&cle(Dv,"size",{get:function(){return wu(this).entries.length},configurable:!0,enumerable:!0}),ule(uA,hw),BD({global:!0,forced:!s5},{URLSearchParams:uA}),!s5&&zD(pw)){var xle=Ih(p5.has),Lle=Ih(p5.set),b5=function(t){if(c5(t)){var r,s=t.body;if(fle(s)===hw)return r=t.headers?new pw(t.headers):new pw,xle(r,"content-type")||Lle(r,"content-type","application/x-www-form-urlencoded;charset=UTF-8"),gle(t,{body:l5(0,Tc(s)),headers:l5(0,r)})}return t};if(zD(h5)&&BD({global:!0,dontCallGetSet:!0,forced:!0},{fetch:function(t){return h5(t,arguments.length>1?b5(arguments[1]):{})}}),zD(lA)){var YD=function(t){return a5(this,$D),new lA(t,arguments.length>1?b5(arguments[1]):{})};$D.constructor=YD,YD.prototype=$D,BD({global:!0,dontCallGetSet:!0,forced:!0},{Request:YD})}}var Tu,Mle={URLSearchParams:uA,getState:wu},Ule=Et.URLSearchParams,w5=xe,Vle=I,jle=be,Fle=u,XD=zc,Ble=Wc,Wle=We,zle=ra,Gle=kt,xv=Object.assign,T5=Object.defineProperty,Hle=Vle([].concat),$le=!xv||Fle(function(){if(w5&&xv({b:1},xv(T5({},"a",{enumerable:!0,get:function(){T5(this,"b",{value:3,enumerable:!1})}}),{b:2})).b!==1)return!0;var t={},r={},s=Symbol(),a="abcdefghijklmnopqrst";return t[s]=7,a.split("").forEach(function(c){r[c]=c}),xv({},t)[s]!=7||XD(xv({},r)).join("")!=a})?function(t,r){for(var s=zle(t),a=arguments.length,c=1,d=Ble.f,h=Wle.f;a>c;)for(var m,y=Gle(arguments[c++]),v=d?Hle(XD(y),d(y)):XD(y),w=v.length,R=0;w>R;)m=v[R++],w5&&!jle(h,y,m)||(s[m]=y[m]);return s}:xv,Kle=mn,qle=S_,Yle=De,Xle=be,Jle=ra,Qle=function(t,r,s,a){try{return a?r(Kle(s)[0],s[1]):r(s)}catch(c){qle(t,"throw",c)}},Zle=E_,eue=N_,tue=Ei,C5=aA,nue=v_,rue=gd,R5=Array,B_=I,JD=2147483647,iue=/[^\0-\u007E]/,I5=/[.\u3002\uFF0E\uFF61]/g,A5="Overflow: input needs wider integers to process",P5=RangeError,sue=B_(I5.exec),Lv=Math.floor,QD=String.fromCharCode,O5=B_("".charCodeAt),k5=B_([].join),$m=B_([].push),oue=B_("".replace),aue=B_("".split),cue=B_("".toLowerCase),N5=function(t){return t+22+75*(t<26)},lue=function(t,r,s){var a=0;for(t=s?Lv(t/700):t>>1,t+=Lv(t/r);t>455;)t=Lv(t/35),a+=36;return Lv(a+36*t/(t+38))},uue=function(t){var r=[];t=function(Q){for(var ee=[],fe=0,ye=Q.length;fe<ye;){var Ee=O5(Q,fe++);if(Ee>=55296&&Ee<=56319&&fe<ye){var _e=O5(Q,fe++);(64512&_e)==56320?$m(ee,((1023&Ee)<<10)+(1023&_e)+65536):($m(ee,Ee),fe--)}else $m(ee,Ee)}return ee}(t);var s,a,c=t.length,d=128,h=0,m=72;for(s=0;s<t.length;s++)(a=t[s])<128&&$m(r,QD(a));var y=r.length,v=y;for(y&&$m(r,"-");v<c;){var w=JD;for(s=0;s<t.length;s++)(a=t[s])>=d&&a<w&&(w=a);var R=v+1;if(w-d>Lv((JD-h)/R))throw P5(A5);for(h+=(w-d)*R,d=w,s=0;s<t.length;s++){if((a=t[s])<d&&++h>JD)throw P5(A5);if(a==d){for(var O=h,D=36;;){var G=D<=m?1:D>=m+26?26:D-m;if(O<G)break;var j=O-G,W=36-G;$m(r,QD(N5(G+j%W))),O=Lv(j/W),D+=36}$m(r,QD(N5(O))),m=lue(h,R,v==y),h=0,v++}}h++,d++}return k5(r,"")},due=Hn,ZD=xe,hue=VD,ex=M,D5=De,Cu=I,dA=Ed,Ru=tv,pue=P_,tx=Pi,nx=$le,Mv=function(t){var r=Jle(t),s=eue(this),a=arguments.length,c=a>1?arguments[1]:void 0,d=c!==void 0;d&&(c=Yle(c,a>2?arguments[2]:void 0));var h,m,y,v,w,R,O=rue(r),D=0;if(!O||this===R5&&Zle(O))for(h=tue(r),m=s?new this(h):R5(h);h>D;D++)R=d?c(r[D],D):r[D],C5(m,D,R);else for(w=(v=nue(r,O)).next,m=s?new this:[];!(y=Xle(w,v)).done;D++)R=d?Qle(v,c,[y.value,D],!0):y.value,C5(m,D,R);return m.length=D,m},Cd=jD,fue=xD.codeAt,mue=function(t){var r,s,a=[],c=aue(oue(cue(t),I5,"."),".");for(r=0;r<c.length;r++)s=c[r],$m(a,sue(iue,s)?"xn--"+uue(s):s);return k5(a,".")},lf=Ba,gue=vd,_ue=Nl,x5=Mle,L5=yd,yue=L5.set,hA=L5.getterFor("URL"),Eue=x5.URLSearchParams,vue=x5.getState,fw=ex.URL,rx=ex.TypeError,pA=ex.parseInt,Sue=Math.floor,M5=Math.pow,Iu=Cu("".charAt),Rd=Cu(/./.exec),mw=Cu([].join),bue=Cu(1 .toString),wue=Cu([].pop),Uv=Cu([].push),ix=Cu("".replace),Tue=Cu([].shift),Cue=Cu("".split),gw=Cu("".slice),fA=Cu("".toLowerCase),Rue=Cu([].unshift),sx="Invalid scheme",W_="Invalid host",U5="Invalid port",V5=/[a-z]/i,Iue=/[\d+-.a-z]/i,ox=/\d/,Aue=/^0x/i,Pue=/^[0-7]+$/,Oue=/^\d+$/,j5=/^[\da-f]+$/i,kue=/[\0\t\n\r #%/:<>?@[\\\]^|]/,Nue=/[\0\t\n\r #/:<>?@[\\\]^|]/,Due=/^[\u0000-\u0020]+/,xue=/(^|[^\u0000-\u0020])[\u0000-\u0020]+$/,Lue=/[\t\n\r]/g,_w=function(t){var r,s,a,c;if(typeof t=="number"){for(r=[],s=0;s<4;s++)Rue(r,t%256),t=Sue(t/256);return mw(r,".")}if(typeof t=="object"){for(r="",a=function(d){for(var h=null,m=1,y=null,v=0,w=0;w<8;w++)d[w]!==0?(v>m&&(h=y,m=v),y=null,v=0):(y===null&&(y=w),++v);return v>m&&(h=y,m=v),h}(t),s=0;s<8;s++)c&&t[s]===0||(c&&(c=!1),a===s?(r+=s?":":"::",c=!0):(r+=bue(t[s],16),s<7&&(r+=":")));return"["+r+"]"}return t},mA={},F5=nx({},mA,{" ":1,'"':1,"<":1,">":1,"`":1}),B5=nx({},F5,{"#":1,"?":1,"{":1,"}":1}),ax=nx({},B5,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),Km=function(t,r){var s=fue(t,0);return s>32&&s<127&&!tx(r,t)?t:encodeURIComponent(t)},gA={ftp:21,file:null,http:80,https:443,ws:80,wss:443},yw=function(t,r){var s;return t.length==2&&Rd(V5,Iu(t,0))&&((s=Iu(t,1))==":"||!r&&s=="|")},W5=function(t){var r;return t.length>1&&yw(gw(t,0,2))&&(t.length==2||(r=Iu(t,2))==="/"||r==="\\"||r==="?"||r==="#")},Mue=function(t){return t==="."||fA(t)==="%2e"},cx={},z5={},lx={},G5={},H5={},ux={},$5={},K5={},_A={},yA={},dx={},hx={},px={},fx={},q5={},mx={},Vv={},Ah={},Y5={},z_={},uf={},gx=function(t,r,s){var a,c,d,h=lf(t);if(r){if(c=this.parse(h))throw rx(c);this.searchParams=null}else{if(s!==void 0&&(a=new gx(s,!0)),c=this.parse(h,null,a))throw rx(c);(d=vue(new Eue)).bindURL(this),this.searchParams=d}};gx.prototype={type:"URL",parse:function(t,r,s){var a,c,d,h,m,y=this,v=r||cx,w=0,R="",O=!1,D=!1,G=!1;for(t=lf(t),r||(y.scheme="",y.username="",y.password="",y.host=null,y.port=null,y.path=[],y.query=null,y.fragment=null,y.cannotBeABaseURL=!1,t=ix(t,Due,""),t=ix(t,xue,"$1")),t=ix(t,Lue,""),a=Mv(t);w<=a.length;){switch(c=a[w],v){case cx:if(!c||!Rd(V5,c)){if(r)return sx;v=lx;continue}R+=fA(c),v=z5;break;case z5:if(c&&(Rd(Iue,c)||c=="+"||c=="-"||c=="."))R+=fA(c);else{if(c!=":"){if(r)return sx;R="",v=lx,w=0;continue}if(r&&(y.isSpecial()!=tx(gA,R)||R=="file"&&(y.includesCredentials()||y.port!==null)||y.scheme=="file"&&!y.host))return;if(y.scheme=R,r)return void(y.isSpecial()&&gA[y.scheme]==y.port&&(y.port=null));R="",y.scheme=="file"?v=fx:y.isSpecial()&&s&&s.scheme==y.scheme?v=G5:y.isSpecial()?v=K5:a[w+1]=="/"?(v=H5,w++):(y.cannotBeABaseURL=!0,Uv(y.path,""),v=Y5)}break;case lx:if(!s||s.cannotBeABaseURL&&c!="#")return sx;if(s.cannotBeABaseURL&&c=="#"){y.scheme=s.scheme,y.path=Cd(s.path),y.query=s.query,y.fragment="",y.cannotBeABaseURL=!0,v=uf;break}v=s.scheme=="file"?fx:ux;continue;case G5:if(c!="/"||a[w+1]!="/"){v=ux;continue}v=_A,w++;break;case H5:if(c=="/"){v=yA;break}v=Ah;continue;case ux:if(y.scheme=s.scheme,c==Tu)y.username=s.username,y.password=s.password,y.host=s.host,y.port=s.port,y.path=Cd(s.path),y.query=s.query;else if(c=="/"||c=="\\"&&y.isSpecial())v=$5;else if(c=="?")y.username=s.username,y.password=s.password,y.host=s.host,y.port=s.port,y.path=Cd(s.path),y.query="",v=z_;else{if(c!="#"){y.username=s.username,y.password=s.password,y.host=s.host,y.port=s.port,y.path=Cd(s.path),y.path.length--,v=Ah;continue}y.username=s.username,y.password=s.password,y.host=s.host,y.port=s.port,y.path=Cd(s.path),y.query=s.query,y.fragment="",v=uf}break;case $5:if(!y.isSpecial()||c!="/"&&c!="\\"){if(c!="/"){y.username=s.username,y.password=s.password,y.host=s.host,y.port=s.port,v=Ah;continue}v=yA}else v=_A;break;case K5:if(v=_A,c!="/"||Iu(R,w+1)!="/")continue;w++;break;case _A:if(c!="/"&&c!="\\"){v=yA;continue}break;case yA:if(c=="@"){O&&(R="%40"+R),O=!0,d=Mv(R);for(var j=0;j<d.length;j++){var W=d[j];if(W!=":"||G){var Q=Km(W,ax);G?y.password+=Q:y.username+=Q}else G=!0}R=""}else if(c==Tu||c=="/"||c=="?"||c=="#"||c=="\\"&&y.isSpecial()){if(O&&R=="")return"Invalid authority";w-=Mv(R).length+1,R="",v=dx}else R+=c;break;case dx:case hx:if(r&&y.scheme=="file"){v=mx;continue}if(c!=":"||D){if(c==Tu||c=="/"||c=="?"||c=="#"||c=="\\"&&y.isSpecial()){if(y.isSpecial()&&R=="")return W_;if(r&&R==""&&(y.includesCredentials()||y.port!==null))return;if(h=y.parseHost(R))return h;if(R="",v=Vv,r)return;continue}c=="["?D=!0:c=="]"&&(D=!1),R+=c}else{if(R=="")return W_;if(h=y.parseHost(R))return h;if(R="",v=px,r==hx)return}break;case px:if(!Rd(ox,c)){if(c==Tu||c=="/"||c=="?"||c=="#"||c=="\\"&&y.isSpecial()||r){if(R!=""){var ee=pA(R,10);if(ee>65535)return U5;y.port=y.isSpecial()&&ee===gA[y.scheme]?null:ee,R=""}if(r)return;v=Vv;continue}return U5}R+=c;break;case fx:if(y.scheme="file",c=="/"||c=="\\")v=q5;else{if(!s||s.scheme!="file"){v=Ah;continue}if(c==Tu)y.host=s.host,y.path=Cd(s.path),y.query=s.query;else if(c=="?")y.host=s.host,y.path=Cd(s.path),y.query="",v=z_;else{if(c!="#"){W5(mw(Cd(a,w),""))||(y.host=s.host,y.path=Cd(s.path),y.shortenPath()),v=Ah;continue}y.host=s.host,y.path=Cd(s.path),y.query=s.query,y.fragment="",v=uf}}break;case q5:if(c=="/"||c=="\\"){v=mx;break}s&&s.scheme=="file"&&!W5(mw(Cd(a,w),""))&&(yw(s.path[0],!0)?Uv(y.path,s.path[0]):y.host=s.host),v=Ah;continue;case mx:if(c==Tu||c=="/"||c=="\\"||c=="?"||c=="#"){if(!r&&yw(R))v=Ah;else if(R==""){if(y.host="",r)return;v=Vv}else{if(h=y.parseHost(R))return h;if(y.host=="localhost"&&(y.host=""),r)return;R="",v=Vv}continue}R+=c;break;case Vv:if(y.isSpecial()){if(v=Ah,c!="/"&&c!="\\")continue}else if(r||c!="?")if(r||c!="#"){if(c!=Tu&&(v=Ah,c!="/"))continue}else y.fragment="",v=uf;else y.query="",v=z_;break;case Ah:if(c==Tu||c=="/"||c=="\\"&&y.isSpecial()||!r&&(c=="?"||c=="#")){if((m=fA(m=R))===".."||m==="%2e."||m===".%2e"||m==="%2e%2e"?(y.shortenPath(),c=="/"||c=="\\"&&y.isSpecial()||Uv(y.path,"")):Mue(R)?c=="/"||c=="\\"&&y.isSpecial()||Uv(y.path,""):(y.scheme=="file"&&!y.path.length&&yw(R)&&(y.host&&(y.host=""),R=Iu(R,0)+":"),Uv(y.path,R)),R="",y.scheme=="file"&&(c==Tu||c=="?"||c=="#"))for(;y.path.length>1&&y.path[0]==="";)Tue(y.path);c=="?"?(y.query="",v=z_):c=="#"&&(y.fragment="",v=uf)}else R+=Km(c,B5);break;case Y5:c=="?"?(y.query="",v=z_):c=="#"?(y.fragment="",v=uf):c!=Tu&&(y.path[0]+=Km(c,mA));break;case z_:r||c!="#"?c!=Tu&&(c=="'"&&y.isSpecial()?y.query+="%27":y.query+=c=="#"?"%23":Km(c,mA)):(y.fragment="",v=uf);break;case uf:c!=Tu&&(y.fragment+=Km(c,F5))}w++}},parseHost:function(t){var r,s,a;if(Iu(t,0)=="["){if(Iu(t,t.length-1)!="]"||(r=function(c){var d,h,m,y,v,w,R,O=[0,0,0,0,0,0,0,0],D=0,G=null,j=0,W=function(){return Iu(c,j)};if(W()==":"){if(Iu(c,1)!=":")return;j+=2,G=++D}for(;W();){if(D==8)return;if(W()!=":"){for(d=h=0;h<4&&Rd(j5,W());)d=16*d+pA(W(),16),j++,h++;if(W()=="."){if(h==0||(j-=h,D>6))return;for(m=0;W();){if(y=null,m>0){if(!(W()=="."&&m<4))return;j++}if(!Rd(ox,W()))return;for(;Rd(ox,W());){if(v=pA(W(),10),y===null)y=v;else{if(y==0)return;y=10*y+v}if(y>255)return;j++}O[D]=256*O[D]+y,++m!=2&&m!=4||D++}if(m!=4)return;break}if(W()==":"){if(j++,!W())return}else if(W())return;O[D++]=d}else{if(G!==null)return;j++,G=++D}}if(G!==null)for(w=D-G,D=7;D!=0&&w>0;)R=O[D],O[D--]=O[G+w-1],O[G+--w]=R;else if(D!=8)return;return O}(gw(t,1,-1)),!r))return W_;this.host=r}else if(this.isSpecial()){if(t=mue(t),Rd(kue,t)||(r=function(c){var d,h,m,y,v,w,R,O=Cue(c,".");if(O.length&&O[O.length-1]==""&&O.length--,(d=O.length)>4)return c;for(h=[],m=0;m<d;m++){if((y=O[m])=="")return c;if(v=10,y.length>1&&Iu(y,0)=="0"&&(v=Rd(Aue,y)?16:8,y=gw(y,v==8?1:2)),y==="")w=0;else{if(!Rd(v==10?Oue:v==8?Pue:j5,y))return c;w=pA(y,v)}Uv(h,w)}for(m=0;m<d;m++)if(w=h[m],m==d-1){if(w>=M5(256,5-d))return null}else if(w>255)return null;for(R=wue(h),m=0;m<h.length;m++)R+=h[m]*M5(256,3-m);return R}(t),r===null))return W_;this.host=r}else{if(Rd(Nue,t))return W_;for(r="",s=Mv(t),a=0;a<s.length;a++)r+=Km(s[a],mA);this.host=r}},cannotHaveUsernamePasswordPort:function(){return!this.host||this.cannotBeABaseURL||this.scheme=="file"},includesCredentials:function(){return this.username!=""||this.password!=""},isSpecial:function(){return tx(gA,this.scheme)},shortenPath:function(){var t=this.path,r=t.length;!r||this.scheme=="file"&&r==1&&yw(t[0],!0)||t.length--},serialize:function(){var t=this,r=t.scheme,s=t.username,a=t.password,c=t.host,d=t.port,h=t.path,m=t.query,y=t.fragment,v=r+":";return c!==null?(v+="//",t.includesCredentials()&&(v+=s+(a?":"+a:"")+"@"),v+=_w(c),d!==null&&(v+=":"+d)):r=="file"&&(v+="//"),v+=t.cannotBeABaseURL?h[0]:h.length?"/"+mw(h,"/"):"",m!==null&&(v+="?"+m),y!==null&&(v+="#"+y),v},setHref:function(t){var r=this.parse(t);if(r)throw rx(r);this.searchParams.update()},getOrigin:function(){var t=this.scheme,r=this.port;if(t=="blob")try{return new jv(t.path[0]).origin}catch{return"null"}return t!="file"&&this.isSpecial()?t+"://"+_w(this.host)+(r!==null?":"+r:""):"null"},getProtocol:function(){return this.scheme+":"},setProtocol:function(t){this.parse(lf(t)+":",cx)},getUsername:function(){return this.username},setUsername:function(t){var r=Mv(lf(t));if(!this.cannotHaveUsernamePasswordPort()){this.username="";for(var s=0;s<r.length;s++)this.username+=Km(r[s],ax)}},getPassword:function(){return this.password},setPassword:function(t){var r=Mv(lf(t));if(!this.cannotHaveUsernamePasswordPort()){this.password="";for(var s=0;s<r.length;s++)this.password+=Km(r[s],ax)}},getHost:function(){var t=this.host,r=this.port;return t===null?"":r===null?_w(t):_w(t)+":"+r},setHost:function(t){this.cannotBeABaseURL||this.parse(t,dx)},getHostname:function(){var t=this.host;return t===null?"":_w(t)},setHostname:function(t){this.cannotBeABaseURL||this.parse(t,hx)},getPort:function(){var t=this.port;return t===null?"":lf(t)},setPort:function(t){this.cannotHaveUsernamePasswordPort()||((t=lf(t))==""?this.port=null:this.parse(t,px))},getPathname:function(){var t=this.path;return this.cannotBeABaseURL?t[0]:t.length?"/"+mw(t,"/"):""},setPathname:function(t){this.cannotBeABaseURL||(this.path=[],this.parse(t,Vv))},getSearch:function(){var t=this.query;return t?"?"+t:""},setSearch:function(t){(t=lf(t))==""?this.query=null:(Iu(t,0)=="?"&&(t=gw(t,1)),this.query="",this.parse(t,z_)),this.searchParams.update()},getSearchParams:function(){return this.searchParams.facade},getHash:function(){var t=this.fragment;return t?"#"+t:""},setHash:function(t){(t=lf(t))!=""?(Iu(t,0)=="#"&&(t=gw(t,1)),this.fragment="",this.parse(t,uf)):this.fragment=null},update:function(){this.query=this.searchParams.serialize()||null}};var jv=function(t){var r=pue(this,Cc),s=_ue(arguments.length,1)>1?arguments[1]:void 0,a=yue(r,new gx(t,!1,s));ZD||(r.href=a.serialize(),r.origin=a.getOrigin(),r.protocol=a.getProtocol(),r.username=a.getUsername(),r.password=a.getPassword(),r.host=a.getHost(),r.hostname=a.getHostname(),r.port=a.getPort(),r.pathname=a.getPathname(),r.search=a.getSearch(),r.searchParams=a.getSearchParams(),r.hash=a.getHash())},Cc=jv.prototype,Au=function(t,r){return{get:function(){return hA(this)[t]()},set:r&&function(s){return hA(this)[r](s)},configurable:!0,enumerable:!0}};if(ZD&&(Ru(Cc,"href",Au("serialize","setHref")),Ru(Cc,"origin",Au("getOrigin")),Ru(Cc,"protocol",Au("getProtocol","setProtocol")),Ru(Cc,"username",Au("getUsername","setUsername")),Ru(Cc,"password",Au("getPassword","setPassword")),Ru(Cc,"host",Au("getHost","setHost")),Ru(Cc,"hostname",Au("getHostname","setHostname")),Ru(Cc,"port",Au("getPort","setPort")),Ru(Cc,"pathname",Au("getPathname","setPathname")),Ru(Cc,"search",Au("getSearch","setSearch")),Ru(Cc,"searchParams",Au("getSearchParams")),Ru(Cc,"hash",Au("getHash","setHash"))),dA(Cc,"toJSON",function(){return hA(this).serialize()},{enumerable:!0}),dA(Cc,"toString",function(){return hA(this).serialize()},{enumerable:!0}),fw){var X5=fw.createObjectURL,J5=fw.revokeObjectURL;X5&&dA(jv,"createObjectURL",D5(X5,fw)),J5&&dA(jv,"revokeObjectURL",D5(J5,fw))}gue(jv,"URL"),due({global:!0,forced:!hue,sham:!ZD},{URL:jv});var Uue=Hn,Vue=u,jue=Nl,Q5=Ba,Fue=VD,Z5=sn("URL");Uue({target:"URL",stat:!0,forced:!(Fue&&Vue(function(){Z5.canParse()}))},{canParse:function(t){var r=jue(arguments.length,1),s=Q5(t),a=r<2||arguments[1]===void 0?void 0:Q5(arguments[1]);try{return!!new Z5(s,a)}catch{return!1}}});var EA=l(Et.URL);let eB=!0,tB=!0;function vA(t,r,s){const a=t.match(r);return a&&a.length>=s&&parseInt(a[s],10)}function G_(t,r,s){if(!t.RTCPeerConnection)return;const a=t.RTCPeerConnection.prototype,c=a.addEventListener;a.addEventListener=function(h,m){if(h!==r)return c.apply(this,arguments);const y=v=>{const w=s(v);w&&(m.handleEvent?m.handleEvent(w):m(w))};return this._eventMap=this._eventMap||{},this._eventMap[r]||(this._eventMap[r]=new Map),this._eventMap[r].set(m,y),c.apply(this,[h,y])};const d=a.removeEventListener;a.removeEventListener=function(h,m){if(h!==r||!this._eventMap||!this._eventMap[r])return d.apply(this,arguments);if(!this._eventMap[r].has(m))return d.apply(this,arguments);const y=this._eventMap[r].get(m);return this._eventMap[r].delete(m),this._eventMap[r].size===0&&delete this._eventMap[r],Object.keys(this._eventMap).length===0&&delete this._eventMap,d.apply(this,[h,y])},Object.defineProperty(a,"on"+r,{get(){return this["_on"+r]},set(h){this["_on"+r]&&(this.removeEventListener(r,this["_on"+r]),delete this["_on"+r]),h&&this.addEventListener(r,this["_on"+r]=h)},enumerable:!0,configurable:!0})}function Bue(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):(eB=t,t?"adapter.js logging disabled":"adapter.js logging enabled")}function Wue(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):(tB=!t,"adapter.js deprecation warnings "+(t?"disabled":"enabled"))}function nB(){if(typeof window=="object"){if(eB)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function _x(t,r){tB&&console.warn(t+" is deprecated, please use "+r+" instead.")}function rB(t){return Object.prototype.toString.call(t)==="[object Object]"}function iB(t){var r;return rB(t)?Ec(r=Object.keys(t)).call(r,function(s,a){const c=rB(t[a]),d=c?iB(t[a]):t[a],h=c&&!Object.keys(d).length;return d===void 0||h?s:Object.assign(s,{[a]:d})},{}):t}function yx(t,r,s){r&&!s.has(r.id)&&(s.set(r.id,r),Object.keys(r).forEach(a=>{a.endsWith("Id")?yx(t,t.get(r[a]),s):a.endsWith("Ids")&&r[a].forEach(c=>{yx(t,t.get(c),s)})}))}function sB(t,r,s){const a=s?"outbound-rtp":"inbound-rtp",c=new Map;if(r===null)return c;const d=[];return t.forEach(h=>{h.type==="track"&&h.trackIdentifier===r.id&&d.push(h)}),d.forEach(h=>{t.forEach(m=>{m.type===a&&m.trackId===h.id&&yx(t,m,c)})}),c}const oB=nB;function aB(t,r){const s=t&&t.navigator;if(!s.mediaDevices)return;const a=function(h){if(typeof h!="object"||h.mandatory||h.optional)return h;const m={};return Object.keys(h).forEach(y=>{if(y==="require"||y==="advanced"||y==="mediaSource")return;const v=typeof h[y]=="object"?h[y]:{ideal:h[y]};v.exact!==void 0&&typeof v.exact=="number"&&(v.min=v.max=v.exact);const w=function(R,O){return R?R+O.charAt(0).toUpperCase()+O.slice(1):O==="deviceId"?"sourceId":O};if(v.ideal!==void 0){m.optional=m.optional||[];let R={};typeof v.ideal=="number"?(R[w("min",y)]=v.ideal,m.optional.push(R),R={},R[w("max",y)]=v.ideal,m.optional.push(R)):(R[w("",y)]=v.ideal,m.optional.push(R))}v.exact!==void 0&&typeof v.exact!="number"?(m.mandatory=m.mandatory||{},m.mandatory[w("",y)]=v.exact):["min","max"].forEach(R=>{v[R]!==void 0&&(m.mandatory=m.mandatory||{},m.mandatory[w(R,y)]=v[R])})}),h.advanced&&(m.optional=(m.optional||[]).concat(h.advanced)),m},c=function(h,m){if(r.version>=61)return m(h);if((h=JSON.parse(JSON.stringify(h)))&&typeof h.audio=="object"){const y=function(v,w,R){w in v&&!(R in v)&&(v[R]=v[w],delete v[w])};y((h=JSON.parse(JSON.stringify(h))).audio,"autoGainControl","googAutoGainControl"),y(h.audio,"noiseSuppression","googNoiseSuppression"),h.audio=a(h.audio)}if(h&&typeof h.video=="object"){let y=h.video.facingMode;y=y&&(typeof y=="object"?y:{ideal:y});const v=r.version<66;if(y&&(y.exact==="user"||y.exact==="environment"||y.ideal==="user"||y.ideal==="environment")&&(!s.mediaDevices.getSupportedConstraints||!s.mediaDevices.getSupportedConstraints().facingMode||v)){let w;if(delete h.video.facingMode,y.exact==="environment"||y.ideal==="environment"?w=["back","rear"]:y.exact!=="user"&&y.ideal!=="user"||(w=["front"]),w)return s.mediaDevices.enumerateDevices().then(R=>{let O=(R=R.filter(D=>D.kind==="videoinput")).find(D=>w.some(G=>{var j;return lt(j=D.label.toLowerCase()).call(j,G)}));return!O&&R.length&&lt(w).call(w,"back")&&(O=R[R.length-1]),O&&(h.video.deviceId=y.exact?{exact:O.deviceId}:{ideal:O.deviceId}),h.video=a(h.video),oB("chrome: "+JSON.stringify(h)),m(h)})}h.video=a(h.video)}return oB("chrome: "+JSON.stringify(h)),m(h)},d=function(h){return r.version>=64?h:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[h.name]||h.name,message:h.message,constraint:h.constraint||h.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(s.getUserMedia=(function(h,m,y){c(h,v=>{s.webkitGetUserMedia(v,m,w=>{y&&y(d(w))})})}).bind(s),s.mediaDevices.getUserMedia){const h=s.mediaDevices.getUserMedia.bind(s.mediaDevices);s.mediaDevices.getUserMedia=function(m){return c(m,y=>h(y).then(v=>{if(y.audio&&!v.getAudioTracks().length||y.video&&!v.getVideoTracks().length)throw v.getTracks().forEach(w=>{w.stop()}),new DOMException("","NotFoundError");return v},v=>pt.reject(d(v))))}}}function cB(t){t.MediaStream=t.MediaStream||t.webkitMediaStream}function lB(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("ontrack"in t.RTCPeerConnection.prototype)){Object.defineProperty(t.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(s){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=s)},enumerable:!0,configurable:!0});const r=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=s=>{s.stream.addEventListener("addtrack",a=>{let c;c=t.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(h=>h.track&&h.track.id===a.track.id):{track:a.track};const d=new Event("track");d.track=a.track,d.receiver=c,d.transceiver={receiver:c},d.streams=[s.stream],this.dispatchEvent(d)}),s.stream.getTracks().forEach(a=>{let c;c=t.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(h=>h.track&&h.track.id===a.id):{track:a};const d=new Event("track");d.track=a,d.receiver=c,d.transceiver={receiver:c},d.streams=[s.stream],this.dispatchEvent(d)})},this.addEventListener("addstream",this._ontrackpoly)),r.apply(this,arguments)}}else G_(t,"track",r=>(r.transceiver||Object.defineProperty(r,"transceiver",{value:{receiver:r.receiver}}),r))}function uB(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("getSenders"in t.RTCPeerConnection.prototype)&&"createDTMFSender"in t.RTCPeerConnection.prototype){const r=function(c,d){return{track:d,get dtmf(){return this._dtmf===void 0&&(d.kind==="audio"?this._dtmf=c.createDTMFSender(d):this._dtmf=null),this._dtmf},_pc:c}};if(!t.RTCPeerConnection.prototype.getSenders){t.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const c=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(h,m){let y=c.apply(this,arguments);return y||(y=r(this,h),this._senders.push(y)),y};const d=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(h){d.apply(this,arguments);const m=this._senders.indexOf(h);m!==-1&&this._senders.splice(m,1)}}const s=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(c){this._senders=this._senders||[],s.apply(this,[c]),c.getTracks().forEach(d=>{this._senders.push(r(this,d))})};const a=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(c){this._senders=this._senders||[],a.apply(this,[c]),c.getTracks().forEach(d=>{const h=this._senders.find(m=>m.track===d);h&&this._senders.splice(this._senders.indexOf(h),1)})}}else if(typeof t=="object"&&t.RTCPeerConnection&&"getSenders"in t.RTCPeerConnection.prototype&&"createDTMFSender"in t.RTCPeerConnection.prototype&&t.RTCRtpSender&&!("dtmf"in t.RTCRtpSender.prototype)){const r=t.RTCPeerConnection.prototype.getSenders;t.RTCPeerConnection.prototype.getSenders=function(){const s=r.apply(this,[]);return s.forEach(a=>a._pc=this),s},Object.defineProperty(t.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function dB(t){if(!t.RTCPeerConnection)return;const r=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){const[s,a,c]=arguments;if(arguments.length>0&&typeof s=="function")return r.apply(this,arguments);if(r.length===0&&(arguments.length===0||typeof s!="function"))return r.apply(this,[]);const d=function(m){const y={};return m.result().forEach(v=>{const w={id:v.id,timestamp:v.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[v.type]||v.type};v.names().forEach(R=>{w[R]=v.stat(R)}),y[w.id]=w}),y},h=function(m){return new Map(Object.keys(m).map(y=>[y,m[y]]))};if(arguments.length>=2){const m=function(y){a(h(d(y)))};return r.apply(this,[m,s])}return new pt((m,y)=>{r.apply(this,[function(v){m(h(d(v)))},y])}).then(a,c)}}function hB(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender&&t.RTCRtpReceiver))return;if(!("getStats"in t.RTCRtpSender.prototype)){const s=t.RTCPeerConnection.prototype.getSenders;s&&(t.RTCPeerConnection.prototype.getSenders=function(){const c=s.apply(this,[]);return c.forEach(d=>d._pc=this),c});const a=t.RTCPeerConnection.prototype.addTrack;a&&(t.RTCPeerConnection.prototype.addTrack=function(){const c=a.apply(this,arguments);return c._pc=this,c}),t.RTCRtpSender.prototype.getStats=function(){const c=this;return this._pc.getStats().then(d=>sB(d,c.track,!0))}}if(!("getStats"in t.RTCRtpReceiver.prototype)){const s=t.RTCPeerConnection.prototype.getReceivers;s&&(t.RTCPeerConnection.prototype.getReceivers=function(){const a=s.apply(this,[]);return a.forEach(c=>c._pc=this),a}),G_(t,"track",a=>(a.receiver._pc=a.srcElement,a)),t.RTCRtpReceiver.prototype.getStats=function(){const a=this;return this._pc.getStats().then(c=>sB(c,a.track,!1))}}if(!("getStats"in t.RTCRtpSender.prototype)||!("getStats"in t.RTCRtpReceiver.prototype))return;const r=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof t.MediaStreamTrack){const s=arguments[0];let a,c,d;return this.getSenders().forEach(h=>{h.track===s&&(a?d=!0:a=h)}),this.getReceivers().forEach(h=>(h.track===s&&(c?d=!0:c=h),h.track===s)),d||a&&c?pt.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):a?a.getStats():c?c.getStats():pt.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return r.apply(this,arguments)}}function pB(t){t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(d=>this._shimmedLocalStreams[d][0])};const r=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(d,h){if(!h)return r.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const m=r.apply(this,arguments);return this._shimmedLocalStreams[h.id]?this._shimmedLocalStreams[h.id].indexOf(m)===-1&&this._shimmedLocalStreams[h.id].push(m):this._shimmedLocalStreams[h.id]=[h,m],m};const s=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(d){this._shimmedLocalStreams=this._shimmedLocalStreams||{},d.getTracks().forEach(y=>{if(this.getSenders().find(w=>w.track===y))throw new DOMException("Track already exists.","InvalidAccessError")});const h=this.getSenders();s.apply(this,arguments);const m=this.getSenders().filter(y=>h.indexOf(y)===-1);this._shimmedLocalStreams[d.id]=[d].concat(m)};const a=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(d){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[d.id],a.apply(this,arguments)};const c=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(d){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},d&&Object.keys(this._shimmedLocalStreams).forEach(h=>{const m=this._shimmedLocalStreams[h].indexOf(d);m!==-1&&this._shimmedLocalStreams[h].splice(m,1),this._shimmedLocalStreams[h].length===1&&delete this._shimmedLocalStreams[h]}),c.apply(this,arguments)}}function fB(t,r){if(!t.RTCPeerConnection)return;if(t.RTCPeerConnection.prototype.addTrack&&r.version>=65)return pB(t);const s=t.RTCPeerConnection.prototype.getLocalStreams;t.RTCPeerConnection.prototype.getLocalStreams=function(){const y=s.apply(this);return this._reverseStreams=this._reverseStreams||{},y.map(v=>this._reverseStreams[v.id])};const a=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(y){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},y.getTracks().forEach(v=>{if(this.getSenders().find(R=>R.track===v))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[y.id]){const v=new t.MediaStream(y.getTracks());this._streams[y.id]=v,this._reverseStreams[v.id]=y,y=v}a.apply(this,[y])};const c=t.RTCPeerConnection.prototype.removeStream;function d(y,v){let w=v.sdp;return Object.keys(y._reverseStreams||[]).forEach(R=>{const O=y._reverseStreams[R],D=y._streams[O.id];w=w.replace(new RegExp(D.id,"g"),O.id)}),new RTCSessionDescription({type:v.type,sdp:w})}t.RTCPeerConnection.prototype.removeStream=function(y){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},c.apply(this,[this._streams[y.id]||y]),delete this._reverseStreams[this._streams[y.id]?this._streams[y.id].id:y.id],delete this._streams[y.id]},t.RTCPeerConnection.prototype.addTrack=function(y,v){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const w=[].slice.call(arguments,1);if(w.length!==1||!w[0].getTracks().find(D=>D===y))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(D=>D.track===y))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const O=this._streams[v.id];if(O)O.addTrack(y),pt.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const D=new t.MediaStream([y]);this._streams[v.id]=D,this._reverseStreams[D.id]=v,this.addStream(D)}return this.getSenders().find(D=>D.track===y)},["createOffer","createAnswer"].forEach(function(y){const v=t.RTCPeerConnection.prototype[y],w={[y](){const R=arguments;return arguments.length&&typeof arguments[0]=="function"?v.apply(this,[O=>{const D=d(this,O);R[0].apply(null,[D])},O=>{R[1]&&R[1].apply(null,O)},arguments[2]]):v.apply(this,arguments).then(O=>d(this,O))}};t.RTCPeerConnection.prototype[y]=w[y]});const h=t.RTCPeerConnection.prototype.setLocalDescription;t.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=function(y,v){let w=v.sdp;return Object.keys(y._reverseStreams||[]).forEach(R=>{const O=y._reverseStreams[R],D=y._streams[O.id];w=w.replace(new RegExp(O.id,"g"),D.id)}),new RTCSessionDescription({type:v.type,sdp:w})}(this,arguments[0]),h.apply(this,arguments)):h.apply(this,arguments)};const m=Object.getOwnPropertyDescriptor(t.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(t.RTCPeerConnection.prototype,"localDescription",{get(){const y=m.get.apply(this);return y.type===""?y:d(this,y)}}),t.RTCPeerConnection.prototype.removeTrack=function(y){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!y._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(y._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let v;this._streams=this._streams||{},Object.keys(this._streams).forEach(w=>{this._streams[w].getTracks().find(R=>y.track===R)&&(v=this._streams[w])}),v&&(v.getTracks().length===1?this.removeStream(this._reverseStreams[v.id]):v.removeTrack(y.track),this.dispatchEvent(new Event("negotiationneeded")))}}function Ex(t,r){!t.RTCPeerConnection&&t.webkitRTCPeerConnection&&(t.RTCPeerConnection=t.webkitRTCPeerConnection),t.RTCPeerConnection&&r.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(s){const a=t.RTCPeerConnection.prototype[s],c={[s](){return arguments[0]=new(s==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),a.apply(this,arguments)}};t.RTCPeerConnection.prototype[s]=c[s]})}function mB(t,r){G_(t,"negotiationneeded",s=>{const a=s.target;if(!(r.version<72||a.getConfiguration&&a.getConfiguration().sdpSemantics==="plan-b")||a.signalingState==="stable")return s})}var gB=Object.freeze({__proto__:null,fixNegotiationNeeded:mB,shimAddTrackRemoveTrack:fB,shimAddTrackRemoveTrackWithNative:pB,shimGetDisplayMedia:function(t,r){t.navigator.mediaDevices&&"getDisplayMedia"in t.navigator.mediaDevices||t.navigator.mediaDevices&&(typeof r=="function"?t.navigator.mediaDevices.getDisplayMedia=function(s){return r(s).then(a=>{const c=s.video&&s.video.width,d=s.video&&s.video.height,h=s.video&&s.video.frameRate;return s.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:a,maxFrameRate:h||3}},c&&(s.video.mandatory.maxWidth=c),d&&(s.video.mandatory.maxHeight=d),t.navigator.mediaDevices.getUserMedia(s)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))},shimGetSendersWithDtmf:uB,shimGetStats:dB,shimGetUserMedia:aB,shimMediaStream:cB,shimOnTrack:lB,shimPeerConnection:Ex,shimSenderReceiverGetStats:hB});function _B(t,r){const s=t&&t.navigator,a=t&&t.MediaStreamTrack;if(s.getUserMedia=function(c,d,h){_x("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),s.mediaDevices.getUserMedia(c).then(d,h)},!(r.version>55&&"autoGainControl"in s.mediaDevices.getSupportedConstraints())){const c=function(h,m,y){m in h&&!(y in h)&&(h[y]=h[m],delete h[m])},d=s.mediaDevices.getUserMedia.bind(s.mediaDevices);if(s.mediaDevices.getUserMedia=function(h){return typeof h=="object"&&typeof h.audio=="object"&&(h=JSON.parse(JSON.stringify(h)),c(h.audio,"autoGainControl","mozAutoGainControl"),c(h.audio,"noiseSuppression","mozNoiseSuppression")),d(h)},a&&a.prototype.getSettings){const h=a.prototype.getSettings;a.prototype.getSettings=function(){const m=h.apply(this,arguments);return c(m,"mozAutoGainControl","autoGainControl"),c(m,"mozNoiseSuppression","noiseSuppression"),m}}if(a&&a.prototype.applyConstraints){const h=a.prototype.applyConstraints;a.prototype.applyConstraints=function(m){return this.kind==="audio"&&typeof m=="object"&&(m=JSON.parse(JSON.stringify(m)),c(m,"autoGainControl","mozAutoGainControl"),c(m,"noiseSuppression","mozNoiseSuppression")),h.apply(this,[m])}}}}function yB(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function vx(t,r){if(typeof t!="object"||!t.RTCPeerConnection&&!t.mozRTCPeerConnection)return;!t.RTCPeerConnection&&t.mozRTCPeerConnection&&(t.RTCPeerConnection=t.mozRTCPeerConnection),r.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(c){const d=t.RTCPeerConnection.prototype[c],h={[c](){return arguments[0]=new(c==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),d.apply(this,arguments)}};t.RTCPeerConnection.prototype[c]=h[c]});const s={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},a=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){const[c,d,h]=arguments;return a.apply(this,[c||null]).then(m=>{if(r.version<53&&!d)try{m.forEach(y=>{y.type=s[y.type]||y.type})}catch(y){if(y.name!=="TypeError")throw y;m.forEach((v,w)=>{m.set(w,Object.assign({},v,{type:s[v.type]||v.type}))})}return m}).then(d,h)}}function EB(t){if(typeof t!="object"||!t.RTCPeerConnection||!t.RTCRtpSender||t.RTCRtpSender&&"getStats"in t.RTCRtpSender.prototype)return;const r=t.RTCPeerConnection.prototype.getSenders;r&&(t.RTCPeerConnection.prototype.getSenders=function(){const a=r.apply(this,[]);return a.forEach(c=>c._pc=this),a});const s=t.RTCPeerConnection.prototype.addTrack;s&&(t.RTCPeerConnection.prototype.addTrack=function(){const a=s.apply(this,arguments);return a._pc=this,a}),t.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):pt.resolve(new Map)}}function vB(t){if(typeof t!="object"||!t.RTCPeerConnection||!t.RTCRtpSender||t.RTCRtpSender&&"getStats"in t.RTCRtpReceiver.prototype)return;const r=t.RTCPeerConnection.prototype.getReceivers;r&&(t.RTCPeerConnection.prototype.getReceivers=function(){const s=r.apply(this,[]);return s.forEach(a=>a._pc=this),s}),G_(t,"track",s=>(s.receiver._pc=s.srcElement,s)),t.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function SB(t){t.RTCPeerConnection&&!("removeStream"in t.RTCPeerConnection.prototype)&&(t.RTCPeerConnection.prototype.removeStream=function(r){_x("removeStream","removeTrack"),this.getSenders().forEach(s=>{var a;s.track&&lt(a=r.getTracks()).call(a,s.track)&&this.removeTrack(s)})})}function bB(t){t.DataChannel&&!t.RTCDataChannel&&(t.RTCDataChannel=t.DataChannel)}function wB(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const r=t.RTCPeerConnection.prototype.addTransceiver;r&&(t.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let s=arguments[1]&&arguments[1].sendEncodings;s===void 0&&(s=[]),s=[...s];const a=s.length>0;a&&s.forEach(d=>{if("rid"in d&&!/^[a-z0-9]{0,16}$/i.test(d.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in d&&!(parseFloat(d.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in d&&!(parseFloat(d.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const c=r.apply(this,arguments);if(a){const{sender:d}=c,h=d.getParameters();(!("encodings"in h)||h.encodings.length===1&&Object.keys(h.encodings[0]).length===0)&&(h.encodings=s,d.sendEncodings=s,this.setParametersPromises.push(d.setParameters(h).then(()=>{delete d.sendEncodings}).catch(()=>{delete d.sendEncodings})))}return c})}function TB(t){if(typeof t!="object"||!t.RTCRtpSender)return;const r=t.RTCRtpSender.prototype.getParameters;r&&(t.RTCRtpSender.prototype.getParameters=function(){const s=r.apply(this,arguments);return"encodings"in s||(s.encodings=[].concat(this.sendEncodings||[{}])),s})}function CB(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const r=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?pt.all(this.setParametersPromises).then(()=>r.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):r.apply(this,arguments)}}function RB(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const r=t.RTCPeerConnection.prototype.createAnswer;t.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?pt.all(this.setParametersPromises).then(()=>r.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):r.apply(this,arguments)}}var IB=Object.freeze({__proto__:null,shimAddTransceiver:wB,shimCreateAnswer:RB,shimCreateOffer:CB,shimGetDisplayMedia:function(t,r){t.navigator.mediaDevices&&"getDisplayMedia"in t.navigator.mediaDevices||t.navigator.mediaDevices&&(t.navigator.mediaDevices.getDisplayMedia=function(s){if(!s||!s.video){const a=new DOMException("getDisplayMedia without video constraints is undefined");return a.name="NotFoundError",a.code=8,pt.reject(a)}return s.video===!0?s.video={mediaSource:r}:s.video.mediaSource=r,t.navigator.mediaDevices.getUserMedia(s)})},shimGetParameters:TB,shimGetUserMedia:_B,shimOnTrack:yB,shimPeerConnection:vx,shimRTCDataChannel:bB,shimReceiverGetStats:vB,shimRemoveStream:SB,shimSenderGetStats:EB});function AB(t){if(typeof t=="object"&&t.RTCPeerConnection){if("getLocalStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in t.RTCPeerConnection.prototype)){const r=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addStream=function(s){var a;this._localStreams||(this._localStreams=[]),lt(a=this._localStreams).call(a,s)||this._localStreams.push(s),s.getAudioTracks().forEach(c=>r.call(this,c,s)),s.getVideoTracks().forEach(c=>r.call(this,c,s))},t.RTCPeerConnection.prototype.addTrack=function(s){for(var a=arguments.length,c=new Array(a>1?a-1:0),d=1;d<a;d++)c[d-1]=arguments[d];return c&&c.forEach(h=>{var m;this._localStreams?lt(m=this._localStreams).call(m,h)||this._localStreams.push(h):this._localStreams=[h]}),r.apply(this,arguments)}}"removeStream"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.removeStream=function(r){this._localStreams||(this._localStreams=[]);const s=this._localStreams.indexOf(r);if(s===-1)return;this._localStreams.splice(s,1);const a=r.getTracks();this.getSenders().forEach(c=>{lt(a).call(a,c.track)&&this.removeTrack(c)})})}}function PB(t){if(typeof t=="object"&&t.RTCPeerConnection&&("getRemoteStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in t.RTCPeerConnection.prototype))){Object.defineProperty(t.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(s){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=s),this.addEventListener("track",this._onaddstreampoly=a=>{a.streams.forEach(c=>{var d;if(this._remoteStreams||(this._remoteStreams=[]),lt(d=this._remoteStreams).call(d,c))return;this._remoteStreams.push(c);const h=new Event("addstream");h.stream=c,this.dispatchEvent(h)})})}});const r=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){const s=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(a){a.streams.forEach(c=>{if(s._remoteStreams||(s._remoteStreams=[]),s._remoteStreams.indexOf(c)>=0)return;s._remoteStreams.push(c);const d=new Event("addstream");d.stream=c,s.dispatchEvent(d)})}),r.apply(s,arguments)}}}function OB(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const r=t.RTCPeerConnection.prototype,s=r.createOffer,a=r.createAnswer,c=r.setLocalDescription,d=r.setRemoteDescription,h=r.addIceCandidate;r.createOffer=function(y,v){const w=arguments.length>=2?arguments[2]:arguments[0],R=s.apply(this,[w]);return v?(R.then(y,v),pt.resolve()):R},r.createAnswer=function(y,v){const w=arguments.length>=2?arguments[2]:arguments[0],R=a.apply(this,[w]);return v?(R.then(y,v),pt.resolve()):R};let m=function(y,v,w){const R=c.apply(this,[y]);return w?(R.then(v,w),pt.resolve()):R};r.setLocalDescription=m,m=function(y,v,w){const R=d.apply(this,[y]);return w?(R.then(v,w),pt.resolve()):R},r.setRemoteDescription=m,m=function(y,v,w){const R=h.apply(this,[y]);return w?(R.then(v,w),pt.resolve()):R},r.addIceCandidate=m}function kB(t){const r=t&&t.navigator;if(r.mediaDevices&&r.mediaDevices.getUserMedia){const s=r.mediaDevices,a=s.getUserMedia.bind(s);r.mediaDevices.getUserMedia=c=>a(NB(c))}!r.getUserMedia&&r.mediaDevices&&r.mediaDevices.getUserMedia&&(r.getUserMedia=(function(s,a,c){r.mediaDevices.getUserMedia(s).then(a,c)}).bind(r))}function NB(t){return t&&t.video!==void 0?Object.assign({},t,{video:iB(t.video)}):t}function DB(t){if(!t.RTCPeerConnection)return;const r=t.RTCPeerConnection;t.RTCPeerConnection=function(s,a){if(s&&s.iceServers){const c=[];for(let d=0;d<s.iceServers.length;d++){let h=s.iceServers[d];!h.hasOwnProperty("urls")&&h.hasOwnProperty("url")?(_x("RTCIceServer.url","RTCIceServer.urls"),h=JSON.parse(JSON.stringify(h)),h.urls=h.url,delete h.url,c.push(h)):c.push(s.iceServers[d])}s.iceServers=c}return new r(s,a)},t.RTCPeerConnection.prototype=r.prototype,"generateCertificate"in r&&Object.defineProperty(t.RTCPeerConnection,"generateCertificate",{get:()=>r.generateCertificate})}function xB(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function LB(t){const r=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(s){if(s){s.offerToReceiveAudio!==void 0&&(s.offerToReceiveAudio=!!s.offerToReceiveAudio);const a=this.getTransceivers().find(d=>d.receiver.track.kind==="audio");s.offerToReceiveAudio===!1&&a?a.direction==="sendrecv"?a.setDirection?a.setDirection("sendonly"):a.direction="sendonly":a.direction==="recvonly"&&(a.setDirection?a.setDirection("inactive"):a.direction="inactive"):s.offerToReceiveAudio!==!0||a||this.addTransceiver("audio",{direction:"recvonly"}),s.offerToReceiveVideo!==void 0&&(s.offerToReceiveVideo=!!s.offerToReceiveVideo);const c=this.getTransceivers().find(d=>d.receiver.track.kind==="video");s.offerToReceiveVideo===!1&&c?c.direction==="sendrecv"?c.setDirection?c.setDirection("sendonly"):c.direction="sendonly":c.direction==="recvonly"&&(c.setDirection?c.setDirection("inactive"):c.direction="inactive"):s.offerToReceiveVideo!==!0||c||this.addTransceiver("video",{direction:"recvonly"})}return r.apply(this,arguments)}}function MB(t){typeof t!="object"||t.AudioContext||(t.AudioContext=t.webkitAudioContext)}var UB=Object.freeze({__proto__:null,shimAudioContext:MB,shimCallbacksAPI:OB,shimConstraints:NB,shimCreateOfferLegacy:LB,shimGetUserMedia:kB,shimLocalStreamsAPI:AB,shimRTCIceServerUrls:DB,shimRemoteStreamsAPI:PB,shimTrackEventTransceiver:xB}),VB=`	
\v\f\r \u2028\u2029\uFEFF`,zue=Lt,Gue=Ba,Sx=VB,jB=I("".replace),Hue=RegExp("^["+Sx+"]+"),$ue=RegExp("(^|[^"+Sx+"])["+Sx+"]+$"),Kue=function(t){return function(r){var s=Gue(zue(r));return 1&t&&(s=jB(s,Hue,"")),2&t&&(s=jB(s,$ue,"$1")),s}},que={trim:Kue(3)},Yue=II.PROPER,Xue=u,FB=VB,Jue=que.trim;Hn({target:"String",proto:!0,forced:function(t){return Xue(function(){return!!FB[t]()||""[t]()!==""||Yue&&FB[t].name!==t})}("trim")},{trim:function(){return Jue(this)}});var Que=yc("String").trim,Zue=P,ede=Que,bx=String.prototype,tde=function(t){var r=t.trim;return typeof t=="string"||t===bx||Zue(bx,t)&&r===bx.trim?ede:r},Ro=l(tde),BB={exports:{}};(function(t){const r={generateIdentifier:function(){return Math.random().toString(36).substring(2,12)}};r.localCName=r.generateIdentifier(),r.splitLines=function(s){return s.trim().split(`
`).map(a=>a.trim())},r.splitSections=function(s){return s.split(`
m=`).map((a,c)=>(c>0?"m="+a:a).trim()+`\r
`)},r.getDescription=function(s){const a=r.splitSections(s);return a&&a[0]},r.getMediaSections=function(s){const a=r.splitSections(s);return a.shift(),a},r.matchPrefix=function(s,a){return r.splitLines(s).filter(c=>c.indexOf(a)===0)},r.parseCandidate=function(s){let a;a=s.indexOf("a=candidate:")===0?s.substring(12).split(" "):s.substring(10).split(" ");const c={foundation:a[0],component:{1:"rtp",2:"rtcp"}[a[1]]||a[1],protocol:a[2].toLowerCase(),priority:parseInt(a[3],10),ip:a[4],address:a[4],port:parseInt(a[5],10),type:a[7]};for(let d=8;d<a.length;d+=2)switch(a[d]){case"raddr":c.relatedAddress=a[d+1];break;case"rport":c.relatedPort=parseInt(a[d+1],10);break;case"tcptype":c.tcpType=a[d+1];break;case"ufrag":c.ufrag=a[d+1],c.usernameFragment=a[d+1];break;default:c[a[d]]===void 0&&(c[a[d]]=a[d+1])}return c},r.writeCandidate=function(s){const a=[];a.push(s.foundation);const c=s.component;c==="rtp"?a.push(1):c==="rtcp"?a.push(2):a.push(c),a.push(s.protocol.toUpperCase()),a.push(s.priority),a.push(s.address||s.ip),a.push(s.port);const d=s.type;return a.push("typ"),a.push(d),d!=="host"&&s.relatedAddress&&s.relatedPort&&(a.push("raddr"),a.push(s.relatedAddress),a.push("rport"),a.push(s.relatedPort)),s.tcpType&&s.protocol.toLowerCase()==="tcp"&&(a.push("tcptype"),a.push(s.tcpType)),(s.usernameFragment||s.ufrag)&&(a.push("ufrag"),a.push(s.usernameFragment||s.ufrag)),"candidate:"+a.join(" ")},r.parseIceOptions=function(s){return s.substring(14).split(" ")},r.parseRtpMap=function(s){let a=s.substring(9).split(" ");const c={payloadType:parseInt(a.shift(),10)};return a=a[0].split("/"),c.name=a[0],c.clockRate=parseInt(a[1],10),c.channels=a.length===3?parseInt(a[2],10):1,c.numChannels=c.channels,c},r.writeRtpMap=function(s){let a=s.payloadType;s.preferredPayloadType!==void 0&&(a=s.preferredPayloadType);const c=s.channels||s.numChannels||1;return"a=rtpmap:"+a+" "+s.name+"/"+s.clockRate+(c!==1?"/"+c:"")+`\r
`},r.parseExtmap=function(s){const a=s.substring(9).split(" ");return{id:parseInt(a[0],10),direction:a[0].indexOf("/")>0?a[0].split("/")[1]:"sendrecv",uri:a[1],attributes:a.slice(2).join(" ")}},r.writeExtmap=function(s){return"a=extmap:"+(s.id||s.preferredId)+(s.direction&&s.direction!=="sendrecv"?"/"+s.direction:"")+" "+s.uri+(s.attributes?" "+s.attributes:"")+`\r
`},r.parseFmtp=function(s){const a={};let c;const d=s.substring(s.indexOf(" ")+1).split(";");for(let h=0;h<d.length;h++)c=d[h].trim().split("="),a[c[0].trim()]=c[1];return a},r.writeFmtp=function(s){let a="",c=s.payloadType;if(s.preferredPayloadType!==void 0&&(c=s.preferredPayloadType),s.parameters&&Object.keys(s.parameters).length){const d=[];Object.keys(s.parameters).forEach(h=>{s.parameters[h]!==void 0?d.push(h+"="+s.parameters[h]):d.push(h)}),a+="a=fmtp:"+c+" "+d.join(";")+`\r
`}return a},r.parseRtcpFb=function(s){const a=s.substring(s.indexOf(" ")+1).split(" ");return{type:a.shift(),parameter:a.join(" ")}},r.writeRtcpFb=function(s){let a="",c=s.payloadType;return s.preferredPayloadType!==void 0&&(c=s.preferredPayloadType),s.rtcpFeedback&&s.rtcpFeedback.length&&s.rtcpFeedback.forEach(d=>{a+="a=rtcp-fb:"+c+" "+d.type+(d.parameter&&d.parameter.length?" "+d.parameter:"")+`\r
`}),a},r.parseSsrcMedia=function(s){const a=s.indexOf(" "),c={ssrc:parseInt(s.substring(7,a),10)},d=s.indexOf(":",a);return d>-1?(c.attribute=s.substring(a+1,d),c.value=s.substring(d+1)):c.attribute=s.substring(a+1),c},r.parseSsrcGroup=function(s){const a=s.substring(13).split(" ");return{semantics:a.shift(),ssrcs:a.map(c=>parseInt(c,10))}},r.getMid=function(s){const a=r.matchPrefix(s,"a=mid:")[0];if(a)return a.substring(6)},r.parseFingerprint=function(s){const a=s.substring(14).split(" ");return{algorithm:a[0].toLowerCase(),value:a[1].toUpperCase()}},r.getDtlsParameters=function(s,a){return{role:"auto",fingerprints:r.matchPrefix(s+a,"a=fingerprint:").map(r.parseFingerprint)}},r.writeDtlsParameters=function(s,a){let c="a=setup:"+a+`\r
`;return s.fingerprints.forEach(d=>{c+="a=fingerprint:"+d.algorithm+" "+d.value+`\r
`}),c},r.parseCryptoLine=function(s){const a=s.substring(9).split(" ");return{tag:parseInt(a[0],10),cryptoSuite:a[1],keyParams:a[2],sessionParams:a.slice(3)}},r.writeCryptoLine=function(s){return"a=crypto:"+s.tag+" "+s.cryptoSuite+" "+(typeof s.keyParams=="object"?r.writeCryptoKeyParams(s.keyParams):s.keyParams)+(s.sessionParams?" "+s.sessionParams.join(" "):"")+`\r
`},r.parseCryptoKeyParams=function(s){if(s.indexOf("inline:")!==0)return null;const a=s.substring(7).split("|");return{keyMethod:"inline",keySalt:a[0],lifeTime:a[1],mkiValue:a[2]?a[2].split(":")[0]:void 0,mkiLength:a[2]?a[2].split(":")[1]:void 0}},r.writeCryptoKeyParams=function(s){return s.keyMethod+":"+s.keySalt+(s.lifeTime?"|"+s.lifeTime:"")+(s.mkiValue&&s.mkiLength?"|"+s.mkiValue+":"+s.mkiLength:"")},r.getCryptoParameters=function(s,a){return r.matchPrefix(s+a,"a=crypto:").map(r.parseCryptoLine)},r.getIceParameters=function(s,a){const c=r.matchPrefix(s+a,"a=ice-ufrag:")[0],d=r.matchPrefix(s+a,"a=ice-pwd:")[0];return c&&d?{usernameFragment:c.substring(12),password:d.substring(10)}:null},r.writeIceParameters=function(s){let a="a=ice-ufrag:"+s.usernameFragment+`\r
a=ice-pwd:`+s.password+`\r
`;return s.iceLite&&(a+=`a=ice-lite\r
`),a},r.parseRtpParameters=function(s){const a={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},c=r.splitLines(s)[0].split(" ");a.profile=c[2];for(let h=3;h<c.length;h++){const m=c[h],y=r.matchPrefix(s,"a=rtpmap:"+m+" ")[0];if(y){const v=r.parseRtpMap(y),w=r.matchPrefix(s,"a=fmtp:"+m+" ");switch(v.parameters=w.length?r.parseFmtp(w[0]):{},v.rtcpFeedback=r.matchPrefix(s,"a=rtcp-fb:"+m+" ").map(r.parseRtcpFb),a.codecs.push(v),v.name.toUpperCase()){case"RED":case"ULPFEC":a.fecMechanisms.push(v.name.toUpperCase())}}}r.matchPrefix(s,"a=extmap:").forEach(h=>{a.headerExtensions.push(r.parseExtmap(h))});const d=r.matchPrefix(s,"a=rtcp-fb:* ").map(r.parseRtcpFb);return a.codecs.forEach(h=>{d.forEach(m=>{h.rtcpFeedback.find(y=>y.type===m.type&&y.parameter===m.parameter)||h.rtcpFeedback.push(m)})}),a},r.writeRtpDescription=function(s,a){let c="";c+="m="+s+" ",c+=a.codecs.length>0?"9":"0",c+=" "+(a.profile||"UDP/TLS/RTP/SAVPF")+" ",c+=a.codecs.map(h=>h.preferredPayloadType!==void 0?h.preferredPayloadType:h.payloadType).join(" ")+`\r
`,c+=`c=IN IP4 0.0.0.0\r
`,c+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,a.codecs.forEach(h=>{c+=r.writeRtpMap(h),c+=r.writeFmtp(h),c+=r.writeRtcpFb(h)});let d=0;return a.codecs.forEach(h=>{h.maxptime>d&&(d=h.maxptime)}),d>0&&(c+="a=maxptime:"+d+`\r
`),a.headerExtensions&&a.headerExtensions.forEach(h=>{c+=r.writeExtmap(h)}),c},r.parseRtpEncodingParameters=function(s){const a=[],c=r.parseRtpParameters(s),d=c.fecMechanisms.indexOf("RED")!==-1,h=c.fecMechanisms.indexOf("ULPFEC")!==-1,m=r.matchPrefix(s,"a=ssrc:").map(O=>r.parseSsrcMedia(O)).filter(O=>O.attribute==="cname"),y=m.length>0&&m[0].ssrc;let v;const w=r.matchPrefix(s,"a=ssrc-group:FID").map(O=>O.substring(17).split(" ").map(D=>parseInt(D,10)));w.length>0&&w[0].length>1&&w[0][0]===y&&(v=w[0][1]),c.codecs.forEach(O=>{if(O.name.toUpperCase()==="RTX"&&O.parameters.apt){let D={ssrc:y,codecPayloadType:parseInt(O.parameters.apt,10)};y&&v&&(D.rtx={ssrc:v}),a.push(D),d&&(D=JSON.parse(JSON.stringify(D)),D.fec={ssrc:y,mechanism:h?"red+ulpfec":"red"},a.push(D))}}),a.length===0&&y&&a.push({ssrc:y});let R=r.matchPrefix(s,"b=");return R.length&&(R=R[0].indexOf("b=TIAS:")===0?parseInt(R[0].substring(7),10):R[0].indexOf("b=AS:")===0?1e3*parseInt(R[0].substring(5),10)*.95-16e3:void 0,a.forEach(O=>{O.maxBitrate=R})),a},r.parseRtcpParameters=function(s){const a={},c=r.matchPrefix(s,"a=ssrc:").map(m=>r.parseSsrcMedia(m)).filter(m=>m.attribute==="cname")[0];c&&(a.cname=c.value,a.ssrc=c.ssrc);const d=r.matchPrefix(s,"a=rtcp-rsize");a.reducedSize=d.length>0,a.compound=d.length===0;const h=r.matchPrefix(s,"a=rtcp-mux");return a.mux=h.length>0,a},r.writeRtcpParameters=function(s){let a="";return s.reducedSize&&(a+=`a=rtcp-rsize\r
`),s.mux&&(a+=`a=rtcp-mux\r
`),s.ssrc!==void 0&&s.cname&&(a+="a=ssrc:"+s.ssrc+" cname:"+s.cname+`\r
`),a},r.parseMsid=function(s){let a;const c=r.matchPrefix(s,"a=msid:");if(c.length===1)return a=c[0].substring(7).split(" "),{stream:a[0],track:a[1]};const d=r.matchPrefix(s,"a=ssrc:").map(h=>r.parseSsrcMedia(h)).filter(h=>h.attribute==="msid");return d.length>0?(a=d[0].value.split(" "),{stream:a[0],track:a[1]}):void 0},r.parseSctpDescription=function(s){const a=r.parseMLine(s),c=r.matchPrefix(s,"a=max-message-size:");let d;c.length>0&&(d=parseInt(c[0].substring(19),10)),isNaN(d)&&(d=65536);const h=r.matchPrefix(s,"a=sctp-port:");if(h.length>0)return{port:parseInt(h[0].substring(12),10),protocol:a.fmt,maxMessageSize:d};const m=r.matchPrefix(s,"a=sctpmap:");if(m.length>0){const y=m[0].substring(10).split(" ");return{port:parseInt(y[0],10),protocol:y[1],maxMessageSize:d}}},r.writeSctpDescription=function(s,a){let c=[];return c=s.protocol!=="DTLS/SCTP"?["m="+s.kind+" 9 "+s.protocol+" "+a.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+a.port+`\r
`]:["m="+s.kind+" 9 "+s.protocol+" "+a.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+a.port+" "+a.protocol+` 65535\r
`],a.maxMessageSize!==void 0&&c.push("a=max-message-size:"+a.maxMessageSize+`\r
`),c.join("")},r.generateSessionId=function(){return Math.random().toString().substr(2,22)},r.writeSessionBoilerplate=function(s,a,c){let d;const h=a!==void 0?a:2;return d=s||r.generateSessionId(),`v=0\r
o=`+(c||"thisisadapterortc")+" "+d+" "+h+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},r.getDirection=function(s,a){const c=r.splitLines(s);for(let d=0;d<c.length;d++)switch(c[d]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return c[d].substring(2)}return a?r.getDirection(a):"sendrecv"},r.getKind=function(s){return r.splitLines(s)[0].split(" ")[0].substring(2)},r.isRejected=function(s){return s.split(" ",2)[1]==="0"},r.parseMLine=function(s){const a=r.splitLines(s)[0].substring(2).split(" ");return{kind:a[0],port:parseInt(a[1],10),protocol:a[2],fmt:a.slice(3).join(" ")}},r.parseOLine=function(s){const a=r.matchPrefix(s,"o=")[0].substring(2).split(" ");return{username:a[0],sessionId:a[1],sessionVersion:parseInt(a[2],10),netType:a[3],addressType:a[4],address:a[5]}},r.isValidSDP=function(s){if(typeof s!="string"||s.length===0)return!1;const a=r.splitLines(s);for(let c=0;c<a.length;c++)if(a[c].length<2||a[c].charAt(1)!=="=")return!1;return!0},t.exports=r})(BB);var WB=BB.exports,Fv=l(WB),nde=i({__proto__:null,default:Fv},[WB]);function SA(t){if(!t.RTCIceCandidate||t.RTCIceCandidate&&"foundation"in t.RTCIceCandidate.prototype)return;const r=t.RTCIceCandidate;t.RTCIceCandidate=function(s){if(typeof s=="object"&&s.candidate&&s.candidate.indexOf("a=")===0&&((s=JSON.parse(JSON.stringify(s))).candidate=s.candidate.substr(2)),s.candidate&&s.candidate.length){const a=new r(s),c=Fv.parseCandidate(s.candidate),d=Object.assign(a,c);return d.toJSON=function(){return{candidate:d.candidate,sdpMid:d.sdpMid,sdpMLineIndex:d.sdpMLineIndex,usernameFragment:d.usernameFragment}},d}return new r(s)},t.RTCIceCandidate.prototype=r.prototype,G_(t,"icecandidate",s=>(s.candidate&&Object.defineProperty(s,"candidate",{value:new t.RTCIceCandidate(s.candidate),writable:"false"}),s))}function wx(t){!t.RTCIceCandidate||t.RTCIceCandidate&&"relayProtocol"in t.RTCIceCandidate.prototype||G_(t,"icecandidate",r=>{if(r.candidate){const s=Fv.parseCandidate(r.candidate.candidate);s.type==="relay"&&(r.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[s.priority>>24])}return r})}function bA(t,r){if(!t.RTCPeerConnection)return;"sctp"in t.RTCPeerConnection.prototype||Object.defineProperty(t.RTCPeerConnection.prototype,"sctp",{get(){return this._sctp===void 0?null:this._sctp}});const s=function(m){if(!m||!m.sdp)return!1;const y=Fv.splitSections(m.sdp);return y.shift(),y.some(v=>{const w=Fv.parseMLine(v);return w&&w.kind==="application"&&w.protocol.indexOf("SCTP")!==-1})},a=function(m){const y=m.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(y===null||y.length<2)return-1;const v=parseInt(y[1],10);return v!=v?-1:v},c=function(m){let y=65536;return r.browser==="firefox"&&(y=r.version<57?m===-1?16384:2147483637:r.version<60?r.version===57?65535:65536:2147483637),y},d=function(m,y){let v=65536;r.browser==="firefox"&&r.version===57&&(v=65535);const w=Fv.matchPrefix(m.sdp,"a=max-message-size:");return w.length>0?v=parseInt(w[0].substr(19),10):r.browser==="firefox"&&y!==-1&&(v=2147483637),v},h=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,r.browser==="chrome"&&r.version>=76){const{sdpSemantics:m}=this.getConfiguration();m==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return this._sctp===void 0?null:this._sctp},enumerable:!0,configurable:!0})}if(s(arguments[0])){const m=a(arguments[0]),y=c(m),v=d(arguments[0],m);let w;w=y===0&&v===0?Number.POSITIVE_INFINITY:y===0||v===0?Math.max(y,v):Math.min(y,v);const R={};Object.defineProperty(R,"maxMessageSize",{get:()=>w}),this._sctp=R}return h.apply(this,arguments)}}function wA(t){if(!t.RTCPeerConnection||!("createDataChannel"in t.RTCPeerConnection.prototype))return;function r(a,c){const d=a.send;a.send=function(){const h=arguments[0],m=h.length||h.size||h.byteLength;if(a.readyState==="open"&&c.sctp&&m>c.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+c.sctp.maxMessageSize+" bytes)");return d.apply(a,arguments)}}const s=t.RTCPeerConnection.prototype.createDataChannel;t.RTCPeerConnection.prototype.createDataChannel=function(){const a=s.apply(this,arguments);return r(a,this),a},G_(t,"datachannel",a=>(r(a.channel,a.target),a))}function Tx(t){if(!t.RTCPeerConnection||"connectionState"in t.RTCPeerConnection.prototype)return;const r=t.RTCPeerConnection.prototype;Object.defineProperty(r,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(r,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(s){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),s&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=s)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(s=>{const a=r[s];r[s]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=c=>{const d=c.target;if(d._lastConnectionState!==d.connectionState){d._lastConnectionState=d.connectionState;const h=new Event("connectionstatechange",c);d.dispatchEvent(h)}return c},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),a.apply(this,arguments)}})}function Cx(t,r){if(!t.RTCPeerConnection||r.browser==="chrome"&&r.version>=71||r.browser==="safari"&&r.version>=605)return;const s=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(a){if(a&&a.sdp&&a.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const c=a.sdp.split(`
`).filter(d=>Ro(d).call(d)!=="a=extmap-allow-mixed").join(`
`);t.RTCSessionDescription&&a instanceof t.RTCSessionDescription?arguments[0]=new t.RTCSessionDescription({type:a.type,sdp:c}):a.sdp=c}return s.apply(this,arguments)}}function TA(t,r){if(!t.RTCPeerConnection||!t.RTCPeerConnection.prototype)return;const s=t.RTCPeerConnection.prototype.addIceCandidate;s&&s.length!==0&&(t.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(r.browser==="chrome"&&r.version<78||r.browser==="firefox"&&r.version<68||r.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?pt.resolve():s.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),pt.resolve())})}function CA(t,r){if(!t.RTCPeerConnection||!t.RTCPeerConnection.prototype)return;const s=t.RTCPeerConnection.prototype.setLocalDescription;s&&s.length!==0&&(t.RTCPeerConnection.prototype.setLocalDescription=function(){let a=arguments[0]||{};if(typeof a!="object"||a.type&&a.sdp)return s.apply(this,arguments);if(a={type:a.type,sdp:a.sdp},!a.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":a.type="offer";break;default:a.type="answer"}return a.sdp||a.type!=="offer"&&a.type!=="answer"?s.apply(this,[a]):(a.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(c=>s.apply(this,[c]))})}var rde=Object.freeze({__proto__:null,removeExtmapAllowMixed:Cx,shimAddIceCandidateNullOrEmpty:TA,shimConnectionState:Tx,shimMaxMessageSize:bA,shimParameterlessSetLocalDescription:CA,shimRTCIceCandidate:SA,shimRTCIceCandidateRelayProtocol:wx,shimSendThrowTypeError:wA});(function(){let{window:t}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0};const s=nB,a=function(d){const h={browser:null,version:null};if(d===void 0||!d.navigator)return h.browser="Not a browser.",h;const{navigator:m}=d;if(m.mozGetUserMedia)h.browser="firefox",h.version=vA(m.userAgent,/Firefox\/(\d+)\./,1);else if(m.webkitGetUserMedia||d.isSecureContext===!1&&d.webkitRTCPeerConnection)h.browser="chrome",h.version=vA(m.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!d.RTCPeerConnection||!m.userAgent.match(/AppleWebKit\/(\d+)\./))return h.browser="Not a supported browser.",h;h.browser="safari",h.version=vA(m.userAgent,/AppleWebKit\/(\d+)\./,1),h.supportsUnifiedPlan=d.RTCRtpTransceiver&&"currentDirection"in d.RTCRtpTransceiver.prototype}return h}(t),c={browserDetails:a,commonShim:rde,extractVersion:vA,disableLog:Bue,disableWarnings:Wue,sdp:nde};switch(a.browser){case"chrome":if(!gB||!Ex||!r.shimChrome)return s("Chrome shim is not included in this adapter release."),c;if(a.version===null)return s("Chrome shim can not determine version, not shimming."),c;s("adapter.js shimming chrome."),c.browserShim=gB,TA(t,a),CA(t),aB(t,a),cB(t),Ex(t,a),lB(t),fB(t,a),uB(t),dB(t),hB(t),mB(t,a),SA(t),wx(t),Tx(t),bA(t,a),wA(t),Cx(t,a);break;case"firefox":if(!IB||!vx||!r.shimFirefox)return s("Firefox shim is not included in this adapter release."),c;s("adapter.js shimming firefox."),c.browserShim=IB,TA(t,a),CA(t),_B(t,a),vx(t,a),yB(t),SB(t),EB(t),vB(t),bB(t),wB(t),TB(t),CB(t),RB(t),SA(t),Tx(t),bA(t,a),wA(t);break;case"safari":if(!UB||!r.shimSafari)return s("Safari shim is not included in this adapter release."),c;s("adapter.js shimming safari."),c.browserShim=UB,TA(t,a),CA(t),DB(t),LB(t),OB(t),AB(t),PB(t),xB(t),kB(t),MB(t),SA(t),wx(t),bA(t,a),wA(t),Cx(t,a);break;default:s("Unsupported browser!")}})({window:typeof window>"u"?void 0:window});var zB=Ua,ide=TypeError,GB=wt.match(/firefox\/(\d+)/i),sde=!!GB&&+GB[1],ode=/MSIE|Trident/.test(wt),HB=wt.match(/AppleWebKit\/(\d+)\./),ade=!!HB&&+HB[1],cde=Hn,$B=I,lde=vt,ude=ra,KB=Ei,dde=function(t,r){if(!delete t[r])throw ide("Cannot delete property "+zB(r)+" of "+zB(t))},qB=Ba,Rx=u,hde=i5,pde=Fp,YB=sde,fde=ode,XB=ui,JB=ade,qm=[],QB=$B(qm.sort),mde=$B(qm.push),gde=Rx(function(){qm.sort(void 0)}),_de=Rx(function(){qm.sort(null)}),yde=pde("sort"),ZB=!Rx(function(){if(XB)return XB<70;if(!(YB&&YB>3)){if(fde)return!0;if(JB)return JB<603;var t,r,s,a,c="";for(t=65;t<76;t++){switch(r=String.fromCharCode(t),t){case 66:case 69:case 70:case 72:s=3;break;case 68:case 71:s=4;break;default:s=2}for(a=0;a<47;a++)qm.push({k:r+a,v:s})}for(qm.sort(function(d,h){return h.v-d.v}),a=0;a<qm.length;a++)r=qm[a].k.charAt(0),c.charAt(c.length-1)!==r&&(c+=r);return c!=="DGBEFHACIJK"}});cde({target:"Array",proto:!0,forced:gde||!_de||!yde||!ZB},{sort:function(t){t!==void 0&&lde(t);var r=ude(this);if(ZB)return t===void 0?QB(r):QB(r,t);var s,a,c=[],d=KB(r);for(a=0;a<d;a++)a in r&&mde(c,r[a]);for(hde(c,function(h){return function(m,y){return y===void 0?-1:m===void 0?1:h!==void 0?+h(m,y)||0:qB(m)>qB(y)?1:-1}}(t)),s=KB(c),a=0;a<s;)r[a]=c[a++];for(;a<d;)dde(r,a++);return r}});var Ede=yc("Array").sort,vde=P,Sde=Ede,Ix=Array.prototype,bde=function(t){var r=t.sort;return t===Ix||vde(Ix,t)&&r===Ix.sort?Sde:r},Ew=l(bde),Ax=M;Hn({global:!0,forced:Ax.globalThis!==Ax},{globalThis:Ax});var e6=l(M),Px={exports:{}};(function(t,r){(function(s,a){var c="function",d="undefined",h="object",m="string",y="major",v="model",w="name",R="type",O="vendor",D="version",G="architecture",j="console",W="mobile",Q="tablet",ee="smarttv",fe="wearable",ye="embedded",Ee="Amazon",_e="Apple",Ne="ASUS",Ze="BlackBerry",ft="Browser",yt="Chrome",An="Firefox",Pn="Google",_r="Huawei",pi="LG",Zr="Microsoft",Ra="Motorola",ze="Opera",at="Samsung",Pt="Sharp",Ye="Sony",U="Xiaomi",ce="Zebra",me="Facebook",nt="Chromium OS",tn="Mac OS",lr=function(Li){for(var ns={},kr=0;kr<Li.length;kr++)ns[Li[kr].toUpperCase()]=Li[kr];return ns},ts=function(Li,ns){return typeof Li===m&&ec(ns).indexOf(ec(Li))!==-1},ec=function(Li){return Li.toLowerCase()},If=function(Li,ns){if(typeof Li===m)return Li=Li.replace(/^\s\s*/,""),typeof ns===d?Li:Li.substring(0,350)},Sy=function(Li,ns){for(var kr,Ac,Kh,fi,qn,tc,gg=0;gg<ns.length&&!qn;){var Fd=ns[gg],IK=ns[gg+1];for(kr=Ac=0;kr<Fd.length&&!qn&&Fd[kr];)if(qn=Fd[kr++].exec(Li))for(Kh=0;Kh<IK.length;Kh++)tc=qn[++Ac],typeof(fi=IK[Kh])===h&&fi.length>0?fi.length===2?typeof fi[1]==c?this[fi[0]]=fi[1].call(this,tc):this[fi[0]]=fi[1]:fi.length===3?typeof fi[1]!==c||fi[1].exec&&fi[1].test?this[fi[0]]=tc?tc.replace(fi[1],fi[2]):a:this[fi[0]]=tc?fi[1].call(this,tc,fi[2]):a:fi.length===4&&(this[fi[0]]=tc?fi[3].call(this,tc.replace(fi[1],fi[2])):a):this[fi]=tc||a;gg+=2}},bT=function(Li,ns){for(var kr in ns)if(typeof ns[kr]===h&&ns[kr].length>0){for(var Ac=0;Ac<ns[kr].length;Ac++)if(ts(ns[kr][Ac],Li))return kr==="?"?a:kr}else if(ts(ns[kr],Li))return kr==="?"?a:kr;return Li},bO={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},wO={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[D,[w,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[D,[w,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[w,D],[/opios[\/ ]+([\w\.]+)/i],[D,[w,ze+" Mini"]],[/\bopr\/([\w\.]+)/i],[D,[w,ze]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/ ]?([\w\.]*)/i,/(avant |iemobile|slim)(?:browser)?[\/ ]?([\w\.]*)/i,/(ba?idubrowser)[\/ ]?([\w\.]+)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|qq|duckduckgo)\/([-\w\.]+)/i,/(weibo)__([\d\.]+)/i],[w,D],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[D,[w,"UC"+ft]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i],[D,[w,"WeChat(Win) Desktop"]],[/micromessenger\/([\w\.]+)/i],[D,[w,"WeChat"]],[/konqueror\/([\w\.]+)/i],[D,[w,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[D,[w,"IE"]],[/yabrowser\/([\w\.]+)/i],[D,[w,"Yandex"]],[/(avast|avg)\/([\w\.]+)/i],[[w,/(.+)/,"$1 Secure "+ft],D],[/\bfocus\/([\w\.]+)/i],[D,[w,An+" Focus"]],[/\bopt\/([\w\.]+)/i],[D,[w,ze+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[D,[w,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[D,[w,"Dolphin"]],[/coast\/([\w\.]+)/i],[D,[w,ze+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[D,[w,"MIUI "+ft]],[/fxios\/([-\w\.]+)/i],[D,[w,An]],[/\bqihu|(qi?ho?o?|360)browser/i],[[w,"360 "+ft]],[/(oculus|samsung|sailfish|huawei)browser\/([\w\.]+)/i],[[w,/(.+)/,"$1 "+ft],D],[/(comodo_dragon)\/([\w\.]+)/i],[[w,/_/g," "],D],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|baiduboxapp|2345Explorer)[\/ ]?([\w\.]+)/i],[w,D],[/(metasr)[\/ ]?([\w\.]+)/i,/(lbbrowser)/i,/\[(linkedin)app\]/i],[w],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[w,me],D],[/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(chromium|instagram)[\/ ]([-\w\.]+)/i],[w,D],[/\bgsa\/([\w\.]+) .*safari\//i],[D,[w,"GSA"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[D,[w,yt+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[w,yt+" WebView"],D],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[D,[w,"Android "+ft]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[w,D],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[D,[w,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[D,w],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[w,[D,bT,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[w,D],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[w,"Netscape"],D],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[D,[w,An+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror|klar)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i,/panasonic;(viera)/i],[w,D],[/(cobalt)\/([\w\.]+)/i],[w,[D,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[G,"amd64"]],[/(ia32(?=;))/i],[[G,ec]],[/((?:i[346]|x)86)[;\)]/i],[[G,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[G,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[G,"armhf"]],[/windows (ce|mobile); ppc;/i],[[G,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[G,/ower/,"",ec]],[/(sun4\w)[;\)]/i],[[G,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[G,ec]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[v,[O,at],[R,Q]],[/\b((?:s[cgp]h|gt|sm)-\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]([-\w]+)/i,/sec-(sgh\w+)/i],[v,[O,at],[R,W]],[/\((ip(?:hone|od)[\w ]*);/i],[v,[O,_e],[R,W]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[v,[O,_e],[R,Q]],[/(macintosh);/i],[v,[O,_e]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[v,[O,Pt],[R,W]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[v,[O,_r],[R,Q]],[/(?:huawei|honor)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[v,[O,_r],[R,W]],[/\b(poco[\w ]+)(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite)?)(?: bui|\))/i],[[v,/_/g," "],[O,U],[R,W]],[/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[v,/_/g," "],[O,U],[R,Q]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[v,[O,"OPPO"],[R,W]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[v,[O,"Vivo"],[R,W]],[/\b(rmx[12]\d{3})(?: bui|;|\))/i],[v,[O,"Realme"],[R,W]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[v,[O,Ra],[R,W]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[v,[O,Ra],[R,Q]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[v,[O,pi],[R,Q]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[v,[O,pi],[R,W]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[v,[O,"Lenovo"],[R,Q]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[v,/_/g," "],[O,"Nokia"],[R,W]],[/(pixel c)\b/i],[v,[O,Pn],[R,Q]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[v,[O,Pn],[R,W]],[/droid.+ (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[v,[O,Ye],[R,W]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[v,"Xperia Tablet"],[O,Ye],[R,Q]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[v,[O,"OnePlus"],[R,W]],[/(alexa)webm/i,/(kf[a-z]{2}wi)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[v,[O,Ee],[R,Q]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[v,/(.+)/g,"Fire Phone $1"],[O,Ee],[R,W]],[/(playbook);[-\w\),; ]+(rim)/i],[v,O,[R,Q]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[v,[O,Ze],[R,W]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[v,[O,Ne],[R,Q]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[v,[O,Ne],[R,W]],[/(nexus 9)/i],[v,[O,"HTC"],[R,Q]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[O,[v,/_/g," "],[R,W]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[v,[O,"Acer"],[R,Q]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[v,[O,"Meizu"],[R,W]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[-_ ]?([-\w]*)/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[O,v,[R,W]],[/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[O,v,[R,Q]],[/(surface duo)/i],[v,[O,Zr],[R,Q]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[v,[O,"Fairphone"],[R,W]],[/(u304aa)/i],[v,[O,"AT&T"],[R,W]],[/\bsie-(\w*)/i],[v,[O,"Siemens"],[R,W]],[/\b(rct\w+) b/i],[v,[O,"RCA"],[R,Q]],[/\b(venue[\d ]{2,7}) b/i],[v,[O,"Dell"],[R,Q]],[/\b(q(?:mv|ta)\w+) b/i],[v,[O,"Verizon"],[R,Q]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[v,[O,"Barnes & Noble"],[R,Q]],[/\b(tm\d{3}\w+) b/i],[v,[O,"NuVision"],[R,Q]],[/\b(k88) b/i],[v,[O,"ZTE"],[R,Q]],[/\b(nx\d{3}j) b/i],[v,[O,"ZTE"],[R,W]],[/\b(gen\d{3}) b.+49h/i],[v,[O,"Swiss"],[R,W]],[/\b(zur\d{3}) b/i],[v,[O,"Swiss"],[R,Q]],[/\b((zeki)?tb.*\b) b/i],[v,[O,"Zeki"],[R,Q]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[O,"Dragon Touch"],v,[R,Q]],[/\b(ns-?\w{0,9}) b/i],[v,[O,"Insignia"],[R,Q]],[/\b((nxa|next)-?\w{0,9}) b/i],[v,[O,"NextBook"],[R,Q]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[O,"Voice"],v,[R,W]],[/\b(lvtel\-)?(v1[12]) b/i],[[O,"LvTel"],v,[R,W]],[/\b(ph-1) /i],[v,[O,"Essential"],[R,W]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[v,[O,"Envizen"],[R,Q]],[/\b(trio[-\w\. ]+) b/i],[v,[O,"MachSpeed"],[R,Q]],[/\btu_(1491) b/i],[v,[O,"Rotor"],[R,Q]],[/(shield[\w ]+) b/i],[v,[O,"Nvidia"],[R,Q]],[/(sprint) (\w+)/i],[O,v,[R,W]],[/(kin\.[onetw]{3})/i],[[v,/\./g," "],[O,Zr],[R,W]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[v,[O,ce],[R,Q]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[v,[O,ce],[R,W]],[/smart-tv.+(samsung)/i],[O,[R,ee]],[/hbbtv.+maple;(\d+)/i],[[v,/^/,"SmartTV"],[O,at],[R,ee]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[O,pi],[R,ee]],[/(apple) ?tv/i],[O,[v,_e+" TV"],[R,ee]],[/crkey/i],[[v,yt+"cast"],[O,Pn],[R,ee]],[/droid.+aft(\w)( bui|\))/i],[v,[O,Ee],[R,ee]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[v,[O,Pt],[R,ee]],[/(bravia[\w ]+)( bui|\))/i],[v,[O,Ye],[R,ee]],[/(mitv-\w{5}) bui/i],[v,[O,U],[R,ee]],[/Hbbtv.*(technisat) (.*);/i],[O,v,[R,ee]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[O,If],[v,If],[R,ee]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[R,ee]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[O,v,[R,j]],[/droid.+; (shield) bui/i],[v,[O,"Nvidia"],[R,j]],[/(playstation [345portablevi]+)/i],[v,[O,Ye],[R,j]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[v,[O,Zr],[R,j]],[/((pebble))app/i],[O,v,[R,fe]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[v,[O,_e],[R,fe]],[/droid.+; (glass) \d/i],[v,[O,Pn],[R,fe]],[/droid.+; (wt63?0{2,3})\)/i],[v,[O,ce],[R,fe]],[/(quest( 2| pro)?)/i],[v,[O,me],[R,fe]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[O,[R,ye]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+? mobile safari/i],[v,[R,W]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[v,[R,Q]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[R,Q]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[R,W]],[/(android[-\w\. ]{0,9});.+buil/i],[v,[O,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[D,[w,"EdgeHTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[D,[w,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i],[w,D],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[D,w]],os:[[/microsoft (windows) (vista|xp)/i],[w,D],[/(windows) nt 6\.2; (arm)/i,/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i,/(windows)[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i],[w,[D,bT,bO]],[/(win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[w,"Windows"],[D,bT,bO]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/cfnetwork\/.+darwin/i],[[D,/_/g,"."],[w,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[w,tn],[D,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[D,w],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[w,D],[/\(bb(10);/i],[D,[w,Ze]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[D,[w,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[D,[w,An+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[D,[w,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[D,[w,"watchOS"]],[/crkey\/([\d\.]+)/i],[D,[w,yt+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[w,nt],D],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[w,D],[/(sunos) ?([\w\.\d]*)/i],[[w,"Solaris"],D],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux)/i,/(unix) ?([\w\.]*)/i],[w,D]]},Gl=function(Li,ns){if(typeof Li===h&&(ns=Li,Li=a),!(this instanceof Gl))return new Gl(Li,ns).getResult();var kr=typeof s!==d&&s.navigator?s.navigator:a,Ac=Li||(kr&&kr.userAgent?kr.userAgent:""),Kh=kr&&kr.userAgentData?kr.userAgentData:a,fi=ns?function(qn,tc){var gg={};for(var Fd in qn)tc[Fd]&&tc[Fd].length%2==0?gg[Fd]=tc[Fd].concat(qn[Fd]):gg[Fd]=qn[Fd];return gg}(wO,ns):wO;return this.getBrowser=function(){var qn={};return qn[w]=a,qn[D]=a,Sy.call(qn,Ac,fi.browser),qn[y]=function(tc){return typeof tc===m?tc.replace(/[^\d\.]/g,"").split(".")[0]:a}(qn[D]),kr&&kr.brave&&typeof kr.brave.isBrave==c&&(qn[w]="Brave"),qn},this.getCPU=function(){var qn={};return qn[G]=a,Sy.call(qn,Ac,fi.cpu),qn},this.getDevice=function(){var qn={};return qn[O]=a,qn[v]=a,qn[R]=a,Sy.call(qn,Ac,fi.device),!qn[R]&&Kh&&Kh.mobile&&(qn[R]=W),qn[v]=="Macintosh"&&kr&&typeof kr.standalone!==d&&kr.maxTouchPoints&&kr.maxTouchPoints>2&&(qn[v]="iPad",qn[R]=Q),qn},this.getEngine=function(){var qn={};return qn[w]=a,qn[D]=a,Sy.call(qn,Ac,fi.engine),qn},this.getOS=function(){var qn={};return qn[w]=a,qn[D]=a,Sy.call(qn,Ac,fi.os),!qn[w]&&Kh&&Kh.platform!="Unknown"&&(qn[w]=Kh.platform.replace(/chrome os/i,nt).replace(/macos/i,tn)),qn},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return Ac},this.setUA=function(qn){return Ac=typeof qn===m&&qn.length>350?If(qn,350):qn,this},this.setUA(Ac),this};Gl.VERSION="0.7.34",Gl.BROWSER=lr([w,D,y]),Gl.CPU=lr([G]),Gl.DEVICE=lr([v,O,R,j,W,ee,Q,fe,ye]),Gl.ENGINE=Gl.OS=lr([w,D]),t.exports&&(r=t.exports=Gl),r.UAParser=Gl;var mg=typeof s!==d&&(s.jQuery||s.Zepto);if(mg&&!mg.ua){var by=new Gl;mg.ua=by.getResult(),mg.ua.get=function(){return by.getUA()},mg.ua.set=function(Li){by.setUA(Li);var ns=by.getResult();for(var kr in ns)mg.ua[kr]=ns[kr]}}})(typeof window=="object"?window:o)})(Px,Px.exports);var wde=l(Px.exports),Tde=Fc,Cde=Pi,Rde=He,Ide=mh,Ade=br("iterator"),Pde=Object,Ode=function(t){if(Rde(t))return!1;var r=Pde(t);return r[Ade]!==void 0||"@@iterator"in r||Cde(Ide,Tde(r))},kde=l(Ode),t6=gv.clear;Hn({global:!0,bind:!0,forced:M.clearImmediate!==t6},{clearImmediate:t6});var Nde=typeof Bun=="function"&&Bun&&typeof Bun.version=="string",n6=M,Dde=re,xde=Oe,Lde=Nde,Mde=wt,Ude=Os,Vde=Nl,jde=n6.Function,Fde=/MSIE .\./.test(Mde)||Lde&&function(){var t=n6.Bun.version.split(".");return t.length<3||t[0]==0&&(t[1]<3||t[1]==3&&t[2]==0)}(),Bde=Hn,r6=M,i6=gv.set,Wde=function(t,r){var s=1;return Fde?function(a,c){var d=Vde(arguments.length,1)>s,h=xde(a)?a:jde(a),m=d?Ude(arguments,s):[],y=d?function(){Dde(h,this,m)}:h;return t(y)}:t},s6=r6.setImmediate?Wde(i6):i6;Bde({global:!0,bind:!0,forced:r6.setImmediate!==s6},{setImmediate:s6});var o6=l(Et.setImmediate),zde=Hn,Gde=wc,Hde=vt,$de=Nl,Kde=Bp,qde=M.process;zde({global:!0,dontCallGetSet:!0},{queueMicrotask:function(t){$de(arguments.length,1),Hde(t);var r=Kde&&qde.domain;Gde(r?r.bind(t):t)}});var a6=l(Et.queueMicrotask);function c6(t,r){return function(){return t.apply(r,arguments)}}const{toString:Yde}=Object.prototype,{getPrototypeOf:Ox}=Object,RA=(kx=Object.create(null),t=>{const r=Yde.call(t);return kx[r]||(kx[r]=r.slice(8,-1).toLowerCase())});var kx;const Id=t=>(t=t.toLowerCase(),r=>RA(r)===t),IA=t=>r=>typeof r===t,{isArray:Bv}=Array,vw=IA("undefined"),l6=Id("ArrayBuffer"),Xde=IA("string"),xl=IA("function"),u6=IA("number"),AA=t=>t!==null&&typeof t=="object",PA=t=>{if(RA(t)!=="object")return!1;const r=Ox(t);return!(r!==null&&r!==Object.prototype&&Object.getPrototypeOf(r)!==null||Symbol.toStringTag in t||kde(t))},Jde=Id("Date"),Qde=Id("File"),Zde=Id("Blob"),ehe=Id("FileList"),the=Id("URLSearchParams"),[nhe,rhe,ihe,she]=["ReadableStream","Request","Response","Headers"].map(Id);function Sw(t,r){let s,a,{allOwnKeys:c=!1}=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(t!=null)if(typeof t!="object"&&(t=[t]),Bv(t))for(s=0,a=t.length;s<a;s++)r.call(null,t[s],s,t);else{const d=c?Object.getOwnPropertyNames(t):Object.keys(t),h=d.length;let m;for(s=0;s<h;s++)m=d[s],r.call(null,t[m],m,t)}}function d6(t,r){r=r.toLowerCase();const s=Object.keys(t);let a,c=s.length;for(;c-- >0;)if(a=s[c],r===a.toLowerCase())return a;return null}const H_=e6!==void 0?e6:typeof self<"u"?self:typeof window<"u"?window:ky,h6=t=>!vw(t)&&t!==H_,ohe=(Nx=typeof Uint8Array<"u"&&Ox(Uint8Array),t=>Nx&&t instanceof Nx);var Nx;const ahe=Id("HTMLFormElement"),p6=(t=>{let{hasOwnProperty:r}=t;return(s,a)=>r.call(s,a)})(Object.prototype),che=Id("RegExp"),f6=(t,r)=>{const s=Object.getOwnPropertyDescriptors(t),a={};Sw(s,(c,d)=>{let h;(h=r(c,d,t))!==!1&&(a[d]=h||c)}),Object.defineProperties(t,a)},Dx="abcdefghijklmnopqrstuvwxyz",m6="0123456789",g6={DIGIT:m6,ALPHA:Dx,ALPHA_DIGIT:Dx+Dx.toUpperCase()+m6},lhe=Id("AsyncFunction"),_6=(y6=typeof o6=="function",E6=xl(H_.postMessage),y6?o6:E6?(xx="axios@".concat(Math.random()),OA=[],H_.addEventListener("message",t=>{let{source:r,data:s}=t;r===H_&&s===xx&&OA.length&&OA.shift()()},!1),t=>{OA.push(t),H_.postMessage(xx,"*")}):t=>setTimeout(t));var y6,E6,xx,OA;const uhe=a6!==void 0?a6.bind(H_):typeof process<"u"&&process.nextTick||_6;var ht={isArray:Bv,isArrayBuffer:l6,isBuffer:function(t){return t!==null&&!vw(t)&&t.constructor!==null&&!vw(t.constructor)&&xl(t.constructor.isBuffer)&&t.constructor.isBuffer(t)},isFormData:t=>{let r;return t&&(typeof FormData=="function"&&t instanceof FormData||xl(t.append)&&((r=RA(t))==="formdata"||r==="object"&&xl(t.toString)&&t.toString()==="[object FormData]"))},isArrayBufferView:function(t){let r;return r=typeof ArrayBuffer<"u"&&ArrayBuffer.isView?ArrayBuffer.isView(t):t&&t.buffer&&l6(t.buffer),r},isString:Xde,isNumber:u6,isBoolean:t=>t===!0||t===!1,isObject:AA,isPlainObject:PA,isReadableStream:nhe,isRequest:rhe,isResponse:ihe,isHeaders:she,isUndefined:vw,isDate:Jde,isFile:Qde,isBlob:Zde,isRegExp:che,isFunction:xl,isStream:t=>AA(t)&&xl(t.pipe),isURLSearchParams:the,isTypedArray:ohe,isFileList:ehe,forEach:Sw,merge:function t(){const{caseless:r}=h6(this)&&this||{},s={},a=(c,d)=>{const h=r&&d6(s,d)||d;PA(s[h])&&PA(c)?s[h]=t(s[h],c):PA(c)?s[h]=t({},c):Bv(c)?s[h]=c.slice():s[h]=c};for(let c=0,d=arguments.length;c<d;c++)arguments[c]&&Sw(arguments[c],a);return s},extend:function(t,r,s){let{allOwnKeys:a}=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return Sw(r,(c,d)=>{s&&xl(c)?t[d]=c6(c,s):t[d]=c},{allOwnKeys:a}),t},trim:t=>Ro(t)?Ro(t).call(t):t.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:t=>(t.charCodeAt(0)===65279&&(t=t.slice(1)),t),inherits:(t,r,s,a)=>{t.prototype=Object.create(r.prototype,a),t.prototype.constructor=t,Object.defineProperty(t,"super",{value:r.prototype}),s&&Object.assign(t.prototype,s)},toFlatObject:(t,r,s,a)=>{let c,d,h;const m={};if(r=r||{},t==null)return r;do{for(c=Object.getOwnPropertyNames(t),d=c.length;d-- >0;)h=c[d],a&&!a(h,t,r)||m[h]||(r[h]=t[h],m[h]=!0);t=s!==!1&&Ox(t)}while(t&&(!s||s(t,r))&&t!==Object.prototype);return r},kindOf:RA,kindOfTest:Id,endsWith:(t,r,s)=>{t=String(t),(s===void 0||s>t.length)&&(s=t.length),s-=r.length;const a=t.indexOf(r,s);return a!==-1&&a===s},toArray:t=>{if(!t)return null;if(Bv(t))return t;let r=t.length;if(!u6(r))return null;const s=new Array(r);for(;r-- >0;)s[r]=t[r];return s},forEachEntry:(t,r)=>{const s=(t&&t[Symbol.iterator]).call(t);let a;for(;(a=s.next())&&!a.done;){const c=a.value;r.call(t,c[0],c[1])}},matchAll:(t,r)=>{let s;const a=[];for(;(s=t.exec(r))!==null;)a.push(s);return a},isHTMLForm:ahe,hasOwnProperty:p6,hasOwnProp:p6,reduceDescriptors:f6,freezeMethods:t=>{f6(t,(r,s)=>{if(xl(t)&&["arguments","caller","callee"].indexOf(s)!==-1)return!1;const a=t[s];xl(a)&&(r.enumerable=!1,"writable"in r?r.writable=!1:r.set||(r.set=()=>{throw Error("Can not rewrite read-only method '"+s+"'")}))})},toObjectSet:(t,r)=>{const s={},a=c=>{c.forEach(d=>{s[d]=!0})};return Bv(t)?a(t):a(String(t).split(r)),s},toCamelCase:t=>t.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(r,s,a){return s.toUpperCase()+a}),noop:()=>{},toFiniteNumber:(t,r)=>t!=null&&Number.isFinite(t=+t)?t:r,findKey:d6,global:H_,isContextDefined:h6,ALPHABET:g6,generateString:function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:16,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:g6.ALPHA_DIGIT,s="";const{length:a}=r;for(;t--;)s+=r[Math.random()*a|0];return s},isSpecCompliantForm:function(t){return!!(t&&xl(t.append)&&t[Symbol.toStringTag]==="FormData"&&t[Symbol.iterator])},toJSONObject:t=>{const r=new Array(10),s=(a,c)=>{if(AA(a)){if(r.indexOf(a)>=0)return;if(!("toJSON"in a)){r[c]=a;const d=Bv(a)?[]:{};return Sw(a,(h,m)=>{const y=s(h,c+1);!vw(y)&&(d[m]=y)}),r[c]=void 0,d}}return a};return s(t,0)},isAsyncFn:lhe,isThenable:t=>t&&(AA(t)||xl(t))&&xl(t.then)&&xl(t.catch),setImmediate:_6,asap:uhe};function ar(t,r,s,a,c){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=t,this.name="AxiosError",r&&(this.code=r),s&&(this.config=s),a&&(this.request=a),c&&(this.response=c,this.status=c.status?c.status:null)}ht.inherits(ar,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:ht.toJSONObject(this.config),code:this.code,status:this.status}}});const v6=ar.prototype,S6={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(t=>{S6[t]={value:t}}),Object.defineProperties(ar,S6),Object.defineProperty(v6,"isAxiosError",{value:!0}),ar.from=(t,r,s,a,c,d)=>{const h=Object.create(v6);return ht.toFlatObject(t,h,function(m){return m!==Error.prototype},m=>m!=="isAxiosError"),ar.call(h,t.message,r,s,a,c),h.cause=t,h.name=t.name,d&&Object.assign(h,d),h};function Lx(t){return ht.isPlainObject(t)||ht.isArray(t)}function b6(t){return ht.endsWith(t,"[]")?t.slice(0,-2):t}function w6(t,r,s){return t?t.concat(r).map(function(a,c){return a=b6(a),!s&&c?"["+a+"]":a}).join(s?".":""):r}const dhe=ht.toFlatObject(ht,{},null,function(t){return/^is[A-Z]/.test(t)});function kA(t,r,s){if(!ht.isObject(t))throw new TypeError("target must be an object");r=r||new FormData;const a=(s=ht.toFlatObject(s,{metaTokens:!0,dots:!1,indexes:!1},!1,function(O,D){return!ht.isUndefined(D[O])})).metaTokens,c=s.visitor||v,d=s.dots,h=s.indexes,m=(s.Blob||typeof Blob<"u"&&Blob)&&ht.isSpecCompliantForm(r);if(!ht.isFunction(c))throw new TypeError("visitor must be a function");function y(O){if(O===null)return"";if(ht.isDate(O))return O.toISOString();if(!m&&ht.isBlob(O))throw new ar("Blob is not supported. Use a Buffer instead.");return ht.isArrayBuffer(O)||ht.isTypedArray(O)?m&&typeof Blob=="function"?new Blob([O]):Buffer.from(O):O}function v(O,D,G){let j=O;if(O&&!G&&typeof O=="object"){if(ht.endsWith(D,"{}"))D=a?D:D.slice(0,-2),O=JSON.stringify(O);else if(ht.isArray(O)&&function(W){return ht.isArray(W)&&!W.some(Lx)}(O)||(ht.isFileList(O)||ht.endsWith(D,"[]"))&&(j=ht.toArray(O)))return D=b6(D),j.forEach(function(W,Q){!ht.isUndefined(W)&&W!==null&&r.append(h===!0?w6([D],Q,d):h===null?D:D+"[]",y(W))}),!1}return!!Lx(O)||(r.append(w6(G,D,d),y(O)),!1)}const w=[],R=Object.assign(dhe,{defaultVisitor:v,convertValue:y,isVisitable:Lx});if(!ht.isObject(t))throw new TypeError("data must be an object");return function O(D,G){if(!ht.isUndefined(D)){if(w.indexOf(D)!==-1)throw Error("Circular reference detected in "+G.join("."));w.push(D),ht.forEach(D,function(j,W){(!(ht.isUndefined(j)||j===null)&&c.call(r,j,ht.isString(W)?Ro(W).call(W):W,G,R))===!0&&O(j,G?G.concat(W):[W])}),w.pop()}}(t),r}function T6(t){const r={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(t).replace(/[!'()~]|%20|%00/g,function(s){return r[s]})}function Mx(t,r){this._pairs=[],t&&kA(t,this,r)}const C6=Mx.prototype;function hhe(t){return encodeURIComponent(t).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function R6(t,r,s){if(!r)return t;const a=s&&s.encode||hhe;ht.isFunction(s)&&(s={serialize:s});const c=s&&s.serialize;let d;if(d=c?c(r,s):ht.isURLSearchParams(r)?r.toString():new Mx(r,s).toString(a),d){const h=t.indexOf("#");h!==-1&&(t=t.slice(0,h)),t+=(t.indexOf("?")===-1?"?":"&")+d}return t}C6.append=function(t,r){this._pairs.push([t,r])},C6.toString=function(t){const r=t?function(s){return t.call(this,s,T6)}:T6;return this._pairs.map(function(s){return r(s[0])+"="+r(s[1])},"").join("&")};var I6=class{constructor(){this.handlers=[]}use(t,r,s){return this.handlers.push({fulfilled:t,rejected:r,synchronous:!!s&&s.synchronous,runWhen:s?s.runWhen:null}),this.handlers.length-1}eject(t){this.handlers[t]&&(this.handlers[t]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(t){ht.forEach(this.handlers,function(r){r!==null&&t(r)})}},A6={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},P6={exports:{}},phe=Hn,fhe=xe,O6=it.f;phe({target:"Object",stat:!0,forced:Object.defineProperty!==O6,sham:!fhe},{defineProperty:O6});var k6=Et.Object,mhe=P6.exports=function(t,r,s){return k6.defineProperty(t,r,s)};k6.defineProperty.sham&&(mhe.sham=!0);var N6=l(P6.exports),ghe=TypeError,D6=l_,_he=N_,yhe=gt,Ehe=br("species"),x6=Array,vhe=function(t){var r;return D6(t)&&(r=t.constructor,(_he(r)&&(r===x6||D6(r.prototype))||yhe(r)&&(r=r[Ehe])===null)&&(r=void 0)),r===void 0?x6:r},L6=function(t,r){return new(vhe(t))(r===0?0:r)},She=u,bhe=ui,whe=br("species"),M6=function(t){return bhe>=51||!She(function(){var r=[];return(r.constructor={})[whe]=function(){return{foo:1}},r[t](Boolean).foo!==1})},The=Hn,Che=u,Rhe=l_,Ihe=gt,Ahe=ra,Phe=Ei,U6=function(t){if(t>9007199254740991)throw ghe("Maximum allowed index exceeded");return t},V6=aA,Ohe=L6,khe=M6,Nhe=ui,j6=br("isConcatSpreadable"),Dhe=Nhe>=51||!Che(function(){var t=[];return t[j6]=!1,t.concat()[0]!==t}),xhe=function(t){if(!Ihe(t))return!1;var r=t[j6];return r!==void 0?!!r:Rhe(t)};The({target:"Array",proto:!0,forced:!Dhe||!khe("concat")},{concat:function(t){var r,s,a,c,d,h=Ahe(this),m=Ohe(h,0),y=0;for(r=-1,a=arguments.length;r<a;r++)if(xhe(d=r===-1?h:arguments[r]))for(c=Phe(d),U6(y+c),s=0;s<c;s++,y++)s in d&&V6(m,y,d[s]);else U6(y+1),V6(m,y++,d);return m.length=y,m}});var F6={},Lhe=X,Mhe=we,B6=hh.f,Uhe=jD,W6=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];F6.f=function(t){return W6&&Lhe(t)=="Window"?function(r){try{return B6(r)}catch{return Uhe(W6)}}(t):B6(Mhe(t))};var Wv={},Vhe=br;Wv.f=Vhe;var z6=Et,jhe=Pi,Fhe=Wv,Bhe=it.f,Ds=function(t){var r=z6.Symbol||(z6.Symbol={});jhe(r,t)||Bhe(r,t,{value:Fhe.f(t)})},Whe=be,zhe=sn,Ghe=br,Hhe=Ed,G6=function(){var t=zhe("Symbol"),r=t&&t.prototype,s=r&&r.valueOf,a=Ghe("toPrimitive");r&&!r[a]&&Hhe(r,a,function(c){return Whe(s,this)},{})},$he=De,Khe=kt,qhe=ra,Yhe=Ei,Xhe=L6,H6=I([].push),Jhe=function(t){var r=t==1,s=t==2,a=t==3,c=t==4,d=t==6,h=t==7,m=t==5||d;return function(y,v,w,R){for(var O,D,G=qhe(y),j=Khe(G),W=$he(v,w),Q=Yhe(j),ee=0,fe=R||Xhe,ye=r?fe(y,Q):s||h?fe(y,0):void 0;Q>ee;ee++)if((m||ee in j)&&(D=W(O=j[ee],ee,G),t))if(r)ye[ee]=D;else if(D)switch(t){case 3:return!0;case 5:return O;case 6:return ee;case 2:H6(ye,O)}else switch(t){case 4:return!1;case 7:H6(ye,O)}return d?-1:a||c?c:ye}},$6={forEach:Jhe(0)},NA=Hn,Ux=M,Vx=be,Qhe=I,zv=xe,Gv=ao,Zhe=u,$o=Pi,epe=P,jx=mn,DA=we,Fx=gc,tpe=Ba,Bx=qe,bw=ma,K6=zc,npe=hh,q6=F6,rpe=Wc,Y6=Ve,X6=it,ipe=PE,J6=We,Q6=Ed,spe=tv,Wx=fc,Z6=Bc,eW=sh,ope=br,ape=Wv,cpe=Ds,lpe=G6,upe=vd,tW=yd,xA=$6.forEach,Qc=d_("hidden"),LA="Symbol",ww="prototype",dpe=tW.set,nW=tW.getterFor(LA),Ad=Object[ww],$_=Ux.Symbol,MA=$_&&$_[ww],hpe=Ux.TypeError,zx=Ux.QObject,rW=Y6.f,K_=X6.f,iW=q6.f,ppe=J6.f,sW=Qhe([].push),df=Wx("symbols"),Tw=Wx("op-symbols"),fpe=Wx("wks"),Gx=!zx||!zx[ww]||!zx[ww].findChild,Hx=zv&&Zhe(function(){return bw(K_({},"a",{get:function(){return K_(this,"a",{value:7}).a}})).a!=7})?function(t,r,s){var a=rW(Ad,r);a&&delete Ad[r],K_(t,r,s),a&&t!==Ad&&K_(Ad,r,a)}:K_,$x=function(t,r){var s=df[t]=bw(MA);return dpe(s,{type:LA,tag:t,description:r}),zv||(s.description=r),s},UA=function(t,r,s){t===Ad&&UA(Tw,r,s),jx(t);var a=Fx(r);return jx(s),$o(df,a)?(s.enumerable?($o(t,Qc)&&t[Qc][a]&&(t[Qc][a]=!1),s=bw(s,{enumerable:Bx(0,!1)})):($o(t,Qc)||K_(t,Qc,Bx(1,{})),t[Qc][a]=!0),Hx(t,a,s)):K_(t,a,s)},Kx=function(t,r){jx(t);var s=DA(r),a=K6(s).concat(lW(s));return xA(a,function(c){zv&&!Vx(oW,s,c)||UA(t,c,s[c])}),t},oW=function(t){var r=Fx(t),s=Vx(ppe,this,r);return!(this===Ad&&$o(df,r)&&!$o(Tw,r))&&(!(s||!$o(this,r)||!$o(df,r)||$o(this,Qc)&&this[Qc][r])||s)},aW=function(t,r){var s=DA(t),a=Fx(r);if(s!==Ad||!$o(df,a)||$o(Tw,a)){var c=rW(s,a);return!c||!$o(df,a)||$o(s,Qc)&&s[Qc][a]||(c.enumerable=!0),c}},cW=function(t){var r=iW(DA(t)),s=[];return xA(r,function(a){$o(df,a)||$o(Z6,a)||sW(s,a)}),s},lW=function(t){var r=t===Ad,s=iW(r?Tw:DA(t)),a=[];return xA(s,function(c){!$o(df,c)||r&&!$o(Ad,c)||sW(a,df[c])}),a};Gv||($_=function(){if(epe(MA,this))throw hpe("Symbol is not a constructor");var t=arguments.length&&arguments[0]!==void 0?tpe(arguments[0]):void 0,r=eW(t),s=function(a){this===Ad&&Vx(s,Tw,a),$o(this,Qc)&&$o(this[Qc],r)&&(this[Qc][r]=!1),Hx(this,r,Bx(1,a))};return zv&&Gx&&Hx(Ad,r,{configurable:!0,set:s}),$x(r,t)},Q6(MA=$_[ww],"toString",function(){return nW(this).tag}),Q6($_,"withoutSetter",function(t){return $x(eW(t),t)}),J6.f=oW,X6.f=UA,ipe.f=Kx,Y6.f=aW,npe.f=q6.f=cW,rpe.f=lW,ape.f=function(t){return $x(ope(t),t)},zv&&spe(MA,"description",{configurable:!0,get:function(){return nW(this).description}})),NA({global:!0,wrap:!0,forced:!Gv,sham:!Gv},{Symbol:$_}),xA(K6(fpe),function(t){cpe(t)}),NA({target:LA,stat:!0,forced:!Gv},{useSetter:function(){Gx=!0},useSimple:function(){Gx=!1}}),NA({target:"Object",stat:!0,forced:!Gv,sham:!zv},{create:function(t,r){return r===void 0?bw(t):Kx(bw(t),r)},defineProperty:UA,defineProperties:Kx,getOwnPropertyDescriptor:aW}),NA({target:"Object",stat:!0,forced:!Gv},{getOwnPropertyNames:cW}),lpe(),upe($_,LA),Z6[Qc]=!0;var uW=ao&&!!Symbol.for&&!!Symbol.keyFor,mpe=Hn,gpe=sn,_pe=Pi,ype=Ba,dW=fc,Epe=uW,qx=dW("string-to-symbol-registry"),vpe=dW("symbol-to-string-registry");mpe({target:"Symbol",stat:!0,forced:!Epe},{for:function(t){var r=ype(t);if(_pe(qx,r))return qx[r];var s=gpe("Symbol")(r);return qx[r]=s,vpe[s]=r,s}});var Spe=Hn,bpe=Pi,wpe=hc,Tpe=Ua,Cpe=uW,hW=fc("symbol-to-string-registry");Spe({target:"Symbol",stat:!0,forced:!Cpe},{keyFor:function(t){if(!wpe(t))throw TypeError(Tpe(t)+" is not a symbol");if(bpe(hW,t))return hW[t]}});var pW=l_,Rpe=Oe,fW=X,Ipe=Ba,mW=I([].push),Ape=Hn,gW=sn,_W=re,Ppe=be,Cw=I,yW=u,EW=Oe,vW=hc,SW=Os,Ope=function(t){if(Rpe(t))return t;if(pW(t)){for(var r=t.length,s=[],a=0;a<r;a++){var c=t[a];typeof c=="string"?mW(s,c):typeof c!="number"&&fW(c)!="Number"&&fW(c)!="String"||mW(s,Ipe(c))}var d=s.length,h=!0;return function(m,y){if(h)return h=!1,y;if(pW(this))return y;for(var v=0;v<d;v++)if(s[v]===m)return y}}},kpe=ao,Npe=String,Ym=gW("JSON","stringify"),VA=Cw(/./.exec),bW=Cw("".charAt),Dpe=Cw("".charCodeAt),xpe=Cw("".replace),Lpe=Cw(1 .toString),Mpe=/[\uD800-\uDFFF]/g,wW=/^[\uD800-\uDBFF]$/,TW=/^[\uDC00-\uDFFF]$/,CW=!kpe||yW(function(){var t=gW("Symbol")();return Ym([t])!="[null]"||Ym({a:t})!="{}"||Ym(Object(t))!="{}"}),RW=yW(function(){return Ym("\uDF06\uD834")!=='"\\udf06\\ud834"'||Ym("\uDEAD")!=='"\\udead"'}),Upe=function(t,r){var s=SW(arguments),a=Ope(r);if(EW(a)||t!==void 0&&!vW(t))return s[1]=function(c,d){if(EW(a)&&(d=Ppe(a,this,Npe(c),d)),!vW(d))return d},_W(Ym,null,s)},Vpe=function(t,r,s){var a=bW(s,r-1),c=bW(s,r+1);return VA(wW,t)&&!VA(TW,c)||VA(TW,t)&&!VA(wW,a)?"\\u"+Lpe(Dpe(t,0),16):t};Ym&&Ape({target:"JSON",stat:!0,forced:CW||RW},{stringify:function(t,r,s){var a=SW(arguments),c=_W(CW?Upe:Ym,null,a);return RW&&typeof c=="string"?xpe(c,Mpe,Vpe):c}});var IW=Wc,jpe=ra;Hn({target:"Object",stat:!0,forced:!ao||u(function(){IW.f(1)})},{getOwnPropertySymbols:function(t){var r=IW.f;return r?r(jpe(t)):[]}}),Ds("asyncIterator"),Ds("hasInstance"),Ds("isConcatSpreadable"),Ds("iterator"),Ds("match"),Ds("matchAll"),Ds("replace"),Ds("search"),Ds("species"),Ds("split");var Fpe=G6;Ds("toPrimitive"),Fpe();var Bpe=sn,Wpe=vd;Ds("toStringTag"),Wpe(Bpe("Symbol"),"Symbol"),Ds("unscopables"),vd(M.JSON,"JSON",!0);var zpe=Et.Symbol,Gpe=br,Hpe=it.f,AW=Gpe("metadata"),PW=Function.prototype;PW[AW]===void 0&&Hpe(PW,AW,{value:null}),Ds("dispose"),Ds("metadata");var $pe=zpe;Ds("asyncDispose");var Kpe=I,Yx=sn("Symbol"),qpe=Yx.keyFor,Ype=Kpe(Yx.prototype.valueOf),OW=Yx.isRegisteredSymbol||function(t){try{return qpe(Ype(t))!==void 0}catch{return!1}};Hn({target:"Symbol",stat:!0},{isRegisteredSymbol:OW});for(var Xpe=fc,kW=sn,Jpe=I,Qpe=hc,Zpe=br,jA=kW("Symbol"),NW=jA.isWellKnownSymbol,DW=kW("Object","getOwnPropertyNames"),efe=Jpe(jA.prototype.valueOf),xW=Xpe("wks"),Xx=0,LW=DW(jA),tfe=LW.length;Xx<tfe;Xx++)try{var MW=LW[Xx];Qpe(jA[MW])&&Zpe(MW)}catch{}var UW=function(t){if(NW&&NW(t))return!0;try{for(var r=efe(t),s=0,a=DW(xW),c=a.length;s<c;s++)if(xW[a[s]]==r)return!0}catch{}return!1};Hn({target:"Symbol",stat:!0,forced:!0},{isWellKnownSymbol:UW}),Ds("matcher"),Ds("observable"),Hn({target:"Symbol",stat:!0},{isRegistered:OW}),Hn({target:"Symbol",stat:!0,forced:!0},{isWellKnown:UW}),Ds("metadataKey"),Ds("patternMatch"),Ds("replaceAll");var Hv=l($pe),VW=l(Wv.f("iterator"));function Rw(t){return Rw=typeof Hv=="function"&&typeof VW=="symbol"?function(r){return typeof r}:function(r){return r&&typeof Hv=="function"&&r.constructor===Hv&&r!==Hv.prototype?"symbol":typeof r},Rw(t)}var nfe=l(Wv.f("toPrimitive"));function rfe(t){var r=function(s,a){if(Rw(s)!=="object"||s===null)return s;var c=s[nfe];if(c!==void 0){var d=c.call(s,a);if(Rw(d)!=="object")return d;throw new TypeError("@@toPrimitive must return a primitive value.")}return(a==="string"?String:Number)(s)}(t,"string");return Rw(r)==="symbol"?r:String(r)}function q(t,r,s){return(r=rfe(r))in t?N6(t,r,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[r]=s,t}var jW=l(Ule),ife={isBrowser:!0,classes:{URLSearchParams:jW!==void 0?jW:Mx,FormData:typeof FormData<"u"?FormData:null,Blob:typeof Blob<"u"?Blob:null},protocols:["http","https","file","blob","url","data"]};const Jx=typeof window<"u"&&typeof document<"u",Qx=typeof navigator=="object"&&navigator||void 0,sfe=Jx&&(!Qx||["ReactNative","NativeScript","NS"].indexOf(Qx.product)<0),ofe=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",afe=Jx&&window.location.href||"http://localhost";function FW(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}function BW(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?FW(Object(s),!0).forEach(function(a){q(t,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):FW(Object(s)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))})}return t}var Ya=BW(BW({},Object.freeze({__proto__:null,hasBrowserEnv:Jx,hasStandardBrowserEnv:sfe,hasStandardBrowserWebWorkerEnv:ofe,navigator:Qx,origin:afe})),ife),cfe=mn,lfe=be,ufe=Pi,dfe=P,hfe=function(){var t=cfe(this),r="";return t.hasIndices&&(r+="d"),t.global&&(r+="g"),t.ignoreCase&&(r+="i"),t.multiline&&(r+="m"),t.dotAll&&(r+="s"),t.unicode&&(r+="u"),t.unicodeSets&&(r+="v"),t.sticky&&(r+="y"),r},WW=RegExp.prototype,zW=function(t){var r=t.flags;return r!==void 0||"flags"in WW||ufe(t,"flags")||!dfe(WW,t)?r:lfe(hfe,t)},pfe=xD.charAt,GW=be,ffe=mn,mfe=Oe,gfe=X,_fe=/./.exec,yfe=TypeError,Efe=Hn,HW=be,$W=ie,vfe=KE,FA=QE,KW=Lt,qW=Gt,Iw=Ba,Sfe=mn,bfe=He,wfe=X,Tfe=BR,YW=zW,Cfe=yi,Rfe=u,Ife=as,Afe=function(t,r,s){return r+(s?pfe(t,r).length:1)},Pfe=function(t,r){var s=t.exec;if(mfe(s)){var a=GW(s,t,r);return a!==null&&ffe(a),a}if(gfe(t)==="RegExp")return GW(_fe,t,r);throw yfe("RegExp#exec called on incompatible receiver")},XW=yd,Ofe=br("matchAll"),JW="RegExp String",QW=JW+" Iterator",kfe=XW.set,Nfe=XW.getterFor(QW),Dfe=TypeError,Zx=$W("".indexOf),BA=$W("".matchAll),eL=!!BA&&!Rfe(function(){BA("a",/./)}),xfe=vfe(function(t,r,s,a){kfe(this,{type:QW,regexp:t,string:r,global:s,unicode:a,done:!1})},JW,function(){var t=Nfe(this);if(t.done)return FA(void 0,!0);var r=t.regexp,s=t.string,a=Pfe(r,s);return a===null?(t.done=!0,FA(void 0,!0)):t.global?(Iw(a[0])===""&&(r.lastIndex=Afe(s,qW(r.lastIndex),t.unicode)),FA(a,!1)):(t.done=!0,FA(a,!1))}),ZW=function(t){var r,s,a,c=Sfe(this),d=Iw(t),h=Ife(c,RegExp),m=Iw(YW(c));return r=new h(h===RegExp?c.source:c,m),s=!!~Zx(m,"g"),a=!!~Zx(m,"u"),r.lastIndex=qW(c.lastIndex),new xfe(r,d,s,a)};Efe({target:"String",proto:!0,forced:eL},{matchAll:function(t){var r,s,a,c,d=KW(this);if(bfe(t)){if(eL)return BA(d,t)}else{if(Tfe(t)&&(r=Iw(KW(YW(t))),!~Zx(r,"g")))throw Dfe("`.matchAll` does not allow non-global regexes");if(eL)return BA(d,t);if((a=Cfe(t,Ofe))===void 0&&wfe(t)=="RegExp"&&(a=ZW),a)return HW(a,t,d)}return s=Iw(d),c=new RegExp(t,"g"),HW(ZW,c,s)}});var Lfe=yc("String").matchAll,Mfe=P,Ufe=Lfe,tL=String.prototype,Vfe=function(t){var r=t.matchAll;return typeof t=="string"||t===tL||Mfe(tL,t)&&r===tL.matchAll?Ufe:r},jfe=l(Vfe);function ez(t){function r(s,a,c,d){let h=s[d++];if(h==="__proto__")return!0;const m=Number.isFinite(+h),y=d>=s.length;return h=!h&&ht.isArray(c)?c.length:h,y?(ht.hasOwnProp(c,h)?c[h]=[c[h],a]:c[h]=a,!m):(c[h]&&ht.isObject(c[h])||(c[h]=[]),r(s,a,c[h],d)&&ht.isArray(c[h])&&(c[h]=function(v){const w={},R=Object.keys(v);let O;const D=R.length;let G;for(O=0;O<D;O++)G=R[O],w[G]=v[G];return w}(c[h])),!m)}if(ht.isFormData(t)&&ht.isFunction(t.entries)){const s={};return ht.forEachEntry(t,(a,c)=>{r(function(d){return jfe(ht).call(ht,/\w+|\[(\w*)]/g,d).map(h=>h[0]==="[]"?"":h[1]||h[0])}(a),c,s,0)}),s}return null}const nL={transitional:A6,adapter:["xhr","http","fetch"],transformRequest:[function(t,r){const s=r.getContentType()||"",a=s.indexOf("application/json")>-1,c=ht.isObject(t);if(c&&ht.isHTMLForm(t)&&(t=new FormData(t)),ht.isFormData(t))return a?JSON.stringify(ez(t)):t;if(ht.isArrayBuffer(t)||ht.isBuffer(t)||ht.isStream(t)||ht.isFile(t)||ht.isBlob(t)||ht.isReadableStream(t))return t;if(ht.isArrayBufferView(t))return t.buffer;if(ht.isURLSearchParams(t))return r.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),t.toString();let d;if(c){if(s.indexOf("application/x-www-form-urlencoded")>-1)return function(h,m){return kA(h,new Ya.classes.URLSearchParams,Object.assign({visitor:function(y,v,w,R){return Ya.isNode&&ht.isBuffer(y)?(this.append(v,y.toString("base64")),!1):R.defaultVisitor.apply(this,arguments)}},m))}(t,this.formSerializer).toString();if((d=ht.isFileList(t))||s.indexOf("multipart/form-data")>-1){const h=this.env&&this.env.FormData;return kA(d?{"files[]":t}:t,h&&new h,this.formSerializer)}}return c||a?(r.setContentType("application/json",!1),function(h,m,y){if(ht.isString(h))try{return(m||JSON.parse)(h),Ro(ht).call(ht,h)}catch(v){if(v.name!=="SyntaxError")throw v}return(y||JSON.stringify)(h)}(t)):t}],transformResponse:[function(t){const r=this.transitional||nL.transitional,s=r&&r.forcedJSONParsing,a=this.responseType==="json";if(ht.isResponse(t)||ht.isReadableStream(t))return t;if(t&&ht.isString(t)&&(s&&!this.responseType||a)){const c=!(r&&r.silentJSONParsing)&&a;try{return JSON.parse(t)}catch(d){if(c)throw d.name==="SyntaxError"?ar.from(d,ar.ERR_BAD_RESPONSE,this,null,this.response):d}}return t}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Ya.classes.FormData,Blob:Ya.classes.Blob},validateStatus:function(t){return t>=200&&t<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};ht.forEach(["delete","get","head","post","put","patch"],t=>{nL.headers[t]={}});var rL=nL;const Ffe=ht.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),tz=Symbol("internals");function Aw(t){var r;return t&&Ro(r=String(t)).call(r).toLowerCase()}function WA(t){return t===!1||t==null?t:ht.isArray(t)?t.map(WA):String(t)}function iL(t,r,s,a,c){return ht.isFunction(a)?a.call(this,r,s):(c&&(r=s),ht.isString(r)?ht.isString(a)?r.indexOf(a)!==-1:ht.isRegExp(a)?a.test(r):void 0:void 0)}class zA{constructor(r){r&&this.set(r)}set(r,s,a){const c=this;function d(y,v,w){const R=Aw(v);if(!R)throw new Error("header name must be a non-empty string");const O=ht.findKey(c,R);(!O||c[O]===void 0||w===!0||w===void 0&&c[O]!==!1)&&(c[O||v]=WA(y))}const h=(y,v)=>ht.forEach(y,(w,R)=>d(w,R,v));if(ht.isPlainObject(r)||r instanceof this.constructor)h(r,s);else if(ht.isString(r)&&(r=Ro(r).call(r))&&!/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(Ro(m=r).call(m)))h((y=>{const v={};let w,R,O;return y&&y.split(`
`).forEach(function(D){var G,j;O=D.indexOf(":"),w=Ro(G=D.substring(0,O)).call(G).toLowerCase(),R=Ro(j=D.substring(O+1)).call(j),!w||v[w]&&Ffe[w]||(w==="set-cookie"?v[w]?v[w].push(R):v[w]=[R]:v[w]=v[w]?v[w]+", "+R:R)}),v})(r),s);else if(ht.isHeaders(r))for(const[y,v]of r.entries())d(v,y,a);else r!=null&&d(s,r,a);var m;return this}get(r,s){if(r=Aw(r)){const a=ht.findKey(this,r);if(a){const c=this[a];if(!s)return c;if(s===!0)return function(d){const h=Object.create(null),m=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let y;for(;y=m.exec(d);)h[y[1]]=y[2];return h}(c);if(ht.isFunction(s))return s.call(this,c,a);if(ht.isRegExp(s))return s.exec(c);throw new TypeError("parser must be boolean|regexp|function")}}}has(r,s){if(r=Aw(r)){const a=ht.findKey(this,r);return!(!a||this[a]===void 0||s&&!iL(0,this[a],a,s))}return!1}delete(r,s){const a=this;let c=!1;function d(h){if(h=Aw(h)){const m=ht.findKey(a,h);!m||s&&!iL(0,a[m],m,s)||(delete a[m],c=!0)}}return ht.isArray(r)?r.forEach(d):d(r),c}clear(r){const s=Object.keys(this);let a=s.length,c=!1;for(;a--;){const d=s[a];r&&!iL(0,this[d],d,r,!0)||(delete this[d],c=!0)}return c}normalize(r){const s=this,a={};return ht.forEach(this,(c,d)=>{var h;const m=ht.findKey(a,d);if(m)return s[m]=WA(c),void delete s[d];const y=r?function(v){return Ro(v).call(v).toLowerCase().replace(/([a-z\d])(\w*)/g,(w,R,O)=>R.toUpperCase()+O)}(d):Ro(h=String(d)).call(h);y!==d&&delete s[d],s[y]=WA(c),a[y]=!0}),this}concat(){for(var r=arguments.length,s=new Array(r),a=0;a<r;a++)s[a]=arguments[a];return this.constructor.concat(this,...s)}toJSON(r){const s=Object.create(null);return ht.forEach(this,(a,c)=>{a!=null&&a!==!1&&(s[c]=r&&ht.isArray(a)?a.join(", "):a)}),s}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(r=>{let[s,a]=r;return s+": "+a}).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(r){return r instanceof this?r:new this(r)}static concat(r){const s=new this(r);for(var a=arguments.length,c=new Array(a>1?a-1:0),d=1;d<a;d++)c[d-1]=arguments[d];return c.forEach(h=>s.set(h)),s}static accessor(r){const s=(this[tz]=this[tz]={accessors:{}}).accessors,a=this.prototype;function c(d){const h=Aw(d);s[h]||(function(m,y){const v=ht.toCamelCase(" "+y);["get","set","has"].forEach(w=>{Object.defineProperty(m,w+v,{value:function(R,O,D){return this[w].call(this,y,R,O,D)},configurable:!0})})}(a,d),s[h]=!0)}return ht.isArray(r)?r.forEach(c):c(r),this}}zA.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),ht.reduceDescriptors(zA.prototype,(t,r)=>{let{value:s}=t,a=r[0].toUpperCase()+r.slice(1);return{get:()=>s,set(c){this[a]=c}}}),ht.freezeMethods(zA);var Pd=zA;function sL(t,r){const s=this||rL,a=r||s,c=Pd.from(a.headers);let d=a.data;return ht.forEach(t,function(h){d=h.call(s,d,c.normalize(),r?r.status:void 0)}),c.normalize(),d}function nz(t){return!(!t||!t.__CANCEL__)}function $v(t,r,s){ar.call(this,t??"canceled",ar.ERR_CANCELED,r,s),this.name="CanceledError"}function rz(t,r,s){const a=s.config.validateStatus;s.status&&a&&!a(s.status)?r(new ar("Request failed with status code "+s.status,[ar.ERR_BAD_REQUEST,ar.ERR_BAD_RESPONSE][Math.floor(s.status/100)-4],s.config,s.request,s)):t(s)}ht.inherits($v,ar,{__CANCEL__:!0});const GA=function(t,r){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:3,a=0;const c=function(d,h){d=d||10;const m=new Array(d),y=new Array(d);let v,w=0,R=0;return h=h!==void 0?h:1e3,function(O){const D=Date.now(),G=y[R];v||(v=D),m[w]=O,y[w]=D;let j=R,W=0;for(;j!==w;)W+=m[j++],j%=d;if(w=(w+1)%d,w===R&&(R=(R+1)%d),D-v<h)return;const Q=G&&D-G;return Q?Math.round(1e3*W/Q):void 0}}(50,250);return function(d,h){let m,y,v=0,w=1e3/h;const R=function(O){v=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Date.now(),m=null,y&&(clearTimeout(y),y=null),d.apply(null,O)};return[function(){const O=Date.now(),D=O-v;for(var G=arguments.length,j=new Array(G),W=0;W<G;W++)j[W]=arguments[W];D>=w?R(j,O):(m=j,y||(y=setTimeout(()=>{y=null,R(m)},w-D)))},()=>m&&R(m)]}(d=>{const h=d.loaded,m=d.lengthComputable?d.total:void 0,y=h-a,v=c(y);a=h,t({loaded:h,total:m,progress:m?h/m:void 0,bytes:y,rate:v||void 0,estimated:v&&m&&h<=m?(m-h)/v:void 0,event:d,lengthComputable:m!=null,[r?"download":"upload"]:!0})},s)},iz=(t,r)=>{const s=t!=null;return[a=>r[0]({lengthComputable:s,total:t,loaded:a}),r[1]]},sz=t=>function(){for(var r=arguments.length,s=new Array(r),a=0;a<r;a++)s[a]=arguments[a];return ht.asap(()=>t(...s))};var Bfe=Ya.hasStandardBrowserEnv?((t,r)=>s=>(s=new EA(s,Ya.origin),t.protocol===s.protocol&&t.host===s.host&&(r||t.port===s.port)))(new EA(Ya.origin),Ya.navigator&&/(msie|trident)/i.test(Ya.navigator.userAgent)):()=>!0,Wfe=Ya.hasStandardBrowserEnv?{write(t,r,s,a,c,d){const h=[t+"="+encodeURIComponent(r)];ht.isNumber(s)&&h.push("expires="+new Date(s).toGMTString()),ht.isString(a)&&h.push("path="+a),ht.isString(c)&&h.push("domain="+c),d===!0&&h.push("secure"),document.cookie=h.join("; ")},read(t){const r=document.cookie.match(new RegExp("(^|;\\s*)("+t+")=([^;]*)"));return r?decodeURIComponent(r[3]):null},remove(t){this.write(t,"",Date.now()-864e5)}}:{write(){},read:()=>null,remove(){}};function oz(t,r){return t&&!function(s){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(s)}(r)?function(s,a){return a?s.replace(/\/?\/$/,"")+"/"+a.replace(/^\/+/,""):s}(t,r):r}function az(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}const cz=t=>t instanceof Pd?function(r){for(var s=1;s<arguments.length;s++){var a=arguments[s]!=null?arguments[s]:{};s%2?az(Object(a),!0).forEach(function(c){q(r,c,a[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(a)):az(Object(a)).forEach(function(c){Object.defineProperty(r,c,Object.getOwnPropertyDescriptor(a,c))})}return r}({},t):t;function q_(t,r){r=r||{};const s={};function a(v,w,R,O){return ht.isPlainObject(v)&&ht.isPlainObject(w)?ht.merge.call({caseless:O},v,w):ht.isPlainObject(w)?ht.merge({},w):ht.isArray(w)?w.slice():w}function c(v,w,R,O){return ht.isUndefined(w)?ht.isUndefined(v)?void 0:a(void 0,v,0,O):a(v,w,0,O)}function d(v,w){if(!ht.isUndefined(w))return a(void 0,w)}function h(v,w){return ht.isUndefined(w)?ht.isUndefined(v)?void 0:a(void 0,v):a(void 0,w)}function m(v,w,R){return R in r?a(v,w):R in t?a(void 0,v):void 0}const y={url:d,method:d,data:d,baseURL:h,transformRequest:h,transformResponse:h,paramsSerializer:h,timeout:h,timeoutMessage:h,withCredentials:h,withXSRFToken:h,adapter:h,responseType:h,xsrfCookieName:h,xsrfHeaderName:h,onUploadProgress:h,onDownloadProgress:h,decompress:h,maxContentLength:h,maxBodyLength:h,beforeRedirect:h,transport:h,httpAgent:h,httpsAgent:h,cancelToken:h,socketPath:h,responseEncoding:h,validateStatus:m,headers:(v,w,R)=>c(cz(v),cz(w),0,!0)};return ht.forEach(Object.keys(Object.assign({},t,r)),function(v){const w=y[v]||c,R=w(t[v],r[v],v);ht.isUndefined(R)&&w!==m||(s[v]=R)}),s}var lz=t=>{const r=q_({},t);let s,{data:a,withXSRFToken:c,xsrfHeaderName:d,xsrfCookieName:h,headers:m,auth:y}=r;if(r.headers=m=Pd.from(m),r.url=R6(oz(r.baseURL,r.url),t.params,t.paramsSerializer),y&&m.set("Authorization","Basic "+btoa((y.username||"")+":"+(y.password?unescape(encodeURIComponent(y.password)):""))),ht.isFormData(a)){if(Ya.hasStandardBrowserEnv||Ya.hasStandardBrowserWebWorkerEnv)m.setContentType(void 0);else if((s=m.getContentType())!==!1){const[v,...w]=s?s.split(";").map(R=>Ro(R).call(R)).filter(Boolean):[];m.setContentType([v||"multipart/form-data",...w].join("; "))}}if(Ya.hasStandardBrowserEnv&&(c&&ht.isFunction(c)&&(c=c(r)),c||c!==!1&&Bfe(r.url))){const v=d&&h&&Wfe.read(h);v&&m.set(d,v)}return r},zfe=typeof XMLHttpRequest<"u"&&function(t){return new pt(function(r,s){const a=lz(t);let c=a.data;const d=Pd.from(a.headers).normalize();let h,m,y,v,w,{responseType:R,onUploadProgress:O,onDownloadProgress:D}=a;function G(){v&&v(),w&&w(),a.cancelToken&&a.cancelToken.unsubscribe(h),a.signal&&a.signal.removeEventListener("abort",h)}let j=new XMLHttpRequest;function W(){if(!j)return;const ee=Pd.from("getAllResponseHeaders"in j&&j.getAllResponseHeaders());rz(function(fe){r(fe),G()},function(fe){s(fe),G()},{data:R&&R!=="text"&&R!=="json"?j.response:j.responseText,status:j.status,statusText:j.statusText,headers:ee,config:t,request:j}),j=null}j.open(a.method.toUpperCase(),a.url,!0),j.timeout=a.timeout,"onloadend"in j?j.onloadend=W:j.onreadystatechange=function(){j&&j.readyState===4&&(j.status!==0||j.responseURL&&j.responseURL.indexOf("file:")===0)&&setTimeout(W)},j.onabort=function(){j&&(s(new ar("Request aborted",ar.ECONNABORTED,t,j)),j=null)},j.onerror=function(){s(new ar("Network Error",ar.ERR_NETWORK,t,j)),j=null},j.ontimeout=function(){let ee=a.timeout?"timeout of "+a.timeout+"ms exceeded":"timeout exceeded";const fe=a.transitional||A6;a.timeoutErrorMessage&&(ee=a.timeoutErrorMessage),s(new ar(ee,fe.clarifyTimeoutError?ar.ETIMEDOUT:ar.ECONNABORTED,t,j)),j=null},c===void 0&&d.setContentType(null),"setRequestHeader"in j&&ht.forEach(d.toJSON(),function(ee,fe){j.setRequestHeader(fe,ee)}),ht.isUndefined(a.withCredentials)||(j.withCredentials=!!a.withCredentials),R&&R!=="json"&&(j.responseType=a.responseType),D&&([y,w]=GA(D,!0),j.addEventListener("progress",y)),O&&j.upload&&([m,v]=GA(O),j.upload.addEventListener("progress",m),j.upload.addEventListener("loadend",v)),(a.cancelToken||a.signal)&&(h=ee=>{j&&(s(!ee||ee.type?new $v(null,t,j):ee),j.abort(),j=null)},a.cancelToken&&a.cancelToken.subscribe(h),a.signal&&(a.signal.aborted?h():a.signal.addEventListener("abort",h)));const Q=function(ee){const fe=/^([-+\w]{1,25})(:?\/\/|:)/.exec(ee);return fe&&fe[1]||""}(a.url);Q&&Ya.protocols.indexOf(Q)===-1?s(new ar("Unsupported protocol "+Q+":",ar.ERR_BAD_REQUEST,t)):j.send(c||null)})},Gfe=(t,r)=>{const{length:s}=t=t?t.filter(Boolean):[];if(r||s){let a,c=new AbortController;const d=function(v){if(!a){a=!0,m();const w=v instanceof Error?v:this.reason;c.abort(w instanceof ar?w:new $v(w instanceof Error?w.message:w))}};let h=r&&setTimeout(()=>{h=null,d(new ar("timeout ".concat(r," of ms exceeded"),ar.ETIMEDOUT))},r);const m=()=>{t&&(h&&clearTimeout(h),h=null,t.forEach(v=>{v.unsubscribe?v.unsubscribe(d):v.removeEventListener("abort",d)}),t=null)};t.forEach(v=>v.addEventListener("abort",d));const{signal:y}=c;return y.unsubscribe=()=>ht.asap(m),y}},Hfe=t5,$fe=Dl;Hn({target:"Promise",stat:!0,forced:!0},{withResolvers:function(){var t=$fe.f(this);return{promise:t.promise,resolve:t.resolve,reject:t.reject}}});var Kfe=Dl,qfe=wh;Hn({target:"Promise",stat:!0,forced:!0},{try:function(t){var r=Kfe.f(this),s=qfe(t);return(s.error?r.reject:r.resolve)(s.value),r.promise}});var oL=l(Hfe),uz=Wv.f("asyncIterator"),Yfe=l(uz);function aL(t,r){this.v=t,this.k=r}function Pw(t){var r,s;function a(d,h){try{var m=t[d](h),y=m.value,v=y instanceof aL;oL.resolve(v?y.v:y).then(function(w){if(v){var R=d==="return"?"return":"next";if(!y.k||w.done)return a(R,w);w=t[R](w).value}c(m.done?"return":"normal",w)},function(w){a("throw",w)})}catch(w){c("throw",w)}}function c(d,h){switch(d){case"return":r.resolve({value:h,done:!0});break;case"throw":r.reject(h);break;default:r.resolve({value:h,done:!1})}(r=r.next)?a(r.key,r.arg):s=null}this._invoke=function(d,h){return new oL(function(m,y){var v={key:d,arg:h,resolve:m,reject:y,next:null};s?s=s.next=v:(r=s=v,a(d,h))})},typeof t.return!="function"&&(this.return=void 0)}function Ll(t){return function(){return new Pw(t.apply(this,arguments))}}function xn(t){return new aL(t,0)}function HA(t){var r={},s=!1;function a(c,d){return s=!0,{done:!1,value:new aL(d=new oL(function(h){h(t[c](d))}),1)}}return r[Hv!==void 0&&VW||"@@iterator"]=function(){return this},r.next=function(c){return s?(s=!1,c):a("next",c)},typeof t.throw=="function"&&(r.throw=function(c){if(s)throw s=!1,c;return a("throw",c)}),typeof t.return=="function"&&(r.return=function(c){return s?(s=!1,c):a("return",c)}),r}Pw.prototype[typeof Hv=="function"&&Yfe||"@@asyncIterator"]=function(){return this},Pw.prototype.next=function(t){return this._invoke("next",t)},Pw.prototype.throw=function(t){return this._invoke("throw",t)},Pw.prototype.return=function(t){return this._invoke("return",t)};var cL=l(uz);function lL(t){var r,s,a,c=2;for(typeof Symbol<"u"&&(s=cL,a=Symbol.iterator);c--;){if(s&&(r=t[s])!=null)return r.call(t);if(a&&(r=t[a])!=null)return new $A(r.call(t));s="@@asyncIterator",a="@@iterator"}throw new TypeError("Object is not async iterable")}function $A(t){function r(s){if(Object(s)!==s)return pt.reject(new TypeError(s+" is not an object."));var a=s.done;return pt.resolve(s.value).then(function(c){return{value:c,done:a}})}return $A=function(s){this.s=s,this.n=s.next},$A.prototype={s:null,n:null,next:function(){return r(this.n.apply(this.s,arguments))},return:function(s){var a=this.s.return;return a===void 0?pt.resolve({value:s,done:!0}):r(a.apply(this.s,arguments))},throw:function(s){var a=this.s.return;return a===void 0?pt.reject(s):r(a.apply(this.s,arguments))}},new $A(t)}const Xfe=function*(t,r){let s=t.byteLength;if(!r||s<r)return void(yield t);let a,c=0;for(;c<s;)a=c+r,yield t.slice(c,a),c=a},Jfe=function(){var t=Ll(function*(r,s){var a,c=!1,d=!1;try{for(var h,m=lL(Qfe(r));c=!(h=yield xn(m.next())).done;c=!1){const y=h.value;yield*HA(lL(Xfe(y,s)))}}catch(y){d=!0,a=y}finally{try{c&&m.return!=null&&(yield xn(m.return()))}finally{if(d)throw a}}});return function(r,s){return t.apply(this,arguments)}}(),Qfe=function(){var t=Ll(function*(r){if(r[cL])return void(yield*HA(lL(r)));const s=r.getReader();try{for(;;){const{done:a,value:c}=yield xn(s.read());if(a)break;yield c}}finally{yield xn(s.cancel())}});return function(r){return t.apply(this,arguments)}}(),dz=(t,r,s,a)=>{const c=Jfe(t,r);let d,h=0,m=y=>{d||(d=!0,a&&a(y))};return new ReadableStream({async pull(y){try{const{done:v,value:w}=await c.next();if(v)return m(),void y.close();let R=w.byteLength;if(s){let O=h+=R;s(O)}y.enqueue(new Uint8Array(w))}catch(v){throw m(v),v}},cancel:y=>(m(y),c.return())},{highWaterMark:2})};function hz(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}function pz(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?hz(Object(s),!0).forEach(function(a){q(t,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):hz(Object(s)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))})}return t}const KA=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",fz=KA&&typeof ReadableStream=="function",Zfe=KA&&(typeof TextEncoder=="function"?(mz=new TextEncoder,t=>mz.encode(t)):async t=>new Uint8Array(await new Response(t).arrayBuffer()));var mz;const gz=function(t){try{for(var r=arguments.length,s=new Array(r>1?r-1:0),a=1;a<r;a++)s[a-1]=arguments[a];return!!t(...s)}catch{return!1}},eme=fz&&gz(()=>{let t=!1;const r=new Request(Ya.origin,{body:new ReadableStream,method:"POST",get duplex(){return t=!0,"half"}}).headers.has("Content-Type");return t&&!r}),uL=fz&&gz(()=>ht.isReadableStream(new Response("").body)),qA={stream:uL&&(t=>t.body)};var _z;KA&&(_z=new Response,["text","arrayBuffer","blob","formData","stream"].forEach(t=>{!qA[t]&&(qA[t]=ht.isFunction(_z[t])?r=>r[t]():(r,s)=>{throw new ar("Response type '".concat(t,"' is not supported"),ar.ERR_NOT_SUPPORT,s)})}));const tme=async(t,r)=>{const s=ht.toFiniteNumber(t.getContentLength());return s??(async a=>a==null?0:ht.isBlob(a)?a.size:ht.isSpecCompliantForm(a)?(await new Request(Ya.origin,{method:"POST",body:a}).arrayBuffer()).byteLength:ht.isArrayBufferView(a)||ht.isArrayBuffer(a)?a.byteLength:(ht.isURLSearchParams(a)&&(a+=""),ht.isString(a)?(await Zfe(a)).byteLength:void 0))(r)};var nme=KA&&(async t=>{let{url:r,method:s,data:a,signal:c,cancelToken:d,timeout:h,onDownloadProgress:m,onUploadProgress:y,responseType:v,headers:w,withCredentials:R="same-origin",fetchOptions:O}=lz(t);v=v?(v+"").toLowerCase():"text";let D,G=Gfe([c,d&&d.toAbortSignal()],h);const j=G&&G.unsubscribe&&(()=>{G.unsubscribe()});let W;try{if(y&&eme&&s!=="get"&&s!=="head"&&(W=await tme(w,a))!==0){let Ee,_e=new Request(r,{method:"POST",body:a,duplex:"half"});if(ht.isFormData(a)&&(Ee=_e.headers.get("content-type"))&&w.setContentType(Ee),_e.body){const[Ne,Ze]=iz(W,GA(sz(y)));a=dz(_e.body,65536,Ne,Ze)}}ht.isString(R)||(R=R?"include":"omit");const Q="credentials"in Request.prototype;D=new Request(r,pz(pz({},O),{},{signal:G,method:s.toUpperCase(),headers:w.normalize().toJSON(),body:a,duplex:"half",credentials:Q?R:void 0}));let ee=await fetch(D);const fe=uL&&(v==="stream"||v==="response");if(uL&&(m||fe&&j)){const Ee={};["status","statusText","headers"].forEach(ft=>{Ee[ft]=ee[ft]});const _e=ht.toFiniteNumber(ee.headers.get("content-length")),[Ne,Ze]=m&&iz(_e,GA(sz(m),!0))||[];ee=new Response(dz(ee.body,65536,Ne,()=>{Ze&&Ze(),j&&j()}),Ee)}v=v||"text";let ye=await qA[ht.findKey(qA,v)||"text"](ee,t);return!fe&&j&&j(),await new pt((Ee,_e)=>{rz(Ee,_e,{data:ye,headers:Pd.from(ee.headers),status:ee.status,statusText:ee.statusText,config:t,request:D})})}catch(Q){throw j&&j(),Q&&Q.name==="TypeError"&&/fetch/i.test(Q.message)?Object.assign(new ar("Network Error",ar.ERR_NETWORK,t,D),{cause:Q.cause||Q}):ar.from(Q,Q&&Q.code,t,D)}});const dL={http:null,xhr:zfe,fetch:nme};ht.forEach(dL,(t,r)=>{if(t){try{Object.defineProperty(t,"name",{value:r})}catch{}Object.defineProperty(t,"adapterName",{value:r})}});const yz=t=>"- ".concat(t),rme=t=>ht.isFunction(t)||t===null||t===!1;var Ez={getAdapter:t=>{t=ht.isArray(t)?t:[t];const{length:r}=t;let s,a;const c={};for(let d=0;d<r;d++){let h;if(s=t[d],a=s,!rme(s)&&(a=dL[(h=String(s)).toLowerCase()],a===void 0))throw new ar("Unknown adapter '".concat(h,"'"));if(a)break;c[h||"#"+d]=a}if(!a){const d=Object.entries(c).map(h=>{let[m,y]=h;return"adapter ".concat(m," ")+(y===!1?"is not supported by the environment":"is not available in the build")});throw new ar("There is no suitable adapter to dispatch the request "+(r?d.length>1?`since :
`+d.map(yz).join(`
`):" "+yz(d[0]):"as no adapter specified"),"ERR_NOT_SUPPORT")}return a},adapters:dL};function hL(t){if(t.cancelToken&&t.cancelToken.throwIfRequested(),t.signal&&t.signal.aborted)throw new $v(null,t)}function vz(t){return hL(t),t.headers=Pd.from(t.headers),t.data=sL.call(t,t.transformRequest),["post","put","patch"].indexOf(t.method)!==-1&&t.headers.setContentType("application/x-www-form-urlencoded",!1),Ez.getAdapter(t.adapter||rL.adapter)(t).then(function(r){return hL(t),r.data=sL.call(t,t.transformResponse,r),r.headers=Pd.from(r.headers),r},function(r){return nz(r)||(hL(t),r&&r.response&&(r.response.data=sL.call(t,t.transformResponse,r.response),r.response.headers=Pd.from(r.response.headers))),pt.reject(r)})}const Sz="1.7.9",YA={};["object","boolean","number","function","string","symbol"].forEach((t,r)=>{YA[t]=function(s){return typeof s===t||"a"+(r<1?"n ":" ")+t}});const bz={};YA.transitional=function(t,r,s){function a(c,d){return"[Axios v"+Sz+"] Transitional option '"+c+"'"+d+(s?". "+s:"")}return(c,d,h)=>{if(t===!1)throw new ar(a(d," has been removed"+(r?" in "+r:"")),ar.ERR_DEPRECATED);return r&&!bz[d]&&(bz[d]=!0,console.warn(a(d," has been deprecated since v"+r+" and will be removed in the near future"))),!t||t(c,d,h)}},YA.spelling=function(t){return(r,s)=>(console.warn("".concat(s," is likely a misspelling of ").concat(t)),!0)};var XA={assertOptions:function(t,r,s){if(typeof t!="object")throw new ar("options must be an object",ar.ERR_BAD_OPTION_VALUE);const a=Object.keys(t);let c=a.length;for(;c-- >0;){const d=a[c],h=r[d];if(h){const m=t[d],y=m===void 0||h(m,d,t);if(y!==!0)throw new ar("option "+d+" must be "+y,ar.ERR_BAD_OPTION_VALUE)}else if(s!==!0)throw new ar("Unknown option "+d,ar.ERR_BAD_OPTION)}},validators:YA};const Ph=XA.validators;let JA=class{constructor(t){this.defaults=t,this.interceptors={request:new I6,response:new I6}}async request(t,r){try{return await this._request(t,r)}catch(s){if(s instanceof Error){let a={};Error.captureStackTrace?Error.captureStackTrace(a):a=new Error;const c=a.stack?a.stack.replace(/^.+\n/,""):"";try{s.stack?c&&!String(s.stack).endsWith(c.replace(/^.+\n.+\n/,""))&&(s.stack+=`
`+c):s.stack=c}catch{}}throw s}}_request(t,r){typeof t=="string"?(r=r||{}).url=t:r=t||{},r=q_(this.defaults,r);const{transitional:s,paramsSerializer:a,headers:c}=r;s!==void 0&&XA.assertOptions(s,{silentJSONParsing:Ph.transitional(Ph.boolean),forcedJSONParsing:Ph.transitional(Ph.boolean),clarifyTimeoutError:Ph.transitional(Ph.boolean)},!1),a!=null&&(ht.isFunction(a)?r.paramsSerializer={serialize:a}:XA.assertOptions(a,{encode:Ph.function,serialize:Ph.function},!0)),XA.assertOptions(r,{baseUrl:Ph.spelling("baseURL"),withXsrfToken:Ph.spelling("withXSRFToken")},!0),r.method=(r.method||this.defaults.method||"get").toLowerCase();let d=c&&ht.merge(c.common,c[r.method]);c&&ht.forEach(["delete","get","head","post","put","patch","common"],D=>{delete c[D]}),r.headers=Pd.concat(d,c);const h=[];let m=!0;this.interceptors.request.forEach(function(D){typeof D.runWhen=="function"&&D.runWhen(r)===!1||(m=m&&D.synchronous,h.unshift(D.fulfilled,D.rejected))});const y=[];let v;this.interceptors.response.forEach(function(D){y.push(D.fulfilled,D.rejected)});let w,R=0;if(!m){const D=[vz.bind(this),void 0];for(D.unshift.apply(D,h),D.push.apply(D,y),w=D.length,v=pt.resolve(r);R<w;)v=v.then(D[R++],D[R++]);return v}w=h.length;let O=r;for(R=0;R<w;){const D=h[R++],G=h[R++];try{O=D(O)}catch(j){G.call(this,j);break}}try{v=vz.call(this,O)}catch(D){return pt.reject(D)}for(R=0,w=y.length;R<w;)v=v.then(y[R++],y[R++]);return v}getUri(t){return R6(oz((t=q_(this.defaults,t)).baseURL,t.url),t.params,t.paramsSerializer)}};ht.forEach(["delete","get","head","options"],function(t){JA.prototype[t]=function(r,s){return this.request(q_(s||{},{method:t,url:r,data:(s||{}).data}))}}),ht.forEach(["post","put","patch"],function(t){function r(s){return function(a,c,d){return this.request(q_(d||{},{method:t,headers:s?{"Content-Type":"multipart/form-data"}:{},url:a,data:c}))}}JA.prototype[t]=r(),JA.prototype[t+"Form"]=r(!0)});var QA=JA;class pL{constructor(r){if(typeof r!="function")throw new TypeError("executor must be a function.");let s;this.promise=new pt(function(c){s=c});const a=this;this.promise.then(c=>{if(!a._listeners)return;let d=a._listeners.length;for(;d-- >0;)a._listeners[d](c);a._listeners=null}),this.promise.then=c=>{let d;const h=new pt(m=>{a.subscribe(m),d=m}).then(c);return h.cancel=function(){a.unsubscribe(d)},h},r(function(c,d,h){a.reason||(a.reason=new $v(c,d,h),s(a.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(r){this.reason?r(this.reason):this._listeners?this._listeners.push(r):this._listeners=[r]}unsubscribe(r){if(!this._listeners)return;const s=this._listeners.indexOf(r);s!==-1&&this._listeners.splice(s,1)}toAbortSignal(){const r=new AbortController,s=a=>{r.abort(a)};return this.subscribe(s),r.signal.unsubscribe=()=>this.unsubscribe(s),r.signal}static source(){let r;return{token:new pL(function(a){r=a}),cancel:r}}}var ime=pL;const fL={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(fL).forEach(t=>{let[r,s]=t;fL[s]=r});var sme=fL;const uo=function t(r){const s=new QA(r),a=c6(QA.prototype.request,s);return ht.extend(a,QA.prototype,s,{allOwnKeys:!0}),ht.extend(a,s,null,{allOwnKeys:!0}),a.create=function(c){return t(q_(r,c))},a}(rL);uo.Axios=QA,uo.CanceledError=$v,uo.CancelToken=ime,uo.isCancel=nz,uo.VERSION=Sz,uo.toFormData=kA,uo.AxiosError=ar,uo.Cancel=uo.CanceledError,uo.all=function(t){return pt.all(t)},uo.spread=function(t){return function(r){return t.apply(null,r)}},uo.isAxiosError=function(t){return ht.isObject(t)&&t.isAxiosError===!0},uo.mergeConfig=q_,uo.AxiosHeaders=Pd,uo.formToJSON=t=>ez(ht.isHTMLForm(t)?new FormData(t):t),uo.getAdapter=Ez.getAdapter,uo.HttpStatusCode=sme,uo.default=uo;var va=uo;const ome=()=>{};function Ow(){const t={promise:void 0,isResolved:!1,isRejected:!1,isFinished:!1,resolve:void 0,reject:void 0,cancel:ome};return t.promise=new pt((r,s)=>{t.resolve=a=>{t.isFinished||(t.isResolved=!0,t.isFinished=!0,r(a),t.value=a)},t.reject=a=>{t.isFinished||(t.isRejected=!0,t.isFinished=!0,s(a))}}),t}const ZA=new Map,eP=new Map,Oh=new Map;let Qi=function(t){return t.WIN_10="Windows 10",t.WIN_81="Windows 8.1",t.WIN_8="Windows 8",t.WIN_7="Windows 7",t.WIN_VISTA="Windows Vista",t.WIN_SERVER_2003="Windows Server 2003",t.WIN_XP="Windows XP",t.WIN_2000="Windows 2000",t.ANDROID="Android",t.HARMONY_OS="HarmonyOS",t.OPEN_BSD="Open BSD",t.SUN_OS="Sun OS",t.LINUX="Linux",t.IOS="iOS",t.MAC_OS="Mac OS",t.CHROMIUM_OS="Chromium OS",t.QNX="QNX",t.UNIX="UNIX",t.BEOS="BeOS",t.OS_2="OS/2",t.SEARCH_BOT="Search Bot",t}({}),$n=function(t){return t.CHROME="Chrome",t.SAFARI="Safari",t.EDGE="Edge",t.FIREFOX="Firefox",t.OPERA="OPR",t.QQ="QQBrowser",t.WECHAT="MicroMessenger",t}({});const wz=new wde;let Od=wz.getResult(),mL=null;function Ln(t){if(!mL){Od=wz.getResult();const r=function(m){if(m.engine.name==="Blink"&&m.browser.name!=="WeChat")return $n.CHROME;switch(m.browser.name){case"Chrome Headless":case"Chrome":case"Chromium":return $n.CHROME;case"Safari":case"Mobile Safari":return $n.SAFARI;case"Edge":return $n.EDGE;case"Firefox":return $n.FIREFOX;case"QQ":case"QQBrowser":return $n.QQ;case"Opera":return $n.OPERA;case"WeChat":return $n.WECHAT;default:return m.browser.name||""}}(Od),s=Tz(Od),a=function(m){return m.os.name==="Windows"?m.os.version?m.os.name+" "+m.os.version:m.os.name:m.os.name||""}(Od),c=Od.os.version,d=Tz(Od,!1),h=Od.device.type;if(!(r&&s&&a&&c))return{name:r,version:s,os:a,osVersion:c,browserVersion:d,deviceType:h};mL={name:r,version:s,os:a,osVersion:c,browserVersion:d,deviceType:h}}return mL}function Tz(t){let r,s=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];return r=t.engine.name==="Blink"?t.engine.version||"":t.browser.version||"",s?r.split(".")[0]:r}function tP(){return Ln().os}function Cz(){const t=Ln();return"".concat(t.os," ").concat(t.osVersion)}function nP(){const t=Ln();return!!(Od.engine.name==="WebKit"&&t.os===Qi.MAC_OS&&navigator.maxTouchPoints&&navigator.maxTouchPoints>0&&t.name!==$n.SAFARI||Ko()&&t.name!==$n.SAFARI)}function hf(){return Ln().name===$n.CHROME}function xs(){return Ln().name===$n.SAFARI}function Rz(){return Ln().name===$n.EDGE}function Hr(){return Ln().name===$n.FIREFOX}function Ko(){return Ln().os===Qi.IOS}function kw(t){const r=Ln();return!(r.name!==$n.CHROME||!r.osVersion)&&Number(r.version)>=t}function Iz(t){const r=Ln();return!(r.name!==$n.CHROME||!r.osVersion)&&Number(r.version)<t}function gL(t,r,s){const a=Ln();return!(a.name!==t||!a.osVersion)&&(s?Number(a.version)>=r&&Number(a.version)<=s:Number(a.version)===r)}function _L(t){const r=Ln();return!(r.name!==$n.EDGE||!r.osVersion)&&Number(r.version)>=t}function Az(t){const r=Ln();return!(r.name!==$n.SAFARI||!r.osVersion)&&Number(r.version)>=t}function Pz(t,r,s){const a=Ln();if(a.os!==Qi.IOS||!a.osVersion)return!1;const c=a.osVersion.split(".");return r&&Number(c[0])===t&&Number(c[1])<r||Number(c[0])<t}function Oz(t,r,s){const a=Ln();if(a.name!==$n.SAFARI||!a.osVersion||!a.browserVersion)return!1;const c=a.browserVersion.split(".");return s?r&&Number(c[0])===t&&Number(c[1])<r||Number(c[0])<t:r?Number(c[0])===t&&Number(c[1])<=r||Number(c[0])<t:Number(c[0])<=t}function yL(t){const r=Ln();return!(r.name!==$n.OPERA||!r.osVersion)&&Number(r.version)>=t}function kz(){const t=Ln();if(t.os!==Qi.IOS||!t.osVersion)return!1;const r=t.osVersion.split(".");return Number(r[0])<14||Number(r[0])===14&&Number(r[1])<=6}function Kv(){const t=Ln();if(t.os!==Qi.IOS||!t.osVersion)return!1;const r=t.osVersion.split(".");return Number(r[0])===15}function EL(){const t=Ln();if(t.os!==Qi.IOS||!t.osVersion)return!1;const r=t.osVersion.split(".");return Number(r[0])===16}function Nz(){const t=Ln();if(t.os!==Qi.IOS||!t.osVersion)return!1;const r=t.osVersion.split(".");return Number(r[0])===15&&Number(r[1])>=1}function Pu(){return xs()&&navigator.maxTouchPoints>0}function Dz(){return Ln().name===$n.WECHAT}function xz(){return window.navigator.appVersion&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)!==null&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]<=35}function vL(){const t=tP();return function(){const{deviceType:r}=Ln();return r==="mobile"||r==="tablet"}()||t===Qi.ANDROID||t===Qi.IOS||t===Qi.HARMONY_OS}function pf(){const t=Ln();return t.name!==$n.EDGE&&t.name!==$n.SAFARI&&!!navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]./i)}function rP(){return tP()===Qi.ANDROID}function Nw(){const t=Ln();return rP()&&(t.name===$n.CHROME||t.name===$n.WECHAT||/chrome|chromium/i.test(navigator.userAgent))}function Lz(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}function St(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?Lz(Object(s),!0).forEach(function(a){Zt(t,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):Lz(Object(s)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))})}return t}function Zt(t,r,s){return(r=function(a){var c=function(d,h){if(typeof d!="object"||d===null)return d;var m=d[Symbol.toPrimitive];if(m!==void 0){var y=m.call(d,"string");if(typeof y!="object")return y;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(d)}(a);return typeof c=="symbol"?c:String(c)}(r))in t?Object.defineProperty(t,r,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[r]=s,t}let te=function(t){return t.UNEXPECTED_ERROR="UNEXPECTED_ERROR",t.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",t.TIMEOUT="TIMEOUT",t.INVALID_PARAMS="INVALID_PARAMS",t.NOT_READABLE="NOT_READABLE",t.NOT_SUPPORTED="NOT_SUPPORTED",t.INVALID_OPERATION="INVALID_OPERATION",t.OPERATION_ABORTED="OPERATION_ABORTED",t.WEB_SECURITY_RESTRICT="WEB_SECURITY_RESTRICT",t.EXCHANGE_SDP_FAILED="EXCHANGE_SDP_FAILED",t.ADD_CANDIDATE_FAILED="ADD_CANDIDATE_FAILED",t.DATACHANNEL_FAILED="DATACHANNEL_FAILED",t.NETWORK_ERROR="NETWORK_ERROR",t.NETWORK_TIMEOUT="NETWORK_TIMEOUT",t.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",t.API_INVOKE_TIMEOUT="API_INVOKE_TIMEOUT",t.ENUMERATE_DEVICES_FAILED="ENUMERATE_DEVICES_FAILED",t.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",t.ELECTRON_IS_NULL="ELECTRON_IS_NULL",t.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",t.CHROME_PLUGIN_NO_RESPONSE="CHROME_PLUGIN_NO_RESPONSE",t.CHROME_PLUGIN_NOT_INSTALL="CHROME_PLUGIN_NOT_INSTALL",t.MEDIA_OPTION_INVALID="MEDIA_OPTION_INVALID",t.PERMISSION_DENIED="PERMISSION_DENIED",t.CONSTRAINT_NOT_SATISFIED="CONSTRAINT_NOT_SATISFIED",t.TRACK_IS_DISABLED="TRACK_IS_DISABLED",t.GET_VIDEO_ELEMENT_VISIBLE_ERROR="GET_VIDEO_ELEMENT_VISIBLE_ERROR",t.SHARE_AUDIO_NOT_ALLOWED="SHARE_AUDIO_NOT_ALLOWED",t.LOW_STREAM_ENCODING_ERROR="LOW_STREAM_ENCODING_ERROR",t.SET_ENCODING_PARAMETER_ERROR="SET_ENCODING_PARAMETER_ERROR",t.TRACK_STATE_UNREACHABLE="TRACK_STATE_UNREACHABLE",t.INVALID_UINT_UID_FROM_STRING_UID="INVALID_UINT_UID_FROM_STRING_UID",t.CAN_NOT_GET_PROXY_SERVER="CAN_NOT_GET_PROXY_SERVER",t.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER",t.VOID_GATEWAY_ADDRESS="VOID_GATEWAY_ADDRESS",t.UID_CONFLICT="UID_CONFLICT",t.MULTI_UNILBS_RESPONSE_ERROR="MULTI_UNILBS_RESPONSE_ERROR",t.UPDATE_TICKET_FAILED="UPDATE_TICKET_FAILED",t.TOKEN_EXPIRE="TOKEN_EXPIRE",t.INVALID_LOCAL_TRACK="INVALID_LOCAL_TRACK",t.INVALID_TRACK="INVALID_TRACK",t.SENDER_NOT_FOUND="SENDER_NOT_FOUND",t.CREATE_OFFER_FAILED="CREATE_OFFER_FAILED",t.SET_ANSWER_FAILED="SET_ANSWER_FAILED",t.ICE_FAILED="ICE_FAILED",t.PC_CLOSED="PC_CLOSED",t.SENDER_REPLACE_FAILED="SENDER_REPLACE_FAILED",t.GET_LOCAL_CAPABILITIES_FAILED="GET_LOCAL_CAPABILITIES_FAILED",t.GET_LOCAL_CONNECTION_PARAMS_FAILED="GET_LOCAL_CONNECTION_PARAMS_FAILED",t.SUBSCRIBE_FAILED="SUBSCRIBE_FAILED",t.UNSUBSCRIBE_FAILED="UNSUBSCRIBE_FAILED",t.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",t.NO_ICE_CANDIDATE="NO_ICE_CANDIDATE",t.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS",t.EXIST_DISABLED_VIDEO_TRACK="EXIST_DISABLED_VIDEO_TRACK",t.INVALID_REMOTE_USER="INVALID_REMOTE_USER",t.REMOTE_USER_IS_NOT_PUBLISHED="REMOTE_USER_IS_NOT_PUBLISHED",t.CUSTOM_REPORT_SEND_FAILED="CUSTOM_REPORT_SEND_FAILED",t.CUSTOM_REPORT_FREQUENCY_TOO_HIGH="CUSTOM_REPORT_FREQUENCY_TOO_HIGH",t.FETCH_AUDIO_FILE_FAILED="FETCH_AUDIO_FILE_FAILED",t.READ_LOCAL_AUDIO_FILE_ERROR="READ_LOCAL_AUDIO_FILE_ERROR",t.DECODE_AUDIO_FILE_FAILED="DECODE_AUDIO_FILE_FAILED",t.WS_ABORT="WS_ABORT",t.WS_DISCONNECT="WS_DISCONNECT",t.WS_ERR="WS_ERR",t.EXTERNAL_SIGNAL_ABORT="EXTERNAL_SIGNAL_ABORT",t.LIVE_STREAMING_TASK_CONFLICT="LIVE_STREAMING_TASK_CONFLICT",t.LIVE_STREAMING_INVALID_ARGUMENT="LIVE_STREAMING_INVALID_ARGUMENT",t.LIVE_STREAMING_INTERNAL_SERVER_ERROR="LIVE_STREAMING_INTERNAL_SERVER_ERROR",t.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED="LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED",t.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED="LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED",t.LIVE_STREAMING_CDN_ERROR="LIVE_STREAMING_CDN_ERROR",t.LIVE_STREAMING_INVALID_RAW_STREAM="LIVE_STREAMING_INVALID_RAW_STREAM",t.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT="LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT",t.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE="LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE",t.LIVE_STREAMING_WARN_FREQUENT_REQUEST="LIVE_STREAMING_WARN_FREQUENT_REQUEST",t.WEBGL_INTERNAL_ERROR="WEBGL_INTERNAL_ERROR",t.BEAUTY_PROCESSOR_INTERNAL_ERROR="BEAUTY_PROCESSOR_INTERNAL_ERROR",t.CROSS_CHANNEL_WAIT_STATUS_ERROR="CROSS_CHANNEL_WAIT_STATUS_ERROR",t.CROSS_CHANNEL_FAILED_JOIN_SRC="CROSS_CHANNEL_FAILED_JOIN_SEC",t.CROSS_CHANNEL_FAILED_JOIN_DEST="CROSS_CHANNEL_FAILED_JOIN_DEST",t.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST="CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST",t.CROSS_CHANNEL_SERVER_ERROR_RESPONSE="CROSS_CHANNEL_SERVER_ERROR_RESPONSE",t.METADATA_OUT_OF_RANGE="METADATA_OUT_OF_RANGE",t.LOCAL_AEC_ERROR="LOCAL_AEC_ERROR",t.INVALID_PLUGIN="INVALID_PLUGIN",t.DISCONNECT_P2P="DISCONNECT_P2P",t.CONVERTING_IMAGEDATA_TO_BLOB_FAILED="CONVERTING_IMAGEDATA_TO_BLOB_FAILED",t.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED="CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED",t.INIT_DATACHANNEL_TIMEOUT="INIT_DATACHANNEL_TIMEOUT",t.CREATE_DATACHANNEL_ERROR="CREATE_DATACHANNEL_ERROR",t.DATACHANNEL_CONNECTION_TIMEOUT="DATACHANNEL_CONNECTION_TIMEOUT",t.PROHIBITED_OPERATION="PROHIBITED_OPERATION",t.IMAGE_MODERATION_UPLOAD_FAILED="IMAGE_MODERATION_UPLOAD_FAILED",t.P2P_MESSAGE_FAILED="P2P_MESSAGE_FAILED",t}({}),Le=class extends Error{constructor(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",s=arguments.length>2?arguments[2]:void 0;super(r),Zt(this,"code",void 0),Zt(this,"message",void 0),Zt(this,"data",void 0),Zt(this,"name","AgoraRTCException"),this.code=t,this.message="AgoraRTCError ".concat(this.code,": ").concat(r),this.data=s}toString(){return this.data?"".concat(this.message,`
data: `).concat(JSON.stringify(this.data)):this.message}print(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error",r=arguments.length>1?arguments[1]:void 0;return t==="error"&&(r||console).error(this.toString()),t==="warning"&&(r||console).warn(this.toString()),this}throw(t){throw this.print("error",t),this}};function ff(t,r){if(typeof t!="boolean")throw new Le(te.INVALID_PARAMS,"Invalid ".concat(r,": The value is of the boolean type."))}function $i(t,r,s){if(!lt(s).call(s,t))throw new Le(te.INVALID_PARAMS,"".concat(r," can only be set as ").concat(JSON.stringify(s)))}function cr(t,r){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1e4;if(t<s||t>a||(!(arguments.length>4&&arguments[4]!==void 0)||arguments[4])&&!function(c){return typeof c=="number"&&c%1==0}(t))throw new Le(te.INVALID_PARAMS,"invalid ".concat(r,": the value range is [").concat(s,", ").concat(a,"]. integer only"))}function SL(t,r){if(typeof t!="number"){if(!(t.min||t.max||t.ideal||t.exact))throw new Le(te.INVALID_PARAMS,"".concat(r," is not a valid ConstrainLong"));t.min!==void 0&&cr(t.min,"".concat(r,".min"),0,1/0),t.max!==void 0&&cr(t.max,"".concat(r,".max"),1,1/0),t.exact!==void 0&&cr(t.exact,"".concat(r,".exact"),1,1/0),t.ideal!==void 0&&cr(t.ideal,"".concat(r,".ideal"),1,1/0)}else cr(t,r,1,1/0)}function _s(t,r){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:255,c=!(arguments.length>4&&arguments[4]!==void 0)||arguments[4];if(t==null)throw new Le(te.INVALID_PARAMS,"".concat(r||"param"," cannot be empty"));if(!Mz(t,s,a,c))throw new Le(te.INVALID_PARAMS,"Invalid ".concat(r||"string param",": Length of the string: [").concat(s,",").concat(a,"].").concat(c?" ASCII characters only.":""))}function mf(t,r){if(!Array.isArray(t))throw new Le(te.INVALID_PARAMS,"".concat(r," should be an array"))}function $r(t){return t==null}function Mz(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:255,a=!(arguments.length>3&&arguments[3]!==void 0)||arguments[3];return typeof t=="string"&&t.length<=s&&t.length>=r&&(!a||function(c){if(typeof c!="string")return!1;for(let d=0;d<c.length;d+=1){const h=c.charCodeAt(d);if(h<0||h>255)return!1}return!0}(t))}var Dw=function(t){return t.COVERED="COVERED",t.POSITION="POSITION",t.SIZE="SIZE",t.STYLE="STYLE",t}(Dw||{}),bL=function(t){return t.UNMOUNTED="UNMOUNTED",t.INVALID_HTML_ELEMENT="INVALID_HTML_ELEMENT",t}(bL||{});const Uz=new class{constructor(){Zt(this,"_clientSize",null),Zt(this,"getClientWidth",()=>document.documentElement?document.documentElement.clientWidth:document.body.clientWidth),Zt(this,"getClientHeight",()=>document.documentElement?document.documentElement.clientHeight:document.body.clientHeight),Zt(this,"getStyle",t=>window.getComputedStyle(t,null)),Zt(this,"checkCssVisibleProperty",t=>{var r;let s=!0;const a=this.getStyle(t),{display:c,visibility:d,opacity:h,filter:m}=a;return(c==="none"||lt(r=["hidden","collapse"]).call(r,d)||Number(h)<.1)&&(s=!1),!!s&&(m&&m.split(" ").filter(y=>{var v;const w=y.split("(")[0];return lt(v=["brightness","blur","opacity"]).call(v,w)}).map(y=>{const[v,w]=y.split(/\(|\)/);return[v,Number(w.match(/^[0-9\.]+/))]}).forEach(y=>{const[v,w]=y;switch(v){case"brightness":(w<.1||w>3)&&(s=!1);break;case"blur":w>3&&(s=!1);break;case"opacity":w<.1&&(s=!1)}}),s)}),Zt(this,"checkPropertyUpToAllParentNodes",(t,r)=>{let s=!0,a=!0;const c=h=>r(h);let d=t;for(;d&&a;)c(d)||(s=!1,a=!1),d=d.parentElement,d||(a=!1);return s}),Zt(this,"checkActualCssVisibleIncludeInherit",t=>this.checkPropertyUpToAllParentNodes(t,this.checkCssVisibleProperty)),Zt(this,"getSizeAboutClient",t=>{const{width:r,height:s,left:a,right:c,top:d,bottom:h}=t.getBoundingClientRect(),m=this.getClientWidth(),y=this.getClientHeight();return{width:r,height:s,left:a,right:c,top:d,bottom:h,clientWidth:m,clientHeight:y,clientMin:Math.min(m,y)}}),Zt(this,"checkActualSize",()=>{const{width:t,height:r,clientMin:s}=this._clientSize;return this.checkSizeIsVisible(t,r,s)}),Zt(this,"elementFromPoint",(t,r)=>document.elementFromPoint?document.elementFromPoint(t,r):null),Zt(this,"checkCoverForAPoint",(t,r,s)=>{const a=this.elementFromPoint(t,r);return a!==null&&a!==s}),Zt(this,"getPointPositionList",()=>{const{width:t,height:r,left:s,top:a}=this._clientSize,c=t/6,d=r/6,h=[],m=10**6;for(let y=0;y<5;y++)for(let v=0;v<5;v++){const w=(s*m+(y===0?.1:y===4?(c*y*m-1e5)/m:c*y)*m)/m,R=(a*m+(v===0?.1:v===4?(d*v*m-1e5)/m:d*v)*m)/m;h.push({x:w,y:R})}return[...h]}),Zt(this,"checkElementCover",t=>this.getPointPositionList().map(r=>this.checkCoverForAPoint(r.x,r.y,t)).filter(r=>!!r).length>6),Zt(this,"checkSizeIsVisible",(t,r,s)=>(t>50||s/t<=10)&&(r>50||s/r<=10)),Zt(this,"checkSizeOfPartInClient",()=>{const{left:t,right:r,top:s,bottom:a,clientHeight:c,clientWidth:d,clientMin:h}=this._clientSize;let m,y,v,w;if(t<0)m=0;else{if(!(t<d))return!1;m=t}if(r<0)return!1;if(y=r<d?r:d,s<0)v=0;else{if(!(s<c))return!1;v=s}if(a<0)return!1;w=a<c?a:c;const R=y-m,O=w-v;return this.checkSizeIsVisible(R,O,h)}),Zt(this,"returnHiddenResult",t=>(this._clientSize=null,{visible:!1,reason:t})),Zt(this,"checkOneElementVisible",t=>{if(t instanceof HTMLElement){if(this.checkElementIsMountedOnDom(t)){if(this.checkActualCssVisibleIncludeInherit(t)){if(this._clientSize=this.getSizeAboutClient(t),this.checkElementCover(t))return this.returnHiddenResult(Dw.COVERED);{const r=this.checkActualSize(),s=this.checkSizeOfPartInClient();return r&&!s?this.returnHiddenResult(Dw.POSITION):r?(this._clientSize=null,{visible:!0}):this.returnHiddenResult(Dw.SIZE)}}return this.returnHiddenResult(Dw.STYLE)}return this.returnHiddenResult(bL.UNMOUNTED)}return this.returnHiddenResult(bL.INVALID_HTML_ELEMENT)}),Zt(this,"checkElementIsMountedOnDom",t=>this.checkPropertyUpToAllParentNodes(t,r=>r.nodeName.toUpperCase()!=="HTML"?r.parentElement!==null:!!document.documentElement))}};function wL(t){return new TextEncoder().encode(t)}const Vz=function(t,r){const s=new Uint8Array(t.byteLength+r.byteLength);return s.set(new Uint8Array(t),0),s.set(new Uint8Array(r),t.byteLength),s},TL=async t=>function(r,s){let a="";return new Uint8Array(r).forEach(c=>{a+=c.toString(s).padStart(2,"0")}),a}(await crypto.subtle.digest("SHA-256",wL(t)),16);let Br=class{constructor(){Zt(this,"_events",{}),Zt(this,"addListener",this.on)}getListeners(t){return this._events[t]?this._events[t].map(r=>r.listener):[]}on(t,r){this._events[t]||(this._events[t]=[]);const s=this._events[t];this._indexOfListener(s,r)===-1&&s.push({listener:r,once:!1})}once(t,r){this._events[t]||(this._events[t]=[]);const s=this._events[t];this._indexOfListener(s,r)===-1&&s.push({listener:r,once:!0})}off(t,r){if(!this._events[t])return;const s=this._events[t],a=this._indexOfListener(s,r);a!==-1&&s.splice(a,1),this._events[t].length===0&&delete this._events[t]}removeAllListeners(t){t?delete this._events[t]:this._events={}}emit(t){this._events[t]||(this._events[t]=[]);const r=this._events[t].map(d=>d);for(var s=arguments.length,a=new Array(s>1?s-1:0),c=1;c<s;c++)a[c-1]=arguments[c];for(let d=0;d<r.length;d+=1){const h=r[d];h.once&&this.off(t,h.listener),h.listener.apply(this,a||[])}}safeEmit(t){for(var r=arguments.length,s=new Array(r>1?r-1:0),a=1;a<r;a++)s[a-1]=arguments[a];[...this._events[t]||[]].forEach(c=>{c.once&&this.off(t,c.listener);try{c.listener.apply(this,s)}catch(d){console.error("safeEmit event:".concat(t," error ").concat(d==null?void 0:d.toString()))}})}_indexOfListener(t,r){let s=t.length;for(;s--;)if(t[s].listener===r)return s;return-1}},xw=null;function jz(){if(xw)return xw;if(window.electron)return xw=window.electron;if(!window.require)return null;try{return xw=window.require("electron"),xw}catch{return null}}let Ni=function(t){return t.CREATE_CLIENT="createClient",t.CHECK_SYSTEM_REQUIREMENTS="checkSystemRequirements",t.SET_AREA="setArea",t.PRELOAD="PRELOAD",t.CHECK_VIDEO_TRACK_IS_ACTIVE="checkVideoTrackIsActive",t.CHECK_AUDIO_TRACK_IS_ACTIVE="checkAudioTrackIsActive",t.CREATE_MIC_AUDIO_TRACK="createMicrophoneAudioTrack",t.CREATE_CUSTOM_AUDIO_TRACK="createCustomAudioTrack",t.CREATE_BUFFER_AUDIO_TRACK="createBufferSourceAudioTrack",t.CREATE_CAM_VIDEO_TRACK="createCameraVideoTrack",t.CREATE_CUSTOM_VIDEO_TRACK="createCustomVideoTrack",t.CREATE_MIC_AND_CAM_TRACKS="createMicrophoneAndCameraTracks",t.CREATE_SCREEN_VIDEO_TRACK="createScreenVideoTrack",t.SET_ENCRYPTION_CONFIG="Client.setEncryptionConfig",t.START_PROXY_SERVER="Client.startProxyServer",t.STOP_PROXY_SERVER="Client.stopProxyServer",t.SET_PROXY_SERVER="Client.setProxyServer",t.SET_TURN_SERVER="Client.setTurnServer",t.SET_CLIENT_ROLE="Client.setClientRole",t.SET_LOW_STREAM_PARAMETER="Client.setLowStreamParameter",t.ENABLE_DUAL_STREAM="Client.enableDualStream",t.DISABLE_DUAL_STREAM="Client.disableDualStream",t.JOIN="Client.join",t.LEAVE="Client.leave",t.PUBLISH="Client.publish",t.UNPUBLISH="Client.unpublish",t.SUBSCRIBE="Client.subscribe",t.MASS_SUBSCRIBE="Client.massSubscribe",t.MASS_UNSUBSCRIBE="Client.massUnsubscribe",t.UNSUBSCRIBE="Client.unsubscribe",t.RENEW_TOKEN="Client.renewToken",t.SET_REMOTE_VIDEO_STREAM_TYPE="Client.setRemoteVideoStreamType",t.SET_STREAM_FALLBACK_OPTION="Client.setStreamFallbackOption",t.ENABLE_AUDIO_VOLUME_INDICATOR="Client.enableAudioVolumeIndicator",t.SEND_CUSTOM_REPORT_MESSAGE="Client.sendCustomReportMessage",t.INSPECT_VIDEO_CONTENT="Client.inspectVideoContent",t.STOP_INSPECT_VIDEO_CONTENT="Client.stopInspectVideoContent",t.JOIN_FALLBACK_TO_PROXY="Client._joinFallbackToProxy",t.ON_LIVE_STREAM_WARNING="Client.onLiveStreamWarning",t.ON_LIVE_STREAM_ERROR="Client.onLiveStreamingError",t.START_LIVE_STREAMING="Client.startLiveStreaming",t.SET_LIVE_TRANSCODING="Client.setLiveTranscoding",t.STOP_LIVE_STREAMING="Client.stopLiveStreaming",t.START_CHANNEL_MEDIA_RELAY="Client.startChannelMediaRelay",t.UPDATE_CHANNEL_MEDIA_RELAY="Client.updateChannelMediaRelay",t.STOP_CHANNEL_MEDIA_RELAY="Client.stopChannelMediaRelay",t.REQUEST_CONFIG_DISTRIBUTE="_config-distribute-request",t.SET_CONFIG_DISTRIBUTE="_configDistribute",t.LOCAL_TRACK_SET_MUTED="LocalTrack.setMute",t.LOCAL_AUDIO_TRACK_PLAY="LocalAudioTrack.play",t.LOCAL_AUDIO_TRACK_PLAY_IN_ELEMENT="LocalAudioTrack.playInElement",t.LOCAL_AUDIO_TRACK_STOP="LocalAudioTrack.stop",t.LOCAL_AUDIO_TRACK_SET_VOLUME="LocalAudioTrack.setVolume",t.MIC_AUDIO_TRACK_SET_DEVICE="MicrophoneAudioTrack.setDevice",t.BUFFER_AUDIO_TRACK_START="BufferSourceAudioTrack.startProcessAudioBuffer",t.BUFFER_AUDIO_TRACK_STOP="BufferSourceAudioTrack.stopProcessAudioBuffer",t.BUFFER_AUDIO_TRACK_PAUSE="BufferSourceAudioTrack.pauseProcessAudioBuffer",t.BUFFER_AUDIO_TRACK_RESUME="BufferSourceAudioTrack.resumeProcessAudioBuffer",t.BUFFER_AUDIO_TRACK_SEEK="BufferSourceAudioTrack.seekAudioBuffer",t.LOCAL_VIDEO_TRACK_PLAY="LocalVideoTrack.play",t.LOCAL_VIDEO_TRACK_STOP="LocalVideoTrack.stop",t.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE="LocalVideoTrack.getVideoElementVisibleStatus",t.LOCAL_VIDEO_TRACK_BEAUTY="LocalVideoTrack.setBeautyEffect",t.LOCAL_VIDEO_SEND_SEI_DATA="LocalVideoTrack.sendSeiData",t.CAM_VIDEO_TRACK_SET_DEVICE="CameraVideoTrack.setDevice",t.CAM_VIDEO_TRACK_SET_ENCODER_CONFIG="CameraVideoTrack.setEncoderConfiguration",t.REMOTE_VIDEO_TRACK_PLAY="RemoteVideoTrack.play",t.REMOTE_VIDEO_TRACK_STOP="RemoteVideoTrack.stop",t.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE="RemoteVideoTrack.getVideoElementVisibleStatus",t.REMOTE_AUDIO_TRACK_PLAY="RemoteAudioTrack.play",t.REMOTE_AUDIO_TRACK_STOP="RemoteAudioTrack.stop",t.REMOTE_AUDIO_SET_VOLUME="RemoteAudioTrack.setVolume",t.REMOTE_AUDIO_SET_OUTPUT_DEVICE="RemoteAudioTrack.setOutputDevice",t.GET_MEDIA_STREAM_TRACK="Track.getMediaStreamTrack",t.STREAM_TYPE_CHANGE="streamTypeChange",t.CONNECTION_STATE_CHANGE="connectionStateChange",t.LOAD_CONFIG_FROM_LOCALSTORAGE="loadConfigFromLocalStorage",t.IMAGE_MODERATION_UPLOAD="imageModerationUpload",t.REPUB_AFTER_PC_CONNECTED="repubAfterPCConnected",t}({}),Kr=function(t){return t.TRACER="tracer",t}({});function Fz(t){return cr(t.timeout,"config.timeout",0,1e5),cr(t.timeoutFactor,"config.timeoutFactor",0,100,!1),cr(t.maxRetryCount,"config.maxRetryConfig",0,1/0),cr(t.maxRetryTimeout,"config.maxRetryTimeout",0,1/0),!0}let ame=function(t){return t[t.AUDIENCE_LEVEL_LOW_LATENCY=1]="AUDIENCE_LEVEL_LOW_LATENCY",t[t.AUDIENCE_LEVEL_ULTRA_LOW_LATENCY=2]="AUDIENCE_LEVEL_ULTRA_LOW_LATENCY",t[t.AUDIENCE_LEVEL_SYNC_LATENCY=3]="AUDIENCE_LEVEL_SYNC_LATENCY",t}({}),Xn=function(t){return t.LEAVE="LEAVE",t.NETWORK_ERROR="NETWORK_ERROR",t.SERVER_ERROR="SERVER_ERROR",t.UID_BANNED="UID_BANNED",t.FALLBACK="FALLBACK",t.IP_BANNED="IP_BANNED",t.CHANNEL_BANNED="CHANNEL_BANNED",t.LICENSE_MISSING="LICENSE_MISSING",t.LICENSE_EXPIRED="LICENSE_EXPIRED",t.LICENSE_MINUTES_EXCEEDED="LICENSE_MINUTES_EXCEEDED",t.LICENSE_PERIOD_INVALID="LICENSE_PERIOD_INVALID",t.LICENSE_MULTIPLE_SDK_SERVICE="LICENSE_MULTIPLE_SDK_SERVICE",t.LICENSE_ILLEGAL="LICENSE_ILLEGAL",t.TOKEN_EXPIRE="TOKEN_EXPIRE",t}({});function Lw(t){if(!Array.isArray(t)||t.length<1)return!1;try{t.forEach(r=>{if(!r.urls)throw Error()})}catch{return!1}return!0}function Bz(t){return _s(t.turnServerURL,"turnServerURL"),_s(t.username,"username"),_s(t.password,"password"),t.udpport&&cr(t.udpport,"udpport",1,99999,!0),t.forceturn&&ff(t.forceturn,"forceturn"),t.security&&ff(t.security,"security"),t.tcpport&&cr(t.tcpport,"tcpport",1,99999,!0),!0}function CL(t){return t.level!==void 0&&$i(t.level,"level",[1,2,3]),t.delay!==void 0&&cr(t.delay,"delay",0,3e3,!0),!0}let wn=function(t){return t.PEERCONNECTION_STATE_CHANGE="peerconnection-state-change",t.AUDIO_METADATA="audio-metadata",t.CONNECTION_STATE_CHANGE="connection-state-change",t.MEDIA_RECONNECT_START="media-reconnect-start",t.MEDIA_RECONNECT_END="media-reconnect-end",t.IS_USING_CLOUD_PROXY="is-using-cloud-proxy",t.USER_JOINED="user-joined",t.USER_LEAVED="user-left",t.USER_PUBLISHED="user-published",t.USER_UNPUBLISHED="user-unpublished",t.USER_INFO_UPDATED="user-info-updated",t.CLIENT_BANNED="client-banned",t.CHANNEL_MEDIA_RELAY_STATE="channel-media-relay-state",t.CHANNEL_MEDIA_RELAY_EVENT="channel-media-relay-event",t.VOLUME_INDICATOR="volume-indicator",t.CRYPT_ERROR="crypt-error",t.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="token-privilege-will-expire",t.ON_TOKEN_PRIVILEGE_DID_EXPIRE="token-privilege-did-expire",t.NETWORK_QUALITY="network-quality",t.STREAM_TYPE_CHANGED="stream-type-changed",t.STREAM_FALLBACK="stream-fallback",t.RECEIVE_METADATA="receive-metadata",t.STREAM_MESSAGE="stream-message",t.LIVE_STREAMING_ERROR="live-streaming-error",t.LIVE_STREAMING_WARNING="live-streaming-warning",t.EXCEPTION="exception",t.ERROR="error",t.P2P_LOST="p2p_lost",t.JOIN_FALLBACK_TO_PROXY="join-fallback-to-proxy",t.CHANNEL_FALLBACK_TO_WEBSOCKET="channel-fallback-to-websocket",t.MEDIA_CONNECTION_TYPE_CHANGE="media-connection-type-change",t.PUBLISHED_USER_LIST="published-user-list",t.CONTENT_INSPECT_CONNECTION_STATE_CHANGE="content-inspect-connection-state-change",t.CONTENT_INSPECT_ERROR="content-inspect-error",t.CONTENT_INSPECT_RESULT="content-inspect-result",t.IMAGE_MODERATION_CONNECTION_STATE_CHANGE="image-moderation-connection-state-change",t}({}),Ls=function(t){return t.NETWORK_ERROR="NETWORK_ERROR",t.SERVER_ERROR="SERVER_ERROR",t.MULTI_IP="MULTI_IP",t.TIMEOUT="TIMEOUT",t.OFFLINE="OFFLINE",t.LEAVE="LEAVE",t.P2P_FAILED="P2P_FAILED",t.FALLBACK="FALLBACK",t.REGIONAL_DISTRIBUTION="REGIONAL_DISTRIBUTION",t}({}),Rc=function(t){return t.ONLINE="ONLINE",t.OFFLINE="OFFLINE",t}({}),qv=function(t){return t.NETWORK_STATE_CHANGE="NETWORK_STATE_CHANGE",t.ONLINE="ONLINE",t.OFFLINE="OFFLINE",t}({});function Ms(t,r){for(var s=arguments.length,a=new Array(s>2?s-2:0),c=2;c<s;c++)a[c-2]=arguments[c];return t.getListeners(r).length===0?pt.reject(new Le(te.UNEXPECTED_ERROR,"can not emit promise")):new pt((d,h)=>{t.emit(r,...a,d,h)})}function fr(t,r){if(t.getListeners(r).length===0)return pt.resolve();for(var s=arguments.length,a=new Array(s>2?s-2:0),c=2;c<s;c++)a[c-2]=arguments[c];return Ms(t,r,...a)}function Zc(t,r){if(t.getListeners(r).length===0)return null;for(var s=arguments.length,a=new Array(s>2?s-2:0),c=2;c<s;c++)a[c-2]=arguments[c];return Mw(t,r,...a)}function Mw(t,r){let s=null,a=null;for(var c=arguments.length,d=new Array(c>2?c-2:0),h=2;h<c;h++)d[h-2]=arguments[h];if(t.emit(r,...d,m=>{s=m},m=>{a=m}),a!==null)throw a;if(s===null)throw new Le(te.UNEXPECTED_ERROR,"handler is not sync");return s}const Si=new class extends Br{set networkState(t){this.emit(qv.NETWORK_STATE_CHANGE,t,this._networkState),t===Rc.ONLINE?this.emit(qv.ONLINE):t===Rc.OFFLINE&&(this.onlineWaiter=new pt(r=>{this.once(qv.ONLINE,()=>{this.onlineWaiter=void 0,r(Rc.ONLINE)})}),this.emit(qv.OFFLINE)),this._networkState=t}get networkState(){return this._networkState}get isOnline(){return this._networkState===Rc.ONLINE}constructor(){super(),Zt(this,"_moduleName","network-indicator"),Zt(this,"_networkState",Rc.ONLINE),Zt(this,"onlineWaiter",void 0),window.addEventListener("online",()=>{this.networkState=Rc.ONLINE}),window.addEventListener("offline",()=>{this.networkState=Rc.OFFLINE})}};function iP(t,r){const s=t.indexOf(r);s!==-1&&t.splice(s,1)}function Yv(t){const r=[];return t.forEach(s=>{r.indexOf(s)===-1&&r.push(s)}),r}function sP(t){pt!==void 0?pt.resolve().then(t):setTimeout(t,0)}function qr(t){return JSON.parse(JSON.stringify(t))}function Y_(t){try{return qr(t)}catch{return t}}const Wz={};function Xm(t,r){Wz[r]||(Wz[r]=!0,t())}function X_(t){const r=window.atob(t),s=new Uint8Array(new ArrayBuffer(r.length));for(let a=0;a<r.length;a+=1)s[a]=r.charCodeAt(a);return s}function Jm(t){let r="";for(let s=0;s<t.length;s+=1)r+=String.fromCharCode(t[s]);return window.btoa(r)}function zz(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:16,s=new TextEncoder().encode(t);if(s.length>r)s=s.slice(0,r);else if(s.length<r){const a=new Uint8Array(r);a.set(s),s=a}return s}function Gz(){for(var t=arguments.length,r=new Array(t),s=0;s<t;s++)r[s]=arguments[s];const a=Ec(r).call(r,(h,m)=>h+m.length,0),c=new Uint8Array(new ArrayBuffer(a));let d=0;return r.forEach(h=>{c.set(h,d),d+=h.length}),c}function kh(t){return window.TextEncoder?new TextEncoder().encode(t).length:t.length}function Hz(t){let r=0;return(/DingTalk/i.test(navigator.userAgent)||/AliApp/i.test(navigator.userAgent))&&t.realFormData&&(t=t.realFormData),t.forEach(s=>{r+=typeof s=="string"?kh(s):s.size}),r+138}function cme(t){const r=new Le(te.TIMEOUT,"timeout");return new pt((s,a)=>{window.setTimeout(()=>a(r),t)})}function ys(t){return new pt(r=>{window.setTimeout(r,t)})}function mr(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:7,r=arguments.length>1?arguments[1]:void 0;const s=Math.random().toString(16).substr(2,t).toLowerCase();return s.length===t?"".concat(r).concat(s):"".concat(r).concat(s)+mr(t-s.length,"")}function J_(){return mr(32,"").toUpperCase()}const oP=()=>{},$z=new class{constructor(){Zt(this,"fnMap",new Map)}throttleByKey(t,r,s,a){for(var c=arguments.length,d=new Array(c>4?c-4:0),h=4;h<c;h++)d[h-4]=arguments[h];if(this.fnMap.has(r)){const m=this.fnMap.get(r);if(m.threshold!==s){m.fn(...m.args),clearTimeout(m.timer);const y=window.setTimeout(()=>{const v=this.fnMap.get(r);v&&v.fn(...v.args),this.fnMap.delete(r)},s);this.fnMap.set(r,{fn:t,threshold:s,timer:y,args:d,skipFn:a})}else m.skipFn&&m.skipFn(...m.args),this.fnMap.set(r,St(St({},m),{},{fn:t,args:d,skipFn:a}))}else{const m=window.setTimeout(()=>{const y=this.fnMap.get(r);y&&y.fn(...y.args),this.fnMap.delete(r)},s);this.fnMap.set(r,{fn:t,threshold:s,timer:m,args:d,skipFn:a})}}},Kz=$z.throttleByKey.bind($z);function qz(t){return typeof t=="object"&&t!==null&&!(t instanceof RegExp)}function RL(t,r){if(!qz(t)||!qz(r)||Array.isArray(t)&&!Array.isArray(r)||!Array.isArray(t)&&Array.isArray(r))return r;if(Array.isArray(r)&&Array.isArray(t)){const s=[...t];for(let a=0;a<r.length;a++)s[a]=RL(t[a],r[a]);return s}{const s=St({},t);for(const a in r)Object.prototype.hasOwnProperty.call(r,a)&&(Object.prototype.hasOwnProperty.call(t,a)?s[a]=RL(t[a],r[a]):s[a]=r[a]);return s}}function Yz(t,r){let s=[0];if(s=new Array(r).fill(0),t===0)return s;let a=0;for(;t>0&&(s[a]=255&t,t>>=8,a++,a!==r););return s}function IL(t){return typeof t=="number"?t:t.exact||t.ideal||t.max||t.min||0}function Xz(t){const r="0123456789abcdef";function s(fe){let ye,Ee="";for(ye=0;ye<=3;ye++)Ee+=r.charAt(fe>>8*ye+4&15)+r.charAt(fe>>8*ye&15);return Ee}function a(fe,ye){const Ee=(65535&fe)+(65535&ye);return(fe>>16)+(ye>>16)+(Ee>>16)<<16|65535&Ee}function c(fe,ye,Ee,_e,Ne,Ze){return a(function(ft,yt){return ft<<yt|ft>>>32-yt}(a(a(ye,fe),a(_e,Ze)),Ne),Ee)}function d(fe,ye,Ee,_e,Ne,Ze,ft){return c(ye&Ee|~ye&_e,fe,ye,Ne,Ze,ft)}function h(fe,ye,Ee,_e,Ne,Ze,ft){return c(ye&_e|Ee&~_e,fe,ye,Ne,Ze,ft)}function m(fe,ye,Ee,_e,Ne,Ze,ft){return c(ye^Ee^_e,fe,ye,Ne,Ze,ft)}function y(fe,ye,Ee,_e,Ne,Ze,ft){return c(Ee^(ye|~_e),fe,ye,Ne,Ze,ft)}const v=function(fe){let ye;const Ee=1+(fe.length+8>>6),_e=new Array(16*Ee);for(ye=0;ye<16*Ee;ye++)_e[ye]=0;for(ye=0;ye<fe.length;ye++)_e[ye>>2]|=fe.charCodeAt(ye)<<ye%4*8;return _e[ye>>2]|=128<<ye%4*8,_e[16*Ee-2]=8*fe.length,_e}(t);let w,R,O,D,G,j=1732584193,W=-271733879,Q=-1732584194,ee=271733878;for(w=0;w<v.length;w+=16)R=j,O=W,D=Q,G=ee,j=d(j,W,Q,ee,v[w+0],7,-680876936),ee=d(ee,j,W,Q,v[w+1],12,-389564586),Q=d(Q,ee,j,W,v[w+2],17,606105819),W=d(W,Q,ee,j,v[w+3],22,-1044525330),j=d(j,W,Q,ee,v[w+4],7,-176418897),ee=d(ee,j,W,Q,v[w+5],12,1200080426),Q=d(Q,ee,j,W,v[w+6],17,-1473231341),W=d(W,Q,ee,j,v[w+7],22,-45705983),j=d(j,W,Q,ee,v[w+8],7,1770035416),ee=d(ee,j,W,Q,v[w+9],12,-1958414417),Q=d(Q,ee,j,W,v[w+10],17,-42063),W=d(W,Q,ee,j,v[w+11],22,-1990404162),j=d(j,W,Q,ee,v[w+12],7,1804603682),ee=d(ee,j,W,Q,v[w+13],12,-40341101),Q=d(Q,ee,j,W,v[w+14],17,-1502002290),W=d(W,Q,ee,j,v[w+15],22,1236535329),j=h(j,W,Q,ee,v[w+1],5,-165796510),ee=h(ee,j,W,Q,v[w+6],9,-1069501632),Q=h(Q,ee,j,W,v[w+11],14,643717713),W=h(W,Q,ee,j,v[w+0],20,-373897302),j=h(j,W,Q,ee,v[w+5],5,-701558691),ee=h(ee,j,W,Q,v[w+10],9,38016083),Q=h(Q,ee,j,W,v[w+15],14,-660478335),W=h(W,Q,ee,j,v[w+4],20,-405537848),j=h(j,W,Q,ee,v[w+9],5,568446438),ee=h(ee,j,W,Q,v[w+14],9,-1019803690),Q=h(Q,ee,j,W,v[w+3],14,-187363961),W=h(W,Q,ee,j,v[w+8],20,1163531501),j=h(j,W,Q,ee,v[w+13],5,-1444681467),ee=h(ee,j,W,Q,v[w+2],9,-51403784),Q=h(Q,ee,j,W,v[w+7],14,1735328473),W=h(W,Q,ee,j,v[w+12],20,-1926607734),j=m(j,W,Q,ee,v[w+5],4,-378558),ee=m(ee,j,W,Q,v[w+8],11,-2022574463),Q=m(Q,ee,j,W,v[w+11],16,1839030562),W=m(W,Q,ee,j,v[w+14],23,-35309556),j=m(j,W,Q,ee,v[w+1],4,-1530992060),ee=m(ee,j,W,Q,v[w+4],11,1272893353),Q=m(Q,ee,j,W,v[w+7],16,-155497632),W=m(W,Q,ee,j,v[w+10],23,-1094730640),j=m(j,W,Q,ee,v[w+13],4,681279174),ee=m(ee,j,W,Q,v[w+0],11,-358537222),Q=m(Q,ee,j,W,v[w+3],16,-722521979),W=m(W,Q,ee,j,v[w+6],23,76029189),j=m(j,W,Q,ee,v[w+9],4,-640364487),ee=m(ee,j,W,Q,v[w+12],11,-421815835),Q=m(Q,ee,j,W,v[w+15],16,530742520),W=m(W,Q,ee,j,v[w+2],23,-995338651),j=y(j,W,Q,ee,v[w+0],6,-198630844),ee=y(ee,j,W,Q,v[w+7],10,1126891415),Q=y(Q,ee,j,W,v[w+14],15,-1416354905),W=y(W,Q,ee,j,v[w+5],21,-57434055),j=y(j,W,Q,ee,v[w+12],6,1700485571),ee=y(ee,j,W,Q,v[w+3],10,-1894986606),Q=y(Q,ee,j,W,v[w+10],15,-1051523),W=y(W,Q,ee,j,v[w+1],21,-2054922799),j=y(j,W,Q,ee,v[w+8],6,1873313359),ee=y(ee,j,W,Q,v[w+15],10,-30611744),Q=y(Q,ee,j,W,v[w+6],15,-1560198380),W=y(W,Q,ee,j,v[w+13],21,1309151649),j=y(j,W,Q,ee,v[w+4],6,-145523070),ee=y(ee,j,W,Q,v[w+11],10,-1120210379),Q=y(Q,ee,j,W,v[w+2],15,718787259),W=y(W,Q,ee,j,v[w+9],21,-343485551),j=a(j,R),W=a(W,O),Q=a(Q,D),ee=a(ee,G);return s(j)+s(W)+s(Q)+s(ee)}let lme=1,Jz=console,Xs=class{static setLogger(t){Jz=t}constructor(t,r){Zt(this,"id",void 0),Zt(this,"lockingPromise",pt.resolve()),Zt(this,"locks",0),Zt(this,"name",""),Zt(this,"lockId",void 0),this.lockId=lme++,t&&(this.name=t),r&&(this.id=r),this.logger("created")}logger(t,r){const s=(this.id?"[".concat(this.id,"]"):"")+"[lock-".concat(this.name,"-").concat(this.lockId,"]"),a=t==="created"?"is ".concat(t,"."):"is ".concat(t,", current queue ").concat(this.locks,". ").concat(r??"");Jz.debug("".concat(s," ").concat(a))}setId(t){this.id=t}get isLocked(){return this.locks>0}lock(t){let r;this.locks+=1,this.logger("locked",t);const s=new pt(c=>{r=()=>{this.locks-=1,this.logger("unlocked",t),c()}}),a=this.lockingPromise.then(()=>r);return this.lockingPromise=this.lockingPromise.then(()=>s),a}};function Xv(t,r){return function(s,a,c){const d=c.value;if(typeof d!="function")throw new Error("Cannot use mutex on object property.");return c.value=async function(){const h=this[r];if(!h)throw new Error("mutex property key ".concat(r," doesn't exist on ").concat(t));const m=await h.lock("From ".concat(t,".").concat(a));try{for(var y=arguments.length,v=new Array(y),w=0;w<y;w++)v[w]=arguments[w];return await d.apply(this,v)}finally{m()}},c}}const Di={timeout:500,timeoutFactor:1.5,maxRetryCount:1/0,maxRetryTimeout:1e4};function AL(t,r){const s=Math.floor(r.timeout*Math.pow(r.timeoutFactor,t));return Math.min(r.maxRetryTimeout,s)}function kd(t,r,s,a){const c=Object.assign({},Di,a);let d=c.timeout;const h=async()=>{await function(v){return new pt(w=>{window.setTimeout(w,v)})}(d),d*=c.timeoutFactor,d=Math.min(c.maxRetryTimeout,d)};let m=!1;const y=new pt(async(v,w)=>{r=r||(()=>!1),s=s||(()=>!0);for(let R=0;R<c.maxRetryCount;R+=1){if(m)return w(new Le(te.OPERATION_ABORTED));try{const O=await t();if(!r(O,R)||R+1===c.maxRetryCount)return v(O);await h()}catch(O){if(!s(O,R)||R+1===c.maxRetryCount)return w(O);await h()}}});return y.cancel=()=>m=!0,y}let aP,Qz=class{constructor(t){Zt(this,"input",[]),Zt(this,"size",void 0),this.size=t}add(t){this.input.push(t),this.input.length>this.size&&this.input.splice(0,1)}mean(){var t;return this.input.length===0?0:Ec(t=this.input).call(t,(r,s)=>r+s)/this.input.length}},cP=0,PL=0;function OL(t,r,s,a){return new pt((c,d)=>{r.responseType=r.responseType||"json",r.data&&!s?(r.data=JSON.stringify(r.data),cP+=kh(r.data)):s&&(r.data.size?cP+=r.data.size:r.data instanceof FormData?cP+=Hz(r.data):cP+=kh(JSON.stringify(r.data))),r.headers=r.headers||{},r.headers["Content-Type"]=r.headers["Content-Type"]||"application/json",r.method="POST",r.url=t,va.request(r).then(h=>{typeof h.data=="string"?PL+=kh(h.data):h.data instanceof ArrayBuffer||h.data instanceof Uint8Array?PL+=h.data.byteLength:PL+=kh(JSON.stringify(h.data)),c(h.data)}).catch(h=>{va.isCancel(h)?d(new Le(te.OPERATION_ABORTED,"cancel token canceled")):h.code==="ECONNABORTED"?d(new Le(te.NETWORK_TIMEOUT,h.message)):h.response?d(new Le(te.NETWORK_RESPONSE_ERROR,h.response.status)):d(new Le(te.NETWORK_ERROR,h.message))})})}async function ume(t,r){const s=new Blob([r.data],{type:"buffer"});return await OL(t,St(St({},r),{},{data:s,headers:{"Content-Type":"application/octet-stream"}}),!0)}const Zz=()=>window.isSecureContext!==void 0;function Ou(t){if(Array.isArray(t))return t.map(s=>s);if(!e8(t))return t;const r={};for(const s in t){const a=t[s];e8(a)||Array.isArray(a)?r[s]=Ou(a):r[s]=a}return r}function e8(t){return!(typeof t!="object"||Array.isArray(t)||!t)}let kL=class{constructor(t){Zt(this,"input",[]),Zt(this,"size",void 0),this.size=t}add(t){this.input.push(t),this.input.length>this.size&&this.input.splice(0,1)}diffMean(){return this.input.length===0?0:(this.input[this.input.length-1]-this.input[0])/this.input.length}};const Nh={address:"unknown",candidateType:"unknown",id:"unknown",port:0,priority:0,protocol:"unknown",type:"unknown"},Uw={timestamp:0,bitrate:{actualEncoded:0,transmit:0},sendPacketLossRate:0,recvPacketLossRate:0,videoRecv:[],videoSend:[],audioRecv:[],audioSend:[],selectedCandidatePair:{id:"unknown",localCandidate:Nh,remoteCandidate:Nh},updateInterval:0},t8={firsCount:0,nacksCount:0,plisCount:0,framesDecodeCount:0,framesDecodeInterval:0,framesDecodeFreezeTime:0,decodeFrameRate:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,qpSumPerFrame:0,framesDroppedCount:0,outputFrameRate:0,packetsDiscarded:0,framesAssembledFromMultiplePackets:0,totalProcessingDelay:0,avgDecodeMs:0,avgFramesAssembledFromMultiplePacketsMs:0,avgProcessingDelayMs:0,avgInterFrameDelayMs:0,totalAssemblyTime:0},n8={firsCount:0,nacksCount:0,plisCount:0,frameCount:0,bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0,qpSumPerFrame:0},r8={bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0},i8={jitterBufferMs:0,jitterMs:0,bytes:0,packetsLost:0,packetLostRate:0,packetsDiscarded:0,packets:0,ssrc:0,receivedFrames:0,droppedFrames:0,concealedSamples:0,totalSamplesReceived:0};let NL=class{constructor(t,r){Zt(this,"onFirstVideoReceived",void 0),Zt(this,"onFirstVideoDecoded",void 0),Zt(this,"onFirstAudioReceived",void 0),Zt(this,"onFirstVideoDecodedTimeout",void 0),Zt(this,"onFirstAudioDecoded",void 0),Zt(this,"onSelectedLocalCandidateChanged",void 0),Zt(this,"onSelectedRemoteCandidateChanged",void 0),Zt(this,"videoIsReady",!1),Zt(this,"videoIsReady2",{}),Zt(this,"pc",void 0),Zt(this,"options",void 0),Zt(this,"intervalTimer",void 0),Zt(this,"stats",Ou(Uw)),Zt(this,"isFirstVideoReceived",{}),Zt(this,"isFirstVideoDecoded",{}),Zt(this,"isFirstAudioReceived",{}),Zt(this,"isFirstAudioDecoded",{}),Zt(this,"isFirstVideoDecodedTimeout",{}),Zt(this,"lossRateWindowStats",[]),this.pc=t,this.options=r,this.intervalTimer=window.setInterval(async()=>{this.updateStats()},this.options.updateInterval)}getStats(){return this.stats}getSelectedCandidatePair(){return new pt(t=>{t({local:St({},Nh),remote:St({},Nh)})})}setVideoIsReady(t){this.videoIsReady=t}setVideoIsReady2(t,r){this.videoIsReady2[t]=r}getVideoIsReady(t){return this.videoIsReady2[t]||!1}setIsFirstAudioDecoded(t){}destroy(){window.clearInterval(this.intervalTimer),this.pc=void 0}calcLossRate(t){this.lossRateWindowStats.push(t),this.lossRateWindowStats.length>this.options.lossRateInterval&&this.lossRateWindowStats.splice(0,1);const r=this.lossRateWindowStats.length,s=["videoSend","audioSend","videoRecv","audioRecv"];let a=0,c=0,d=0,h=0;for(const m of s)t[m].forEach((y,v)=>{if(!this.lossRateWindowStats[r-1][m][v]||!this.lossRateWindowStats[0][m][v])return;const w=this.lossRateWindowStats[r-1][m][v].packets-this.lossRateWindowStats[0][m][v].packets,R=this.lossRateWindowStats[r-1][m][v].packetsLost-this.lossRateWindowStats[0][m][v].packetsLost;m==="videoSend"||m==="audioSend"?(a+=w,d+=R):(c+=w,h+=R),Number.isNaN(w)||Number.isNaN(w)?y.packetLostRate=0:y.packetLostRate=w<=0||R<=0?0:R/(w+R)});t.sendPacketLossRate=a<=0||d<=0?0:d/(a+d),t.recvPacketLossRate=c<=0||h<=0?0:h/(c+h)}},dme=class extends NL{constructor(){super(...arguments),Zt(this,"_stats",Uw),Zt(this,"lastDecodeVideoReceiverStats",new Map)}async updateStats(){const t=await this._getStats(),r=this.statsResponsesToObjects(t);this._stats=Ou(Uw);const s=r.filter(c=>c.type==="ssrc");this.processSSRCStats(s);const a=r.find(c=>c.type==="VideoBwe");a&&this.processBandwidthStats(a),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}processBandwidthStats(t){this._stats.bitrate={actualEncoded:Number(t.googActualEncBitrate),targetEncoded:Number(t.googTargetEncBitrate),retransmit:Number(t.googRetransmitBitrate),transmit:Number(t.googTransmitBitrate)},this._stats.sendBandwidth=Number(t.googAvailableSendBandwidth)}processSSRCStats(t){t.forEach(r=>{var s;const a=lt(s=r.id).call(s,"send");switch("".concat(r.mediaType,"_").concat(a?"send":"recv")){case"video_send":{const c=Ou(n8);c.codec=r.googCodecName,c.adaptionChangeReason="none",r.googCpuLimitedResolution&&(c.adaptionChangeReason="cpu"),r.googBandwidthLimitedResolution&&(c.adaptionChangeReason="bandwidth"),c.avgEncodeMs=Number(r.googAvgEncodeMs),c.inputFrame={width:Number(r.googFrameWidthInput)||Number(r.googFrameWidthSent),height:Number(r.googFrameHeightInput)||Number(r.googFrameHeightSent),frameRate:Number(r.googFrameRateInput)},c.sentFrame={width:Number(r.googFrameWidthSent),height:Number(r.googFrameHeightSent),frameRate:Number(r.googFrameRateInput)},c.firsCount=Number(r.googFirReceived),c.nacksCount=Number(r.googNacksReceived),c.plisCount=Number(r.googPlisReceived),c.frameCount=Number(r.framesEncoded),c.bytes=Number(r.bytesSent),c.packets=Number(r.packetsSent),c.packetsLost=Number(r.packetsLost),c.ssrc=Number(r.ssrc),c.rttMs=Number(r.googRtt||0),this._stats.videoSend.push(c),this._stats.rtt=c.rttMs;break}case"video_recv":{const c=Ou(t8),d=this.lastDecodeVideoReceiverStats.get(Number(r.ssrc));if(c.codec=r.googCodecName,c.targetDelayMs=Number(r.googTargetDelayMs),c.renderDelayMs=Number(r.googRenderDelayMs),c.currentDelayMs=Number(r.googCurrentDelayMs),c.minPlayoutDelayMs=Number(r.googMinPlayoutDelayMs),c.decodeMs=Number(r.googDecodeMs),c.maxDecodeMs=Number(r.googMaxDecodeMs),c.receivedFrame={width:Number(r.googFrameWidthReceived),height:Number(r.googFrameHeightReceived),frameRate:Number(r.googFrameRateReceived)},c.decodedFrame={width:Number(r.googFrameWidthReceived),height:Number(r.googFrameHeightReceived),frameRate:Number(r.googFrameRateDecoded)},c.decodeFrameRate=Number(r.googFrameRateDecoded),c.outputFrame={width:Number(r.googFrameWidthReceived),height:Number(r.googFrameHeightReceived),frameRate:Number(r.googFrameRateOutput)},c.jitterBufferMs=Number(r.googJitterBufferMs),c.firsCount=Number(r.googFirsSent),c.nacksCount=Number(r.googNacksSent),c.plisCount=Number(r.googPlisSent),c.framesDecodeCount=Number(r.framesDecoded),c.bytes=Number(r.bytesReceived),c.packets=Number(r.packetsReceived),c.packetsLost=Number(r.packetsLost),c.ssrc=Number(r.ssrc),c.packets>0&&!this.isFirstVideoReceived[c.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(c.ssrc),this.isFirstVideoReceived[c.ssrc]=!0),c.framesDecodeCount>0&&!this.isFirstVideoDecoded[c.ssrc]&&(this.onFirstVideoDecoded&&this.onFirstVideoDecoded(c.ssrc,c.decodedFrame.width,c.decodedFrame.height),this.isFirstVideoDecoded[c.ssrc]=!0),d){const h=d.stats,m=Date.now()-d.lts;c.framesDecodeFreezeTime=h.framesDecodeFreezeTime,c.framesDecodeInterval=h.framesDecodeInterval,c.framesDecodeCount>h.framesDecodeCount&&this.isFirstVideoDecoded[c.ssrc]?(d.lts=Date.now(),c.framesDecodeInterval=m,c.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(r.ssrc,10))?c.framesDecodeFreezeTime+=c.framesDecodeInterval:this.setVideoIsReady2(parseInt(r.ssrc,10),!0))):c.framesDecodeCount<d.stats.framesDecodeCount&&(c.framesDecodeInterval=0)}this.lastDecodeVideoReceiverStats.set(c.ssrc,{stats:St({},c),lts:Date.now()}),this._stats.videoRecv.push(c);break}case"audio_recv":{const c=Ou(i8);c.codec=r.googCodecName,c.outputLevel=Math.abs(Number(r.audioOutputLevel))/32767,c.decodingCNG=Number(r.googDecodingCNG),c.decodingCTN=Number(r.googDecodingCTN),c.decodingCTSG=Number(r.googDecodingCTSG),c.decodingNormal=Number(r.googDecodingNormal),c.decodingPLC=Number(r.googDecodingPLC),c.decodingPLCCNG=Number(r.googDecodingPLCCNG),c.expandRate=Number(r.googExpandRate),c.accelerateRate=Number(r.googAccelerateRate),c.preemptiveExpandRate=Number(r.googPreemptiveExpandRate),c.secondaryDecodedRate=Number(r.googSecondaryDecodedRate),c.speechExpandRate=Number(r.googSpeechExpandRate),c.preferredJitterBufferMs=Number(r.googPreferredJitterBufferMs),c.jitterBufferMs=Number(r.googJitterBufferMs),c.jitterMs=Number(r.googJitterReceived),c.bytes=Number(r.bytesReceived),c.packets=Number(r.packetsReceived),c.packetsLost=Number(r.packetsLost),c.ssrc=Number(r.ssrc),c.receivedFrames=Number(r.googDecodingCTN)||Number(r.packetsReceived),c.droppedFrames=Number(r.googDecodingPLC)+Number(r.googDecodingPLCCNG)||Number(r.packetsLost),c.receivedFrames>0&&!this.isFirstAudioReceived[c.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(c.ssrc),this.isFirstAudioReceived[c.ssrc]=!0),c.decodingNormal>0&&!this.isFirstAudioDecoded[c.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(c.ssrc),this.isFirstAudioDecoded[c.ssrc]=!0),this._stats.audioRecv.push(c);break}case"audio_send":{const c=Ou(r8);c.codec=r.googCodecName,c.inputLevel=Math.abs(Number(r.audioInputLevel))/32767,c.aecReturnLoss=Number(r.googEchoCancellationReturnLoss||0),c.aecReturnLossEnhancement=Number(r.googEchoCancellationReturnLossEnhancement||0),c.residualEchoLikelihood=Number(r.googResidualEchoLikelihood||0),c.residualEchoLikelihoodRecentMax=Number(r.googResidualEchoLikelihoodRecentMax||0),c.bytes=Number(r.bytesSent),c.packets=Number(r.packetsSent),c.packetsLost=Number(r.packetsLost),c.ssrc=Number(r.ssrc),c.rttMs=Number(r.googRtt||0),this._stats.rtt=c.rttMs,this._stats.audioSend.push(c);break}}})}_getStats(){return new pt((t,r)=>{this.pc.getStats(t,r)})}statsResponsesToObjects(t){const r=[];return t.result().forEach(s=>{const a={id:s.id,timestamp:s.timestamp.valueOf().toString(),type:s.type};s.names().forEach(c=>{a[c]=s.stat(c)}),r.push(a)}),r}},Vw=function(t){return t.BANDWIDTH="bandwidth",t.CPU="cpu",t.NONE="none",t.OTHER="other",t}({}),lP=function(t){return t.L1T1="L1T1",t.L1T2="L1T2",t.L1T3="L1T3",t.L1T3_KEY="L1T3_KEY",t.L2T1_KEY="L2T1_KEY",t.L2T2_KEY="L2T2_KEY",t.L2T3_KEY="L2T3_KEY",t.L3T1_KEY="L3T1_KEY",t.L3T2_KEY="L3T2_KEY",t.L3T3_KEY="L3T3_KEY",t}({}),DL=function(t){return t[t.new=0]="new",t[t.connecting=1]="connecting",t[t.connected=2]="connected",t[t.disconnected=3]="disconnected",t[t.failed=4]="failed",t[t.closed=5]="closed",t}({}),el=function(t){return t.CERTIFICATE="certificate",t.CODEC="codec",t.CANDIDATE_PAIR="candidate-pair",t.LOCAL_CANDIDATE="local-candidate",t.REMOTE_CANDIDATE="remote-candidate",t.INBOUND="inbound-rtp",t.TRACK="track",t.OUTBOUND="outbound-rtp",t.PC="peer-connection",t.REMOTE_INBOUND="remote-inbound-rtp",t.REMOTE_OUTBOUND="remote-outbound-rtp",t.TRANSPORT="transport",t.CSRC="csrc",t.DATA_CHANNEL="data-channel",t.STREAM="stream",t.SENDER="sender",t.RECEIVER="receiver",t}({});var Jv=function(t){return t[t.kNone=1]="kNone",t[t.kMillisecondsFromSeconds=1e3]="kMillisecondsFromSeconds",t[t.kBytesToBits=8]="kBytesToBits",t}(Jv||{});function jw(t,r,s,a){let c=arguments.length>4&&arguments[4]!==void 0?arguments[4]:Jv.kNone;if(!r)return;const d=Number(r[s]);if(typeof d!="number")return;const h=Number(r[a]);if(typeof h!="number")return;if(!t)return h?d/h*c:void 0;const m=Number(t[s]);if(typeof m!="number")return;const y=Number(t[a]);if(typeof y!="number")return;const v=h-y;return v?(d-m)/v*c:void 0}let s8=class extends NL{constructor(){super(...arguments),Zt(this,"_stats",Uw),Zt(this,"report",void 0),Zt(this,"lastDecodeVideoReceiverStats",new Map),Zt(this,"lastVideoFramesRecv",new Map),Zt(this,"lastVideoFramesSent",new Map),Zt(this,"lastVideoFramesDecode",new Map),Zt(this,"lastVideoFramesOutput",new Map),Zt(this,"lastVideoJBDelay",new Map),Zt(this,"lastAudioJBDelay",new Map),Zt(this,"mediaBytesSent",new Map),Zt(this,"mediaBytesRetransmit",new Map),Zt(this,"mediaBytesTargetEncode",new Map),Zt(this,"lastDecodeAudioReceiverStats",new Map),Zt(this,"lastEncoderMs",new Map)}async updateStats(){this.report=await this.pc.getStats(),this._stats=Ou(Uw),this.report.forEach(t=>{switch(t.type){case el.OUTBOUND:case el.INBOUND:{const r=t.mediaType||t.kind,s=!r&&"frameWidth"in t,a=!r&&!("frameWidth"in t);t.type===el.OUTBOUND?r==="audio"||a?this.processAudioOutboundStats(t):(r==="video"||s)&&this.processVideoOutboundStats(t):t.type===el.INBOUND&&(r==="audio"||a?this.processAudioInboundStats(t):(r==="video"||s)&&this.processVideoInboundStats(t));break}case el.TRANSPORT:{const r=this.report.get(t.selectedCandidatePairId);r&&this.processCandidatePairStats(r);break}case el.CANDIDATE_PAIR:t.selected&&this.processCandidatePairStats(t)}}),this.updateSendBitrate(),this._stats.updateInterval=Date.now()-this.stats.timestamp,this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}async getSelectedCandidatePair(){const t=await this.pc.getStats(),r={local:St({},Nh),remote:St({},Nh)};return t.forEach(s=>{let a;if(s.type===el.TRANSPORT&&(a=t.get(s.selectedCandidatePairId)),s.type===el.CANDIDATE_PAIR&&s.selected&&(a=s),a){const c=(d,h)=>{d.type=h.type,d.id=h.id,h.address&&(d.address=h.address),h.candidateType&&(d.candidateType=h.candidateType),h.port&&(d.port=h.port),h.priority&&(d.priority=h.priority),h.protocol&&(d.protocol=h.protocol),h.relayProtocol&&(d.relayProtocol=h.relayProtocol)};if(a.localCandidateId){const d=t.get(a.localCandidateId);d&&c(r.local,d)}if(a.remoteCandidateId){const d=t.get(a.remoteCandidateId);d&&c(r.remote,d)}}}),r}processCandidatePairStats(t){if(this._stats.sendBandwidth=t.availableOutgoingBitrate||0,t.currentRoundTripTime&&(this._stats.rtt=1e3*t.currentRoundTripTime),this._stats.videoSend.forEach(r=>{t.currentRoundTripTime&&(r.rttMs=1e3*t.currentRoundTripTime)}),this._stats.audioSend.forEach(r=>{t.currentRoundTripTime&&(r.rttMs=1e3*t.currentRoundTripTime)}),this._stats.selectedCandidatePair.id=t.id,t.localCandidateId){const r=this.report.get(t.localCandidateId);r&&this.processCandidateStats(r)}if(t.remoteCandidateId){const r=this.report.get(t.remoteCandidateId);r&&this.processCandidateStats(r)}}processCandidateStats(t){let r;t.type===el.LOCAL_CANDIDATE&&(r=this._stats.selectedCandidatePair.localCandidate),t.type===el.REMOTE_CANDIDATE&&(r=this._stats.selectedCandidatePair.remoteCandidate),r&&(r.type=t.type,r.id=t.id,t.address&&(r.address=t.address),t.candidateType&&(r.candidateType=t.candidateType),t.port&&(r.port=t.port),t.priority&&(r.priority=t.priority),t.protocol&&(r.protocol=t.protocol),t.relayProtocol&&(r.relayProtocol=t.relayProtocol),t.type===el.LOCAL_CANDIDATE&&this.stats.selectedCandidatePair.localCandidate.id!==r.id&&this.onSelectedLocalCandidateChanged&&this.onSelectedLocalCandidateChanged(St({},r),St({},this.stats.selectedCandidatePair.localCandidate)),t.type===el.REMOTE_CANDIDATE&&this.stats.selectedCandidatePair.remoteCandidate.id!==r.id&&this.onSelectedRemoteCandidateChanged&&this.onSelectedRemoteCandidateChanged(St({},r),St({},this.stats.selectedCandidatePair.remoteCandidate)))}processAudioInboundStats(t){let r=this._stats.audioRecv.find(a=>a.ssrc===t.ssrc);r||(r=Ou(i8),this._stats.audioRecv.push(r)),r.ssrc=t.ssrc,r.packets=t.packetsReceived,r.packetsLost=t.packetsLost,r.packetsDiscarded=t.packetsDiscarded,r.bytes=t.bytesReceived,r.jitterMs=1e3*t.jitter,r.retransmittedBytesReceived=t.retransmittedBytesReceived,r.retransmittedPacketsReceived=t.retransmittedPacketsReceived,r.totalProcessingDelay=t.totalProcessingDelay,r.jitterBufferEmittedCount=t.jitterBufferEmittedCount;const s=this.lastDecodeAudioReceiverStats.get(r.ssrc);r.avgProcessingDelayMs=jw(s,r,"totalProcessingDelay","jitterBufferEmittedCount",Jv.kMillisecondsFromSeconds),this.processAudioTrackReceiverStats(t,t.trackId,r),t.codecId&&(r.codec=this.getCodecFromCodecStats(t.codecId)),r.receivedFrames||(r.receivedFrames=t.packetsReceived),r.droppedFrames||(r.droppedFrames=t.packetsLost),r.receivedFrames>0&&!this.isFirstAudioReceived[r.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(r.ssrc),this.isFirstAudioReceived[r.ssrc]=!0),r.outputLevel&&r.outputLevel>0&&!this.isFirstAudioDecoded[r.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(r.ssrc),this.isFirstAudioDecoded[r.ssrc]=!0),typeof t.concealedSamples=="number"&&(r.concealedSamples=t.concealedSamples),this.lastDecodeAudioReceiverStats.set(r.ssrc,St({},r))}processVideoInboundStats(t){let r=this._stats.videoRecv.find(h=>h.ssrc===t.ssrc);r||(r=Ou(t8),this._stats.videoRecv.push(r)),r.ssrc=t.ssrc,r.packets=t.packetsReceived,r.packetsLost=t.packetsLost,r.bytes=t.bytesReceived,r.firsCount=t.firCount,r.nacksCount=t.nackCount,r.plisCount=t.pliCount,r.framesDecodeCount=t.framesDecoded,r.framesDroppedCount=t.framesDropped,r.totalInterFrameDelay=t.totalInterFrameDelay,r.totalSquaredInterFrameDelay=t.totalSquaredInterFrameDelay,r.totalFreezesDuration=t.totalFreezesDuration,r.totalProcessingDelay=t.totalProcessingDelay,r.packetsDiscarded=t.packetsDiscarded,r.framesAssembledFromMultiplePackets=t.framesAssembledFromMultiplePackets,r.totalAssemblyTime=t.totalAssemblyTime,r.keyFramesDecoded=t.keyFramesDecoded,r.retransmittedBytesReceived=t.retransmittedBytesReceived,r.retransmittedPacketsReceived=t.retransmittedPacketsReceived;const s=this.lastDecodeVideoReceiverStats.get(r.ssrc),a=this.lastVideoFramesDecode.get(r.ssrc),c=this.lastVideoFramesOutput.get(r.ssrc),d=Date.now();if(r.framesDecodeCount>0&&!this.isFirstVideoDecoded[r.ssrc]){const h=r.decodedFrame?r.decodedFrame.width:0,m=r.decodedFrame?r.decodedFrame.height:0;this.onFirstVideoDecoded&&this.onFirstVideoDecoded(r.ssrc,h,m),this.isFirstVideoDecoded[r.ssrc]=!0}if(s){const h=s.stats,m=d-s.lts;r.framesDecodeFreezeTime=h.framesDecodeFreezeTime,r.framesDecodeInterval=h.framesDecodeInterval,!this.isFirstVideoDecoded[r.ssrc]&&m>this.options.firstVideoDecodedTimeout&&!this.isFirstVideoDecodedTimeout[r.ssrc]&&(this.onFirstVideoDecodedTimeout&&this.onFirstVideoDecodedTimeout(r.ssrc),this.isFirstVideoDecodedTimeout[r.ssrc]=!0),r.framesDecodeCount>h.framesDecodeCount&&this.isFirstVideoDecoded[r.ssrc]?(s.lts=Date.now(),r.framesDecodeInterval=m,r.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(t.ssrc))?r.framesDecodeFreezeTime+=r.framesDecodeInterval:this.setVideoIsReady2(parseInt(t.ssrc,10),!0))):r.framesDecodeCount<h.framesDecodeCount&&(r.framesDecodeInterval=0),t.framesDecoded&&t.qpSum&&(s.stats.framesDecodeCount>t.framesDecoded?r.qpSumPerFrame=t.qpSum/t.framesDecoded:r.qpSumPerFrame=(t.qpSum-s.qpSum)/(t.framesDecoded-s.stats.framesDecodeCount))}t.totalDecodeTime&&(r.decodeMs=1e3*t.totalDecodeTime,r.avgDecodeMs=jw(s==null?void 0:s.stats,r,"decodeMs","framesDecodeCount")),r.avgProcessingDelayMs=jw(s==null?void 0:s.stats,r,"totalProcessingDelay","framesDecodeCount",Jv.kMillisecondsFromSeconds),r.avgFramesAssembledFromMultiplePacketsMs=jw(s==null?void 0:s.stats,r,"totalAssemblyTime","framesAssembledFromMultiplePackets",Jv.kMillisecondsFromSeconds),r.avgInterFrameDelayMs=jw(s==null?void 0:s.stats,r,"totalInterFrameDelay","framesDecodeCount",Jv.kMillisecondsFromSeconds),a&&d-a.lts>=800?(r.decodeFrameRate=Math.round((r.framesDecodeCount-a.count)/((d-a.lts)/1e3)),this.lastVideoFramesDecode.set(r.ssrc,{count:r.framesDecodeCount,lts:d,rate:r.decodeFrameRate})):a?r.decodeFrameRate=a.rate:this.lastVideoFramesDecode.set(r.ssrc,{count:r.framesDecodeCount,lts:d,rate:0}),r.framesDroppedCount&&t.framesReceived&&(c&&d-c.lts>=800?(r.outputFrameRate=Math.round((t.framesReceived-r.framesDroppedCount-c.count)/((d-c.lts)/1e3)),this.lastVideoFramesOutput.set(r.ssrc,{count:t.framesReceived-r.framesDroppedCount,lts:d,rate:Math.max(r.outputFrameRate,0)})):c?r.outputFrameRate=c.rate:this.lastVideoFramesOutput.set(r.ssrc,{count:t.framesReceived-r.framesDroppedCount,lts:d,rate:0})),this.processVideoTrackReceiverStats(t,t.trackId,r),t.codecId&&(r.codec=this.getCodecFromCodecStats(t.codecId)),t.framerateMean&&(r.framesRateFirefox=t.framerateMean),r.packets>0&&!this.isFirstVideoReceived[r.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(r.ssrc),this.isFirstVideoReceived[r.ssrc]=!0),this.lastDecodeVideoReceiverStats.set(r.ssrc,{stats:St({},r),lts:s?s.lts:Date.now(),qpSum:t.qpSum})}processVideoOutboundStats(t){let r=this._stats.videoSend.find(a=>a.ssrc===t.ssrc);r||(r=Ou(n8),this._stats.videoSend.push(r));const s=this.mediaBytesSent.get(t.ssrc);if(s)s.add(t.bytesSent);else{const a=new kL(10);a.add(t.bytesSent),this.mediaBytesSent.set(t.ssrc,a)}if(t.retransmittedBytesSent!==void 0){const a=this.mediaBytesRetransmit.get(t.ssrc);if(a)a.add(t.retransmittedBytesSent);else{const c=new kL(10);c.add(t.retransmittedBytesSent),this.mediaBytesRetransmit.set(t.ssrc,c)}}if(t.totalEncodedBytesTarget){const a=this.mediaBytesTargetEncode.get(t.ssrc);if(a)a.add(t.totalEncodedBytesTarget);else{const c=new kL(10);c.add(t.totalEncodedBytesTarget),this.mediaBytesTargetEncode.set(t.ssrc,c)}}if(r.ssrc=t.ssrc,r.bytes=t.bytesSent,r.packets=t.packetsSent,r.firsCount=t.firCount,r.nacksCount=t.nackCount,r.plisCount=t.pliCount,r.frameCount=t.framesEncoded,r.adaptionChangeReason=t.qualityLimitationReason,r.scalabilityMode=t.scalabilityMode,r.retransmittedBytesSent=t.retransmittedBytesSent,r.retransmittedPacketsSent=t.retransmittedPacketsSent,r.hugeFramesSent=t.hugeFramesSent,r.keyFramesEncoded=t.keyFramesEncoded,t.totalEncodeTime&&t.framesEncoded){const a=this.lastEncoderMs.get(t.ssrc);if(!a||a.lastFrameCount>t.framesEncoded)r.avgEncodeMs=1e3*t.totalEncodeTime/t.framesEncoded;else{const c=t.framesEncoded-a.lastFrameCount,d=t.totalEncodeTime-a.lastEncoderTime;r.avgEncodeMs=1e3*d/c}}if(t.framesEncoded&&t.qpSum){const a=this.lastEncoderMs.get(t.ssrc);!a||a.lastFrameCount>t.framesEncoded?r.qpSumPerFrame=t.qpSum/t.framesEncoded:r.qpSumPerFrame=(t.qpSum-a.lastQpSum)/(t.framesEncoded-a.lastFrameCount)}if(this.lastEncoderMs.set(t.ssrc,{lastFrameCount:t.framesEncoded,lastEncoderTime:t.totalEncodeTime,lastQpSum:t.qpSum,lts:Date.now()}),t.codecId&&(r.codec=this.getCodecFromCodecStats(t.codecId)),t.mediaSourceId&&this.processVideoMediaSource(t.mediaSourceId,r),this.processVideoTrackSenderStats(t,t.trackId,r),t.remoteId)this.processRemoteInboundStats(t.remoteId,r);else{const a=this.findRemoteStatsId(t.ssrc,el.REMOTE_INBOUND);a&&this.processRemoteInboundStats(a,r)}}processAudioOutboundStats(t){let r=this._stats.audioSend.find(s=>s.ssrc===t.ssrc);if(r||(r=Ou(r8),this._stats.audioSend.push(r)),r.ssrc=t.ssrc,r.packets=t.packetsSent,r.bytes=t.bytesSent,r.retransmittedBytesSent=t.retransmittedBytesSent,r.retransmittedPacketsSent=t.retransmittedPacketsSent,t.mediaSourceId&&this.processAudioMediaSource(t.mediaSourceId,r),t.codecId&&(r.codec=this.getCodecFromCodecStats(t.codecId)),this.processAudioTrackSenderStats(t,t.trackId,r),t.remoteId)this.processRemoteInboundStats(t.remoteId,r);else{const s=this.findRemoteStatsId(t.ssrc,el.REMOTE_INBOUND);s&&this.processRemoteInboundStats(s,r)}}findRemoteStatsId(t,r){var s;const a=Array.from(Jc(s=this.report).call(s)).find(c=>c.type===r&&c.ssrc===t);return a?a.id:null}processVideoMediaSource(t,r){const s=this.report.get(t);s&&s.width&&s.height&&s.framesPerSecond&&(r.inputFrame={width:s.width,height:s.height,frameRate:s.framesPerSecond})}processAudioMediaSource(t,r){const s=this.report.get(t);s&&(r.inputLevel=s.audioLevel)}processVideoTrackSenderStats(t,r,s){var a,c,d,h;const m=r?this.report.get(r):void 0,y=(a=m==null?void 0:m.framesSent)!==null&&a!==void 0?a:t.framesSent;if(typeof y!="number")return;let v=(c=m==null?void 0:m.frameWidth)!==null&&c!==void 0?c:t.frameWidth,w=(d=m==null?void 0:m.frameHeight)!==null&&d!==void 0?d:t.frameHeight,R=(h=m==null?void 0:m.framesPerSecond)!==null&&h!==void 0?h:t.framesPerSecond;if(typeof v=="number"&&typeof w=="number"||(v=0,w=0),R==null){const O=Date.now(),D=this.lastVideoFramesSent.get(s.ssrc);D&&O-D.lts>=800?(R=Math.round((y-D.count)/((O-D.lts)/1e3)),this.lastVideoFramesSent.set(s.ssrc,{count:y,lts:O,rate:R})):D?R=D.rate:this.lastVideoFramesSent.set(s.ssrc,{count:y,lts:O,rate:0})}s.sentFrame={width:v,height:w,frameRate:Math.max(0,R)}}processVideoTrackReceiverStats(t,r,s){var a,c,d,h,m;const y=r?this.report.get(r):void 0,v=(a=y==null?void 0:y.framesReceived)!==null&&a!==void 0?a:t.framesReceived,w=(c=y==null?void 0:y.frameWidth)!==null&&c!==void 0?c:t.frameWidth,R=(d=y==null?void 0:y.frameHeight)!==null&&d!==void 0?d:t.frameHeight,O=(h=y==null?void 0:y.jitterBufferDelay)!==null&&h!==void 0?h:t.jitterBufferDelay,D=(m=y==null?void 0:y.jitterBufferEmittedCount)!==null&&m!==void 0?m:t.jitterBufferEmittedCount;if(typeof v=="number"){const G=this.lastVideoFramesRecv.get(s.ssrc),j=Date.now();s.framesReceivedCount=v;let W=0;G&&j-G.lts>=800?(W=Math.round((v-G.count)/((j-G.lts)/1e3)),this.lastVideoFramesRecv.set(s.ssrc,{count:v,lts:j,rate:W})):G?W=G.rate:this.lastVideoFramesRecv.set(s.ssrc,{count:v,lts:j,rate:0}),s.receivedFrame={width:w||0,height:R||0,frameRate:W||0},s.decodedFrame={width:w||0,height:R||0,frameRate:s.decodeFrameRate||0},s.outputFrame={width:w||0,height:R||0,frameRate:s.outputFrameRate||s.decodeFrameRate||0}}if(O&&D){const G=this.lastVideoJBDelay.get(s.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let j=G.jitterBufferMs;const W=D-G.jitterBufferEmittedCount;W>0&&(j=1e3*(O-G.jitterBufferDelay)/W),s.jitterBufferMs=j,s.currentDelayMs=Math.round(j),this.lastVideoJBDelay.set(s.ssrc,{jitterBufferDelay:O,jitterBufferEmittedCount:D,jitterBufferMs:s.currentDelayMs})}}processAudioTrackSenderStats(t,r,s){var a,c,d,h;const m=r?this.report.get(r):void 0,y=(a=(c=m==null?void 0:m.echoReturnLoss)!==null&&c!==void 0?c:t.echoReturnLoss)!==null&&a!==void 0?a:0,v=(d=(h=m==null?void 0:m.echoReturnLossEnhancement)!==null&&h!==void 0?h:t.echoReturnLossEnhancement)!==null&&d!==void 0?d:0;s.aecReturnLoss=y,s.aecReturnLossEnhancement=v}processAudioTrackReceiverStats(t,r,s){var a,c,d,h,m,y,v;const w=r?this.report.get(r):void 0,R=(a=w==null?void 0:w.removedSamplesForAcceleration)!==null&&a!==void 0?a:t.removedSamplesForAcceleration,O=(c=w==null?void 0:w.totalSamplesReceived)!==null&&c!==void 0?c:t.totalSamplesReceived,D=(d=w==null?void 0:w.jitterBufferDelay)!==null&&d!==void 0?d:t.jitterBufferDelay,G=(h=w==null?void 0:w.jitterBufferEmittedCount)!==null&&h!==void 0?h:t.jitterBufferEmittedCount,j=(m=w==null?void 0:w.audioLevel)!==null&&m!==void 0?m:t==null?void 0:t.audioLevel,W=(y=w==null?void 0:w.totalSamplesDuration)!==null&&y!==void 0?y:t==null?void 0:t.totalSamplesDuration,Q=(v=w==null?void 0:w.concealedSamples)!==null&&v!==void 0?v:t.concealedSamples;if(typeof O=="number"&&(s.totalSamplesReceived=O),R&&O&&(s.accelerateRate=R/O),D&&G){const fe=this.lastAudioJBDelay.get(s.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let ye=fe.jitterBufferMs;const Ee=G-fe.jitterBufferEmittedCount;Ee>0&&(ye=1e3*(D-fe.jitterBufferDelay)/Ee),s.jitterBufferMs=Math.round(ye),this.lastAudioJBDelay.set(s.ssrc,{jitterBufferDelay:D,jitterBufferEmittedCount:G,jitterBufferMs:s.jitterBufferMs})}s.outputLevel=j;let ee=1920;W&&O&&(ee=O/W/50,s.receivedFrames=Math.round(O/ee)),Q&&(s.droppedFrames=Math.round(Q/ee))}processRemoteInboundStats(t,r){const s=this.report.get(t);s&&(r.packetsLost=s.packetsLost,s.roundTripTime&&(r.rttMs=1e3*s.roundTripTime),s.jitter&&(r.jitterMs=1e3*s.jitter),s.timestamp&&(r.timestamp=s.timestamp))}getCodecFromCodecStats(t){const r=this.report.get(t);if(!r)return"";const s=r.mimeType.match(/\/(.*)$/);return s&&s[1]?s[1]:""}updateSendBitrate(){let t=0,r=null,s=null;this.mediaBytesSent.forEach(c=>{t+=c.diffMean()}),this.mediaBytesRetransmit.forEach(c=>{r=r===null?c.diffMean():r+c.diffMean()}),this.mediaBytesTargetEncode.forEach(c=>{s=s===null?c.diffMean():s+c.diffMean()});const a=r!==null?t-r:t;this._stats.bitrate={actualEncoded:8*a/(this.options.updateInterval/1e3),transmit:8*t/(this.options.updateInterval/1e3)},r!==null&&(this._stats.bitrate.retransmit=8*r/(this.options.updateInterval/1e3)),s!==null&&(this._stats.bitrate.targetEncoded=8*s/(this.options.updateInterval/1e3))}},hme=class extends NL{updateStats(){return pt.resolve()}};function xL(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:250,s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:8,a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:500,c=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1e4;const d=function(){const h=navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]*/i);return h&&h[0]?Number(h[0].split("/")[1]):null}();return d?d<76?new dme(t,{updateInterval:r,lossRateInterval:s,freezeRateLimit:a,firstVideoDecodedTimeout:c}):new s8(t,{updateInterval:r,lossRateInterval:s,freezeRateLimit:a,firstVideoDecodedTimeout:c}):function(h){if(!window.RTCStatsReport)return!1;const m=h.getStats();return!!(m instanceof pt||function(y){return!!y&&(typeof y=="object"||typeof y=="function")&&typeof y.then=="function"}(m))}(t)?new s8(t,{updateInterval:r,lossRateInterval:s,freezeRateLimit:a,firstVideoDecodedTimeout:c}):new hme(t,{updateInterval:r,lossRateInterval:s,freezeRateLimit:a,firstVideoDecodedTimeout:c})}const o8="websdk_ng_install_id";function LL(){try{if(oe("INSTALL_ID"))return oe("INSTALL_ID");let t=window.localStorage.getItem(o8);return t||(t=J_(),window.localStorage.setItem(o8,t)),sr("INSTALL_ID",t),t}catch{return}}const Ml=function(t){if(t.match(/[0-9]+\.[0-9]+\.[0-9]+$/))return t;const r=t.match(/([0-9]+\.[0-9]+\.[0-9]+)\-([0-9]+)/);if(r&&r[1]&&r[2]){const s=r[1],a=r[2];return"".concat(s,".").concat(a)}return"4.0.0.999"}("4.23.2"),ML=function(){try{return JSON.parse("true")===!0}catch{return!0}}();let Q_=function(t){return t.Default="default",t.Auto="auto",t.Relay="relay",t.SdRtn="sd-rtn",t}({});const Us=function(){const t="us".concat("erna","me"),r="pa".concat("sswo","rd"),s=["t","s","t"];s.splice(1,0,"e");const a=s.join(""),c=[];for(let m=0;m<6;m++)c.push("1");const d=c.join(""),h={};return h[t]=a,h[r]=d,Object.assign(h,{turnServerURL:"",tcpport:3433,udpport:3478,forceturn:!1})}();window.DEFAULT_TURN_CONFIG=Us;const uP={ENABLE_PUBLISHED_USER_LIST:!0,MAX_SUBSCRIPTION:50,SUBSCRIBE_AUDIO_FILTER_TOPN:void 0,ENABLE_PUBLISH_AUDIO_FILTER:void 0,ENABLE_USER_LICENSE_CHECK:!0,DISABLE_FEC:void 0,ENABLE_NTP_REPORT:!1,ENABLE_INSTANT_VIDEO:!1,ENABLE_USER_AUTO_REBALANCE_CHECK:!0,ENABLE_LOSSBASED_BWE:!0,ENABLE_AUT_CC:!1,ENABLE_CC_FALLBACK:void 0,SUBSCRIBE_TWCC:!0,PUBLISH_TWCC:!1,ENABLE_SVC_DEFAULT_CODECS:["H264","VP8","VP9","AV1"],SVC:[],ENABLE_FULL_LINK_AV_SYNC:!1,SVC_MODE:null,PRE_SUB_NUM:2,ENABLE_AUT_FEEDBACK:!1,SVC_EXTENDED:["VP9"]},UL={MIN_FRAME_RATE:1,MAX_FRAME_RATE:30,MAX_THRESHOLD_FRAMERATE:30,BITRATE_MIN_THRESHOLD:100,BITRATE_MAX_THRESHOLD:100,MAX_SCALE:5,BWE_SCALE_UP_THRESHOLD:.6,BWE_SCALE_DOWN_THRESHOLD:.6,PERF_SCALE_UP_THRESHOLD:.7,PERF_SCALE_DOWN_THRESHOLD:.6,MOTION_RESOLUTION_FACTOR:.8,MOTION_BITRATE_FACTOR:.6,DETAIL_FRAMERATE_FACTOR:.8,DETAIL_BITRATE_FACTOR:.6,BALANCE_RESOLUTION_FACTOR:.9,BALANCE_FRAMERATE_FACTOR:.9,BALANCE_BITRATE_FACTOR:.6,OVERUSE_TIMES_THRESHOLD:10,UNDERUSE_TIMES_THRESHOLD:40},VL="v4.23.2-0-g1599fdac-dirty(3/4/2025, 5:13:36 PM)",jL={ENABLE_EVENT_REPORT:!0,UPLOAD_LOG:!1,ENABLE_AG_ADAPTATION:!0,FORCE_AG_HIGH_FRAMERATE:!1,FORCE_SUPPORT_AG_ADAPTATION:!1,ENCODER_CONFIG_LIMIT:{},CAMERA_CAPTURE_CONFIG:void 0,ENABLE_PRELOAD:!0,NEW_ICE_RESTART:!1,ICE_RESTART_INTERVAL:1e4,RESTART_SEQUENCE:["udp_tcp_relay","relay"],FIRST_TCP_CANDIDATE:!1,FIRST_TCP_CANDIDATE_INTERVAL:1e3,TURN_DOMAIN:"edge.agora.io",USE_TURN_IP:!1,NEW_TURN_MODE:void 0,NEW_FORCE_TURN:!1},Rr=St(St(St({},jL),{},{PROCESS_ID:"",ENCRYPT_AES:!0,AREAS:["CHINA","GLOBAL"],WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io","webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io","webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-web-2.ap.sd-rtn.com","cds-ap-web-3.agora.io","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-web-2.ap.sd-rtn.com","sua-ap-web-3.agora.io","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-ap-web-1.agora.io","uap-web-2.ap.sd-rtn.com","uap-ap-web-3.agora.io","uap-web-4.ap.sd-rtn.com"],LOG_UPLOAD_SERVER:"logservice.agora.io",EVENT_REPORT_DOMAIN:"statscollector-1.agora.io",EVENT_REPORT_BACKUP_DOMAIN:"web-2.statscollector.sd-rtn.com",GATEWAY_ADDRESS:[],GATEWAY_WSS_ADDRESS:"",LIVE_STREAMING_ADDRESS:"",HTTP_CONNECT_TIMEOUT:5e3,SIGNAL_REQUEST_TIMEOUT:1e4,REPORT_STATS:!0,NOT_REPORT_EVENT:[],PING_PONG_TIME_OUT:10,WEBSOCKET_TIMEOUT_MIN:1e4,EVENT_REPORT_SEND_INTERVAL:3e3,CONFIG_DISTRIBUTE_INTERVAL:3e5,ENABLE_CONFIG_DISTRIBUTE:!0,CANDIDATE_TIMEOUT:5e3,SHOW_REPORT_INVOKER_LOG:!1,SHOW_REPORT_USER_INVOKER_LOG:!0,JOIN_EXTEND:"",PUB_EXTEND:"",SUB_EXTEND:"",FORCE_TURN:!1,TURN_ENABLE_TCP:!0,TURN_ENABLE_UDP:!0,MAX_UPLOAD_CACHE:50,UPLOAD_CACHE_INTERVAL:2e3,AJAX_REQUEST_CONCURRENT:3,REPORT_APP_SCENARIO:void 0,GATEWAY_DOMAINS:["edge.agora.io","edge.sd-rtn.com"],CONNECT_GATEWAY_WITHOUT_DOMAIN:!1,WORKER_DOMAIN:"edge.agora.io",EVENT_REPORT_RETRY:!0,CHROME_FORCE_PLAN_B:!1,AUDIO_SOURCE_VOLUME_UPDATE_INTERVAL:400,AUDIO_SOURCE_AVG_VOLUME_DURATION:3e3,AUDIO_VOLUME_INDICATION_INTERVAL:2e3,VOLUME_VOICE_WEIGHT:10,GET_VOLUME_OF_MUTED_AUDIO_TRACK:!1,STATS_UPDATE_INTERVAL:250,NORMAL_EVENT_QUEUE_CAPACITY:100,CUSTOM_REPORT:!0,CUSTOM_REPORT_LIMIT:20,PROXY_SERVER_TYPE2:"webnginx-proxy.agora.io",PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com","webrtc-cloud-proxy.agora.io"],CUSTOM_PUB_ANSWER_MODIFIER:null,CUSTOM_SUB_ANSWER_MODIFIER:null,CUSTOM_PUB_OFFER_MODIFIER:null,CUSTOM_SUB_OFFER_MODIFIER:null,DSCP_TYPE:"high",REMOVE_NEW_CODECS:!0,FRAGEMENT_LENGTH:3,WEBSOCKET_COMPRESS:!1,SIMULCAST:!1,PRELOAD_MEDIA_COUNT:0,CHECK_VIDEO_VISIBLE_INTERVAL:3e4,CHECK_LOCAL_STATS_INTERVAL:250,PROFILE_SWITCH_INTERVAL:2e3,UNSUPPORTED_VIDEO_CODEC:[],ENUMERATE_DEVICES_INTERVAL:!1,ENUMERATE_DEVICES_INTERVAL_TIME:1e4,USE_NEW_TOKEN:!1,CLOSE_AFB_FOR_LOCAL_AP:!0,JOIN_MAX_CONCURRENCY:6,JOIN_WITH_FALLBACK_SIGNAL_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE:!1,JOIN_GATEWAY_TRY_443PORT_DURATION:2e3,JOIN_GATEWAY_USE_443PORT_ONLY:!1,JOIN_GATEWAY_USE_DUAL_DOMAIN:!0,JOIN_GATEWAY_FALLBACK_PORT:443,USE_TURN_SERVER_OF_GATEWAY:!1,H264_PROFILE_LEVEL_ID:"",USE_NEW_LOG:!1,LOG_VERSION:3,MEDIA_DEVICE_CONSTRAINTS:null,ENCRYPT_PROXY_USERNAME_AND_PSW:!0,SDP_LOGGING:!1,CSP_DETECTED_HOSTNAME_LIST:["agora.io","sd-rtn.com"],REMOTE_AUDIO_TRACK_USES_WEB_AUDIO:!1,LOCAL_AUDIO_TRACK_USES_WEB_AUDIO:!1,BITRATE_ADAPTER_TYPE:"STANDARD_BITRATE",AI_DENOISER_PARAMETERS:{excludedLinks:[]},ADJUST_3A_FROM_PLUGINS:!0,RAISE_H264_BASELINE_PRIORITY:!0,FILTER_SEND_H264_BASELINE:!1,FIRST_H264_PROFILE_LEVEL_ID:"42001f",FIRST_PACKETIZATION_MODE:"",X_GOOGLE_START_BITRATE:void 0,NEW_REPORT_SERVER:!1,NEW_REPORT_SERVER_DOMAINS:["data-reporting.agora.io","data-reporting.agora.io"],VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT:3e5,VIDEO_INSPECT_INTERVAL_MINIMUM:1e3,VIDEO_INSPECT_QUALITY_RATIO:.9,VIDEO_INSPECT_WORKER_MANAGER_HOST:"edge.agora.io",VIDEO_INSPECT_WORKER_MANAGER_PORT:"",VIDEO_INSPECT_WORKER_PORT:"",SHOW_VIDEO_INSPECT_WORKER_MESSAGE:!1,STATS_COLLECTOR_PORT:443,FORCE_TURN_TCP:!1,WEBAUDIO_INIT_OPTIONS:void 0,FILTER_VIDEO_FEC:!0,FILTER_AUDIO_FEC:!1,CHROME_DUAL_STREAM_USE_ENCODING:!0,DISABLE_DUAL_STREAM_USE_ENCODING:!1,EXTENSION_USAGE_UPLOAD_INTERVAL:1e4,ICE_RESTART:!0,FINGERPRINT:null,ENABLE_VIDEO_FRAME_CALLBACK:!0,VIDEO_FREEZE_DURATION:500,SPATIALIZER_PARAMETERS:{},UPLOAD_LOG_INTERVAL:3e3,UPLOAD_LOG_REQUEST_RETRY_INTERVAL:2e3,UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL:2e4,UPLOAD_LOG_TRY_INTERVAL_WHILE_OFF:5e3,UPLOAD_LOG_RETRY_INTERVAL_V1:1e4,UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1:200,UPLOAD_LOG_LENGTH_EACH_TIME:10,APP_TYPE:0,DISABLE_WEBAUDIO:!1,CHANNEL_MEDIA_RELAY_SERVERS:void 0,KEEP_LAST_FRAME:!0,FORWARD_P2P_CREATION:!0,SYNC_GROUP:!0,BLOCK_LOCAL_CLIENT:!1,ENABLE_AUDIO_TOPN:!1,ENABLE_AUDIO_METADATA:!1,ENABLE_AUDIO_PTS_METADATA:!1,TOPN_SMOOTH_LEVEL:void 0,TOPN_NEW_SPEAKER_DELAY:void 0,TOPN_SWITCH_HOLD_MS:void 0,TOPN_AUDIO_GAIN:void 0,TOPN_SILENCE_THRESHOLD:250,AP_AREA:!0,ENABLE_ENCODED_TRANSFORM:!1,ENABLE_VIDEO_SEI:!1,IMAGE_MODERATION_WORKER_HOST:"edge.agora.io",IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT:3e5,IMAGE_MODERATION_INTERVAL_MINIMUM:1e3,SHOW_IMAGE_MODERATION_WORKER_MESSAGE:!1,IMAGE_MODERATION_QUALITY_RATIO:.9,IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL:5e3,SHOW_GLOBAL_CLIENT_LIST:!1,DATASTREAM_MAX_RETRANSMITS:10,TCP_CANDIDATE_ONLY:!1,EXTERNAL_SIGNAL_REQUEST_TIMEOUT:3e3,SHOW_P2P_LOG:!1,MAX_P2P_TIMEOUT:3e4,P2P_TOKEN_INTERVAL:1e3,SHOW_DATASTREAM2_LOG:!1,RESTRICTION_SET_PLAYBACK_DEVICE:!0,USE_PURE_ENCRYPTION_MASTER_KEY:!1,ACCOUNT_REGISTER_RETRY_TIMEOUT:1,ACCOUNT_REGISTER_RETRY_RATIO:2,ACCOUNT_REGISTER_RETRY_TIMEOUT_MAX:6e4,ACCOUNT_REGISTER_RETRY_COUNT_MAX:1e5,AUDIO_CONTEXT:null,WEBCS_BACKUP_CONNECT_TIMEOUT:6e3,PLAYER_STATE_DEFER:2e3,SIGNAL_REQUEST_WATCH_INTERVAL:1e3,FILEPATH_LENMAX:255,DUALSTREAM_OPERATION_CHECK:!0,MEDIA_ELEMENT_EXISTS_DEPTH:3,SHIM_CANDIDATE:!1,LEAVE_MSG_TIMEOUT:2e3,STATS_FILTER:{transportId:!0,googTrackId:!0},FILTER_VIDEO_CODEC:[],USE_NEW_NETWORK_CONFIG:!1,AUTO_RESET_AUDIO_ROUTE:!1,PLUGIN_INFO:[],OVERUSE_DETECTOR_PARAMS:UL,CUSTOM_ADAPTATION_DEFAULT_MODE:"",HIDE_NO_POSTER:!1,AP_CACHE_NUM:10,AP_UPDATE_INTERVAL:12e4,AP_CACHE_LIFETIME:12e4,MAX_PRELOAD_ASYNC_LENGTH:3,DISABLE_SCREEN_SHARE_REMB:!1},uP),{},{USE_CANDIDATE_FROM_AP_DETAIL:!1,AP_REQUEST_DETAIL:void 0,ENABLE_ROLE_SELECT_EDGE:!1,CLIENT_ROLE_OPTIONS:void 0,COMPATIBLE_SDP_EXTENSION:["gdpr_forbidden"],LIMIT_BITRATE:void 0,EXPERIMENTS:{},USE_PUB_RTX:!0,USE_SUB_RTX:!0,ENABLE_DATASTREAM_2:!1,USE_XR:!0,ENABLE_PREALLOC_PC:!1,ENABLE_PRE_SUB:!1,ENABLE_SVC:!1},{INSTALL_ID:""});function sr(t,r,s){var a,c,d;lt(a=Object.keys(Rr)).call(a,t)&&(!s&&lt(c=Object.keys(Nd)).call(c,t)||(Rr[t]=r,t!=="ENABLE_VIDEO_SEI"&&t!=="ENABLE_AUDIO_TOPN"&&t!=="ENABLE_AUDIO_METADATA"&&t!=="ENABLE_AUDIO_PTS_METADATA"||r!==!0||(Rr.ENABLE_ENCODED_TRANSFORM=!0,t==="ENABLE_AUDIO_PTS_METADATA"&&(Rr.ENABLE_AUDIO_METADATA=!0)),t==="USE_NEW_NETWORK_CONFIG"&&r&&(d=!!r,Rr.USE_NEW_NETWORK_CONFIG=d,d&&(Rr.WEBCS_DOMAIN=["webrtc2-2.ap.sd-rtn.com"],Rr.WEBCS_DOMAIN_BACKUP_LIST=["webrtc2-4.ap.sd-rtn.com"],Rr.CDS_AP=["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],Rr.ACCOUNT_REGISTER=["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],Rr.EVENT_REPORT_DOMAIN="web-2.statscollector.sd-rtn.com",Rr.EVENT_REPORT_BACKUP_DOMAIN="statscollector-1.agora.io",Rr.GATEWAY_DOMAINS=["edge.sd-rtn.com"])),t==="ENABLE_PRE_SUB"&&r&&(Rr.ENABLE_INSTANT_VIDEO=!0,Rr.ENABLE_PREALLOC_PC=!0),t==="ENABLE_SVC"&&r&&(Rr.ENABLE_AUT_CC=!0),t==="NEW_FORCE_TURN"&&r&&(Rr.NEW_TURN_MODE||(Rr.NEW_TURN_MODE=4))))}function oe(t){return Rr[t]}ML||(Rr.WEBCS_DOMAIN=["ap-web-1-oversea.agora.io","ap-web-1-north-america.agora.io"],Rr.WEBCS_DOMAIN_BACKUP_LIST=["ap-web-2-oversea.agora.io","ap-web-2-north-america.agora.io"],Rr.PROXY_CS=["proxy-ap-web-oversea.agora.io","proxy-ap-web-america.agora.io"],Rr.CDS_AP=["cds-ap-web-oversea.agora.io","cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],Rr.ACCOUNT_REGISTER=["sua-ap-web-oversea.agora.io","sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],Rr.UAP_AP=["uap-ap-web-oversea.agora.io","uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],Rr.LOG_UPLOAD_SERVER="logservice-oversea.agora.io",Rr.EVENT_REPORT_DOMAIN="statscollector-1-oversea.agora.io",Rr.EVENT_REPORT_BACKUP_DOMAIN="statscollector-2-oversea.agora.io",Rr.PROXY_SERVER_TYPE3="webrtc-cloud-proxy.agora.io",Rr.AREAS=["NORTH_AMERICA","OVERSEA"]);let a8=function(t){return t[t.REALTIME=1]="REALTIME",t}({});const Nd={};var Tn=function(t){return t.SET_SESSION_ID="SET_SESSION_ID",t.SET_P2P_ID="SET_P2P_id",t.SET_DC_ID="SET_DC_id",t.SET_UID="SET_UID",t.SET_INT_UID="SET_INT_UID",t.SET_PUB_ID="SET_PUB_ID",t.SET_CLOUD_PROXY_SERVER_MODE="SET_CLOUD_PROXY_SERVER_MODE",t.KEY_METRIC_CLIENT_CREATED="KEY_METRIC_CLIENT_CREATED",t.KEY_METRIC_JOIN_START="KEY_METRIC_JOIN_START",t.AVOID_JOIN_START="AVOID_JOIN_START",t.KEY_METRIC_JOIN_END="KEY_METRIC_JOIN_END",t.KEY_METRIC_REQUEST_AP_START="KEY_METRIC_REQUEST_AP_START",t.KEY_METRIC_REQUEST_AP_END="KEY_METRIC_REQUEST_AP_END",t.KEY_METRIC_JOIN_GATEWAY_START="KEY_METRIC_JOIN_GATEWAY_START",t.KEY_METRIC_JOIN_GATEWAY_END="KEY_METRIC_JOIN_GATEWAY_END",t.KEY_METRIC_PEER_CONNECTION_START="KEY_METRIC_PEER_CONNECTION_START",t.KEY_METRIC_PEER_CONNECTION_END="KEY_METRIC_PEER_CONNECTION_END",t.KEY_METRIC_DESCRIPTION_START="KEY_METRIC_DESCRIPTION_START",t.KEY_METRIC_ICE_CONNECTION_END="KEY_METRIC_ICE_CONNECTION_END",t.KEY_METRIC_SIGNAL_CHANNEL_OPEN="KEY_METRIC_SIGNAL_CHANNEL_OPEN",t.KEY_METRIC_PUBLISH="KEY_METRIC_PUBLISH",t.KEY_METRIC_SUBSCRIBE="KEY_METRIC_SUBSCRIBE",t.RECORD_JOIN_CHANNEL_SERVICE="RECORD_JOIN_CHANNEL_SERVICE",t.RESET_JOIN_CHANNEL_SERVICE_RECORDS="RESET_JOIN_CHANNEL_SERVICE_RECORDS",t.RESET_KEY_METRICS="RESET_KEY_METRICS",t.SET_USE_P2P="SET_USE_P2P",t.SET_TRANSPORT_TYPE="SET_TRANSPORT_TYPE",t}(Tn||{});let dP=function(t){return t.h264="h264",t.h265="h265",t.vp8="vp8",t.vp9="vp9",t.av1="av1",t}({});(function(t){t.opus="opus",t.pcma="pcma",t.pcmu="pcmu",t.g722="g722"})({});const c8=128,pme=96,l8=1e3,Qv=10;let fme=0;var u8=(()=>{var t={8:(a,c,d)=>{d.r(c),d.d(c,{Parser:()=>ft,Printer:()=>pi,parse:()=>at,print:()=>Pt});const h=`
`,m="".concat("\r").concat(h),y=" ";let v;function w(Ye){return Ye>="0"&&Ye<="9"}function R(Ye){return Ye>="!"&&Ye<="~"}function O(Ye){return R(Ye)||Ye>=""&&Ye<=""}function D(Ye){return Ye==="!"||Ye>="#"&&Ye<="'"||Ye>="*"&&Ye<="+"||Ye>="-"&&Ye<="."||Ye>="0"&&Ye<="9"||Ye>="A"&&Ye<="Z"||Ye>="^"&&Ye<="~"}function G(Ye){return Ye>="1"&&Ye<="9"}function j(Ye){return Ye>="A"&&Ye<="Z"||Ye>="a"&&Ye<="z"}function W(Ye){return Ye==="d"||Ye==="h"||Ye==="m"||Ye==="s"}function Q(Ye){return Ye>""&&Ye<"	"||Ye>"\v"&&Ye<"\f"||Ye>""&&Ye<""}function ee(Ye){return j(Ye)||w(Ye)||Ye==="+"||Ye==="/"}function fe(Ye){return w(Ye)||j(Ye)||Ye==="+"||Ye==="/"||Ye==="-"||Ye==="_"}function ye(Ye){return j(Ye)||w(Ye)||Ye==="+"||Ye==="/"}function Ee(Ye,U){var ce=Object.keys(Ye);if(Object.getOwnPropertySymbols){var me=Object.getOwnPropertySymbols(Ye);U&&(me=me.filter(function(nt){return Object.getOwnPropertyDescriptor(Ye,nt).enumerable})),ce.push.apply(ce,me)}return ce}function _e(Ye){for(var U=1;U<arguments.length;U++){var ce=arguments[U]!=null?arguments[U]:{};U%2?Ee(Object(ce),!0).forEach(function(me){Ne(Ye,me,ce[me])}):Object.getOwnPropertyDescriptors?Object.defineProperties(Ye,Object.getOwnPropertyDescriptors(ce)):Ee(Object(ce)).forEach(function(me){Object.defineProperty(Ye,me,Object.getOwnPropertyDescriptor(ce,me))})}return Ye}function Ne(Ye,U,ce){return U in Ye?Object.defineProperty(Ye,U,{value:ce,enumerable:!0,configurable:!0,writable:!0}):Ye[U]=ce,Ye}(function(Ye){Ye.VERSION="v",Ye.ORIGIN="o",Ye.SESSION_NAME="s",Ye.INFORMATION="i",Ye.URI="u",Ye.EMAIL="e",Ye.PHONE="p",Ye.CONNECTION="c",Ye.BANDWIDTH="b",Ye.TIME="t",Ye.REPEAT="r",Ye.ZONE_ADJUSTMENTS="z",Ye.KEY="k",Ye.ATTRIBUTE="a",Ye.MEDIA="m"})(v||(v={}));class Ze{consumeText(U,ce){let me=ce;for(;me<U.length;){const nt=U[me];if(nt==="\0"||nt==="\r"||nt===h)break;me+=1}if(me-ce==0)throw new Error("Invalid text, at ".concat(U));return me}consumeUnicastAddress(U,ce,me){return this.consumeTill(U,ce,y)}consumeOneOrMore(U,ce,me){let nt=ce;for(;me(U[nt]);)nt++;if(nt-ce==0)throw new Error("Invalid rule at ".concat(ce,"."));return nt}consumeSpace(U,ce){if(U[ce]===y)return ce+1;throw new Error("Invalid space at ".concat(ce,"."))}consumeIP4Address(U,ce){let me=ce;for(let nt=0;nt<4;nt++)if(me=this.consumeDecimalUChar(U,me),nt!==3){if(U[me]!==".")throw new Error("Invalid IP4 address.");me++}return me}consumeDecimalUChar(U,ce){let me=ce;for(let tn=0;tn<3&&w(U[me]);tn++,me++);if(me-ce==0)throw new Error("Invalid decimal uchar.");const nt=parseInt(U.slice(ce,me));if(nt>=0&&nt<=255)return me;throw new Error("Invalid decimal uchar")}consumeIP6Address(U,ce){let me=this.consumeHexpart(U,ce);return U[me]===":"&&(me+=1,me=this.consumeIP4Address(U,me)),me}consumeHexpart(U,ce){let me=ce;if(U[me]===":"&&U[me+1]===":"){me+=2;try{me=this.consumeHexseq(U,me)}catch{}return me}if(me=this.consumeHexseq(U,me),U[me]===":"&&U[me+1]===":"){me+=2;try{me=this.consumeHexseq(U,me)}catch{}return me}return me}consumeHexseq(U,ce){let me=ce;for(;me=this.consumeHex4(U,me),U[me]===":"&&U[me+1]!==":";)me+=1;return me}consumeHex4(U,ce){let me=0;for(;me<4;me++)if(!((nt=U[ce+me])>="0"&&nt<="9"||nt>="a"&&nt<="f"||nt>="A"&&nt<="F")){if(me===0)throw new Error("Invalid hex 4");break}var nt;return ce+me}consumeFQDN(U,ce){let me=ce;for(;w(U[me])||j(U[me])||U[me]==="-"||U[me]===".";)me+=1;if(me-ce<4)throw new Error("Invalid FQDN");return me}consumeExtnAddr(U,ce){return this.consumeOneOrMore(U,ce,O)}consumeMulticastAddress(U,ce,me){switch(me){case"IP4":case"ip4":return this.consumeIP4MulticastAddress(U,ce);case"IP6":case"ip6":return this.consumeIP6MulticastAddress(U,ce);default:try{return this.consumeFQDN(U,ce)}catch{return this.consumeExtnAddr(U,ce)}}}consumeIP6MulticastAddress(U,ce){const me=this.consumeHexpart(U,ce);return U[me]==="/"?this.consumeInteger(U,me+1):me}consumeIP4MulticastAddress(U,ce){let me=ce+3;const nt=U.slice(ce,me),tn=parseInt(nt);if(tn<224||tn>239)throw new Error("Invalid IP4 multicast address, IPv4 multicast addresses may be in the range 224.0.0.0 to 239.255.255.255.");for(let lr=0;lr<3;lr++){if(U[me]!==".")throw new Error("Invalid IP4 multicast address.");me+=1,me=this.consumeDecimalUChar(U,me)}return U[me]==="/"&&(me+=1),me=this.consumeTTL(U,me),U[me]==="/"&&(me=this.consumeInteger(U,me)),me}consumeInteger(U,ce){if(!G(U[ce]))throw new Error("Invalid integer.");for(ce+=1;w(U[ce]);)ce+=1;return ce}consumeTTL(U,ce){if(U[ce]==="0")return ce+1;if(!G(U[ce]))throw new Error("Invalid TTL.");ce+=1;for(let me=0;me<2&&w(U[ce]);me++)ce+=1;return ce}consumeToken(U,ce){return this.consumeOneOrMore(U,ce,D)}consumeTime(U,ce){let me=ce;if(U[me]==="0")return me+1;for(G(U[me])&&(me+=1);w(U[me]);)me++;if(me-ce<10)throw new Error("Invalid time");return me}consumeAddress(U,ce){return this.consumeTill(U,ce,y)}consumeTypedTime(U,ce){let me=ce;return me=this.consumeOneOrMore(U,me,w),W(U[me])?me+1:me}consumeRepeatInterval(U,ce){if(!G(U[ce]))throw new Error("Invalid repeat interval");for(ce+=1;w(U[ce]);)ce+=1;return W(U[ce])&&(ce+=1),ce}consumePort(U,ce){return this.consumeOneOrMore(U,ce,w)}consume(U,ce,me){for(let nt=0;nt<me.length;nt++){if(ce+nt>=U.length)throw new Error("consume exceeding value length");if(U[ce+nt]!==me[nt])throw new Error("consume ".concat(me," failed at ").concat(nt))}return ce+me.length}consumeTill(U,ce,me){let nt=ce;for(;nt<U.length&&(typeof me!="string"||U[nt]!==me)&&(typeof me!="function"||!me(U[nt]));)nt++;return nt}}class ft extends Ze{constructor(){super(),Ne(this,"records",[]),Ne(this,"currentLine",0)}parse(U){const ce=this.probeEOL(U);this.records=U.split(ce).filter(by=>!!Ro(by).call(by)).map(this.parseLine),this.currentLine=0;const me=this.parseVersion(),nt=this.parseOrigin(),tn=this.parseSessionName(),lr=this.parseInformation(),ts=this.parseUri(),ec=this.parseEmail(),If=this.parsePhone(),Sy=this.parseConnection(),bT=this.parseBandWidth(),bO=this.parseTimeFields(),wO=this.parseKey(),Gl=this.parseSessionAttribute(),mg=this.parseMediaDescription();if(this.currentLine!==this.records.length)throw new Error("parsing failed, non exhaustive sdp lines.");return{version:me,origin:nt,sessionName:tn,information:lr,uri:ts,emails:ec,phones:If,connection:Sy,bandwidths:bT,timeFields:bO,key:wO,attributes:Gl,mediaDescriptions:mg}}getCurrentRecord(){const U=this.records[this.currentLine];if(!U)throw new Error("Record doesn't exit.");return U}probeEOL(U){for(let ce=0;ce<U.length;ce++)if(U[ce]===h)return U[ce-1]==="\r"?m:h;throw new Error("Invalid newline character.")}parseLine(U,ce){if(U.length<2)throw new Error("Invalid sdp line, sdp line should be of form <type>=<value>.");const me=U[0];if(U[1]!=="=")throw new Error('Invalid sdp line, <type> should be a single character followed by an "=" sign.');return{type:me,value:U.slice(2),line:ce,cur:0}}parseSessionAttribute(){const U=new An;for(;this.currentLine<this.records.length;){const ce=this.getCurrentRecord();if(ce.type!==v.ATTRIBUTE)break;const me={attField:this.extractOneOrMore(ce,nt=>D(nt)&&nt!==":"),_cur:0};ce.value[ce.cur]===":"&&(ce.cur+=1,me.attValue=this.extractOneOrMore(ce,Q)),U.parse(me),this.currentLine++}return U.digest()}parseMediaAttributes(U){const ce=new Pn(U);for(;this.currentLine<this.records.length;){const me=this.getCurrentRecord();if(me.type!==v.ATTRIBUTE)break;const nt={attField:this.extractOneOrMore(me,tn=>D(tn)&&tn!==":"),_cur:0};me.value[me.cur]===":"&&(me.cur+=1,nt.attValue=this.extractOneOrMore(me,Q)),ce.parse(nt),this.currentLine++}return ce.digest()}parseKey(){const U=this.getCurrentRecord();if(U.type===v.KEY){if(U.value==="prompt"||U.value==="clear:"||U.value==="base64:"||U.value==="uri:")return U.value;throw this.currentLine++,new Error("Invalid key.")}}parseZone(){const U=this.getCurrentRecord();if(U.type===v.ZONE_ADJUSTMENTS){const ce=[];for(;;)try{const me=this.extract(U,this.consumeTime);this.consumeSpaceForRecord(U);let nt=!1;U.value[U.cur]==="-"&&(nt=!0,U.cur+=1);const tn=this.extract(U,this.consumeTypedTime);ce.push({time:me,typedTime:tn,back:nt})}catch{break}if(ce.length===0)throw new Error("Invalid zone adjustments");return this.currentLine++,ce}return[]}parseRepeat(){const U=[];for(;;){const ce=this.getCurrentRecord();if(ce.type!==v.REPEAT)break;{const me=this.extract(ce,this.consumeRepeatInterval),nt=this.parseTypedTime(ce);U.push({repeatInterval:me,typedTimes:nt}),this.currentLine++}}return U}parseTypedTime(U){const ce=[];for(;;)try{this.consumeSpaceForRecord(U),ce.push(this.extract(U,this.consumeTypedTime))}catch{break}if(ce.length===0)throw new Error("Invalid typed time.");return ce}parseTime(){const U=this.getCurrentRecord(),ce=this.extract(U,this.consumeTime);this.consumeSpaceForRecord(U);const me=this.extract(U,this.consumeTime);return this.currentLine++,{startTime:ce,stopTime:me}}parseBandWidth(){const U=[];for(;this.currentLine<this.records.length;){const ce=this.getCurrentRecord();if(ce.type!==v.BANDWIDTH)break;{const me=this.extractOneOrMore(ce,D);if(ce.value[ce.cur]!==":")throw new Error("Invalid bandwidth field.");ce.cur++;const nt=this.extractOneOrMore(ce,w);U.push({bwtype:me,bandwidth:nt}),this.currentLine++}}return U}parseVersion(){const U=this.getCurrentRecord();if(U.type!==v.VERSION)throw new Error("first sdp record must be version");const ce=U.value.slice(0,this.consumeOneOrMore(U.value,0,w));if(ce.length!==U.value.length)throw new Error('invalid proto version, "v='.concat(U.value,'"'));return this.currentLine++,ce}parseOrigin(){const U=this.getCurrentRecord();if(U.type!==v.ORIGIN)throw new Error("second line of sdp must be origin");const ce=this.extractOneOrMore(U,O);this.consumeSpaceForRecord(U);const me=this.extractOneOrMore(U,w);this.consumeSpaceForRecord(U);const nt=this.extractOneOrMore(U,w);this.consumeSpaceForRecord(U);const tn=this.extractOneOrMore(U,D);this.consumeSpaceForRecord(U);const lr=this.extractOneOrMore(U,D);this.consumeSpaceForRecord(U);const ts=this.extract(U,this.consumeUnicastAddress);return this.currentLine++,{username:ce,sessId:me,sessVersion:nt,nettype:tn,addrtype:lr,unicastAddress:ts}}parseSessionName(){const U=this.getCurrentRecord();if(U.type===v.SESSION_NAME){const ce=this.extract(U,this.consumeText);return this.currentLine++,ce}}parseInformation(){const U=this.getCurrentRecord();if(U.type!==v.INFORMATION)return;const ce=this.extract(U,this.consumeText);return this.currentLine++,ce}parseUri(){const U=this.getCurrentRecord();if(U.type===v.URI)return this.currentLine++,U.value}parseEmail(){const U=[];for(;;){const ce=this.getCurrentRecord();if(ce.type!==v.EMAIL)break;U.push(ce.value),this.currentLine++}return U}parsePhone(){const U=[];for(;;){const ce=this.getCurrentRecord();if(ce.type!==v.PHONE)break;U.push(ce.value),this.currentLine++}return U}parseConnection(){const U=this.getCurrentRecord();if(U.type===v.CONNECTION){const ce=this.extractOneOrMore(U,D);this.consumeSpaceForRecord(U);const me=this.extractOneOrMore(U,D);this.consumeSpaceForRecord(U);const nt=this.extract(U,this.consumeAddress);return this.currentLine++,{nettype:ce,addrtype:me,address:nt}}}parseMedia(){const U=this.getCurrentRecord(),ce=this.extract(U,this.consumeToken);this.consumeSpaceForRecord(U);let me=this.extract(U,this.consumePort);U.value[U.cur]==="/"&&(U.cur+=1,me+=this.extract(U,this.consumeInteger)),this.consumeSpaceForRecord(U);const nt=[];for(nt.push(this.extract(U,this.consumeToken));U.value[U.cur]==="/";)U.cur+=1,nt.push(this.extract(U,this.consumeToken));if(nt.length===0)throw new Error("Invalid proto");const tn=this.parseFmt(U);return this.currentLine++,{mediaType:ce,port:me,protos:nt,fmts:tn}}parseTimeFields(){const U=[];for(;this.getCurrentRecord().type===v.TIME;){const ce=this.parseTime(),me=this.parseRepeat(),nt=this.parseZone();U.push({time:ce,repeats:me,zones:nt})}return U}parseMediaDescription(){const U=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===v.MEDIA;){const ce=this.parseMedia(),me=this.parseInformation(),nt=this.parseConnections(),tn=this.parseBandWidth(),lr=this.parseKey(),ts=this.parseMediaAttributes(ce);U.push({media:ce,information:me,connections:nt,bandwidths:tn,key:lr,attributes:ts})}return U}parseConnections(){const U=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===v.CONNECTION;)U.push(this.parseConnection());return U}parseFmt(U){const ce=[];for(;;)try{this.consumeSpaceForRecord(U),ce.push(this.extract(U,this.consumeToken))}catch{break}if(ce.length===0)throw new Error("Invalid fmts");return ce}extract(U,ce){for(var me=arguments.length,nt=new Array(me>2?me-2:0),tn=2;tn<me;tn++)nt[tn-2]=arguments[tn];const lr=ce.call(this,U.value,U.cur,...nt),ts=U.value.slice(U.cur,lr);return U.cur=lr,ts}extractOneOrMore(U,ce){const me=this.consumeOneOrMore(U.value,U.cur,ce),nt=U.value.slice(U.cur,me);return U.cur=me,nt}consumeSpaceForRecord(U){if(U.value[U.cur]!==y)throw new Error("Invalid space at ".concat(U.cur,"."));U.cur+=1}}class yt extends Ze{constructor(){super(...arguments),Ne(this,"attributes",void 0),Ne(this,"digested",!1)}extractOneOrMore(U,ce,me){const nt=this.consumeOneOrMore(U.attValue,U._cur,ce),tn=U.attValue.slice(U._cur,nt),[lr,ts]=me||[];if(typeof lr=="number"&&tn.length<lr)throw new Error("error in length, should be more or equal than ".concat(lr," characters."));if(typeof ts=="number"&&tn.length>ts)throw new Error("error in length, should be less or equal than ".concat(ts," characters."));return U._cur=nt,tn}consumeAttributeSpace(U){if(U.attValue[U._cur]!==y)throw new Error("Invalid space at ".concat(U._cur,"."));U._cur+=1}extract(U,ce){if(!U.attValue)throw new Error("Nothing to extract from attValue.");for(var me=arguments.length,nt=new Array(me>2?me-2:0),tn=2;tn<me;tn++)nt[tn-2]=arguments[tn];const lr=ce.call(this,U.attValue,U._cur,...nt),ts=U.attValue.slice(U._cur,lr);return U._cur=lr,ts}atEnd(U){if(!U.attValue)throw new Error;return U._cur>=U.attValue.length}peekChar(U){if(!U.attValue)throw new Error;return U.attValue[U._cur]}peek(U,ce){if(!U.attValue)throw new Error;for(let me=0;me<ce.length;me++)if(ce[me]!==U.attValue[U._cur+me])return!1;return!0}parseIceUfrag(U){if(this.attributes.iceUfrag)throw new Error("Invalid ice-ufrag, should be only a single line if 'a=ice-ufrag'");this.attributes.iceUfrag=this.extractOneOrMore(U,ee,[4,256])}parseIcePwd(U){if(this.attributes.icePwd)throw new Error("Invalid ice-pwd, should be only a single line if 'a=ice-pwd'");this.attributes.icePwd=this.extractOneOrMore(U,ee,[22,256])}parseIceOptions(U){if(this.attributes.iceOptions)throw new Error("Invalid ice-options, should be only one 'ice-options' line");const ce=[];for(;!this.atEnd(U);){ce.push(this.extractOneOrMore(U,ee));try{this.consumeAttributeSpace(U)}catch(me){if(this.atEnd(U))break;throw me}}this.attributes.iceOptions=ce}parseFingerprint(U){const ce=this.extract(U,this.consumeToken);this.consumeAttributeSpace(U);const me=this.extract(U,this.consumeTill);this.attributes.fingerprints.push({hashFunction:ce,fingerprint:me})}parseExtmap(U){const ce=this.extractOneOrMore(U,w);let me;this.peekChar(U)==="/"&&(this.extract(U,this.consume,"/"),me=this.extract(U,this.consumeToken)),this.consumeAttributeSpace(U);const nt=this.extract(U,this.consumeTill,y),tn=_e(_e({entry:parseInt(ce,10)},me&&{direction:me}),{},{extensionName:nt});this.peekChar(U)===y&&(this.consumeAttributeSpace(U),tn.extensionAttributes=this.extract(U,this.consumeTill)),this.attributes.extmaps.push(tn)}parseSetup(U){if(this.attributes.setup)throw new Error("must only be one single 'a=setup' line.");const ce=this.extract(U,this.consumeTill);if(ce!=="active"&&ce!=="passive"&&ce!=="actpass"&&ce!=="holdconn")throw new Error("role must be one of 'active', 'passive', 'actpass', 'holdconn'.");this.attributes.setup=ce}}class An extends yt{constructor(){super(...arguments),Ne(this,"attributes",{unrecognized:[],groups:[],extmaps:[],fingerprints:[],identities:[]})}parse(U){if(this.digested)throw new Error("already digested");try{switch(U.attField){case"group":this.parseGroup(U);break;case"ice-lite":this.parseIceLite();break;case"ice-ufrag":this.parseIceUfrag(U);break;case"ice-pwd":this.parseIcePwd(U);break;case"ice-options":this.parseIceOptions(U);break;case"fingerprint":this.parseFingerprint(U);break;case"setup":this.parseSetup(U);break;case"tls-id":this.parseTlsId(U);break;case"identity":this.parseIdentity(U);break;case"extmap":this.parseExtmap(U);break;case"msid-semantic":this.parseMsidSemantic(U);break;default:U.ignored=!0,this.attributes.unrecognized.push(U)}}catch(ce){throw console.error("parsing session attribute ".concat(U.attField,' error, "a=').concat(U.attField,":").concat(U.attValue,'"')),ce}if(!U.ignored&&U.attValue&&!this.atEnd(U))throw new Error("attribute parsing error")}digest(){return this.digested=!0,this.attributes}parseGroup(U){const ce=this.extract(U,this.consumeToken),me=[];for(;!this.atEnd(U)&&this.peekChar(U)===y;)this.consumeAttributeSpace(U),me.push(this.extract(U,this.consumeToken));this.attributes.groups.push({semantic:ce,identificationTag:me})}parseIceLite(){if(this.attributes.iceLite)throw new Error("Invalid ice-lite, should be only a single line of 'a=ice-lite'");this.attributes.iceLite=!0}parseTlsId(U){if(this.attributes.tlsId)throw new Error("must be only one tld-id line");this.attributes.tlsId=this.extractOneOrMore(U,fe)}parseIdentity(U){const ce=this.extractOneOrMore(U,ye),me=[];for(;!this.atEnd(U)&&this.peekChar(U)===y;){this.consumeAttributeSpace(U);const nt=this.extract(U,this.consumeToken);this.extract(U,this.consume,"=");const tn=this.extractOneOrMore(U,lr=>lr!==y&&Q(lr));me.push({name:nt,value:tn})}this.attributes.identities.push({assertionValue:ce,extensions:me})}parseMsidSemantic(U){this.peekChar(U)===y&&this.consumeAttributeSpace(U);const ce={semantic:this.extract(U,this.consumeToken),identifierList:[]};for(;;){try{this.consumeAttributeSpace(U)}catch{break}if(this.peekChar(U)==="*"){this.extract(U,this.consume,"*"),ce.applyForAll=!0;break}{const me=this.extract(U,this.consumeTill,y);ce.identifierList.push(me)}}this.attributes.msidSemantic=ce}}class Pn extends yt{constructor(U){super(),Ne(this,"attributes",void 0),U.protos.indexOf("RTP")!==-1||U.protos.indexOf("rtp"),this.attributes={unrecognized:[],candidates:[],extmaps:[],fingerprints:[],imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[]}}parse(U){if(this.digested)throw new Error("already digested");try{switch(U.attField){case"extmap":this.parseExtmap(U);break;case"setup":this.parseSetup(U);break;case"ice-ufrag":this.parseIceUfrag(U);break;case"ice-pwd":this.parseIcePwd(U);break;case"ice-options":this.parseIceOptions(U);break;case"candidate":this.parseCandidate(U);break;case"remote-candidate":this.parseRemoteCandidate(U);break;case"end-of-candidates":this.parseEndOfCandidates();break;case"fingerprint":this.parseFingerprint(U);break;case"rtpmap":this.parseRtpmap(U);break;case"ptime":this.parsePtime(U);break;case"maxptime":this.parseMaxPtime(U);break;case"sendrecv":case"recvonly":case"sendonly":case"inactive":this.parseDirection(U);break;case"ssrc":this.parseSSRC(U);break;case"fmtp":this.parseFmtp(U);break;case"rtcp-fb":this.parseRtcpFb(U);break;case"rtcp-mux":this.parseRTCPMux();break;case"rtcp-mux-only":this.parseRTCPMuxOnly();break;case"rtcp-rsize":this.parseRTCPRsize();break;case"rtcp":this.parseRTCP(U);break;case"mid":this.parseMid(U);break;case"msid":this.parseMsid(U);break;case"imageattr":this.parseImageAttr(U);break;case"rid":this.parseRid(U);break;case"simulcast":this.parseSimulcast(U);break;case"sctp-port":this.parseSctpPort(U);break;case"max-message-size":this.parseMaxMessageSize(U);break;case"ssrc-group":this.parseSSRCGroup(U);break;default:U.ignored=!0,this.attributes.unrecognized.push(U)}}catch(ce){throw console.error("parsing media attribute ".concat(U.attField,' error, "a=').concat(U.attField,":").concat(U.attValue,'"')),ce}if(!U.ignored&&U.attValue&&!this.atEnd(U))throw new Error("attribute parsing error")}parseCandidate(U){const ce=this.extractOneOrMore(U,ee,[1,32]);this.consumeAttributeSpace(U);const me=this.extractOneOrMore(U,w,[1,5]);this.consumeAttributeSpace(U);const nt=this.extract(U,this.consumeToken);this.consumeAttributeSpace(U);const tn=this.extractOneOrMore(U,w,[1,10]);this.consumeAttributeSpace(U);const lr=this.extract(U,this.consumeAddress);this.consumeAttributeSpace(U);const ts=this.extract(U,this.consumePort);this.consumeAttributeSpace(U),this.extract(U,this.consume,"typ"),this.consumeAttributeSpace(U);const ec={foundation:ce,componentId:me,transport:nt,priority:tn,connectionAddress:lr,port:ts,type:this.extract(U,this.consumeToken),extension:{}};for(this.peek(U," raddr")&&(this.extract(U,this.consume," raddr"),this.consumeAttributeSpace(U),ec.relAddr=this.extract(U,this.consumeAddress)),this.peek(U," rport")&&(this.extract(U,this.consume," rport"),this.consumeAttributeSpace(U),ec.relPort=this.extract(U,this.consumePort));this.peekChar(U)===y;){this.consumeAttributeSpace(U);const If=this.extract(U,this.consumeToken);this.consumeAttributeSpace(U),ec.extension[If]=this.extractOneOrMore(U,R)}this.attributes.candidates.push(ec)}parseRemoteCandidate(U){const ce=[];for(;;){const me=this.extractOneOrMore(U,w,[1,5]);this.consumeAttributeSpace(U);const nt=this.extract(U,this.consumeAddress);this.consumeAttributeSpace(U);const tn=this.extract(U,this.consumePort);ce.push({componentId:me,connectionAddress:nt,port:tn});try{this.consumeAttributeSpace(U)}catch{break}}this.attributes.remoteCandidatesList.push(ce)}parseEndOfCandidates(){if(this.attributes.endOfCandidates)throw new Error("must be only one line of end-of-candidates");this.attributes.endOfCandidates=!0}parseRtpmap(U){const ce=this.extract(U,this.consumeToken);this.consumeAttributeSpace(U);const me=this.extract(U,this.consumeTill,"/");this.extract(U,this.consume,"/");const nt={encodingName:me,clockRate:this.extractOneOrMore(U,w)};this.atEnd(U)||this.peekChar(U)!=="/"||(this.extract(U,this.consume,"/"),nt.encodingParameters=parseInt(this.extract(U,this.consumeTill),10));const tn=this.attributes.payloads.find(lr=>lr.payloadType===parseInt(ce,10));tn?tn.rtpMap=nt:this.attributes.payloads.push({payloadType:parseInt(ce,10),rtpMap:nt,rtcpFeedbacks:[]})}parsePtime(U){if(this.attributes.ptime)throw new Error("must be only one line of ptime");this.attributes.ptime=this.extract(U,this.consumeTill)}parseMaxPtime(U){if(this.attributes.maxPtime)throw new Error("must be only one line of ptime");this.attributes.maxPtime=this.extract(U,this.consumeTill)}parseDirection(U){if(this.attributes.direction)throw new Error("must be only one line of direction info");this.attributes.direction=U.attField}parseSSRC(U){const ce=this.extractOneOrMore(U,w);this.consumeAttributeSpace(U);const me=this.extract(U,this.consumeTill,":");let nt;this.peekChar(U)===":"&&(this.extract(U,this.consume,":"),nt=this.extract(U,this.consumeTill));const tn=this.attributes.ssrcs.find(lr=>lr.ssrcId===parseInt(ce,10));tn?tn.attributes[me]=nt:this.attributes.ssrcs.push({ssrcId:parseInt(ce,10),attributes:{[me]:nt}})}parseFmtp(U){const ce=this.extract(U,this.consumeTill,y);this.consumeAttributeSpace(U);const me=this.extract(U,this.consumeTill),nt={};me.split(";").forEach(lr=>{let[ts,ec]=lr.split("=");ts=Ro(ts).call(ts);const If=typeof ec=="string"?Ro(ec).call(ec):null;typeof ts=="string"&&ts.length>0&&(nt[ts]=If)});const tn=this.attributes.payloads.find(lr=>lr.payloadType===parseInt(ce,10));tn?tn.fmtp={parameters:nt}:this.attributes.payloads.push({payloadType:parseInt(ce,10),rtcpFeedbacks:[],fmtp:{parameters:nt}})}parseFmtParameters(U){const ce={},me=this.extract(U,this.consumeTill,"=");U._cur++;const nt=this.extract(U,this.consumeTill,";");for(ce[me]=nt;U.attValue[U._cur]===";";){const tn=this.extract(U,this.consumeTill,"=");U._cur++;const lr=this.extract(U,this.consumeTill,";");ce[tn]=lr}return ce}parseRtcpFb(U){let ce="";ce=this.peekChar(U)==="*"?this.extract(U,this.consume,"*"):this.extract(U,this.consumeTill,y),this.consumeAttributeSpace(U);const me=this.extract(U,this.consumeTill,y);let nt;if(me==="trr-int")nt={type:me,interval:this.extract(U,this.consumeTill)};else{const tn={type:me};this.peekChar(U)===y&&(this.consumeAttributeSpace(U),tn.parameter=this.extract(U,this.consumeToken),this.peekChar(U)===y&&(tn.additional=this.extract(U,this.consumeTill))),nt=tn}if(ce==="*")this.attributes.rtcpFeedbackWildcards.push(nt);else{const tn=this.attributes.payloads.find(lr=>lr.payloadType===parseInt(ce,10));tn?tn.rtcpFeedbacks.push(nt):this.attributes.payloads.push({payloadType:parseInt(ce,10),rtcpFeedbacks:[nt]})}}parseRTCPMux(){if(this.attributes.rtcpMux)throw new Error("must be single line of rtcp-mux");this.attributes.rtcpMux=!0}parseRTCPMuxOnly(){if(this.attributes.rtcpMuxOnly)throw new Error("must be single line of rtcp-only");this.attributes.rtcpMuxOnly=!0}parseRTCPRsize(){if(this.attributes.rtcpRsize)throw new Error("must be single line of rtcp-rsize");this.attributes.rtcpRsize=!0}parseRTCP(U){if(this.attributes.rtcp)throw new Error("must be single line of rtcp");const ce={port:this.extract(U,this.consumePort)};this.peekChar(U)===y&&(this.consumeAttributeSpace(U),ce.netType=this.extractOneOrMore(U,D),this.consumeAttributeSpace(U),ce.addressType=this.extractOneOrMore(U,D),this.consumeAttributeSpace(U),ce.address=this.extract(U,this.consumeAddress)),this.attributes.rtcp=ce}parseMsid(U){const ce={id:this.extractOneOrMore(U,D,[1,64])};this.peekChar(U)===y&&(this.consumeAttributeSpace(U),ce.appdata=this.extractOneOrMore(U,D,[1,64])),this.attributes.msids.push(ce)}parseImageAttr(U){this.attributes.imageattr.push(U.attValue)}parseRid(U){const ce=this.extractOneOrMore(U,nt=>j(nt)||w(nt)||nt==="_"||nt==="-");this.consumeAttributeSpace(U);const me={id:ce,direction:this.extract(U,this.consumeToken),params:[]};if(this.peekChar(U)===y){if(this.consumeAttributeSpace(U),this.peek(U,"pt=")){this.extract(U,this.consume,"pt=");const nt=[];for(;;){const tn=this.extract(U,this.consumeToken);nt.push(tn);try{this.extract(U,this.consume,",")}catch{break}}me.payloads=nt,this.peekChar(U)===y&&this.extract(U,this.consume,y)}for(;;){const nt=this.extract(U,this.consumeToken);switch(nt){case"depend":{const tn={type:nt,rids:this.extract(U,this.consume,"=").split(",")};me.params.push(tn);break}default:{const tn={type:nt};this.peekChar(U)==="="&&(this.extract(U,this.consume,"="),tn.val=this.extract(U,this.consumeTill,";")),me.params.push(tn)}}try{this.extract(U,this.consume,";")}catch{break}}}this.attributes.rids.push(me)}parseSimulcast(U){if(this.attributes.simulcast)throw new Error("must be single line of simulcast");this.attributes.simulcast=U.attValue,this.extract(U,this.consumeTill)}parseSctpPort(U){this.attributes.sctpPort=this.extractOneOrMore(U,w,[1,5])}parseMaxMessageSize(U){this.attributes.maxMessageSize=this.extractOneOrMore(U,w,[1,void 0])}digest(){return this.digested=!0,this.attributes}parseMid(U){this.attributes.mid=this.extract(U,this.consumeToken)}parseSSRCGroup(U){const ce=this.extract(U,this.consumeToken),me=[];for(;;)try{this.consumeAttributeSpace(U);const nt=this.extract(U,this.consumeInteger);me.push(parseInt(nt,10))}catch{break}this.attributes.ssrcGroups.push({semantic:ce,ssrcIds:me})}}function _r(Ye,U,ce){return U in Ye?Object.defineProperty(Ye,U,{value:ce,enumerable:!0,configurable:!0,writable:!0}):Ye[U]=ce,Ye}class pi{constructor(){_r(this,"eol",m)}print(U,ce){let me="";return ce&&(this.eol=ce),me+=this.printVersion(U.version),me+=this.printOrigin(U.origin),me+=this.printSessionName(U.sessionName),me+=this.printInformation(U.information),me+=this.printUri(U.uri),me+=this.printEmail(U.emails),me+=this.printPhone(U.phones),me+=this.printConnection(U.connection),me+=this.printBandwidth(U.bandwidths),me+=this.printTimeFields(U.timeFields),me+=this.printKey(U.key),me+=this.printSessionAttributes(U.attributes),me+=this.printMediaDescription(U.mediaDescriptions),me}printVersion(U){return"v=".concat(U).concat(this.eol)}printOrigin(U){return"o=".concat(U.username," ").concat(U.sessId," ").concat(U.sessVersion," ").concat(U.nettype," ").concat(U.addrtype," ").concat(U.unicastAddress).concat(this.eol)}printSessionName(U){return U?"s=".concat(U).concat(this.eol):""}printInformation(U){return U?"i=".concat(U).concat(this.eol):""}printUri(U){return U?"u=".concat(U).concat(this.eol):""}printEmail(U){let ce="";for(const me of U)ce+="e=".concat(me).concat(this.eol);return ce}printPhone(U){let ce="";for(const me of U)ce+="e=".concat(me).concat(this.eol);return ce}printConnection(U){return U?"c=".concat(U.nettype," ").concat(U.addrtype," ").concat(U.address).concat(this.eol):""}printBandwidth(U){let ce="";for(const me of U)ce+="b=".concat(me.bwtype,":").concat(me.bandwidth).concat(this.eol);return ce}printTimeFields(U){let ce="";for(const me of U){ce+="t=".concat(me.time.startTime," ").concat(me.time.startTime).concat(this.eol);for(const nt of me.repeats)ce+="r=".concat(nt.repeatInterval," ").concat(nt.typedTimes.join(" ")).concat(this.eol);me.zoneAdjustments&&(ce+="z=",ce+="z=".concat(me.zoneAdjustments.map(nt=>"".concat(nt.time," ").concat(nt.back?"-":""," ").concat(nt.typedTime)).join(" ")).concat(this.eol),ce+=this.eol)}return ce}printKey(U){return U?"k=".concat(U).concat(this.eol):""}printAttributes(U){let ce="";for(const me of U)ce+="a=".concat(me.attField).concat(me.attValue?":".concat(me.attValue):"").concat(this.eol);return ce}printMediaDescription(U){let ce="";for(const me of U)ce+=this.printMedia(me.media),ce+=this.printInformation(me.information),ce+=this.printConnections(me.connections),ce+=this.printBandwidth(me.bandwidths),ce+=this.printKey(me.key),ce+=this.printMediaAttributes(me);return ce}printConnections(U){let ce="";for(const me of U)ce+=this.printConnection(me);return ce}printMedia(U){return"m=".concat(U.mediaType," ").concat(U.port," ").concat(U.protos.join("/")," ").concat(U.fmts.join(" ")).concat(this.eol)}printSessionAttributes(U){return new Ra(this.eol).print(U)}printMediaAttributes(U){return new ze(this.eol).print(U)}}class Zr{constructor(U){_r(this,"eol",void 0),this.eol=U}printIceUfrag(U){return U===void 0?"":"a=ice-ufrag:".concat(U).concat(this.eol)}printIcePwd(U){return U===void 0?"":"a=ice-pwd:".concat(U).concat(this.eol)}printIceOptions(U){return U===void 0?"":"a=ice-options:".concat(U.join(y)).concat(this.eol)}printFingerprints(U){return U.length>0?U.map(ce=>"a=fingerprint:".concat(ce.hashFunction).concat(y).concat(ce.fingerprint)).join(this.eol)+this.eol:""}printExtmap(U){return U.map(ce=>"a=extmap:".concat(ce.entry).concat(ce.direction?"/".concat(ce.direction):"").concat(y).concat(ce.extensionName).concat(ce.extensionAttributes?"".concat(y).concat(ce.extensionAttributes):"").concat(this.eol)).join("")}printSetup(U){return U===void 0?"":"a=setup:".concat(U).concat(this.eol)}printUnrecognized(U){return U.map(ce=>"a=".concat(ce.attField).concat(ce.attValue?":".concat(ce.attValue):"").concat(this.eol)).join("")}}class Ra extends Zr{print(U){let ce="";return ce+=this.printGroups(U.groups),ce+=this.printMsidSemantic(U.msidSemantic),ce+=this.printIceLite(U.iceLite),ce+=this.printIceUfrag(U.iceUfrag),ce+=this.printIcePwd(U.icePwd),ce+=this.printIceOptions(U.iceOptions),ce+=this.printFingerprints(U.fingerprints),ce+=this.printSetup(U.setup),ce+=this.printTlsId(U.tlsId),ce+=this.printIdentity(U.identities),ce+=this.printExtmap(U.extmaps),ce+=this.printUnrecognized(U.unrecognized),ce}printGroups(U){let ce="";return U.length>0&&(ce+=U.map(me=>"a=group:".concat(me.semantic).concat(me.identificationTag.map(nt=>"".concat(y).concat(nt)).join("")).concat(this.eol)).join("")),ce}printIceLite(U){return U===void 0?"":"a=ice-lite"+this.eol}printTlsId(U){return U?"a=tls-id:".concat(U).concat(this.eol):""}printIdentity(U){return U.length===0?"":U.map(ce=>"a=identity:".concat(ce.assertionValue).concat(ce.extensions.map(me=>"".concat(y).concat(me.name).concat(me.value?"=".concat(me.value):"")))).join(this.eol)+this.eol}printMsidSemantic(U){if(!U)return"";let ce="a=msid-semantic:".concat(U.semantic);return U.applyForAll?ce+="".concat(y,"*"):U.identifierList.length>0&&(ce+=U.identifierList.map(me=>"".concat(y).concat(me))),ce+this.eol}}class ze extends Zr{print(U){const ce=U.attributes;let me="";return me+=this.printRTCP(ce.rtcp),me+=this.printIceUfrag(ce.iceUfrag),me+=this.printIcePwd(ce.icePwd),me+=this.printIceOptions(ce.iceOptions),me+=this.printCandidates(ce.candidates),me+=this.printRemoteCandidatesList(ce.remoteCandidatesList),me+=this.printEndOfCandidates(ce.endOfCandidates),me+=this.printFingerprints(ce.fingerprints),me+=this.printSetup(ce.setup),me+=this.printMid(ce.mid),me+=this.printExtmap(ce.extmaps),me+=this.printRTPRelated(ce),me+=this.printPtime(ce.ptime),me+=this.printMaxPtime(ce.maxPtime),me+=this.printDirection(ce.direction),me+=this.printSSRCGroups(ce.ssrcGroups),me+=this.printSSRC(ce.ssrcs),me+=this.printRTCPMux(ce.rtcpMux),me+=this.printRTCPMuxOnly(ce.rtcpMuxOnly),me+=this.printRTCPRsize(ce.rtcpRsize),me+=this.printMSId(ce.msids),me+=this.printImageattr(ce.imageattr),me+=this.printRid(ce.rids),me+=this.printSimulcast(ce.simulcast),me+=this.printSCTPPort(ce.sctpPort),me+=this.printMaxMessageSize(ce.maxMessageSize),me+=this.printUnrecognized(ce.unrecognized),me}printCandidates(U){return U.map(ce=>"a=candidate:".concat(ce.foundation).concat(y).concat(ce.componentId).concat(y).concat(ce.transport).concat(y).concat(ce.priority).concat(y).concat(ce.connectionAddress).concat(y).concat(ce.port).concat(y,"typ").concat(y).concat(ce.type).concat(ce.relAddr?"".concat(y,"raddr").concat(y).concat(ce.relAddr):"").concat(ce.relPort?"".concat(y,"rport").concat(y).concat(ce.relPort):"").concat(Object.keys(ce.extension).map(me=>"".concat(y).concat(me).concat(y).concat(ce.extension[me])).join("")).concat(this.eol)).join("")}printRemoteCandidatesList(U){return U.map(ce=>"a=remote-candidates:".concat(ce.join(y)).concat(this.eol)).join("")}printEndOfCandidates(U){return U===void 0?"":"a=end-of-candidates"+this.eol}printRTPRelated(U){if(!U.payloads)return"";const ce=U.payloads;let me="";me+=U.rtcpFeedbackWildcards.map(nt=>this.printRTCPFeedback("*",nt)).join("");for(const nt of ce)me+=this.printRtpMap(nt.payloadType,nt.rtpMap),me+=this.printFmtp(nt.payloadType,nt.fmtp),me+=nt.rtcpFeedbacks.map(tn=>this.printRTCPFeedback(nt.payloadType,tn)).join("");return me}printFmtp(U,ce){if(!ce)return"";const me=Object.keys(ce.parameters);return me.length===1&&ce.parameters[me[0]]===null?"a=fmtp:".concat(U).concat(y).concat(me[0]).concat(this.eol):"a=fmtp:".concat(U).concat(y).concat(Object.keys(ce.parameters).map(nt=>"".concat(nt,"=").concat(ce.parameters[nt])).join(";")).concat(this.eol)}printRtpMap(U,ce){return ce?"a=rtpmap:".concat(U).concat(y).concat(ce.encodingName,"/").concat(ce.clockRate).concat(ce.encodingParameters?"/".concat(ce.encodingParameters):"").concat(this.eol):""}printRTCPFeedback(U,ce){let me="a=rtcp-fb:".concat(U).concat(y),nt=ce;return nt.type==="trr-int"?me+="ttr-int".concat(y).concat(nt.interval):(me+="".concat(nt.type),nt.parameter&&(me+="".concat(y).concat(nt.parameter),nt.additional&&(me+="".concat(y).concat(nt.additional)))),me+this.eol}printPtime(U){return U===void 0?"":"a=ptime:".concat(U).concat(this.eol)}printMaxPtime(U){return U===void 0?"":"a=maxptime:".concat(U).concat(this.eol)}printDirection(U){return U===void 0?"":"a=".concat(U).concat(this.eol)}printSSRC(U){return U.map(ce=>Object.keys(ce.attributes).map(me=>"a=ssrc:".concat(ce.ssrcId.toString(10)).concat(y).concat(me).concat(ce.attributes[me]?":".concat(ce.attributes[me]):"").concat(this.eol)).join("")).join("")}printRTCPMux(U){return U===void 0?"":"a=rtcp-mux".concat(this.eol)}printRTCPMuxOnly(U){return U===void 0?"":"a=rtcp-mux-only".concat(this.eol)}printRTCPRsize(U){return U===void 0?"":"a=rtcp-rsize".concat(this.eol)}printRTCP(U){if(U===void 0)return"";let ce="a=rtcp:".concat(U.port);return U.netType&&(ce+="".concat(y).concat(U.netType)),U.addressType&&(ce+="".concat(y).concat(U.addressType)),U.address&&(ce+="".concat(y).concat(U.address)),ce+this.eol}printMSId(U){return U.map(ce=>"a=msid:".concat(ce.id).concat(ce.appdata?"".concat(y).concat(ce.appdata):"").concat(this.eol)).join("")}printImageattr(U){return U.map(ce=>"a=imageattr:".concat(ce).concat(this.eol)).join("")}printRid(U){return U.map(ce=>{let me="a=rid:".concat(ce.id).concat(y).concat(ce.direction);return ce.payloads&&(me+="".concat(y,"pt=").concat(ce.payloads.join(","))),ce.params.length>0&&(me+="".concat(y).concat(ce.params.map(nt=>nt.type==="depend"?"depend=".concat(nt.rids.join(",")):"".concat(nt.type,"=").concat(nt.val)).join(";"))),me+this.eol}).join("")}printSimulcast(U){return U===void 0?"":"a=simulcast:".concat(U).concat(this.eol)}printSCTPPort(U){return U===void 0?"":"a=sctp-port:".concat(U).concat(this.eol)}printMaxMessageSize(U){return U===void 0?"":"a=max-message-size:".concat(U).concat(this.eol)}printMid(U){return U===void 0?"":"a=mid:".concat(U).concat(this.eol)}printSSRCGroups(U){return U.map(ce=>"a=ssrc-group:".concat(ce.semantic).concat(ce.ssrcIds.map(me=>"".concat(y).concat(me.toString(10))).join("")).concat(this.eol)).join("")}}function at(Ye){return new ft().parse(Ye)}function Pt(Ye,U){return new pi().print(Ye,U)}}},r={};function s(a){if(r[a])return r[a].exports;var c=r[a]={exports:{}};return t[a](c,c.exports,s),c.exports}return s.d=(a,c)=>{for(var d in c)s.o(c,d)&&!s.o(a,d)&&Object.defineProperty(a,d,{enumerable:!0,get:c[d]})},s.o=(a,c)=>Object.prototype.hasOwnProperty.call(a,c),s.r=a=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(a,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(a,"__esModule",{value:!0})},s(8)})();function Xa(t){return u8.parse(t)}function Qm(t,r){return u8.print(t,r)}var mme=yc("Array").keys,gme=Fc,_me=Pi,yme=P,Eme=mme,FL=Array.prototype,vme={DOMTokenList:!0,NodeList:!0},Sme=function(t){var r=t.keys;return t===FL||yme(FL,t)&&r===FL.keys||_me(vme,gme(t))?Eme:r},tl=l(Sme);function d8(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}function dn(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?d8(Object(s),!0).forEach(function(a){Yr(t,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):d8(Object(s)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))})}return t}function Yr(t,r,s){return(r=function(a){var c=function(d,h){if(typeof d!="object"||d===null)return d;var m=d[Symbol.toPrimitive];if(m!==void 0){var y=m.call(d,"string");if(typeof y!="object")return y;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(d)}(a);return typeof c=="symbol"?c:String(c)}(r))in t?Object.defineProperty(t,r,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[r]=s,t}const h8=new class extends Br{constructor(){super(...arguments),Yr(this,"currentUploadLogID",0)}reportLogUploadError(t){const{errorRange:r}=t;r[r.length-1]&&r[r.length-1]>this.currentUploadLogID&&(this.currentUploadLogID=r[r.length-1],this.emit("REPORT_LOG_UPLOAD",t))}};class bme{constructor(r){Yr(this,"logger",void 0),Yr(this,"prefixLists",[]),this.logger=r}debug(){for(var r=arguments.length,s=new Array(r),a=0;a<r;a++)s[a]=arguments[a];this.logger.debug(...this.prefixLists,...s)}info(){for(var r=arguments.length,s=new Array(r),a=0;a<r;a++)s[a]=arguments[a];this.logger.info(...this.prefixLists,...s)}warning(){for(var r=arguments.length,s=new Array(r),a=0;a<r;a++)s[a]=arguments[a];this.logger.warning(...this.prefixLists,...s)}error(){for(var r=arguments.length,s=new Array(r),a=0;a<r;a++)s[a]=arguments[a];this.logger.error(...this.prefixLists,...s)}prefix(r){return this.prefixLists.push(r),this}popPrefix(){return this.prefixLists.pop(),this}}function BL(){const t=new Date;return t.toTimeString().split(" ")[0]+":"+t.getMilliseconds()}function p8(){const t=new Date,r=/((\d+:){2}\d+)/.exec(new Date().toUTCString());return r?(r==null?void 0:r[0])+":"+t.getUTCMilliseconds():t.toTimeString().split(" ")[0]+":"+t.getMilliseconds()}const Ul={DEBUG:0,INFO:1,WARNING:2,ERROR:3,NONE:4},hP=Date.now(),Fw=t=>{for(const r in Ul)if(Object.prototype.hasOwnProperty.call(Ul,r)&&Ul[r]===t)return r;return"DEFAULT"},x=new class{constructor(){Yr(this,"proxyServerURL",void 0),Yr(this,"logLevel",Ul.DEBUG),Yr(this,"uploadState","collecting"),Yr(this,"uploadLogWaitingList",[]),Yr(this,"uploadLogUploadingList",[]),Yr(this,"uploadErrorCount",0),Yr(this,"currentLogID",0),Yr(this,"url",void 0),Yr(this,"extLog",(t,r)=>{this.appendLogToWaitingList(t,...r)})}debug(){for(var t=arguments.length,r=new Array(t),s=0;s<t;s++)r[s]=arguments[s];const a=[Ul.DEBUG].concat(r);this.log.apply(this,a)}info(){for(var t=arguments.length,r=new Array(t),s=0;s<t;s++)r[s]=arguments[s];const a=[Ul.INFO].concat(r);this.log.apply(this,a)}warning(){for(var t=arguments.length,r=new Array(t),s=0;s<t;s++)r[s]=arguments[s];const a=[Ul.WARNING].concat(r);this.log.apply(this,a)}warn(){this.warning(...arguments)}error(){for(var t=arguments.length,r=new Array(t),s=0;s<t;s++)r[s]=arguments[s];const a=[Ul.ERROR].concat(r);this.log.apply(this,a)}upload(){for(var t=arguments.length,r=new Array(t),s=0;s<t;s++)r[s]=arguments[s];const a=[Ul.DEBUG].concat(r);this.uploadLog.apply(this,a)}setLogLevel(t){t=Math.min(Math.max(0,t),4),this.logLevel=t}enableLogUpload(){sr("UPLOAD_LOG",!0)}disableLogUpload(){sr("UPLOAD_LOG",!1),this.uploadLogUploadingList=[],this.uploadLogWaitingList=[]}setProxyServer(t){this.proxyServerURL=t}prefix(t){return new bme(this).prefix(t)}log(){for(var t=arguments.length,r=new Array(t),s=0;s<t;s++)r[s]=arguments[s];if(Date.now()-hP<100)return void setTimeout(()=>{this.log(...r)},Date.now()-hP);const a=Math.max(0,Math.min(4,r[0]));if(r[0]=BL()+" Agora-SDK [".concat(Fw(a),"]:"),this.appendLogToWaitingList(a,...r),a<this.logLevel)return;const c=BL()+" %cAgora-SDK [".concat(Fw(a),"]:");let d=[];if(!oe("USE_NEW_LOG"))switch(a){case Ul.DEBUG:d=[c,"color: #64B5F6;"].concat(r.slice(1)),console.log.apply(console,d);break;case Ul.INFO:d=[c,"color: #1E88E5; font-weight: bold;"].concat(r.slice(1)),console.log.apply(console,d);break;case Ul.WARNING:d=[c,"color: #FB8C00; font-weight: bold;"].concat(r.slice(1)),console.warn.apply(console,d);break;case Ul.ERROR:d=[c,"color: #B00020; font-weight: bold;"].concat(r.slice(1)),console.error.apply(console,d)}}uploadLog(){for(var t=arguments.length,r=new Array(t),s=0;s<t;s++)r[s]=arguments[s];if(Date.now()-hP<100)return void setTimeout(()=>{this.uploadLog(...r)},Date.now()-hP);const a=Math.max(0,Math.min(4,r[0]));r[0]=BL()+" Agora-SDK [".concat(Fw(a),"]:"),this.appendLogToWaitingList(a,...r)}appendLogToWaitingList(t){if(!oe("UPLOAD_LOG"))return;for(var r=arguments.length,s=new Array(r>1?r-1:0),a=1;a<r;a++)s[a-1]=arguments[a];Array.isArray(s[0])?s[0][0]=p8()+" Agora-SDK [".concat(Fw(t),"]:"):s[0]=p8()+" Agora-SDK [".concat(Fw(t),"]:");let c="";s.forEach(d=>{typeof d=="object"&&(d=JSON.stringify(d)),c+="".concat(d," ")}),this.uploadLogWaitingList.push({payload_str:c,log_level:t,log_item_id:this.currentLogID++}),this.uploadState==="uploading"&&this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}startUpload(){this.uploadState="uploading",this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}async uploadLogs(){const t=this.uploadLogUploadingList,r={sdk_version:Ml,process_id:oe("PROCESS_ID"),payload:JSON.stringify(t)};return kd(async()=>{const s=await va.post(this.url||(this.proxyServerURL?"https://".concat(this.proxyServerURL,"/ls/?h=").concat(oe("LOG_UPLOAD_SERVER"),"&p=443&d=upload/v1"):"https://".concat(oe("LOG_UPLOAD_SERVER"),"/upload/v1")),r,{responseType:"text"});if(s.data!=="OK"){const a=new Error("unexpected upload log response");throw a.response=s,a}},()=>(this.uploadLogUploadingList=[],!1),s=>{const a={status:-1,message:s.message,errorRange:t.map(c=>c.log_item_id)};return s.response?(a.status=s.response.status,a.data=s.response.data,a.headers=s.response.headers):s.request&&(a.status=s.request.status),h8.reportLogUploadError(a),!0},{timeout:oe("UPLOAD_LOG_REQUEST_RETRY_INTERVAL"),maxRetryTimeout:oe("UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL")})}uploadLogInterval(){this.uploadLogUploadingList.length===0&&this.uploadLogWaitingList.length===0||(this.uploadLogUploadingList.length===0&&(this.uploadLogUploadingList=this.uploadLogWaitingList.splice(0,oe("UPLOAD_LOG_LENGTH_EACH_TIME"))),this.uploadLogs().then(()=>{this.uploadErrorCount=0,this.uploadLogWaitingList.length>0&&window.setTimeout(()=>this.uploadLogInterval(),oe("UPLOAD_LOG_INTERVAL"))}).catch(t=>{this.uploadErrorCount+=1,this.uploadErrorCount<2?window.setTimeout(()=>this.uploadLogInterval(),oe("UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1")):window.setTimeout(()=>this.uploadLogInterval(),oe("UPLOAD_LOG_RETRY_INTERVAL_V1"))}))}};var f8;function wme(t){return _s(t.reportId,"params.reportId",0,100,!1),_s(t.category,"params.category",0,100,!1),_s(t.event,"params.event",0,100,!1),_s(t.label,"params.label",0,100,!1),cr(t.value,"params.value",Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,!1),!0}(f8={}).FREE="free",f8.UPLOADING="uploading",function(t){t[t.MISC=0]="MISC",t[t.INTERNAL_EVENT=1]="INTERNAL_EVENT",t[t.PUBLIC_EVENT=2]="PUBLIC_EVENT",t[t.WEB_EVENT=3]="WEB_EVENT",t[t.INTERNAL_API=4]="INTERNAL_API",t[t.WEB_API=5]="WEB_API",t[t.PUBLIC_API=6]="PUBLIC_API"}({});const Tme={sid:"",lts:0,success:null,cname:null,uid:null,peer:null,cid:null,elapse:null,extend:null,vid:0};let Zi=function(t){return t.PUBLISH="publish",t.SUBSCRIBE="subscribe",t.WS_COMPRESSOR_INIT="ws_compressor_init",t.SESSION_INIT="session_init",t.JOIN_CHOOSE_SERVER="join_choose_server",t.REQ_USER_ACCOUNT="req_user_account",t.JOIN_GATEWAY="join_gateway",t.REJOIN_GATEWAY="rejoin_gateway",t.STREAM_SWITCH="stream_switch",t.REQUEST_PROXY_WORKER_MANAGER="request_proxy_worker_manager",t.REQUEST_PROXY_APPCENTER="request_proxy_appcenter",t.FIRST_VIDEO_RECEIVED="first_video_received",t.FIRST_AUDIO_RECEIVED="first_audio_received",t.FIRST_VIDEO_DECODE="first_video_decode",t.FIRST_AUDIO_DECODE="first_audio_decode",t.ON_ADD_AUDIO_STREAM="on_add_audio_stream",t.ON_ADD_VIDEO_STREAM="on_add_video_stream",t.ON_UPDATE_STREAM="on_update_stream",t.ON_REMOVE_STREAM="on_remove_stream",t.USER_ANALYTICS="req_user_analytics",t.PC_STATS="pc_stats",t.UPDATE_REMOTE_RTPCAPABILITIES="update_remote_rtpCapabilities",t.AB_TEST="ab_test",t}({}),Mr=function(t){return t.SESSION="io.agora.pb.Wrtc.Session",t.JOIN_CHOOSE_SERVER="io.agora.pb.Wrtc.JoinChooseServer",t.REQ_USER_ACCOUNT="io.agora.pb.Wrtc.ReqUserAccount",t.JOIN_GATEWAY="io.agora.pb.Wrtc.JoinGateway",t.RE_JOIN_GATEWAY="io.agora.pb.Wrtc.ReJoinGateway",t.PUBLISH="io.agora.pb.Wrtc.Publish",t.SUBSCRIBE="io.agora.pb.Wrtc.Subscribe",t.WS_COMPRESSOR_INIT="io.agora.pb.Wrtc.WsCompressorInit",t.STREAM_SWITCH="io.agora.pb.Wrtc.StreamSwitch",t.AUDIO_SENDING_STOPPED="io.agora.pb.Wrtc.AudioSendingStopped",t.VIDEO_SENDING_STOPPED="io.agora.pb.Wrtc.VideoSendingStopped",t.REQUEST_PROXY_APPCENTER="io.agora.pb.Wrtc.RequestProxyAppCenter",t.REQUEST_PROXY_WORKER_MANAGER="io.agora.pb.Wrtc.RequestProxyWorkerManager",t.API_INVOKE="io.agora.pb.Wrtc.ApiInvoke",t.FIRST_VIDEO_RECEIVED="io.agora.pb.Wrtc.FirstVideoReceived",t.FIRST_AUDIO_RECEIVED="io.agora.pb.Wrtc.FirstAudioReceived",t.FIRST_VIDEO_DECODE="io.agora.pb.Wrtc.FirstVideoDecode",t.FIRST_AUDIO_DECODE="io.agora.pb.Wrtc.FirstAudioDecode",t.ON_ADD_AUDIO_STREAM="io.agora.pb.Wrtc.OnAddAudioStream",t.ON_ADD_VIDEO_STREAM="io.agora.pb.Wrtc.OnAddVideoStream",t.ON_UPDATE_STREAM="io.agora.pb.Wrtc.OnUpdateStream",t.ON_REMOVE_STREAM="io.agora.pb.Wrtc.OnRemoveStream",t.JOIN_CHANNEL_TIMEOUT="io.agora.pb.Wrtc.JoinChannelTimeout",t.PEER_PUBLISH_STATUS="io.agora.pb.Wrtc.PeerPublishStatus",t.WORKER_EVENT="io.agora.pb.Wrtc.WorkerEvent",t.AP_WORKER_EVENT="io.agora.pb.Wrtc.APWorkerEvent",t.JOIN_WEB_PROXY_AP="io.agora.pb.Wrtc.JoinWebProxyAP",t.WEBSOCKET_QUIT="io.agora.pb.Wrtc.WebSocketQuit",t.USER_ANALYTICS="io.agora.pb.Wrtc.UserAnalytics",t.AUTOPLAY_FAILED="io.agora.pb.Wrtc.AutoplayFailed",t.PC_STATS="io.agora.pb.Wrtc.PCStats",t.UPDATE_REMOTE_RTPCAPABILITIES="io.agora.pb.Wrtc.UpdateRemoteRTPCapabilities",t.AB_TEST="io.agora.pb.Wrtc.ABTest",t}({});(function(t){t[t.WORKER_EVENT=156]="WORKER_EVENT",t[t.AP_WORKER_EVENT=160]="AP_WORKER_EVENT"})({});let Cme=function(t){return t[t.SESSION=26]="SESSION",t[t.JOIN_CHOOSE_SERVER=27]="JOIN_CHOOSE_SERVER",t[t.REQ_USER_ACCOUNT=196]="REQ_USER_ACCOUNT",t[t.JOIN_GATEWAY=28]="JOIN_GATEWAY",t[t.PUBLISH=30]="PUBLISH",t[t.SUBSCRIBE=29]="SUBSCRIBE",t[t.WS_COMPRESSOR_INIT=9430]="WS_COMPRESSOR_INIT",t[t.STREAM_SWITCH=32]="STREAM_SWITCH",t[t.AUDIO_SENDING_STOPPED=33]="AUDIO_SENDING_STOPPED",t[t.VIDEO_SENDING_STOPPED=34]="VIDEO_SENDING_STOPPED",t[t.REQUEST_PROXY_APPCENTER=35]="REQUEST_PROXY_APPCENTER",t[t.REQUEST_PROXY_WORKER_MANAGER=36]="REQUEST_PROXY_WORKER_MANAGER",t[t.API_INVOKE=41]="API_INVOKE",t[t.FIRST_VIDEO_RECEIVED=348]="FIRST_VIDEO_RECEIVED",t[t.FIRST_AUDIO_RECEIVED=349]="FIRST_AUDIO_RECEIVED",t[t.FIRST_VIDEO_DECODE=350]="FIRST_VIDEO_DECODE",t[t.FIRST_AUDIO_DECODE=351]="FIRST_AUDIO_DECODE",t[t.ON_ADD_AUDIO_STREAM=352]="ON_ADD_AUDIO_STREAM",t[t.ON_ADD_VIDEO_STREAM=353]="ON_ADD_VIDEO_STREAM",t[t.ON_UPDATE_STREAM=356]="ON_UPDATE_STREAM",t[t.ON_REMOVE_STREAM=355]="ON_REMOVE_STREAM",t[t.JOIN_CHANNEL_TIMEOUT=407]="JOIN_CHANNEL_TIMEOUT",t[t.PEER_PUBLISH_STATUS=408]="PEER_PUBLISH_STATUS",t[t.WORKER_EVENT=156]="WORKER_EVENT",t[t.AP_WORKER_EVENT=160]="AP_WORKER_EVENT",t[t.JOIN_WEB_PROXY_AP=700]="JOIN_WEB_PROXY_AP",t[t.WEBSOCKET_QUIT=671]="WEBSOCKET_QUIT",t[t.USER_ANALYTICS=1e4]="USER_ANALYTICS",t[t.AUTOPLAY_FAILED=9178]="AUTOPLAY_FAILED",t}({});function Ht(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return function(r,s,a){const c=a.value;if(typeof c=="function"){const d=t.className||r.__className__||(r.constructor.name==="AgoraRTCClient"?"Client":r.constructor.name);a.value=function(){for(var h,m=arguments.length,y=new Array(m),v=0;v<m;v++)y[v]=arguments[v];let w=y;if(t.argsMap)try{w=t.argsMap(this,...y)}catch(O){x.warning(O),w=[]}try{JSON.stringify(w)}catch{x.warning("arguments for method ".concat(d,".").concat(String(s)," not serializable for apiInvoke.")),w=[]}const R=(t.report||Nt).reportApiInvoke(this._sessionId||null,{id:this._clientId||((h=this.store)===null||h===void 0?void 0:h.clientId)||this._ID,name:"".concat(d,".").concat(String(s)),options:w,tag:Kr.TRACER,reportResult:t.reportResult},t.throttleTime);try{const O=c.apply(this,y);return O instanceof pt?O.then(D=>(R.onSuccess(t.reportResult&&D),D)).catch(D=>{throw R.onError(D),D}):(R.onSuccess(t.reportResult&&O),O)}catch(O){throw R.onError(O),O}}}return a}}const Nt=new class{constructor(){Yr(this,"baseInfoMap",new Map),Yr(this,"proxyServer",void 0),Yr(this,"eventUploadTimer",void 0),Yr(this,"setSessionIdTimer",void 0),Yr(this,"url",void 0),Yr(this,"sids",new Set),Yr(this,"backupUrl",void 0),Yr(this,"_appId",void 0),Yr(this,"_aid",0),Yr(this,"keyEventUploadPendingItems",[]),Yr(this,"normalEventUploadPendingItems",[]),Yr(this,"apiInvokeUploadPendingItems",[]),Yr(this,"apiInvokeCount",0),Yr(this,"apiInvokeLoggedCount",0),Yr(this,"ltsList",[]),Yr(this,"lastSendNormalEventTime",Date.now()),Yr(this,"customReportCounterTimer",void 0),Yr(this,"customReportCount",0),Yr(this,"extApiInvoke",async t=>{for(const r of t){const s=dn(dn({},r),{},{sid:null,invokeId:++this.apiInvokeCount,tag:Kr.TRACER});this.sendApiInvoke(s)}}),this.eventUploadTimer=window.setInterval(this.doSend.bind(this),oe("EVENT_REPORT_SEND_INTERVAL")),this.setSessionIdTimer=window.setInterval(this.appendSessionId.bind(this),oe("EVENT_REPORT_SEND_INTERVAL"))}getBaseInfoBySessionId(t){return this.baseInfoMap.get(t)}setAppId(t){this._appId=t,this._aid=parseInt(t.replace(/[a-fA-F0-9]{8}/g,r=>{let[s,a]=r;return s+a}),16)||0}reportApiInvoke(t,r,s){r.timeout=r.timeout||6e4,r.reportResult=r.reportResult===void 0||r.reportResult;const a=Date.now();this.apiInvokeCount+=1;const c=this.apiInvokeCount,d=!!oe("SHOW_REPORT_INVOKER_LOG"),h=!!oe("SHOW_REPORT_USER_INVOKER_LOG"),m=d||h&&r.id;m&&(this.apiInvokeLoggedCount+=1);const y=this.apiInvokeLoggedCount;function v(D,G){if(m){let j="[apiInvoke-".concat(y,"]");r.id&&(j+="[".concat(r.id,"]")),r.name&&(j+="[".concat(r.name,"]")),x.info("".concat(j," ").concat(D),D==="start"?r.options:G||"")}}const w=()=>({tag:r.tag,invokeId:c,sid:t,name:r.name,apiInvokeTime:a,options:r.options,states:r.states||null});v("start");let R=!1;ys(r.timeout).then(()=>{R||(this.sendApiInvoke(dn(dn({},w()),{},{error:te.API_INVOKE_TIMEOUT,success:!1})),v("timeout"))});const O=new Le(te.UNEXPECTED_ERROR,"".concat(r.name,": this api invoke is end"));return{onSuccess:D=>{const G=()=>{if(R)throw O;return R=!0,this.sendApiInvoke(dn(dn({},w()),{},{success:!0},r.reportResult&&{result:D})),v("onSuccess"),D};return s?Kz(G,r.name+"Success",s,()=>R=!0):G()},onError:D=>{const G=()=>{if(R)throw D;R=!0,this.sendApiInvoke(dn(dn({},w()),{},{success:!1,error:D})),v("onFailure",D.toString())};return s?Kz(G,r.name+"Error",s,()=>R=!0):G()}}}sessionInit(t,r){if(this.baseInfoMap.has(t))return;const s=Date.now(),a=this.createBaseInfo(t,s);a.cname=r.cname;const c=Object.assign({},{willUploadConsoleLog:oe("UPLOAD_LOG"),maxTouchPoints:navigator.maxTouchPoints,areaVersion:ML?"global":"oversea",areas:oe("AREAS")&&oe("AREAS").join(",")},r.extend),{stringUid:d,channelProfile:h,channelMode:m,isABTestSuccess:y,lsid:v,clientRole:w}=r,R=Date.now(),O=dn(dn({},a),{},{eventType:Zi.SESSION_INIT,appid:r.appid,browser:navigator.userAgent,buildFormat:r.buildFormat,build:VL,lts:R,elapse:R-s,extend:JSON.stringify(c),mode:r.mode,process:oe("PROCESS_ID"),appType:oe("APP_TYPE"),success:!0,version:Ml,stringUid:d,channelProfile:h,channelMode:m,isABTestSuccess:y,lsid:v,clientType:lt(D=window.navigator.userAgent).call(D,"AgoraWebView")?42:20,clientRole:w,serviceId:oe("PROCESS_ID"),extensionID:oe("PLUGIN_INFO").join(",")||""});var D;this.send({type:Mr.SESSION,data:O},!0)}joinChooseServer(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const a=s.info,c=Date.now(),d=dn(dn({},a),{},{role:r.role,eventType:Zi.JOIN_CHOOSE_SERVER,lts:c,eventElapse:r.elapse||c-r.lts,chooseServerAddr:r.csAddr,errorCode:r.ec,elapse:c-s.startTime,success:r.succ,chooseServerAddrList:JSON.stringify(r.serverList),uid:r.uid?parseInt(r.uid):null,cid:r.cid?parseInt(r.cid):null,chooseServerIp:r.csIp||"",opid:r.opid,unilbsServerIds:r.unilbsServerIds,extend:r.extend||void 0,isHttp3:r.isHttp3,corssRegionTagReq:r.corssRegionTagReq||void 0,corssRegionTagRes:r.corssRegionTagRes||void 0});this.send({type:Mr.JOIN_CHOOSE_SERVER,data:d},!0)}reqUserAccount(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const a=s.info,c=Date.now(),d=dn(dn({},a),{},{eventType:Zi.REQ_USER_ACCOUNT,lts:c,success:r.success,serverAddress:r.serverAddr,stringUid:r.stringUid,uid:r.uid,errorCode:r.errorCode,elapse:r.elapse||c-s.startTime,eventElapse:c-r.lts,extend:JSON.stringify(r.extend)});this.send({type:Mr.REQ_USER_ACCOUNT,data:d},!0)}joinGateway(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const a=s.info;r.vid&&(a.vid=r.vid),a.uid=r.uid,a.cid=r.cid;const c=Date.now(),{firstSuccess:d,avoidJoinStartTime:h,addr:m,isProxy:y}=r,v=c-(d&&h?h:s.startTime),w=dn(dn({},a),{},{eventType:Zi.JOIN_GATEWAY,lts:c,gatewayAddr:r.addr,success:r.succ,errorCode:r.ec,errorMsg:r.errorMsg||"",elapse:v,eventElapse:c-r.lts,firstSuccess:d,signalChannel:r.signalChannel,preload:r.preload?1:0,installId:LL(),isABTestSuccess:r.isABTestSuccess?1:0}),R=w.success?1:0;if(r.succ&&(s.lastJoinSuccessTime=c),d)this.send({type:Mr.JOIN_GATEWAY,data:w},!0);else{let O;if(m)if(y){const G=m.match(/h=(\d{1,3}-){3}\d{1,3}/g),j=m.match(/p=[0-9]{1,6}/g);O={isSuccess:R,gatewayIp:G&&G.length?G[0].split("=")[1].replace(/-/g,"."):"",port:j&&j.length?j[0].split("=")[1]:"",isProxy:y?1:0}}else{const G=m.match(/wss:\/\/(\d{1,3}-){3}\d{1,3}/g),j=m.match(/(:|p=)[0-9]{1,6}/g);O={isSuccess:R,gatewayIp:G&&G.length?G[0].split("//")[1].replace(/-/g,"."):"",port:j&&j.length?j[0].split(/:|p=/g)[1]:"",isProxy:y?1:0}}else O={isSuccess:R,gatewayIp:"",port:"",isProxy:y?1:0};delete w.success,delete w.eventType,delete w.firstSuccess,w.vid=Number(w.vid);const D=Object.assign({},w,O,{eventType:Zi.REJOIN_GATEWAY});this.send({type:Mr.RE_JOIN_GATEWAY,data:D},!0)}}joinChannelTimeout(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const a=Date.now(),c=dn(dn({},s.info),{},{lts:a,timeout:r,elapse:a-s.startTime});this.send({type:Mr.JOIN_CHANNEL_TIMEOUT,data:c},!0)}publish(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const a=s.info,c=Date.now(),d=dn(dn({},a),{},{eventType:Zi.PUBLISH,lts:c,eventElapse:r.eventElapse,elapse:c-s.startTime,success:r.succ,errorCode:r.ec,videoName:r.videoName,audioName:r.audioName,screenName:r.screenName,screenshare:r.screenshare,audio:r.audio,video:r.video,p2pid:r.p2pid,publishRequestid:r.publishRequestid});this.send({type:Mr.PUBLISH,data:d},!0)}subscribe(t,r,s){const a=this.baseInfoMap.get(t);if(!a)return;const c=a.info,d=Date.now(),h=dn(dn({},c),{},{eventType:Zi.SUBSCRIBE,lts:d,eventElapse:r.eventElapse,elapse:d-a.startTime,success:r.succ,errorCode:r.ec,video:r.video,audio:r.audio,subscribeRequestid:r.subscribeRequestid,p2pid:r.p2pid,preSsrc:r.preSsrc?1:0},s&&{extend:JSON.stringify({isMassSubscribe:!0})});typeof r.peerid=="string"?h.peerSuid=r.peerid:h.peer=r.peerid,this.send({type:Mr.SUBSCRIBE,data:h},!0)}wsCompressorInit(t){var r;const s=[...tl(r=this.baseInfoMap).call(r)],a=s.length?s[0]:"UnableToGetSid",c=this.baseInfoMap.get(a);if(!c)return;const d=c.info,h=Date.now(),m=dn(dn({},d),{},{eventType:Zi.WS_COMPRESSOR_INIT,lts:h,eventElapse:t.eventElapse,elapse:h-c.startTime,status:t.status?1:2});this.send({type:Mr.WS_COMPRESSOR_INIT,data:m},!0)}firstRemoteVideoDecode(t,r,s,a){const c=this.baseInfoMap.get(t);if(!c)return;const d=c.info,h=Date.now(),m=dn(dn(dn({},d),a),{},{elapse:h-c.startTime,eventType:r,lts:h,firstDecodeFrame:Math.max((a.firstFrame||h)-c.startTime,0),apEnd:Math.max(a.apEnd-c.startTime,0),apStart:Math.max(a.apStart-c.startTime,0),joinGwEnd:Math.max(a.joinGwEnd-c.startTime,0),joinGwStart:Math.max(a.joinGwStart-c.startTime,0),pcEnd:Math.max(a.pcEnd-c.startTime,0),pcStart:Math.max(a.pcStart-c.startTime,0),subscriberEnd:Math.max(a.subscriberEnd-c.startTime,0),subscriberStart:Math.max(a.subscriberStart-c.startTime,0),videoAddNotify:Math.max(a.videoAddNotify-c.startTime,0)});this.send({type:s,data:m},!0)}firstRemoteFrame(t,r,s,a){const c=this.baseInfoMap.get(t);if(!c)return;const d=c.info,h=Date.now(),m=dn(dn(dn({},d),a),{},{elapse:h-c.startTime,eventType:r,lts:h});this.send({type:s,data:m},!0)}abTest(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const a=s.info,c=Date.now(),d=dn(dn(dn({},a),r),{},{vid:a.vid===void 0?0:Number(a.vid),elapse:c-s.startTime,eventType:Zi.AB_TEST,lts:c});this.send({type:Mr.AB_TEST,data:d},!0)}pcStats(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const a=s.info,c=Date.now(),d=dn(dn(dn({},a),r),{},{vid:a.vid===void 0?0:Number(a.vid),elapse:c-s.startTime,eventType:Zi.PC_STATS,lts:c,preallocation:r.preallocation?1:0});this.send({type:Mr.PC_STATS,data:d},!0)}updateRemoteRTPCapabilities(t,r){if(t){const s=this.baseInfoMap.get(t);if(!s)return;const a=s.info,c=Date.now(),d=dn(dn(dn({},a),r),{},{vid:a.vid===void 0?0:Number(a.vid),eventType:Zi.UPDATE_REMOTE_RTPCAPABILITIES,lts:c});this.send({type:Mr.UPDATE_REMOTE_RTPCAPABILITIES,data:d},!0)}}onGatewayStream(t,r,s,a){const c=this.baseInfoMap.get(t);if(!c)return;const d=c.info,h=Date.now(),m=dn(dn(dn({},d),a),{},{eventType:r,lts:h});this.send({type:s,data:m},!0)}streamSwitch(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const a=s.info,c=Date.now(),d=dn(dn({},a),{},{eventType:Zi.STREAM_SWITCH,lts:c,isDual:r.isdual,elapse:c-s.startTime,success:r.succ});this.send({type:Mr.STREAM_SWITCH,data:d},!0)}requestProxyAppCenter(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const a=s.info,c=Date.now(),d=dn(dn({},a),{},{eventType:Zi.REQUEST_PROXY_APPCENTER,lts:c,eventElapse:c-r.lts,elapse:c-s.startTime,APAddr:r.APAddr,workerManagerList:r.workerManagerList,response:r.response,errorCode:r.ec,success:r.succ});this.send({type:Mr.REQUEST_PROXY_APPCENTER,data:d},!0)}requestProxyWorkerManager(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const a=s.info,c=Date.now(),d=dn(dn({},a),{},{eventType:Zi.REQUEST_PROXY_WORKER_MANAGER,lts:c,eventElapse:c-r.lts,elapse:c-s.startTime,workerManagerAddr:r.workerManagerAddr,response:r.response,errorCode:r.ec,success:r.succ});this.send({type:Mr.REQUEST_PROXY_WORKER_MANAGER,data:d},!0)}setProxyServer(t){this.proxyServer=t,t?x.debug("reportProxyServerurl: ".concat(t)):x.debug("disable reportProxyServerurl: ".concat(t))}peerPublishStatus(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const a=s.info,c=Date.now(),d=dn(dn({},a),{},{subscribeElapse:r.subscribeElapse,peer:r.peer,peerPublishDuration:Math.max(r.audioPublishDuration,r.videoPublishDuration),audiotag:r.audioPublishDuration>0?1:-1,videotag:r.videoPublishDuration>0?1:-1,lts:c,elapse:c-s.startTime,joinChannelSuccessElapse:c-(s.lastJoinSuccessTime||c),peerPublishDurationVideo:r.videoPublishDuration,peerPublishDurationAudio:r.audioPublishDuration});this.send({type:Mr.PEER_PUBLISH_STATUS,data:d},!0)}workerEvent(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const a=s.info,c=Date.now();(function(d,h,m){const y=d[h];if(!y||typeof y!="string")return[d];d[h]="";const v=kh(JSON.stringify(d));let w=0;const R=[];let O=0;for(let D=0;D<y.length;D++)O+=y.charCodeAt(D)<=127?1:3,O<=m-v||(R[R.length]=St(St({},d),{},{[h]:y.substring(w,D)}),w=D,O=y.charCodeAt(D)<=127?1:3);return w!==y.length-1&&(R[R.length]=St(St({},d),{},{[h]:y.substring(w)})),R})(dn(dn(dn({},a),r),{},{elapse:c-s.startTime,lts:c,productType:"WebRTC"}),"payload",1300).forEach(d=>this.send({type:Mr.WORKER_EVENT,data:d},!0))}apworkerEvent(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const a=s.info,c=Date.now(),d=dn(dn(dn({},a),r),{},{elapse:c-s.startTime,lts:c});this.send({type:Mr.AP_WORKER_EVENT,data:d},!0)}joinWebProxyAP(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const a=s.info,c=Date.now(),d=dn(dn(dn({},a),r),{},{elapse:c-s.startTime,lts:c,extend:r.extend||void 0});this.send({type:Mr.JOIN_WEB_PROXY_AP,data:d},!0)}WebSocketQuit(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const a=s.info,c=Date.now(),d=dn(dn(dn({},a),r),{},{elapse:c-s.startTime,lts:c});this.send({type:Mr.WEBSOCKET_QUIT,data:d},!0)}async sendCustomReportMessage(t,r){if(this.customReportCount+=r.length,this.customReportCount>oe("CUSTOM_REPORT_LIMIT"))throw new Le(te.CUSTOM_REPORT_FREQUENCY_TOO_HIGH);this.customReportCounterTimer||(this.customReportCounterTimer=window.setInterval(()=>{this.customReportCount=0},5e3));const s=Date.now(),a=r.map(c=>({type:Mr.USER_ANALYTICS,data:dn(dn({sid:t},c),{},{lts:s})}));try{oe("NEW_REPORT_SERVER")?await this.postDataToStatsCollector2(a):await this.postDataToStatsCollector(a)}catch(c){throw x.error("send custom report message failed",c.toString()),new Le(te.CUSTOM_REPORT_SEND_FAILED,c.message)}}sendApiInvoke(t){const r=oe("NOT_REPORT_EVENT");if(t.tag&&lt(r)&&lt(r).call(r,t.tag))return!1;if(t.sid===null)return this.apiInvokeUploadPendingItems.push(t),!1;const s=this.baseInfoMap.get(t.sid);if(!s)return this.apiInvokeUploadPendingItems.push(t),!1;const{cname:a,uid:c,cid:d}=s.info;let h;if(t.lts=t.lts||Date.now(),t.error)if(t.error instanceof Le){const{code:y,message:v}=t.error;h=y||v||t.error.toString()}else h=t.error.toString();const m={invokeId:t.invokeId,sid:t.sid,cname:a,cid:d,uid:c,lts:t.lts,success:t.success,elapse:t.lts-s.startTime,execElapse:t.lts-t.apiInvokeTime,apiName:t.name,options:t.options?JSON.stringify(t.options):void 0,execStates:t.states?JSON.stringify(t.states):void 0,execResult:t.result?JSON.stringify(t.result):void 0,errorCode:t.error?h:void 0,errorMsg:t.error?JSON.stringify(t.error):void 0};return this.send({type:Mr.API_INVOKE,data:m},!1),!0}addSid(t){this.sids.add(t)}removeSid(t){this.sids.delete(t)}appendSessionId(){const t=this.apiInvokeUploadPendingItems;if(t.length===0)return;const r=Array.from(this.sids).find(s=>s!==null);r&&t.forEach(s=>{s&&(s.sid=r,this.sendApiInvoke(Object.assign({},s)))}),t.length=0}send(t,r){if(r)return this.keyEventUploadPendingItems.push(t),void this.sendItems(this.keyEventUploadPendingItems,!0);this.normalEventUploadPendingItems.push(t),this.normalEventUploadPendingItems.length>oe("NORMAL_EVENT_QUEUE_CAPACITY")&&this.normalEventUploadPendingItems.splice(0,1),this.normalEventUploadPendingItems.length>=10&&this.sendItems(this.normalEventUploadPendingItems,!1)}doSend(){this.keyEventUploadPendingItems.length>0&&this.sendItems(this.keyEventUploadPendingItems,!0),this.normalEventUploadPendingItems.length>0&&Date.now()-this.lastSendNormalEventTime>=5e3&&this.sendItems(this.normalEventUploadPendingItems,!1)}sendItems(t,r){const s=[],a=[];for(;t.length;){const d=t.shift();s.length<20?s.push(d):a.push(d)}t.push(...a);for(const d of[...s]){var c;this.ltsList.indexOf(d.data.lts)!==-1?(d.data.lts=this.ltsList[this.ltsList.length-1]+1,this.ltsList.push(d.data.lts)):(this.ltsList.push(d.data.lts),Ew(c=this.ltsList).call(c,(h,m)=>h-m))}return r||(this.lastSendNormalEventTime=Date.now()),oe("ENABLE_EVENT_REPORT")&&s.length&&(oe("NEW_REPORT_SERVER")?this.postDataToStatsCollector2(s):this.postDataToStatsCollector(s)).catch((d=>h=>{oe("EVENT_REPORT_RETRY")&&(r?this.keyEventUploadPendingItems=this.keyEventUploadPendingItems.concat(d):(this.normalEventUploadPendingItems=this.normalEventUploadPendingItems.concat(d),this.normalEventUploadPendingItems.length>oe("NORMAL_EVENT_QUEUE_CAPACITY")&&(this.normalEventUploadPendingItems.splice(0,this.normalEventUploadPendingItems.length-oe("NORMAL_EVENT_QUEUE_CAPACITY")),x.warning("report: drop normal events"))))})(s)),t}async postDataToStatsCollector2(t){Si.networkState===Rc.OFFLINE&&await pt.race([Si.onlineWaiter,ys(2*Di.maxRetryTimeout)]);const r=c=>{let d=new Uint8Array;return c.forEach(h=>{const m=wL(JSON.stringify(h.data)),y=new ArrayBuffer(5),v=(R=>{let O=0;return Object.entries(Mr).forEach(D=>{let[G,j]=D;j===R.type&&(O=Cme[G])}),O})(h),w=new DataView(y);w.setUint16(0,m.byteLength,!0),w.setUint8(2,255&v),w.setUint8(3,v>>>8&255),w.setUint8(4,v>>>16&255),d=Vz(d,new Uint8Array(y)),d=Vz(d,m)}),d},s="event";let a=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(oe("NEW_REPORT_SERVER_DOMAINS")[0],"&p=443&d=").concat(s):"https://".concat(oe("NEW_REPORT_SERVER_DOMAINS")[0],"/").concat(s);for(let c=0;c<2;c+=1){c===1&&(a=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(oe("NEW_REPORT_SERVER_DOMAINS")[1],"&p=443&d=").concat(s):"https://".concat(oe("NEW_REPORT_SERVER_DOMAINS")[1],"/").concat(s));try{await OL(a,{timeout:1e4,data:r(t),headers:dn(dn({biz:"webrtc",sendts:Math.round(Date.now()/1e3),debug:"false"},this._appId&&{appid:this._appId}),{},{"Content-Type":"application/octet-stream"})},!0)}catch(d){if(c===1)throw d;continue}return}}async postDataToStatsCollector(t){let r=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const s=(m=>{const y=m&&m.data.sid&&this.baseInfoMap.get(m.data.sid);return y&&y.info.vid&&+y.info.vid||0})(t[0]),a=s?void 0:this._aid,c={msgType:"EventMessages",sentTs:Math.round(Date.now()/1e3),payloads:t.map(m=>JSON.stringify(m)),vid:s,aid:a};Si.networkState===Rc.OFFLINE&&await pt.race([Si.onlineWaiter,ys(2*Di.maxRetryTimeout)]);const d=r?"/events/proto-raws":"/events/messages";let h=this.url||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(oe("EVENT_REPORT_DOMAIN"),"&p=").concat(oe("STATS_COLLECTOR_PORT"),"&d=").concat(d):"https://".concat(oe("EVENT_REPORT_DOMAIN"),":").concat(oe("STATS_COLLECTOR_PORT")).concat(d));for(let m=0;m<2;m+=1){m===1&&(h=this.backupUrl||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(oe("EVENT_REPORT_BACKUP_DOMAIN"),"&p=").concat(oe("STATS_COLLECTOR_PORT"),"&d=").concat(d):"https://".concat(oe("EVENT_REPORT_BACKUP_DOMAIN"),":").concat(oe("STATS_COLLECTOR_PORT")).concat(d)));try{r?await ume(h,{timeout:1e4,data:c}):await OL(h,{timeout:1e4,data:c})}catch(y){if(m===1)throw y;continue}return}}createBaseInfo(t,r){const s=Object.assign({},Tme);return s.sid=t,this.baseInfoMap.set(t,{info:s,startTime:r}),s}reportResourceTiming(t,r){const s=performance.getEntriesByName(t),a=s[s.length-1];a&&this.reportApiInvoke(r,{name:"Client.resourceTiming",options:a,tag:Kr.TRACER}).onSuccess()}};h8.on("REPORT_LOG_UPLOAD",t=>{t.networkState=Si.networkState,Nt.reportApiInvoke(null,{name:"logUploadError",options:t,tag:Kr.TRACER}).onSuccess("logUploadError")});class Ae extends Le{constructor(r){super(r,arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",arguments.length>2?arguments[2]:void 0),Yr(this,"name","AgoraRTCException")}print(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error";return super.print(r,x)}throw(){super.throw(x)}}const Es={getDisplayMedia:!1,getStreamFromExtension:!1,supportUnifiedPlan:!1,supportMinBitrate:!1,supportSetRtpSenderParameters:!1,supportDualStream:!0,webAudioMediaStreamDest:!1,supportReplaceTrack:!1,supportWebGL:!1,webAudioWithAEC:!1,supportRequestFrame:!1,supportShareAudio:!1,supportDualStreamEncoding:!1,supportDataChannel:!1,supportPCSetConfiguration:!1,supportWebRTCEncodedTransform:!1,supportWebRTCInsertableStream:!1,supportRequestVideoFrameCallback:!1,supportWebCrypto:!1};function Wn(){return Es}function m8(){return"setSinkId"in HTMLAudioElement.prototype&&(!oe("RESTRICTION_SET_PLAYBACK_DEVICE")||(hf()||Rz())&&!vL())}function g8(){return!Es.supportUnifiedPlan||oe("CHROME_FORCE_PLAN_B")&&pf()}let vs=function(t){return t.IOS_15_16_INTERRUPTION_START="ios15_16-interruption-start",t.IOS_15_16_INTERRUPTION_END="ios15_16-interruption-end",t.IOS_INTERRUPTION_START="ios-interruption-start",t.IOS_INTERRUPTION_END="ios-interruption-end",t.STATE_CHANGE="state-change",t}({});function Zv(t,r,s){return{sampleRate:t,stereo:r,bitrate:s}}function Mn(t,r,s,a,c){return{width:t,height:r,frameRate:s,bitrateMin:a,bitrateMax:c}}function ku(t,r,s,a,c){return{width:{max:t},height:{max:r},frameRate:s,bitrateMin:a,bitrateMax:c}}function WL(t,r){return{numSpatialLayers:t,numTemporalLayers:r}}const Rme={"90p":Mn(160,90),"90p_1":Mn(160,90),"120p":Mn(160,120,15,30,65),"120p_1":Mn(160,120,15,30,65),"120p_3":Mn(120,120,15,30,50),"120p_4":Mn(212,120),"180p":Mn(320,180,15,30,140),"180p_1":Mn(320,180,15,30,140),"180p_3":Mn(180,180,15,30,100),"180p_4":Mn(240,180,15,30,120),"240p":Mn(320,240,15,40,200),"240p_1":Mn(320,240,15,40,200),"240p_3":Mn(240,240,15,40,140),"240p_4":Mn(424,240,15,40,220),"360p":Mn(640,360,15,80,400),"360p_1":Mn(640,360,15,80,400),"360p_3":Mn(360,360,15,80,260),"360p_4":Mn(640,360,30,80,600),"360p_6":Mn(360,360,30,80,400),"360p_7":Mn(480,360,15,80,320),"360p_8":Mn(480,360,30,80,490),"360p_9":Mn(640,360,15,80,800),"360p_10":Mn(640,360,24,80,800),"360p_11":Mn(640,360,24,80,1e3),"480p":Mn(640,480,15,100,500),"480p_1":Mn(640,480,15,100,500),"480p_2":Mn(640,480,30,100,1e3),"480p_3":Mn(480,480,15,100,400),"480p_4":Mn(640,480,30,100,750),"480p_6":Mn(480,480,30,100,600),"480p_8":Mn(848,480,15,100,610),"480p_9":Mn(848,480,30,100,930),"480p_10":Mn(640,480,10,100,400),"720p":Mn(1280,720,15,120,1130),"720p_auto":Mn(1280,720,30,900,3e3),"720p_1":Mn(1280,720,15,120,1130),"720p_2":Mn(1280,720,30,120,2e3),"720p_3":Mn(1280,720,30,120,1710),"720p_5":Mn(960,720,15,120,910),"720p_6":Mn(960,720,30,120,1380),"1080p":Mn(1920,1080,15,120,2080),"1080p_1":Mn(1920,1080,15,120,2080),"1080p_2":Mn(1920,1080,30,120,3e3),"1080p_3":Mn(1920,1080,30,120,3150),"1080p_5":Mn(1920,1080,60,120,4780),"1440p":Mn(2560,1440,30,120,4850),"1440p_1":Mn(2560,1440,30,120,4850),"1440p_2":Mn(2560,1440,60,120,7350),"4k":Mn(3840,2160,30,120,8910),"4k_1":Mn(3840,2160,30,120,8910),"4k_3":Mn(3840,2160,60,120,13500)},Ime={"480p":ku(640,480,5),"480p_1":ku(640,480,5),"480p_2":ku(640,480,30),"480p_3":ku(640,480,15),"720p":ku(1280,720,5),"720p_auto":Mn(1280,720,30,900,3e3),"720p_1":ku(1280,720,5),"720p_2":ku(1280,720,30),"720p_3":ku(1280,720,15),"1080p":ku(1920,1080,5),"1080p_1":ku(1920,1080,5),"1080p_2":ku(1920,1080,30),"1080p_3":ku(1920,1080,15)},Ame={"1SL1TL":WL(1,1),"3SL3TL":WL(3,3),"2SL3TL":WL(2,3)};function Dh(t){return t||(t="480p_1"),typeof t=="string"?Object.assign({},Rme[t]):t}function zL(t){return typeof t=="string"?Object.assign({},Ime[t]):t}function pP(t){return typeof t=="string"?Object.assign({},Ame[t]):t}const Pme={speech_low_quality:Zv(16e3,!1),speech_standard:Zv(32e3,!1,18),music_standard:Zv(48e3,!1),standard_stereo:Zv(48e3,!0,56),high_quality:Zv(48e3,!1,128),high_quality_stereo:Zv(48e3,!0,192)};function fP(t){return typeof t=="string"?Object.assign({},Pme[t]):t}const eS=[];function _8(t){return $i(t,"mediaSource",["screen","window","application"]),!0}let It=function(t){return t.NEED_RENEGOTIATE="@need_renegotiate",t.NEED_REPLACE_TRACK="@need_replace_track",t.NEED_REPLACE_MIXING_TRACK="@need_replace_mixing_track",t.NEED_CLOSE="@need_close",t.NEED_ENABLE_TRACK="@need_enable_track",t.NEED_DISABLE_TRACK="@need_disable_track",t.NEED_SESSION_ID="@need_sid",t.SET_OPTIMIZATION_MODE="@set_optimization_mode",t.GET_STATS="@get_stats",t.GET_RTC_STATS="@get_rtc_stats",t.GET_LOW_VIDEO_TRACK="@get_low_video_track",t.NEED_RESET_REMOTE_SDP="@need_reset_remote_sdp",t.NEED_UPDATE_VIDEO_ENCODER="@need_update_video_encoder",t.NEED_UPDATE_VIDEO_SEND_PARAMETERS="@need_update_video_send_parameters",t.NEED_MUTE_TRACK="@need_mute_track",t.NEED_UNMUTE_TRACK="@need_unmute_track",t}({}),gr=function(t){return t.SCREEN_TRACK="screen_track",t.CUSTOM_TRACK="custome_track",t.LOW_STREAM="low_stream",t.SCREEN_LOW_TRACK="screen_low_track",t}({}),tS=function(t){return t[t.HIGH_STREAM=0]="HIGH_STREAM",t[t.LOW_STREAM=1]="LOW_STREAM",t}({}),Ome=function(t){return t[t.HIGH_STREAM=0]="HIGH_STREAM",t[t.LOW_STREAM=1]="LOW_STREAM",t[t.HIGH_STREAM_LAYER1=4]="HIGH_STREAM_LAYER1",t[t.HIGH_STREAM_LAYER2=5]="HIGH_STREAM_LAYER2",t[t.HIGH_STREAM_LAYER3=6]="HIGH_STREAM_LAYER3",t[t.HIGH_STREAM_LAYER4=7]="HIGH_STREAM_LAYER4",t[t.HIGH_STREAM_LAYER5=8]="HIGH_STREAM_LAYER5",t[t.HIGH_STREAM_LAYER6=9]="HIGH_STREAM_LAYER6",t}({}),kme=function(t){return t[t.DISABLE=0]="DISABLE",t[t.LOW_STREAM=1]="LOW_STREAM",t[t.AUDIO_ONLY=2]="AUDIO_ONLY",t[t.HIGH_STREAM_LAYER1=3]="HIGH_STREAM_LAYER1",t[t.HIGH_STREAM_LAYER2=4]="HIGH_STREAM_LAYER2",t[t.HIGH_STREAM_LAYER3=5]="HIGH_STREAM_LAYER3",t[t.HIGH_STREAM_LAYER4=6]="HIGH_STREAM_LAYER4",t[t.HIGH_STREAM_LAYER5=7]="HIGH_STREAM_LAYER5",t[t.HIGH_STREAM_LAYER6=8]="HIGH_STREAM_LAYER6",t}({}),Z_=function(t){return t.TRANSCEIVER_UPDATED="transceiver-updated",t.SEI_TO_SEND="sei-to-send",t.SEI_RECEIVED="sei-received",t.TRACK_UPDATED="track-updated",t}({}),nS=function(t){return t.SOURCE_STATE_CHANGE="source-state-change",t.TRACK_ENDED="track-ended",t.BEAUTY_EFFECT_OVERLOAD="beauty-effect-overload",t.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",t.CLOSED="closed",t}({}),rS=function(t){return t.FIRST_FRAME_DECODED="first-frame-decoded",t.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",t.VIDEO_STATE_CHANGED="video-state-changed",t}({}),iS=function(t){return t.AUDIO="audio",t.VIDEO="video",t.DATA="data",t}({}),nl=function(t){return t.AUDIO_SOURCE_STATE_CHANGE="audio_source_state_change",t.RECEIVE_TRACK_BUFFER="receive_track_buffer",t.ON_AUDIO_BUFFER="on_audio_buffer",t.UPDATE_SOURCE="update_source",t}({});(function(t){t.UPDATE_TRACK_SOURCE="update-track-source"})({});const GL={sendVolumeLevel:0,sendBitrate:0,sendBytes:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,currentPacketLossRate:0},HL={sendBytes:0,sendBitrate:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,sendResolutionHeight:0,sendResolutionWidth:0,captureResolutionHeight:0,captureResolutionWidth:0,targetSendBitrate:0,totalDuration:0,totalFreezeTime:0,currentPacketLossRate:0},y8={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveLevel:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receivePacketsDiscarded:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1},Nme={uplinkNetworkQuality:0,downlinkNetworkQuality:0},E8={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receiveResolutionHeight:0,receiveResolutionWidth:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1};let qo=function(t){return t.ON_TRACK="on_track",t.ON_NODE="on_node",t}({}),rl=function(t){return t.REQUEST_UPDATE_CONSTRAINTS="request_update_constraints",t.REQUEST_CONSTRAINTS="request_constraints",t}({}),Bw=function(t){return t.IDLE="IDLE",t.INITING="INITING",t.INITEND="INITEND",t}({}),ey=function(t){return t.STATE_CHANGE="state_change",t.RECORDING_DEVICE_CHANGED="recordingDeviceChanged",t.PLAYOUT_DEVICE_CHANGED="playoutDeviceChanged",t.CAMERA_DEVICE_CHANGED="cameraDeviceChanged",t}({}),Io=function(t){return t.NONE="none",t.INIT="init",t.CANPLAY="canplay",t.PLAYING="playing",t.PAUSED="paused",t.SUSPEND="suspend",t.STALLED="stalled",t.WAITING="waiting",t.ERROR="error",t.DESTROYED="destroyed",t.ABORT="abort",t.ENDED="ended",t.EMPTIED="emptied",t.LOADEDDATA="loadeddata",t}({}),xh=function(t){return t[t.VideoStateStopped=0]="VideoStateStopped",t[t.VideoStateStarting=1]="VideoStateStarting",t[t.VideoStateDecoding=2]="VideoStateDecoding",t[t.VideoStateFrozen=3]="VideoStateFrozen",t}({});const $L={uninit:100,none:110,init:120,loadeddata:130,canplay:200,playing:210,paused:220,suspend:300,stalled:310,waiting:320,error:330,destroyed:340,abort:350,ended:360,emptied:370};let mP=function(t){return t.OPEN="open",t.MESSAGE="message",t.CLOSE="close",t.CLOSING="closing",t.ERROR="error",t}({});function v8(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}function Ur(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?v8(Object(s),!0).forEach(function(a){Ie(t,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):v8(Object(s)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))})}return t}function Ie(t,r,s){return(r=function(a){var c=function(d,h){if(typeof d!="object"||d===null)return d;var m=d[Symbol.toPrimitive];if(m!==void 0){var y=m.call(d,"string");if(typeof y!="object")return y;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(d)}(a);return typeof c=="symbol"?c:String(c)}(r))in t?Object.defineProperty(t,r,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[r]=s,t}function Un(t,r,s,a,c){var d,h,m={};return Object.keys(a).forEach(function(y){m[y]=a[y]}),m.enumerable=!!m.enumerable,m.configurable=!!m.configurable,("value"in m||m.initializer)&&(m.writable=!0),m=Ec(d=wm(h=s.slice()).call(h)).call(d,function(y,v){return v(t,r,y)||y},m),c&&m.initializer!==void 0&&(m.value=m.initializer?m.initializer.call(c):void 0,m.initializer=void 0),m.initializer===void 0&&(Object.defineProperty(t,r,m),m=null),m}class S8 extends Br{set _mediaStreamTrack(r){r!==this.mediaStreamTrack&&(this.safeEmit(Z_.TRACK_UPDATED,r),this.mediaStreamTrack=r)}get _mediaStreamTrack(){return this.mediaStreamTrack}constructor(r,s){super(),Ie(this,"trackMediaType",void 0),Ie(this,"_ID",void 0),Ie(this,"_rtpTransceiver",void 0),Ie(this,"_lowRtpTransceiver",void 0),Ie(this,"_hints",[]),Ie(this,"_isClosed",!1),Ie(this,"_originMediaStreamTrack",void 0),Ie(this,"mediaStreamTrack",void 0),Ie(this,"_external",{}),this._ID=s||mr(8,"track-"),this._originMediaStreamTrack=r,this.mediaStreamTrack=r,function(a){lt(eS).call(eS,a)||eS.push(a)}(this)}toString(){return this._ID}getTrackId(){return this._ID}getMediaStreamTrack(r){return r||Xm(()=>{var s;Nt.reportApiInvoke(null,{name:Ni.GET_MEDIA_STREAM_TRACK,options:[],tag:Kr.TRACER}).onSuccess(((s=this._mediaStreamTrack)===null||s===void 0?void 0:s.label)||"")},this.mediaStreamTrack.id||this.getTrackId()),this._mediaStreamTrack}getRTCRtpTransceiver(r){return r===tS.LOW_STREAM?this._lowRtpTransceiver:this._rtpTransceiver}getMediaStreamTrackSettings(){return this.getMediaStreamTrack(!0).getSettings()}close(){this._isClosed=!0,this._lowRtpTransceiver=void 0,this._rtpTransceiver=void 0,function(r){const s=eS.indexOf(r);s!==-1&&eS.splice(s,1)}(this),this.emit(nS.CLOSED),this.removeAllListeners(Z_.SEI_RECEIVED)}_updateRtpTransceiver(r,s){if(s===tS.LOW_STREAM){if(this._lowRtpTransceiver===r)return;this._lowRtpTransceiver=r}else{if(this._rtpTransceiver===r)return;this._rtpTransceiver=r}this.emit(Z_.TRANSCEIVER_UPDATED,r,s)}}class sS extends S8{get isExternalTrack(){return this._isExternalTrack}get muted(){return this._muted}get enabled(){return this._enabled}get processorContext(){return this._processorContext}constructor(r,s){super(r,s),Ie(this,"_enabled",!0),Ie(this,"_muted",!1),Ie(this,"_isExternalTrack",!1),Ie(this,"_isClosed",!1),Ie(this,"_enabledMutex",void 0),Ie(this,"processor",void 0),Ie(this,"_processorContext",void 0),Ie(this,"_handleTrackEnded",()=>{this.onTrackEnded()}),this._enabledMutex=new Xs("".concat(this.getTrackId())),r.addEventListener("ended",this._handleTrackEnded)}getTrackLabel(){var r,s;return(r=(s=this._originMediaStreamTrack)===null||s===void 0?void 0:s.label)!==null&&r!==void 0?r:""}close(){this._isClosed||(this.stop(),this._originMediaStreamTrack.stop(),this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack.stop(),this._mediaStreamTrack=null),this._originMediaStreamTrack=null,this._enabledMutex=null,x.debug("[".concat(this.getTrackId(),"] close")),this.emit(It.NEED_CLOSE),super.close())}async _updateOriginMediaStreamTrack(r,s){let a=arguments.length>2&&arguments[2]!==void 0&&arguments[2];this._isExternalTrack=a,r!==this._originMediaStreamTrack&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),s&&this._originMediaStreamTrack.stop()),r.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=r,this._muted&&(this._originMediaStreamTrack.enabled=!1),this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await fr(this,It.NEED_REPLACE_TRACK,this),this.processor&&this._processorContext&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this._processorContext}))}_getDefaultPlayerConfig(){return{}}onTrackEnded(){x.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(nS.TRACK_ENDED)}stateCheck(r,s){if(x.debug("check track state, [muted: ".concat(this._muted,", enabled: ").concat(this._enabled,"] to [").concat(r,": ").concat(s,"]")),ff(s,r),this._enabled&&this._muted&&r==="enabled"&&s===!1)throw new Le(te.TRACK_STATE_UNREACHABLE,"cannot set enabled while the track is muted").print("error",x);if(!this._enabled&&!this._muted&&r==="muted"&&s===!0)throw new Le(te.TRACK_STATE_UNREACHABLE,"cannot set muted while the track is disabled").print("error",x)}getProcessorStats(){return this._processorContext&&this._processorContext.gatherStats()||[]}getProcessorUsage(){return this._processorContext?this._processorContext.gatherUsage():pt.resolve([])}}const b8=window.AudioContext||window.webkitAudioContext;let il=null;const or=new class extends Br{constructor(){super(...arguments),Ie(this,"prevState",void 0),Ie(this,"curState",void 0),Ie(this,"currentTime",void 0),Ie(this,"currentTimeStuckAt",void 0),Ie(this,"interruptDetectorTrack",void 0),Ie(this,"onLocalAudioTrackMute",()=>{x.info("ios15-interruption-start"),this.emit(vs.IOS_15_16_INTERRUPTION_START)}),Ie(this,"onLocalAudioTrackUnmute",async()=>{x.info("ios15-interruption-end"),this.curState!=="running"||this.duringInterruption?x.info("ios15-interruption-end-canceled"):(il&&await il.suspend(),this.emit(vs.IOS_15_16_INTERRUPTION_END))})}get duringInterruption(){return this.prevState==="running"&&this.curState==="interrupted"}bindInterruptDetectorTrack(t){x.debug("webaudio bindInterruptDetectorTrack ".concat(t.getTrackId())),this.interruptDetectorTrack||(this.interruptDetectorTrack=t,this.interruptDetectorTrack._mediaStreamTrack.onmute=this.onLocalAudioTrackMute,this.interruptDetectorTrack._mediaStreamTrack.onunmute=this.onLocalAudioTrackUnmute)}unbindInterruptDetectorTrack(t){x.debug("webaudio unbindInterruptDetectorTrack ".concat(t.getTrackId())),this.interruptDetectorTrack&&this.interruptDetectorTrack===t&&(this.interruptDetectorTrack._mediaStreamTrack&&(this.interruptDetectorTrack._mediaStreamTrack.onmute=null,this.interruptDetectorTrack._mediaStreamTrack.onunmute=null),this.interruptDetectorTrack=void 0)}};function oS(){if(!il){if(function(){if(!b8)return void x.error("your browser is not support web audio");x.info("create audio context");const t=Ur({},oe("WEBAUDIO_INIT_OPTIONS"));x.debug("audio context init option:",JSON.stringify(t)),il=new b8(t),or.curState=il.state,il.onstatechange=()=>{or.prevState=or.curState,or.curState=il?il.state:void 0;const{prevState:r,curState:s}=or,a=s==="running",c=s==="interrupted",d=r==="running",h=r==="suspended",m=r==="interrupted",y=Ln().osVersion;(Ko()||Pu())&&d&&c&&(x.info("ios".concat(y,"-interruption-start")),or.emit(vs.IOS_INTERRUPTION_START)),(Ko()||Pu())&&(h||m)&&a&&(x.info("ios".concat(y,"-interruption-end")),or.emit(vs.IOS_INTERRUPTION_END)),r!==s&&or.emit(vs.STATE_CHANGE,s,r)},setInterval(()=>{var r;const s=(r=il)===null||r===void 0?void 0:r.currentTime;or.currentTime!==s?(or.currentTimeStuckAt&&(x.debug("AudioContext current time resume at ".concat(s)),or.currentTimeStuckAt=void 0),or.currentTime=s):(s!==or.currentTimeStuckAt&&(Nt.reportApiInvoke(null,{name:"WEB_AUDIO_CURRENT_TIME_STUCK",options:{currentTime:s},tag:Kr.TRACER}).onSuccess(),x.warning("AudioContext current time stuck at ".concat(s))),or.currentTimeStuckAt=s)},5e3),async function(r){const s=["click","contextmenu","auxclick","dblclick","mousedown","mouseup","touchend","keydown","keyup"];let a,c=!1,d=!1,h=!1;function m(j){r.state==="running"?y(!1):Ko()||Pu()?r.state==="suspended"&&(y(!0),j&&r.resume().then(v,v)):r.state!=="closed"&&(y(!0),j&&r.resume().then(v,v))}function y(j){if(c!==j){c=j;for(let W=0,Q=s;W<Q.length;W+=1){const ee=Q[W];j?window.addEventListener(ee,w,{capture:!0,passive:!0}):window.removeEventListener(ee,w,{capture:!0,passive:!0})}}}function v(){m(!1)}function w(){m(!0)}function R(j){if(!h)if(a.paused)if(j){let W;O(!1),h=!0;try{W=a.play(),W?W.then(D,D):(a.addEventListener("playing",D),a.addEventListener("abort",D),a.addEventListener("error",D))}catch{D()}}else O(!0);else O(!1)}function O(j){if(d!==j){d=j;for(let W=0,Q=s;W<Q.length;W++){const ee=Q[W];j?window.addEventListener(ee,G,{capture:!0,passive:!0}):window.removeEventListener(ee,G,{capture:!0,passive:!0})}}}function D(){a.removeEventListener("playing",D),a.removeEventListener("abort",D),a.removeEventListener("error",D),h=!1,R(!1)}function G(){R(!0)}if(Ko()){const j=r.createMediaStreamDestination(),W=document.createElement("div");W.innerHTML="<audio x-webkit-airplay='deny'></audio>",a=W.children.item(0),a.controls=!1,a.disableRemotePlayback=!0,a.preload="auto",a.srcObject=j.stream,R(!0)}or.on(vs.STATE_CHANGE,function(){m(!0)}),m(!1)}(il)}(),!il)throw new Le(te.NOT_SUPPORTED,"can not create audio context");return il}return il}function ty(t){if(function(){if(KL!==null)return KL;const a=oS(),c=a.createBufferSource(),d=a.createGain(),h=a.createGain();c.connect(d),c.connect(h),c.disconnect(d);let m=!1;try{c.disconnect(d)}catch{m=!0}return c.disconnect(),KL=m,m}())return;const r=t.connect,s=t.disconnect;t.connect=(a,c,d)=>{var h;return t._inputNodes||(t._inputNodes=[]),lt(h=t._inputNodes).call(h,a)||(a instanceof AudioNode?(t._inputNodes.push(a),r.call(t,a,c,d)):r.call(t,a,c)),t},t.disconnect=(a,c,d)=>{s.call(t),a?iP(t._inputNodes,a):t._inputNodes=[];for(const h of t._inputNodes)r.call(t,h)}}let KL=null;function qL(t,r){let s=!1;const a=1/r;if(oe("DISABLE_WEBAUDIO")){const c=window.setInterval(()=>{s?window.clearInterval(c):t(performance.now()/1e3)},1e3*a)}else{const c=oS();let d=c.createGain();d.gain.value=0,d.connect(c.destination);const h=()=>{if(s)return void(d=null);const m=c.createOscillator();m.onended=h,m.connect(d),m.start(0),m.stop(c.currentTime+a),t(c.currentTime)};h()}return()=>{s=!0}}class w8{constructor(){Ie(this,"context",void 0),Ie(this,"analyserNode",void 0),Ie(this,"sourceNode",void 0),this.context=oS(),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4}updateSource(r){if(r!==this.sourceNode){if(this.sourceNode)try{this.sourceNode.disconnect(this.analyserNode)}catch{}this.sourceNode=r,r==null||r.connect(this.analyserNode)}}getVolumeLevel(){if(!this.sourceNode||(!this.context||Ko()||Pu()||this.context.state!=="running"&&this.context.resume(),!this.analyserNode))return 0;const r=new Float32Array(this.analyserNode.fftSize);if(this.analyserNode.getFloatTimeDomainData)this.analyserNode.getFloatTimeDomainData(r);else{const a=new Uint8Array(this.analyserNode.fftSize);this.analyserNode.getByteTimeDomainData(a);for(let c=0;c<r.length;++c)r[c]=a[c]/128-1}const s=Ec(r).call(r,(a,c)=>a+c*c,0)/r.length;return Math.max(10*Math.log10(s)+100,0)/100}getAnalyserNode(){return this.analyserNode}rebuildAnalyser(){try{var r,s;(r=this.sourceNode)===null||r===void 0||r.disconnect(this.analyserNode),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4,(s=this.sourceNode)===null||s===void 0||s.connect(this.analyserNode)}catch{x.warning("rebuild analyser node failed.")}}destroy(){this.updateSource(void 0)}}class T8 extends Br{get processSourceNode(){return this.sourceNode}set processedNode(r){var s;if(!this.isDestroyed&&this._processedNode!==r){try{var a;(a=this.sourceNode)===null||a===void 0||a.disconnect(this.outputNode)}catch{}(s=this._processedNode)===null||s===void 0||s.disconnect(),this._processedNode=r,this.connect()}}get processedNode(){return this._processedNode}constructor(){super(),Ie(this,"outputNode",void 0),Ie(this,"outputTrack",void 0),Ie(this,"isPlayed",!1),Ie(this,"sourceNode",void 0),Ie(this,"context",void 0),Ie(this,"audioBufferNode",void 0),Ie(this,"destNode",void 0),Ie(this,"audioOutputLevel",0),Ie(this,"volumeLevelAnalyser",void 0),Ie(this,"_processedNode",void 0),Ie(this,"playNode",void 0),Ie(this,"isDestroyed",!1),Ie(this,"onNoAudioInput",void 0),Ie(this,"isNoAudioInput",!1),Ie(this,"_noAudioInputCount",0),this.context=oS(),this.playNode=this.context.destination,this.outputNode=this.context.createGain(),ty(this.outputNode),this.volumeLevelAnalyser=new w8}startGetAudioBuffer(r){this.audioBufferNode||(this.audioBufferNode=this.context.createScriptProcessor(r),this.outputNode.connect(this.audioBufferNode),this.audioBufferNode.connect(this.context.destination),this.audioBufferNode.onaudioprocess=s=>{this.emit(nl.ON_AUDIO_BUFFER,function(a){for(let c=0;c<a.outputBuffer.numberOfChannels;c+=1){const d=a.outputBuffer.getChannelData(c);for(let h=0;h<d.length;h+=1)d[h]=0}return a.inputBuffer}(s))})}stopGetAudioBuffer(){this.audioBufferNode&&(this.audioBufferNode.onaudioprocess=null,this.outputNode.disconnect(this.audioBufferNode),this.audioBufferNode=void 0)}createOutputTrack(){if(!Wn().webAudioMediaStreamDest)throw new Le(te.NOT_SUPPORTED,"your browser is not support audio processor");return this.destNode&&this.outputTrack||(this.destNode=this.context.createMediaStreamDestination(),this.outputNode.connect(this.destNode),this.outputTrack=this.destNode.stream.getAudioTracks()[0]),this.outputTrack}play(r){this.context.state!=="running"&&sP(()=>{or.emit("autoplay-failed")}),this.isPlayed=!0,this.playNode=r||this.context.destination,this.outputNode.connect(this.playNode)}stop(){if(this.isPlayed)try{this.outputNode.disconnect(this.playNode)}catch{}this.isPlayed=!1}getAccurateVolumeLevel(){return this.volumeLevelAnalyser.getVolumeLevel()}async checkHasAudioInput(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;if(r>5)return this.isNoAudioInput=!0,this.onNoAudioInput&&this.onNoAudioInput(),!1;Ko()||Pu()?this.context.state==="suspended"&&this.context.resume():this.context.state!=="running"&&this.context.resume();const s=this.volumeLevelAnalyser.getAnalyserNode();let a;s.getFloatTimeDomainData?(a=new Float32Array(s.fftSize),s.getFloatTimeDomainData(a)):(a=new Uint8Array(s.fftSize),s.getByteTimeDomainData(a));let c=!1;for(let d=0;d<a.length;d++)a[d]!==0&&(c=!0);return c?(this.isNoAudioInput=!1,!0):(await ys(200),await this.checkHasAudioInput(r?r+1:1)&&c)}getAudioVolume(){return this.outputNode.gain.value}setVolume(r){this.outputNode.gain.setValueAtTime(r,this.context.currentTime)}destroy(){this.disconnect(),this.stop(),this.isDestroyed=!0,this.onNoAudioInput=void 0}disconnect(){var r,s;(r=this.processedNode)===null||r===void 0||r.disconnect(),(s=this.sourceNode)===null||s===void 0||s.disconnect(),this.outputNode&&this.outputNode.disconnect()}connect(){var r;this.processedNode?(r=this.processedNode)===null||r===void 0||r.connect(this.outputNode):this.sourceNode&&this.sourceNode.connect(this.outputNode),this.volumeLevelAnalyser.updateSource(this.outputNode)}}class C8 extends T8{get isFreeze(){return!1}constructor(r,s,a){var c;if(super(),Ie(this,"sourceNode",void 0),Ie(this,"track",void 0),Ie(this,"clonedTrack",void 0),Ie(this,"audioElement",void 0),Ie(this,"isCurrentTrackCloned",!1),Ie(this,"isRemoteTrack",!1),Ie(this,"originVolumeLevelAnalyser",void 0),Ie(this,"rebuildWebAudio",async()=>{if(x.debug("ready to rebuild web audio, state:",this.context.state),this.isNoAudioInput&&await this.checkHasAudioInput(),!this.isNoAudioInput||this.isDestroyed)return document.body.removeEventListener("click",this.rebuildWebAudio,!0),void x.debug("rebuild web audio success, current volume status",this.getAccurateVolumeLevel());this.context.resume().then(()=>x.info("resume success")),x.debug("rebuild web audio because of ios 12 bugs"),this.disconnect();const m=this.track;this.track=this.track.clone(),this.isCurrentTrackCloned?m.stop():this.isCurrentTrackCloned=!0;const y=new MediaStream([this.track]);this.sourceNode=this.context.createMediaStreamSource(y),ty(this.sourceNode),this.volumeLevelAnalyser.rebuildAnalyser();const v=this.outputNode.gain.value;this.outputNode=this.context.createGain(),this.outputNode.gain.setValueAtTime(v,this.context.currentTime),ty(this.outputNode),this.emit(nl.UPDATE_SOURCE),this.connect(),this.audioElement.srcObject=y,this.isPlayed&&this.play(this.playNode),this.checkHasAudioInput()}),r.kind!=="audio")throw new Le(te.UNEXPECTED_ERROR);this.track=r;const d=new MediaStream([this.track]);if(this.isRemoteTrack=!!s,this.sourceNode=this.context.createMediaStreamSource(d),ty(this.sourceNode),a){const m=a.clone();m.enabled=!0,this.clonedTrack=m,x.debug("create an unmuted track ".concat(m.id," from the original track ").concat(a.id," to get the volume"));const y=this.context.createMediaStreamSource(new MediaStream([m]));ty(y),this.originVolumeLevelAnalyser=new w8,this.originVolumeLevelAnalyser.updateSource(y)}this.connect(),this.audioElement=document.createElement("audio"),this.audioElement.srcObject=d;const h=Ln();s&&h.os===Qi.IOS&&Number((c=h.osVersion)===null||c===void 0?void 0:c.split(".")[0])<15&&(or.on(vs.STATE_CHANGE,()=>{this.context.state==="suspended"?document.body.addEventListener("click",this.rebuildWebAudio,!0):this.context.state==="running"&&this.rebuildWebAudio()}),this.checkHasAudioInput().then(m=>{m||document.body.addEventListener("click",this.rebuildWebAudio,!0)}))}updateTrack(r){this.sourceNode.disconnect(),this.track=r,this.isCurrentTrackCloned=!1;const s=new MediaStream([r]);this.sourceNode=this.context.createMediaStreamSource(s),ty(this.sourceNode),this.processedNode||this.sourceNode.connect(this.outputNode),this.emit(nl.UPDATE_SOURCE),this.audioElement.srcObject=s}destroy(){var r;this.audioElement.srcObject=null,this.audioElement.remove(),or.off("state-change",this.rebuildWebAudio),(r=this.originVolumeLevelAnalyser)===null||r===void 0||r.destroy(),this.clonedTrack=void 0,super.destroy()}createMediaStreamSourceNode(r){return this.context.createMediaStreamSource(new MediaStream([r]))}updateOriginTrack(r){const s=r.clone();s.enabled=!0,this.clonedTrack&&(this.clonedTrack.stop(),this.clonedTrack=s),x.debug("create an unmuted track ".concat(s.id," from the original track ").concat(r.id," to get the volume"));const a=this.context.createMediaStreamSource(new MediaStream([s]));ty(a),this.originVolumeLevelAnalyser&&this.originVolumeLevelAnalyser.updateSource(a)}getOriginVolumeLevel(){return this.originVolumeLevelAnalyser?this.originVolumeLevelAnalyser.getVolumeLevel():this.getAccurateVolumeLevel()}}async function R8(t,r,s){const a=(d,h)=>d?typeof d!="number"?d.max||d.exact||d.ideal||d.min||h:d:h,c={audio:!!s&&{mandatory:{chromeMediaSource:"desktop"}},video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:t,maxHeight:a(r.height,1080),maxWidth:a(r.width,1920)}}};return r.frameRate&&typeof r.frameRate!="number"?(c.video.mandatory.maxFrameRate=r.frameRate.max,c.video.mandatory.minFrameRate=r.frameRate.min):typeof r.frameRate=="number"&&(c.video.mandatory.maxFrameRate=r.frameRate),await navigator.mediaDevices.getUserMedia(c)}async function Dme(t,r){const s=await I8(t.mediaSource),{sourceId:a,audio:c}=await function(d){let h=arguments.length>1&&arguments[1]!==void 0&&arguments[1];return new pt((m,y)=>{const v=document.createElement("div");v.innerText="share screen",v.setAttribute("style","text-align: center; height: 25px; line-height: 25px; border-radius: 4px 4px 0 0; background: #D4D2D4; border-bottom:  solid 1px #B9B8B9;");const w=document.createElement("div");w.setAttribute("style","width: 100%; height: 500px; padding: 15px 25px ; box-sizing: border-box;");const R=document.createElement("div");R.innerText="Agora Web Screensharing wants to share the contents of your screen with webdemo.agorabeckon.com. Choose what you'd like to share.",R.setAttribute("style","height: 12%;");const O=document.createElement("div");O.setAttribute("style","width: 100%; height: 80%; background: #FFF; border:  solid 1px #CBCBCB; display: flex; flex-wrap: wrap; justify-content: space-around; overflow-y: scroll; padding: 0 15px; box-sizing: border-box;");const D=document.createElement("div");D.setAttribute("style","display: flex; justify-content: space-between; padding: 16px 0;");const G=document.createElement("button");G.innerHTML="cancel",G.setAttribute("style","width: 85px;"),G.onclick=()=>{document.body.removeChild(Q);const ee=new Error("NotAllowedError");ee.name="NotAllowedError",y(ee)};let j=h;const W=document.createElement("div");if(h){const ee=document.createElement("input");ee.setAttribute("type","checkbox");const fe=document.createElement("span");ee.setAttribute("style","margin-right: 6px;"),fe.innerText="Share audio",ee.checked=j,ee.onchange=()=>{j=ee.checked},W.appendChild(ee),W.appendChild(fe)}D.appendChild(W),D.appendChild(G),w.appendChild(R),w.appendChild(O),w.appendChild(D);const Q=document.createElement("div");Q.setAttribute("style","position: fixed; z-index: 99999999; top: 50%; left: 50%; width: 620px; height: 525px; background: #ECECEC; border-radius: 4px; -webkit-transform: translate(-50%,-50%); transform: translate(-50%,-50%);"),Q.appendChild(v),Q.appendChild(w),document.body.appendChild(Q),d.map(ee=>{if(ee.id){const fe=document.createElement("div");fe.setAttribute("style","width: 30%; height: 160px; padding: 20px 0; text-align: center;box-sizing: content-box;");let ye=ee.thumbnail;try{const{width:Ee}=ye.getSize();Ee>1920&&(ye=ye.resize({width:1920}))}catch(Ee){throw Ee&&Ee.message.startsWith("Illegal invocation")&&console.error("Operate thumbnail error, please try to set contextIsolation: false. (https://github.com/electron/electron/issues/34953)"),Ee}fe.innerHTML='<div style="height: 120px; display: table-cell; vertical-align: middle;"><img style="width: 100%; background: #333333; box-shadow: 1px 1px 1px 1px rgba(0, 0, 0, 0.2);" src='+ye.toDataURL()+' /></div><span style="	height: 40px; line-height: 40px; display: inline-block; width: 70%; word-break: keep-all; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+ee.name.replace(/[\u00A0-\u9999<>\&]/g,function(Ee){return"&#"+Ee.charCodeAt(0)+";"})+"</span>",fe.onclick=()=>{document.body.removeChild(Q),m({sourceId:ee.id,audio:j})},O.appendChild(fe)}})})}(s,r);return await R8(a,t,c)}async function I8(t){let r=["window","screen"];t!=="application"&&t!=="window"||(r=["window"]),t==="screen"&&(r=["screen"]);const s=jz();if(!s)throw console.error("failed to fetch electron, please mount it to window"),new Le(te.ELECTRON_IS_NULL);let a=null;try{var c;a=((c=s.desktopCapturer)===null||c===void 0?void 0:c.getSources({types:r}))||s.ipcRenderer.invoke("DESKTOP_CAPTURER_GET_SOURCES",{types:r})}catch{a=null}a&&a.then||(a=new pt((d,h)=>{s.desktopCapturer.getSources({types:r},(m,y)=>{m?h(m):d(y)})}));try{return await a}catch(d){throw new Le(te.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR,d.toString())}}const YL=new Xs("safari");let A8=!1,P8=!1;async function sl(t,r){let s=0,a=null;for(;s<2;)try{a=await xme(t,r,s>0);break}catch(c){if(c instanceof Le)throw x.error("[".concat(r,"] ").concat(c.toString())),c;const d=gP(c.name||c.code||c,c.message);if(d.code===te.MEDIA_OPTION_INVALID){x.debug("[".concat(r,"] detect media option invalid, retry")),s+=1,await ys(500);continue}throw x.error("[".concat(r,"] ").concat(d.toString())),d}if(!a)throw new Le(te.UNEXPECTED_ERROR,"can not find stream after getUserMedia");return a}async function xme(t,r,s){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new Le(te.NOT_SUPPORTED,"can not find getUserMedia");s&&(t.video&&(delete t.video.width,delete t.video.height),t.screen&&(delete t.screen.width,delete t.screen.height));const a=Wn(),c=new MediaStream;if(t.audioSource&&c.addTrack(t.audioSource),t.videoSource&&c.addTrack(t.videoSource),!t.audio&&!t.video&&!t.screen)return x.debug("Using Video Source/ Audio Source"),c;if(t.screen)if(jz())t.screen.sourceId?aS(c,await R8(t.screen.sourceId,t.screen,!!t.screenAudio)):aS(c,await Dme(t.screen,!!t.screenAudio));else if(hf()&&t.screen.extensionId&&t.screen.mandatory){if(!a.getStreamFromExtension)throw new Le(te.NOT_SUPPORTED,"This browser does not support screen sharing");x.debug("[".concat(r,'] Screen access on chrome stable, looking for extension"'));const O=await(h=t.screen.extensionId,m=r,new pt((D,G)=>{try{chrome.runtime.sendMessage(h,{getStream:!0},j=>{if(!j||!j.streamId)return x.error("[".concat(m,"] No response from Chrome Plugin. Plugin not installed properly"),j),void G(new Le(te.CHROME_PLUGIN_NO_RESPONSE,"No response from Chrome Plugin. Plugin not installed properly"));D(j.streamId)})}catch(j){x.error("[".concat(m,"] AgoraRTC screensharing plugin is not accessible(").concat(h,")"),j.toString()),G(new Le(te.CHROME_PLUGIN_NOT_INSTALL))}}));t.screen.mandatory.chromeMediaSourceId=O,aS(c,await navigator.mediaDevices.getUserMedia({video:{mandatory:t.screen.mandatory}}))}else if(a.getDisplayMedia){var d;t.screen.mediaSource&&_8(t.screen.mediaSource);const O={width:t.screen.width,height:t.screen.height,frameRate:t.screen.frameRate,displaySurface:(d=t.screen.displaySurface)!==null&&d!==void 0?d:t.screen.mediaSource==="screen"?"monitor":t.screen.mediaSource},{selfBrowserSurface:D,surfaceSwitching:G,systemAudio:j,preferCurrentTab:W}=t.screen,Q={selfBrowserSurface:D,surfaceSwitching:G,systemAudio:j,preferCurrentTab:W};!D&&delete Q.selfBrowserSurface,!G&&delete Q.surfaceSwitching,!j&&delete Q.systemAudio,!W&&delete Q.preferCurrentTab,x.debug("[".concat(r,"] getDisplayMedia:"),JSON.stringify({video:O,audio:t.screenAudio,controls:Q})),aS(c,await navigator.mediaDevices.getDisplayMedia(Ur({video:O,audio:t.screenAudio},Q)))}else{if(!Hr())throw x.error("[".concat(r,"] This browser does not support screenSharing")),new Le(te.NOT_SUPPORTED,"This browser does not support screen sharing");{t.screen.mediaSource&&_8(t.screen.mediaSource);const O={video:{mediaSource:t.screen.mediaSource,width:t.screen.width,height:t.screen.height,frameRate:t.screen.frameRate}};x.debug("[".concat(r,"] getUserMedia: ").concat(JSON.stringify(O))),aS(c,await navigator.mediaDevices.getUserMedia(O))}}var h,m;if(!t.video&&!t.audio)return c;let y={video:t.video,audio:t.audio},v=oe("MEDIA_DEVICE_CONSTRAINTS");if(v)try{typeof v=="string"&&(v=JSON.parse(v)),y=RL(y,v)}catch{}x.debug("[".concat(r,"] GetUserMedia"),JSON.stringify(y)),Ln();let w,R=null;(xs()||Ko()||nP())&&(R=await YL.lock());try{w=await navigator.mediaDevices.getUserMedia(y)}catch(O){throw R&&R(),O}return y.audio&&(A8=!0),y.video&&(P8=!0),aS(c,w),R&&R(),c}function gP(t,r){switch(t){case"Starting video failed":case"OverconstrainedError":case"TrackStartError":return new Le(te.MEDIA_OPTION_INVALID,"".concat(t,": ").concat(r));case"NotFoundError":case"DevicesNotFoundError":return new Le(te.DEVICE_NOT_FOUND,"".concat(t,": ").concat(r));case"NotSupportedError":return new Le(te.NOT_SUPPORTED,"".concat(t,": ").concat(r));case"NotReadableError":return new Le(te.NOT_READABLE,"".concat(t,": ").concat(r));case"InvalidStateError":case"NotAllowedError":case"PERMISSION_DENIED":case"PermissionDeniedError":return new Le(te.PERMISSION_DENIED,"".concat(t,": ").concat(r));case"ConstraintNotSatisfiedError":return new Le(te.CONSTRAINT_NOT_SATISFIED,"".concat(t,": ").concat(r));default:return x.error("getUserMedia unexpected error",t),new Le(te.UNEXPECTED_ERROR,"".concat(t,": ").concat(r))}}function aS(t,r){const s=t.getVideoTracks()[0],a=t.getAudioTracks()[0],c=r.getVideoTracks()[0],d=r.getAudioTracks()[0];d&&(a&&t.removeTrack(a),t.addTrack(d)),c&&(s&&t.removeTrack(s),t.addTrack(c))}const ol=new class extends Br{get state(){return this._state}set state(t){t!==this._state&&(this.emit(ey.STATE_CHANGE,t),this._state=t)}constructor(){super(),Ie(this,"_state",Bw.IDLE),Ie(this,"isAccessMicrophonePermission",!1),Ie(this,"isAccessCameraPermission",!1),Ie(this,"lastAccessMicrophonePermission",!1),Ie(this,"lastAccessCameraPermission",!1),Ie(this,"checkdeviceMatched",!1),Ie(this,"deviceInfoMap",new Map),this.init().then(()=>{navigator.mediaDevices.addEventListener&&navigator.mediaDevices.addEventListener("devicechange",this.updateDevicesInfo.bind(this)),window.setInterval(()=>{(oe("ENUMERATE_DEVICES_INTERVAL")||(rP()||tP()===Qi.HARMONY_OS)&&pf())&&this.updateDevicesInfo()},oe("ENUMERATE_DEVICES_INTERVAL_TIME"))}).catch(t=>x.error(t.toString()))}async enumerateDevices(t,r){let s=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)return new Le(te.NOT_SUPPORTED,"enumerateDevices() not supported.").throw();const a=await navigator.mediaDevices.enumerateDevices(),c=this.checkMediaDeviceInfoIsOk(a);let d=!this.isAccessMicrophonePermission&&t,h=!this.isAccessCameraPermission&&r;c.audio&&(d=!1),c.video&&(h=!1);let m=null,y=null,v=null;if(!s&&(d||h)){if(YL.isLocked&&(x.debug("[device manager] wait GUM lock"),(await YL.lock())(),x.debug("[device manager] GUM unlock")),A8&&(d=!1,this.isAccessMicrophonePermission=!0),P8&&(h=!1,this.isAccessCameraPermission=!0),x.debug("[device manager] check media device permissions",t,r,d,h),d&&h){try{v=await navigator.mediaDevices.getUserMedia({audio:!0,video:!0})}catch(w){const R=gP(w.name||w.code||w,w.message);if(R.code===te.PERMISSION_DENIED)throw R;x.warning("getUserMedia failed in getDevices",R)}this.isAccessCameraPermission=!0,this.isAccessMicrophonePermission=!0}else if(d){try{m=await navigator.mediaDevices.getUserMedia({audio:t})}catch(w){const R=gP(w.name||w.code||w,w.message);if(R.code===te.PERMISSION_DENIED)throw R;x.warning("getUserMedia failed in getDevices",R)}this.isAccessMicrophonePermission=!0}else if(h){try{y=await navigator.mediaDevices.getUserMedia({video:r})}catch(w){const R=gP(w.name||w.code||w,w.message);if(R.code===te.PERMISSION_DENIED)throw R;x.warning("getUserMedia failed in getDevices",R)}this.isAccessCameraPermission=!0}x.debug("[device manager] mic permission",t,"cam permission",r)}try{const w=await navigator.mediaDevices.enumerateDevices();return m&&m.getTracks().forEach(R=>R.stop()),y&&y.getTracks().forEach(R=>R.stop()),v&&v.getTracks().forEach(R=>R.stop()),m=null,y=null,v=null,w}catch(w){return m&&m.getTracks().forEach(R=>R.stop()),y&&y.getTracks().forEach(R=>R.stop()),v&&v.getTracks().forEach(R=>R.stop()),m=null,y=null,v=null,new Le(te.ENUMERATE_DEVICES_FAILED,w.toString()).throw()}}async getRecordingDevices(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,t)).filter(r=>r.kind==="audioinput")}async getCamerasDevices(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!1,!0,t)).filter(r=>r.kind==="videoinput")}async getSpeakers(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,t)).filter(r=>r.kind==="audiooutput")}searchDeviceIdByName(t){let r=null;return this.deviceInfoMap.forEach(s=>{s.device.label===t&&(r=s.device.deviceId)}),r}async getDeviceById(t){const r=(await this.enumerateDevices(!0,!0,!0)).find(s=>s.deviceId===t);if(!r)throw new Le(te.DEVICE_NOT_FOUND,"deviceId: ".concat(t));return r}async init(){this.state=Bw.INITING;try{await this.updateDevicesInfo(),this.state=Bw.INITEND}catch(t){throw x.warning("Device Detection functionality cannot start properly.",t.toString()),this.state=Bw.IDLE,(typeof isSecureContext=="boolean"?isSecureContext:location.protocol==="https:"||location.protocol==="file:"||location.hostname==="localhost"||location.hostname==="127.0.0.1"||location.hostname==="::1")||new Le(te.WEB_SECURITY_RESTRICT,"Your context is limited by web security, please try using https protocol or localhost.").throw(),t}}async updateDevicesInfo(){const t=await this.enumerateDevices(!0,!0,!0),r=Date.now(),s=[];if(t[0]&&t[0].label&&this.checkdeviceMatched===!1){this.checkdeviceMatched=!0;const c=t.find(h=>h.kind==="audioinput"&&h.deviceId==="default"),d=t.find(h=>h.kind==="audiooutput"&&h.deviceId==="default");c&&d?d.groupId===c.groupId?x.debug("[device-check] default input ".concat(c.label," and output ").concat(d.label," is the same group")):x.debug("[device-check] default input ".concat(c.label," and output ").concat(d.label," is not the same group")):x.debug("[device-check] default input or output not found")}const a=this.checkMediaDeviceInfoIsOk(t);if(t.forEach(c=>{if(!c.deviceId)return;const d=this.deviceInfoMap.get("".concat(c.kind,"_").concat(c.deviceId));if((d?d.state:"INACTIVE")!=="ACTIVE"){const h={initAt:r,updateAt:r,device:c,state:"ACTIVE"};this.deviceInfoMap.set("".concat(c.kind,"_").concat(c.deviceId),h),s.push(h)}d&&(d.updateAt=r)}),this.deviceInfoMap.forEach((c,d)=>{c.state==="ACTIVE"&&c.updateAt!==r&&(c.state="INACTIVE",s.push(c))}),this.state!==Bw.INITEND)return a.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),void(a.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0));s.forEach(c=>{switch(c.device.kind){case"audioinput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(ey.RECORDING_DEVICE_CHANGED,c);break;case"videoinput":this.lastAccessCameraPermission&&this.isAccessCameraPermission&&this.emit(ey.CAMERA_DEVICE_CHANGED,c);break;case"audiooutput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(ey.PLAYOUT_DEVICE_CHANGED,c)}}),a.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),a.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0)}checkMediaDeviceInfoIsOk(t){const r=t.filter(c=>c.kind==="audioinput"),s=t.filter(c=>c.kind==="videoinput"),a={audio:!1,video:!1};for(const c of r)if(c.label&&c.deviceId){a.audio=!0;break}for(const c of s)if(c.label&&c.deviceId){a.video=!0;break}return a}};let XL=!1;const al=new class extends Br{constructor(){super(...arguments),Ie(this,"onAutoplayFailed",void 0),Ie(this,"onAudioAutoplayFailed",void 0)}};function O8(){if(Ln(),!XL){const t=r=>{r.preventDefault(),XL=!1,Nw()?document.body.removeEventListener("click",t,!0):(document.body.removeEventListener("touchstart",t,!0),document.body.removeEventListener("mousedown",t,!0))};XL=!0,Nw()?document.body.addEventListener("click",t,!0):(document.body.addEventListener("touchstart",t,!0),document.body.addEventListener("mousedown",t,!0)),x.info("detect media autoplay failed, document: https://docs.agora.io/cn/Voice/autoplay_policy_web_ng?platform=Web"),al.onAutoplayFailed?al.onAutoplayFailed():al.onAudioAutoplayFailed?x.warning(`AgoraRTC.onAudioAutoplayFailed has been deprecated in favor of AgoraRTC.onAutoplayFailed.

  Please refer to the Agora document to migrate the newer API, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`):x.warning(`We have detected a media autoplay failed event, and found out that you haven't implemented AgoraRTC.onAutoplayFailed callback yet.

  It will cause audio/video element not playing automatically on some browsers without user interaction, possibly hurting user experiences.

  Please refer to the Agora document to properly handle autoplay failed event, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`),al.emit("autoplay-failed")}}function k8(t,r,s,a){if(!t)return;const c=Nt.getBaseInfoBySessionId(t);if(!c)return;const d=c.info,h=Date.now(),m=Ur(Ur({},d),{},{vid:d.vid===void 0?0:Number(d.vid),lts:h,elapse:h-c.startTime,cbRegistered:al.onAutoplayFailed||al.onAudioAutoplayFailed?1:-1,errorMsg:s,mediaType:r,trackId:a,extend:void 0});Nt.send({type:Mr.AUTOPLAY_FAILED,data:m},!0)}const Lme=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","error"],Sa=new class{constructor(){Ie(this,"onAutoplayFailed",void 0),Ie(this,"elementMap",new Map),Ie(this,"elementStateMap",new Map),Ie(this,"elementsNeedToResume",[]),Ie(this,"sinkIdMap",new Map),Ie(this,"autoResumeAfterInterruption",t=>{Array.from(this.elementMap.entries()).forEach(r=>{let[s,a]=r;const c=this.elementStateMap.get(s),d=a.srcObject.getAudioTracks()[0],h=d&&d.readyState;if(x.debug("resume after interrupted, ele: ".concat(c," audio: ").concat(h," ").concat(t)),h==="live"){if(t)return a.pause(),void a.play();if(or.curState==="running")return Kv()?(a.pause(),void a.play()):void(c&&c==="paused"&&a.play())}})}),Ie(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{Array.from(this.elementMap.entries()).forEach(t=>{let[r,s]=t;const a=s.srcObject.getAudioTracks()[0];a&&a.readyState==="live"&&(x.debug("auto resume after interruption inside autoResumeAfterInterruptionOnIOS15"),s.pause(),s.play())})}),this.autoResumeAudioElement(),or.on(vs.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),or.on(vs.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),or.on(vs.STATE_CHANGE,()=>{Ko()&&or.prevState==="suspended"&&or.curState==="running"&&this.autoResumeAfterInterruption()})}async setSinkID(t,r){const s=this.elementMap.get(t);if(this.sinkIdMap.set(t,r),s)try{await s.setSinkId(r)}catch(a){throw new Le(te.PERMISSION_DENIED,"can not set sink id: "+a.toString())}}play(t,r,s,a){if(this.elementMap.has(r))return;const c=document.createElement("audio");c.autoplay=!0,c.srcObject=new MediaStream([t]),this.bindAudioElementEvents(r,c),this.elementMap.set(r,c),this.elementStateMap.set(r,Io.INIT),this.setVolume(r,s);const d=this.sinkIdMap.get(r);if(d)try{c.setSinkId(d).catch(m=>{x.warning("[".concat(r,"] set sink id failed"),m.toString())})}catch(m){x.warning("[".concat(r,"] set sink id failed"),m.toString())}const h=c.play();h&&h.then&&h.catch(m=>{a&&k8(a,"audio",m.message,r),x.warning("audio element play warning",m.toString()),this.elementMap.has(r)&&m.name==="NotAllowedError"&&(x.warning("detected audio element autoplay failed"),this.elementsNeedToResume.push(c),sP(()=>{this.onAutoplayFailed&&this.onAutoplayFailed(),O8()}))})}updateTrack(t,r){const s=this.elementMap.get(t);s&&(s.srcObject=new MediaStream([r]))}isPlaying(t){return this.elementMap.has(t)&&this.elementStateMap.get(t)==="playing"}setVolume(t,r){const s=this.elementMap.get(t);s&&(r=Math.max(0,Math.min(100,r)),s.volume=r/100)}stop(t){const r=this.elementMap.get(t);if(this.sinkIdMap.delete(t),!r)return;const s=this.elementsNeedToResume.indexOf(r);this.elementsNeedToResume.splice(s,1),r.srcObject=null,r.remove(),this.elementMap.delete(t),this.elementStateMap.delete(t)}bindAudioElementEvents(t,r){Lme.forEach(s=>{r.addEventListener(s,a=>{const c=this.elementStateMap.get(t),d=a.type==="pause"?"paused":a.type;if(x.debug("[".concat(t,"] audio-element-status change ").concat(c," => ").concat(d)),a.type==="error"){const h=r==null?void 0:r.error;h&&x.error("[".concat(t,"] media error, code: ").concat(h.code,", message: ").concat(h.message))}this.elementStateMap.set(t,d)})})}getPlayerState(t){return this.elementStateMap.get(t)||"uninit"}autoResumeAudioElement(){const t=()=>{this.elementsNeedToResume.forEach(r=>{r.play().then(s=>{x.debug("Auto resume audio element success")}).catch(s=>{x.warning("Auto resume audio element failed!",s)})}),this.elementsNeedToResume=[]};new pt(r=>{document.body?r():window.addEventListener("load",()=>r())}).then(()=>{Nw()?document.body.addEventListener("click",t,!0):(document.body.addEventListener("touchstart",t,!0),document.body.addEventListener("mousedown",t,!0))})}};function di(){return function(t,r,s){const a=s.value;return typeof a=="function"&&(s.value=function(){this._isClosed&&new Le(te.INVALID_OPERATION,"[".concat(this.getTrackId(),"] cannot operate a closed track")).print("warning",x);for(var c=arguments.length,d=new Array(c),h=0;h<c;h++)d[h]=arguments[h];const m=a.apply(this,d);return m instanceof pt?new pt((y,v)=>{m.then(y).catch(v)}):m}),s}}class N8 extends Br{constructor(r){super(),Ie(this,"name","VideoProcessorDestination"),Ie(this,"ID","0"),Ie(this,"_source",void 0),Ie(this,"videoContext",void 0),Ie(this,"inputTrack",void 0),this.videoContext=r}get kind(){return"video"}get enabled(){return!0}pipe(){throw new Le(te.NOT_SUPPORTED,"VideoProcessor cannot pipe to any other Processor")}unpipe(){throw new Le(te.NOT_SUPPORTED,"VideoProcessor cannot unpipe to any other Processor")}enable(){}disable(){}updateInput(r){if(r.context!==this.videoContext)throw new Error(`ProcessorContext passed to VideoTrack.processorDestination doesn't match it's belonging VideoTrack's context.
Probably you are making pipeline like this:
videoTrack1.pipe(processor).pipe(videoTrack2.processorDestination).`);r.track&&r.track!==this.inputTrack&&(this.videoContext.chained=!0,this.inputTrack=r.track,this.emit(qo.ON_TRACK,r.track))}reset(){this.inputTrack=void 0,this.videoContext.chained=!1,this.emit(qo.ON_TRACK,void 0)}}class D8 extends Br{set chained(r){this._chained=r}get chained(){return this._chained}constructor(r,s){super(),Ie(this,"constraintsMap",new Map),Ie(this,"statsRegistry",[]),Ie(this,"usageRegistry",[]),Ie(this,"trackId",void 0),Ie(this,"direction",void 0),Ie(this,"_chained",!1),this.trackId=r,this.direction=s}async getConstraints(){return await Ms(this,rl.REQUEST_CONSTRAINTS)}async requestApplyConstraints(r,s){var a;return x.info("processor ".concat(s.name," requestApplyConstraints for ").concat(this.trackId)),r&&this.constraintsMap.set(s,r),fr(this,rl.REQUEST_UPDATE_CONSTRAINTS,Array.from(Jc(a=this.constraintsMap).call(a)))}async requestRevertConstraints(r){var s;if(this.constraintsMap.has(r))return x.info("processor ".concat(r.name," requestRevertConstraints for ").concat(this.trackId)),this.constraintsMap.delete(r),fr(this,rl.REQUEST_UPDATE_CONSTRAINTS,Array.from(Jc(s=this.constraintsMap).call(s)))}registerStats(r,s,a){this.statsRegistry.find(c=>c.processorID===r.ID&&c.processorName===r.name&&c.type===s)||this.statsRegistry.push({processorName:r.name,processorID:r.ID,type:s,cb:a})}unregisterStats(r,s){const a=this.statsRegistry.findIndex(c=>c.processorID===r.ID&&c.processorName===r.name&&c.type===s);a!==-1&&this.statsRegistry.splice(a,1)}gatherStats(){const r=[];for(const{processorID:s,processorName:a,type:c,cb:d}of this.statsRegistry)try{const h=d();r.push({processorID:s,processorName:a,type:c,stats:h})}catch(h){x.error(new Le(te.UNEXPECTED_ERROR,h.message))}return r}registerUsage(r,s){this.usageRegistry.find(a=>a.processorID===r.ID&&a.processorName===r.name)||this.usageRegistry.push({processorID:r.ID,processorName:r.name,cb:s})}unregisterUsage(r){const s=this.usageRegistry.findIndex(a=>a.processorID===r.ID&&a.processorName===r.name);s!==-1&&this.usageRegistry.splice(s,1)}async gatherUsage(){const r=[];if(!this.chained)return[];for(const{cb:s}of this.usageRegistry)try{let a=s();a instanceof pt&&(a=await a),r.push(Ur(Ur({},a),{},{direction:this.direction}))}catch(a){x.error("gather extension usage error",a)}return r}getDirection(){return this.direction}}class x8 extends Br{constructor(r){super(),Ie(this,"name","AudioProcessorDestination"),Ie(this,"ID","0"),Ie(this,"inputTrack",void 0),Ie(this,"inputNode",void 0),Ie(this,"audioProcessorContext",void 0),Ie(this,"_source",void 0),this.audioProcessorContext=r}get kind(){return"audio"}get enabled(){return!0}pipe(){throw new Le(te.NOT_SUPPORTED,"AudioProcessorDestination cannot pipe to any other Processor")}unpipe(){throw new Le(te.NOT_SUPPORTED,"AudioProcessor cannot unpipe to any other Processor")}enable(){}disable(){}reset(){this.inputTrack=void 0,this.inputNode=void 0,this.audioProcessorContext.chained=!1,this.emit(qo.ON_TRACK,void 0),this.emit(qo.ON_NODE,void 0)}updateInput(r){if(r.context!==this.audioProcessorContext)throw new Error(`ProcessorContext passed to AudioTrack.processorDestination doesn't match it's belonging AudioTrack's context.
        Probably you are making pipeline like this: audioTrack1.pipe(processor).pipe(audioTrack2.processorDestination).`);r.track&&this.inputTrack!==r.track&&(this.audioProcessorContext.chained=!0,this.inputTrack=r.track,this.emit(qo.ON_TRACK,this.inputTrack)),r.node&&this.inputNode!==r.node&&(this.audioProcessorContext.chained=!0,this.inputNode=r.node,this.emit(qo.ON_NODE,this.inputNode))}}class L8 extends Br{set chained(r){this._chained=r}get chained(){return this._chained}constructor(r,s,a){super(),Ie(this,"constraintsMap",new Map),Ie(this,"statsRegistry",[]),Ie(this,"audioContext",void 0),Ie(this,"trackId",void 0),Ie(this,"direction",void 0),Ie(this,"usageRegistry",[]),Ie(this,"_chained",!1),this.audioContext=r,this.trackId=s,this.direction=a}async getConstraints(){return Ms(this,rl.REQUEST_CONSTRAINTS)}getAudioContext(){return this.audioContext}async requestApplyConstraints(r,s){var a;return x.info("processor ".concat(s.name," requestApplyConstraints for ").concat(this.trackId)),r&&this.constraintsMap.set(s,r),fr(this,rl.REQUEST_UPDATE_CONSTRAINTS,Array.from(Jc(a=this.constraintsMap).call(a)))}async requestRevertConstraints(r){var s;if(this.constraintsMap.has(r))return this.constraintsMap.delete(r),fr(this,rl.REQUEST_UPDATE_CONSTRAINTS,Array.from(Jc(s=this.constraintsMap).call(s)))}registerStats(r,s,a){this.statsRegistry.find(c=>c.processorID===r.ID&&c.processorName===r.name&&c.type===s)||this.statsRegistry.push({processorName:r.name,processorID:r.ID,type:s,cb:a})}unregisterStats(r,s){const a=this.statsRegistry.findIndex(c=>c.processorID===r.ID&&c.processorName===r.name&&c.type===s);a!==-1&&this.statsRegistry.splice(a,1)}gatherStats(){const r=[];for(const{processorID:s,processorName:a,type:c,cb:d}of this.statsRegistry)try{const h=d();r.push({processorID:s,processorName:a,type:c,stats:h})}catch(h){x.error(new Le(te.UNEXPECTED_ERROR,h.message))}return r}registerUsage(r,s){this.usageRegistry.find(a=>a.processorID===r.ID&&a.processorName===r.name)||this.usageRegistry.push({processorID:r.ID,processorName:r.name,cb:s})}unregisterUsage(r){const s=this.usageRegistry.findIndex(a=>a.processorID===r.ID&&a.processorName===r.name);s!==-1&&this.usageRegistry.splice(s,1)}async gatherUsage(){const r=[];if(!this.chained)return[];for(const{cb:s}of this.usageRegistry)try{let a=s();a instanceof pt&&(a=await a),r.push(Ur(Ur({},a),{},{direction:this.direction}))}catch(a){x.error("gather extension usage error",a)}return r}getDirection(){return this.direction}}class JL extends Br{get isPlayed(){return!0}get isFreeze(){return!1}constructor(){super(),Ie(this,"context",void 0),Ie(this,"processSourceNode",void 0),Ie(this,"outputTrack",void 0),Ie(this,"processedNode",void 0),Ie(this,"clonedTrack",void 0),Ie(this,"outputNode",void 0),this.outputNode=new Mme}setVolume(){}createOutputTrack(){throw new Le(te.NOT_SUPPORTED,"can not create output MediaStreamTrack when WebAudio disabled")}getOriginVolumeLevel(){return 0}getAccurateVolumeLevel(){return 0}stopGetAudioBuffer(){}startGetAudioBuffer(){}play(){}stop(){}destroy(){}updateTrack(){}updateOriginTrack(){}createMediaStreamSourceNode(){}}class Mme{disconnect(){}connect(){}}function M8(t){return new pt((r,s)=>{let a=!1;const c=document.createElement("video");c.setAttribute("autoplay",""),c.setAttribute("muted",""),c.muted=!0,c.autoplay=!0,c.setAttribute("playsinline",""),c.setAttribute("style","position: fixed; top: 0; left: 0; width: 1px; height: 1px"),document.body.appendChild(c);const d=Ko()?"canplay":"playing";c.addEventListener(d,()=>{const h=c.videoWidth,m=c.videoHeight;!h&&Hr()||(a=!0,c.srcObject=null,c.remove(),r([h,m]))}),c.srcObject=new MediaStream([t]),c.play().catch(oP),setTimeout(()=>{a||(c.srcObject=null,c.remove(),r([c.videoWidth,c.videoHeight]))},4e3)})}function _P(t){const r={};t.facingMode&&(r.facingMode=t.facingMode),t.cameraId&&(r.deviceId={exact:t.cameraId});const s=Dh(t.encoderConfig);return s.width!=null&&(r.width=s.width),s.height!=null&&(r.height=s.height),!xz()&&s.frameRate&&(r.frameRate=s.frameRate),Rz()&&typeof r.frameRate=="object"&&(r.frameRate.max=60),Hr()&&(r.frameRate={ideal:30,max:30}),r}function U8(t){const r={};return xz()||(t.AGC!==void 0&&(r.autoGainControl=t.AGC),t.AEC!==void 0&&(r.echoCancellation=t.AEC),t.ANS!==void 0&&(r.noiseSuppression=t.ANS,hf()&&t.ANS&&(r.googHighpassFilter=t.ANS))),r}function V8(t){const r=U8(t);if(t.encoderConfig){const s=fP(t.encoderConfig);r.channelCount=s.stereo?2:1,r.sampleRate=s.sampleRate,r.sampleSize=s.sampleSize}return t.microphoneId&&(r.deviceId={exact:t.microphoneId}),rP()&&(r.sampleRate=void 0),r}const Ume=t=>{const r=t._encoderConfig;if(!r)return;const{frameRate:s,width:a,height:c}=t.getMediaStreamTrackSettings();let{frameRate:d=s,width:h=a,height:m=c}=r;if(!d||!h||!m)return;h=IL(h),m=IL(m),d=IL(d);const{max:y,min:v}=function(D,G,j){const W=200*Math.pow(j/15,.6)*Math.pow(D*G/640/360,.75);return{min:Math.floor(W),max:Math.floor(4*W)}}(h,m,d),{bitrateMax:w,bitrateMin:R}=r||{};w||x.debug("calculate bitrate: [w: ".concat(h,", h: ").concat(m,", fps: ").concat(d,"] => [brMax: ").concat(w,", brMin: ").concat(R,"]"));const{maxFramerate:O}=oe("ENCODER_CONFIG_LIMIT");return O&&typeof O=="number"&&(d=Math.min(d,O)),{frameRate:d,bitrateMax:w||y,bitrateMin:R||v,scaleResolutionDownBy:1,scale:0}},j8=async(t,r,s)=>await(async(a,c,d)=>{const h=function(v){const w=[];for(let R=0;R<v.length;R+=2)w.push(parseInt(v.slice(R,R+2),16));return Uint8Array.from(w)}(Xz(""+c+d)).slice(0,16),m=h.slice(0,12),y=await window.crypto.subtle.importKey("raw",h,"AES-GCM",!0,["encrypt"]);return new Uint8Array(await window.crypto.subtle.encrypt({name:"AES-GCM",iv:m},y,a))})(t.buffer,r,s),QL=t=>{const r=document.createElement("canvas");return r.width=2,r.height=2,new pt((s,a)=>{r.toBlob(async c=>{if(r.remove(),c){const d=await F8(c);s({buffer:d,width:r.width,height:r.height})}else a(new Le(te.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},t,1)})},F8=async t=>{const r=await t.arrayBuffer();return new Uint8Array(r)};var B8,W8,z8,G8,H8,$8,K8,q8,Y8,X8,J8,Q8,Z8,eG,tG,nG,rG,iG,Wr,sG,oG,aG,cG,lG,uG,Lh,dG,hG,pG,fG,mG,gG,_G,yG,EG,vG,SG,bG,wG,Vs;let Qr=(B8=Ht({argsMap:(t,r)=>[t.getTrackId(),r],throttleTime:300}),W8=Ht({argsMap:(t,r)=>[t.getTrackId(),r]}),z8=di(),G8=Xv("LocalAudioTrack","_enabledMutex"),H8=Ht({argsMap:(t,r)=>[t.getTrackId(),r]}),$8=di(),K8=Xv("LocalAudioTrack","_enabledMutex"),q8=Ht({argsMap:(t,r)=>[t.getTrackId(),r]}),Y8=di(),X8=di(),J8=di(),Q8=Ht({argsMap:t=>[t.getTrackId()]}),Z8=di(),eG=Ht({argsMap:t=>[t.getTrackId()]}),tG=di(),nG=Ht({argsMap:t=>[t.getTrackId()]}),rG=Ht({argsMap:(t,r)=>[t.getTrackId(),r.name]}),iG=Ht({argsMap:t=>[t.getTrackId()]}),Un((Wr=class extends sS{get _source(){return this.initWebAudio()}set _source(t){this._trackSource=t}get processorContext(){return this._processorContext||(this._processorContext=this.initProcessor().processorContext),this._processorContext}get processorDestination(){return this._processorDestination||(this._processorDestination=this.initProcessor().processorDestination),this._processorDestination}get isPlaying(){return this._useAudioElement?Sa.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"LocalAudioTrack"}constructor(t,r,s,a){super(t,s),Ie(this,"trackMediaType",iS.AUDIO),Ie(this,"_encoderConfig",void 0),Ie(this,"_trackSource",void 0),Ie(this,"metadata",[]),Ie(this,"_enabled",!0),Ie(this,"_volume",100),Ie(this,"_useAudioElement",!0),Ie(this,"_bypassWebAudio",!1),Ie(this,"processor",void 0),Ie(this,"_processorContext",void 0),Ie(this,"_processorDestination",void 0),Ie(this,"_getOriginVolumeLevel",void 0),this._encoderConfig=r,this._getOriginVolumeLevel=!!a,this._trackSource=new JL,oe("DISABLE_WEBAUDIO")&&(this._bypassWebAudio=!0),oe("LOCAL_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1),xs()&&!il?setTimeout(()=>this.initWebAudio()):this.initWebAudio()}setVolume(t){cr(t,"volume",0,1e3),this._volume=t,this._source.setVolume(t/100),this._useAudioElement&&Sa.setVolume(this.getTrackId(),t);try{if(this._bypassWebAudio)return void x.debug("[".concat(this.getTrackId(),"] setVolume returned because no pass through WebAudio."));const r=this._source.createOutputTrack();this._mediaStreamTrack!==r&&(this._mediaStreamTrack=r,fr(this,It.NEED_REPLACE_TRACK,this).then(()=>{x.debug("[".concat(this.getTrackId(),"] replace web audio track success"))}).catch(s=>{x.warning("[".concat(this.getTrackId(),"] replace web audio track failed"),s)}))}catch{}}getVolumeLevel(){return this._muted&&this.enabled&&this._getOriginVolumeLevel?this._source.getOriginVolumeLevel():this._source.getAccurateVolumeLevel()}async setPlaybackDevice(t){if(!this._useAudioElement||!m8())throw new Le(te.NOT_SUPPORTED,"your browser does not support setting the audio output device");await Sa.setSinkID(this.getTrackId(),t)}async setEnabled(t,r,s){return this._setEnabled(t,r,s)}async _setEnabled(t,r,s){if(!s){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(x.info("[".concat(this.getTrackId(),"] start setEnabled"),t),t){this._originMediaStreamTrack.enabled=!0;try{s||(this._enabled=!0),await fr(this,It.NEED_ENABLE_TRACK,this),x.info("[".concat(this.getTrackId(),"] setEnabled to ").concat(t," success"))}catch(a){throw s||(this._enabled=!1),x.error("[".concat(this.getTrackId(),"] setEnabled to true error"),a.toString()),a}}else{this._originMediaStreamTrack.enabled=!1,s||(this._enabled=!1);try{await fr(this,It.NEED_DISABLE_TRACK,this)}catch(a){throw s||(this._enabled=!0),x.error("[".concat(this.getTrackId(),"] setEnabled to false error"),a.toString()),a}}}async setMuted(t){t!==this._muted&&(this.stateCheck("muted",t),this._muted=t,this._originMediaStreamTrack.enabled=!t,x.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(t)),t?await fr(this,It.NEED_MUTE_TRACK,this):await fr(this,It.NEED_UNMUTE_TRACK,this))}getStats(){return Xm(()=>{x.warning("[deprecated] LocalAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalAudioStats instead")},"localAudioTrackGetStatsWarning"),Zc(this,It.GET_STATS)||Ur({},GL)}setAudioFrameCallback(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!t)return this._source.removeAllListeners(nl.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(r),this._source.removeAllListeners(nl.ON_AUDIO_BUFFER),this._source.on(nl.ON_AUDIO_BUFFER,s=>t(s))}play(){x.debug("[".concat(this.getTrackId(),"] start audio playback")),this._useAudioElement?(x.debug("[".concat(this.getTrackId(),"] start audio playback in element")),Sa.play(this._mediaStreamTrack,this.getTrackId(),this._volume)):this._source.play()}stop(){x.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._useAudioElement?Sa.stop(this.getTrackId()):this._source.stop()}close(){super.close(),this._processorDestination&&this.unbindProcessorDestinationEvents(this._processorDestination),this._processorContext&&this.unbindProcessorContextEvents(this._processorContext),this.unpipe(),this._processorDestination&&this._processorDestination._source&&this._processorDestination._source.unpipe(),this._source.destroy()}_updatePlayerSource(){let t=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];x.debug("[".concat(this.getTrackId(),"] update player source track")),t&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&Sa.updateTrack(this.getTrackId(),this._mediaStreamTrack)}async _updateOriginMediaStreamTrack(t,r){this._originMediaStreamTrack!==t&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),r&&this._originMediaStreamTrack.stop()),t.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=t,this._muted&&(this._originMediaStreamTrack.enabled=!1),this.processor&&this._processorContext&&this.processor.updateInput({track:t,context:this._processorContext}),this._mediaStreamTrack!==this._source.outputTrack?(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await fr(this,It.NEED_REPLACE_TRACK,this)):this._source.updateTrack(this._originMediaStreamTrack),this._getOriginVolumeLevel&&this._source.updateOriginTrack(t))}renewMediaStreamTrack(t){return pt.resolve(void 0)}pipe(t){if(this._bypassWebAudio)throw new Le(te.INVALID_OPERATION,"Can not process AudioTrack when bypassWebAudio set to true.");if(this.processor===t)return t;if(t._source)throw new Le(te.INVALID_OPERATION,"Processor ".concat(t.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=t,this.processor._source=this,t.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),t}unpipe(){var t;if(!this.processor)return;const r=this.processor;(t=this._source.processSourceNode)===null||t===void 0||t.disconnect(),this.processor._source=!1,this.processor=void 0,r.reset()}bindProcessorDestinationEvents(t){t.on(qo.ON_TRACK,async r=>{r?r!==this._mediaStreamTrack&&(this._mediaStreamTrack=r,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(r),await fr(this,It.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await fr(this,It.NEED_REPLACE_TRACK,this))}),t.on(qo.ON_NODE,r=>{this._source.processedNode=r})}unbindProcessorDestinationEvents(t){t.removeAllListeners(qo.ON_TRACK),t.removeAllListeners(qo.ON_NODE)}bindProcessorContextEvents(t){t.on(rl.REQUEST_CONSTRAINTS,async r=>{r(this._originMediaStreamTrack.getSettings())})}unbindProcessorContextEvents(t){t.removeAllListeners(rl.REQUEST_CONSTRAINTS)}initWebAudio(){return this._trackSource instanceof JL&&(this._trackSource=new C8(this._mediaStreamTrack,!1,this._getOriginVolumeLevel?this._mediaStreamTrack:void 0)),this._trackSource}initProcessor(){const t=new L8(this._source.context,this.getTrackId(),"local"),r=new x8(t);return this._processorContext=t,this._processorDestination=r,this.bindProcessorContextEvents(t),this.bindProcessorDestinationEvents(r),this._source.on(nl.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:t})}),this._useAudioElement&&(this._useAudioElement=!1,this.isPlaying&&(Sa.stop(this.getTrackId()),this._source.play()),fr(this,It.NEED_REPLACE_MIXING_TRACK,this).then(()=>{x.debug("[".concat(this.getTrackId(),"] replace from origin track to web audio track success"))}).catch(s=>{x.warning("[".concat(this.getTrackId(),"] replace from origin track to web audio track failed"),s)})),{processorContext:t,processorDestination:r}}}).prototype,"setVolume",[B8],Object.getOwnPropertyDescriptor(Wr.prototype,"setVolume"),Wr.prototype),Un(Wr.prototype,"setPlaybackDevice",[W8,z8],Object.getOwnPropertyDescriptor(Wr.prototype,"setPlaybackDevice"),Wr.prototype),Un(Wr.prototype,"setEnabled",[G8,H8,$8],Object.getOwnPropertyDescriptor(Wr.prototype,"setEnabled"),Wr.prototype),Un(Wr.prototype,"setMuted",[K8,q8,Y8],Object.getOwnPropertyDescriptor(Wr.prototype,"setMuted"),Wr.prototype),Un(Wr.prototype,"getStats",[X8],Object.getOwnPropertyDescriptor(Wr.prototype,"getStats"),Wr.prototype),Un(Wr.prototype,"setAudioFrameCallback",[J8],Object.getOwnPropertyDescriptor(Wr.prototype,"setAudioFrameCallback"),Wr.prototype),Un(Wr.prototype,"play",[Q8,Z8],Object.getOwnPropertyDescriptor(Wr.prototype,"play"),Wr.prototype),Un(Wr.prototype,"stop",[eG,tG],Object.getOwnPropertyDescriptor(Wr.prototype,"stop"),Wr.prototype),Un(Wr.prototype,"close",[nG],Object.getOwnPropertyDescriptor(Wr.prototype,"close"),Wr.prototype),Un(Wr.prototype,"pipe",[rG],Object.getOwnPropertyDescriptor(Wr.prototype,"pipe"),Wr.prototype),Un(Wr.prototype,"unpipe",[iG],Object.getOwnPropertyDescriptor(Wr.prototype,"unpipe"),Wr.prototype),Wr),yP=(sG=Ht({argsMap:(t,r)=>[t.getTrackId(),r]}),oG=di(),aG=Xv("MicrophoneAudioTrack","_enabledMutex"),cG=Ht({argsMap:(t,r,s)=>[t.getTrackId(),r,s]}),lG=di(),uG=Ht({argsMap:t=>[t.getTrackId()]}),Un((Lh=class extends Qr{get __className__(){return"MicrophoneAudioTrack"}constructor(t,r,s,a){super(t,r.encoderConfig?fP(r.encoderConfig):{},a,oe("GET_VOLUME_OF_MUTED_AUDIO_TRACK")),Ie(this,"_config",void 0),Ie(this,"_deviceName","default"),Ie(this,"_constraints",void 0),Ie(this,"_originalConstraints",void 0),Ie(this,"_enabled",!0),this._config=r,this._constraints=s,this._originalConstraints=s,this._deviceName=t.label,typeof r.bypassWebAudio=="boolean"&&(this._bypassWebAudio=r.bypassWebAudio),(Kv()||EL())&&or.bindInterruptDetectorTrack(this)}async setDevice(t){if(x.info("[".concat(this.getTrackId(),"] start set device to ").concat(t)),this._enabled)try{const r=await ol.getDeviceById(t),s={};s.audio=Ur({},this._constraints),s.audio.deviceId={exact:t},this._originMediaStreamTrack.stop();let a=null;try{a=await sl(s,this.getTrackId())}catch(c){throw x.error("[".concat(this.getTrackId(),"] setDevice failed"),c.toString()),a=await sl({audio:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(a.getAudioTracks()[0],!1),c}await this._updateOriginMediaStreamTrack(a.getAudioTracks()[0],!1),this._deviceName=r.label,this._config.microphoneId=t,this._constraints.deviceId={exact:t}}catch(r){throw x.error("[".concat(this.getTrackId(),"] setDevice error"),r.toString()),r}else try{const r=await ol.getDeviceById(t);this._deviceName=r.label,this._config.microphoneId=t,this._constraints.deviceId={exact:t}}catch(r){throw x.error("[".concat(this.getTrackId(),"] setDevice error"),r.toString()),r}x.info("[".concat(this.getTrackId(),"] set device to ").concat(t," success"))}async setEnabled(t,r,s){if(r)return x.debug("[".concat(this.getTrackId(),"] setEnabled false (do not close microphone)")),await super._setEnabled(t);if(!s){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(x.info("[".concat(this.getTrackId(),"] start setEnabled"),t),oe("AUTO_RESET_AUDIO_ROUTE")&&(Ko()||Pu())){const h=navigator.audioSession;h&&(t||(h.type="playback"),h.type="auto")}if(!t){var a;this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop(),(a=this._source.clonedTrack)===null||a===void 0||a.stop(),s||(this._enabled=!1);try{await fr(this,It.NEED_DISABLE_TRACK,this)}catch(h){throw x.error("[".concat(this.getTrackId(),"] setEnabled false failed"),h.toString()),h}return}const c=Ur({},this._constraints),d=ol.searchDeviceIdByName(this._deviceName);d&&!c.deviceId&&(c.deviceId=d);try{s||(this._enabled=!0);const h=await sl({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(h.getAudioTracks()[0],!1),await fr(this,It.NEED_ENABLE_TRACK,this)}catch(h){throw s||(this._enabled=!1),x.error("[".concat(this.getTrackId(),"] setEnabled true failed"),h.toString()),h}x.info("[".concat(this.getTrackId(),"] setEnabled success"))}close(){super.close(),(Kv()||EL())&&or.unbindInterruptDetectorTrack(this)}onTrackEnded(){if((Ko()||Pu())&&this._enabled&&!this._isClosed&&or.duringInterruption){const t=async()=>{or.off(vs.IOS_INTERRUPTION_END,t),this._enabled&&!this._isClosed&&(x.debug("[".concat(this.getTrackId(),"] try capture microphone media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};or.on(vs.IOS_INTERRUPTION_END,t)}else x.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(nS.TRACK_ENDED)}async renewMediaStreamTrack(t){const r=t||this._constraints,s=ol.searchDeviceIdByName(this._deviceName);if(s&&!r.deviceId&&(r.deviceId=s),this._constraints=r,this._enabled){this._originMediaStreamTrack.stop();const a=await sl({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(a.getAudioTracks()[0],!0)}}bindProcessorContextEvents(t){super.bindProcessorContextEvents(t),t.on(rl.REQUEST_UPDATE_CONSTRAINTS,async(r,s,a)=>{try{const c=Object.assign({},this._originalConstraints,...r);await this.renewMediaStreamTrack(c),s()}catch(c){a(c)}})}unbindProcessorContextEvents(t){super.unbindProcessorContextEvents(t),t.removeAllListeners(rl.REQUEST_UPDATE_CONSTRAINTS)}}).prototype,"setDevice",[sG,oG],Object.getOwnPropertyDescriptor(Lh.prototype,"setDevice"),Lh.prototype),Un(Lh.prototype,"setEnabled",[aG,cG,lG],Object.getOwnPropertyDescriptor(Lh.prototype,"setEnabled"),Lh.prototype),Un(Lh.prototype,"close",[uG],Object.getOwnPropertyDescriptor(Lh.prototype,"close"),Lh.prototype),Lh),Vme=(dG=Ht({argsMap:(t,r)=>[t.getTrackId(),r,t.duration]}),hG=di(),pG=Ht({argsMap:t=>[t.getTrackId()]}),fG=di(),mG=Ht({argsMap:t=>[t.getTrackId()]}),gG=di(),_G=Ht({argsMap:t=>[t.getTrackId()]}),yG=di(),EG=Ht({argsMap:t=>[t.getTrackId()]}),vG=di(),SG=Ht({argsMap:t=>[t.getTrackId()]}),bG=Ht({argsMap:t=>[t.getTrackId()]}),wG=di(),Un((Vs=class extends Qr{get __className__(){return"BufferSourceAudioTrack"}constructor(t,r,s,a){super(r.createOutputTrack(),s,a),Ie(this,"source",void 0),Ie(this,"_bufferSource",void 0),this._useAudioElement=!1,this.source=t,this._bufferSource=r,this._bufferSource.on(nl.AUDIO_SOURCE_STATE_CHANGE,c=>{this.safeEmit(nS.SOURCE_STATE_CHANGE,c)});try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}}get currentState(){return this._bufferSource.currentState}get duration(){return this._bufferSource.duration}get playbackSpeed(){return this._bufferSource.playbackSpeed}getCurrentTime(){return this._bufferSource.currentTime}startProcessAudioBuffer(t){t&&this._bufferSource.updateOptions(t),this._bufferSource.startProcessAudioBuffer()}pauseProcessAudioBuffer(){this._bufferSource.pauseProcessAudioBuffer()}seekAudioBuffer(t){this._bufferSource.seekAudioBuffer(t)}resumeProcessAudioBuffer(){this._bufferSource.resumeProcessAudioBuffer()}stopProcessAudioBuffer(){this._bufferSource.stopProcessAudioBuffer()}close(){this.source=null,this._bufferSource.destroy(),super.close()}setAudioBufferPlaybackSpeed(t){cr(t,"speed",0),this._bufferSource.setAudioBufferPlaybackSpeed(t)}}).prototype,"startProcessAudioBuffer",[dG,hG],Object.getOwnPropertyDescriptor(Vs.prototype,"startProcessAudioBuffer"),Vs.prototype),Un(Vs.prototype,"pauseProcessAudioBuffer",[pG,fG],Object.getOwnPropertyDescriptor(Vs.prototype,"pauseProcessAudioBuffer"),Vs.prototype),Un(Vs.prototype,"seekAudioBuffer",[mG,gG],Object.getOwnPropertyDescriptor(Vs.prototype,"seekAudioBuffer"),Vs.prototype),Un(Vs.prototype,"resumeProcessAudioBuffer",[_G,yG],Object.getOwnPropertyDescriptor(Vs.prototype,"resumeProcessAudioBuffer"),Vs.prototype),Un(Vs.prototype,"stopProcessAudioBuffer",[EG,vG],Object.getOwnPropertyDescriptor(Vs.prototype,"stopProcessAudioBuffer"),Vs.prototype),Un(Vs.prototype,"close",[SG],Object.getOwnPropertyDescriptor(Vs.prototype,"close"),Vs.prototype),Un(Vs.prototype,"setAudioBufferPlaybackSpeed",[bG,wG],Object.getOwnPropertyDescriptor(Vs.prototype,"setAudioBufferPlaybackSpeed"),Vs.prototype),Vs);class Bi extends Qr{get __className__(){return"MixingAudioTrack"}get isActive(){for(const r of this.trackList)if(r._enabled&&!r._isClosed&&!r.muted)return!0;return!1}constructor(){const r=oS().createMediaStreamDestination();super(r.stream.getAudioTracks()[0],void 0,mr(8,"track-mix-")),Ie(this,"trackList",void 0),Ie(this,"destNode",void 0),this._useAudioElement=!1;try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}this.destNode=r,this.trackList=[]}hasAudioTrack(r){return this.trackList.indexOf(r)!==-1}addAudioTrack(r){this.trackList.indexOf(r)===-1?(x.debug("add ".concat(r.getTrackId()," to mixing track")),r._source.outputNode.connect(this.destNode),this.trackList.push(r),this.updateEncoderConfig()):x.debug("track ".concat(r.getTrackId()," is already added"))}removeAudioTrack(r){if(this.trackList.indexOf(r)!==-1){x.debug("remove ".concat(r.getTrackId()," from mixing track"));try{r._source.outputNode.disconnect(this.destNode)}catch{}iP(this.trackList,r),this.updateEncoderConfig()}}updateEncoderConfig(){const r={};this.trackList.forEach(s=>{s._encoderConfig&&((s._encoderConfig.bitrate||0)>(r.bitrate||0)&&(r.bitrate=s._encoderConfig.bitrate),(s._encoderConfig.sampleRate||0)>(r.sampleRate||0)&&(r.sampleRate=s._encoderConfig.sampleRate),(s._encoderConfig.sampleSize||0)>(r.sampleSize||0)&&(r.sampleSize=s._encoderConfig.sampleSize),s._encoderConfig.stereo&&(r.stereo=!0))}),this._encoderConfig=r}_updateRtpTransceiver(r){this._rtpTransceiver!==r&&(this._rtpTransceiver=r,this.trackList.forEach(s=>{s instanceof Bi?s.emit(Z_.TRANSCEIVER_UPDATED,r):s._updateRtpTransceiver(r)}))}}class jme extends T8{set currentState(r){r!==this._currentState&&(this._currentState=r,this.safeEmit(nl.AUDIO_SOURCE_STATE_CHANGE,this._currentState))}get currentState(){return this._currentState}constructor(r){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),Ie(this,"audioBuffer",void 0),Ie(this,"sourceNode",void 0),Ie(this,"startPlayTime",0),Ie(this,"startPlayOffset",0),Ie(this,"pausePlayTime",0),Ie(this,"options",void 0),Ie(this,"currentLoopCount",0),Ie(this,"currentPlaybackSpeed",100),Ie(this,"_currentState","stopped"),this.audioBuffer=r,this.options=s,this.startPlayOffset=this.options.startPlayTime||0}createWebAudioDiagram(){return this.context.createGain()}get duration(){return this.audioBuffer?this.audioBuffer.duration:0}get playbackSpeed(){return this.currentPlaybackSpeed}get currentTime(){return this.audioBuffer?this.currentState==="stopped"?0:this.currentState==="paused"?this.pausePlayTime:((this.context.currentTime-this.startPlayTime)*(this.playbackSpeed/100)+this.startPlayOffset)%this.audioBuffer.duration:0}updateOptions(r){this.currentState==="stopped"?(this.options=r,this.startPlayOffset=this.options.startPlayTime||0):x.warning("can not set audio source options")}startProcessAudioBuffer(){this.sourceNode&&this.stopProcessAudioBuffer(),this.sourceNode=this.createSourceNode(),this.startSourceNode(),this.currentState="playing"}pauseProcessAudioBuffer(){this.sourceNode&&this.currentState==="playing"&&(this.pausePlayTime=this.currentTime,this.sourceNode.onended=null,this.sourceNode.stop(),this.sourceNode.buffer=null,this.sourceNode=this.createSourceNode(),this.currentState="paused")}seekAudioBuffer(r){this.sourceNode&&(this.sourceNode.onended=null,this.currentState==="playing"&&this.sourceNode.stop(),this.sourceNode=this.createSourceNode(),this.currentState==="playing"?(this.startPlayOffset=r,this.startSourceNode()):this.currentState==="paused"&&(this.pausePlayTime=r))}resumeProcessAudioBuffer(){this.currentState==="paused"&&this.sourceNode&&(this.startPlayOffset=this.pausePlayTime,this.pausePlayTime=0,this.startSourceNode(),this.currentState="playing")}stopProcessAudioBuffer(){if(this.sourceNode){this.sourceNode.onended=null;try{this.sourceNode.stop()}catch{}this.reset()}}destroy(){this.audioBuffer=null,super.destroy()}setAudioBufferPlaybackSpeed(r){this.sourceNode&&(this.currentState==="playing"&&(this.startPlayOffset=this.currentTime,this.startPlayTime=this.context.currentTime),this.sourceNode.playbackRate.value=r/100),this.currentPlaybackSpeed=r}startSourceNode(){this.sourceNode&&this.sourceNode.buffer&&(this.sourceNode.start(0,this.startPlayOffset),this.startPlayTime=this.context.currentTime,this.sourceNode.onended=this.handleSourceNodeEnded.bind(this))}createSourceNode(){const r=this.context.createBufferSource();return r.buffer=this.audioBuffer,r.loop=!!this.options.loop,r.connect(this.outputNode),r.playbackRate.value=this.currentPlaybackSpeed/100,r}handleSourceNodeEnded(){if(this.currentLoopCount+=1,this.options.cycle&&this.options.cycle>this.currentLoopCount)return this.startPlayOffset=0,this.sourceNode=void 0,void this.startProcessAudioBuffer();this.reset()}reset(){this.startPlayOffset=this.options.startPlayTime||0,this.currentState="stopped",this.sourceNode&&(this.sourceNode.disconnect(),this.sourceNode=void 0),this.currentLoopCount=0}}const TG=new Map;class ZL{get rendFrameRate(){if(this.renderStats&&this.renderStats.curTs!==this.renderStats.lastTs){const r=this.renderStats.curTs-this.renderStats.lastTs,s=(this.renderStats.renderNum-this.renderStats.lastRenderNum)/r;return this.renderStats.lastRenderNum=this.renderStats.renderNum,this.renderStats.lastTs=this.renderStats.curTs,s}return 0}get videoElementStatus(){return this._videoElementStatus}set videoElementStatus(r){r!==this._videoElementStatus&&(x.debug("[".concat(this.trackId,"] video-element-status change ").concat(this._videoElementStatus," => ").concat(r)),this._videoElementStatus=r)}get videoState(){return this._videoState}set videoState(r){var s;r!==this._videoState&&(this._videoState=r,(s=this.onVideoStateChanged)===null||s===void 0||s.call(this,this.videoState))}constructor(r){Ie(this,"trackId",void 0),Ie(this,"config",void 0),Ie(this,"onFirstVideoFrameDecoded",void 0),Ie(this,"onVideoStateChanged",void 0),Ie(this,"freezeTimeCounterList",[]),Ie(this,"renderFreezeAccTime",0),Ie(this,"isKeepLastFrame",!1),Ie(this,"timeUpdatedCount",0),Ie(this,"freezeTime",0),Ie(this,"playbackTime",0),Ie(this,"lastTimeUpdatedTime",0),Ie(this,"autoplayFailed",!1),Ie(this,"videoTrack",void 0),Ie(this,"videoElement",void 0),Ie(this,"cacheVideoElement",void 0),Ie(this,"renderStats",void 0),Ie(this,"_videoState",xh.VideoStateStopped),Ie(this,"videoElementCheckInterval",void 0),Ie(this,"videoElementFreezeTimeout",void 0),Ie(this,"_videoElementStatus",Io.NONE),Ie(this,"isGettingVideoDimensions",!1),Ie(this,"startGetVideoDimensions",()=>{const s=()=>{if(this.isGettingVideoDimensions=!0,this.videoElement.videoWidth*this.videoElement.videoHeight>4)return x.debug("[".concat(this.trackId,"] current video dimensions:"),this.videoElement.videoWidth,this.videoElement.videoHeight),void(this.isGettingVideoDimensions=!1);setTimeout(s,500)};!this.isGettingVideoDimensions&&s()}),Ie(this,"autoResumeAfterInterruption",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&or.curState==="running"&&(x.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(Cz())),Nz()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),Ie(this,"handleVideoEvents",s=>{switch(s.type){case"play":case"playing":this.startGetVideoDimensions(),this.videoElementStatus=Io.PLAYING;break;case"loadeddata":if(this.videoState=xh.VideoStateStarting,this.onFirstVideoFrameDecoded&&this.onFirstVideoFrameDecoded(),this.cacheVideoElement){try{this.cacheVideoElement.srcObject=null,this.cacheVideoElement.remove()}catch{}this.cacheVideoElement=void 0}break;case"canplay":this.videoElementStatus=Io.CANPLAY;break;case"stalled":this.videoElementStatus=Io.STALLED;break;case"suspend":this.videoElementStatus=Io.SUSPEND;break;case"pause":this.videoElementStatus=Io.PAUSED,Ko()||Pu()||xs()&&this.autoplayFailed||!this.videoTrack||this.videoTrack.readyState!=="live"||(x.debug("[track-".concat(this.trackId,"] video element paused, auto resume")),this.videoElement.play());break;case"waiting":this.videoElementStatus=Io.WAITING;break;case"abort":this.videoElementStatus=Io.ABORT;break;case"ended":this.videoElementStatus=Io.ENDED;break;case"emptied":this.videoElementStatus=Io.EMPTIED;break;case"error":{const a=this.videoElement.error;a&&(this.videoElementStatus=Io.ERROR,x.error("[".concat(this.trackId,"] media error: ").concat(a.message," (").concat(a.code,")")));break}case"timeupdate":{const a=performance.now();if(this.timeUpdatedCount+=1,this.timeUpdatedCount<10)return void(this.lastTimeUpdatedTime=a);const c=a-this.lastTimeUpdatedTime,d=this.lastTimeUpdatedTime;if(this.lastTimeUpdatedTime=a,gf.lastVisibleTime<gf.lastHiddenTime||d<gf.lastHiddenTime||d<gf.lastVisibleTime)return;for(c>oe("VIDEO_FREEZE_DURATION")&&(this.freezeTime+=c),this.playbackTime+=c;this.playbackTime>=6e3;){this.playbackTime-=6e3;const h=Math.min(6e3,this.freezeTime);this.freezeTimeCounterList.push(h),this.freezeTime=Math.max(0,this.freezeTime-6e3)}break}}}),Ie(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&(x.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(Cz())),Nz()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),this.trackId=r.trackId,this.config=r,r.element instanceof HTMLVideoElement?this.videoElement=r.element:this.videoElement=document.createElement("video"),or.on(vs.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),or.on(vs.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16)}getVideoElement(){return this.videoElement}getContainerElement(){var r;return(r=this.videoElement.parentElement)!==null&&r!==void 0?r:void 0}updateConfig(r){this.config=r,this.trackId=r.trackId,r.element!==this.videoElement&&(this.destroy(),this.videoElement=r.element),this.videoTrack&&this.initVideoElement()}updateVideoTrack(r){this.videoTrack!==r&&(this.videoTrack=r,this.initVideoElement())}play(r){const s=this.videoElement.play();s&&s.catch&&s.catch(c=>{r&&k8(r,"video",c.message,this.trackId),c.name==="NotAllowedError"?(x.warning("detected video element autoplay failed",c),this.autoplayFailed=!0,this.handleAutoPlayFailed()):x.warning("[".concat(this.trackId,"] play warning: "),c)});const a=Ln();if((a.name==="Safari"&&Number(a.version)===15||Kv())&&s&&s.then){const c=()=>{this.config.mirror&&(this.videoElement.style.transform="rotateY(180deg)")};s.then(c).catch(c)}}getCurrentFrame(){const r=document.createElement("canvas");r.width=this.videoElement.videoWidth,r.height=this.videoElement.videoHeight;const s=r.getContext("2d");if(!s)return x.error("create canvas context failed!"),new ImageData(2,2);s.drawImage(this.videoElement,0,0,r.width,r.height);const a=s.getImageData(0,0,r.width,r.height);return r.remove(),a}async getCurrentFrameToUint8Array(r){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;const a=document.createElement("canvas");a.width=this.videoElement.videoWidth,a.height=this.videoElement.videoHeight;const c=a.getContext("2d");return c?(c.drawImage(this.videoElement,0,0,a.width,a.height),new pt((d,h)=>{a.toBlob(async m=>{if(a.remove(),m){const y=await F8(m);d({buffer:y,width:a.width,height:a.height})}else h(new Le(te.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},r,s<0?.1:s>1?1:s)})):await QL(r)}destroy(){this.renderStats=void 0,or.off(vs.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),or.off(vs.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),this.videoElement.srcObject=null,this.resetVideoElement(),this.freezeTimeCounterList=[],this.videoState=xh.VideoStateStopped}initVideoElement(){if(this.videoElementStatus=Io.INIT,!this.videoElementCheckInterval&&(CG.forEach(d=>{this.videoElement.addEventListener(d,this.handleVideoEvents)}),this.videoElementCheckInterval=window.setInterval(()=>{(function(d){return d!==document.body&&document.body.contains(d)})(this.videoElement)||(this.videoElementStatus=Io.DESTROYED)},1e3),oe("ENABLE_VIDEO_FRAME_CALLBACK"))){var r,s;let d;const h=()=>{document.visibilityState==="visible"&&(document.removeEventListener("visibilitychange",h),this.videoElementFreezeTimeout=window.setTimeout(m,oe("VIDEO_FREEZE_DURATION")))},m=()=>{this.videoElementFreezeTimeout=void 0,this.videoState===xh.VideoStateDecoding&&(document.visibilityState==="visible"?this.videoState=xh.VideoStateFrozen:document.addEventListener("visibilitychange",h))},y=(v,w)=>{if(this.videoElementStatus===Io.PLAYING){if(this.renderStats?(this.renderStats.renderNum++,this.renderStats.curTs=w.mediaTime):this.renderStats={lastTs:w.mediaTime,curTs:w.mediaTime,lastRenderNum:0,renderNum:0},d){const D=w.presentationTime-d.presentationTime;this.videoState===xh.VideoStateStarting&&(this.videoState=xh.VideoStateDecoding),this.videoState===xh.VideoStateDecoding&&this.onVideoStateChanged&&(this.videoElementFreezeTimeout&&window.clearTimeout(this.videoElementFreezeTimeout),this.videoElementFreezeTimeout=window.setTimeout(m,oe("VIDEO_FREEZE_DURATION"))),D<oe("VIDEO_FREEZE_DURATION")&&this.videoState===xh.VideoStateFrozen&&(this.videoState=xh.VideoStateDecoding),D>oe("VIDEO_FREEZE_DURATION")&&gf.lastVisibleTime>=gf.lastHiddenTime&&d.timestamp>gf.lastVisibleTime&&d.timestamp>gf.lastHiddenTime&&(this.renderFreezeAccTime+=D)}d=Ur(Ur({},w),{},{timestamp:v})}var R,O;oe("ENABLE_VIDEO_FRAME_CALLBACK")&&((R=(O=this.videoElement).requestVideoFrameCallback)===null||R===void 0||R.call(O,y))};(r=(s=this.videoElement).requestVideoFrameCallback)===null||r===void 0||r.call(s,y)}this.videoElement.controls=!1,this.videoElement.setAttribute("playsinline",""),rP()&&!oe("HIDE_NO_POSTER")&&(this.videoElement.poster="noposter");const a=Ln();a.name==="Safari"&&Number(a.version)===15||Kv()||!this.config.mirror||(this.videoElement.style.transform="rotateY(180deg)"),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover",this.videoElement.setAttribute("muted",""),this.videoElement.muted=!0,this.videoElement.srcObject&&this.videoElement.srcObject instanceof MediaStream?this.videoElement.srcObject.getVideoTracks()[0]!==this.videoTrack&&(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,Hr()&&this.videoElement.load()):(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,Hr()&&this.videoElement.load());const c=this.videoElement.play();c!==void 0&&c.catch(d=>{x.debug("[".concat(this.trackId,"] playback interrupted"),d.toString())})}resetVideoElement(){CG.forEach(r=>{this.videoElement&&this.videoElement.removeEventListener(r,this.handleVideoEvents)}),this.videoElementCheckInterval&&(window.clearInterval(this.videoElementCheckInterval),this.videoElementCheckInterval=void 0),this.videoElementStatus=Io.NONE}handleAutoPlayFailed(){const r=s=>{s.preventDefault(),this.videoElement.play().then(()=>{x.debug("[".concat(this.trackId,"] Video element for trackId:").concat(this.trackId," autoplay resumed."))}).catch(a=>{x.error(a)}),this.autoplayFailed=!1,Nw()?document.body.removeEventListener("click",r,!0):(document.body.removeEventListener("touchstart",r,!0),document.body.removeEventListener("mousedown",r,!0))};Nw()?document.body.addEventListener("click",r,!0):(document.body.addEventListener("touchstart",r,!0),document.body.addEventListener("mousedown",r,!0)),O8()}}const CG=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","timeupdate","error"];class RG extends ZL{constructor(r){super(r),Ie(this,"container",void 0),Ie(this,"slot",void 0),this.slot=r.element,this.updateConfig(r)}updateConfig(r){this.config=r,this.trackId=r.trackId;const s=r.element;s!==this.slot&&(this.destroy(),this.slot=s),this.createElements()}updateVideoTrack(r){this.videoTrack!==r&&(this.videoTrack=r,this.createElements())}play(r){var s;(s=this.container)!==null&&s!==void 0&&s.contains(this.videoElement)&&super.play(r)}getCurrentFrame(){var r;return(r=this.container)!==null&&r!==void 0&&r.contains(this.videoElement)?super.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameToUint8Array(r){var s;let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return(s=this.container)!==null&&s!==void 0&&s.contains(this.videoElement)?await super.getCurrentFrameToUint8Array(r,a):await QL(r)}destroy(){if(super.destroy(),this.videoElement.remove(),this.videoElement=document.createElement("video"),this.container){try{this.container.remove(),this.slot.removeChild(this.container)}catch{}this.container=void 0}}createElements(){this.container||(this.container=document.createElement("div")),this.container.id="agora-video-player-".concat(this.trackId),this.container.style.width="100%",this.container.style.height="100%",this.container.style.position="relative",this.container.style.overflow="hidden",this.videoTrack?(this.container.style.backgroundColor="black",oe("KEEP_LAST_FRAME")&&this.isKeepLastFrame&&this.videoElement.paused&&this.resetVideoElement(),this.mountedVideoElement()):this.unmountedVideoElement(),this.slot.appendChild(this.container)}mountedVideoElement(){var r;!this.container||(r=this.container)!==null&&r!==void 0&&r.contains(this.videoElement)||this.container.appendChild(this.videoElement),super.initVideoElement(),this.videoElement.id="video_".concat(this.trackId),this.videoElement.className="agora_video_player",this.videoElement.style.width="100%",this.videoElement.style.height="100%",this.videoElement.style.position="absolute",this.videoElement.style.left="0",this.videoElement.style.top="0"}unmountedVideoElement(){var r;if((r=this.container)!==null&&r!==void 0&&r.contains(this.videoElement)){super.resetVideoElement();try{this.container&&this.container.removeChild(this.videoElement)}catch{}this.videoElement=document.createElement("video")}}resetVideoElement(){var r;(r=this.container)!==null&&r!==void 0&&r.contains(this.videoElement)&&(super.resetVideoElement(),this.cacheVideoElement=this.videoElement,this.videoElement=document.createElement("video"))}getContainerElement(){return this.container}}var IG,AG,PG,OG,kG,NG,DG,xG,LG,MG,UG,VG,jG,FG,BG,WG,zG,GG,HG,$G,KG,qG,YG,XG,On,JG,QG,ZG,eH,tH,nH,rH,iH,cl;let Ir=(IG=Ht({argsMap:(t,r,s)=>[t.getTrackId(),typeof r=="string"?r:r instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",s]}),AG=di(),PG=Ht({argsMap:t=>[t.getTrackId()]}),OG=Xv("LocalVideoTrack","_enabledMutex"),kG=Ht({argsMap:(t,r)=>[t.getTrackId(),r]}),NG=di(),DG=Xv("LocalVideoTrack","_enabledMutex"),xG=Ht({argsMap:(t,r)=>[t.getTrackId(),r]}),LG=di(),MG=Ht({argsMap:(t,r)=>[t.getTrackId(),r]}),UG=di(),VG=di(),jG=Ht({argsMap:(t,r,s)=>[t.getTrackId(),r,s]}),FG=di(),BG=di(),WG=di(),zG=di(),GG=di(),HG=di(),$G=di(),KG=Ht({argsMap:(t,r)=>[t.getTrackId(),r.name]}),qG=Ht({argsMap:t=>[t.getTrackId()]}),YG=Ht({argsMap:t=>[t.getTrackId()]}),XG=Ht({argsMap:(t,r,s)=>[t.getTrackId(),r.label,s]}),On=class yae extends sS{get videoHeight(){if(xs()){const{height:r}=this._mediaStreamTrack.getSettings();return this._videoHeight=r,this._videoHeight}return this._videoHeight}get videoWidth(){if(xs()){const{width:r}=this._mediaStreamTrack.getSettings();return this._videoWidth=r,this._videoWidth}return this._videoWidth}get isPlaying(){return!(!this._player||this._player.videoElementStatus!==Io.PLAYING)}get processorDestination(){return this._processorDestination}get processorContext(){return this._processorContext}set processorContext(r){this._processorContext=r}get __className__(){return"LocalVideoTrack"}constructor(r,s,a,c,d,h){if(super(r,d),Ie(this,"trackMediaType",iS.VIDEO),Ie(this,"_player",void 0),Ie(this,"isUseScaleResolutionDownBy",!1),Ie(this,"_videoVisibleTimer",null),Ie(this,"_previousVideoVisibleStatus",void 0),Ie(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),Ie(this,"_encoderConfig",void 0),Ie(this,"_scalabilityMode",{numSpatialLayers:1,numTemporalLayers:1}),Ie(this,"_optimizationMode",void 0),Ie(this,"_videoHeight",void 0),Ie(this,"_videoWidth",void 0),Ie(this,"_forceBitrateLimit",void 0),Ie(this,"_enabled",!0),Ie(this,"_processorDestination",void 0),Ie(this,"_processorContext",void 0),xs()){const{width:m,height:y}=r.getSettings();this._videoWidth=m,this._videoHeight=y}else this.updateMediaStreamTrackResolution();if(this._encoderConfig=s,this._scalabilityMode=a,this._optimizationMode=c,this._hints=h||[],this._hints.indexOf(gr.SCREEN_TRACK)===-1)this.updateBitrateFromProfile();else if(gL($n.CHROME,115)&&tP().indexOf("Windows")!==-1){const m=function(y,v){if("VideoFrame"in window&&"TransformStream"in window&&Wn().supportWebRTCInsertableStream){const w=new MediaStreamTrackProcessor(y),R=new MediaStreamTrackGenerator({kind:"video"});let O,D,G=Date.now();const j=()=>{W&&(clearInterval(W),W=void 0),O&&(O.close(),O=void 0),y.stop(),D=void 0,R.removeEventListener("ended",j)};let W=window.setInterval(()=>{if(D&&O&&Date.now()-G>1e3)try{R.readyState==="live"?D.enqueue(O.clone()):j()}catch{j()}},1e3);const Q=new TransformStream({transform:(ee,fe)=>{R.readyState==="live"?(D=fe,G=Date.now(),O===void 0?(O=ee,fe.enqueue(ee.clone())):(fe.enqueue(O),O=ee)):ee.close()}});return R.addEventListener("ended",j),w.readable.pipeThrough(Q).pipeTo(R.writable),R}}(r);m&&(x.info("local screen video track begin to inject frame"),this._mediaStreamTrack=m)}s&&this._hints.indexOf(gr.CUSTOM_TRACK)!==-1&&this.setEncoderConfiguration(s),this._processorContext=new D8(this.getTrackId(),"local"),this._processorDestination=new N8(this.processorContext),this.bindProcessorDestinationEvents()}play(r){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof r=="string"){const c=document.getElementById(r);c?r=c:(x.warning("[".concat(this.getTrackId(),'] can not find "#').concat(r,'" element, use document.body')),r=document.body)}x.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(r instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(s));const a=Ur(Ur(Ur({},this._getDefaultPlayerConfig()),s),{},{trackId:this.getTrackId(),element:r});this._player?this._player.updateConfig(a):(r instanceof HTMLVideoElement?this._player=new ZL(a):this._player=new RG(a),this._player.updateVideoTrack(this._mediaStreamTrack)),this._player.play(),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const c=this.getVideoElementVisibleStatus();this.safeEmit(nS.VIDEO_ELEMENT_VISIBLE_STATUS,c)}catch{}},oe("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,x.debug("[".concat(this.getTrackId(),"] stop video playback")))}async setEnabled(r,s){if(!s){if(r===this._enabled)return;this.stateCheck("enabled",r)}if(x.info("[".concat(this.getTrackId(),"] start setEnabled"),r),!r){this._originMediaStreamTrack.enabled=!1;try{await fr(this,It.NEED_DISABLE_TRACK,this)}catch(a){throw x.error("[".concat(this.getTrackId(),"] setEnabled to false error"),a.toString()),a}return s||(this._enabled=!1),void x.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}this._originMediaStreamTrack.enabled=!0;try{await fr(this,It.NEED_ENABLE_TRACK,this)}catch(a){throw x.error("[".concat(this.getTrackId(),"] setEnabled to true error"),a.toString()),a}x.info("[".concat(this.getTrackId(),"] setEnabled to true success")),s||(this._enabled=!0)}async setMuted(r){r!==this._muted&&(this.stateCheck("muted",r),this._muted=r,this._originMediaStreamTrack.enabled=!r,x.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(r)),r?await fr(this,It.NEED_MUTE_TRACK,this):await fr(this,It.NEED_UNMUTE_TRACK,this))}async setEncoderConfiguration(r,s){if(!this._enabled)throw new Le(te.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");if(r=Dh(r),this._forceBitrateLimit&&(r.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:r.bitrateMax,r.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:r.bitrateMin),r.width||r.height||r.frameRate){const a=_P({encoderConfig:r});(xs()||Ko()||Pu())&&(a.deviceId=void 0),x.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(r),JSON.stringify(a));try{await this._originMediaStreamTrack.applyConstraints(a),this.updateMediaStreamTrackResolution()}catch(c){const d=new Le(te.UNEXPECTED_ERROR,c.toString());throw x.error("[".concat(this.getTrackId(),"] applyConstraints error"),d.toString()),d}}this._encoderConfig=r,this._hints.indexOf(gr.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await fr(this,It.NEED_UPDATE_VIDEO_ENCODER,this)}catch(a){return a.throw(x)}}getStats(){return Xm(()=>{x.warning("[deprecated] LocalVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalVideoStats instead")},"localVideoTrackGetStatsWarning"),Zc(this,It.GET_STATS)||Ur({},HL)}async setBeautyEffect(r){x.error("LocalVideoTrack.setBeautyEffect was deprecated, please migrate to agora-extension-beauty-effect")}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameImage(r){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return this._player?this._player.getCurrentFrameToUint8Array(r,s):await QL(r)}async setBitrateLimit(r){x.debug("[".concat(this.getTrackId(),"] set bitrate limit, ").concat(JSON.stringify(r))),r&&(this._forceBitrateLimit=r,this._encoderConfig&&(this._encoderConfig.bitrateMax?this._encoderConfig.bitrateMax=this._encoderConfig.bitrateMax<r.max_bitrate?this._encoderConfig.bitrateMax:r.max_bitrate:this._encoderConfig.bitrateMax=r.max_bitrate,this._encoderConfig.bitrateMin,this._encoderConfig.bitrateMin=r.min_bitrate))}async setOptimizationMode(r){if(r!=="motion"&&r!=="detail"&&r!=="balanced")return void x.error(te.INVALID_PARAMS,"optimization mode must be motion, detail or balanced");const s=this._optimizationMode;try{this._optimizationMode=r,await fr(this,It.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this)}catch(a){throw this._optimizationMode=s,x.error("[".concat(this.getTrackId(),"] set optimization mode failed"),a.toString()),a}x.info("[".concat(this.getTrackId(),"] set optimization mode success (").concat(r,")"))}setScalabiltyMode(r){if(r.numSpatialLayers===1&&r.numTemporalLayers!==1)return x.error(te.INVALID_PARAMS,"scalability mode currently not supported, no SVC."),void(this._scalabilityMode={numSpatialLayers:1,numTemporalLayers:1});this._scalabilityMode=r,x.info("[".concat(this.getTrackId(),"] set scalability mode success (").concat(r,")"))}updateMediaStreamTrackResolution(){M8(this._originMediaStreamTrack).then(r=>{let[s,a]=r;this._videoHeight=a,this._videoWidth=s}).catch(oP)}_updatePlayerSource(){this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}_getDefaultPlayerConfig(){return{fit:"contain"}}async setSenderConfiguration(r){if(!this._enabled)throw new Le(te.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");x.debug("[".concat(this.getTrackId(),"] setSenderConfiguration applyConstraints"),JSON.stringify(r)),r=Dh(r),this._forceBitrateLimit&&(r.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:r.bitrateMax,r.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:r.bitrateMin),this._encoderConfig=r,this._hints.indexOf(gr.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await fr(this,It.NEED_UPDATE_VIDEO_ENCODER,this)}catch(s){return s.throw(x)}}updateBitrateFromProfile(){if(!this._encoderConfig)return;const{width:r,height:s,frameRate:a}=this.getMediaStreamTrackSettings();if(!r||!s||!a)return;const{bitrateMax:c,bitrateMin:d}=this._encoderConfig;if(d==null||c==null){const{max:h,min:m}=function(y,v,w,R,O){const D=oe("BITRATE_ADAPTER_TYPE");if(D==="DEFAULT_BITRATE")return{min:R,max:O};if(O===void 0){var G;const W=Math.floor(200*Math.pow(w/15,.6)*Math.pow(y*v/640/360,.75));O=D==="STANDARD_BITRATE"?4*W:2*W,R=(G=R)!==null&&G!==void 0?G:W}else{var j;R=(j=R)!==null&&j!==void 0?j:Math.floor(O/10)}return{min:R,max:O}}(r,s,a,d,c);this._encoderConfig.bitrateMin=m,this._encoderConfig.bitrateMax=h,x.debug("[".concat(this.getTrackId(),"] update bitrate from profile, [w: ").concat(r,", h: ").concat(s,", fps: ").concat(a,"] => [brMax: ").concat(h,", brMin: ").concat(m,"]"))}}getVideoElementVisibleStatus(){try{var r,s;const a=this==null||(r=this._player)===null||r===void 0?void 0:r.getContainerElement(),c={track:this,element:this==null||(s=this._player)===null||s===void 0?void 0:s.getVideoElement(),slot:a==null?void 0:a.parentElement},{element:d,slot:h}=c;if(this.isPlaying&&d instanceof HTMLVideoElement&&h instanceof HTMLElement){const m=Uz.checkOneElementVisible(d),y=Object.assign({},m);if(y.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=y.visible;const v=Nt.reportApiInvoke(null,{tag:Kr.TRACER,name:Ni.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});y.visible?v.onSuccess("Video is visible"):v.onSuccess("Invisible because of ".concat(y.reason))}return y}return}catch(a){throw new Le(te.GET_VIDEO_ELEMENT_VISIBLE_ERROR,a.message)}}async renewMediaStreamTrack(r){}pipe(r){if(this.processor===r)return r;if(r._source)throw new Le(te.INVALID_OPERATION,"Processor ".concat(r.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=r,this.processor._source=this,r.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),r}unpipe(){if(!this.processor)return;const r=this.processor;this.processor._source=void 0,this.processor=void 0,r.reset()}close(){super.close(),this.unbindProcessorDestinationEvents(),this.unbindProcessorContextEvents(),this.unpipe(),this.processorDestination._source&&this.processorDestination._source.unpipe()}clone(r){let s=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],a=this._encoderConfig;r&&(a=Ur(Ur({},a),Dh(r))),a=Y_(a);const c=mr(8,"track-video-cloned-"),d=new yae(s?this._mediaStreamTrack.clone():this._mediaStreamTrack,a,Y_(this._scalabilityMode),this._optimizationMode,c,Y_(this._hints));return r&&a&&d.setEncoderConfiguration(a),x.debug("clone video track from ".concat(this.getTrackId()," to ").concat(c,", clone ").concat(s)),d}async replaceTrack(r,s){if(!(r instanceof MediaStreamTrack))throw new Le(te.INVALID_PARAMS,"track should be an instance of MediaStreamTrack");if(r.kind!=="video")throw new Le(te.INVALID_PARAMS,"track should be a video MediaStreamTrack");await this._updateOriginMediaStreamTrack(r,s,!0),this.updateMediaStreamTrackResolution()}sendSeiData(r){if(Xm(()=>{Nt.reportApiInvoke(null,{name:Ni.LOCAL_VIDEO_SEND_SEI_DATA,options:[],tag:Kr.TRACER}).onSuccess("")},this._mediaStreamTrack.id||this.getTrackId()),!oe("ENABLE_VIDEO_SEI")||!oe("ENABLE_ENCODED_TRANSFORM"))return void x.warning('To send/receive SEI, please call AgoraRTC.setParameter("ENABLE_VIDEO_SEI", true) before instantiate IAgoraRtcClient');if(r instanceof Uint8Array==0)return new Le(te.INVALID_PARAMS,"Invalid argument type, ILocalVideoTrack.sendSeiData() only accept Uint8Array argument.").throw();const s=this.getRTCRtpTransceiver();if(!s)return void x.warning("Video track is not published, SEI can not be send");const a=s.sender.getParameters();if(a.codecs.length===0)return;const c=a.codecs[0].mimeType.toLocaleLowerCase();c==="video/h264"?this.safeEmit("sei-to-send",r):x.warning("SEI is not supported by ".concat(c))}bindProcessorDestinationEvents(){this.processorDestination.on(qo.ON_TRACK,async r=>{r?r!==this._mediaStreamTrack&&(this._mediaStreamTrack=r,this._updatePlayerSource(),await fr(this,It.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await fr(this,It.NEED_REPLACE_TRACK,this))})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(qo.ON_TRACK)}unbindProcessorContextEvents(){this.processorContext.removeAllListeners(rl.REQUEST_UPDATE_CONSTRAINTS),this.processorContext.removeAllListeners(rl.REQUEST_CONSTRAINTS)}},Un(On.prototype,"play",[IG,AG],Object.getOwnPropertyDescriptor(On.prototype,"play"),On.prototype),Un(On.prototype,"stop",[PG],Object.getOwnPropertyDescriptor(On.prototype,"stop"),On.prototype),Un(On.prototype,"setEnabled",[OG,kG,NG],Object.getOwnPropertyDescriptor(On.prototype,"setEnabled"),On.prototype),Un(On.prototype,"setMuted",[DG,xG,LG],Object.getOwnPropertyDescriptor(On.prototype,"setMuted"),On.prototype),Un(On.prototype,"setEncoderConfiguration",[MG,UG],Object.getOwnPropertyDescriptor(On.prototype,"setEncoderConfiguration"),On.prototype),Un(On.prototype,"getStats",[VG],Object.getOwnPropertyDescriptor(On.prototype,"getStats"),On.prototype),Un(On.prototype,"setBeautyEffect",[jG,FG],Object.getOwnPropertyDescriptor(On.prototype,"setBeautyEffect"),On.prototype),Un(On.prototype,"getCurrentFrameData",[BG],Object.getOwnPropertyDescriptor(On.prototype,"getCurrentFrameData"),On.prototype),Un(On.prototype,"getCurrentFrameImage",[WG],Object.getOwnPropertyDescriptor(On.prototype,"getCurrentFrameImage"),On.prototype),Un(On.prototype,"setBitrateLimit",[zG],Object.getOwnPropertyDescriptor(On.prototype,"setBitrateLimit"),On.prototype),Un(On.prototype,"setOptimizationMode",[GG],Object.getOwnPropertyDescriptor(On.prototype,"setOptimizationMode"),On.prototype),Un(On.prototype,"setScalabiltyMode",[HG],Object.getOwnPropertyDescriptor(On.prototype,"setScalabiltyMode"),On.prototype),Un(On.prototype,"updateMediaStreamTrackResolution",[$G],Object.getOwnPropertyDescriptor(On.prototype,"updateMediaStreamTrackResolution"),On.prototype),Un(On.prototype,"pipe",[KG],Object.getOwnPropertyDescriptor(On.prototype,"pipe"),On.prototype),Un(On.prototype,"unpipe",[qG],Object.getOwnPropertyDescriptor(On.prototype,"unpipe"),On.prototype),Un(On.prototype,"close",[YG],Object.getOwnPropertyDescriptor(On.prototype,"close"),On.prototype),Un(On.prototype,"replaceTrack",[XG],Object.getOwnPropertyDescriptor(On.prototype,"replaceTrack"),On.prototype),On),e2=(JG=Ht({argsMap:(t,r)=>[t.getTrackId(),r]}),QG=di(),ZG=Xv("CameraVideoTrack","_enabledMutex"),eH=Ht({argsMap:(t,r)=>[t.getTrackId(),r]}),tH=di(),nH=Ht({argsMap:(t,r)=>[t.getTrackId(),r]}),rH=di(),iH=Ht({argsMap:t=>[t.getTrackId()]}),cl=class Eae extends Ir{get __className__(){return"CameraVideoTrack"}constructor(r,s,a,c,d,h){super(r,Dh(s.encoderConfig),c,d,h),Ie(this,"_config",void 0),Ie(this,"_originalConstraints",void 0),Ie(this,"_constraints",void 0),Ie(this,"_enabled",!0),Ie(this,"_deviceName","default"),Ie(this,"tryResumeVideoForIOS15_16WeChat",async()=>{(Kv()||EL())&&!function(){const m=Ln();if(m.os!==Qi.IOS||!m.osVersion)return!1;const y=m.osVersion.split(".");return Number(y[0])===15&&Number(y[1])>=2}()&&Dz()&&this._enabled&&!this._isClosed&&(x.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS 15 device on WeChat.")),await this.renewMediaStreamTrack())}),this._config=s,this._originalConstraints=a,this._constraints=a,this._deviceName=r.label,this._encoderConfig=Dh(this._config.encoderConfig),or.on(vs.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),or.on(vs.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),this.bindProcessorContextEvents()}async setDevice(r){return typeof r=="string"?this._setDeviceById(r):r.deviceId?this._setDeviceById(r.deviceId):r.facingMode?this._setDeviceByFacingModel(r.facingMode):void 0}async _setDeviceById(r){if(x.info("[".concat(this.getTrackId(),"] set device to ").concat(r)),this._enabled)try{const s=await ol.getDeviceById(r),a={};a.video=Ur({},this._constraints),a.video.deviceId={exact:r},a.video.facingMode=void 0,this._originMediaStreamTrack.stop();let c=null;try{c=await sl(a,this.getTrackId())}catch(d){throw x.error("[".concat(this.getTrackId(),"] setDevice failed"),d.toString()),c=await sl({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(c.getVideoTracks()[0],!1),d}await this._updateOriginMediaStreamTrack(c.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution(),this._deviceName=s.label,this._config.cameraId=r,this._constraints.deviceId={exact:r}}catch(s){throw x.error("[".concat(this.getTrackId(),"] setDevice error"),s.toString()),s}else try{const s=await ol.getDeviceById(r);this._deviceName=s.label,this._config.cameraId=r,this._constraints.deviceId={exact:r}}catch(s){throw x.error("[".concat(this.getTrackId(),"] setDevice error"),s.toString()),s}x.info("[".concat(this.getTrackId(),"] setDevice success"))}async _setDeviceByFacingModel(r){x.info("[".concat(this.getTrackId(),"] set facingMode ").concat(r));const s={video:Ur(Ur({},this._constraints),{},{deviceId:void 0,facingMode:{exact:r}})};if(this._enabled){this._originMediaStreamTrack.stop();let a=null;try{a=await sl(s,this.getTrackId())}catch(c){throw x.error("[".concat(this.getTrackId(),"] setDeviceByFacingModel failed"),c.toString()),a=await sl({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(a.getVideoTracks()[0],!1),c}await this._updateOriginMediaStreamTrack(a.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution()}this._deviceName="",this._config.facingMode=r,this._config.cameraId=void 0,this._constraints=Ur({},s.video),x.info("[".concat(this.getTrackId(),"] setDeviceByFacingModel success"))}async setEnabled(r,s){if(!s){if(r===this._enabled)return;this.stateCheck("enabled",r)}if(x.info("[".concat(this.getTrackId(),"] start setEnabled"),r),r){try{if(this.isExternalTrack)this._originMediaStreamTrack.enabled=!0;else{const a=await sl({video:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(a.getVideoTracks()[0],!1)}await fr(this,It.NEED_ENABLE_TRACK,this)}catch(a){throw x.error("[".concat(this.getTrackId(),"] setEnabled true error"),a.toString()),a}this.updateMediaStreamTrackResolution(),x.info("[".concat(this.getTrackId(),"] setEnabled to true success")),s||(this._enabled=!0)}else{this.isExternalTrack?this._originMediaStreamTrack.enabled=!1:(this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop()),s||(this._enabled=!1);try{await fr(this,It.NEED_DISABLE_TRACK,this)}catch(a){throw x.error("[".concat(this.getTrackId(),"] setEnabled to false error"),a.toString()),a}x.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}}async setEncoderConfiguration(r,s){if(!this._enabled)throw new Le(te.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");r=Dh(r),this._forceBitrateLimit&&(r.bitrateMax=this._forceBitrateLimit.max_bitrate||r.bitrateMax,r.bitrateMin=this._forceBitrateLimit.min_bitrate||r.bitrateMin);const a=qr(this._config);a.encoderConfig=r;const c=_P(a);(xs()||Ko()||Pu())&&(c.deviceId=void 0),x.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(r),JSON.stringify(c));try{await this._originMediaStreamTrack.applyConstraints(c),this.updateMediaStreamTrackResolution()}catch(d){const h=new Le(te.UNEXPECTED_ERROR,d.toString());throw x.error("[".concat(this.getTrackId(),"] applyConstraints error"),h.toString()),h}this._config=a,this._constraints=c,this._originalConstraints=c,this._encoderConfig=r,this._hints.indexOf(gr.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await fr(this,It.NEED_UPDATE_VIDEO_ENCODER,this)}catch(d){return d.throw(x)}}_getDefaultPlayerConfig(){return{mirror:!0,fit:"cover"}}onTrackEnded(){if((Ko()||Pu())&&this._enabled&&!this._isClosed&&or.duringInterruption){const r=async()=>{or.off(vs.IOS_INTERRUPTION_END,r),this._enabled&&!this._isClosed&&(x.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};or.on(vs.IOS_INTERRUPTION_END,r)}else x.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(nS.TRACK_ENDED)}async renewMediaStreamTrack(r){const s=r||this._constraints,a=ol.searchDeviceIdByName(this._deviceName);if(a&&!s.deviceId&&(s.deviceId={exact:a}),this._enabled){const c=await sl({video:s},this.getTrackId());this._constraints=s,await this._updateOriginMediaStreamTrack(c.getVideoTracks()[0],!0),this.updateMediaStreamTrackResolution()}}close(){super.close(),or.off(vs.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),or.off(vs.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat)}clone(r){let s=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],a=this._encoderConfig;r&&(a=Ur(Ur({},a),Dh(r))),a=Y_(a);const c=mr(8,"track-cam-cloned-"),d=new Eae(s?this._mediaStreamTrack.clone():this._mediaStreamTrack,Y_(Ur(Ur({},this._config),{},{encoderConfig:a})),Y_(this._constraints),Y_(this._scalabilityMode),this._optimizationMode,c);return r&&a&&d.setEncoderConfiguration(a),x.debug("clone track from ".concat(this.getTrackId()," to ").concat(c,", clone ").concat(s)),d}bindProcessorContextEvents(){this.processorContext.on(rl.REQUEST_UPDATE_CONSTRAINTS,async(r,s,a)=>{try{const c=Object.assign({},this._originalConstraints,...r);await this.renewMediaStreamTrack(c),s()}catch(c){a(c)}}),this.processorContext.on(rl.REQUEST_CONSTRAINTS,async r=>{r(this._originMediaStreamTrack.getSettings())})}},Un(cl.prototype,"setDevice",[JG,QG],Object.getOwnPropertyDescriptor(cl.prototype,"setDevice"),cl.prototype),Un(cl.prototype,"setEnabled",[ZG,eH,tH],Object.getOwnPropertyDescriptor(cl.prototype,"setEnabled"),cl.prototype),Un(cl.prototype,"setEncoderConfiguration",[nH,rH],Object.getOwnPropertyDescriptor(cl.prototype,"setEncoderConfiguration"),cl.prototype),Un(cl.prototype,"close",[iH],Object.getOwnPropertyDescriptor(cl.prototype,"close"),cl.prototype),cl);function t2(t,r,s,a){s.optimizationMode&&(a&&a.width&&a.height?(s.encoderConfig=Ur(Ur({},a),{},{bitrateMin:a.bitrateMin,bitrateMax:a.bitrateMax}),s.optimizationMode!=="motion"&&s.optimizationMode!=="detail"||(r.contentHint=s.optimizationMode,r.contentHint===s.optimizationMode?x.debug("[".concat(t,"] set content hint to"),s.optimizationMode):x.debug("[".concat(t,"] set content hint failed")))):x.warning("[".concat(t,"] can not apply optimization mode bitrate config, no encoderConfig")))}var sH,oH,aH,cH,Vl,lH,uH,dH,hH,pH,fH,Ao;class mH extends S8{getUserId(){return this._userId}constructor(r,s,a,c){super(r,"track-".concat(r.kind,"-").concat(s,"-").concat(c.clientId,"_").concat(mr(5,""))),Ie(this,"_userId",void 0),Ie(this,"_uintId",void 0),Ie(this,"_isDestroyed",!1),Ie(this,"store",void 0),Ie(this,"processor",void 0),Ie(this,"processorContext",void 0),this._userId=s,this._uintId=a,this.store=c}_updateOriginMediaStreamTrack(r){this._originMediaStreamTrack=r,this._mediaStreamTrack=r,this._updatePlayerSource(),this.processor&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this.processorContext})}_destroy(){this._isDestroyed=!0,x.info("[".concat(this.getTrackId(),"] is destroyed")),this.stop(),super.close()}getProcessorStats(){return this.processorContext.gatherStats()}getProcessorUsage(){return this.processorContext.gatherUsage()}}let cS=(sH=Ht({argsMap:(t,r,s)=>[t.getTrackId(),typeof r=="string"?r:r instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",s]}),oH=Ht({argsMap:t=>[t.getTrackId()]}),aH=Ht({argsMap:(t,r)=>[t.getTrackId(),r.name]}),cH=Ht({argsMap:t=>[t.getTrackId()]}),Un((Vl=class extends mH{get isPlaying(){return!(!this._player||this._player.videoElementStatus!==Io.PLAYING)}get __className__(){return"RemoteVideoTrack"}constructor(t,r,s,a){super(t,r,s,a),Ie(this,"_videoVisibleTimer",null),Ie(this,"_previousVideoVisibleStatus",void 0),Ie(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),Ie(this,"trackMediaType",iS.VIDEO),Ie(this,"_videoWidth",void 0),Ie(this,"_videoHeight",void 0),Ie(this,"_player",void 0),Ie(this,"processorDestination",void 0),Ie(this,"processorContext",void 0),this.updateMediaStreamTrackResolution(),this.processorContext=new D8(this.getTrackId(),"remote"),this.processorDestination=new N8(this.processorContext),this.bindProcessorDestinationEvents()}getStats(){return Xm(()=>{x.warning("[deprecated] RemoteVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteVideoStats instead")},"remoteVideoTrackGetStatsWarning"),Zc(this,It.GET_STATS)||Ur({},E8)}play(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof t=="string"){const a=document.getElementById(t);a?t=a:(x.warning("[".concat(this.getTrackId(),'] can not find "#').concat(t,'" element, use document.body')),t=document.body)}x.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(r));const s=Ur(Ur({fit:"cover"},r),{},{trackId:this.getTrackId(),element:t});this._player?this._player.updateConfig(s):(t instanceof HTMLVideoElement?this._player=new ZL(s):this._player=new RG(s),this._player.updateVideoTrack(this._mediaStreamTrack),this._player.onFirstVideoFrameDecoded=()=>{this.store.subscribe(this.getUserId(),"video",void 0,void 0,Date.now()),this.safeEmit(rS.FIRST_FRAME_DECODED)},this._player.onVideoStateChanged=a=>{this.safeEmit(rS.VIDEO_STATE_CHANGED,a)}),this._player.play(this.store.sessionId||void 0),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const a=this.getVideoElementVisibleStatus();this.safeEmit(rS.VIDEO_ELEMENT_VISIBLE_STATUS,a)}catch{}},oe("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,x.debug("[".concat(this.getTrackId(),"] stop video playback")))}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}updateMediaStreamTrackResolution(){M8(this._originMediaStreamTrack).then(t=>{let[r,s]=t;this._videoHeight=s,this._videoWidth=r}).catch(oP)}_updatePlayerSource(){x.debug("[".concat(this.getTrackId(),"] update player source track")),this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}getVideoElementVisibleStatus(){try{var t,r;const s=this==null||(t=this._player)===null||t===void 0?void 0:t.getContainerElement(),a={track:this,element:this==null||(r=this._player)===null||r===void 0?void 0:r.getVideoElement(),slot:s==null?void 0:s.parentElement},{element:c,slot:d}=a;if(this.isPlaying&&c instanceof HTMLVideoElement&&d instanceof HTMLElement){const h=Uz.checkOneElementVisible(c),m=Object.assign({},h);if(m.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=m.visible;const y=Nt.reportApiInvoke(null,{tag:Kr.TRACER,name:Ni.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});m.visible?y.onSuccess("Video is visible"):y.onSuccess("Invisible because of ".concat(m.reason))}return m}return}catch(s){throw new Le(te.GET_VIDEO_ELEMENT_VISIBLE_ERROR,s.message)}}pipe(t){if(this.processor===t)return t;if(t._source)throw new Le(te.INVALID_OPERATION,"Processor ".concat(t.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=t,this.processor._source=this,t.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),t}unpipe(){if(!this.processor)return;const t=this.processor;this.processor._source=void 0,this.processor=void 0,t.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(qo.ON_TRACK,async t=>{t?t!==this._mediaStreamTrack&&(this._mediaStreamTrack=t,this._updatePlayerSource()):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(qo.ON_TRACK)}_destroy(){super._destroy(),this.unbindProcessorDestinationEvents()}_onSei(t){this.emit(Z_.SEI_RECEIVED,t)}}).prototype,"play",[sH],Object.getOwnPropertyDescriptor(Vl.prototype,"play"),Vl.prototype),Un(Vl.prototype,"stop",[oH],Object.getOwnPropertyDescriptor(Vl.prototype,"stop"),Vl.prototype),Un(Vl.prototype,"pipe",[aH],Object.getOwnPropertyDescriptor(Vl.prototype,"pipe"),Vl.prototype),Un(Vl.prototype,"unpipe",[cH],Object.getOwnPropertyDescriptor(Vl.prototype,"unpipe"),Vl.prototype),Vl),lS=(lH=Ht({argsMap:(t,r)=>[t.getTrackId(),r],throttleTime:300}),uH=Ht({argsMap:(t,r)=>[t.getTrackId(),r]}),dH=Ht({argsMap:t=>[t.getTrackId()]}),hH=Ht({argsMap:t=>[t.getTrackId()]}),pH=Ht({argsMap:(t,r)=>[t.getTrackId(),r.name]}),fH=Ht({argsMap:t=>[t.getTrackId()]}),Un((Ao=class extends mH{get isPlaying(){return this._useAudioElement?Sa.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"RemoteAudioTrack"}constructor(t,r,s,a){super(t,r,s,a),Ie(this,"trackMediaType",iS.AUDIO),Ie(this,"_source",void 0),Ie(this,"_useAudioElement",!0),Ie(this,"_volume",100),Ie(this,"processorContext",void 0),Ie(this,"processorDestination",void 0),Ie(this,"_played",!1),Ie(this,"_bypassWebAudio",!1),oe("DISABLE_WEBAUDIO")?(this._source=new JL,this._bypassWebAudio=!0,this._useAudioElement=!0):(this._source=new C8(t,!0),oe("REMOTE_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1)),this._source.once(nl.RECEIVE_TRACK_BUFFER,()=>{this.safeEmit(rS.FIRST_FRAME_DECODED)}),this.processorContext=new L8(this._source.context,this.getTrackId(),"remote"),this.processorDestination=new x8(this.processorContext),this.bindProcessorDestinationEvents(),this._source.on(nl.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:this.processorContext})})}setAudioFrameCallback(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!t)return this._source.removeAllListeners(nl.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(r),this._source.removeAllListeners(nl.ON_AUDIO_BUFFER),this._source.on(nl.ON_AUDIO_BUFFER,s=>t(s))}setVolume(t){this._volume=t,this._useAudioElement?Sa.setVolume(this.getTrackId(),t):this._source.setVolume(t/100)}async setPlaybackDevice(t){if(!this._useAudioElement||!m8())throw new Le(te.NOT_SUPPORTED,"your browser does not support setting the audio output device");await Sa.setSinkID(this.getTrackId(),t)}getVolumeLevel(){return this._source.getAccurateVolumeLevel()}getStats(){return Xm(()=>{x.warning("[deprecated] RemoteAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteAudioStats instead")},"remoteAudioTrackGetStatsWarning"),Zc(this,It.GET_STATS)||Ur({},y8)}play(){x.debug("[".concat(this.getTrackId(),"] start audio playback")),this._played=!0,this._useAudioElement?(x.debug("[".concat(this.getTrackId(),"] use audio element to play")),Sa.play(this._mediaStreamTrack,this.getTrackId(),this._volume,this.store.sessionId||void 0)):this._source.play()}stop(){x.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._played=!1,this._useAudioElement?Sa.stop(this.getTrackId()):this._source.stop()}_destroy(){super._destroy(),this._played=!1,this.unbindProcessorDestinationEvents(),this._source.destroy()}_isFreeze(){return this._source.isFreeze}_updatePlayerSource(){let t=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];x.debug("[".concat(this.getTrackId(),"] update player source track")),t&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&Sa.updateTrack(this.getTrackId(),this._mediaStreamTrack)}pipe(t){if(this._bypassWebAudio)throw new Le(te.NOT_SUPPORTED,"can not pipe extension when WebAudio disabled");if(this.processor===t)return t;if(t._source)throw new Le(te.INVALID_OPERATION,"Processor ".concat(t.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=t,this.processor._source=this,t.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),t}unpipe(){var t;if(this._bypassWebAudio)throw new Le(te.NOT_SUPPORTED,"can not unpipe extension when WebAudio disabled");if(!this.processor)return;const r=this.processor;(t=this._source.processSourceNode)===null||t===void 0||t.disconnect(),this.processor._source=!1,this.processor=void 0,r.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(qo.ON_TRACK,async t=>{t?t!==this._mediaStreamTrack&&(this._mediaStreamTrack=t,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(t)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())}),this.processorDestination.on(qo.ON_NODE,t=>{this._source.processedNode=t;const r=!t;this._useAudioElement!==r&&(this._played?(this.stop(),this._useAudioElement=r,this.play()):this._useAudioElement=r)})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(qo.ON_TRACK),this.processorDestination.removeAllListeners(qo.ON_NODE)}}).prototype,"setVolume",[lH],Object.getOwnPropertyDescriptor(Ao.prototype,"setVolume"),Ao.prototype),Un(Ao.prototype,"setPlaybackDevice",[uH],Object.getOwnPropertyDescriptor(Ao.prototype,"setPlaybackDevice"),Ao.prototype),Un(Ao.prototype,"play",[dH],Object.getOwnPropertyDescriptor(Ao.prototype,"play"),Ao.prototype),Un(Ao.prototype,"stop",[hH],Object.getOwnPropertyDescriptor(Ao.prototype,"stop"),Ao.prototype),Un(Ao.prototype,"pipe",[pH],Object.getOwnPropertyDescriptor(Ao.prototype,"pipe"),Ao.prototype),Un(Ao.prototype,"unpipe",[fH],Object.getOwnPropertyDescriptor(Ao.prototype,"unpipe"),Ao.prototype),Ao);const gf=new class extends Br{get visibility(){return document.visibilityState}get lastHiddenTime(){return this._lastHiddenTime}get lastVisibleTime(){return this._lastVisibleTime}constructor(){super(),Ie(this,"_lastHiddenTime",0),Ie(this,"_lastVisibleTime",0),document.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"?this._lastHiddenTime=performance.now():this._lastVisibleTime=performance.now(),x.debug("current web page is ".concat(document.visibilityState)),this.emit("VISIBILITY_CHANGE",document.visibilityState)})}};class gH extends Br{constructor(r,s){super(),Ie(this,"trackMediaType",iS.DATA),Ie(this,"_version",1),Ie(this,"_type",3),Ie(this,"_config",void 0),Ie(this,"_originDataChannel",void 0),Ie(this,"_dataStreamPacketHeader",new ArrayBuffer(4)),Ie(this,"_dataStreamPacketHandler",{serialize:a=>a,deserialize:a=>a}),Ie(this,"_datachannelEventMap",new Map),this._config=r,s&&(this._originDataChannel=s,this._bandDataChannelEvents(s)),this._initPacketHeader()}useDataStream(r){this._dataStreamPacketHandler=r}get id(){return this._config.id}get ordered(){return this._config.ordered}get maxRetransmits(){return oe("DATASTREAM_MAX_RETRANSMITS")}get metadata(){return this._config.metadata}get readyState(){var r,s;return(r=(s=this._originDataChannel)===null||s===void 0?void 0:s.readyState)!==null&&r!==void 0?r:"connecting"}get _originDataChannelId(){var r,s;return(r=(s=this._originDataChannel)===null||s===void 0?void 0:s.id)!==null&&r!==void 0?r:null}getChannelId(){return this.id}getConfig(){return this._config}_close(){this._originDataChannel&&(this._unbindDataChannelEvents(this._originDataChannel),this._originDataChannel=void 0)}async _waitTillOpen(){return new pt((r,s)=>{if(this._originDataChannel){this._originDataChannel.readyState==="open"&&r();const a=setTimeout(()=>{var c;s(new Le(te.DATACHANNEL_CONNECTION_TIMEOUT,"Cannot create datachannel, id: ".concat((c=this._originDataChannel)===null||c===void 0?void 0:c.id)))},1e4);this._originDataChannel.onopen=()=>{clearTimeout(a),this._originDataChannel&&this._bandDataChannelEvents(this._originDataChannel),r()},this._originDataChannel.onerror=()=>{throw clearTimeout(a),new Le(te.DATACHANNEL_CONNECTION_TIMEOUT)}}else s(new Le(te.DATACHANNEL_CONNECTION_TIMEOUT,"cannot find dataChannel"))})}_updateOriginDataChannel(r){this._originDataChannel=r,this._bandDataChannelEvents(r)}_initPacketHeader(){const r=new DataView(this._dataStreamPacketHeader);r.setUint16(0,this._version),r.setUint8(2,this._type),r.setUint8(3,this._config.id)}_bandDataChannelEvents(r){this._unbindDataChannelEvents(r),[mP.OPEN,mP.CLOSE,mP.ERROR].forEach(s=>{const a=()=>{this.emit(s)};this._datachannelEventMap.set(s,a),r.addEventListener(s,a)})}_unbindDataChannelEvents(r){Array.from(this._datachannelEventMap.entries()).forEach(s=>{let[a,c]=s;r.removeEventListener(a,c)}),this._datachannelEventMap.clear()}}class Fme extends gH{constructor(r){super(r),Ie(this,"_messageListener",void 0),this._messageListener=s=>{if(s.data.byteLength<this._dataStreamPacketHeader.byteLength)throw Error("invalid byteLength: the byte length must exceed "+this._dataStreamPacketHeader.byteLength);const a=s.data.slice(0,this._dataStreamPacketHeader.byteLength),c=new DataView(a).getUint8(3);if(c!==this.id)return void(oe("SHOW_DATASTREAM2_LOG")&&x.debug("invalid datachannel id: ".concat(c," !== ").concat(this.id)));let d=s.data.slice(this._dataStreamPacketHeader.byteLength);d=this._dataStreamPacketHandler.deserialize(d),this.emit(mP.MESSAGE,d)}}_updateOriginDataChannel(r){super._updateOriginDataChannel(r),this._bandRemoteDataChannelEvents()}_close(){this._originDataChannel&&(this._originDataChannel.removeEventListener("message",this._messageListener),super._close())}_bandRemoteDataChannelEvents(){this._originDataChannel&&this._originDataChannel.addEventListener("message",this._messageListener)}}class Bme extends gH{send(r){if(this._originDataChannel){let s=r;s=this._dataStreamPacketHandler.serialize(r);const a=new Uint8Array(this._dataStreamPacketHeader.byteLength+s.byteLength);a.set(new Uint8Array(this._dataStreamPacketHeader),0),a.set(new Uint8Array(s),this._dataStreamPacketHeader.byteLength),this._originDataChannel.send(a.buffer)}}}function EP(){const t=new Blob([atob("ZnVuY3Rpb24gdCh0LGUsbil7bGV0IGE9bmV3IFVpbnQ4QXJyYXkodCxlLG4pLG89W10scj0wO2Zvcig7by5sZW5ndGg8bjspciszPG4mJjA9PT1hW3JdJiYwPT09YVtyKzFdJiYzPT09YVtyKzJdJiYoMD09PWFbciszXXx8MT09PWFbciszXXx8Mj09PWFbciszXXx8Mz09PWFbciszXSk/KG8ucHVzaChhW3JdLGFbcisxXSxhW3IrM10pLHIrPTQpOihvLnB1c2goYVtyXSkscisrKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkobyl9ZnVuY3Rpb24gZSh0LGUpe2NvbnN0IG49ZnVuY3Rpb24odCl7Y29uc3QgZT10Lmxlbmd0aDtsZXQgbj1bXSxhPTA7Zm9yKDthPGU7KWErMjxlJiYwPT09dFthXSYmMD09PXRbYSsxXSYmKDA9PT10W2ErMl18fDE9PT10W2ErMl18fDI9PT10W2ErMl18fDM9PT10W2ErMl0pPyhuLnB1c2godFthXSx0W2ErMV0sMyx0W2ErMl0pLGErPTMpOihuLnB1c2godFthXSksYSsrKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkobil9KGUpLGE9bi5sZW5ndGgsbz1NYXRoLmZsb29yKGEvMjU1KSxyPWElMjU1LHM9bmV3IFVpbnQ4QXJyYXkoNitvKzErYSt0LmJ5dGVMZW5ndGgpO3NbMF09MCxzWzFdPTAsc1syXT0wLHNbM109MSxzWzRdPTYsc1s1XT0xMDE7bGV0IGk9MDtmb3IoO2k8bzspc1s2K2ldPTI1NSxpKys7cmV0dXJuIHNbNitpXT1yLGkrKyxzLnNldChuLDYraSkscy5zZXQobmV3IFVpbnQ4QXJyYXkodCksNitpK2EpLHMuYnVmZmVyfWNvbnN0IG49NzEsYT0xLG89MixyPTEscz0yO3ZhciBpOyFmdW5jdGlvbih0KXt0W3QuQVVESU9fTEVWRUw9MV09IkFVRElPX0xFVkVMIix0W3QuTUVUQURBVEE9Ml09Ik1FVEFEQVRBIix0W3QuQVVESU9fNjRfQklUX1BUUz0zXT0iQVVESU9fNjRfQklUX1BUUyJ9KGl8fChpPXt9KSk7bmF2aWdhdG9yLnVzZXJBZ2VudC5pbmRleE9mKCJTYWZhcmkiKT4tMSYmLTE9PT1uYXZpZ2F0b3IudXNlckFnZW50LmluZGV4T2YoIkNocm9tZSIpJiYoc2VsZi5vbnJ0Y3RyYW5zZm9ybT1mPT57Y29uc3QgdT1mLnRyYW5zZm9ybWVyO2xldCBkPVtdLGw9W107dS5vcHRpb25zLnBvcnQub25tZXNzYWdlPXQ9Pnt0LmRhdGEuc2VpJiZkLnB1c2godC5kYXRhLnNlaSksdC5kYXRhLm1ldGFkYXRhJiZsLnB1c2godC5kYXRhLm1ldGFkYXRhKX0sc2VsZi5wb3N0TWVzc2FnZSgic3RhcnRlZCIpO2NvbnN0IGc9dS5yZWFkYWJsZS5nZXRSZWFkZXIoKSxjPXUud3JpdGFibGUuZ2V0V3JpdGVyKCk7InNlaS1yeCI9PT11Lm9wdGlvbnMubmFtZT9mdW5jdGlvbiBlKG4pe2cucmVhZCgpLnRoZW4oKGE9PntpZighYS5kb25lKXtpZihhLnZhbHVlIGluc3RhbmNlb2YgUlRDRW5jb2RlZFZpZGVvRnJhbWUpe2NvbnN0IGU9ZnVuY3Rpb24oZSl7Y29uc3Qgbj1uZXcgRGF0YVZpZXcoZS5kYXRhKTtsZXQgYT0wO2Zvcig7YSs0PGUuZGF0YS5ieXRlTGVuZ3RoOyl7aWYoMD09PW4uZ2V0VWludDgoYSswKSYmMD09PW4uZ2V0VWludDgoYSsxKSYmMD09PW4uZ2V0VWludDgoYSsyKSYmMT09PW4uZ2V0VWludDgoYSszKSYmNj09PW4uZ2V0VWludDgoYSs0KSl7bGV0IG89YSs2LHI9MCxzPTA7Zm9yKDsyNTU9PT0ocz1uLmdldFVpbnQ4KG8rKykpOylyKz0yNTU7cis9cztjb25zdCBpPXQoZS5kYXRhLG8scik7cmV0dXJuIG5ldyBVaW50OEFycmF5KGkpfWErK31yZXR1cm4gbnVsbH0oYS52YWx1ZSk7ZSYmbi5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3NlaTplfSl9Yy53cml0ZShhLnZhbHVlKSxuLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSxlKG4pfX0pKX0odSk6InNlaS10eCI9PT11Lm9wdGlvbnMubmFtZT9mdW5jdGlvbiB0KG4pe2cucmVhZCgpLnRoZW4oKGE9PntpZighYS5kb25lKXtpZihhLnZhbHVlIGluc3RhbmNlb2YgUlRDRW5jb2RlZFZpZGVvRnJhbWUpe2NvbnN0IHQ9ZC5zaGlmdCgpO3QmJihhLnZhbHVlLmRhdGE9ZShhLnZhbHVlLmRhdGEsdCkpfWMud3JpdGUoYS52YWx1ZSksbi5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3RyYW5zZm9ybWVkOiEwfSksdChuKX19KSl9KHUpOiJhdWRpby1tZXRhZGF0YS1yeCI9PT11Lm9wdGlvbnMubmFtZT9mdW5jdGlvbiB0KGUpe2cucmVhZCgpLnRoZW4oKGY9PntpZighZi5kb25lKXtpZihmLnZhbHVlIGluc3RhbmNlb2YgUlRDRW5jb2RlZEF1ZGlvRnJhbWUpe2NvbnN0IHQ9ZnVuY3Rpb24odCxlPSExKXtjb25zdCBmPXQuZ2V0VWludDgoMCk7aWYoZiE9PW4pcmV0dXJuO2NvbnN0IHU9dC5nZXRVaW50MTYoMSksZD1hK28rdSxsPW5ldyBVaW50OEFycmF5KHQuYnl0ZUxlbmd0aC1kKTtsLnNldChuZXcgVWludDhBcnJheSh0LmJ1ZmZlcixkLHQuYnl0ZUxlbmd0aC1kKSk7Y29uc3QgZz17bTpmLHRsdkxlbjp1LHRsdjpbXSxmcmFtZTpsfTtsZXQgYz1hK287Zm9yKDtjPGQ7KXtjb25zdCBuPXQuZ2V0VWludDgoYyksYT10LmdldFVpbnQxNihjK3IpLG89citzO2lmKG49PT1pLkFVRElPX0xFVkVMKXtsZXQgcj10LmdldFVpbnQ4KGMrbyk7Zm9yKGxldCBlPTE7ZTxhO2UrKylyPXI8PDh8dC5nZXRVaW50OChjK28rZSk7Zy50bHYucHVzaCh7dGFnOm4sbGVuZ3RoOmEsdmFsdWU6ZT8xMjdecj4+MToxMjcmcn0pfWVsc2UgaWYobj09PWkuTUVUQURBVEF8fG49PT1pLkFVRElPXzY0X0JJVF9QVFMpe2NvbnN0IGU9bmV3IFVpbnQ4QXJyYXkoYSk7Zm9yKGxldCBuPTA7bjxhO24rKyllW25dPXQuZ2V0VWludDgoYytvK24pO2cudGx2LnB1c2goe3RhZzpuLGxlbmd0aDphLHZhbHVlOmV9KX1jKz1vK2F9cmV0dXJuIGd9KG5ldyBEYXRhVmlldyhmLnZhbHVlLmRhdGEpKTtpZih0KXtjb25zdCBuPXQudGx2LmZpbmQoKHQ9PnQudGFnPT09aS5NRVRBREFUQXx8dC50YWc9PT1pLkFVRElPXzY0X0JJVF9QVFMpKTtuJiZuLnZhbHVlIGluc3RhbmNlb2YgVWludDhBcnJheSYmZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe21ldGFkYXRhOm4udmFsdWV9KSxmLnZhbHVlLmRhdGE9dC5mcmFtZS5idWZmZXJ9fWMud3JpdGUoZi52YWx1ZSksZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3RyYW5zZm9ybWVkOiEwfSksdChlKX19KSl9KHUpOiJhdWRpby1tZXRhZGF0YS10eCI9PT11Lm9wdGlvbnMubmFtZSYmZnVuY3Rpb24gdChlKXtnLnJlYWQoKS50aGVuKChmPT57aWYoIWYuZG9uZSl7aWYoZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe2dldE1ldGFkYXRhOiEwfSksZi52YWx1ZSBpbnN0YW5jZW9mIFJUQ0VuY29kZWRBdWRpb0ZyYW1lKXtjb25zdCB0PWwuc2hpZnQoKTt0JiYoZi52YWx1ZS5kYXRhPWZ1bmN0aW9uKHQsZSxpKXtjb25zdCBmPWkuYnl0ZUxlbmd0aCx1PWYrcitzLGQ9YStvK3UsbD1uZXcgQXJyYXlCdWZmZXIodC5ieXRlTGVuZ3RoK2QpLGc9bmV3IERhdGFWaWV3KGwpO2cuc2V0VWludDgoMCxuKSxnLnNldFVpbnQxNigxLHUpLGcuc2V0VWludDgoMyxlKSxnLnNldFVpbnQxNig0LGYpO2ZvcihsZXQgdD0wO3Q8Zjt0KyspZy5zZXRVaW50OCg2K3QsaVt0XSk7Y29uc3QgYz1uZXcgVWludDhBcnJheShnLmJ1ZmZlcik7cmV0dXJuIGMuc2V0KG5ldyBVaW50OEFycmF5KHQpLGQpLGMuYnVmZmVyfShmLnZhbHVlLmRhdGEsaS5BVURJT182NF9CSVRfUFRTLHQpKX1jLndyaXRlKGYudmFsdWUpLGUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHt0cmFuc2Zvcm1lZDohMH0pLHQoZSl9fSkpfSh1KX0sc2VsZi5wb3N0TWVzc2FnZSgicmVnaXN0ZXJlZCIpKTsK")],{type:"text/javascript"});return setTimeout(()=>EA.revokeObjectURL(t),0),new Worker(EA.createObjectURL(t))}const _H=71,n2=1,r2=2,i2=1,yH=2;var _f=function(t){return t[t.AUDIO_LEVEL=1]="AUDIO_LEVEL",t[t.METADATA=2]="METADATA",t[t.AUDIO_64_BIT_PTS=3]="AUDIO_64_BIT_PTS",t}(_f||{});function EH(t){let r=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const s=t.getUint8(0);if(s!==_H)return;const a=t.getUint16(1),c=n2+r2+a,d=new Uint8Array(t.byteLength-c);d.set(new Uint8Array(t.buffer,c,t.byteLength-c));const h={m:s,tlvLen:a,tlv:[],frame:d};let m=n2+r2;for(;m<c;){const y=t.getUint8(m),v=t.getUint16(m+i2),w=i2+yH;if(y===_f.AUDIO_LEVEL){let R=t.getUint8(m+w);for(let O=1;O<v;O++)R=R<<8|t.getUint8(m+w+O);h.tlv.push({tag:y,length:v,value:r?127^R>>1:127&R})}else if(y===_f.METADATA||y===_f.AUDIO_64_BIT_PTS){const R=new Uint8Array(v);for(let O=0;O<v;O++)R[O]=t.getUint8(m+w+O);h.tlv.push({tag:y,length:v,value:R})}m+=w+v}return h}const vP=new Map,SP=127,ny=1e-10,s2=139/13,bP=new Map;function o2(t,r,s){const a="".concat(t,"-").concat(r,"-").concat(s);let c=0;return bP.has(a)?c=bP.get(a):(c=Math.log(function(h,m){const y=h-m;m<y&&(m=y);let v=1;for(let w=h,R=1;w>m;w--,R++)v=v*w/R;return v}(r,t))+t*Math.log(.5)+(r-t)*Math.log(1-.5)-Math.log(s)+s*t,bP.set(a,c)),c<ny&&(c=ny),c}function vH(t,r,s){const a=r.length,c=t.length/a;let d=!1;for(let h=0,m=0;h<a;h++){let y=0;for(let v=m+c;m<v;m++)t[m]>s&&y++;r[h]!==y&&(r[h]=y,d=!0)}return d}window.cache=bP;let Wme=0;class SH{constructor(r){Ie(this,"id",void 0),Ie(this,"immediates",[]),Ie(this,"lastNonSilence",-1),Ie(this,"immediateSpeechActivityScore",ny),Ie(this,"lastLevelChangedTime",Date.now()),Ie(this,"levels",[]),Ie(this,"longs",[]),Ie(this,"longSpeechActivityScore",ny),Ie(this,"mediums",[]),Ie(this,"mediumSpeechActivityScore",ny),Ie(this,"minLevel",0),Ie(this,"nextMinLevel",0),Ie(this,"nextMinLevelWindowLength",0),Ie(this,"energyScore",0),this.id=r||"".concat(Wme++),this.immediates.length=50,this.mediums.length=10,this.longs.length=1,this.levels.length=this.immediates.length}computeImmediates(){const r=this.immediates,s=this.levels,a=this.minLevel+s2;let c=!1;for(let d=0;d<r.length;++d){let h=s[d];h<a&&(h=0);const m=Math.floor(h/s2);r[d]!==m&&(r[d]=m,c=!0)}return c}computeLongs(){return vH(this.mediums,this.longs,4)}computeMediums(){return vH(this.immediates,this.mediums,7)}evaluateImmediateSpeechActivityScore(){this.immediateSpeechActivityScore=o2(this.immediates[0],13,.78)}evaluateLongSpeechActivityScore(r){this.longSpeechActivityScore=o2(this.longs[0],10,47),this.longSpeechActivityScore>ny&&(this.lastNonSilence=r)}evaluateMediumSpeechActivityScore(){this.mediumSpeechActivityScore=o2(this.mediums[0],5,24)}evaluateSpeechActivityScores(r){this.computeImmediates()&&(this.evaluateImmediateSpeechActivityScore(),this.computeMediums()&&(this.evaluateMediumSpeechActivityScore(),this.computeLongs()&&this.evaluateLongSpeechActivityScore(r)))}getLastLevelChangedTime(){return this.lastLevelChangedTime}getLevels(){var r;return"[".concat(wm(r=[...this.levels]).call(r).join(),"]")}getSpeechActivityScore(r){switch(r){case 0:return this.immediateSpeechActivityScore;case 1:return this.mediumSpeechActivityScore;case 2:return this.longSpeechActivityScore;default:throw new Error("interval "+r)}}levelChanged(r,s){if(this.lastLevelChangedTime<=s){this.lastLevelChangedTime=s;let a=r;return r<0&&(a=0),r>SP&&(a=SP),this.levels.unshift(a),this.levels.length>this.immediates.length&&this.levels.pop(),this.updateMinLevel(a),a>=this.minLevel+s2?a:a/2}return-1}levelTimedOut(){this.levelChanged(0,this.lastLevelChangedTime)}updateMinLevel(r){if(r!==0){if(this.minLevel===0||this.minLevel>r)return this.minLevel=r,this.nextMinLevel=0,void(this.nextMinLevelWindowLength=0);if(this.nextMinLevel===0)return this.nextMinLevel=r,void(this.nextMinLevelWindowLength=1);if(this.nextMinLevel>r&&(this.nextMinLevel=r),this.nextMinLevelWindowLength++,this.nextMinLevelWindowLength>=750){let s=Math.sqrt(this.minLevel*this.nextMinLevel);s<0?s=0:s>SP&&(s=SP),this.minLevel=s,this.nextMinLevel=0,this.nextMinLevelWindowLength=0}}}}class zme{constructor(r){Ie(this,"algorithm",void 0),this.algorithm=r}execute(){let r=!this.algorithm;if(!r)try{const s=this.algorithm.runInDecisionMaker(this);s<=0?r=!0:setTimeout(this.execute.bind(this),s)}catch{r=!0}r&&this.algorithm&&this.algorithm.decisionMakerExited(this)}}class a2{constructor(r,s,a){Ie(this,"isDominant",void 0),Ie(this,"energyRanking",void 0),Ie(this,"energyScore",void 0),this.isDominant=r,this.energyRanking=s,this.energyScore=a}}class Gme extends Br{constructor(r){super(),Ie(this,"dominantId",null),Ie(this,"lastDecisionTime",0),Ie(this,"lastLevelChangedTime",0),Ie(this,"lastLevelIdleTime",0),Ie(this,"relativeSpeechActivities",[]),Ie(this,"speakers",new Map),Ie(this,"enableSilence",!1),Ie(this,"timeoutToSilenceInterval",0),Ie(this,"decisionMaker",null),Ie(this,"loudest",[]),Ie(this,"numLoudestToTrack",3),Ie(this,"energyExpireTimeMs",250),Ie(this,"energyAlphaPct",50),this.timeoutToSilenceInterval=r,this.enableSilence=r>0,this.relativeSpeechActivities.length=3}setLoudestConfig(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:3,s=arguments.length>1?arguments[1]:void 0,a=arguments.length>2?arguments[2]:void 0;this.numLoudestToTrack=r,s!=null&&(this.energyExpireTimeMs=s),a!=null&&(this.energyAlphaPct=a),this.loudest.length>r&&this.loudest.splice(r)}getDominantSpeaker(){return this.dominantId}isAmongLoudest(r){return this.loudest.some(s=>s.id===r)}levelChanged(r,s){const a=Date.now(),c=this.getOrCreateSpeaker(r);this.lastLevelChangedTime<a&&(this.lastLevelChangedTime=a,this.maybeStartDecisionMaker());const d=c.levelChanged(s,a);return this.updateLoudestList(c,d,a)}runInDecisionMaker(r){return this.decisionMaker!==r||this.lastDecisionTime>0&&this.lastDecisionTime-this.lastLevelChangedTime>=15e3?-1:this._runInDecisionMaker()}decisionMakerExited(r){this.decisionMaker===r&&(this.decisionMaker=null)}destroy(){this.decisionMaker=null,this.loudest.length=0,this.speakers.clear(),this.removeAllListeners()}addSpeakers(r){r.forEach(s=>{this.speakers.has(s.id)||this.speakers.set(s.id,s)})}removeSpeakers(r){r.forEach(s=>{this.speakers.delete(s.id)})}getOrCreateSpeaker(r){let s=this.speakers.get(r);return s||(s=new SH(r),this.speakers.set(r,s),this.maybeStartDecisionMaker()),s}updateLoudestList(r,s,a){const c=r.id===this.dominantId;if(s<0){let y=0;for(;y<this.loudest.length&&this.loudest[y]!==r;)++y;return new a2(c,y,r.energyScore)}if(r.energyScore=Math.floor((this.energyAlphaPct*s+(100-this.energyAlphaPct)*r.energyScore+50)/100),this.numLoudestToTrack===0)return new a2(c,0,r.energyScore);const d=a-this.energyExpireTimeMs;let h=0;for(;h<this.loudest.length;){const y=this.loudest[h];if(y.getLastLevelChangedTime()<d&&this.loudest.length>=this.numLoudestToTrack)this.loudest.splice(h,1);else if(y.id!==r.id)++h;else if(this.loudest.splice(h,1),this.loudest.length<this.numLoudestToTrack)break}let m=0;for(;m<this.loudest.length&&!(this.loudest[m].energyScore<r.energyScore);)++m;return m<this.numLoudestToTrack&&(this.loudest.splice(m,0,r),this.loudest.length>this.numLoudestToTrack&&this.loudest.splice(this.numLoudestToTrack,1)),new a2(c,m,r.energyScore)}maybeStartDecisionMaker(){!this.decisionMaker&&this.speakers.size>0&&(this.decisionMaker=new zme(this),this.decisionMaker.execute())}makeDecision(r){let s=null,a=null;const c=this.speakers.size;let d=null;if(c===0)d=null;else if(c===1){var h;const m=Jc(h=this.speakers).call(h).next().value;this.enableSilence&&m&&(d=m.id,m.evaluateSpeechActivityScores(r),r-m.lastNonSilence>this.timeoutToSilenceInterval&&(d=null))}else{let m=this.dominantId==null?null:this.speakers.get(this.dominantId);if(m==null){const w=this.speakers.entries().next();w.value&&(d=w.value[0],m=w.value[1])}else d=m.id;m!=null&&m.evaluateSpeechActivityScores(r);const y=this.relativeSpeechActivities;let v=2;for(const w of this.speakers.entries()){const[R,O]=w;if(O===m)continue;O.evaluateSpeechActivityScores(r);for(let W=0;W<y.length;++W){const Q=m==null?ny:m.getSpeechActivityScore(W);y[W]=Math.log(O.getSpeechActivityScore(W)/Q)}const D=y[0],G=y[1],j=y[2];D>3&&G>2&&j>0&&G>v&&(v=G,d=R)}this.enableSilence&&m!=null&&d===m.id&&r-m.lastNonSilence>this.timeoutToSilenceInterval&&(d=null)}d==null&&!this.enableSilence||d===this.dominantId||(s=this.dominantId,this.dominantId=d,a=this.dominantId),a==null&&!this.enableSilence||a===s||this.emit("ActiveSpeakerChanged",a)}_runInDecisionMaker(){const r=Date.now(),s=300-(r-this.lastLevelIdleTime);let a=0;s<=0?(this.lastLevelIdleTime!==0&&this.timeoutIdleLevels(r),this.lastLevelIdleTime=r):a=s;let c=300-(r-this.lastDecisionTime);return c<=0&&(this.lastDecisionTime=r,this.makeDecision(r),c=300-(Date.now()-r)),c>0&&a>c&&(a=c),a}timeoutIdleLevels(r){const s=[];for(const c of Jc(a=this.speakers).call(a)){var a;const d=r-c.getLastLevelChangedTime();36e5<d&&(this.dominantId==null||c.id!==this.dominantId)?s.push(c.id):300<d&&c.levelTimedOut()}s.forEach(c=>this.speakers.delete(c))}}const uS=new Map;let Dd=null,wP=null;const bH=3;let ry=[];const xd=new Map,TP=new Map;class Hme{get samples(){return this.actives+this.inactives}get activeRate(){return this.actives/this.samples}constructor(r,s){Ie(this,"id",void 0),Ie(this,"track",void 0),Ie(this,"score",0),Ie(this,"active",!0),Ie(this,"muted",!1),Ie(this,"timer",0),Ie(this,"actives",0),Ie(this,"inactives",0),this.id=r,this.track=s,this.setActive(xd.size<3)}autoCheckActive(){this.autoSetActive(),this.autoAdjustActive(),this.resetTimer(),this.actives=0,this.inactives=0}autoSetActive(){const r=this.active;this.active=this.activeRate>=.8;const{actives:s,inactives:a}=function(){const c=[],d=[];return Array.from(Jc(xd).call(xd)).forEach(h=>{h.active?c.push(h):d.push(h)}),{actives:c,inactives:d}}();if(s.length>3){let c;s.forEach(d=>{(!c||c.score>d.score)&&(c=d)}),c&&c.setActive(!1)}if(s.length<3&&a.length>0){let c;a.forEach(d=>{(!c||c.score<d.score)&&d.id!==this.id&&(c=d)}),c&&r&&!this.active&&(c.samples>40&&c.activeRate-this.activeRate>.4?c.setActive(!0):this.active=!0)}this.setMuted(!this.active)}setActive(r){this.active=r,this.resetTimer(),this.setMuted(!r)}autoAdjustActive(){this.active?this.autoSwitchToInactive():this.autoSwitchToActive()}autoSwitchToActive(){const r=function(s){let a;return Array.from(Jc(xd).call(xd)).forEach(c=>{!c.active||c.id===s||c.samples<40||(!a||c.score<a.score)&&(a=c)}),a}(this.id);r&&this.activeRate-r.activeRate>.4&&(r.setActive(!1),this.setActive(!0))}autoSwitchToInactive(){const r=function(s){let a;return Array.from(Jc(xd).call(xd)).forEach(c=>{c.active||c.id===s||c.samples<40||(!a||c.score>a.score)&&(a=c)}),a}(this.id);r&&r.activeRate-this.activeRate>.4&&(r.setActive(!0),this.setActive(!1))}addSample(r){r?this.actives+=1:this.inactives+=1,this.samples>66.66666666666667&&this.autoCheckActive()}setMuted(r){this.track&&(this.track.enabled=!r,this.muted=r)}resetTimer(){this.clearTimer(),this.timer=window.setTimeout(()=>{if(this.samples!==0)return this.samples<50?this.resetTimer():void this.autoCheckActive()},1e3)}clearTimer(){this.timer&&(clearTimeout(this.timer),this.timer=0)}}let CP;function wH(t){const r=xd.get(t);r&&(xd.delete(t),r.clearTimer())}const RP=new Map,$me=new Map;function Kme(t,r,s){let a=new Uint8Array(t,r,s),c=[],d=0;for(;c.length<s;)d+3<s&&a[d]===0&&a[d+1]===0&&a[d+2]===3&&(a[d+3]===0||a[d+3]===1||a[d+3]===2||a[d+3]===3)?(c.push(a[d],a[d+1],a[d+3]),d+=4):(c.push(a[d]),d++);return new Uint8Array(c)}const IP=new Map,Ww=new Map;(function(){const t=Ln();Es.getDisplayMedia=!(!navigator.mediaDevices||!navigator.mediaDevices.getDisplayMedia),Es.getStreamFromExtension=t.name===$n.CHROME&&Number(t.version)>34,Es.supportUnifiedPlan=function(){if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;const r=new RTCPeerConnection;let s=!1;try{r.addTransceiver("audio"),s=!0}catch{}return r.close(),s}(),Es.supportMinBitrate=t.name===$n.CHROME||t.name===$n.EDGE,Es.supportSetRtpSenderParameters=function(){const r=Ln();return!!(window.RTCRtpSender&&window.RTCRtpSender.prototype.setParameters&&window.RTCRtpSender.prototype.getParameters)&&(!!pf()||!(!xs()&&!nP())||r.name===$n.FIREFOX&&Number(r.version)>=64)}(),t.name===$n.SAFARI&&(Number(t.version)>=14?Es.supportDualStream=!0:Es.supportDualStream=!1),Es.webAudioMediaStreamDest=function(){const r=Ln();return!(r.name===$n.SAFARI&&Number(r.version)<12)}(),Es.supportReplaceTrack=!!window.RTCRtpSender&&typeof RTCRtpSender.prototype.replaceTrack=="function",Es.supportWebGL=typeof WebGLRenderingContext<"u",Es.supportRequestFrame=!!window.CanvasCaptureMediaStreamTrack,pf()||(Es.webAudioWithAEC=!0),Es.supportShareAudio=function(){const r=Ln();return(r.os===Qi.WIN_10||r.os===Qi.WIN_81||r.os===Qi.WIN_7||r.os===Qi.LINUX||r.os===Qi.MAC_OS||r.os===Qi.CHROMIUM_OS)&&r.name===$n.CHROME&&Number(r.version)>=74}(),Es.supportDataChannel=!!(kw(76)||function(r){const s=Ln();return!(s.name!==$n.FIREFOX||!s.osVersion)&&Number(s.version)>=r}(68)||Az(14)),Es.supportPCSetConfiguration=function(){const r=window.RTCPeerConnection;return!Hr()&&!!r&&r.prototype.setConfiguration instanceof Function}(),Es.supportWebRTCEncodedTransform=function(){const r=Ln();return r.name==="Chrome"&&Number(r.version)>=87||r.name==="Safari"&&Number(r.version)>=15}(),Es.supportWebRTCInsertableStream=function(){const r=Ln();return(r.name===$n.CHROME||r.name===$n.EDGE)&&Number(r.version)>=94&&"MediaStreamTrackGenerator"in window&&"MediaStreamTrackProcessor"in window}(),Es.supportRequestVideoFrameCallback="requestVideoFrameCallback"in HTMLVideoElement.prototype,Es.supportWebCrypto=typeof window<"u"&&window.crypto!==void 0&&window.crypto.subtle!==void 0,sP(()=>{Es.supportDualStreamEncoding=function(){const r=Ln();return!!oe("DISABLE_WEBAUDIO")||r.name==="Safari"&&Number(r.version)>=14||!!(r.name==="Chrome"&&/Windows/i.test(r.os||"")&&Number(r.version)>=100&&oe("CHROME_DUAL_STREAM_USE_ENCODING"))}(),x.debug("browser ua: ",navigator.userAgent),x.info("browser info: ",t),x.info("browser compatibility: ",Es)})})();const qme=["CHINA","GLOBAL"],TH=[[0,1,2,3,4,5,5],[0,2,2,3,4,5,5],[0,3,3,3,4,5,5],[0,4,4,4,4,5,5],[0,5,5,5,5,5,5]],iy=[],dS=[];function sy(t,r){return!!r&&iy.some(s=>s.uid===t&&s.channelName===r)}function c2(){return dS.length>0}var Yme=$6.forEach,CH=Fp("forEach")?[].forEach:function(t){return Yme(this,t,arguments.length>1?arguments[1]:void 0)};Hn({target:"Array",proto:!0,forced:[].forEach!=CH},{forEach:CH});var Xme=yc("Array").forEach,Jme=Fc,Qme=Pi,Zme=P,ege=Xme,l2=Array.prototype,tge={DOMTokenList:!0,NodeList:!0},nge=function(t){var r=t.forEach;return t===l2||Zme(l2,t)&&r===l2.forEach||Qme(tge,Jme(t))?ege:r},rge=l(nge),ige=ra,RH=zc;Hn({target:"Object",stat:!0,forced:u(function(){RH(1)})},{keys:function(t){return RH(ige(t))}});var IH=l(Et.Object.keys),sge=l(SE),oge=l(wE),age=Hn,AH=l_,cge=N_,lge=gt,PH=ge,uge=Ei,dge=we,hge=aA,pge=br,fge=Os,mge=M6("slice"),gge=pge("species"),u2=Array,_ge=Math.max;age({target:"Array",proto:!0,forced:!mge},{slice:function(t,r){var s,a,c,d=dge(this),h=uge(d),m=PH(t,h),y=PH(r===void 0?h:r,h);if(AH(d)&&(s=d.constructor,(cge(s)&&(s===u2||AH(s.prototype))||lge(s)&&(s=s[gge])===null)&&(s=void 0),s===u2||s===void 0))return fge(d,m,y);for(a=new(s===void 0?u2:s)(_ge(y-m,0)),c=0;m<y;m++,c++)m in d&&hge(a,c,d[m]);return a.length=c,a}});var yge=yc("Array").slice,Ege=P,vge=yge,d2=Array.prototype,Sge=function(t){var r=t.slice;return t===d2||Ege(d2,t)&&r===d2.slice?vge:r},bge=l(Sge);function At(t,r,s,a,c){var d,h,m,y={};return rge(d=IH(a)).call(d,function(v){y[v]=a[v]}),y.enumerable=!!y.enumerable,y.configurable=!!y.configurable,("value"in y||y.initializer)&&(y.writable=!0),y=sge(h=oge(m=bge(s).call(s)).call(m)).call(h,function(v,w){return w(t,r,v)||v},y),c&&y.initializer!==void 0&&(y.value=y.initializer?y.initializer.call(c):void 0,y.initializer=void 0),y.initializer===void 0&&(N6(t,r,y),y=null),y}let AP=function(t){return t[t.ACCESS_POINT=101]="ACCESS_POINT",t[t.UNILBS=201]="UNILBS",t[t.STRING_UID_ALLOCATOR=901]="STRING_UID_ALLOCATOR",t}({}),h2=function(t){return t[t.IIIEGAL_APPID=1]="IIIEGAL_APPID",t[t.IIIEGAL_UID=2]="IIIEGAL_UID",t[t.INTERNAL_ERROR=3]="INTERNAL_ERROR",t}({}),Nu=function(t){return t[t.INVALID_VENDOR_KEY=5]="INVALID_VENDOR_KEY",t[t.INVALID_CHANNEL_NAME=7]="INVALID_CHANNEL_NAME",t[t.INTERNAL_ERROR=8]="INTERNAL_ERROR",t[t.NO_AUTHORIZED=9]="NO_AUTHORIZED",t[t.DYNAMIC_KEY_TIMEOUT=10]="DYNAMIC_KEY_TIMEOUT",t[t.NO_ACTIVE_STATUS=11]="NO_ACTIVE_STATUS",t[t.DYNAMIC_KEY_EXPIRED=13]="DYNAMIC_KEY_EXPIRED",t[t.STATIC_USE_DYNAMIC_KEY=14]="STATIC_USE_DYNAMIC_KEY",t[t.DYNAMIC_USE_STATIC_KEY=15]="DYNAMIC_USE_STATIC_KEY",t[t.USER_OVERLOAD=16]="USER_OVERLOAD",t[t.FORBIDDEN_REGION=18]="FORBIDDEN_REGION",t[t.CANNOT_MEET_AREA_DEMAND=19]="CANNOT_MEET_AREA_DEMAND",t}({}),Yo=function(t){return t[t.NO_FLAG_SET=100]="NO_FLAG_SET",t[t.FLAG_SET_BUT_EMPTY=101]="FLAG_SET_BUT_EMPTY",t[t.INVALID_FALG_SET=102]="INVALID_FALG_SET",t[t.FLAG_SET_BUT_NO_RE=103]="FLAG_SET_BUT_NO_RE",t[t.INVALID_SERVICE_ID=104]="INVALID_SERVICE_ID",t[t.NO_SERVICE_AVAILABLE=200]="NO_SERVICE_AVAILABLE",t[t.NO_SERVICE_AVAILABLE_P2P=201]="NO_SERVICE_AVAILABLE_P2P",t[t.NO_SERVICE_AVAILABLE_VOICE=202]="NO_SERVICE_AVAILABLE_VOICE",t[t.NO_SERVICE_AVAILABLE_WEBRTC=203]="NO_SERVICE_AVAILABLE_WEBRTC",t[t.NO_SERVICE_AVAILABLE_CDS=204]="NO_SERVICE_AVAILABLE_CDS",t[t.NO_SERVICE_AVAILABLE_CDN=205]="NO_SERVICE_AVAILABLE_CDN",t[t.NO_SERVICE_AVAILABLE_TDS=206]="NO_SERVICE_AVAILABLE_TDS",t[t.NO_SERVICE_AVAILABLE_REPORT=207]="NO_SERVICE_AVAILABLE_REPORT",t[t.NO_SERVICE_AVAILABLE_APP_CENTER=208]="NO_SERVICE_AVAILABLE_APP_CENTER",t[t.NO_SERVICE_AVAILABLE_ENV0=209]="NO_SERVICE_AVAILABLE_ENV0",t[t.NO_SERVICE_AVAILABLE_VOET=210]="NO_SERVICE_AVAILABLE_VOET",t[t.NO_SERVICE_AVAILABLE_STRING_UID=211]="NO_SERVICE_AVAILABLE_STRING_UID",t[t.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS=212]="NO_SERVICE_AVAILABLE_WEBRTC_UNILBS",t[t.NO_SERVICE_AVAILABLE_UNILBS_FLV=213]="NO_SERVICE_AVAILABLE_UNILBS_FLV",t}({}),Wt=function(t){return t[t.K_TIMESTAMP_EXPIRED=2]="K_TIMESTAMP_EXPIRED",t[t.K_CHANNEL_PERMISSION_INVALID=3]="K_CHANNEL_PERMISSION_INVALID",t[t.K_CERTIFICATE_INVALID=4]="K_CERTIFICATE_INVALID",t[t.K_CHANNEL_NAME_EMPTY=5]="K_CHANNEL_NAME_EMPTY",t[t.K_CHANNEL_NOT_FOUND=6]="K_CHANNEL_NOT_FOUND",t[t.K_TICKET_INVALID=7]="K_TICKET_INVALID",t[t.K_CHANNEL_CONFLICTED=8]="K_CHANNEL_CONFLICTED",t[t.K_SERVICE_NOT_READY=9]="K_SERVICE_NOT_READY",t[t.K_SERVICE_TOO_HEAVY=10]="K_SERVICE_TOO_HEAVY",t[t.K_UID_BANNED=14]="K_UID_BANNED",t[t.K_IP_BANNED=15]="K_IP_BANNED",t[t.K_CHANNEL_BANNED=16]="K_CHANNEL_BANNED",t[t.DATASTREAM2_NOT_AVAILABLE=27]="DATASTREAM2_NOT_AVAILABLE",t[t.K_AUTO_REBALANCE=28]="K_AUTO_REBALANCE",t[t.WARN_NO_AVAILABLE_CHANNEL=103]="WARN_NO_AVAILABLE_CHANNEL",t[t.WARN_LOOKUP_CHANNEL_TIMEOUT=104]="WARN_LOOKUP_CHANNEL_TIMEOUT",t[t.WARN_LOOKUP_CHANNEL_REJECTED=105]="WARN_LOOKUP_CHANNEL_REJECTED",t[t.WARN_OPEN_CHANNEL_TIMEOUT=106]="WARN_OPEN_CHANNEL_TIMEOUT",t[t.WARN_OPEN_CHANNEL_REJECTED=107]="WARN_OPEN_CHANNEL_REJECTED",t[t.WARN_REQUEST_DEFERRED=108]="WARN_REQUEST_DEFERRED",t[t.ERR_DYNAMIC_KEY_TIMEOUT=109]="ERR_DYNAMIC_KEY_TIMEOUT",t[t.ERR_NO_AUTHORIZED=110]="ERR_NO_AUTHORIZED",t[t.ERR_VOM_SERVICE_UNAVAILABLE=111]="ERR_VOM_SERVICE_UNAVAILABLE",t[t.ERR_NO_CHANNEL_AVAILABLE_CODE=112]="ERR_NO_CHANNEL_AVAILABLE_CODE",t[t.ERR_MASTER_VOCS_UNAVAILABLE=114]="ERR_MASTER_VOCS_UNAVAILABLE",t[t.ERR_INTERNAL_ERROR=115]="ERR_INTERNAL_ERROR",t[t.ERR_NO_ACTIVE_STATUS=116]="ERR_NO_ACTIVE_STATUS",t[t.ERR_INVALID_UID=117]="ERR_INVALID_UID",t[t.ERR_DYNAMIC_KEY_EXPIRED=118]="ERR_DYNAMIC_KEY_EXPIRED",t[t.ERR_STATIC_USE_DYANMIC_KE=119]="ERR_STATIC_USE_DYANMIC_KE",t[t.ERR_DYNAMIC_USE_STATIC_KE=120]="ERR_DYNAMIC_USE_STATIC_KE",t[t.ERR_NO_VOCS_AVAILABLE=2e3]="ERR_NO_VOCS_AVAILABLE",t[t.ERR_NO_VOS_AVAILABLE=2001]="ERR_NO_VOS_AVAILABLE",t[t.ERR_JOIN_CHANNEL_TIMEOUT=2002]="ERR_JOIN_CHANNEL_TIMEOUT",t[t.ERR_REPEAT_JOIN_CHANNEL=2003]="ERR_REPEAT_JOIN_CHANNEL",t[t.ERR_JOIN_BY_MULTI_IP=2004]="ERR_JOIN_BY_MULTI_IP",t[t.ERR_NOT_JOINED=2011]="ERR_NOT_JOINED",t[t.ERR_REPEAT_JOIN_REQUEST=2012]="ERR_REPEAT_JOIN_REQUEST",t[t.ERR_INVALID_VENDOR_KEY=2013]="ERR_INVALID_VENDOR_KEY",t[t.ERR_INVALID_CHANNEL_NAME=2014]="ERR_INVALID_CHANNEL_NAME",t[t.ERR_INVALID_STRINGUID=2015]="ERR_INVALID_STRINGUID",t[t.ERR_TOO_MANY_USERS=2016]="ERR_TOO_MANY_USERS",t[t.ERR_SET_CLIENT_ROLE_TIMEOUT=2017]="ERR_SET_CLIENT_ROLE_TIMEOUT",t[t.ERR_SET_CLIENT_ROLE_NO_PERMISSION=2018]="ERR_SET_CLIENT_ROLE_NO_PERMISSION",t[t.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE=2019]="ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",t[t.ERR_PUBLISH_REQUEST_INVALID=2020]="ERR_PUBLISH_REQUEST_INVALID",t[t.ERR_SUBSCRIBE_REQUEST_INVALID=2021]="ERR_SUBSCRIBE_REQUEST_INVALID",t[t.ERR_NOT_SUPPORTED_MESSAGE=2022]="ERR_NOT_SUPPORTED_MESSAGE",t[t.ERR_ILLEAGAL_PLUGIN=2023]="ERR_ILLEAGAL_PLUGIN",t[t.ERR_REJOIN_TOKEN_INVALID=2024]="ERR_REJOIN_TOKEN_INVALID",t[t.ERR_REJOIN_USER_NOT_JOINED=2025]="ERR_REJOIN_USER_NOT_JOINED",t[t.ERR_INVALID_OPTIONAL_INFO=2027]="ERR_INVALID_OPTIONAL_INFO",t[t.ILLEGAL_AES_PASSWORD=2028]="ILLEGAL_AES_PASSWORD",t[t.ILLEGAL_CLIENT_ROLE_LEVEL=2029]="ILLEGAL_CLIENT_ROLE_LEVEL",t[t.ERR_TOO_MANY_BROADCASTERS=2031]="ERR_TOO_MANY_BROADCASTERS",t[t.ERR_TOO_MANY_SUBSCRIBERS=2032]="ERR_TOO_MANY_SUBSCRIBERS",t[t.ERR_LICENSE_MISSING=32769]="ERR_LICENSE_MISSING",t[t.ERR_LICENSE_EXPIRED=32771]="ERR_LICENSE_EXPIRED",t[t.ERR_LICENSE_MINUTES_EXCEEDED=32773]="ERR_LICENSE_MINUTES_EXCEEDED",t[t.ERR_LICENSE_PERIOD_INVALID=32774]="ERR_LICENSE_PERIOD_INVALID",t[t.ERR_LICENSE_MULTIPLE_SDK_SERVICE=32778]="ERR_LICENSE_MULTIPLE_SDK_SERVICE",t[t.ERR_LICENSE_ILLEGAL=32783]="ERR_LICENSE_ILLEGAL",t[t.ERR_TEST_RECOVER=9e3]="ERR_TEST_RECOVER",t[t.ERR_TEST_TRYNEXT=9001]="ERR_TEST_TRYNEXT",t[t.ERR_TEST_RETRY=9002]="ERR_TEST_RETRY",t}({}),yr=function(t){return t.CONNECTING="connecting",t.CONNECTED="connected",t.RECONNECTING="reconnecting",t.CLOSED="closed",t}({}),Jt=function(t){return t.WS_CONNECTED="ws_connected",t.WS_RECONNECTING="ws_reconnecting",t.WS_CLOSED="ws_closed",t.WS_RECONNECT_CREATE_CONNECTION="ws_reconnect_create_connection",t.ON_BINARY_DATA="on_binary_data",t.REQUEST_RECOVER="request_recover",t.REQUEST_JOIN_INFO="request_join_info",t.REQUEST_REJOIN_INFO="req_rejoin_info",t.IS_P2P_DISCONNECTED="is_p2p_dis",t.DISCONNECT_P2P="dis_p2p",t.ABORT_P2P_EXECUTION="abort_p2p_execution",t.NEED_RENEW_SESSION="need-sid",t.REPORT_JOIN_GATEWAY="report_join_gateway",t.REQUEST_TIMEOUT="request_timeout",t.REQUEST_SUCCESS="request_success",t.JOIN_RESPONSE="join_response",t.PRE_CONNECT_PC="pre_connect_pc",t.P2P_CONNECTION="p2p_connection",t.P2P_REMOTE_CANDIDATE_UPDATE="p2p_remote_candidate_update",t.P2P_SUBSCRIBE="p2p_subscribe",t.P2P_UNSUBSCRIBE="p2p_unsubscribe",t.P2P_EXCHANGE_SDP="p2p_exchange_sdp",t.P2P_ON_ADD_VIDEO_STREAM="p2p_on_add_video_stream",t.P2P_ON_ADD_AUDIO_STREAM="p2p_on_add_audio_stream",t.RECOVER_NOTIFICATION="recover_notification",t}({}),Yt=function(t){return t.PING="ping",t.PING_BACK="ping_back",t.JOIN="join_v3",t.REJOIN="rejoin_v3",t.LEAVE="leave",t.SET_CLIENT_ROLE="set_client_role",t.PUBLISH="publish",t.PUBLISH_DATASTREAM="publish_datastream",t.UNPUBLISH="unpublish",t.UNPUBLISH_DATASTREAM="unpublish_datastream",t.SUBSCRIBE="subscribe",t.PRE_SUBSCRIBE="pre_subscribe",t.SUBSCRIBE_DATASTREAM="subscribe_datastream",t.SUBSCRIBE_STREAMS="subscribe_streams",t.UNSUBSCRIBE="unsubscribe",t.UNSUBSCRIBE_DATASTREAM="unsubscribe_datastream",t.UNSUBSCRIBE_STREAMS="unsubscribe_streams",t.SUBSCRIBE_CHANGE="subscribe_change",t.TRAFFIC_STATS="traffic_stats",t.RENEW_TOKEN="renew_token",t.SWITCH_VIDEO_STREAM="switch_video_stream",t.DEFAULT_VIDEO_STREAM="default_video_stream",t.SET_FALLBACK_OPTION="set_fallback_option",t.GATEWAY_INFO="gateway_info",t.CONTROL="control",t.SEND_METADATA="send_metadata",t.DATA_STREAM="data_stream",t.PICK_SVC_LAYER="pick_svc_layer",t.RESTART_ICE="restart_ice",t.CONNECT_PC="connect_pc",t.SET_VIDEO_PROFILE="set_video_profile",t.SET_PARAMETER="set_parameter",t.SET_RTM2_FLAG="set_rtm2_flag",t}({}),zw=function(t){return t.WRTC_STATS="wrtc_stats",t.WS_INFLATE_DATA_LENGTH="ws_inflate_data_length",t.DENOISER_STATS="denoiser_stats",t.EXTENSION_USAGE_STATS="extension_usage_stats",t}({}),Cn=function(t){return t.ON_USER_ONLINE="on_user_online",t.ON_USER_OFFLINE="on_user_offline",t.ON_STREAM_FALLBACK_UPDATE="on_stream_fallback_update",t.ON_PUBLISH_STREAM="on_publish_stream",t.ON_UPLINK_STATS="on_uplink_stats",t.ON_P2P_LOST="on_p2p_lost",t.ON_REMOVE_STREAM="on_remove_stream",t.ON_ADD_AUDIO_STREAM="on_add_audio_stream",t.ON_ADD_VIDEO_STREAM="on_add_video_stream",t.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="on_token_privilege_will_expire",t.ON_TOKEN_PRIVILEGE_DID_EXPIRE="on_token_privilege_did_expire",t.ON_USER_BANNED="on_user_banned",t.ON_USER_LICENSE_BANNED="on_user_license_banned",t.ON_NOTIFICATION="on_notification",t.ON_CRYPT_ERROR="on_crypt_error",t.MUTE_AUDIO="mute_audio",t.MUTE_VIDEO="mute_video",t.UNMUTE_AUDIO="unmute_audio",t.UNMUTE_VIDEO="unmute_video",t.ON_P2P_OK="on_p2p_ok",t.RECEIVE_METADATA="receive_metadata",t.ON_DATA_STREAM="on_data_stream",t.ON_RTP_CAPABILITY_CHANGE="on_rtp_capability_change",t.ON_REMOTE_DATASTREAM_UPDATE="on_remote_datastream_update",t.ON_REMOTE_FULL_DATASTREAM_INFO="on_remote_full_datastream_info",t.ENABLE_LOCAL_VIDEO="enable_local_video",t.DISABLE_LOCAL_VIDEO="disable_local_video",t.ENABLE_LOCAL_AUDIO="enable_local_audio",t.DISABLE_LOCAL_AUDIO="disable_local_audio",t.ON_PUBLISHED_USER_LIST="on_published_user_list",t}({}),Xo=function(t){return t.SEND_ONLY="SEND_ONLY",t.RECEIVE_ONLY="RECEIVE_ONLY",t}({}),rn=function(t){return t.CONNECTED="websocket:connected",t.RECONNECTING="websocket:reconnecting",t.WILL_RECONNECT="websocket:will_reconnect",t.CLOSED="websocket:closed",t.FAILED="websocket:failed",t.ON_MESSAGE="websocket:on_message",t.REQUEST_NEW_URLS="websocket:request_new_urls",t.RECONNECT_CREATE_CONNECTION="websocket:reconnect_create_connection",t.ON_TOKEN_PRIVILEGE_DID_EXPIRE="websocket:on_token_privilege_did_expire",t}({});function PP(t){if(typeof t!="string"||!/^[a-zA-Z0-9 \!\#\$\%\&\(\)\+\-\:\;\<\=\.\>\?\@\[\]\^\_\{\}\|\~\,]{1,64}$/.test(t))throw x.error("Invalid Channel Name ".concat(t)),new Ae(te.INVALID_PARAMS,"The length must be within 64 bytes. The supported characters: a-z,A-Z,0-9,space,!, #, $, %, &, (, ), +, -, :, ;, <, =, ., >, ?, @, [, ], ^, _,  {, }, |, ~, ,")}function OP(t){if(r=t,!(typeof r=="number"&&Math.floor(r)===r&&0<=r&&r<=4294967295||Mz(t,1,255)))throw new Ae(te.INVALID_PARAMS,"[String uid] Length of the string: [1,255]. ASCII characters only. [Number uid] The value range is [0,10000]");var r;typeof t=="string"&&x.warn("You input a string as the user ID, to ensure better end-user experience, Agora highly suggests not using a string as the user ID.")}let yf=function(t){return t.TRANSCODE="mix_streaming",t.RAW="raw_streaming",t}({});const wge={alpha:1,height:640,width:360,x:0,y:0,zOrder:0,audioChannel:0},p2={x:0,y:0,width:160,height:160,zOrder:255,alpha:1};function f2(t,r){_s(t.url,"".concat(r,".url"),1,1e3,!1),$r(t.x)||cr(t.x,"".concat(r,".x"),0,1e4),$r(t.y)||cr(t.y,"".concat(r,".y"),0,1e4),$r(t.width)||cr(t.width,"".concat(r,".width"),0,1e4),$r(t.height)||cr(t.height,"".concat(r,".height"),0,1e4),$r(t.zOrder)||cr(t.zOrder,"".concat(r,".zOrder"),0,255),$r(t.alpha)||cr(t.alpha,"".concat(r,".alpha"),0,1,!1)}const Tge={audioBitrate:48,audioChannels:1,audioSampleRate:48e3,backgroundColor:0,height:360,lowLatency:!1,videoBitrate:400,videoCodecProfile:100,videoCodecType:1,videoFrameRate:15,videoGop:30,width:640,images:[],userConfigs:[],userConfigExtraInfo:""};let Zm=function(t){return t.WARNING="@live_uap-warning",t.ERROR="@line_uap-error",t.PUBLISH_STREAM_STATUS="@live_uap-publish-status",t.WORKER_STATUS="@live_uap-worker-status",t.REQUEST_NEW_ADDRESS="@live_uap-request-address",t}({}),m2=function(t){return t.REQUEST_WORKER_MANAGER_LIST="@live_req_worker_manager",t}({}),Wi=function(t){return t[t.LIVE_STREAM_RESPONSE_SUCCEED=200]="LIVE_STREAM_RESPONSE_SUCCEED",t[t.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM=454]="LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM",t[t.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR=450]="LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR",t[t.LIVE_STREAM_RESPONSE_BAD_STREAM=451]="LIVE_STREAM_RESPONSE_BAD_STREAM",t[t.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR=400]="LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR",t[t.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST=404]="LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST",t[t.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED=456]="LIVE_STREAM_RESPONSE_NOT_AUTHORIZED",t[t.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE=457]="LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE",t[t.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN=429]="LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN",t[t.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH=452]="LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH",t[t.LIVE_STREAM_RESPONSE_NOT_SUPPORTED=453]="LIVE_STREAM_RESPONSE_NOT_SUPPORTED",t[t.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM=455]="LIVE_STREAM_RESPONSE_MAX_STREAM_NUM",t[t.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR=500]="LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR",t[t.LIVE_STREAM_RESPONSE_WORKER_LOST=501]="LIVE_STREAM_RESPONSE_WORKER_LOST",t[t.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT=502]="LIVE_STREAM_RESPONSE_RESOURCE_LIMIT",t[t.LIVE_STREAM_RESPONSE_WORKER_QUIT=503]="LIVE_STREAM_RESPONSE_WORKER_QUIT",t[t.ERROR_FAIL_SEND_MESSAGE=504]="ERROR_FAIL_SEND_MESSAGE",t[t.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE=30]="PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE",t[t.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT=31]="PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT",t[t.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH=32]="PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH",t[t.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN=33]="PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN",t}({});function OH(t){if(!t.channelName)throw new Ae(te.INVALID_PARAMS,"invalid channelName in info");if(typeof t.uid!="number")throw new Ae(te.INVALID_PARAMS,"invalid uid in info, uid must be a number");return t.token&&_s(t.token,"info.token",1,2047),OP(t.uid),PP(t.channelName),!0}let Jo=function(t){return t[t.SetSdkProfile=0]="SetSdkProfile",t[t.SetSourceChannel=1]="SetSourceChannel",t[t.SetSourceUserId=2]="SetSourceUserId",t[t.SetDestChannel=3]="SetDestChannel",t[t.StartPacketTransfer=4]="StartPacketTransfer",t[t.StopPacketTransfer=5]="StopPacketTransfer",t[t.UpdateDestChannel=6]="UpdateDestChannel",t[t.Reconnect=7]="Reconnect",t[t.SetVideoProfile=8]="SetVideoProfile",t}({}),Ef=function(t){return t.NETWORK_DISCONNECTED="NETWORK_DISCONNECTED",t.NETWORK_CONNECTED="NETWORK_CONNECTED",t.PACKET_JOINED_SRC_CHANNEL="PACKET_JOINED_SRC_CHANNEL",t.PACKET_JOINED_DEST_CHANNEL="PACKET_JOINED_DEST_CHANNEL",t.PACKET_SENT_TO_DEST_CHANNEL="PACKET_SENT_TO_DEST_CHANNEL",t.PACKET_RECEIVED_VIDEO_FROM_SRC="PACKET_RECEIVED_VIDEO_FROM_SRC",t.PACKET_RECEIVED_AUDIO_FROM_SRC="PACKET_RECEIVED_AUDIO_FROM_SRC",t.PACKET_UPDATE_DEST_CHANNEL="PACKET_UPDATE_DEST_CHANNEL",t.PACKET_UPDATE_DEST_CHANNEL_REFUSED="PACKET_UPDATE_DEST_CHANNEL_REFUSED",t.PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE="PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE",t}({}),Ja=function(t){return t.RELAY_STATE_IDLE="RELAY_STATE_IDLE",t.RELAY_STATE_CONNECTING="RELAY_STATE_CONNECTING",t.RELAY_STATE_RUNNING="RELAY_STATE_RUNNING",t.RELAY_STATE_FAILURE="RELAY_STATE_FAILURE",t}({}),hS=function(t){return t.RELAY_OK="RELAY_OK",t.SERVER_CONNECTION_LOST="SERVER_CONNECTION_LOST",t.SRC_TOKEN_EXPIRED="SRC_TOKEN_EXPIRED",t.DEST_TOKEN_EXPIRED="DEST_TOKEN_EXPIRED",t}({}),Qn=function(t){return t.High="high",t.Low="low",t.Audio="audio",t.Screen="screen",t.ScreenLow="screen_low",t}({}),ls=function(t){return t.DISCONNECT="disconnect",t.CONNECTION_STATE_CHANGE="connection-state-change",t.NETWORK_QUALITY="network-quality",t.STREAM_TYPE_CHANGE="stream-type-change",t.IS_P2P_DISCONNECTED="is-p2p-dis",t.DISCONNECT_P2P="dis-p2p",t.REQUEST_NEW_GATEWAY_LIST="req-gate-url",t.NEED_RENEW_SESSION="need-sid",t.REQUEST_P2P_CONNECTION_PARAMS="request-p2p-connection-params",t.JOIN_RESPONSE="join-response",t.RESET_CONNECTION_EVENTS="reset-connection-events",t.PRE_CONNECT_PC="pre-connect_pc",t.UPDATE_GATEWAY_CONFIG="update-gateway-config",t}({}),kP=function(t){return t.P2P_DISCONNECTED="P2P_DISCONNECTED",t.A_ROUND_WS_FAILED="A_ROUND_WS_FAILED",t.TIMEOUT="TIMEOUT",t.UNKNOWN_REASON="UNKNOWN_REASON",t}({}),es=function(t){return t[t.Nothing=0]="Nothing",t[t.Audio=1]="Audio",t[t.LwoVideo=2]="LwoVideo",t[t.Video=4]="Video",t[t.Data=8]="Data",t[t.DataStream0=256]="DataStream0",t[t.DataStream1=512]="DataStream1",t[t.DataStream2=1024]="DataStream2",t[t.DataStream3=2048]="DataStream3",t[t.DataStream4=4096]="DataStream4",t[t.DataStream5=8192]="DataStream5",t[t.DataStream6=16384]="DataStream6",t[t.DataStream7=32768]="DataStream7",t}({}),Kn=function(t){return t.CHINA="CHINA",t.ASIA="ASIA",t.NORTH_AMERICA="NORTH_AMERICA",t.EUROPE="EUROPE",t.JAPAN="JAPAN",t.INDIA="INDIA",t.KOREA="KOREA",t.HKMC="HKMC",t.US="US",t.OCEANIA="OCEANIA",t.SOUTH_AMERICA="SOUTH_AMERICA",t.AFRICA="AFRICA",t.OVERSEA="OVERSEA",t.GLOBAL="GLOBAL",t.EXTENSIONS="EXTENSIONS",t}({});const kH=[Kn.AFRICA,Kn.ASIA,Kn.CHINA,Kn.EUROPE,Kn.GLOBAL,Kn.INDIA,Kn.JAPAN,Kn.NORTH_AMERICA,Kn.OCEANIA,Kn.OVERSEA,Kn.SOUTH_AMERICA];let Js=function(t){return t.CHINA="CN",t.ASIA="AS",t.NORTH_AMERICA="NA",t.EUROPE="EU",t.JAPAN="JP",t.INDIA="IN",t.KOREA="KR",t.HKMC="HK",t.US="US",t.OCEANIA="OC",t.SOUTH_AMERICA="SA",t.AFRICA="AF",t.OVERSEA="OVERSEA",t.GLOBAL="GLOBAL",t.EXTENSIONS="GLOBAL",t}({});const NP={CHINA:{},ASIA:{CODE:Js.ASIA,WEBCS_DOMAIN:["ap-web-1-asia.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-asia.agora.io"],PROXY_CS:["proxy-ap-web-asia.agora.io"],CDS_AP:["cds-ap-web-asia.agora.io","cds-ap-web-asia2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-asia.agora.io","sua-ap-web-asia2.agora.io"],UAP_AP:["uap-ap-web-asia.agora.io","uap-ap-web-asia2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"],PROXY_SERVER_TYPE3:["southeast-asia.webrtc-cloud-proxy.sd-rtn.com"]},NORTH_AMERICA:{CODE:Js.NORTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-north-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-north-america.agora.io"],PROXY_CS:["proxy-ap-web-america.agora.io"],CDS_AP:["cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],UAP_AP:["uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"],PROXY_SERVER_TYPE3:["east-usa.webrtc-cloud-proxy.sd-rtn.com"]},EUROPE:{CODE:Js.EUROPE,WEBCS_DOMAIN:["ap-web-1-europe.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-europe.agora.io"],PROXY_CS:["proxy-ap-web-europe.agora.io"],CDS_AP:["cds-ap-web-europe.agora.io","cds-ap-web-europe2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-europe.agora.io","sua-ap-web-europe.agora.io"],UAP_AP:["uap-ap-web-europe.agora.io","uap-ap-web-europe2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"],PROXY_SERVER_TYPE3:["europe.webrtc-cloud-proxy.sd-rtn.com"]},JAPAN:{CODE:Js.JAPAN,WEBCS_DOMAIN:["ap-web-1-japan.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-japan.agora.io"],PROXY_CS:["proxy-ap-web-japan.agora.io"],CDS_AP:["cds-ap-web-japan.agora.io","cds-ap-web-japan2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-japan.agora.io","sua-ap-web-japan2.agora.io"],UAP_AP:["uap-ap-web-japan.agora.io","uap-ap-web-japan2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"],PROXY_SERVER_TYPE3:["japan.webrtc-cloud-proxy.sd-rtn.com"]},INDIA:{CODE:Js.INDIA,WEBCS_DOMAIN:["ap-web-1-india.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-india.agora.io"],PROXY_CS:["proxy-ap-web-india.agora.io"],CDS_AP:["cds-ap-web-india.agora.io","cds-ap-web-india2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-india.agora.io","sua-ap-web-india2.agora.io"],UAP_AP:["uap-ap-web-india.agora.io","uap-ap-web-india2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"],PROXY_SERVER_TYPE3:["india.webrtc-cloud-proxy.sd-rtn.com"]},KOREA:{CODE:Js.KOREA,WEBCS_DOMAIN:["ap-web-1-korea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-korea.agora.io"],PROXY_CS:["proxy-ap-web-korea.agora.io"],CDS_AP:["cds-ap-web-korea.agora.io","cds-ap-web-korea2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-korea.agora.io","sua-ap-web-korea2.agora.io"],UAP_AP:["uap-ap-web-korea.agora.io","uap-ap-web-korea2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-korea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-korea.agora.io"],LOG_UPLOAD_SERVER:["logservice-korea.agora.io"],PROXY_SERVER_TYPE3:["korea.webrtc-cloud-proxy.sd-rtn.com"]},HKMC:{CODE:Js.HKMC,WEBCS_DOMAIN:["ap-web-1-hkmc.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-hkmc.agora.io"],PROXY_CS:["proxy-ap-web-hkmc.agora.io"],CDS_AP:["cds-ap-web-hkmc.agora.io","cds-ap-web-hkmc2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-hkmc.agora.io","sua-ap-web-hkmc2.agora.io"],UAP_AP:["uap-ap-web-hkmc.agora.io","uap-ap-web-hkmc2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-hkmc.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-hkmc.agora.io"],LOG_UPLOAD_SERVER:["logservice-hkmc.agora.io"],PROXY_SERVER_TYPE3:["hkmc.webrtc-cloud-proxy.sd-rtn.com"]},US:{CODE:Js.US,WEBCS_DOMAIN:["ap-web-1-us.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-us.agora.io"],PROXY_CS:["proxy-ap-web-us.agora.io"],CDS_AP:["cds-ap-web-us.agora.io","cds-ap-web-us2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-us.agora.io","sua-ap-web-us2.agora.io"],UAP_AP:["uap-ap-web-us.agora.io","uap-ap-web-us2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-us.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-us.agora.io"],LOG_UPLOAD_SERVER:["logservice-us.agora.io"],PROXY_SERVER_TYPE3:["us.webrtc-cloud-proxy.sd-rtn.com"]},OVERSEA:{CODE:Js.OVERSEA,WEBCS_DOMAIN:["ap-web-1-oversea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oversea.agora.io"],PROXY_CS:["proxy-ap-web-oversea.agora.io"],CDS_AP:["cds-ap-web-oversea.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oversea.agora.io"],UAP_AP:["uap-ap-web-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.agora.io"]},GLOBAL:{CODE:Js.GLOBAL,WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-ap-web-3.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-ap-web-3.agora.io"],UAP_AP:["uap-ap-web-1.agora.io","uap-ap-web-3.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2.agora.io"],LOG_UPLOAD_SERVER:["logservice.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com"]},OCEANIA:{CODE:Js.OCEANIA,WEBCS_DOMAIN:["ap-web-1-oceania.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oceania.agora.io"],PROXY_CS:["proxy-ap-web-oceania.agora.io"],CDS_AP:["cds-ap-web-oceania.agora.io","cds-ap-web-oceania2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oceania.agora.io","sua-ap-web-oceania2.agora.io"],UAP_AP:["uap-ap-web-oceania.agora.io","uap-ap-web-oceania2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"],PROXY_SERVER_TYPE3:["oceania.webrtc-cloud-proxy.sd-rtn.com"]},SOUTH_AMERICA:{CODE:Js.SOUTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-south-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-south-america.agora.io"],PROXY_CS:["proxy-ap-web-south-america.agora.io"],CDS_AP:["cds-ap-web-south-america.agora.io","cds-ap-web-south-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-south-america.agora.io","sua-ap-web-south-america2.agora.io"],UAP_AP:["uap-ap-web-south-america.agora.io","uap-ap-web-south-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"],PROXY_SERVER_TYPE3:["south-america.webrtc-cloud-proxy.sd-rtn.com"]},AFRICA:{CODE:Js.AFRICA,WEBCS_DOMAIN:["ap-web-1-africa.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-africa.agora.io"],PROXY_CS:["proxy-ap-web-africa.agora.io"],CDS_AP:["cds-ap-web-africa.agora.io","cds-ap-web-africa2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-africa.agora.io","sua-ap-web-africa2.agora.io"],UAP_AP:["uap-ap-web-africa.agora.io","uap-ap-web-africa2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"],PROXY_SERVER_TYPE3:["africa.webrtc-cloud-proxy.sd-rtn.com"]},EXTENSIONS:{}};ML&&(NP.CHINA={CODE:Js.CHINA,WEBCS_DOMAIN:["webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["proxy-web.ap.sd-rtn.com"],CDS_AP:["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-web-2.ap.sd-rtn.com","uap-web-4.ap.sd-rtn.com"],EVENT_REPORT_DOMAIN:["web-3.statscollector.sd-rtn.com"],EVENT_REPORT_BACKUP_DOMAIN:["web-4.statscollector.sd-rtn.com"],LOG_UPLOAD_SERVER:["logservice-china.agora.io"],PROXY_SERVER_TYPE3:["east-cn.webrtc-cloud-proxy.sd-rtn.com"]});let Gw=function(t){return t.UPDATE_BITRATE_LIMIT="update_bitrate_limit",t.UPDATE_CLIENT_ROLE_OPTIONS="update_client_role_options",t}({});function NH(t){return!!t&&!(!t.uplink||!t.id)&&t.uplink.max_bitrate!==void 0&&t.uplink.min_bitrate!==void 0}class DH extends Br{constructor(r,s){super(),q(this,"onICEConnectionStateChange",void 0),q(this,"onConnectionStateChange",void 0),q(this,"onDTLSTransportStateChange",void 0),q(this,"onDTLSTransportError",void 0),q(this,"onICETransportStateChange",void 0),q(this,"onFirstAudioReceived",void 0),q(this,"onFirstVideoReceived",void 0),q(this,"onFirstAudioDecoded",void 0),q(this,"onFirstVideoDecoded",void 0),q(this,"onFirstVideoDecodedTimeout",void 0),q(this,"onSelectedLocalCandidateChanged",void 0),q(this,"onSelectedRemoteCandidateChanged",void 0),q(this,"onICECandidateError",void 0),q(this,"getLocalVideoStats",void 0)}}class xH extends DH{constructor(r,s){super(r,s),q(this,"establishPromise",void 0)}}let bt=function(t){return t.VIDEO="video",t.AUDIO="audio",t}({}),Qs=function(t){return t.UDP_RELAY="udp_relay",t.UDP_TCP_RELAY="udp_tcp_relay",t.TCP_RELAY="tcp_relay",t.RELAY="relay",t}({}),vf=function(t){return t[t.FIRST_CONNECTION=0]="FIRST_CONNECTION",t[t.UDP_TCP_RESTART=1]="UDP_TCP_RESTART",t[t.RELAY_RESTART=2]="RELAY_RESTART",t[t.TCP_RESTART=3]="TCP_RESTART",t[t.OLD_FIRST_CONNECTION=10]="OLD_FIRST_CONNECTION",t[t.OLD_RESTART=11]="OLD_RESTART",t[t.DISCONNECTED_OR_FAILED=20]="DISCONNECTED_OR_FAILED",t}({});const LH=["disconnected","failed"];let Xe=function(t){return t.LocalVideoTrack="videoTrack",t.LocalAudioTrack="audioTrack",t.LocalVideoLowTrack="videoLowTrack",t}({}),Jn=function(t){return t.New="new",t.Connected="connected",t.Reconnecting="reconnecting",t.Disconnected="disconnected",t}({}),jt=function(t){return t.AudioMetadata="audioMetadata",t.StateChange="stateChange",t.IceConnectionStateChange="iceConnectionStateChange",t.RequestMuteLocal="requestMuteLocal",t.RequestUnmuteLocal="requestUnmuteLocal",t.RequestRePublish="requestRePublish",t.RequestRePublishDataChannel="requestRePublishDataChannel",t.RequestReSubscribe="requestReSubscribe",t.RequestUploadStats="requestUploadStats",t.RequestUpload="requestUpload",t.MediaReconnectStart="MediaReconnectStart",t.MediaReconnectEnd="MediaReconnectEnd",t.NeedSignalRTT="NeedSignalRTT",t.RequestRestartICE="RequestRestartIce",t.PeerConnectionStateChange="PeerConnectionStateChange",t.RequestReconnect="RequestReconnect",t.RequestReconnectPC="RequestReconnectPC",t.RequestUnpublishForReconnectPC="RequestUnpublishForReconnectPC",t.P2PLost="P2PLost",t.UpdateVideoEncoder="UpdateVideoEncoder",t.ConnectionTypeChange="ConnectionTypeChange",t.RequestLowStreamParameter="RequestLowStreamParameter",t.QueryClientConnectionState="QueryClientConnectionState",t.LocalCandidate="LocalCandidate",t.RequestP2PMuteLocal="requestP2PMuteLocal",t.RequestP2PUnPublish="RequestP2PUnPublish",t.RequestP2PUnmuteRemote="RequestP2PUnmuteRemote",t.RequestP2PMuteRemote="RequestP2PMuteRemote",t.RequestP2PRestartICE="RequestP2PRestartICE",t}({}),Du=function(t){return t.CONNECTING="CONNECTING",t.RECONNECTING="RECONNECTING",t.CONNECTED="CONNECTED",t.CLOSED="CLOSED",t}({}),xu=function(t){return t[t.CONNECT_AP=0]="CONNECT_AP",t[t.AP_CONNECTED=1]="AP_CONNECTED",t[t.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",t[t.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",t[t.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",t[t.CONNECT_WORKER=5]="CONNECT_WORKER",t[t.WORKER_CONNECTED=6]="WORKER_CONNECTED",t[t.CLOSED=7]="CLOSED",t}({}),us=function(t){return t.CONNECTION_STATE_CHANGE="connection-state-change",t.STATE_CHANGE="state-change",t.INSPECT_RESULT="inspect-result",t.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",t.REQUEST_NEW_WORKER_URL="request-new-worker-url",t}({}),MH=function(t){return t.CONNECTED="transmitter:connected",t.RECONNECTING="transmitter:reconnecting",t.WILL_RECONNECT="transmitter:will_reconnect",t.CLOSED="transmitter:closed",t.FAILED="transmitter:failed",t.ON_MESSAGE="transmitter:on_message",t.REQUEST_NEW_URLS="transmitter:request_new_urls",t.RECONNECT_CREATE_CONNECTION="transmitter:reconnect_create_connection",t.ON_TOKEN_PRIVILEGE_DID_EXPIRE="transmitter:on_token_privilege_did_expire",t.TO_CONNECT_DATACHANNEL="transmitter:to_connect_datachannel",t.FAILBACK="transmitter:failback",t.PRE_CONNECT_PC="transmitter:pre_connect_pc",t}({}),Mh=function(t){return t.CAMERA_CHANGED="camera-changed",t.MICROPHONE_CHANGED="microphone-changed",t.PLAYBACK_DEVICE_CHANGED="playback-device-changed",t.AUDIO_AUTOPLAY_FAILED="audio-autoplay-failed",t.AUTOPLAY_FAILED="autoplay-failed",t.AUDIO_CONTEXT_STATE_CHANGED="audio-context-state-changed",t.SECURITY_POLICY_VIOLATION="security-policy-violation",t}({}),jl=function(t){return t.CONNECTING="CONNECTING",t.RECONNECTING="RECONNECTING",t.CONNECTED="CONNECTED",t.CLOSED="CLOSED",t}({}),Ld=function(t){return t.CONNECTION_STATE_CHANGE="connection-state-change",t.STATE_CHANGE="state-change",t.INSPECT_RESULT="inspect-result",t.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",t.REQUEST_NEW_WORKER_URL="request-new-worker-url",t}({}),pS=function(t){return t[t.CONNECT_AP=0]="CONNECT_AP",t[t.AP_CONNECTED=1]="AP_CONNECTED",t[t.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",t[t.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",t[t.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",t[t.CONNECT_WORKER=5]="CONNECT_WORKER",t[t.WORKER_CONNECTED=6]="WORKER_CONNECTED",t[t.CLOSED=7]="CLOSED",t}({}),hi=function(t){return t.CALL="call",t.CANDIDATE="candidate",t.PUBLISH="publish",t.UNPUBLISH="unpublish",t.CONTROL="control",t.RESTART_ICE="restart_ice",t.ACK="ack",t.RESPONSE="response",t.JOIN="join",t.CHECK="check",t}({}),fS=function(t){return t.ABORT="abort",t}({}),eg=function(t){return t.MUTE_LOCAL_AUDIO="mute_local_audio",t.MUTE_LOCAL_VIDEO="mute_local_video",t.UNMUTE_LOCAL_AUDIO="unmute_local_audio",t.UNMUTE_LOCAL_VIDEO="unmute_local_video",t}({}),Cge=function(t){return t.P2P_TOKEN_TIMEOUT="p2p_token_timeout",t.P2P_TOKEN_CHANGED="p2p_token_changed",t}({});const Rge={[AP.ACCESS_POINT]:{[Yo.NO_FLAG_SET]:{desc:"flag is zero",retry:!1},[Yo.FLAG_SET_BUT_EMPTY]:{desc:"flag is empty",retry:!1},[Yo.INVALID_FALG_SET]:{desc:"invalid flag",retry:!1},[Yo.FLAG_SET_BUT_NO_RE]:{desc:"flag set unilbs but no request",retry:!1},[Yo.INVALID_SERVICE_ID]:{desc:"invalid service id",retry:!1},[Yo.NO_SERVICE_AVAILABLE]:{desc:"no service available",retry:!0},[Yo.NO_SERVICE_AVAILABLE_P2P]:{desc:"no unilbs p2p service available",retry:!0},[Yo.NO_SERVICE_AVAILABLE_VOICE]:{desc:"no unilbs voice service available",retry:!0},[Yo.NO_SERVICE_AVAILABLE_WEBRTC]:{desc:"no unilbs webrtc service available",retry:!0},[Yo.NO_SERVICE_AVAILABLE_CDS]:{desc:"no cds service available",retry:!0},[Yo.NO_SERVICE_AVAILABLE_CDN]:{desc:"no cdn dispatcher service available",retry:!0},[Yo.NO_SERVICE_AVAILABLE_TDS]:{desc:"no tds service available",retry:!0},[Yo.NO_SERVICE_AVAILABLE_REPORT]:{desc:"no unilbs report service available",retry:!0},[Yo.NO_SERVICE_AVAILABLE_APP_CENTER]:{desc:"no app center service available",retry:!0},[Yo.NO_SERVICE_AVAILABLE_ENV0]:{desc:"no unilbs sig env0 service available",retry:!0},[Yo.NO_SERVICE_AVAILABLE_VOET]:{desc:"no unilbs voet service available",retry:!0},[Yo.NO_SERVICE_AVAILABLE_STRING_UID]:{desc:"no string uid service available",retry:!0},[Yo.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS]:{desc:"no webrtc unilbs service available",retry:!0}},[AP.UNILBS]:{[Nu.INVALID_VENDOR_KEY]:{desc:"invalid vendor key, can not find appid",retry:!1},[Nu.INVALID_CHANNEL_NAME]:{desc:"invalid channel name",retry:!1},[Nu.INTERNAL_ERROR]:{desc:"unilbs internal error",retry:!1},[Nu.NO_AUTHORIZED]:{desc:"invalid token, authorized failed",retry:!1},[Nu.DYNAMIC_KEY_TIMEOUT]:{desc:"dynamic key or token timeout",retry:!1},[Nu.NO_ACTIVE_STATUS]:{desc:"no active status",retry:!1},[Nu.DYNAMIC_KEY_EXPIRED]:{desc:"dynamic key expired",retry:!1},[Nu.STATIC_USE_DYNAMIC_KEY]:{desc:"static use dynamic key",retry:!1},[Nu.DYNAMIC_USE_STATIC_KEY]:{desc:"dynamic use static key",retry:!1},[Nu.USER_OVERLOAD]:{desc:"amount of users over load",retry:!1},[Nu.FORBIDDEN_REGION]:{desc:"the request is forbidden in this area",retry:!1},[Nu.CANNOT_MEET_AREA_DEMAND]:{desc:"unable to allocate services in this area",retry:!1}},[AP.STRING_UID_ALLOCATOR]:{[h2.IIIEGAL_APPID]:{desc:"invalid appid",retry:!1},[h2.IIIEGAL_UID]:{desc:"invalid string uid",retry:!1},[h2.INTERNAL_ERROR]:{desc:"string uid allocator internal error",retry:!0}}};function mS(t){const r=Rge[Math.floor(t/1e4)];if(!r)return{desc:"unknown error",retry:!1};const s=r[t%1e4];if(!s){if(Math.floor(t/1e4)===AP.ACCESS_POINT){const a=t%1e4;if(a.toString()[0]==="1")return{desc:t.toString(),retry:!1};if(a.toString()[0]==="2")return{desc:t.toString(),retry:!0}}return{desc:"unknown error",retry:!1}}return s}const Ige={[Wt.K_TIMESTAMP_EXPIRED]:{desc:"K_TIMESTAMP_EXPIRED",action:"failed"},[Wt.K_CHANNEL_PERMISSION_INVALID]:{desc:"K_CHANNEL_PERMISSION_INVALID",action:"failed"},[Wt.K_CERTIFICATE_INVALID]:{desc:"K_CERTIFICATE_INVALID",action:"failed"},[Wt.K_CHANNEL_NAME_EMPTY]:{desc:"K_CHANNEL_NAME_EMPTY",action:"failed"},[Wt.K_CHANNEL_NOT_FOUND]:{desc:"K_CHANNEL_NOT_FOUND",action:"failed"},[Wt.K_TICKET_INVALID]:{desc:"K_TICKET_INVALID",action:"failed"},[Wt.K_CHANNEL_CONFLICTED]:{desc:"K_CHANNEL_CONFLICTED",action:"failed"},[Wt.K_SERVICE_NOT_READY]:{desc:"K_SERVICE_NOT_READY",action:"tryNext"},[Wt.K_SERVICE_TOO_HEAVY]:{desc:"K_SERVICE_TOO_HEAVY",action:"tryNext"},[Wt.K_UID_BANNED]:{desc:"K_UID_BANNED",action:"failed"},[Wt.K_IP_BANNED]:{desc:"K_IP_BANNED",action:"failed"},[Wt.DATASTREAM2_NOT_AVAILABLE]:{desc:"DATASTREAM2_NOT_AVAILABLE",action:"quit"},[Wt.K_AUTO_REBALANCE]:{desc:"k_AUTO_REBALANCE",action:"recover"},[Wt.ERR_INVALID_VENDOR_KEY]:{desc:"ERR_INVALID_VENDOR_KEY",action:"failed"},[Wt.ERR_INVALID_CHANNEL_NAME]:{desc:"ERR_INVALID_CHANNEL_NAME",action:"failed"},[Wt.WARN_NO_AVAILABLE_CHANNEL]:{desc:"WARN_NO_AVAILABLE_CHANNEL",action:"failed"},[Wt.WARN_LOOKUP_CHANNEL_TIMEOUT]:{desc:"WARN_LOOKUP_CHANNEL_TIMEOUT",action:"tryNext"},[Wt.WARN_LOOKUP_CHANNEL_REJECTED]:{desc:"WARN_LOOKUP_CHANNEL_REJECTED",action:"failed"},[Wt.WARN_OPEN_CHANNEL_TIMEOUT]:{desc:"WARN_OPEN_CHANNEL_TIMEOUT",action:"tryNext"},[Wt.WARN_OPEN_CHANNEL_REJECTED]:{desc:"WARN_OPEN_CHANNEL_REJECTED",action:"failed"},[Wt.WARN_REQUEST_DEFERRED]:{desc:"WARN_REQUEST_DEFERRED",action:"failed"},[Wt.ERR_DYNAMIC_KEY_TIMEOUT]:{desc:"ERR_DYNAMIC_KEY_TIMEOUT",action:"failed"},[Wt.ERR_NO_AUTHORIZED]:{desc:"ERR_NO_AUTHORIZED",action:"failed"},[Wt.ERR_VOM_SERVICE_UNAVAILABLE]:{desc:"ERR_VOM_SERVICE_UNAVAILABLE",action:"tryNext"},[Wt.ERR_NO_CHANNEL_AVAILABLE_CODE]:{desc:"ERR_NO_CHANNEL_AVAILABLE_CODE",action:"failed"},[Wt.ERR_MASTER_VOCS_UNAVAILABLE]:{desc:"ERR_MASTER_VOCS_UNAVAILABLE",action:"tryNext"},[Wt.ERR_INTERNAL_ERROR]:{desc:"ERR_INTERNAL_ERROR",action:"tryNext"},[Wt.ERR_NO_ACTIVE_STATUS]:{desc:"ERR_NO_ACTIVE_STATUS",action:"failed"},[Wt.ERR_INVALID_UID]:{desc:"ERR_INVALID_UID",action:"failed"},[Wt.ERR_DYNAMIC_KEY_EXPIRED]:{desc:"ERR_DYNAMIC_KEY_EXPIRED",action:"failed"},[Wt.ERR_STATIC_USE_DYANMIC_KE]:{desc:"ERR_STATIC_USE_DYANMIC_KE",action:"failed"},[Wt.ERR_DYNAMIC_USE_STATIC_KE]:{desc:"ERR_DYNAMIC_USE_STATIC_KE",action:"failed"},[Wt.ERR_NO_VOCS_AVAILABLE]:{desc:"ERR_NO_VOCS_AVAILABLE",action:"tryNext"},[Wt.ERR_NO_VOS_AVAILABLE]:{desc:"ERR_NO_VOS_AVAILABLE",action:"tryNext"},[Wt.ERR_JOIN_CHANNEL_TIMEOUT]:{desc:"ERR_JOIN_CHANNEL_TIMEOUT",action:"tryNext"},[Wt.ERR_JOIN_BY_MULTI_IP]:{desc:"ERR_JOIN_BY_MULTI_IP",action:"recover"},[Wt.ERR_NOT_JOINED]:{desc:"ERR_NOT_JOINED",action:"failed"},[Wt.ERR_REPEAT_JOIN_REQUEST]:{desc:"ERR_REPEAT_JOIN_REQUEST",action:"quit"},[Wt.ERR_REPEAT_JOIN_CHANNEL]:{desc:"ERR_REPEAT_JOIN_CHANNEL",action:"quit"},[Wt.ERR_INVALID_STRINGUID]:{desc:"ERR_INVALID_STRINGUID",action:"failed"},[Wt.ERR_TOO_MANY_USERS]:{desc:"ERR_TOO_MANY_USERS",action:"tryNext"},[Wt.ERR_SET_CLIENT_ROLE_TIMEOUT]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[Wt.ERR_SET_CLIENT_ROLE_NO_PERMISSION]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[Wt.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE]:{desc:"ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",action:"success"},[Wt.ERR_PUBLISH_REQUEST_INVALID]:{desc:"ERR_PUBLISH_REQUEST_INVALID",action:"failed"},[Wt.ERR_SUBSCRIBE_REQUEST_INVALID]:{desc:"ERR_SUBSCRIBE_REQUEST_INVALID",action:"failed"},[Wt.ERR_NOT_SUPPORTED_MESSAGE]:{desc:"ERR_NOT_SUPPORTED_MESSAGE",action:"failed"},[Wt.ERR_ILLEAGAL_PLUGIN]:{desc:"ERR_ILLEAGAL_PLUGIN",action:"failed"},[Wt.ILLEGAL_CLIENT_ROLE_LEVEL]:{desc:"ILLEGAL_CLIENT_ROLE_LEVEL",action:"failed"},[Wt.ERR_REJOIN_TOKEN_INVALID]:{desc:"ERR_REJOIN_TOKEN_INVALID",action:"failed"},[Wt.ERR_REJOIN_USER_NOT_JOINED]:{desc:"ERR_REJOIN_NOT_JOINED",action:"failed"},[Wt.ERR_INVALID_OPTIONAL_INFO]:{desc:"ERR_INVALID_OPTIONAL_INFO",action:"quit"},[Wt.ERR_TEST_RECOVER]:{desc:"ERR_TEST_RECOVER",action:"recover"},[Wt.ERR_TEST_TRYNEXT]:{desc:"ERR_TEST_TRYNEXT",action:"recover"},[Wt.ERR_TEST_RETRY]:{desc:"ERR_TEST_RETRY",action:"recover"},[Wt.ILLEGAL_AES_PASSWORD]:{desc:"ERR_TEST_RETRY",action:"failed"},[Wt.ERR_TOO_MANY_BROADCASTERS]:{desc:"ERR_TOO_MANY_BROADCASTERS",action:"failed"},[Wt.ERR_TOO_MANY_SUBSCRIBERS]:{desc:"ERR_TOO_MANY_SUBSCRIBERS",action:"failed"},[Wt.ERR_LICENSE_ILLEGAL]:{desc:"ERR_LICENSE_ILLEGAL",action:"quit"},[Wt.ERR_LICENSE_MISSING]:{desc:"ERR_LICENSE_MISSING",action:"quit"},[Wt.ERR_LICENSE_EXPIRED]:{desc:"ERR_LICENSE_EXPIRED",action:"quit"},[Wt.ERR_LICENSE_MINUTES_EXCEEDED]:{desc:"ERR_LICENSE_MINUTES_EXCEEDED",action:"quit"},[Wt.ERR_LICENSE_PERIOD_INVALID]:{desc:"ERR_LICENSE_PERIOD_INVALID",action:"quit"},[Wt.ERR_LICENSE_MULTIPLE_SDK_SERVICE]:{desc:"ERR_LICENSE_MULTIPLE_SDK_SERVICE",action:"quit"}};function Hw(t){return Ige[t]||{desc:"UNKNOWN_ERROR_".concat(t),action:"failed"}}function UH(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}function g2(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?UH(Object(s),!0).forEach(function(a){q(t,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):UH(Object(s)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))})}return t}function VH(t,r){if(typeof t=="string")return t;const{proxy:s,host:a,port:c}=t;if(r){const d=oe("JOIN_GATEWAY_FALLBACK_PORT")||443;return d===443?"wss://".concat(a,"/ws/?p=").concat(Number(c)+150):"wss://".concat(a,":").concat(d,"/ws/?p=").concat(Number(c)+150)}return s?"wss://".concat(s,"/ws/?h=").concat(a,"&p=").concat(c):"wss://".concat(a,":").concat(c)}const Age=/wss:\/\/(.+)\/ws\/\?h=(.+)&p=([0-9]+)\/?/,Pge=/wss:\/\/(.+)\/ws\/\?p=([0-9]+)\/?/,Oge=/wss:\/\/(.+):([0-9]+)\/?/,kge=/wss:\/\/(.[^\/]+)\/?/;let Nge=0;class Dge{constructor(r,s){q(this,"id",0),q(this,"store",void 0),q(this,"recordIndex",void 0),q(this,"websockets",[]),q(this,"try443PortDuration",2e3),q(this,"forceCloseWSDuration",5e3),q(this,"try443PortTimeout",null),q(this,"forceCloseTimeout",null),q(this,"isTry443PortFailed",!1),q(this,"isNormalPortFailed",!1),q(this,"useDoubleDomain",!1),q(this,"useProxy",!1),q(this,"startTime",Date.now()),this.id=++Nge,this.try443PortDuration=oe("JOIN_GATEWAY_TRY_443PORT_DURATION")||2e3,this.forceCloseWSDuration=r||5e3,this.store=s}closeAllWebsockets(){this.websockets.forEach(r=>{r.onopen=null,r.onclose=null,r.onmessage=null,r.close()}),this.websockets.length=0}clearTimeout(){this.forceCloseTimeout&&clearTimeout(this.forceCloseTimeout),this.try443PortTimeout&&clearTimeout(this.try443PortTimeout),this.forceCloseTimeout=null,this.try443PortTimeout=null}logger(){var r;const s=Date.now()-this.startTime;for(var a=arguments.length,c=new Array(a),d=0;d<a;d++)c[d]=arguments[d];x.debug("[choose-best-ws ".concat((r=this.store)===null||r===void 0?void 0:r.clientId," ").concat(this.id,"] ").concat(s,"ms:"),...c)}createWebSocket(r,s,a){this.logger("createWebSocket:",r,{isTry443Port:s,hasTimeoutDetection:a});const c=oe("GATEWAY_DOMAINS"),d=Date.now(),h=[],m=c.find(O=>{var D;return lt(D=r.host).call(D,O)});m||(this.useDoubleDomain=!1);const y=[];if(this.useDoubleDomain)c.forEach(O=>{y.push(VH(g2(g2({},r),{},{host:r.host.replace(m,O)}),s))});else{const O=g2({},r);if(s&&m){const D=c.find(G=>G!==m);D&&(O.host=O.host.replace(m,D))}y.push(VH(O,s))}try{y.forEach(O=>{const D=new WebSocket(O);D.binaryType="arraybuffer",h.push(D),this.logger("ws is connecting:",D.url)})}catch(O){if(this.logger("ws create failed"),h.forEach(D=>D.close()),h.length=0,this.useDoubleDomain)return this.useDoubleDomain=!1,this.createWebSocket(r,s,a);if(!s&&Number(r.port)!==443)return this.createWebSocket(r,!0,a);throw new Ae(te.WS_ERR,"init websocket failed! Error: ".concat(O.toString()))}const v=Ow();this.store&&this.store.recordJoinChannelService({urls:h.map(O=>O.url),service:"gateway"},this.recordIndex),h.forEach(O=>{O.onopen=()=>{this.logger("onopen: ws ".concat(O.url," open cost ").concat(Date.now()-d,"ms")),this.websockets.forEach(D=>{D!==O&&(D.onopen=null,D.onclose=null,D.onmessage=null,D.close(),this.logger("close backup websocket: ".concat(D.url)))}),this.websockets.length=0,v.resolve(O)},O.onclose=D=>{this.logger("onclose: ws ".concat(O.url," closed cost ").concat(Date.now()-d,"ms state: ").concat(O.readyState));const G=h.every(j=>j.readyState===WebSocket.CLOSED||j.readyState===WebSocket.CLOSING);this.logger("".concat(s?"443":"47xx"," websocket closed, all failed: ").concat(G)),G&&(s||this.isTry443PortFailed||this.useProxy)?(this.logger("onclose: all websocket is closed, ".concat(D.reason)),v.reject({code:D.code,reason:kP.A_ROUND_WS_FAILED})):!s&&G&&!this.isNormalPortFailed&&this.try443PortTimeout&&(this.logger("all 47xx websocket is closed, try 443 port"),this.clearTimeout(),R()),s?this.isTry443PortFailed=G:this.isNormalPortFailed=G},O.onmessage=D=>this.logger("".concat(O.url," onmessage: ").concat(D.data))}),this.websockets.push(...h);const w=()=>{this.websockets.forEach(O=>O.readyState!==WebSocket.OPEN&&O.close())},R=()=>{if(v.isResolved)return w();Ln().os===Qi.MAC_OS&&Hr()&&w(),this.createWebSocket(r,!0,!0).then(O=>{v.resolve(O)}).catch(O=>{this.isNormalPortFailed&&v.reject(O),this.logger("try 443 port to create ws failed")}),this.forceCloseTimeout=window.setTimeout(()=>{this.logger("5s timeout close un-opens, isWebsocket created: ",v.isResolved),this.forceCloseTimeout=null,w()},this.forceCloseWSDuration)};return a||(()=>{if(s||this.useProxy)return this.logger("add 5s timeout at ".concat(s?"try-443":"proxy"," condition")),this.forceCloseTimeout=window.setTimeout(()=>{this.forceCloseTimeout=null,w()},this.forceCloseWSDuration);this.try443PortTimeout=window.setTimeout(()=>{this.logger("2s timeout, isWebsocket created: ",v.isResolved),this.try443PortTimeout=null,R()},this.try443PortDuration)})(),v.promise}chooseBestWebsocket(r,s,a,c){return this.useDoubleDomain=!!s,typeof r=="string"&&(r=function(d){let h,m,y;return[,h,m,y]=d.match(Age)||[],h||([,m,y]=d.match(Pge)||[]),m&&y||([,m,y]=d.match(Oge)||[]),m&&y||([,m]=d.match(kge)||[]),m||x.warning("un-destructible url: ",d),{proxy:h,host:m,port:y||"443"}}(r)),this.recordIndex=c,this.useProxy=!!r.proxy,a&&this.useProxy&&(x.warn("cannot use 443 only when use proxy"),a=!1),this.createWebSocket(r,!!a,!1).finally(()=>this.clearTimeout())}}function jH(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}class FH extends Br{get url(){return this.websocket&&this.websocket.url||null}get reconnectMode(){return this._reconnectMode}set reconnectMode(r){var s;lt(s=["tryNext","recover"]).call(s,r)&&this.resetReconnectCount(r),this._reconnectMode=r}get state(){return this._state}set state(r){r!==this._state&&(this._state=r,this._state==="reconnecting"?this.emit(rn.RECONNECTING,this.reconnectReason):this._state==="connected"?this.emit(rn.CONNECTED):this._state==="closed"?this.emit(rn.CLOSED):this._state==="failed"&&this.emit(rn.FAILED))}resetReconnectCount(r){x.debug("websocket reset reconnect count, reason: "+r),this.reconnectCount=0}constructor(r,s){let a=arguments.length>2&&arguments[2]!==void 0&&arguments[2],c=arguments.length>3&&arguments[3]!==void 0&&arguments[3],d=arguments.length>4&&arguments[4]!==void 0&&arguments[4],h=arguments.length>5?arguments[5]:void 0;super(),q(this,"connectionID",0),q(this,"currentURLIndex",0),q(this,"urls",[]),q(this,"_reconnectMode","tryNext"),q(this,"reconnectReason",void 0),q(this,"_initMutex",void 0),q(this,"name",void 0),q(this,"_state","closed"),q(this,"reconnectInterrupter",void 0),q(this,"websocket",void 0),q(this,"retryConfig",void 0),q(this,"reconnectCount",0),q(this,"forceCloseTimeout",5e3),q(this,"onlineReconnectListener",void 0),q(this,"useCompress",void 0),q(this,"tryDoubleDomain",!1),q(this,"use443PortOnly",!1),q(this,"wsInflateLength",0),q(this,"wsDeflateLength",0),q(this,"closeEstablishingWs",()=>{}),q(this,"store",void 0),q(this,"joinGatewayRecordIndex",void 0),this.store=h,this.name=r,this.retryConfig=function(R){for(var O=1;O<arguments.length;O++){var D=arguments[O]!=null?arguments[O]:{};O%2?jH(Object(D),!0).forEach(function(G){q(R,G,D[G])}):Object.getOwnPropertyDescriptors?Object.defineProperties(R,Object.getOwnPropertyDescriptors(D)):jH(Object(D)).forEach(function(G){Object.defineProperty(R,G,Object.getOwnPropertyDescriptor(D,G))})}return R}({},s),this.useCompress=a,this.tryDoubleDomain=c,this.use443PortOnly=d,this._initMutex=new Xs("websocket",h?h.clientId:void 0);const{timeout:m,timeoutFactor:y}=s,v=Math.max(300,Math.floor(3*m/5)),w=Math.max(1.2,Math.floor(8*y)/10);Rc.ONLINE&&(this.retryConfig.timeout=v,this.retryConfig.timeoutFactor=w),Si.on(qv.NETWORK_STATE_CHANGE,(R,O)=>{R!==O&&(this.resetReconnectCount("network state change: ".concat(O," -> ").concat(R)),R===Rc.ONLINE?(this.retryConfig.timeout=v,this.retryConfig.timeoutFactor=w):(this.retryConfig.timeout=m,this.retryConfig.timeoutFactor=y))})}getConnection(){return this.websocket||void 0}async init(r){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const a=await this._initMutex.lock();this._reconnectMode="tryNext",this.forceCloseTimeout=s,this.urls=r,this.state="connecting";try{const c=Ow(),d=this.urls[this.currentURLIndex];oe("ENABLE_PREALLOC_PC")&&this.emit(MH.PRE_CONNECT_PC),this.createWebSocketConnection(d).then(c.resolve).catch(c.reject),this.once(rn.CLOSED,()=>{c.reject(new Le(te.WS_DISCONNECT))}),this.once(rn.CONNECTED,c.resolve),await c.promise}catch{}finally{a()}}close(r,s){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this.reconnectInterrupter&&this.reconnectInterrupter(),this.websocket){this.websocket.onclose=null,this.websocket.onopen=null,this.websocket.onmessage=null;const a=this.websocket;s?setTimeout(()=>a.close(),500):a.close(),this.websocket=void 0}this.state=r?"failed":"closed",this.closeEstablishingWs&&this.closeEstablishingWs()}reconnect(r,s){if(!this.websocket)return void x.warning("[".concat(this.name,"] can not reconnect, no websocket"));r!==void 0&&(this.reconnectMode=r),x.debug("[".concat(this.name,"] reconnect is triggered initiative")),typeof this.joinGatewayRecordIndex=="number"&&this.store&&this.store.recordJoinChannelService({status:"error",errors:[new Error(s)]},this.joinGatewayRecordIndex);const a=this.websocket.onclose;this.websocket.onclose=null,this.websocket.close(),a&&a.bind(this.websocket)({code:9999,reason:s})}sendMessage(r){let s=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!this.websocket||this.websocket.readyState!==WebSocket.OPEN)throw new Le(te.WS_ABORT,"websocket is not ready");try{s||(r=JSON.stringify(r)),this.websocket.send(r)}catch(a){throw new Le(te.WS_ERR,"send websocket message error"+a.toString())}}setWsInflateData(r){this.wsDeflateLength=this.wsDeflateLength+r.originLength,this.wsInflateLength=this.wsInflateLength+r.compressedLength}getWsInflateData(){const r=this.wsInflateLength,s=this.wsDeflateLength;return this.clearWsInflateData(),{wsInflateLength:r,wsDeflateLength:s}}clearWsInflateData(){this.wsInflateLength=0,this.wsDeflateLength=0}async createWebSocketConnection(r){var s;const a=Ow();this.connectionID+=1,this.joinGatewayRecordIndex=void 0;const c=w=>{var R;(R=this.store)===null||R===void 0||R.signalChannelOpen(),x.debug("[".concat(this.name,"] websocket opened:"),w),this.reconnectMode="retry",this.state="connected",this.resetReconnectCount("opened"),a.resolve()},d=async w=>{var R;if(x.debug("[".concat(this.name,"] websocket close ").concat((R=this.websocket)===null||R===void 0?void 0:R.url,", code: ").concat(w.code,", reason: ").concat(w.reason,", current mode: ").concat(this.reconnectMode)),this.reconnectCount>=this.retryConfig.maxRetryCount)a.reject(new Le(te.WS_DISCONNECT,"websocket close: ".concat(w.code))),this.close();else{this.state==="connected"&&(this.reconnectReason=w.reason,this.state="reconnecting");const O=Zc(this,rn.WILL_RECONNECT,this.reconnectMode,w.reason)||this.reconnectMode,D=await this.reconnectWithAction(O);if(this.state==="closed")return void x.debug("[".concat(this.connectionID,"] ws is closed, no need to reconnect"));if(!D)return a.reject(new Le(te.WS_DISCONNECT,"websocket reconnect failed: ".concat(w.code))),this.close(!0);a.resolve()}},h=w=>{this.emit(rn.ON_MESSAGE,w)},m=w=>{x.warn("[".concat(this.connectionID,"] ws open error ").concat(w))};this.websocket&&(this.websocket.onclose=null,this.websocket.close()),oe("GATEWAY_WSS_ADDRESS")&&this.name.startsWith("gateway")&&(r=oe("GATEWAY_WSS_ADDRESS")),x.debug("[".concat(this.name,"] start connect, url:"),r);const y=(s=this.store)===null||s===void 0?void 0:s.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"});try{var v;const w=await this.chooseBestWebsocketConnection(r);this.websocket=w,c&&c(this.websocket.url),this.websocket.onclose=d,this.websocket.onmessage=h,this.websocket.onerror=m,(v=this.store)===null||v===void 0||v.recordJoinChannelService({endTs:Date.now(),status:"success"},y),this.joinGatewayRecordIndex=y}catch(w){const R=this.state==="closed",O=w instanceof Le,D=O&&w.code===te.WS_ABORT,G=O&&w.code===te.WS_ERR,j=O?w.message:w&&(w.reason||w.toString());x.warning("[choose-best-ws] chooseBestWebsocket error: ".concat(j)),this.store&&this.store.recordJoinChannelService({endTs:Date.now(),status:D?"aborted":"error",errors:[w]},y),R||G?(a.reject(R?new Le(te.WS_DISCONNECT,"websocket is closed: ".concat(j)):new Le(te.WS_ERR,"init websocket failed: ".concat(j))),G&&x.error("[".concat(this.name,"] init websocket failed: ").concat(j))):d&&d(w)}return a.promise}async reconnectWithAction(r){let s=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(this.reconnectCount>=this.retryConfig.maxRetryCount||this.urls.length===0||this.state==="closed")return!1;x.warning("[choose-best-ws] action: =>",r),this.onlineReconnectListener||Si.isOnline||!Si.onlineWaiter||(this.onlineReconnectListener=Si.onlineWaiter.then(()=>{this.onlineReconnectListener=void 0}));let a=!0;if(this.reconnectInterrupter=()=>a=!1,s){const h=AL(this.reconnectCount,this.retryConfig);x.debug("[".concat(this.name,"] wait ").concat(h,"ms to reconnect websocket, mode: ").concat(r)),await pt.race([ys(h),this.onlineReconnectListener||new pt(()=>{})])}if(this._state==="closed"||!a)return!1;this.reconnectCount+=1;const c=async(h,m)=>{this.emit(rn.RECONNECT_CREATE_CONNECTION,m),await this.createWebSocketConnection(h)};try{if(r==="retry")await c(this.urls[this.currentURLIndex],r);else if(r==="tryNext"){if(this.currentURLIndex+=1,this.currentURLIndex>=this.urls.length)return this.reconnectWithAction("recover",!1);x.debug("[".concat(this.name,"] websocket url length: ").concat(this.urls.length," current index: ").concat(this.currentURLIndex)),await c(this.urls[this.currentURLIndex],r)}else r==="recover"&&(x.debug("[".concat(this.name,"] request new urls")),this.resetReconnectCount("recover mode"),this.urls=await Ms(this,rn.REQUEST_NEW_URLS),this.currentURLIndex=0,await c(this.urls[this.currentURLIndex],r))}catch(h){var d;x.error("[".concat(this.name,"] reconnect failed ").concat(h&&h.toString()));const m=h==null||(d=h.data)===null||d===void 0?void 0:d.desc;return Array.isArray(m)&&lt(m).call(m,"dynamic key expired")?(this.emit(rn.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):this.reconnectWithAction(r,s)}return!0}}class _2 extends FH{constructor(r,s){super(r,s,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(r,s){const a=Ow(),c=function(h,m){return new Dge(h,m)}(this.forceCloseTimeout,this.store);this.closeEstablishingWs=()=>{x.debug("[choose-best-ws] close establishing websockets"),c.closeAllWebsockets(),a.reject(new Le(te.WS_ABORT,"choose best websocket aborted"))};const d=oe("GATEWAY_DOMAINS");return x.debug("[choose-best-ws] currentDomain: ",r,", domains: ",d,"total: ".concat(this.urls.length),"current: ".concat(this.currentURLIndex+1)),c.chooseBestWebsocket(r,this.tryDoubleDomain,this.use443PortOnly,s).then(a.resolve).catch(a.reject),a.promise.finally(()=>{this.closeEstablishingWs=void 0})}}class $w extends FH{constructor(r,s){super(r,s,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(r,s){return new pt((a,c)=>{let d=!1;const h=[];this.closeEstablishingWs=()=>{x.debug("[choose-best-ws] close establishing websockets"),h.forEach(G=>{G.onclose=null,G.onopen=null,G.onmessage=null,G.close()}),c(new Le(te.WS_ABORT,"choose best websocket aborted"))};const m=oe("GATEWAY_DOMAINS");let y;const v=r.indexOf("?h="),w=m.find(G=>v!==-1?lt(r).call(r,G,v):lt(r).call(r,G));x.debug("[choose-best-ws] currentDomain: ",w,", domains: ",m);let R=!this.tryDoubleDomain||!w;if(!R&&w){var O;const G=Date.now();try{m.forEach(j=>{const W=v===-1?r.replace(w,j):r.substr(0,v)+r.substr(v).replace(w,j),Q=new WebSocket(W);Q.binaryType="arraybuffer",h.push(Q),x.debug("[choose-best-ws] ws is connecting:",Q.url)})}catch{for(x.debug("[choose-best-ws] ws create failed, fallback to single url"),h.forEach(W=>W.close());h.length;)h.pop();R=!0}(O=this.store)===null||O===void 0||O.recordJoinChannelService({urls:h.map(j=>j.url),service:"gateway"},s),h.forEach(j=>{j.onopen=()=>{if(d)return;const W=Date.now()-G;x.debug("[choose-best-ws] ws open cost ".concat(W,"ms")),h.filter(Q=>Q!==j).forEach(Q=>{x.debug("[choose-best-ws]close backup websocket: ".concat(Q.url)),Q.close()}),d=!0,a(j)},j.onclose=W=>{y=W,!d&&(h.find(Q=>!(Q.readyState===WebSocket.CLOSED||Q.readyState===WebSocket.CLOSING))||(x.debug("[choose-best-ws] all websocket is closed"),d=!0,c(y)))},j.onmessage=W=>{x.debug("[choose-best-ws]".concat(j.url," onmessage: ").concat(W.data))}}),ys(this.forceCloseTimeout).then(()=>{h.forEach(j=>{j.readyState!==WebSocket.OPEN&&j.close()})})}if(R){var D;let G;x.debug("[choose-best-ws] use single url: ",r),(D=this.store)===null||D===void 0||D.recordJoinChannelService({urls:[r],service:"gateway"},s);try{G=new WebSocket(r),h.push(G),G.binaryType="arraybuffer"}catch(j){const W=new Le(te.WS_ERR,"init websocket failed! Error: ".concat(j.toString()));return x.error("[".concat(this.name,"]").concat(W)),void c(W)}G.onopen=()=>{a(G)},G.onclose=j=>{c(j)},G.onmessage=j=>{x.debug("[choose-best-ws]".concat(G.url," onmessage: ").concat(j.data))},ys(this.forceCloseTimeout).then(()=>{G&&G.readyState!==WebSocket.OPEN&&G.close()})}}).then(a=>(this.closeEstablishingWs=void 0,a)).catch(a=>{throw this.closeEstablishingWs=void 0,a})}}class xge extends Br{get connectionState(){return this._connectionState}set connectionState(r){r!==this._connectionState&&(this._connectionState=r,r===yr.CONNECTED?this.emit(Jt.WS_CONNECTED):r===yr.RECONNECTING?this.emit(Jt.WS_RECONNECTING,this._websocketReconnectReason):r===yr.CLOSED&&this.emit(Jt.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(r,s){super(),q(this,"_disconnectedReason",void 0),q(this,"_websocketReconnectReason",void 0),q(this,"_connectionState",yr.CLOSED),q(this,"reconnectToken",void 0),q(this,"websocket",void 0),q(this,"openConnectionTime",void 0),q(this,"clientId",void 0),q(this,"lastMsgTime",Date.now()),q(this,"uploadCache",[]),q(this,"uploadCacheInterval",void 0),q(this,"rttRolling",new Qz(5)),q(this,"pingpongTimer",void 0),q(this,"wsInflateDataTimer",void 0),q(this,"pingpongTimeoutCount",0),q(this,"joinResponse",void 0),q(this,"multiIpOption",void 0),q(this,"initError",void 0),q(this,"spec",void 0),q(this,"store",void 0),q(this,"onWebsocketMessage",a=>{if(a.data instanceof ArrayBuffer)return void this.emit(Jt.ON_BINARY_DATA,a.data);const c=JSON.parse(a.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(c,"_id")){const d="res-@".concat(c._id);this.emit(d,c._result,c._message)}else if(Object.prototype.hasOwnProperty.call(c,"_type")){if(this.emit(c._type,c._message),c._type===Cn.ON_NOTIFICATION&&this.handleNotification(c._message),c._type===Cn.ON_USER_BANNED)switch(c._message.error_code){case 14:this.close(Xn.UID_BANNED);break;case 15:this.close(Xn.IP_BANNED);break;case 16:this.close(Xn.CHANNEL_BANNED)}if(c._type===Cn.ON_USER_LICENSE_BANNED)switch(c._message.error_code){case Wt.ERR_LICENSE_MISSING:this.close(Xn.LICENSE_MISSING);break;case Wt.ERR_LICENSE_EXPIRED:this.close(Xn.LICENSE_EXPIRED);break;case Wt.ERR_LICENSE_MINUTES_EXCEEDED:this.close(Xn.LICENSE_MINUTES_EXCEEDED);break;case Wt.ERR_LICENSE_PERIOD_INVALID:this.close(Xn.LICENSE_PERIOD_INVALID);break;case Wt.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(Xn.LICENSE_MULTIPLE_SDK_SERVICE);break;case Wt.ERR_LICENSE_ILLEGAL:this.close(Xn.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=r.clientId,this.spec=r,this.store=s,this.websocket=new _2("gateway-".concat(this.clientId),this.spec.retryConfig,!0,oe("JOIN_GATEWAY_USE_DUAL_DOMAIN"),oe("JOIN_GATEWAY_USE_443PORT_ONLY"),s),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===yr.CONNECTED&&this.reconnect("retry",Ls.OFFLINE)})}async request(r,s,a,c){const d=mr(6,""),h={_id:d,_type:r,_message:s},m=this.websocket.connectionID,y=()=>new pt((G,j)=>{if(this.connectionState===yr.CONNECTED)return G();const W=()=>{this.off(Jt.WS_CLOSED,Q),G()},Q=()=>{this.off(Jt.WS_CONNECTED,W),j(new Ae(te.WS_ABORT))};this.once(Jt.WS_CONNECTED,W),this.once(Jt.WS_CLOSED,Q),r!==Yt.PUBLISH&&r!==Yt.PUBLISH_DATASTREAM&&r!==Yt.SUBSCRIBE&&r!==Yt.SUBSCRIBE_DATASTREAM&&r!==Yt.UNSUBSCRIBE&&r!==Yt.UNSUBSCRIBE_DATASTREAM&&r!==Yt.UNPUBLISH&&r!==Yt.UNPUBLISH_DATASTREAM&&r!==Yt.CONTROL&&r!==Yt.RESTART_ICE||this.once(Jt.DISCONNECT_P2P,()=>{j(new Ae(te.DISCONNECT_P2P))}),r!==Yt.PUBLISH&&r!==Yt.RESTART_ICE||this.once(Jt.ABORT_P2P_EXECUTION,()=>{j(new Ae(te.DISCONNECT_P2P))})});if(this.connectionState!==yr.CONNECTING&&this.connectionState!==yr.RECONNECTING||r===Yt.JOIN||r===Yt.REJOIN||await y(),this.websocket.sendMessage(h,!0),c)return;const v=new pt((G,j)=>{let W=!1;const Q=(fe,ye)=>{W=!0,G({isSuccess:fe==="success",message:ye||{}}),this.off(Jt.WS_CLOSED,ee),this.off(Jt.WS_RECONNECTING,ee),this.emit(Jt.REQUEST_SUCCESS,r,s)};this.once("res-@".concat(d),Q);const ee=()=>{j(new Ae(te.WS_ABORT,"type: ".concat(r))),this.off(Jt.WS_CLOSED,ee),this.off(Jt.WS_RECONNECTING,ee),this.off("res-@".concat(d),Q)};this.once(Jt.WS_CLOSED,ee),this.once(Jt.WS_RECONNECTING,ee),ys(oe("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==m||W||(x.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(r)),this.emit(Jt.REQUEST_TIMEOUT,r,s))})});let w=null;try{w=await v}catch(G){if(this.connectionState===yr.CLOSED||r===Yt.LEAVE)throw new Ae(te.WS_ABORT);return!this.spec.forceWaitGatewayResponse||a?G.throw():r===Yt.JOIN||r===Yt.REJOIN?null:(await y(),await this.request(r,s))}if(w.isSuccess)return w.message;const R=Number(w.message.error_code||w.message.code),O=Hw(R),D=new Ae(te.UNEXPECTED_RESPONSE,"".concat(O.desc,": ").concat(w.message.error_str),{code:R,data:w.message,desc:O.desc});return O.action==="success"?w.message:(x.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(r,", error_code: ").concat(R,", message: ").concat(O.desc,", action: ").concat(O.action)),R===Wt.ERR_TOO_MANY_BROADCASTERS?((r===Yt.JOIN||r===Yt.REJOIN)&&(this.initError=D,this.close()),D.throw()):O.action==="failed"?D.throw():O.action==="quit"?(this.initError=D,this.close(),D.throw()):(R===Wt.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=w.message.option,x.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",Ls.MULTI_IP)):this.reconnect(O.action,Ls.SERVER_ERROR),r===Yt.JOIN||r===Yt.REJOIN?null:await this.request(r,s)))}waitMessage(r,s){return new pt(a=>{const c=d=>{(!s||s(d))&&(this.off(r,c),a(d))};this.on(r,c)})}uploadWRTCStats(r){if(!this.store.sessionId)return void x.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const s={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:r};this.upload(zw.WRTC_STATS,s)}upload(r,s){const a={_type:r,_message:s};try{this.websocket.sendMessage(a)}catch{const d=oe("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(a),this.uploadCache.length>d&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==yr.CONNECTED)return;const h=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(h._type,h._message)},oe("UPLOAD_CACHE_INTERVAL")||2e3))}}send(r,s){const a={_type:r,_message:s};this.websocket.sendMessage(a)}init(r){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new pt((s,a)=>{this.once(Jt.WS_CONNECTED,()=>s(this.joinResponse)),this.once(Jt.WS_CLOSED,c=>a(this.initError||new Ae(te.WS_ABORT,c))),this.connectionState=yr.CONNECTING,this.websocket.init(r).catch(a),this.wsInflateDataTimer&&window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=window.setInterval(()=>{this.handleWsInflateData()},2e4)})}close(r){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.wsInflateDataTimer&&(this.handleWsInflateData(),window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=r||Xn.LEAVE,this.connectionState=yr.CLOSED,x.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close()}async join(){if(!this.joinResponse){this.emit(Jt.ABORT_P2P_EXECUTION);const r=await Ms(this,Jt.REQUEST_JOIN_INFO),s=await this.request(Yt.JOIN,r);if(!s)return this.emit(Jt.REPORT_JOIN_GATEWAY,kP.TIMEOUT,this.url||""),!1;this.joinResponse=s,this.emit(Jt.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=yr.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}async rejoin(){if(!this.reconnectToken)throw new Ae(te.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const r=Mw(this,Jt.REQUEST_REJOIN_INFO);r.token=this.reconnectToken;const s=await this.request(Yt.REJOIN,r);return!!s&&(this.connectionState=yr.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),s.peers&&s.peers.forEach(a=>{this.emit(Cn.ON_USER_ONLINE,{uid:a.uid}),a.audio&&this.emit(Cn.ON_ADD_AUDIO_STREAM,{uid:a.uid,uint_id:a.uint_id,audio:!0,ssrcId:a.audio_ssrc}),a.video&&this.emit(Cn.ON_ADD_VIDEO_STREAM,{uid:a.uid,uint_id:a.uint_id,video:!0,ssrcId:a.video_ssrc}),a.audio_mute?this.emit(Cn.MUTE_AUDIO,{uid:a.uid}):this.emit(Cn.UNMUTE_AUDIO,{uid:a.uid}),a.video_mute?this.emit(Cn.MUTE_VIDEO,{uid:a.uid}):this.emit(Cn.UNMUTE_VIDEO,{uid:a.uid}),a.audio_enable_local?this.emit(Cn.ENABLE_LOCAL_AUDIO,{uid:a.uid}):this.emit(Cn.DISABLE_LOCAL_AUDIO,{uid:a.uid}),a.video_enable_local?this.emit(Cn.ENABLE_LOCAL_VIDEO,{uid:a.uid}):this.emit(Cn.DISABLE_LOCAL_VIDEO,{uid:a.uid}),a.audio||a.video||this.emit(Cn.ON_REMOVE_STREAM,{uid:a.uid,uint_id:a.uint_id})}),!0)}reconnect(r,s){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(r,s)}handleNotification(r){x.debug("[".concat(this.clientId,"] receive notification: "),r);const s=Hw(r.code);if(r.code===28&&"detail"in r&&(x.info("[".concat(this.clientId,"] receive recover notification: "),r.detail),this.emit(Jt.RECOVER_NOTIFICATION,r.detail)),s.action!=="success"){if(s.action!=="failed")return s.action==="quit"?(s.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(Xn.UID_BANNED),void this.close()):void this.reconnect(s.action,Ls.SERVER_ERROR);x.error("[".concat(this.clientId,"] ignore error: "),s.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const r=oe("PING_PONG_TIME_OUT"),s=Date.now();this.pingpongTimeoutCount>=r&&(x.warning("[".concat(this.clientId,"] PING-PONG Timeout. Last Socket Message: ").concat(s-this.lastMsgTime,"ms")),s-this.lastMsgTime>oe("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",Ls.TIMEOUT):this.request(Yt.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const a=Date.now()-s;this.rttRolling.add(a),oe("REPORT_STATS")&&this.send(Yt.PING_BACK,{pingpongElapse:a})}).catch(a=>{})}handleWsInflateData(){const{wsInflateLength:r,wsDeflateLength:s}=this.websocket.getWsInflateData();r!==0&&s!==0&&this.upload(zw.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:s,ws_inflate_length:r})}handleWebsocketEvents(){this.websocket.on(rn.RECONNECT_CREATE_CONNECTION,r=>{this.emit(Jt.WS_RECONNECT_CREATE_CONNECTION,r)}),this.websocket.on(rn.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(rn.CLOSED,()=>{this.connectionState=yr.CLOSED}),this.websocket.on(rn.FAILED,()=>{this._disconnectedReason=Xn.NETWORK_ERROR,this.connectionState=yr.CLOSED}),this.websocket.on(rn.RECONNECTING,r=>{this._websocketReconnectReason=r,this.joinResponse=void 0,this.connectionState===yr.CONNECTED?this.connectionState=yr.RECONNECTING:this.connectionState=yr.CONNECTING}),this.websocket.on(rn.WILL_RECONNECT,(r,s,a)=>{const c=Mw(this,Jt.IS_P2P_DISCONNECTED),d=c||r!=="retry";c&&r==="retry"&&(x.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),r="tryNext",s=kP.P2P_DISCONNECTED),d&&(x.debug("".concat(this.clientId," will renewSession, reconnect mode: ").concat(r)),this.emit(Jt.REPORT_JOIN_GATEWAY,s||kP.UNKNOWN_REASON,this.url||""),this.reconnectToken=void 0,this.emit(Jt.DISCONNECT_P2P)),a(r)}),this.websocket.on(rn.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(r=>{x.warning("[".concat(this.clientId,"] rejoin failed ").concat(r)),this.reconnect("tryNext",Ls.SERVER_ERROR)}):this.join().catch(r=>{if(this.emit(Jt.REPORT_JOIN_GATEWAY,r,this.url||""),r instanceof Ae){if(r.code===te.UNEXPECTED_RESPONSE&&r.data.code===Wt.ERR_NO_AUTHORIZED)return this.initError=new Ae(te.TOKEN_EXPIRE,"dynamic key expired"),void this.close(Xn.TOKEN_EXPIRE);x.error("[".concat(this.clientId,"] join gateway request failed"),r.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",Ls.SERVER_ERROR):(this.initError=r,this.close())}})}),this.websocket.on(rn.REQUEST_NEW_URLS,(r,s)=>{Ms(this,Jt.REQUEST_RECOVER,this.multiIpOption).then(r).catch(s)}),this.websocket.on(rn.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(Cn.ON_TOKEN_PRIVILEGE_DID_EXPIRE)}),this.websocket.on(MH.PRE_CONNECT_PC,()=>{this.emit(Jt.PRE_CONNECT_PC)})}}let Lge=function(t){return t.NATIVE_RTC="native_rtc",t.NATIVE_RTM="native_rtm",t.WEB_RTC="web_rtc",t.WEB_RTM="web_rtm",t}({}),bi=function(t){return t[t.CHOOSE_SERVER=11]="CHOOSE_SERVER",t[t.CLOUD_PROXY=18]="CLOUD_PROXY",t[t.CLOUD_PROXY_5=20]="CLOUD_PROXY_5",t[t.CLOUD_PROXY_FALLBACK=26]="CLOUD_PROXY_FALLBACK",t}({});function BH(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}function DP(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?BH(Object(s),!0).forEach(function(a){q(t,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):BH(Object(s)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))})}return t}function tg(t){return t.match(/^[\.\:\d]+$/)?"".concat(t.replace(/[^\d]/g,"-"),".").concat(oe("TURN_DOMAIN")):(x.debug("Cannot recognized as ip address: ".concat(t,", use as host")),t)}function y2(t,r){t.addresses||(t.addresses=[]);const s=function(m,y){if(oe("CONNECT_GATEWAY_WITHOUT_DOMAIN"))return m.map(R=>{let{ip:O,port:D}=R;return{address:"".concat(O,":").concat(D)}});const v=oe("GATEWAY_DOMAINS");let w=v[1]&&lt(y).call(y,v[1])?1:0;return m.map(R=>{let{domain_prefix:O,port:D,ip:G}=R;if(O)return{address:"".concat(O,".").concat(v[w++%v.length],":").concat(D)};const j=/^[\.\:\d]+$/.test(G),W=j?"".concat(G.replace(/[^\d]/g,"-"),".").concat(v[w++%v.length],":").concat(D):"".concat(G,":").concat(D);return j||x.debug("Cannot recognized as ip address: ".concat(G,", use as host")),{ip:G,port:D,address:W}})}(t.addresses,r),a=Array.isArray(t.detail)&&t.detail[18];if(a&&typeof a=="string"){const m=a.split(";");for(let y=0;y<m.length;y++){var c;const v=Ro(c=m[y]).call(c);s[y]&&v&&(s[y].ip6=v)}}const d=t.detail&&t.detail.candidate;let h;if(d){const[m,y]=d.split(":");m&&y&&(h={port:Number(y),ip:m,address:"".concat(m,":").concat(y)})}return{gatewayAddrs:s,apGatewayAddress:h,uid:t.uid,cid:t.cid,cert:t.cert,vid:t.detail&&t.detail[8],uni_lbs_ip:t.detail&&t.detail[1],res:t,csIp:t.detail&&t.detail[502]}}function Ic(t){return typeof t=="number"?t:t.exact||t.ideal||t.max||t.min||0}function WH(t){const r=t._encoderConfig;if(!r)return{};const s={resolution:r.width&&r.height?"".concat(Ic(r.width),"x").concat(Ic(r.height)):void 0,maxVideoBW:r.bitrateMax,minVideoBW:r.bitrateMin};return typeof r.frameRate=="number"?(s.maxFrameRate=r.frameRate,s.minFrameRate=r.frameRate):r.frameRate&&(s.maxFrameRate=r.frameRate.max||r.frameRate.ideal||r.frameRate.exact||r.frameRate.min,s.minFrameRate=r.frameRate.min||r.frameRate.ideal||r.frameRate.exact||r.frameRate.max),s}function zH(t){return t>=0&&t<.17?1:t>=.17&&t<.36?2:t>=.36&&t<.59?3:t>=.59&&t<=1?4:t>1?5:0}function Kw(t,r){let s,a,c;switch(r){case bi.CHOOSE_SERVER:a=4096,c="choose server";break;case bi.CLOUD_PROXY:a=1048576,c="proxy";break;case bi.CLOUD_PROXY_5:a=4194304,c="proxy5";break;case bi.CLOUD_PROXY_FALLBACK:a=4194310,c="proxy fallback";break;default:throw new Ae(te.UNEXPECTED_ERROR,"multi unlibs response transformer get unknown service id",{csIp:t.detail&&t.detail[502],retry:!1})}if(t.response_body.forEach(d=>{d.buffer&&d.buffer.flag===a&&(s={code:d.buffer.code,addresses:(d.buffer.edges_services||[]).map(h=>DP(DP({},h),{},{ticket:d.buffer.cert})),server_ts:t.enter_ts,uid:d.buffer.uid,cid:d.buffer.cid,cname:d.buffer.cname,detail:DP(DP({},d.buffer.detail),t.detail),flag:d.buffer.flag,opid:t.opid,cert:d.buffer.cert})}),!s)throw new Ae(te.MULTI_UNILBS_RESPONSE_ERROR,"cannot parse response ".concat(c," from multi unilbs response"),{csIp:t.detail&&t.detail[502]});return s}async function GH(t,r){return await pt.all(t.addresses.map(async s=>({address:oe("USE_TURN_IP")?s.ip:tg(s.ip),tcpport:s.port,udpport:s.port,username:r&&oe("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?r.toString():Us.username,password:r&&oe("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?await TL(r.toString()):Us.password})))}function E2(t,r){const s=r.getMediaStreamTrack(!0).getSettings(),a=r.videoHeight||s.height,c=r.videoWidth||s.width;return a&&c?Math.max(Math.min(a,c)/Math.min(Ic(t.height),Ic(t.width)),1):(x.warning("can't get ori-track's height, default scale down 4 times for low stream"),4)}function ng(t){let{candidateType:r,relayProtocol:s,type:a,address:c,port:d,protocol:h}=t;const m={candidateType:r,relayProtocol:s,protocol:h};if(a!=="local-candidate"){const y=c.split(".");y.length>=4&&(y[1]="*",y[2]="*"),m.address=y.join("."),m.port=d}return m}function xP(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:oe("SVC_MODE");if(oe("ENABLE_SVC"))return function(r){return r in lP}(t)?t:lP.L1T3}const HH={[bt.VIDEO]:[{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"},{key:"video-orientation",extensionName:"urn:3gpp:video-orientation"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"playout-delay",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/playout-delay"},{key:"video-content-type",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-content-type"},{key:"color-space",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/color-space"},{key:"video-timing",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-timing"}],[bt.AUDIO]:[{key:"ssrc-audio-level",extensionName:"urn:ietf:params:rtp-hdrext:ssrc-audio-level"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"}]};function LP(t,r,s){r.forEach(a=>{var c;const d=HH[t].find(m=>{var y;let{key:v}=m;return lt(y=a.extensionName).call(y,v)});if(!d)return;const h=s.find(m=>{let{extensionName:y}=m;return lt(y).call(y,d.key)});h&&lt(c=h.extensionName).call(c,"gdpr_forbidden")&&(a.extensionName=h.extensionName)})}function gS(t,r){r.forEach(s=>{var a;const c=HH[t].find(d=>{var h;let{key:m}=d;return lt(h=s.extensionName).call(h,m)});lt(a=s.extensionName).call(a,"gdpr_forbidden")&&c&&(s.extensionName=c.extensionName)})}function $H(t){return t==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"||lt(t).call(t,"abs-send-time")}function MP(t){return t==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"||lt(t).call(t,"draft-holmer-rmcat-transport-wide-cc-extensions-01")}function KH(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}function qH(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?KH(Object(s),!0).forEach(function(a){q(t,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):KH(Object(s)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))})}return t}function qw(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},a=arguments.length>3?arguments[3]:void 0;const{filterRTX:c,filterVideoFec:d,filterAudioFec:h,filterAudioCodec:m,filterVideoCodec:y}=r,{useXR:v}=s;let w=[],R=[],O=[],D=[],G=!1,j=!1;if(Xa(t).mediaDescriptions.forEach(Q=>{a&&a!==Q.attributes.direction||(Q.media.mediaType!=="video"||G||(R=Q.attributes.payloads,D=Q.attributes.extmaps,G=!0),Q.media.mediaType!=="audio"||j||(w=Q.attributes.payloads,O=Q.attributes.extmaps,j=!0))}),!D||R.length===0)throw new Error("Cannot get video capabilities from SDP.");if(!O||w.length===0)throw new Error("Cannot get audio capabilities from SDP.");if(R.forEach(Q=>{var ee;(ee=Q.rtpMap)!==null&&ee!==void 0&&ee.clockRate&&(Q.rtpMap.clockRate=parseInt(Q.rtpMap.clockRate)),v&&Q.rtcpFeedbacks.push({type:"rrtr"})}),w.forEach(Q=>{var ee;(ee=Q.rtpMap)!==null&&ee!==void 0&&ee.clockRate&&(Q.rtpMap.clockRate=parseInt(Q.rtpMap.clockRate)),v&&Q.rtcpFeedbacks.push({type:"rrtr"})}),c&&(w=w.filter(Q=>{var ee;return((ee=Q.rtpMap)===null||ee===void 0?void 0:ee.encodingName.toLowerCase())!=="rtx"}),R=R.filter(Q=>{var ee;return((ee=Q.rtpMap)===null||ee===void 0?void 0:ee.encodingName.toLowerCase())!=="rtx"})),d&&(R=R.filter(Q=>{var ee;return!/(red)|(ulpfec)|(flexfec)/i.test(((ee=Q.rtpMap)===null||ee===void 0?void 0:ee.encodingName)||"")})),h&&(w=w.filter(Q=>{var ee;return!/(red)|(ulpfec)|(flexfec)/i.test(((ee=Q.rtpMap)===null||ee===void 0?void 0:ee.encodingName)||"")})),m&&(m==null?void 0:m.length)>0&&(w=w.filter(Q=>{var ee;return lt(m).call(m,((ee=Q.rtpMap)===null||ee===void 0?void 0:ee.encodingName.toLowerCase())||"")})),y&&(y==null?void 0:y.length)>0){const Q=R.filter(ee=>{var fe;return lt(y).call(y,((fe=ee.rtpMap)===null||fe===void 0?void 0:fe.encodingName.toLowerCase())||"")});R=Q.concat(c?[]:b2(Q,R))}const W=oe("UNSUPPORTED_VIDEO_CODEC");return W&&W.length>0&&(R=R.filter(Q=>!(Q.rtpMap&&lt(W).call(W,Q.rtpMap.encodingName.toLowerCase())))),{audioCodecs:w,videoCodecs:R,audioExtensions:O,videoExtensions:D}}function rg(t){const r=Xa(t);let s,a;for(const c of r.mediaDescriptions){if(!s){const d=c.attributes.iceUfrag,h=c.attributes.icePwd;if(!d||!h)throw new Error("Cannot get iceUfrag or icePwd from SDP.");s={iceUfrag:d,icePwd:h}}if(!a){const d=c.attributes.fingerprints;d.length>0&&(a={fingerprints:d})}}if(!a&&r.attributes.fingerprints.length>0&&(a={fingerprints:r.attributes.fingerprints}),!a||!s)throw new Error("Cannot get iceParameters or dtlsParameters from SDP.");return{iceParameters:s,dtlsParameters:a}}function YH(t,r){const s=[],a=t.attributes.ssrcGroups.filter(h=>h.semantic==="FID"),c=t.attributes.ssrcGroups.find(h=>h.semantic==="SIM"),d=t.attributes.ssrcs;if(c)c.ssrcIds.forEach(h=>{var m;const y=(m=a.find(v=>v.ssrcIds[0]===h))===null||m===void 0?void 0:m.ssrcIds[1];s.push({ssrcId:h,rtx:r?y:void 0})});else if(a.length>0){const h=a[0].ssrcIds[0],m=a[0].ssrcIds[1];s.push({ssrcId:h,rtx:r?m:void 0})}else{if(d.length===0)throw new Error("No ssrcs found on local media description.");s.push({ssrcId:d[0].ssrcId})}return s}function XH(t,r,s){const{cname:a}=t;let c=[];r&&(c=JH(r)),c.length===0&&(c=t.iceParameters.candidates.map(w=>({foundation:w.foundation,componentId:"1",transport:w.protocol,priority:w.priority.toString(),connectionAddress:w.ip,port:w.port.toString(),type:w.type,extension:{}})),x.debug("Using candidates from gateway."));const d={fingerprints:t.dtlsParameters.fingerprints.map(w=>({hashFunction:w.algorithm,fingerprint:w.fingerprint}))},h={iceUfrag:t.iceParameters.iceUfrag,icePwd:t.iceParameters.icePwd};let m;switch(t.dtlsParameters.role){case"server":m="passive";break;case"client":m="active";break;case"auto":m="actpass"}const y=VP(t.rtpCapabilities),v=[];return Array.isArray(s)&&s.length>0&&s.forEach(w=>{v.push({kind:bt.VIDEO,ssrcId:w.v,rtx:w.v_rtx,mslabel:"".concat(w.v,"_").concat(w.a)},{kind:bt.AUDIO,ssrcId:w.a,mslabel:"".concat(w.v,"_").concat(w.a)})}),{dtlsParameters:d,iceParameters:h,candidates:c,rtpCapabilities:y,setup:m,cname:a,preSSRCs:v}}function JH(t){let r=[];return t.ip&&typeof t.port=="number"&&(r=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:t.ip,port:t.port.toString(),type:"host",extension:{}}],x.debug("Using remote candidate from AP ".concat(t.ip,":").concat(t.port)),t.ip6&&(r.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:t.ip6,port:t.port.toString(),type:"host",extension:{}}),x.debug("Using IPV6 remote candidate from AP ".concat(t.ip6,":").concat(t.port)))),r}function oy(t,r,s){const a=[],c=[];return t.forEach(d=>{let{ssrcId:h,rtx:m}=d;const y=mr(8,"track-"),v={ssrcId:h,attributes:qH({label:y,mslabel:s=s||mr(10,""),msid:"".concat(s," ").concat(y)},r&&{cname:r})};if(a.push(v),m!==void 0){const w={ssrcId:m,attributes:qH({label:y,mslabel:s,msid:"".concat(s," ").concat(y)},r&&{cname:r})};a.push(w),c.push({semantic:"FID",ssrcIds:[h,m]})}}),t.length>1&&c.push({semantic:"SIM",ssrcIds:t.map(d=>{let{ssrcId:h}=d;return h})}),{ssrcs:a,ssrcGroups:c}}function _S(t,r){r instanceof Qr&&t.attributes.payloads.forEach(s=>{var a;const c=(a=s.rtpMap)===null||a===void 0?void 0:a.encodingName.toLowerCase();if(!c||["opus","pcmu","pcma","g722"].indexOf(c)===-1)return;s.fmtp||(s.fmtp={parameters:{}}),s.fmtp.parameters.minptime="10",s.fmtp.parameters.useinbandfec="1";const d=r._encoderConfig;d&&c!=="pcmu"&&c!=="pcma"&&c!=="g722"&&(d.bitrate&&!Hr()&&(s.fmtp.parameters.maxaveragebitrate="".concat(Math.floor(1e3*d.bitrate))),d.sampleRate&&(s.fmtp.parameters.maxplaybackrate="".concat(d.sampleRate),s.fmtp.parameters["sprop-maxcapturerate"]="".concat(d.sampleRate)),d.stereo&&(s.fmtp.parameters.stereo="1",s.fmtp.parameters["sprop-stereo"]="1"))})}function v2(t){const r=t.attributes.unrecognized.findIndex(s=>s.attField==="x-google-flag"&&s.attValue==="conference");r!==-1&&t.attributes.unrecognized.splice(r,1)}function S2(t,r){var s;if(!(r instanceof Ir&&r._encoderConfig&&r._hints.indexOf(gr.SCREEN_TRACK)===-1))return;const a=r._encoderConfig;Wn().supportMinBitrate&&a.bitrateMin&&t.attributes.payloads.forEach(c=>{var d,h;lt(d=["h264","h265","vp8","vp9","av1"]).call(d,((h=c.rtpMap)===null||h===void 0?void 0:h.encodingName.toLowerCase())||"")&&(c.fmtp||(c.fmtp={parameters:{}}),c.fmtp.parameters["x-google-min-bitrate"]="".concat(a.bitrateMin))}),Wn().supportMinBitrate&&!lt(s=r._hints).call(s,gr.LOW_STREAM)&&a.bitrateMax&&t.attributes.payloads.forEach(c=>{var d,h;lt(d=["h264","h265","vp8","vp9","av1"]).call(d,((h=c.rtpMap)===null||h===void 0?void 0:h.encodingName.toLowerCase())||"")&&(c.fmtp||(c.fmtp={parameters:{}}),c.fmtp.parameters["x-google-start-bitrate"]="".concat(oe("X_GOOGLE_START_BITRATE")||Math.floor(a.bitrateMax)))})}function QH(t){if(t.media.mediaType!=="video")return;const r=Ln();if(r.name!==$n.SAFARI&&r.os!==Qi.IOS)return;const s=t.attributes.extmaps.findIndex(a=>/video-orientation/g.test(a.extensionName));s!==-1&&t.attributes.extmaps.splice(s,1)}function UP(t,r,s){if(!r)return;let a,c;if(t.media.mediaType==="video"?(a=s.videoExtensions,c=s.videoCodecs):(a=s.audioExtensions,c=s.audioCodecs),r.twcc===!0){const d=a.find(h=>MP(h.extensionName));if(d){const h=d.extensionName;t.attributes.extmaps.find(y=>MP(y.extensionName))||t.attributes.extmaps.push({entry:d.entry,extensionName:h}),function(y,v){return v.filter(w=>!!y.find(R=>R.payloadType===w.payloadType&&!!R.rtcpFeedbacks.find(O=>O.type==="transport-cc")))}(c,t.attributes.payloads).forEach(y=>{y.rtcpFeedbacks.find(v=>v.type==="transport-cc")||y.rtcpFeedbacks.push({type:"transport-cc"})})}}else if(r.twcc===!1){const d=t.attributes.extmaps.findIndex(h=>MP(h.extensionName));d!==-1&&t.attributes.extmaps.splice(d,1),t.attributes.payloads.forEach(h=>{const m=h.rtcpFeedbacks.findIndex(y=>y.type==="transport-cc");m!==-1&&h.rtcpFeedbacks.splice(m,1)})}if(r.remb===!0){const d=a.find(h=>$H(h.extensionName));if(d){const h=d.extensionName;t.attributes.extmaps.find(y=>y.extensionName===h)||t.attributes.extmaps.push({entry:d.entry,extensionName:h}),function(y,v){return v.filter(w=>!!y.find(R=>R.payloadType===w.payloadType&&!!R.rtcpFeedbacks.find(O=>O.type==="goog-remb")))}(c,t.attributes.payloads).forEach(y=>{y.rtcpFeedbacks.find(v=>v.type==="goog-remb")||y.rtcpFeedbacks.push({type:"goog-remb"})})}}else if(r.remb===!1){const d=t.attributes.extmaps.findIndex(h=>$H(h.extensionName));d!==-1&&t.attributes.extmaps.splice(d,1),t.attributes.payloads.forEach(h=>{const m=h.rtcpFeedbacks.findIndex(y=>y.type==="goog-remb");m!==-1&&h.rtcpFeedbacks.splice(m,1)})}}function ZH(t,r,s){if(Hr()||t.media.mediaType!=="video"||!(r instanceof Ir)||s!=="vp9"&&s!=="vp8"||s==="vp8"&&!oe("SIMULCAST")||s==="vp9"&&oe("ENABLE_SVC")||r._scalabilityMode===void 0||r._scalabilityMode.numSpatialLayers<=1)return;const a=s==="vp8"?2:r._scalabilityMode.numSpatialLayers,c=t.attributes.ssrcs[0],d=t.attributes.ssrcGroups.find(m=>m.semantic==="FID"&&m.ssrcIds[0]===c.ssrcId),h={semantic:"SIM",ssrcIds:[c.ssrcId]};for(let m=1;m<a;m++)t.attributes.ssrcs.push({ssrcId:c.ssrcId+m,attributes:qr(c.attributes)}),h.ssrcIds.push(c.ssrcId+m),d&&(t.attributes.ssrcs.push({ssrcId:d.ssrcIds[1]+m,attributes:qr(c.attributes)}),t.attributes.ssrcGroups.push({semantic:"FID",ssrcIds:[c.ssrcId+m,d.ssrcIds[1]+m]}));t.attributes.ssrcGroups.unshift(h)}async function e9(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const s=new RTCPeerConnection;s.addTransceiver("video",{direction:"sendonly"}),s.addTransceiver("audio",{direction:"sendonly"}),s.addTransceiver("video",{direction:"recvonly"}),s.addTransceiver("audio",{direction:"recvonly"});const a=(await s.createOffer()).sdp,{send:c,recv:d,sendrecv:h}=function(){let m=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},y=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},v=arguments.length>2?arguments[2]:void 0;const w=qw(v,m,y,"sendonly"),R=qw(v,m,y,"recvonly"),O={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},D={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},G={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(Lu(w,R,"videoExtensions",O,D,G),Lu(w,R,"videoCodecs",O,D,G),Lu(w,R,"audioExtensions",O,D,G),Lu(w,R,"audioCodecs",O,D,G),oe("RAISE_H264_BASELINE_PRIORITY")){const j=[],W=[];G.videoCodecs.forEach((Q,ee)=>{var fe;if(((fe=Q.rtpMap)===null||fe===void 0?void 0:fe.encodingName.toLocaleLowerCase())==="h264"){var ye,Ee;const _e=G.videoCodecs[ee+1],Ne=_e&&s9(Q,_e),Ze=(ye=Q.fmtp)===null||ye===void 0?void 0:ye.parameters["profile-level-id"],ft=(Ee=Q.fmtp)===null||Ee===void 0?void 0:Ee.parameters["packetization-mode"];!Ze||Ze!==oe("FIRST_H264_PROFILE_LEVEL_ID")||oe("FIRST_PACKETIZATION_MODE")&&ft!==oe("FIRST_PACKETIZATION_MODE")?Ne?W.push([Q,_e]):W.push([Q]):Ne?j.push([Q,_e]):j.push([Q])}}),j.length>0&&W.length>0&&(x.debug("raising H264 baseline profile priority"),G.videoCodecs.forEach((Q,ee)=>{var fe;if(((fe=Q.rtpMap)===null||fe===void 0?void 0:fe.encodingName.toLocaleLowerCase())==="h264"){const ye=s9(Q,G.videoCodecs[ee+1]),Ee=j.shift()||W.shift()||[];Ee.length>0&&(ye?G.videoCodecs.splice(ee,2,...Ee):G.videoCodecs.splice(ee,1,...Ee))}}),D.videoCodecs=D.videoCodecs.filter(Q=>{var ee,fe;return!(((ee=Q.rtpMap)===null||ee===void 0?void 0:ee.encodingName.toLocaleLowerCase())==="h264"&&((fe=Q.fmtp)===null||fe===void 0?void 0:fe.parameters["profile-level-id"])!==oe("FIRST_H264_PROFILE_LEVEL_ID"))}),oe("FILTER_SEND_H264_BASELINE")&&(O.videoCodecs=O.videoCodecs.filter(Q=>{var ee,fe;return!(((ee=Q.rtpMap)===null||ee===void 0?void 0:ee.encodingName.toLocaleLowerCase())==="h264"&&((fe=Q.fmtp)===null||fe===void 0?void 0:fe.parameters["profile-level-id"])!==oe("FIRST_H264_PROFILE_LEVEL_ID"))})))}return{send:O,recv:D,sendrecv:G}}(t,r,a);try{s.close()}catch{}return{send:c,recv:d,sendrecv:h}}function t9(){const t={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},r=qw(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"recvonly"),s={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},a={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},c={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(Lu(t,r,"videoExtensions",s,a,c),Lu(t,r,"videoCodecs",s,a,c),Lu(t,r,"audioExtensions",s,a,c),Lu(t,r,"audioCodecs",s,a,c),oe("RAISE_H264_BASELINE_PRIORITY")){const d=c.videoCodecs.findIndex(h=>h.rtpMap&&h.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&h.fmtp&&h.fmtp.parameters["profile-level-id"]==="42001f");if(d!==-1){const h=c.videoCodecs.findIndex(m=>m.rtpMap&&m.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(h<d){x.debug("raising H264 baseline profile priority");const m=c.videoCodecs[d];c.videoCodecs.splice(d,1),c.videoCodecs.splice(h,0,m)}h!==-1&&(a.videoCodecs=a.videoCodecs.filter(m=>!(m.rtpMap&&m.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&m.fmtp&&m.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:s,recv:a,sendrecv:c}}function Lu(t,r,s,a,c,d){if(s==="videoExtensions"||s==="audioExtensions"){const h=[];return t[s].forEach(m=>{r[s].some((y,v)=>{if(m.entry===y.entry&&m.extensionName===y.extensionName)return h.push(v),!0})?d[s].push(m):a[s].push(m)}),void r[s].forEach((m,y)=>{h.indexOf(y)===-1&&c[s].push(m)})}if(s==="videoCodecs"||s==="audioCodecs"){const h=[];return t[s].forEach(m=>{r[s].some((y,v)=>{if(m.payloadType===y.payloadType&&JSON.stringify(m)===JSON.stringify(y))return h.push(v),!0})?d[s].push(m):a[s].push(m)}),void r[s].forEach((m,y)=>{h.indexOf(y)===-1&&c[s].push(m)})}}function VP(t){const{send:r,recv:s,sendrecv:a}=t;if(!a){if(!r||!s)throw new Error("cannot merge rtp capabilities because one of send or recv is empty!");return{send:r,recv:s}}let c,d;return r?(c={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},c.audioCodecs=[...r.audioCodecs,...a.audioCodecs],c.videoCodecs=[...r.videoCodecs,...a.videoCodecs],c.audioExtensions=[...r.audioExtensions,...a.audioExtensions],c.videoExtensions=[...r.videoExtensions,...a.videoExtensions]):c=a,s?(d={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},d.audioCodecs=[...s.audioCodecs,...a.audioCodecs],d.videoCodecs=[...s.videoCodecs,...a.videoCodecs],d.audioExtensions=[...s.audioExtensions,...a.audioExtensions],d.videoExtensions=[...s.videoExtensions,...a.videoExtensions]):d=a,{send:c,recv:d}}function yS(t){t.media.mediaType==="audio"&&t.attributes.payloads.filter(r=>{var s;return((s=r.rtpMap)===null||s===void 0?void 0:s.encodingName.toLowerCase())==="opus"}).forEach(r=>{r.fmtp||(r.fmtp={parameters:{}}),r.fmtp.parameters.stereo="1",r.fmtp.parameters["sprop-stereo"]="1"})}function Yw(t,r,s,a){let c=[];if(t===bt.VIDEO){if(oe("H264_PROFILE_LEVEL_ID")&&a==="h264"&&(c=r.videoCodecs.filter(d=>{var h;return lt(h=d.rtpMap&&d.rtpMap.encodingName.toLowerCase()||"").call(h,a)&&d&&d.fmtp&&d.fmtp.parameters["profile-level-id"]===oe("H264_PROFILE_LEVEL_ID")})),!Array.isArray(c)||c.length===0){let d=[];const h=[],m=[],y=[];if(s.videoCodecs.forEach(v=>{const w=v.rtpMap&&v.rtpMap.encodingName.toLowerCase()||"";lt(w).call(w,a)?d.push(v):lt(w).call(w,"vp9")?h.push(v):lt(w).call(w,"vp8")?m.push(v):lt(w).call(w,"h264")&&y.push(v)}),d.length===0){let v="";h.length!==0?(d=h,v="vp9"):m.length!==0?(d=m,v="vp8"):y.length!==0&&(d=y,v="h264"),x.warning("codec ".concat(a," not included in rtpCapabilities, fallback to default payloads: ").concat(v))}d.length!==0&&(c=r.videoCodecs.filter(v=>d.some(w=>w.payloadType===v.payloadType)))}if(c.length===0&&(x.warning("codec ".concat(a," not included in rtpCapabilities, fallback to default payloads: ").concat(r.videoCodecs[0].rtpMap&&r.videoCodecs[0].rtpMap.encodingName)),c=r.videoCodecs),oe("USE_PUB_RTX")||oe("USE_SUB_RTX")){const d=b2(c,r.videoCodecs);c=[...c,...d]}}else c=r.audioCodecs.filter(d=>{var h;return lt(h=d.rtpMap&&d.rtpMap.encodingName.toLowerCase()||"").call(h,a)}),c.length===0&&(x.warning("codec ".concat(a," not included in rtpCapabilities, fallback to opus")),c=r.audioCodecs.filter(d=>{var h;return lt(h=d.rtpMap&&d.rtpMap.encodingName.toLowerCase()||"").call(h,"opus")}));return c}function b2(t,r){const s=t.map(a=>a.payloadType.toString());return r.filter(a=>a.rtpMap&&a.rtpMap.encodingName==="rtx"&&a.fmtp&&a.fmtp.parameters.apt&&lt(s).call(s,a.fmtp&&a.fmtp.parameters.apt))}async function Xw(t,r,s){const a=r.toString(),c=r9(a,"offer","remote","exchangeSDP");await t.setRemoteDescription({type:"offer",sdp:a});const d=await t.createAnswer();if(!d.sdp)throw new Error("cannot get answer sdp");let h=d.sdp;h=n9(h,s||{}),c==null||c(h||""),await t.setLocalDescription({type:"answer",sdp:h})}function n9(t,r,s){const a=Xa(t),{useXR:c}=r;return a.mediaDescriptions.forEach(d=>{var h;d.attributes.mid&&(Array.isArray(s)&&!lt(s).call(s,d.attributes.mid)||(d.media.mediaType==="audio"&&yS(d),c&&lt(h=["audio","video"]).call(h,d.media.mediaType)&&d.attributes.payloads.forEach(m=>{m.rtcpFeedbacks.findIndex(y=>y.type==="rrtr")===-1&&m.rtcpFeedbacks.push({type:"rrtr"})})))}),Qm(a)}function r9(t,r,s,a){if(oe("SDP_LOGGING"))return x.upload("exchanging ".concat(s," ").concat(r," SDP during P2PConnection.").concat(a,`
`),t),r==="offer"?c=>{r9(c,"answer",s==="local"?"remote":"local",a)}:void 0}function i9(t){const r=oe("COMPATIBLE_SDP_EXTENSION");return!!(Array.isArray(r)&&r.length>0)&&r.some(s=>lt(t).call(t,s))}function s9(t,r){try{var s;return((s=t.fmtp)===null||s===void 0?void 0:s.parameters.apt)===r.payloadType.toString()}catch{return!1}}function o9(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}function Fl(t,r){return typeof oe(t)===r?oe(t):void 0}function Mge(){try{const t=oe("EXPERIMENTS")||{};return typeof t=="string"||Array.isArray(t)?{}:function(r){for(var s=1;s<arguments.length;s++){var a=arguments[s]!=null?arguments[s]:{};s%2?o9(Object(a),!0).forEach(function(c){q(r,c,a[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(a)):o9(Object(a)).forEach(function(c){Object.defineProperty(r,c,Object.getOwnPropertyDescriptor(a,c))})}return r}({},t)}catch(t){return x.debug("handle gateway attributes failed: ",t),{}}}const a9={};function ig(t){(!(arguments.length>1&&arguments[1]!==void 0)||arguments[1])&&x.debug("install service ".concat(t.name)),a9[t.name]=t}function Sf(t){const r=a9[t];if(!r)throw new Le(te.INVALID_OPERATION,"".concat(t," not found, please use AgoraRTC.use(").concat(t,"Service) to load it first"));return r}function c9(t,r){return Sf("DataStream").create(t,r)}function jP(){return Sf("InterceptFrame").create()}function l9(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}function bf(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?l9(Object(s),!0).forEach(function(a){q(t,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):l9(Object(s)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))})}return t}const w2=new Map;class Uge extends Br{get state(){return this._state}set state(r){if(r===this._state)return;const s=this._state;this._state=r,r==="DISCONNECTED"&&this._disconnectedReason?this.emit(ls.CONNECTION_STATE_CHANGE,r,s,this._disconnectedReason):this.emit(ls.CONNECTION_STATE_CHANGE,r,s)}get joinGatewayStartTime(){return this._joinGatewayStartTime}set joinGatewayStartTime(r){x.debug("[".concat(this.store.clientId,"] set joinGatewayStartTime at ").concat(r)),this._joinGatewayStartTime=r}constructor(r,s){var a,c,d;super(),q(this,"store",void 0),q(this,"joinInfo",void 0),q(this,"key",void 0),q(this,"ntpOffset",0),q(this,"signal",void 0),q(this,"role",void 0),q(this,"inChannelInfo",{joinAt:null,duration:0}),q(this,"spec",void 0),q(this,"_state","DISCONNECTED"),q(this,"_statsCollector",void 0),q(this,"_disconnectedReason",void 0),q(this,"isSignalRecover",!1),q(this,"hasChangeBGPAddress",!1),q(this,"trafficStatsInterval",void 0),q(this,"networkQualityInterval",void 0),q(this,"_joinGatewayStartTime",0),q(this,"_signalTimeout",!1),q(this,"_clientRoleOptions",void 0),q(this,"_isProactiveJoin",!1),this.store=r,this.spec=s,this.signal=this.store.useP2P?(a={spec:bf(bf({},s),{},{retryConfig:s.websocketRetryConfig}),store:r},(c=(d=Sf("P2PChannel")).createSubmodule)===null||c===void 0?void 0:c.call(d,a)):new xge(bf(bf({},s),{},{retryConfig:s.websocketRetryConfig}),r),this._statsCollector=s.statsCollector,this.role=s.role||"audience",this._clientRoleOptions=s.clientRoleOptions,this.handleSignalEvents()}async join(r,s,a){this.store.joinGatewayStart(),r.cloudProxyServer!=="disabled"&&(this.hasChangeBGPAddress=!0);const c=Date.now();let d=w2.get(r.cname);if(d||(d=new Map,w2.set(r.cname,d)),this._isProactiveJoin=!0,d.has(r.uid)){const v=new Ae(te.UID_CONFLICT);throw Nt.joinGateway(r.sid,{lts:c,succ:!1,ec:v.code,addr:null,uid:r.uid,cid:r.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!r.proxyServer,signalChannel:"0",preload:r.preload}),v}d.set(r.uid,!0),this.joinInfo=r,this.key=s;let h=0;this.joinGatewayStartTime=c;const m=r.proxyServer;try{x.debug("[".concat(this.store.clientId,"] use websocket join uid ").concat(h));const v=r.gatewayAddrs.map(w=>{let{address:R}=w;const[O,D]=R.split(":"),G={host:O,port:D};return r.proxyServer&&(G.proxy=r.proxyServer),G});h=(await this.signal.init(v)).uid,x.debug("[".concat(this.store.clientId,"] websocket join uid ").concat(h," cost ").concat(Date.now()-this.joinGatewayStartTime))}catch(v){var y;throw x.error("[".concat(this.store.clientId,"] User join failed"),v.toString()),Nt.joinGateway(r.sid,{lts:c,succ:!1,ec:((y=v.data)===null||y===void 0?void 0:y.desc)||v.code,errorMsg:v.message,addr:this.signal.url,uid:r.uid,cid:r.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!m,signalChannel:"0",preload:r.preload}),d.delete(r.uid),this.signal.close(),v}return this.state="CONNECTED",this.inChannelInfo.joinAt=Date.now(),x.debug("[".concat(this.store.clientId,"] Connected to gateway server")),this.trafficStatsInterval=window.setInterval(()=>{this.updateTrafficStats().catch(v=>{x.warning("[".concat(this.store.clientId,"] get traffic stats error"),v.toString())})},3e3),this.networkQualityInterval=window.setInterval(()=>{navigator&&navigator.onLine!==void 0&&!navigator.onLine?this.emit(ls.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6}):this._signalTimeout?this.emit(ls.NETWORK_QUALITY,{downlinkNetworkQuality:5,uplinkNetworkQuality:5}):this.state==="CONNECTED"&&this._statsCollector.trafficStats?this.emit(ls.NETWORK_QUALITY,{uplinkNetworkQuality:zH(this._statsCollector.trafficStats.B_unq),downlinkNetworkQuality:zH(this._statsCollector.trafficStats.B_dnq)}):this.emit(ls.NETWORK_QUALITY,{uplinkNetworkQuality:0,downlinkNetworkQuality:0})},2e3),this.store.joinGatewayEnd(),h}async leave(){let r=arguments.length>0&&arguments[0]!==void 0&&arguments[0],s=arguments.length>1?arguments[1]:void 0;if(this.state!=="DISCONNECTED"){s!==Xn.FALLBACK&&(this.state="DISCONNECTING");try{r||this.signal.connectionState!==yr.CONNECTED||await function(a,c){return c===1/0?a:pt.race([a,cme(c)])}(this.signal.request(Yt.LEAVE,void 0,!0),3e3)}catch(a){x.warning("[".concat(this.store.clientId,"] leave request failed, ignore"),a)}this.signal.close(s),s!==Xn.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}}async publish(r,s,a){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Ae(te.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const c={state:"offer",p2p_id:this.store.p2pId,ortc:s,mode:this.spec.mode,extend:oe("PUB_EXTEND"),twcc:!!oe("PUBLISH_TWCC"),rtx:!!oe("USE_PUB_RTX")};try{return(await this.signal.request(Yt.PUBLISH,c,!0))._message}catch(d){if(a&&d.data&&d.data.code===Wt.ERR_PUBLISH_REQUEST_INVALID)return x.warning("[".concat(this.store.clientId,"] receive publish error code, retry"),d.toString()),await this.tryUnpubBeforeRepub(r,s),this.publish(r,s,!1);throw d}}async publishDataChannel(r,s,a){var c;if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Ae(te.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const d={stream_id:s.streamId,ordered:s.ordered?1:0,max_retrans_times:(c=s.maxRetransmits)!==null&&c!==void 0?c:10,channel_id:s.channelId,metadata:s.metadata};try{await this.signal.request(Yt.PUBLISH_DATASTREAM,d,!0)}catch(h){if(a&&h.data&&h.data.code===Wt.ERR_PUBLISH_REQUEST_INVALID)return x.warning("[".concat(this.store.clientId,"] receive publish datachannels error code, retry"),h.toString()),await this.tryUnpubDataChannelBeforeRepub(r,s),this.publishDataChannel(r,s,!1);throw h}}async unpublish(r,s){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Ae(te.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await this.signal.request(Yt.UNPUBLISH,{stream_id:s,ortc:r},!0)}catch(a){x.warning("[".concat(this.store.clientId,"] unpublish warning: "),a)}}async unpublishDataChannel(r){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Ae(te.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await pt.all(r.map(s=>this.signal.request(Yt.UNPUBLISH_DATASTREAM,{channel_id:s},!0)))}catch(s){x.warning("unpublish datachannels warning: ",s)}}async presubscribe(r,s,a){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Ae(te.INVALID_OPERATION,"can not presubscribe when connection state is ".concat(this.state));const c={stream_id:r,stream_type:s,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!oe("SUBSCRIBE_TWCC"),rtx:!!oe("USE_SUB_RTX")||void 0,extend:oe("SUB_EXTEND"),svc:Array.isArray(oe("SVC"))&&oe("SVC").length!==0?oe("SVC"):void 0};try{return await this.signal.request(Yt.PRE_SUBSCRIBE,c,!0)}catch(d){if(a&&d.data&&d.data.code===Wt.ERR_SUBSCRIBE_REQUEST_INVALID)return x.warning("[".concat(this.store.clientId,"] pre-subscribe error, retry"),d.toString()),this.presubscribe(r,s,!1);throw d}}async subscribe(r,s,a){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Ae(te.INVALID_OPERATION,"can not subscribe when connection state is ".concat(this.state));const c={stream_id:r,stream_type:s.stream_type,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!oe("SUBSCRIBE_TWCC"),rtx:!!oe("USE_SUB_RTX"),extend:oe("SUB_EXTEND"),ssrcId:s.ssrcId,svc:Array.isArray(oe("SVC"))&&oe("SVC").length!==0?oe("SVC"):void 0};try{return(await this.signal.request(Yt.SUBSCRIBE,c,!0))._message}catch(d){if(a&&d.data&&d.data.code===Wt.ERR_SUBSCRIBE_REQUEST_INVALID)return x.warning("[".concat(this.store.clientId,"] receiver subscribe error code, retry"),d.toString()),await this.tryUnsubBeforeResub(r,s),await this.subscribe(r,s,!1);throw d}}async subscribeDataChannel(r,s,a){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Ae(te.INVALID_OPERATION,"can not subscribe datachannel when connection state is ".concat(this.state));const c={uid:r,stream_id:s.id,channel_id:s.datachannelId};try{return void await this.signal.request(Yt.SUBSCRIBE_DATASTREAM,c,!0)}catch(d){if(a&&d.data&&d.data.code===Wt.ERR_SUBSCRIBE_REQUEST_INVALID)return x.warning("[".concat(this.store.clientId,"] receiver subscribe datachannel error code, retry"),d.toString()),await this.tryUnsubDataChannelBeforeResub(r,s),await this.subscribeDataChannel(r,s,!1);throw d}}async subscribeAll(r,s){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Ae(te.INVALID_OPERATION,"can not massSubscribe when connection state is ".concat(this.state));const a={p2p_id:this.store.p2pId,users:r,dtx:!1,rtx:!!oe("USE_SUB_RTX"),twcc:!!oe("SUBSCRIBE_TWCC"),svc:Array.isArray(oe("SVC"))&&oe("SVC").length!==0?oe("SVC"):void 0};try{return await this.signal.request(Yt.SUBSCRIBE_STREAMS,a,!0)}catch(c){if(s&&c.data&&c.data.code===Wt.ERR_SUBSCRIBE_REQUEST_INVALID)return x.warning("[".concat(this.store.clientId,"] receiver massSubscribe error code, retry"),c.toString()),await this.tryMassUnsubBeforeResub(r),await this.subscribeAll(r,!1);throw c}}async setVideoProfile(r){const s=function(a){if(!(a.bitrateMax&&a.bitrateMin&&a.frameRate&&a.height&&a.width))return;let c=a.frameRate,d=a.width,h=a.height,m=!0;return typeof c!="number"&&(c=c.exact||c.ideal||c.max||c.min||0,c||(m=!1)),typeof d!="number"&&(d=d.exact||d.ideal||d.max||d.min||0,d||(m=!1)),typeof h!="number"&&(h=h.exact||h.ideal||h.max||h.min||0,c||(m=!1)),m?{stream_type:0,width:d,height:h,fps:c,start_bps:1e3*a.bitrateMax,min_bps:1e3*a.bitrateMin,target_bps:1e3*a.bitrateMax}:void 0}(r);if(s)return this.signal.request(Yt.SET_VIDEO_PROFILE,s);x.debug("[".concat(this.store.clientId,"] encoder config is not complete, do not report to gateway"))}async unsubscribe(r,s){try{await this.signal.request(Yt.UNSUBSCRIBE,{p2p_id:this.store.p2pId,ortc:r,stream_id:s},!0)}catch(a){x.warning("[".concat(this.store.clientId,"] unsubscribe warning: "),a)}}async unsubscribeDataChannel(r,s){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Ae(te.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await pt.all(r.map(a=>this.signal.request(Yt.UNSUBSCRIBE_DATASTREAM,{stream_id:a,uid:s},!0)))}catch(a){x.warning("unsubscribeDataChannel warning: ",a)}}async massUnsubscribe(r){try{await this.signal.request(Yt.UNSUBSCRIBE_STREAMS,r,!0)}catch(s){x.warning("[".concat(this.store.clientId,"] massUnsubscribeAll warning: "),s)}}async reconnectPC(r){const{iceParameters:s,dtlsParameters:a,rtpCapabilities:c}=r;return{gatewayEstablishParams:await this.signal.request(Yt.CONNECT_PC,{p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:{iceParameters:s,dtlsParameters:a,rtpCapabilities:c}},!0),gatewayAddress:this.getCurrentGatewayAddress()}}getGatewayInfo(){return this.signal.request(Yt.GATEWAY_INFO)}async renewToken(r){await this.signal.request(Yt.RENEW_TOKEN,r),this.key=r.token}updateClientRole(r,s){s&&(this._clientRoleOptions=Object.assign({},s)),oe("CLIENT_ROLE_OPTIONS")&&(x.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify(oe("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," ")),this._clientRoleOptions=Object.assign({},oe("CLIENT_ROLE_OPTIONS"))),this.role=r}async setClientRole(r,s){if(s&&(this._clientRoleOptions=Object.assign({},s)),oe("CLIENT_ROLE_OPTIONS")&&(this._clientRoleOptions=Object.assign({},oe("CLIENT_ROLE_OPTIONS")),x.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify(oe("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," "))),this.state!=="CONNECTED")return void(this.role=r);let a,c=0;r==="audience"?this._clientRoleOptions&&this._clientRoleOptions.delay?(a=this._clientRoleOptions.delay,c=1):c=this._clientRoleOptions&&this._clientRoleOptions.level?this._clientRoleOptions.level:2:c=0,await this.signal.request(Yt.SET_CLIENT_ROLE,{role:r,level:c,delay:a,client_ts:Date.now()}),this.role=r}async setRemoteVideoStreamType(r,s){await this.signal.request(Yt.SWITCH_VIDEO_STREAM,{stream_id:r,stream_type:s})}async setDefaultRemoteVideoStreamType(r){await this.signal.request(Yt.DEFAULT_VIDEO_STREAM,{stream_type:r})}async setStreamFallbackOption(r,s){await this.signal.request(Yt.SET_FALLBACK_OPTION,{stream_id:r,fallback_type:s})}async pickSVCLayer(r,s){await this.signal.request(Yt.PICK_SVC_LAYER,{stream_id:r,spatial_layer:s.spatialLayer,temporal_layer:s.temporalLayer})}async setRTM2Flag(r){await this.signal.request(Yt.SET_RTM2_FLAG,{rtm2_flag:r})}async sendExtensionMessage(r,s,a){if(this.store.useP2P)return this.signal.sendExtensionMessage(r,s,a)}getInChannelInfo(){return this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt),bf({},this.inChannelInfo)}async getGatewayVersion(){return(await this.signal.request(Yt.GATEWAY_INFO)).version}reset(){if(this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt,this.inChannelInfo.joinAt=null),this.trafficStatsInterval&&(window.clearInterval(this.trafficStatsInterval),this.trafficStatsInterval=void 0),this.joinInfo){const r=w2.get(this.joinInfo.cname);r&&r.delete(this.joinInfo.uid)}this.joinInfo=void 0,this.key=void 0,this.networkQualityInterval&&(window.clearInterval(this.networkQualityInterval),this.networkQualityInterval=void 0)}updateTurnConfigFromSignal(){if(!this.joinInfo)return;const r=function(s){let a;return a=s.startsWith("dc")?s.match(/(dc\:\/\/)?([^:]+):(\d+)/):s.match(/(wss\:\/\/)?([^:]+):(\d+)/),a?{username:Us.username,password:Us.password,turnServerURL:a[2],tcpport:parseInt(a[3])+30,udpport:parseInt(a[3])+30,forceturn:!1}:null}((this.joinInfo.cloudProxyServer==="disabled"?this.signal.url:this.joinInfo.gatewayAddrs[this.signal.currentURLIndex].address)||"");this.joinInfo.turnServer.serversFromGateway=[],r&&this.joinInfo.turnServer.mode!=="off"&&this.joinInfo.cloudProxyServer==="disabled"&&this.joinInfo.turnServer.serversFromGateway.push(bf(bf({},Us),{},{turnServerURL:r.turnServerURL,tcpport:r.tcpport,udpport:r.udpport,username:this.joinInfo.uid.toString(),password:this.joinInfo.token}))}async updateTrafficStats(){if(this.state!=="CONNECTED")return;const r=await this.signal.request(Yt.TRAFFIC_STATS,void 0,!0);r.timestamp=Date.now(),r.ntp_offset!=null&&(this.ntpOffset=r.ntp_offset),r.peer_delay.forEach(s=>{const a=this._statsCollector.trafficStats&&this._statsCollector.trafficStats.peer_delay.find(c=>c.peer_uid===s.peer_uid);a&&a.B_st!==s.B_st&&sP(()=>{this.emit(ls.STREAM_TYPE_CHANGE,s.peer_uid,s.B_st)})}),this._statsCollector.updateTrafficStats(r)}getJoinMessage(r){if(!this.joinInfo||!this.key)throw new Ae(te.UNEXPECTED_ERROR,"can not generate join message, no join info");const s=Object.assign({},this.joinInfo.apResponse);let a=oe("REPORT_APP_SCENARIO");if(typeof a!="string")try{a=JSON.stringify(a)}catch{a=void 0}var c;a&&a.length>128&&(a=void 0),this.store.hasStartJoinChannel=!0,this.store.isABTestSuccess||this.emit(ls.UPDATE_GATEWAY_CONFIG),c=this.store.clientId,lt(dS).call(dS,c)||dS.push(c);const d=!(Hr()||Iz(87)||g8())&&typeof oe("ENABLE_PRE_SUB")=="boolean"&&oe("ENABLE_PRE_SUB"),h=!g8()&&Fl("ENABLE_PREALLOC_PC","boolean"),m=Mge(),y=kw(87)||function(){const w=Ln();if(w.name!==$n.SAFARI||!w.browserVersion)return!1;const R=w.browserVersion.split(".");return Number(R[0])>15||Number(R[0])===15&&Number(R[1])>=4}(),v=bf({license:this.joinInfo.license,p2p_id:this.store.p2pId,session_id:this.joinInfo.sid,app_id:this.joinInfo.appId,channel_key:this.key,channel_name:this.joinInfo.cname,sdk_version:Ml,browser:navigator.userAgent,process_id:oe("PROCESS_ID"),mode:this.store.useP2P?"p2p":this.spec.mode,codec:this.spec.codec,role:this.role,has_changed_gateway:this.hasChangeBGPAddress,ap_response:s,extend:oe("JOIN_EXTEND"),details:{6:this.joinInfo.stringUid,cservice_map:this.joinInfo.cloudProxyServer==="proxy3"?"1":this.joinInfo.cloudProxyServer==="proxy5"?"2":void 0},features:{rejoin:!0},optionalInfo:this.joinInfo.optionalInfo,appScenario:a,attributes:{userAttributes:bf({enableEncodedTransform:!!oe("ENABLE_AUDIO_METADATA")&&y||!!oe("ENABLE_AUDIO_TOPN")&&gL($n.CHROME,87,116)||void 0,enableAudioMetadata:!!oe("ENABLE_AUDIO_METADATA")&&y,enableAudioPts:!!oe("ENABLE_AUDIO_PTS_METADATA")&&y,topnSmoothLevel:oe("TOPN_SMOOTH_LEVEL"),topnNewSpeakerDelay:oe("TOPN_NEW_SPEAKER_DELAY"),topnSwitchHoldMs:oe("TOPN_SWITCH_HOLD_MS"),topnAudioGain:oe("TOPN_AUDIO_GAIN"),enablePublishedUserList:oe("ENABLE_PUBLISHED_USER_LIST"),maxSubscription:oe("MAX_SUBSCRIPTION"),subscribeAudioFilterTopN:Fl("SUBSCRIBE_AUDIO_FILTER_TOPN","number"),enablePublishAudioFilter:Fl("ENABLE_PUBLISH_AUDIO_FILTER","boolean"),enableUserLicenseCheck:Fl("ENABLE_USER_LICENSE_CHECK","boolean"),enableRTX:oe("USE_PUB_RTX")===!0||oe("USE_SUB_RTX")===!0||void 0,disableFEC:oe("DISABLE_FEC"),enableNTPReport:!!oe("ENABLE_NTP_REPORT")||void 0,enableInstantVideo:!!oe("ENABLE_INSTANT_VIDEO")||void 0,enableFulllinkAvSync:!!oe("ENABLE_FULL_LINK_AV_SYNC")||void 0,enableDataStream2:Fl("ENABLE_DATASTREAM_2","boolean"),enableAutFeedback:!!oe("ENABLE_AUT_FEEDBACK")||void 0,rtm2Flag:typeof this.joinInfo.rtmFlag=="number"?this.joinInfo.rtmFlag:void 0,enableUserAutoRebalanceCheck:!!oe("ENABLE_USER_AUTO_REBALANCE_CHECK"),enableXR:Fl("USE_XR","boolean"),enableLossbasedBwe:Fl("ENABLE_LOSSBASED_BWE","boolean"),enableAutCC:!!oe("ENABLE_AUT_CC")||void 0,enableCCFallback:Fl("ENABLE_CC_FALLBACK","boolean"),enablePreallocPC:h,preSubNum:d?Fl("PRE_SUB_NUM","number"):void 0,enablePubTWCC:Fl("PUBLISH_TWCC","boolean"),enableSubTWCC:Fl("SUBSCRIBE_TWCC","boolean"),enablePubRTX:Fl("USE_PUB_RTX","boolean"),enableSubRTX:Fl("USE_SUB_RTX","boolean"),enableSubSVC:oe("ENABLE_SVC")?oe("ENABLE_SVC_DEFAULT_CODECS"):Array.isArray(oe("SVC"))&&oe("SVC").length!==0?oe("SVC"):void 0,enableSvcExtended:oe("ENABLE_SVC")&&Array.isArray(oe("SVC_EXTENDED"))&&oe("SVC_EXTENDED").length!==0?oe("SVC_EXTENDED"):void 0},m)},join_ts:this.joinGatewayStartTime},r);return this.joinInfo.stringUid&&(v.string_uid=this.joinInfo.stringUid),this.joinInfo.aesmode&&this.joinInfo.aespassword&&(v.aes_mode=this.joinInfo.aesmode,oe("ENCRYPT_AES")?(v.aes_secret=this.joinInfo.aespassword,v.aes_encrypt=!0):v.aes_secret=this.joinInfo.aespassword,this.joinInfo.aessalt&&(v.aes_salt=this.joinInfo.aessalt)),s.addresses[this.signal.websocket.currentURLIndex]&&(v.ap_response.ticket=s.addresses[this.signal.websocket.currentURLIndex].ticket,delete s.addresses),this.joinInfo.defaultVideoStream!==void 0&&(v.default_video_stream=this.joinInfo.defaultVideoStream),v}getRejoinMessage(){if(!this.joinInfo)throw new Ae(te.UNEXPECTED_ERROR,"can not generate rejoin message, no join info");return{session_id:this.joinInfo.sid,channel_name:this.joinInfo.cname,cid:this.joinInfo.cid,uid:this.joinInfo.uid,vid:Number(this.joinInfo.vid)}}handleSignalEvents(){this.signal.on(Jt.WS_RECONNECT_CREATE_CONNECTION,r=>{this.joinGatewayStartTime=Date.now()}),this.signal.on(Jt.WS_RECONNECTING,r=>{this.joinInfo&&Nt.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:r||Ls.NETWORK_ERROR}),this.joinInfo&&(this.state="RECONNECTING",Nt.sessionInit(this.joinInfo.sid,{lts:new Date().getTime(),extend:this.isSignalRecover?{recover:!0}:{rejoin:!0},cname:this.joinInfo.cname,appid:this.joinInfo.appId,mode:this.spec.mode,stringUid:this.joinInfo.stringUid,channelProfile:this.spec.mode==="live"?1:0,channelMode:0,lsid:this.joinInfo.sid,clientRole:this.role==="audience"?2:1,buildFormat:1}),this.isSignalRecover=!1,this.joinGatewayStartTime=Date.now())}),this.signal.on(Jt.WS_CLOSED,r=>{let s;switch(r){case Xn.LEAVE:s=Ls.LEAVE;break;case Xn.UID_BANNED:case Xn.IP_BANNED:case Xn.CHANNEL_BANNED:case Xn.SERVER_ERROR:s=Ls.SERVER_ERROR;break;case Xn.FALLBACK:s=Ls.FALLBACK;break;case Xn.LICENSE_MISSING:case Xn.LICENSE_EXPIRED:case Xn.LICENSE_MINUTES_EXCEEDED:case Xn.LICENSE_PERIOD_INVALID:case Xn.LICENSE_MULTIPLE_SDK_SERVICE:case Xn.LICENSE_ILLEGAL:case Xn.TOKEN_EXPIRE:s=r;break;default:s=Ls.NETWORK_ERROR}x.debug("[".concat(this.store.clientId,"] [signal] websocket closed, reason: ").concat(s||"undefined -> "+Ls.NETWORK_ERROR)),this.joinInfo&&Nt.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:r===Xn.LEAVE?1:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:s}),this._disconnectedReason=r,r!==Xn.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}),this.signal.on(Jt.WS_CONNECTED,()=>{if(this.updateTurnConfigFromSignal(),this.state="CONNECTED",this.joinInfo){if(this.role==="audience"){const r=oe("CLIENT_ROLE_OPTIONS")||this._clientRoleOptions;r&&(r.level||r.delay)&&(x.debug("[".concat(this.store.clientId,"] patch to send set client role, role: ").concat(this.role,", mode: ").concat(this.spec.mode,", level: ").concat(r.level,", delay: ").concat(r.delay)),this.setClientRole(this.role,r))}if(Nt.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!0,ec:null,vid:this.joinInfo.vid,addr:this.signal.url,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload,isABTestSuccess:this.store.isABTestSuccess}),this._isProactiveJoin=!1,this.joinInfo.useLocalAccessPoint&&this.joinInfo.setLocalAPVersion===1){const r=this.signal.url&&this.signal.url.match(/wss\:\/\/([^:]+):(\d+)/);if(!r)return void x.error("[".concat(this.store.clientId,"] set local access point after joined failed: ").concat(r));sr("EVENT_REPORT_DOMAIN",r[1]),sr("EVENT_REPORT_BACKUP_DOMAIN",r[1]),sr("LOG_UPLOAD_SERVER","".concat(r[1],":6444"))}}}),this.signal.on(Cn.ON_UPLINK_STATS,r=>{this._statsCollector.updateUplinkStats(r)}),this.signal.on(Jt.REQUEST_RECOVER,(r,s,a)=>{if(!this.joinInfo)return a(new Ae(te.UNEXPECTED_ERROR,"gateway: can not recover, no join info"));r&&(this.joinInfo.multiIP=r,this.hasChangeBGPAddress=!0),this.isSignalRecover=!0,Ms(this,ls.REQUEST_NEW_GATEWAY_LIST).then(s).catch(a)}),this.signal.on(Jt.REQUEST_JOIN_INFO,async(r,s,a)=>{var c;if(this.updateTurnConfigFromSignal(),this.store.useP2P)return void r(this.getJoinMessage({ortc:{}}));const d=qr((c=this.joinInfo)===null||c===void 0?void 0:c.turnServer);if(oe("NEW_TURN_MODE")&&d){let v=d.servers,w=d.serversFromGateway;const R=this.signal.currentURLIndex;v.length>0&&(v=[v[R%v.length]],d.servers=v),Array.isArray(w)&&w.length>0&&(w=[w[0]],d.serversFromGateway=w),x.debug("[".concat(this.store.clientId,"] use single turn, use turn server index: ").concat(R))}const{iceParameters:h,dtlsParameters:m,rtpCapabilities:y}=await Ms(this,ls.REQUEST_P2P_CONNECTION_PARAMS,{turnServer:d});try{r(this.getJoinMessage({ortc:{iceParameters:h,dtlsParameters:m,rtpCapabilities:y,version:"2"}}))}catch(v){s(v)}}),this.signal.on(Jt.REQUEST_REJOIN_INFO,r=>{r(this.getRejoinMessage())}),this.signal.on(Jt.REPORT_JOIN_GATEWAY,(r,s)=>{if(!this.joinInfo)return;let a,c="";var d;r instanceof Ae?(a=((d=r.data)===null||d===void 0?void 0:d.desc)||r.code,c=r.message):a=r,Nt.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!1,ec:a,errorMsg:c,addr:s,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload})}),this.signal.on(Jt.IS_P2P_DISCONNECTED,r=>{r(Mw(this,ls.IS_P2P_DISCONNECTED))}),this.signal.on(Jt.DISCONNECT_P2P,()=>{this.emit(ls.DISCONNECT_P2P)}),this.signal.on(Jt.REQUEST_SUCCESS,()=>{this._signalTimeout=!1}),this.signal.on(Jt.REQUEST_TIMEOUT,()=>{this._signalTimeout=!0}),this.signal.on(Jt.JOIN_RESPONSE,r=>{const s=this.getCurrentGatewayAddress();this.emit(ls.JOIN_RESPONSE,r,s)}),this.signal.on(Jt.PRE_CONNECT_PC,async()=>{if(this.joinInfo){this.updateTurnConfigFromSignal();const r=this.getCurrentGatewayAddress(),s=oe("FINGERPRINT")||this.joinInfo.apResponse.addresses[this.signal.currentURLIndex].fingerprint;if(r&&s){const a=JH(r);this.emit(ls.PRE_CONNECT_PC,{candidates:a,fingerprint:s})}}}),this.signal.on(Jt.RECOVER_NOTIFICATION,r=>{this.joinInfo&&typeof oe("AP_REQUEST_DETAIL")=="string"&&(this.joinInfo.apRequestDetail="".concat(oe("AP_REQUEST_DETAIL"),";").concat(r))})}async tryUnsubBeforeResub(r,s){try{await this.signal.request(Yt.UNSUBSCRIBE,{p2p_id:this.store.p2pId,stream_id:r,ortc:[s]},!0)}catch(a){throw x.warning("[".concat(this.store.clientId,"] tryUnsubBeforeResub warning"),a),a}}async tryUnsubDataChannelBeforeResub(r,s){try{await this.signal.request(Yt.UNSUBSCRIBE,{stream_id:s.id},!0)}catch(a){throw x.warning("unsubscribe datachannel warning",a),a}}async tryUnpubBeforeRepub(r,s){try{await this.signal.request(Yt.UNPUBLISH,{stream_id:r,ortc:s},!0)}catch(a){throw x.warning("[".concat(this.store.clientId,"] tryUnpubBeforeRepub warning: "),a),a}}async tryUnpubDataChannelBeforeRepub(r,s){try{await this.signal.request(Yt.UNPUBLISH_DATASTREAM,{channnel_id:s.channelId},!0)}catch(a){throw x.warning("unpublish datastream warning: ",a),a}}async tryMassUnsubBeforeResub(r){const s={users:r.map(a=>({stream_id:a.stream_id,stream_type:a.stream_type}))};try{await this.signal.request(Yt.UNSUBSCRIBE_STREAMS,s,!0)}catch(a){throw x.warning("[".concat(this.store.clientId,"] tryMassUnsubBeforeResub warning"),a),a}}async muteLocal(r,s){const a={action:r.find(c=>c.stream_type===Qn.Audio)?"mute_local_audio":"mute_local_video",p2p_id:this.store.p2pId,ortc:r,stream_id:s};try{await this.signal.request(Yt.CONTROL,a,!0,!0)}catch(c){throw x.warning("[".concat(this.store.clientId,"] gateway muteLocal warning: "),c),c}}async unmuteLocal(r,s){const a={action:r.find(c=>c.stream_type===Qn.Audio)?"unmute_local_audio":"unmute_local_video",p2p_id:this.store.p2pId,ortc:r,stream_id:s};try{await this.signal.request(Yt.CONTROL,a,!0,!0)}catch(c){throw x.warning("[".concat(this.store.clientId,"] gateway unmuteLocal warning: "),c),c}}async muteRemote(r,s){const a={action:r===bt.AUDIO?"mute_remote_audio":"mute_remote_video",p2p_id:this.store.p2pId,stream_id:s};try{await this.signal.request(Yt.CONTROL,a,!0,!0)}catch(c){throw x.warning("[".concat(this.store.clientId,"] gateway muteRemote warning: "),c),c}}async unmuteRemote(r,s){const a={action:r===bt.AUDIO?"unmute_remote_audio":"unmute_remote_video",p2p_id:this.store.p2pId,stream_id:s};try{await this.signal.request(Yt.CONTROL,a,!0,!0)}catch(c){throw x.warning("[".concat(this.store.clientId,"] gateway unmuteRemote warning: "),c),c}}uploadWRTCStats(r){this.signal.uploadWRTCStats(r)}upload(r,s){this.signal.upload(r,s)}getSignalRTT(){return this.signal.rtt}async restartICE(r){const s={p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:r};try{return await this.signal.request(Yt.RESTART_ICE,s,!0)}catch(a){throw x.warning("[".concat(this.store.clientId,"] P2PChannel.restartICE warning: "),a),a}}reconnect(r,s){this.state==="CONNECTED"&&this.signal.reconnect(r||void 0,s||Ls.P2P_FAILED)}getCurrentGatewayAddress(){var r,s;if(!oe("GATEWAY_WSS_ADDRESS"))return oe("USE_CANDIDATE_FROM_AP_DETAIL")&&(r=this.joinInfo)!==null&&r!==void 0&&r.apGatewayAddress?(x.debug("[".concat(this.store.clientId,"] use candidate from ap detail, ").concat(JSON.stringify(this.joinInfo.apGatewayAddress))),this.joinInfo.apGatewayAddress):(s=this.joinInfo)!==null&&s!==void 0&&s.gatewayAddrs?this.joinInfo.gatewayAddrs[this.signal.currentURLIndex]:void 0}async setPublishAudioFilterEnabled(r){await this.signal.request(Yt.SET_PARAMETER,{enablePublishAudioFilter:r})}}let FP=0,T2=0;function Md(t,r,s,a){return new pt((c,d)=>{r.timeout=r.timeout||oe("HTTP_CONNECT_TIMEOUT"),r.responseType=r.responseType||"json",r.data&&!s?(r.data=JSON.stringify(r.data),FP+=kh(r.data)):s&&(r.data.size?FP+=r.data.size:r.data instanceof FormData?FP+=Hz(r.data):FP+=kh(JSON.stringify(r.data))),r.headers=r.headers||{},r.headers["Content-Type"]=r.headers["Content-Type"]||"application/json",r.method="POST",r.url=t,va.request(r).then(h=>{typeof h.data=="string"?T2+=kh(h.data):h.data instanceof ArrayBuffer||h.data instanceof Uint8Array?T2+=h.data.byteLength:T2+=kh(JSON.stringify(h.data)),a&&c({data:h.data,headers:h.headers}),c(h.data)}).catch(h=>{va.isCancel(h)?d(new Ae(te.OPERATION_ABORTED,"cancel token canceled")):h.code==="ECONNABORTED"?d(new Ae(te.NETWORK_TIMEOUT,h.message)):h.response?d(new Ae(te.NETWORK_RESPONSE_ERROR,h.response.status)):d(new Ae(te.NETWORK_ERROR,h.message))})})}/*! formdata-polyfill. MIT License. Jimmy W?rting <https://jimmy.warting.se/opensource> */(function(){var t;function r(ze){var at=0;return function(){return at<ze.length?{done:!1,value:ze[at++]}:{done:!0}}}var s=typeof Object.defineProperties=="function"?Object.defineProperty:function(ze,at,Pt){return ze==Array.prototype||ze==Object.prototype||(ze[at]=Pt.value),ze},a,c=function(ze){ze=[typeof globalThis=="object"&&globalThis,ze,typeof window=="object"&&window,typeof self=="object"&&self,typeof o=="object"&&o];for(var at=0;at<ze.length;++at){var Pt=ze[at];if(Pt&&Pt.Math==Math)return Pt}throw Error("Cannot find global object")}(this);function d(ze,at){if(at)e:{var Pt=c;ze=ze.split(".");for(var Ye=0;Ye<ze.length-1;Ye++){var U=ze[Ye];if(!(U in Pt))break e;Pt=Pt[U]}(at=at(Ye=Pt[ze=ze[ze.length-1]]))!=Ye&&at!=null&&s(Pt,ze,{configurable:!0,writable:!0,value:at})}}function h(ze){return(ze={next:ze})[Symbol.iterator]=function(){return this},ze}function m(ze){var at=typeof Symbol<"u"&&Symbol.iterator&&ze[Symbol.iterator];return at?at.call(ze):{next:r(ze)}}if(d("Symbol",function(ze){function at(U,ce){this.A=U,s(this,"description",{configurable:!0,writable:!0,value:ce})}if(ze)return ze;at.prototype.toString=function(){return this.A};var Pt="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",Ye=0;return function U(ce){if(this instanceof U)throw new TypeError("Symbol is not a constructor");return new at(Pt+(ce||"")+"_"+Ye++,ce)}}),d("Symbol.iterator",function(ze){if(ze)return ze;ze=Symbol("Symbol.iterator");for(var at="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),Pt=0;Pt<at.length;Pt++){var Ye=c[at[Pt]];typeof Ye=="function"&&typeof Ye.prototype[ze]!="function"&&s(Ye.prototype,ze,{configurable:!0,writable:!0,value:function(){return h(r(this))}})}return ze}),typeof Object.setPrototypeOf=="function")a=Object.setPrototypeOf;else{var y;e:{var v={};try{v.__proto__={a:!0},y=v.a;break e}catch{}y=!1}a=y?function(ze,at){if(ze.__proto__=at,ze.__proto__!==at)throw new TypeError(ze+" is not extensible");return ze}:null}var w=a;function R(){this.m=!1,this.j=null,this.v=void 0,this.h=1,this.u=this.C=0,this.l=null}function O(ze){if(ze.m)throw new TypeError("Generator is already running");ze.m=!0}function D(ze,at){return ze.h=3,{value:at}}function G(ze){this.g=new R,this.G=ze}function j(ze,at,Pt,Ye){try{var U=at.call(ze.g.j,Pt);if(!(U instanceof Object))throw new TypeError("Iterator result "+U+" is not an object");if(!U.done)return ze.g.m=!1,U;var ce=U.value}catch(me){return ze.g.j=null,ze.g.s(me),W(ze)}return ze.g.j=null,Ye.call(ze.g,ce),W(ze)}function W(ze){for(;ze.g.h;)try{var at=ze.G(ze.g);if(at)return ze.g.m=!1,{value:at.value,done:!1}}catch(Pt){ze.g.v=void 0,ze.g.s(Pt)}if(ze.g.m=!1,ze.g.l){if(at=ze.g.l,ze.g.l=null,at.F)throw at.D;return{value:at.return,done:!0}}return{value:void 0,done:!0}}function Q(ze){this.next=function(at){return ze.o(at)},this.throw=function(at){return ze.s(at)},this.return=function(at){return function(Pt,Ye){O(Pt.g);var U=Pt.g.j;return U?j(Pt,"return"in U?U.return:function(ce){return{value:ce,done:!0}},Ye,Pt.g.return):(Pt.g.return(Ye),W(Pt))}(ze,at)},this[Symbol.iterator]=function(){return this}}function ee(ze,at){return at=new Q(new G(at)),w&&ze.prototype&&w(at,ze.prototype),at}if(R.prototype.o=function(ze){this.v=ze},R.prototype.s=function(ze){this.l={D:ze,F:!0},this.h=this.C||this.u},R.prototype.return=function(ze){this.l={return:ze},this.h=this.u},G.prototype.o=function(ze){return O(this.g),this.g.j?j(this,this.g.j.next,ze,this.g.o):(this.g.o(ze),W(this))},G.prototype.s=function(ze){return O(this.g),this.g.j?j(this,this.g.j.throw,ze,this.g.o):(this.g.s(ze),W(this))},d("Array.prototype.entries",function(ze){return ze||function(){return function(at,Pt){at instanceof String&&(at+="");var Ye=0,U=!1,ce={next:function(){if(!U&&Ye<at.length){var me=Ye++;return{value:Pt(me,at[me]),done:!1}}return U=!0,{done:!0,value:void 0}}};return ce[Symbol.iterator]=function(){return ce},ce}(this,function(at,Pt){return[at,Pt]})}}),typeof Blob<"u"&&(typeof FormData>"u"||!FormData.prototype.keys)){var fe=function(ze,at){for(var Pt=0;Pt<ze.length;Pt++)at(ze[Pt])},ye=function(ze){return ze.replace(/\r?\n|\r/g,`\r
`)},Ee=function(ze,at,Pt){return at instanceof Blob?(Pt=Pt!==void 0?Pt+"":typeof at.name=="string"?at.name:"blob",at.name===Pt&&Object.prototype.toString.call(at)!=="[object Blob]"||(at=new File([at],Pt)),[String(ze),at]):[String(ze),String(at)]},_e=function(ze,at){if(ze.length<at)throw new TypeError(at+" argument required, but only "+ze.length+" present.")},Ne=typeof globalThis=="object"?globalThis:typeof window=="object"?window:typeof self=="object"?self:this,Ze=Ne.FormData,ft=Ne.XMLHttpRequest&&Ne.XMLHttpRequest.prototype.send,yt=Ne.Request&&Ne.fetch,An=Ne.navigator&&Ne.navigator.sendBeacon,Pn=Ne.Element&&Ne.Element.prototype,_r=Ne.Symbol&&Symbol.toStringTag;_r&&(Blob.prototype[_r]||(Blob.prototype[_r]="Blob"),"File"in Ne&&!File.prototype[_r]&&(File.prototype[_r]="File"));try{new File([],"")}catch{Ne.File=function(at,Pt,Ye){return at=new Blob(at,Ye||{}),Object.defineProperties(at,{name:{value:Pt},lastModified:{value:+(Ye&&Ye.lastModified!==void 0?new Date(Ye.lastModified):new Date)},toString:{value:function(){return"[object File]"}}}),_r&&Object.defineProperty(at,_r,{value:"File"}),at}}var pi=function(ze){return ze.replace(/\n/g,"%0A").replace(/\r/g,"%0D").replace(/"/g,"%22")},Zr=function(ze){this.i=[];var at=this;ze&&fe(ze.elements,function(Pt){if(Pt.name&&!Pt.disabled&&Pt.type!=="submit"&&Pt.type!=="button"&&!Pt.matches("form fieldset[disabled] *"))if(Pt.type==="file"){var Ye=Pt.files&&Pt.files.length?Pt.files:[new File([],"",{type:"application/octet-stream"})];fe(Ye,function(U){at.append(Pt.name,U)})}else Pt.type==="select-multiple"||Pt.type==="select-one"?fe(Pt.options,function(U){!U.disabled&&U.selected&&at.append(Pt.name,U.value)}):Pt.type==="checkbox"||Pt.type==="radio"?Pt.checked&&at.append(Pt.name,Pt.value):(Ye=Pt.type==="textarea"?ye(Pt.value):Pt.value,at.append(Pt.name,Ye))})};if((t=Zr.prototype).append=function(ze,at,Pt){_e(arguments,2),this.i.push(Ee(ze,at,Pt))},t.delete=function(ze){_e(arguments,1);var at=[];ze=String(ze),fe(this.i,function(Pt){Pt[0]!==ze&&at.push(Pt)}),this.i=at},t.entries=function ze(){var at,Pt=this;return ee(ze,function(Ye){if(Ye.h==1&&(at=0),Ye.h!=3)return at<Pt.i.length?Ye=D(Ye,Pt.i[at]):(Ye.h=0,Ye=void 0),Ye;at++,Ye.h=2})},t.forEach=function(ze,at){_e(arguments,1);for(var Pt=m(this),Ye=Pt.next();!Ye.done;Ye=Pt.next()){var U=m(Ye.value);Ye=U.next().value,U=U.next().value,ze.call(at,U,Ye,this)}},t.get=function(ze){_e(arguments,1);var at=this.i;ze=String(ze);for(var Pt=0;Pt<at.length;Pt++)if(at[Pt][0]===ze)return at[Pt][1];return null},t.getAll=function(ze){_e(arguments,1);var at=[];return ze=String(ze),fe(this.i,function(Pt){Pt[0]===ze&&at.push(Pt[1])}),at},t.has=function(ze){_e(arguments,1),ze=String(ze);for(var at=0;at<this.i.length;at++)if(this.i[at][0]===ze)return!0;return!1},t.keys=function ze(){var at,Pt,Ye,U,ce=this;return ee(ze,function(me){if(me.h==1&&(at=m(ce),Pt=at.next()),me.h!=3)return Pt.done?void(me.h=0):(Ye=Pt.value,U=m(Ye),D(me,U.next().value));Pt=at.next(),me.h=2})},t.set=function(ze,at,Pt){_e(arguments,2),ze=String(ze);var Ye=[],U=Ee(ze,at,Pt),ce=!0;fe(this.i,function(me){me[0]===ze?ce&&(ce=!Ye.push(U)):Ye.push(me)}),ce&&Ye.push(U),this.i=Ye},t.values=function ze(){var at,Pt,Ye,U,ce=this;return ee(ze,function(me){if(me.h==1&&(at=m(ce),Pt=at.next()),me.h!=3)return Pt.done?void(me.h=0):(Ye=Pt.value,(U=m(Ye)).next(),D(me,U.next().value));Pt=at.next(),me.h=2})},Zr.prototype._asNative=function(){for(var ze=new Ze,at=m(this),Pt=at.next();!Pt.done;Pt=at.next()){var Ye=m(Pt.value);Pt=Ye.next().value,Ye=Ye.next().value,ze.append(Pt,Ye)}return ze},Zr.prototype._blob=function(){var ze="----formdata-polyfill-"+Math.random(),at=[],Pt="--"+ze+`\r
Content-Disposition: form-data; name="`;return this.forEach(function(Ye,U){return typeof Ye=="string"?at.push(Pt+pi(ye(U))+`"\r
\r
`+ye(Ye)+`\r
`):at.push(Pt+pi(ye(U))+'"; filename="'+pi(Ye.name)+`"\r
Content-Type: `+(Ye.type||"application/octet-stream")+`\r
\r
`,Ye,`\r
`)}),at.push("--"+ze+"--"),new Blob(at,{type:"multipart/form-data; boundary="+ze})},Zr.prototype[Symbol.iterator]=function(){return this.entries()},Zr.prototype.toString=function(){return"[object FormData]"},Pn&&!Pn.matches&&(Pn.matches=Pn.matchesSelector||Pn.mozMatchesSelector||Pn.msMatchesSelector||Pn.oMatchesSelector||Pn.webkitMatchesSelector||function(ze){for(var at=(ze=(this.document||this.ownerDocument).querySelectorAll(ze)).length;0<=--at&&ze.item(at)!==this;);return-1<at}),_r&&(Zr.prototype[_r]="FormData"),ft){var Ra=Ne.XMLHttpRequest.prototype.setRequestHeader;Ne.XMLHttpRequest.prototype.setRequestHeader=function(ze,at){Ra.call(this,ze,at),ze.toLowerCase()==="content-type"&&(this.B=!0)},Ne.XMLHttpRequest.prototype.send=function(ze){ze instanceof Zr?(ze=ze._blob(),this.B||this.setRequestHeader("Content-Type",ze.type),ft.call(this,ze)):ft.call(this,ze)}}yt&&(Ne.fetch=function(ze,at){return at&&at.body&&at.body instanceof Zr&&(at.body=at.body._blob()),yt.call(this,ze,at)}),An&&(Ne.navigator.sendBeacon=function(ze,at){return at instanceof Zr&&(at=at._asNative()),An.call(this,ze,at)}),Ne.FormData=Zr}})();const Jw=()=>{const t=oe("AREAS");return t.length===0&&t.push(Kn.GLOBAL),Ec(t).call(t,(r,s,a)=>{const c=u9(s);return c?a===0?c:"".concat(r,",").concat(c):r},"")},u9=t=>t===Kn.OVERSEA?"".concat(Js.ASIA,",").concat(Js.EUROPE,",").concat(Js.AFRICA,",").concat(Js.NORTH_AMERICA,",").concat(Js.SOUTH_AMERICA,",").concat(Js.OCEANIA):Js[t],Vge=t=>{const r={CODE:"",WEBCS_DOMAIN:[],WEBCS_DOMAIN_BACKUP_LIST:[],PROXY_CS:[],CDS_AP:[],ACCOUNT_REGISTER:[],UAP_AP:[],EVENT_REPORT_DOMAIN:[],EVENT_REPORT_BACKUP_DOMAIN:[],LOG_UPLOAD_SERVER:[],PROXY_SERVER_TYPE3:[]};return t.map(s=>{const a=NP[s],c=Object.keys(a);c&&c.map(d=>{d!=="CODE"&&(r[d]=r[d].concat(a[d]))})}),r},BP={GLOBAL:{ASIA:[Kn.CHINA,Kn.JAPAN,Kn.INDIA,Kn.KOREA,Kn.HKMC],EUROPE:[],NORTH_AMERICA:[Kn.US],SOUTH_AMERICA:[],OCEANIA:[],AFRICA:[]}},WP=Object.keys(BP[Kn.GLOBAL]),C2=[Kn.CHINA,Kn.NORTH_AMERICA,Kn.EUROPE,Kn.ASIA,Kn.JAPAN,Kn.INDIA,Kn.OCEANIA,Kn.SOUTH_AMERICA,Kn.AFRICA,Kn.KOREA,Kn.HKMC,Kn.US],jge=function(t,r){let s=[];if(lt(t).call(t,Kn.GLOBAL)){const d=[Kn.GLOBAL,Kn.OVERSEA],h=Object.keys(NP);if(r===Kn.GLOBAL)throw new Ae(te.INVALID_PARAMS,"GLOBAL is an invalid excludedArea value");if(r===Kn.CHINA)s=[Kn.OVERSEA];else if(c=r,lt(WP).call(WP,c)){const m=(a=r,BP[Kn.GLOBAL][a]||[]),y=[...d,r,...m];s=h.filter(v=>!lt(y).call(y,v))}else if(function(m){let y=!1;return WP.forEach(v=>{var w;lt(w=BP[Kn.GLOBAL][v]).call(w,m)&&(y=!0)}),y}(r)){const m=function(v){let w;return WP.forEach(R=>{var O;lt(O=BP[Kn.GLOBAL][R]).call(O,v)&&(w=R)}),w}(r),y=[...d,m,r];s=h.filter(v=>!lt(y).call(y,v))}else s=t;s=function(m){const y=[];return C2.forEach(v=>{lt(m).call(m,v)&&y.push(v)}),y.concat(m.filter(v=>!lt(C2).call(C2,v)))}(s)}else s=t;var a,c;return s};function d9(t){var r,s;if(!t&&lt(r=oe("AREAS")).call(r,Kn.EXTENSIONS))return x.debug("update area from ap : reset"),void R2(qme,!0);if(!lt(s=oe("AREAS")).call(s,Kn.GLOBAL)||!t)return;let a=NP.EXTENSIONS;a&&(a={CODE:u9(Kn.EXTENSIONS),WEBCS_DOMAIN:["ap-web-1-".concat(t,".agora.io")],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-".concat(t,".ap.sd-rtn.com")],PROXY_CS:["proxy-ap-web-".concat(t,".agora.io")],CDS_AP:["cds-ap-web-1-".concat(t,".agora.io"),"cds-ap-web-2-".concat(t,".ap.sd-rtn.com")],ACCOUNT_REGISTER:["sua-ap-web-1-".concat(t,".agora.io"),"sua-ap-web-2-".concat(t,".ap.sd-rtn.com")],UAP_AP:["uap-ap-web-1-".concat(t,".agora.io"),"uap-ap-web-2-".concat(t,".ap.sd-rtn.com")],EVENT_REPORT_DOMAIN:["statscollector-1-".concat(t,".agora.io")],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-".concat(t,".agora.io")],LOG_UPLOAD_SERVER:["logservice-".concat(t,".agora.io")],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy-".concat(t,".agora.io")]},x.debug("update area from ap success: ".concat(t,",config is "),a),sr("AREAS",[Kn.EXTENSIONS],!0),Object.keys(a).map(c=>{c==="LOG_UPLOAD_SERVER"||c==="EVENT_REPORT_DOMAIN"||c==="EVENT_REPORT_BACKUP_DOMAIN"||c==="PROXY_SERVER_TYPE3"?sr(c,a[c][0]):sr(c,a[c])}))}function R2(t){let r=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const s=Nt.reportApiInvoke(null,{name:Ni.SET_AREA,options:t,tag:Kr.TRACER});try{let a=[];if(typeof t=="string"&&(a=[t]),Array.isArray(t)&&(t.forEach(d=>{if(!lt(kH).call(kH,d))throw new Ae(te.INVALID_PARAMS,"invalid area code")}),a=t),Object.prototype.toString.call(t)==="[object Object]"){const{areaCode:d,excludedArea:h}=t;if(!d)throw new Ae(te.INVALID_PARAMS,"area code is needed");let m=d;typeof d=="string"&&(m=[d]),a=h?jge(m,h):m}if(!r){if(Nd.AREAS){const d=new Ae(te.PROHIBITED_OPERATION,"setArea is prohibited because of config-distribute");return s.onError(d),void x.warning("setArea is prohibited because of config-distribute")}if(lt(a).call(a,Kn.GLOBAL)&&oe("AREAS")===Kn.EXTENSIONS){const d=new Ae(te.PROHIBITED_OPERATION,"setArea is prohibited because of ap extensions");return s.onError(d),void x.warning("setArea is prohibited because of ap extensions")}}sr("AREAS",a,r);const c=Vge(a);Object.keys(c).map(d=>{d==="LOG_UPLOAD_SERVER"||d==="EVENT_REPORT_DOMAIN"||d==="EVENT_REPORT_BACKUP_DOMAIN"||d==="PROXY_SERVER_TYPE3"?sr(d,c[d][0]):sr(d,c[d])}),x.debug("set area success:",a.join(","))}catch(a){throw s.onError(a),a}s.onSuccess()}function h9(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}function Uh(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?h9(Object(s),!0).forEach(function(a){q(t,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):h9(Object(s)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))})}return t}let I2=1;function Fge(t,r,s,a,c){I2+=1;const d={sid:s.sid,command:"convergeAllocateEdge",uid:"666",appId:s.appId,ts:Math.floor(Date.now()/1e3),seq:I2,requestId:I2,version:Ml,cname:s.cname},h={service_name:r,json_body:JSON.stringify(d)};let m,y,v=t[0];return kd(async()=>{m=Date.now();const w=await Md(v,{data:h,cancelToken:a,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"}});if(y=Date.now()-m,w.code!==0){const D=new Ae(te.UNEXPECTED_RESPONSE,"live streaming ap error, code"+w.code,{retry:!0,responseTime:y});throw x.error(D.toString()),D}const R=JSON.parse(w.json_body);if(R.code!==200){const D=new Ae(te.UNEXPECTED_RESPONSE,"live streaming app center error, code: ".concat(R.code,", reason: ").concat(R.reason),{code:R.code,responseTime:y});throw x.error(D.toString()),D}if(!R.servers||R.servers.length===0){const D=new Ae(te.UNEXPECTED_RESPONSE,"live streaming app center empty server",{code:R.code,responseTime:y});throw x.error(D.toString()),D}const O=function(D,G){return{addressList:D.servers.map(j=>"wss://".concat(j.address.replace(/\./g,"-"),".").concat(oe("WORKER_DOMAIN"),":").concat(j.wss,"?serviceName=").concat(encodeURIComponent(G))),workerToken:D.workerToken,vid:D.vid}}(R,r);return oe("LIVE_STREAMING_ADDRESS")&&(O.addressList=oe("LIVE_STREAMING_ADDRESS")instanceof Array?oe("LIVE_STREAMING_ADDRESS"):[oe("LIVE_STREAMING_ADDRESS")]),Uh(Uh({},O),{},{responseTime:y})},(w,R)=>(Nt.apworkerEvent(s.sid,{success:!0,sc:200,serviceName:r,responseDetail:JSON.stringify(w.addressList),firstSuccess:R===0,responseTime:y,serverIp:t[R%t.length]}),!1),(w,R)=>(Nt.apworkerEvent(s.sid,{success:!1,sc:w.data&&w.data.code||200,serviceName:r,responseTime:y,serverIp:t[R%t.length]}),!!(w.code!==te.OPERATION_ABORTED&&w.code!==te.UNEXPECTED_RESPONSE||w.data&&w.data.retry)&&(v=t[(R+1)%t.length],!0)),c)}let A2=1;function p9(t,r,s,a){let{url:c,areaCode:d}=t;const{clientId:h,sid:m}=r,y=Date.now();let v;const w=r.role,[R,O]=O2(r,d,[bi.CHOOSE_SERVER]);let D=Si.networkState;return kd(async()=>{D&&Si.networkState===Rc.OFFLINE&&Si.onlineWaiter&&await pt.race([Si.onlineWaiter,ys(a&&a.maxRetryTimeout||Di.maxRetryTimeout)]),D=Si.networkState;const{data:G,headers:j}=await Md(c,{data:R,cancelToken:s,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);v=j.http3==="1"?1:-1,Nt.reportResourceTiming(c,m),m9(G,c,r,y,[bi.CHOOSE_SERVER],v);const W=Kw(G,bi.CHOOSE_SERVER);return P2(W),y2(W,c)},G=>(G&&Nt.joinChooseServer(m,{role:w,lts:y,succ:!0,csAddr:c,opid:O,serverList:G.gatewayAddrs.map(j=>j.address),ec:null,cid:G.cid.toString(),uid:G.uid.toString(),csIp:G.csIp,unilbsServerIds:[bi.CHOOSE_SERVER].toString(),isHttp3:v,corssRegionTagReq:r.apRequestDetail,corssRegionTagRes:G.res.detail&&G.res.detail[38]}),!1),G=>G.code!==te.OPERATION_ABORTED&&(G.code===te.CAN_NOT_GET_GATEWAY_SERVER?G.data.retry:(Nt.joinChooseServer(m,{role:w,lts:y,succ:!1,csAddr:c,serverList:null,opid:O,ec:G.code,csIp:G.data&&G.data.csIp,unilbsServerIds:[bi.CHOOSE_SERVER].toString(),extend:JSON.stringify({networkState:D}),isHttp3:v,corssRegionTagReq:r.apRequestDetail}),x.warning("[".concat(h||"sid-".concat(m.slice(0,6)),"] Choose server network error, retry"),G),!0)),a)}function f9(t,r,s,a){let c,{url:d,areaCode:h,serviceIds:m}=t;const y=Date.now(),v=r.role,[w,R]=O2(r,h,m);let O;return kd(async()=>{O&&Si.networkState===Rc.OFFLINE&&Si.onlineWaiter&&await pt.race([Si.onlineWaiter,ys(a&&a.maxRetryTimeout||Di.maxRetryTimeout)]),O=Si.networkState;const{data:D,headers:G}=await Md(d,{data:w,cancelToken:s,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);c=G.http3==="1"?1:-1,Nt.reportResourceTiming(d,r.sid),m9(D,d,r,y,m,c);const j=Kw(D,bi.CHOOSE_SERVER),W=Kw(D,r.cloudProxyServer==="proxy5"?bi.CLOUD_PROXY_5:r.cloudProxyServer==="proxy3"||r.cloudProxyServer==="proxy4"?bi.CLOUD_PROXY:bi.CLOUD_PROXY_FALLBACK);return P2(j),{gatewayInfo:y2(j,d),proxyInfo:W,url:d}},D=>(D.gatewayInfo&&Nt.joinChooseServer(r.sid,{role:v,lts:y,succ:!0,csAddr:d,serverList:D.gatewayInfo.gatewayAddrs.map(G=>G.address),ec:null,opid:R,cid:D.gatewayInfo.cid.toString(),uid:D.gatewayInfo.uid.toString(),csIp:D.gatewayInfo.csIp,unilbsServerIds:m.toString(),isHttp3:c,corssRegionTagReq:r.apRequestDetail,corssRegionTagRes:D.gatewayInfo.res.detail&&D.gatewayInfo.res.detail[38]}),D.proxyInfo&&Nt.joinWebProxyAP(r.sid,{lts:y,sucess:1,apServerAddr:d,turnServerAddrList:D.proxyInfo.addresses.map(G=>G.ip).join(","),errorCode:null,eventType:r.cloudProxyServer,unilbsServerIds:m.toString()}),!1),D=>D.code!==te.OPERATION_ABORTED&&(D.code===te.CAN_NOT_GET_GATEWAY_SERVER?D.data.retry:(Nt.joinWebProxyAP(r.sid,{lts:y,sucess:0,apServerAddr:d,turnServerAddrList:null,errorCode:D.code,eventType:r.cloudProxyServer,unilbsServerIds:m.toString(),extend:JSON.stringify({networkState:O})}),x.warning("[".concat(r.clientId,"] multi unilbs network error, retry"),D),!0)),a)}const m9=(t,r,s,a,c,d)=>{const{sid:h,clientId:m,cloudProxyServer:y}=s,v=[],w=R=>{R.flag===4096?Nt.joinChooseServer(h,{role:s.role,lts:a,succ:!1,csAddr:r,opid:t.opid,serverList:null,ec:R.error.message,csIp:R.error.data&&R.error.data.csIp,unilbsServerIds:c.toString(),isHttp3:d,corssRegionTagReq:s.apRequestDetail}):R.flag!==1048576&&R.flag!==4194304&&R.flag!==4194310||Nt.joinWebProxyAP(h,{lts:a,sucess:0,apServerAddr:r,turnServerAddrList:null,errorCode:R.error.code,eventType:y,unilbsServerIds:c.toString()})};if(t.response_body.forEach(R=>{const O=R.buffer.code;if(R.uri===23&&O===0&&!R.buffer.edges_services)if(R.buffer.flag===4194310)x.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers"),R.buffer.edges_services=[];else{const D={error:new Ae(te.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:t.detail[502]}),flag:R.buffer.flag};v.push(D),w(D)}if(O!==0){const D=mS(O),G={error:new Ae(te.CAN_NOT_GET_GATEWAY_SERVER,D.desc,{desc:D.desc,retry:D.retry,csIp:t.detail[502]}),flag:R.buffer.flag};R.buffer.flag===4194310?x.warning(G.error.toString()):v.push(G),w(G)}}),v.length)throw x.warning("[".concat(m||"sid-".concat(h.slice(0,6)),"] multi unilbs ").concat(r," failed, ").concat(v.map(R=>"flag: ".concat(R.flag,", message: ").concat(R.error.message,", retry: ").concat(R.error.data.retry)).join(" | "))),new Ae(te.CAN_NOT_GET_GATEWAY_SERVER,v.map(R=>"flag: ".concat(R.flag,", message: ").concat(R.error.message)).join(" | "),{retry:!!v.find(R=>R.error.data.retry),csIp:t.detail[502],desc:[...new Set(v.map(R=>{var O;return R==null||(O=R.error)===null||O===void 0||(O=O.data)===null||O===void 0?void 0:O.desc}).filter(R=>!!R))]})},P2=t=>{var r,s,a,c;if(t.addresses&&t.addresses.length===0&&t.code===0)throw new Ae(te.CAN_NOT_GET_GATEWAY_SERVER,"void gateway address",{retry:!0,csIp:t.detail&&t.detail[502]});if(oe("AP_AREA")&&((a=t.detail)!==null&&a!==void 0&&a[23]&&typeof((c=t.detail)===null||c===void 0?void 0:c[23])=="string"?d9(t.detail[23].toLowerCase()):d9()),(r=t.detail)!==null&&r!==void 0&&r[19]&&typeof((s=t.detail)===null||s===void 0?void 0:s[19])=="string"){const h=t.detail[19],m=h==null?void 0:h.split(";");for(let y=0;y<m.length;y++){var d;const v=Ro(d=m[y]).call(d);t.addresses[y]&&m&&(t.addresses[y].fingerprint=v)}}if(oe("GATEWAY_ADDRESS")&&oe("GATEWAY_ADDRESS").length>0){x.debug("assign gateway address to",oe("GATEWAY_ADDRESS"));const h=oe("GATEWAY_ADDRESS").map(m=>{var y,v;const w=(y=(v=t.addresses.find(R=>R.ip===m.ip&&R.port===m.port))===null||v===void 0?void 0:v.fingerprint)!==null&&y!==void 0?y:"";return{ip:m.ip,port:m.port,ticket:t.addresses[0]&&t.addresses[0].ticket,fingerprint:w}});t.addresses=h}},Bge=(t,r)=>{if(t.response_body&&t.response_body.length){const s=t.response_body[0];if(s.buffer.code!==0){const a=mS(s.buffer.code);throw new Ae(te.UPDATE_TICKET_FAILED,"[".concat(s.buffer.code,"]: ").concat(a.desc),{retry:a.retry})}return s.buffer.ticket}throw x.debug("update ticket request received ap response without response body:",r),new Ae(te.UPDATE_TICKET_FAILED,"cannot find response body from ap response",{retry:!1})},O2=(t,r,s)=>{const a=Math.floor(Math.random()*1e12),c=t.role==="host"?"1":t.role==="audience"?"2":void 0,d={appid:t.appId,client_ts:Date.now(),opid:a,sid:t.sid,request_bodies:[{uri:22,buffer:{cname:t.cname,detail:Uh(Uh(Uh({6:t.stringUid,11:r,12:oe("USE_NEW_TOKEN")?"1":void 0},c?{17:c}:{}),{},{22:r},t.apRequestDetail?{33:t.apRequestDetail}:{}),t.apRTM?{26:"RTM2"}:{}),key:t.token,service_ids:s,uid:t.uid||0}}]};d.request_bodies.forEach(m=>{t.multiIP&&t.multiIP.gateway_ip&&(m.buffer.detail[5]=JSON.stringify({vocs_ip:[t.multiIP.uni_lbs_ip],vos_ip:[t.multiIP.gateway_ip]}))});const h=new FormData;return h.append("request",JSON.stringify(d)),[h,a]},Wge=(t,r)=>{const s=Math.floor(Math.random()*1e12),a={appid:t.appId,client_ts:Date.now(),opid:s,sid:t.sid,request_bodies:[{uri:28,buffer:{cname:t.cname,detail:{1:"",6:t.stringUid,12:"1"},token:t.token,service_ids:r,uid:t.uid||0,edges_services:t.apResponse.addresses.map(d=>({ip:d.ip,port:d.port}))}}]},c=new FormData;return c.append("request",JSON.stringify(a)),[c,s]};let ES=0;function vS(t){return pt.all(t.map(r=>r.then(s=>{throw s},s=>s))).then(r=>{throw r},r=>r)}const Qw=async t=>{let{fragementLength:r,referenceList:s,asyncMapHandler:a,allFailedhandler:c,promisesCollector:d}=t,h=0;const m=r;let y,v=0;const w=async()=>{const R=(()=>{const O=h*m,D=O+m;return s.slice(O,D).map(a)})();d&&d.push(...R);try{y=await vS(R)}catch(O){if(v+=m,h++,!(v>=s.length))return void await w();c(O)}R.forEach(O=>O.cancel())};return await w(),y},g9=async t=>{let{referenceList:r,asyncMapHandler:s,closeFn:a}=t;const c=r.length;let d=0;const h=async()=>{const m=s(r.shift());try{return await m}catch(y){if(d++,d>=c||a!=null&&a(y))throw y;return h()}};return h()};async function k2(t,r,s,a){return{gatewayInfo:await async function(d,h,m,y){let v=null;const w=[],R=async()=>{const D=oe("WEBCS_DOMAIN").slice(0,oe("AJAX_REQUEST_CONCURRENT")).map(W=>({url:d.proxyServer?"https://".concat(d.proxyServer,"/ap/?url=").concat(W+"/api/v2/transpond/webrtc?v=2"):"https://".concat(W,"/api/v2/transpond/webrtc?v=2"),areaCode:Jw()})),G=y.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:D.map(W=>W.url)}),j=await Qw({fragementLength:oe("FRAGEMENT_LENGTH"),referenceList:D,asyncMapHandler:W=>(x.debug("[".concat(d.clientId,"] Connect to choose_server:"),W.url),p9(W,d,h,m)),allFailedhandler:W=>{throw y.recordJoinChannelService({endTs:Date.now(),status:"error",errors:W},G),W[0]},promisesCollector:w});return y.recordJoinChannelService({endTs:Date.now(),status:"success"},G),j},O=async()=>{if(await ys(1e3),v!==null)return v;const D=oe("WEBCS_DOMAIN_BACKUP_LIST").map(W=>({url:d.proxyServer?"https://".concat(d.proxyServer,"/ap/?url=").concat(W+"/api/v2/transpond/webrtc?v=2"):"https://".concat(W,"/api/v2/transpond/webrtc?v=2"),areaCode:Jw()})),G=y.recordJoinChannelService({endTs:void 0,startTs:Date.now(),status:"pending",service:"chooseServer",urls:D.map(W=>W.url)}),j=await Qw({fragementLength:oe("FRAGEMENT_LENGTH"),referenceList:D,asyncMapHandler:W=>(x.debug("[".concat(d.clientId,"] Connect to backup choose_server:"),W.url),p9(W,d,h,m)),allFailedhandler:W=>{throw y.recordJoinChannelService({endTs:Date.now(),status:"error",errors:W},G),W[0]},promisesCollector:w});return y.recordJoinChannelService({endTs:Date.now(),status:"success"},G),j};try{return v=await vS([R(),O()]),w.length&&w.forEach(D=>D.cancel&&typeof D.cancel=="function"&&D.cancel()),v}catch(D){throw D[0]}}(t,r,s,a)}}async function _9(t,r,s,a,c){const d=t.cloudProxyServer;if(d==="disabled"){if(t.useLocalAccessPoint)return await k2(t,r,s,c);if(oe("JOIN_WITH_FALLBACK_MEDIA_PROXY")){const{gatewayInfo:O,proxyInfo:D}=await v9(t,r,s,c);if(t.turnServer&&t.turnServer.mode!=="auto")return{gatewayInfo:O};const G=D.map(j=>({turnServerURL:j.address,tcpport:j.tcpport||Us.tcpport,udpport:j.udpport||Us.udpport,username:j.username||Us.username,password:j.password||Us.password,forceturn:!1,security:!0}));if(c.useP2P){var h;const j=(h=t.uid)!==null&&h!==void 0?h:O.uid,W="glb:".concat(j.toString()),Q=await TL(W),ee=D.map(fe=>({turnServerURL:fe.address,tcpport:fe.tcpport||Us.tcpport,udpport:fe.udpport||Us.udpport,username:W,password:Q,forceturn:!1,security:!0}));G.push(...ee)}return t.turnServer={mode:"manual",servers:G},{gatewayInfo:O}}return await k2(t,r,s,c)}const{proxyInfo:m,gatewayInfo:y}=await v9(t,r,s,c),v={gatewayInfo:y},w=m.map(O=>({turnServerURL:O.address,tcpport:d==="proxy3"?void 0:O.tcpport?O.tcpport:Us.tcpport,udpport:d==="proxy4"?void 0:O.udpport?O.udpport:Us.udpport,username:O.username||Us.username,password:O.password||Us.password,forceturn:d!=="proxy4",security:d==="proxy5"}));if(c.useP2P){var R;const O=(R=t.uid)!==null&&R!==void 0?R:y.uid,D="glb:".concat(O.toString()),G=await TL(D),j=m.map(W=>({turnServerURL:W.address,tcpport:d==="proxy3"?void 0:W.tcpport||Us.tcpport,udpport:d==="proxy4"?void 0:W.udpport||Us.udpport,username:D,password:G,forceturn:d!=="proxy4",security:d==="proxy5"}));w.push(...j)}return t.turnServer={mode:"manual",servers:w},x.debug("[".concat(t.clientId,"] set proxy server: ").concat(t.proxyServer,", mode: ").concat(d)),v}async function y9(t,r,s,a,c){const d=oe("ACCOUNT_REGISTER").slice(0,oe("AJAX_REQUEST_CONCURRENT"));let h=[];h=r.proxyServer?d.map(y=>"https://".concat(r.proxyServer,"/ap/?url=").concat(y+"/api/v1")):d.map(y=>"https://".concat(y,"/api/v1"));const m=c==null?void 0:c.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"stringUID",urls:h});try{const y=await async function(v,w,R,O,D){const G=Date.now(),j={sid:R.sid,opid:10,appid:R.appId,string_uid:w};let W=v[0];const Q=await kd(()=>Md(W+"".concat(W.indexOf("?")===-1?"?":"&","action=stringuid"),{data:j,cancelToken:O,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}}),(ee,fe)=>{if(ee.code===0){if(ee.uid<=0||ee.uid>=Math.pow(2,32))throw x.error("Invalid Uint Uid ".concat(w," => ").concat(ee.uid),ee),Nt.reqUserAccount(j.sid,{lts:G,success:!1,serverAddr:W,stringUid:j.string_uid,uid:ee.uid,errorCode:te.INVALID_UINT_UID_FROM_STRING_UID,extend:j}),new Ae(te.INVALID_UINT_UID_FROM_STRING_UID);return Nt.reqUserAccount(j.sid,{lts:G,success:!0,serverAddr:W,stringUid:j.string_uid,uid:ee.uid,errorCode:null,extend:j}),!1}const ye=mS(ee.code);return ye.retry&&(W=v[(fe+1)%v.length]),Nt.reqUserAccount(j.sid,{lts:G,success:!1,serverAddr:W,stringUid:j.string_uid,uid:ee.uid,errorCode:ye.desc,extend:j}),ye.retry},(ee,fe)=>ee.code!==te.OPERATION_ABORTED&&(Nt.reqUserAccount(j.sid,{lts:G,success:!1,serverAddr:W,stringUid:j.string_uid,uid:null,errorCode:ee.code,extend:j}),W=v[(fe+1)%v.length],!0),D);if(Q.code!==0){const ee=mS(Q.code);throw new Ae(te.UNEXPECTED_RESPONSE,ee.desc)}return Q}(h,t,r,s,a);return c==null||c.recordJoinChannelService({status:"success",endTs:Date.now()},m),y.uid}catch(y){throw c==null||c.recordJoinChannelService({status:"error",endTs:Date.now(),errors:[y]},m),y}}async function zge(t,r,s){const a=oe("ACCOUNT_REGISTER");let c=[];c=r.proxyServer?a.map(d=>"https://".concat(r.proxyServer,"/ap/?url=").concat(d+"/api/v1")):a.map(d=>"https://".concat(d,"/api/v1"));try{return await g9({referenceList:c,asyncMapHandler:h=>async function(m,y,v,w){const R=Date.now(),O={sid:v.sid,opid:10,appid:v.appId,string_uid:y};try{const D=await Md(m+"".concat(m.indexOf("?")===-1?"?":"&","action=stringuid"),{data:O,cancelToken:w,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}});if(D.code!==0){const G=mS(D.code);throw new Ae(te.UNEXPECTED_RESPONSE,"preload sua error:".concat(G.desc),G)}if(D.uid<=0||D.uid>=Math.pow(2,32))throw new Ae(te.INVALID_UINT_UID_FROM_STRING_UID);return{requestTime:R,url:m,req:O,uid:D.uid,elapse:Date.now()-R}}catch(D){throw D}}(h,t,r,s),closeFn:h=>h.code===te.OPERATION_ABORTED||h.code===te.UNEXPECTED_RESPONSE&&!h.data.retry})}catch(d){throw d}}async function Gge(t,r,s){const a=oe("CDS_AP").slice(0,oe("AJAX_REQUEST_CONCURRENT")).map(y=>t.proxyServer?"https://".concat(t.proxyServer,"/ap/?url=").concat(y+"/api/v1"):"https://".concat(y,"/api/v1?action=config")),c=a.map(y=>function(v,w,R,O){const D=Ln(),G={flag:64,cipher_method:0,features:Uh(Uh(Uh(Uh(Uh({install_id:LL(),device:D.name,system:D.os,system_general:navigator.userAgent,vendor:w.appId,version:Ml,cname:w.cname,session_id:w.sid,proxyServer:w.proxyServer,sdk_type:Lge.WEB_RTC,browser_name:D.name,browser_version:D.version,user_agent:navigator.userAgent,channel_name:w.cname},w.stringUid&&{string_uid:w.stringUid}),w.uid&&{uid:w.uid+""}),D.os&&{os_name:D.os}),D.osVersion&&{os_version:D.osVersion}),{},{detail:""})};return kd(()=>Md(v,{data:G,timeout:1e3,cancelToken:R,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":54}}),void 0,j=>j.code!==te.OPERATION_ABORTED,O)}(y,t,r,s));let d=null,h=null,m={};try{d=await vS(c)}catch(y){if(y.code===te.OPERATION_ABORTED)throw y;h=y}if(c.forEach(y=>y.cancel()),Nt.reportApiInvoke(t.sid,{name:Ni.REQUEST_CONFIG_DISTRIBUTE,options:{error:h,res:d}}).onSuccess(),d&&d.test_tags)try{m=function(y){if(!y.test_tags)return{};const v=y.test_tags,w=Object.keys(v),R={};return w.forEach(O=>{var D;const G=Ro(D=O.slice(4)).call(D),j=JSON.parse(v[O]),W=j[1];R[G]={tag:j[0]||"",value:W}}),R}(d)}catch{}return m}async function E9(t,r){const s=oe("WEBCS_DOMAIN").concat(oe("WEBCS_DOMAIN_BACKUP_LIST")).map(a=>({url:"https://".concat(a,"/api/v2/transpond/webrtc?v=2"),areaCode:Jw(),serviceIds:[bi.CHOOSE_SERVER,bi.CLOUD_PROXY_FALLBACK]}));try{return await g9({referenceList:s,asyncMapHandler:c=>async function(d,h,m){let y,{url:v,areaCode:w,serviceIds:R}=d;const O=Date.now(),[D,G]=O2(h,w,R);let j=Si.networkState;try{j&&Si.networkState===Rc.OFFLINE&&Si.onlineWaiter&&await pt.race([Si.onlineWaiter,ys(Di.maxRetryTimeout)]),j=Si.networkState;const{data:W,headers:Q}=await Md(v,{data:D,cancelToken:m,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);y=Q.http3==="1"?1:-1,(Ee=>{const _e=[];if(Ee.response_body.forEach(Ne=>{const Ze=Ne.buffer.code;if(Ne.uri===23&&Ze===0&&!Ne.buffer.edges_services)if(Ne.buffer.flag===4194310)Ne.buffer.edges_services=[];else{const ft={error:new Ae(te.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:Ee.detail[502]}),flag:Ne.buffer.flag};_e.push(ft)}if(Ze!==0){const ft=mS(Ze),yt={error:new Ae(te.CAN_NOT_GET_GATEWAY_SERVER,ft.desc,{desc:ft.desc,retry:ft.retry,csIp:Ee.detail[502]}),flag:Ne.buffer.flag};Ne.buffer.flag===4194310?x.warning(yt.error.toString()):_e.push(yt)}}),_e.length)throw new Ae(te.CAN_NOT_GET_GATEWAY_SERVER,_e.map(Ne=>"flag: ".concat(Ne.flag,", message: ").concat(Ne.error.message)).join(" | "),{retry:!!_e.find(Ne=>Ne.error.data.retry),csIp:Ee.detail[502],desc:[...new Set(_e.map(Ne=>{var Ze;return Ne==null||(Ze=Ne.error)===null||Ze===void 0||(Ze=Ze.data)===null||Ze===void 0?void 0:Ze.desc}).filter(Ne=>!!Ne))]})})(W);const fe=Kw(W,bi.CHOOSE_SERVER),ye=Kw(W,bi.CLOUD_PROXY_FALLBACK);return P2(fe),{gatewayInfo:y2(fe,v),proxyInfo:ye,opid:G,requestTime:O,url:v,isHttp3:y,elapse:Date.now()-O}}catch(W){throw W}}(c,t,r),closeFn:c=>c.code===te.OPERATION_ABORTED||c.code===te.CAN_NOT_GET_GATEWAY_SERVER&&!c.data.retry})}catch(a){throw a}}async function v9(t,r,s,a){const c=oe("PROXY_SERVER_TYPE3"),d=(D,G,j)=>{let W=j||c;return Array.isArray(W)&&(W=G%2==0?c[1]:c[0]),"https://".concat(W,"/ap/?url=").concat(D)};let h=null;const m=[],y=async()=>{const D=oe("WEBCS_DOMAIN").slice(0,oe("AJAX_REQUEST_CONCURRENT")).map((W,Q)=>{let ee;return ee=t.cloudProxyServer==="disabled"&&t.proxyServer?d("".concat(W,"/api/v2/transpond/webrtc?v=2"),Q,t.proxyServer):t.cloudProxyServer==="disabled"||t.cloudProxyServer==="fallback"?"https://".concat(W,"/api/v2/transpond/webrtc?v=2"):d("".concat(W,"/api/v2/transpond/webrtc?v=2"),Q),{url:ee,areaCode:Jw(),serviceIds:[bi.CHOOSE_SERVER,t.cloudProxyServer==="proxy5"?bi.CLOUD_PROXY_5:t.cloudProxyServer==="proxy3"||t.cloudProxyServer==="proxy4"?bi.CLOUD_PROXY:bi.CLOUD_PROXY_FALLBACK]}}),G=a.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:D.map(W=>W.url)}),j=await Qw({fragementLength:oe("FRAGEMENT_LENGTH"),referenceList:D,asyncMapHandler:W=>(x.debug("[".concat(t.clientId,"] Connect to choose_server:"),W.url),f9(W,t,r,s)),allFailedhandler:W=>{throw a.recordJoinChannelService({endTs:Date.now(),status:"error",errors:W},G),W[0]},promisesCollector:m});return a.recordJoinChannelService({endTs:Date.now(),status:"success"},G),j},v=async()=>{if(await ys(1e3),h!==null)return h;const D=oe("WEBCS_DOMAIN_BACKUP_LIST").map((W,Q)=>{let ee;return ee=t.cloudProxyServer==="disabled"&&t.proxyServer?d("".concat(W,"/api/v2/transpond/webrtc?v=2"),Q,t.proxyServer):t.cloudProxyServer==="disabled"||t.cloudProxyServer==="fallback"?"https://".concat(W,"/api/v2/transpond/webrtc?v=2"):d("".concat(W,"/api/v2/transpond/webrtc?v=2"),Q),{url:ee,areaCode:Jw(),serviceIds:[bi.CHOOSE_SERVER,t.cloudProxyServer==="proxy5"?bi.CLOUD_PROXY_5:t.cloudProxyServer==="proxy3"||t.cloudProxyServer==="proxy4"?bi.CLOUD_PROXY:bi.CLOUD_PROXY_FALLBACK]}}),G=a.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:D.map(W=>W.url)}),j=await Qw({fragementLength:oe("FRAGEMENT_LENGTH"),referenceList:D,asyncMapHandler:W=>(x.debug("[".concat(t.clientId,"] Connect to backup choose_server:"),W.url),f9(W,t,r,s)),allFailedhandler:W=>{throw a.recordJoinChannelService({endTs:Date.now(),status:"error",errors:W},G),W[0]},promisesCollector:m});return a.recordJoinChannelService({endTs:Date.now(),status:"success"},G),j};let w,R,O;try{({gatewayInfo:w,proxyInfo:R,url:O}=await vS([y(),v()]))}catch(D){throw D[0]}if(m.length&&m.forEach(D=>D.cancel&&typeof D.cancel=="function"&&D.cancel()),!w||!R)throw new Ae(te.UNEXPECTED_ERROR,"missing gateway or proxy response").print();if(t.apUrl=O,t.cloudProxyServer!=="disabled"&&Array.isArray(c)&&O){const D=/^https?:\/\/(.+?)(\/.*)?$/.exec(O)[1];lt(c).call(c,D)&&(t.proxyServer=D,x.setProxyServer(D),Nt.setProxyServer(D))}return h={gatewayInfo:w,proxyInfo:await GH(R,w.uid)},h}async function Hge(t,r,s){const a=oe("UAP_AP").slice(0,oe("AJAX_REQUEST_CONCURRENT")).map(d=>t.proxyServer?"https://".concat(t.proxyServer,"/ap/?url=").concat(d+"/api/v1?action=uap"):"https://".concat(d,"/api/v1?action=uap")),c=a.map(d=>function(h,m,y,v){const w={command:"convergeAllocateEdge",sid:m.sid,appId:m.appId,token:m.token,ts:Date.now(),version:Ml,cname:m.cname,uid:m.uid.toString(),requestId:A2,seq:A2};A2+=1;const R={service_name:"tele_channel",json_body:JSON.stringify(w)};return kd(async()=>{const O=await Md(h,{data:R,cancelToken:y,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":61}});if(O.code!==0){const G=new Ae(te.UNEXPECTED_RESPONSE,"cross channel ap error, code"+O.code,{retry:!0});throw x.error(G.toString()),G}const D=JSON.parse(O.json_body);if(D.code!==200){const G=new Ae(te.UNEXPECTED_RESPONSE,"cross channel app center error, code: ".concat(D.code,", reason: ").concat(D.reason));throw x.error(G.toString()),G}if(!D.servers||D.servers.length===0){const G=new Ae(te.UNEXPECTED_RESPONSE,"cross channel app center empty server");throw x.error(G.toString()),G}return{vid:D.vid,workerToken:D.workerToken,addressList:(oe("CHANNEL_MEDIA_RELAY_SERVERS")||D.servers).map(G=>"wss://".concat(G.address.replace(/\./g,"-"),".").concat(oe("WORKER_DOMAIN"),":").concat(G.wss))}},void 0,O=>!!(O.code!==te.OPERATION_ABORTED&&O.code!==te.UNEXPECTED_RESPONSE||O.data&&O.data.retry),v)}(d,t,r,s));try{const d=await vS(c);return c.forEach(h=>h.cancel()),d}catch(d){throw d[0]}}async function $ge(t,r,s){let a=null;const c=[],d=async h=>{const m=oe(h?"WEBCS_DOMAIN_BACKUP_LIST":"WEBCS_DOMAIN").map(y=>t.proxyServer?"https://".concat(t.proxyServer,"/ap/?url=").concat(y+"/api/v2/transpond/webrtc?v=2"):"https://".concat(y,"/api/v2/transpond/webrtc?v=2"));return h&&(await ys(1e3),a!==null)?a:await Qw({fragementLength:oe("FRAGEMENT_LENGTH"),referenceList:m,asyncMapHandler:y=>(x.debug("[".concat(t.clientId,"] update ticket, Connect to ").concat(h?"backup":""," choose_server:"),y),function(v,w,R,O){const[D]=Wge(w,[bi.CHOOSE_SERVER]);let G=Si.networkState;return kd(async()=>{G&&Si.networkState===Rc.OFFLINE&&Si.onlineWaiter&&await pt.race([Si.onlineWaiter,ys(O&&O.maxRetryTimeout||Di.maxRetryTimeout)]),G=Si.networkState;const j=await Md(v,{data:D,cancelToken:R,headers:{"Content-Type":"multipart/form-data;"}},!0);return Bge(j,v)},()=>!1,j=>j.code!==te.OPERATION_ABORTED&&(j.code===te.UPDATE_TICKET_FAILED?j.data.retry:(x.warning("[".concat(w.clientId,"] update ticket network error, retry"),j),!0)),O)}(y,t,r,s)),allFailedhandler:y=>{throw y[0]},promisesCollector:c})};try{return a=await vS([d(!1),d(!0)]),c.length&&c.forEach(h=>h.cancel&&typeof h.cancel=="function"&&h.cancel()),a}catch(h){throw h[0]}}function S9(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}function N2(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?S9(Object(s),!0).forEach(function(a){q(t,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):S9(Object(s)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))})}return t}class Kge extends Br{get isSuccess(){return!!this.configs}constructor(r,s){super(),q(this,"configs",void 0),q(this,"store",void 0),q(this,"joinInfo",void 0),q(this,"cancelToken",void 0),q(this,"retryConfig",{timeout:3e3,timeoutFactor:1.5,maxRetryCount:1,maxRetryTimeout:1e4}),q(this,"interval",void 0),q(this,"mutex",void 0),q(this,"mutableParamsRead",!1),q(this,"configCache",{}),q(this,"limit_bitrate",void 0),this.mutex=new Xs("config-distribute",r),this.store=s}startGetConfigDistribute(r,s){this.joinInfo=r,this.cancelToken=s,this.interval&&this.stopGetConfigDistribute(),oe("ENABLE_CONFIG_DISTRIBUTE")&&(this.updateConfigDistribute(),this.interval=window.setInterval(()=>{this.updateConfigDistribute()},oe("CONFIG_DISTRIBUTE_INTERVAL")))}stopGetConfigDistribute(){this.interval&&clearInterval(this.interval),this.interval=void 0,this.joinInfo=void 0,this.cancelToken=void 0,this.configs=void 0,this.limit_bitrate=void 0}async awaitConfigDistributeComplete(){this.mutex.isLocked&&(await this.mutex.lock())()}async updateConfigDistribute(){if(this.mutableParamsRead||(this.mutableParamsRead=!0,Nt.reportApiInvoke(null,{options:void 0,name:Ni.LOAD_CONFIG_FROM_LOCALSTORAGE,tag:Kr.TRACER}).onSuccess(JSON.stringify(Nd))),!this.joinInfo||!this.cancelToken||!this.retryConfig)return void x.debug("[config-distribute] get config distribute interrupted have no joininfo");let r;const s=await this.mutex.lock();try{r=await Gge(this.joinInfo,this.cancelToken,this.retryConfig),x.debug("[config-distribute] get config distribute",JSON.stringify(r));const a=function(c){var d;const h=Ew(d=Object.keys(c).filter(v=>/^webrtc_ng_global_parameter/.test(v))).call(d);for(let v=0;v<h.length;v++)for(let w=h.length-1;w>v;w--){const R=h[w],O=c[R].value;if(typeof O.__priority=="number"){const D=O.__priority,G=h[w-1],j=c[G].value;if(typeof j.__priority=="number"){if(!(D>j.__priority))continue;{const W=R;h[w]=h[w-1],h[w-1]=W}}else{const W=R;h[w]=h[w-1],h[w-1]=W}}}const m=Date.now();let y={};return h.forEach(v=>{const w=c[v].value.__expires;w&&w<=m||(y[v]=c[v])}),y}(r);this.cacheGlobalParameterConfig(a),this.store.hasStartJoinChannel||(this.store.isABTestSuccess=!0),this.configs=a}catch(a){const c=new Ae(te.NETWORK_RESPONSE_ERROR,a);x.warning("[config-distribute] ".concat(c.toString()))}finally{s()}}getBitrateLimit(){return this.limit_bitrate||void 0}handleBitrateLimit(r){NH(r)&&(this.limit_bitrate?this.limit_bitrate&&this.limit_bitrate.id!==r.id&&this.emit(Gw.UPDATE_BITRATE_LIMIT,r):this.emit(Gw.UPDATE_BITRATE_LIMIT,r))}getLowStreamConfigDistribute(){return this.limit_bitrate&&N2({},this.limit_bitrate.low_stream_uplink)}handleABTestConfigDistribute(r){try{const s={},a=Object.keys(r),c=[];a.forEach(d=>{const h=r[d].value;s[d]=h;const m=h.__id;if(m&&this.configCache[d]&&this.configCache[d].__id===m)return;const y=h.__type,v=r[d].value,w=r[d].tag;let R=0;y?y===a8.REALTIME&&(R=1):Object.keys(v).some(O=>Object.prototype.hasOwnProperty.call(jL,O)||!c2()&&Object.prototype.hasOwnProperty.call(uP,O)?(R=1,!0):void 0),c.push({tag:w,isApplied:R,feature:d,params:JSON.stringify(h)})}),c.forEach(d=>{let{tag:h,feature:m,params:y,isApplied:v}=d;this.store.sessionId&&Nt.abTest(this.store.sessionId,{intSucc:1,isApplied:v,tag:h,feature:m,params:y,cid:this.store.cid,uid:this.store.intUid})}),this.configCache=s}catch(s){x.debug("handleABTestConfigDistribute error",s)}}cacheGlobalParameterConfig(r){const s=function(c){const d={};return Object.keys(c).forEach(h=>{const m=c[h].value,y=m.__expires,v=m.__type;Object.keys(m).forEach(w=>{w==="__id"||w==="__type"||w==="__priority"||w==="__expires"||Object.prototype.hasOwnProperty.call(d,w)||(d[w]=N2(N2({value:m[w]},y&&{expires:y}),v&&{type:v}))})}),d}(r);try{var a;const c=(a=s.LIMIT_BITRATE)===null||a===void 0?void 0:a.value;delete s.LIMIT_BITRATE,c&&NH(c)&&this.handleBitrateLimit(c),this.limit_bitrate=c,this.handleGlobalParameterConfig(s),this.handleABTestConfigDistribute(r),function(m){try{const y=Date.now();Object.keys(m).forEach(v=>{const{value:w,type:R,expires:O}=m[v];O&&O<=y||((R===a8.REALTIME||Object.prototype.hasOwnProperty.call(jL,v))&&(Nd[v]=w,Rr[v]=w,x.debug("Update realtime parameters from config distribute",v,w)),R||c2()||!Object.prototype.hasOwnProperty.call(uP,v)||(Nd[v]=w,Rr[v]=w,x.debug("Update gateway parameters from config distribute",v,w)))})}catch(y){x.error("Error update config immediately: ".concat(m),y.message)}}(s);const d=JSON.stringify(s),h=window.btoa(d);window.localStorage.setItem("websdk_ng_global_parameter",h),x.debug("Caching global parameters ".concat(d))}catch(c){x.error("Error caching global parameters:",c.message)}}handleGlobalParameterConfig(r){try{const s=Date.now();Object.keys(r).forEach(a=>{if(a==="CLIENT_ROLE_OPTIONS"&&Object.prototype.hasOwnProperty.call(Rr,a)){const{value:c,expires:d}=r[a];if(d&&d<=s)return;(function(h,m){try{return typeof h=="object"&&typeof m=="object"&&JSON.stringify(h)===JSON.stringify(m)}catch{return!1}})(Rr[a],c)||(Nd[a]=c,Rr[a]=c,this.emit(Gw.UPDATE_CLIENT_ROLE_OPTIONS,c),x.debug("Updating client role options: ".concat(JSON.stringify(c))))}})}catch(s){x.error("Error handling global parameter config:",s.message)}}}class qge extends Br{constructor(){super(...arguments),q(this,"resultStorage",new Map)}setLocalAudioStats(r,s,a){this.record("AUDIO_INPUT_LEVEL_TOO_LOW",r,this.checkAudioInputLevel(a,s)),this.record("SEND_AUDIO_BITRATE_TOO_LOW",r,this.checkSendAudioBitrate(a,s))}setLocalVideoStats(r,s,a){this.record("SEND_VIDEO_BITRATE_TOO_LOW",r,this.checkSendVideoBitrate(a,s)),this.record("FRAMERATE_INPUT_TOO_LOW",r,this.checkFramerateInput(a,s)),this.record("FRAMERATE_SENT_TOO_LOW",r,this.checkFramerateSent(a))}setRemoteAudioStats(r,s){const a=r.getUserId();this.record("AUDIO_OUTPUT_LEVEL_TOO_LOW",a,this.checkAudioOutputLevel(s))}setRemoteVideoStats(r,s){const a=r.getUserId();this.record("RECV_VIDEO_DECODE_FAILED",a,this.checkVideoDecode(s))}record(r,s,a){if(oe("STATS_UPDATE_INTERVAL")>500)return;this.resultStorage.has(r)||this.resultStorage.set(r,{result:[],isPrevNormal:!0});const c=this.resultStorage.get(r);if(c&&(c.result.push(a),c.result.length>=5)){var d;const h=lt(d=c.result).call(d,!0);c.isPrevNormal&&!h&&this.emit("exception",b9[r],r,s),!c.isPrevNormal&&h&&this.emit("exception",b9[r]+2e3,r+"_RECOVER",s),c.isPrevNormal=h,c.result=[]}}checkAudioOutputLevel(r){return!(r.receiveBitrate>0&&r.receiveLevel===0)}checkAudioInputLevel(r,s){return s instanceof Bi&&!s.isActive||!!s.muted||r.sendVolumeLevel!==0}checkFramerateInput(r,s){let a=null;s._encoderConfig&&s._encoderConfig.frameRate&&(a=Ic(s._encoderConfig.frameRate));const c=r.captureFrameRate;return!a||!c||!(a>10&&c<5||a<10&&a>=5&&c<=1)}checkFramerateSent(r){return!(r.captureFrameRate&&r.sendFrameRate&&r.captureFrameRate>5&&r.sendFrameRate<=1)}checkSendVideoBitrate(r,s){return!!s.muted||r.sendBitrate!==0}checkSendAudioBitrate(r,s){return s instanceof Bi&&!s.isActive||!!s.muted||r.sendBitrate!==0}checkVideoDecode(r){return r.receiveBitrate===0||r.decodeFrameRate!==0}}const b9={FRAMERATE_INPUT_TOO_LOW:1001,FRAMERATE_SENT_TOO_LOW:1002,SEND_VIDEO_BITRATE_TOO_LOW:1003,RECV_VIDEO_DECODE_FAILED:1005,AUDIO_INPUT_LEVEL_TOO_LOW:2001,AUDIO_OUTPUT_LEVEL_TOO_LOW:2002,SEND_AUDIO_BITRATE_TOO_LOW:2003},Zs=new class{markSubscribeStart(t,r){performance.mark("agora-web-sdk/".concat(t,"/subscribe-").concat(r))}markPublishStart(t,r){performance.mark("agora-web-sdk/".concat(t,"/publish-").concat(r))}measureFromSubscribeStart(t,r){const s=performance.getEntriesByName("agora-web-sdk/".concat(t,"/subscribe-").concat(r));if(s.length>0){const a=s[s.length-1];return Math.round(performance.now()-a.startTime)}return 0}measureFromPublishStart(t,r){const s=performance.getEntriesByName("agora-web-sdk/".concat(t,"/publish-").concat(r));if(s.length>0){const a=s[s.length-1];return Math.round(performance.now()-a.startTime)}return 0}};function w9(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}function ay(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?w9(Object(s),!0).forEach(function(a){q(t,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):w9(Object(s)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))})}return t}class Zw{constructor(r){q(this,"store",void 0),q(this,"onStatsException",void 0),q(this,"onUploadPublishDuration",void 0),q(this,"onStatsChanged",void 0),q(this,"localStats",new Map),q(this,"remoteStats",new Map),q(this,"updateStatsInterval",void 0),q(this,"trafficStats",void 0),q(this,"trafficStatsPeerList",[]),q(this,"uplinkStats",void 0),q(this,"exceptionMonitor",void 0),q(this,"p2pChannel",void 0),q(this,"scalabilityMode",lP.L1T1),q(this,"updateStats",()=>{this.p2pChannel&&(this.updateRemoteStats(this.p2pChannel),this.updateLocalStats(this.p2pChannel))}),this.store=r,this.exceptionMonitor=new qge,this.exceptionMonitor.on("exception",(s,a,c)=>{this.onStatsException&&this.onStatsException(s,a,c)})}startUpdateStats(){this.updateStatsInterval||(this.updateStatsInterval=window.setInterval(this.updateStats,1e3))}stopUpdateStats(){this.updateStatsInterval&&(window.clearInterval(this.updateStatsInterval),this.updateStatsInterval=void 0)}reset(){this.localStats=new Map,this.remoteStats=new Map,this.trafficStats=void 0,this.trafficStatsPeerList=[],this.uplinkStats=void 0}getLocalAudioTrackStats(){return this.localStats.get(Xe.LocalAudioTrack)||ay({},GL)}getLocalVideoTrackStats(){return this.localStats.get(Xe.LocalVideoTrack)||ay({},HL)}getRemoteAudioTrackStats(r){const s=(d,h)=>{if(!this.trafficStats)return h;const m=this.trafficStats.peer_delay.find(y=>y.peer_uid===d);return m&&(h.publishDuration=m.B_ppad+(Date.now()-this.trafficStats.timestamp)),h},a={};if(r){var c;const d=(c=this.remoteStats.get(r))===null||c===void 0?void 0:c.audioStats;d&&(a[r]=s(r,d))}else Array.from(this.remoteStats.entries()).forEach(d=>{let[h,{audioStats:m}]=d;m&&(a[h]=s(h,m))});return a}getRemoteNetworkQualityStats(r){const s={};if(r){var a;const c=(a=this.remoteStats.get(r))===null||a===void 0?void 0:a.networkStats;c&&(s[r]=c)}else Array.from(this.remoteStats.entries()).forEach(c=>{let[d,{networkStats:h}]=c;h&&(s[d]=h)});return s}getRemoteVideoTrackStats(r){const s=(d,h)=>{if(!this.trafficStats)return h;const m=this.trafficStats.peer_delay.find(y=>y.peer_uid===d);return m&&(h.publishDuration=m.B_ppvd+(Date.now()-this.trafficStats.timestamp)),h},a={};if(r){var c;const d=(c=this.remoteStats.get(r))===null||c===void 0?void 0:c.videoStats;d&&(a[r]=s(r,d))}else Array.from(this.remoteStats.entries()).forEach(d=>{let[h,{videoStats:m}]=d;m&&(a[h]=s(h,m))});return a}getRTCStats(){let r=0,s=0,a=0,c=0;const d=this.localStats.get(Xe.LocalAudioTrack);d&&(r+=d.sendBytes,s+=d.sendBitrate);const h=this.localStats.get(Xe.LocalVideoTrack);h&&(r+=h.sendBytes,s+=h.sendBitrate);const m=this.localStats.get(Xe.LocalVideoLowTrack);m&&(r+=m.sendBytes,s+=m.sendBitrate),this.remoteStats.forEach(v=>{let{audioStats:w,videoStats:R}=v;w&&(a+=w.receiveBytes,c+=w.receiveBitrate),R&&(a+=R.receiveBytes,c+=R.receiveBitrate)});let y=1;return this.trafficStats&&(y+=this.trafficStats.peer_delay.length),{Duration:0,UserCount:y,SendBitrate:s,SendBytes:r,RecvBytes:a,RecvBitrate:c,OutgoingAvailableBandwidth:this.uplinkStats?this.uplinkStats.B_uab/1e3:0,RTT:this.trafficStats?2*this.trafficStats.B_acd:0}}addLocalStats(r){this.localStats.set(r,void 0)}removeLocalStats(r){r?this.localStats.delete(r):this.localStats.clear()}addRemoteStats(r){this.remoteStats.set(r,{})}removeRemoteStats(r){r?this.remoteStats.delete(r):this.remoteStats.clear()}addP2PChannel(r){this.p2pChannel=r}updateTrafficStats(r){r.peer_delay=r.peer_delay.filter(s=>s.B_ppad!==void 0||s.B_ppvd!==void 0),r.peer_delay.filter(s=>this.trafficStatsPeerList.indexOf(s.peer_uid)===-1).forEach(s=>{var a;const c=(a=this.p2pChannel)===null||a===void 0?void 0:a.getRemoteMedia(s.peer_uid),d=c!=null&&c.videoSSRC?Zs.measureFromSubscribeStart(this.store.clientId,c.videoSSRC):0,h=c!=null&&c.audioSSRC?Zs.measureFromSubscribeStart(this.store.clientId,c.audioSSRC):0;s.B_ppad!==void 0&&s.B_ppvd!==void 0&&(this.onUploadPublishDuration&&this.onUploadPublishDuration(s.peer_uid,s.B_ppad,s.B_ppvd,d>h?d:h),this.trafficStatsPeerList.push(s.peer_uid))}),this.trafficStats=r}updateUplinkStats(r){this.uplinkStats&&this.uplinkStats.B_fir!==r.B_fir&&x.debug("[".concat(this.store.clientId,"]: Period fir changes to ").concat(r.B_fir)),this.uplinkStats=r}static isRemoteVideoFreeze(r,s,a){if(!r)return!1;const c=!!a&&s.framesDecodeFreezeTime>a.framesDecodeFreezeTime,d=!a||s.framesDecodeCount>a.framesDecodeCount;return c||!d}static isRemoteAudioFreeze(r){return!!r&&r._isFreeze()}isLocalVideoFreeze(r){return!(!r.inputFrame||!r.sentFrame)&&r.inputFrame.frameRate>5&&r.sentFrame.frameRate<3}updateLocalStats(r){Array.from(this.localStats.entries()).forEach(s=>{let[a,c]=s;switch(a){case Xe.LocalVideoTrack:case Xe.LocalVideoLowTrack:{const h=c,m=ay({},HL),y=r.getStats(),v=r.getLocalMedia(a);if(y){const w=y.videoSend.find(R=>R.ssrc===(v==null?void 0:v.ssrcs[0].ssrcId));if(w){const R=r.getLocalVideoSize(),O=r.getEncoderConfig(Xe.LocalVideoTrack);w.codec!=="H264"&&w.codec!=="H265"&&w.codec!=="VP8"&&w.codec!=="VP9"&&w.codec!=="AV1X"&&w.codec!=="AV1"||(m.codecType=w.codec),m.sendBytes=w.bytes,m.sendBitrate=h?8*Math.max(0,m.sendBytes-h.sendBytes):0,w.inputFrame?(m.captureFrameRate=w.inputFrame.frameRate,m.captureResolutionHeight=w.inputFrame.height,m.captureResolutionWidth=w.inputFrame.width):R&&(m.captureResolutionWidth=R.width,m.captureResolutionHeight=R.height),w.sentFrame?(m.sendFrameRate=w.sentFrame.frameRate,m.sendResolutionHeight=w.sentFrame.height,m.sendResolutionWidth=w.sentFrame.width):R&&(m.sendResolutionWidth=R.width,m.sendResolutionHeight=R.height),w.avgEncodeMs&&(m.encodeDelay=w.avgEncodeMs),O&&O.bitrateMax&&(m.targetSendBitrate=1e3*O.bitrateMax),m.sendPackets=w.packets,m.sendPacketsLost=w.packetsLost,m.sendJitterMs=w.jitterMs,m.sendRttMs=w.rttMs,m.totalDuration=h?h.totalDuration+1:1,m.totalFreezeTime=h?h.totalFreezeTime:0,this.isLocalVideoFreeze(w)&&(m.totalFreezeTime+=1),w.scalabilityMode&&this.scalabilityMode!==w.scalabilityMode&&(x.debug("[".concat(this.store.clientId,"]: The scalabilityMode of the video sending stream is ").concat(w.scalabilityMode)),this.scalabilityMode=w.scalabilityMode)}this.trafficStats&&(m.currentPacketLossRate=(this.trafficStats.B_pvlr4||0)/100)}var d;this.localStats.set(a,m),((h==null?void 0:h.sendResolutionWidth)!==m.sendResolutionWidth||(h==null?void 0:h.sendResolutionHeight)!==m.sendResolutionHeight)&&((d=this.onStatsChanged)===null||d===void 0||d.call(this,"resolution",{width:m.sendResolutionWidth,height:m.sendResolutionHeight})),m&&v&&this.exceptionMonitor.setLocalVideoStats(this.store.uid,v.track,m);break}case Xe.LocalAudioTrack:{const h=c,m=ay({},GL),y=r.getStats(),v=r.getLocalMedia(a);if(y){const w=y.audioSend.find(R=>R.ssrc===(v==null?void 0:v.ssrcs[0].ssrcId));if(w){if(w.codec!=="opus"&&w.codec!=="aac"&&w.codec!=="PCMU"&&w.codec!=="PCMA"&&w.codec!=="G722"||(m.codecType=w.codec),w.inputLevel)m.sendVolumeLevel=Math.round(32767*w.inputLevel);else{const R=r.getLocalAudioVolume();R&&(m.sendVolumeLevel=Math.round(32767*R))}m.sendBytes=w.bytes,m.sendPackets=w.packets,m.sendPacketsLost=w.packetsLost,m.sendJitterMs=w.jitterMs,m.sendRttMs=w.rttMs,m.sendBitrate=h?8*Math.max(0,m.sendBytes-h.sendBytes):0}}this.trafficStats&&(m.currentPacketLossRate=(this.trafficStats.B_palr4||0)/100),this.localStats.set(Xe.LocalAudioTrack,m),m&&v&&this.exceptionMonitor.setLocalAudioStats(this.store.uid,v.track,m);break}}})}updateRemoteStats(r){Array.from(this.remoteStats.entries()).forEach(s=>{var a,c;let[d,{videoStats:h,audioStats:m,videoPcStats:y}]=s;const v=m,w=h,R=y,O=ay({},y8),D=ay({},E8),G=ay({},Nme),{audioTrack:j,videoTrack:W,audioSSRC:Q,videoSSRC:ee}=r.getRemoteMedia(d);let fe;fe=this.store.useP2P?r.getStats(!0):r.getStats();const ye=(a=fe)===null||a===void 0?void 0:a.audioRecv.find(Ze=>Ze.ssrc===Q),Ee=(c=fe)===null||c===void 0?void 0:c.videoRecv.find(Ze=>Ze.ssrc===ee),_e=this.trafficStats&&this.trafficStats.peer_delay.find(Ze=>Ze.peer_uid===d);if(ye&&(ye.codec!=="opus"&&ye.codec!=="aac"&&ye.codec!=="PCMU"&&ye.codec!=="PCMA"&&ye.codec!=="G722"||(O.codecType=ye.codec),ye.outputLevel?O.receiveLevel=Math.round(32767*ye.outputLevel):j&&(O.receiveLevel=Math.round(32767*j.getVolumeLevel())),O.receiveBytes=ye.bytes,O.receivePackets=ye.packets,O.receivePacketsLost=ye.packetsLost,O.receivePacketsDiscarded=ye.packetsDiscarded,O.packetLossRate=O.receivePacketsLost/(O.receivePackets+O.receivePacketsLost),O.receiveBitrate=v?8*Math.max(0,O.receiveBytes-v.receiveBytes):0,O.totalDuration=v?v.totalDuration+1:1,O.totalFreezeTime=v?v.totalFreezeTime:0,O.freezeRate=O.totalFreezeTime/O.totalDuration,O.receiveDelay=ye.jitterBufferMs,O.totalDuration>10&&Zw.isRemoteAudioFreeze(j)&&(O.totalFreezeTime+=1)),Ee){var Ne;Ee.codec!=="H264"&&Ee.codec!=="H265"&&Ee.codec!=="VP8"&&Ee.codec!=="VP9"&&Ee.codec!=="AV1X"&&Ee.codec!=="AV1"||(D.codecType=Ee.codec),D.receiveBytes=Ee.bytes,D.receiveBitrate=w?8*Math.max(0,D.receiveBytes-w.receiveBytes):0,D.decodeFrameRate=Ee.decodeFrameRate<0?0:Ee.decodeFrameRate,D.renderFrameRate=Ee.decodeFrameRate<0?0:Ee.decodeFrameRate,Ee.outputFrame&&(D.renderFrameRate=Ee.outputFrame.frameRate),Ee.receivedFrame?(D.receiveFrameRate=Ee.receivedFrame.frameRate,D.receiveResolutionHeight=Ee.receivedFrame.height,D.receiveResolutionWidth=Ee.receivedFrame.width):W&&(D.receiveResolutionHeight=W._videoHeight||0,D.receiveResolutionWidth=W._videoWidth||0),Ee.framesRateFirefox!==void 0&&(D.receiveFrameRate=Math.round(Ee.framesRateFirefox)),D.receivePackets=Ee.packets,D.receivePacketsLost=Ee.packetsLost,D.packetLossRate=D.receivePacketsLost/(D.receivePackets+D.receivePacketsLost);const Ze=w?w.totalFreezeTime:0,ft=w?w.totalDuration:0;D.totalDuration=w?w.totalDuration+1:1,D.totalFreezeTime=(Ne=Ee.totalFreezesDuration)!==null&&Ne!==void 0?Ne:Ze||0,D.receiveDelay=Ee.jitterBufferMs||0;const yt=!!ee&&r.getRemoteVideoIsReady(ee);Ee.totalFreezesDuration===void 0&&W&&yt&&Zw.isRemoteVideoFreeze(W,Ee,R)&&(D.totalFreezeTime+=1),D.freezeRate=Math.max(0,Math.min((D.totalFreezeTime-Ze)/(D.totalDuration-ft),1))}_e&&(O.end2EndDelay=_e.B_ad,D.end2EndDelay=_e.B_vd,O.transportDelay=_e.B_ed,D.transportDelay=_e.B_ed,O.currentPacketLossRate=_e.B_ealr4/100,D.currentPacketLossRate=_e.B_evlr4/100,G.uplinkNetworkQuality=_e.B_punq?_e.B_punq:0,G.downlinkNetworkQuality=_e.B_pdnq?_e.B_pdnq:0),this.remoteStats.set(d,{audioStats:O,videoStats:D,videoPcStats:Ee,networkStats:G}),j&&this.exceptionMonitor.setRemoteAudioStats(j,O),W&&this.exceptionMonitor.setRemoteVideoStats(W,D)})}}class T9{constructor(){q(this,"destChannelMediaInfos",new Map),q(this,"srcChannelMediaInfo",void 0)}setSrcChannelInfo(r){OH(r),this.srcChannelMediaInfo=r}addDestChannelInfo(r){OH(r),this.destChannelMediaInfos.set(r.channelName,r)}removeDestChannelInfo(r){PP(r),this.destChannelMediaInfos.delete(r)}getSrcChannelMediaInfo(){return this.srcChannelMediaInfo}getDestChannelMediaInfo(){return this.destChannelMediaInfos}}function C9(t){if(!(t instanceof T9))return new Ae(te.INVALID_PARAMS,"Config should be instance of [ChannelMediaRelayConfiguration]").throw();const r=t.getSrcChannelMediaInfo(),s=t.getDestChannelMediaInfo();if(!r)return new Ae(te.INVALID_PARAMS,"srcChannelMediaInfo should not be empty").throw();if(s.size===0)return new Ae(te.INVALID_PARAMS,"destChannelMediaInfo should not be empty").throw()}class sg{get hasVideo(){return this._video_enabled_&&!this._video_muted_&&this._video_added_}get hasAudio(){return this._audio_enabled_&&!this._audio_muted_&&this._audio_added_}get audioTrack(){if(this.hasAudio||this._audio_pre_subscribed)return this._audioTrack}get videoTrack(){if(this.hasVideo||this._video_pre_subscribed)return this._videoTrack}get dataChannels(){return this._dataChannels}constructor(r,s){q(this,"uid",void 0),q(this,"_uintid",void 0),q(this,"_trust_in_room_",!0),q(this,"_trust_audio_enabled_state_",!0),q(this,"_trust_video_enabled_state_",!0),q(this,"_trust_audio_mute_state_",!0),q(this,"_trust_video_mute_state_",!0),q(this,"_audio_muted_",!1),q(this,"_video_muted_",!1),q(this,"_audio_enabled_",!0),q(this,"_video_enabled_",!0),q(this,"_audio_added_",!1),q(this,"_video_added_",!1),q(this,"_is_pre_created",!1),q(this,"_video_pre_subscribed",!1),q(this,"_audio_pre_subscribed",!1),q(this,"_trust_video_stream_added_state_",!0),q(this,"_trust_audio_stream_added_state_",!0),q(this,"_audioTrack",void 0),q(this,"_videoTrack",void 0),q(this,"_dataChannels",[]),q(this,"_audioSSRC",void 0),q(this,"_videoSSRC",void 0),q(this,"_audioOrtc",void 0),q(this,"_videoOrtc",void 0),q(this,"_cname",void 0),q(this,"_rtxSsrcId",void 0),q(this,"_videoMid",void 0),q(this,"_audioMid",void 0),this.uid=r,this._uintid=s}}function R9(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}function I9(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?R9(Object(s),!0).forEach(function(a){q(t,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):R9(Object(s)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))})}return t}const eT="9",A9=4e4;function P9(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}function wf(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?P9(Object(s),!0).forEach(function(a){q(t,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):P9(Object(s)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))})}return t}var SS=function(t){return t[t.DOWN=0]="DOWN",t[t.UP=1]="UP",t}(SS||{});const zP=new Map;function O9(t,r,s,a){let{scale:c}=t;if(c===0&&a===SS.UP||c>=r.length-1&&a===SS.DOWN)return t;let d=wf(wf({},t),{},{scale:a===SS.DOWN?++c:--c});switch(s){case"maintain-framerate":d=wf(wf({},d),r[c].motion);break;case"maintain-resolution":d=wf(wf({},d),r[c].detail);break;case"balanced":d=wf(wf({},d),r[c].balanced)}return d}function k9(t,r){if(r){const s={overUse:0,underUse:0,adaptationList:N9(r)};zP.set(t,s)}else zP.delete(t)}function N9(t){const r=wf({},t),{bitrateMax:s,frameRate:a,scaleResolutionDownBy:c,bitrateMin:d}=r,{MIN_FRAME_RATE:h,MAX_THRESHOLD_FRAMERATE:m,MAX_SCALE:y,BITRATE_MIN_THRESHOLD:v,BITRATE_MAX_THRESHOLD:w,BWE_SCALE_UP_THRESHOLD:R,BWE_SCALE_DOWN_THRESHOLD:O,PERF_SCALE_DOWN_THRESHOLD:D,PERF_SCALE_UP_THRESHOLD:G,BALANCE_BITRATE_FACTOR:j,BALANCE_FRAMERATE_FACTOR:W,BALANCE_RESOLUTION_FACTOR:Q,MOTION_RESOLUTION_FACTOR:ee,MOTION_BITRATE_FACTOR:fe,DETAIL_FRAMERATE_FACTOR:ye,DETAIL_BITRATE_FACTOR:Ee}=UL,_e=Math.min(r.frameRate,m),Ne=[{scale:0,threshold:{bwe_down:Math.round(Math.pow(O,1)*s),bwe_up:s,fps_down:Math.round(Math.pow(D,1)*_e),fps_up:a},balanced:{scaleResolutionDownBy:1,frameRate:a,bitrateMax:s,bitrateMin:d},motion:{scaleResolutionDownBy:1,frameRate:a,bitrateMax:s,bitrateMin:d},detail:{scaleResolutionDownBy:1,frameRate:a,bitrateMax:s,bitrateMin:d}}];for(let Ze=1;Ze<=y;Ze++){const ft={bwe_up:Math.round(Math.pow(R,Ze)*s),bwe_down:Math.round(Math.pow(O,Ze+1)*s),fps_up:Math.round(Math.pow(G,Ze)*_e),fps_down:Math.round(Math.pow(D,Ze+1)*_e)},yt={scaleResolutionDownBy:c/Math.pow(Q,Ze),frameRate:Math.max(Math.round(Math.pow(W,Ze)*a),h),bitrateMax:Math.max(Math.round(Math.pow(j,Ze)*s),w),bitrateMin:Math.max(Math.round(Math.pow(j,Ze)*d),v)},An={scaleResolutionDownBy:c/Math.pow(ee,Ze),frameRate:a,bitrateMax:Math.max(Math.round(Math.pow(fe,Ze)*s),w),bitrateMin:Math.max(Math.round(Math.pow(fe,Ze)*d),v)},Pn={scaleResolutionDownBy:1,frameRate:Math.max(Math.round(Math.pow(ye,Ze)*a),h),bitrateMax:Math.max(Math.round(Math.pow(Ee,Ze)*s),w),bitrateMin:Math.max(Math.round(Math.pow(Ee,Ze)*d),v)};Ne.push({scale:Ze,threshold:ft,balanced:yt,motion:An,detail:Pn})}return Ne}function Yge(t,r,s,a,c,d){const h=zP.get(t)||{overUse:0,underUse:0,adaptationList:N9(c)},{adaptationList:m}=h;zP.set(t,h);const{OVERUSE_TIMES_THRESHOLD:y,UNDERUSE_TIMES_THRESHOLD:v}=UL,{scale:w}=a;let R,O;return typeof r=="number"&&r>0&&function(D,G,j,W){if(G>=j.length)return!1;let{threshold:{fps_down:Q}}=j[G];return oe("FORCE_AG_HIGH_FRAMERATE")&&W==="maintain-framerate"&&(Q=j[0].threshold.fps_down),D<Q}(r,w,m,d)&&(h.overUse++,O=Vw.CPU,h.overUse>y)||typeof s=="number"&&s>0&&function(D,G,j){if(G>=j.length)return!1;const{threshold:{bwe_down:W}}=j[G];return D<W}(s,w,m)&&(h.overUse++,O=Vw.BANDWIDTH,h.overUse>y)?(h.overUse=0,h.underUse=0,R=O9(a,m,d,SS.DOWN),[R,O]):(typeof r=="number"&&r>0&&typeof s=="number"&&s>0&&function(D,G,j,W){if(G===0)return;let{threshold:{fps_up:Q}}=j[G];return oe("FORCE_AG_HIGH_FRAMERATE")&&W==="maintain-framerate"&&(Q=j[1].threshold.fps_up),D>Q}(r,w,m,d)&&function(D,G,j){if(G===0)return;const{threshold:{bwe_up:W}}=j[G];return D>W}(s,w,m)&&(h.underUse++,h.underUse>v&&(h.overUse=0,h.underUse=0,R=O9(a,m,d,SS.UP),R.scale===0&&(O=Vw.NONE))),[R,O])}function D9(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}function D2(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?D9(Object(s),!0).forEach(function(a){q(t,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):D9(Object(s)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))})}return t}function Xge(t){var r;return!!oe("ENABLE_AG_ADAPTATION")&&!!(t instanceof e2||lt(r=t._hints).call(r,gr.CUSTOM_TRACK))&&(!!oe("FORCE_SUPPORT_AG_ADAPTATION")||!!(function(s){const a=Ln();if(a.os!==Qi.IOS||!a.osVersion)return!1;const c=a.osVersion.split(".");return Number(c[0])>=s}(14)&&Pz(17,4)||Az(14)&&Oz(17,4,!0)))}const GP=new Map;function HP(t,r){const s=GP.get(t);if(s){const{timer:a}=s;window.clearTimeout(a),GP.delete(t)}r.qualityLimitationReason=Vw.NONE,k9(t)}function Jge(t,r){var s;let a;switch(r){case Xe.LocalAudioTrack:a=Qn.Audio;break;case Xe.LocalVideoTrack:a=lt(s=t._hints).call(s,gr.SCREEN_TRACK)?Qn.Screen:Qn.High;break;case Xe.LocalVideoLowTrack:a=Qn.Low}return a}function x2(t){const r=Wn();if(t.some(s=>s._bypassWebAudio))throw new Le(te.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");if(!r.webAudioMediaStreamDest)throw new Le(te.NOT_SUPPORTED,"cannot publish multiple tracks because your browser does not support audio mixing")}function L2(t,r){x2(t);const s=new Bi;return t.forEach(a=>s.addAudioTrack(a)),s}const Qge=!Wn().supportUnifiedPlan||oe("CHROME_FORCE_PLAN_B")&&pf();function $P(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var s;return Qge?(s={spec:r,store:t},Sf("PlanBConnection").create(s)):new Vh(r,t)}function M2(t){return t&&(t.iceConnectionState==="disconnected"||t.iceConnectionState==="checking"||t.iceConnectionState==="failed")}function x9(t){try{if(t.iceServers)return!1;if(t.turnServer&&t.turnServer.mode!=="off"){if(Lw(t.turnServer.servers))return!1;if(oe("FORCE_TURN_TCP")||t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).some(r=>r.forceturn))return!0}return!1}catch{return!1}}var kn;function L9(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}function Ud(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?L9(Object(s),!0).forEach(function(a){q(t,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):L9(Object(s)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))})}return t}let Vh=(kn=class Ay extends xH{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var r,s;return(r=(s=this.peerConnection.getReceivers()[0])===null||s===void 0||(s=s.transport)===null||s===void 0?void 0:s.state)!==null&&r!==void 0?r:null}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.send.videoCodecs.map(r=>r.rtpMap&&r.rtpMap.encodingName.toLowerCase()||"").filter(r=>{var s;return lt(s=Object.keys(dP)).call(s,r)}))]}constructor(r,s){super(r,s),q(this,"id",mr(5,"connection-")),q(this,"store",void 0),q(this,"peerConnection",void 0),q(this,"forceTurn",!1),q(this,"remoteSDP",void 0),q(this,"initialOffer",void 0),q(this,"transportEventReceiver",void 0),q(this,"statsFilter",void 0),q(this,"extension",{useXR:oe("USE_XR")}),q(this,"localCapabilities",void 0),q(this,"remoteCodecs",void 0),q(this,"localCandidateCount",0),q(this,"allCandidatesReceived",!1),q(this,"isPreallocation",!1),q(this,"preSSRCMap",new Map),q(this,"dataStreamChannelMap",new Map),q(this,"establishPromise",void 0),q(this,"recoveredDataChannelIds",[]),q(this,"currentDataChannelId",1),q(this,"supportAV1RtpSpec",!1),q(this,"mutex",void 0),q(this,"qualityLimitationReason",Vw.NONE),q(this,"isFirstConnected",!1),this.store=s,this.forceTurn=x9(r),this.mutex=new Xs("P2PConnection-mutex",s.clientId),this.peerConnection=new RTCPeerConnection(Ay.resolvePCConfiguration(r),{optional:[{googDscp:!0}]}),this.isFirstConnected=!1,this.statsFilter=xL(this.peerConnection,oe("STATS_UPDATE_INTERVAL"),void 0,Hr()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}getPreMedia(r){const s=this.preSSRCMap.get(r);if(s!==void 0){const a=this.peerConnection.getTransceivers().find(c=>c.mid===s);if(a)return{transceiver:a,track:a.receiver.track,id:s}}}async updateRemoteRTPCapabilities(r,s){if(this.remoteCodecs=s,!this.remoteSDP)return void x.debug("[P2PConnection] cannot updateRemoteRTPCapabilities before remote SDP created, local codecs: ".concat(this.localCodecs,", codecs: ").concat(s));if(this.remoteSDP.updateRemoteCodec(r,s,this.store.codec)){const a=await this.peerConnection.createOffer(),c=this.logSDPExchange(a.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(a);const d=this.remoteSDP.toString();c==null||c(d),await this.peerConnection.setRemoteDescription({type:"answer",sdp:d})}else x.debug("[P2PConnection] updateRemoteRTPCapabilities no need to exchange SDP.")}async establish(){try{this.peerConnection.addTransceiver("video",{direction:"recvonly"}),this.peerConnection.addTransceiver("audio",{direction:"recvonly"});const a=await this.peerConnection.createOffer();if(!a.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const c=rg(a.sdp),d=await e9({filterRTX:!oe("USE_PUB_RTX")&&!oe("USE_SUB_RTX"),filterVideoFec:oe("FILTER_VIDEO_FEC"),filterAudioFec:oe("FILTER_AUDIO_FEC"),filterVideoCodec:oe("FILTER_VIDEO_CODEC")},this.extension);if(this.localCapabilities=VP(d),this.initialOffer=a,oe("ENABLE_SVC")&&this.store.codec=="av1"){const m=await async function(){try{const y=new RTCPeerConnection;y.addTransceiver("video",{direction:"sendonly",sendEncodings:[{scalabilityMode:lP.L1T3}]});const v=await y.createOffer();if(!v.sdp)return void y.close();const w=Xa(v.sdp).mediaDescriptions[0];if(!w)return;const R=w.attributes.extmaps.find(O=>O.extensionName==="https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension");return y.close(),R}catch{return}}();var r;m&&(this.supportAV1RtpSpec=!0,(r=d.send)===null||r===void 0||r.videoExtensions.push(m))}let h;return a.sdp&&i9(a.sdp)&&(h=qr(d),(s=h).send&&(gS(bt.VIDEO,s.send.videoExtensions),gS(bt.AUDIO,s.send.audioExtensions)),s.recv&&(gS(bt.VIDEO,s.recv.videoExtensions),gS(bt.AUDIO,s.recv.audioExtensions)),s.sendrecv&&(gS(bt.VIDEO,s.sendrecv.videoExtensions),gS(bt.AUDIO,s.sendrecv.audioExtensions))),Ud(Ud({},c),{},{rtpCapabilities:h||d,offerSDP:a.sdp})}catch(a){throw new Le(te.GET_LOCAL_CONNECTION_PARAMS_FAILED,a.toString())}var s}async connect(r){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.initialOffer.sdp&&i9(this.initialOffer.sdp)&&(s=r.rtpCapabilities,a=this.localCapabilities,s.send&&(LP(bt.VIDEO,s.send.videoExtensions,a.send.videoExtensions),LP(bt.AUDIO,s.send.audioExtensions,a.send.audioExtensions)),s.recv&&(LP(bt.VIDEO,s.recv.videoExtensions,a.recv.videoExtensions),LP(bt.AUDIO,s.recv.audioExtensions,a.recv.audioExtensions))),this.remoteSDP=new class{get localCapabilities(){return qr(this._localCapabilities)}get rtpCapabilities(){return qr(this._rtpCapabilities)}get candidates(){return qr(this._candidates)}get iceParameters(){return qr(this._iceParameters)}get dtlsParameters(){return qr(this._dtlsParameters)}constructor(v){let w=arguments.length>1&&arguments[1]!==void 0&&arguments[1];q(this,"sessionDesc",void 0),q(this,"_localCapabilities",void 0),q(this,"_rtpCapabilities",void 0),q(this,"_candidates",void 0),q(this,"_originCandidates",void 0),q(this,"_iceParameters",void 0),q(this,"_isUseExtmapAllowMixed",void 0),q(this,"_dtlsParameters",void 0),q(this,"setup",void 0),q(this,"currentMidIndex",void 0),q(this,"cname",void 0),q(this,"firefoxSsrcMidMap",new Map),this._isUseExtmapAllowMixed=w,v=qr(v);const{iceParameters:R,dtlsParameters:O,candidates:D,rtpCapabilities:G,setup:j,localCapabilities:W,cname:Q}=v;this._rtpCapabilities=G,this._candidates=D,this._originCandidates=qr(D),this._iceParameters=R,this._dtlsParameters=O,this._localCapabilities=W,this.setup=j,this.cname=Q,this.sessionDesc=this.updateRemoteRTPCapabilities(G),this.currentMidIndex=this.sessionDesc.mediaDescriptions.length-1}preloadRemoteMedia(v){const w=this.candidates,R=this.dtlsParameters,O=this.iceParameters,D=this.rtpCapabilities.send;let G=this.sessionDesc.mediaDescriptions.length-1;for(let j=1;j<v;j++){const W=2*j+2e4,Q=2*j+A9,{ssrcs:ee,ssrcGroups:fe}=oy([{ssrcId:W}],this.cname),{ssrcs:ye,ssrcGroups:Ee}=oy([{ssrcId:Q,rtx:oe("USE_SUB_RTX")?Q+1:void 0}],this.cname);this.sessionDesc.mediaDescriptions.push({media:{mediaType:"video",port:eT,protos:["UDP","TLS","RTP","SAVPF"],fmts:D.videoCodecs.map(_e=>_e.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:O.iceUfrag,icePwd:O.icePwd,unrecognized:[],candidates:w,extmaps:D.videoExtensions,fingerprints:R.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:ye,ssrcGroups:Ee,rtcpFeedbackWildcards:[],payloads:D.videoCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(++G)}}),this.sessionDesc.mediaDescriptions.push({media:{mediaType:"audio",port:eT,protos:["UDP","TLS","RTP","SAVPF"],fmts:D.audioCodecs.map(_e=>_e.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:O.iceUfrag,icePwd:O.icePwd,unrecognized:[],candidates:w,extmaps:D.audioExtensions,fingerprints:R.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:ee,ssrcGroups:fe,rtcpFeedbackWildcards:[],payloads:D.audioCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(++G)}}),this.currentMidIndex+=2}this.updateBundleMids()}toString(){return Qm(this.sessionDesc)}send(v,w,R,O){const{ssrcs:D,ssrcGroups:G}=oy(w,this.cname,oe("SYNC_GROUP")?R:void 0),j=this.findPreloadMediaDesc(D);if(j){if(Hr()&&this.firefoxSsrcMidMap.set(D[0].ssrcId,j.attributes.mid),O&&(O.twcc||O.remb)){const W=this.sessionDesc.mediaDescriptions.indexOf(j);return this.sessionDesc.mediaDescriptions[W]=this.mungSendMediaDesc(j,O),{mid:j.attributes.mid,needExchangeSDP:!0}}return{mid:j.attributes.mid,needExchangeSDP:!1}}{const W=this.findAvailableMediaIndex(v,D);let Q;return W===-1||W===1&&(xs()||function(){const ee=Ln();return!(ee.name!==$n.CHROME||!ee.osVersion)&&Number(ee.version)<=90}()||oe("ENABLE_ENCODED_TRANSFORM")&&hf())||W===0&&oe("USE_SUB_RTX")||kz()?(Q=this.createOrRecycleSendMedia(v,D,G,"sendonly",O),this.updateBundleMids()):(Q=qr(this.sessionDesc.mediaDescriptions[W]),Q.attributes.direction="sendonly",Q.attributes.ssrcs=D,Q.attributes.ssrcGroups=G,this.sessionDesc.mediaDescriptions[W]=this.mungSendMediaDesc(Q,O)),Hr()&&this.firefoxSsrcMidMap.set(D[0].ssrcId,Q.attributes.mid),{mid:Q.attributes.mid,needExchangeSDP:!0}}}sendDataChannel(){const{mediaDesc:v,needExchangeSDP:w}=this.createOrRecycleDataChannel();return this.updateBundleMids(),{mid:v.attributes.mid,needExchangeSDP:w}}batchSend(v){const w=v.map(D=>{let{kind:G,ssrcMsg:j,mslabel:W}=D;return this.send(G,j,W)}),R=[];let O=!1;return w.forEach(D=>{let{mid:G,needExchangeSDP:j}=D;j&&(O=!0),R.push(G)}),{mids:R,needExchangeSDP:O}}stopSending(v){const w=this.sessionDesc.mediaDescriptions.filter(R=>R.attributes.mid&&v.indexOf(R.attributes.mid)!==-1);if(w.length!==v.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");w.forEach(R=>{R.attributes.mid==="0"||Hr()||kz()?R.attributes.ssrcs=[]:(R.attributes.ssrcs=[],R.attributes.direction="inactive",R.media.port="0")}),this.updateBundleMids()}mute(v){const w=this.sessionDesc.mediaDescriptions.find(R=>R.attributes.mid===v);if(!w)throw new Error("mediaDescription not found with ".concat(v," in remote SDP when calling RemoteSDP.mute."));w.attributes.direction="inactive"}unmute(v){const w=this.sessionDesc.mediaDescriptions.find(R=>R.attributes.mid===v);if(!w)throw new Error("mediaDescription not found with ".concat(v," in remote SDP when calling RemoteSDP.unmute."));w.attributes.direction="sendonly"}muteRemote(v){const w=this.sessionDesc.mediaDescriptions.filter(R=>lt(v).call(v,R.attributes.mid||""));if(w.length!==v.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");w.forEach(R=>{R.attributes.direction="inactive"})}unmuteRemote(v){const w=this.sessionDesc.mediaDescriptions.filter(R=>lt(v).call(v,R.attributes.mid||""));if(w.length!==v.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");w.forEach(R=>{R.attributes.direction="recvonly"})}receive(v,w,R,O){v.forEach((D,G)=>{this.createOrRecycleRecvMedia(D,[],"recvonly",w,R,O[G])}),this.updateBundleMids()}stopReceiving(v){const w=this.sessionDesc.mediaDescriptions.filter(R=>v.indexOf(R.attributes.mid)!==-1);if(w.length!==v.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");w.forEach(R=>{R.media.port="0",R.attributes.direction="inactive"}),this.updateBundleMids()}updateRemoteRTPCapabilities(v){const w=this.sessionDesc||Xa((R=this._isUseExtmapAllowMixed,`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=ice-lite`.concat(R?`
a=extmap-allow-mixed`:"",`
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`)));var R;this._rtpCapabilities=v;const O=this.rtpCapabilities.send,D=this.localCapabilities.send;for(const G of w.mediaDescriptions){if(G.attributes.iceUfrag=this._iceParameters.iceUfrag,G.attributes.icePwd=this._iceParameters.icePwd,G.attributes.fingerprints=this._dtlsParameters.fingerprints,G.attributes.candidates=this._candidates,G.attributes.setup=this.setup,G.media.mediaType==="application"&&(G.attributes.sctpPort="5000"),G.media.mediaType==="video"){if(O.videoCodecs.length===0){const j=D.videoCodecs.filter(W=>{var Q,ee;return(Q=W.rtpMap)===null||Q===void 0?void 0:lt(ee=Q.encodingName.toLowerCase()).call(ee,"vp8")})||[D.videoCodecs[0]];G.media.fmts=j.map(W=>W.payloadType.toString(10)),G.attributes.payloads=j,G.attributes.extmaps=[]}else if(G.media.fmts=O.videoCodecs.map(j=>j.payloadType.toString(10)),G.attributes.payloads=O.videoCodecs,G.attributes.extmaps=O.videoExtensions,oe("PRELOAD_MEDIA_COUNT")>0){const{ssrcs:j,ssrcGroups:W}=oy([{ssrcId:A9,rtx:oe("USE_SUB_RTX")?40001:void 0}],this.cname);G.attributes.ssrcs=j,G.attributes.ssrcGroups=W}}if(G.media.mediaType==="audio"){if(O.audioCodecs.length===0){const j=D.audioCodecs.filter(W=>{var Q,ee;return(Q=W.rtpMap)===null||Q===void 0?void 0:lt(ee=Q.encodingName.toLowerCase()).call(ee,"opus")})||[D.audioCodecs[0]];G.media.fmts=j.map(W=>W.payloadType.toString(10)),G.attributes.payloads=j,G.attributes.extmaps=[]}else if(G.media.fmts=O.audioCodecs.map(j=>j.payloadType.toString(10)),G.attributes.payloads=O.audioCodecs,G.attributes.extmaps=O.audioExtensions,yS(G),oe("PRELOAD_MEDIA_COUNT")>0){const{ssrcs:j,ssrcGroups:W}=oy([{ssrcId:2e4}],this.cname);G.attributes.ssrcs=j,G.attributes.ssrcGroups=W}}}return this.sessionDesc=w,this.currentMidIndex=w.mediaDescriptions.length-1,this.sessionDesc}updateCandidates(v){const w=this._originCandidates.filter(O=>O.transport==="udp"),R=[];if(w.forEach(O=>{R.push(I9(I9({},O),{},{foundation:"tcpcandidate",priority:Number(O.priority)-1+"",transport:"tcp",port:Number(O.port)+90+""}))}),w.length!==0){switch(v){case Qs.TCP_RELAY:this._candidates=R;break;case Qs.UDP_TCP_RELAY:case Qs.RELAY:this._candidates=[...w,...R];break;default:this._candidates=w}for(const O of this.sessionDesc.mediaDescriptions)O.attributes.candidates=this.candidates}}restartICE(v){v=qr(v),this._iceParameters=v,this.sessionDesc.mediaDescriptions.forEach(w=>{w.attributes.iceUfrag=v.iceUfrag,w.attributes.icePwd=v.icePwd})}predictReceivingMids(v){const w=[];for(let R=0;R<v;R++)w.push((this.currentMidIndex+R+1).toString(10));return w}findAvailableMediaIndex(v,w){return this.sessionDesc.mediaDescriptions.findIndex(R=>{const O=R.media.mediaType===v&&R.media.port!=="0"&&(R.attributes.direction==="sendonly"||R.attributes.direction==="sendrecv")&&R.attributes.ssrcs.length===0;if(Hr()){if(O){const D=this.firefoxSsrcMidMap.get(w[0].ssrcId);return!(D||R.attributes.mid!=="0"&&R.attributes.mid!=="1")||!(!D||D!==R.attributes.mid)}return!1}return O})}createOrRecycleDataChannel(){for(const R of this.sessionDesc.mediaDescriptions)if(R.media.mediaType==="application")return{mediaDesc:R,needExchangeSDP:!1};this.currentMidIndex+=1;const v="".concat(this.currentMidIndex),w={media:{mediaType:"application",port:eT,protos:["UDP","DTLS","SCTP"],fmts:["webrtc-datachannel"]},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:[],fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[],rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,mid:"".concat(v),sctpPort:"5000"}};return this.sessionDesc.mediaDescriptions.push(w),{mediaDesc:w,needExchangeSDP:!0}}createOrRecycleRecvMedia(v,w,R,O,D,G){const j=v._mediaStreamTrack.kind,W=this.rtpCapabilities.recv,Q=Yw(j,W,this.localCapabilities.send,j===bt.VIDEO?O:D),ee=j===bt.VIDEO?W.videoExtensions:W.audioExtensions;this.currentMidIndex+=1;const fe="".concat(this.currentMidIndex);let ye={media:{mediaType:j,port:eT,protos:["UDP","TLS","RTP","SAVPF"],fmts:Q.map(_e=>_e.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:ee,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:w,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:Q,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:R,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(fe)}};ye=this.mungRecvMediaDsec(ye,v,G);const Ee=this.findFirstClosedMedia(j);if(Ee){const _e=this.sessionDesc.mediaDescriptions.indexOf(Ee);this.sessionDesc.mediaDescriptions[_e]=ye}else this.sessionDesc.mediaDescriptions.push(ye);return ye}updateRemoteCodec(v,w,R){const O=[...new Set(this._rtpCapabilities.recv.videoCodecs.map(ye=>ye.rtpMap&&ye.rtpMap.encodingName.toLowerCase()||"").filter(ye=>{var Ee;return lt(Ee=Object.keys(dP)).call(Ee,ye)}))],D=new Set(w);if(O.every(ye=>D.has(ye)))return x.debug("codecs has not changed, no need to updateRemoteCodec, codecs: ".concat(w)),!1;const G=this._rtpCapabilities.recv.videoCodecs.filter(ye=>w.some(Ee=>{var _e;return lt(_e=ye.rtpMap&&ye.rtpMap.encodingName.toLowerCase()||"").call(_e,Ee)}));if(G.length===0)return x.debug("updateRemoteCodec failed, because cannot find matched codec, remoteCapabilities codecs: ".concat(O," codecs: ").concat(w)),!1;const j=[...new Set(G.map(ye=>ye.rtpMap&&ye.rtpMap.encodingName.toLowerCase()||""))];let W;if(x.debug("updateRemoteCodec, from ".concat(O," to ").concat(j)),v.length===0)W=this.sessionDesc.mediaDescriptions.filter(ye=>ye.media.mediaType==="video"&&ye.attributes.direction==="recvonly");else if(W=this.sessionDesc.mediaDescriptions.filter(ye=>ye.attributes.mid&&lt(v).call(v,ye.attributes.mid)&&ye.attributes.direction==="recvonly"),W.length!==v.length)return x.debug("updateRemoteCodec failed, because cannot find mids, mids: ".concat(v,", codecs: ").concat(w)),!1;if(oe("USE_PUB_RTX")||oe("USE_SUB_RTX")){const ye=b2(G,this.rtpCapabilities.recv.videoCodecs);G.push(...ye)}this._rtpCapabilities.recv.videoCodecs=G;const Q=this.localCapabilities.send,ee=this.rtpCapabilities.recv,fe=Yw(bt.VIDEO,ee,Q,R);return W.forEach(ye=>{const Ee=fe.map(_e=>_e.payloadType.toString(10));x.debug("updateRemoteCodec mid: ".concat(ye.attributes.mid,", from"),ye.attributes.payloads,"to",fe),ye.attributes.payloads=fe,ye.media.fmts=Ee}),!0}createOrRecycleSendMedia(v,w,R,O,D){const G=this.rtpCapabilities.send,j=v===bt.VIDEO?G.videoCodecs:G.audioCodecs,W=v===bt.VIDEO?G.videoExtensions:G.audioExtensions;this.currentMidIndex+=1;const Q="".concat(this.currentMidIndex);let ee={media:{mediaType:v,port:eT,protos:["UDP","TLS","RTP","SAVPF"],fmts:j.map(ye=>ye.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:W,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:w,ssrcGroups:R,rtcpFeedbackWildcards:[],payloads:j,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:O,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(Q)}};ee=this.mungSendMediaDesc(ee,D);const fe=this.findFirstClosedMedia(v);if(fe){const ye=this.sessionDesc.mediaDescriptions.indexOf(fe);this.sessionDesc.mediaDescriptions[ye]=ee}else this.sessionDesc.mediaDescriptions.push(ee);return ee}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(v=>v.media.port!=="0").map(v=>v.attributes.mid)}mungRecvMediaDsec(v,w,R){const O=qr(v);return v2(O),_S(O,w),S2(O,w),QH(O),UP(O,R,this.localCapabilities.send),O}mungSendMediaDesc(v,w){const R=qr(v);return UP(R,w,this.localCapabilities.recv),yS(R),R}updateRecvMedia(v,w){const R=this.sessionDesc.mediaDescriptions.findIndex(O=>O.attributes.mid===v);if(R!==-1){const O=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[R],w);this.sessionDesc.mediaDescriptions[R]=O}}bumpMid(v){this.currentMidIndex+=v}findFirstClosedMedia(v){return this.sessionDesc.mediaDescriptions.find(w=>Hr()?w.media.port==="0"&&w.media.mediaType===v:w.media.port==="0")}findPreloadMediaDesc(v){return this.sessionDesc.mediaDescriptions.find(w=>{var R;return((R=w.attributes)===null||R===void 0||(R=R.ssrcs[0])===null||R===void 0?void 0:R.ssrcId)===v[0].ssrcId})}getSSRC(v){var w;return(w=this.sessionDesc.mediaDescriptions.find(R=>R.attributes.mid===v))===null||w===void 0?void 0:w.attributes.ssrcs}}(Ud(Ud({},r),{},{localCapabilities:this.localCapabilities}),this.supportAV1RtpSpec),r.preallocation&&(this.isPreallocation=!0),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);const c=this.remoteSDP.toString(),d=n9(this.initialOffer.sdp,this.extension),h=this.logSDPExchange(d||"","offer","local","connect");this.store.descriptionStart(),await this.peerConnection.setLocalDescription({type:"offer",sdp:d}),h==null||h(c),await this.peerConnection.setRemoteDescription({type:"answer",sdp:c});const m=this.peerConnection.getTransceivers()[0];if(m!=null&&m.receiver&&this.tryBindTransportEvents(m.receiver),oe("PRELOAD_MEDIA_COUNT")>0){this.remoteSDP.preloadRemoteMedia(oe("PRELOAD_MEDIA_COUNT"));const v=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:v});const w=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(w)}const{preSSRCs:y}=r;if(Array.isArray(y)&&y.length>0){const{mids:v}=this.remoteSDP.batchSend(y.map(w=>({kind:w.kind,ssrcMsg:[{ssrcId:w.ssrcId,rtx:w.rtx}],mslabel:w.mslabel})));v.forEach((w,R)=>{this.preSSRCMap.set(y[R].ssrcId,w)}),await Xw(this.peerConnection,this.remoteSDP,this.extension),x.debug("[".concat(this.store.clientId,"] [P2PConnection] pre-batchReceive exchange SDP."))}}catch(c){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(c.toString()))}var s,a}async updateRemoteConnect(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateRemoteConnect before remote SDP created");const{rtpCapabilities:s}=r;this.remoteSDP.updateRemoteRTPCapabilities(s),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);const{preSSRCs:a}=r;if(Array.isArray(a)&&a.length>0){const{mids:c}=this.remoteSDP.batchSend(a.map(d=>Object.assign({},{kind:d.kind,ssrcMsg:[{ssrcId:d.ssrcId,rtx:d.rtx}],mslabel:d.mslabel})));c.forEach((d,h)=>{this.preSSRCMap.set(a[h].ssrcId,d)})}await Xw(this.peerConnection,this.remoteSDP,this.extension),x.debug("[P2PConnection] updateRemoteRTPCapabilities by exchanging SDP.")}catch(s){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.updateRemoteConnect failed; ".concat(s.toString()))}}send(r,s,a){var c=this;return Ll(function*(){const d=yield xn(c.mutex.lock("From P2PConnection.send"));try{if(!c.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const h=[],m=xP();r.forEach(W=>{const Q=c.peerConnection.addTransceiver(W._mediaStreamTrack,Ud({direction:"sendonly"},W.trackMediaType==="video"&&c.supportAV1RtpSpec&&m?{sendEncodings:[{scalabilityMode:m}]}:{}));h.push(Q),W._updateRtpTransceiver(Q)}),Hr()&&oe("SIMULCAST")===!0&&(yield xn(c.applySimulcastForFirefox(h,r)));const y=yield xn(c.peerConnection.createOffer()),v=c.remoteSDP.predictReceivingMids(r.length),w=c.mungSendOfferSDP(y.sdp,r,v),R=Xa(w),O=v.map(W=>{const Q=R.mediaDescriptions.find(ee=>ee.attributes.mid===W);if(!Q)throw new Error("Cannot extract ssrc from mediaDescription.");return YH(Q,oe("USE_PUB_RTX"))});let D;try{D=yield O}catch(W){D=[],c.remoteSDP.receive(r,s,a,D);const Q=c.remoteSDP.toString();throw yield xn(c.peerConnection.setLocalDescription({type:"offer",sdp:w})),yield xn(c.peerConnection.setRemoteDescription({type:"answer",sdp:Q})),yield xn(c.stopSending(v,!0)),W}c.remoteSDP.receive(r,s,a,D);const G=c.remoteSDP.toString(),j=c.logSDPExchange(w,"offer","local","send");return yield xn(c.peerConnection.setLocalDescription({type:"offer",sdp:w})),yield xn(c.applySimulcastEncodings(h,r)),yield xn(c.applySendEncodings(h,r)),j==null||j(G),yield xn(c.peerConnection.setRemoteDescription({type:"answer",sdp:G})),h.map((W,Q)=>{const ee=v[Q];return{localSSRC:O[Q],id:ee,transceiver:W}})}catch(h){throw h instanceof Le?h:new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(h.toString()))}finally{d()}})()}async createDataChannels(r,s){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.createDataChannels before remote SDP created");let a=this.dataStreamChannelMap.get(r);if(a&&a.readyState==="open")x.debug("[P2PConnection] Channels are already available and can be reused directly.");else{const d=this.currentDataChannelId<1023?this.currentDataChannelId++:this.recoveredDataChannelIds.shift();if(typeof d!="number")throw new Error("create DataChannel error, because cannot get dc id");a=this.peerConnection.createDataChannel("datastream-channel",{id:d,negotiated:!0,ordered:!1,maxRetransmits:oe("DATASTREAM_MAX_RETRANSMITS")}),a.binaryType="arraybuffer",this.dataStreamChannelMap.set(r,a)}s.forEach(d=>{d._updateOriginDataChannel(a)});const{needExchangeSDP:c}=this.remoteSDP.sendDataChannel();if(c){const d=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:d});const h=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(h),x.debug("[P2PConnection] createDataChannels by exchanging SDP.")}else x.debug("[P2PConnection] createDataChannels no need to exchange SDP.");return}catch(a){throw a instanceof Le?a:new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.createDataChannels failed; ".concat(a.toString()))}}async stopDataChannels(r){try{const s=this.dataStreamChannelMap.get(r);return s&&(s.id&&this.recoveredDataChannelIds.push(s.id),s.close()),void this.dataStreamChannelMap.delete(r)}catch(s){throw s instanceof Le?s:new Le(te.DATACHANNEL_FAILED,"P2PConnection.stopDataChannels failed; ".concat(s.toString()))}}async stopSending(r,s){const a=s?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const c=this.peerConnection.getTransceivers().filter(y=>r.indexOf(y.mid)!==-1);if(c.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");c.map(y=>{var v;HP(this.id+y.mid,this),y.direction="inactive",(v=y.stop)===null||v===void 0||v.call(y)});const d=await this.peerConnection.createOffer(),h=this.logSDPExchange(d.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(d),this.remoteSDP.stopReceiving(r);const m=this.remoteSDP.toString();h==null||h(m),await this.peerConnection.setRemoteDescription({type:"answer",sdp:m})}catch(c){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(c.toString()))}finally{a&&a()}}async receive(r,s,a,c){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(r," before remoteSDP created."));const{mid:d,needExchangeSDP:h}=this.remoteSDP.send(r,s,a,c);h&&(await Xw(this.peerConnection,this.remoteSDP,this.extension),x.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(r," by exchanging SDP.")));const m=this.peerConnection.getTransceivers().find(y=>y.mid===d);if(!m)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:m.receiver.track,id:d,transceiver:m}}catch(d){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(d.toString()))}}async batchReceive(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const{mids:s,needExchangeSDP:a}=this.remoteSDP.batchSend(r);return a&&(await Xw(this.peerConnection,this.remoteSDP,this.extension),x.debug("[".concat(this.store.clientId,"] [P2PConnection] batchReceive by exchanging SDP."))),s.map(c=>{const d=this.peerConnection.getTransceivers().find(h=>h.mid===c);if(!d)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:d.receiver.track,id:c,transceiver:d}})}catch(s){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(s.toString()))}}async stopReceiving(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");r.forEach(d=>{Array.from(this.preSSRCMap.entries()).some(h=>{let[m,y]=h;if(y===d)return this.preSSRCMap.delete(m),!0})}),this.remoteSDP.stopSending(r);const s=this.remoteSDP.toString(),a=this.logSDPExchange(s,"offer","remote","stopReceiving");await this.peerConnection.setRemoteDescription({type:"offer",sdp:s});const c=await this.peerConnection.createAnswer();a==null||a(c.sdp||""),await this.peerConnection.setLocalDescription(c)}catch(s){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(s.toString()))}}async muteRemote(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteRemote mid=".concat(r," before remote SDP created."));this.remoteSDP.mute(r);const s=this.remoteSDP.toString(),a=this.logSDPExchange(s,"offer","remote","muteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:s});const c=await this.peerConnection.createAnswer();a==null||a(c.sdp||""),await this.peerConnection.setLocalDescription(c)}catch(s){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.muteRemote failed; ".concat(s.toString()))}}async unmuteRemote(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteRemote mid=".concat(r," before remote SDP created."));this.remoteSDP.unmute(r);const s=this.remoteSDP.toString(),a=this.logSDPExchange(s,"offer","remote","unmuteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:s});const c=await this.peerConnection.createAnswer();a==null||a(c.sdp||""),await this.peerConnection.setLocalDescription(c)}catch(s){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteRemote failed; ".concat(s.toString()))}}async muteLocal(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const s=this.peerConnection.getTransceivers().filter(h=>h.mid&&r.indexOf(h.mid)!==-1);if(s.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length.");s.map(h=>{h.direction="inactive"});const a=await this.peerConnection.createOffer(),c=this.logSDPExchange(a.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(a),this.remoteSDP.muteRemote(r);const d=this.remoteSDP.toString();c==null||c(d),await this.peerConnection.setRemoteDescription({type:"answer",sdp:d})}catch(s){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(s.toString()))}}async unmuteLocal(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const s=this.peerConnection.getTransceivers().filter(h=>h.mid&&r.indexOf(h.mid)!==-1);if(s.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length.");s.map(async(h,m)=>{h.direction="sendonly"});const a=await this.peerConnection.createOffer(),c=this.logSDPExchange(a.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(a),this.remoteSDP.unmuteRemote(r),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec(r,this.remoteCodecs,this.store.codec);const d=this.remoteSDP.toString();c==null||c(d),await this.peerConnection.setRemoteDescription({type:"answer",sdp:d})}catch(s){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(s.toString()))}}restartICE(r){var s=this;return Ll(function*(){const a=yield xn(s.mutex.lock("From P2PConnection.restartICE"));try{if(!s.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");const c=Wn().supportPCSetConfiguration,d=oe("FORCE_TURN_TCP")||s.forceTurn;if(r===Qs.RELAY&&!c)return;if(c&&!d){const R=r===Qs.RELAY?"relay":"all",O=s.peerConnection.getConfiguration();O.iceTransportPolicy!==R&&(x.debug("[".concat(s.store.clientId,"] restartICE change iceTransportPolicy from [").concat(O.iceTransportPolicy,"] to [").concat(R,"]")),O.iceTransportPolicy=R,s.peerConnection.setConfiguration(O))}s.remoteSDP.updateCandidates(r);const h=yield xn(s.peerConnection.createOffer({iceRestart:!0}));if(!h.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const m=rg(h.sdp),{remoteIceParameters:y}=yield m.iceParameters;s.remoteSDP.restartICE(y);const v=s.remoteSDP.toString(),w=s.logSDPExchange(h.sdp||"","offer","local","restartICE");s.store.descriptionStart(),yield xn(s.peerConnection.setLocalDescription(h)),w==null||w(v),yield xn(s.peerConnection.setRemoteDescription({type:"answer",sdp:v}))}catch(c){x.warning("[".concat(s.store.clientId,"] restart ICE failed, abort operation"),c)}finally{a()}})()}async extendCandidate(){if(!this.remoteSDP||this.isFirstConnected)return;const r=await this.mutex.lock("From P2PConnection.extendCandidate");try{this.remoteSDP.updateCandidates(Qs.TCP_RELAY),await Xw(this.peerConnection,this.remoteSDP,this.extension)}catch(s){x.warning("[".concat(this.store.clientId,"] extend candidate failed, abort operation"),s)}finally{r()}}close(){var r;this.peerConnection.getTransceivers().forEach(s=>{HP(this.id+s.mid,this)}),this.preSSRCMap.clear(),this.peerConnection.close(),(r=this.onConnectionStateChange)===null||r===void 0||r.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy(),this.dataStreamChannelMap.clear(),this.recoveredDataChannelIds=[],this.currentDataChannelId=1}getStats(){return Ud(Ud({},this.statsFilter.getStats()),{},{qualityLimitationReason:this.qualityLimitationReason})}getRemoteVideoIsReady(r){return this.statsFilter.getVideoIsReady(r)}async updateEncoderConfig(r,s){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const a=await this.peerConnection.createOffer(),c=this.mungSendOfferSDP(a.sdp,[s],[r]);this.remoteSDP.updateRecvMedia(r,s);const d=this.remoteSDP.toString(),h=this.logSDPExchange(c,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:c}),h==null||h(d),await this.peerConnection.setRemoteDescription({type:"answer",sdp:d})}catch(a){throw new Le(te.EXCHANGE_SDP_FAILED,a.toString())}}async updateSendParameters(r,s){const a=this.peerConnection.getTransceivers().filter(c=>c.mid===r);a.length===1&&(this.isVP8Simulcast(s)?Hr()||await this.applySimulcastEncodings(a,[s]):await this.applySendEncodings(a,[s]))}setStatsRemoteVideoIsReady(r,s){this.statsFilter.setVideoIsReady2(r,s)}async replaceTrack(r,s){const a=this.peerConnection.getTransceivers().find(c=>c.mid===s);a&&await a.sender.replaceTrack(r._mediaStreamTrack)}async getSelectedCandidatePair(){const r=this.peerConnection.getReceivers();if(r.length>0&&r[0].transport&&r[0].transport.iceTransport&&r[0].transport.iceTransport.getSelectedCandidatePair&&r[0].transport.iceTransport.getSelectedCandidatePair()){const s=r[0].transport.iceTransport,{local:a,remote:c}=s.getSelectedCandidatePair();return{local:Ud(Ud({},Nh),{},{candidateType:a.type,protocol:a.protocol,address:a.address,port:a.port}),remote:Ud(Ud({},Nh),{},{candidateType:c.type,protocol:c.protocol,address:c.address,port:c.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var r;(r=this.onICEConnectionStateChange)===null||r===void 0||r.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var r;this.peerConnection.connectionState==="connected"&&(this.isFirstConnected=!0),(r=this.onConnectionStateChange)===null||r===void 0||r.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidateerror=r=>{if(r&&(r.errorCode||r.errorText)){var s;const a="code: ".concat(r.errorCode,", message: ").concat(r.errorText),c=r.port?"local: ".concat(r.port):"";x.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICECandidateError(").concat(a,"), url: ").concat(r.url||"",", host_candidate:").concat(c)),(s=this.onICECandidateError)===null||s===void 0||s.call(this,a)}},this.peerConnection.onicegatheringstatechange=r=>{r&&r.target&&"iceGatheringState"in r.target&&x.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] RTCPeerConnection.onicegatheringstatechange(").concat(r.target.iceGatheringState,")"))},this.peerConnection.onicecandidate=r=>{r.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,x.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,x.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},oe("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(r){const s={iceServers:[]};return r.iceServers?s.iceServers=r.iceServers:r.turnServer&&(Lw(r.turnServer.servers)?s.iceServers=r.turnServer.servers:oe("NEW_TURN_MODE")&&s.iceServers?(oe("USE_TURN_SERVER_OF_GATEWAY")?r.turnServer.serversFromGateway&&s.iceServers.push(...Ay.newTurnServerConfigToIceServers(r.turnServer.serversFromGateway)):s.iceServers.push(...Ay.newTurnServerConfigToIceServers(r.turnServer.servers)),oe("NEW_FORCE_TURN")&&(s.iceTransportPolicy="relay")):r.turnServer.mode!=="off"&&(s.iceServers&&s.iceServers.push(...Ay.turnServerConfigToIceServers(r.turnServer.servers)),oe("USE_TURN_SERVER_OF_GATEWAY")&&s.iceServers&&r.turnServer.serversFromGateway&&s.iceServers.push(...Ay.turnServerConfigToIceServers(r.turnServer.serversFromGateway)),oe("FORCE_TURN_TCP")?s.iceTransportPolicy="relay":r.turnServer.servers.concat(r.turnServer.serversFromGateway||[]).forEach(a=>{a.forceturn&&(s.iceTransportPolicy="relay")}))),oe("ENABLE_ENCODED_TRANSFORM")&&Wn().supportWebRTCEncodedTransform&&(s.encodedInsertableStreams=!0),s}static turnServerConfigToIceServers(r){const s=[];return r.forEach(a=>{a.security?a.tcpport&&s.push({username:a.username,credential:a.password,credentialType:"password",urls:"turns:".concat(tg(a.turnServerURL),":").concat(a.tcpport,"?transport=tcp")}):(a.udpport&&!oe("FORCE_TURN_TCP")&&s.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":").concat(a.udpport,"?transport=udp")}),a.tcpport&&s.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":").concat(a.tcpport,"?transport=tcp")}))}),s}static newTurnServerConfigToIceServers(r){const s=[];return r.forEach(a=>{const c=oe("NEW_TURN_MODE");c===1?s.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":3478?transport=udp")}):c===2?s.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":3478?transport=tcp")}):c===3?s.push({username:a.username,credential:a.password,credentialType:"password",urls:"turns:".concat(tg(a.turnServerURL),":443?transport=tcp")}):c===4&&(s.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":3478?transport=udp")}),s.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":3478?transport=tcp")}),s.push({username:a.username,credential:a.password,credentialType:"password",urls:"turns:".concat(tg(a.turnServerURL),":443?transport=tcp")}))}),s}tryBindTransportEvents(r){const s=r.transport;if(s){this.transportEventReceiver=r,s.onstatechange=()=>{var c;s!=null&&s.state&&((c=this.onDTLSTransportStateChange)===null||c===void 0||c.call(this,s.state))},s.onerror=c=>{var d;(d=this.onDTLSTransportError)===null||d===void 0||d.call(this,"error"in c?c.error:c)};const a=s.iceTransport;a&&(a.onstatechange=()=>{const c=s==null?void 0:s.iceTransport.state;var d;c&&((d=this.onICETransportStateChange)===null||d===void 0||d.call(this,c))},a.getSelectedCandidatePair&&(a.onselectedcandidatepairchange=()=>{if(a.getSelectedCandidatePair()){const{local:c,remote:d}=a.getSelectedCandidatePair();x.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:c.type,protocol:c.protocol}),", remote ").concat(JSON.stringify({candidateType:d.type,protocol:d.protocol,address:d.address,port:d.port})," )"))}}))}}tryUnbindTransportEvents(){this.transportEventReceiver&&this.transportEventReceiver.transport&&(this.transportEventReceiver.transport.onstatechange=null,this.transportEventReceiver.transport.onerror=null,this.transportEventReceiver.transport.iceTransport&&(this.transportEventReceiver.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(r,s){var a,c;if(s||(s=this.peerConnection.getSenders().find(W=>W.track===r._mediaStreamTrack)),!s)return x.warn("[".concat(r.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(r))return x.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!Wn().supportSetRtpSenderParameters)return x.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const d={},h={};switch(r._optimizationMode){case"motion":d.degradationPreference="maintain-framerate";break;case"detail":d.degradationPreference="maintain-resolution";break;case"balanced":d.degradationPreference="balanced"}const m=function(j,W){return j.getTransceivers().find(Q=>Q.sender.track===W||Q.receiver.track===W)}(this.peerConnection,r._mediaStreamTrack),y=Ume(r);if(Xge(r)&&m&&s&&y&&this.getLocalVideoStats&&lt(a=["vp8","vp9"]).call(a,this.store.codec)){var v;const j=d.degradationPreference||(lt(v=r._hints).call(v,gr.CUSTOM_TRACK)?oe("CUSTOM_ADAPTATION_DEFAULT_MODE"):"maintain-framerate");(function(W,Q,ee,fe,ye,Ee){if(HP(W,ee),ye(Q),fe!=="balanced"&&fe!=="maintain-framerate"&&fe!=="maintain-resolution")return;let _e=-1;k9(W,Q);const Ne=window.setInterval(()=>{const ft=GP.get(W);if(!oe("ENABLE_AG_ADAPTATION")||!ft)return HP(W,ee),void ye(Q);const yt=Ee();if(yt.sendPackets>0&&yt.OutgoingAvailableBandwidth>0){if(_e===-1)return void(_e=Date.now());if(Date.now()-_e<1e3)return;const An=yt.sendFrameRate,Pn=yt.OutgoingAvailableBandwidth,[_r,pi]=Yge(W,An,Pn,ft.adaptationConfig,Q,fe);pi&&(ee.qualityLimitationReason=pi),_r&&ft.adaptationConfig.scale!==_r.scale&&(x.debug("[".concat(W,"] applyAdaptation: ").concat(ee.qualityLimitationReason,`
           sendFps `).concat(An,", bwe ").concat(Pn,", switch from ").concat(ft.adaptationConfig.scale," to ").concat(_r.scale," ")),ft.adaptationConfig=D2(D2({},ft.adaptationConfig),_r),ye(_r))}},oe("CHECK_LOCAL_STATS_INTERVAL")),Ze=D2({},Q);GP.set(W,{timer:Ne,adaptationConfig:Ze,originConfig:Q,adaptationFunc:ye}),x.debug("[".concat(W,"] start adaptation, originConfig: ").concat(JSON.stringify(Q),", degradationPreference: ").concat(fe))})(this.id+m.mid,y,this,j,W=>{s&&this.updateAdaptation(s,W)},this.getLocalVideoStats.bind(this))}if(r._encoderConfig){var w;const{bitrateMax:j,frameRate:W,scaleResolutionDownBy:Q}=r._encoderConfig;j&&(h.maxBitrate=1e3*j),(lt(w=r._hints).call(w,gr.LOW_STREAM)||r.isUseScaleResolutionDownBy)&&(W&&(h.maxFramerate=Ic(W)),Q&&Q>=1&&(h.scaleResolutionDownBy=Q))}const{maxFramerate:R}=oe("ENCODER_CONFIG_LIMIT");if(R&&typeof R=="number"&&(h.maxFramerate=h.maxFramerate?Math.min(h.maxFramerate,R):R),oe("DSCP_TYPE")&&pf()){var O;const j=oe("DSCP_TYPE");lt(O=["very-low","low","medium","high"]).call(O,j)&&(h.networkPriority=j)}const D=s.getParameters(),G=(c=D.encodings)===null||c===void 0?void 0:c[0];Hr()&&!G&&(d.encodings=[h]),G&&Object.assign(G,h),Object.assign(D,d),x.debug("[".concat(r.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(D.encodings))),await s.setParameters(D),await async function(j,W,Q){try{var ee;if(!Wn().supportSetRtpSenderParameters||!function(Ne){return Ne==="vp9"||Ne==="av1"}(j)||!oe("ENABLE_SVC"))return;const fe={},ye={},Ee=W.getParameters(),_e=(ee=Ee.encodings)===null||ee===void 0?void 0:ee[0];ye.scalabilityMode=xP(Q),_e&&Object.assign(_e,ye),Object.assign(Ee,fe),await W.setParameters(Ee),x.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode success: ".concat(JSON.stringify(Ee.encodings)))}catch(fe){x.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode failed",fe)}}(this.store.codec,s,oe("SVC_MODE"))}async updateAdaptation(r,s){var a,c;if(!r)return x.debug("[updateAdaptation] no rtpSender found");if(!Wn().supportSetRtpSenderParameters)return x.debug("[updateAdaptation] Browser not support set rtp-sender parameters");const d={},{bitrateMax:h,frameRate:m,scaleResolutionDownBy:y}=s;h&&(d.maxBitrate=1e3*h),m&&(d.maxFramerate=Ic(m)),y&&y>=1&&lt(a=["vp8","vp9"]).call(a,this.store.codec)&&(d.scaleResolutionDownBy=y);const v=r.getParameters(),w=(c=v.encodings)===null||c===void 0?void 0:c[0];w&&Object.assign(w,d),Object.assign(v,{});try{await r.setParameters(v),x.debug("[updateAdaptation] updateRtpSenderEncodings: ".concat(JSON.stringify(v.encodings)))}catch(R){!("transport"in r)||r.transport&&r.transport.state==="connected"?this.peerConnectionState!=="connected"?x.debug("[updateAdaptation] peerConnection not connected}"):x.debug("[updateAdaptation] updateRtpSenderEncodings failed",R):x.debug("[updateAdaptation] rtpSender transport not connected}")}}async applySendEncodings(r,s){try{if(!Wn().supportSetRtpSenderParameters||r.length!==s.length)return;for(let a=0;a<r.length;a++){const c=r[a],d=s[a];d instanceof Ir&&!this.isVP8Simulcast(d)&&await this.updateRtpSenderEncodings(d,c.sender)}}catch{x.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(r,s,a){const c=Xa(r);return s.forEach((d,h)=>{const m=a[h],y=c.mediaDescriptions.find(v=>v.attributes.mid===m);y&&(_S(y,d),ZH(y,d,this.store.codec))}),Qm(c)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=r=>{var s;(s=this.onFirstAudioReceived)===null||s===void 0||s.call(this,r)},this.statsFilter.onFirstVideoReceived=r=>{var s;(s=this.onFirstVideoReceived)===null||s===void 0||s.call(this,r)},this.statsFilter.onFirstAudioDecoded=r=>{var s;(s=this.onFirstAudioDecoded)===null||s===void 0||s.call(this,r)},this.statsFilter.onFirstVideoDecoded=(r,s,a)=>{var c;(c=this.onFirstVideoDecoded)===null||c===void 0||c.call(this,r,s,a)},this.statsFilter.onSelectedLocalCandidateChanged=(r,s)=>{var a;(a=this.onSelectedLocalCandidateChanged)===null||a===void 0||a.call(this,r,s)},this.statsFilter.onSelectedRemoteCandidateChanged=(r,s)=>{var a;(a=this.onSelectedRemoteCandidateChanged)===null||a===void 0||a.call(this,r,s)},this.statsFilter.onFirstVideoDecodedTimeout=r=>{var s;(s=this.onFirstVideoDecodedTimeout)===null||s===void 0||s.call(this,r)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(r,s){if(r.length===s.length)for(let y=0;y<r.length;y++){var a,c,d,h,m;const v=r[y],w=s[y];if(w instanceof Ir&&!lt(a=w._hints).call(a,gr.LOW_STREAM)&&(c=w._encoderConfig)!==null&&c!==void 0&&c.bitrateMax&&((d=w._encoderConfig)===null||d===void 0?void 0:d.bitrateMax)>200&&(h=w._scalabilityMode)!==null&&h!==void 0&&h.numSpatialLayers&&((m=w._scalabilityMode)===null||m===void 0?void 0:m.numSpatialLayers)>1&&this.store.codec==="vp8"){const R={},O={high:1e3*(w._encoderConfig.bitrateMax-50),medium:5e4};R.encodings=[{rid:"m",active:!0,maxBitrate:O.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:O.high}];const D=v.sender.getParameters();await v.sender.setParameters(Object.assign(D,R))}}}async applySimulcastEncodings(r,s){if(!Hr()&&r.length===s.length)for(let a=0;a<r.length;a++){const c=s[a];if(c instanceof Ir&&this.isVP8Simulcast(c)){const d=r[a],h={},m={high:1e3*(c._encoderConfig.bitrateMax-50),medium:5e4};h.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:m.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:m.medium,scaleResolutionDownBy:4}];const y=d.sender.getParameters();await d.sender.setParameters(Object.assign(y,h))}}}isVP8Simulcast(r){var s,a,c,d,h;return!!(r instanceof Ir&&oe("SIMULCAST")&&this.store.codec==="vp8"&&!lt(s=r._hints).call(s,gr.LOW_STREAM)&&(a=r._encoderConfig)!==null&&a!==void 0&&a.bitrateMax&&((c=r._encoderConfig)===null||c===void 0?void 0:c.bitrateMax)>200&&(d=r._scalabilityMode)!==null&&d!==void 0&&d.numSpatialLayers&&((h=r._scalabilityMode)===null||h===void 0?void 0:h.numSpatialLayers)>1)}logSDPExchange(r,s,a,c){if(oe("SDP_LOGGING"))return x.upload("[".concat(this.store.clientId,"] exchanging ").concat(a," ").concat(s," SDP during P2PConnection.").concat(c,`
`),r),s==="offer"?d=>{this.logSDPExchange(d,"answer",a==="local"?"remote":"local",c)}:void 0}async getRemoteSSRC(r){if(!this.remoteSDP)return;const s=this.remoteSDP.getSSRC(r);return s&&s.length!==0?s[0].ssrcId:void 0}setConfiguration(r){if(Wn().supportPCSetConfiguration){const s=Ay.resolvePCConfiguration(r);this.peerConnection.setConfiguration(s)}}},At(kn.prototype,"updateRemoteRTPCapabilities",[ba],Object.getOwnPropertyDescriptor(kn.prototype,"updateRemoteRTPCapabilities"),kn.prototype),At(kn.prototype,"connect",[ba],Object.getOwnPropertyDescriptor(kn.prototype,"connect"),kn.prototype),At(kn.prototype,"updateRemoteConnect",[ba],Object.getOwnPropertyDescriptor(kn.prototype,"updateRemoteConnect"),kn.prototype),At(kn.prototype,"createDataChannels",[ba],Object.getOwnPropertyDescriptor(kn.prototype,"createDataChannels"),kn.prototype),At(kn.prototype,"receive",[ba],Object.getOwnPropertyDescriptor(kn.prototype,"receive"),kn.prototype),At(kn.prototype,"batchReceive",[ba],Object.getOwnPropertyDescriptor(kn.prototype,"batchReceive"),kn.prototype),At(kn.prototype,"stopReceiving",[ba],Object.getOwnPropertyDescriptor(kn.prototype,"stopReceiving"),kn.prototype),At(kn.prototype,"muteRemote",[ba],Object.getOwnPropertyDescriptor(kn.prototype,"muteRemote"),kn.prototype),At(kn.prototype,"unmuteRemote",[ba],Object.getOwnPropertyDescriptor(kn.prototype,"unmuteRemote"),kn.prototype),At(kn.prototype,"muteLocal",[ba],Object.getOwnPropertyDescriptor(kn.prototype,"muteLocal"),kn.prototype),At(kn.prototype,"unmuteLocal",[ba],Object.getOwnPropertyDescriptor(kn.prototype,"unmuteLocal"),kn.prototype),At(kn.prototype,"close",[ba],Object.getOwnPropertyDescriptor(kn.prototype,"close"),kn.prototype),At(kn.prototype,"updateEncoderConfig",[ba],Object.getOwnPropertyDescriptor(kn.prototype,"updateEncoderConfig"),kn.prototype),At(kn.prototype,"updateSendParameters",[ba],Object.getOwnPropertyDescriptor(kn.prototype,"updateSendParameters"),kn.prototype),At(kn.prototype,"replaceTrack",[ba],Object.getOwnPropertyDescriptor(kn.prototype,"replaceTrack"),kn.prototype),At(kn.prototype,"updateAdaptation",[ba],Object.getOwnPropertyDescriptor(kn.prototype,"updateAdaptation"),kn.prototype),At(kn.prototype,"getRemoteSSRC",[ba],Object.getOwnPropertyDescriptor(kn.prototype,"getRemoteSSRC"),kn.prototype),kn);function ba(t,r,s){const a=t[r];if(typeof a!="function")throw new Error("Cannot use mutex on object property.");return s.value=async function(){const c=this.mutex,d=await c.lock("From P2PConnection.".concat(r));try{for(var h=arguments.length,m=new Array(h),y=0;y<h;y++)m[y]=arguments[y];return await a.apply(this,m)}finally{d()}},s}function U2(t,r){let s=document.createElement("video"),a=document.createElement("canvas");s.setAttribute("style","display:none"),a.setAttribute("style","display:none"),s.setAttribute("muted",""),s.muted=!0,s.setAttribute("autoplay",""),s.autoplay=!0,s.setAttribute("playsinline",""),a.width=Ic(r.width),a.height=Ic(r.height);const c=Ic(r.framerate||15);document.body.append(s),document.body.append(a);let d=t._mediaStreamTrack;s.srcObject=new MediaStream([d]),s.play();const h=a.getContext("2d");if(!h)throw new Ae(te.UNEXPECTED_ERROR,"can not get canvas context");const m=Wn(),y=a.captureStream(m.supportRequestFrame?0:c).getVideoTracks()[0];y.canvas||(y.canvas=a),a.startCapture=()=>{if(!s)return a.stopCapture&&a.stopCapture();if(s.paused&&s.play(),s.videoHeight>2&&s.videoWidth>2){const w=s.videoWidth,R=s.videoHeight/w,O=a.width*R;Math.abs(O-a.height)>=2&&(x.debug("adjust low stream resolution","".concat(a.width,"x").concat(a.height," -> ").concat(a.width,"x").concat(O)),a.height=O)}h.drawImage(s,0,0,a.width,a.height),y.requestFrame&&y.requestFrame(),d!==t._mediaStreamTrack&&(d=t._mediaStreamTrack,s.srcObject=new MediaStream([d]))},a.stopCapture=qL(()=>a.startCapture&&a.startCapture(),c);const v=y.stop;return y.stop=()=>{v.call(y),s&&(s.remove(),s.srcObject=null,s=null),a&&(a.width=0,a.remove(),a.stopCapture&&a.stopCapture(),a.startCapture=void 0,a.stopCapture=void 0,a=null),x.debug("clean low stream renderer")},y}var KP=function(t){return t[t.HEIGHT=2033]="HEIGHT",t[t.FRAME_RATE=2034]="FRAME_RATE",t[t.WIDTH=2035]="WIDTH",t}(KP||{}),wi=function(t){return t[t.FRAME_RATE=2002]="FRAME_RATE",t[t.WIDTH=2003]="WIDTH",t[t.HEIGHT=2004]="HEIGHT",t[t.PACKAGE_LOST=2005]="PACKAGE_LOST",t[t.AVG_ENCODE=2007]="AVG_ENCODE",t[t.NACKS=2009]="NACKS",t[t.PLIS=2010]="PLIS",t[t.FIRS=2011]="FIRS",t[t.BITRATE=2012]="BITRATE",t[t.PACKAGE_RATE=2031]="PACKAGE_RATE",t[t.ADAPTATION=2032]="ADAPTATION",t[t.ACTUAL_ENCODED=2060]="ACTUAL_ENCODED",t[t.BANDWIDTH=2061]="BANDWIDTH",t[t.RETRANSMIT=2062]="RETRANSMIT",t[t.TARGET_ENCODED=2064]="TARGET_ENCODED",t[t.TRANSMIT=2066]="TRANSMIT",t[t.FREEZE=2082]="FREEZE",t[t.DISABLED=2095]="DISABLED",t[t.PLAYER_STATUS=2128]="PLAYER_STATUS",t[t.QP_SUM=2143]="QP_SUM",t[t.BYTES_RETRANSMIT=2173]="BYTES_RETRANSMIT",t[t.PACKAGES_RETRANSMIT=2172]="PACKAGES_RETRANSMIT",t[t.HUGE_FRAME_SENT=2174]="HUGE_FRAME_SENT",t[t.KEY_FRAMES_ENCODED=2207]="KEY_FRAMES_ENCODED",t}(wi||{}),cy=function(t){return t[t.BITRATE=2069]="BITRATE",t[t.PACKAGE_LOST=2070]="PACKAGE_LOST",t[t.PACKAGE_RATE=2071]="PACKAGE_RATE",t[t.HEIGHT=2073]="HEIGHT",t[t.FRAME_RATE=2075]="FRAME_RATE",t[t.WIDTH=2077]="WIDTH",t}(cy||{}),Ti=function(t){return t[t.JITTER=-1]="JITTER",t[t.PACKAGE_LOST=2014]="PACKAGE_LOST",t[t.WIDTH=2018]="WIDTH",t[t.HEIGHT=2019]="HEIGHT",t[t.FRAME_RATE=2020]="FRAME_RATE",t[t.JITTER_BUFFER=2023]="JITTER_BUFFER",t[t.CURRENT_DELAY=2024]="CURRENT_DELAY",t[t.NACKS=2026]="NACKS",t[t.PLIS=2027]="PLIS",t[t.FIRS=2028]="FIRS",t[t.BITRATE=2029]="BITRATE",t[t.PACKAGE_RATE=2078]="PACKAGE_RATE",t[t.FREEZE=2084]="FREEZE",t[t.DISABLED=2101]="DISABLED",t[t.PLAYER_STATUS=2129]="PLAYER_STATUS",t[t.QP_SUM=2144]="QP_SUM",t[t.I_FRAME_DELAY=2149]="I_FRAME_DELAY",t[t.FRAMES_DROPPED=2181]="FRAMES_DROPPED",t[t.BYTES_RETRANSMIT=2175]="BYTES_RETRANSMIT",t[t.PACKAGES_RETRANSMIT=2176]="PACKAGES_RETRANSMIT",t[t.PACKAGES_DISCARDED=2198]="PACKAGES_DISCARDED",t[t.AVG_DECODE=2200]="AVG_DECODE",t[t.AVG_PROCESSING_DELAY=2202]="AVG_PROCESSING_DELAY",t[t.AVG_ASSEMBLY_TIME=2203]="AVG_ASSEMBLY_TIME",t[t.AVG_INTER_FRAME_DELAY=2204]="AVG_INTER_FRAME_DELAY",t[t.KEY_FRAMES_DECODED=2206]="KEY_FRAMES_DECODED",t}(Ti||{}),ly=function(t){return t[t.FRAME_RATE_DECODE=2021]="FRAME_RATE_DECODE",t[t.FRAME_RATE_RENDER=2022]="FRAME_RATE_RENDER",t[t.FRAME_RATE_OUTPUT=2155]="FRAME_RATE_OUTPUT",t[t.FREEZE_TIME=2109]="FREEZE_TIME",t[t.FREEZE_TIME_RENDER=2147]="FREEZE_TIME_RENDER",t[t.FREEZE_DURATION=2156]="FREEZE_DURATION",t}(ly||{}),M9=function(t){return t[t.PCM_LEVEL=2104]="PCM_LEVEL",t}(M9||{}),jh=function(t){return t[t.PACKAGE_LOST=-1]="PACKAGE_LOST",t[t.LEVEL=2038]="LEVEL",t[t.BITRATE=2039]="BITRATE",t[t.PACKAGE_RATE=2040]="PACKAGE_RATE",t[t.AEC_RETURN_LOSS=2041]="AEC_RETURN_LOSS",t[t.AEC_RETURN_LOSS_ENH=2042]="AEC_RETURN_LOSS_ENH",t[t.FREEZE=2081]="FREEZE",t[t.DISABLED=2096]="DISABLED",t[t.BYTES_RETRANSMIT=2179]="BYTES_RETRANSMIT",t[t.PACKAGES_RETRANSMIT=2180]="PACKAGES_RETRANSMIT",t}(jh||{}),wa=function(t){return t[t.BITRATE=2044]="BITRATE",t[t.PACKAGE_LOST=2045]="PACKAGE_LOST",t[t.PACKAGE_RATE=2046]="PACKAGE_RATE",t[t.CURRENT_DELAY=2047]="CURRENT_DELAY",t[t.JITTER_BUFFER=2054]="JITTER_BUFFER",t[t.JITTER=2055]="JITTER",t[t.FREEZE=2083]="FREEZE",t[t.DISABLED=2102]="DISABLED",t[t.PCM_LEVEL=2105]="PCM_LEVEL",t[t.PLAYER_STATUS=2130]="PLAYER_STATUS",t[t.CONCEALED_SAMPLES=2148]="CONCEALED_SAMPLES",t[t.BYTES_RETRANSMIT=2178]="BYTES_RETRANSMIT",t[t.PACKAGES_RETRANSMIT=2177]="PACKAGES_RETRANSMIT",t[t.PACKAGES_DISCARDED=2199]="PACKAGES_DISCARDED",t[t.AVG_PROCESSING_DELAY=2201]="AVG_PROCESSING_DELAY",t[t.TOTAL_SAMPLES_RECEIVED=2224]="TOTAL_SAMPLES_RECEIVED",t}(wa||{}),U9=function(t){return t[t.FREEZE_TIME=-1]="FREEZE_TIME",t[t.LEVEL=2043]="LEVEL",t}(U9||{}),Ta=function(t){return t[t.RTT=2006]="RTT",t[t.CONN_TYPE=801]="CONN_TYPE",t[t.STATS_UPDATE_INTERVAL=2205]="STATS_UPDATE_INTERVAL",t}(Ta||{}),qP=function(t){return t[t.RTC_PEER_CONNECTION_STATE=2219]="RTC_PEER_CONNECTION_STATE",t}(qP||{});const uy=1e3,dy=6,YP=3,Zge=Math.max(dy,YP);function qt(t,r,s){s!=null&&Number.isFinite(s)&&(t[r]=Math.round(Math.max(0,s)))}function V9(t){const r={[Ta.CONN_TYPE]:0,[Ta.RTT]:t.rtt,[Ta.STATS_UPDATE_INTERVAL]:t.updateInterval?Math.round(Math.max(0,t.updateInterval)):void 0};switch(t.selectedCandidatePair.localCandidate.candidateType){case"relay":{const s=t.selectedCandidatePair.localCandidate.relayProtocol;s==="udp"&&(r[Ta.CONN_TYPE]=1),s==="tcp"&&(r[Ta.CONN_TYPE]=3),s==="tls"&&(r[Ta.CONN_TYPE]=4);break}case"srflx":r[Ta.CONN_TYPE]=2;break;case"unknown":r[Ta.CONN_TYPE]=5;break;default:r[Ta.CONN_TYPE]=0}return r}function j9(t){let r=0;switch(t){case"none":r=0;break;case"cpu":r=1;break;case"bandwidth":r=2;break;case"other":r=3}return r}class F9 extends Br{constructor(r){super(),q(this,"store",void 0),q(this,"uploadWRTCStatsTimer",void 0),q(this,"uploadOutboundDenoiserStatsTimer",void 0),q(this,"uploadExtStatsTimer",void 0),q(this,"uploadExtUsageStatsTimer",void 0),q(this,"uploadInboundExtStatsTimer",void 0),q(this,"requestStats",void 0),q(this,"requestTransportStats",void 0),q(this,"requestLocalMedia",void 0),q(this,"requestRemoteMedia",void 0),q(this,"requestAllTracks",void 0),q(this,"requestVideoIsReady",void 0),q(this,"requestUploadStats",void 0),q(this,"requestUpload",void 0),q(this,"uploadOutboundStarted",!1),q(this,"uploadInboundStarted",!1),q(this,"uploadTransportStarted",!1),q(this,"uploadBaseStatsStarted",!1),q(this,"uploadExtensionUsageStarted",!1),q(this,"lastRecvStats",void 0),q(this,"lastSendStats",void 0),q(this,"lastRefRecvStats",void 0),q(this,"lastRefSendStats",void 0),q(this,"lastFullRecvStats",void 0),q(this,"lastFullSendStats",void 0),q(this,"needUploadRenderFreezeTime",!0),this.store=r}uploadWRTCStats(r){if(!this.requestStats||!this.requestUploadStats)return;const s=r%YP==0,a=r%dy==0;let c,d;if(this.uploadTransportStarted&&(c=this.requestStats(),this.store.useP2P&&(d=this.requestStats(!0))),!c&&this.uploadOutboundStarted&&(c=this.requestStats()),!d&&this.uploadInboundStarted&&(d=this.requestStats(!0)),c||d){var h;const m={};if(this.uploadTransportStarted&&c){const v=this.getTransportStats(c,d,s);v&&(m.misc=[v])}if(this.uploadOutboundStarted&&c){const v=this.getOutboundStats(c,a?this.lastFullSendStats:s?this.lastRefSendStats:this.lastSendStats,s,a);v&&(m.outbound=[v])}if(this.uploadInboundStarted&&d){const v=this.getInboundStats(d,a?this.lastFullRecvStats:s?this.lastRefRecvStats:this.lastRecvStats,s,a);v&&(m.inbound=v)}const y=(h=this.requestTransportStats)===null||h===void 0?void 0:h.call(this).connectState;y&&(Array.isArray(m.misc)?m.misc[0]&&m.misc[0].addition&&(m.misc[0].addition[qP.RTC_PEER_CONNECTION_STATE]=DL[y]):m.misc=[{addition:{[qP.RTC_PEER_CONNECTION_STATE]:DL[y]}}]),this.requestUploadStats(m)}this.lastRecvStats=d,this.lastSendStats=c,a&&(this.lastFullRecvStats=d,this.lastFullSendStats=c),s&&(this.lastRefRecvStats=d,this.lastRefSendStats=c)}startUploadWRTCStats(){if(this.uploadWRTCStatsTimer)return;this.uploadBaseStatsStarted=!0;let r=1;this.uploadWRTCStatsTimer=window.setInterval(()=>{if(!this.uploadTransportStarted&&!this.uploadInboundStarted&&!this.uploadOutboundStarted){if(this.uploadBaseStatsStarted){var s,a;const c=(s=this.requestTransportStats)===null||s===void 0?void 0:s.call(this);return void(c&&((a=this.requestUploadStats)===null||a===void 0||a.call(this,{misc:[{addition:{[qP.RTC_PEER_CONNECTION_STATE]:DL[c.connectState]}}]})))}return this.stopUploadWRTCStats()}this.uploadWRTCStats(r),++r===Zge+1&&(r=1)},uy)}stopUploadWRTCStats(){window.clearInterval(this.uploadWRTCStatsTimer),this.uploadWRTCStatsTimer=void 0,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0)}getTransportStats(r,s,a){if(!this.requestStats)return;if(!a)return r.rtt==null?void 0:{addition:{[Ta.RTT]:r.rtt,[Ta.CONN_TYPE]:void 0,[Ta.STATS_UPDATE_INTERVAL]:r.updateInterval||void 0}};const c=V9(r);if(this.store.useP2P){if(s){const d=V9(s);c[Ta.CONN_TYPE]+=d[Ta.CONN_TYPE]<<3}c[Ta.CONN_TYPE]+=110}else c[Ta.CONN_TYPE]+=100;return{addition:c}}getOutboundStats(r,s,a,c){if(!this.requestUploadStats||!this.requestLocalMedia)return;const d=this.requestLocalMedia();if(!d||d.length===0)return;let h,m,y;return d.forEach(v=>{let[w,{track:R,ssrcs:O}]=v;switch(w){case Xe.LocalVideoLowTrack:case Xe.LocalVideoTrack:if(w===Xe.LocalVideoTrack){const D=function(W,Q,ee,fe,ye,Ee){const _e=Q.videoSend.find(yt=>yt.ssrc===W);if(!_e)return;const Ne={},{sentFrame:Ze,inputFrame:ft}=_e;if(Ee&&(qt(Ne,wi.QP_SUM,_e.qpSumPerFrame),ft&&Ze)){const yt=ft.frameRate,An=Ze.frameRate;Ne[wi.FREEZE]=function(Pn,_r){let pi=!0;return pi=!(Pn<=5)&&(Pn<=10?_r<3:Pn<=20?_r<4:_r<5),pi}(yt,An)?1:0}if(ye){switch(Ze&&(qt(Ne,wi.HEIGHT,Ze.height),qt(Ne,wi.WIDTH,Ze.width),qt(Ne,wi.FRAME_RATE,Ze.frameRate)),Ne[wi.DISABLED]=fe._originMediaStreamTrack&&!fe._originMediaStreamTrack.enabled||fe._mediaStreamTrack&&!fe._mediaStreamTrack.enabled?1:0,_e.adaptionChangeReason){case"none":Ne[wi.ADAPTATION]=0;break;case"cpu":Ne[wi.ADAPTATION]=1;break;case"bandwidth":Ne[wi.ADAPTATION]=2;break;case"other":Ne[wi.ADAPTATION]=3}let yt=0;_e.adaptionChangeReason&&(yt+=j9(_e.adaptionChangeReason)),Q.qualityLimitationReason&&(yt+=j9(Q.qualityLimitationReason)<<3),Ne[wi.ADAPTATION]=yt,Ne[wi.PLAYER_STATUS]=$L[fe._player?fe._player.videoElementStatus:"uninit"],qt(Ne,wi.NACKS,_e.nacksCount),qt(Ne,wi.PLIS,_e.plisCount),qt(Ne,wi.FIRS,_e.firsCount),qt(Ne,wi.AVG_ENCODE,_e.avgEncodeMs),qt(Ne,wi.HUGE_FRAME_SENT,_e.hugeFramesSent),qt(Ne,wi.BYTES_RETRANSMIT,_e.retransmittedBytesSent),qt(Ne,wi.PACKAGES_RETRANSMIT,_e.retransmittedPacketsSent),qt(Ne,wi.KEY_FRAMES_ENCODED,_e.keyFramesEncoded);const An=ee&&ee.videoSend.find(Pn=>Pn.ssrc===W);if(An){let Pn=ye?uy:uy*dy;An.timestamp&&_e.timestamp&&(Pn=_e.timestamp-An.timestamp),An.packets!=null&&_e.packets!=null&&qt(Ne,wi.PACKAGE_RATE,1e3*(_e.packets-An.packets)/Pn),_e.packetsLost!=null&&An.packetsLost!=null&&qt(Ne,wi.PACKAGE_LOST,_e.packetsLost-An.packetsLost),An.bytes!=null&&_e.bytes!=null&&qt(Ne,wi.BITRATE,8*(_e.bytes-An.bytes)/Pn)}}return Ne}(O[0].ssrcId,r,s,R,a,c),G=R&&function(W,Q,ee,fe){const ye=Q.videoSend.find(_e=>_e.ssrc===W);if(!ye)return null;const Ee={};if(fe){const _e=ye.inputFrame,Ne=_e&&_e.height||ee.videoHeight||0,Ze=_e&&_e.width||ee.videoWidth||0,ft=_e&&_e.frameRate||0;qt(Ee,KP.HEIGHT,Ne),qt(Ee,KP.WIDTH,Ze),qt(Ee,KP.FRAME_RATE,ft)}return Ee}(O[0].ssrcId,r,R,a),j=function(W,Q){const ee={};return Q&&(qt(ee,wi.RETRANSMIT,W.bitrate.retransmit),qt(ee,wi.TARGET_ENCODED,W.bitrate.targetEncoded),qt(ee,wi.ACTUAL_ENCODED,W.bitrate.actualEncoded),qt(ee,wi.TRANSMIT,W.bitrate.transmit),qt(ee,wi.BANDWIDTH,W.sendBandwidth)),ee}(r,a);m=Object.assign({},D,G,j)}else y=function(D,G,j,W){const Q=G.videoSend.find(fe=>fe.ssrc===D);if(!Q)return;const ee={};if(W){const fe=Q.sentFrame;if(fe&&(qt(ee,cy.HEIGHT,fe.height),qt(ee,cy.WIDTH,fe.width),qt(ee,cy.FRAME_RATE,fe.frameRate)),j){const ye=j.videoSend.find(Ee=>Ee.ssrc===D);if(ye){let Ee=uy*dy;ye.timestamp&&Q.timestamp&&(Ee=Q.timestamp-ye.timestamp),ye.packets!=null&&Q.packets!=null&&qt(ee,cy.PACKAGE_RATE,1e3*(Q.packets-ye.packets)/Ee),Q.packetsLost!=null&&ye.packetsLost!=null&&qt(ee,cy.PACKAGE_LOST,Q.packetsLost-ye.packetsLost),ye.bytes!=null&&Q.bytes!=null&&qt(ee,cy.BITRATE,8*(Q.bytes-ye.bytes)/Ee)}}}return ee}(O[0].ssrcId,r,s,a);break;case Xe.LocalAudioTrack:h=R&&function(D,G,j,W,Q){const ee=G.audioSend.find(ye=>ye.ssrc===D);if(!ee)return;const fe={};if(Q){fe[jh.DISABLED]=W._originMediaStreamTrack&&!W._originMediaStreamTrack.enabled||W._mediaStreamTrack&&!W._mediaStreamTrack.enabled?1:0;const ye=100*W._source.getAccurateVolumeLevel(),Ee=ee.inputLevel;if(Ee!=null){const Ne=Math.ceil(50*Math.log10(100*Ee+1));qt(fe,jh.LEVEL,Ne)}qt(fe,M9.PCM_LEVEL,ye),qt(fe,jh.AEC_RETURN_LOSS,ee.aecReturnLoss),qt(fe,jh.AEC_RETURN_LOSS_ENH,ee.aecReturnLossEnhancement),qt(fe,jh.BYTES_RETRANSMIT,ee.retransmittedBytesSent),qt(fe,jh.PACKAGES_RETRANSMIT,ee.retransmittedPacketsSent),fe[jh.FREEZE]=0;const _e=j&&j.audioSend.find(Ne=>Ne.ssrc===D);if(_e){let Ne=uy*dy;_e.timestamp&&ee.timestamp&&(Ne=ee.timestamp-_e.timestamp),_e.bytes!=null&&ee.bytes!=null&&qt(fe,jh.BITRATE,8*(ee.bytes-_e.bytes)/Ne),_e.packets!=null&&ee.packets!=null&&qt(fe,jh.PACKAGE_RATE,1e3*(ee.packets-_e.packets)/Ne)}}return fe}(O[0].ssrcId,r,s,R,a)}}),{high:m,low:y,audio:h}}getInboundStats(r,s,a,c){if(!this.requestRemoteMedia)return;const d=this.requestRemoteMedia()||[],h=[];return d.forEach(m=>{let[y,v]=m;const w={peer:y.uid};if(v.has(bt.VIDEO)&&y.videoTrack){const R=y._videoSSRC&&this.requestVideoIsReady&&this.requestVideoIsReady(y._videoSSRC)||!1,O=y.videoTrack?function(D,G,j,W,Q,ee,fe,ye){const Ee=G.videoRecv.find(Pn=>Pn.ssrc===D);if(!Ee)return;const _e={},{receivedFrame:Ne,outputFrame:Ze,decodeFrameRate:ft}=Ee,yt=j&&j.videoRecv.find(Pn=>Pn.ssrc===D);if(qt(_e,ly.FRAME_RATE_DECODE,ft),Ee.framesRateFirefox&&qt(_e,Ti.FRAME_RATE,Ee.framesRateFirefox),Ne&&qt(_e,Ti.FRAME_RATE,Ne.frameRate),qt(_e,Ti.FRAMES_DROPPED,Ee.framesDroppedCount),qt(_e,Ti.BYTES_RETRANSMIT,Ee.retransmittedBytesReceived),qt(_e,Ti.PACKAGES_RETRANSMIT,Ee.retransmittedPacketsReceived),qt(_e,Ti.PACKAGES_DISCARDED,Ee.packetsDiscarded),qt(_e,Ti.AVG_DECODE,Ee.avgDecodeMs),qt(_e,Ti.AVG_PROCESSING_DELAY,Ee.avgProcessingDelayMs),qt(_e,Ti.AVG_ASSEMBLY_TIME,Ee.avgFramesAssembledFromMultiplePacketsMs),qt(_e,Ti.AVG_INTER_FRAME_DELAY,Ee.avgInterFrameDelayMs),qt(_e,Ti.KEY_FRAMES_DECODED,Ee.keyFramesDecoded),yt){const Pn=G.timestamp-j.timestamp||uy*(ye?dy:fe?YP:1);Ee.packetsLost!=null&&yt.packetsLost!=null&&qt(_e,Ti.PACKAGE_LOST,Ee.packetsLost-yt.packetsLost),yt.bytes!=null&&Ee.bytes!=null&&qt(_e,Ti.BITRATE,8*(Ee.bytes-yt.bytes)/Pn),yt.packets!=null&&Ee.packets!=null&&qt(_e,Ti.PACKAGE_RATE,1e3*(Ee.packets-yt.packets)/Pn)}if(ye&&(qt(_e,Ti.QP_SUM,Ee.qpSumPerFrame),_e[Ti.FREEZE]=Q&&Zw.isRemoteVideoFreeze(W,Ee,yt)?1:0),fe){var An;Ne?(qt(_e,Ti.HEIGHT,Ne.height),qt(_e,Ti.WIDTH,Ne.width)):W&&(qt(_e,Ti.HEIGHT,W._videoHeight||0),qt(_e,Ti.WIDTH,W._videoWidth||0)),Ze&&qt(_e,ly.FRAME_RATE_OUTPUT,Ze.frameRate);const Pn=(An=W._player)===null||An===void 0?void 0:An.rendFrameRate.toFixed(0);if(Pn&&qt(_e,ly.FRAME_RATE_RENDER,+Pn),qt(_e,Ti.JITTER_BUFFER,Ee.jitterBufferMs),qt(_e,Ti.CURRENT_DELAY,Ee.currentDelayMs),qt(_e,Ti.FIRS,Ee.firsCount),qt(_e,Ti.NACKS,Ee.nacksCount),qt(_e,Ti.PLIS,Ee.plisCount),W){_e[Ti.DISABLED]=W._originMediaStreamTrack.enabled&&W._mediaStreamTrack.enabled?0:1;const _r=W._player;if(_r){const{freezeTimeCounterList:pi,renderFreezeAccTime:Zr,videoElementStatus:Ra}=_r;if(pi&&pi.length>0&&qt(_e,ly.FREEZE_TIME,pi.splice(0,1)[0]),ee&&gf.visibility==="visible"&&Ra===Io.PLAYING&&Wn().supportRequestVideoFrameCallback){const ze=Math.min(6e3,Zr);_r.renderFreezeAccTime=Math.max(0,Zr-ze),qt(_e,ly.FREEZE_TIME_RENDER,ze)}if(typeof Ee.totalFreezesDuration=="number"){const ze=yt&&yt.totalFreezesDuration?Ee.totalFreezesDuration-yt.totalFreezesDuration:Ee.totalFreezesDuration;qt(_e,ly.FREEZE_DURATION,1e3*ze)}}}if(_e[Ti.PLAYER_STATUS]=$L[W._player?W._player.videoElementStatus:"uninit"],yt&&Ee.totalInterFrameDelay!==void 0&&Ee.totalSquaredInterFrameDelay!==void 0&&yt.totalInterFrameDelay!==void 0&&yt.totalSquaredInterFrameDelay!==void 0){const _r=Ee.totalInterFrameDelay-yt.totalInterFrameDelay,pi=Ee.totalSquaredInterFrameDelay-yt.totalSquaredInterFrameDelay,Zr=Ee.framesDecodeCount-yt.framesDecodeCount,Ra=_r/Zr*1e3,ze=Math.round(1e3*Math.sqrt((pi-Math.pow(_r,2)/Zr)/Zr));!isNaN(ze)&&Ra+ze>Math.max(3*Ra,Ra+150)&&(_e[Ti.I_FRAME_DELAY]=ze)}}return _e}(y._videoSSRC,r,s,y.videoTrack,R===!0,this.needUploadRenderFreezeTime,a,c):void 0;O&&(w.video=O)}if(v.has(bt.AUDIO)&&y.audioTrack){const R=y.audioTrack?function(O,D,G,j,W,Q){const ee=D.audioRecv.find(_e=>_e.ssrc===O);if(!ee)return;const fe={},ye=G&&G.audioRecv.find(_e=>_e.ssrc===O);if(qt(fe,wa.JITTER,ee.jitterMs),qt(fe,wa.BYTES_RETRANSMIT,ee.retransmittedBytesReceived),qt(fe,wa.PACKAGES_RETRANSMIT,ee.retransmittedPacketsReceived),qt(fe,wa.PACKAGES_DISCARDED,ee.packetsDiscarded),qt(fe,wa.AVG_PROCESSING_DELAY,ee.avgProcessingDelayMs),ye){const _e=D.timestamp-G.timestamp||uy*(Q?dy:W?YP:1);ee.packets!=null&&ye.packets!=null&&qt(fe,wa.PACKAGE_RATE,1e3*(ee.packets-ye.packets)/_e),W&&ye.bytes!=null&&ee.bytes!=null&&qt(fe,wa.BITRATE,8*(ee.bytes-ye.bytes)/_e),ee.packetsLost!=null&&ye.packetsLost!=null&&qt(fe,wa.PACKAGE_LOST,ee.packetsLost-ye.packetsLost)}if(Q){const{receivedFrames:_e,droppedFrames:Ne}=ee;_e!=null&&Ne!=null&&(fe[wa.FREEZE]=(Ee=_e)===0||100*Ne/Ee>20?1:0)}var Ee;if(W){const _e=100*j._source.getAccurateVolumeLevel(),Ne=ee.outputLevel;if(Ne!=null){const Ze=Math.ceil(50*Math.log10(100*Ne+1));qt(fe,U9.LEVEL,Ze)}if(qt(fe,wa.PCM_LEVEL,_e),j&&(fe[wa.DISABLED]=j._originMediaStreamTrack.enabled&&j._mediaStreamTrack.enabled?0:1),qt(fe,wa.JITTER_BUFFER,ee.jitterBufferMs),qt(fe,wa.CURRENT_DELAY,ee.jitterBufferMs),fe[wa.PLAYER_STATUS]=$L[Sa.getPlayerState(j.getTrackId())],ye){const Ze=ee.concealedSamples-ye.concealedSamples;Ze>0&&qt(fe,wa.CONCEALED_SAMPLES,Ze);const ft=ee.totalSamplesReceived-ye.totalSamplesReceived;ft>0&&qt(fe,wa.TOTAL_SAMPLES_RECEIVED,ft)}}return fe}(y._audioSSRC,r,s,y.audioTrack,a,c):void 0;R&&(w.audio=R)}(w.video||w.audio)&&h.push(w)}),this.needUploadRenderFreezeTime=!this.needUploadRenderFreezeTime,h}startUploadTransportStats(){this.uploadTransportStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats()}stopUploadTransportStats(){this.uploadTransportStarted=!1}startUploadOutboundStats(){this.uploadOutboundStarted||(this.uploadOutboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=window.setInterval(()=>{if(!this.requestAllTracks||!this.requestUpload)return;const r=(this.requestAllTracks()||[]).find(s=>s instanceof yP);if(r&&r._external.getDenoiserStats){const s=r._external.getDenoiserStats();s&&this.requestUpload(zw.DENOISER_STATS,s)}},2e3),this.uploadExtStatsTimer&&window.clearInterval(this.uploadExtStatsTimer),this.uploadExtStatsTimer=window.setInterval(()=>{!this.requestAllTracks||!this.requestUpload||this.requestAllTracks().forEach(r=>{r.getProcessorStats().forEach(s=>{this.requestUpload&&this.requestUpload(s.type,s.stats)})})},2e3))}stopUploadOutboundStats(){this.uploadOutboundStarted&&(this.uploadOutboundStarted=!1,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=void 0)}startUploadInboundStats(){this.uploadInboundStarted||(this.uploadInboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadInboundExtStatsTimer&&window.clearInterval(this.uploadInboundExtStatsTimer),this.uploadInboundExtStatsTimer=window.setInterval(()=>{!this.requestUpload||!this.requestRemoteMedia||(this.requestRemoteMedia()||[]).forEach(r=>{let[s,a]=r;a.has(bt.VIDEO)&&s.videoTrack&&s.videoTrack.getProcessorStats().forEach(c=>{this.requestUpload&&this.requestUpload(c.type,c.stats)}),a.has(bt.AUDIO)&&s.audioTrack&&s.audioTrack.getProcessorStats().forEach(c=>{this.requestUpload&&this.requestUpload(c.type,c.stats)})})},2e3))}stopUploadInboundStats(){this.uploadInboundStarted&&(this.uploadInboundStarted=!1,this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0))}startUploadExtensionUsageStats(){if(this.uploadExtensionUsageStarted)return;this.uploadExtensionUsageStarted=!0,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer);const r=new Map;this.uploadExtUsageStatsTimer=window.setInterval(async()=>{const s=Date.now(),a={connectionInterval:oe("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3,details:[],lts:s};let c=[];const d=this.requestAllTracks&&this.requestAllTracks()||[];for(const v of d)!v.muted&&v.enabled&&(c=c.concat(await v.getProcessorUsage()));const h=this.requestRemoteMedia&&this.requestRemoteMedia()||[];for(const[v,w]of h)w.has(bt.VIDEO)&&v.videoTrack&&(c=c.concat(await v.videoTrack.getProcessorUsage())),w.has(bt.AUDIO)&&v.audioTrack&&(c=c.concat(await v.audioTrack.getProcessorUsage()));if(c.length===0)return;a.details=function(v,w){const R={};for(const{id:j,value:W,level:Q,direction:ee}of v){var O;const fe=(O=w.get(j))!==null&&O!==void 0?O:0,ye=W===2?fe+oe("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3:fe;var D,G;w.set(j,ye),R[j]?(W===2&&(R[j].value=W),Q>R[j].level&&(R[j].level=Q),ee==="remote"&&(R[j].remoteUidCount+=1),R[j].totalTs=(D=w.get(j))!==null&&D!==void 0?D:0):R[j]={value:W,level:Q,remoteUidCount:ee==="local"?0:1,totalTs:(G=w.get(j))!==null&&G!==void 0?G:0}}return Object.keys(R).map(j=>{const{level:W,value:Q,totalTs:ee}=R[j];return{id:j,level:W,value:Q,totalTs:ee}})}(c,r);const m=Date.now(),y=m>s?m:s+1;this.requestUpload&&this.requestUpload(zw.EXTENSION_USAGE_STATS,{usageStats:a,sendTs:y})},oe("EXTENSION_USAGE_UPLOAD_INTERVAL"))}stopUploadExtensionUsageStats(){this.uploadExtensionUsageStarted&&(this.uploadExtensionUsageStarted=!1,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer),this.uploadExtUsageStatsTimer=void 0)}stopUploadBaseStats(){this.uploadBaseStatsStarted=!1}}const e_e=oe("ICE_RESTART_INTERVAL");let XP=new Map,bS=new Map,og=[Qs.UDP_TCP_RELAY,Qs.TCP_RELAY,Qs.RELAY],V2=oe("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&Wn().supportPCSetConfiguration;function B9(t){let r=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const s=XP.get(t.id);s&&(window.clearTimeout(s),XP.delete(t.id));const a=bS.get(t.id);r&&a&&a.index===og.length-1&&(x.debug("[".concat(t.id,"] reset ICE restart policy")),bS.delete(t.id))}function W9(t,r,s){if(XP.size===0&&bS.size===0&&(Array.isArray(oe("RESTART_SEQUENCE"))&&oe("RESTART_SEQUENCE").length>0&&!function(m,y){if(m.length!==y.length)return!1;for(let v=0;v<m.length;v+=1){const w=m[v];if(m.filter(R=>R===w).length!==y.filter(R=>R===w).length)return!1}return!0}(og,oe("RESTART_SEQUENCE"))&&(og=oe("RESTART_SEQUENCE").filter(m=>{var y;if(lt(y=Object.values(Qs)).call(y,m))return!0}),x.debug("use reconnection policy from config distribution, queues: ".concat(og.join(" => ")))),V2=oe("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&Wn().supportPCSetConfiguration),og.length===0)return void s();let a,{index:c=0,type:d}=bS.get(t.id)||{};if(V2&&d===Qs.RELAY)return void s();let h=d&&c>=og.length-1;if(V2)d=Qs.RELAY;else{if(h)return void s();d?(c++,d=og[c]):(d=og[0],c=0)}x.debug("[".concat(t.id,"] choose ICE restart policy: ").concat(d,", index: ").concat(c)),r(d),bS.set(t.id,{index:c,type:d}),a=window.setTimeout(()=>W9(t,r,s),e_e),XP.set(t.id,a)}var En;function z9(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}function Fh(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?z9(Object(s),!0).forEach(function(a){q(t,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):z9(Object(s)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))})}return t}function G9(t){var r,s,a,c=2;for(typeof Symbol<"u"&&(s=cL,a=Symbol.iterator);c--;){if(s&&(r=t[s])!=null)return r.call(t);if(a&&(r=t[a])!=null)return new JP(r.call(t));s="@@asyncIterator",a="@@iterator"}throw new TypeError("Object is not async iterable")}function JP(t){function r(s){if(Object(s)!==s)return pt.reject(new TypeError(s+" is not an object."));var a=s.done;return pt.resolve(s.value).then(function(c){return{value:c,done:a}})}return JP=function(s){this.s=s,this.n=s.next},JP.prototype={s:null,n:null,next:function(){return r(this.n.apply(this.s,arguments))},return:function(s){var a=this.s.return;return a===void 0?pt.resolve({value:s,done:!0}):r(a.apply(this.s,arguments))},throw:function(s){var a=this.s.return;return a===void 0?pt.reject(s):r(a.apply(this.s,arguments))}},new JP(t)}let tT=(En=class extends Br{get state(){return this._state}set state(t){const r=this._state;this._state=t,this.emit(jt.StateChange,r,this._state)}constructor(t,r){super(),q(this,"isPlanB",void 0),q(this,"store",void 0),q(this,"statsUploader",void 0),q(this,"connection",void 0),q(this,"localTrackMap",new Map),q(this,"remoteUserMap",new Map),q(this,"localDataChannels",[]),q(this,"remoteDataChannelMap",new Map),q(this,"pendingLocalTracks",[]),q(this,"pendingRemoteTracks",[]),q(this,"pendingLocalDataChannels",[]),q(this,"pendingRemoteDataChannels",[]),q(this,"statsCollector",void 0),q(this,"shouldForwardP2PCreation",void 0),q(this,"iceFailedCount",0),q(this,"dtlsFailedCount",0),q(this,"mutex",void 0),q(this,"_state",Jn.Disconnected),q(this,"_pcStatsUploadType",oe("NEW_ICE_RESTART")?vf.FIRST_CONNECTION:vf.OLD_FIRST_CONNECTION),q(this,"_isStartRestartIce",!1),q(this,"_restartTimer",void 0),q(this,"_isTryConnecting",!1),q(this,"_iceError",null),q(this,"_forceTurn",!1),q(this,"_isWaitPcToRePub",!1),q(this,"handleMuteLocalTrack",async(s,a,c)=>{const d=await this.mutex.lock("Locking from P2PChannel.handleMuteLocalTrack");try{if(!this.connection||this.state!==Jn.Connected)return void c(new Le(te.INVALID_OPERATION,"Cannot call P2PChannel.handleMuteLocalTrack before connection established."));const h=this.filterTobeMutedTracks(s);if(h.length===0)return void a();const m=h.find(v=>v[0]==="videoLowTrack");m&&m[1].track._originMediaStreamTrack.stop(),await this.connection.muteLocal(h.map(v=>{let[,{id:w}]=v;return w}));const y=this.createMuteMessage(h);await fr(this,jt.RequestMuteLocal,y),a()}catch(h){c(h)}finally{d()}}),q(this,"handleUnmuteLocalTrack",async(s,a,c)=>{const d=await this.mutex.lock("Locking from P2PChannel.handleUnmuteLocalTrack");try{if(!this.connection||this.state!==Jn.Connected)return void c(new Le(te.INVALID_OPERATION,"Cannot call P2PChannel.handleUnmuteLocalTrack before connection established."));const h=this.filterTobeUnmutedTracks(s);if(h.length===0)return void a();const m=h.find(v=>v[0]==="videoLowTrack");if(m){const v=m[1];if(v.track._originMediaStreamTrack.stop(),!oe("DISABLE_DUAL_STREAM_USE_ENCODING")&&Wn().supportDualStreamEncoding){const w=s._mediaStreamTrack.clone();v.track._mediaStreamTrack=w,v.track._originMediaStreamTrack=w}else{const w=U2(s,Mw(this,jt.RequestLowStreamParameter));v.track._mediaStreamTrack=w,v.track._originMediaStreamTrack=w}await new pt((w,R)=>{this.handleReplaceTrack(v.track,w,R,!0)})}await this.connection.unmuteLocal(h.map(v=>{let[,{id:w}]=v;return w}));const y=this.createUnmuteMessage(h);await fr(this,jt.RequestUnmuteLocal,y),a()}catch(h){c(h)}finally{d()}}),q(this,"handleUpdateVideoEncoder",async(s,a,c,d)=>{let h;d||(h=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoEncoder"));try{const y=this.localTrackMap.get(Xe.LocalVideoTrack);if(!this.connection||!y||y.track!==s||this.state!==Jn.Connected)return void a();const{id:v,track:w}=y;await this.connection.updateSendParameters(v,w),await this.connection.updateEncoderConfig(v,w),this.emit(jt.UpdateVideoEncoder,w),a()}catch(y){c(y)}finally{var m;(m=h)===null||m===void 0||m()}}),q(this,"handleUpdateVideoSendParameters",async(s,a,c)=>{const d=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoSendParameters");try{const h=this.localTrackMap.get(Xe.LocalVideoTrack);if(!this.connection||!h||h.track!==s||this.state!==Jn.Connected)return void a();const{id:m,track:y}=h;await this.connection.updateSendParameters(m,y),a()}catch(h){c(h)}finally{d()}}),q(this,"handleReplaceMixingTrack",async(s,a,c,d)=>{if(!this.connection||this.state!==Jn.Connected)return void a();const h=L2([s]);let m;x.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(h.getTrackId(),"]")),typeof d=="boolean"&&d||(m=await this.mutex.lock("From P2PChannel.handleReplaceMixingTrack"));try{await this.replaceTrack(s,h),a()}catch(v){c(v)}finally{var y;(y=m)===null||y===void 0||y()}}),q(this,"handleReplaceTrack",async(s,a,c,d)=>{let h;x.debug("[".concat(this.store.clientId,"] P2PChannel handleReplaceTrack for [track-id-").concat(s.getTrackId(),"]")),typeof d=="boolean"&&d||(h=await this.mutex.lock("From P2PChannel.handleReplaceTrack"));try{var m;const v=Array.from(this.localTrackMap.entries()).find(w=>{let[,{track:R}]=w;return s===R});if(!this.connection||!v||this.state!==Jn.Connected)return void a();if(await((m=this.connection)===null||m===void 0?void 0:m.replaceTrack(s,v[1].id)),this.isPlanB){const w=v[1];w.id=s._mediaStreamTrack.id,this.localTrackMap.set(v[0],w)}if(v[0]===Xe.LocalVideoTrack&&!oe("DISABLE_DUAL_STREAM_USE_ENCODING")&&Wn().supportDualStreamEncoding){const w=this.localTrackMap.get(Xe.LocalVideoLowTrack);if(w){const R=s._mediaStreamTrack.clone();w.track._originMediaStreamTrack.stop(),w.track._mediaStreamTrack=R,w.track._originMediaStreamTrack=R,await new pt((O,D)=>{this.handleReplaceTrack(w.track,O,D,!0)})}}a()}catch(v){c(v)}finally{var y;(y=h)===null||y===void 0||y()}}),q(this,"handleGetRTCStats",s=>{s(this.statsCollector.getRTCStats())}),q(this,"handleGetLocalVideoStats",s=>{s(this.statsCollector.getLocalVideoTrackStats())}),q(this,"handleGetLocalAudioStats",s=>{s(this.statsCollector.getLocalAudioTrackStats())}),q(this,"handleGetRemoteVideoStats",s=>this.statsCollector.getRemoteVideoTrackStats(s.uid)[s.uid]),q(this,"handleGetRemoteAudioStats",s=>this.statsCollector.getRemoteAudioTrackStats(s.uid)[s.uid]),this.store=t,this.statsCollector=r,this.statsCollector.addP2PChannel(this),this.statsUploader=new F9(this.store),this.bindStatsUploaderEvents(),this.mutex=new Xs("P2PChannel-mutex",this.store.clientId),this.isPlanB=!Wn().supportUnifiedPlan||oe("CHROME_FORCE_PLAN_B")&&pf(),this.shouldForwardP2PCreation=oe("FORWARD_P2P_CREATION")&&Wn().supportPCSetConfiguration&&vL(),this.shouldForwardP2PCreation&&(this.connection=$P(this.store),this.emit(jt.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection))}async startP2PConnection(t){var r;this.state=Jn.New,this._forceTurn=x9(t),x.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] forceTurn: ").concat(this._forceTurn));const s=this.shouldForwardP2PCreation&&((r=this.connection)===null||r===void 0?void 0:r.peerConnectionState)==="closed";if(this.shouldForwardP2PCreation&&!s||(s&&this.connection&&(x.warning("[".concat(this.store.clientId,"] P2PChannel.startP2PConnection ForwardP2P closed.")),this.resetConnection(this.connection)),this.connection=$P(this.store,t),this.emit(jt.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),!this.connection)throw new Le(te.UNEXPECTED_ERROR,"Cannot P2PChannel.startConnection before P2PConnection initialization .");return this._pcStatsUploadType=oe("NEW_ICE_RESTART")?vf.FIRST_CONNECTION:vf.OLD_FIRST_CONNECTION,this._isTryConnecting=!0,this._isStartRestartIce=!1,this._iceError=null,this.connection.setConfiguration(t),this.connection.establishPromise}async connect(t){if(!this.connection)throw new Le(te.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");oe("ENABLE_PREALLOC_PC")&&this.state===Jn.Connected?await this.connection.updateRemoteConnect(t):(this.store.peerConnectionStart(),await this.connection.connect(t),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=Jn.Connected)}updateRemoteRTPCapabilities(t){const r=Array.from(this.localTrackMap.entries()).filter(c=>{var d;let[h]=c;return lt(d=[Xe.LocalVideoLowTrack,Xe.LocalVideoTrack]).call(d,h)}),s=r.map(c=>{let[,{id:d}]=c;return d}),a=r.map(c=>{let[d]=c;return d});if(this.connection instanceof Vh){if(Nt.updateRemoteRTPCapabilities(this.store.sessionId,{trackTypes:JSON.stringify(a),localCodecs:JSON.stringify(this.connection.localCodecs),remoteCodecs:JSON.stringify(t)}),!lt(t).call(t,this.store.codec)){const c=["vp9","vp8","h264"].find(d=>lt(t).call(t,d));c&&(this.store.codec=c,x.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId," updateRemoteRTPCapabilities] default codec is not available, hence the fallback to ").concat(c,".")))}this.connection.updateRemoteRTPCapabilities(s,t)}}async getEstablishParams(){var t;if(this.connection instanceof Vh&&this.connection.peerConnectionState!=="closed"&&lt(t=[Jn.New,Jn.Connected]).call(t,this.state))return this.connection.establishPromise}async publishDataChannel(t){if(!this.connection||this.state!==Jn.Connected){if(this.state===Jn.Disconnected)throw new Le(te.UNEXPECTED_ERROR,"PeerConnection already disconnected.");return t.forEach(s=>{var a;lt(a=this.pendingLocalDataChannels).call(a,s)||this.pendingLocalDataChannels.push(s)}),[]}const r=this.filterTobePublishedDataChannels(t);return r.length===0?[]:(r.forEach(s=>{const a=Date.now();this.store.publish(s.id.toString(),"datachannel",a)}),await this.connection.createDataChannels(this.store.uid,r),r.forEach(s=>{this.localDataChannels.push(s);const a=Date.now();this.store.publish(s.id+"","datachannel",void 0,a)}),t.map(s=>({streamId:s.id,ordered:s.ordered,maxRetransmits:s.maxRetransmits,metadata:s.metadata,channelId:s._originDataChannelId})))}publish(t,r,s){var a=this;return Ll(function*(){const c=yield xn(a.mutex.lock("From P2PChannel.publish"));try{var d;const h=a.connection&&lt(d=["disconnected","failed"]).call(d,a.connection.peerConnectionState);if(!a.connection||a.state!==Jn.Connected||h){if(a.state===Jn.Disconnected)throw new Le(te.UNEXPECTED_ERROR,"PeerConnection already disconnected.");a.throwIfTrackTypeNotMatch(t);const y=t.filter(v=>a.pendingLocalTracks.indexOf(v)===-1);return a.pendingLocalTracks=a.pendingLocalTracks.concat(y),void(h&&(a._isWaitPcToRePub=!0))}a.store.pubId=a.store.pubId+1,Zs.markPublishStart(a.store.clientId,a.store.pubId);const m=a.filterTobePublishedTracks(t,r,s);if(m.length===0)return void(yield xn(a.tryToUnmuteAudio(t)));yield*HA(G9(a.doPublish(a.connection,m)))}finally{c()}})()}doPublish(t,r){var s=this;return Ll(function*(){r.forEach(O=>{let{track:D,type:G}=O;const j=Date.now();s.store.publish(D.getTrackId(),G===Xe.LocalAudioTrack?"audio":"video",j)}),s.bindLocalTrackEvents(r);const a=r.map(O=>{let{track:D}=O;return D}),c=yield xn(t.send(a,s.store.codec,s.store.audioCodec)),d=(yield xn(c.next())).value,h=s.createGatewayPublishMessage(r,d);let m;try{m=yield h}catch(O){throw c.throw(O),(O==null?void 0:O.code)===te.WS_ABORT&&r.forEach(D=>{let{track:G}=D;s.pendingLocalTracks.indexOf(G)===-1&&s.pendingLocalTracks.push(G)}),s.unbindLocalTrackEvents(r),O}const y=s.mapPubResToRemoteConfig(h,m,a),v=(yield xn(c.next(y))).value;if(s.state===Jn.Disconnected)throw new Le(te.UNEXPECTED_ERROR,"PeerConnection already disconnected.");oe("ENABLE_VIDEO_SEI");const w=oe("ENABLE_ENCODED_TRANSFORM"),R=oe("ENABLE_AUDIO_METADATA");a.forEach(async O=>{const D=O.getRTCRtpTransceiver();if(!D||!w)return;const{interceptLocalVideoFrame:G,interceptLocalAudioFrame:j}=jP();O.trackMediaType===bt.VIDEO?await G(D.sender,O):O.trackMediaType===bt.AUDIO&&await j(D.sender,{metadata:R?()=>{const W=O.metadata.shift();return W&&W.value}:void 0})}),r.forEach(O=>{let{type:D}=O;s.statsCollector.addLocalStats(D)}),s.assignLocalTracks(r,v),s.statsUploader.startUploadOutboundStats(),r.forEach(O=>{let{track:D,type:G}=O;const j=Date.now();s.store.publish(D.getTrackId(),G===Xe.LocalAudioTrack?"audio":"video",void 0,j)})})()}async updateVideoStreamParameter(t,r){const s=this.localTrackMap.get(r);if(!s||!this.connection)return;if(!(s.track instanceof Ir))return x.warn("[updateVideoStreamParameter]: track is not an instance of LocalVideoTrack");const{track:a}=s,c=function(d,h){const m={};return d.height&&d.width&&(m.scaleResolutionDownBy=E2(d,h)),m.maxFramerate=d.framerate?Ic(d.framerate):void 0,m.maxBitrate=d.bitrate?1e3*d.bitrate:void 0,m}(t,a);if(a._encoderConfig||(a._encoderConfig={}),r!==Xe.LocalVideoLowTrack||!oe("DISABLE_DUAL_STREAM_USE_ENCODING")&&Wn().supportDualStreamEncoding)c.scaleResolutionDownBy!=null&&(a._encoderConfig.scaleResolutionDownBy=c.scaleResolutionDownBy);else{const d=a._originMediaStreamTrack;if(!d.canvas)return x.warn("[".concat(a.getTrackId(),"] no canvas on track"));(function(h,m){const y=h.canvas;m.width&&(y.width=Ic(m.width)),m.height&&(y.height=Ic(m.height)),m.framerate&&(y.stopCapture&&y.stopCapture(),y.stopCapture=qL(()=>{!y.startCapture&&y.stopCapture&&y.stopCapture(),y.startCapture&&y.startCapture()},Ic(m.framerate)))})(d,t)}c.maxBitrate!=null&&(a._encoderConfig.bitrateMax=c.maxBitrate/1e3),c.maxFramerate!=null&&(a._encoderConfig.frameRate&&typeof a._encoderConfig.frameRate=="object"?a._encoderConfig.frameRate.max=c.maxFramerate:a._encoderConfig.frameRate={max:c.maxFramerate}),x.debug("[".concat(a.getTrackId(),"] LowStreamEncoderConfig: , ").concat(JSON.stringify(a._encoderConfig))),await this.connection.updateRtpSenderEncodings(a)}publishLowStream(t){var r=this;return Ll(function*(){if(!r.connection||r.state!==Jn.Connected)return;const s=yield xn(r.mutex.lock("Locking from P2PChannel.publishLowStream"));try{const c=r.localTrackMap.get(Xe.LocalVideoTrack);if(!c)throw new Le(te.UNEXPECTED_ERROR,"Could not find high stream");if(r.localTrackMap.has(Xe.LocalVideoLowTrack))throw new Le(te.UNEXPECTED_ERROR,"[".concat(r.store.clientId,"] Can't publish low stream when stream already publish"));const d=[{track:r.getLowVideoTrack(c.track,t),type:Xe.LocalVideoLowTrack}];if(yield*HA(G9(r.doPublish(r.connection,d))),c.track.muted||!c.track.enabled){var a;const h=(a=r.localTrackMap.get(Xe.LocalVideoLowTrack))===null||a===void 0?void 0:a.id;h!==void 0&&(yield xn(r.connection.muteLocal([h])))}}finally{s()}})()}async republish(){this.pendingLocalTracks.length>0&&(x.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await Ms(this,jt.RequestRePublish,this.pendingLocalTracks),this.emit(jt.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[]),this.pendingLocalDataChannels.length>0&&(x.debug("Emit P2PChannelEvents.RequestRePublishDataChannel to republish datachannels."),await Ms(this,jt.RequestRePublishDataChannel,this.pendingLocalDataChannels),this.pendingLocalDataChannels=[]),this._isWaitPcToRePub=!1}async reSubscribe(t){for(let r=this.pendingRemoteTracks.length-1;r>=0;r--){const{user:s,kind:a}=this.pendingRemoteTracks[r];(a!==bt.AUDIO||s._audio_added_&&s._audioSSRC)&&(a!==bt.VIDEO||s._video_added_&&s._videoSSRC)||this.pendingRemoteTracks.splice(r,1)}if(t)await Ms(this,jt.RequestReSubscribe,this.pendingRemoteTracks);else for(const{user:r,kind:s}of this.pendingRemoteTracks)await this.subscribe(r,s,s===bt.VIDEO?r._videoSSRC:r._audioSSRC);this.pendingRemoteTracks.forEach(r=>{let{user:s}=r;this.emit(jt.MediaReconnectEnd,s.uid)}),this.pendingRemoteTracks=[]}async unpublish(t){if(!this.connection||this.state!==Jn.Connected)return void t.forEach(a=>{const c=this.pendingLocalTracks.indexOf(a);c!==-1&&this.pendingLocalTracks.splice(c,1)});const r=this.filterTobeUnpublishedTracks(t);if(r.length===0)return;const s=r.find(a=>a[0]==="videoLowTrack");return s&&s[1].track.close(),this.doUnpublish(this.connection,r)}async unpublishDataChannel(t){if(!this.connection||this.state!==Jn.Connected)return void t.forEach(s=>{const a=this.pendingLocalDataChannels.indexOf(s);a!==-1&&this.pendingLocalDataChannels.splice(a,1)});const r=this.filterTobeUnpublishedDataChannels(t);return r.length!==0?(r.forEach(s=>{const a=this.localDataChannels.indexOf(s);a!==-1&&this.localDataChannels.splice(a,1)}),this.localDataChannels.length===0&&await this.connection.stopDataChannels(this.store.uid),r.map(s=>s.id)):void 0}async unpublishLowStream(){if(!this.connection||this.state!==Jn.Connected)return;const t=this.localTrackMap.get(Xe.LocalVideoLowTrack);if(!t)return;t.track.close();const r=[[Xe.LocalVideoLowTrack,t]];return this.doUnpublish(this.connection,r)}async doUnpublish(t,r){const s=this.createGatewayUnpublishMessage(r);return await t.stopSending(r.map(a=>{let[,{id:c}]=a;return c})),this.withdrawLocalTracks(r),this.unbindLocalTrackEvents(r.map(a=>{let[c,{track:d}]=a;return{type:c,track:d}})),r.forEach(a=>{let[c]=a;this.statsCollector.removeLocalStats(c)}),this.localTrackMap.size===0&&this.statsUploader.stopUploadOutboundStats(),s}async subscribeDataChannel(t,r){if(!this.connection||this.state!==Jn.Connected)throw new Le(te.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");const s=r.filter(a=>{var c;return!((c=this.remoteDataChannelMap.get(t))!==null&&c!==void 0&&c.get(a.id))});if(s.length!==0)return await this.connection.createDataChannels(t.uid,s),s.forEach(a=>{var c;this.remoteDataChannelMap.has(t)?(c=this.remoteDataChannelMap.get(t))===null||c===void 0||c.set(a.id,a):this.remoteDataChannelMap.set(t,new Map([[a.id,a]]));const d=this.pendingRemoteDataChannels.findIndex(h=>{let{user:m,id:y}=h;return m.uid===t.uid&&y===a.id});d!==-1&&this.pendingRemoteDataChannels.splice(d,1)}),s.map(a=>a.id)}async subscribe(t,r,s,a,c){var d;if(!this.connection||this.state!==Jn.Connected)throw new Le(te.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");if((d=this.remoteUserMap.get(t))!==null&&d!==void 0&&d.has(r))return;let h,m,y;const v=this.connection.getPreMedia(s);if(v)x.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] preSSRCMap has ssrcId: ").concat(s,", no need to send sub to gateway.")),y=v.transceiver,h=v.track,m=v.id;else if(c){const O=c.find(G=>{let{stream_type:j}=G;return j===r});if(!O)throw new Le(te.UNEXPECTED_ERROR,"Cannot subscribe to remote ".concat(r," for user: ").concat(t.uid," because subscribe answer from gateway does not contain stream_type: ").concat(r,"."));const D=await this.connection.receive(r,O.ssrcs,String(t._uintid),O.attributes);this.connection instanceof Vh&&(y=D.transceiver),h=D.track,m=D.id}else{const O=await this.connection.receive(r,[{ssrcId:s,rtx:a}],String(t._uintid),void 0);this.connection instanceof Vh&&(y=O.transceiver),h=O.track,m=O.id}if(r===bt.AUDIO?(t._audioTrack?t._audioTrack._updateOriginMediaStreamTrack(h):(t._audioTrack=new lS(h,t.uid,t._uintid,this.store),x.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(t._audioTrack.getTrackId()))),y&&t._audioTrack._updateRtpTransceiver(y),this.bindRemoteTrackEvents(t,t._audioTrack)):(t._videoTrack?t._videoTrack._updateOriginMediaStreamTrack(h):(t._videoTrack=new cS(h,t.uid,t._uintid,this.store),x.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(t._videoTrack.getTrackId()))),y&&t._videoTrack._updateRtpTransceiver(y),this.bindRemoteTrackEvents(t,t._videoTrack)),y&&oe("ENABLE_ENCODED_TRANSFORM")){const{interceptRemoteVideoFrame:O,interceptRemoteAudioFrame:D}=jP();r==bt.VIDEO?await O(y.receiver,{onSei:oe("ENABLE_VIDEO_SEI")&&(G=>{var j;return(j=t._videoTrack)===null||j===void 0?void 0:j._onSei(G)})}):r==bt.AUDIO&&await D(y.receiver,{enableTopn:!!oe("ENABLE_AUDIO_TOPN"),enableMetadata:!!oe("ENABLE_AUDIO_METADATA"),onMetadata:G=>{this.safeEmit(jt.AudioMetadata,G)}})}const w=this.remoteUserMap.get(t);w?w.set(r,m):this.remoteUserMap.set(t,new Map([[r,m]])),this.statsCollector.addRemoteStats(t.uid),this.statsUploader.startUploadInboundStats();const R=this.pendingRemoteTracks.findIndex(O=>{let{user:D,kind:G}=O;return D.uid===t.uid&&r===G});R!==-1&&(this.pendingRemoteTracks.splice(R,1),this.emit(jt.MediaReconnectEnd,t.uid))}async massSubscribe(t){return this.massSubscribeNoLock(t)}async massSubscribeNoLock(t){if(!this.connection||this.state!==Jn.Connected)throw new Le(te.INVALID_OPERATION,"Cannot subscribeAll remote users when peerConnection disconnected.");t=t.filter(c=>{var d;let{user:h,mediaType:m}=c;return!((d=this.remoteUserMap.get(h))!==null&&d!==void 0&&d.has(m))});const r=[],s=new Map;t.forEach(c=>{if(!this.connection)return;const d=this.connection.getPreMedia(c.ssrcId);d?s.set(c.ssrcId,d):r.push(c)});const a=await this.connection.batchReceive(r.map(c=>{let{user:d,mediaType:h,ssrcId:m,rtxSsrcId:y}=c;return{kind:h,ssrcMsg:[{ssrcId:m,rtx:y}],mslabel:String(d._uintid)}}));r.forEach((c,d)=>{s.set(c.ssrcId,a[d])});for(const{user:c,mediaType:d,ssrcId:h}of t){const m=s.get(h);if(!m)return void x.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] cannot find ").concat(c.uid," subscribe data,").concat(d,", ").concat(h));const{track:y,id:v,transceiver:w}=m;if(w&&oe("ENABLE_ENCODED_TRANSFORM")){const{interceptRemoteVideoFrame:D,interceptRemoteAudioFrame:G}=jP();d==bt.VIDEO?await D(w.receiver,{onSei:oe("ENABLE_VIDEO_SEI")&&(j=>{var W;return(W=c._videoTrack)===null||W===void 0?void 0:W._onSei(j)})}):d==bt.AUDIO&&await G(w.receiver,{enableTopn:!!oe("ENABLE_AUDIO_TOPN"),enableMetadata:!!oe("ENABLE_AUDIO_METADATA"),onMetadata:j=>{this.safeEmit(jt.AudioMetadata,j)}})}if(d===bt.AUDIO?(c._audioTrack?c._audioTrack._updateOriginMediaStreamTrack(y):(c._audioTrack=new lS(y,c.uid,c._uintid,this.store),x.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(c._audioTrack.getTrackId()))),w&&c._audioTrack._updateRtpTransceiver(w),this.bindRemoteTrackEvents(c,c._audioTrack)):(c._videoTrack?c._videoTrack._updateOriginMediaStreamTrack(y):(c._videoTrack=new cS(y,c.uid,c._uintid,this.store),x.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(c._videoTrack.getTrackId()))),w&&c._videoTrack._updateRtpTransceiver(w),this.bindRemoteTrackEvents(c,c._videoTrack)),oe("ENABLE_VIDEO_SEI")&&w){const{interceptRemoteVideoFrame:D,interceptRemoteAudioFrame:G}=jP();d==bt.VIDEO?await D(w.receiver,{onSei:j=>{var W;(W=c._videoTrack)===null||W===void 0||W._onSei(j)}}):d==bt.AUDIO&&await G(w.receiver)}const R=this.remoteUserMap.get(c);R?R.set(d,v):this.remoteUserMap.set(c,new Map([[d,v]])),this.statsCollector.addRemoteStats(c.uid),this.statsUploader.startUploadInboundStats();const O=this.pendingRemoteTracks.findIndex(D=>{let{user:G,kind:j}=D;return G.uid===c.uid&&d===j});O!==-1&&(this.pendingRemoteTracks.splice(O,1),this.emit(jt.MediaReconnectEnd,c.uid))}}async unsubscribe(t,r,s){const a=this.pendingRemoteTracks.filter(h=>{let{user:m,kind:y}=h;return r!==void 0?m.uid===t.uid&&r===y:m.uid===t.uid});if(a.forEach(h=>{const m=this.pendingRemoteTracks.indexOf(h);this.pendingRemoteTracks.splice(m,1)}),this.connection&&this.state===Jn.Connected||s||a.forEach(h=>{let{kind:m}=h;var y;if(m===bt.AUDIO)(y=t._audioTrack)===null||y===void 0||y._destroy(),t._audioTrack=void 0;else if(m===bt.VIDEO){var v;(v=t._videoTrack)===null||v===void 0||v._destroy(),t._videoTrack=void 0}}),!this.connection||this.state!==Jn.Connected)return;const c=this.filterTobeUnSubscribedTracks(t,r);if(c.length===0)return;await this.connection.stopReceiving(c.map(h=>{let[,{id:m}]=h;return m}));const d=this.createUnsubscribeMessage(c);return this.withdrawRemoteTracks(c),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),c.forEach(h=>{let[m,{kind:y}]=h;var v,w;if(y===bt.VIDEO&&m._videoSSRC&&((v=this.connection)===null||v===void 0||v.setStatsRemoteVideoIsReady(m._videoSSRC,!1)),y===bt.VIDEO)this.unbindRemoteTrackEvents(m._videoTrack),s||((w=m._videoTrack)===null||w===void 0||w._destroy(),m._videoTrack=void 0);else if(y===bt.AUDIO){var R;this.unbindRemoteTrackEvents(m._audioTrack),!s&&((R=m._audioTrack)===null||R===void 0||R._destroy(),m._audioTrack=void 0)}}),d}async unsubscribeDataChannel(t,r){if(r.forEach(c=>{const d=this.pendingRemoteDataChannels.findIndex(h=>h.id===c.id);d!==-1&&this.pendingRemoteDataChannels.splice(d,1)}),!this.connection)return;const s=this.filterTobeUnSubscribedDataChannels(t,r);if(s.length===0)return;r.forEach(c=>{c._close()});const a=this.remoteDataChannelMap.get(t);return s.forEach(c=>{a&&a.delete(c.id)}),a&&a.size===0&&(this.remoteDataChannelMap.delete(t),await this.connection.stopDataChannels(t.uid)),s.map(c=>c.id)}async massUnsubscribe(t){return this.massUnsubscribeNoLock(t)}async massUnsubscribeNoLock(t){let r=[];for(const{user:c,mediaType:d}of t){const h=this.pendingRemoteTracks.filter(m=>{let{user:y,kind:v}=m;return d!==void 0?y.uid===c.uid&&d===v:y.uid===c.uid});h.forEach(m=>{const y=this.pendingRemoteTracks.indexOf(m);this.pendingRemoteTracks.splice(y,1)}),r=r.concat(h)}if(!this.connection||this.state!==Jn.Connected)return void r.forEach(c=>{let{user:d,kind:h}=c;var m;if(h===bt.AUDIO)(m=d._audioTrack)===null||m===void 0||m._destroy(),d._audioTrack=void 0;else if(h===bt.VIDEO){var y;(y=d._videoTrack)===null||y===void 0||y._destroy(),d._videoTrack=void 0}});const s=Ec(t).call(t,(c,d)=>{let{user:h,mediaType:m}=d;const y=this.filterTobeUnSubscribedTracks(h,m);return c.concat(y)},[]);if(s.length===0)return;await this.connection.stopReceiving(s.map(c=>{let[,{id:d}]=c;return d}));const a=this.createUnsubscribeAllMessage(s);return this.withdrawRemoteTracks(s),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),s.forEach(c=>{let[d,{kind:h}]=c;var m,y;if(h===bt.VIDEO&&d._videoSSRC&&((m=this.connection)===null||m===void 0||m.setStatsRemoteVideoIsReady(d._videoSSRC,!1)),h===bt.VIDEO)this.unbindRemoteTrackEvents(d._videoTrack),(y=d._videoTrack)===null||y===void 0||y._destroy(),d._videoTrack=void 0;else if(h===bt.AUDIO){var v;this.unbindRemoteTrackEvents(d._audioTrack),(v=d._audioTrack)===null||v===void 0||v._destroy(),d._audioTrack=void 0}}),a}isPreSubScribe(t){return!this.connection||this.state!==Jn.Connected?!1:!!this.connection.getPreMedia(t)}async muteRemote(t,r){if(!this.connection)return;const s=this.remoteUserMap.get(t);if(!s)return void x.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(t.uid,"."));if(!s.get(r))return void x.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(t.uid," media type ").concat(r,"."));const a=r===bt.VIDEO?t._videoSSRC:t._audioSSRC;a!==void 0&&this.connection.setStatsRemoteVideoIsReady(a,!1)}async unmuteRemote(t,r){return this.unmuteRemoteNoLock(t,r)}async unmuteRemoteNoLock(t,r){if(!this.connection)return;const s=this.remoteUserMap.get(t);if(!s)return void x.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(t.uid,"."));s.get(r)||x.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(t.uid," media type ").concat(r,"."))}addAudioMetadata(t){const r=this.localTrackMap.get(Xe.LocalAudioTrack),s=r&&r.track;s&&s.metadata.push(t)}getAllTracks(t){const r=this.localTrackMap.get(Xe.LocalAudioTrack);if((r==null?void 0:r.track)instanceof Bi){const s=r.track;return Array.from(this.localTrackMap.entries()).filter(a=>{let[c]=a;return c!==Xe.LocalAudioTrack}).filter(a=>{let[c]=a;return!(t&&c===Xe.LocalVideoLowTrack)}).map(a=>{let[,{track:c}]=a;return c}).concat(s.trackList)}return Array.from(this.localTrackMap.entries()).filter(s=>{let[a]=s;return!(t&&a===Xe.LocalVideoLowTrack)}).map(s=>{let[,{track:a}]=s;return a})}getAllDataChannels(){return this.localDataChannels}reportPublishEvent(t,r,s,a,c){if(t){const h=this.localTrackMap.get(Xe.LocalAudioTrack),m=a?this.localTrackMap.get(Xe.LocalVideoLowTrack):this.localTrackMap.get(Xe.LocalVideoTrack);Nt.publish(this.store.sessionId,{eventElapse:Zs.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:t,ec:r,audioName:h==null?void 0:h.track.getTrackLabel(),videoName:m==null?void 0:m.track.getTrackLabel(),screenshare:(m==null?void 0:m.track._hints.indexOf(gr.SCREEN_TRACK))!==-1,audio:!!h,video:!!m,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:c})}else{var d;s||(s=[]);const h=s.find(y=>y instanceof Qr),m=a?(d=this.localTrackMap.get(Xe.LocalVideoTrack))===null||d===void 0?void 0:d.track:s.find(y=>y instanceof Ir);Nt.publish(this.store.sessionId,{eventElapse:Zs.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:t,ec:r,audioName:h==null?void 0:h.getTrackLabel(),videoName:m==null?void 0:m.getTrackLabel(),screenshare:(m==null?void 0:m._hints.indexOf(gr.SCREEN_TRACK))!==-1,audio:!!h,video:!!m,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:c})}}reportSubscribeEvent(t,r,s,a){const c=a===bt.VIDEO?s._videoSSRC:s._audioSSRC;c&&Nt.subscribe(this.store.sessionId,{succ:t,ec:r,video:a===bt.VIDEO,audio:a===bt.AUDIO,peerid:s.uid,subscribeRequestid:c,p2pid:this.store.p2pId,eventElapse:Zs.measureFromSubscribeStart(this.store.clientId,c),preSsrc:this.isPreSubScribe(c)})}reset(){x.debug("[".concat(this.store.clientId,"] P2PChannel.reset")),this.mutex=new Xs("P2PChannel-mutex",this.store.clientId),this.connection&&(this.resetConnection(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=$P(this.store),this.emit(jt.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.statsUploader.stopUploadBaseStats(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const t=this.localTrackMap.get(Xe.LocalAudioTrack);if((t==null?void 0:t.track)instanceof Bi){if(t.track.trackList.length>0){const r=t.track;t.track.trackList.forEach(s=>{r.removeAudioTrack(s)})}t.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.iceFailedCount=0,this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.localDataChannels=[],this.remoteDataChannelMap.clear(),this.pendingLocalDataChannels=[],this.pendingRemoteDataChannels=[],this.state=Jn.Disconnected}getStats(){var t;return(t=this.connection)===null||t===void 0?void 0:t.getStats()}getRemoteVideoIsReady(t){var r;return((r=this.connection)===null||r===void 0?void 0:r.getRemoteVideoIsReady(t))||!1}getLocalAudioVolume(){const t=this.localTrackMap.get(Xe.LocalAudioTrack);if(t)return t.track.getVolumeLevel()}getLocalVideoSize(){const t=this.localTrackMap.get(Xe.LocalVideoTrack);if(t)return{width:t.track.videoWidth||0,height:t.track.videoHeight||0}}getEncoderConfig(t){const r=this.localTrackMap.get(t);return r&&r.track instanceof Ir||r&&r.track instanceof Qr?r.track._encoderConfig:void 0}getLocalMedia(t){return this.localTrackMap.get(t)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(t,r){if(!t)return this.remoteUserMap.size>0;const s=this.remoteUserMap.get(t);return!!s&&(!r||s.has(r))}async hasRemoteMediaWithLock(t,r){if(!t)return this.remoteUserMap.size>0;const s=this.remoteUserMap.get(t);return!!s&&(!r||s.has(r))}getRemoteMedia(t){var r;const s=Array.from(tl(r=this.remoteUserMap).call(r)).find(a=>a.uid===t);return s?{audioTrack:s.audioTrack,audioSSRC:s._audioSSRC,videoTrack:s.videoTrack,videoSSRC:s._videoSSRC}:{}}getAudioLevels(){let t=Array.from(this.remoteUserMap.entries()).map(s=>{let[a]=s;return{uid:a.uid,level:a.audioTrack?100*a.audioTrack._source.getAccurateVolumeLevel():0}});const r=this.localTrackMap.get(Xe.LocalAudioTrack);return r&&t.push({level:100*r.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),t=Ew(t).call(t,(s,a)=>s.level-a.level),t}async disconnectForReconnect(){this.connection&&(x.debug("[".concat(this.store.clientId,"] P2PChannel.disconnectForReconnect closing P2PConnection")),this.state=Jn.Reconnecting,oe("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(t=>{let[r]=t;var s;r._videoTrack&&r._videoTrack._player&&((s=r._videoTrack._player.getVideoElement())===null||s===void 0||s.pause(),r._videoTrack._player.isKeepLastFrame=!0,r._videoTrack._originMediaStreamTrack.stop())}),this.resetConnection(this.connection),this.connection=void 0,this.shouldForwardP2PCreation&&(this.connection=$P(this.store),this.emit(jt.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(t=>{var r;let[s,{track:a}]=t;switch(s){case Xe.LocalVideoTrack:lt(r=a._hints).call(r,gr.LOW_STREAM)?a.close():this.pendingLocalTracks.push(a);break;case Xe.LocalAudioTrack:a instanceof Bi?this.pendingLocalTracks=this.pendingLocalTracks.concat(a.trackList):this.pendingLocalTracks.push(a);case Xe.LocalVideoLowTrack:}}),this.emit(jt.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(t=>{let[r,s]=t;Array.from(tl(s).call(s)).forEach(a=>{this.setPendingRemoteMedia(r,a)}),this.emit(jt.MediaReconnectStart,r.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.localDataChannels.length!==0&&(this.localDataChannels.forEach(t=>{this.pendingLocalDataChannels.push(t)}),this.localDataChannels.length=0),this.remoteDataChannelMap.size!==0&&(Array.from(this.remoteDataChannelMap.entries()).forEach(t=>{let[r,s]=t;Array.from(tl(s).call(s)).forEach(a=>{this.setPendingRemoteDataChannel(r,a)})}),this.remoteDataChannelMap.clear()),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),x.debug("[".concat(this.store.clientId,"] P2PChannel disconnected, waiting to reconnect.")))}hasPendingRemoteDataChannel(t,r){for(const s of this.pendingRemoteDataChannels){const{user:a,id:c}=s;if((t instanceof sg?t.uid:t)===a.uid&&c===r)return!0}return!1}setPendingRemoteDataChannel(t,r){this.hasPendingRemoteDataChannel(t,r)||this.pendingRemoteDataChannels.push({user:t,id:r})}hasPendingRemoteMedia(t,r){for(const s of this.pendingRemoteTracks){const{user:a,kind:c}=s;if((t instanceof sg?t.uid:t)===a.uid&&r===c)return!0}return!1}setPendingRemoteMedia(t,r){this.hasPendingRemoteMedia(t,r)||this.pendingRemoteTracks.push({user:t,kind:r})}restartICE(t){var r=this;return Ll(function*(){if(!r.connection||r.state!==Jn.Connected)return;const s=yield xn(r.mutex.lock("From P2PChannel.restartICE"));let a;try{a=yield xn(r.connection.restartICE(t));const d=yield xn(a.next());if(d.done)return;const h=d.value,m=yield h;switch(M2(r.connection)&&r.reportPCStats(Date.now(),!1,r._pcStatsUploadType),t){case Qs.UDP_TCP_RELAY:r._pcStatsUploadType=vf.UDP_TCP_RESTART;break;case Qs.TCP_RELAY:r._pcStatsUploadType=vf.TCP_RESTART;break;case Qs.RELAY:r._pcStatsUploadType=vf.RELAY_RESTART;break;default:r._pcStatsUploadType=vf.OLD_RESTART}r._isTryConnecting=!0,a.next(m)}catch(d){var c;(c=a)===null||c===void 0||c.throw(d)}finally{s()}})()}getUplinkNetworkQuality(){if(!this.connection)return 0;const t=this.connection.getStats(),r=this.localTrackMap.get(Xe.LocalVideoTrack),s=this.localTrackMap.get(Xe.LocalAudioTrack),a=t.videoSend.find(D=>D.ssrc===(r==null?void 0:r.ssrcs[0].ssrcId)),c=t.audioSend.find(D=>D.ssrc===(s==null?void 0:s.ssrcs[0].ssrcId));if(!a||!c)return 1;const d=Zc(this,jt.NeedSignalRTT),h=a?a.rttMs:void 0,m=c?c.rttMs:void 0,y=h&&m?(h+m)/2:h||m,v=(y&&d?(y+d)/2:y||d)||0,w=100*t.sendPacketLossRate*.7/50+.3*v/1500,R=w<.17?1:w<.36?2:w<.59?3:w<.1?4:5,O=r==null?void 0:r.track;if(O&&O._encoderConfig&&O._hints.indexOf(gr.SCREEN_TRACK)===-1){const D=O._encoderConfig.bitrateMax,G=t.bitrate.actualEncoded;if(D&&G){const j=(1e3*D-G)/(1e3*D);return TH[j<.15?0:j<.3?1:j<.45?2:j<.6?3:4][R]}}return R}getDownlinkNetworkQuality(){if(!this.connection)return 0;const t=this.connection.getStats();let r=0;return Array.from(this.remoteUserMap.entries()).forEach(s=>{let[a]=s;const c=a._audioSSRC,d=a._videoSSRC,h=t.audioRecv.find(G=>G.ssrc===c),m=t.videoRecv.find(G=>G.ssrc===d);if(!h&&!m)return void(r+=1);const y=Zc(this,jt.NeedSignalRTT),v=t.rtt,w=(v&&y?(v+y)/2:v||y)||0,R=h?h.jitterMs:void 0,O=t.recvPacketLossRate;let D=.7*O*100/50+.3*w/1500;R&&(D=.6*O*100/50+.2*w/1500+.2*R/400),r+=D<.1?1:D<.17?2:D<.36?3:D<.59?4:5}),this.remoteUserMap.size>0?Math.round(r/this.remoteUserMap.size):r}async muteLocalTrack(t){return new pt((r,s)=>{this.handleMuteLocalTrack(t,r,s)})}async replaceTrack(t,r){var s;if(x.debug("[".concat(this.store.clientId,"] P2PChannel replaceTrack from [").concat(t.getTrackId(),"] to [").concat(r.getTrackId(),"]")),!this.connection||this.state!==Jn.Connected)return;const a=Array.from(this.localTrackMap.entries()).find(d=>{let[,{track:h}]=d;return t===h});if(!a)return;const c=a[0];if(t!==r&&(this.unbindLocalTrackEvents([{track:t,type:c}]),this.bindLocalTrackEvents([{track:r,type:c}]),a[1].track=r),await((s=this.connection)===null||s===void 0?void 0:s.replaceTrack(r,a[1].id)),this.isPlanB){const d=a[1];d.id=r._mediaStreamTrack.id,this.localTrackMap.set(c,d)}if(c===Xe.LocalVideoTrack&&!oe("DISABLE_DUAL_STREAM_USE_ENCODING")&&Wn().supportDualStreamEncoding){const d=this.localTrackMap.get(Xe.LocalVideoLowTrack);if(d){const h=t._mediaStreamTrack.clone();d.track._originMediaStreamTrack.stop(),d.track._mediaStreamTrack=h,d.track._originMediaStreamTrack=h,await new pt((m,y)=>{this.handleReplaceTrack(d.track,m,y,!0)})}}}filterTobePublishedTracks(t,r,s){const a=[],c=this.getAllTracks();t=Yv(t=t.filter(y=>c.indexOf(y)===-1));let d,h=!1;const m=this.localTrackMap.get(Xe.LocalAudioTrack);for(const y of t){if(y instanceof Ir&&(this.localTrackMap.has(Xe.LocalVideoTrack)||h?new Le(te.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(a.push({track:y,type:Xe.LocalVideoTrack}),h=!0),r)){const v=this.getLowVideoTrack(y,s);a.push({track:v,type:Xe.LocalVideoLowTrack})}if(y instanceof Qr)if(m){const v=m.track;if(v instanceof Bi)x2([y]),v.addAudioTrack(y),this.bindLocalAudioTrackEvents(y,!0);else{const w=L2([v,y]);x.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(w.getTrackId(),"]")),this.replaceTrack(v,w)}}else d instanceof Bi?(x2([y]),d.addAudioTrack(y)):d||!y._useAudioElement&&Wn().webAudioMediaStreamDest&&!y._bypassWebAudio?d=L2(d?[y,d]:[y]):d=y}return d&&(x.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will send audioTrack [").concat(d.getTrackId(),"]")),a.push({track:d,type:Xe.LocalAudioTrack})),a}filterTobeUnpublishedTracks(t){const r=[],s=this.getAllTracks();t=Yv(t=t.filter(a=>s.indexOf(a)!==-1));for(const a of t){if(a instanceof Qr){const c=this.localTrackMap.get(Xe.LocalAudioTrack);if(!c)continue;c.track instanceof Bi?(c.track.removeAudioTrack(a),this.unbindLocalAudioTrackEvents(a),c.track.trackList.length===0&&(r.push([Xe.LocalAudioTrack,c]),c.track.close())):r.push([Xe.LocalAudioTrack,c])}if(a instanceof Ir){const c=this.localTrackMap.get(Xe.LocalVideoTrack);if(!c)continue;r.push([Xe.LocalVideoTrack,c]);const d=this.localTrackMap.get(Xe.LocalVideoLowTrack);d&&r.push([Xe.LocalVideoLowTrack,d])}}return r}filterTobePublishedDataChannels(t){return t=(t=Yv(t)).filter(r=>this.localDataChannels.findIndex(s=>s.id===r.id)===-1)}filterTobeUnpublishedDataChannels(t){return t=(t=(t=Yv(t)).filter(r=>this.localDataChannels.indexOf(r)!==-1)).filter(r=>r._originDataChannel)}bindLocalTrackEvents(t){t.forEach(r=>{let{track:s,type:a}=r;switch(a){case Xe.LocalVideoTrack:s.addListener(It.GET_STATS,this.handleGetLocalVideoStats),s.addListener(It.GET_RTC_STATS,this.handleGetRTCStats),s.addListener(It.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),s.addListener(It.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),s.addListener(It.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),s.addListener(It.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),s.addListener(It.NEED_REPLACE_TRACK,this.handleReplaceTrack),s.addListener(It.NEED_MUTE_TRACK,this.handleMuteLocalTrack),s.addListener(It.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Xe.LocalAudioTrack:this.bindLocalAudioTrackEvents(s);case Xe.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(t,r){t instanceof Bi?t.trackList.forEach(s=>{s.addListener(It.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),s.addListener(It.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),s.addListener(It.GET_STATS,this.handleGetLocalAudioStats),s.addListener(It.NEED_MUTE_TRACK,this.handleMuteLocalTrack),s.addListener(It.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(t.addListener(It.GET_STATS,this.handleGetLocalAudioStats),t.addListener(It.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.addListener(It.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.addListener(It.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.addListener(It.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),r||(t.addListener(It.NEED_REPLACE_TRACK,this.handleReplaceTrack),t.addListener(It.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack)))}unbindLocalTrackEvents(t){t||(t=Array.from(this.localTrackMap.entries()).map(r=>{let[s,{track:a}]=r;return{track:a,type:s}})),t.forEach(r=>{let{track:s,type:a}=r;switch(a){case Xe.LocalVideoTrack:s.off(It.GET_STATS,this.handleGetLocalVideoStats),s.off(It.GET_RTC_STATS,this.handleGetRTCStats),s.off(It.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),s.off(It.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),s.off(It.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),s.off(It.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),s.off(It.NEED_REPLACE_TRACK,this.handleReplaceTrack),s.off(It.NEED_MUTE_TRACK,this.handleMuteLocalTrack),s.off(It.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Xe.LocalAudioTrack:this.unbindLocalAudioTrackEvents(s);case Xe.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(t){t instanceof Bi?t.trackList.forEach(r=>{r.off(It.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),r.off(It.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),r.off(It.GET_STATS,this.handleGetLocalAudioStats),r.off(It.NEED_MUTE_TRACK,this.handleMuteLocalTrack),r.off(It.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(t.off(It.GET_STATS,this.handleGetLocalAudioStats),t.off(It.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(It.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(It.NEED_REPLACE_TRACK,this.handleReplaceTrack),t.off(It.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack),t.off(It.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(It.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(t,r){r instanceof cS&&r.addListener(It.GET_STATS,s=>{s(this.handleGetRemoteVideoStats(t))}),r instanceof lS&&r.addListener(It.GET_STATS,s=>{s(this.handleGetRemoteAudioStats(t))})}unbindRemoteTrackEvents(t){t&&t.removeAllListeners(It.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(t=>{let[r,s]=t;s.has(bt.AUDIO)&&this.unbindRemoteTrackEvents(r._audioTrack),s.has(bt.VIDEO)&&this.unbindRemoteTrackEvents(r._videoTrack)})}createGatewayPublishMessage(t,r){return t.map((s,a)=>{var c;let d,h,{track:m,type:y}=s;switch(y){case Xe.LocalAudioTrack:d=Qn.Audio,h={dtx:m instanceof yP&&m._config.DTX,hq:!1,lq:!1,stereo:!1,speech:!1};break;case Xe.LocalVideoTrack:d=lt(c=m._hints).call(c,gr.SCREEN_TRACK)?Qn.Screen:Qn.High,h=Fh(Fh({},WH(m)),{},{codec:this.store.codec,svc_mode:xP()});break;case Xe.LocalVideoLowTrack:d=Qn.Low,h=Fh(Fh({},WH(m)),{},{codec:this.store.codec,svc_mode:xP()})}return{stream_type:d,attributes:h,ssrcs:r[a]}})}createGatewayUnpublishMessage(t){return t.map(r=>{var s;let a,[c,{track:d,ssrcs:h,id:m}]=r;switch(c){case Xe.LocalVideoTrack:a=lt(s=d._hints).call(s,gr.SCREEN_TRACK)?Qn.Screen:Qn.High;break;case Xe.LocalAudioTrack:a=Qn.Audio;break;case Xe.LocalVideoLowTrack:a=Qn.Low}return{stream_type:a,ssrcs:h,mid:m}})}assignLocalTracks(t,r){t.forEach((s,a)=>{let{track:c,type:d}=s;this.localTrackMap.set(d,{track:c,id:r[a].id,ssrcs:r[a].localSSRC})})}withdrawLocalTracks(t){t.forEach(r=>{let[s]=r;this.localTrackMap.delete(s)})}bindConnectionEvents(t){t.onConnectionStateChange=async r=>{if(x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onConnectionStateChange(").concat(r,")")),this.emit(jt.PeerConnectionStateChange,r),r==="connecting"&&t instanceof Vh&&!Hr()&&oe("FIRST_TCP_CANDIDATE")&&window.setTimeout(()=>{r==="connecting"&&t.extendCandidate()},oe("FIRST_TCP_CANDIDATE_INTERVAL")),r!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),r==="connected"&&(this._restartTimer&&(window.clearTimeout(this._restartTimer),this._restartTimer=void 0),t instanceof Vh&&B9(t,!0),this._isTryConnecting&&this.reportPCStats(Date.now(),!0,this._pcStatsUploadType),this._isTryConnecting=!1,this._isStartRestartIce=!1,this._pcStatsUploadType=vf.DISCONNECTED_OR_FAILED,Zc(this,jt.QueryClientConnectionState)==="CONNECTED"&&this._isWaitPcToRePub)){const s=this.pendingLocalTracks.map(c=>c.getTrackId()),a=this.pendingLocalDataChannels.map(c=>"dc_".concat(c.id));Nt.reportApiInvoke(this.store.sessionId,{name:Ni.REPUB_AFTER_PC_CONNECTED,options:s.concat(a),tag:Kr.TRACER}).onSuccess(),this.republish()}if(oe("NEW_ICE_RESTART")&&t instanceof Vh&&!Hr()&&!this._forceTurn){if(lt(LH).call(LH,r)){if(this._isStartRestartIce)return;this._isStartRestartIce=!0;const s=c=>{M2(t)&&(x.debug("[".concat(this.store.clientId,"] [P2PChannel] try to restartICE, type is ").concat(c)),Zc(this,jt.QueryClientConnectionState)==="CONNECTED"&&this.emit(jt.RequestRestartICE,c))},a=()=>{M2(t)&&(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),x.debug("[".concat(this.store.clientId,"] P2PConnection disconnected timeout, force reconnect")),setTimeout(()=>this.emit(jt.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())};return void(this._restartTimer=window.setTimeout(()=>{W9(t,s,a)},800))}}else{if(r==="disconnected"&&t.iceConnectionState==="disconnected")return setTimeout(()=>{t.iceConnectionState==="disconnected"&&oe("ICE_RESTART")&&Zc(this,jt.QueryClientConnectionState)==="CONNECTED"&&this.emit(jt.RequestRestartICE)},800),void setTimeout(()=>{t.peerConnectionState==="disconnected"&&(x.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection disconnected timeout 4000ms, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isTryConnecting=!1,setTimeout(()=>this.emit(jt.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())},4e3);r==="failed"&&(x.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection state failed, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),setTimeout(()=>this.emit(jt.P2PLost),0),this.iceFailedCount+=1,await this.requestReconnect())}},t.onICEConnectionStateChange=r=>{r!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(r,")")),Nt.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:r,tag:Kr.TRACER}).onSuccess(),this.emit(jt.IceConnectionStateChange,r)},t.onICETransportStateChange=r=>{x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(r,")"))},t.onDTLSTransportStateChange=r=>{x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(r,")"))},t.onDTLSTransportError=r=>{x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(r,")"))},t.onFirstAudioDecoded=r=>{var s;const a=Array.from(tl(s=this.remoteUserMap).call(s)).find(d=>d._audioSSRC===r);var c;a&&(this.store.subscribe(a.uid,"audio",void 0,void 0,void 0,Date.now()),(c=a.audioTrack)===null||c===void 0||c.emit(rS.FIRST_FRAME_DECODED),Nt.firstRemoteFrame(this.store.sessionId,Zi.FIRST_AUDIO_DECODE,Mr.FIRST_AUDIO_DECODE,{peer:a._uintid,subscribeElapse:Zs.measureFromSubscribeStart(this.store.clientId,r),subscribeRequestid:r,p2pid:this.store.p2pId}))},t.onFirstAudioReceived=r=>{var s;const a=Array.from(tl(s=this.remoteUserMap).call(s)).find(c=>c._audioSSRC===r);a&&Nt.firstRemoteFrame(this.store.sessionId,Zi.FIRST_AUDIO_RECEIVED,Mr.FIRST_AUDIO_RECEIVED,{peer:a._uintid,subscribeElapse:Zs.measureFromSubscribeStart(this.store.clientId,r),subscribeRequestid:r,p2pid:this.store.p2pId})},t.onFirstVideoDecoded=(r,s,a)=>{this.reportVideoFirstFrameDecoded(r,s,a)},t.onFirstVideoReceived=r=>{var s;const a=Array.from(tl(s=this.remoteUserMap).call(s)).find(c=>c._videoSSRC===r);a&&Nt.firstRemoteFrame(this.store.sessionId,Zi.FIRST_VIDEO_RECEIVED,Mr.FIRST_VIDEO_RECEIVED,{peer:a._uintid,subscribeElapse:Zs.measureFromSubscribeStart(this.store.clientId,r),subscribeRequestid:r,p2pid:this.store.p2pId})},t.onSelectedLocalCandidateChanged=(r,s)=>{const a=r.candidateType==="relay",c=s.candidateType==="relay";s.candidateType!=="unknown"&&a===c||this.emit(jt.ConnectionTypeChange,a),x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(ng(s))," -> ").concat(JSON.stringify(ng(r)),")"))},t.onSelectedRemoteCandidateChanged=(r,s)=>{x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(ng(s))," -> ").concat(JSON.stringify(ng(r)),")"))},t.onFirstVideoDecodedTimeout=r=>{this.reportVideoFirstFrameDecoded(r,void 0,void 0,!0)},t.getLocalVideoStats=()=>{const r=this.statsCollector.getLocalVideoTrackStats(),s=this.statsCollector.getRTCStats();return Fh(Fh({},r),s)},t.onICECandidateError=r=>{this._iceError=r}}resetConnection(t){t instanceof Vh&&function(r){bS.delete(r.id),B9(r)}(t),t.close(),this.emit(jt.PeerConnectionStateChange,"closed"),function(r){r.onConnectionStateChange=void 0,r.onICEConnectionStateChange=void 0,r.onICETransportStateChange=void 0,r.onDTLSTransportStateChange=void 0,r.onDTLSTransportError=void 0,r.onFirstAudioDecoded=void 0,r.onFirstAudioReceived=void 0,r.onFirstVideoDecoded=void 0,r.onFirstVideoReceived=void 0,r.onSelectedLocalCandidateChanged=void 0,r.onSelectedRemoteCandidateChanged=void 0,r.onFirstVideoDecodedTimeout=void 0,r.getLocalVideoStats=void 0}(t),this._isWaitPcToRePub=!1}filterTobeMutedTracks(t){const r=[];if(this.getAllTracks().indexOf(t)===-1)return r;const s=this.localTrackMap.get(Xe.LocalAudioTrack);if(t instanceof Qr&&(s==null?void 0:s.track)instanceof Bi)return s.track.isActive||r.push([Xe.LocalAudioTrack,s]),r;const a=Array.from(this.localTrackMap.entries()).find(c=>{let[,{track:d}]=c;return t===d});if(a&&(r.push(a),a[0]===Xe.LocalVideoTrack)){const c=this.localTrackMap.get(Xe.LocalVideoLowTrack);c&&r.push([Xe.LocalVideoLowTrack,c])}return r}filterTobeUnmutedTracks(t){const r=[],s=this.localTrackMap.get(Xe.LocalAudioTrack);if(t instanceof Qr&&(s==null?void 0:s.track)instanceof Bi)return s.track.isActive&&r.push([Xe.LocalAudioTrack,s]),r;const a=Array.from(this.localTrackMap.entries()).find(c=>{let[,{track:d}]=c;return t===d});if(a)if(a[0]===Xe.LocalVideoTrack){r.push(a);const c=this.localTrackMap.get(Xe.LocalVideoLowTrack);c&&r.push([Xe.LocalVideoLowTrack,c])}else r.push(a);return r}createMuteMessage(t){return t.map(r=>{var s;let a,[c,{track:d,ssrcs:h,id:m}]=r;switch(c){case Xe.LocalAudioTrack:a=Qn.Audio;break;case Xe.LocalVideoTrack:a=lt(s=d._hints).call(s,gr.SCREEN_TRACK)?Qn.Screen:Qn.High;break;case Xe.LocalVideoLowTrack:a=Qn.Low}return{stream_type:a,ssrcs:h,mid:m}})}createUnmuteMessage(t){return t.map(r=>{var s;let a,[c,{track:d,ssrcs:h,id:m}]=r;switch(c){case Xe.LocalAudioTrack:a=Qn.Audio;break;case Xe.LocalVideoTrack:a=lt(s=d._hints).call(s,gr.SCREEN_TRACK)?Qn.Screen:Qn.High;break;case Xe.LocalVideoLowTrack:a=Qn.Low}return{stream_type:a,ssrcs:h,mid:m}})}filterTobeUnSubscribedTracks(t,r){const s=[],a=this.remoteUserMap.get(t);if(!a)return s;if(r){const c=a.get(r);if(!c)return s;s.push([t,{kind:r,id:c}])}else Array.from(a.entries()).forEach(c=>{let[d,h]=c;s.push([t,{kind:d,id:h}])});return s}filterTobeUnSubscribedDataChannels(t,r){const s=[];return r.forEach(a=>{var c;(c=this.remoteDataChannelMap.get(t))!==null&&c!==void 0&&c.has(a.id)&&s.push(a)}),s}createUnsubscribeMessage(t){const r=[];return t.forEach(s=>{let[a,{kind:c,id:d}]=s;switch(c){case bt.VIDEO:return void(a._videoSSRC&&r.push({stream_type:bt.VIDEO,ssrcId:a._videoSSRC}));case bt.AUDIO:return void(a._audioSSRC&&r.push({stream_type:bt.AUDIO,ssrcId:a._audioSSRC}))}}),r}createUnsubscribeAllMessage(t){const r=new Map;return t.forEach(s=>{let[a,{kind:c}]=s;if(r.has(a)){let d=r.get(a);c===bt.VIDEO?d|=es.Video:d|=es.Audio,r.set(a,d)}else c===bt.VIDEO?r.set(a,es.Video):r.set(a,es.Audio)}),{users:Array.from(r.entries()).map(s=>{let[a,c]=s;return{stream_id:a.uid,stream_type:c}})}}withdrawRemoteTracks(t){t.forEach(r=>{let[s,{kind:a}]=r;const c=this.remoteUserMap.get(s);c&&(c.delete(a),Array.from(c.entries()).length===0&&this.remoteUserMap.delete(s))})}async updateBitrateLimit(t){const r=this.localTrackMap.get(Xe.LocalVideoTrack),s=this.localTrackMap.get(Xe.LocalVideoLowTrack);r&&(await r.track.setBitrateLimit(t.uplink),await new pt((a,c)=>{this.handleUpdateVideoEncoder(r.track,a,c,!0)})),s&&t.low_stream_uplink&&(await s.track.setBitrateLimit({max_bitrate:t.low_stream_uplink.bitrate,min_bitrate:t.low_stream_uplink.bitrate||0}),await new pt((a,c)=>{this.handleUpdateVideoEncoder(s.track,a,c,!0)}))}isP2PDisconnected(){return this.connection?this.connection.peerConnectionState!=="connected":!0}mapPubResToRemoteConfig(t,r,s){return t.map((a,c)=>{var d;let{stream_type:h}=a;const m=(d=r.find(y=>{let{stream_type:v}=y;return h===v}))===null||d===void 0?void 0:d.attributes;if(m&&oe("DISABLE_SCREEN_SHARE_REMB")){const y=s[c]._hints;(lt(y).call(y,gr.SCREEN_TRACK)||lt(y).call(y,gr.SCREEN_LOW_TRACK))&&(m.remb=!1,x.debug("disable remb for screen share, hints:",y))}return m})}async tryToUnmuteAudio(t){for(let s=0;s<t.length;s++)if(t[s]instanceof Qr){var r;const a=this.filterTobeUnmutedTracks(t[s]);if(a.length===0)continue;await((r=this.connection)===null||r===void 0?void 0:r.unmuteLocal(a.map(d=>{let[,{id:h}]=d;return h})));const c=this.createUnmuteMessage(a);return void await fr(this,jt.RequestUnmuteLocal,c)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=()=>this.getStats(),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=t=>{var r;return!((r=this.connection)===null||r===void 0||!r.getRemoteVideoIsReady(t))},this.statsUploader.requestUpload=(t,r)=>this.emit(jt.RequestUpload,t,r),this.statsUploader.requestUploadStats=t=>this.emit(jt.RequestUploadStats,t),this.statsUploader.requestAllTracks=()=>this.getAllTracks(),this.statsUploader.requestTransportStats=()=>{var t;return{connectState:((t=this.connection)===null||t===void 0?void 0:t.peerConnectionState)||"closed"}}}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await ys(AL(this.dtlsFailedCount,Di)),this.emit(jt.RequestReconnect)}async reconnectP2P(){const t=Array.from(this.localTrackMap.entries()),r=this.createGatewayUnpublishMessage(t);Array.from(this.remoteUserMap.entries()),r.length>0&&await Ms(this,jt.RequestUnpublishForReconnectPC,r),this.disconnectForReconnect(),this.emit(jt.RequestReconnectPC)}canPublishLowStream(){return this.localTrackMap.has(Xe.LocalVideoTrack)||this.pendingLocalTracks.some(t=>t instanceof Ir)}throwIfTrackTypeNotMatch(t){if(t.filter(r=>r instanceof Ir).length>1)throw new Le(te.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t.filter(r=>r instanceof Qr).length>1&&(t.some(r=>r instanceof Qr&&r._bypassWebAudio)||!Wn().webAudioMediaStreamDest))throw new Le(te.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const r of t){if(r instanceof Ir&&this.pendingLocalTracks.some(s=>s instanceof Ir))throw new Le(te.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(r instanceof Qr&&this.pendingLocalTracks.some(s=>s instanceof Qr)&&(!Wn().webAudioMediaStreamDest||r._bypassWebAudio||this.pendingLocalTracks.some(s=>s instanceof Qr&&s._bypassWebAudio)))throw new Le(te.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(t,r){var s;const a=!oe("DISABLE_DUAL_STREAM_USE_ENCODING")&&Wn().supportDualStreamEncoding,c=Fh(Fh({},{width:160,height:120,framerate:15,bitrate:50}),r);let d;d=a?t._mediaStreamTrack.clone():U2(t,c);const h=mr(8,"track-low-"),m=new Ir(d,Fh(Fh({},a&&{scaleResolutionDownBy:E2(c,t)}),{},{frameRate:c.framerate,bitrateMax:c.bitrate,bitrateMin:c.bitrate}),void 0,void 0,h);return m.on(Z_.TRANSCEIVER_UPDATED,y=>{t._updateRtpTransceiver(y,tS.LOW_STREAM)}),m._hints.push(gr.LOW_STREAM),lt(s=t._hints).call(s,gr.SCREEN_TRACK)&&m._hints.push(gr.SCREEN_LOW_TRACK),t.on("sei-to-send",y=>{m.emit("sei-to-send",y)}),t.addListener(It.NEED_CLOSE,()=>{m.close()}),m}async globalLock(){return this.mutex.lock("From P2PChannel.globalLock")}async reportPCStats(t,r,s){let a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;if(this.connection&&this.connection instanceof Vh){var c,d,h,m;const y=this.store.keyMetrics.descriptionStart||0,{iceConnectionState:v,dtlsTransportState:w,peerConnectionState:R}=this.connection,{local:O,remote:D}=await this.connection.getSelectedCandidatePair();Nt.pcStats(this.store.sessionId,{startTime:y,eventElapse:t-y||0,iceconnectionsate:v,dtlsstate:w,connectionstate:R,intSucc:r?1:2,error:this._iceError||a||"",selectedLocalCandidateProtocol:(c=O==null?void 0:O.protocol)!==null&&c!==void 0?c:"",selectedLocalCandidateType:(d=O.candidateType)!==null&&d!==void 0?d:"",selectedLocalCandidateAddress:"".concat(O.address,":").concat(O.port),selectedRemoteCandidateProtocol:(h=D.protocol)!==null&&h!==void 0?h:"",selectedRemoteCandidateType:(m=D.candidateType)!==null&&m!==void 0?m:"",selectedRemoteCandidateAddress:"".concat(D.address,":").concat(D.port),restartCnt:s,preallocation:this.connection.isPreallocation}),this._iceError=null}}reportVideoFirstFrameDecoded(t,r,s,a){var c;const d=Array.from(tl(c=this.remoteUserMap).call(c)).find(h=>h._videoSSRC===t);if(d){a||this.store.subscribe(d.uid,"video",void 0,void 0,void 0,void 0,Date.now());const h=this.store.keyMetrics,m=h.subscribe.find(y=>y.userId===d.uid&&y.type==="video");Nt.firstRemoteVideoDecode(this.store.sessionId,Zi.FIRST_VIDEO_DECODE,Mr.FIRST_VIDEO_DECODE,{peer:d._uintid,videowidth:r,videoheight:s,subscribeElapse:Zs.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId,apEnd:h.requestAPEnd||0,apStart:h.requestAPStart||0,joinGwEnd:h.joinGatewayEnd||0,joinGwStart:h.joinGatewayStart||0,pcEnd:h.peerConnectionEnd||0,pcStart:h.peerConnectionStart||0,subscriberEnd:(m==null?void 0:m.subscribeEnd)||0,subscriberStart:(m==null?void 0:m.subscribeStart)||0,videoAddNotify:(m==null?void 0:m.streamAdded)||0,state:a?1:0,firstFrame:(m==null?void 0:m.firstFrame)||0})}}async remoteMediaSsrcChanged(t,r,s){if(!this.connection)return!1;const a=this.remoteUserMap.get(t);if(!a)return!1;const c=a.get(r);if(!c)return!1;const d=await this.connection.getRemoteSSRC(c);return d!==void 0&&d!==s}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(t=>{let[r,{track:s}]=t;r===Xe.LocalVideoLowTrack?s._updateRtpTransceiver(void 0,tS.LOW_STREAM):s._updateRtpTransceiver(void 0)})}},At(En.prototype,"startP2PConnection",[Po],Object.getOwnPropertyDescriptor(En.prototype,"startP2PConnection"),En.prototype),At(En.prototype,"connect",[Po],Object.getOwnPropertyDescriptor(En.prototype,"connect"),En.prototype),At(En.prototype,"updateRemoteRTPCapabilities",[Po],Object.getOwnPropertyDescriptor(En.prototype,"updateRemoteRTPCapabilities"),En.prototype),At(En.prototype,"publishDataChannel",[Po],Object.getOwnPropertyDescriptor(En.prototype,"publishDataChannel"),En.prototype),At(En.prototype,"unpublish",[Po],Object.getOwnPropertyDescriptor(En.prototype,"unpublish"),En.prototype),At(En.prototype,"unpublishDataChannel",[Po],Object.getOwnPropertyDescriptor(En.prototype,"unpublishDataChannel"),En.prototype),At(En.prototype,"unpublishLowStream",[Po],Object.getOwnPropertyDescriptor(En.prototype,"unpublishLowStream"),En.prototype),At(En.prototype,"subscribeDataChannel",[Po],Object.getOwnPropertyDescriptor(En.prototype,"subscribeDataChannel"),En.prototype),At(En.prototype,"subscribe",[Po],Object.getOwnPropertyDescriptor(En.prototype,"subscribe"),En.prototype),At(En.prototype,"massSubscribe",[Po],Object.getOwnPropertyDescriptor(En.prototype,"massSubscribe"),En.prototype),At(En.prototype,"unsubscribe",[Po],Object.getOwnPropertyDescriptor(En.prototype,"unsubscribe"),En.prototype),At(En.prototype,"unsubscribeDataChannel",[Po],Object.getOwnPropertyDescriptor(En.prototype,"unsubscribeDataChannel"),En.prototype),At(En.prototype,"massUnsubscribe",[Po],Object.getOwnPropertyDescriptor(En.prototype,"massUnsubscribe"),En.prototype),At(En.prototype,"muteRemote",[Po],Object.getOwnPropertyDescriptor(En.prototype,"muteRemote"),En.prototype),At(En.prototype,"unmuteRemote",[Po],Object.getOwnPropertyDescriptor(En.prototype,"unmuteRemote"),En.prototype),At(En.prototype,"hasRemoteMediaWithLock",[Po],Object.getOwnPropertyDescriptor(En.prototype,"hasRemoteMediaWithLock"),En.prototype),At(En.prototype,"disconnectForReconnect",[Po],Object.getOwnPropertyDescriptor(En.prototype,"disconnectForReconnect"),En.prototype),At(En.prototype,"updateBitrateLimit",[Po],Object.getOwnPropertyDescriptor(En.prototype,"updateBitrateLimit"),En.prototype),At(En.prototype,"remoteMediaSsrcChanged",[Po],Object.getOwnPropertyDescriptor(En.prototype,"remoteMediaSsrcChanged"),En.prototype),En);function Po(t,r,s){const a=t[r];if(typeof a!="function")throw new Error("Cannot use mutex on object property.");return s.value=async function(){const c=this.mutex,d=await c.lock("From P2PChannel.".concat(r));try{for(var h=arguments.length,m=new Array(h),y=0;y<h;y++)m[y]=arguments[y];return await a.apply(this,m)}finally{d()}},s}function H9(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}function $9(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?H9(Object(s),!0).forEach(function(a){q(t,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):H9(Object(s)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))})}return t}const t_e=Date.now(),n_e=20,j2=new Map,QP=new Map;async function K9(t){const r=j2.get(t),s=Array.isArray(r)&&r[r.length-1],a=QP.get(t);if(!s)return void(a.isSyncing=!1);const c={uid:s.uid,payload:s.payload};a.firstRecvTs===0&&(a.firstRecvTs=s.recvTs,a.firstSendTs=s.sendTs);const d=s.sendTs-a.firstSendTs,h=d-(Date.now()-a.firstRecvTs);h>0&&(a.firstRecvTs=Date.now()-d);let m=s.mediaDelay+h;m<=0?(r.pop(),q9(s.context,c),m=0):m=Math.min(m,n_e),setTimeout(()=>r.length&&K9(t),m)}function q9(t,r){t.safeEmit(wn.STREAM_MESSAGE,r.uid,r.payload),t.onStreamMessage&&t.onStreamMessage(r)}function r_e(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,s=arguments.length>2?arguments[2]:void 0;if(!t.syncWithAudio)return q9(s,{uid:t.uid,payload:t.payload});const a="".concat(s.id,"-").concat(t.uid),c=j2.get(a)||[],d=c.findIndex(v=>t.sendTs>=v.sendTs),h=$9($9({},t),{},{context:s,mediaDelay:r,recvTs:Date.now()});d===-1?c.push(h):c.splice(d,0,h),j2.set(a,c);let m=!1;var y;QP.has(a)?m=!((y=QP.get(a))===null||y===void 0||!y.isSyncing):QP.set(a,{isSyncing:m,firstRecvTs:0,firstSendTs:0}),m||K9(a)}const i_e=Ln().name;function Y9(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}function X9(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?Y9(Object(s),!0).forEach(function(a){q(t,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):Y9(Object(s)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))})}return t}const wS="websdk_ng_cache_parameter",s_e=oe("MAX_PRELOAD_ASYNC_LENGTH"),o_e=1e4,hy=new Map,py=[];let F2=null,B2=0,W2=0;const ZP=new Map,a_e=function(t,r){const s=[];let a=0;const c=async()=>{const d=s.shift();d&&await d(),s.length>0&&a<r?c():a--};return async function(){for(var d=arguments.length,h=new Array(d),m=0;m<d;m++)h[m]=arguments[m];return new pt(async(y,v)=>{s.push(async()=>{try{const w=await t(...h);y(w)}catch(w){v(w)}}),a<r&&(a++,c())})}}(J9,s_e),z2=va.CancelToken.source();async function J9(t,r,s,a,c,d){try{if(!oe("ENABLE_PRELOAD"))return;if(!Wn().supportWebCrypto)return void Xm(()=>{x.warn("Your browser does not support preloading, this feature  be run in a secure environment")},"preload_webcrypto_not_supported");if(!s&&s!==null)throw new Le(te.INVALID_PARAMS,"Invalid token: ".concat(s,". If you don not use token, set it to null"));s&&_s(s,"token",1,2047),_s(t,"appid",1,2047),PP(r),a&&OP(a);const h=J_();x.debug("preload channel ".concat(r,", uid is ").concat(a));const m={appId:t,cname:r,token:s||t,uid:typeof a!="string"?a:null,sid:h,proxyServer:c};let y,v;typeof a=="string"?(m.stringUid=a,[v,y]=await pt.all([zge(a,{sid:h,appId:t},z2.token),E9(X9(X9({},m),{},{token:s||t,uid:0}),z2.token)]),m.uid=v.uid,y.gatewayInfo.uid=m.uid,y.gatewayInfo.res.uid=m.uid):(d&&(m.stringUid=d),y=await E9(m,z2.token));const w={sid:h,appId:t,cname:r,token:s||t,uid:m.stringUid||a,intUid:m.uid||y.gatewayInfo.uid,stringUid:m.stringUid,ts:Date.now(),sua:v,ap:y};await async function(R){let O;try{R.uid&&Z9({appId:R.appId,cname:R.cname,token:R.token,uid:R.uid,stringUid:R.stringUid});const D=r$(R),G=await async function(W,Q){try{const ee=await window.crypto.subtle.importKey("raw",zz(Q),"AES-GCM",!1,["encrypt"]),fe=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:new Uint8Array(1)},ee,X_(window.btoa(JSON.stringify(W))));return Jm(new Uint8Array(fe))}catch{return}}(R,R.token||R.appId);if(!G)return;O=n$(wS);const j=O?JSON.parse(O):[];j.push({[D]:G}),j.length>oe("AP_CACHE_NUM")&&j.shift(),eO(wS,JSON.stringify(j))}catch(D){x.warn("Error caching server parameters:",D.message),eO(wS,"")}}(w),B2++}catch(h){throw W2++,function(m){F2||(F2=window.setTimeout(()=>{let v="";ZP.forEach((w,R)=>{v+="".concat(R,": ").concat(w," ;")}),Nt.reportApiInvoke(null,{name:Ni.PRELOAD,options:{success:B2,failed:W2,err:v}}).onError(m),B2=0,W2=0,ZP.clear(),F2=null},o_e));const y=ZP.get(m.code)||0;ZP.set(m.code,y+1)}(h),h}}async function Q9(t){try{if(oe("AP_REQUEST_DETAIL")||oe("ENABLE_ROLE_SELECT_EDGE"))return;const r=Z9(t);if(!r||t.cloudProxyServer!=="disabled")return;const s=await async function(a,c){try{const d=await window.crypto.subtle.importKey("raw",zz(c),"AES-GCM",!1,["decrypt"]),h=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:new Uint8Array(1)},d,X_(a));return JSON.parse(window.atob(Jm(new Uint8Array(h))))}catch{return}}(r,t.token||t.appId);if(!s||!function(a,c){return a.cname===c.cname&&a.appId===c.appId&&a.token===c.token?c.stringUid?a.stringUid===c.stringUid:typeof c.uid=="number"?a.uid===c.uid:a.uid==c.uid:!1}(s,t))return;if(s&&Date.now()-s.ts<oe("AP_CACHE_LIFETIME"))return s}catch(r){x.warn("Error get preloadInfo",r.message)}}function Z9(t){let r;try{if(r=n$(wS),!r)return;const s=JSON.parse(r),a=r$(t),c=function(h,m){for(let y=h.length-1;y>=0;y--)if(m(h[y]))return y;return-1}(s,h=>a in h);if(c===-1)return;const d=s.splice(c,1)[0];return eO(wS,JSON.stringify(s)),d[a]}catch(s){x.warn("Error delete preload info: ".concat(r),s.message),eO(wS,"")}}function G2(t){if(t){let r=hy.get(t);r&&(window.clearTimeout(r),r=null,hy.delete(t)),lt(py).call(py,t)||t.cloudProxyServer!=="disabled"||py.push(t)}if(hy.size<oe("AP_CACHE_NUM")&&py.length>0){const r=py.shift();hy.set(r,window.setTimeout(async()=>{const{appId:s,cname:a,token:c,stringUid:d,uid:h,proxyServer:m}=r;try{await a_e(s,a,c,h,m,d),hy.has(r)&&G2(r)}catch(y){x.warn("update preload failed",y.message),e$(r)}},oe("AP_UPDATE_INTERVAL")))}}function e$(t){const r=py.indexOf(t);r!==-1&&py.splice(r,1);let s=hy.get(t);s&&(window.clearTimeout(s),s=null,hy.delete(t),G2())}function t$(t,r){const s=t.sua,a=t.ap;r&&s&&Nt.reqUserAccount(t.sid,{lts:s.requestTime,elapse:s.elapse,success:!0,serverAddr:s.url,stringUid:r,uid:t.intUid,errorCode:null,extend:s.req}),Nt.reportResourceTiming(t.ap.url,t.sid),Nt.joinWebProxyAP(t.sid,{lts:a.requestTime,elapse:a.elapse,sucess:1,apServerAddr:a.url,turnServerAddrList:a.proxyInfo.addresses.map(c=>c.ip).join(","),eventType:"disabled",unilbsServerIds:[bi.CHOOSE_SERVER,bi.CLOUD_PROXY_FALLBACK].toString()}),Nt.joinChooseServer(t.sid,{lts:a.requestTime,elapse:a.elapse,succ:!0,csAddr:a.url,opid:a.opid,serverList:a.gatewayInfo.gatewayAddrs.map(c=>c.address),ec:null,cid:a.gatewayInfo.cid.toString(),uid:a.gatewayInfo.uid.toString(),csIp:a.gatewayInfo.csIp,unilbsServerIds:[bi.CHOOSE_SERVER].toString(),isHttp3:a.isHttp3})}function n$(t){return window.atob(window.localStorage.getItem(t)||"")}function eO(t,r){window.localStorage.setItem(t,window.btoa(r))}function r$(t){let r="".concat(t.appId,"_").concat(t.cname);return typeof t.uid=="string"&&(r+="_s_".concat(t.uid)),typeof t.uid=="number"&&(r+="_".concat(t.uid)),t.token&&(r+="_".concat(t.token)),Xz(r)}function c_e(t){let r=function(){const s=d_e.pop();return s?(s.offset=s.limit=0,s):{bytes:new Uint8Array(64),offset:0,limit:0}}();return function(s,a){let c=s.appId;c!==void 0&&(Ci(a,10),ag(a,c));let d=s.cid;d!==void 0&&(Ci(a,16),Ci(a,d));let h=s.cname;h!==void 0&&(Ci(a,26),ag(a,h));let m=s.deviceId;m!==void 0&&(Ci(a,34),ag(a,m));let y=s.elapse;y!==void 0&&(Ci(a,40),cg(a,y));let v=s.fileSize;v!==void 0&&(Ci(a,48),cg(a,TS(v)));let w=s.height;w!==void 0&&(Ci(a,56),cg(a,TS(w)));let R=s.jpg;R!==void 0&&(Ci(a,66),Ci(a,R.length),s$(a,R));let O=s.networkType;O!==void 0&&(Ci(a,72),cg(a,TS(O)));let D=s.osType;D!==void 0&&(Ci(a,80),cg(a,TS(D)));let G=s.requestId;G!==void 0&&(Ci(a,90),ag(a,G));let j=s.sdkVersion;j!==void 0&&(Ci(a,98),ag(a,j));let W=s.sequence;W!==void 0&&(Ci(a,104),cg(a,TS(W)));let Q=s.sid;Q!==void 0&&(Ci(a,114),ag(a,Q));let ee=s.timestamp;ee!==void 0&&(Ci(a,120),cg(a,ee));let fe=s.uid;fe!==void 0&&(Ci(a,128),Ci(a,fe));let ye=s.vid;ye!==void 0&&(Ci(a,136),Ci(a,ye));let Ee=s.width;Ee!==void 0&&(Ci(a,144),cg(a,TS(Ee)));let _e=s.service;_e!==void 0&&(Ci(a,152),Ci(a,_e));let Ne=s.callbackData;Ne!==void 0&&(Ci(a,162),Ci(a,Ne.length),s$(a,Ne));let Ze=s.ticket;Ze!==void 0&&(Ci(a,170),ag(a,Ze));let ft=s.vendorConfigs;ft!==void 0&&(Ci(a,178),ag(a,ft))}(t,r),function(s){let a=s.bytes,c=s.limit;return a.length===c?a:a.subarray(0,c)}(r)}function l_e(t){return function(s){let a={};e:for(;!h_e(s);){let c=nT(s);switch(c>>>3){case 0:break e;case 1:a.code=nT(s);break;case 2:a.msg=o$(s,nT(s));break;case 3:a.requestId=o$(s,nT(s));break;case 4:a.timestamp=p_e(s,!1);break;default:u_e(s,7&c)}}return a}({bytes:r=t,offset:0,limit:r.length});var r}function u_e(t,r){switch(r){case 0:for(;128&Mu(t););break;case 2:H2(t,nT(t));break;case 5:H2(t,4);break;case 1:H2(t,8);break;default:throw new Error("Unimplemented type: "+r)}}function TS(t){return{low:t|=0,high:t>>31,unsigned:t>=0}}let d_e=[];function H2(t,r){if(t.offset+r>t.limit)throw new Error("Skip past limit");t.offset+=r}function h_e(t){return t.offset>=t.limit}function tO(t,r){let s=t.bytes,a=t.offset,c=t.limit,d=a+r;if(d>s.length){let h=new Uint8Array(2*d);h.set(s),t.bytes=h}return t.offset=d,d>c&&(t.limit=d),a}function i$(t,r){let s=t.offset;if(s+r>t.limit)throw new Error("Read past limit");return t.offset+=r,s}function s$(t,r){let s=tO(t,r.length);t.bytes.set(r,s)}function o$(t,r){let s=i$(t,r),a=String.fromCharCode,c=t.bytes,d="",h="";for(let m=0;m<r;m++){let y,v,w,R,O=c[m+s];(128&O)==0?h+=a(O):(224&O)==192?m+1>=r?h+=d:(y=c[m+s+1],(192&y)!=128?h+=d:(R=(31&O)<<6|63&y,R<128?h+=d:(h+=a(R),m++))):(240&O)==224?m+2>=r?h+=d:(y=c[m+s+1],v=c[m+s+2],(49344&(y|v<<8))!=32896?h+=d:(R=(15&O)<<12|(63&y)<<6|63&v,R<2048||R>=55296&&R<=57343?h+=d:(h+=a(R),m+=2))):(248&O)==240?m+3>=r?h+=d:(y=c[m+s+1],v=c[m+s+2],w=c[m+s+3],(12632256&(y|v<<8|w<<16))!=8421504?h+=d:(R=(7&O)<<18|(63&y)<<12|(63&v)<<6|63&w,R<65536||R>1114111?h+=d:(R-=65536,h+=a(55296+(R>>10),56320+(1023&R)),m+=3))):h+=d}return h}function ag(t,r){let s=r.length,a=0;for(let h=0;h<s;h++){let m=r.charCodeAt(h);m>=55296&&m<=56319&&h+1<s&&(m=(m<<10)+r.charCodeAt(++h)-56613888),a+=m<128?1:m<2048?2:m<65536?3:4}Ci(t,a);let c=tO(t,a),d=t.bytes;for(let h=0;h<s;h++){let m=r.charCodeAt(h);m>=55296&&m<=56319&&h+1<s&&(m=(m<<10)+r.charCodeAt(++h)-56613888),m<128?d[c++]=m:(m<2048?d[c++]=m>>6&31|192:(m<65536?d[c++]=m>>12&15|224:(d[c++]=m>>18&7|240,d[c++]=m>>12&63|128),d[c++]=m>>6&63|128),d[c++]=63&m|128)}}function Mu(t){return t.bytes[i$(t,1)]}function a$(t,r){let s=tO(t,1);t.bytes[s]=r}function nT(t){let r,s=0,a=0;do r=Mu(t),s<32&&(a|=(127&r)<<s),s+=7;while(128&r);return a}function Ci(t,r){for(r>>>=0;r>=128;)a$(t,127&r|128),r>>>=7;a$(t,r)}function p_e(t,r){let s,a=0,c=0,d=0;return s=Mu(t),a=127&s,128&s&&(s=Mu(t),a|=(127&s)<<7,128&s&&(s=Mu(t),a|=(127&s)<<14,128&s&&(s=Mu(t),a|=(127&s)<<21,128&s&&(s=Mu(t),c=127&s,128&s&&(s=Mu(t),c|=(127&s)<<7,128&s&&(s=Mu(t),c|=(127&s)<<14,128&s&&(s=Mu(t),c|=(127&s)<<21,128&s&&(s=Mu(t),d=127&s,128&s&&(s=Mu(t),d|=(127&s)<<7))))))))),{low:a|c<<28,high:c>>>4|d<<24,unsigned:r}}function cg(t,r){let s=r.low>>>0,a=(r.low>>>28|r.high<<4)>>>0,c=r.high>>>24,d=c===0?a===0?s<16384?s<128?1:2:s<1<<21?3:4:a<16384?a<128?5:6:a<1<<21?7:8:c<128?9:10,h=tO(t,d),m=t.bytes;switch(d){case 10:m[h+9]=c>>>7&1;case 9:m[h+8]=d!==9?128|c:127&c;case 8:m[h+7]=d!==8?a>>>21|128:a>>>21&127;case 7:m[h+6]=d!==7?a>>>14|128:a>>>14&127;case 6:m[h+5]=d!==6?a>>>7|128:a>>>7&127;case 5:m[h+4]=d!==5?128|a:127&a;case 4:m[h+3]=d!==4?s>>>21|128:s>>>21&127;case 3:m[h+2]=d!==3?s>>>14|128:s>>>14&127;case 2:m[h+1]=d!==2?s>>>7|128:s>>>7&127;case 1:m[h]=d!==1?128|s:127&s}}const c$={},l$={},nO=4294967296,f_e=nO*nO,m_e=f_e/2;d$(0,!0);const u$=d$(0),g_e=rT(0,-2147483648,!1),__e=rT(-1,2147483647,!1);function d$(t,r){let s,a,c;return r?(c=0<=(t>>>=0)&&t<256)&&(a=l$[t],a)?a:(s=rT(t,0,!0),c&&(l$[t]=s),s):(c=-128<=(t|=0)&&t<128)&&(a=c$[t],a)?a:(s=rT(t,t<0?-1:0,!1),c&&(c$[t]=s),s)}function rT(t,r,s){return{low:0|t,high:0|r,unsigned:!!s}}function h$(t,r){if(isNaN(t))return u$;{if(t<=-9223372036854776e3)return g_e;if(t+1>=m_e)return __e}return t<0?u$:rT(t%nO|0,t/nO|0,r)}function p$(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}class $2 extends Br{get connectionState(){return this._connectionState}set connectionState(r){if(this._connectionState===r)return;const s=this._connectionState;this._connectionState=r,this.emit(Ld.CONNECTION_STATE_CHANGE,r,s)}get quality(){return this._quality}set quality(r){this._quality=r>1?1:r<.1?.1:r,this._qualityTimer&&(window.clearTimeout(this._qualityTimer),this._qualityTimer=null),this._quality>=1||(this._qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this._qualityRatio},6e4))}constructor(r){var s;super(),q(this,"name","AgoraRTCImageModeration"),q(this,"_connectionState",jl.CONNECTING),q(this,"_sequence",0),q(this,"_moderationStartTime",void 0),q(this,"_workerConnection",void 0),q(this,"_workerMessageLengthLimit",void 0),q(this,"_qualityRatio",void 0),q(this,"_connectInfo",void 0),q(this,"_cancelTokenSource",va.CancelToken.source()),q(this,"_retryConfig",void 0),q(this,"_moderationInterval",void 0),q(this,"_moderationTimer",null),q(this,"_moderationMode",1),q(this,"_quality",1),q(this,"_qualityTimer",null),q(this,"_ticket",void 0),q(this,"_moderationIntervalMinimum",void 0),q(this,"_uploadFailedNum",0),q(this,"_uploadNum",0),q(this,"_uploadTimer",null),q(this,"_extraInfo",void 0),q(this,"_vendor",""),q(this,"_encoder",new TextEncoder),q(this,"_moderationId",void 0),q(this,"inspectImage",()=>{if(this.connectionState!==jl.CONNECTED)throw new Ae(te.OPERATION_ABORTED,"image moderation service connection status is ".concat(this.connectionState));this._moderationTimer&&(window.clearInterval(this._moderationTimer),this._moderationTimer=null),this._moderationTimer=window.setInterval(()=>{this.connectionState===jl.CONNECTED?this.requestToInspectImage():x.debug("[".concat(this._moderationId,"] Moderation State is not connected , "),this.connectionState)},this._moderationInterval<this._moderationIntervalMinimum?this._moderationIntervalMinimum:this._moderationInterval),this.requestToInspectImage()}),this._moderationId=mr(5,"image-moderation-"),this._workerMessageLengthLimit=oe("IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT"),this._moderationIntervalMinimum=oe("IMAGE_MODERATION_INTERVAL_MINIMUM"),this._moderationInterval=(s=r.interval)!==null&&s!==void 0?s:1e3,r.extraInfo&&(this._extraInfo=this._encoder.encode(r.extraInfo)),r.vendor&&(this._vendor=r.vendor),this._qualityRatio=oe("IMAGE_MODERATION_QUALITY_RATIO"),this._moderationStartTime=Number(Date.now()),this._workerConnection=new $w("worker-"+this._moderationId,Di),this.on(Ld.STATE_CHANGE,(a,c)=>{x.debug("[".concat(this._moderationId,"] Moderation operation :").concat(pS[a]," ").concat(c||""))}),this.handleWorkerEvents()}async init(r,s){this.emit(Ld.STATE_CHANGE,pS.CONNECT_AP),this._connectInfo=r;const a=this._cancelTokenSource.token;return this._retryConfig=s,new pt((c,d)=>{this.on(Ld.CONNECTION_STATE_CHANGE,(h,m)=>{h===jl.CONNECTED&&c()}),this.requestAP(r,a,s).then(h=>{this.connectWorker(h)}).catch(h=>{d(h)})})}updateConfig(r){var s;this._moderationInterval=(s=r.interval)!==null&&s!==void 0?s:1e3,r.extraInfo&&(this._extraInfo=this._encoder.encode(r.extraInfo)),r.vendor&&(this._vendor=r.vendor),x.debug("[".concat(this._moderationId,"] updateConfig: ").concat(JSON.stringify(r))),this.connectionState===jl.CONNECTED&&this.inspectImage()}async requestAP(r,s,a){const c=oe("WEBCS_DOMAIN").map(y=>"https://".concat(y,"/api/v1")),d=await function(y,v,w,R){let{appId:O,areaCode:D,cname:G,sid:j,token:W,uid:Q}=v;ES++;const ee="moderation_plugin",fe={service_name:ee,json_body:JSON.stringify({appId:O,areaCode:D,cname:G,command:"allocateEdge",requestId:ES,seq:ES,sid:j,appToken:W,ts:Date.now(),uid:Q+""})};let ye,Ee,_e=y[0];return kd(async()=>{ye=Date.now();const Ne=await Md(_e,{data:fe,cancelToken:w,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(Ee=Date.now()-ye,Ne.code!==0){const yt=new Ae(te.UNEXPECTED_RESPONSE,"moderation plugin ap error, code"+Ne.code,{retry:!0,responseTime:Ee});throw x.error(yt.toString()),yt}const Ze=JSON.parse(Ne.json_body);if(Ze.code!==200){const yt=new Ae(te.UNEXPECTED_RESPONSE,"moderation plugin ap error, code: ".concat(Ze.code,", reason: ").concat(Ze.reason),{code:Ze.code,responseTime:Ee});throw x.error(yt.toString()),yt}if(!Ze.servers||!Array.isArray(Ze.servers)||Ze.servers.length===0){const yt=new Ae(te.UNEXPECTED_RESPONSE,"moderation plugin ap empty server",{code:Ze.code,responseTime:Ee});throw x.error(yt.toString()),yt}if(!Ze.servers.some(yt=>!!yt.wss)){const yt=new Ae(te.UNEXPECTED_RESPONSE,"moderation plugin ap empty port",{code:Ze.code,responseTime:Ee});throw x.error(yt.toString()),yt}const ft=oe("IMAGE_MODERATION_WORKER_HOST");return{addressList:Ze.servers.map(yt=>{let{address:An,wss:Pn}=yt;if(An&&Pn)return"wss://".concat(An.replace(/\./g,"-"),".").concat(ft,":").concat(Pn,"/moderation")}).filter(yt=>!!yt),workerToken:Ze.workerToken,vid:Ze.vid,ticket:Ze.appTicket,responseTime:Ee}},(Ne,Ze)=>(Nt.apworkerEvent(j,{success:!0,sc:200,serviceName:ee,responseDetail:JSON.stringify(Ne.addressList),firstSuccess:Ze===0,responseTime:Ee,serverIp:y[Ze%y.length]}),!1),(Ne,Ze)=>(Nt.apworkerEvent(j,{success:!1,sc:Ne.data&&Ne.data.code||200,serviceName:ee,responseTime:Ee,serverIp:y[Ze%y.length]}),!!(Ne.code!==te.OPERATION_ABORTED&&Ne.code!==te.UNEXPECTED_RESPONSE||Ne.data&&Ne.data.retry)&&(_e=y[(Ze+1)%y.length],!0)),R)}(c,r,s,a);this.emit(Ld.STATE_CHANGE,pS.AP_CONNECTED);const{addressList:h,ticket:m}=d;return this._ticket=m,h}async connectWorker(r){this.emit(Ld.STATE_CHANGE,pS.CONNECT_WORKER),await this._workerConnection.init(r,1e4)}handleWorkerEvents(){this._workerConnection.on(rn.CONNECTED,async()=>{this.emit(Ld.STATE_CHANGE,pS.WORKER_CONNECTED,this._workerConnection.url),this.connectionState=jl.CONNECTED}),this._workerConnection.on(rn.CLOSED,()=>{this.connectionState=jl.CLOSED}),this._workerConnection.on(rn.FAILED,()=>{this.connectionState=jl.CLOSED}),this._workerConnection.on(rn.RECONNECTING,()=>{this.connectionState=this.connectionState===jl.CONNECTED?jl.RECONNECTING:jl.CONNECTING}),this._workerConnection.on(rn.ON_MESSAGE,async r=>{if(r.data instanceof ArrayBuffer){const s=l_e(new Uint8Array(r.data));oe("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&x.debug("[".concat(this._moderationId,"] Response message for worker of image moderation "),JSON.stringify(s)),this._uploadNum++,s.code===void 0||s.code===0||(this._uploadFailedNum++,x.error("[".concat(this._moderationId,"] Error response from worke, code is ").concat(s.code,", msg is ").concat(s.msg)),this._uploadTimer||(this._uploadTimer=window.setTimeout(()=>{Nt.reportApiInvoke(this._connectInfo.sid||null,{name:Ni.IMAGE_MODERATION_UPLOAD,options:[this._uploadFailedNum,this._uploadNum,s.code],tag:Kr.TRACER}).onError(new Ae(te.IMAGE_MODERATION_UPLOAD_FAILED,s.msg)),this._uploadTimer=null},oe("IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL"))))}else x.error("[".concat(this._moderationId,"] Unexpected message type from worker"))}),this._workerConnection.on(rn.WILL_RECONNECT,(r,s,a)=>{r==="recover"&&a(r),a("tryNext")}),this._workerConnection.on(rn.REQUEST_NEW_URLS,(r,s)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(r).catch(s)})}static intToLong(r){return{low:r|=0,high:r>>31,unsigned:r>=0}}async requestToInspectImage(){const r=Zc(this,Ld.CLIENT_LOCAL_VIDEO_TRACK),s={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(r){if(!r.isPlaying)return void(oe("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&x.debug("Only the track being played can be inspected"));this._sequence++;const a=await this.generateRequestData(r,s);this._workerConnection.sendMessage(a,!0,!0)}else oe("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&x.debug("Only the track being published can be inspected")}async generateRequestData(r,s){let{appId:a,cname:c,cid:d,vid:h,sid:m,uid:y}=s;const v=Date.now(),w=await r.getCurrentFrameImage("image/jpeg",this.quality),R=await j8(w,a,c),O=this._sequence+"-"+d+"-"+y+"-"+v+"-"+mr(12,""),D={appId:a,cid:d,cname:c,deviceId:"",elapse:$2.intToLong(Number(v-this._moderationStartTime)),fileSize:w.buffer.byteLength,height:w.height,width:w.width,jpg:R,networkType:6,osType:7,requestId:O,sdkVersion:"4.23.2",sequence:this._sequence,sid:m,timestamp:h$(v),uid:y,vid:h,service:this._moderationMode,ticket:this._ticket,callbackData:this._extraInfo,vendorConfigs:this._vendor};this._extraInfo===void 0&&delete D.callbackData;const G=c_e(D);if(G.byteLength<this._workerMessageLengthLimit){if(oe("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")){const j=function(W){for(var Q=1;Q<arguments.length;Q++){var ee=arguments[Q]!=null?arguments[Q]:{};Q%2?p$(Object(ee),!0).forEach(function(fe){q(W,fe,ee[fe])}):Object.getOwnPropertyDescriptors?Object.defineProperties(W,Object.getOwnPropertyDescriptors(ee)):p$(Object(ee)).forEach(function(fe){Object.defineProperty(W,fe,Object.getOwnPropertyDescriptor(ee,fe))})}return W}({},D);delete j.jpg,x.debug("[".concat(this._moderationId,"] Request message for worker of image moderation service: "),JSON.stringify(j))}return G}{const j=this.quality*this._qualityRatio;return this.quality=j,await this.generateRequestData(r,{appId:a,cname:c,cid:d,vid:h,sid:m,uid:y})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=va.CancelToken.source(),this._workerConnection&&this._workerConnection.close(),this._moderationTimer&&window.clearInterval(this._moderationTimer),this._moderationTimer=null,this._uploadTimer&&window.clearTimeout(this._uploadTimer),this._uploadTimer=null,this.connectionState=jl.CLOSED,this.emit(Ld.STATE_CHANGE,pS.CLOSED)}}function f$(t){if(cr(t.interval,"interval",1e3,1/0),t&&t.extraInfo&&t.extraInfo.length>1024)throw new Ae(te.INVALID_PARAMS,"config.extraInfo length cannot exceed 1024 bytes");if(t&&t.vendor&&t.vendor.length>1024)throw new Ae(te.INVALID_PARAMS,"config.vendor length cannot exceed 1024 bytes")}const y_e={name:"ImageModeration",create:function(t){let{config:r}=t;return f$(r),new $2(r)}};var m$,g$,_$,y$,E$,v$,S$,b$,w$,T$,C$,R$,I$,A$,P$,O$,k$,N$,D$,x$,L$,M$,U$,V$,j$,F$,B$,W$,z$,G$,H$,$$,K$,q$,Y$,X$,J$,Q$,Z$,e7,t7,_t;function n7(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}function Uu(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?n7(Object(s),!0).forEach(function(a){q(t,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):n7(Object(s)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))})}return t}Xs.setLogger(x);let E_e=(m$=Ht(),g$=Ht({argsMap:(t,r)=>{if(!Array.isArray(r)){if(!(r instanceof sS))return[r];r=[r]}return r.map(s=>s?Object(s).toString():"null")}}),_$=Ht({argsMap:(t,r)=>(r||(r=[]),Array.isArray(r)||r.trackMediaType!==iS.DATA?(Array.isArray(r)||(r=[r]),r.map(s=>s.getTrackId())):[r.getChannelId()])}),y$=Ht({argsMap:(t,r,s,a)=>[typeof r=="object"?r.uid:r,s,a]}),E$=Ht({argsMap:(t,r,s)=>[r,s]}),v$=Ht({argsMap:(t,r)=>r.map(s=>{let{user:a,mediaType:c}=s;return[a==null?void 0:a.uid,c]})}),S$=Ht({argsMap:(t,r,s,a)=>[typeof r=="object"?r.uid:r,s,a]}),b$=Ht({argsMap:(t,r)=>r.map(s=>{let{user:a,mediaType:c}=s;return{uid:a==null?void 0:a.uid,mediaType:c}})}),w$=Ht(),T$=Ht(),C$=Ht(),R$=Ht(),I$=Ht(),A$=Ht(),P$=Ht(),O$=Ht(),k$=Ht(),N$=Ht(),D$=Ht(),x$=Ht(),L$=Ht(),M$=Ht(),U$=Ht(),V$=Ht({argsMap:(t,r)=>[r]}),j$=Ht(),F$=Ht(),B$=Ht(),W$=Ht(),z$=Ht(),G$=Ht(),H$=Ht(),$$=Ht(),K$=Ht({argsMap:(t,r)=>(Array.isArray(r)||(r=[r]),[JSON.stringify(r)])}),q$=Ht(),Y$=Ht(),X$=Ht(),J$=Ht(),Q$=Ht(),Z$=Ht(),e7=Ht({reportResult:!0}),t7=Ht(),_t=class extends Br{get connectionState(){return this._gateway.state}get remoteUsers(){return this._users}get localTracks(){return this._p2pChannel.getAllTracks(!0)}get uid(){return this._uid}get channelName(){return this._channelName}get localDataChannels(){return this._p2pChannel.getAllDataChannels()}get mode(){return this._config.mode}get role(){var t;return((t=this._config)===null||t===void 0?void 0:t.role)||"audience"}get codec(){return this._config.codec}get audioCodec(){return this._config.audioCodec||"opus"}get isStringUID(){return!!this._joinInfo&&!!this._joinInfo.stringUid}get __className__(){return"Client"}constructor(t,r){let s;if(super(),q(this,"store",void 0),q(this,"_uid",void 0),q(this,"_channelName",void 0),q(this,"_uintUid",void 0),q(this,"_users",[]),q(this,"_config",void 0),q(this,"_clientId",void 0),q(this,"_appId",void 0),q(this,"_sessionId",null),q(this,"_key",void 0),q(this,"_rtmConfig",{}),q(this,"_joinInfo",void 0),q(this,"_gateway",void 0),q(this,"_statsCollector",void 0),q(this,"_configDistribute",void 0),q(this,"_leaveMutex",void 0),q(this,"_publishMutex",void 0),q(this,"_renewTokenMutex",void 0),q(this,"_subscribeMutex",void 0),q(this,"_encryptionMode","none"),q(this,"_encryptionSecret",null),q(this,"_encryptionSalt",null),q(this,"_encryptDataStream",!1),q(this,"_encryptDataStreamKey",null),q(this,"_encryptDataStreamIv",null),q(this,"_proxyServer",void 0),q(this,"_turnServer",{servers:[],mode:"auto"}),q(this,"_cloudProxyServerMode","disabled"),q(this,"_isDualStreamEnabled",!1),q(this,"_defaultStreamFallbackType",void 0),q(this,"_lowStreamParameter",void 0),q(this,"_streamFallbackTypeCacheMap",new Map),q(this,"_remoteStreamTypeCacheMap",new Map),q(this,"_axiosCancelSource",va.CancelToken.source()),q(this,"_audioVolumeIndicationInterval",void 0),q(this,"_networkQualityInterval",void 0),q(this,"_userOfflineTimeout",void 0),q(this,"_streamRemovedTimeout",void 0),q(this,"_liveTranscodeStreamingClient",void 0),q(this,"_liveRawStreamingClient",void 0),q(this,"_channelMediaRelayClient",void 0),q(this,"_networkQualitySensitivity","normal"),q(this,"_p2pChannel",void 0),q(this,"_useLocalAccessPoint",!1),q(this,"_setLocalAPVersion",void 0),q(this,"_joinAndNotLeaveYet",!1),q(this,"_numberOfJoinCount",0),q(this,"_remoteDefaultVideoStreamType",void 0),q(this,"_inspect",void 0),q(this,"_moderation",void 0),q(this,"_license",void 0),q(this,"_pendingPublishedUsers",[]),q(this,"ntpAlignErrorCount",0),q(this,"remoteInboundOffset",0),q(this,"_peerConnectionState",void 0),q(this,"_handleLocalTrackEnable",(c,d,h)=>{this.publish(c,!1).then(d).catch(h)}),q(this,"_handleLocalTrackDisable",(c,d,h)=>{this.unpublish(c).then(d).catch(h)}),q(this,"_handleUserOnline",c=>{if(oe("BLOCK_LOCAL_CLIENT")&&sy(c.uid,this.channelName))return void x.debug("[".concat(c.uid,"] will be ignored in local"));this.isStringUID&&typeof c.uid!="string"&&x.error("[".concat(this._clientId,"] StringUID is Mixed with UintUID"));const d=this._users.find(h=>h.uid===c.uid);if(d)d._trust_in_room_=!0,d._is_pre_created&&(d._is_pre_created=!1,this.safeEmit(wn.USER_JOINED,d));else{const h=new sg(c.uid,c.uint_id||c.uid);this._users.push(h),x.debug("[".concat(this._clientId,"] user online"),c.uid),this.safeEmit(wn.USER_JOINED,h)}}),q(this,"_handleUserOffline",c=>{if(oe("BLOCK_LOCAL_CLIENT")&&sy(c.uid,this.channelName))return;const d=this._users.find(h=>h.uid===c.uid);d&&(this._handleRemoveStream(c),this._handleRemoveDataChannels(c),d._audio_pre_subscribed||d._video_pre_subscribed?d._is_pre_created=!0:iP(this._users,d),this._remoteStreamTypeCacheMap.delete(d.uid),this._streamFallbackTypeCacheMap.delete(d.uid),x.debug("[".concat(this._clientId,"] user offline"),c.uid,"reason:",c.reason),this.safeEmit(wn.USER_LEAVED,d,c.reason))}),q(this,"_handleAddAudioOrVideoStream",(c,d,h,m,y,v,w)=>{if(oe("BLOCK_LOCAL_CLIENT")&&sy(d,this.channelName))return;const R=this._users.find(D=>D.uid===d);if(!R)return void x.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));x.debug("[".concat(this._clientId,"] stream added with uid ").concat(d,", type ").concat(c)),this.store.subscribe(R.uid,c,void 0,void 0,void 0,Date.now());const O=c==="audio"?R.hasAudio:R.hasVideo;R._uintid||(R._uintid=y||d),c==="audio"?R._trust_audio_stream_added_state_=!0:R._trust_video_stream_added_state_=!0,c==="audio"?(R._audio_added_=!0,h!==void 0&&(R._audioSSRC=h),m!==void 0&&(R._cname=m),v&&(R._audioOrtc=v)):(R._video_added_=!0,h!==void 0&&(R._videoSSRC=h),m!==void 0&&(R._cname=m),w!==void 0&&(R._rtxSsrcId=w),v&&(R._videoOrtc=v)),(c==="audio"?R.hasAudio:R.hasVideo)&&!O&&(x.info("[".concat(this._clientId,"] remote user ").concat(R.uid," published ").concat(c)),this.safeEmit(wn.USER_PUBLISHED,R,c)),c==="video"?Nt.onGatewayStream(this._sessionId,Zi.ON_ADD_VIDEO_STREAM,Mr.ON_ADD_VIDEO_STREAM,{peer:y||d,ssrc:R._videoSSRC}):Nt.onGatewayStream(this._sessionId,Zi.ON_ADD_AUDIO_STREAM,Mr.ON_ADD_AUDIO_STREAM,{peer:y||d,ssrc:R._audioSSRC}),this._p2pChannel.remoteMediaSsrcChanged(R,c,h).then(D=>{if(D&&(x.debug("[".concat(this._clientId,"] resubscribe ").concat(c," for user ").concat(R.uid," after rejoin because SSRC id changed.")),this._p2pChannel instanceof tT))return this._p2pChannel.unsubscribe(R,c,!0).then(()=>this._subscribe(R,c,!0).catch(G=>{x.error("[".concat(this._clientId,"] resubscribe error"),G.toString())}))}),this._p2pChannel.hasPendingRemoteMedia(R,c)&&(x.debug("[".concat(this._clientId,"] resubscribe ").concat(c," for user ").concat(R.uid," after reconnect.")),this._subscribe(R,c,!0).catch(D=>{x.error("[".concat(this._clientId,"] resubscribe error"),D.toString())}))}),q(this,"_handleRemoveStream",c=>{if(oe("BLOCK_LOCAL_CLIENT")&&sy(c.uid,this.channelName))return;const d=this._users.find(m=>m.uid===c.uid);if(!d)return void x.warning("[".concat(this._clientId,"] can not find target user!(on_remove_stream)"));x.debug("[".concat(this._clientId,"] stream removed with uid ").concat(c.uid));let h=()=>{};d.hasAudio&&d.hasVideo?h=()=>{x.info("[".concat(this._clientId,"] remote user ").concat(d.uid," unpublished audio track")),this.safeEmit(wn.USER_UNPUBLISHED,d,"audio"),x.info("[".concat(this._clientId,"] remote user ").concat(d.uid," unpublished video track")),this.safeEmit(wn.USER_UNPUBLISHED,d,"video")}:d.hasVideo?h=()=>{x.info("[".concat(this._clientId,"] remote user ").concat(d.uid," unpublished video track")),this.safeEmit(wn.USER_UNPUBLISHED,d,"video")}:d.hasAudio&&(h=()=>{x.info("[".concat(this._clientId,"] remote user ").concat(d.uid," unpublished audio track")),this.safeEmit(wn.USER_UNPUBLISHED,d,"audio")}),d._video_pre_subscribed||d._audio_pre_subscribed||(d._trust_audio_stream_added_state_=!0,d._trust_video_stream_added_state_=!0,d._audio_added_=!1,d._video_added_=!1,this._p2pChannel instanceof tT&&this._p2pChannel.unsubscribe(d).then(m=>{if(m)return this._gateway.unsubscribe(m,d.uid)}),d._audioSSRC=void 0,d._videoSSRC=void 0,d._audioOrtc=void 0,d._videoOrtc=void 0,d._rtxSsrcId=void 0),Nt.onGatewayStream(this._sessionId,Zi.ON_REMOVE_STREAM,Mr.ON_REMOVE_STREAM,{peer:c.uint_id||c.uid}),h()}),q(this,"_handleSetStreamLocalEnable",(c,d,h)=>{if(oe("BLOCK_LOCAL_CLIENT")&&sy(d,this.channelName))return;const m=this._users.find(w=>w.uid===d);if(!m)return void x.error("[".concat(this._clientId,"] can not find target user!(disable_local)"));x.debug("[".concat(this._clientId,"] local ").concat(c," ").concat(h?"enabled":"disabled"," with uid ").concat(d));const y=c==="audio"?m.hasAudio:m.hasVideo;if(c==="audio"){m._trust_audio_enabled_state_=!0;const w=m._audio_enabled_;if(m._audio_enabled_=h,m._audio_enabled_===w)return;{const R=m._audio_enabled_?"enable-local-audio":"disable-local-audio";x.debug("[".concat(this._clientId,"] user-info-updated, uid: ").concat(d,", msg: ").concat(R)),this.safeEmit(wn.USER_INFO_UPDATED,d,R)}}else{m._trust_video_enabled_state_=!0;const w=m._video_enabled_;if(m._video_enabled_=h,m._video_enabled_===w)return;{const R=m._video_enabled_?"enable-local-video":"disable-local-video";x.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(d,", msg: ").concat(R)),this.safeEmit(wn.USER_INFO_UPDATED,d,R)}}const v=c==="audio"?m.hasAudio:m.hasVideo;return y!==v?!y&&v?(x.info("[".concat(this._clientId,"] remote user ").concat(d," published ").concat(c)),void this.safeEmit(wn.USER_PUBLISHED,m,c)):(c==="video"&&m._videoTrack&&m._videoTrack._destroy(),c==="audio"&&m._audioTrack,this._p2pChannel.muteRemote(m,c),x.info("[".concat(this._clientId,"] remote user ").concat(d," unpublished ").concat(c)),void this.safeEmit(wn.USER_UNPUBLISHED,m,c)):void 0}),q(this,"_handleMuteStream",(c,d,h)=>{if(oe("BLOCK_LOCAL_CLIENT")&&sy(c,this.channelName))return;x.debug("[".concat(this._clientId,"] receive mute message"),c,d,h);const m=this._users.find(w=>w.uid===c);if(!m)return void x.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(c));const y=d==="audio"?m.hasAudio:m.hasVideo;if(d==="audio"){m._trust_audio_mute_state_=!0;const w=m._audio_muted_;if(m._audio_muted_=h,m._audio_muted_===w)return;{const R=m._audio_muted_?"mute-audio":"unmute-audio";x.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(c,", msg: ").concat(R)),this.safeEmit(wn.USER_INFO_UPDATED,c,R)}}else{m._trust_video_mute_state_=!0;const w=m._video_muted_;if(m._video_muted_=h,m._video_muted_===w)return;{const R=m._video_muted_?"mute-video":"unmute-video";x.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(c,", msg: ").concat(R)),this.safeEmit(wn.USER_INFO_UPDATED,c,R)}}const v=d==="audio"?m.hasAudio:m.hasVideo;if(y!==v){if(!y&&v)return(d==="audio"?m._audioSSRC:m._videoSSRC)?(x.info("[".concat(this._clientId,"] remote user ").concat(c," published ").concat(d)),void this.safeEmit(wn.USER_PUBLISHED,m,d)):void x.warning("[".concat(this._clientId,"] remote user ").concat(c," receive ").concat(d," unmute message  before add stream message, ").concat(d," SSRC doesn't exist yet."));d==="video"&&m._videoTrack&&!m._video_pre_subscribed&&m._videoTrack._destroy(),d==="audio"&&m._audioTrack,this._p2pChannel.muteRemote(m,d),x.info("[".concat(this._clientId,"] remote user ").concat(c," unpublished ").concat(d)),this.safeEmit(wn.USER_UNPUBLISHED,m,d)}}),q(this,"_handleP2PLost",async c=>{x.debug("[".concat(this._clientId,"] receive p2p lost"),c),parseInt(c.p2pid,10)===this.store.p2pId?await this._p2pChannel.requestReconnect():x.warning("[".concat(this._clientId,"] P2PLost stream not found"),c)}),q(this,"_handleTokenWillExpire",()=>{x.debug("[".concat(this._clientId,"] received message onTokenPrivilegeWillExpire")),this.safeEmit(wn.ON_TOKEN_PRIVILEGE_WILL_EXPIRE)}),q(this,"_handleBeforeUnload",c=>{c.type==="beforeunload"&&c.returnValue!==void 0&&c.returnValue!==""||(this.leave(),x.info("[".concat(this._clientId,"] auto leave onbeforeunload or pagehide")))}),q(this,"_handleUpdateNetworkQuality",()=>{if(this._networkQualitySensitivity==="normal")return;if(navigator&&navigator.onLine!==void 0&&!navigator.onLine)return void this.safeEmit(wn.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6});const c={downlinkNetworkQuality:0,uplinkNetworkQuality:0};c.uplinkNetworkQuality=this._p2pChannel.getUplinkNetworkQuality(),c.downlinkNetworkQuality=this._p2pChannel.getDownlinkNetworkQuality(),this.safeEmit(wn.NETWORK_QUALITY,c)}),q(this,"_handleP2PAddAudioOrVideoStream",(c,d,h,m)=>{const y=this._users.find(w=>w.uid===d);if(!y)return void x.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));x.debug("[".concat(this._clientId,"] stream added with uid ").concat(d,", type ").concat(c)),this.store.subscribe(y.uid,c,void 0,void 0,void 0,Date.now());const v=c==="audio"?y.hasAudio:y.hasVideo;c==="audio"?y._trust_audio_stream_added_state_=!0:y._trust_video_stream_added_state_=!0,c==="audio"?(y._audio_added_=!0,h!==void 0&&(y._audioSSRC=h),m!==void 0&&(y._audioMid=m)):(y._video_added_=!0,h!==void 0&&(y._videoSSRC=h),m!==void 0&&(y._videoMid=m)),(c==="audio"?y.hasAudio:y.hasVideo)&&!v&&(x.info("[".concat(this._clientId,"] remote user ").concat(y.uid," published ").concat(c)),this.safeEmit(wn.USER_PUBLISHED,y,c)),this._p2pChannel.hasPendingRemoteMedia(y,c)&&(x.debug("[".concat(this._clientId,"] resubscribe ").concat(c," for user ").concat(y.uid," after reconnect.")),this._subscribe(y,c,!0).catch(w=>{x.error("[".concat(this._clientId,"] resubscribe error"),w.toString())}))}),this._config=t,this._clientId=r||mr(5,"client-"),this.store=new class{constructor(c,d,h,m){Zt(this,"state",void 0),this.state={codec:c,audioCodec:d,mode:h,clientId:m,sessionId:null,p2pId:0,dcId:0,pubId:0,subId:0,avoidJoinStart:0,keyMetrics:{publish:[],subscribe:[]},joinChannelServiceRecords:[],cloudProxyServerMode:"disabled",useP2P:!1,p2pTransport:Q_.Default,hasStartJoinChannel:!1,isABTestSuccess:!1}}dispatch(c){this.state=function(d,h){switch(h.type){case Tn.SET_SESSION_ID:return St(St({},d),{},{sessionId:h.sessionId});case Tn.SET_P2P_ID:return St(St({},d),{},{p2pId:h.p2pId});case Tn.SET_UID:return St(St({},d),{},{uid:h.uid});case Tn.SET_INT_UID:return St(St({},d),{},{intUid:h.intUid});case Tn.SET_PUB_ID:return St(St({},d),{},{pubId:h.pubId});case Tn.KEY_METRIC_CLIENT_CREATED:return St(St({},d),{},{keyMetrics:St(St({},d.keyMetrics),{},{clientCreated:h.metric})});case Tn.KEY_METRIC_JOIN_START:return St(St({},d),{},{keyMetrics:St(St({},d.keyMetrics),{},{joinStart:h.metric})});case Tn.AVOID_JOIN_START:return St(St({},d),{},{avoidJoinStart:h.avoidJoinStart});case Tn.KEY_METRIC_JOIN_END:return St(St({},d),{},{keyMetrics:St(St({},d.keyMetrics),{},{joinEnd:h.metric})});case Tn.KEY_METRIC_REQUEST_AP_START:return St(St({},d),{},{keyMetrics:St(St({},d.keyMetrics),{},{requestAPStart:h.metric})});case Tn.KEY_METRIC_REQUEST_AP_END:return St(St({},d),{},{keyMetrics:St(St({},d.keyMetrics),{},{requestAPEnd:h.metric})});case Tn.KEY_METRIC_JOIN_GATEWAY_START:return St(St({},d),{},{keyMetrics:St(St({},d.keyMetrics),{},{joinGatewayStart:h.metric})});case Tn.KEY_METRIC_JOIN_GATEWAY_END:return St(St({},d),{},{keyMetrics:St(St({},d.keyMetrics),{},{joinGatewayEnd:h.metric})});case Tn.KEY_METRIC_PEER_CONNECTION_START:return St(St({},d),{},{keyMetrics:St(St({},d.keyMetrics),{},{peerConnectionStart:h.metric})});case Tn.KEY_METRIC_PEER_CONNECTION_END:return St(St({},d),{},{keyMetrics:St(St({},d.keyMetrics),{},{peerConnectionEnd:h.metric})});case Tn.KEY_METRIC_DESCRIPTION_START:return St(St({},d),{},{keyMetrics:St(St({},d.keyMetrics),{},{descriptionStart:h.metric})});case Tn.KEY_METRIC_SIGNAL_CHANNEL_OPEN:return St(St({},d),{},{keyMetrics:St(St({},d.keyMetrics),{},{signalChannelOpen:h.metric})});case Tn.KEY_METRIC_ICE_CONNECTION_END:return St(St({},d),{},{keyMetrics:St(St({},d.keyMetrics),{},{iceConnectionEnd:h.metric})});case Tn.KEY_METRIC_PUBLISH:{const m=d.keyMetrics.publish,y=m.findIndex(v=>v.trackId===h.metric.trackId);return y!==-1?(m[y]=St(St({},m[y]),h.metric),St(St({},d),{},{keyMetrics:St(St({},d.keyMetrics),{},{publish:[...m]})})):St(St({},d),{},{keyMetrics:St(St({},d.keyMetrics),{},{publish:[...d.keyMetrics.publish,h.metric]})})}case Tn.KEY_METRIC_SUBSCRIBE:{const m=d.keyMetrics.subscribe,y=m.findIndex(v=>v.userId===h.metric.userId&&v.type===h.metric.type);return y!==-1?(m[y]=St(St({},m[y]),h.metric),St(St({},d),{},{keyMetrics:St(St({},d.keyMetrics),{},{subscribe:[...m]})})):St(St({},d),{},{keyMetrics:St(St({},d.keyMetrics),{},{subscribe:[...d.keyMetrics.subscribe,h.metric]})})}case Tn.SET_CLOUD_PROXY_SERVER_MODE:return d.cloudProxyServerMode=h.mode,d;case Tn.RECORD_JOIN_CHANNEL_SERVICE:return typeof h.index!="number"?d.joinChannelServiceRecords=[...d.joinChannelServiceRecords,h.record]:(d.joinChannelServiceRecords[h.index]=St(St({},d.joinChannelServiceRecords[h.index]),h.record),d.joinChannelServiceRecords=[...d.joinChannelServiceRecords]),d;case Tn.RESET_JOIN_CHANNEL_SERVICE_RECORDS:return d.joinChannelServiceRecords=[],d;case Tn.RESET_KEY_METRICS:return d.keyMetrics={publish:[],subscribe:[]},d;case Tn.SET_USE_P2P:return St(St({},d),{},{useP2P:h.val});case Tn.SET_TRANSPORT_TYPE:return St(St({},d),{},{p2pTransport:h.val});default:return d}}(this.state,c)}set sessionId(c){this.dispatch({type:Tn.SET_SESSION_ID,sessionId:c})}get sessionId(){return this.state.sessionId}set cid(c){this.state.cid=c}get cid(){return this.state.cid}set codec(c){this.state.codec=c}get codec(){return this.state.codec}get mode(){return this.state.mode}get audioCodec(){return this.state.audioCodec}get clientId(){return this.state.clientId}set p2pId(c){this.dispatch({type:Tn.SET_P2P_ID,p2pId:c})}get p2pId(){return this.state.p2pId}set dcId(c){this.dispatch({type:Tn.SET_DC_ID,dcId:c})}get dcId(){return this.state.dcId}set uid(c){this.dispatch({type:Tn.SET_UID,uid:c})}get uid(){return this.state.uid}set intUid(c){this.dispatch({type:Tn.SET_INT_UID,intUid:c})}get intUid(){return this.state.intUid}set pubId(c){this.dispatch({type:Tn.SET_PUB_ID,pubId:c})}get pubId(){return this.state.pubId}set cloudProxyServerMode(c){this.dispatch({type:Tn.SET_CLOUD_PROXY_SERVER_MODE,mode:c})}get cloudProxyServerMode(){return this.state.cloudProxyServerMode}set useP2P(c){this.dispatch({type:Tn.SET_USE_P2P,val:c})}get useP2P(){return this.state.useP2P}set p2pTransport(c){this.dispatch({type:Tn.SET_TRANSPORT_TYPE,val:c})}get p2pTransport(){return this.state.p2pTransport}set hasStartJoinChannel(c){this.state.hasStartJoinChannel=c}get hasStartJoinChannel(){return this.state.hasStartJoinChannel}set isABTestSuccess(c){this.state.isABTestSuccess=c}get isABTestSuccess(){return this.state.isABTestSuccess}clientCreated(){this.dispatch({type:Tn.KEY_METRIC_CLIENT_CREATED,metric:Date.now()})}joinStart(){this.dispatch({type:Tn.KEY_METRIC_JOIN_START,metric:Date.now()})}joinEnd(){this.dispatch({type:Tn.KEY_METRIC_JOIN_END,metric:Date.now()})}requestAPStart(){this.dispatch({type:Tn.KEY_METRIC_REQUEST_AP_START,metric:Date.now()})}requestAPEnd(){this.dispatch({type:Tn.KEY_METRIC_REQUEST_AP_END,metric:Date.now()})}joinGatewayStart(){this.dispatch({type:Tn.KEY_METRIC_JOIN_GATEWAY_START,metric:Date.now()})}joinGatewayEnd(){this.dispatch({type:Tn.KEY_METRIC_JOIN_GATEWAY_END,metric:Date.now()})}peerConnectionStart(){this.dispatch({type:Tn.KEY_METRIC_PEER_CONNECTION_START,metric:Date.now()})}peerConnectionEnd(){this.dispatch({type:Tn.KEY_METRIC_PEER_CONNECTION_END,metric:Date.now()})}descriptionStart(){this.dispatch({type:Tn.KEY_METRIC_DESCRIPTION_START,metric:Date.now()})}signalChannelOpen(){this.dispatch({type:Tn.KEY_METRIC_SIGNAL_CHANNEL_OPEN,metric:Date.now()})}iceConnectionEnd(){this.dispatch({type:Tn.KEY_METRIC_ICE_CONNECTION_END,metric:Date.now()})}publish(c,d,h,m){this.dispatch({type:Tn.KEY_METRIC_PUBLISH,metric:St(St({trackId:c,type:d},h&&{publishStart:h}),m&&{publishEnd:m})})}subscribe(c,d,h,m,y,v,w){this.dispatch({type:Tn.KEY_METRIC_SUBSCRIBE,metric:St(St(St(St(St({userId:c,type:d},h&&{subscribeStart:h}),m&&{subscribeEnd:m}),y&&{firstFrame:y}),v&&{streamAdded:v}),w&&{firstDecoded:w})})}massSubscribe(c,d,h,m){c.forEach(y=>{this.dispatch({type:Tn.KEY_METRIC_SUBSCRIBE,metric:St(St(St({userId:y.userId,type:y.type},d&&{subscribeStart:d}),h&&{subscribeEnd:h}),m&&{firstFrame:m})})})}get keyMetrics(){return this.state.keyMetrics}recordJoinChannelService(c,d){c.service==="gateway"&&Array.isArray(c.urls)&&(c.urls=c.urls.map(h=>h.replace(/(\d+)-\d+-\d+-(\d+)/,"$1-*-*-$2")));try{return typeof d!="number"?(this.dispatch({type:Tn.RECORD_JOIN_CHANNEL_SERVICE,record:St(St({},c),{},{sessionId:this.sessionId,cloudProxyMode:this.cloudProxyServerMode,uid:this.uid})}),this.state.joinChannelServiceRecords.length-1):(d<0||d>=this.state.joinChannelServiceRecords.length||this.dispatch({type:Tn.RECORD_JOIN_CHANNEL_SERVICE,record:c,index:d}),d)}catch{return 0}}resetJoinChannelServiceRecords(){this.dispatch({type:Tn.RESET_JOIN_CHANNEL_SERVICE_RECORDS})}resetKeyMetrics(){this.dispatch({type:Tn.RESET_KEY_METRICS})}get joinChannelServiceRecords(){try{return this.state.joinChannelServiceRecords}catch{return[]}}get avoidJoinStart(){return this.state.avoidJoinStart}set avoidJoinStart(c){this.dispatch({type:Tn.AVOID_JOIN_START,avoidJoinStart:c})}}(t.codec,t.audioCodec,t.mode,this._clientId),this._leaveMutex=new Xs("client-leave",this._clientId),this._publishMutex=new Xs("client-publish",this._clientId),this._renewTokenMutex=new Xs("client-renewtoken",this._clientId),this._subscribeMutex=new Xs("client-subscribe",this._clientId),this.store.clientCreated(),t.proxyServer&&this.setProxyServer(t.proxyServer,!0),t.turnServer&&this.setTurnServer(t.turnServer,!0),x.info("[".concat(this._clientId,"] Initializing AgoraRTC client v").concat(Ml," build: ").concat(VL,", mode: ").concat(this.mode,", codec: ").concat(this.codec)),t.clientRoleOptions)try{CL(t.clientRoleOptions),s=Object.assign({},t.clientRoleOptions)}catch(c){x.warning("[".concat(this._clientId,"] ").concat(c.toString()))}var a;this._statsCollector=new Zw(this.store),this._statsCollector.onStatsException=(c,d,h)=>{x.warn("[".concat(this._clientId,"] receive exception msg, code: ").concat(c,", msg: ").concat(d,", uid: ").concat(h)),this.safeEmit(wn.EXCEPTION,{code:c,msg:d,uid:h})},this._statsCollector.onUploadPublishDuration=(c,d,h,m)=>{const y=this._users.find(v=>v.uid===c);y&&Nt.peerPublishStatus(this._sessionId,{subscribeElapse:m,audioPublishDuration:d,videoPublishDuration:h,peer:y._uintid})},this.store.useP2P=t.mode==="p2p",this._gateway=new Uge(this.store,{clientId:this._clientId,mode:this.mode,codec:this.codec,websocketRetryConfig:t.websocketRetryConfig||Di,httpRetryConfig:t.httpRetryConfig||Di,forceWaitGatewayResponse:t.forceWaitGatewayResponse===void 0||t.forceWaitGatewayResponse,statsCollector:this._statsCollector,role:t.role,clientRoleOptions:s}),this._configDistribute=new Kge(this._clientId,this.store),this.store.useP2P?(this._p2pChannel=(a={store:this.store,statsCollector:this._statsCollector},Sf("P2PChannel").create(a)),this._handleP2PEvents()):this._p2pChannel=new tT(this.store,this._statsCollector),this._handleP2PChannelEvents(),this._handleGatewayEvents(),this._handleGatewaySignalEvents()}async joinMeta(t,r,s,a,c){let d=!(arguments.length>5&&arguments[5]!==void 0)||arguments[5],h=arguments.length>6&&arguments[6]!==void 0&&arguments[6];sr("JOIN_GATEWAY_USE_443PORT_ONLY",d),sr("JOIN_GATEWAY_USE_DUAL_DOMAIN",h);const m=this._gateway.signal.websocket;return m instanceof _2&&(m.use443PortOnly=d,m.tryDoubleDomain=h),async function(y,v,w){ZA.get(y)||ZA.set(y,[]),eP.get(y)||eP.set(y,v),Oh.get(y)||Oh.set(y,0);const R=ZA.get(y),O=eP.get(y);if(!R||!O)throw new Error("concurrent: deferQueue or maxConcurrency is null");if(Oh.get(y)===O){const Q=Ow();R.push(Q),await Q.promise}Oh.set(y,Oh.get(y)+1);for(var D=arguments.length,G=new Array(D>3?D-3:0),j=3;j<D;j++)G[j-3]=arguments[j];const W=await w(...G);return Oh.set(y,Oh.get(y)-1),Oh.get(y)===O-1&&R.length>0&&(R[0].resolve(),R.shift()),Oh.get(y)===0&&(ZA.set(y,[]),eP.set(y,0),Oh.set(y,0)),W}("client.join",oe("JOIN_MAX_CONCURRENCY"),this.join.bind(this),t,r,s,a,c)}async join(t,r,s,a,c){const d=++this._numberOfJoinCount;this.store.joinStart(),a&&(this.store.uid=a);const h=(aP||aP||(aP=(window.location.protocol.split(":")[0]||"").toUpperCase(),aP))==="HTTPS",m=Zz()?window.isSecureContext:"Browser Not Support";(!Zz()&&!h||!window.isSecureContext)&&x.warning("The website must be running in a secure context (About secure context: https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts ), otherwise the media collection will be restricted by the browser"),this.connectionState==="DISCONNECTED"&&(this.store.avoidJoinStart=Math.round(Date.now()),x.debug("[".concat(this._clientId,"] set avoidJoinStart to ").concat(this.store.avoidJoinStart))),Nt.setAppId(t);try{if(!s&&s!==null)throw new Ae(te.INVALID_PARAMS,"Invalid token: ".concat(s,". If you don not use token, set it to null"));s&&_s(s,"token",1,2047),_s(t,"appid",1,2047),PP(r),a&&OP(a),c&&_s(c,"optionalInfo",1,2047)}catch(j){throw Nt.reportApiInvoke(J_(),{name:Ni.JOIN,options:[t,r,s,a],states:{isHttps:h,isSecureContext:m},tag:Kr.TRACER}).onError(j),j}if(this._leaveMutex.isLocked&&(x.debug("[".concat(this._clientId,"] join: waiting leave operation")),(await this._leaveMutex.lock())(),x.debug("[".concat(this._clientId,"] join: continue"))),this._joinAndNotLeaveYet=!0,this.connectionState!=="DISCONNECTED"){const j=new Ae(te.INVALID_OPERATION,"[".concat(this._clientId,"] Client already in connecting/connected state"));throw Nt.reportApiInvoke(J_(),{name:Ni.JOIN,options:[t,r,s,a],states:{isHttps:h,isSecureContext:m},tag:Kr.TRACER}).onError(j),j}this._gateway.state="CONNECTING";const y=await Q9({appId:t,cname:r,uid:a,stringUid:typeof a=="string"?a:void 0,token:s||t,cloudProxyServer:this._cloudProxyServerMode});if(!this._joinAndNotLeaveYet)throw new Ae(te.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));const v=(y==null?void 0:y.sid)||J_();x.info("[".concat(this._clientId,"] start join channel ").concat(r,", join number: ").concat(d)),this._sessionId||(this._sessionId=v,this.store.sessionId=this._sessionId);const w=Nt.reportApiInvoke(v,{id:this._clientId,name:Ni.JOIN,options:[t,r,s,a],states:{isHttps:h,isSecureContext:m},tag:Kr.TRACER}),R=Uu(Uu(Uu({},this._rtmConfig),{},{role:this.role,clientId:this._clientId,appId:t,sid:this._sessionId,cname:r,uid:typeof a!="string"?a:null,turnServer:this._turnServer,proxyServer:this._proxyServer,token:s||t,cloudProxyServer:this._cloudProxyServerMode,optionalInfo:c,license:this._license,useLocalAccessPoint:this._useLocalAccessPoint,preload:!!y},this._remoteDefaultVideoStreamType!==void 0&&{defaultVideoStream:this._remoteDefaultVideoStreamType}),{},{apRequestDetail:oe("AP_REQUEST_DETAIL")||void 0});if(this._useLocalAccessPoint&&(R.setLocalAPVersion=this._setLocalAPVersion),typeof a=="string"&&(R.stringUid=a,this._uintUid?(R.uid=this._uintUid,this._uintUid=void 0):R.uid=0),this._encryptionMode!=="none"&&this._encryptionSecret){if(R.aesmode=this._encryptionMode,R.aespassword=await(async j=>{const W=function(ye){const Ee=window.atob(`MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDCMnXAHkKIGAM+x4N22gCI+Wyu
STM9ztkT3uYslTT2PuKmZfPzhH6kVdO7PTjGCOZnAsyb3oTtWat0KcxQ4jxvqQV+
HvYl3iI1Yd4vl2c3qRMJPLtRDfNxa2Mcxgq7e9aEUibzdd0st+OJAy3tOj/Y0aVy
xQiYDz3vqa6bP29adwIDAQAB`),_e=new Uint8Array(new ArrayBuffer(Ee.length));for(let Ne=0;Ne<Ee.length;Ne+=1)_e[Ne]=Ee.charCodeAt(Ne);return _e}(),Q=await window.crypto.subtle.importKey("spki",W,{name:"RSA-OAEP",hash:"SHA-256"},!0,["encrypt"]),ee=wL(j),fe=await window.crypto.subtle.encrypt({name:"RSA-OAEP"},Q,ee);return function(ye){let Ee="";for(let _e=0;_e<ye.length;_e+=1)Ee+=String.fromCharCode(ye[_e]);return window.btoa(Ee)}(new Uint8Array(fe))})(this._encryptionSecret),!this._joinAndNotLeaveYet)throw new Ae(te.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));this._encryptionSalt&&(R.aessalt=this._encryptionSalt)}if(this._encryptDataStream&&(this._encryptionMode==="aes-128-gcm2"||this._encryptionMode==="aes-256-gcm2"))if(this._encryptionSalt&&this._encryptionSecret)if(window.crypto.subtle){const j=new TextEncoder,W=oe("USE_PURE_ENCRYPTION_MASTER_KEY")?j.encode(R.appId+this._encryptionSecret+this._encryptionSecret):j.encode(R.appId+R.cname+this._encryptionSecret);this._encryptDataStreamIv=await async function(Q,ee,fe){const ye=await window.crypto.subtle.importKey("raw",ee,"PBKDF2",!1,["deriveBits","deriveKey"]),Ee=Q==="aes-128-gcm2"?128:256,_e=await window.crypto.subtle.deriveBits({name:"PBKDF2",iterations:l8,hash:"SHA-256",salt:fe},ye,Ee+pme);return new Uint8Array(_e).subarray(Ee/8)}(this._encryptionMode,W,X_(this._encryptionSalt)),this._encryptDataStreamKey=await async function(Q,ee,fe){const ye=await window.crypto.subtle.importKey("raw",ee,"PBKDF2",!1,["deriveBits","deriveKey"]),Ee=Q==="aes-128-gcm2"?128:256;return await window.crypto.subtle.deriveKey({name:"PBKDF2",iterations:l8,hash:"SHA-256",salt:fe},ye,{name:"AES-GCM",length:Ee},!0,["encrypt","decrypt"])}(this._encryptionMode,W,X_(this._encryptionSalt))}else m?x.warning("[".concat(this._clientId,"] encrypt datastream must be running in a secure context, fallback to plain data stream")):x.warning("[".concat(this._clientId,"] current browser do not support WebCrypto ,fallback to plain data stream")),this._encryptDataStream=!1;else this._encryptDataStream=!1,x.debug("[".concat(this._clientId,"] no salt / secret, cannot support encrypt data stream, fallback to plain data stream"));this._startSession(this._sessionId,{channel:r,appId:t,stringUid:R.stringUid});const O=this._sessionId;setTimeout(()=>{this.connectionState==="CONNECTING"&&O===this._sessionId&&Nt.joinChannelTimeout(this._sessionId,5)},5e3);try{var D;let j;const W=R.cloudProxyServer;if(lt(D=["proxy3","proxy4","proxy5"]).call(D,W)){const Ee=oe("PROXY_SERVER_TYPE3");Array.isArray(Ee)?R.proxyServer=Ee[0]:R.proxyServer=Ee}if(Nt.setProxyServer(R.proxyServer),x.setProxyServer(R.proxyServer),this.store.requestAPStart(),y){if(x.debug("[".concat(this._clientId,"] get serverInfo Success from Preload Cache ").concat(R.stringUid?", ".concat(R.stringUid," => ").concat(y.intUid):""," ")),R.stringUid&&!R.uid&&(R.uid=y.intUid),j={gatewayInfo:y.ap.gatewayInfo},oe("JOIN_WITH_FALLBACK_MEDIA_PROXY")&&R.turnServer.mode==="auto")if(y.ap.proxyInfo.addresses.length===0)x.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers");else{const Ee=(await GH(y.ap.proxyInfo,y.ap.gatewayInfo.uid)).map(_e=>({turnServerURL:_e.address,tcpport:_e.tcpport||Us.tcpport,udpport:_e.udpport||Us.udpport,username:_e.username||Us.username,password:_e.password||Us.password,forceturn:!1,security:!0}));R.turnServer={mode:"manual",servers:Ee}}t$(y,R.stringUid)}else{if(R.stringUid&&!R.uid){let Ee;[Ee,j]=await pt.all([y9(R.stringUid,R,this._axiosCancelSource.token,this._config.httpRetryConfig||Di,this.store),_9(R,this._axiosCancelSource.token,this._config.httpRetryConfig||Di,!0,this.store)]),x.debug("[".concat(this._clientId,"] getUserAccount Success ").concat(R.stringUid," => ").concat(Ee)),R.uid=Ee,j.gatewayInfo.uid=Ee,j.gatewayInfo.res.uid=Ee}else j=await _9(R,this._axiosCancelSource.token,this._config.httpRetryConfig||Di,!0,this.store);if(!this._joinAndNotLeaveYet)throw new Ae(te.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"))}this.store.requestAPEnd(),setTimeout(()=>{this._configDistribute.startGetConfigDistribute(R,this._axiosCancelSource.token),this._configDistribute.on(Gw.UPDATE_BITRATE_LIMIT,Ee=>{this._p2pChannel.updateBitrateLimit(Ee)}),this._configDistribute.on(Gw.UPDATE_CLIENT_ROLE_OPTIONS,Ee=>{this._setClientRoleOptions(Ee)})},0),this._key=s||t;const Q=j.gatewayInfo,ee=R.uid?R.uid:Q.uid;this._joinInfo=Uu(Uu({},R),{},{cid:Q.cid,uid:ee,vid:Q.vid,apResponse:Q.res,apGatewayAddress:Q.apGatewayAddress,uni_lbs_ip:Q.uni_lbs_ip,gatewayAddrs:Q.gatewayAddrs}),this.store.intUid=ee,this.store.cid=Q.cid;const fe=await this._joinGateway();if(!this._joinAndNotLeaveYet)throw new Ae(te.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));w.onSuccess(fe),this._appId=t,this._channelName=R.cname,this._uid=fe,this.store.uid=fe,setTimeout(()=>{this._networkQualityInterval&&window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=window.setInterval(this._handleUpdateNetworkQuality,2e3),window.addEventListener(xs()?"beforeunload":"pagehide",this._handleBeforeUnload),this._statsCollector.startUpdateStats()},0);const ye=R.stringUid?"string uid: ".concat(R.stringUid,",uid: ").concat(R.uid):"uid: ".concat(this._uid);return x.info("[".concat(this._clientId,"] Joining channel success: channel: ").concat(r,",").concat(ye)),setTimeout(()=>{x.startUpload()},5e3),this.store.joinEnd(),G=this,lt(iy).call(iy,G)||iy.push(G),this._cloudProxyServerMode==="disabled"&&Wn().supportWebCrypto&&oe("ENABLE_PRELOAD")&&G2(this._joinInfo),fe}catch(j){const W=Array.isArray(j)?j[0]:j;throw W&&W.code===te.OPERATION_ABORTED?x.warning("[".concat(this._clientId,"] join number: ").concat(d,", Joining channel failed, rollback"),W):x.error("[".concat(this._clientId,"] join number: ").concat(d,", Joining channel failed, rollback"),W),W.code!==te.OPERATION_ABORTED&&this._numberOfJoinCount===d&&(this._gateway.state="DISCONNECTED",this._reset()),w.onError(W),W}var G}_joinGateway(){if(!this._joinInfo||!this._key)throw new Ae(te.INVALID_OPERATION);return this._gateway.join(this._joinInfo,this._key,!(this._joinInfo.cloudProxyServer!=="disabled"||this._joinInfo.proxyServer||!oe("JOIN_WITH_FALLBACK_SIGNAL_PROXY")))}async leave(){x.info("[".concat(this._clientId,"] Leaving channel")),window.removeEventListener(xs()?"beforeunload":"pagehide",this._handleBeforeUnload),this._reset(),function(r){const s=iy.indexOf(r);s!==-1&&iy.splice(s,1)}(this),this._statsCollector.stopUpdateStats();const t=await this._leaveMutex.lock();if(this.connectionState==="DISCONNECTED")return x.info("[".concat(this._clientId,"] Leaving channel repeated, success")),void t();await this._gateway.leave(this.connectionState!=="CONNECTED",Xn.LEAVE),x.info("[".concat(this._clientId,"] Leaving channel success")),this._joinAndNotLeaveYet=!1,this.store.resetJoinChannelServiceRecords(),t()}async publish(t){let r=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!Array.isArray(t)){if(!(t instanceof sS))return this._publishDataChannel(t);t=[t]}if(t.length===0)throw new Ae(te.INVALID_PARAMS,"param list is empty");const s=t;if(this._gateway.role==="audience")throw new Ae(te.INVALID_OPERATION,"audience can not publish stream");for(const c of s){if(!(c instanceof sS))throw new Ae(te.INVALID_PARAMS,"parameter is not local track");if(!c._enabled&&r)throw new Ae(te.TRACK_IS_DISABLED,"can not publish a disabled track: ".concat(c.getTrackId()))}x.info("[".concat(this._clientId,"] Publishing tracks, id ").concat(s.map(c=>"".concat(c.getTrackId()," "))));const a=await this._publishMutex.lock();await this._configDistribute.awaitConfigDistributeComplete(),r&&s.forEach(c=>{const d=this._configDistribute.getBitrateLimit();c instanceof Ir&&d&&c.setBitrateLimit(d.uplink)});try{await this._publishHighStream(s),x.info("[".concat(this._clientId,"] Publish success, id ").concat(s.map(c=>"".concat(c.getTrackId()," "))))}catch(c){throw x.error("[".concat(this._clientId,"] publish error"),c.toString()),c}finally{a()}}async _publishDataChannel(t){cr(t.id,"id",0,65535,!0),ff(t.ordered,"ordered"),_s(t.metadata,"metadata",0,512),x.info("[".concat(this._clientId,"] Publishing datachannels, id ").concat(t.id));const r=await this._publishMutex.lock();try{if(this._p2pChannel.getAllDataChannels().findIndex(c=>c.id===t.id)!==-1)throw new Ae(te.INVALID_PARAMS,"Invalid id: ".concat(t.id,". If you want to republish the datachannel, unpublish first"));if(!this._joinInfo||this._uid===void 0)throw new Ae(te.INVALID_OPERATION,"Can't publish datachannel, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Ae(te.INVALID_OPERATION,"can not publish datachannel in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&oe("FORCE_TURN")&&!oe("TURN_ENABLE_TCP")&&!oe("TURN_ENABLE_UDP"))throw new Ae(te.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");const s=function(c){return c9(c,!1)}(t),a=await this._p2pChannel.publishDataChannel([s]);if(a.length>0){if(typeof s._originDataChannelId!="number")throw x.error("[".concat(this._clientId,"] can not publish with mediaType datachannel, cannot get RTCDatachannel id")),new Ae(te.CREATE_DATACHANNEL_ERROR);try{await pt.all(a.map(c=>this._uid&&this._gateway.publishDataChannel(this._uid,c,!0))),await s._waitTillOpen()}catch(c){if(c.code!==te.DISCONNECT_P2P)throw c}}return x.info("[".concat(this._clientId,"] Publish dataChannels success, id ").concat(s.id)),s}catch(s){throw x.error("[".concat(this._clientId,"] publish datachannels error"),s.toString()),s}finally{r()}}async unpublish(t){if(!this._joinInfo||this._uid===void 0)throw new Ae(te.INVALID_OPERATION,"Can't unpublish stream, haven't joined yet!");let r=[];if(t)if(Array.isArray(t))r=t;else{if(!(t instanceof sS))return this._unpublishDataChannel([t]);r=[t]}else this.store.useP2P||await this._unpublishDataChannel(),r=this._p2pChannel.getAllTracks(!0);x.info("[".concat(this._clientId,"] Unpublish tracks, tracks ").concat(r.map(a=>"".concat(a.getTrackId()," "))," "));const s=await this._publishMutex.lock();try{if(this.store.useP2P){const a=await this._p2pChannel.unpublish(r);a&&await this._gateway.sendExtensionMessage(hi.UNPUBLISH,{unpubMsg:a},!0)}else{const a=await this._p2pChannel.unpublish(r);a&&await this._gateway.unpublish(a,this._uid),x.info("[".concat(this._clientId,"] Unpublish success,tracks ").concat(r.map(c=>"".concat(c.getTrackId()))))}}catch(a){throw x.error("[".concat(this._clientId,"] unpublish error"),a.toString()),a}finally{s&&s()}}async _unpublishDataChannel(t){t!==void 0&&t.length!==0||(t=this._p2pChannel.getAllDataChannels()),x.info("[".concat(this._clientId,"] Unpublish datachannels, datachannels ").concat(t.map(s=>"".concat(s.id," "))," "));const r=await this._publishMutex.lock();try{const s=await this._p2pChannel.unpublishDataChannel(t);s&&await this._gateway.unpublishDataChannel(s),x.info("[".concat(this._clientId,"] Unpublish dataChannel success,dataChannel ").concat(t.map(a=>"".concat(a.id))))}catch(s){throw x.error("[".concat(this._clientId,"] unpublish dataChannel error"),s.toString()),s}finally{r&&r()}}async subscribe(t,r,s){if(!(t instanceof sg)){const a=this.remoteUsers.find(c=>c.uid===t);if(!a)throw new Ae(te.INVALID_REMOTE_USER,"user is not in the channel");t=a}return r==="datachannel"?this._subscribeDataChannel(t,s):this._subscribe(t,r)}async presubscribe(t,r){if($i(r,"mediaType",["audio","video"]),this.store.useP2P)throw new Ae(te.INVALID_OPERATION,"can't presub at p2p mode");if(!this._joinInfo)throw new Ae(te.INVALID_OPERATION,"can't presub when not join");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Ae(te.INVALID_OPERATION,"can't presub in ".concat(this.connectionState," state"));const s=r===bt.AUDIO,a=r===bt.VIDEO,c=await this._subscribeMutex.lock();try{const{ssrcId:d,ortc:h,rtxSsrcId:m,cname:y,uint_id:v}=await this._gateway.presubscribe(t,r,!0);if(d==null)throw new Ae(te.UNEXPECTED_RESPONSE,"no ssrc id");let w=this._users.find(O=>O.uid===t);w||(w=new sg(t,v||t),w._is_pre_created=!0,this._users.push(w)),y&&(w._cname=y),w._uintid||(w._uintid=v||t),s&&(w._audioSSRC=d,w._audio_pre_subscribed=!0,h&&(w._audioOrtc=h)),a&&(w._videoSSRC=d,w._video_pre_subscribed=!0,h&&(w._videoOrtc=h),m!=null&&(w._rtxSsrcId=m)),x.info("[".concat(this._clientId,"] presub succeed ssrc: ").concat(d)),await this._p2pChannel.subscribe(w,r,d,m,h);const R=s?w._audioTrack:w._videoTrack;if(!R)throw new Ae(te.UNEXPECTED_ERROR,"can not find remote track in user");return s&&(w._trust_audio_stream_added_state_=!0,w._audio_added_=!0),a&&(w._trust_video_stream_added_state_=!0,w._video_added_=!0),R}catch(d){throw x.error("[".concat(this._clientId,"] presub user ").concat(t," error"),d),d}finally{c()}}async _subscribeDataChannel(t,r){var s;if(cr(r,"channelId",0,65535,!0),!this._joinInfo)throw new Ae(te.INVALID_OPERATION,"Can't subscribe datachannel, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Ae(te.INVALID_OPERATION,"Can't subscribe datachannel in ".concat(this.connectionState," state"));if(!this._users.find(m=>m===t))throw x.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", this user is not in the channel")),new Ae(te.INVALID_REMOTE_USER,"user is not in the channel");if(!t.hasAudio&&!t.hasVideo&&t._dataChannels.length===0)throw x.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", user is not published")),new Ae(te.INVALID_REMOTE_USER,"user is not published");const c=(s=t._dataChannels)===null||s===void 0?void 0:s.find(m=>m.id===r);if(!c)throw x.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid," with mediaType datachannel, remote datachannel is not published")),new Ae(te.REMOTE_USER_IS_NOT_PUBLISHED);const d=await this._subscribeMutex.lock();x.info("[".concat(this._clientId,"] subscribe user ").concat(t.uid,", mediaType: datachannel"));try{const m=await this._p2pChannel.subscribeDataChannel(t,[c]);if(m&&lt(m).call(m,c.id))try{var h;if(typeof c._originDataChannelId!="number")throw x.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid," with mediaType datachannel, cannot get RTCDatachannel")),new Ae(te.CREATE_DATACHANNEL_ERROR);const y={id:c.id,datachannelId:c._originDataChannelId,ordered:c.ordered,maxRetransmits:c.maxRetransmits,metadata:(h=c.metadata)!==null&&h!==void 0?h:""};await this._gateway.subscribeDataChannel(t.uid,y,!0),await c._waitTillOpen()}catch(y){if((y==null?void 0:y.code)!==te.WS_ABORT)throw await this._p2pChannel.unsubscribeDataChannel(t,[c]),y;await this._p2pChannel.unsubscribeDataChannel(t,[c]),this._p2pChannel.setPendingRemoteDataChannel(t,c.id)}return x.info("[".concat(this._clientId,"] subscribe success user ").concat(t.uid,", mediaType: datachannel")),c}finally{d()}}async _p2pSubscribe(t,r,s){if($i(r,"mediaType",["audio","video"]),!this._joinInfo)throw new Ae(te.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Ae(te.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(d=>d===t)){const d=new Ae(te.INVALID_REMOTE_USER,"user is not in the channel");throw x.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", this user is not in the channel")),d}if(!t.hasAudio&&!t.hasVideo){const d=new Ae(te.INVALID_REMOTE_USER,"user is not published");throw x.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", user is not published")),d}if(!s&&(r==="audio"&&!t.hasAudio||r==="video"&&!t.hasVideo)){const d=new Ae(te.REMOTE_USER_IS_NOT_PUBLISHED);throw x.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid," with mediaType ").concat(r,", remote track is not published")),d}const c=await this._subscribeMutex.lock();x.info("[".concat(this._clientId,"] subscribe user ").concat(t.uid,", mediaType: ").concat(r));try{if(await this._p2pChannel.hasRemoteMediaWithLock(t,r))await this._p2pChannel.unmuteRemote(t,r);else try{const h=r==="audio"?t._audioSSRC:t._videoSSRC,m=r==="audio"?t._audioMid:t._videoMid;this.store.subscribe(t.uid,r,Date.now()),this.store.useP2P&&await this._p2pChannel.subscribe(t,r,h,m)}catch(h){throw h}x.info("[".concat(this._clientId,"] subscribe success user ").concat(t.uid,", mediaType: ").concat(r)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(t.uid,this._defaultStreamFallbackType).catch(h=>{x.warning("[".concat(this._clientId,"] auto set fallback failed"),h)});const d=r==="audio"?t._audioTrack:t._videoTrack;if(!d)throw new Ae(te.UNEXPECTED_ERROR,"can not find remote track in user object");return d}catch(d){throw x.error("[".concat(this._clientId,"] subscribe user ").concat(t.uid," error"),d),d}finally{c()}}async _subscribe(t,r,s){if(this.store.useP2P)return this._p2pSubscribe(t,r);if($i(r,"mediaType",["audio","video"]),!this._joinInfo)throw new Ae(te.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Ae(te.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(v=>v===t)){const v=new Ae(te.INVALID_REMOTE_USER,"user is not in the channel");throw x.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", this user is not in the channel")),v}if(!t.hasAudio&&!t.hasVideo){const v=new Ae(te.INVALID_REMOTE_USER,"user is not published");throw x.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", user is not published")),v}if(!(s||(r!=="audio"||t.hasAudio&&t._audioSSRC!==void 0)&&(r!=="video"||t.hasVideo&&t._videoSSRC!==void 0))){const v=new Ae(te.REMOTE_USER_IS_NOT_PUBLISHED);throw x.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid," with mediaType ").concat(r,", remote track is not published")),v}let c=r==="audio"?t._audioSSRC:t._videoSSRC,d=r==="audio"?t._audioOrtc:t._videoOrtc,h=r==="video"?t._rtxSsrcId:void 0,m={stream_type:r==="audio"?bt.AUDIO:bt.VIDEO,ssrcId:c};const y=await this._subscribeMutex.lock();x.info("[".concat(this._clientId,"] subscribe user ").concat(t.uid,", mediaType: ").concat(r));try{if(await this._p2pChannel.hasRemoteMediaWithLock(t,r))await this._p2pChannel.unmuteRemote(t,r);else try{const w=r==="audio"?t._audioSSRC:t._videoSSRC;w!==void 0&&w!==c&&(c=w,d=r==="audio"?t._audioOrtc:t._videoOrtc,h=r==="video"?t._rtxSsrcId:void 0,m={stream_type:r==="audio"?bt.AUDIO:bt.VIDEO,ssrcId:c}),Zs.markSubscribeStart(this.store.clientId,c),this.store.subscribe(t.uid,r,Date.now()),await this._p2pChannel.subscribe(t,r,c,h,d);try{this._p2pChannel.isPreSubScribe(c)||await this._gateway.subscribe(t.uid,m,!0)}catch(R){if((R==null?void 0:R.code)!==te.WS_ABORT)throw await this._p2pChannel.unsubscribe(t,r),R;await this._p2pChannel.unsubscribe(t,r,!0),this._p2pChannel.setPendingRemoteMedia(t,r)}this.store.subscribe(t.uid,r,void 0,Date.now()),this._p2pChannel.reportSubscribeEvent(!0,null,t,r)}catch(w){throw this._p2pChannel.reportSubscribeEvent(!1,w==null?void 0:w.code,t,r),w}x.info("[".concat(this._clientId,"] subscribe success user ").concat(t.uid,", mediaType: ").concat(r)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(t.uid,this._defaultStreamFallbackType).catch(w=>{x.warning("[".concat(this._clientId,"] auto set fallback failed"),w)});const v=r==="audio"?t._audioTrack:t._videoTrack;if(!v)throw new Ae(te.UNEXPECTED_ERROR,"can not find remote track in user object");return v}catch(v){throw x.error("[".concat(this._clientId,"] subscribe user ").concat(t.uid," error"),v),v}finally{y()}}async massSubscribe(t){if(mf(t,"subscribeList"),!this._joinInfo)throw new Ae(te.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Ae(te.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));const r=Date.now(),s=new Map,a=await this._subscribeMutex.lock();x.info("[".concat(this._clientId,"]start massSubscribe user ").concat(t.map(m=>{let{user:y,mediaType:v}=m;return"user: ".concat(y==null?void 0:y.uid,", mediaType: ").concat(v)}).join("; ")));const c=(t=[...t]).map(m=>{let{user:y,mediaType:v}=m;return{user:y,mediaType:v}}),d=await this._p2pChannel.globalLock();try{var h;for(let y=t.length-1;y>=0;y--){const v=t[y],{user:w,mediaType:R}=v;if($i(R,"mediaType",["audio","video"]),!w){const j=new Ae(te.INVALID_PARAMS,"user property does not exist in subscribeList item");throw x.error("[".concat(this._clientId,"] user property does not exist in subscribeList item")),j}if(!this._users.find(j=>j===w)){const j=new Ae(te.INVALID_REMOTE_USER,"user is not in the channel");x.error("[".concat(this._clientId,"] can not massSubscribe ").concat(w.uid,", this user is not in the channel")),c[y].error=j,t.splice(y,1);continue}if(R==="audio"&&(!w.hasAudio||w._audioSSRC===void 0)||R==="video"&&(!w.hasVideo||w._videoSSRC===void 0)){const j=new Ae(te.REMOTE_USER_IS_NOT_PUBLISHED);x.error("[".concat(this._clientId,"] can not subscribe ").concat(w.uid," with mediaType ").concat(R,", remote user is not published")),c[y].error=j,t.splice(y,1);continue}const D=es.Video|es.LwoVideo,G=s.get(w);if(G){if(R==="video"?G&D:G&es.Audio){t.splice(y,1),x.warning("[".concat(this._clientId,"] repeat massSubscribe user:").concat(w.uid,", mediaType:").concat(R," twice"));continue}s.set(w,G|(R==="video"?D:es.Audio))}else s.set(w,R==="video"?D:es.Audio)}for(let y=t.length-1;y>=0;y--){const v=t[y],{user:w,mediaType:R}=v,O=es.Video|es.LwoVideo;if(this._p2pChannel.hasRemoteMedia(w,R)){await this._p2pChannel.unmuteRemoteNoLock(w,R);const D=s.get(w);s.set(w,R==="video"?D^O:D^es.Audio),t.splice(y,1)}}this.store.massSubscribe(t.map(y=>({userId:y.user.uid,type:y.mediaType})),r);let m=Ec(h=Array.from(s.entries())).call(h,(y,v)=>{let[w,R]=v;if(R===0)return y;const O={stream_id:w.uid,stream_type:R};return R&es.Audio&&(O.audio_ssrc=w._audioSSRC),R&es.Video&&(O.video_ssrc=w._videoSSRC),y.push(O),y},[]);try{t.length>0&&await this._p2pChannel.massSubscribeNoLock(t.map(v=>{let{user:w,mediaType:R}=v;return{user:w,mediaType:R,ssrcId:R===bt.VIDEO?w._videoSSRC:w._audioSSRC,rtxSsrcId:R===bt.VIDEO?w._rtxSsrcId:void 0}}));const y=new Map;if(m=m.filter(v=>v.video_ssrc&&!this._p2pChannel.isPreSubScribe(v.video_ssrc)||v.audio_ssrc&&!this._p2pChannel.isPreSubScribe(v.audio_ssrc)||!v.video_ssrc&&!v.audio_ssrc),m.length>0){const v=await this._gateway.subscribeAll(m,!0);((v==null?void 0:v.users)||[]).forEach(w=>{let{stream_id:R,video_error_code:O,audio_error_code:D,error_code:G}=w;(O||D||G)&&y.set(R,{video_error_code:O,audio_error_code:D,error_code:G})})}if(Array.from(y.entries()).length>0){const v=[];Array.from(y.entries()).forEach(w=>{let[R,O]=w;const D=this.remoteUsers.find(G=>G.uid===R);if(D){let G;O.error_code||O.video_error_code&&O.audio_error_code?G=void 0:O.video_error_code?G=bt.VIDEO:O.audio_error_code&&(G=bt.AUDIO),v.push({user:D,mediaType:G})}}),v.length>0&&await this._p2pChannel.massUnsubscribeNoLock(v)}for(const v of c){const w=y.get(v.user.uid);if(w){const R=w.error_code||v.mediaType==="audio"&&w.audio_error_code||v.mediaType==="video"&&w.video_error_code;if(R){const O=Hw(R);x.error("user:".concat(v.user.uid," mediaType:").concat(v.mediaType," has massSubscribe error ").concat(O.desc)),v.error=new Ae(te.SUBSCRIBE_FAILED,"code ".concat(R,": ").concat(O.desc))}}v.error||(v.mediaType==="video"?v.track=v.user.videoTrack:v.track=v.user.audioTrack)}return this.store.massSubscribe(c.filter(v=>!v.error).map(v=>({userId:v.user.uid,type:v.mediaType})),void 0,Date.now()),c.forEach(v=>{var w;Nt.subscribe(this.store.sessionId,{succ:!!v.error,ec:((w=v.error)===null||w===void 0?void 0:w.code)||null,video:v.mediaType===bt.VIDEO,audio:v.mediaType===bt.AUDIO,peerid:v.user.uid,subscribeRequestid:v.mediaType===bt.VIDEO?v.user._videoSSRC:v.user._audioSSRC,p2pid:this.store.p2pId,eventElapse:Math.floor(performance.now()-r),preSsrc:this._p2pChannel.isPreSubScribe(v.user._videoSSRC)},!0)}),x.info("[".concat(this._clientId,"] massSubscribe success ").concat(t.map(v=>{let{user:w,mediaType:R}=v;return"user: ".concat(w==null?void 0:w.uid,", mediaType: ").concat(R)}).join("; "))),c}catch(y){throw await this._p2pChannel.massUnsubscribeNoLock(t),y}}finally{d(),a()}}async unsubscribe(t,r,s){if(!(t instanceof sg)){const d=this.remoteUsers.find(h=>h.uid===t);if(!d)throw new Ae(te.INVALID_REMOTE_USER,"user is not in the channel");t=d}if(r||this.store.useP2P){if(r==="datachannel")return this._unsubscribeDataChannel(t,s)}else await this._unsubscribeDataChannel(t,s);if(r&&$i(r,"mediaType",["audio","video"]),!this._joinInfo)throw new Ae(te.INVALID_OPERATION,"Can't unsubscribe stream, haven't joined yet!");if(!this._users.find(d=>d===t)){const d=new Ae(te.INVALID_REMOTE_USER,"user is not in the channel");throw x.error("[".concat(this._clientId,"] can not unsubscribe ").concat(t.uid,", user is not in the channel")),d}x.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(t.uid,", mediaType: ").concat(r));const c=await this._subscribeMutex.lock();try{if(this.store.useP2P)await this._p2pChannel.unsubscribe(t,r);else{const d=await this._p2pChannel.unsubscribe(t,r);d&&await this._gateway.unsubscribe(d,t.uid),r&&r!=="audio"||(t._audio_pre_subscribed=!1),r&&r!=="video"||(t._video_pre_subscribed=!1),t._is_pre_created&&iP(this._users,t),x.info("[".concat(this._clientId,"] unsubscribe success uid: ").concat(t.uid,", mediaType: ").concat(r))}}catch(d){if(d.code===te.DISCONNECT_P2P)return void x.warning("disconnecting p2p, abort unsubscribe request.");throw x.error("[".concat(this._clientId,"] unsubscribe user ").concat(t.uid," error"),d.toString()),d}finally{c()}}async _unsubscribeDataChannel(t,r){if(r&&cr(r,"id",0,65535,!0),!this._joinInfo)throw new Ae(te.INVALID_OPERATION,"Can't unsubscribe datachannel, haven't joined yet!");if(!this._users.find(c=>c===t)){const c=new Ae(te.INVALID_REMOTE_USER,"user is not in the channel");throw x.error("[".concat(this._clientId,"] can not unsubscribe ").concat(t.uid,", user is not in the channel")),c}let a;if(typeof r=="number"){const c=t._dataChannels.find(d=>d.id===r);c&&(a=[c])}else a=t._dataChannels;if(a===void 0){const c=new Ae(te.REMOTE_USER_IS_NOT_PUBLISHED);throw x.error("[".concat(this._clientId,"] can not unsubscribe ").concat(t.uid," with channelId ").concat(r,", remote datachannel is not published")),c}x.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(t.uid,", mediaType: datachannel, ids: ").concat(a.map(c=>c.id)));try{const c=await this._p2pChannel.unsubscribeDataChannel(t,a);c&&await this._gateway.unsubscribeDataChannel(c,t.uid),x.info("[".concat(this._clientId,"] unsubscribe datachannel success uid: ").concat(t.uid,", mediaType: datachannel, ids: ").concat(c))}catch(c){if(c.code===te.DISCONNECT_P2P)return void x.warning("disconnecting p2p, abort unsubscribe request.");throw x.error("[".concat(this._clientId,"] unsubscribe user ").concat(t.uid," error"),c.toString()),c}}async massUnsubscribe(t){if(mf(t,"unsubscribeList"),!this._joinInfo)throw new Ae(te.INVALID_OPERATION,"Can't unsubscribeAll stream, haven't joined yet!");x.info("[".concat(this._clientId,"] start massUnsubscribe ").concat(t.map(s=>{let{user:a,mediaType:c}=s;return"user: ".concat(a==null?void 0:a.uid,", mediaType: ").concat(c,";")}).join())),t=[...t];const r=new Map;for(let s=t.length-1;s>=0;s--){const{user:a,mediaType:c}=t[s];if(!a){const m=new Ae(te.INVALID_PARAMS,"user property does not exist in unsubscribeList item");throw x.error("[".concat(this._clientId,"] user property does not exist in unsubscribeList item")),m}if($i(c,"mediaType",["video","audio",void 0]),!this._users.find(m=>m===a)){x.warning("[".concat(this._clientId,"] can not unsubscribe ").concat(a.uid,", user is not in the channel")),t.splice(s,1);continue}const h=es.Video|es.LwoVideo;if(r.has(a)){const m=r.get(a);let y;switch(c){case"video":y=m&h;break;case"audio":y=m&es.Audio;break;default:y=m&(es.Audio|h)}if(y){x.warning("[".concat(this._clientId,"] repeat massUnsubscribe user:").concat(a.uid,",mediaType:").concat(c," twice.")),t.splice(s,1);continue}c?c==="audio"?r.set(a,m|es.Audio):c==="video"&&r.set(a,m|h):r.set(a,m|es.Audio|h)}else c?c==="audio"?r.set(a,es.Audio):c==="video"&&r.set(a,h):r.set(a,es.Audio|h)}try{const s=await this._p2pChannel.massUnsubscribe(t);s&&await this._gateway.massUnsubscribe(s),x.info("[".concat(this._clientId,"] massUnsubscribe success ").concat(t.map(a=>{let{user:c,mediaType:d}=a;return"user: ".concat(c==null?void 0:c.uid,", mediaType: ").concat(d,";")}).join()))}catch(s){if(s.code===te.DISCONNECT_P2P)return void x.warning("[".concat(this._clientId,"] disconnecting p2p, abort unsubscribe request."));throw x.error("[".concat(this._clientId,"] massUnsubscribe error"),s.toString()),s}}async setLowStreamParameter(t){(function(s){if(!s)throw new Le(te.INVALID_PARAMS);$r(s.width)||SL(s.width,"streamParameter.width"),$r(s.height)||SL(s.height,"streamParameter.height"),$r(s.framerate)||SL(s.framerate,"streamParameter.framerate"),$r(s.bitrate)||cr(s.bitrate,"streamParameter.bitrate")})(t),(!t.width&&t.height||t.width&&!t.height)&&x.warning("[".concat(this._clientId,"] The width and height parameters take effect only when both are set")),x.info("[".concat(this._clientId,"] set low stream parameter to"),JSON.stringify(t));const r=this._configDistribute.getLowStreamConfigDistribute();if(r&&r.bitrate&&t.bitrate&&r.bitrate<t.bitrate&&(t.bitrate=r.bitrate),this._lowStreamParameter=t,this._isDualStreamEnabled)return this._p2pChannel.updateVideoStreamParameter(t,Xe.LocalVideoLowTrack)}async enableDualStream(){if(!Wn().supportDualStream)throw Nt.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),new Ae(te.NOT_SUPPORTED,"Your browser is not support dual stream");if(this._isDualStreamEnabled)throw new Ae(te.INVALID_OPERATION,"Dual stream is already enabled");if(this._p2pChannel.canPublishLowStream())try{await this._publishLowStream()}catch(t){throw Nt.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),t}this._isDualStreamEnabled=!0,Nt.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!0}),x.info("[".concat(this._clientId,"] enable dual stream"))}async disableDualStream(){if(this._isDualStreamEnabled){if(!this._joinInfo)throw new Ae(te.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this._p2pChannel.getLocalMedia(Xe.LocalVideoLowTrack))try{const t=await this._p2pChannel.unpublishLowStream();t&&await this._gateway.unpublish(t,this._joinInfo.stringUid||this._joinInfo.uid)}catch(t){throw Nt.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!1}),t}this._isDualStreamEnabled=!1,Nt.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!0}),x.info("[".concat(this._clientId,"] disable dual stream"))}}async setClientRole(t,r){if(function(a){$i(a,"role",["audience","host"])}(t),r&&CL(r),this.mode==="rtc"||this.mode==="p2p")throw x.warning("[".concat(this._clientId,"]").concat(this.mode," mode can not use setClientRole")),new Ae(te.INVALID_OPERATION,"".concat(this.mode," mode can not use setClientRole"));if(r&&r.level&&t==="host")throw new Ae(te.INVALID_OPERATION,"host mode can not set audience latency level");if(t==="audience"&&this._p2pChannel.hasLocalMedia())throw new Ae(te.INVALID_OPERATION,"can not set client role to audience when publishing stream");const s=this._config.role;this._joinInfo&&(this._joinInfo.role=t),t!==s&&oe("ENABLE_ROLE_SELECT_EDGE")?(this._gateway.updateClientRole(t,r),this._config.role=t,this._gateway.reconnect("recover",Ls.REGIONAL_DISTRIBUTION)):(await this._gateway.setClientRole(t,r),this._config.role=t),x.info("[".concat(this._clientId,"] set client role to ").concat(t,", level: ").concat(r&&r.level))}async _setClientRoleOptions(t){if(this.mode==="rtc"||this.mode==="p2p"||this._config.role!=="audience"||this._p2pChannel.hasLocalMedia())return;let r=!1;try{t&&CL(t),await this._gateway.setClientRole(this._config.role,t),r=!0}catch{}finally{x.info("[".concat(this._clientId,"] set client role options ").concat(r?"succeed":"failed",", options is ").concat(t))}}getRemoteInboundOffset(){var t;const r=(t=this._p2pChannel.getStats())===null||t===void 0?void 0:t.audioSend[0];if(!r||!r.timestamp)return 0;const s=r.timestamp-Date.now();return Math.abs(s)>1e3+r.rttMs+100?this.ntpAlignErrorCount+=1:this.ntpAlignErrorCount=0,this.ntpAlignErrorCount>=3?s:0}getNtpWallTimeInMs(){return document.visibilityState==="visible"&&(this.remoteInboundOffset=this.getRemoteInboundOffset()),this.remoteInboundOffset+Date.now()+this._gateway.ntpOffset}setProxyServer(t,r){if(_s(t,"proxyServer"),!r){if(this.connectionState!=="DISCONNECTED")throw new Ae(te.INVALID_OPERATION,"Set proxy server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new Ae(te.INVALID_OPERATION,"You have already set the proxy")}this._proxyServer=t,Nt.setProxyServer(this._proxyServer),x.setProxyServer(this._proxyServer),x.info("[".concat(this._clientId,"] Set proxy server ").concat(r?"by initialize call":""," success."))}setTurnServer(t,r){if(Array.isArray(t)||(t=[t]),!r){if(this.connectionState!=="DISCONNECTED")throw new Ae(te.INVALID_OPERATION,"Set turn server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new Ae(te.INVALID_OPERATION,"You have already set the proxy")}if(Lw(t))return this._turnServer={servers:t,mode:"original-manual"},void x.info("[".concat(this._clientId,"] Set original turnserver ").concat(r?"by initialize call":""," success: ").concat(t.map(s=>s.urls).join(","),"."));t.forEach(s=>Bz(s)),this._turnServer={servers:t,mode:"manual"},x.info("[".concat(this._clientId,"] Set turnserver ").concat(r?"by initialize call":""," success."))}setLicense(t){if(this.connectionState!=="DISCONNECTED")throw new Ae(te.INVALID_OPERATION,"you should set license before join channel");if(_s(t,"license",32,32),!/^[A-Za-z\d]+$/.test(t))throw new Ae(te.INVALID_PARAMS,"license should only contains characters from A-Z a-z 0-9");this._license=t,x.info("[".concat(this._clientId,"] set license success"),t)}startProxyServer(t){if(this.connectionState!=="DISCONNECTED")throw new Ae(te.INVALID_OPERATION,"Start proxy server before join channel");if(this._proxyServer||this._turnServer.mode==="manual"||this._useLocalAccessPoint)throw new Ae(te.INVALID_OPERATION,"You have already set the proxy");const r=[3,4,5];let s;switch(t===void 0&&(t=3),t){case 1:case 2:throw new Ae(te.NOT_SUPPORTED,"proxy mode 1/2 has been deprecated and not supported.");case 3:s="proxy3";break;case 4:s="proxy4";break;case 5:s="proxy5";break;default:throw new Ae(te.INVALID_PARAMS,"proxy server mode must be ".concat(r.join("|")))}this._cloudProxyServerMode=s,this.store.cloudProxyServerMode=s,x.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode)}stopProxyServer(){if(this.connectionState!=="DISCONNECTED")throw new Ae(te.INVALID_OPERATION,"Stop proxy server after leave channel");Nt.setProxyServer(),x.setProxyServer(),this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled",x.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode),this._proxyServer=void 0,this._turnServer={mode:"auto",servers:[]}}setLocalAccessPointsV2(t){if(!t.accessPoints)throw new Ae(te.INVALID_PARAMS,"accessPoints is required.");mf(t.accessPoints.serverList,"accessPoints.serverList"),_s(t.accessPoints.domain,"accessPoints.domain");const r=(O,D)=>{cr(O,D,0,65535,!0)};let s=443;if(t.accessPoints.port&&(r(t.accessPoints.port,"accessPoints.port"),s=t.accessPoints.port),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new Ae(te.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");oe("CLOSE_AFB_FOR_LOCAL_AP")&&(sr("JOIN_WITH_FALLBACK_SIGNAL_PROXY",!1),sr("JOIN_WITH_FALLBACK_MEDIA_PROXY",!1));const a=/^((\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.){3}(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/,c=t.accessPoints.domain,d=t.accessPoints.serverList.map(O=>a.test(O)?"".concat(O.replace(/\./g,"-"),".").concat(c):O),h=d.map(O=>"".concat(O,":").concat(s));this._useLocalAccessPoint=!0,this._setLocalAPVersion=2,sr("WEBCS_DOMAIN",h),sr("WEBCS_DOMAIN_BACKUP_LIST",h),sr("GATEWAY_DOMAINS",[c]),t.report&&t.report.hostname&&Array.isArray(t.report.hostname)&&t.report.hostname.length?(mf(t.report.hostname,"report.hostname"),sr("EVENT_REPORT_DOMAIN",t.report.hostname[0]),sr("EVENT_REPORT_BACKUP_DOMAIN",t.report.hostname[1]||t.report.hostname[0])):(sr("EVENT_REPORT_DOMAIN",d[0]),sr("EVENT_REPORT_BACKUP_DOMAIN",d[1]||d[0]));let m=6443;t.report&&t.report.port&&(r(t.report.port,"report.port"),m=t.report.port),sr("STATS_COLLECTOR_PORT",m),t.report?sr("ENABLE_EVENT_REPORT",!0):sr("ENABLE_EVENT_REPORT",!1);let y="";t.log&&t.log.hostname&&Array.isArray(t.log.hostname)&&t.log.hostname.length?(mf(t.log.hostname,"log.hostname"),y=t.log.hostname[0]):y=d[0];let v=6444;t.log&&t.log.port&&(r(t.log.port,"log.port"),v=t.log.port),sr("LOG_UPLOAD_SERVER","".concat(y,":").concat(v));let w=[];t.cds&&t.cds.hostname&&Array.isArray(t.cds.hostname)&&t.cds.hostname.length?(mf(t.cds.hostname,"cds.hostname"),w=t.cds.hostname):w=d;let R=443;t.cds&&t.cds.port&&(r(t.cds.port,"cds.port"),R=t.cds.port),sr("CDS_AP",w.map(O=>"".concat(O,":").concat(R))),t.cds?sr("ENABLE_CONFIG_DISTRIBUTE",!0):sr("ENABLE_CONFIG_DISTRIBUTE",!1),x.info("set local access point v2 success")}setLocalAccessPoints(t,r){if(mf(t,"serverList"),_s(r,"domain"),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new Ae(te.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");const s=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/;t=t.map(a=>s.test(a)?"".concat(a.replace(/\./g,"-"),".").concat(r):a),this._useLocalAccessPoint=!0,this._setLocalAPVersion=1,sr("WEBCS_DOMAIN",t),sr("WEBCS_DOMAIN_BACKUP_LIST",t),sr("GATEWAY_DOMAINS",[r]),sr("EVENT_REPORT_DOMAIN",t[0]),sr("EVENT_REPORT_BACKUP_DOMAIN",t[1]||t[0]),sr("LOG_UPLOAD_SERVER","".concat(t[0],":6444")),x.info("[".concat(this._clientId,"] set local access point success"))}async setRemoteDefaultVideoStreamType(t){if($i(t,"streamType",[0,1,4,5,6,7,8,9]),this._remoteDefaultVideoStreamType=t,this._joinInfo)try{await this._gateway.setDefaultRemoteVideoStreamType(t),this._joinInfo.defaultVideoStream=this._remoteDefaultVideoStreamType}catch(r){throw x.error("[".concat(this._clientId,"] set default remote video stream type error"),r.toString()),r}else x.debug("[".concat(this._clientId,"] haven't joined yet, cache remoteDefaultVideoStreamType ").concat(t))}async setRemoteVideoStreamType(t,r){$i(r,"streamType",[0,1,4,5,6,7,8,9]);try{await this._gateway.setRemoteVideoStreamType(t,r),setTimeout(()=>{const s=this._users.find(a=>a.uid===t);s&&s.videoTrack&&s.videoTrack.updateMediaStreamTrackResolution()},2e3)}catch(s){throw x.error("[".concat(this._clientId,"] set remote video stream type error"),s.toString()),s}x.info("[".concat(this._clientId,"] set remote ").concat(t," video stream type to ").concat(r)),this._remoteStreamTypeCacheMap.set(t,r)}async setStreamFallbackOption(t,r){$i(r,"fallbackType",[0,1,2,3,4,5,6,7,8]);try{await this._gateway.setStreamFallbackOption(t,r)}catch(s){throw x.error("[".concat(this._clientId,"] set stream fallback option"),s.toString()),s}x.info("[".concat(this._clientId,"] set remote ").concat(t," stream fallback type to ").concat(r)),this._streamFallbackTypeCacheMap.set(t,r)}setEncryptionConfig(t,r,s,a){(function(d){$i(d,"encryptionMode",["aes-128-xts","aes-256-xts","aes-128-ecb","sm4-128-ecb","aes-128-gcm","aes-256-gcm","aes-128-gcm2","aes-256-gcm2","none"])})(t),_s(r,"secret");const c=["aes-128-gcm2","aes-256-gcm2"];if(lt(c).call(c,t)){if(!s||!(s instanceof Uint8Array&&s.length===32))throw new Ae(te.INVALID_PARAMS,"salt must be an Uint8Array and exactly equal to 32 bytes")}else if(s)throw new Ae(te.INVALID_PARAMS,"current encrypt mode does not need salt");if(a){if(ff(a,"encryptDataStream"),!lt(c).call(c,t))throw new Ae(te.INVALID_PARAMS,"current encrypt mode does not support data stream");this._encryptDataStream=!0}new RegExp(`^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*,.<>?/:;'"|{}\\[\\]])(?=.{8,})`).test(r)||x.warning(`The secret is not strong:
      The secret must contain at least 1 lowercase alphabetical character,
      The secret must contain at least 1 uppercase alphabetical character,
      The secret must contain at least 1 numeric character,
      The secret must contain at least one special character,
      The secret must be eight characters or longer.
      `),this._encryptionMode=t,this._encryptionSecret=r,s&&(this._encryptionSalt=Jm(s))}async renewToken(t){if(_s(t,"token",1,2047),!this._key||!this._joinInfo)throw new Ae(te.INVALID_OPERATION,"renewToken should not be called before user join");const r=this._key;this._key=t,this._joinInfo&&(this._joinInfo.token=t);const s=await this._renewTokenMutex.lock();try{if(oe("USE_NEW_TOKEN")){x.debug("[".concat(this._clientId,"] start renew token with ticket from unilbs"));const a=await $ge(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||Di);x.debug("[".concat(this._clientId,"] get ticket from unilbs success")),await this._gateway.renewToken({token:t,ticket:a})}else x.debug("[".concat(this._clientId,"] start renew token without ticket")),await this._gateway.renewToken({token:t});x.debug("[".concat(this._clientId,"] renewToken success"))}catch(a){throw this._key=r,this._joinInfo.token=r,x.error("[".concat(this._clientId,"] renewToken failed"),a.toString()),a}finally{s()}}enableAudioVolumeIndicator(){this._audioVolumeIndicationInterval?x.warning("you have already enabled audio volume indicator!"):this._audioVolumeIndicationInterval=window.setInterval(()=>{const t=this._p2pChannel.getAudioLevels();this.safeEmit(wn.VOLUME_INDICATOR,t)},oe("AUDIO_VOLUME_INDICATION_INTERVAL")||2e3)}getRTCStats(){const t=this._statsCollector.getRTCStats(),r=this._gateway.getInChannelInfo();return t.Duration=Math.round(r.duration/1e3),t}async startLiveStreaming(t,r){if(!r){if(this.codec!=="h264")throw new Ae(te.LIVE_STREAMING_INVALID_RAW_STREAM,"raw streaming is only support h264");if(!this._p2pChannel.hasLocalMedia())throw new Ae(te.LIVE_STREAMING_INVALID_RAW_STREAM,"can not find stream to raw streaming")}if(this._liveRawStreamingClient&&this._liveRawStreamingClient.hasUrl(t)||this._liveTranscodeStreamingClient&&this._liveTranscodeStreamingClient.hasUrl(t))throw new Ae(te.LIVE_STREAMING_TASK_CONFLICT);const s=r?yf.TRANSCODE:yf.RAW;return this._createLiveStreamingClient(s).startLiveStreamingTask(t,s)}setLiveTranscoding(t){return this._createLiveStreamingClient(yf.TRANSCODE).setTranscodingConfig(t)}async stopLiveStreaming(t){const r=[this._liveRawStreamingClient,this._liveTranscodeStreamingClient].filter(s=>s&&s.hasUrl(t));if(!r.length)throw new Ae(te.INVALID_PARAMS,"can not find live streaming url to stop");await pt.all(r.map(s=>s&&s.stopLiveStreamingTask(t)))}async startChannelMediaRelay(t){C9(t),await this._createChannelMediaRelayClient().startChannelMediaRelay(t)}async updateChannelMediaRelay(t){C9(t),await this._createChannelMediaRelayClient().updateChannelMediaRelay(t)}async stopChannelMediaRelay(){await this._createChannelMediaRelayClient().stopChannelMediaRelay(),this._statsCollector.onStatsChanged&&(this._statsCollector.onStatsChanged=void 0)}sendAudioMetadata(t){this._p2pChannel instanceof tT&&this._p2pChannel.addAudioMetadata(t)}async sendStreamMessage(t){var r;let s=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!this._joinInfo)throw new Ae(te.INVALID_OPERATION,"can not send data stream, not joined");if((typeof t=="string"||t instanceof Uint8Array)&&(t={payload:t}),typeof t.payload=="string"){const c=new TextEncoder;t.payload=c.encode(t.payload)}let a=!1;if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&lt(r=["aes-128-gcm2","aes-256-gcm2"]).call(r,this._encryptionMode)&&(a=!0,t.payload=await async function(c,d,h){var m;const y=Ec(m=Array.from(h)).call(m,(j,W)=>j+W,0),v={serverTs:0,seq:fme++,length:h.length,checkSum:y},w=new Uint8Array(Yz(y,2)),R=new ArrayBuffer(Qv),O=new DataView(R);O.setUint32(0,v.serverTs),O.setUint16(4,v.seq),O.setUint16(6,v.length),O.setUint16(8,v.checkSum);const D=16-h.length%16;h=Gz(h,new Uint8Array(D));const G=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:c,tagLength:c8,additionalData:w},d,h);return Gz(new Uint8Array(R),new Uint8Array(G))}(this._encryptDataStreamIv,this._encryptDataStreamKey,t.payload)),new Blob([t.payload]).size>1024)throw new Ae(te.INVALID_PARAMS,a?"encrypted stream message out of range.":"stream message out of range.");return this._gateway.signal.request(Yt.DATA_STREAM,{payload:Jm(t.payload),syncWithAudio:t.syncWithAudio,sendTs:Date.now()-t_e},!s)}sendMetadata(t){if(!this._joinInfo)throw new Ae(te.INVALID_OPERATION,"can not send metadata, not joined");if(new Blob([t]).size>1024)throw new Ae(te.METADATA_OUT_OF_RANGE);return this._gateway.signal.request(Yt.SEND_METADATA,{session_id:this._joinInfo.sid,metadata:Jm(t)})}async sendCustomReportMessage(t){if(Array.isArray(t)||(t=[t]),t.forEach(wme),!this._joinInfo)throw new Ae(te.INVALID_OPERATION,"can not send custom report, not joined");await Nt.sendCustomReportMessage(this._joinInfo.sid,t)}getLocalAudioStats(){return this._statsCollector.getLocalAudioTrackStats()}getRemoteAudioStats(){return this._statsCollector.getRemoteAudioTrackStats()}getLocalVideoStats(){return this._statsCollector.getLocalVideoTrackStats()}getRemoteVideoStats(){return this._statsCollector.getRemoteVideoTrackStats()}getRemoteNetworkQuality(){return this._statsCollector.getRemoteNetworkQualityStats()}async pickSVCLayer(t,r){$i(r.spatialLayer,"spatialLayer",[0,1,2,3]),$i(r.temporalLayer,"temporalLayer",[0,1,2,3]);try{await this._gateway.pickSVCLayer(t,r)}catch(s){throw x.error("[".concat(this._clientId,"] pick SVC layer failed"),s.toString()),s}}async setRTMConfig(t){const{apRTM:r=!1,rtmFlag:s}=t;if(ff(r,"apRTM"),cr(s,"rtmFlag",0),this._rtmConfig.apRTM=r,this._rtmConfig.rtmFlag=s,x.debug("[".concat(this._clientId,"] setRTMconfig ").concat(JSON.stringify(t)," in ").concat(this.connectionState," state")),(this.connectionState==="CONNECTED"||this.connectionState==="RECONNECTING")&&this._joinInfo)return this._joinInfo.apRTM=r,this._joinInfo.rtmFlag=s,this._gateway.setRTM2Flag(s)}_reset(){if(x.debug("[".concat(this._clientId,"] reset client")),function(t){const r=dS.indexOf(t);r!==-1&&dS.splice(r,1)}(this._clientId),this.store.hasStartJoinChannel=!1,this.store.isABTestSuccess=!1,this._axiosCancelSource.cancel(),this._axiosCancelSource=va.CancelToken.source(),this._streamFallbackTypeCacheMap=new Map,this._remoteStreamTypeCacheMap=new Map,this._configDistribute.stopGetConfigDistribute(),this._joinInfo&&e$(this._joinInfo),this._joinInfo=void 0,this._proxyServer=void 0,this._defaultStreamFallbackType=void 0,this._sessionId&&Nt.removeSid(this._sessionId),this._sessionId=null,this.store.sessionId=null,this._statsCollector.reset(),this._key=void 0,this._appId=void 0,this._uid=void 0,this.store.uid=void 0,this._channelName=void 0,this._encryptionMode="none",this._encryptionSecret=null,this._encryptionSalt=null,this._encryptDataStreamKey=null,this._encryptDataStreamIv=null,this._pendingPublishedUsers=[],this._users.forEach(t=>{t._audioTrack&&t._audioTrack._destroy(),t._videoTrack&&t._videoTrack._destroy(),t._dataChannels&&(t._dataChannels.forEach(r=>r._close()),t._dataChannels.length=0)}),this._users=[],this._audioVolumeIndicationInterval&&(window.clearInterval(this._audioVolumeIndicationInterval),this._audioVolumeIndicationInterval=void 0),this._cloudProxyServerMode==="fallback"&&(this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled"),this._p2pChannel.reset(),this._publishMutex=new Xs("client-publish",this._clientId),this._subscribeMutex=new Xs("client-subscribe",this._clientId),this._networkQualityInterval&&(window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=void 0),this._liveRawStreamingClient&&(this._liveRawStreamingClient.terminate(),this._liveRawStreamingClient.removeAllListeners(),this._liveRawStreamingClient=void 0),this._liveTranscodeStreamingClient&&(this._liveTranscodeStreamingClient.terminate(),this._liveTranscodeStreamingClient.removeAllListeners(),this._liveTranscodeStreamingClient=void 0),this._channelMediaRelayClient&&(this._channelMediaRelayClient.dispose(),this._channelMediaRelayClient=void 0),this._inspect)try{this._inspect.close(),this._inspect=void 0}catch{}if(this._moderation)try{this.setImageModeration(!1)}catch{}}_startSession(t,r){var s;const a=t||J_();t?x.debug("[".concat(this._clientId,"] new Session ").concat(a)):x.debug("[".concat(this._clientId,"] renewSession ").concat(this._sessionId," => ").concat(a));const c=t?"":this._sessionId||"";this._sessionId=a,this.store.sessionId=a,Nt.addSid(a);const d={lts:new Date().getTime(),mode:this.mode,buildFormat:1,stringUid:(r==null?void 0:r.stringUid)||((s=this._joinInfo)===null||s===void 0?void 0:s.stringUid),channelProfile:this.mode==="live"?1:0,channelMode:0,isABTestSuccess:Number(this._configDistribute.isSuccess),lsid:c,clientRole:this.role==="audience"?2:1};Nt.sessionInit(this._sessionId,Uu({cname:r.channel,appid:r.appId},d)),this._joinInfo&&(this._joinInfo.sid=a),this._gateway.joinInfo&&(this._gateway.joinInfo.sid=a)}async _publishHighStream(t){if(!this._joinInfo||this._uid===void 0)throw new Ae(te.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Ae(te.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&oe("FORCE_TURN")&&!oe("TURN_ENABLE_TCP")&&!oe("TURN_ENABLE_UDP"))throw new Ae(te.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");x.debug("[".concat(this._clientId,"] publish high stream"));try{const s=await this._p2pChannel.publish(t,this._isDualStreamEnabled,this._lowStreamParameter);if(this.store.useP2P){const a=(await s.next()).value;if(a){try{await this._gateway.sendExtensionMessage(hi.PUBLISH,a,!0)}catch(c){throw s.throw(c),c}await s.next()}this._p2pChannel.reportPublishEvent(!0,null)}else{const a=(await s.next()).value;if(a){var r;let c;try{c=await this._gateway.publish(this._uid,a,!0)}catch(d){if(d.code!==te.DISCONNECT_P2P)throw s.throw(d),d}await s.next(((r=c)===null||r===void 0?void 0:r.ortc)||[])}this._p2pChannel.reportPublishEvent(!0,null);for(const c of t)c instanceof Ir&&c._encoderConfig&&this._gateway.setVideoProfile(c._encoderConfig).catch(d=>{x.debug("[".concat(this._clientId,"] stop setVideoProfile, because websocket is closed"))}),!c.muted&&c.enabled||await this._p2pChannel.muteLocalTrack(c)}}catch(s){if(this._p2pChannel.reportPublishEvent(!1,s==null?void 0:s.code,t),(s==null?void 0:s.code)===te.WS_ABORT)return;throw s}}async _publishLowStream(){if(!this._joinInfo||this._uid===void 0)throw new Ae(te.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Ae(te.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));x.debug("[".concat(this._clientId,"] publish low stream"));const t=this._configDistribute.getLowStreamConfigDistribute();t&&t.bitrate&&(this._lowStreamParameter||(this._lowStreamParameter={width:160,height:120,framerate:15,bitrate:50}),this._lowStreamParameter&&this._lowStreamParameter.bitrate&&t.bitrate<this._lowStreamParameter.bitrate&&(this._lowStreamParameter.bitrate=t.bitrate));try{const s=await this._p2pChannel.publishLowStream(this._lowStreamParameter),a=(await s.next()).value;if(a){var r;let c;try{c=await this._gateway.publish(this._uid,a,!0)}catch(d){if(d.code!==te.DISCONNECT_P2P)throw s.throw(d),d}s.next(((r=c)===null||r===void 0?void 0:r.ortc)||[]),this._p2pChannel.reportPublishEvent(!0,null,void 0,!0)}}catch(s){if(this._p2pChannel.reportPublishEvent(!1,s==null?void 0:s.code,void 0,!0),(s==null?void 0:s.code)===te.WS_ABORT)return;throw s}}_createLiveStreamingClient(t){const r=()=>{if(!this._joinInfo||!this._appId)return new Ae(te.INVALID_OPERATION,"can not create live streaming client, please join channel first").throw();const s=(a={joinInfo:this._joinInfo,appId:this._appId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig},Sf("LiveStreaming").create(a));var a;return s.onLiveStreamError=(c,d)=>{Nt.reportApiInvoke(this._sessionId,{name:Ni.ON_LIVE_STREAM_ERROR,options:[c,d],tag:Kr.TRACER}).onSuccess(),this.safeEmit(wn.LIVE_STREAMING_ERROR,c,d)},s.onLiveStreamWarning=(c,d)=>{Nt.reportApiInvoke(this._sessionId,{name:Ni.ON_LIVE_STREAM_WARNING,options:[c,d],tag:Kr.TRACER}).onSuccess(),this.safeEmit(wn.LIVE_STREAMING_WARNING,c,d)},s.on(m2.REQUEST_WORKER_MANAGER_LIST,(c,d,h)=>{if(!this._joinInfo)return h(new Ae(te.INVALID_OPERATION,"can not find join info to get worker manager"));(async function(m,y,v,w){const R=oe("UAP_AP").slice(0,oe("AJAX_REQUEST_CONCURRENT")).map(O=>y.proxyServer?"https://".concat(y.proxyServer,"/ap/?url=").concat(O+"/api/v1?action=uap"):"https://".concat(O,"/api/v1?action=uap"));return await Fge(R,m,y,v,w)})(c,this._joinInfo,this._axiosCancelSource.token,Di).then(d).catch(h)}),s};return t===yf.RAW?(this._liveRawStreamingClient=this._liveRawStreamingClient||r(),this._liveRawStreamingClient):(this._liveTranscodeStreamingClient=this._liveTranscodeStreamingClient||r(),this._liveTranscodeStreamingClient)}_createChannelMediaRelayClient(){if(!this._joinInfo)return new Ae(te.INVALID_OPERATION,"can not create channel media relay client, please join channel first").throw();if(!this._channelMediaRelayClient){const{sendResolutionWidth:r,sendResolutionHeight:s}=this.getLocalVideoStats(),a=(t={joinInfo:this._joinInfo,clientId:this._clientId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig,resolution:{width:r,height:s}},Sf("ChannelMediaRelay").create(t));a.on("state",c=>{c===Ja.RELAY_STATE_FAILURE&&a&&a.dispose(),this.safeEmit(wn.CHANNEL_MEDIA_RELAY_STATE,c)}),a.on("event",c=>{this.safeEmit(wn.CHANNEL_MEDIA_RELAY_EVENT,c)}),this._channelMediaRelayClient=a,this._statsCollector.onStatsChanged=(c,d)=>{var h;c==="resolution"&&((h=this._channelMediaRelayClient)===null||h===void 0||h.setVideoProfile(d))}}var t;return this._channelMediaRelayClient}_handleUpdateDataChannel(t,r){const{added:s,deleted:a}=t,c=[];if(r){const d=[];this._users.forEach(h=>{h._dataChannels.forEach(m=>{s.every(y=>y.uid!==h._uintid||y.stream_id!==m.id)&&d.push({uid:h._uintid,stream_id:m.id,ordered:m.ordered,max_retrans_times:m.maxRetransmits,metadata:m.metadata})})}),d.length>0&&this._handleUpdateDataChannel({added:[],deleted:d})}Array.isArray(s)&&s.length>0&&s.forEach(d=>{const{uid:h,stream_id:m,ordered:y,max_retrans_times:v,metadata:w}=d,R=this._users.find(O=>O._uintid===h);if(!R)return void x.error("[".concat(this._clientId,"] can not find target user!(on_add_data_channel)"));if(x.debug("[".concat(this._clientId,"] data_channel added with uid ").concat(h)),lt(c).call(c,R)||c.push(R),R._uintid||(R._uintid=h),R._dataChannels.findIndex(O=>O.id===d.stream_id)===-1){const O={id:m,ordered:!!y,maxRetransmits:v,metadata:w},D=function(G){return c9(G,!0)}(O);R._dataChannels.push(D),x.info("[".concat(this._clientId,"] remote user ").concat(R.uid," published datachannel")),r||this.safeEmit(wn.USER_PUBLISHED,R,"datachannel",O)}this._p2pChannel.hasPendingRemoteDataChannel(R,d.stream_id)&&(x.debug("[".concat(this._clientId,"] resubscribe datachannel for user ").concat(R.uid," after reconnect.")),this._subscribeDataChannel(R,d.stream_id).catch(O=>{x.error("[".concat(this._clientId,"] resubscribe datachannel error"),O.toString())}))}),r&&(this.safeEmit(wn.PUBLISHED_USER_LIST,this._pendingPublishedUsers),this._pendingPublishedUsers=[]),Array.isArray(a)&&a.length>0&&a.forEach(d=>{const{uid:h,stream_id:m}=d,y=this._users.find(w=>w._uintid===h);if(!y)return void x.error("[".concat(this._clientId,"] can not find target user!(on_delete_data_channel)"));const v=y._dataChannels.find(w=>w.id===d.stream_id);v&&(x.debug("[".concat(this._clientId,"] data_stream delete with uid ").concat(h)),this._p2pChannel.unsubscribeDataChannel(y,[v]).then(w=>{if(y._dataChannels=y._dataChannels.filter(R=>R!==v),w)return this._gateway.unsubscribeDataChannel(w,y.uid)}),x.info("[".concat(this._clientId,"] remote user ").concat(h," unpublished datachannel ,id:").concat(v.id)),this.safeEmit(wn.USER_UNPUBLISHED,y,"datachannel",v._config))})}_handleRemoveDataChannels(t){const r=this._users.find(s=>s.uid===t.uid);if(r){if(r._dataChannels!==void 0&&r._dataChannels.length>0){x.debug("[".concat(this._clientId,"] datachannel removed with uid ").concat(t.uid));const s=()=>{x.info("[".concat(this._clientId,"] remote user ").concat(r.uid," unpublished datachannel")),r._dataChannels.forEach(a=>{this.safeEmit(wn.USER_UNPUBLISHED,r,"datachannel",a._config)})};this._p2pChannel.unsubscribeDataChannel(r,r._dataChannels).then(a=>{if(a)return this._gateway.unsubscribeDataChannel(a,r.uid)}),s()}}else x.warning("[".concat(this._clientId,"] can not find target user!(on_remove_datachannel)"))}_handleGatewayEvents(){this._gateway.on(ls.UPDATE_GATEWAY_CONFIG,()=>{(function(){let t;try{t=window.localStorage.getItem("websdk_ng_global_parameter")}catch(r){return void x.error("Error loading sdk config",r.message)}if(t)try{const r=JSON.parse(window.atob(t)),s=Date.now();Object.keys(r).forEach(a=>{const{value:c,type:d,expires:h}=r[a];h&&h<=s||d||c2()||!Object.prototype.hasOwnProperty.call(uP,a)||(Nd[a]=c,Rr[a]=c,x.debug("Update gateway parameters from config distribute",a,c))})}catch(r){x.error("Error update config from local cache",r.message)}})()}),this._gateway.on(ls.DISCONNECT_P2P,async()=>{await this._p2pChannel.disconnectForReconnect()}),this._gateway.on(ls.CONNECTION_STATE_CHANGE,(t,r,s)=>{var a;if(s===Xn.FALLBACK)return;const c=()=>{this.safeEmit(wn.CONNECTION_STATE_CHANGE,t,r,s)};if(Nt.reportApiInvoke(this._sessionId||((a=this._gateway.joinInfo)===null||a===void 0?void 0:a.sid)||null,{name:Ni.CONNECTION_STATE_CHANGE,options:[t,r,s],tag:Kr.TRACER}).onSuccess(JSON.stringify({cur:t,prev:r,reason:s})),x.info("[".concat(this._clientId,"] signal connection state change: ").concat(r," -> ").concat(t)),t==="DISCONNECTED")return this._reset(),void c();if(t==="RECONNECTING")this._users.forEach(h=>{h._trust_in_room_=!1,h._trust_audio_enabled_state_=!1,h._trust_video_enabled_state_=!1,h._trust_audio_mute_state_=!1,h._trust_video_mute_state_=!1,h._trust_audio_stream_added_state_=!1,h._trust_video_stream_added_state_=!1,h._is_pre_created||(h._audio_pre_subscribed||(h._audioSSRC=void 0,h._audioOrtc=void 0),h._video_pre_subscribed||(h._videoSSRC=void 0,h._videoOrtc=void 0,h._rtxSsrcId=void 0),h._cname=void 0)}),this._userOfflineTimeout&&window.clearTimeout(this._userOfflineTimeout),this._streamRemovedTimeout&&window.clearTimeout(this._streamRemovedTimeout),this._userOfflineTimeout=void 0,this._streamRemovedTimeout=void 0;else if(t==="CONNECTED"){var d;this._streamFallbackTypeCacheMap.forEach((h,m)=>{this._gateway.setStreamFallbackOption(m,h).catch(y=>{x.warning("[".concat(this._clientId,"] auto set stream fallback option failed"),y)})}),this._remoteStreamTypeCacheMap.forEach((h,m)=>{this._gateway.setRemoteVideoStreamType(m,h).catch(y=>{x.warning("[".concat(this._clientId,"] auto set remote stream type failed"),y)})}),this._remoteDefaultVideoStreamType!==void 0&&((d=this._joinInfo)===null||d===void 0?void 0:d.defaultVideoStream)===void 0&&this.setRemoteDefaultVideoStreamType(this._remoteDefaultVideoStreamType).then(()=>{x.debug("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway connected"))}).catch(h=>{x.error("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway failed, ").concat(h))}),this.store.useP2P||(this._p2pChannel.republish(),this._userOfflineTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._userOfflineTimeout=void 0,this._users.filter(h=>!h._trust_in_room_).forEach(h=>{x.debug("[".concat(this._clientId,"] user offline timeout, emit user offline ").concat(h.uid)),this._handleUserOffline({uid:h.uid})}))},3e3),this._streamRemovedTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._streamRemovedTimeout=void 0,this._users.forEach(h=>{h._trust_audio_mute_state_||(x.debug("[".concat(this._clientId,"] auto dispatch audio unmute event ").concat(h.uid)),this._handleMuteStream(h.uid,bt.AUDIO,!1)),h._trust_video_mute_state_||(x.debug("[".concat(this._clientId,"] auto dispatch video unmute event ").concat(h.uid)),this._handleMuteStream(h.uid,bt.VIDEO,!1)),h._trust_audio_enabled_state_||(x.debug("[".concat(this._clientId,"] auto dispatch enable local audio ").concat(h.uid)),this._handleSetStreamLocalEnable("audio",h.uid,!0)),h._trust_video_enabled_state_||(x.debug("[".concat(this._clientId,"] auto dispatch enable local video ").concat(h.uid)),this._handleSetStreamLocalEnable("video",h.uid,!0)),h._trust_video_stream_added_state_||(x.debug("[".concat(this._clientId,"] auto dispatch reset video stream added ").concat(h.uid)),this._handleResetAddStream(h,"video")),h._trust_audio_stream_added_state_||(x.debug("[".concat(this._clientId,"] auto dispatch reset audio stream added ").concat(h.uid)),this._handleResetAddStream(h,"audio")),h._video_added_||h._audio_added_||(x.debug("[".concat(this._clientId,"] auto dispatch stream remove ").concat(h.uid)),this._handleRemoveStream({uid:h.uid,uint_id:h._uintid}))}))},1e3))}c()}),this._gateway.on(ls.REQUEST_NEW_GATEWAY_LIST,async(t,r)=>{if(!this._joinInfo)return r(new Ae(te.UNEXPECTED_ERROR,"can not recover, no join info"));try{let s;const a=await Q9(Uu(Uu({},this._joinInfo),{},{uid:this._joinInfo.uid,stringUid:void 0}));a?(s=a.ap,t$(a),this._joinInfo.preload=!0):(s=await k2(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||Di,this.store),this._joinInfo.preload=!1),this._joinInfo&&(this._joinInfo.apResponse=s.gatewayInfo.res,this._joinInfo.gatewayAddrs=s.gatewayInfo.gatewayAddrs,this._joinInfo.uni_lbs_ip=s.gatewayInfo.uni_lbs_ip);const c=[];s.gatewayInfo.gatewayAddrs.forEach(d=>{let{address:h}=d;const[m,y]=h.split(":");this._joinInfo&&this._joinInfo.proxyServer?c.push({proxy:this._joinInfo.proxyServer,host:m,port:y}):c.push({host:m,port:y})}),t(c)}catch(s){r(s)}}),this._gateway.on(ls.NETWORK_QUALITY,t=>{this._networkQualitySensitivity==="normal"&&this.safeEmit(wn.NETWORK_QUALITY,t)}),this._gateway.on(ls.STREAM_TYPE_CHANGE,(t,r)=>{this.safeEmit(wn.STREAM_TYPE_CHANGED,t,r),Nt.reportApiInvoke(this._sessionId,{name:Ni.STREAM_TYPE_CHANGE,options:[t,r],tag:Kr.TRACER}).onSuccess(JSON.stringify({uid:t,streamType:r}))}),this._gateway.on(ls.IS_P2P_DISCONNECTED,t=>{this._p2pChannel.isP2PDisconnected()?t(!0):this._p2pChannel.hasLocalMedia()||this._p2pChannel.hasRemoteMedia()?t(!1):t(!0)}),this._gateway.on(ls.REQUEST_P2P_CONNECTION_PARAMS,async(t,r,s)=>{try{let a=await this._p2pChannel.getEstablishParams();oe("ENABLE_PREALLOC_PC")&&a||(a=await this._p2pChannel.startP2PConnection(t)),r(a)}catch(a){s(a)}}),this._gateway.on(ls.JOIN_RESPONSE,(t,r)=>{if(this.store.useP2P)return;let s;t.attributes?s=t.attributes.userAttributes.preSubSsrcs:x.debug("no attributes in joinResponse");const a=XH(t.ortc,r,s);this._p2pChannel.connect(a)}),this._gateway.on(ls.PRE_CONNECT_PC,async t=>{const{candidates:r,fingerprint:s}=t;if(this._joinInfo&&r.length>0&&!this._p2pChannel.isPlanB){var a;await this._p2pChannel.startP2PConnection({turnServer:this._joinInfo.turnServer});const{cert:c,cid:d}=this._joinInfo.apResponse;await this._p2pChannel.connect({iceParameters:{iceUfrag:"".concat(d,"_").concat(c),icePwd:"".concat(d,"_").concat(c)},dtlsParameters:{fingerprints:[{hashFunction:"sha-256",fingerprint:(a=oe("FINGERPRINT"))!==null&&a!==void 0?a:s}]},candidates:r,rtpCapabilities:{send:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},recv:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]}},setup:"active",cname:"o/i14u9pJrxRKAsu",preallocation:!0})}})}_handleGatewaySignalEvents(){this._gateway.signal.on(Cn.ON_USER_ONLINE,this._handleUserOnline),this._gateway.signal.on(Cn.ON_USER_OFFLINE,this._handleUserOffline),this._gateway.signal.on(Cn.ON_ADD_AUDIO_STREAM,t=>this._handleAddAudioOrVideoStream("audio",t.uid,t.ssrcId,t.cname,t.uint_id,t.ortc)),this._gateway.signal.on(Cn.ON_ADD_VIDEO_STREAM,t=>this._handleAddAudioOrVideoStream("video",t.uid,t.ssrcId,t.cname,t.uint_id,t.ortc,t.rtxSsrcId)),this._gateway.signal.on(Cn.ON_REMOTE_DATASTREAM_UPDATE,t=>{this._handleUpdateDataChannel(t)}),this._gateway.signal.on(Cn.ON_REMOTE_FULL_DATASTREAM_INFO,t=>{this._handleUpdateDataChannel({added:t.datastreams||[],deleted:[]},!0)}),this._gateway.signal.on(Cn.ON_REMOVE_STREAM,this._handleRemoveStream),this._gateway.signal.on(Cn.ON_P2P_LOST,this._handleP2PLost),this._gateway.signal.on(Cn.MUTE_AUDIO,t=>this._handleMuteStream(t.uid,bt.AUDIO,!0)),this._gateway.signal.on(Cn.UNMUTE_AUDIO,t=>this._handleMuteStream(t.uid,bt.AUDIO,!1)),this._gateway.signal.on(Cn.MUTE_VIDEO,t=>this._handleMuteStream(t.uid,bt.VIDEO,!0)),this._gateway.signal.on(Cn.UNMUTE_VIDEO,t=>this._handleMuteStream(t.uid,bt.VIDEO,!1)),this._gateway.signal.on(Cn.RECEIVE_METADATA,t=>{const r=X_(t.metadata);this.safeEmit(wn.RECEIVE_METADATA,t.uid,r)}),this._gateway.signal.on(Cn.ON_DATA_STREAM,async t=>{var r;if(!t)return;let s=X_(t.payload);if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&lt(r=["aes-128-gcm2","aes-256-gcm2"]).call(r,this._encryptionMode)){if(t.payload.length<Qv)throw new Ae(te.UNEXPECTED_RESPONSE,"payload length ".concat(t.payload.length," is less than header length ").concat(Qv));s=await async function(d,h,m){const y=m.subarray(0,Qv),v=y.slice(8,Qv),w=(v[0]<<8)+v[1],R=(y[6]<<8)+y[7],O=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:d,tagLength:c8,additionalData:new Uint8Array(Yz(w,2))},h,m.subarray(Qv));return new Uint8Array(O).subarray(0,R)}(this._encryptDataStreamIv,this._encryptDataStreamKey,s)}let a=0;if(t.ordered||t.syncWithAudio){const c=this._p2pChannel.getStats(),d=this.remoteUsers.find(m=>m.uid===t.uid),h=c==null?void 0:c.audioRecv.find(m=>m.ssrc===(d==null?void 0:d._audioSSRC));a=h==null?void 0:h.jitterBufferMs}(a==null||Number.isNaN(a))&&(a=0),r_e(Uu(Uu({},t),{},{payload:s}),a,{id:this._clientId,onStreamMessage:typeof this.onStreamMessage=="function"?this.onStreamMessage.bind(this):void 0,safeEmit:this.safeEmit.bind(this)})}),this._gateway.signal.on(Cn.ON_CRYPT_ERROR,()=>{Xm(()=>{x.warning("[".concat(this._clientId,"] on crypt error")),this.safeEmit(wn.CRYPT_ERROR)},this._sessionId)}),this._gateway.signal.on(Cn.ON_TOKEN_PRIVILEGE_WILL_EXPIRE,this._handleTokenWillExpire),this._gateway.signal.on(Cn.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{x.warning("[".concat(this._clientId,"] received message onTokenPrivilegeDidExpire, please get new token and join again")),this._gateway.leave(!0,Xn.TOKEN_EXPIRE),this.safeEmit(wn.ON_TOKEN_PRIVILEGE_DID_EXPIRE),this._reset()}),this._gateway.signal.on(Cn.ON_STREAM_FALLBACK_UPDATE,t=>{x.debug("[".concat(this._clientId,"] stream fallback peerId: ").concat(t.stream_id,", attr: ").concat(t.stream_type)),this.safeEmit(wn.STREAM_FALLBACK,t.stream_id,t.stream_type===1?"fallback":"recover")}),this._gateway.signal.on(Cn.ON_PUBLISH_STREAM,t=>{this.uid===this._uid&&(this._p2pChannel.reportPublishEvent(!0,null,void 0,!1,JSON.stringify({proxy:t.proxy})),x.info("[".concat(this._clientId,"] on publish stream, ").concat(JSON.stringify(t))))}),this._gateway.signal.on(Cn.ENABLE_LOCAL_VIDEO,t=>{this._handleSetStreamLocalEnable("video",t.uid,!0)}),this._gateway.signal.on(Cn.DISABLE_LOCAL_VIDEO,t=>{this._handleSetStreamLocalEnable("video",t.uid,!1)}),this._gateway.signal.on(Jt.REQUEST_TIMEOUT,(t,r)=>{if(this._joinInfo)switch(t){case Yt.PUBLISH:{if(!r)return;const c=r.ortc;if(c){var s,a;const d=c.some(y=>{let{stream_type:v}=y;return v===Qn.Audio}),h=c.some(y=>{let{stream_type:v}=y;return v!==Qn.Audio}),m=c.some(y=>{let{stream_type:v}=y;return v===Qn.Screen||v===Qn.ScreenLow});r.state==="offer"&&Nt.publish(this._joinInfo.sid,{eventElapse:Zs.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:!1,ec:te.TIMEOUT,audio:d,video:h,p2pid:r.p2p_id,publishRequestid:this.store.pubId,screenshare:m,audioName:d?(s=c.find(y=>{let{stream_type:v}=y;return v===Qn.Audio}))===null||s===void 0||(s=s.ssrcs[0])===null||s===void 0?void 0:s.ssrcId.toString():void 0,videoName:h?(a=c.find(y=>{let{stream_type:v}=y;return v!==Qn.Audio}))===null||a===void 0||(a=a.ssrcs[0])===null||a===void 0?void 0:a.ssrcId.toString():void 0})}break}case Yt.SUBSCRIBE:r&&Nt.subscribe(this._joinInfo.sid,{succ:!1,ec:te.TIMEOUT,audio:r.stream_type===bt.AUDIO,video:r.stream_type===bt.VIDEO,peerid:r.stream_id,subscribeRequestid:r.ssrcId,p2pid:this.store.p2pId,eventElapse:Zs.measureFromSubscribeStart(this.store.clientId,r.ssrcId),preSsrc:this._p2pChannel.isPreSubScribe(r.ssrcId)})}}),this._gateway.signal.on(Cn.ON_P2P_OK,t=>{this.uid,this._uid}),this._gateway.signal.on(Cn.ON_PUBLISHED_USER_LIST,t=>{if(t==null||!t.users)return;oe("BLOCK_LOCAL_CLIENT")&&(t.users=t.users.filter(a=>!sy(a.string_id||a.stream_id,this.channelName)));const r=[],s=[];for(const a of t.users){let c=this._users.find(w=>w._uintid===a.stream_id);c?c._trust_in_room_=!0:(c=new sg(a.string_id||a.stream_id,a.stream_id),this._users.push(c),this.getListeners(wn.PUBLISHED_USER_LIST).length===0&&(x.debug("[".concat(this._clientId,"] user online"),a.stream_id),this.safeEmit(wn.USER_JOINED,c)));const d=es.Audio&a.stream_type,h=(es.Video|es.LwoVideo)&a.stream_type,m=(65280&a.stream_type)!=0,y=d&&c.hasAudio,v=h&&c.hasVideo;h&&(c._trust_video_stream_added_state_=!0,c._video_added_=!0,c._videoSSRC=a.video_ssrc,c._rtxSsrcId=a.video_rtx),d&&(c._trust_audio_stream_added_state_=!0,c._audio_added_=!0,c._audioSSRC=a.audio_ssrc),d&&!y&&this.getListeners(wn.PUBLISHED_USER_LIST).length===0&&(x.info("[".concat(this._clientId,"] remote user ").concat(c.uid," published audio")),this.safeEmit(wn.USER_PUBLISHED,c,"audio")),h&&!v&&this.getListeners(wn.PUBLISHED_USER_LIST).length===0&&(x.info("[".concat(this._clientId,"] remote user ").concat(c.uid," published video")),this.safeEmit(wn.USER_PUBLISHED,c,"video")),(d&&!y||h&&!v||m)&&r.push(c),h&&this._p2pChannel.hasPendingRemoteMedia(c,"video")&&s.push({user:c,mediaType:"video"}),d&&this._p2pChannel.hasPendingRemoteMedia(c,"audio")&&s.push({user:c,mediaType:"audio"})}s.length>0&&(x.debug("[".concat(this._clientId,"] RE massSubscribe after reconnect ").concat(s.map(a=>"user: ".concat(a.user.uid,", mediaType: ").concat(a.mediaType)).join("; ")," ")),this.massSubscribe(s).catch(a=>{x.error("[".concat(this._clientId,"] mass resubscribe error"),a.toString())})),this.getListeners(wn.PUBLISHED_USER_LIST).length>0?oe("ENABLE_DATASTREAM_2")?this._pendingPublishedUsers=r:(x.info("[".concat(this._clientId,"] client emit user-list event, users: ").concat(r.map(a=>a.uid).join(", "))),this.safeEmit(wn.PUBLISHED_USER_LIST,r)):x.info("[".concat(this._clientId,"] client not emit user-list event case there is no user-list listener, users: ").concat(r.map(a=>a.uid).join(", ")))}),this._gateway.signal.on(Cn.ON_RTP_CAPABILITY_CHANGE,t=>{const{video_codec:r}=t;this._p2pChannel instanceof tT&&this._p2pChannel.updateRemoteRTPCapabilities(r.map(s=>s.toLowerCase()).filter(s=>{var a;return lt(a=Object.keys(dP)).call(a,s)}))})}_handleP2PEvents(){this._gateway.signal.on(Cn.ON_USER_OFFLINE,()=>{this._p2pChannel.disconnectForReconnect()}),this._gateway.signal.on(hi.PUBLISH,(t,r,s)=>{const{uid:a}=t;t.forEach(c=>{const{kind:d,ssrcs:h,mid:m,isMuted:y}=c;this._handleP2PAddAudioOrVideoStream(d,a,h[0].ssrcId,m);const v=this._users.find(w=>w.uid===a);return v&&this.store.useP2P?this._p2pChannel.mockSubscribe(v,d,h[0].ssrcId,m).then(()=>{r()}).catch(s):r(),this._handleMuteStream(a,d,!!y)})}),this._gateway.signal.on(hi.CALL,async(t,r,s)=>{if(this.store.useP2P)try{var a;r(await this._p2pChannel.startP2P({turnServer:(a=this._joinInfo)===null||a===void 0?void 0:a.turnServer},t))}catch(c){s(c)}}),this._gateway.signal.on(Jt.P2P_CONNECTION,async t=>{this.store.useP2P&&(await this._p2pChannel).p2pConnect(t)}),this._gateway.signal.on(hi.UNPUBLISH,async(t,r,s)=>{if(this.store.useP2P){const{unpubMsg:a,uid:c}=t,d=this._users.find(h=>h.uid===c);if(!d)return x.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(c)),void r();try{a.forEach(async h=>{let{stream_type:m}=h;const y=m===Qn.Audio?bt.AUDIO:bt.VIDEO;await this._p2pChannel.unsubscribe(d,y),this._handleMuteStream(c,y,!0)}),r()}catch(h){s(h)}}}),this._gateway.signal.on(hi.CONTROL,async(t,r)=>{const{action:s}=t;switch(s){case eg.MUTE_LOCAL_VIDEO:this._handleMuteStream(r,bt.VIDEO,!0);break;case eg.MUTE_LOCAL_AUDIO:this._handleMuteStream(r,bt.AUDIO,!0);break;case eg.UNMUTE_LOCAL_VIDEO:this._handleP2PAddAudioOrVideoStream("video",r),this._handleMuteStream(r,bt.VIDEO,!1);break;case eg.UNMUTE_LOCAL_AUDIO:this._handleP2PAddAudioOrVideoStream("audio",r),this._handleMuteStream(r,bt.AUDIO,!1)}}),this._gateway.signal.on(hi.RESTART_ICE,async(t,r,s)=>{if(this.store.useP2P)try{const{direction:a,iceParameter:c}=t;a!==Xo.SEND_ONLY||c?r(await this._p2pChannel.restartICE(a,c)):(this._p2pChannel.handleDisconnect(a),r())}catch(a){s(a)}}),this._gateway.signal.on(hi.CANDIDATE,t=>{if(this.store.useP2P){const{candidate:r,direction:s}=t;this._p2pChannel.addRemoteCandidate(r,s)}}),this._p2pChannel.on(jt.RequestP2PRestartICE,async(t,r,s)=>{try{const{direction:a}=t;r(await this._gateway.sendExtensionMessage(hi.RESTART_ICE,t,a===Xo.SEND_ONLY))}catch(a){s(a)}}),this._p2pChannel.on(jt.LocalCandidate,t=>{this._gateway.sendExtensionMessage(hi.CANDIDATE,JSON.stringify(t),!0)}),this._p2pChannel.on(jt.RequestP2PMuteLocal,async(t,r,s)=>{try{await this._gateway.sendExtensionMessage(hi.CONTROL,t,!0),r()}catch(a){s(a)}}),this._p2pChannel.on(jt.RequestP2PUnmuteRemote,async(t,r,s)=>{if(this._joinInfo)try{await this._gateway.unmuteRemote(t,this._joinInfo.stringUid||this._joinInfo.uid),r()}catch(a){a.code===te.DISCONNECT_P2P?r():s(a)}else r()}),this._p2pChannel.on(jt.RequestP2PMuteRemote,async(t,r,s)=>{if(this._joinInfo)try{await this._gateway.muteRemote(t,this._joinInfo.stringUid||this._joinInfo.uid),r()}catch(a){a.code===te.DISCONNECT_P2P?r():s(a)}else r()}),this._p2pChannel.on(jt.StateChange,(t,r)=>{r===Jn.Connected&&this._p2pChannel.republish()})}_handleP2PChannelEvents(){this._p2pChannel.on(jt.PeerConnectionStateChange,t=>{const r=this._peerConnectionState;t!==r&&(this.safeEmit(wn.PEERCONNECTION_STATE_CHANGE,t,r),this._peerConnectionState=t)}),this._p2pChannel.on(jt.RequestMuteLocal,async(t,r,s)=>{if(this._joinInfo)try{await this._gateway.muteLocal(t,this._joinInfo.stringUid||this._joinInfo.uid),r()}catch(a){a.code===te.DISCONNECT_P2P?r():s(a)}else r()}),this._p2pChannel.on(jt.RequestUnmuteLocal,async(t,r,s)=>{if(this._joinInfo)try{await this._gateway.unmuteLocal(t,this._joinInfo.stringUid||this._joinInfo.uid),r()}catch(a){a.code===te.DISCONNECT_P2P?r():s(a)}else r()}),this._p2pChannel.on(jt.RequestRePublish,(t,r,s)=>{this.publish(t,!1).then(r).catch(s)}),this._p2pChannel.on(jt.RequestRePublishDataChannel,(t,r,s)=>{pt.all(t.map(async a=>{const c=await this._p2pChannel.publishDataChannel([a]);try{c.forEach(d=>{this._uid&&this._gateway.publishDataChannel(this._uid,d,!0)})}catch(d){if(d.code!==te.DISCONNECT_P2P)throw d}})).then(r).catch(s)}),this._p2pChannel.on(jt.RequestReSubscribe,async(t,r,s)=>{try{for(const{user:a,kind:c}of t)c===bt.VIDEO?await this.subscribe(a,"video"):await this.subscribe(a,"audio");r()}catch(a){s(a)}}),this._p2pChannel.on(jt.RequestUpload,(t,r)=>{this._gateway.upload(t,r)}),this._p2pChannel.on(jt.RequestUploadStats,t=>{this._gateway.uploadWRTCStats(t)}),this._p2pChannel.on(jt.MediaReconnectStart,t=>{this.safeEmit(wn.MEDIA_RECONNECT_START,t)}),this._p2pChannel.on(jt.MediaReconnectEnd,t=>{this.safeEmit(wn.MEDIA_RECONNECT_END,t)}),this._p2pChannel.on(jt.NeedSignalRTT,t=>{t(this._gateway.getSignalRTT())}),this._p2pChannel.on(jt.RequestRestartICE,async t=>{if(this.store.useP2P)return;const r=await this._p2pChannel.restartICE(t),s=await r.next();if(s.done)return;const a=s.value;let c;try{c=await this._gateway.restartICE({iceParameters:a})}catch(h){return void r.throw(h)}const{iceParameters:d}=function(h){const m=h.iceParameters;return{iceParameters:{iceUfrag:m.iceUfrag,icePwd:m.icePwd}}}(c);await r.next({remoteIceParameters:d})}),this._p2pChannel.on(jt.RequestReconnect,async()=>{this._gateway.reconnect()}),this._p2pChannel.on(jt.RequestReconnectPC,async()=>{var t;const{iceParameters:r,dtlsParameters:s,rtpCapabilities:a}=await this._p2pChannel.startP2PConnection({turnServer:(t=this._joinInfo)===null||t===void 0?void 0:t.turnServer}),{gatewayEstablishParams:c,gatewayAddress:d}=await this._gateway.reconnectPC({iceParameters:r,dtlsParameters:s,rtpCapabilities:a}),h=XH(c,d);await this._p2pChannel.connect(h),await this._p2pChannel.republish(),await this._p2pChannel.reSubscribe()}),this._p2pChannel.on(jt.RequestUnpublishForReconnectPC,async(t,r,s)=>{this._joinInfo&&this._uid!==void 0?(await this._gateway.unpublish(t,this._uid),r()):s()}),this._p2pChannel.on(jt.P2PLost,()=>{this.safeEmit(wn.P2P_LOST,this.store.uid)}),this._p2pChannel.on(jt.UpdateVideoEncoder,t=>{t._encoderConfig&&this._gateway.setVideoProfile(t._encoderConfig)}),this._p2pChannel.on(jt.ConnectionTypeChange,t=>{this.safeEmit(wn.IS_USING_CLOUD_PROXY,t)}),this._p2pChannel.on(jt.RequestLowStreamParameter,t=>{t(this._lowStreamParameter||{width:160,height:120,framerate:15,bitrate:50})}),this._p2pChannel.on(jt.QueryClientConnectionState,t=>{t(this.connectionState)}),this._p2pChannel.on(jt.AudioMetadata,t=>{this.safeEmit(wn.AUDIO_METADATA,t)})}getKeyMetrics(){return this.store.keyMetrics}async enableContentInspect(t){if(!this._joinInfo||this.connectionState!=="CONNECTED")throw new Ae(te.INVALID_OPERATION,"[".concat(this._clientId,"] can not create content inspect, please join channel first"));if(this._inspect)throw new Ae(te.INVALID_OPERATION,"[".concat(this._clientId,"] Inspect content service already in connecting/connected state"));try{const s=(r={config:t},Sf("ContentInspect").create(r));this._inspect=s,this.handleVideoInspectEvents(s);const{appId:a,cname:c,sid:d,token:h,uid:m,cid:y,vid:v}=this._joinInfo;await s.init({appId:a,areaCode:"",cname:c,sid:d,token:h,uid:m,cid:y,vid:v?Number(v):0},Di)}catch(s){throw Array.isArray(s)?s[0]:s}var r}handleVideoInspectEvents(t){t.on(us.CONNECTION_STATE_CHANGE,(r,s)=>{if(this.safeEmit(wn.CONTENT_INSPECT_CONNECTION_STATE_CHANGE,r,s),s===Du.CONNECTED){if(this.connectionState!=="CONNECTED")return void this.safeEmit(wn.CONTENT_INSPECT_ERROR,new Ae(te.OPERATION_ABORTED,"Content inspect was cancelled because it left the channel"));t.inspectImage()}}),t.on(us.INSPECT_RESULT,(r,s)=>{var a;if((s==null?void 0:s.code)===te.INVALID_OPERATION&&this.connectionState==="DISCONNECTED")return x.debug("Stop inspect content because that has left channel"),this==null||(a=this._inspect)===null||a===void 0||a.close(),void(this._inspect=void 0);this.safeEmit(wn.CONTENT_INSPECT_RESULT,r,s)}),t.on(us.CLIENT_LOCAL_VIDEO_TRACK,r=>{r(this.localTracks.filter(s=>s.trackMediaType==="video")[0])})}async disableContentInspect(){if(!this._inspect)throw new Ae(te.INVALID_OPERATION,"[".concat(this._clientId,"] inspectVideoContent not started"));try{this._inspect.close(),this._inspect=void 0}catch(t){throw Array.isArray(t)?t[0]:t}}async setImageModeration(t,r){if(ff(t,"enabled"),t){if(!r)throw new Ae(te.INVALID_PARAMS,"config is required");if(f$(r),!this._joinInfo)throw new Ae(te.INVALID_OPERATION,"can not create image moderation, please join channel first");try{if(this._moderation)this._moderation.updateConfig(r);else{const a=(s={config:r},Sf("ImageModeration").create(s));this._moderation=a,this.handleImageModerationEvents(a);const{appId:c,cname:d,sid:h,token:m,uid:y,cid:v,vid:w}=this._joinInfo;await a.init({appId:c,areaCode:"",cname:d,sid:h,token:m,uid:y,cid:v,vid:w?Number(w):0},Di)}}catch(a){throw Array.isArray(a)?a[0]:a}}else{var s;if(!this._moderation)throw new Ae(te.INVALID_OPERATION,"[".concat(this._clientId,"] image moderation not started"));try{this._moderation.close(),this._moderation.removeAllListeners(),this._moderation=void 0}catch(a){throw Array.isArray(a)?a[0]:a}}}handleImageModerationEvents(t){t.on(Ld.CONNECTION_STATE_CHANGE,(r,s)=>{if(this.safeEmit(wn.IMAGE_MODERATION_CONNECTION_STATE_CHANGE,r,s),r===jl.CONNECTED){if(this.connectionState!=="CONNECTED")throw this.setImageModeration(!1),new Ae(te.OPERATION_ABORTED,"Image moderation was cancelled because it left the channel");t.inspectImage()}}),t.on(Ld.CLIENT_LOCAL_VIDEO_TRACK,r=>{r(this.localTracks.filter(s=>s.trackMediaType==="video")[0])})}setP2PTransport(t){if(function(r){$i(r,"transport",["default","auto","relay","sd-rtn"])}(t),this.mode!=="p2p")throw new Ae(te.INVALID_OPERATION,"only p2p mode can set p2pTransport");this.store.p2pTransport=t,x.info("[".concat(this._clientId,"] set client p2pTransport to ").concat(t))}getJoinChannelServiceRecords(){return x.debug("getJoinChannelServiceRecords"),this.store.joinChannelServiceRecords}async setPublishAudioFilterEnabled(t){ff(t,"enabled"),sr("ENABLE_PUBLISH_AUDIO_FILTER",t),this._joinInfo&&await this._gateway.setPublishAudioFilterEnabled(t)}_handleResetAddStream(t,r){switch(r){case"audio":t._audio_added_=!1,t._trust_audio_stream_added_state_=!0;break;case"video":t._video_added_=!1,t._trust_video_stream_added_state_=!0}}},At(_t.prototype,"leave",[m$],Object.getOwnPropertyDescriptor(_t.prototype,"leave"),_t.prototype),At(_t.prototype,"publish",[g$],Object.getOwnPropertyDescriptor(_t.prototype,"publish"),_t.prototype),At(_t.prototype,"unpublish",[_$],Object.getOwnPropertyDescriptor(_t.prototype,"unpublish"),_t.prototype),At(_t.prototype,"subscribe",[y$],Object.getOwnPropertyDescriptor(_t.prototype,"subscribe"),_t.prototype),At(_t.prototype,"presubscribe",[E$],Object.getOwnPropertyDescriptor(_t.prototype,"presubscribe"),_t.prototype),At(_t.prototype,"massSubscribe",[v$],Object.getOwnPropertyDescriptor(_t.prototype,"massSubscribe"),_t.prototype),At(_t.prototype,"unsubscribe",[S$],Object.getOwnPropertyDescriptor(_t.prototype,"unsubscribe"),_t.prototype),At(_t.prototype,"massUnsubscribe",[b$],Object.getOwnPropertyDescriptor(_t.prototype,"massUnsubscribe"),_t.prototype),At(_t.prototype,"setLowStreamParameter",[w$],Object.getOwnPropertyDescriptor(_t.prototype,"setLowStreamParameter"),_t.prototype),At(_t.prototype,"enableDualStream",[T$],Object.getOwnPropertyDescriptor(_t.prototype,"enableDualStream"),_t.prototype),At(_t.prototype,"disableDualStream",[C$],Object.getOwnPropertyDescriptor(_t.prototype,"disableDualStream"),_t.prototype),At(_t.prototype,"setClientRole",[R$],Object.getOwnPropertyDescriptor(_t.prototype,"setClientRole"),_t.prototype),At(_t.prototype,"_setClientRoleOptions",[I$],Object.getOwnPropertyDescriptor(_t.prototype,"_setClientRoleOptions"),_t.prototype),At(_t.prototype,"setProxyServer",[A$],Object.getOwnPropertyDescriptor(_t.prototype,"setProxyServer"),_t.prototype),At(_t.prototype,"setTurnServer",[P$],Object.getOwnPropertyDescriptor(_t.prototype,"setTurnServer"),_t.prototype),At(_t.prototype,"setLicense",[O$],Object.getOwnPropertyDescriptor(_t.prototype,"setLicense"),_t.prototype),At(_t.prototype,"startProxyServer",[k$],Object.getOwnPropertyDescriptor(_t.prototype,"startProxyServer"),_t.prototype),At(_t.prototype,"stopProxyServer",[N$],Object.getOwnPropertyDescriptor(_t.prototype,"stopProxyServer"),_t.prototype),At(_t.prototype,"setLocalAccessPointsV2",[D$],Object.getOwnPropertyDescriptor(_t.prototype,"setLocalAccessPointsV2"),_t.prototype),At(_t.prototype,"setLocalAccessPoints",[x$],Object.getOwnPropertyDescriptor(_t.prototype,"setLocalAccessPoints"),_t.prototype),At(_t.prototype,"setRemoteDefaultVideoStreamType",[L$],Object.getOwnPropertyDescriptor(_t.prototype,"setRemoteDefaultVideoStreamType"),_t.prototype),At(_t.prototype,"setRemoteVideoStreamType",[M$],Object.getOwnPropertyDescriptor(_t.prototype,"setRemoteVideoStreamType"),_t.prototype),At(_t.prototype,"setStreamFallbackOption",[U$],Object.getOwnPropertyDescriptor(_t.prototype,"setStreamFallbackOption"),_t.prototype),At(_t.prototype,"setEncryptionConfig",[V$],Object.getOwnPropertyDescriptor(_t.prototype,"setEncryptionConfig"),_t.prototype),At(_t.prototype,"renewToken",[j$],Object.getOwnPropertyDescriptor(_t.prototype,"renewToken"),_t.prototype),At(_t.prototype,"enableAudioVolumeIndicator",[F$],Object.getOwnPropertyDescriptor(_t.prototype,"enableAudioVolumeIndicator"),_t.prototype),At(_t.prototype,"startLiveStreaming",[B$],Object.getOwnPropertyDescriptor(_t.prototype,"startLiveStreaming"),_t.prototype),At(_t.prototype,"setLiveTranscoding",[W$],Object.getOwnPropertyDescriptor(_t.prototype,"setLiveTranscoding"),_t.prototype),At(_t.prototype,"stopLiveStreaming",[z$],Object.getOwnPropertyDescriptor(_t.prototype,"stopLiveStreaming"),_t.prototype),At(_t.prototype,"startChannelMediaRelay",[G$],Object.getOwnPropertyDescriptor(_t.prototype,"startChannelMediaRelay"),_t.prototype),At(_t.prototype,"updateChannelMediaRelay",[H$],Object.getOwnPropertyDescriptor(_t.prototype,"updateChannelMediaRelay"),_t.prototype),At(_t.prototype,"stopChannelMediaRelay",[$$],Object.getOwnPropertyDescriptor(_t.prototype,"stopChannelMediaRelay"),_t.prototype),At(_t.prototype,"sendCustomReportMessage",[K$],Object.getOwnPropertyDescriptor(_t.prototype,"sendCustomReportMessage"),_t.prototype),At(_t.prototype,"pickSVCLayer",[q$],Object.getOwnPropertyDescriptor(_t.prototype,"pickSVCLayer"),_t.prototype),At(_t.prototype,"setRTMConfig",[Y$],Object.getOwnPropertyDescriptor(_t.prototype,"setRTMConfig"),_t.prototype),At(_t.prototype,"enableContentInspect",[X$],Object.getOwnPropertyDescriptor(_t.prototype,"enableContentInspect"),_t.prototype),At(_t.prototype,"disableContentInspect",[J$],Object.getOwnPropertyDescriptor(_t.prototype,"disableContentInspect"),_t.prototype),At(_t.prototype,"setImageModeration",[Q$],Object.getOwnPropertyDescriptor(_t.prototype,"setImageModeration"),_t.prototype),At(_t.prototype,"setP2PTransport",[Z$],Object.getOwnPropertyDescriptor(_t.prototype,"setP2PTransport"),_t.prototype),At(_t.prototype,"getJoinChannelServiceRecords",[e7],Object.getOwnPropertyDescriptor(_t.prototype,"getJoinChannelServiceRecords"),_t.prototype),At(_t.prototype,"setPublishAudioFilterEnabled",[t7],Object.getOwnPropertyDescriptor(_t.prototype,"setPublishAudioFilterEnabled"),_t.prototype),_t);class iT{constructor(r,s){q(this,"id",0),q(this,"element",void 0),q(this,"peerPair",void 0),q(this,"context",void 0),q(this,"audioPlayerElement",void 0),q(this,"audioTrack",void 0),iT.count+=1,this.id=iT.count,this.element=r,this.context=s}initPeers(){this.peerPair=[new RTCPeerConnection,new RTCPeerConnection],this.peerPair[1].ontrack=r=>{const s=document.createElement("audio");s.srcObject=new MediaStream([r.track]),s.play(),this.audioPlayerElement=s}}async switchSdp(){if(!this.peerPair)return;const r=async(a,c)=>{const d=c==="offer"?await a.createOffer():await a.createAnswer();return await a.setLocalDescription(d),a.iceGatheringState==="complete"?a.localDescription:new pt(h=>{a.onicegatheringstatechange=()=>{a.iceGatheringState==="complete"&&h(a.localDescription)}})},s=async(a,c)=>await a.setRemoteDescription(c);try{const a=await r(this.peerPair[0],"offer");await s(this.peerPair[1],a);const c=await r(this.peerPair[1],"answer");await s(this.peerPair[0],c)}catch(a){throw new Ae(te.LOCAL_AEC_ERROR,a.toString()).print()}}async getTracksFromMediaElement(r){if(this.audioTrack)return this.audioTrack;let s;try{r instanceof HTMLVideoElement&&(r.captureStream?r.captureStream():r.mozCaptureStream()),s=this.context.createMediaStreamDestination(),this.context.createMediaElementSource(r).connect(s)}catch(c){throw new Ae(te.LOCAL_AEC_ERROR,c.toString()).print()}if(!s)throw new Ae(te.LOCAL_AEC_ERROR,"no dest node when local aec").print();const a=s.stream.getAudioTracks()[0];return this.audioTrack=a,a}getElement(){return this.element}async startEchoCancellation(){this.context.resume(),this.peerPair&&this.close(),this.initPeers();const r=this.element,s=await this.getTracksFromMediaElement(r);this.peerPair&&this.peerPair[0].addTrack(s),await this.switchSdp()}close(){x.debug("close echo cancellation unit, id is",this.id),this.audioPlayerElement&&this.audioPlayerElement.pause(),this.peerPair&&this.peerPair.forEach(r=>{r.close()}),this.peerPair=void 0,this.audioPlayerElement=void 0}}var r7,rO;q(iT,"count",0);const v_e=window.AudioContext||window.webkitAudioContext,S_e=new(r7=Ht({report:Nt}),At((rO=class{constructor(){q(this,"units",[]),q(this,"context",void 0)}processExternalMediaAEC(t){if(!this._doesEnvironmentNeedAEC())return x.debug("the system does not need to process local aec"),-1;this.context||(this.context=new v_e);let r=this.units.find(s=>s&&s.getElement()===t);return r||(r=new iT(t,this.context),this.units.push(r)),r.startEchoCancellation(),x.debug("start processing local audio echo cancellation, id is",r.id),r.id}_doesEnvironmentNeedAEC(){return Ln().name!==$n.SAFARI}}).prototype,"processExternalMediaAEC",[r7],Object.getOwnPropertyDescriptor(rO.prototype,"processExternalMediaAEC"),rO.prototype),rO);function i7(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}function s7(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?i7(Object(s),!0).forEach(function(a){q(t,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):i7(Object(s)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))})}return t}const K2=window||document;function o7(t){let r=arguments.length>1&&arguments[1]!==void 0&&arguments[1];if(!K2)return;const s=xi._cspEventHandlerPointer;if(s&&r)return void console.error(s,r);const a=c=>{if(!(c&&c.blockedURI&&(xi.onSecurityPolicyViolation||xi.getListeners(Mh.SECURITY_POLICY_VIOLATION).length>0)))return;const d=c.blockedURI;oe("CSP_DETECTED_HOSTNAME_LIST").some(h=>lt(d).call(d,h))&&(xi.onSecurityPolicyViolation&&typeof xi.onSecurityPolicyViolation=="function"&&xi.onSecurityPolicyViolation(c),xi.getListeners(Mh.SECURITY_POLICY_VIOLATION).length>0&&xi.safeEmit(Mh.SECURITY_POLICY_VIOLATION,c))};s&&K2.removeEventListener("securitypolicyviolation",s),(r||t&&typeof t=="function"||xi.getListeners(Mh.SECURITY_POLICY_VIOLATION).length>0)&&K2.addEventListener("securitypolicyviolation",a),xi._cspEventHandlerPointer=a}var b_e=P,w_e=zW,a7=RegExp.prototype,T_e=function(t){return t===a7||b_e(a7,t)?w_e(t):t.flags},Oo=l(T_e);function CS(t){let r=t.length;for(;--r>=0;)t[r]=0}const q2=256,c7=286,sT=30,oT=15,Y2=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),iO=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),C_e=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),l7=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Tf=new Array(576);CS(Tf);const aT=new Array(60);CS(aT);const cT=new Array(512);CS(cT);const lT=new Array(256);CS(lT);const X2=new Array(29);CS(X2);const sO=new Array(sT);function J2(t,r,s,a,c){this.static_tree=t,this.extra_bits=r,this.extra_base=s,this.elems=a,this.max_length=c,this.has_stree=t&&t.length}let u7,d7,h7;function Q2(t,r){this.dyn_tree=t,this.max_code=0,this.stat_desc=r}CS(sO);const p7=t=>t<256?cT[t]:cT[256+(t>>>7)],uT=(t,r)=>{t.pending_buf[t.pending++]=255&r,t.pending_buf[t.pending++]=r>>>8&255},ll=(t,r,s)=>{t.bi_valid>16-s?(t.bi_buf|=r<<t.bi_valid&65535,uT(t,t.bi_buf),t.bi_buf=r>>16-t.bi_valid,t.bi_valid+=s-16):(t.bi_buf|=r<<t.bi_valid&65535,t.bi_valid+=s)},Bh=(t,r,s)=>{ll(t,s[2*r],s[2*r+1])},f7=(t,r)=>{let s=0;do s|=1&t,t>>>=1,s<<=1;while(--r>0);return s>>>1},m7=(t,r,s)=>{const a=new Array(16);let c,d,h=0;for(c=1;c<=oT;c++)h=h+s[c-1]<<1,a[c]=h;for(d=0;d<=r;d++){let m=t[2*d+1];m!==0&&(t[2*d]=f7(a[m]++,m))}},g7=t=>{let r;for(r=0;r<c7;r++)t.dyn_ltree[2*r]=0;for(r=0;r<sT;r++)t.dyn_dtree[2*r]=0;for(r=0;r<19;r++)t.bl_tree[2*r]=0;t.dyn_ltree[512]=1,t.opt_len=t.static_len=0,t.sym_next=t.matches=0},_7=t=>{t.bi_valid>8?uT(t,t.bi_buf):t.bi_valid>0&&(t.pending_buf[t.pending++]=t.bi_buf),t.bi_buf=0,t.bi_valid=0},y7=(t,r,s,a)=>{const c=2*r,d=2*s;return t[c]<t[d]||t[c]===t[d]&&a[r]<=a[s]},Z2=(t,r,s)=>{const a=t.heap[s];let c=s<<1;for(;c<=t.heap_len&&(c<t.heap_len&&y7(r,t.heap[c+1],t.heap[c],t.depth)&&c++,!y7(r,a,t.heap[c],t.depth));)t.heap[s]=t.heap[c],s=c,c<<=1;t.heap[s]=a},E7=(t,r,s)=>{let a,c,d,h,m=0;if(t.sym_next!==0)do a=255&t.pending_buf[t.sym_buf+m++],a+=(255&t.pending_buf[t.sym_buf+m++])<<8,c=t.pending_buf[t.sym_buf+m++],a===0?Bh(t,c,r):(d=lT[c],Bh(t,d+q2+1,r),h=Y2[d],h!==0&&(c-=X2[d],ll(t,c,h)),a--,d=p7(a),Bh(t,d,s),h=iO[d],h!==0&&(a-=sO[d],ll(t,a,h)));while(m<t.sym_next);Bh(t,256,r)},eM=(t,r)=>{const s=r.dyn_tree,a=r.stat_desc.static_tree,c=r.stat_desc.has_stree,d=r.stat_desc.elems;let h,m,y,v=-1;for(t.heap_len=0,t.heap_max=573,h=0;h<d;h++)s[2*h]!==0?(t.heap[++t.heap_len]=v=h,t.depth[h]=0):s[2*h+1]=0;for(;t.heap_len<2;)y=t.heap[++t.heap_len]=v<2?++v:0,s[2*y]=1,t.depth[y]=0,t.opt_len--,c&&(t.static_len-=a[2*y+1]);for(r.max_code=v,h=t.heap_len>>1;h>=1;h--)Z2(t,s,h);y=d;do h=t.heap[1],t.heap[1]=t.heap[t.heap_len--],Z2(t,s,1),m=t.heap[1],t.heap[--t.heap_max]=h,t.heap[--t.heap_max]=m,s[2*y]=s[2*h]+s[2*m],t.depth[y]=(t.depth[h]>=t.depth[m]?t.depth[h]:t.depth[m])+1,s[2*h+1]=s[2*m+1]=y,t.heap[1]=y++,Z2(t,s,1);while(t.heap_len>=2);t.heap[--t.heap_max]=t.heap[1],((w,R)=>{const O=R.dyn_tree,D=R.max_code,G=R.stat_desc.static_tree,j=R.stat_desc.has_stree,W=R.stat_desc.extra_bits,Q=R.stat_desc.extra_base,ee=R.stat_desc.max_length;let fe,ye,Ee,_e,Ne,Ze,ft=0;for(_e=0;_e<=oT;_e++)w.bl_count[_e]=0;for(O[2*w.heap[w.heap_max]+1]=0,fe=w.heap_max+1;fe<573;fe++)ye=w.heap[fe],_e=O[2*O[2*ye+1]+1]+1,_e>ee&&(_e=ee,ft++),O[2*ye+1]=_e,ye>D||(w.bl_count[_e]++,Ne=0,ye>=Q&&(Ne=W[ye-Q]),Ze=O[2*ye],w.opt_len+=Ze*(_e+Ne),j&&(w.static_len+=Ze*(G[2*ye+1]+Ne)));if(ft!==0){do{for(_e=ee-1;w.bl_count[_e]===0;)_e--;w.bl_count[_e]--,w.bl_count[_e+1]+=2,w.bl_count[ee]--,ft-=2}while(ft>0);for(_e=ee;_e!==0;_e--)for(ye=w.bl_count[_e];ye!==0;)Ee=w.heap[--fe],Ee>D||(O[2*Ee+1]!==_e&&(w.opt_len+=(_e-O[2*Ee+1])*O[2*Ee],O[2*Ee+1]=_e),ye--)}})(t,r),m7(s,v,t.bl_count)},v7=(t,r,s)=>{let a,c,d=-1,h=r[1],m=0,y=7,v=4;for(h===0&&(y=138,v=3),r[2*(s+1)+1]=65535,a=0;a<=s;a++)c=h,h=r[2*(a+1)+1],++m<y&&c===h||(m<v?t.bl_tree[2*c]+=m:c!==0?(c!==d&&t.bl_tree[2*c]++,t.bl_tree[32]++):m<=10?t.bl_tree[34]++:t.bl_tree[36]++,m=0,d=c,h===0?(y=138,v=3):c===h?(y=6,v=3):(y=7,v=4))},S7=(t,r,s)=>{let a,c,d=-1,h=r[1],m=0,y=7,v=4;for(h===0&&(y=138,v=3),a=0;a<=s;a++)if(c=h,h=r[2*(a+1)+1],!(++m<y&&c===h)){if(m<v)do Bh(t,c,t.bl_tree);while(--m!=0);else c!==0?(c!==d&&(Bh(t,c,t.bl_tree),m--),Bh(t,16,t.bl_tree),ll(t,m-3,2)):m<=10?(Bh(t,17,t.bl_tree),ll(t,m-3,3)):(Bh(t,18,t.bl_tree),ll(t,m-11,7));m=0,d=c,h===0?(y=138,v=3):c===h?(y=6,v=3):(y=7,v=4)}};let b7=!1;const w7=(t,r,s,a)=>{ll(t,0+(a?1:0),3),_7(t),uT(t,s),uT(t,~s),s&&t.pending_buf.set(t.window.subarray(r,r+s),t.pending),t.pending+=s};var R_e=t=>{b7||((()=>{let r,s,a,c,d;const h=new Array(16);for(a=0,c=0;c<28;c++)for(X2[c]=a,r=0;r<1<<Y2[c];r++)lT[a++]=c;for(lT[a-1]=c,d=0,c=0;c<16;c++)for(sO[c]=d,r=0;r<1<<iO[c];r++)cT[d++]=c;for(d>>=7;c<sT;c++)for(sO[c]=d<<7,r=0;r<1<<iO[c]-7;r++)cT[256+d++]=c;for(s=0;s<=oT;s++)h[s]=0;for(r=0;r<=143;)Tf[2*r+1]=8,r++,h[8]++;for(;r<=255;)Tf[2*r+1]=9,r++,h[9]++;for(;r<=279;)Tf[2*r+1]=7,r++,h[7]++;for(;r<=287;)Tf[2*r+1]=8,r++,h[8]++;for(m7(Tf,287,h),r=0;r<sT;r++)aT[2*r+1]=5,aT[2*r]=f7(r,5);u7=new J2(Tf,Y2,257,c7,oT),d7=new J2(aT,iO,0,sT,oT),h7=new J2(new Array(0),C_e,0,19,7)})(),b7=!0),t.l_desc=new Q2(t.dyn_ltree,u7),t.d_desc=new Q2(t.dyn_dtree,d7),t.bl_desc=new Q2(t.bl_tree,h7),t.bi_buf=0,t.bi_valid=0,g7(t)},I_e=(t,r,s,a)=>{let c,d,h=0;t.level>0?(t.strm.data_type===2&&(t.strm.data_type=(m=>{let y,v=4093624447;for(y=0;y<=31;y++,v>>>=1)if(1&v&&m.dyn_ltree[2*y]!==0)return 0;if(m.dyn_ltree[18]!==0||m.dyn_ltree[20]!==0||m.dyn_ltree[26]!==0)return 1;for(y=32;y<q2;y++)if(m.dyn_ltree[2*y]!==0)return 1;return 0})(t)),eM(t,t.l_desc),eM(t,t.d_desc),h=(m=>{let y;for(v7(m,m.dyn_ltree,m.l_desc.max_code),v7(m,m.dyn_dtree,m.d_desc.max_code),eM(m,m.bl_desc),y=18;y>=3&&m.bl_tree[2*l7[y]+1]===0;y--);return m.opt_len+=3*(y+1)+5+5+4,y})(t),c=t.opt_len+3+7>>>3,d=t.static_len+3+7>>>3,d<=c&&(c=d)):c=d=s+5,s+4<=c&&r!==-1?w7(t,r,s,a):t.strategy===4||d===c?(ll(t,2+(a?1:0),3),E7(t,Tf,aT)):(ll(t,4+(a?1:0),3),((m,y,v,w)=>{let R;for(ll(m,y-257,5),ll(m,v-1,5),ll(m,w-4,4),R=0;R<w;R++)ll(m,m.bl_tree[2*l7[R]+1],3);S7(m,m.dyn_ltree,y-1),S7(m,m.dyn_dtree,v-1)})(t,t.l_desc.max_code+1,t.d_desc.max_code+1,h+1),E7(t,t.dyn_ltree,t.dyn_dtree)),g7(t),a&&_7(t)},A_e=(t,r,s)=>(t.pending_buf[t.sym_buf+t.sym_next++]=r,t.pending_buf[t.sym_buf+t.sym_next++]=r>>8,t.pending_buf[t.sym_buf+t.sym_next++]=s,r===0?t.dyn_ltree[2*s]++:(t.matches++,r--,t.dyn_ltree[2*(lT[s]+q2+1)]++,t.dyn_dtree[2*p7(r)]++),t.sym_next===t.sym_end),P_e=t=>{ll(t,2,3),Bh(t,256,Tf),(r=>{r.bi_valid===16?(uT(r,r.bi_buf),r.bi_buf=0,r.bi_valid=0):r.bi_valid>=8&&(r.pending_buf[r.pending++]=255&r.bi_buf,r.bi_buf>>=8,r.bi_valid-=8)})(t)},O_e={_tr_init:R_e,_tr_stored_block:w7,_tr_flush_block:I_e,_tr_tally:A_e,_tr_align:P_e},dT=(t,r,s,a)=>{let c=65535&t|0,d=t>>>16&65535|0,h=0;for(;s!==0;){h=s>2e3?2e3:s,s-=h;do c=c+r[a++]|0,d=d+c|0;while(--h);c%=65521,d%=65521}return c|d<<16|0};const k_e=new Uint32Array((()=>{let t,r=[];for(var s=0;s<256;s++){t=s;for(var a=0;a<8;a++)t=1&t?3988292384^t>>>1:t>>>1;r[s]=t}return r})());var Qo=(t,r,s,a)=>{const c=k_e,d=a+s;t^=-1;for(let h=a;h<d;h++)t=t>>>8^c[255&(t^r[h])];return-1^t},fy={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},oO={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:N_e,_tr_stored_block:tM,_tr_flush_block:D_e,_tr_tally:lg,_tr_align:x_e}=O_e,{Z_NO_FLUSH:ug,Z_PARTIAL_FLUSH:L_e,Z_FULL_FLUSH:M_e,Z_FINISH:Vu,Z_BLOCK:T7,Z_OK:Ca,Z_STREAM_END:C7,Z_STREAM_ERROR:Wh,Z_DATA_ERROR:U_e,Z_BUF_ERROR:nM,Z_DEFAULT_COMPRESSION:V_e,Z_FILTERED:j_e,Z_HUFFMAN_ONLY:aO,Z_RLE:F_e,Z_FIXED:B_e,Z_DEFAULT_STRATEGY:W_e,Z_UNKNOWN:z_e,Z_DEFLATED:cO}=oO,rM=286,G_e=30,H_e=19,$_e=2*rM+1,K_e=15,my=258,zh=262,RS=42,gy=113,hT=666,_y=(t,r)=>(t.msg=fy[r],r),R7=t=>2*t-(t>4?9:0),dg=t=>{let r=t.length;for(;--r>=0;)t[r]=0},q_e=t=>{let r,s,a,c=t.w_size;r=t.hash_size,a=r;do s=t.head[--a],t.head[a]=s>=c?s-c:0;while(--r);r=c,a=r;do s=t.prev[--a],t.prev[a]=s>=c?s-c:0;while(--r)};let hg=(t,r,s)=>(r<<t.hash_shift^s)&t.hash_mask;const Bl=t=>{const r=t.state;let s=r.pending;s>t.avail_out&&(s=t.avail_out),s!==0&&(t.output.set(r.pending_buf.subarray(r.pending_out,r.pending_out+s),t.next_out),t.next_out+=s,r.pending_out+=s,t.total_out+=s,t.avail_out-=s,r.pending-=s,r.pending===0&&(r.pending_out=0))},Wl=(t,r)=>{D_e(t,t.block_start>=0?t.block_start:-1,t.strstart-t.block_start,r),t.block_start=t.strstart,Bl(t.strm)},ii=(t,r)=>{t.pending_buf[t.pending++]=r},pT=(t,r)=>{t.pending_buf[t.pending++]=r>>>8&255,t.pending_buf[t.pending++]=255&r},iM=(t,r,s,a)=>{let c=t.avail_in;return c>a&&(c=a),c===0?0:(t.avail_in-=c,r.set(t.input.subarray(t.next_in,t.next_in+c),s),t.state.wrap===1?t.adler=dT(t.adler,r,c,s):t.state.wrap===2&&(t.adler=Qo(t.adler,r,c,s)),t.next_in+=c,t.total_in+=c,c)},I7=(t,r)=>{let s,a,c=t.max_chain_length,d=t.strstart,h=t.prev_length,m=t.nice_match;const y=t.strstart>t.w_size-zh?t.strstart-(t.w_size-zh):0,v=t.window,w=t.w_mask,R=t.prev,O=t.strstart+my;let D=v[d+h-1],G=v[d+h];t.prev_length>=t.good_match&&(c>>=2),m>t.lookahead&&(m=t.lookahead);do if(s=r,v[s+h]===G&&v[s+h-1]===D&&v[s]===v[d]&&v[++s]===v[d+1]){d+=2,s++;do;while(v[++d]===v[++s]&&v[++d]===v[++s]&&v[++d]===v[++s]&&v[++d]===v[++s]&&v[++d]===v[++s]&&v[++d]===v[++s]&&v[++d]===v[++s]&&v[++d]===v[++s]&&d<O);if(a=my-(O-d),d=O-my,a>h){if(t.match_start=r,h=a,a>=m)break;D=v[d+h-1],G=v[d+h]}}while((r=R[r&w])>y&&--c!=0);return h<=t.lookahead?h:t.lookahead},IS=t=>{const r=t.w_size;let s,a,c;do{if(a=t.window_size-t.lookahead-t.strstart,t.strstart>=r+(r-zh)&&(t.window.set(t.window.subarray(r,r+r-a),0),t.match_start-=r,t.strstart-=r,t.block_start-=r,t.insert>t.strstart&&(t.insert=t.strstart),q_e(t),a+=r),t.strm.avail_in===0)break;if(s=iM(t.strm,t.window,t.strstart+t.lookahead,a),t.lookahead+=s,t.lookahead+t.insert>=3)for(c=t.strstart-t.insert,t.ins_h=t.window[c],t.ins_h=hg(t,t.ins_h,t.window[c+1]);t.insert&&(t.ins_h=hg(t,t.ins_h,t.window[c+3-1]),t.prev[c&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=c,c++,t.insert--,!(t.lookahead+t.insert<3)););}while(t.lookahead<zh&&t.strm.avail_in!==0)},A7=(t,r)=>{let s,a,c,d=t.pending_buf_size-5>t.w_size?t.w_size:t.pending_buf_size-5,h=0,m=t.strm.avail_in;do{if(s=65535,c=t.bi_valid+42>>3,t.strm.avail_out<c||(c=t.strm.avail_out-c,a=t.strstart-t.block_start,s>a+t.strm.avail_in&&(s=a+t.strm.avail_in),s>c&&(s=c),s<d&&(s===0&&r!==Vu||r===ug||s!==a+t.strm.avail_in)))break;h=r===Vu&&s===a+t.strm.avail_in?1:0,tM(t,0,0,h),t.pending_buf[t.pending-4]=s,t.pending_buf[t.pending-3]=s>>8,t.pending_buf[t.pending-2]=~s,t.pending_buf[t.pending-1]=~s>>8,Bl(t.strm),a&&(a>s&&(a=s),t.strm.output.set(t.window.subarray(t.block_start,t.block_start+a),t.strm.next_out),t.strm.next_out+=a,t.strm.avail_out-=a,t.strm.total_out+=a,t.block_start+=a,s-=a),s&&(iM(t.strm,t.strm.output,t.strm.next_out,s),t.strm.next_out+=s,t.strm.avail_out-=s,t.strm.total_out+=s)}while(h===0);return m-=t.strm.avail_in,m&&(m>=t.w_size?(t.matches=2,t.window.set(t.strm.input.subarray(t.strm.next_in-t.w_size,t.strm.next_in),0),t.strstart=t.w_size,t.insert=t.strstart):(t.window_size-t.strstart<=m&&(t.strstart-=t.w_size,t.window.set(t.window.subarray(t.w_size,t.w_size+t.strstart),0),t.matches<2&&t.matches++,t.insert>t.strstart&&(t.insert=t.strstart)),t.window.set(t.strm.input.subarray(t.strm.next_in-m,t.strm.next_in),t.strstart),t.strstart+=m,t.insert+=m>t.w_size-t.insert?t.w_size-t.insert:m),t.block_start=t.strstart),t.high_water<t.strstart&&(t.high_water=t.strstart),h?4:r!==ug&&r!==Vu&&t.strm.avail_in===0&&t.strstart===t.block_start?2:(c=t.window_size-t.strstart,t.strm.avail_in>c&&t.block_start>=t.w_size&&(t.block_start-=t.w_size,t.strstart-=t.w_size,t.window.set(t.window.subarray(t.w_size,t.w_size+t.strstart),0),t.matches<2&&t.matches++,c+=t.w_size,t.insert>t.strstart&&(t.insert=t.strstart)),c>t.strm.avail_in&&(c=t.strm.avail_in),c&&(iM(t.strm,t.window,t.strstart,c),t.strstart+=c,t.insert+=c>t.w_size-t.insert?t.w_size-t.insert:c),t.high_water<t.strstart&&(t.high_water=t.strstart),c=t.bi_valid+42>>3,c=t.pending_buf_size-c>65535?65535:t.pending_buf_size-c,d=c>t.w_size?t.w_size:c,a=t.strstart-t.block_start,(a>=d||(a||r===Vu)&&r!==ug&&t.strm.avail_in===0&&a<=c)&&(s=a>c?c:a,h=r===Vu&&t.strm.avail_in===0&&s===a?1:0,tM(t,t.block_start,s,h),t.block_start+=s,Bl(t.strm)),h?3:1)},sM=(t,r)=>{let s,a;for(;;){if(t.lookahead<zh){if(IS(t),t.lookahead<zh&&r===ug)return 1;if(t.lookahead===0)break}if(s=0,t.lookahead>=3&&(t.ins_h=hg(t,t.ins_h,t.window[t.strstart+3-1]),s=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),s!==0&&t.strstart-s<=t.w_size-zh&&(t.match_length=I7(t,s)),t.match_length>=3)if(a=lg(t,t.strstart-t.match_start,t.match_length-3),t.lookahead-=t.match_length,t.match_length<=t.max_lazy_match&&t.lookahead>=3){t.match_length--;do t.strstart++,t.ins_h=hg(t,t.ins_h,t.window[t.strstart+3-1]),s=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart;while(--t.match_length!=0);t.strstart++}else t.strstart+=t.match_length,t.match_length=0,t.ins_h=t.window[t.strstart],t.ins_h=hg(t,t.ins_h,t.window[t.strstart+1]);else a=lg(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++;if(a&&(Wl(t,!1),t.strm.avail_out===0))return 1}return t.insert=t.strstart<2?t.strstart:2,r===Vu?(Wl(t,!0),t.strm.avail_out===0?3:4):t.sym_next&&(Wl(t,!1),t.strm.avail_out===0)?1:2},AS=(t,r)=>{let s,a,c;for(;;){if(t.lookahead<zh){if(IS(t),t.lookahead<zh&&r===ug)return 1;if(t.lookahead===0)break}if(s=0,t.lookahead>=3&&(t.ins_h=hg(t,t.ins_h,t.window[t.strstart+3-1]),s=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),t.prev_length=t.match_length,t.prev_match=t.match_start,t.match_length=2,s!==0&&t.prev_length<t.max_lazy_match&&t.strstart-s<=t.w_size-zh&&(t.match_length=I7(t,s),t.match_length<=5&&(t.strategy===j_e||t.match_length===3&&t.strstart-t.match_start>4096)&&(t.match_length=2)),t.prev_length>=3&&t.match_length<=t.prev_length){c=t.strstart+t.lookahead-3,a=lg(t,t.strstart-1-t.prev_match,t.prev_length-3),t.lookahead-=t.prev_length-1,t.prev_length-=2;do++t.strstart<=c&&(t.ins_h=hg(t,t.ins_h,t.window[t.strstart+3-1]),s=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart);while(--t.prev_length!=0);if(t.match_available=0,t.match_length=2,t.strstart++,a&&(Wl(t,!1),t.strm.avail_out===0))return 1}else if(t.match_available){if(a=lg(t,0,t.window[t.strstart-1]),a&&Wl(t,!1),t.strstart++,t.lookahead--,t.strm.avail_out===0)return 1}else t.match_available=1,t.strstart++,t.lookahead--}return t.match_available&&(a=lg(t,0,t.window[t.strstart-1]),t.match_available=0),t.insert=t.strstart<2?t.strstart:2,r===Vu?(Wl(t,!0),t.strm.avail_out===0?3:4):t.sym_next&&(Wl(t,!1),t.strm.avail_out===0)?1:2};function Gh(t,r,s,a,c){this.good_length=t,this.max_lazy=r,this.nice_length=s,this.max_chain=a,this.func=c}const fT=[new Gh(0,0,0,0,A7),new Gh(4,4,8,4,sM),new Gh(4,5,16,8,sM),new Gh(4,6,32,32,sM),new Gh(4,4,16,16,AS),new Gh(8,16,32,32,AS),new Gh(8,16,128,128,AS),new Gh(8,32,128,256,AS),new Gh(32,128,258,1024,AS),new Gh(32,258,258,4096,AS)];function Y_e(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=cO,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(2*$_e),this.dyn_dtree=new Uint16Array(2*(2*G_e+1)),this.bl_tree=new Uint16Array(2*(2*H_e+1)),dg(this.dyn_ltree),dg(this.dyn_dtree),dg(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(K_e+1),this.heap=new Uint16Array(2*rM+1),dg(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*rM+1),dg(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const mT=t=>{if(!t)return 1;const r=t.state;return!r||r.strm!==t||r.status!==RS&&r.status!==57&&r.status!==69&&r.status!==73&&r.status!==91&&r.status!==103&&r.status!==gy&&r.status!==hT?1:0},P7=t=>{if(mT(t))return _y(t,Wh);t.total_in=t.total_out=0,t.data_type=z_e;const r=t.state;return r.pending=0,r.pending_out=0,r.wrap<0&&(r.wrap=-r.wrap),r.status=r.wrap===2?57:r.wrap?RS:gy,t.adler=r.wrap===2?0:1,r.last_flush=-2,N_e(r),Ca},O7=t=>{const r=P7(t);return r===Ca&&(s=>{s.window_size=2*s.w_size,dg(s.head),s.max_lazy_match=fT[s.level].max_lazy,s.good_match=fT[s.level].good_length,s.nice_match=fT[s.level].nice_length,s.max_chain_length=fT[s.level].max_chain,s.strstart=0,s.block_start=0,s.lookahead=0,s.insert=0,s.match_length=s.prev_length=2,s.match_available=0,s.ins_h=0})(t.state),r},k7=(t,r,s,a,c,d)=>{if(!t)return Wh;let h=1;if(r===V_e&&(r=6),a<0?(h=0,a=-a):a>15&&(h=2,a-=16),c<1||c>9||s!==cO||a<8||a>15||r<0||r>9||d<0||d>B_e||a===8&&h!==1)return _y(t,Wh);a===8&&(a=9);const m=new Y_e;return t.state=m,m.strm=t,m.status=RS,m.wrap=h,m.gzhead=null,m.w_bits=a,m.w_size=1<<m.w_bits,m.w_mask=m.w_size-1,m.hash_bits=c+7,m.hash_size=1<<m.hash_bits,m.hash_mask=m.hash_size-1,m.hash_shift=~~((m.hash_bits+3-1)/3),m.window=new Uint8Array(2*m.w_size),m.head=new Uint16Array(m.hash_size),m.prev=new Uint16Array(m.w_size),m.lit_bufsize=1<<c+6,m.pending_buf_size=4*m.lit_bufsize,m.pending_buf=new Uint8Array(m.pending_buf_size),m.sym_buf=m.lit_bufsize,m.sym_end=3*(m.lit_bufsize-1),m.level=r,m.strategy=d,m.method=s,O7(t)};var X_e=(t,r)=>{if(mT(t)||r>T7||r<0)return t?_y(t,Wh):Wh;const s=t.state;if(!t.output||t.avail_in!==0&&!t.input||s.status===hT&&r!==Vu)return _y(t,t.avail_out===0?nM:Wh);const a=s.last_flush;if(s.last_flush=r,s.pending!==0){if(Bl(t),t.avail_out===0)return s.last_flush=-1,Ca}else if(t.avail_in===0&&R7(r)<=R7(a)&&r!==Vu)return _y(t,nM);if(s.status===hT&&t.avail_in!==0)return _y(t,nM);if(s.status===RS&&s.wrap===0&&(s.status=gy),s.status===RS){let c=cO+(s.w_bits-8<<4)<<8,d=-1;if(d=s.strategy>=aO||s.level<2?0:s.level<6?1:s.level===6?2:3,c|=d<<6,s.strstart!==0&&(c|=32),c+=31-c%31,pT(s,c),s.strstart!==0&&(pT(s,t.adler>>>16),pT(s,65535&t.adler)),t.adler=1,s.status=gy,Bl(t),s.pending!==0)return s.last_flush=-1,Ca}if(s.status===57){if(t.adler=0,ii(s,31),ii(s,139),ii(s,8),s.gzhead)ii(s,(s.gzhead.text?1:0)+(s.gzhead.hcrc?2:0)+(s.gzhead.extra?4:0)+(s.gzhead.name?8:0)+(s.gzhead.comment?16:0)),ii(s,255&s.gzhead.time),ii(s,s.gzhead.time>>8&255),ii(s,s.gzhead.time>>16&255),ii(s,s.gzhead.time>>24&255),ii(s,s.level===9?2:s.strategy>=aO||s.level<2?4:0),ii(s,255&s.gzhead.os),s.gzhead.extra&&s.gzhead.extra.length&&(ii(s,255&s.gzhead.extra.length),ii(s,s.gzhead.extra.length>>8&255)),s.gzhead.hcrc&&(t.adler=Qo(t.adler,s.pending_buf,s.pending,0)),s.gzindex=0,s.status=69;else if(ii(s,0),ii(s,0),ii(s,0),ii(s,0),ii(s,0),ii(s,s.level===9?2:s.strategy>=aO||s.level<2?4:0),ii(s,3),s.status=gy,Bl(t),s.pending!==0)return s.last_flush=-1,Ca}if(s.status===69){if(s.gzhead.extra){let c=s.pending,d=(65535&s.gzhead.extra.length)-s.gzindex;for(;s.pending+d>s.pending_buf_size;){let m=s.pending_buf_size-s.pending;if(s.pending_buf.set(s.gzhead.extra.subarray(s.gzindex,s.gzindex+m),s.pending),s.pending=s.pending_buf_size,s.gzhead.hcrc&&s.pending>c&&(t.adler=Qo(t.adler,s.pending_buf,s.pending-c,c)),s.gzindex+=m,Bl(t),s.pending!==0)return s.last_flush=-1,Ca;c=0,d-=m}let h=new Uint8Array(s.gzhead.extra);s.pending_buf.set(h.subarray(s.gzindex,s.gzindex+d),s.pending),s.pending+=d,s.gzhead.hcrc&&s.pending>c&&(t.adler=Qo(t.adler,s.pending_buf,s.pending-c,c)),s.gzindex=0}s.status=73}if(s.status===73){if(s.gzhead.name){let c,d=s.pending;do{if(s.pending===s.pending_buf_size){if(s.gzhead.hcrc&&s.pending>d&&(t.adler=Qo(t.adler,s.pending_buf,s.pending-d,d)),Bl(t),s.pending!==0)return s.last_flush=-1,Ca;d=0}c=s.gzindex<s.gzhead.name.length?255&s.gzhead.name.charCodeAt(s.gzindex++):0,ii(s,c)}while(c!==0);s.gzhead.hcrc&&s.pending>d&&(t.adler=Qo(t.adler,s.pending_buf,s.pending-d,d)),s.gzindex=0}s.status=91}if(s.status===91){if(s.gzhead.comment){let c,d=s.pending;do{if(s.pending===s.pending_buf_size){if(s.gzhead.hcrc&&s.pending>d&&(t.adler=Qo(t.adler,s.pending_buf,s.pending-d,d)),Bl(t),s.pending!==0)return s.last_flush=-1,Ca;d=0}c=s.gzindex<s.gzhead.comment.length?255&s.gzhead.comment.charCodeAt(s.gzindex++):0,ii(s,c)}while(c!==0);s.gzhead.hcrc&&s.pending>d&&(t.adler=Qo(t.adler,s.pending_buf,s.pending-d,d))}s.status=103}if(s.status===103){if(s.gzhead.hcrc){if(s.pending+2>s.pending_buf_size&&(Bl(t),s.pending!==0))return s.last_flush=-1,Ca;ii(s,255&t.adler),ii(s,t.adler>>8&255),t.adler=0}if(s.status=gy,Bl(t),s.pending!==0)return s.last_flush=-1,Ca}if(t.avail_in!==0||s.lookahead!==0||r!==ug&&s.status!==hT){let c=s.level===0?A7(s,r):s.strategy===aO?((d,h)=>{let m;for(;;){if(d.lookahead===0&&(IS(d),d.lookahead===0)){if(h===ug)return 1;break}if(d.match_length=0,m=lg(d,0,d.window[d.strstart]),d.lookahead--,d.strstart++,m&&(Wl(d,!1),d.strm.avail_out===0))return 1}return d.insert=0,h===Vu?(Wl(d,!0),d.strm.avail_out===0?3:4):d.sym_next&&(Wl(d,!1),d.strm.avail_out===0)?1:2})(s,r):s.strategy===F_e?((d,h)=>{let m,y,v,w;const R=d.window;for(;;){if(d.lookahead<=my){if(IS(d),d.lookahead<=my&&h===ug)return 1;if(d.lookahead===0)break}if(d.match_length=0,d.lookahead>=3&&d.strstart>0&&(v=d.strstart-1,y=R[v],y===R[++v]&&y===R[++v]&&y===R[++v])){w=d.strstart+my;do;while(y===R[++v]&&y===R[++v]&&y===R[++v]&&y===R[++v]&&y===R[++v]&&y===R[++v]&&y===R[++v]&&y===R[++v]&&v<w);d.match_length=my-(w-v),d.match_length>d.lookahead&&(d.match_length=d.lookahead)}if(d.match_length>=3?(m=lg(d,1,d.match_length-3),d.lookahead-=d.match_length,d.strstart+=d.match_length,d.match_length=0):(m=lg(d,0,d.window[d.strstart]),d.lookahead--,d.strstart++),m&&(Wl(d,!1),d.strm.avail_out===0))return 1}return d.insert=0,h===Vu?(Wl(d,!0),d.strm.avail_out===0?3:4):d.sym_next&&(Wl(d,!1),d.strm.avail_out===0)?1:2})(s,r):fT[s.level].func(s,r);if(c!==3&&c!==4||(s.status=hT),c===1||c===3)return t.avail_out===0&&(s.last_flush=-1),Ca;if(c===2&&(r===L_e?x_e(s):r!==T7&&(tM(s,0,0,!1),r===M_e&&(dg(s.head),s.lookahead===0&&(s.strstart=0,s.block_start=0,s.insert=0))),Bl(t),t.avail_out===0))return s.last_flush=-1,Ca}return r!==Vu?Ca:s.wrap<=0?C7:(s.wrap===2?(ii(s,255&t.adler),ii(s,t.adler>>8&255),ii(s,t.adler>>16&255),ii(s,t.adler>>24&255),ii(s,255&t.total_in),ii(s,t.total_in>>8&255),ii(s,t.total_in>>16&255),ii(s,t.total_in>>24&255)):(pT(s,t.adler>>>16),pT(s,65535&t.adler)),Bl(t),s.wrap>0&&(s.wrap=-s.wrap),s.pending!==0?Ca:C7)},J_e=(t,r)=>{let s=r.length;if(mT(t))return Wh;const a=t.state,c=a.wrap;if(c===2||c===1&&a.status!==RS||a.lookahead)return Wh;if(c===1&&(t.adler=dT(t.adler,r,s,0)),a.wrap=0,s>=a.w_size){c===0&&(dg(a.head),a.strstart=0,a.block_start=0,a.insert=0);let y=new Uint8Array(a.w_size);y.set(r.subarray(s-a.w_size,s),0),r=y,s=a.w_size}const d=t.avail_in,h=t.next_in,m=t.input;for(t.avail_in=s,t.next_in=0,t.input=r,IS(a);a.lookahead>=3;){let y=a.strstart,v=a.lookahead-2;do a.ins_h=hg(a,a.ins_h,a.window[y+3-1]),a.prev[y&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=y,y++;while(--v);a.strstart=y,a.lookahead=2,IS(a)}return a.strstart+=a.lookahead,a.block_start=a.strstart,a.insert=a.lookahead,a.lookahead=0,a.match_length=a.prev_length=2,a.match_available=0,t.next_in=h,t.input=m,t.avail_in=d,a.wrap=c,Ca},gT={deflateInit:(t,r)=>k7(t,r,cO,15,8,W_e),deflateInit2:k7,deflateReset:O7,deflateResetKeep:P7,deflateSetHeader:(t,r)=>mT(t)||t.state.wrap!==2?Wh:(t.state.gzhead=r,Ca),deflate:X_e,deflateEnd:t=>{if(mT(t))return Wh;const r=t.state.status;return t.state=null,r===gy?_y(t,U_e):Ca},deflateSetDictionary:J_e,deflateInfo:"pako deflate (from Nodeca project)"};const Q_e=(t,r)=>Object.prototype.hasOwnProperty.call(t,r);var lO={assign:function(t){const r=Array.prototype.slice.call(arguments,1);for(;r.length;){const s=r.shift();if(s){if(typeof s!="object")throw new TypeError(s+"must be non-object");for(const a in s)Q_e(s,a)&&(t[a]=s[a])}}return t},flattenChunks:t=>{let r=0;for(let a=0,c=t.length;a<c;a++)r+=t[a].length;const s=new Uint8Array(r);for(let a=0,c=0,d=t.length;a<d;a++){let h=t[a];s.set(h,c),c+=h.length}return s}};let N7=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{N7=!1}const _T=new Uint8Array(256);for(let t=0;t<256;t++)_T[t]=t>=252?6:t>=248?5:t>=240?4:t>=224?3:t>=192?2:1;_T[254]=_T[254]=1;var yT={string2buf:t=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(t);let r,s,a,c,d,h=t.length,m=0;for(c=0;c<h;c++)s=t.charCodeAt(c),(64512&s)==55296&&c+1<h&&(a=t.charCodeAt(c+1),(64512&a)==56320&&(s=65536+(s-55296<<10)+(a-56320),c++)),m+=s<128?1:s<2048?2:s<65536?3:4;for(r=new Uint8Array(m),d=0,c=0;d<m;c++)s=t.charCodeAt(c),(64512&s)==55296&&c+1<h&&(a=t.charCodeAt(c+1),(64512&a)==56320&&(s=65536+(s-55296<<10)+(a-56320),c++)),s<128?r[d++]=s:s<2048?(r[d++]=192|s>>>6,r[d++]=128|63&s):s<65536?(r[d++]=224|s>>>12,r[d++]=128|s>>>6&63,r[d++]=128|63&s):(r[d++]=240|s>>>18,r[d++]=128|s>>>12&63,r[d++]=128|s>>>6&63,r[d++]=128|63&s);return r},buf2string:(t,r)=>{const s=r||t.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(t.subarray(0,r));let a,c;const d=new Array(2*s);for(c=0,a=0;a<s;){let h=t[a++];if(h<128){d[c++]=h;continue}let m=_T[h];if(m>4)d[c++]=65533,a+=m-1;else{for(h&=m===2?31:m===3?15:7;m>1&&a<s;)h=h<<6|63&t[a++],m--;m>1?d[c++]=65533:h<65536?d[c++]=h:(h-=65536,d[c++]=55296|h>>10&1023,d[c++]=56320|1023&h)}}return((h,m)=>{if(m<65534&&h.subarray&&N7)return String.fromCharCode.apply(null,h.length===m?h:h.subarray(0,m));let y="";for(let v=0;v<m;v++)y+=String.fromCharCode(h[v]);return y})(d,c)},utf8border:(t,r)=>{(r=r||t.length)>t.length&&(r=t.length);let s=r-1;for(;s>=0&&(192&t[s])==128;)s--;return s<0||s===0?r:s+_T[t[s]]>r?s:r}},D7=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const x7=Object.prototype.toString,{Z_NO_FLUSH:Z_e,Z_SYNC_FLUSH:eye,Z_FULL_FLUSH:tye,Z_FINISH:nye,Z_OK:uO,Z_STREAM_END:rye,Z_DEFAULT_COMPRESSION:iye,Z_DEFAULT_STRATEGY:sye,Z_DEFLATED:oye}=oO;function dO(t){this.options=lO.assign({level:iye,method:oye,chunkSize:16384,windowBits:15,memLevel:8,strategy:sye},t||{});let r=this.options;r.raw&&r.windowBits>0?r.windowBits=-r.windowBits:r.gzip&&r.windowBits>0&&r.windowBits<16&&(r.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new D7,this.strm.avail_out=0;let s=gT.deflateInit2(this.strm,r.level,r.method,r.windowBits,r.memLevel,r.strategy);if(s!==uO)throw new Error(fy[s]);if(r.header&&gT.deflateSetHeader(this.strm,r.header),r.dictionary){let a;if(a=typeof r.dictionary=="string"?yT.string2buf(r.dictionary):x7.call(r.dictionary)==="[object ArrayBuffer]"?new Uint8Array(r.dictionary):r.dictionary,s=gT.deflateSetDictionary(this.strm,a),s!==uO)throw new Error(fy[s]);this._dict_set=!0}}function aye(t,r){const s=new dO(r);if(s.push(t,!0),s.err)throw s.msg||fy[s.err];return s.result}dO.prototype.push=function(t,r){const s=this.strm,a=this.options.chunkSize;let c,d;if(this.ended)return!1;for(d=r===~~r?r:r===!0?nye:Z_e,typeof t=="string"?s.input=yT.string2buf(t):x7.call(t)==="[object ArrayBuffer]"?s.input=new Uint8Array(t):s.input=t,s.next_in=0,s.avail_in=s.input.length;;)if(s.avail_out===0&&(s.output=new Uint8Array(a),s.next_out=0,s.avail_out=a),(d===eye||d===tye)&&s.avail_out<=6)this.onData(s.output.subarray(0,s.next_out)),s.avail_out=0;else{if(c=gT.deflate(s,d),c===rye)return s.next_out>0&&this.onData(s.output.subarray(0,s.next_out)),c=gT.deflateEnd(this.strm),this.onEnd(c),this.ended=!0,c===uO;if(s.avail_out!==0){if(d>0&&s.next_out>0)this.onData(s.output.subarray(0,s.next_out)),s.avail_out=0;else if(s.avail_in===0)break}else this.onData(s.output)}return!0},dO.prototype.onData=function(t){this.chunks.push(t)},dO.prototype.onEnd=function(t){t===uO&&(this.result=lO.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};var cye={deflate:aye};const hO=16209;var lye=function(t,r){let s,a,c,d,h,m,y,v,w,R,O,D,G,j,W,Q,ee,fe,ye,Ee,_e,Ne,Ze,ft;const yt=t.state;s=t.next_in,Ze=t.input,a=s+(t.avail_in-5),c=t.next_out,ft=t.output,d=c-(r-t.avail_out),h=c+(t.avail_out-257),m=yt.dmax,y=yt.wsize,v=yt.whave,w=yt.wnext,R=yt.window,O=yt.hold,D=yt.bits,G=yt.lencode,j=yt.distcode,W=(1<<yt.lenbits)-1,Q=(1<<yt.distbits)-1;e:do{D<15&&(O+=Ze[s++]<<D,D+=8,O+=Ze[s++]<<D,D+=8),ee=G[O&W];t:for(;;){if(fe=ee>>>24,O>>>=fe,D-=fe,fe=ee>>>16&255,fe===0)ft[c++]=65535&ee;else{if(!(16&fe)){if((64&fe)==0){ee=G[(65535&ee)+(O&(1<<fe)-1)];continue t}if(32&fe){yt.mode=16191;break e}t.msg="invalid literal/length code",yt.mode=hO;break e}ye=65535&ee,fe&=15,fe&&(D<fe&&(O+=Ze[s++]<<D,D+=8),ye+=O&(1<<fe)-1,O>>>=fe,D-=fe),D<15&&(O+=Ze[s++]<<D,D+=8,O+=Ze[s++]<<D,D+=8),ee=j[O&Q];n:for(;;){if(fe=ee>>>24,O>>>=fe,D-=fe,fe=ee>>>16&255,!(16&fe)){if((64&fe)==0){ee=j[(65535&ee)+(O&(1<<fe)-1)];continue n}t.msg="invalid distance code",yt.mode=hO;break e}if(Ee=65535&ee,fe&=15,D<fe&&(O+=Ze[s++]<<D,D+=8,D<fe&&(O+=Ze[s++]<<D,D+=8)),Ee+=O&(1<<fe)-1,Ee>m){t.msg="invalid distance too far back",yt.mode=hO;break e}if(O>>>=fe,D-=fe,fe=c-d,Ee>fe){if(fe=Ee-fe,fe>v&&yt.sane){t.msg="invalid distance too far back",yt.mode=hO;break e}if(_e=0,Ne=R,w===0){if(_e+=y-fe,fe<ye){ye-=fe;do ft[c++]=R[_e++];while(--fe);_e=c-Ee,Ne=ft}}else if(w<fe){if(_e+=y+w-fe,fe-=w,fe<ye){ye-=fe;do ft[c++]=R[_e++];while(--fe);if(_e=0,w<ye){fe=w,ye-=fe;do ft[c++]=R[_e++];while(--fe);_e=c-Ee,Ne=ft}}}else if(_e+=w-fe,fe<ye){ye-=fe;do ft[c++]=R[_e++];while(--fe);_e=c-Ee,Ne=ft}for(;ye>2;)ft[c++]=Ne[_e++],ft[c++]=Ne[_e++],ft[c++]=Ne[_e++],ye-=3;ye&&(ft[c++]=Ne[_e++],ye>1&&(ft[c++]=Ne[_e++]))}else{_e=c-Ee;do ft[c++]=ft[_e++],ft[c++]=ft[_e++],ft[c++]=ft[_e++],ye-=3;while(ye>2);ye&&(ft[c++]=ft[_e++],ye>1&&(ft[c++]=ft[_e++]))}break}}break}}while(s<a&&c<h);ye=D>>3,s-=ye,D-=ye<<3,O&=(1<<D)-1,t.next_in=s,t.next_out=c,t.avail_in=s<a?a-s+5:5-(s-a),t.avail_out=c<h?h-c+257:257-(c-h),yt.hold=O,yt.bits=D};const pO=15,uye=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),dye=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),hye=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),pye=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var ET=(t,r,s,a,c,d,h,m)=>{const y=m.bits;let v,w,R,O,D,G,j=0,W=0,Q=0,ee=0,fe=0,ye=0,Ee=0,_e=0,Ne=0,Ze=0,ft=null;const yt=new Uint16Array(16),An=new Uint16Array(16);let Pn,_r,pi,Zr=null;for(j=0;j<=pO;j++)yt[j]=0;for(W=0;W<a;W++)yt[r[s+W]]++;for(fe=y,ee=pO;ee>=1&&yt[ee]===0;ee--);if(fe>ee&&(fe=ee),ee===0)return c[d++]=20971520,c[d++]=20971520,m.bits=1,0;for(Q=1;Q<ee&&yt[Q]===0;Q++);for(fe<Q&&(fe=Q),_e=1,j=1;j<=pO;j++)if(_e<<=1,_e-=yt[j],_e<0)return-1;if(_e>0&&(t===0||ee!==1))return-1;for(An[1]=0,j=1;j<pO;j++)An[j+1]=An[j]+yt[j];for(W=0;W<a;W++)r[s+W]!==0&&(h[An[r[s+W]]++]=W);if(t===0?(ft=Zr=h,G=20):t===1?(ft=uye,Zr=dye,G=257):(ft=hye,Zr=pye,G=0),Ze=0,W=0,j=Q,D=d,ye=fe,Ee=0,R=-1,Ne=1<<fe,O=Ne-1,t===1&&Ne>852||t===2&&Ne>592)return 1;for(;;){Pn=j-Ee,h[W]+1<G?(_r=0,pi=h[W]):h[W]>=G?(_r=Zr[h[W]-G],pi=ft[h[W]-G]):(_r=96,pi=0),v=1<<j-Ee,w=1<<ye,Q=w;do w-=v,c[D+(Ze>>Ee)+w]=Pn<<24|_r<<16|pi|0;while(w!==0);for(v=1<<j-1;Ze&v;)v>>=1;if(v!==0?(Ze&=v-1,Ze+=v):Ze=0,W++,--yt[j]==0){if(j===ee)break;j=r[s+h[W]]}if(j>fe&&(Ze&O)!==R){for(Ee===0&&(Ee=fe),D+=Q,ye=j-Ee,_e=1<<ye;ye+Ee<ee&&(_e-=yt[ye+Ee],!(_e<=0));)ye++,_e<<=1;if(Ne+=1<<ye,t===1&&Ne>852||t===2&&Ne>592)return 1;R=Ze&O,c[R]=fe<<24|ye<<16|D-d|0}}return Ze!==0&&(c[D+Ze]=j-Ee<<24|64<<16|0),m.bits=fe,0};const{Z_FINISH:L7,Z_BLOCK:fye,Z_TREES:fO,Z_OK:yy,Z_STREAM_END:mye,Z_NEED_DICT:gye,Z_STREAM_ERROR:ju,Z_DATA_ERROR:M7,Z_MEM_ERROR:U7,Z_BUF_ERROR:_ye,Z_DEFLATED:V7}=oO,mO=16180,gO=16190,Cf=16191,oM=16192,aM=16194,_O=16199,yO=16200,cM=16206,ds=16209,j7=t=>(t>>>24&255)+(t>>>8&65280)+((65280&t)<<8)+((255&t)<<24);function yye(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const Ey=t=>{if(!t)return 1;const r=t.state;return!r||r.strm!==t||r.mode<mO||r.mode>16211?1:0},F7=t=>{if(Ey(t))return ju;const r=t.state;return t.total_in=t.total_out=r.total=0,t.msg="",r.wrap&&(t.adler=1&r.wrap),r.mode=mO,r.last=0,r.havedict=0,r.flags=-1,r.dmax=32768,r.head=null,r.hold=0,r.bits=0,r.lencode=r.lendyn=new Int32Array(852),r.distcode=r.distdyn=new Int32Array(592),r.sane=1,r.back=-1,yy},B7=t=>{if(Ey(t))return ju;const r=t.state;return r.wsize=0,r.whave=0,r.wnext=0,F7(t)},W7=(t,r)=>{let s;if(Ey(t))return ju;const a=t.state;return r<0?(s=0,r=-r):(s=5+(r>>4),r<48&&(r&=15)),r&&(r<8||r>15)?ju:(a.window!==null&&a.wbits!==r&&(a.window=null),a.wrap=s,a.wbits=r,B7(t))},z7=(t,r)=>{if(!t)return ju;const s=new yye;t.state=s,s.strm=t,s.window=null,s.mode=mO;const a=W7(t,r);return a!==yy&&(t.state=null),a};let lM,uM,G7=!0;const Eye=t=>{if(G7){lM=new Int32Array(512),uM=new Int32Array(32);let r=0;for(;r<144;)t.lens[r++]=8;for(;r<256;)t.lens[r++]=9;for(;r<280;)t.lens[r++]=7;for(;r<288;)t.lens[r++]=8;for(ET(1,t.lens,0,288,lM,0,t.work,{bits:9}),r=0;r<32;)t.lens[r++]=5;ET(2,t.lens,0,32,uM,0,t.work,{bits:5}),G7=!1}t.lencode=lM,t.lenbits=9,t.distcode=uM,t.distbits=5},H7=(t,r,s,a)=>{let c;const d=t.state;return d.window===null&&(d.wsize=1<<d.wbits,d.wnext=0,d.whave=0,d.window=new Uint8Array(d.wsize)),a>=d.wsize?(d.window.set(r.subarray(s-d.wsize,s),0),d.wnext=0,d.whave=d.wsize):(c=d.wsize-d.wnext,c>a&&(c=a),d.window.set(r.subarray(s-a,s-a+c),d.wnext),(a-=c)?(d.window.set(r.subarray(s-a,s),0),d.wnext=a,d.whave=d.wsize):(d.wnext+=c,d.wnext===d.wsize&&(d.wnext=0),d.whave<d.wsize&&(d.whave+=c))),0};var vye=(t,r)=>{let s,a,c,d,h,m,y,v,w,R,O,D,G,j,W,Q,ee,fe,ye,Ee,_e,Ne,Ze=0;const ft=new Uint8Array(4);let yt,An;const Pn=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(Ey(t)||!t.output||!t.input&&t.avail_in!==0)return ju;s=t.state,s.mode===Cf&&(s.mode=oM),h=t.next_out,c=t.output,y=t.avail_out,d=t.next_in,a=t.input,m=t.avail_in,v=s.hold,w=s.bits,R=m,O=y,Ne=yy;e:for(;;)switch(s.mode){case mO:if(s.wrap===0){s.mode=oM;break}for(;w<16;){if(m===0)break e;m--,v+=a[d++]<<w,w+=8}if(2&s.wrap&&v===35615){s.wbits===0&&(s.wbits=15),s.check=0,ft[0]=255&v,ft[1]=v>>>8&255,s.check=Qo(s.check,ft,2,0),v=0,w=0,s.mode=16181;break}if(s.head&&(s.head.done=!1),!(1&s.wrap)||(((255&v)<<8)+(v>>8))%31){t.msg="incorrect header check",s.mode=ds;break}if((15&v)!==V7){t.msg="unknown compression method",s.mode=ds;break}if(v>>>=4,w-=4,_e=8+(15&v),s.wbits===0&&(s.wbits=_e),_e>15||_e>s.wbits){t.msg="invalid window size",s.mode=ds;break}s.dmax=1<<s.wbits,s.flags=0,t.adler=s.check=1,s.mode=512&v?16189:Cf,v=0,w=0;break;case 16181:for(;w<16;){if(m===0)break e;m--,v+=a[d++]<<w,w+=8}if(s.flags=v,(255&Oo(s))!==V7){t.msg="unknown compression method",s.mode=ds;break}if(57344&Oo(s)){t.msg="unknown header flags set",s.mode=ds;break}s.head&&(s.head.text=v>>8&1),512&Oo(s)&&4&s.wrap&&(ft[0]=255&v,ft[1]=v>>>8&255,s.check=Qo(s.check,ft,2,0)),v=0,w=0,s.mode=16182;case 16182:for(;w<32;){if(m===0)break e;m--,v+=a[d++]<<w,w+=8}s.head&&(s.head.time=v),512&Oo(s)&&4&s.wrap&&(ft[0]=255&v,ft[1]=v>>>8&255,ft[2]=v>>>16&255,ft[3]=v>>>24&255,s.check=Qo(s.check,ft,4,0)),v=0,w=0,s.mode=16183;case 16183:for(;w<16;){if(m===0)break e;m--,v+=a[d++]<<w,w+=8}s.head&&(s.head.xflags=255&v,s.head.os=v>>8),512&Oo(s)&&4&s.wrap&&(ft[0]=255&v,ft[1]=v>>>8&255,s.check=Qo(s.check,ft,2,0)),v=0,w=0,s.mode=16184;case 16184:if(1024&Oo(s)){for(;w<16;){if(m===0)break e;m--,v+=a[d++]<<w,w+=8}s.length=v,s.head&&(s.head.extra_len=v),512&Oo(s)&&4&s.wrap&&(ft[0]=255&v,ft[1]=v>>>8&255,s.check=Qo(s.check,ft,2,0)),v=0,w=0}else s.head&&(s.head.extra=null);s.mode=16185;case 16185:if(1024&Oo(s)&&(D=s.length,D>m&&(D=m),D&&(s.head&&(_e=s.head.extra_len-s.length,s.head.extra||(s.head.extra=new Uint8Array(s.head.extra_len)),s.head.extra.set(a.subarray(d,d+D),_e)),512&Oo(s)&&4&s.wrap&&(s.check=Qo(s.check,a,D,d)),m-=D,d+=D,s.length-=D),s.length))break e;s.length=0,s.mode=16186;case 16186:if(2048&Oo(s)){if(m===0)break e;D=0;do _e=a[d+D++],s.head&&_e&&s.length<65536&&(s.head.name+=String.fromCharCode(_e));while(_e&&D<m);if(512&Oo(s)&&4&s.wrap&&(s.check=Qo(s.check,a,D,d)),m-=D,d+=D,_e)break e}else s.head&&(s.head.name=null);s.length=0,s.mode=16187;case 16187:if(4096&Oo(s)){if(m===0)break e;D=0;do _e=a[d+D++],s.head&&_e&&s.length<65536&&(s.head.comment+=String.fromCharCode(_e));while(_e&&D<m);if(512&Oo(s)&&4&s.wrap&&(s.check=Qo(s.check,a,D,d)),m-=D,d+=D,_e)break e}else s.head&&(s.head.comment=null);s.mode=16188;case 16188:if(512&Oo(s)){for(;w<16;){if(m===0)break e;m--,v+=a[d++]<<w,w+=8}if(4&s.wrap&&v!==(65535&s.check)){t.msg="header crc mismatch",s.mode=ds;break}v=0,w=0}s.head&&(s.head.hcrc=Oo(s)>>9&1,s.head.done=!0),t.adler=s.check=0,s.mode=Cf;break;case 16189:for(;w<32;){if(m===0)break e;m--,v+=a[d++]<<w,w+=8}t.adler=s.check=j7(v),v=0,w=0,s.mode=gO;case gO:if(s.havedict===0)return t.next_out=h,t.avail_out=y,t.next_in=d,t.avail_in=m,s.hold=v,s.bits=w,gye;t.adler=s.check=1,s.mode=Cf;case Cf:if(r===fye||r===fO)break e;case oM:if(s.last){v>>>=7&w,w-=7&w,s.mode=cM;break}for(;w<3;){if(m===0)break e;m--,v+=a[d++]<<w,w+=8}switch(s.last=1&v,v>>>=1,w-=1,3&v){case 0:s.mode=16193;break;case 1:if(Eye(s),s.mode=_O,r===fO){v>>>=2,w-=2;break e}break;case 2:s.mode=16196;break;case 3:t.msg="invalid block type",s.mode=ds}v>>>=2,w-=2;break;case 16193:for(v>>>=7&w,w-=7&w;w<32;){if(m===0)break e;m--,v+=a[d++]<<w,w+=8}if((65535&v)!=(v>>>16^65535)){t.msg="invalid stored block lengths",s.mode=ds;break}if(s.length=65535&v,v=0,w=0,s.mode=aM,r===fO)break e;case aM:s.mode=16195;case 16195:if(D=s.length,D){if(D>m&&(D=m),D>y&&(D=y),D===0)break e;c.set(a.subarray(d,d+D),h),m-=D,d+=D,y-=D,h+=D,s.length-=D;break}s.mode=Cf;break;case 16196:for(;w<14;){if(m===0)break e;m--,v+=a[d++]<<w,w+=8}if(s.nlen=257+(31&v),v>>>=5,w-=5,s.ndist=1+(31&v),v>>>=5,w-=5,s.ncode=4+(15&v),v>>>=4,w-=4,s.nlen>286||s.ndist>30){t.msg="too many length or distance symbols",s.mode=ds;break}s.have=0,s.mode=16197;case 16197:for(;s.have<s.ncode;){for(;w<3;){if(m===0)break e;m--,v+=a[d++]<<w,w+=8}s.lens[Pn[s.have++]]=7&v,v>>>=3,w-=3}for(;s.have<19;)s.lens[Pn[s.have++]]=0;if(s.lencode=s.lendyn,s.lenbits=7,yt={bits:s.lenbits},Ne=ET(0,s.lens,0,19,s.lencode,0,s.work,yt),s.lenbits=yt.bits,Ne){t.msg="invalid code lengths set",s.mode=ds;break}s.have=0,s.mode=16198;case 16198:for(;s.have<s.nlen+s.ndist;){for(;Ze=s.lencode[v&(1<<s.lenbits)-1],W=Ze>>>24,Q=Ze>>>16&255,ee=65535&Ze,!(W<=w);){if(m===0)break e;m--,v+=a[d++]<<w,w+=8}if(ee<16)v>>>=W,w-=W,s.lens[s.have++]=ee;else{if(ee===16){for(An=W+2;w<An;){if(m===0)break e;m--,v+=a[d++]<<w,w+=8}if(v>>>=W,w-=W,s.have===0){t.msg="invalid bit length repeat",s.mode=ds;break}_e=s.lens[s.have-1],D=3+(3&v),v>>>=2,w-=2}else if(ee===17){for(An=W+3;w<An;){if(m===0)break e;m--,v+=a[d++]<<w,w+=8}v>>>=W,w-=W,_e=0,D=3+(7&v),v>>>=3,w-=3}else{for(An=W+7;w<An;){if(m===0)break e;m--,v+=a[d++]<<w,w+=8}v>>>=W,w-=W,_e=0,D=11+(127&v),v>>>=7,w-=7}if(s.have+D>s.nlen+s.ndist){t.msg="invalid bit length repeat",s.mode=ds;break}for(;D--;)s.lens[s.have++]=_e}}if(s.mode===ds)break;if(s.lens[256]===0){t.msg="invalid code -- missing end-of-block",s.mode=ds;break}if(s.lenbits=9,yt={bits:s.lenbits},Ne=ET(1,s.lens,0,s.nlen,s.lencode,0,s.work,yt),s.lenbits=yt.bits,Ne){t.msg="invalid literal/lengths set",s.mode=ds;break}if(s.distbits=6,s.distcode=s.distdyn,yt={bits:s.distbits},Ne=ET(2,s.lens,s.nlen,s.ndist,s.distcode,0,s.work,yt),s.distbits=yt.bits,Ne){t.msg="invalid distances set",s.mode=ds;break}if(s.mode=_O,r===fO)break e;case _O:s.mode=yO;case yO:if(m>=6&&y>=258){t.next_out=h,t.avail_out=y,t.next_in=d,t.avail_in=m,s.hold=v,s.bits=w,lye(t,O),h=t.next_out,c=t.output,y=t.avail_out,d=t.next_in,a=t.input,m=t.avail_in,v=s.hold,w=s.bits,s.mode===Cf&&(s.back=-1);break}for(s.back=0;Ze=s.lencode[v&(1<<s.lenbits)-1],W=Ze>>>24,Q=Ze>>>16&255,ee=65535&Ze,!(W<=w);){if(m===0)break e;m--,v+=a[d++]<<w,w+=8}if(Q&&(240&Q)==0){for(fe=W,ye=Q,Ee=ee;Ze=s.lencode[Ee+((v&(1<<fe+ye)-1)>>fe)],W=Ze>>>24,Q=Ze>>>16&255,ee=65535&Ze,!(fe+W<=w);){if(m===0)break e;m--,v+=a[d++]<<w,w+=8}v>>>=fe,w-=fe,s.back+=fe}if(v>>>=W,w-=W,s.back+=W,s.length=ee,Q===0){s.mode=16205;break}if(32&Q){s.back=-1,s.mode=Cf;break}if(64&Q){t.msg="invalid literal/length code",s.mode=ds;break}s.extra=15&Q,s.mode=16201;case 16201:if(s.extra){for(An=s.extra;w<An;){if(m===0)break e;m--,v+=a[d++]<<w,w+=8}s.length+=v&(1<<s.extra)-1,v>>>=s.extra,w-=s.extra,s.back+=s.extra}s.was=s.length,s.mode=16202;case 16202:for(;Ze=s.distcode[v&(1<<s.distbits)-1],W=Ze>>>24,Q=Ze>>>16&255,ee=65535&Ze,!(W<=w);){if(m===0)break e;m--,v+=a[d++]<<w,w+=8}if((240&Q)==0){for(fe=W,ye=Q,Ee=ee;Ze=s.distcode[Ee+((v&(1<<fe+ye)-1)>>fe)],W=Ze>>>24,Q=Ze>>>16&255,ee=65535&Ze,!(fe+W<=w);){if(m===0)break e;m--,v+=a[d++]<<w,w+=8}v>>>=fe,w-=fe,s.back+=fe}if(v>>>=W,w-=W,s.back+=W,64&Q){t.msg="invalid distance code",s.mode=ds;break}s.offset=ee,s.extra=15&Q,s.mode=16203;case 16203:if(s.extra){for(An=s.extra;w<An;){if(m===0)break e;m--,v+=a[d++]<<w,w+=8}s.offset+=v&(1<<s.extra)-1,v>>>=s.extra,w-=s.extra,s.back+=s.extra}if(s.offset>s.dmax){t.msg="invalid distance too far back",s.mode=ds;break}s.mode=16204;case 16204:if(y===0)break e;if(D=O-y,s.offset>D){if(D=s.offset-D,D>s.whave&&s.sane){t.msg="invalid distance too far back",s.mode=ds;break}D>s.wnext?(D-=s.wnext,G=s.wsize-D):G=s.wnext-D,D>s.length&&(D=s.length),j=s.window}else j=c,G=h-s.offset,D=s.length;D>y&&(D=y),y-=D,s.length-=D;do c[h++]=j[G++];while(--D);s.length===0&&(s.mode=yO);break;case 16205:if(y===0)break e;c[h++]=s.length,y--,s.mode=yO;break;case cM:if(s.wrap){for(;w<32;){if(m===0)break e;m--,v|=a[d++]<<w,w+=8}if(O-=y,t.total_out+=O,s.total+=O,4&s.wrap&&O&&(t.adler=s.check=Oo(s)?Qo(s.check,c,O,h-O):dT(s.check,c,O,h-O)),O=y,4&s.wrap&&(Oo(s)?v:j7(v))!==s.check){t.msg="incorrect data check",s.mode=ds;break}v=0,w=0}s.mode=16207;case 16207:if(s.wrap&&Oo(s)){for(;w<32;){if(m===0)break e;m--,v+=a[d++]<<w,w+=8}if(4&s.wrap&&v!==(4294967295&s.total)){t.msg="incorrect length check",s.mode=ds;break}v=0,w=0}s.mode=16208;case 16208:Ne=mye;break e;case ds:Ne=M7;break e;case 16210:return U7;default:return ju}return t.next_out=h,t.avail_out=y,t.next_in=d,t.avail_in=m,s.hold=v,s.bits=w,(s.wsize||O!==t.avail_out&&s.mode<ds&&(s.mode<cM||r!==L7))&&H7(t,t.output,t.next_out,O-t.avail_out),R-=t.avail_in,O-=t.avail_out,t.total_in+=R,t.total_out+=O,s.total+=O,4&s.wrap&&O&&(t.adler=s.check=Oo(s)?Qo(s.check,c,O,t.next_out-O):dT(s.check,c,O,t.next_out-O)),t.data_type=s.bits+(s.last?64:0)+(s.mode===Cf?128:0)+(s.mode===_O||s.mode===aM?256:0),(R===0&&O===0||r===L7)&&Ne===yy&&(Ne=_ye),Ne},Rf={inflateReset:B7,inflateReset2:W7,inflateResetKeep:F7,inflateInit:t=>z7(t,15),inflateInit2:z7,inflate:vye,inflateEnd:t=>{if(Ey(t))return ju;let r=t.state;return r.window&&(r.window=null),t.state=null,yy},inflateGetHeader:(t,r)=>{if(Ey(t))return ju;const s=t.state;return(2&s.wrap)==0?ju:(s.head=r,r.done=!1,yy)},inflateSetDictionary:(t,r)=>{const s=r.length;let a,c,d;return Ey(t)?ju:(a=t.state,a.wrap!==0&&a.mode!==gO?ju:a.mode===gO&&(c=1,c=dT(c,r,s,0),c!==a.check)?M7:(d=H7(t,r,s,s),d?(a.mode=16210,U7):(a.havedict=1,yy)))},inflateInfo:"pako inflate (from Nodeca project)"},Sye=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const $7=Object.prototype.toString,{Z_NO_FLUSH:bye,Z_FINISH:wye,Z_OK:vT,Z_STREAM_END:dM,Z_NEED_DICT:hM,Z_STREAM_ERROR:Tye,Z_DATA_ERROR:K7,Z_MEM_ERROR:Cye}=oO;function EO(t){this.options=lO.assign({chunkSize:65536,windowBits:15,to:""},t||{});const r=this.options;r.raw&&r.windowBits>=0&&r.windowBits<16&&(r.windowBits=-r.windowBits,r.windowBits===0&&(r.windowBits=-15)),!(r.windowBits>=0&&r.windowBits<16)||t&&t.windowBits||(r.windowBits+=32),r.windowBits>15&&r.windowBits<48&&(15&r.windowBits)==0&&(r.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new D7,this.strm.avail_out=0;let s=Rf.inflateInit2(this.strm,r.windowBits);if(s!==vT)throw new Error(fy[s]);if(this.header=new Sye,Rf.inflateGetHeader(this.strm,this.header),r.dictionary&&(typeof r.dictionary=="string"?r.dictionary=yT.string2buf(r.dictionary):$7.call(r.dictionary)==="[object ArrayBuffer]"&&(r.dictionary=new Uint8Array(r.dictionary)),r.raw&&(s=Rf.inflateSetDictionary(this.strm,r.dictionary),s!==vT)))throw new Error(fy[s])}function Rye(t,r){const s=new EO(r);if(s.push(t),s.err)throw s.msg||fy[s.err];return s.result}EO.prototype.push=function(t,r){const s=this.strm,a=this.options.chunkSize,c=this.options.dictionary;let d,h,m;if(this.ended)return!1;for(h=r===~~r?r:r===!0?wye:bye,$7.call(t)==="[object ArrayBuffer]"?s.input=new Uint8Array(t):s.input=t,s.next_in=0,s.avail_in=s.input.length;;){for(s.avail_out===0&&(s.output=new Uint8Array(a),s.next_out=0,s.avail_out=a),d=Rf.inflate(s,h),d===hM&&c&&(d=Rf.inflateSetDictionary(s,c),d===vT?d=Rf.inflate(s,h):d===K7&&(d=hM));s.avail_in>0&&d===dM&&s.state.wrap>0&&t[s.next_in]!==0;)Rf.inflateReset(s),d=Rf.inflate(s,h);switch(d){case Tye:case K7:case hM:case Cye:return this.onEnd(d),this.ended=!0,!1}if(m=s.avail_out,s.next_out&&(s.avail_out===0||d===dM))if(this.options.to==="string"){let y=yT.utf8border(s.output,s.next_out),v=s.next_out-y,w=yT.buf2string(s.output,y);s.next_out=v,s.avail_out=a-v,v&&s.output.set(s.output.subarray(y,y+v),0),this.onData(w)}else this.onData(s.output.length===s.next_out?s.output:s.output.subarray(0,s.next_out));if(d!==vT||m!==0){if(d===dM)return d=Rf.inflateEnd(this.strm),this.onEnd(d),this.ended=!0,!0;if(s.avail_in===0)break}}return!0},EO.prototype.onData=function(t){this.chunks.push(t)},EO.prototype.onEnd=function(t){t===vT&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=lO.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};var Iye={inflate:Rye};const{deflate:Aye}=cye,{inflate:Pye}=Iye;var Oye=Aye,kye=Pye,q7=function(t){return t[t.ONE_BYTE=0]="ONE_BYTE",t[t.TWO_BYTE=1]="TWO_BYTE",t}(q7||{});class Nye{constructor(){q(this,"_sequence",0),q(this,"_startTime",Date.now()),q(this,"isUseOneByte",!0)}get startTime(){const r=Date.now()-this._startTime;return r<Math.pow(2,16)?r:(this._startTime+=Math.pow(2,16),this.startTime)}get sequence(){return this._sequence<Math.pow(2,32)?this._sequence++:(this._sequence-=Math.pow(2,32),this.sequence)}serialize(r){const s={commonPacketHeader:{length:0,reserved:0,extension:0,sequence:this.sequence},commonStreamHeader:this.startTime,extension:void 0,payload:r};if(r.byteLength>128){const m=new Uint8Array(4);m.set([1,0,0,0]);const y={id:0,length:4,data:m.buffer},v={profile:this.isUseOneByte?0:1,length:this.isUseOneByte?5:6,datas:[y]};s.commonPacketHeader.extension=1,s.extension=v,s.payload=this.compress(r),s.commonPacketHeader.length=8+(s.extension.length+2)+s.payload.byteLength}else s.commonPacketHeader.length=8+s.payload.byteLength;oe("SHOW_DATASTREAM2_LOG")&&x.debug("send data header: ".concat(JSON.stringify(s.commonPacketHeader)));const a=new ArrayBuffer(s.commonPacketHeader.length),c=new Uint8Array(a),d=new DataView(a);let h=0;if(d.setUint16(h,s.commonPacketHeader.extension<<15|s.commonPacketHeader.reserved<<14|s.commonPacketHeader.length,!0),h+=2,d.setUint32(h,s.commonPacketHeader.sequence,!0),h+=4,d.setUint16(h,s.commonStreamHeader,!0),h+=2,s.extension){const m=this.serializeExtension(s.extension);c.set(new Uint8Array(m),h),h+=m.byteLength}if(c.set(new Uint8Array(s.payload),h),h+=s.payload.byteLength,h!==s.commonPacketHeader.length)throw Error("serialize error!");return a}deserialize(r){if(r.byteLength<4)return new ArrayBuffer(0);const s=new DataView(r);let a=0;const c=s.getUint16(a,!0);a+=2;const d={length:16383&c,reserved:(16384&c)>>14,extension:(32768&c)>>15,sequence:s.getUint16(a+2,!0)<<16|s.getUint16(a,!0)};let h,m;if(a+=4,oe("SHOW_DATASTREAM2_LOG")&&x.debug("receive data header: ".concat(JSON.stringify(d))),s.getUint16(a,!0),a+=2,d.extension){m=this.deserializeExtension(r.slice(a)),a+=2+m.length,h=r.slice(a);let y=!1;if(m.datas.length>0){const v=m.datas.find(w=>w.id===0);v&&(y=(1&new DataView(v.data).getUint32(0,!0))==1)}h=y?this.decompress(h):h}else h=r.slice(8);return h}serializeExtension(r){const{profile:s,length:a,datas:c}=r,d=new ArrayBuffer(a+2),h=new Uint8Array(d),m=new DataView(d);let y=0;if(m.setUint8(y++,s),m.setUint8(y++,a),c.forEach(v=>{s?(m.setUint8(y++,v.id),m.setUint8(y++,v.length),h.set(new Uint8Array(v.data),y),y+=v.data.byteLength):(m.setUint8(y++,v.id|v.length<<4),h.set(new Uint8Array(v.data),y),y+=v.data.byteLength)}),y!==a+2)throw Error("serialize extension error, is ".concat(y,"!==").concat(a+2));return d}deserializeExtension(r){const s=new DataView(r);let a=0;const c=s.getUint8(a);a++;const d=s.getUint8(a);a++;const h=c===q7.TWO_BYTE,m=[],y=new DataView(r,2);let v=0;for(;v<d;){let w=0,R=0,O=new ArrayBuffer(0);h?(w=y.getUint8(v),v++,R=y.getUint8(v),v++):(w=15&y.getUint8(v),R=y.getUint8(v)>>4,v++),R>0&&(O=y.buffer.slice(v+2,v+2+R),v+=O.byteLength),m.push({id:w,length:R,data:O})}if(v!==d)throw Error("parse error");return{profile:c,length:d,datas:m}}decompress(r){return kye(new Uint8Array(r))}compress(r){return Oye(new Uint8Array(r))}}const Dye={name:"DataStream",create:(t,r)=>{const s=r?new Fme(t):new Bme(t);return s.useDataStream(new Nye),s}};class xye extends Br{constructor(r,s,a){super(),q(this,"ws",void 0),q(this,"requestId",1),q(this,"heartBeatTimer",void 0),q(this,"joinInfo",void 0),q(this,"clientId",void 0),q(this,"onOpen",()=>{this.emit("open"),this.startHeartBeatCheck()}),q(this,"onClose",c=>{this.emit("close"),this.dispose()}),q(this,"onMessage",c=>{const d=JSON.parse(c.data);if(!d||d.command!=="serverResponse"||!d.requestId)return d&&d.command==="serverStatus"&&d.serverStatus&&d.serverStatus.command?(this.emit("status",d.serverStatus),void this.emit(d.serverStatus.command,d.serverStatus)):void 0;this.emit("req_".concat(d.requestId),d)}),this.joinInfo=r,this.clientId=s,this.ws=new $w("cross-channel-".concat(this.clientId),a),this.ws.on(rn.RECONNECTING,()=>{this.ws.reconnectMode="retry",this.emit("reconnecting")}),this.ws.on(rn.CONNECTED,this.onOpen),this.ws.on(rn.ON_MESSAGE,this.onMessage),this.ws.on(rn.CLOSED,this.onClose)}isConnect(){return this.ws.state==="connected"}sendMessage(r){const s=this.requestId++;return r.requestId=s,r.seq=s,this.ws.sendMessage(r),s}waitStatus(r){return new pt((s,a)=>{const c=window.setTimeout(()=>{a(new Ae(te.TIMEOUT,"wait status timeout, status: ".concat(r)))},5e3);this.once(r,d=>{window.clearTimeout(c),d.state&&d.state!==0?a(new Ae(te.CROSS_CHANNEL_WAIT_STATUS_ERROR,"wait status error, status: ".concat(r))):s(void 0)}),this.once("dispose",()=>{window.clearTimeout(c),a(new Ae(te.WS_ABORT))})})}async request(r){if(this.ws.state==="closed")throw new Ae(te.WS_DISCONNECT);const s=()=>new pt((h,m)=>{this.ws.once(rn.CLOSED,()=>m(new Ae(te.WS_ABORT))),this.ws.once(rn.CONNECTED,h)});this.ws.state!=="connected"&&await s();const a=this.sendMessage(r),c=new pt((h,m)=>{const y=()=>{m(new Ae(te.WS_ABORT))};this.ws.once(rn.RECONNECTING,y),this.ws.once(rn.CLOSED,y),this.once("req_".concat(a),h),ys(3e3).then(()=>{this.removeAllListeners("req_".concat(a)),this.ws.off(rn.RECONNECTING,y),this.ws.off(rn.CLOSED,y),m(new Ae(te.TIMEOUT,"cross channel ws request timeout"))})}),d=await c;if(!d||d.code!==200)throw new Ae(te.CROSS_CHANNEL_SERVER_ERROR_RESPONSE,"response: ".concat(JSON.stringify(d)));return d}async connect(r){this.ws.removeAllListeners(rn.REQUEST_NEW_URLS),this.ws.on(rn.REQUEST_NEW_URLS,s=>{s(r)}),await this.ws.init(r)}dispose(){this.clearHeartBeatCheck(),this.emit("dispose"),this.removeAllListeners(),this.ws.close()}sendPing(r){const s=this.requestId++;return r.requestId=s,this.ws.sendMessage(r),s}startHeartBeatCheck(){this.heartBeatTimer&&window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=window.setInterval(()=>{this.sendPing({command:"ping",appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sid:this.joinInfo.sid,ts:+new Date,requestId:0})},3e3)}clearHeartBeatCheck(){window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=void 0}}class Lye extends Br{set state(r){r!==this._state&&(r!==Ja.RELAY_STATE_FAILURE&&(this.errorCode=hS.RELAY_OK),this.emit("state",r,this.errorCode),this._state=r)}get state(){return this._state}constructor(r,s,a,c,d){super(),q(this,"joinInfo",void 0),q(this,"sid",void 0),q(this,"clientId",void 0),q(this,"cancelToken",va.CancelToken.source()),q(this,"workerToken",void 0),q(this,"requestId",0),q(this,"signal",void 0),q(this,"prevChannelMediaConfig",void 0),q(this,"httpRetryConfig",void 0),q(this,"_resolution",void 0),q(this,"_state",Ja.RELAY_STATE_IDLE),q(this,"errorCode",hS.RELAY_OK),q(this,"onStatus",h=>{x.debug("[".concat(this.clientId,"] ChannelMediaStatus: ").concat(JSON.stringify(h))),h&&h.command&&(h.command==="onAudioPacketReceived"&&this.emit("event",Ef.PACKET_RECEIVED_AUDIO_FROM_SRC),h.command==="onVideoPacketReceived"&&this.emit("event",Ef.PACKET_RECEIVED_VIDEO_FROM_SRC),h.command==="onSrcTokenPrivilegeDidExpire"&&(this.errorCode=hS.SRC_TOKEN_EXPIRED,this.state=Ja.RELAY_STATE_FAILURE),h.command==="onDestTokenPrivilegeDidExpire"&&(this.errorCode=hS.DEST_TOKEN_EXPIRED,this.state=Ja.RELAY_STATE_FAILURE))}),q(this,"onReconnect",async()=>{x.debug("[".concat(this.clientId,"] ChannelMediaSocket disconnect, reconnecting")),this.emit("event",Ef.NETWORK_DISCONNECTED),this.state=Ja.RELAY_STATE_IDLE,this.prevChannelMediaConfig&&this.sendStartRelayMessage(this.prevChannelMediaConfig).catch(h=>{this.state!==Ja.RELAY_STATE_IDLE&&(x.error("auto restart channel media relay failed",h.toString()),this.errorCode=hS.SERVER_CONNECTION_LOST,this.state=Ja.RELAY_STATE_FAILURE)})}),this.joinInfo=r,this.clientId=s,this.sid=J_(),this.signal=new xye(this.joinInfo,this.clientId,a),this.httpRetryConfig=c,this._resolution=d}async startChannelMediaRelay(r){if(this.state!==Ja.RELAY_STATE_IDLE)throw new Ae(te.INVALID_OPERATION);this.state=Ja.RELAY_STATE_CONNECTING,await this.connect(),x.debug("[".concat(this.clientId,"] startChannelMediaRelay: connect success"));try{await this.sendStartRelayMessage(r)}catch(s){throw s.data&&s.data.serverResponse&&s.data.serverResponse.command==="SetSourceChannel"?new Ae(te.CROSS_CHANNEL_FAILED_JOIN_SRC):s.data&&s.data.serverResponse&&s.serverResponse.command==="SetDestChannelStatus"?new Ae(te.CROSS_CHANNEL_FAILED_JOIN_DEST):s.data&&s.data.serverResponse&&s.serverResponse.command==="StartPacketTransfer"?new Ae(te.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST):s}this.prevChannelMediaConfig=r}async updateChannelMediaRelay(r){if(this.state!==Ja.RELAY_STATE_RUNNING)throw new Ae(te.INVALID_OPERATION);await this.sendUpdateMessage(r),this.prevChannelMediaConfig=r}async setVideoProfile(r){if(this._resolution=r,this.state!==Ja.RELAY_STATE_RUNNING)throw new Ae(te.INVALID_OPERATION);const s=this.genMessage(Jo.SetVideoProfile);await this.signal.request(s),x.debug("[".concat(this.clientId,"] startChannelMediaRelay: setVideoProfile success"))}async stopChannelMediaRelay(){await this.sendStopRelayMessage(),x.debug("[".concat(this.clientId,"] stopChannelMediaRelay: send stop message success")),this.state=Ja.RELAY_STATE_IDLE,this.dispose()}dispose(){x.debug("[".concat(this.clientId,"] disposeChannelMediaRelay")),this.cancelToken.cancel(),this.cancelToken=va.CancelToken.source(),this.state=Ja.RELAY_STATE_IDLE,this.emit("dispose"),this.signal.dispose(),this.prevChannelMediaConfig=void 0}async connect(){const r=await Hge(this.joinInfo,this.cancelToken.token,this.httpRetryConfig);this.workerToken=r.workerToken,await this.signal.connect(r.addressList),this.emit("event",Ef.NETWORK_CONNECTED),this.signal.on("status",this.onStatus),this.signal.on("reconnecting",this.onReconnect)}async sendStartRelayMessage(r){const s=this.genMessage(Jo.StopPacketTransfer);await this.signal.request(s),await this.signal.waitStatus("Normal Quit"),x.debug("[".concat(this.clientId,"] startChannelMediaRelay: StopPacketTransfer success"));const a=this.genMessage(Jo.SetSdkProfile,r);await this.signal.request(a),x.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSdkProfile success"));const c=this.genMessage(Jo.SetSourceChannel,r);await this.signal.request(c),await this.signal.waitStatus("SetSourceChannelStatus"),this.emit("event",Ef.PACKET_JOINED_SRC_CHANNEL),x.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceChannel success"));const d=this.genMessage(Jo.SetSourceUserId,r);await this.signal.request(d),x.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceUserId success"));const h=this.genMessage(Jo.SetDestChannel,r);await this.signal.request(h),await this.signal.waitStatus("SetDestChannelStatus"),this.emit("event",Ef.PACKET_JOINED_DEST_CHANNEL),x.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetDestChannel success"));const m=this.genMessage(Jo.StartPacketTransfer,r);await this.signal.request(m),this.emit("event",Ef.PACKET_SENT_TO_DEST_CHANNEL),this.state=Ja.RELAY_STATE_RUNNING,x.debug("[".concat(this.clientId,"] startChannelMediaRelay: StartPacketTransfer success")),this.setVideoProfile(this._resolution)}async sendUpdateMessage(r){const s=this.genMessage(Jo.UpdateDestChannel,r);await this.signal.request(s),this.emit("event",Ef.PACKET_UPDATE_DEST_CHANNEL),x.debug("[".concat(this.clientId,"] sendUpdateMessage: UpdateDestChannel success"))}async sendStopRelayMessage(){const r=this.genMessage(Jo.StopPacketTransfer);await this.signal.request(r),x.debug("[".concat(this.clientId,"] sendStopRelayMessage: StopPacketTransfer success"))}genMessage(r,s){const a=[],c=[],d=[];this.requestId+=1;const h={appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sdkVersion:Ml,sid:this.sid,ts:Date.now(),requestId:this.requestId,seq:this.requestId,allocate:!0,clientRequest:{}};h.sdkVersion==="4.23.2"&&(h.sdkVersion="0.0.1");let m=null,y=null;switch(r){case Jo.SetSdkProfile:return h.clientRequest={command:"SetSdkProfile",type:"multi_channel"},h;case Jo.SetSourceChannel:if(y=s&&s.getSrcChannelMediaInfo(),!y)throw new Ae(te.UNEXPECTED_ERROR,"can not find source config");return h.clientRequest={command:"SetSourceChannel",uid:"0",channelName:y.channelName,token:y.token||this.joinInfo.appId},h;case Jo.SetSourceUserId:if(y=s&&s.getSrcChannelMediaInfo(),!y)throw new Ae(te.UNEXPECTED_ERROR,"can not find source config");return h.clientRequest={command:"SetSourceUserId",uid:y.uid+""},h;case Jo.SetDestChannel:if(m=s&&s.getDestChannelMediaInfo(),!m)throw new Ae(te.UNEXPECTED_ERROR,"can not find dest config");return m.forEach(v=>{a.push(v.channelName),c.push(v.uid+""),d.push(v.token||this.joinInfo.appId)}),h.clientRequest={command:"SetDestChannel",channelName:a,uid:c,token:d},h;case Jo.StartPacketTransfer:return h.clientRequest={command:"StartPacketTransfer"},h;case Jo.Reconnect:return h.clientRequest={command:"Reconnect"},h;case Jo.StopPacketTransfer:return h.clientRequest={command:"StopPacketTransfer"},h;case Jo.UpdateDestChannel:if(m=s&&s.getDestChannelMediaInfo(),!m)throw new Ae(te.UNEXPECTED_ERROR,"can not find dest config");return m.forEach(v=>{a.push(v.channelName),c.push(v.uid+""),d.push(v.token||this.joinInfo.appId)}),h.clientRequest={command:"UpdateDestChannel",channelName:a,uid:c,token:d},h;case Jo.SetVideoProfile:h.clientRequest={command:"SetVideoProfile",width:this._resolution.width,height:this._resolution.height}}return h}}const Mye={name:"ChannelMediaRelay",create:function(t){return new Lye(t.joinInfo,t.clientId,t.websocketRetryConfig||Di,t.httpRetryConfig||Di,t.resolution)}};function Y7(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}function ST(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?Y7(Object(s),!0).forEach(function(a){q(t,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):Y7(Object(s)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))})}return t}class Uye extends Br{constructor(r,s,a,c){super(),q(this,"spec",void 0),q(this,"token",void 0),q(this,"websocket",void 0),q(this,"pingpongTimer",void 0),q(this,"reconnectMode","retry"),q(this,"serviceMode",void 0),q(this,"reqId",0),q(this,"commandReqId",0),q(this,"handleWebSocketOpen",()=>{this.reconnectMode="retry",this.startPingPong()}),q(this,"handleWebSocketMessage",d=>{if(!d.data)return;const h=JSON.parse(d.data);h.requestId?this.emit("@".concat(h.requestId,"-").concat(h.sid),h):(Nt.workerEvent(this.spec.sid,{actionType:"status",serverCode:h.code,workerType:this.serviceMode===yf.TRANSCODE?1:2}),this.emit(Zm.PUBLISH_STREAM_STATUS,h))}),this.spec=s,this.token=r,this.serviceMode=c,this.websocket=new $w("live-streaming",a),this.websocket.on(rn.CONNECTED,this.handleWebSocketOpen),this.websocket.on(rn.ON_MESSAGE,this.handleWebSocketMessage),this.websocket.on(rn.REQUEST_NEW_URLS,(d,h)=>{Ms(this,Zm.REQUEST_NEW_ADDRESS).then(d).catch(h)}),this.websocket.on(rn.RECONNECTING,()=>{this.websocket.reconnectMode=this.reconnectMode})}init(r){return this.websocket.init(r)}async request(r,s,a,c){this.reqId+=1,r==="request"&&(this.commandReqId+=1);const d=this.commandReqId,h=this.reqId;if(!h||!this.websocket)throw new Ae(te.UNEXPECTED_ERROR);const m=ST({command:r,sdkVersion:Ml==="4.23.2"?"0.0.1":Ml,seq:h,requestId:h,allocate:a,cname:this.spec.cname,appId:this.spec.appId,sid:this.spec.sid,uid:this.spec.uid.toString(),ts:Math.floor(Date.now()/1e3)},s);if(this.websocket.state==="closed")throw new Ae(te.WS_DISCONNECT);const y=()=>new pt((O,D)=>{this.websocket.once(rn.CLOSED,()=>D(new Ae(te.WS_ABORT))),this.websocket.once(rn.CONNECTED,O)});this.websocket.state!=="connected"&&await y(),m.clientRequest&&(m.clientRequest.workerToken=this.token);const v=new pt((O,D)=>{const G=()=>{D(new Ae(te.WS_ABORT))};this.websocket.once(rn.RECONNECTING,G),this.websocket.once(rn.CLOSED,G),this.once("@".concat(h,"-").concat(this.spec.sid),j=>{O(j)})});c&&Nt.workerEvent(this.spec.sid,ST(ST({},c),{},{requestId:d,actionType:"request",payload:JSON.stringify(s.clientRequest),serverCode:0,code:0}));const w=Date.now();this.websocket.sendMessage(m);let R=null;try{R=await v}catch(O){if(this.websocket.state==="closed")throw O;return await y(),await this.request(r,s,a)}return c&&Nt.workerEvent(this.spec.sid,ST(ST({},c),{},{requestId:d,actionType:"response",payload:JSON.stringify(R.serverResponse),serverCode:R.code,success:R.code===200,responseTime:Date.now()-w})),R.code!==200&&this.handleResponseError(R),R}tryNextAddress(){this.reconnectMode="tryNext",this.websocket.reconnect("tryNext")}close(){const r=Ml==="4.23.2"?"0.0.1":Ml;this.reqId+=1,this.websocket.state==="connected"?(this.websocket.sendMessage({command:"request",appId:this.spec.appId,cname:this.spec.cname,uid:this.spec.uid.toString(),sdkVersion:r,sid:this.spec.sid,seq:this.reqId,ts:Math.floor(Date.now()/1e3),requestId:this.reqId,clientRequest:{command:"DestroyWorker"}}),this.websocket.close(!1,!0)):this.websocket.close(!1),this.pingpongTimer&&(window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0)}handleResponseError(r){switch(r.code){case Wi.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM:return void x.warning("live stream response already exists stream");case Wi.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR:case Wi.LIVE_STREAM_RESPONSE_BAD_STREAM:case Wi.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR:return new Ae(te.LIVE_STREAMING_INVALID_ARGUMENT,"",{code:r.code}).throw();case Wi.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST:if(r.serverResponse.command==="UnpublishStream")return;throw new Ae(te.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case Wi.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED:return new Ae(te.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED,"",{code:r.code}).throw();case Wi.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const s=new Ae(te.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE);return this.emit(Zm.WARNING,s,r.serverResponse.url)}case Wi.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN:{const s=new Ae(te.LIVE_STREAMING_WARN_FREQUENT_REQUEST);return this.emit(Zm.WARNING,s,r.serverResponse.url)}case Wi.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH:throw new Ae(te.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case Wi.LIVE_STREAM_RESPONSE_NOT_SUPPORTED:return new Ae(te.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED,"",{code:r.code}).throw();case Wi.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM:{const s=new Ae(te.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT);return this.emit(Zm.WARNING,s,r.serverResponse.url)}case Wi.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR:return new Ae(te.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:r.code}).throw();case Wi.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT:throw new Ae(te.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream resource limit",{retry:!0,changeAddress:!0});case Wi.LIVE_STREAM_RESPONSE_WORKER_LOST:case Wi.LIVE_STREAM_RESPONSE_WORKER_QUIT:if(r.serverResponse.command==="UnpublishStream")return;throw new Ae(te.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case Wi.ERROR_FAIL_SEND_MESSAGE:if(r.serverResponse.command==="UnpublishStream")return;if(r.serverResponse.command==="UpdateTranscoding"||r.serverResponse.command==="ControlStream")return new Ae(te.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{code:r.code}).throw();throw new Ae(te.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case Wi.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case Wi.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case Wi.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case Wi.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:return new Ae(te.LIVE_STREAMING_CDN_ERROR,"",{code:r.code}).throw()}}startPingPong(){this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(()=>{this.websocket.state==="connected"&&this.request("ping",{}).catch(oP)},6e3)}}function X7(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}function Qa(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?X7(Object(s),!0).forEach(function(a){q(t,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):X7(Object(s)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))})}return t}class Vye extends Br{constructor(r){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Di,a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Di;super(),q(this,"onLiveStreamWarning",void 0),q(this,"onLiveStreamError",void 0),q(this,"spec",void 0),q(this,"retryTimeout",1e4),q(this,"connection",void 0),q(this,"httpRetryConfig",void 0),q(this,"wsRetryConfig",void 0),q(this,"streamingTasks",new Map),q(this,"isStartingStreamingTask",!1),q(this,"taskMutex",new Xs("live-streaming")),q(this,"cancelToken",va.CancelToken.source()),q(this,"transcodingConfig",void 0),q(this,"uapResponse",void 0),q(this,"lastTaskId",1),q(this,"statusError",new Map),this.spec=r,this.httpRetryConfig=a,this.wsRetryConfig=s}async setTranscodingConfig(r){const s=Qa(Qa({},Tge),r);s.videoCodecProfile!==66&&s.videoCodecProfile!==77&&s.videoCodecProfile!==100&&(x.debug("[".concat(this.spec.clientId,"] set transcoding config, fix video codec profile: ").concat(s.videoCodecProfile," -> 100")),s.videoCodecProfile=100),s.transcodingUsers||(s.transcodingUsers=s.userConfigs),s.transcodingUsers&&(s.transcodingUsers=s.transcodingUsers.map(h=>Qa(Qa(Qa({},wge),h),{},{zOrder:h.zOrder?h.zOrder+1:1}))),function(h){$r(h.width)||cr(h.width,"config.width",0,1e4),$r(h.height)||cr(h.height,"config.height",0,1e4),$r(h.videoBitrate)||cr(h.videoBitrate,"config.videoBitrate",1,1e6),$r(h.videoFrameRate)||cr(h.videoFrameRate,"config.videoFrameRate"),$r(h.lowLatency)||ff(h.lowLatency,"config.lowLatency"),$r(h.audioSampleRate)||$i(h.audioSampleRate,"config.audioSampleRate",[32e3,44100,48e3]),$r(h.audioBitrate)||cr(h.audioBitrate,"config.audioBitrate",1,128),$r(h.audioChannels)||$i(h.audioChannels,"config.audioChannels",[1,2,3,4,5]),$r(h.videoGop)||cr(h.videoGop,"config.videoGop"),$r(h.videoCodecProfile)||$i(h.videoCodecProfile,"config.videoCodecProfile",[66,77,100]),$r(h.userCount)||cr(h.userCount,"config.userCount",0,17),$r(h.backgroundColor)||cr(h.backgroundColor,"config.backgroundColor",0,16777215),$r(h.userConfigExtraInfo)||_s(h.userConfigExtraInfo,"config.userConfigExtraInfo",0,4096,!1),h.transcodingUsers&&!$r(h.transcodingUsers)&&(mf(h.transcodingUsers,"config.transcodingUsers"),h.transcodingUsers.forEach((m,y)=>{OP(m.uid),$r(m.x)||cr(m.x,"transcodingUser[".concat(y,"].x"),0,1e4),$r(m.y)||cr(m.y,"transcodingUser[".concat(y,"].y"),0,1e4),$r(m.width)||cr(m.width,"transcodingUser[".concat(y,"].width"),0,1e4),$r(m.height)||cr(m.height,"transcodingUser[".concat(y,"].height"),0,1e4),$r(m.zOrder)||cr(m.zOrder-1,"transcodingUser[".concat(y,"].zOrder"),0,100),$r(m.alpha)||cr(m.alpha,"transcodingUser[".concat(y,"].alpha"),0,1,!1)})),$r(h.watermark)||f2(h.watermark,"watermark"),$r(h.backgroundImage)||f2(h.backgroundImage,"backgroundImage"),h.images&&!$r(h.images)&&(mf(h.images,"config.images"),h.images.forEach((m,y)=>{f2(m,"images[".concat(y,"]"))}))}(s);const a=[];s.images&&a.push(...s.images.map(h=>Qa(Qa(Qa({},p2),h),{},{zOrder:255}))),s.backgroundImage&&(a.push(Qa(Qa(Qa({},p2),s.backgroundImage),{},{zOrder:0})),delete s.backgroundImage),s.watermark&&(a.push(Qa(Qa(Qa({},p2),s.watermark),{},{zOrder:255})),delete s.watermark),s.images=a,s.transcodingUsers&&(s.userConfigs=s.transcodingUsers.map(h=>Qa({},h)),s.userCount=s.transcodingUsers.length,delete s.transcodingUsers);const c=(s.userConfigs||[]).map(h=>typeof h.uid=="number"?pt.resolve(h.uid):y9(h.uid,this.spec,this.cancelToken.token,this.httpRetryConfig));if((await pt.all(c)).forEach((h,m)=>{s.userConfigs&&s.userConfigs[m]&&(s.userConfigs[m].uid=h)}),this.transcodingConfig=s,this.connection)try{var d;const h=await this.connection.request("request",{clientRequest:{command:"UpdateTranscoding",transcodingConfig:this.transcodingConfig}},!1,{command:"UpdateTranscoding",workerType:1,requestByUser:!0,tid:Array.from(Jc(d=this.streamingTasks).call(d)).map(m=>m.taskId).join("#")});x.debug("[".concat(this.spec.clientId,"] update live transcoding config success, code: ").concat(h.code,", config:"),JSON.stringify(this.transcodingConfig))}catch(h){if(!h.data||!h.data.retry)throw h;h.data.changeAddress&&this.connection.tryNextAddress(),this.streamingTasks.forEach(m=>{x.warning("[".concat(this.spec.clientId,"] live streaming receive error"),h.toString(),"try to republish",m.url),this.startLiveStreamingTask(m.url,m.mode,h).then(()=>{x.debug("[".concat(this.spec.clientId,"] live streaming republish ").concat(m.url," success"))}).catch(y=>{x.error("[".concat(this.spec.clientId,"] live streaming republish failed"),m.url,y.toString()),this.onLiveStreamError&&this.onLiveStreamError(m.url,y)})})}}async startLiveStreamingTask(r,s,a){if(!this.transcodingConfig&&s===yf.TRANSCODE)throw new Ae(te.INVALID_OPERATION,"[LiveStreaming] no transcoding config found, can not start transcoding streaming task");const c={command:"PublishStream",ts:Date.now(),url:r,uid:this.spec.uid.toString(),autoDestroyTime:100,acceptImageTimeout:!0};x.debug("[".concat(this.spec.clientId,"] start live streaming ").concat(r,", mode: ").concat(s));const d=await this.taskMutex.lock();if(!this.connection&&a)return void d();if(this.streamingTasks.get(r)&&!a)return d(),new Ae(te.LIVE_STREAMING_TASK_CONFLICT).throw();try{this.connection||(this.connection=await this.connect(s))}catch(m){throw d(),m}switch(s){case yf.TRANSCODE:c.transcodingConfig=Qa({},this.transcodingConfig)}this.uapResponse&&this.uapResponse.vid&&(c.vid=this.uapResponse.vid),this.isStartingStreamingTask=!0;const h=this.lastTaskId++;try{const m=new pt((v,w)=>{ys(this.retryTimeout).then(()=>{if(a)return w(a);const R=this.statusError.get(r);return R?(this.statusError.delete(r),w(R)):void 0})}),y=await pt.race([this.connection.request("request",{clientRequest:c},!0,{url:r,command:"PublishStream",workerType:s===yf.TRANSCODE?1:2,requestByUser:!a,tid:h.toString()}),m]);this.isStartingStreamingTask=!1,x.debug("[".concat(this.spec.clientId,"] live streaming started, code: ").concat(y.code)),this.streamingTasks.set(r,{clientRequest:c,mode:s,url:r,taskId:h}),d()}catch(m){if(d(),this.isStartingStreamingTask=!1,!m.data||!m.data.retry||a)throw m;return m.data.changeAddress?(this.connection.tryNextAddress(),await this.startLiveStreamingTask(r,s,m)):await this.startLiveStreamingTask(r,s,m)}}stopLiveStreamingTask(r){return new pt((s,a)=>{const c=this.streamingTasks.get(r);if(!c||!this.connection)return new Ae(te.UNEXPECTED_ERROR,"can not find streaming task to stop").throw();const d=c.mode;c.abortTask=()=>{x.debug("[".concat(this.spec.clientId,"] stop live streaming success(worker exception)")),this.streamingTasks.delete(r),s()},this.connection.request("request",{clientRequest:{command:"UnpublishStream",url:c.url}},!1,{url:r,command:"UnPublishStream",workerType:d===yf.TRANSCODE?1:2,requestByUser:!0,tid:(this.lastTaskId++).toString()}).then(h=>{x.debug("[".concat(this.spec.clientId,"] stop live streaming success, code: ").concat(h.code)),this.streamingTasks.delete(r),this.streamingTasks.size===0&&(this.connection&&this.connection.close(),this.connection=void 0),s()}).catch(a)})}resetAllTask(){var r;const s=Array.from(Jc(r=this.streamingTasks).call(r));this.terminate();for(const a of s)this.startLiveStreamingTask(a.url,a.mode).catch(c=>{this.onLiveStreamError&&this.onLiveStreamError(a.url,c)})}terminate(){this.cancelToken&&this.cancelToken.cancel(),this.streamingTasks=new Map,this.isStartingStreamingTask=!1,this.statusError=new Map,this.cancelToken=va.CancelToken.source(),this.uapResponse=void 0,this.connection&&this.connection.close(),this.connection=void 0}async connect(r){if(this.connection)throw new Ae(te.UNEXPECTED_ERROR,"live streaming connection has already connected");const s=await Ms(this,m2.REQUEST_WORKER_MANAGER_LIST,r);return this.uapResponse=s,this.connection=new Uye(s.workerToken,this.spec,this.wsRetryConfig,r),this.connection.on(Zm.WARNING,(a,c)=>this.onLiveStreamWarning&&this.onLiveStreamWarning(c,a)),this.connection.on(Zm.PUBLISH_STREAM_STATUS,a=>this.handlePublishStreamServer(a)),this.connection.on(Zm.REQUEST_NEW_ADDRESS,(a,c)=>{if(!this.connection)return c(new Ae(te.UNEXPECTED_ERROR,"can not get new live streaming address list"));Ms(this,m2.REQUEST_WORKER_MANAGER_LIST,r).then(d=>{this.uapResponse=d,a(d.addressList)}).catch(c)}),await this.connection.init(s.addressList),this.connection}handlePublishStreamServer(r){const s=r.serverStatus&&r.serverStatus.url||"empty_url",a=this.streamingTasks.get(s),c=r.reason;switch(r.code){case Wi.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case Wi.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case Wi.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case Wi.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:{const h=new Ae(te.LIVE_STREAMING_CDN_ERROR,"",{code:r.code});if(a)return x.error(h.toString()),this.onLiveStreamError&&this.onLiveStreamError(s,h);if(!this.isStartingStreamingTask)return;this.statusError.set(s,h)}case Wi.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const h=new Ae(te.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE,c);return this.onLiveStreamWarning&&this.onLiveStreamWarning(s,h)}case Wi.LIVE_STREAM_RESPONSE_WORKER_LOST:case Wi.LIVE_STREAM_RESPONSE_WORKER_QUIT:{var d;if(!this.connection)return;this.connection.tryNextAddress();const h=Array.from(Jc(d=this.streamingTasks).call(d));for(const m of h)m.abortTask?m.abortTask():(x.warning("[".concat(this.spec.clientId,"] publish stream status code"),r.code,"try to republish",m.url),this.startLiveStreamingTask(m.url,m.mode,new Ae(te.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:r.code})).then(()=>{x.debug("[".concat(this.spec.clientId,"] republish live stream success"),m.url)}).catch(y=>{x.error(y.toString()),this.onLiveStreamError&&this.onLiveStreamError(m.url,y)}));return}}}hasUrl(r){return this.streamingTasks.has(r)}}const jye={name:"LiveStreaming",create:function(t){return new Vye(t.joinInfo,t.websocketRetryConfig||Di,t.httpRetryConfig||Di)}};function Fye(t){let r=Z7();return function(s,a){let c=s.appId;c!==void 0&&(tr(a,10),Hh(a,c));let d=s.cid;d!==void 0&&(tr(a,16),tr(a,d));let h=s.cname;h!==void 0&&(tr(a,26),Hh(a,h));let m=s.deviceId;m!==void 0&&(tr(a,34),Hh(a,m));let y=s.elapse;y!==void 0&&(tr(a,40),pg(a,y));let v=s.fileSize;v!==void 0&&(tr(a,48),pg(a,PS(v)));let w=s.height;w!==void 0&&(tr(a,56),pg(a,PS(w)));let R=s.jpg;R!==void 0&&(tr(a,66),tr(a,R.length),function(Ra,ze){let at=OS(Ra,ze.length);Ra.bytes.set(ze,at)}(a,R));let O=s.networkType;O!==void 0&&(tr(a,72),pg(a,PS(O)));let D=s.osType;D!==void 0&&(tr(a,80),pg(a,PS(D)));let G=s.requestId;G!==void 0&&(tr(a,90),Hh(a,G));let j=s.sdkVersion;j!==void 0&&(tr(a,98),Hh(a,j));let W=s.sequence;W!==void 0&&(tr(a,104),pg(a,PS(W)));let Q=s.sid;Q!==void 0&&(tr(a,114),Hh(a,Q));let ee=s.timestamp;ee!==void 0&&(tr(a,120),pg(a,ee));let fe=s.uid;fe!==void 0&&(tr(a,128),tr(a,fe));let ye=s.vid;ye!==void 0&&(tr(a,136),tr(a,ye));let Ee=s.width;Ee!==void 0&&(tr(a,144),pg(a,PS(Ee)));let _e=s.service;_e!==void 0&&(tr(a,152),tr(a,_e));let Ne=s.callbackData;Ne!==void 0&&(tr(a,162),Hh(a,Ne));let Ze=s.jpgEncryption;Ze!==void 0&&(tr(a,168),tr(a,Ze));let ft=s.requestType;ft!==void 0&&(tr(a,176),tr(a,ft));let yt=s.scorePorn;yt!==void 0&&(tr(a,185),_M(a,yt));let An=s.scoreSexy;An!==void 0&&(tr(a,193),_M(a,An));let Pn=s.scoreNeutral;Pn!==void 0&&(tr(a,201),_M(a,Pn));let _r=s.scene;_r!==void 0&&(tr(a,208),tr(a,_r));let pi=s.ossFilePrefix;pi!==void 0&&(tr(a,218),Hh(a,pi));let Zr=s.serviceVendor;if(Zr!==void 0)for(let Ra of Zr){tr(a,226);let ze=Z7();zye(Ra,ze),tr(a,ze.limit),Kye(a,ze),$ye(ze)}}(t,r),function(s){let a=s.bytes,c=s.limit;return a.length===c?a:a.subarray(0,c)}(r)}function Bye(t){return function(s){let a={};e:for(;!eK(s);){let c=$h(s);switch(c>>>3){case 0:break e;case 1:a.code=$h(s);break;case 2:a.msg=tK(s,$h(s));break;case 3:{let d=Gye(s);a.data=Wye(s),s.limit=d;break}default:J7(s,7&c)}}return a}({bytes:r=t,offset:0,limit:r.length});var r}function Wye(t){let r={};e:for(;!eK(t);){let s=$h(t);switch(s>>>3){case 0:break e;case 1:r.requestId=tK(t,$h(t));break;case 2:r.requestType=$h(t)>>>0;break;case 3:r.scorePorn=gM(t);break;case 4:r.scoreSexy=gM(t);break;case 5:r.scoreNeutral=gM(t);break;case 6:r.requestScene=$h(t)>>>0;break;case 7:r.scene=$h(t)>>>0;break;default:J7(t,7&s)}}return r}function zye(t,r){let s=t.service;s!==void 0&&(tr(r,8),tr(r,s));let a=t.vendor;a!==void 0&&(tr(r,16),tr(r,a));let c=t.token;c!==void 0&&(tr(r,26),Hh(r,c));let d=t.callbackUrl;d!==void 0&&(tr(r,34),Hh(r,d))}function Gye(t){let r=$h(t),s=t.limit;return t.limit=t.offset+r,s}function J7(t,r){switch(r){case 0:for(;128&nK(t););break;case 2:fM(t,$h(t));break;case 5:fM(t,4);break;case 1:fM(t,8);break;default:throw new Error("Unimplemented type: "+r)}}let Hye=new Float32Array(1);new Uint8Array(Hye.buffer);let pM=new Float64Array(1),Za=new Uint8Array(pM.buffer);function PS(t){return{low:t|=0,high:t>>31,unsigned:t>=0}}let Q7=[];function Z7(){const t=Q7.pop();return t?(t.offset=t.limit=0,t):{bytes:new Uint8Array(64),offset:0,limit:0}}function $ye(t){Q7.push(t)}function fM(t,r){if(t.offset+r>t.limit)throw new Error("Skip past limit");t.offset+=r}function eK(t){return t.offset>=t.limit}function OS(t,r){let s=t.bytes,a=t.offset,c=t.limit,d=a+r;if(d>s.length){let h=new Uint8Array(2*d);h.set(s),t.bytes=h}return t.offset=d,d>c&&(t.limit=d),a}function mM(t,r){let s=t.offset;if(s+r>t.limit)throw new Error("Read past limit");return t.offset+=r,s}function tK(t,r){let s=mM(t,r),a=String.fromCharCode,c=t.bytes,d="",h="";for(let m=0;m<r;m++){let y,v,w,R,O=c[m+s];(128&O)==0?h+=a(O):(224&O)==192?m+1>=r?h+=d:(y=c[m+s+1],(192&y)!=128?h+=d:(R=(31&O)<<6|63&y,R<128?h+=d:(h+=a(R),m++))):(240&O)==224?m+2>=r?h+=d:(y=c[m+s+1],v=c[m+s+2],(49344&(y|v<<8))!=32896?h+=d:(R=(15&O)<<12|(63&y)<<6|63&v,R<2048||R>=55296&&R<=57343?h+=d:(h+=a(R),m+=2))):(248&O)==240?m+3>=r?h+=d:(y=c[m+s+1],v=c[m+s+2],w=c[m+s+3],(12632256&(y|v<<8|w<<16))!=8421504?h+=d:(R=(7&O)<<18|(63&y)<<12|(63&v)<<6|63&w,R<65536||R>1114111?h+=d:(R-=65536,h+=a(55296+(R>>10),56320+(1023&R)),m+=3))):h+=d}return h}function Hh(t,r){let s=r.length,a=0;for(let h=0;h<s;h++){let m=r.charCodeAt(h);m>=55296&&m<=56319&&h+1<s&&(m=(m<<10)+r.charCodeAt(++h)-56613888),a+=m<128?1:m<2048?2:m<65536?3:4}tr(t,a);let c=OS(t,a),d=t.bytes;for(let h=0;h<s;h++){let m=r.charCodeAt(h);m>=55296&&m<=56319&&h+1<s&&(m=(m<<10)+r.charCodeAt(++h)-56613888),m<128?d[c++]=m:(m<2048?d[c++]=m>>6&31|192:(m<65536?d[c++]=m>>12&15|224:(d[c++]=m>>18&7|240,d[c++]=m>>12&63|128),d[c++]=m>>6&63|128),d[c++]=63&m|128)}}function Kye(t,r){let s=OS(t,r.limit),a=t.bytes,c=r.bytes;for(let d=0,h=r.limit;d<h;d++)a[d+s]=c[d]}function nK(t){return t.bytes[mM(t,1)]}function rK(t,r){let s=OS(t,1);t.bytes[s]=r}function gM(t){let r=mM(t,8),s=t.bytes;return Za[0]=s[r++],Za[1]=s[r++],Za[2]=s[r++],Za[3]=s[r++],Za[4]=s[r++],Za[5]=s[r++],Za[6]=s[r++],Za[7]=s[r++],pM[0]}function _M(t,r){let s=OS(t,8),a=t.bytes;pM[0]=r,a[s++]=Za[0],a[s++]=Za[1],a[s++]=Za[2],a[s++]=Za[3],a[s++]=Za[4],a[s++]=Za[5],a[s++]=Za[6],a[s++]=Za[7]}function $h(t){let r,s=0,a=0;do r=nK(t),s<32&&(a|=(127&r)<<s),s+=7;while(128&r);return a}function tr(t,r){for(r>>>=0;r>=128;)rK(t,127&r|128),r>>>=7;rK(t,r)}function pg(t,r){let s=r.low>>>0,a=(r.low>>>28|r.high<<4)>>>0,c=r.high>>>24,d=c===0?a===0?s<16384?s<128?1:2:s<1<<21?3:4:a<16384?a<128?5:6:a<1<<21?7:8:c<128?9:10,h=OS(t,d),m=t.bytes;switch(d){case 10:m[h+9]=c>>>7&1;case 9:m[h+8]=d!==9?128|c:127&c;case 8:m[h+7]=d!==8?a>>>21|128:a>>>21&127;case 7:m[h+6]=d!==7?a>>>14|128:a>>>14&127;case 6:m[h+5]=d!==6?a>>>7|128:a>>>7&127;case 5:m[h+4]=d!==5?128|a:127&a;case 4:m[h+3]=d!==4?s>>>21|128:s>>>21&127;case 3:m[h+2]=d!==3?s>>>14|128:s>>>14&127;case 2:m[h+1]=d!==2?s>>>7|128:s>>>7&127;case 1:m[h]=d!==1?128|s:127&s}}function iK(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}const qye=new Map([["moderation",1],["supervise",2]]);class Yye extends Br{get connectionState(){return this._connectionState}set connectionState(r){if(this._connectionState===r)return;const s=this._connectionState;this._connectionState=r,this.emit(us.CONNECTION_STATE_CHANGE,s,r)}get inspectType(){return this._inspectType}set inspectType(r){var s;this._inspectMode=Ec(s=r.map(a=>qye.get(a)||0)).call(s,(a,c)=>a+c),this._inspectType=r}get quality(){return this._quality}set quality(r){this._quality=r>1?1:r<.1?.1:r,this.qualityTimer&&(window.clearTimeout(this.qualityTimer),this.qualityTimer=null),this._quality>=1||(this.qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this.qualityRatio},6e4))}constructor(r){super(),q(this,"name","AgoraRTCVideoContentInspect"),q(this,"_connectionState",Du.CONNECTING),q(this,"_innerConnectionState",void 0),q(this,"sequence",0),q(this,"inspectStartTime",void 0),q(this,"workerManagerConnection",void 0),q(this,"workerConnection",void 0),q(this,"workerMessageLengthLimit",void 0),q(this,"inspectIntervalMinimum",void 0),q(this,"qualityRatio",void 0),q(this,"_connectInfo",void 0),q(this,"_cancelTokenSource",va.CancelToken.source()),q(this,"_retryConfig",void 0),q(this,"wmSequence",0),q(this,"inspectInterval",void 0),q(this,"inspectTimer",null),q(this,"ossFilePrefix",void 0),q(this,"extraInfo",void 0),q(this,"_inspectType",void 0),q(this,"_inspectMode",void 0),q(this,"_quality",1),q(this,"qualityTimer",null),q(this,"_inspectId",void 0),q(this,"_needWorkUrlOnly",!1),q(this,"inspectImage",()=>{if(this.connectionState!==Du.CONNECTED)throw new Ae(te.OPERATION_ABORTED,"content inspect service connection status is ".concat(this.connectionState));this.inspectTimer&&(window.clearInterval(this.inspectTimer),this.inspectTimer=null),this.inspectTimer=window.setInterval(()=>{this.connectionState===Du.CONNECTED?this.requestToInspectImage():x.debug("[".concat(this._inspectId,"] Inspect State is not connected , "),this.connectionState)},this.inspectInterval<this.inspectIntervalMinimum?this.inspectIntervalMinimum:this.inspectInterval),this.requestToInspectImage()}),this._inspectId=mr(5,"inspect-"),this.workerMessageLengthLimit=oe("VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT"),this.inspectIntervalMinimum=oe("VIDEO_INSPECT_INTERVAL_MINIMUM"),this.qualityRatio=oe("VIDEO_INSPECT_QUALITY_RATIO"),this.inspectInterval=r.interval,this.ossFilePrefix=r.ossFilePrefix,this.extraInfo=r.extraInfo,this.inspectType=r.inspectType,this.inspectStartTime=Number(Date.now()),this.workerManagerConnection=new $w("worker-manager-"+this._inspectId,Di),this.on(us.STATE_CHANGE,(s,a)=>{this._innerConnectionState=s,x.debug("[".concat(this._inspectId,"] Inspect operation :").concat(xu[s]," ").concat(a||""))}),this.handleWorkerManagerEvents(),this.workerConnection=new $w("worker-"+this._inspectId,Di),this.handleWorkerEvents()}async init(r,s){this.emit(us.STATE_CHANGE,xu.CONNECT_AP),this._connectInfo=r;const a=this._cancelTokenSource.token;return this._retryConfig=s,new pt((c,d)=>{this.on(us.CONNECTION_STATE_CHANGE,(h,m)=>{m===Du.CONNECTED&&c()}),this.requestAP(r,a,s).then(h=>{this.connectWorkerManager(h)}).catch(h=>{d(h)})})}async requestAP(r,s,a){const c=oe("WEBCS_DOMAIN").map(m=>"https://".concat(m,"/api/v1")),d=await function(m,y,v,w){let{appId:R,areaCode:O,cname:D,sid:G,token:j,uid:W}=y;ES++;const Q="image_moderation_api",ee={service_name:Q,json_body:JSON.stringify({appId:R,areaCode:O,cname:D,command:"allocateEdge",requestId:ES,seq:ES,sid:G,token:j,ts:Date.now(),uid:W+""})};let fe,ye,Ee=m[0];return kd(async()=>{fe=Date.now();const _e=await Md(Ee,{data:ee,cancelToken:v,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(ye=Date.now()-fe,_e.code!==0){const yt=new Ae(te.UNEXPECTED_RESPONSE,"image inspect ap error, code"+_e.code,{retry:!0,responseTime:ye});throw x.error(yt.toString()),yt}const Ne=JSON.parse(_e.json_body);if(Ne.code!==200){const yt=new Ae(te.UNEXPECTED_RESPONSE,"image inspect ap error, code: ".concat(Ne.code,", reason: ").concat(Ne.reason),{code:Ne.code,responseTime:ye});throw x.error(yt.toString()),yt}if(!Ne.servers||!Array.isArray(Ne.servers)||Ne.servers.length===0){const yt=new Ae(te.UNEXPECTED_RESPONSE,"image inspect ap empty server",{code:Ne.code,responseTime:ye});throw x.error(yt.toString()),yt}const Ze=oe("VIDEO_INSPECT_WORKER_MANAGER_HOST"),ft=oe("VIDEO_INSPECT_WORKER_MANAGER_PORT");return{addressList:Ne.servers.map(yt=>{let{address:An,wss:Pn}=yt;if(An&&Pn)return"wss://".concat(An.replace(/\./g,"-"),".").concat(Ze,":").concat(ft||Pn)}).filter(yt=>!!yt),workerToken:Ne.workerToken,vid:Ne.vid,responseTime:ye}},(_e,Ne)=>(Nt.apworkerEvent(G,{success:!0,sc:200,serviceName:Q,responseDetail:JSON.stringify(_e.addressList),firstSuccess:Ne===0,responseTime:ye,serverIp:m[Ne%m.length]}),!1),(_e,Ne)=>(Nt.apworkerEvent(G,{success:!1,sc:_e.data&&_e.data.code||200,serviceName:Q,responseTime:ye,serverIp:m[Ne%m.length]}),!!(_e.code!==te.OPERATION_ABORTED&&_e.code!==te.UNEXPECTED_RESPONSE||_e.data&&_e.data.retry)&&(Ee=m[(Ne+1)%m.length],!0)),w)}(c,r,s,a);this.emit(us.STATE_CHANGE,xu.AP_CONNECTED);const{addressList:h}=d;return this.wmSequence++,h}async connectWorkerManager(r){let s=arguments.length>1&&arguments[1]!==void 0&&arguments[1];this._needWorkUrlOnly=s,this.emit(us.STATE_CHANGE,xu.CONNECT_WORKER_MANAGER),await this.workerManagerConnection.init(r,1e4)}async connectWorker(r){await this.workerConnection.init([r])}handleWorkerManagerEvents(){this.workerManagerConnection.on(rn.CONNECTED,async()=>{this.emit(us.STATE_CHANGE,xu.WORKER_MANAGER_CONNECTED,this.workerManagerConnection.url),this.workerManagerConnection.sendMessage({appId:this._connectInfo.appId,cname:this._connectInfo.cname,uid:this._connectInfo.uid+"",sdkVersion:"4.23.2",sid:this._connectInfo.sid,seq:this.wmSequence,ts:Number(Date.now()),requestId:Math.floor(1e12*Math.random()),allocate:!0,clientRequest:{command:"join"}},!0)}),this.workerManagerConnection.on(rn.CLOSED,()=>{this._innerConnectionState<xu.GET_WORKER_MANAGER_RESPONSE&&x.debug("[".concat(this._inspectId,"] Inspect worker manager is closed before connecting worker"))}),this.workerManagerConnection.on(rn.FAILED,()=>{this._innerConnectionState<xu.GET_WORKER_MANAGER_RESPONSE&&x.debug("[".concat(this._inspectId,"] Connecting inspect worker manager is failed before connecting worker"))}),this.workerManagerConnection.on(rn.RECONNECTING,()=>{this._innerConnectionState<xu.GET_WORKER_MANAGER_RESPONSE&&x.debug("[".concat(this._inspectId,"] Inspect worker manager is reconnecting before connecting worker"))}),this.workerManagerConnection.on(rn.ON_MESSAGE,async r=>{this.emit(us.STATE_CHANGE,xu.GET_WORKER_MANAGER_RESPONSE);const s=this.workerManagerConnection.url;this.workerManagerConnection.close();const a=JSON.parse(r.data);if(a.code!==200)throw x.error("[".concat(this._inspectId,"] Unexpected code ").concat(a.code," from worker manager")),new Ae(te.UNEXPECTED_RESPONSE,"response code of worker is unexpected",a);if(!(a.serverResponse&&a.serverResponse.portWss&&s))throw x.error("[".concat(this._inspectId,"] Unexpected content from worker manager : ").concat(JSON.stringify(a))),new Ae(te.UNEXPECTED_RESPONSE,"response content of worker is unexpected",a);{const c=oe("VIDEO_INSPECT_WORKER_PORT")||a.serverResponse.portWss,d=s.replace(/:\d+\/?$/,":".concat(c));this.emit(us.STATE_CHANGE,xu.CONNECT_WORKER,d),this._needWorkUrlOnly?this.emit(us.REQUEST_NEW_WORKER_URL,d):await this.connectWorker(d)}}),this.workerManagerConnection.on(rn.WILL_RECONNECT,(r,s,a)=>{a(r)}),this.workerManagerConnection.on(rn.REQUEST_NEW_URLS,(r,s)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(r).catch(s)})}handleWorkerEvents(){this.workerConnection.on(rn.CONNECTED,async()=>{this.emit(us.STATE_CHANGE,xu.WORKER_CONNECTED,this.workerConnection.url),this.connectionState=Du.CONNECTED}),this.workerConnection.on(rn.ON_MESSAGE,async r=>{if(r.data instanceof ArrayBuffer){const a=Bye(new Uint8Array(r.data));if(oe("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")&&x.debug("[".concat(this._inspectId,"] Response message for worker of inspect content "),JSON.stringify(a)),a.code===200){if(Array.isArray(this.inspectType)&&this.inspectType.length===1&&this.inspectType[0]==="supervise")return void this.emit(us.INSPECT_RESULT,void 0,void 0);if(a.data&&a.data.scorePorn&&a.data.scoreSexy&&a.data.scoreNeutral){var s;const c={porn:a.data.scorePorn,sexy:a.data.scoreSexy,neutral:a.data.scoreNeutral},d=Ec(s=Object.keys(c)).call(s,(m,y)=>c[m]>c[y]?m:y,"porn"),h=Object.keys(c).find(m=>m===d);this.emit(us.INSPECT_RESULT,h)}else this.emit(us.INSPECT_RESULT,void 0,new Ae(te.UNEXPECTED_RESPONSE,a.code+"","There is an unexpected data on message"))}else this.emit(us.INSPECT_RESULT,void 0,new Ae(te.UNEXPECTED_RESPONSE,a.code+"",a.msg))}else x.error("[".concat(this._inspectId,"] Unexpected message type from worker")),this.emit(us.INSPECT_RESULT,void 0,new Ae(te.UNEXPECTED_RESPONSE,"invalid worker message type"))}),this.workerConnection.on(rn.CLOSED,()=>{this.connectionState=Du.CLOSED}),this.workerConnection.on(rn.FAILED,()=>{this.connectionState=Du.CLOSED}),this.workerConnection.on(rn.RECONNECTING,()=>{this.connectionState=this.connectionState===Du.CONNECTED?Du.RECONNECTING:Du.CONNECTING}),this.workerConnection.on(rn.WILL_RECONNECT,(r,s,a)=>{r==="recover"&&a(r),a("tryNext")}),this.workerConnection.on(rn.REQUEST_NEW_URLS,(r,s)=>{this.workerManagerConnection.close(),this.once(us.REQUEST_NEW_WORKER_URL,a=>{r([a])}),this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(a=>{this.connectWorkerManager(a,!0)}).catch(a=>{s(a)})})}async requestToInspectImage(){this.sequence++;const r=Zc(this,us.CLIENT_LOCAL_VIDEO_TRACK),s={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(r){if(!r.isPlaying)return void this.emit(us.INSPECT_RESULT,void 0,new Ae(te.INVALID_OPERATION,"Only the track being played can be inspected"));const a=await this.generateRequestData(r,s);this.workerConnection.sendMessage(a,!0,!0)}else this.emit(us.INSPECT_RESULT,void 0,new Ae(te.INVALID_OPERATION,"Only the track being published can be inspected"))}async generateRequestData(r,s){let{appId:a,cname:c,cid:d,vid:h,sid:m,uid:y}=s;const v=Date.now(),w=await r.getCurrentFrameImage("image/jpeg",this.quality),R=await j8(w,a,c),O=this.sequence+"-"+d+"-"+y+"-"+v+"-"+mr(12,""),D={appId:a,cid:d,cname:c,deviceId:"",elapse:(G=Number(v-this.inspectStartTime),{low:G|=0,high:G>>31,unsigned:G>=0}),fileSize:R.byteLength,jpgEncryption:2,height:w.height,width:w.width,jpg:R,networkType:6,osType:7,requestId:O,sdkVersion:"4.23.2",sequence:this.sequence,sid:m,timestamp:h$(v),uid:y,vid:h,service:this._inspectMode,callbackData:this.extraInfo,ossFilePrefix:this.ossFilePrefix};var G;this.extraInfo===void 0&&delete D.callbackData,this.ossFilePrefix===void 0&&delete D.ossFilePrefix;const j=Fye(D);if(j.byteLength<this.workerMessageLengthLimit){if(oe("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")){const W=function(Q){for(var ee=1;ee<arguments.length;ee++){var fe=arguments[ee]!=null?arguments[ee]:{};ee%2?iK(Object(fe),!0).forEach(function(ye){q(Q,ye,fe[ye])}):Object.getOwnPropertyDescriptors?Object.defineProperties(Q,Object.getOwnPropertyDescriptors(fe)):iK(Object(fe)).forEach(function(ye){Object.defineProperty(Q,ye,Object.getOwnPropertyDescriptor(fe,ye))})}return Q}({},D);delete W.jpg,x.debug("[".concat(this._inspectId,"] Request message for worker of inspect content "),JSON.stringify(W))}return j}{const W=this.quality*this.qualityRatio;return this.quality=W,await this.generateRequestData(r,{appId:a,cname:c,cid:d,vid:h,sid:m,uid:y})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=va.CancelToken.source(),this.workerManagerConnection&&this.workerManagerConnection.close(),this.workerConnection&&this.workerConnection.close(),this.inspectTimer&&window.clearInterval(this.inspectTimer),this.inspectTimer=null,this.connectionState=Du.CLOSED,this.emit(us.STATE_CHANGE,xu.CLOSED)}}const Xye={name:"ContentInspect",create:function(t){let{config:r}=t;return function(s){if(!s)throw new Ae(te.INVALID_PARAMS,"inspectConfig is necessary.");if(!s.inspectType||!Array.isArray(s.inspectType))throw new Ae(te.INVALID_PARAMS,"inspectConfig.inspectType is necessary and is an instance of Array.");{const a=[...new Set(s.inspectType)];a.forEach(c=>{var d;if(!lt(d=["supervise","moderation"]).call(d,c))throw new Ae(te.INVALID_PARAMS,"".concat(c," is not a valid inspect type."))}),s.inspectType=a}if(s&&s.extraInfo&&s.extraInfo.length>1024)throw new Ae(te.INVALID_PARAMS,"inspectConfig.extraInfo length cannot exceed 1024 bytes")}(r),new Yye(r)}};var sK=l(Et.Object.getOwnPropertySymbols),Jye=Hn,Qye=fa.indexOf,Zye=Fp,yM=ie([].indexOf),oK=!!yM&&1/yM([1],1,-0)<0;Jye({target:"Array",proto:!0,forced:oK||!Zye("indexOf")},{indexOf:function(t){var r=arguments.length>1?arguments[1]:void 0;return oK?yM(this,t,r)||0:Qye(this,t,r)}});var eEe=yc("Array").indexOf,tEe=P,nEe=eEe,EM=Array.prototype,rEe=function(t){var r=t.indexOf;return t===EM||tEe(EM,t)&&r===EM.indexOf?nEe:r},aK=l(rEe);function iEe(t,r){if(t==null)return{};var s,a,c=function(h,m){if(h==null)return{};var y,v,w={},R=IH(h);for(v=0;v<R.length;v++)y=R[v],aK(m).call(m,y)>=0||(w[y]=h[y]);return w}(t,r);if(sK){var d=sK(t);for(a=0;a<d.length;a++)s=d[a],aK(r).call(r,s)>=0||Object.prototype.propertyIsEnumerable.call(t,s)&&(c[s]=t[s])}return c}let cK=class{get localCapabilities(){return qr(this._localCapabilities)}get rtpCapabilities(){return qr(this._rtpCapabilities)}get candidates(){return qr(this._candidates)}get iceParameters(){return qr(this._iceParameters)}get dtlsParameters(){return qr(this._dtlsParameters)}constructor(t){q(this,"sessionDesc",void 0),q(this,"_localCapabilities",void 0),q(this,"_rtpCapabilities",void 0),q(this,"_candidates",void 0),q(this,"_iceParameters",void 0),q(this,"_dtlsParameters",void 0),q(this,"setup",void 0),q(this,"currentMidIndex",void 0),q(this,"cname","o/i14u9pJrxRKAsu"),q(this,"firefoxSsrcMidMap",new Map),t=qr(t);const{remoteIceParameters:r,remoteDtlsParameters:s,candidates:a,remoteRTPCapabilities:c,localCapabilities:d,direction:h,setup:m,videoCodec:y,audioCodec:v}=t;let w;this.setup=m,w=h===Xo.RECEIVE_ONLY?Xa(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`):Xa(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`),this._rtpCapabilities=c,this._candidates=a,this._iceParameters=r,this._dtlsParameters=s,this._localCapabilities=d;const R=h===Xo.RECEIVE_ONLY?this.rtpCapabilities.send:this.rtpCapabilities.recv,O=h===Xo.RECEIVE_ONLY?this._localCapabilities.recv:this._localCapabilities.send,D=h===Xo.RECEIVE_ONLY?c.send.videoCodecs:Yw(bt.VIDEO,R,O,y),G=h===Xo.RECEIVE_ONLY?c.send.audioCodecs:Yw(bt.AUDIO,R,O,v);for(const j of w.mediaDescriptions)j.attributes.iceUfrag=r.iceUfrag,j.attributes.icePwd=r.icePwd,j.attributes.fingerprints=s.fingerprints,j.attributes.candidates=a,j.attributes.setup=this.setup,j.media.mediaType==="application"&&(j.attributes.sctpPort="5000"),j.media.mediaType==="video"&&(j.media.fmts=D.map(W=>W.payloadType.toString(10)),j.attributes.payloads=D,j.attributes.extmaps=R.videoExtensions),j.media.mediaType==="audio"&&(j.media.fmts=G.map(W=>W.payloadType.toString(10)),j.attributes.payloads=G,j.attributes.extmaps=R.audioExtensions,yS(j));this.sessionDesc=w,this.currentMidIndex=w.mediaDescriptions.length-1}toString(){return Qm(this.sessionDesc)}hasMid(t){return Array.isArray(t)?t.every(r=>this.hasMid(r)):this.sessionDesc.mediaDescriptions.some(r=>r.attributes.mid===t)}send(t,r,s,a,c){s=s.replace(/ /g,"-");const{ssrcs:d,ssrcGroups:h}=oy(r,this.cname,oe("SYNC_GROUP")?s:void 0),m=this.findPreloadMediaDesc(d);if(m){if(Hr()&&this.firefoxSsrcMidMap.set(d[0].ssrcId,m.attributes.mid),c&&(c.twcc||c.remb)){const y=this.sessionDesc.mediaDescriptions.indexOf(m);return this.sessionDesc.mediaDescriptions[y]=this.mungSendMediaDesc(m,c),{mid:m.attributes.mid,needExchangeSDP:!0}}return{mid:m.attributes.mid,needExchangeSDP:!1}}{const y=this.findAvailableMediaIndex(t,d,a);let v;return y===-1?(v=this.createOrRecycleSendMedia(t,d,h,"sendonly",a,c),this.updateBundleMids()):(v=qr(this.sessionDesc.mediaDescriptions[y]),v.attributes.direction="sendonly",v.attributes.ssrcs=d,v.attributes.ssrcGroups=h,this.sessionDesc.mediaDescriptions[y]=this.mungSendMediaDesc(v,c)),Hr()&&this.firefoxSsrcMidMap.set(d[0].ssrcId,v.attributes.mid),{needExchangeSDP:!0,mid:v.attributes.mid}}}stopSending(t){const r=this.sessionDesc.mediaDescriptions.filter(s=>s.attributes.mid&&t.indexOf(s.attributes.mid)!==-1);if(r.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");r.forEach(s=>{s.attributes.ssrcs=[]}),this.updateBundleMids()}receive(t,r,s){const a=[];return t.forEach(c=>{const d=c._mediaStreamTrack.kind,h=this.findAvailableRecvMediaIndex(d);let m,y=!1;h===-1?(y=!0,m=this.createOrRecycleRecvMedia(c,[],"recvonly",r,s),this.updateBundleMids()):(m=qr(this.sessionDesc.mediaDescriptions[h]),m.attributes.direction="recvonly"),a.push({mid:m.attributes.mid,needCreateTransceiver:y})}),a}stopReceiving(t){const r=this.sessionDesc.mediaDescriptions.filter(s=>t.indexOf(s.attributes.mid)!==-1);if(r.length!==t.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");r.forEach(s=>{s.media.port="0",s.attributes.direction="inactive"}),this.updateBundleMids()}addRemoteCandidate(t){const{foundation:r,protocol:s,address:a,port:c,type:d,relatedAddress:h,relatedPort:m,priority:y}=new RTCIceCandidate(t),v={foundation:r??"",componentId:"1",transport:s??"",priority:y?y+"":"",connectionAddress:a??"",port:c?c+"":"",type:d?d+"":"",relAddr:h??"",relPort:m?m+"":"",extension:{}};this.candidates.some(w=>w.priority===v.priority&&w.connectionAddress===v.connectionAddress&&w.port===v.port)||(this._candidates.push(v),this.sessionDesc.mediaDescriptions.forEach(w=>{w.attributes.candidates=this.candidates}))}clearRemoteCandidate(){this._candidates=[],this.sessionDesc.mediaDescriptions[0].attributes.candidates=this._candidates}createOrRecycleRecvMedia(t,r,s,a,c){const d=t._mediaStreamTrack.kind,h=this.rtpCapabilities.recv,m=Yw(d,h,this.localCapabilities.send,d===bt.AUDIO?c:a),y=d===bt.VIDEO?h.videoExtensions:h.audioExtensions,v="".concat(++this.currentMidIndex);let w={media:{mediaType:d,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:m.map(O=>O.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:y,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:r,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:m,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:s,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(v)}};w=this.mungRecvMediaDsec(w,t);const R=this.findFirstClosedMedia(d);if(R){const O=this.sessionDesc.mediaDescriptions.indexOf(R);this.sessionDesc.mediaDescriptions[O]=w}else this.sessionDesc.mediaDescriptions.push(w);return w}muteRemote(t){const r=this.sessionDesc.mediaDescriptions.filter(s=>lt(t).call(t,s.attributes.mid||""));if(r.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");r.forEach(s=>{s.attributes.direction="inactive"})}unmuteRemote(t){const r=this.sessionDesc.mediaDescriptions.filter(s=>lt(t).call(t,s.attributes.mid||""));if(r.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");r.forEach(s=>{s.attributes.direction="recvonly"})}findAvailableMediaIndex(t,r,s){return this.sessionDesc.mediaDescriptions.findIndex(a=>{const c=a.media.mediaType===t&&a.media.port!=="0"&&(a.attributes.direction==="sendonly"||a.attributes.direction==="sendrecv")&&a.attributes.ssrcs.length===0;if(Hr()){if(c){const d=this.firefoxSsrcMidMap.get(r[0].ssrcId);return!(d||a.attributes.mid!=="0"&&a.attributes.mid!=="1")||!(!d||d!==a.attributes.mid)}return!1}return c&&a.attributes.mid===s})}findAvailableRecvMediaIndex(t){return this.sessionDesc.mediaDescriptions.findIndex(r=>{const s=r.media.mediaType===t&&r.media.port!=="0"&&(r.attributes.direction==="recvonly"||r.attributes.direction==="sendrecv");return r.attributes.mid!=="0"&&r.attributes.mid!=="1"&&s})}predictReceivingMids(t){const r=[];for(let s=0;s<t;s++)r.push((this.currentMidIndex+s+1).toString(10));return r}restartICE(t){t=qr(t),this._iceParameters=t,this.sessionDesc.mediaDescriptions.forEach(r=>{r.attributes.iceUfrag=t.iceUfrag,r.attributes.icePwd=t.icePwd})}createOrRecycleSendMedia(t,r,s,a,c,d){const h=this.rtpCapabilities.send,m=t===bt.VIDEO?h.videoCodecs:h.audioCodecs,y=t===bt.VIDEO?h.videoExtensions:h.audioExtensions;Hr()&&(c="".concat(++this.currentMidIndex));let v={media:{mediaType:t,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:m.map(R=>R.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:y,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:r,ssrcGroups:s,rtcpFeedbackWildcards:[],payloads:m,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:a,rtcpMux:!0,rtcpRsize:!0,mid:c}};v=this.mungSendMediaDesc(v,d);const w=this.findFirstClosedMedia(t);if(w){const R=this.sessionDesc.mediaDescriptions.indexOf(w);this.sessionDesc.mediaDescriptions[R]=v}else this.sessionDesc.mediaDescriptions.push(v);return v}mungRecvMediaDsec(t,r,s){const a=qr(t);return v2(a),_S(a,r),S2(a,r),QH(a),UP(a,s,this.localCapabilities.send),a}mungSendMediaDesc(t,r){const s=qr(t);return UP(s,r,this.localCapabilities.recv),yS(s),s}updateRecvMedia(t,r){const s=this.sessionDesc.mediaDescriptions.findIndex(a=>a.attributes.mid===t);if(s!==-1){const a=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[s],r);this.sessionDesc.mediaDescriptions[s]=a}}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(t=>t.media.port!=="0").map(t=>t.attributes.mid)}findPreloadMediaDesc(t){return this.sessionDesc.mediaDescriptions.find(r=>{var s;return((s=r.attributes)===null||s===void 0||(s=s.ssrcs[0])===null||s===void 0?void 0:s.ssrcId)===t[0].ssrcId})}findFirstClosedMedia(t){return this.sessionDesc.mediaDescriptions.find(r=>Hr()?r.media.port==="0"&&r.media.mediaType===t:r.media.port==="0")}};const sEe=["sdp"];var wr;function lK(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}function fg(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?lK(Object(s),!0).forEach(function(a){q(t,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):lK(Object(s)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))})}return t}let uK=(wr=class GS extends DH{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var r,s;return(r=(s=this.peerConnection.getReceivers()[0])===null||s===void 0||(s=s.transport)===null||s===void 0?void 0:s.state)!==null&&r!==void 0?r:null}get localCodecs(){return[]}set isInRestartIce(r){this._isInRestartIce=r}get isInRestartIce(){return this._isInRestartIce}constructor(r,s,a){super(r,s),q(this,"direction",void 0),q(this,"name",void 0),q(this,"store",void 0),q(this,"spec",void 0),q(this,"peerConnection",void 0),q(this,"initialOffer",void 0),q(this,"transport",void 0),q(this,"statsFilter",void 0),q(this,"localCandidateCount",0),q(this,"_isInRestartIce",!1),q(this,"mutex",void 0),q(this,"onLocalCandidate",void 0),q(this,"remoteSDP",void 0),q(this,"pendingCandidates",[]),q(this,"localCapabilities",void 0),q(this,"isReady",!1),q(this,"restartCnt",0),q(this,"curTurnServerIndex",0),this.store=s,this.spec=r,this.mutex=new Xs("P2PConnection-mutex",s.clientId),this.peerConnection=new RTCPeerConnection(GS.resolvePCConfiguration(r,s.p2pTransport),{optional:[{googDscp:!0}]}),this.direction=a??Xo.SEND_ONLY,this.name=this.direction===Xo.SEND_ONLY?"sendP2PConnection":"recvP2PConnection",this.statsFilter=xL(this.peerConnection,oe("STATS_UPDATE_INTERVAL"),void 0,Hr()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1}async establish(r){try{const s=await e9();if(this.localCapabilities=VP(s),r){const{sdp:a}=r,c=iEe(r,sEe),d=function(){const w={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},R=qw(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"sendonly"),O={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},D={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},G={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(Lu(R,w,"videoExtensions",O,D,G),Lu(R,w,"videoCodecs",O,D,G),Lu(R,w,"audioExtensions",O,D,G),Lu(R,w,"audioCodecs",O,D,G),oe("RAISE_H264_BASELINE_PRIORITY")){const j=G.videoCodecs.findIndex(W=>W.rtpMap&&W.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&W.fmtp&&W.fmtp.parameters["profile-level-id"]==="42001f");if(j!==-1){const W=G.videoCodecs.findIndex(Q=>Q.rtpMap&&Q.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(W<j){x.debug("raising H264 baseline profile priority");const Q=G.videoCodecs[j];G.videoCodecs.splice(j,1),G.videoCodecs.splice(W,0,Q)}W!==-1&&oe("FILTER_SEND_H264_BASELINE")&&(O.videoCodecs=O.videoCodecs.filter(Q=>!(Q.rtpMap&&Q.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&Q.fmtp&&Q.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:O,recv:D,sendrecv:G}}({},{},a);this.remoteSDP=new cK({remoteIceParameters:c.iceParameters,remoteDtlsParameters:c.dtlsParameters,candidates:[],remoteRTPCapabilities:d,localCapabilities:this.localCapabilities,direction:this.direction,setup:"actpass",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()}),this.isReady=!0;const h=await this.peerConnection.createAnswer();if(!h.sdp)throw new Error("Cannot get answer sdp when trying to establish PeerConnection.");const m=rg(h.sdp);await this.peerConnection.setLocalDescription(h);const y=await t9({},{},h.sdp);this.localCapabilities=VP(y);const v=this.peerConnection.getTransceivers()[0];return v!=null&&v.receiver&&v.receiver.transport&&this.tryBindTransportEvents(v.receiver.transport),fg(fg({},m),{},{sdp:h.sdp})}{this.peerConnection.addTransceiver("video",{direction:"sendonly"}),this.peerConnection.addTransceiver("audio",{direction:"sendonly"});const a=await this.peerConnection.createOffer();if(!a.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const c=rg(a.sdp);return this.initialOffer=a,fg(fg({},c),{},{sdp:a.sdp})}}catch(s){throw new Le(te.GET_LOCAL_CONNECTION_PARAMS_FAILED,s.toString())}}async connect(r){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");await this.peerConnection.setLocalDescription(this.initialOffer);const{sdp:s,iceParameters:a,dtlsParameters:c}=r,d=await t9({},{},s);this.remoteSDP=new cK({remoteIceParameters:a,remoteDtlsParameters:c,candidates:[],remoteRTPCapabilities:d,localCapabilities:this.localCapabilities,direction:this.direction,setup:"active",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()});const h=this.peerConnection.getTransceivers()[0];h!=null&&h.sender&&h.sender.transport&&this.tryBindTransportEvents(h.sender.transport)}catch(s){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(s.toString()))}}async addRemoteCandidate(r){try{r&&this.pendingCandidates.push(r),this.peerConnection.remoteDescription&&this.isReady&&(this.pendingCandidates.forEach(s=>{this.peerConnection.addIceCandidate(s)}),this.pendingCandidates=[])}catch(s){throw new Le(te.ADD_CANDIDATE_FAILED,"P2PConnection.addRemoteCandidate failed; ".concat(s.toString()))}}send(r,s,a){var c=this;return Ll(function*(){const d=yield xn(c.mutex.lock("From P2PConnection.send"));try{if(!c.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const h=[],m=c.remoteSDP.receive(r,s,a);r.forEach((W,Q)=>{if(m[Q].needCreateTransceiver){const ee=c.peerConnection.addTransceiver(W._mediaStreamTrack,{direction:"sendonly"});h.push(ee),W._updateRtpTransceiver(ee)}else{const ee=c.peerConnection.getTransceivers().find(fe=>fe.mid===m[Q].mid);if(!ee)throw new Error("cannot find transceiver when sendPeerconnection send, mid is ".concat(m[Q].mid));h.push(ee),W._updateRtpTransceiver(ee)}}),Hr()&&oe("SIMULCAST")===!0&&(yield xn(c.applySimulcastForFirefox(h,r)));const y=m.map(W=>W.mid),v=yield xn(c.peerConnection.createOffer()),w=c.mungSendOfferSDP(v.sdp,r,y),R=Xa(w),O=y.map(W=>{const Q=R.mediaDescriptions.find(ee=>ee.attributes.mid===W);if(!Q)throw new Error("Cannot extract ssrc from mediaDescription.");return YH(Q,oe("USE_PUB_RTX"))}),D=h.map((W,Q)=>{const ee=y[Q];return{localSSRC:O[Q],id:ee}});yield xn(c.peerConnection.setLocalDescription({type:"offer",sdp:w}));try{yield D}catch(W){const Q=c.remoteSDP.toString();throw yield xn(c.peerConnection.setLocalDescription({type:"offer",sdp:w})),yield xn(c.peerConnection.setRemoteDescription({type:"answer",sdp:Q})),yield xn(c.stopSending(y,!0)),W}yield xn(c.applySimulcastEncodings(h,r)),yield xn(c.applySendEncodings(h,r));const G=c.remoteSDP.toString(),j=c.logSDPExchange(w,"offer","local","send");return j==null||j(G),yield xn(c.setRemoteDescription({type:"answer",sdp:G})),h.map((W,Q)=>{const ee=y[Q];return{localSSRC:O[Q],id:ee}})}catch(h){throw h instanceof Le?h:new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(h.toString()))}finally{d()}})()}async stopSending(r,s){const a=s?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const c=this.peerConnection.getTransceivers().filter(y=>r.indexOf(y.mid)!==-1);if(c.length!==r.length)throw new Error("Transceivers' length (".concat(c.length,") doesn't match mids' length (").concat(r.length,") when trying to call P2PConnection.stopSending."));c.map(y=>{var v;y.direction="inactive",(v=y.stop)===null||v===void 0||v.call(y)});const d=await this.peerConnection.createOffer(),h=this.logSDPExchange(d.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(d),this.remoteSDP.stopReceiving(r);const m=this.remoteSDP.toString();h==null||h(m),await this.setRemoteDescription({type:"answer",sdp:m})}catch(c){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(c.toString()))}finally{a&&a()}}async receive(r,s,a,c){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(r," before remoteSDP created."));const{mid:d,needExchangeSDP:h}=this.remoteSDP.send(r,s,a,c);if(h){const y=this.remoteSDP.toString(),v=this.logSDPExchange(y,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:y});const w=await this.peerConnection.createAnswer(),R=this.mungReceiveAnswerSDP(w.sdp,d,r);v==null||v(R||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:R}),x.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(r," by exchanging SDP."))}else x.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(r," no need to exchange SDP."));const m=this.peerConnection.getTransceivers().find(y=>y.mid===d);if(!m||m.mid===null)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:m.receiver.track,mid:m.mid,transceiver:m}}catch(d){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(d.toString()))}}async mockReceive(r,s,a,c){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(r," before remoteSDP created."));const{mid:d,needExchangeSDP:h}=this.remoteSDP.send(r,s,a,c);if(h){const m=this.remoteSDP.toString(),y=this.logSDPExchange(m,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:m});const v=await this.peerConnection.createAnswer(),w=this.mungReceiveAnswerSDP(v.sdp,d,r);y==null||y(w||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:w}),x.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(r," by exchanging SDP."))}else x.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(r," no need to exchange SDP."))}catch(d){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(d.toString()))}}async stopReceiving(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(r);const s=this.remoteSDP.toString(),a=this.logSDPExchange(s,"offer","remote","stopReceiving");await this.setRemoteDescription({type:"offer",sdp:s});const c=await this.peerConnection.createAnswer();a==null||a(c.sdp||""),await this.peerConnection.setLocalDescription(c)}catch(s){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(s.toString()))}}async restartICE(r){try{if(this.store.p2pTransport===Q_.Auto&&(this.store.p2pTransport=Q_.SdRtn,Wn().supportPCSetConfiguration&&this.peerConnection.setConfiguration(GS.resolvePCConfiguration(this.spec,this.store.p2pTransport))),this.restartCnt>3&&(this.restartCnt=0,Wn().supportPCSetConfiguration&&this.peerConnection.setConfiguration(GS.resolvePCConfiguration(this.spec,this.store.p2pTransport,++this.curTurnServerIndex))),!r){this.restartCnt++,this.isReady=!1;const s=await this.peerConnection.createOffer({iceRestart:!0});if(!s.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const{iceParameters:a}=rg(s.sdp);return this.store.descriptionStart(),this.direction===Xo.SEND_ONLY&&await this.peerConnection.setLocalDescription(s),a}if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");if(this.remoteSDP.restartICE(r),this.store.descriptionStart(),this.direction===Xo.RECEIVE_ONLY){this.restartCnt++,await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()});const s=await this.peerConnection.createAnswer();if(!s.sdp)throw new Error("Cannot get answer sdp when trying to iceRestart.");const{iceParameters:a}=rg(s.sdp);return await this.peerConnection.setLocalDescription(s),a}await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()}),this.isReady=!0}catch(s){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(s.toString()))}}close(){var r;this.peerConnection.close(),this.peerConnection.onicecandidate=null,(r=this.onConnectionStateChange)===null||r===void 0||r.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.transport=void 0,this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(r){return this.statsFilter.getVideoIsReady(r)}async updateEncoderConfig(r,s){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const a=await this.peerConnection.createOffer(),c=this.mungSendOfferSDP(a.sdp,[s],[r]);this.remoteSDP.updateRecvMedia(r,s);const d=this.remoteSDP.toString(),h=this.logSDPExchange(c,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:c}),h==null||h(d),await this.peerConnection.setRemoteDescription({type:"answer",sdp:d})}catch(a){throw new Le(te.EXCHANGE_SDP_FAILED,a.toString())}}async updateSendParameters(r,s){const a=this.peerConnection.getTransceivers().filter(c=>c.mid===r);a.length===1&&(this.isVP8Simulcast(s)?Hr()||await this.applySimulcastEncodings(a,[s]):await this.applySendEncodings(a,[s]))}setStatsRemoteVideoIsReady(r,s){this.statsFilter.setVideoIsReady2(r,s)}async replaceTrack(r,s){const a=this.peerConnection.getTransceivers().find(c=>c.mid===s);a&&await a.sender.replaceTrack(r._mediaStreamTrack)}async getSelectedCandidatePair(){const r=this.peerConnection.getReceivers();if(r.length>0&&r[0].transport&&r[0].transport.iceTransport&&r[0].transport.iceTransport.getSelectedCandidatePair&&r[0].transport.iceTransport.getSelectedCandidatePair()){const s=r[0].transport.iceTransport,{local:a,remote:c}=s.getSelectedCandidatePair();return{local:fg(fg({},Nh),{},{candidateType:a.type,protocol:a.protocol,address:a.address,port:a.port}),remote:fg(fg({},Nh),{},{candidateType:c.type,protocol:c.protocol,address:c.address,port:c.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var r,s;lt(r=["connected","completed"]).call(r,this.peerConnection.iceConnectionState)&&(this.isReady=!1),(s=this.onICEConnectionStateChange)===null||s===void 0||s.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var r;this.peerConnection.connectionState==="connected"&&(this.restartCnt=0),(r=this.onConnectionStateChange)===null||r===void 0||r.call(this,this.peerConnection.connectionState)},this.startICECandidate()}startICECandidate(){this.peerConnection.onicecandidate||(this.localCandidateCount=0,this.peerConnection.onicecandidate=r=>{if(r.candidate){var s;r.candidate.candidate&&((s=this.onLocalCandidate)===null||s===void 0||s.call(this,r.candidate.toJSON())),this.localCandidateCount+=1}else x.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount)})}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(r,s){let a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const c={iceServers:[]};var d;return r.iceServers?c.iceServers=r.iceServers:r.turnServer&&r.turnServer.mode!=="off"&&(Lw(r.turnServer.servers)?c.iceServers=r.turnServer.servers:(c.iceServers&&c.iceServers.push(...GS.turnServerConfigToIceServers(r.turnServer.servers,s,a)),oe("USE_TURN_SERVER_OF_GATEWAY")&&c.iceServers&&r.turnServer.serversFromGateway&&c.iceServers.push(...GS.turnServerConfigToIceServers(r.turnServer.serversFromGateway,s,a)),lt(d=[Q_.Relay,Q_.SdRtn]).call(d,s)&&(c.iceTransportPolicy="relay"),oe("FORCE_TURN_TCP")?c.iceTransportPolicy="relay":r.turnServer.servers.concat(r.turnServer.serversFromGateway||[]).forEach(h=>{h.forceturn&&(c.iceTransportPolicy="relay")}))),oe("ENABLE_ENCODED_TRANSFORM")&&Wn().supportWebRTCEncodedTransform&&(c.encodedInsertableStreams=!0),x.debug("P2PConnection p2pTransport is ".concat(s)),c}static turnServerConfigToIceServers(r,s){let a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const c=[],d=r.filter(m=>m.tcpport);x.debug("P2PConnection turnServers is ".concat(d,", current index is ").concat(a));const h=d.length>a?d[a]:d[0];switch(s){case Q_.SdRtn:const m=r.filter(v=>{var w;return lt(w=v.username).call(w,"glb:")&&v.turnServerURL==v.turnServerURL}),y=m.length>a?m[a]:m[0];y&&(c.push({username:y.username,credential:y.password,credentialType:"password",urls:"turn:".concat(tg(y.turnServerURL),":").concat(y.tcpport,"?transport=udp")}),c.push({username:y.username,credential:y.password,credentialType:"password",urls:"turns:".concat(tg(y.turnServerURL),":").concat(y.tcpport,"?transport=tcp")}));break;case Q_.Relay:h&&(c.push({username:h.username,credential:h.password,credentialType:"password",urls:"turn:".concat(h.turnServerURL,":").concat(h.tcpport,"?transport=udp")}),c.push({username:h.username,credential:h.password,credentialType:"password",urls:"turns:".concat(tg(h.turnServerURL),":").concat(h.tcpport,"?transport=tcp")}));break;default:h&&(c.push({username:h.username,credential:h.password,credentialType:"password",urls:"turn:".concat(h.turnServerURL,":").concat(h.tcpport,"?transport=udp")}),c.push({username:h.username,credential:h.password,credentialType:"password",urls:"turns:".concat(tg(h.turnServerURL),":").concat(h.tcpport,"?transport=tcp")}),c.push({username:h.username,credential:h.password,credentialType:"password",urls:"stun:".concat(h.turnServerURL,":").concat(h.tcpport)}))}return c}tryBindTransportEvents(r){if(r){this.transport=r,r.onstatechange=()=>{var a;r!=null&&r.state&&((a=this.onDTLSTransportStateChange)===null||a===void 0||a.call(this,r.state))},r.onerror=a=>{var c;(c=this.onDTLSTransportError)===null||c===void 0||c.call(this,"error"in a?a.error:a)};const s=r.iceTransport;s&&(s.onstatechange=()=>{const a=r==null?void 0:r.iceTransport.state;var c;a&&((c=this.onICETransportStateChange)===null||c===void 0||c.call(this,a))},s.getSelectedCandidatePair&&(s.onselectedcandidatepairchange=()=>{if(s.getSelectedCandidatePair()){const{local:a,remote:c}=s.getSelectedCandidatePair();x.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:a.type,protocol:a.protocol}),", remote ").concat(JSON.stringify({candidateType:c.type,protocol:c.protocol,address:c.address,port:c.port})," )"))}}))}}tryUnbindTransportEvents(){this.transport&&(this.transport.onstatechange=null,this.transport.onerror=null,this.transport.iceTransport&&(this.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(r,s){var a;if(s||(s=this.peerConnection.getSenders().find(w=>w.track===r._mediaStreamTrack)),!s)return x.warn("[".concat(r.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(r))return x.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!Wn().supportSetRtpSenderParameters)return x.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const c={},d={};switch(r._optimizationMode){case"motion":c.degradationPreference="maintain-framerate";break;case"detail":c.degradationPreference="maintain-resolution";break;default:c.degradationPreference="balanced"}if(r._encoderConfig){var h;const{bitrateMax:w,frameRate:R,scaleResolutionDownBy:O}=r._encoderConfig;w&&(d.maxBitrate=1e3*w),lt(h=r._hints).call(h,gr.LOW_STREAM)&&(R&&(d.maxFramerate=Ic(R)),O&&O>=1&&(d.scaleResolutionDownBy=O))}if(oe("DSCP_TYPE")&&pf()){var m;const w=oe("DSCP_TYPE");lt(m=["very-low","low","medium","high"]).call(m,w)&&(d.networkPriority=w)}const y=s.getParameters(),v=(a=y.encodings)===null||a===void 0?void 0:a[0];Hr()&&!v&&(c.encodings=[d]),v&&Object.assign(v,d),Object.assign(y,c),x.debug("[".concat(r.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(y.encodings))),await s.setParameters(y)}async applySendEncodings(r,s){try{if(!Wn().supportSetRtpSenderParameters||r.length!==s.length)return;for(let a=0;a<r.length;a++){const c=r[a],d=s[a];d instanceof Ir&&!this.isVP8Simulcast(d)&&await this.updateRtpSenderEncodings(d,c.sender)}}catch{x.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(r,s,a){const c=Xa(r);return s.forEach((d,h)=>{const m=a[h],y=c.mediaDescriptions.find(v=>v.attributes.mid===m);y&&(_S(y,d),ZH(y,d,this.store.codec))}),Qm(c)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=r=>{var s;(s=this.onFirstAudioReceived)===null||s===void 0||s.call(this,r)},this.statsFilter.onFirstVideoReceived=r=>{var s;(s=this.onFirstVideoReceived)===null||s===void 0||s.call(this,r)},this.statsFilter.onFirstAudioDecoded=r=>{var s;(s=this.onFirstAudioDecoded)===null||s===void 0||s.call(this,r)},this.statsFilter.onFirstVideoDecoded=(r,s,a)=>{var c;(c=this.onFirstVideoDecoded)===null||c===void 0||c.call(this,r,s,a)},this.statsFilter.onSelectedLocalCandidateChanged=(r,s)=>{var a;(a=this.onSelectedLocalCandidateChanged)===null||a===void 0||a.call(this,r,s)},this.statsFilter.onSelectedRemoteCandidateChanged=(r,s)=>{var a;(a=this.onSelectedRemoteCandidateChanged)===null||a===void 0||a.call(this,r,s)},this.statsFilter.onFirstVideoDecodedTimeout=r=>{var s;(s=this.onFirstVideoDecodedTimeout)===null||s===void 0||s.call(this,r)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(r,s){if(r.length===s.length)for(let y=0;y<r.length;y++){var a,c,d,h,m;const v=r[y],w=s[y];if(w instanceof Ir&&!lt(a=w._hints).call(a,gr.LOW_STREAM)&&(c=w._encoderConfig)!==null&&c!==void 0&&c.bitrateMax&&((d=w._encoderConfig)===null||d===void 0?void 0:d.bitrateMax)>200&&(h=w._scalabilityMode)!==null&&h!==void 0&&h.numSpatialLayers&&((m=w._scalabilityMode)===null||m===void 0?void 0:m.numSpatialLayers)>1&&this.store.codec==="vp8"){const R={},O={high:1e3*(w._encoderConfig.bitrateMax-50),medium:5e4};R.encodings=[{rid:"m",active:!0,maxBitrate:O.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:O.high}];const D=v.sender.getParameters();await v.sender.setParameters(Object.assign(D,R))}}}async applySimulcastEncodings(r,s){if(!Hr()&&r.length===s.length)for(let a=0;a<r.length;a++){const c=s[a];if(c instanceof Ir&&this.isVP8Simulcast(c)){const d=r[a],h={},m={high:1e3*(c._encoderConfig.bitrateMax-50),medium:5e4};h.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:m.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:m.medium,scaleResolutionDownBy:4}];const y=d.sender.getParameters();await d.sender.setParameters(Object.assign(y,h))}}}isVP8Simulcast(r){var s,a,c,d,h;return!!(r instanceof Ir&&oe("SIMULCAST")&&this.store.codec==="vp8"&&!lt(s=r._hints).call(s,gr.LOW_STREAM)&&(a=r._encoderConfig)!==null&&a!==void 0&&a.bitrateMax&&((c=r._encoderConfig)===null||c===void 0?void 0:c.bitrateMax)>200&&(d=r._scalabilityMode)!==null&&d!==void 0&&d.numSpatialLayers&&((h=r._scalabilityMode)===null||h===void 0?void 0:h.numSpatialLayers)>1)}logSDPExchange(r,s,a,c){if(oe("SDP_LOGGING"))return x.upload("[".concat(this.store.clientId,"] exchanging ").concat(a," ").concat(s," SDP during P2PConnection.").concat(c,`
`),r),s==="offer"?d=>{this.logSDPExchange(d,"answer",a==="local"?"remote":"local",c)}:void 0}async muteLocal(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const s=this.peerConnection.getTransceivers().filter(h=>h.mid&&r.indexOf(h.mid)!==-1);if(s.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length.");s.map(h=>{h.direction="inactive"});const a=await this.peerConnection.createOffer(),c=this.logSDPExchange(a.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(a),this.remoteSDP.muteRemote(r);const d=this.remoteSDP.toString();c==null||c(d),await this.setRemoteDescription({type:"answer",sdp:d})}catch(s){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(s.toString()))}}async unmuteLocal(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const s=this.peerConnection.getTransceivers().filter(h=>h.mid&&r.indexOf(h.mid)!==-1);if(s.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length.");s.map(async h=>{h.direction="sendonly"});const a=await this.peerConnection.createOffer(),c=this.logSDPExchange(a.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(a),this.remoteSDP.unmuteRemote(r);const d=this.remoteSDP.toString();c==null||c(d),await this.setRemoteDescription({type:"answer",sdp:d})}catch(s){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(s.toString()))}}async getRemoteSSRC(r,s){var a,c;if(s=(a=s)!==null&&a!==void 0?a:(c=this.currentRemoteDescription)===null||c===void 0?void 0:c.sdp){var d;const h=(d=Xa(s).mediaDescriptions.find(m=>m.attributes.mid===r))===null||d===void 0?void 0:d.attributes.ssrcs;return h==null?void 0:h[0].ssrcId}}async setRemoteDescription(r){var s;await this.peerConnection.setRemoteDescription(r),lt(s=["connected","completed"]).call(s,this.peerConnection.iceConnectionState)||(this.isReady=!0,this.addRemoteCandidate())}mungReceiveAnswerSDP(r,s,a){const c=Xa(r),d=c.mediaDescriptions.find(h=>h.attributes.mid===s);return d&&a===bt.AUDIO&&d.media.mediaType==="audio"&&yS(d),Qm(c)}},At(wr.prototype,"establish",[Fu],Object.getOwnPropertyDescriptor(wr.prototype,"establish"),wr.prototype),At(wr.prototype,"connect",[Fu],Object.getOwnPropertyDescriptor(wr.prototype,"connect"),wr.prototype),At(wr.prototype,"receive",[Fu],Object.getOwnPropertyDescriptor(wr.prototype,"receive"),wr.prototype),At(wr.prototype,"mockReceive",[Fu],Object.getOwnPropertyDescriptor(wr.prototype,"mockReceive"),wr.prototype),At(wr.prototype,"stopReceiving",[Fu],Object.getOwnPropertyDescriptor(wr.prototype,"stopReceiving"),wr.prototype),At(wr.prototype,"restartICE",[Fu],Object.getOwnPropertyDescriptor(wr.prototype,"restartICE"),wr.prototype),At(wr.prototype,"close",[Fu],Object.getOwnPropertyDescriptor(wr.prototype,"close"),wr.prototype),At(wr.prototype,"updateEncoderConfig",[Fu],Object.getOwnPropertyDescriptor(wr.prototype,"updateEncoderConfig"),wr.prototype),At(wr.prototype,"updateSendParameters",[Fu],Object.getOwnPropertyDescriptor(wr.prototype,"updateSendParameters"),wr.prototype),At(wr.prototype,"replaceTrack",[Fu],Object.getOwnPropertyDescriptor(wr.prototype,"replaceTrack"),wr.prototype),At(wr.prototype,"muteLocal",[Fu],Object.getOwnPropertyDescriptor(wr.prototype,"muteLocal"),wr.prototype),At(wr.prototype,"unmuteLocal",[Fu],Object.getOwnPropertyDescriptor(wr.prototype,"unmuteLocal"),wr.prototype),wr);function Fu(t,r,s){const a=t[r];if(typeof a!="function")throw new Error("Cannot use mutex on object property.");return s.value=async function(){const c=this.mutex,d=await c.lock("From P2PConnection.".concat(r));try{for(var h=arguments.length,m=new Array(h),y=0;y<h;y++)m[y]=arguments[y];return await a.apply(this,m)}finally{d()}},s}let Vd=function(t){return t.SEND_ONLY="SEND_ONLY",t.RECEIVE_ONLY="RECEIVE_ONLY",t}({});var dK,hK,pK,fK,mK,gK,_K,yK,EK,vK,SK,Vr;function bK(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}function vO(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?bK(Object(s),!0).forEach(function(a){q(t,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):bK(Object(s)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))})}return t}let oEe=(dK=jd(Vd.SEND_ONLY),hK=jd(Vd.SEND_ONLY),pK=jd(),fK=jd(Vd.RECEIVE_ONLY),mK=jd(Vd.RECEIVE_ONLY),gK=jd(Vd.RECEIVE_ONLY),_K=jd(Vd.RECEIVE_ONLY),yK=jd(Vd.RECEIVE_ONLY),EK=jd(Vd.RECEIVE_ONLY),vK=jd(),SK=jd(Vd.RECEIVE_ONLY),Vr=class extends Br{get state(){return this._state}set state(t){const r=this._state;this._state=t,this.emit(jt.StateChange,r,this._state)}constructor(t,r){super(),q(this,"isPlanB",!1),q(this,"store",void 0),q(this,"statsUploader",void 0),q(this,"sendConnection",void 0),q(this,"recvConnection",void 0),q(this,"localTrackMap",new Map),q(this,"remoteUserMap",new Map),q(this,"localDataChannels",[]),q(this,"pendingLocalTracks",[]),q(this,"pendingRemoteTracks",[]),q(this,"statsCollector",void 0),q(this,"dtlsFailedCount",0),q(this,"sendMutex",void 0),q(this,"recvMutex",void 0),q(this,"_state",Jn.Disconnected),q(this,"_restartStates",["disconnected","failed"]),q(this,"reconnectInterval",void 0),q(this,"uploadUnplinkStarted",!1),q(this,"uploadDownlinkStarted",!1),q(this,"uplinkStateUploadInterval",void 0),q(this,"downlinkStatsUploadInterval",void 0),q(this,"handleMuteLocalTrack",async(s,a,c)=>{const d=await this.sendMutex.lock("Locking from P2PChannel2.handleMuteLocalTrack");try{if(!this.sendConnection||this.state!==Jn.Connected)return void c(new Le(te.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established."));const y=this.filterTobeMutedTracks(s);if(y.length===0)return void a();const v=y.find(D=>D[0]==="videoLowTrack");v&&v[1].track._originMediaStreamTrack.stop(),await this.sendConnection.muteLocal(y.map(D=>{let[,{id:G}]=D;return G}));let w=!1;var h,m;s.trackMediaType==="video"?w=!((h=this.localTrackMap.get(Xe.LocalAudioTrack))===null||h===void 0||!h.track._muted):w=((m=this.localTrackMap.get(Xe.LocalVideoTrack))===null||m===void 0?void 0:m.id)===void 0;const R=this.createMuteMessage(y);await fr(this,jt.RequestMuteLocal,R);const O=s.trackMediaType==="video"?eg.MUTE_LOCAL_VIDEO:eg.MUTE_LOCAL_AUDIO;await fr(this,jt.RequestP2PMuteLocal,{action:O,message:R,isMuteAll:w}),a()}catch(y){c(y)}finally{d()}}),q(this,"handleUnmuteLocalTrack",async(s,a,c)=>{const d=await this.sendMutex.lock("Locking from P2PChannel2.handleUnmuteLocalTrack");try{if(!this.sendConnection||this.state!==Jn.Connected)return void c(new Le(te.INVALID_OPERATION,"Cannot call P2PChannel2.handleUnmuteLocalTrack before sendConnection established."));const h=this.filterTobeUnmutedTracks(s);if(h.length===0)return void a();await this.sendConnection.unmuteLocal(h.map(v=>{let[,{id:w}]=v;return w}));const m=this.createUnmuteMessage(h),y=s.trackMediaType==="video"?eg.UNMUTE_LOCAL_VIDEO:eg.UNMUTE_LOCAL_AUDIO;await fr(this,jt.RequestP2PMuteLocal,{action:y,message:m}),a()}catch(h){c(h)}finally{d()}}),q(this,"handleUpdateVideoEncoder",async(s,a,c,d)=>{let h;typeof d=="boolean"&&d||(h=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoEncoder"));try{const y=this.localTrackMap.get(Xe.LocalVideoTrack);if(!this.sendConnection||!y||y.track!==s||this.state!==Jn.Connected)return void a();const{id:v,track:w}=y;v&&(await this.sendConnection.updateSendParameters(v,w),await this.sendConnection.updateEncoderConfig(v,w),this.emit(jt.UpdateVideoEncoder,w)),a()}catch(y){c(y)}finally{var m;(m=h)===null||m===void 0||m()}}),q(this,"handleUpdateVideoSendParameters",async(s,a,c)=>{const d=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoSendParameters");try{const h=this.localTrackMap.get(Xe.LocalVideoTrack);if(!this.sendConnection||!h||h.track!==s||this.state!==Jn.Connected)return void a();const{id:m,track:y}=h;m&&await this.sendConnection.updateSendParameters(m,y),a()}catch(h){c(h)}finally{d()}}),q(this,"handleReplaceTrack",async(s,a,c,d)=>{let h;x.debug("[".concat(this.store.clientId,"] P2PChannel2 handleReplaceTrack for [track-id-").concat(s.getTrackId(),"]")),typeof d=="boolean"&&d||(h=await this.sendMutex.lock("From P2PChannel2.handleReplaceTrack"));try{var m;const v=Array.from(this.localTrackMap.entries()).find(w=>{let[,{track:R}]=w;return s===R});if(!this.sendConnection||!v||v[1].id===void 0||this.state!==Jn.Connected)return void a();if(await((m=this.sendConnection)===null||m===void 0?void 0:m.replaceTrack(s,v[1].id)),v[0]===Xe.LocalVideoTrack&&Wn().supportDualStreamEncoding){const w=this.localTrackMap.get(Xe.LocalVideoLowTrack);if(w){const R=s._mediaStreamTrack.clone();w.track._originMediaStreamTrack.stop(),w.track._mediaStreamTrack=R,w.track._originMediaStreamTrack=R,await new pt((O,D)=>{this.handleReplaceTrack(w.track,O,D,!0)})}}a()}catch(v){c(v)}finally{var y;(y=h)===null||y===void 0||y()}}),q(this,"handleGetLocalVideoStats",s=>{s(this.statsCollector.getLocalVideoTrackStats())}),q(this,"handleGetLocalAudioStats",s=>{s(this.statsCollector.getLocalAudioTrackStats())}),q(this,"handleGetRemoteVideoStats",s=>this.statsCollector.getRemoteVideoTrackStats(s.uid)[s.uid]),q(this,"handleGetRemoteAudioStats",s=>this.statsCollector.getRemoteAudioTrackStats(s.uid)[s.uid]),this.store=t,this.statsCollector=r,this.statsCollector.addP2PChannel(this),this.statsUploader=new F9(t),this.bindStatsUploaderEvents(),this.sendMutex=new Xs("P2PChannel2-send-mutex",t.clientId),this.recvMutex=new Xs("P2PChannel2-recv-mutex",t.clientId),this.reconnectInterval=window.setInterval(()=>{[this.sendConnection,this.recvConnection].forEach(s=>{s&&(s.iceConnectionState!=="disconnected"&&s.iceConnectionState!=="failed"||this.handleDisconnect(s.direction))})},oe("ICE_RESTART_INTERVAL"))}async startP2PConnection(t,r){throw new Le(te.NOT_SUPPORTED,"p2p mode does not support startP2PConnection.")}async connect(t){throw new Le(te.NOT_SUPPORTED,"p2p mode does not support connect.")}async startP2P(t,r){let s;try{if(r){this.recvConnection&&(x.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset recvConnection.")),this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection)),s=await this.recvMutex.lock("From P2PChannel.startP2P"),this.recvConnection=new uK(t,this.store,Xo.RECEIVE_ONLY),this.bindConnectionEvents(this.recvConnection);const a=await this.recvConnection.establish(r);return{iceParameters:a.iceParameters,dtlsParameters:a.dtlsParameters,sdp:a.sdp}}{this.state=Jn.New,this.sendConnection&&(x.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset sendConnection.")),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection)),s=await this.sendMutex.lock("From P2PChannel.startP2P"),this.sendConnection=new uK(t,this.store),this.store.peerConnectionStart(),this.bindConnectionEvents(this.sendConnection);const a=await this.sendConnection.establish();return{iceParameters:a.iceParameters,dtlsParameters:a.dtlsParameters,sdp:a.sdp}}}finally{s&&s()}}async p2pConnect(t){if(!this.sendConnection)throw new Le(te.UNEXPECTED_ERROR,"Cannot P2PChannel2.p2pConnect before P2PChannel2.startP2PConnection .");this.store.peerConnectionStart(),await this.sendConnection.connect(t),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=Jn.Connected}async addRemoteCandidate(t,r){if(r===Xo.RECEIVE_ONLY){if(!this.sendConnection)throw new Le(te.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.sendConnection.addRemoteCandidate(t)}else{if(!this.recvConnection)throw new Le(te.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.recvConnection.addRemoteCandidate(t)}}publish(t,r,s){var a=this;return Ll(function*(){const c=yield xn(a.sendMutex.lock("From P2PChannel.publish"));try{if(!a.sendConnection||a.state!==Jn.Connected){a.throwIfTrackTypeNotMatch(t);const v=t.filter(w=>a.pendingLocalTracks.indexOf(w)===-1);return void(a.pendingLocalTracks=a.pendingLocalTracks.concat(v))}a.store.pubId=a.store.pubId+1,Zs.markPublishStart(a.store.clientId,a.store.pubId);const d=a.filterTobePublishedTracks(t,r,s);if(d.length===0)return void(yield xn(a.tryToUnmuteAudio(t)));d.forEach(v=>{let{track:w,type:R}=v;const O=Date.now();a.store.publish(w.getTrackId(),R===Xe.LocalAudioTrack?"audio":"video",O)}),a.bindLocalTrackEvents(d);const h=yield xn(a.sendConnection.send(d.map(v=>{let{track:w}=v;return w}),a.store.codec,a.store.audioCodec)),m=(yield xn(h.next())).value,y=a.createGatewayPublishMessage(d,m);try{yield y}catch(v){throw h.throw(v),(v==null?void 0:v.code)===te.WS_ABORT&&d.forEach(w=>{let{track:R}=w;a.pendingLocalTracks.indexOf(R)===-1&&a.pendingLocalTracks.push(R)}),a.unbindLocalTrackEvents(d),v}yield xn(h.next()),d.forEach(v=>{let{type:w}=v;a.statsCollector.addLocalStats(w)}),a.statsUploader.startUploadOutboundStats(),a.assignLocalTracks(d,m),d.forEach(v=>{let{track:w,type:R}=v;const O=Date.now();a.store.publish(w.getTrackId(),R===Xe.LocalAudioTrack?"audio":"video",void 0,O)}),a.startUploadUplinkState()}finally{c()}})()}async unpublish(t){if(!this.sendConnection||this.state!==Jn.Connected)return void(t.length===0?this.pendingLocalTracks.length=0:this.pendingLocalTracks=this.pendingLocalTracks.filter(c=>!lt(t).call(t,c)));const r=this.filterTobeUnpublishedTracks(t);if(r.length===0)return;const s=r.find(c=>c[0]==="videoLowTrack");s&&s[1].track.close();const a=this.createGatewayUnpublishMessage(r);if(await this.sendConnection.stopSending(r.map(c=>{let[,{id:d}]=c;return d})),this.withdrawLocalTracks(r),this.unbindLocalTrackEvents(r.map(c=>{let[d,{track:h}]=c;return{type:d,track:h}})),r.forEach(c=>{let[d]=c;this.statsCollector.removeLocalStats(d)}),this.localTrackMap.size===0&&(this.statsUploader.stopUploadOutboundStats(),this.stopUploadUplinkState()),this.sendConnection&&this.state===Jn.Connected)return s&&s[1].track.close(),a;t.forEach(c=>{const d=this.pendingLocalTracks.indexOf(c);d!==-1&&this.pendingLocalTracks.splice(d,1)})}startUploadUplinkState(){if(this.uploadUnplinkStarted)return;this.uploadUnplinkStarted=!0,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval);const t=()=>{const r=[],s=[];Array.from(this.localTrackMap.entries()).forEach(a=>{let[c,{track:d,ssrcs:h}]=a;const m={stream_type:Jge(d,c),ssrcs:h};d._muted||!d._enabled?r.push(m):s.push(m)}),r.length>0&&r.forEach(a=>{fr(this,jt.RequestMuteLocal,[a])}),s.length>0&&s.forEach(a=>{fr(this,jt.RequestUnmuteLocal,[a])})};t(),this.uplinkStateUploadInterval=window.setInterval(()=>{t()},3e3)}stopUploadUplinkState(){this.uploadUnplinkStarted&&(this.uploadUnplinkStarted=!1,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval))}publishLowStream(t){return Ll(function*(){throw new Le(te.NOT_SUPPORTED,"p2p mode does not support publishLowStream.")})()}async republish(){this.pendingLocalTracks.length>0&&(x.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await Ms(this,jt.RequestRePublish,this.pendingLocalTracks),this.emit(jt.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[])}async unpublishLowStream(){throw new Le(te.NOT_SUPPORTED,"p2p mode does not support unpublishLowStream.")}async subscribe(t,r,s,a){var c;if(!this.recvConnection)throw new Le(te.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");if((c=this.remoteUserMap.get(t))!==null&&c!==void 0&&c.has(r))return;const{track:d,mid:h,transceiver:m}=await this.recvConnection.receive(r,[{ssrcId:s}],String(t.uid),a);r===bt.AUDIO?(t._audioTrack?t._audioTrack._updateOriginMediaStreamTrack(d):(t._audioTrack=new lS(d,t.uid,t._uintid,this.store),x.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(t._audioTrack.getTrackId()))),m&&t._audioTrack._updateRtpTransceiver(m),this.bindRemoteTrackEvents(t,t._audioTrack)):(t._videoSSRC=s,t._videoTrack?t._videoTrack._updateOriginMediaStreamTrack(d):(t._videoTrack=new cS(d,t.uid,t._uintid,this.store),x.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(t._videoTrack.getTrackId()))),m&&t._videoTrack._updateRtpTransceiver(m),this.bindRemoteTrackEvents(t,t._videoTrack));const y=this.remoteUserMap.get(t);y?y.set(r,h):this.remoteUserMap.set(t,new Map([[r,h]])),this.statsCollector.addRemoteStats(t.uid),this.statsUploader.startUploadInboundStats(),this.startUploadDownlinkState();const v=this.pendingRemoteTracks.findIndex(w=>{let{user:R,kind:O}=w;return R.uid===t.uid&&r===O});v!==-1&&(this.pendingRemoteTracks.splice(v,1),this.emit(jt.MediaReconnectEnd,t.uid))}async mockSubscribe(t,r,s,a){if(!this.recvConnection)throw new Le(te.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");await this.recvConnection.mockReceive(r,[{ssrcId:s}],String(t.uid),a)}async unsubscribe(t,r,s){const a=this.pendingRemoteTracks.filter(d=>{let{user:h,kind:m}=d;return r!==void 0?h.uid===t.uid&&r===m:h.uid===t.uid});if(a.forEach(d=>{const h=this.pendingRemoteTracks.indexOf(d);this.pendingRemoteTracks.splice(h,1)}),this.recvConnection||s||a.forEach(d=>{let{kind:h}=d;var m;if(h===bt.AUDIO)(m=t._audioTrack)===null||m===void 0||m._destroy(),t._audioTrack=void 0;else if(h===bt.VIDEO){var y;(y=t._videoTrack)===null||y===void 0||y._destroy(),t._videoTrack=void 0}}),!this.recvConnection)return;const c=this.filterTobeUnSubscribedTracks(t,r);c.length!==0&&(await this.recvConnection.stopReceiving(c.map(d=>{let[,{id:h}]=d;return h})),this.withdrawRemoteTracks(c),this.remoteUserMap.size===0&&(this.statsUploader.stopUploadInboundStats(),this.stopUploadDownlinkState()),c.forEach(d=>{let[h,{kind:m}]=d;var y,v;if(m===bt.VIDEO&&h._videoSSRC&&((y=this.recvConnection)===null||y===void 0||y.setStatsRemoteVideoIsReady(h._videoSSRC,!1)),m===bt.VIDEO)this.unbindRemoteTrackEvents(h._videoTrack),s||((v=h._videoTrack)===null||v===void 0||v._destroy(),h._videoTrack=void 0);else if(m===bt.AUDIO){var w;this.unbindRemoteTrackEvents(h._audioTrack),!s&&((w=h._audioTrack)===null||w===void 0||w._destroy(),h._audioTrack=void 0)}}),c.forEach(d=>{let[,{kind:h}]=d;fr(this,jt.RequestP2PMuteRemote,h)}))}startUploadDownlinkState(){if(this.uploadDownlinkStarted)return;this.uploadDownlinkStarted=!0,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval);const t=()=>Array.from(this.remoteUserMap.entries()).forEach(r=>{let[,s]=r;[bt.VIDEO,bt.AUDIO].forEach(a=>{s.has(a)?fr(this,jt.RequestP2PUnmuteRemote,a):fr(this,jt.RequestP2PMuteRemote,a)})});t(),this.downlinkStatsUploadInterval=window.setInterval(()=>{t()},3e3)}stopUploadDownlinkState(){this.uploadDownlinkStarted&&(this.uploadDownlinkStarted=!1,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval))}getAllDataChannels(){return this.localDataChannels}async massSubscribe(t){throw new Le(te.NOT_SUPPORTED,"p2p mode does not support massSubscribe.")}async massSubscribeNoLock(t){throw new Le(te.NOT_SUPPORTED,"p2p mode does not support massSubscribeNoLock.")}async massUnsubscribe(t){throw new Le(te.NOT_SUPPORTED,"p2p mode does not support massUnsubscribe.")}async massUnsubscribeNoLock(t){throw new Le(te.NOT_SUPPORTED,"p2p mode does not support massUnsubscribeNoLock.")}async muteRemote(t,r){if(!this.recvConnection)return;const s=this.remoteUserMap.get(t);if(!s)return void x.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(t.uid,"."));if(!s.get(r))return void x.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(t.uid," media type ").concat(r,"."));const a=r===bt.VIDEO?t._videoSSRC:t._audioSSRC;a!==void 0&&this.recvConnection.setStatsRemoteVideoIsReady(a,!1)}async unmuteRemote(t,r){return this.unmuteRemoteNoLock(t,r)}async unmuteRemoteNoLock(t,r){if(!this.recvConnection)return;const s=this.remoteUserMap.get(t);if(!s)return void x.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(t.uid,"."));s.get(r)||x.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(t.uid," media type ").concat(r,"."))}getAllTracks(t){const r=this.localTrackMap.get(Xe.LocalAudioTrack);if((r==null?void 0:r.track)instanceof Bi){const s=r.track;return Array.from(this.localTrackMap.entries()).filter(a=>{let[c]=a;return c!==Xe.LocalAudioTrack}).filter(a=>{let[c]=a;return!(t&&c===Xe.LocalVideoLowTrack)}).map(a=>{let[,{track:c}]=a;return c}).concat(s.trackList)}return Array.from(this.localTrackMap.entries()).filter(s=>{let[a]=s;return!(t&&a===Xe.LocalVideoLowTrack)}).map(s=>{let[,{track:a}]=s;return a})}reportPublishEvent(t,r,s,a,c){if(t){const h=this.localTrackMap.get(Xe.LocalAudioTrack),m=a?this.localTrackMap.get(Xe.LocalVideoLowTrack):this.localTrackMap.get(Xe.LocalVideoTrack);Nt.publish(this.store.sessionId,{eventElapse:Zs.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:t,ec:r,audioName:h==null?void 0:h.track.getTrackLabel(),videoName:m==null?void 0:m.track.getTrackLabel(),screenshare:(m==null?void 0:m.track._hints.indexOf(gr.SCREEN_TRACK))!==-1,audio:!!h,video:!!m,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:c})}else{var d;s||(s=[]);const h=s.find(y=>y instanceof Qr),m=a?(d=this.localTrackMap.get(Xe.LocalVideoTrack))===null||d===void 0?void 0:d.track:s.find(y=>y instanceof Ir);Nt.publish(this.store.sessionId,{eventElapse:Zs.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:t,ec:r,audioName:h==null?void 0:h.getTrackLabel(),videoName:m==null?void 0:m.getTrackLabel(),screenshare:(m==null?void 0:m._hints.indexOf(gr.SCREEN_TRACK))!==-1,audio:!!h,video:!!m,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:c})}}reportSubscribeEvent(t,r,s,a){const c=a===bt.VIDEO?s._videoSSRC:s._audioSSRC;c&&Nt.subscribe(this.store.sessionId,{succ:t,ec:r,video:a===bt.VIDEO,audio:a===bt.AUDIO,peerid:s.uid,subscribeRequestid:a===bt.VIDEO?s._videoSSRC:s._audioSSRC,p2pid:this.store.p2pId,eventElapse:Zs.measureFromSubscribeStart(this.store.clientId,c)})}reset(){x.debug("[".concat(this.store.clientId,"] P2PChannel2.reset")),this.sendMutex=new Xs("P2PChannel2-send-mutex",this.store.clientId),this.sendMutex=new Xs("P2PChannel2-recv-mutex",this.store.clientId),this.sendConnection&&(this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0),this.recvConnection&&(this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const t=this.localTrackMap.get(Xe.LocalAudioTrack);if((t==null?void 0:t.track)instanceof Bi){if(t.track.trackList.length>0){const r=t.track;t.track.trackList.forEach(s=>{r.removeAudioTrack(s)})}t.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.reconnectInterval&&(window.clearInterval(this.reconnectInterval),this.reconnectInterval=void 0),this.state=Jn.Disconnected}getStats(t){var r,s;return t?(s=this.recvConnection)===null||s===void 0?void 0:s.getStats():(r=this.sendConnection)===null||r===void 0?void 0:r.getStats()}getRemoteVideoIsReady(t){var r;return((r=this.recvConnection)===null||r===void 0?void 0:r.getRemoteVideoIsReady(t))||!1}getLocalAudioVolume(){const t=this.localTrackMap.get(Xe.LocalAudioTrack);if(t)return t.track.getVolumeLevel()}getLocalVideoSize(){const t=this.localTrackMap.get(Xe.LocalVideoTrack);if(t)return{width:t.track.videoWidth||0,height:t.track.videoHeight||0}}getEncoderConfig(t){const r=this.localTrackMap.get(t);return r&&r.track instanceof Ir||r&&r.track instanceof Qr?r.track._encoderConfig:void 0}getLocalMedia(t){return this.localTrackMap.get(t)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(t,r){if(!t)return this.remoteUserMap.size>0;const s=this.remoteUserMap.get(t);return!!s&&(!r||s.has(r))}async hasRemoteMediaWithLock(t,r){if(!t)return this.remoteUserMap.size>0;const s=this.remoteUserMap.get(t);return!!s&&(!r||s.has(r))}getRemoteMedia(t){var r;const s=Array.from(tl(r=this.remoteUserMap).call(r)).find(a=>a.uid===t);return s?{audioTrack:s.audioTrack,audioSSRC:s._audioSSRC,videoTrack:s.videoTrack,videoSSRC:s._videoSSRC}:{}}getAudioLevels(){let t=Array.from(this.remoteUserMap.entries()).map(s=>{let[a]=s;return{uid:a.uid,level:a.audioTrack?100*a.audioTrack._source.getAccurateVolumeLevel():0}});const r=this.localTrackMap.get(Xe.LocalAudioTrack);return r&&t.push({level:100*r.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),t=Ew(t).call(t,(s,a)=>s.level-a.level),t}async disconnectForReconnect(){this.sendConnection&&this.recvConnection&&(x.debug("[".concat(this.store.clientId,"] P2PChannel2.disconnectForReconnect closing P2PConnection")),this.state=Jn.Reconnecting,oe("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(t=>{let[r]=t;var s;r._videoTrack&&r._videoTrack._player&&((s=r._videoTrack._player.getVideoElement())===null||s===void 0||s.pause(),r._videoTrack._player.isKeepLastFrame=!0,r._videoTrack._originMediaStreamTrack.stop())}),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0,this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0,this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(t=>{var r;let[s,{track:a}]=t;switch(s){case Xe.LocalVideoTrack:lt(r=a._hints).call(r,gr.LOW_STREAM)?a.close():this.pendingLocalTracks.push(a);break;case Xe.LocalAudioTrack:a instanceof Bi?this.pendingLocalTracks=this.pendingLocalTracks.concat(a.trackList):this.pendingLocalTracks.push(a);case Xe.LocalVideoLowTrack:}}),this.emit(jt.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(t=>{let[r,s]=t;Array.from(tl(s).call(s)).forEach(a=>{this.setPendingRemoteMedia(r,a)}),this.emit(jt.MediaReconnectStart,r.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),x.debug("[".concat(this.store.clientId,"] P2PChannel2 disconnected, waiting to reconnect.")))}hasPendingRemoteMedia(t,r){for(const s of this.pendingRemoteTracks){const{user:a,kind:c}=s;if((t instanceof sg?t.uid:t)===a.uid&&r===c)return!0}return!1}setPendingRemoteMedia(t,r){this.hasPendingRemoteMedia(t,r)||this.pendingRemoteTracks.push({user:t,kind:r})}async restartICE(t,r){let s,a;if(t===Xo.SEND_ONLY){if(!this.sendConnection)throw new Le(te.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established.");s=await this.sendMutex.lock("From P2PChannel.restartICE"),a=this.sendConnection}else{if(!this.recvConnection)throw new Le(te.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before recvConnection established.");s=await this.recvMutex.lock("From P2PChannel.restartICE"),a=this.recvConnection}try{if(r){const c=await a.restartICE(r);return a.isInRestartIce=!1,c}{const c=await a.restartICE();if(c){const d=await Ms(this,jt.RequestP2PRestartICE,{direction:Xo.RECEIVE_ONLY,iceParameter:c});await a.restartICE(d),a.isInRestartIce=!1}}}finally{s()}}getUplinkNetworkQuality(){if(!this.sendConnection)return 0;const t=this.sendConnection.getStats(),r=this.localTrackMap.get(Xe.LocalVideoTrack),s=this.localTrackMap.get(Xe.LocalAudioTrack),a=t.videoSend.find(D=>{var G;return D.ssrc===(r==null||(G=r.ssrcs)===null||G===void 0?void 0:G[0].ssrcId)}),c=t.audioSend.find(D=>{var G;return D.ssrc===(s==null||(G=s.ssrcs)===null||G===void 0?void 0:G[0].ssrcId)});if(!a||!c)return 1;const d=Zc(this,jt.NeedSignalRTT),h=a?a.rttMs:void 0,m=c?c.rttMs:void 0,y=h&&m?(h+m)/2:h||m,v=(y&&d?(y+d)/2:y||d)||0,w=100*t.sendPacketLossRate*.7/50+.3*v/1500,R=w<.17?1:w<.36?2:w<.59?3:w<.1?4:5,O=r==null?void 0:r.track;if(O&&O._encoderConfig&&O._hints.indexOf(gr.SCREEN_TRACK)===-1){const D=O._encoderConfig.bitrateMax,G=t.bitrate.actualEncoded;if(D&&G){const j=(1e3*D-G)/(1e3*D);return TH[j<.15?0:j<.3?1:j<.45?2:j<.6?3:4][R]}}return R}getDownlinkNetworkQuality(){if(!this.recvConnection)return 0;const t=this.recvConnection.getStats();let r=0;return Array.from(this.remoteUserMap.entries()).forEach(s=>{let[a]=s;const c=a._audioSSRC,d=a._videoSSRC,h=t.audioRecv.find(G=>G.ssrc===c),m=t.videoRecv.find(G=>G.ssrc===d);if(!h&&!m)return void(r+=1);const y=Zc(this,jt.NeedSignalRTT),v=t.rtt,w=(v&&y?(v+y)/2:v||y)||0,R=h?h.jitterMs:void 0,O=t.recvPacketLossRate;let D=.7*O*100/50+.3*w/1500;R&&(D=.6*O*100/50+.2*w/1500+.2*R/400),r+=D<.1?1:D<.17?2:D<.36?3:D<.59?4:5}),this.remoteUserMap.size>0?Math.round(r/this.remoteUserMap.size):r}async muteLocalTrack(t){return new pt((r,s)=>{this.handleMuteLocalTrack(t,r,s)})}filterTobePublishedTracks(t,r,s){const a=[],c=Wn(),d=this.getAllTracks();t=Yv(t=t.filter(y=>d.indexOf(y)===-1));let h=!1,m=!1;for(const y of t){if(y instanceof Ir&&(this.localTrackMap.has(Xe.LocalVideoTrack)||h?new Le(te.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(a.push({track:y,type:Xe.LocalVideoTrack}),h=!0),r)){const v=this.getLowVideoTrack(y,s);a.push({track:v,type:Xe.LocalVideoLowTrack})}if(y instanceof Qr){const v=this.localTrackMap.get(Xe.LocalAudioTrack);if(v){if(!(v.track instanceof Bi))throw new Le(te.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(y._bypassWebAudio)throw new Le(te.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");v.track.addAudioTrack(y),this.bindLocalAudioTrackEvents(y,!0)}else if(m){const w=a.find(R=>{let{type:O}=R;return O===Xe.LocalAudioTrack});if(!(w.track instanceof Bi))throw new Le(te.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(y._bypassWebAudio)throw new Le(te.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");w.track.addAudioTrack(y)}else{if(!c.webAudioMediaStreamDest||y instanceof Bi||y._bypassWebAudio)a.push({track:y,type:Xe.LocalAudioTrack});else{const w=new Bi;w.addAudioTrack(y),a.push({track:w,type:Xe.LocalAudioTrack})}m=!0}}}return a}filterTobeUnpublishedTracks(t){const r=[],s=this.getAllTracks();t=Yv(t=t.filter(a=>s.indexOf(a)!==-1));for(const a of t){if(a instanceof Qr){const c=this.localTrackMap.get(Xe.LocalAudioTrack);if(!c)continue;c.track instanceof Bi?(c.track.removeAudioTrack(a),this.unbindLocalAudioTrackEvents(a),c.track.trackList.length===0&&(r.push([Xe.LocalAudioTrack,c]),c.track.close())):r.push([Xe.LocalAudioTrack,c])}if(a instanceof Ir){const c=this.localTrackMap.get(Xe.LocalVideoTrack);if(!c)continue;r.push([Xe.LocalVideoTrack,c]);const d=this.localTrackMap.get(Xe.LocalVideoLowTrack);d&&r.push([Xe.LocalVideoLowTrack,d])}}return r}bindLocalTrackEvents(t){t.forEach(r=>{let{track:s,type:a}=r;switch(a){case Xe.LocalVideoTrack:s.addListener(It.GET_STATS,this.handleGetLocalVideoStats),s.addListener(It.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),s.addListener(It.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),s.addListener(It.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),s.addListener(It.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),s.addListener(It.NEED_REPLACE_TRACK,this.handleReplaceTrack),s.addListener(It.NEED_MUTE_TRACK,this.handleMuteLocalTrack),s.addListener(It.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Xe.LocalAudioTrack:this.bindLocalAudioTrackEvents(s);case Xe.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(t,r){t instanceof Bi?t.trackList.forEach(s=>{s.addListener(It.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),s.addListener(It.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),s.addListener(It.GET_STATS,this.handleGetLocalAudioStats),s.addListener(It.NEED_MUTE_TRACK,this.handleMuteLocalTrack),s.addListener(It.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(t.addListener(It.GET_STATS,this.handleGetLocalAudioStats),t.addListener(It.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.addListener(It.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.addListener(It.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.addListener(It.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),r||t.addListener(It.NEED_REPLACE_TRACK,this.handleReplaceTrack))}unbindLocalTrackEvents(t){t||(t=Array.from(this.localTrackMap.entries()).map(r=>{let[s,{track:a}]=r;return{track:a,type:s}})),t.forEach(r=>{let{track:s,type:a}=r;switch(a){case Xe.LocalVideoTrack:s.off(It.GET_STATS,this.handleGetLocalVideoStats),s.off(It.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),s.off(It.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),s.off(It.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),s.off(It.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),s.off(It.NEED_REPLACE_TRACK,this.handleReplaceTrack),s.off(It.NEED_MUTE_TRACK,this.handleMuteLocalTrack),s.off(It.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Xe.LocalAudioTrack:this.unbindLocalAudioTrackEvents(s);case Xe.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(t){t instanceof Bi?t.trackList.forEach(r=>{r.off(It.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),r.off(It.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),r.off(It.GET_STATS,this.handleGetLocalAudioStats),r.off(It.NEED_MUTE_TRACK,this.handleMuteLocalTrack),r.off(It.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(t.off(It.GET_STATS,this.handleGetLocalAudioStats),t.off(It.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(It.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(It.NEED_REPLACE_TRACK,this.handleReplaceTrack),t.off(It.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(It.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(t,r){r instanceof cS&&r.addListener(It.GET_STATS,s=>{s(this.handleGetRemoteVideoStats(t))}),r instanceof lS&&r.addListener(It.GET_STATS,s=>{s(this.handleGetRemoteAudioStats(t))})}unbindRemoteTrackEvents(t){t&&t.removeAllListeners(It.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(t=>{let[r,s]=t;s.has(bt.AUDIO)&&this.unbindRemoteTrackEvents(r._audioTrack),s.has(bt.VIDEO)&&this.unbindRemoteTrackEvents(r._videoTrack)})}createGatewayPublishMessage(t,r){return t.map((s,a)=>{var c;let d,{track:h,type:m}=s;switch(m){case Xe.LocalAudioTrack:d=Qn.Audio;break;case Xe.LocalVideoTrack:d=lt(c=h._hints).call(c,gr.SCREEN_TRACK)?Qn.Screen:Qn.High;break;case Xe.LocalVideoLowTrack:d=Qn.Low}return{kind:m===Xe.LocalAudioTrack?bt.AUDIO:bt.VIDEO,stream_type:d,mid:r[a].id,ssrcs:r[a].localSSRC,isMuted:h.muted||!h.enabled}})}createGatewayUnpublishMessage(t){return t.map(r=>{var s;let a,[c,{track:d,ssrcs:h,id:m}]=r;switch(c){case Xe.LocalVideoTrack:a=lt(s=d._hints).call(s,gr.SCREEN_TRACK)?Qn.Screen:Qn.High;break;case Xe.LocalAudioTrack:a=Qn.Audio;break;case Xe.LocalVideoLowTrack:a=Qn.Low}return{stream_type:a,ssrcs:h,mid:m}})}assignLocalTracks(t,r){t.forEach((s,a)=>{let{track:c,type:d}=s;this.localTrackMap.set(d,{track:c,id:r[a].id,ssrcs:r[a].localSSRC})})}withdrawLocalTracks(t){t.forEach(r=>{let[s]=r;this.localTrackMap.delete(s)})}bindConnectionEvents(t){t.onConnectionStateChange=async r=>{var s;x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: ").concat(t.name,".onConnectionStateChange(").concat(r,")")),this.emit(jt.PeerConnectionStateChange,r),r!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),r==="connected"&&(t.isInRestartIce=!1),lt(s=this._restartStates).call(s,r)&&!t.isInRestartIce&&(r==="disconnected"&&await ys(800),t.iceConnectionState!=="disconnected"&&t.iceConnectionState!=="failed"||this.handleDisconnect(t.direction))},t.onICEConnectionStateChange=r=>{r!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(r,")")),Nt.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:r,tag:Kr.TRACER}).onSuccess(),this.emit(jt.IceConnectionStateChange,r)},t.onICETransportStateChange=r=>{x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(r,")"))},t.onDTLSTransportStateChange=r=>{x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(r,")"))},t.onDTLSTransportError=r=>{x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(r,")"))},t.onFirstAudioDecoded=r=>{var s;const a=Array.from(tl(s=this.remoteUserMap).call(s)).find(d=>d._audioSSRC===r);var c;a&&(this.store.subscribe(a.uid,"audio",void 0,void 0,void 0,Date.now()),(c=a.audioTrack)===null||c===void 0||c.emit(rS.FIRST_FRAME_DECODED),Nt.firstRemoteFrame(this.store.sessionId,Zi.FIRST_AUDIO_DECODE,Mr.FIRST_AUDIO_DECODE,{peer:a._uintid,subscribeElapse:Zs.measureFromSubscribeStart(this.store.clientId,r),subscribeRequestid:r,p2pid:this.store.p2pId}))},t.onFirstAudioReceived=r=>{var s;const a=Array.from(tl(s=this.remoteUserMap).call(s)).find(c=>c._audioSSRC===r);a&&Nt.firstRemoteFrame(this.store.sessionId,Zi.FIRST_AUDIO_RECEIVED,Mr.FIRST_AUDIO_RECEIVED,{peer:a._uintid,subscribeElapse:Zs.measureFromSubscribeStart(this.store.clientId,r),subscribeRequestid:r,p2pid:this.store.p2pId})},t.onFirstVideoDecoded=(r,s,a)=>{this.reportVideoFirstFrameDecoded(r,s,a)},t.onFirstVideoReceived=r=>{var s;const a=Array.from(tl(s=this.remoteUserMap).call(s)).find(c=>c._videoSSRC===r);a&&Nt.firstRemoteFrame(this.store.sessionId,Zi.FIRST_VIDEO_RECEIVED,Mr.FIRST_VIDEO_RECEIVED,{peer:a._uintid,subscribeElapse:Zs.measureFromSubscribeStart(this.store.clientId,r),subscribeRequestid:r,p2pid:this.store.p2pId})},t.onSelectedLocalCandidateChanged=(r,s)=>{const a=r.candidateType==="relay",c=s.candidateType==="relay";s.candidateType!=="unknown"&&a===c||this.emit(jt.ConnectionTypeChange,a),x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(ng(s))," -> ").concat(JSON.stringify(ng(r)),")"))},t.onSelectedRemoteCandidateChanged=(r,s)=>{x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(ng(s))," -> ").concat(JSON.stringify(ng(r)),")"))},t.onFirstVideoDecodedTimeout=r=>{this.reportVideoFirstFrameDecoded(r,void 0,void 0,!0)},t.onLocalCandidate=r=>{this.emit(jt.LocalCandidate,{candidate:r,direction:t.direction})}}unbindConnectionEvents(t){t.onConnectionStateChange=void 0,t.onICEConnectionStateChange=void 0,t.onICETransportStateChange=void 0,t.onDTLSTransportStateChange=void 0,t.onDTLSTransportError=void 0,t.onFirstAudioDecoded=void 0,t.onFirstAudioReceived=void 0,t.onFirstVideoDecoded=void 0,t.onFirstVideoReceived=void 0,t.onSelectedLocalCandidateChanged=void 0,t.onSelectedRemoteCandidateChanged=void 0,t.onFirstVideoDecodedTimeout=void 0,t.onLocalCandidate=void 0}async handleDisconnect(t){const r=t===Xo.SEND_ONLY?this.sendConnection:this.recvConnection;r&&!r.isInRestartIce&&(r.isInRestartIce=!0,x.debug("[".concat(this.store.clientId,"] [P2PChannel-").concat(r.name,"] start use restartICE")),t===Xo.SEND_ONLY?this.restartICE(t):Ms(this,jt.RequestP2PRestartICE,{direction:Xo.SEND_ONLY}))}filterTobeMutedTracks(t){const r=[];if(this.getAllTracks().indexOf(t)===-1)return r;const s=this.localTrackMap.get(Xe.LocalAudioTrack);if(t instanceof Qr&&(s==null?void 0:s.track)instanceof Bi)return s.track.isActive||r.push([Xe.LocalAudioTrack,s]),r;const a=Array.from(this.localTrackMap.entries()).find(c=>{let[,{track:d}]=c;return t===d});if(a&&(r.push(a),a[0]===Xe.LocalVideoTrack)){const c=this.localTrackMap.get(Xe.LocalVideoLowTrack);c&&r.push([Xe.LocalVideoLowTrack,c])}return r}filterTobeUnmutedTracks(t){const r=[],s=this.localTrackMap.get(Xe.LocalAudioTrack);if(t instanceof Qr&&(s==null?void 0:s.track)instanceof Bi)return s.track.isActive&&r.push([Xe.LocalAudioTrack,s]),r;const a=Array.from(this.localTrackMap.entries()).find(c=>{let[,{track:d}]=c;return t===d});if(a)if(a[0]===Xe.LocalVideoTrack){r.push(a);const c=this.localTrackMap.get(Xe.LocalVideoLowTrack);c&&r.push([Xe.LocalVideoLowTrack,c])}else r.push(a);return r}createMuteMessage(t){return t.map(r=>{var s;let a,[c,{track:d,ssrcs:h,id:m}]=r;switch(c){case Xe.LocalAudioTrack:a=Qn.Audio;break;case Xe.LocalVideoTrack:a=lt(s=d._hints).call(s,gr.SCREEN_TRACK)?Qn.Screen:Qn.High;break;case Xe.LocalVideoLowTrack:a=Qn.Low}return{stream_type:a,ssrcs:h,mid:m}})}createUnmuteMessage(t){return t.map(r=>{var s;let a,[c,{track:d,ssrcs:h,id:m}]=r;switch(c){case Xe.LocalAudioTrack:a=Qn.Audio;break;case Xe.LocalVideoTrack:a=lt(s=d._hints).call(s,gr.SCREEN_TRACK)?Qn.Screen:Qn.High;break;case Xe.LocalVideoLowTrack:a=Qn.Low}return{stream_type:a,ssrcs:h,mid:m}})}filterTobeUnSubscribedTracks(t,r){const s=[],a=this.remoteUserMap.get(t);if(!a)return s;if(r){const c=a.get(r);if(!c)return s;s.push([t,{kind:r,id:c}])}else Array.from(a.entries()).forEach(c=>{let[d,h]=c;s.push([t,{kind:d,id:h}])});return s}createUnsubscribeMessage(t){const r=[];return t.forEach(s=>{let[a,{kind:c,id:d}]=s;switch(c){case bt.VIDEO:return void(a._videoSSRC&&r.push({stream_type:bt.VIDEO,ssrcId:a._videoSSRC}));case bt.AUDIO:return void(a._audioSSRC&&r.push({stream_type:bt.AUDIO,ssrcId:a._audioSSRC}))}}),r}withdrawRemoteTracks(t){t.forEach(r=>{let[s,{kind:a}]=r;const c=this.remoteUserMap.get(s);c&&(c.delete(a),Array.from(c.entries()).length===0&&this.remoteUserMap.delete(s))})}async updateBitrateLimit(t){const r=this.localTrackMap.get(Xe.LocalVideoTrack),s=this.localTrackMap.get(Xe.LocalVideoLowTrack);r&&(await r.track.setBitrateLimit(t.uplink),await new pt((a,c)=>{this.handleUpdateVideoEncoder(r.track,a,c,!0)})),s&&t.low_stream_uplink&&(await s.track.setBitrateLimit({max_bitrate:t.low_stream_uplink.bitrate,min_bitrate:t.low_stream_uplink.bitrate||0}),await new pt((a,c)=>{this.handleUpdateVideoEncoder(s.track,a,c,!0)}))}isP2PDisconnected(){if(this.sendConnection&&this.recvConnection){const t=this.sendConnection.peerConnectionState,r=this.recvConnection.peerConnectionState;return t!=="connected"&&r!=="connected"}return!0}async tryToUnmuteAudio(t){for(let r=0;r<t.length;r++)if(t[r]instanceof Qr){const s=this.filterTobeUnmutedTracks(t[r]);if(s.length===0)continue;const a=this.createUnmuteMessage(s);return void await fr(this,jt.RequestUnmuteLocal,a)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=t=>this.getStats(t),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()).filter(t=>{let[,{ssrcs:r}]=t;return!!r}),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=t=>{var r;return!((r=this.recvConnection)===null||r===void 0||!r.getRemoteVideoIsReady(t))},this.statsUploader.requestUpload=(t,r)=>this.emit(jt.RequestUpload,t,r),this.statsUploader.requestUploadStats=t=>this.emit(jt.RequestUploadStats,t),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await ys(AL(this.dtlsFailedCount,Di)),this.emit(jt.RequestReconnect)}async reconnectP2P(){}canPublishLowStream(){return this.localTrackMap.has(Xe.LocalVideoTrack)||this.pendingLocalTracks.some(t=>t instanceof Ir)}throwIfTrackTypeNotMatch(t){if(t.filter(r=>r instanceof Ir).length>1)throw new Le(te.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t.filter(r=>r instanceof Qr).length>1&&(t.some(r=>r instanceof Qr&&r._bypassWebAudio)||!Wn().webAudioMediaStreamDest))throw new Le(te.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const r of t){if(r instanceof Ir&&this.pendingLocalTracks.some(s=>s instanceof Ir))throw new Le(te.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(r instanceof Qr&&this.pendingLocalTracks.some(s=>s instanceof Qr)&&(!Wn().webAudioMediaStreamDest||r._bypassWebAudio||this.pendingLocalTracks.some(s=>s instanceof Qr&&s._bypassWebAudio)))throw new Le(te.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(t,r){const s=!oe("DISABLE_DUAL_STREAM_USE_ENCODING")&&Wn().supportDualStreamEncoding,a=vO(vO({},{width:160,height:120,framerate:15,bitrate:50}),r);let c;c=s?t._mediaStreamTrack.clone():U2(t,a);const d=mr(8,"track-low-"),h=new Ir(c,vO(vO({},s&&{scaleResolutionDownBy:E2(a,t)}),{},{frameRate:a.framerate,bitrateMax:a.bitrate,bitrateMin:a.bitrate}),void 0,void 0,d);return h.on(Z_.TRANSCEIVER_UPDATED,m=>{t._updateRtpTransceiver(m,tS.LOW_STREAM)}),h._hints.push(gr.LOW_STREAM),t.addListener(It.NEED_CLOSE,()=>{h.close()}),h}async globalLock(){return this.recvMutex.lock("From P2PChannel2.globalLock")}reportVideoFirstFrameDecoded(t,r,s,a){var c;const d=Array.from(tl(c=this.remoteUserMap).call(c)).find(h=>h._videoSSRC===t);if(d){a||this.store.subscribe(d.uid,"video",void 0,void 0,void 0,void 0,Date.now());const h=this.store.keyMetrics,m=h.subscribe.find(y=>y.userId===d.uid&&y.type==="video");Nt.firstRemoteVideoDecode(this.store.sessionId,Zi.FIRST_VIDEO_DECODE,Mr.FIRST_VIDEO_DECODE,{peer:d._uintid,videowidth:r,videoheight:s,subscribeElapse:Zs.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId,apEnd:h.requestAPEnd||0,apStart:h.requestAPStart||0,joinGwEnd:h.joinGatewayEnd||0,joinGwStart:h.joinGatewayStart||0,pcEnd:h.peerConnectionEnd||0,pcStart:h.peerConnectionStart||0,subscriberEnd:(m==null?void 0:m.subscribeEnd)||0,subscriberStart:(m==null?void 0:m.subscribeStart)||0,videoAddNotify:(m==null?void 0:m.streamAdded)||0,state:a?1:0})}}async remoteMediaSsrcChanged(t,r,s){if(!this.recvConnection)return!1;const a=this.remoteUserMap.get(t);if(!a)return!1;const c=a.get(r);if(!c)return!1;const d=await this.recvConnection.getRemoteSSRC(c);return d!==void 0&&d!==s}isPreSubScribe(t){return!1}async publishDataChannel(t){throw new Le(te.NOT_SUPPORTED)}async unpublishDataChannel(t){throw new Le(te.NOT_SUPPORTED)}async subscribeDataChannel(t,r){throw new Le(te.NOT_SUPPORTED)}async unsubscribeDataChannel(t,r){throw new Le(te.NOT_SUPPORTED)}hasPendingRemoteDataChannel(t,r){throw new Le(te.NOT_SUPPORTED)}setPendingRemoteDataChannel(t,r){throw new Le(te.NOT_SUPPORTED)}async preConnect(t){throw new Le(te.NOT_SUPPORTED)}getEstablishParams(){throw new Le(te.NOT_SUPPORTED)}async reSubscribe(t){throw new Le(te.NOT_SUPPORTED)}async updateVideoStreamParameter(t,r){throw new Le(te.NOT_SUPPORTED)}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(t=>{let[r,{track:s}]=t;r===Xe.LocalVideoLowTrack?s._updateRtpTransceiver(void 0,tS.LOW_STREAM):s._updateRtpTransceiver(void 0)})}},At(Vr.prototype,"p2pConnect",[dK],Object.getOwnPropertyDescriptor(Vr.prototype,"p2pConnect"),Vr.prototype),At(Vr.prototype,"unpublish",[hK],Object.getOwnPropertyDescriptor(Vr.prototype,"unpublish"),Vr.prototype),At(Vr.prototype,"unpublishLowStream",[pK],Object.getOwnPropertyDescriptor(Vr.prototype,"unpublishLowStream"),Vr.prototype),At(Vr.prototype,"subscribe",[fK],Object.getOwnPropertyDescriptor(Vr.prototype,"subscribe"),Vr.prototype),At(Vr.prototype,"mockSubscribe",[mK],Object.getOwnPropertyDescriptor(Vr.prototype,"mockSubscribe"),Vr.prototype),At(Vr.prototype,"unsubscribe",[gK],Object.getOwnPropertyDescriptor(Vr.prototype,"unsubscribe"),Vr.prototype),At(Vr.prototype,"muteRemote",[_K],Object.getOwnPropertyDescriptor(Vr.prototype,"muteRemote"),Vr.prototype),At(Vr.prototype,"unmuteRemote",[yK],Object.getOwnPropertyDescriptor(Vr.prototype,"unmuteRemote"),Vr.prototype),At(Vr.prototype,"hasRemoteMediaWithLock",[EK],Object.getOwnPropertyDescriptor(Vr.prototype,"hasRemoteMediaWithLock"),Vr.prototype),At(Vr.prototype,"disconnectForReconnect",[vK],Object.getOwnPropertyDescriptor(Vr.prototype,"disconnectForReconnect"),Vr.prototype),At(Vr.prototype,"remoteMediaSsrcChanged",[SK],Object.getOwnPropertyDescriptor(Vr.prototype,"remoteMediaSsrcChanged"),Vr.prototype),Vr);function jd(t){return function(r,s,a){const c=r[s];if(typeof c!="function")throw new Error("Cannot use mutex on object property.");return a.value=async function(){for(var d=arguments.length,h=new Array(d),m=0;m<d;m++)h[m]=arguments[m];switch(t){case Vd.SEND_ONLY:{const y=await this.sendMutex.lock("From P2PChannel2.".concat(s));try{return await c.apply(this,h)}finally{y()}}case Vd.RECEIVE_ONLY:{const y=await this.recvMutex.lock("From P2PChannel2.".concat(s));try{return await c.apply(this,h)}finally{y()}}default:{const y=await this.sendMutex.lock("From P2PChannel2.".concat(s)),v=await this.recvMutex.lock("From P2PChannel2.".concat(s));try{return await c.apply(this,h)}finally{y(),v()}}}},a}}class vy extends Br{constructor(r,s){super(),q(this,"signal",void 0),q(this,"token",void 0),q(this,"tokenTimeout",void 0),q(this,"tokenInterval",void 0),q(this,"_sequence",0),q(this,"userMap",new Map),q(this,"encoder",new TextEncoder),this.signal=r,this.token=s;const a=()=>{this.signal.connectionState===yr.CONNECTED&&this.check(),this.userMap.size===0?this.tokenInterval=window.setTimeout(a,1e3):this.tokenInterval=window.setTimeout(a,3*oe("P2P_TOKEN_INTERVAL"))};a()}async send(r,s,a,c,d){var h,m,y;if(this.userMap.size===0)return;const v=Array.from(Jc(h=this.userMap).call(h))[0].token;typeof s!="string"&&(s=JSON.stringify(s)),c=(m=c)!==null&&m!==void 0?m:mr(6,""),d=(y=d)!==null&&y!==void 0?y:this._sequence++;const w={_id:c,_type:r,_seq:d,_message:s,token:"".concat(this.token,"_").concat(v)};oe("SHOW_P2P_LOG")&&x.debug("send message",w,"noNeedResponse : ".concat(a)),this.splitMessage(JSON.stringify(w)).forEach(O=>{this.signal.request(Yt.DATA_STREAM,{payload:Jm(this.encoder.encode(O))})});const R=new pt((O,D)=>{const G=window.setTimeout(()=>{this.off("res-@".concat(c,"_ack"),j),this.off("res-@".concat(c),Q),this.off(fS.ABORT,W),x.debug("[external-signal] request timeout, type: ".concat(r,", requestId: ").concat(c)),this.userMap.size===0?D(new Le(te.INVALID_REMOTE_USER)):D(new Le(te.TIMEOUT))},oe("EXTERNAL_SIGNAL_REQUEST_TIMEOUT")),j=()=>{G&&window.clearTimeout(G),this.off(fS.ABORT,W),a&&O()},W=()=>{G&&window.clearTimeout(G),this.off("res-@".concat(c,"_ack"),j),this.off("res-@".concat(c),Q),D(new Le(te.EXTERNAL_SIGNAL_ABORT,"type: ".concat(r,", requestId: ").concat(c)))};this.once(fS.ABORT,W),this.once("res-@".concat(c,"_ack"),j);const Q=(fe,ye)=>{ee=!0,G&&window.clearTimeout(G),this.off("res-@".concat(c,"_ack"),j),this.off(fS.ABORT,W),fe==="success"?O(ye):D(new Le(te.P2P_MESSAGE_FAILED,"request ".concat(r," failed, requestId: ").concat(c)))};let ee=!1;a||(this.once("res-@".concat(c),Q),ys(oe("SIGNAL_REQUEST_TIMEOUT")).then(()=>{ee||x.warning("external_signal request timeout, type: ".concat(r,", requestId: ").concat(c,", ").concat(w))}))});try{return await R}catch(O){if(O.code===te.TIMEOUT)return await this.send(r,s,a,c,d);throw O}}onMessage(r){var s;const{_uid:a}=r;let c,d=this.userMap.get(a);if(d)c=d.splitMessageMap;else{if(this.userMap.size>0||!("_type"in r)||r._type!==hi.CHECK)return;const{token:v}=r;c=new Map,d={uid:a,isStart:!0,token:v,splitMessageMap:c,nextExpectedSequenceNumber:0,receivedMessagesMap:new Map},this.userMap.set(a,d),this.signal.emit(Cn.ON_USER_ONLINE,{uid:a}),this.handleUserOnline()}if("id"in r&&"total"in r){var h;const{id:v,total:w}=r,R=(h=c.get(v))!==null&&h!==void 0?h:[];if(R.push(r),c.has(v)||c.set(v,R),R.length!==w)return;{const O=Ew(R).call(R,(D,G)=>D.index-G.index).map(D=>D.payload).join("");c.delete(v),(r=JSON.parse(O))._uid=a}}const{_type:m,token:y}=r;if(lt(s=[hi.ACK,hi.CHECK]).call(s,m))return m===hi.CHECK&&this.handleCheckToken(d,y),void this.receiveMessage(r);y==="".concat(d.token,"_").concat(this.token)?this.handleReceivedMessage(r):x.debug('Receive unexpected message", '.concat(y,", cur_token: ").concat(d.token,"_").concat(this.token),r)}check(){const r={_id:mr(6,""),token:this.token,_type:hi.CHECK};oe("SHOW_P2P_LOG")&&x.debug("send message",r),this.signal.request(Yt.DATA_STREAM,{payload:Jm(this.encoder.encode(JSON.stringify(r)))})}ack(r){const s={_id:r,_type:hi.ACK,token:this.token};oe("SHOW_P2P_LOG")&&x.debug("send message",s),this.signal.request(Yt.DATA_STREAM,{payload:Jm(this.encoder.encode(JSON.stringify(s)))})}response(r,s,a){this.send(hi.RESPONSE,JSON.stringify({success:!a,message:s}),!0,r)}handleReceivedMessage(r){const s=()=>{this.userMap.forEach(v=>{const{receivedMessagesMap:w,nextExpectedSequenceNumber:R}=v;for(;w.has(R);){const O=w.get(R);w.delete(R),this.receiveMessage(O),v.nextExpectedSequenceNumber++}})};if(!r)return void s();const{_uid:a,_seq:c}=r,d=this.userMap.get(a),{receivedMessagesMap:h,isStart:m,nextExpectedSequenceNumber:y}=d;if(c<y)return this.ack(r._id),void x.debug("[external-signal] receive old message, seq: ".concat(c,", ").concat(r._message));h.set(c,r),m&&c===y&&(this.receiveMessage(r),h.delete(y),d.nextExpectedSequenceNumber++,s())}receiveMessage(r){const{_id:s,_type:a,_message:c,_uid:d}=r;if(oe("SHOW_P2P_LOG")&&x.debug("receive message",r),s){let h;switch(r._type!==hi.ACK&&(c&&(h=JSON.parse(c)),this.ack(r._id)),r._type){case hi.CANDIDATE:case hi.CONTROL:this.signal.emit(a,h,d);break;case hi.PUBLISH:case hi.UNPUBLISH:case hi.RESTART_ICE:case hi.CALL:h.uid=d,Ms(this.signal,a,h).then(m=>{this.response(r._id,m)}).catch(()=>{this.response(r._id,void 0,!0)});break;case hi.ACK:this.getListeners("res-@".concat(s,"_ack")).length>0&&this.emit("res-@".concat(s,"_ack"));break;case hi.RESPONSE:{const{success:m,message:y}=h;this.emit("res-@".concat(s),m?"success":"failed",y);break}}}}splitMessage(r){if(r.length<vy.MAX_MESSAGE_SIZE)return[r];const s=[],{remoteToken:a}=JSON.parse(r),c=mr(6,"");let d=0,h=800;const m=Math.ceil(r.length/h);for(;r.length>0;){d++;const y={id:c,index:d,total:m,payload:r.slice(0,h),token:"".concat(this.token,"_").concat(a)};JSON.stringify(y).length>vy.MAX_MESSAGE_SIZE?h-=50:(s.push(y),r=r.slice(h))}return s.map(y=>JSON.stringify(y))}handleCheckToken(r,s){return r.token!==s?(x.debug("token changed, from ".concat(r.token," to ").concat(s)),this.reset(r.uid,s),!1):(this.tokenTimeout&&(window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0),this.tokenTimeout=window.setTimeout(()=>{x.debug("token timeout, ".concat(s)),this.reset(r.uid)},oe("MAX_P2P_TIMEOUT")),!0)}async handleUserOnline(){const r=await Ms(this.signal,hi.CALL,void 0),s=await this.send(hi.CALL,r);this.signal.emit(Jt.P2P_CONNECTION,s,!0)}async reset(r,s){const a=this.userMap.get(r);a&&(this.emit(fS.ABORT),this.signal.emit(Cn.ON_USER_OFFLINE,{uid:a.uid,reason:Cge.P2P_TOKEN_CHANGED}),this._sequence=0,this.userMap.clear(),s||(x.debug("change local token from ".concat(s," to ").concat(s)),this.token=mr(6,"")))}clear(){this._sequence=0,this.userMap.clear(),this.tokenInterval&&window.clearTimeout(this.tokenInterval),this.tokenInterval=void 0,this.tokenTimeout&&window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0,this.emit(fS.ABORT)}}q(vy,"MAX_SIZE",1),q(vy,"MAX_MESSAGE_SIZE",1024);class aEe extends Br{get connectionState(){return this._connectionState}set connectionState(r){r!==this._connectionState&&(this._connectionState=r,r===yr.CONNECTED?this.emit(Jt.WS_CONNECTED):r===yr.RECONNECTING?this.emit(Jt.WS_RECONNECTING,this._websocketReconnectReason):r===yr.CLOSED&&this.emit(Jt.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(r,s){super(),q(this,"_disconnectedReason",void 0),q(this,"_websocketReconnectReason",void 0),q(this,"_connectionState",yr.CLOSED),q(this,"reconnectToken",void 0),q(this,"p2pToken",void 0),q(this,"websocket",void 0),q(this,"openConnectionTime",void 0),q(this,"clientId",void 0),q(this,"lastMsgTime",Date.now()),q(this,"uploadCache",[]),q(this,"uploadCacheInterval",void 0),q(this,"rttRolling",new Qz(5)),q(this,"pingpongTimer",void 0),q(this,"pingpongTimeoutCount",0),q(this,"joinResponse",void 0),q(this,"multiIpOption",void 0),q(this,"initError",void 0),q(this,"spec",void 0),q(this,"store",void 0),q(this,"_external_signal",void 0),q(this,"onWebsocketMessage",a=>{if(a.data instanceof ArrayBuffer)return void this.emit(Jt.ON_BINARY_DATA,a.data);const c=JSON.parse(a.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(c,"_id")){const d="res-@".concat(c._id);this.emit(d,c._result,c._message)}else if(Object.prototype.hasOwnProperty.call(c,"_type")){switch(c._type){case Cn.ON_DATA_STREAM:return void this.handleDataStream(c._message);case Cn.MUTE_AUDIO:case Cn.MUTE_VIDEO:case Cn.ON_P2P_LOST:case Cn.ON_USER_ONLINE:return;case Cn.ON_USER_OFFLINE:const{uid:d}=c._message;return x.debug("[".concat(this.clientId,"] user-offline uid: ").concat(d)),void this._external_signal.reset(d)}if(this.emit(c._type,c._message),c._type===Cn.ON_NOTIFICATION&&this.handleNotification(c._message),c._type===Cn.ON_USER_BANNED)switch(c._message.error_code){case 14:this.close(Xn.UID_BANNED);break;case 15:this.close(Xn.IP_BANNED);break;case 16:this.close(Xn.CHANNEL_BANNED)}if(c._type===Cn.ON_USER_LICENSE_BANNED)switch(c._message.error_code){case Wt.ERR_LICENSE_MISSING:this.close(Xn.LICENSE_MISSING);break;case Wt.ERR_LICENSE_EXPIRED:this.close(Xn.LICENSE_EXPIRED);break;case Wt.ERR_LICENSE_MINUTES_EXCEEDED:this.close(Xn.LICENSE_MINUTES_EXCEEDED);break;case Wt.ERR_LICENSE_PERIOD_INVALID:this.close(Xn.LICENSE_PERIOD_INVALID);break;case Wt.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(Xn.LICENSE_MULTIPLE_SDK_SERVICE);break;case Wt.ERR_LICENSE_ILLEGAL:this.close(Xn.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=r.clientId,this.spec=r,this.store=s,this.websocket=new _2("gateway-".concat(this.clientId),this.spec.retryConfig,!0,oe("JOIN_GATEWAY_USE_DUAL_DOMAIN"),oe("JOIN_GATEWAY_USE_443PORT_ONLY"),s),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===yr.CONNECTED&&this.reconnect("retry",Ls.OFFLINE)}),this.p2pToken=mr(6,""),this._external_signal=new vy(this,this.p2pToken)}async request(r,s,a,c){const d=mr(6,""),h={_id:d,_type:r,_message:s},m=this.websocket.connectionID,y=()=>new pt((G,j)=>{if(this.connectionState===yr.CONNECTED)return G();const W=()=>{this.off(Jt.WS_CLOSED,Q),G()},Q=()=>{this.off(Jt.WS_CONNECTED,W),j(new Le(te.WS_ABORT))};this.once(Jt.WS_CONNECTED,W),this.once(Jt.WS_CLOSED,Q)});if(this.connectionState!==yr.CONNECTING&&this.connectionState!==yr.RECONNECTING||r===Yt.JOIN||r===Yt.REJOIN||await y(),this.websocket.sendMessage(h,!0),c)return;const v=new pt((G,j)=>{let W=!1;const Q=(fe,ye)=>{W=!0,G({isSuccess:fe==="success",message:ye||{}}),this.off(Jt.WS_CLOSED,ee),this.off(Jt.WS_RECONNECTING,ee),this.emit(Jt.REQUEST_SUCCESS,r,s)};this.once("res-@".concat(d),Q);const ee=()=>{j(new Le(te.WS_ABORT,"type: ".concat(r))),this.off(Jt.WS_CLOSED,ee),this.off(Jt.WS_RECONNECTING,ee),this.off("res-@".concat(d),Q)};this.once(Jt.WS_CLOSED,ee),this.once(Jt.WS_RECONNECTING,ee),ys(oe("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==m||W||(x.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(r)),this.emit(Jt.REQUEST_TIMEOUT,r,s))})});let w=null;try{w=await v}catch(G){if(this.connectionState===yr.CLOSED||r===Yt.LEAVE)throw new Le(te.WS_ABORT);return!this.spec.forceWaitGatewayResponse||a?G.throw():r===Yt.JOIN||r===Yt.REJOIN?null:(await y(),await this.request(r,s))}if(w.isSuccess)return w.message;const R=Number(w.message.error_code||w.message.code),O=Hw(R),D=new Le(te.UNEXPECTED_RESPONSE,"".concat(O.desc,": ").concat(w.message.error_str),{code:R,data:w.message,desc:O.desc});return O.action==="success"?w.message:(x.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(r,", error_code: ").concat(R,", message: ").concat(O.desc,", action: ").concat(O.action)),R===Wt.ERR_TOO_MANY_BROADCASTERS?((r===Yt.JOIN||r===Yt.REJOIN)&&(this.initError=D,this.close()),D.throw()):O.action==="failed"?D.throw():O.action==="quit"?(this.initError=D,this.close(),D.throw()):(R===Wt.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=w.message.option,x.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",Ls.MULTI_IP)):this.reconnect(O.action,Ls.SERVER_ERROR),r===Yt.JOIN||r===Yt.REJOIN?null:await this.request(r,s)))}waitMessage(r,s){return new pt(a=>{const c=d=>{(!s||s(d))&&(this.off(r,c),a(d))};this.on(r,c)})}uploadWRTCStats(r){if(!this.store.sessionId)return void x.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const s={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:r};this.upload(zw.WRTC_STATS,s)}upload(r,s){const a={_type:r,_message:s};try{this.websocket.sendMessage(a)}catch{const d=oe("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(a),this.uploadCache.length>d&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==yr.CONNECTED)return;const h=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(h._type,h._message)},oe("UPLOAD_CACHE_INTERVAL")||2e3))}}send(r,s){const a={_type:r,_message:s};this.websocket.sendMessage(a)}async sendExtensionMessage(r,s,a){return await this._external_signal.send(r,s,a)}init(r){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new pt((s,a)=>{this.once(Jt.WS_CONNECTED,()=>s(this.joinResponse)),this.once(Jt.WS_CLOSED,()=>a(this.initError||new Le(te.WS_ABORT))),this.connectionState=yr.CONNECTING,this.websocket.init(r).catch(a)})}close(r){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._external_signal.clear(),this._disconnectedReason=r||Xn.LEAVE,this.connectionState=yr.CLOSED,x.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close(),this.p2pToken=mr(6,""),this._external_signal.clear(),this._external_signal=new vy(this,this.p2pToken)}async join(){if(!this.joinResponse){this.emit(Jt.ABORT_P2P_EXECUTION);const r=await Ms(this,Jt.REQUEST_JOIN_INFO),s=await this.request(Yt.JOIN,r);if(!s)return this.emit(Jt.REPORT_JOIN_GATEWAY,te.TIMEOUT,this.url||""),!1;this.joinResponse=s,this.emit(Jt.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=yr.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}reconnect(r,s){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(r,s)}handleDataStream(r){try{var s;const a=X_(r.payload),c=new TextDecoder().decode(a),d=JSON.parse(c);"total"in d&&"id"in d||lt(s=Object.values(hi)).call(s,d._type)?(d._uid=r.uid,this._external_signal.onMessage(d)):this.emit(Cn.ON_DATA_STREAM,r)}catch{this.emit(Cn.ON_DATA_STREAM,r)}}handleNotification(r){x.debug("[".concat(this.clientId,"] receive notification: "),r);const s=Hw(r.code);if(s.action!=="success"){if(s.action!=="failed")return s.action==="quit"?(s.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(Xn.UID_BANNED),void this.close()):void this.reconnect(s.action,Ls.SERVER_ERROR);x.error("[".concat(this.clientId,"] ignore error: "),s.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const r=oe("PING_PONG_TIME_OUT"),s=Date.now();this.pingpongTimeoutCount>=r&&(x.warning("[".concat(this.clientId,"] PINGPONG Timeout. Last Socket Message: ").concat(s-this.lastMsgTime,"ms")),s-this.lastMsgTime>oe("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",Ls.TIMEOUT):this.request(Yt.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const a=Date.now()-s;this.rttRolling.add(a),oe("REPORT_STATS")&&this.send(Yt.PING_BACK,{pingpongElapse:a})}).catch(a=>{})}handleWebsocketEvents(){this.websocket.on(rn.RECONNECT_CREATE_CONNECTION,r=>{this.emit(Jt.WS_RECONNECT_CREATE_CONNECTION,r)}),this.websocket.on(rn.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(rn.CLOSED,()=>{this.connectionState=yr.CLOSED}),this.websocket.on(rn.FAILED,()=>{this._disconnectedReason=Xn.NETWORK_ERROR,this.connectionState=yr.CLOSED}),this.websocket.on(rn.RECONNECTING,r=>{this._websocketReconnectReason=r,this.joinResponse=void 0,this.connectionState===yr.CONNECTED?this.connectionState=yr.RECONNECTING:this.connectionState=yr.CONNECTING}),this.websocket.on(rn.WILL_RECONNECT,(r,s,a)=>{r!=="retry"?(x.debug("".concat(this.clientId," websocket will_connect event, renewSession reconnectMode is ").concat(r)),this.reconnectToken=void 0):x.debug("".concat(this.clientId," reconnect mode is retry, no need to renew session")),a(r)}),this.websocket.on(rn.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.join().catch(r=>{if(this.emit(Jt.REPORT_JOIN_GATEWAY,r,this.url||""),r instanceof Le&&r.code===te.UNEXPECTED_RESPONSE&&r.data.code===Wt.ERR_NO_AUTHORIZED)return x.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",Ls.SERVER_ERROR);x.error("[".concat(this.clientId,"] join gateway request failed"),r.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",Ls.SERVER_ERROR):(this.initError=r,this.close())})}),this.websocket.on(rn.REQUEST_NEW_URLS,(r,s)=>{Ms(this,Jt.REQUEST_RECOVER,this.multiIpOption).then(r).catch(s)}),this.websocket.on(rn.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(Cn.ON_TOKEN_PRIVILEGE_DID_EXPIRE)})}}const cEe={name:"P2PChannel",create:function(t){let{store:r,statsCollector:s}=t;return new oEe(r,s)},createSubmodule:function(t){let{store:r,spec:s}=t;return new aEe(s,r)}};function wK(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}function TK(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?wK(Object(s),!0).forEach(function(a){q(t,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):wK(Object(s)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))})}return t}class lEe{constructor(r){q(this,"sessionDesc",void 0),q(this,"localCapabilities",void 0),q(this,"rtpCapabilities",void 0),q(this,"candidates",void 0),q(this,"_originCandidates",void 0),q(this,"iceParameters",void 0),q(this,"dtlsParameters",void 0),q(this,"setup",void 0),q(this,"currentMidIndex",void 0),q(this,"cname",void 0),r=qr(r);const{iceParameters:s,dtlsParameters:a,candidates:c,rtpCapabilities:d,setup:h,localCapabilities:m,sdkCodec:y,cname:v}=r,w=Xa(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE audio video
a=msid-semantic: WMS
a=ice-lite
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:audio
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:video
`);this.rtpCapabilities=d,this.candidates=c,this._originCandidates=qr(c),this.iceParameters=s,this.dtlsParameters=a,this.setup=h,this.localCapabilities=m,this.cname=v;for(let R=0;R<w.mediaDescriptions.length;R++){const O=w.mediaDescriptions[R];if(O.attributes.iceUfrag=s.iceUfrag,O.attributes.icePwd=s.icePwd,O.attributes.fingerprints=a.fingerprints,O.attributes.candidates=c,O.attributes.setup=h,O.media.mediaType==="video"){O.media.fmts=d.videoCodecs.map(G=>G.payloadType.toString(10));let D=d.videoCodecs.filter(G=>{var j,W;return(j=G.rtpMap)===null||j===void 0?void 0:lt(W=j.encodingName.toLowerCase()).call(W,y)});D.length===0&&(D=d.videoCodecs),O.attributes.payloads=D,O.attributes.extmaps=d.videoExtensions}O.media.mediaType==="audio"&&(O.media.fmts=d.audioCodecs.map(D=>D.payloadType.toString(10)),O.attributes.payloads=d.audioCodecs,O.attributes.extmaps=d.audioExtensions),w.mediaDescriptions[R]=this.mungMediaDesc(O)}this.sessionDesc=w,this.currentMidIndex=w.mediaDescriptions.length-1}toString(){return Qm(this.sessionDesc)}send(r,s,a){const{ssrcs:c,ssrcGroups:d}=oy(s,this.cname),h=this.sessionDesc.mediaDescriptions.find(v=>r===bt.VIDEO?v.media.mediaType==="video":v.media.mediaType==="audio"),m=c[0].attributes.label,y=c[0].attributes.mslabel;return h.attributes.ssrcs=h.attributes.ssrcs.concat(c),h.attributes.ssrcGroups=h.attributes.ssrcGroups.concat(d),{id:m,mslabel:y}}batchSend(r){return r.map(s=>{let{kind:a,ssrcMsg:c}=s;return this.send(a,c,void 0)})}stopSending(r){this.sessionDesc.mediaDescriptions.forEach(s=>{const a=[],c=[],d=[];s.attributes.ssrcs.forEach(h=>{lt(r).call(r,h.attributes.label||"")?d.push(h):a.push(h)}),s.attributes.ssrcGroups.forEach(h=>{var m;lt(m=d.map(y=>y.ssrcId)).call(m,h.ssrcIds[0])||c.push(h)}),s.attributes.ssrcs=a,s.attributes.ssrcGroups=c})}mute(r){const s=this.sessionDesc.mediaDescriptions.find(a=>a.attributes.mid===r);if(!s)throw new Error("mediaDescription not found with ".concat(r," in remote SDP when calling RemoteSDP.mute."));s.attributes.direction="inactive"}unmute(r){const s=this.sessionDesc.mediaDescriptions.find(a=>a.attributes.mid===r);if(!s)throw new Error("mediaDescription not found with ".concat(r," in remote SDP when calling RemoteSDP.unmute."));s.attributes.direction="sendonly"}receive(r,s,a){r.forEach((c,d)=>{const h=c._mediaStreamTrack,m=this.sessionDesc.mediaDescriptions.findIndex(v=>v.attributes.mid===h.kind),y=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[m],c);this.sessionDesc.mediaDescriptions[m]=y})}stopReceiving(r){}updateCandidates(r){const s=this._originCandidates.filter(c=>c.transport==="udp"),a=[];if(s.forEach(c=>{a.push(TK(TK({},c),{},{foundation:"tcpcandidate",priority:Number(c.priority)-1+"",transport:"tcp",port:Number(c.port)+90+""}))}),s.length!==0){switch(r){case Qs.TCP_RELAY:this.candidates=a;break;case Qs.UDP_TCP_RELAY:case Qs.RELAY:this.candidates=[...s,...a];break;default:this.candidates=s}for(const c of this.sessionDesc.mediaDescriptions)c.attributes.candidates=this.candidates}}restartICE(r){r=qr(r),this.iceParameters=r,this.sessionDesc.mediaDescriptions.forEach(s=>{s.attributes.iceUfrag=r.iceUfrag,s.attributes.icePwd=r.icePwd})}predictReceivingMids(r){const s=[];for(let a=0;a<r;a++)s.push((this.currentMidIndex+a+1).toString(10));return s}mungRecvMediaDsec(r,s){const a=qr(r);return _S(a,s),S2(a,s),a}updateRecvMedia(r,s){const a=this.sessionDesc.mediaDescriptions.findIndex(c=>c.attributes.mid===r);if(a!==-1){const c=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[a],s);this.sessionDesc.mediaDescriptions[a]=c}}bumpMid(r){this.currentMidIndex+=r}updateTrackLabel(r,s,a){const c=this.sessionDesc.mediaDescriptions.find(h=>r===bt.VIDEO?h.attributes.mid==="video":h.attributes.mid==="audio");if(c){const h=c.attributes.ssrcs.find(m=>m.attributes.label===s);var d;h&&(h.attributes.label=a,(d=h.attributes.msid)===null||d===void 0||d.replace(s,a))}}mungMediaDesc(r){const s=qr(r);return v2(s),function(a){const c=a.attributes.extmaps.find(d=>MP(d.extensionName));c&&a.attributes.extmaps.splice(a.attributes.extmaps.indexOf(c),1),a.attributes.payloads.forEach(d=>{const h=d.rtcpFeedbacks.findIndex(m=>m.type==="transport-cc");h!==-1&&d.rtcpFeedbacks.splice(h,1)})}(s),s}getSSRC(r){for(const s of this.sessionDesc.mediaDescriptions)for(const a of s.attributes.ssrcs)if(a.attributes.label===r)return[a]}}var pr;function CK(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}function SO(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?CK(Object(s),!0).forEach(function(a){q(t,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):CK(Object(s)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))})}return t}let uEe=(pr=class cC extends xH{get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.videoCodecs.map(r=>r.rtpMap&&r.rtpMap.encodingName.toLowerCase()||"").filter(r=>{var s;return lt(s=Object.keys(dP)).call(s,r)}))]}constructor(r,s){super(r,s),q(this,"store",void 0),q(this,"peerConnection",void 0),q(this,"remoteSDP",void 0),q(this,"initialOffer",void 0),q(this,"statsFilter",void 0),q(this,"useRTX",!1),q(this,"localCapabilities",void 0),q(this,"localCandidateCount",0),q(this,"allCandidatesReceived",!1),q(this,"establishPromise",void 0),q(this,"mutex",void 0),this.store=s,this.mutex=new Xs("P2PConnection-mutex",s.clientId),this.peerConnection=new RTCPeerConnection(cC.resolvePCConfiguration(r),{optional:[{googDscp:!0}]}),this.statsFilter=xL(this.peerConnection,oe("STATS_UPDATE_INTERVAL"),void 0,Hr()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async establish(){try{const r=await this.peerConnection.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});if(!r.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const s=rg(r.sdp),a=qw(r.sdp,{filterRTX:!this.useRTX,filterVideoFec:oe("FILTER_VIDEO_FEC"),filterAudioFec:oe("FILTER_AUDIO_FEC"),filterAudioCodec:["opus"]});return this.localCapabilities=a,this.initialOffer=r,SO(SO({},s),{},{rtpCapabilities:{send:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},recv:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},sendrecv:a},offerSDP:r.sdp})}catch(r){throw new Le(te.GET_LOCAL_CONNECTION_PARAMS_FAILED,r.toString())}}async updateRemoteConnect(){}async connect(r){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.remoteSDP=new lEe(SO(SO({},r),{},{rtpCapabilities:r.rtpCapabilities.send,localCapabilities:this.localCapabilities,sdkCodec:this.store.codec}));const s=this.remoteSDP.toString();await this.peerConnection.setLocalDescription(this.initialOffer),await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}catch(s){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(s.toString()))}}async updateRemoteRTPCapabilities(r,s){throw new Le(te.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}getPreMedia(r){}send(r,s){var a=this;return Ll(function*(){const c=yield xn(a.mutex.lock());try{if(!a.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const d=r.map(O=>a.peerConnection.addTrack(O._mediaStreamTrack)),h=yield xn(a.peerConnection.createOffer()),m=Xa(h.sdp),y=r.map(O=>{const D=O._mediaStreamTrack,G=m.mediaDescriptions.find(j=>j.attributes.mid===D.kind);if(!G)throw new Error("Cannot extract ssrc from mediaDescription.");return function(j,W,Q){const ee=j.attributes.ssrcs.filter(ye=>ye.attributes.label===W),fe=j.attributes.ssrcGroups;if(ee.length===0)throw new Error("Cannot extract ssrc from plan-b SDP.");if(fe&&ee.length>1){const ye=fe.find(Ee=>Ee.ssrcIds.indexOf(ee[0].ssrcId)!==-1);return ye?[{ssrcId:ye.ssrcIds[0],rtx:Q?ye.ssrcIds[1]:void 0}]:[{ssrcId:ee[0].ssrcId}]}return[{ssrcId:ee[0].ssrcId}]}(G,D.id,a.useRTX)});let v;try{v=yield y}catch(O){throw d.forEach(D=>{xs()&&D.replaceTrack(null),a.peerConnection.removeTrack(D)}),O}const w=a.mungSendOfferSDP(h.sdp,r);a.remoteSDP.receive(r,s,v);const R=a.remoteSDP.toString();return yield xn(a.peerConnection.setLocalDescription({type:"offer",sdp:w})),yield xn(a.applySendEncodings(d,r)),yield xn(a.peerConnection.setRemoteDescription({type:"answer",sdp:R})),r.map((O,D)=>{const G=O._mediaStreamTrack.id;return{localSSRC:y[D],id:G}})}catch(d){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(d.toString()))}finally{c()}})()}async stopSending(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const s=this.peerConnection.getSenders().filter(d=>{var h;return r.indexOf(((h=d.track)===null||h===void 0?void 0:h.id)||"")!==-1});if(s.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");s.map(d=>{xs()&&d.replaceTrack(null),this.peerConnection.removeTrack(d)});const a=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(a),this.remoteSDP.stopReceiving(r);const c=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:c})}catch(s){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(s.toString()))}}async receive(r,s,a,c){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(r," before remoteSDP created."));const{id:d,mslabel:h}=this.remoteSDP.send(r,s,c),m=new pt((w,R)=>{const O=setTimeout(()=>{R(new Error("Cannot receive track, id: ".concat(d)))},1e4),D=G=>{const j=Ln();if((j.name==="Safari"&&Number(j.version)===11||Ko())&&G.track.id!==d&&G.streams[0].id===h){var W;const Q=G.streams[0].getTracks()[0];return(W=this.remoteSDP)===null||W===void 0||W.updateTrackLabel(r,d,G.track.id),this.peerConnection.removeEventListener("track",D),clearTimeout(O),void w(Q)}if(G.track.id===d)return this.peerConnection.removeEventListener("track",D),clearTimeout(O),void w(G.track)};this.peerConnection.addEventListener("track",D)}),y=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:y});const v=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(v),{track:await m,id:d}}catch(d){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(d.toString()))}}async stopReceiving(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(r);const s=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:s});const a=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(a)}catch(s){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(s.toString()))}}async muteRemote(r){}async unmuteRemote(r){}async muteLocal(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const s=this.peerConnection.getSenders().filter(a=>{var c;return r.indexOf(((c=a.track)===null||c===void 0?void 0:c.id)||"")!==-1});if(s.length!==r.length)throw new Error("sender' length doesn't match mids' length.");s.map(a=>{if(xs()&&a.track)a.track.enabled=!1;else{const c=a.getParameters();c.encodings.forEach(d=>d.active=!1),a.setParameters(c)}})}catch(s){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(s.toString()))}}async unmuteLocal(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const s=this.peerConnection.getSenders().filter(d=>{var h;return r.indexOf(((h=d.track)===null||h===void 0?void 0:h.id)||"")!==-1});if(s.length!==r.length)throw new Error("Senders' length doesn't match mids' length.");s.map(async d=>{if(xs()&&d.track)d.track.enabled=!0;else{const h=d.getParameters();h.encodings.forEach(m=>m.active=!0),await d.setParameters(h)}});const a=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(a);const c=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:c})}catch(s){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(s.toString()))}}restartICE(r){var s=this;return Ll(function*(){const a=yield xn(s.mutex.lock("From P2PConnection.restartICE"));try{if(!s.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");const c=Wn().supportPCSetConfiguration;if(r===Qs.RELAY&&!c)return;if(c){const v=s.peerConnection.getConfiguration(),w=r===Qs.RELAY?"relay":"all";v.iceTransportPolicy!==w&&(x.debug("[".concat(s.store.clientId,"] restartICE change iceTransportPolicy from [").concat(v.iceTransportPolicy,"] to [").concat(w,"]")),v.iceTransportPolicy=w,s.peerConnection.setConfiguration(v))}r!==Qs.RELAY&&s.remoteSDP.updateCandidates(r);const d=yield xn(s.peerConnection.createOffer({iceRestart:!0}));if(!d.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const h=rg(d.sdp),{remoteIceParameters:m}=yield h.iceParameters;s.remoteSDP.restartICE(m);const y=s.remoteSDP.toString();yield xn(s.peerConnection.setLocalDescription(d)),yield xn(s.peerConnection.setRemoteDescription({type:"answer",sdp:y}))}catch(c){x.warning("[".concat(s.store.clientId,"] restart ICE failed, abort operation"),c)}finally{a()}})()}close(){var r;this.peerConnection.close(),(r=this.onConnectionStateChange)===null||r===void 0||r.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(r){return this.statsFilter.getVideoIsReady(r)}async updateEncoderConfig(r,s){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const a=await this.peerConnection.createOffer(),c=this.mungSendOfferSDP(a.sdp,[s]);this.remoteSDP.updateRecvMedia(s._mediaStreamTrack.kind,s);const d=this.remoteSDP.toString();await this.peerConnection.setLocalDescription({type:"offer",sdp:c}),await this.peerConnection.setRemoteDescription({type:"answer",sdp:d})}catch(a){throw new Le(te.EXCHANGE_SDP_FAILED,a.toString())}}async updateSendParameters(r,s){const a=this.peerConnection.getSenders().filter(c=>{var d;return((d=c.track)===null||d===void 0?void 0:d.id)===r});a.length===1&&await this.applySendEncodings(a,[s])}setStatsRemoteVideoIsReady(r,s){this.statsFilter.setVideoIsReady2(r,s)}async replaceTrack(r,s){const a=this.peerConnection.getSenders().find(c=>{var d;return((d=c.track)===null||d===void 0?void 0:d.id)===s});a&&await a.replaceTrack(r._mediaStreamTrack)}createDataChannels(r,s){throw new Le(te.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}stopDataChannels(r){throw new Le(te.NOT_SUPPORTED,"Planb mode does not support stopDataChannels.")}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var r;(r=this.onICEConnectionStateChange)===null||r===void 0||r.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var r;(r=this.onConnectionStateChange)===null||r===void 0||r.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=r=>{r.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,x.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,x.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},oe("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(r){const s={iceServers:[],sdpSemantics:"plan-b"};return r.iceServers?s.iceServers=r.iceServers:r.turnServer&&r.turnServer.mode!=="off"&&(Lw(r.turnServer.servers)?s.iceServers=r.turnServer.servers:(s.iceServers&&s.iceServers.push(...cC.turnServerConfigToIceServers(r.turnServer.servers)),oe("USE_TURN_SERVER_OF_GATEWAY")&&s.iceServers&&r.turnServer.serversFromGateway&&s.iceServers.push(...cC.turnServerConfigToIceServers(r.turnServer.serversFromGateway)),r.turnServer.servers.concat(r.turnServer.serversFromGateway||[]).forEach(a=>{a.forceturn&&(s.iceTransportPolicy="relay")}))),s}static turnServerConfigToIceServers(r){const s=[];return r.forEach(a=>{a.security?a.tcpport&&s.push({username:a.username,credential:a.password,credentialType:"password",urls:"turns:".concat(a.turnServerURL,":").concat(a.tcpport,"?transport=tcp")}):(a.udpport&&s.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":").concat(a.udpport,"?transport=udp")}),a.tcpport&&s.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":").concat(a.tcpport,"?transport=tcp")}))}),s}async updateRtpSenderEncodings(r,s){var a;if(s||(s=this.peerConnection.getSenders().find(v=>{var w;return((w=v.track)===null||w===void 0?void 0:w.id)===r._mediaStreamTrack.id})),!s)return x.warn("[".concat(r.getTrackId(),"] no rtpSender found}"));if(!Wn().supportSetRtpSenderParameters)return x.warn("Browser not support set rtp-sender parameters");const c={},d={};if(r instanceof Ir)switch(r._optimizationMode){case"motion":c.degradationPreference="maintain-framerate";break;case"detail":c.degradationPreference="maintain-resolution";break;default:c.degradationPreference="balanced"}if(oe("DSCP_TYPE")&&pf()){var h;const v=oe("DSCP_TYPE");lt(h=["very-low","low","medium","high"]).call(h,v)&&(d.networkPriority=v)}const m=s.getParameters(),y=(a=m.encodings)===null||a===void 0?void 0:a[0];y&&Object.assign(y,d),Object.assign(m,c),x.debug("[".concat(r.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(m.encodings))),await s.setParameters(m)}async applySendEncodings(r,s){try{if(!Wn().supportSetRtpSenderParameters||r.length!==s.length)return;for(let a=0;a<r.length;a++){const c=r[a],d=s[a];c&&d&&await this.updateRtpSenderEncodings(d,c)}}catch{x.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(r,s){const a=Xa(r);return s.forEach((c,d)=>{const h=c._mediaStreamTrack,m=a.mediaDescriptions.find(y=>y.attributes.mid===h.kind);m&&_S(m,c)}),Qm(a)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=r=>{var s;(s=this.onFirstAudioReceived)===null||s===void 0||s.call(this,r)},this.statsFilter.onFirstVideoReceived=r=>{var s;(s=this.onFirstVideoReceived)===null||s===void 0||s.call(this,r)},this.statsFilter.onFirstAudioDecoded=r=>{var s;(s=this.onFirstAudioDecoded)===null||s===void 0||s.call(this,r)},this.statsFilter.onFirstVideoDecoded=(r,s,a)=>{var c;(c=this.onFirstVideoDecoded)===null||c===void 0||c.call(this,r,s,a)},this.statsFilter.onSelectedLocalCandidateChanged=(r,s)=>{var a;(a=this.onSelectedLocalCandidateChanged)===null||a===void 0||a.call(this,r,s)},this.statsFilter.onSelectedRemoteCandidateChanged=(r,s)=>{var a;(a=this.onSelectedRemoteCandidateChanged)===null||a===void 0||a.call(this,r,s)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0}async batchReceive(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const s=this.remoteSDP.batchSend(r).map((d,h)=>{let{id:m,mslabel:y}=d;const{kind:v}=r[h];return new pt((w,R)=>{const O=setTimeout(()=>{R(new Error("Cannot receive track, id: ".concat(m)))},1e4),D=G=>{const j=Ln();if(j.name==="Safari"&&Number(j.version)===11&&G.track.id!==m&&G.streams[0].id===y){var W;const Q=G.streams[0].getTracks()[0];return(W=this.remoteSDP)===null||W===void 0||W.updateTrackLabel(v,m,G.track.id),this.peerConnection.removeEventListener("track",D),clearTimeout(O),void w({track:Q,id:m})}if(G.track.id===m)return this.peerConnection.removeEventListener("track",D),clearTimeout(O),void w({track:G.track,id:m})};this.peerConnection.addEventListener("track",D)})}),a=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:a});const c=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(c),await pt.all(s)}catch(s){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(s.toString()))}}async getRemoteSSRC(r){if(!this.remoteSDP)return;const s=this.remoteSDP.getSSRC(r);return s==null?void 0:s[0].ssrcId}setConfiguration(r){if(Wn().supportPCSetConfiguration){const s=cC.resolvePCConfiguration(r);this.peerConnection.setConfiguration(s)}}},At(pr.prototype,"connect",[zl],Object.getOwnPropertyDescriptor(pr.prototype,"connect"),pr.prototype),At(pr.prototype,"stopSending",[zl],Object.getOwnPropertyDescriptor(pr.prototype,"stopSending"),pr.prototype),At(pr.prototype,"receive",[zl],Object.getOwnPropertyDescriptor(pr.prototype,"receive"),pr.prototype),At(pr.prototype,"stopReceiving",[zl],Object.getOwnPropertyDescriptor(pr.prototype,"stopReceiving"),pr.prototype),At(pr.prototype,"muteRemote",[zl],Object.getOwnPropertyDescriptor(pr.prototype,"muteRemote"),pr.prototype),At(pr.prototype,"unmuteRemote",[zl],Object.getOwnPropertyDescriptor(pr.prototype,"unmuteRemote"),pr.prototype),At(pr.prototype,"muteLocal",[zl],Object.getOwnPropertyDescriptor(pr.prototype,"muteLocal"),pr.prototype),At(pr.prototype,"unmuteLocal",[zl],Object.getOwnPropertyDescriptor(pr.prototype,"unmuteLocal"),pr.prototype),At(pr.prototype,"close",[zl],Object.getOwnPropertyDescriptor(pr.prototype,"close"),pr.prototype),At(pr.prototype,"updateEncoderConfig",[zl],Object.getOwnPropertyDescriptor(pr.prototype,"updateEncoderConfig"),pr.prototype),At(pr.prototype,"updateSendParameters",[zl],Object.getOwnPropertyDescriptor(pr.prototype,"updateSendParameters"),pr.prototype),At(pr.prototype,"replaceTrack",[zl],Object.getOwnPropertyDescriptor(pr.prototype,"replaceTrack"),pr.prototype),At(pr.prototype,"getRemoteSSRC",[zl],Object.getOwnPropertyDescriptor(pr.prototype,"getRemoteSSRC"),pr.prototype),pr);function zl(t,r,s){const a=t[r];if(typeof a!="function")throw new Error("Cannot use mutex on object property.");return s.value=async function(){const c=this.mutex,d=await c.lock("Locking from P2PConnection.".concat(r));try{for(var h=arguments.length,m=new Array(h),y=0;y<h;y++)m[y]=arguments[y];return await a.apply(this,m)}finally{d()}},s}const dEe={name:"PlanBConnection",create:function(t){let{store:r,spec:s}=t;return new uEe(s,r)}},hEe={interceptLocalAudioFrame:async function(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!Wn().supportWebRTCEncodedTransform)return void x.warning("browser not support audio encoded transform");if(vP.has(t)||!t.track)return;const s={track:t.track};if(hf()){if(!t.createEncodedStreams)return void x.warning("browser not support createEncodedStreams() API");let c=null;try{c=t.createEncodedStreams()}catch(h){return void x.error("create audio-encoded-streams error",h&&h.message)}const d=new TransformStream({transform(h,m){s.controller||(s.controller=m),t.track&&t.track.id!==s.track.id&&(x.debug("audio track changed: ".concat(s.track.id," => ").concat(t.track.id)),s.track.removeEventListener("ended",a),s.track=t.track,s.track.addEventListener("ended",a));const y=r.metadata&&r.metadata();y?function(v,w){const{chunk:R,controller:O}=w,D=oe("ENABLE_AUDIO_PTS_METADATA")?_f.AUDIO_64_BIT_PTS:_f.METADATA;R.data=function(G,j,W){const Q=W.byteLength,ee=Q+i2+yH,fe=n2+r2+ee,ye=new ArrayBuffer(G.byteLength+fe),Ee=new DataView(ye);Ee.setUint8(0,_H),Ee.setUint16(1,ee),Ee.setUint8(3,j),Ee.setUint16(4,Q);for(let Ne=0;Ne<Q;Ne++)Ee.setUint8(6+Ne,W[Ne]);const _e=new Uint8Array(Ee.buffer);return _e.set(new Uint8Array(G),fe),_e.buffer}(R.data,D,v),O.enqueue(R)}(y,{chunk:h,controller:m}):m.enqueue(h)}});c.readable.pipeThrough(d).pipeTo(c.writable)}else if(xs()){if(typeof RTCRtpScriptTransform>"u")return void x.warning("browser not support RTCRtpScriptTransform");const c=EP(),d=new MessageChannel;await new pt(m=>c.onmessage=y=>{y.data==="registered"&&m(void 0)});const h=new RTCRtpScriptTransform(c,{name:"audio-metadata-tx",port:d.port2},[d.port2]);t.transform=h,await new pt(m=>c.onmessage=y=>{y.data==="started"&&m(void 0)}),d.port1.onmessage=m=>{var y;if(m.data.transformed&&t.track&&((y=t.track)===null||y===void 0?void 0:y.id)!==s.track.id)x.debug("audio track changed: ".concat(s.track.id," => ").concat(t.track.id)),s.track.removeEventListener("ended",a),s.track=t.track,s.track.addEventListener("ended",a);else if(m.data.getMetadata){const v=r.metadata&&r.metadata();v&&d.port1.postMessage({metadata:v})}},s.worker=c}function a(){if(t.track){if(this.id!==t.track.id)return;t.track.removeEventListener("ended",a)}const c=vP.get(t);if(c){vP.delete(t);try{var d,h;(d=c.controller)===null||d===void 0||d.terminate(),(h=c.worker)===null||h===void 0||h.terminate()}catch(m){x.warning(m&&m.message)}}}vP.set(t,s),t.track.addEventListener("ended",a)},interceptRemoteAudioFrame:async function(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!Wn().supportWebRTCEncodedTransform)return void x.warning("browser not support audio encoded transform");if(RP.has(t))return;const s={track:t.track,onMetadata:r.onMetadata};if(hf()){if(!t.createEncodedStreams)return void x.warning("browser not support createEncodedStreams() API");gL($n.CHROME,87,116)||(r.enableTopn=!1);let c=null;try{c=t.createEncodedStreams()}catch(h){return void x.error("create audio-encoded-streams error",h&&h.message)}const d=new TransformStream({transform(h,m){s.controller||(s.controller=m),t.track&&t.track.id!==s.track.id&&(x.debug("audio track changed: ".concat(s.track.id," => ").concat(t.track.id)),s.track.removeEventListener("ended",a),s.track=t.track,s.track.addEventListener("ended",a)),r.enableTopn?function(y,v,w){var R;const O=EH(new DataView(v.data));if(!O)return w.enqueue(v);const D=y.track.id;$me.set(D,y.track);const G=(R=O.tlv.find(ye=>ye.tag===_f.AUDIO_LEVEL))===null||R===void 0?void 0:R.value;let j=0;typeof G=="number"&&(j=127-G);const W=Math.round(Math.pow(10,j/60)-1),{selected:Q,speaker:ee}=function(ye,Ee){let _e=uS.get(ye);if(_e||(_e=function(Ne){const Ze=new SH;return uS.set(Ne,Ze),Dd||(Dd=new Gme(oe("TOPN_SILENCE_THRESHOLD")||500),Dd.on("ActiveSpeakerChanged",ft=>{ft!=null&&(wP=ft)})),Dd.addSpeakers([Ze]),Ze}(ye)),uS.size<=bH)return{selected:!0,speaker:_e};if(!Dd)throw new Error("no active speaker detector");return Dd.levelChanged(_e.id,Ee),ry=Dd.loudest.map(Ne=>Ne.id),wP&&!lt(ry).call(ry,wP)&&ry.length>=bH&&ry.pop(),{selected:lt(ry).call(ry,_e.id)||_e.id===wP,speaker:_e}}(y,W),fe=function(ye,Ee,_e){const Ne=xd.get(ye)||new Hme(ye,Ee);return Ne.score=_e,xd.set(ye,Ne),function(Ze){if(TP.set(Ze,!0),!CP)return void(CP=Date.now());const ft=Date.now();ft-CP>1e3&&(TP.get(Ze)?TP.set(Ze,!1):(wH(Ze),TP.delete(Ze)),CP=ft)}(ye),Ne}(D,y.track,ee.energyScore);fe.addSample(Q),fe.active&&(v.data=O.frame.buffer,w.enqueue(v))}(t,h,m):r.enableMetadata?function(y,v,w){const R=EH(new DataView(y.data));if(!R)return v.enqueue(y);const O=R.tlv.find(D=>D.tag===_f.METADATA||D.tag===_f.AUDIO_64_BIT_PTS);O&&w&&O.value instanceof Uint8Array&&w(O.value),y.data=R.frame.buffer,v.enqueue(y)}(h,m,r.onMetadata):m.enqueue(h)}});c.readable.pipeThrough(d).pipeTo(c.writable)}else if(xs()){if(typeof RTCRtpScriptTransform>"u")return void x.warning("browser not support RTCRtpScriptTransform");const c=EP(),d=new MessageChannel;await new pt(m=>c.onmessage=y=>{y.data==="registered"&&m(void 0)});const h=new RTCRtpScriptTransform(c,{name:"audio-metadata-rx",port:d.port2},[d.port2]);t.transform=h,await new pt(m=>c.onmessage=y=>{y.data==="started"&&m(void 0)}),d.port1.onmessage=m=>{var y;m.data.transformed&&t.track&&((y=t.track)===null||y===void 0?void 0:y.id)!==s.track.id?(x.debug("audio track changed: ".concat(s.track.id," => ").concat(t.track.id)),s.track.removeEventListener("ended",a),s.track=t.track,s.track.addEventListener("ended",a)):m.data.metadata&&s.onMetadata&&s.onMetadata(m.data.metadata)},s.worker=c}function a(){t.track.removeEventListener("ended",a),function(c){const d=RP.get(c);if(d){(function(y){const v=uS.get(y);v&&(uS.delete(y),Dd&&(Dd.removeSpeakers([v]),uS.size===0&&(Dd.destroy(),Dd=null)))})(c),wH(c.track.id),RP.delete(c);try{var h,m;(h=d.controller)===null||h===void 0||h.terminate(),(m=d.worker)===null||m===void 0||m.terminate()}catch(y){x.warning(y&&y.message)}}}(t)}RP.set(t,s),t.track.addEventListener("ended",a)},interceptLocalVideoFrame:async function(t,r){if(!Wn().supportWebRTCEncodedTransform)return void x.warning("browser not support video encoded transform");if(IP.has(t)||!t.track)return;const s={track:t.track};if(hf()){if(!t.createEncodedStreams)return void x.warning("browser not support createEncodedStreams() API");let c=null;try{c=t.createEncodedStreams()}catch(m){return void x.error("create video-encoded-streams error",m&&m.message)}const d=[];r.on("sei-to-send",m=>{d.push(m)});const h=new TransformStream({transform(m,y){s.controller||(s.controller=y),t.track&&t.track.id!==s.track.id&&(x.debug("video track changed: ".concat(s.track.id," => ").concat(t.track.id)),s.track.removeEventListener("ended",a),s.track=t.track,s.track.addEventListener("ended",a));const v=d.shift();v&&(m.data=function(w,R){const O=function(ee){const fe=ee.length;let ye=[],Ee=0;for(;Ee<fe;)Ee+2<fe&&ee[Ee]===0&&ee[Ee+1]===0&&(ee[Ee+2]===0||ee[Ee+2]===1||ee[Ee+2]===2||ee[Ee+2]===3)?(ye.push(ee[Ee],ee[Ee+1],3,ee[Ee+2]),Ee+=3):(ye.push(ee[Ee]),Ee++);return new Uint8Array(ye)}(R),D=O.length,G=Math.floor(D/255),j=D%255,W=new Uint8Array(6+G+1+D+w.byteLength);W[0]=0,W[1]=0,W[2]=0,W[3]=1,W[4]=6,W[5]=101;let Q=0;for(;Q<G;)W[6+Q]=255,Q++;return W[6+Q]=j,Q++,W.set(O,6+Q),W.set(new Uint8Array(w),6+Q+D),W.buffer}(m.data,v)),y.enqueue(m)}});c.readable.pipeThrough(h).pipeTo(c.writable)}else{if(!xs())return;{if(typeof RTCRtpScriptTransform>"u")return void x.warning("browser not support RTCRtpScriptTransform");const c=EP(),d=new MessageChannel;await new pt(m=>c.onmessage=y=>{y.data==="registered"&&m(void 0)});const h=new RTCRtpScriptTransform(c,{name:"sei-tx",port:d.port2},[d.port2]);t.transform=h,await new pt(m=>c.onmessage=y=>{y.data==="started"&&m(void 0)}),r.on("sei-to-send",m=>{d.port1.postMessage({sei:m})}),d.port1.onmessage=m=>{var y;m.data.transformed&&t.track&&((y=t.track)===null||y===void 0?void 0:y.id)!==s.track.id&&(x.debug("video track changed: ".concat(s.track.id," => ").concat(t.track.id)),s.track.removeEventListener("ended",a),s.track=t.track,s.track.addEventListener("ended",a))},s.worker=c}}function a(){if(t.track){if(this.id!==t.track.id)return;t.track.removeEventListener("ended",a)}const c=IP.get(t);if(c){IP.delete(t);try{var d,h;(d=c.controller)===null||d===void 0||d.terminate(),(h=c.worker)===null||h===void 0||h.terminate()}catch(m){x.warning(m&&m.message)}}}IP.set(t,s),t.track.addEventListener("ended",a)},interceptRemoteVideoFrame:async function(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!Wn().supportWebRTCEncodedTransform)return void x.warning("browser not support video encoded transform");if(!t.track)return;if(Ww.has(t)){const c=Ww.get(t);return void(c&&(c.onSei=r.onSei))}const s={track:t.track,onSei:r.onSei};if(hf()){if(!t.createEncodedStreams)return void x.warning("browser not support createEncodedStreams() API");let c=null;try{c=t.createEncodedStreams()}catch(h){return void x.error("create video-encoded-streams error",h&&h.message)}const d=new TransformStream({transform(h,m){s.controller||(s.controller=m),t.track&&t.track.id!==s.track.id&&(x.debug("video track changed: ".concat(s.track.id," => ").concat(t.track.id)),s.track.removeEventListener("ended",a),s.track=t.track,s.track.addEventListener("ended",a));const y=function(v){const w=new DataView(v.data);let R=0;for(;R+4<v.data.byteLength;){if(w.getUint8(R+0)===0&&w.getUint8(R+1)===0&&w.getUint8(R+2)===0&&w.getUint8(R+3)===1&&w.getUint8(R+4)===6){let O=R+6,D=0,G=0;for(;(G=w.getUint8(O++))===255;)D+=255;D+=G;const j=Kme(v.data,O,D);return new Uint8Array(j)}R++}return null}(h);y&&s.onSei&&s.onSei(y),m.enqueue(h)}});c.readable.pipeThrough(d).pipeTo(c.writable)}else if(xs()){if(typeof RTCRtpScriptTransform>"u")return void x.warning("browser not support RTCRtpScriptTransform");const c=EP(),d=new MessageChannel;await new pt(m=>c.onmessage=y=>{y.data==="registered"&&m(void 0)});const h=new RTCRtpScriptTransform(c,{name:"sei-rx",port:d.port2},[d.port2]);t.transform=h,await new pt(m=>c.onmessage=y=>{y.data==="started"&&m(void 0)}),d.port1.onmessage=m=>{var y;m.data.transformed&&t.track&&((y=t.track)===null||y===void 0?void 0:y.id)!==s.track.id?(x.debug("video track changed: ".concat(s.track.id," => ").concat(t.track.id)),s.track.removeEventListener("ended",a),s.track=t.track,s.track.addEventListener("ended",a)):m.data.sei&&s.onSei&&s.onSei(m.data.sei)},s.worker=c}function a(){if(t.track){if(this.id!==t.track.id)return;t.track.removeEventListener("ended",a)}(function(c){const d=Ww.get(c);if(d){Ww.delete(c);try{var h,m;(h=d.controller)===null||h===void 0||h.terminate(),(m=d.worker)===null||m===void 0||m.terminate()}catch(y){x.warning(y&&y.message)}}})(t)}Ww.set(t,s),t.track.addEventListener("ended",a)}},pEe={name:"InterceptFrame",create:()=>hEe};LL(),sr("PROCESS_ID","process-".concat(mr(8,""),"-").concat(mr(4,""),"-").concat(mr(4,""),"-").concat(mr(4,""),"-").concat(mr(12,""))),function(){let t;try{t=window.localStorage.getItem("websdk_ng_global_parameter")}catch(r){return void x.error("Error loading sdk config",r.message)}if(t)try{const r=JSON.parse(window.atob(t)),s=Date.now();x.debug("Loading global parameters from cache",r),Object.keys(r).forEach(a=>{if(Object.prototype.hasOwnProperty.call(Rr,a)){const{value:c,expires:d}=r[a];if(d&&d<=s)return;Nd[a]=c,Rr[a]=c}})}catch(r){x.error("Error loading mutableParamsCache: ".concat(t),r.message)}}(),Array.isArray(Nd.AREAS)&&Nd.AREAS.length>0&&R2(Nd.AREAS,!0);const RK=(t,r,s)=>{x.debug("setParameter key:".concat(t,", value:").concat(JSON.stringify(r))),sr(t,r,s)};ig(Mye,!1),ig(jye,!1),ig(y_e,!1),ig(Xye,!1),ig(Dye,!1),ig(cEe,!1),ig(dEe,!1),ig(pEe,!1);const xi=function(t){const r=new Br,s=t,a={getListeners:r.getListeners.bind(r),on:(c,d)=>(function(h,m){h===Mh.SECURITY_POLICY_VIOLATION&&o7(m,!0)}(c,d),r.on.bind(r)(c,d)),addListener:r.addListener.bind(r),once:r.once.bind(r),off:r.off.bind(r),removeAllListeners:r.removeAllListeners.bind(r),emit:r.emit.bind(r),safeEmit:r.safeEmit.bind(r)};return s7(s7({},s),a)}({__TRACK_LIST__:eS,VERSION:Ml,BUILD:VL,ESM_BUNDLER:!1,ESM:!1,UMD:!0,DEV:!1,setParameter:RK,getParameter:oe,getSupportedCodec:async function(){let t={audio:[],video:[]};try{let r=new RTCPeerConnection;const s=await async function(a){let c;return Wn().supportUnifiedPlan?(a.addTransceiver("video",{direction:"recvonly"}),a.addTransceiver("audio",{direction:"recvonly"}),c=(await a.createOffer()).sdp):c=(await a.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0})).sdp,c}(r);if(!s)return t;r.close(),r=null,t=function(a){const c={video:[],audio:[]};return a.match(/ VP8/i)&&c.video.push("VP8"),a.match(/ VP9/i)&&c.video.push("VP9"),a.match(/ AV1/i)&&c.video.push("AV1"),a.match(/ H264/i)&&c.video.push("H264"),a.match(/ H265/i)&&c.video.push("H265"),a.match(/ opus/i)&&c.audio.push("OPUS"),a.match(/ PCMU/i)&&c.audio.push("PCMU"),a.match(/ PCMA/i)&&c.audio.push("PCMA"),a.match(/ G722/i)&&c.audio.push("G722"),c}(s)}catch(r){throw new Ae(te.CREATE_OFFER_FAILED,r.toString&&r.toString()).print()}return t},checkSystemRequirements:function(){const t=Nt.reportApiInvoke(null,{name:Ni.CHECK_SYSTEM_REQUIREMENTS,options:[],tag:Kr.TRACER});let r=!1;try{const d=window.RTCPeerConnection,h=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia,m=window.WebSocket;r=!!(d&&h&&m),r&&vL()&&Iz(75)&&new d().close()}catch(d){return x.error("check system requirement failed: ",d),!1}let s=!1;const a=Ln();a.name===$n.CHROME&&Number(a.version)>=58&&(Od.engine.name!=="WebKit"||function(){const d=Ln();if(nP()){if(d.os===Qi.MAC_OS)return!0;if(d.os===Qi.IOS){const h=Od.os.version&&Od.os.version.split(".");if(h&&Number(h[0])===14&&h[1]&&Number(h[1])>=3||h&&Number(h[0])>14)return!0}}return!1}())&&(s=!0),(a.name===$n.FIREFOX&&Number(a.version)>=56||a.name===$n.OPERA&&Number(a.version)>=45||a.name===$n.SAFARI&&Number(a.version)>=11||a.name==="WebKit"&&(Ko()||Pu())&&a.osVersion&&Number(a.osVersion.split(".")[0])>=11||Dz()||Ln().name===$n.QQ)&&(s=!0),x.debug("checkSystemRequirements, api:",r,"browser",s);const c=r&&s;return t.onSuccess(c),c},getDevices:function(t){return ol.enumerateDevices(!0,!0,t)},getMicrophones:function(t){return ol.getRecordingDevices(t)},getCameras:function(t){return ol.getCamerasDevices(t)},getElectronScreenSources:I8,getPlaybackDevices:function(t){return ol.getSpeakers(t)},createClient:function(){var t;let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{codec:"vp8",audioCodec:"opus",mode:"rtc"};const s=mr(5,"client-"),a=Nt.reportApiInvoke(null,{id:s,name:Ni.CREATE_CLIENT,options:[r],tag:Kr.TRACER});try{(function(c){$i(c.codec,"config.codec",["vp8","vp9","av1","h264","h265"]),$i(c.mode,"config.mode",["rtc","live","p2p"]),c.audioCodec!==void 0&&$i(c.audioCodec,"config.audioCodec",["opus","pcmu","pcma","g722"]),c.proxyServer!==void 0&&_s(c.proxyServer,"config.proxyServer",1,1e4),c.turnServer!==void 0&&Bz(c.turnServer),c.httpRetryConfig!==void 0&&Fz(c.httpRetryConfig),c.websocketRetryConfig!==void 0&&Fz(c.websocketRetryConfig)})(r)}catch(c){throw a.onError(c),c}return(Pz(16,0)||Oz(16,0,!0))&&(r.codec==="vp9"&&(r.codec="vp8",x.debug("browser not support vp9, force use vp8")),sr("UNSUPPORTED_VIDEO_CODEC",["vp9"])),r.audioCodec===void 0&&(r.audioCodec="opus"),a.onSuccess(),new E_e(Uu(Uu({forceWaitGatewayResponse:!0},r),{},{role:lt(t=["rtc","p2p"]).call(t,r.mode)?"host":r.role||"audience"}),s)},createCameraVideoTrack:async function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const r=oe("CAMERA_CAPTURE_CONFIG"),s=mr(8,"track-cam-"),a=Nt.reportApiInvoke(null,{id:s,tag:Kr.TRACER,name:Ni.CREATE_CAM_VIDEO_TRACK,options:[Ur({},t),r]});r&&(t.encoderConfig=r);const c=_P(t);let d=null;x.info("start create camera video track with config",JSON.stringify(t),"trackId",s);try{d=(await sl({video:c},s)).getVideoTracks()[0]||null}catch(m){throw a.onError(m),m}if(!d){const m=new Le(te.UNEXPECTED_ERROR,"can not find track in media stream");return a.onError(m),m.throw(x)}t.optimizationMode&&t2(s,d,t,Dh(t.encoderConfig));const h=new e2(d,t,c,t.scalabiltyMode?pP(t.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t.optimizationMode,s);return a.onSuccess(h.getTrackId()),x.info("create camera video success, trackId:",s),h},createCustomVideoTrack:function(t){const r=mr(8,"track-cus-"),s=Nt.reportApiInvoke(null,{id:r,tag:Kr.TRACER,name:Ni.CREATE_CUSTOM_VIDEO_TRACK,options:[t]}),a=new Ir(t.mediaStreamTrack,{width:t.width,height:t.height,frameRate:t.frameRate,bitrateMax:t.bitrateMax,bitrateMin:t.bitrateMin},t.scalabiltyMode?pP(t.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t.optimizationMode,r,[gr.CUSTOM_TRACK]);return s.onSuccess(a.getTrackId()),x.info("create custom video track success with config",t,"trackId",a.getTrackId()),a},createScreenVideoTrack:async function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"disable";const s=typeof r=="object"?function(O){return U8(O)}(r):void 0;s&&(r="auto");const a=mr(8,"track-scr-v-"),c=Nt.reportApiInvoke(null,{id:a,tag:Kr.TRACER,name:Ni.CREATE_SCREEN_VIDEO_TRACK,options:[Ur({},t),r]});t.encoderConfig?typeof t.encoderConfig=="string"||t.encoderConfig.width&&t.encoderConfig.height||(t.encoderConfig.width={max:1920},t.encoderConfig.height={max:1080}):t.encoderConfig="1080p_2";const d=function(O){const D={};O.screenSourceType&&(D.mediaSource=O.screenSourceType),O.extensionId&&hf()&&(D.extensionId=O.extensionId);const{displaySurface:G,selfBrowserSurface:j,surfaceSwitching:W,systemAudio:Q,preferCurrentTab:ee}=O;(kw(107)||_L(107)||yL(93))&&(G&&($i(G,"displaySurface",["browser","window","monitor"]),D.displaySurface=G),j?($i(j,"selfBrowserSurface",["exclude","include"]),D.selfBrowserSurface=j):D.selfBrowserSurface="include",W&&($i(W,"surfaceSwitching",["exclude","include"]),D.surfaceSwitching=W)),(kw(105)||_L(105)||yL(91))&&Q&&($i(Q,"systemAudio",["exclude","include"]),D.systemAudio=Q),(kw(94)||_L(94)||yL(80))&&ee&&(D.preferCurrentTab=!0),O.electronScreenSourceId&&(D.sourceId=O.electronScreenSourceId);const fe=O.encoderConfig?zL(O.encoderConfig):null;return D.mandatory={chromeMediaSource:"desktop",maxWidth:fe?fe.width:void 0,maxHeight:fe?fe.height:void 0},fe&&(fe.frameRate&&(typeof fe.frameRate=="number"?(D.mandatory.maxFrameRate=fe.frameRate,D.mandatory.minFrameRate=fe.frameRate):(D.mandatory.maxFrameRate=fe.frameRate.max||fe.frameRate.ideal||fe.frameRate.exact||void 0,D.mandatory.minFrameRate=fe.frameRate.min||fe.frameRate.ideal||fe.frameRate.exact||void 0),D.frameRate=fe.frameRate),fe.width&&(D.width=fe.width),fe.height&&(D.height=fe.height)),D}(t);let h=null,m=null;const y=Wn();if(!y.supportShareAudio&&r==="enable"){const O=new Le(te.NOT_SUPPORTED,"your browser or platform is not support share-screen with audio");return c.onError(O),O.throw(x)}x.info("start create screen video track with config",t,"withAudio",r,"trackId",a);const v=y.supportShareAudio&&r!=="disable";try{const O=await sl({screen:d,screenAudio:v?s||!0:void 0},a);h=O.getVideoTracks()[0]||null,m=O.getAudioTracks()[0]||null}catch(O){throw c.onError(O),O}if(!h){const O=new Le(te.UNEXPECTED_ERROR,"can not find track in media stream");return c.onError(O),O.throw(x)}if(!m&&r==="enable"){h&&h.stop();const O=new Le(te.SHARE_AUDIO_NOT_ALLOWED);return c.onError(O),O.throw(x)}t.optimizationMode||(t.optimizationMode="detail"),t.optimizationMode&&(t2(a,h,t,t.encoderConfig&&zL(t.encoderConfig)||void 0),t.encoderConfig&&typeof t.encoderConfig!="string"&&(t.encoderConfig.bitrateMin=t.encoderConfig.bitrateMax));const w=new Ir(h,t.encoderConfig?zL(t.encoderConfig):{},t.scalabiltyMode?pP(t.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t.optimizationMode,a,[gr.SCREEN_TRACK]);if(!m)return c.onSuccess(w.getTrackId()),x.info("create screen video track success","video:",w.getTrackId()),w;const R=new Qr(m,void 0,mr(8,"track-scr-a-"),!1);return c.onSuccess([w.getTrackId(),R.getTrackId()]),x.info("create screen video track success","video:",w.getTrackId(),"audio:",R.getTrackId()),[w,R]},createMicrophoneAndCameraTracks:async function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const s=oe("CAMERA_CAPTURE_CONFIG"),a=mr(8,"track-mic-"),c=mr(8,"track-cam-"),d=Nt.reportApiInvoke(null,{id:"".concat(a,"-").concat(c),tag:Kr.TRACER,name:Ni.CREATE_MIC_AND_CAM_TRACKS,options:[t,r,s]});s&&(r.encoderConfig=s);const h=_P(r),m=V8(t);let y=null,v=null;x.info("start create camera video track(".concat(c,") and microphone audio track(").concat(a,") with config, audio: ").concat(JSON.stringify(t),", video: ").concat(JSON.stringify(r)));try{const O=await sl({audio:m,video:h},"".concat(a,"-").concat(c));y=O.getAudioTracks()[0],v=O.getVideoTracks()[0]}catch(O){throw d.onError(O),O}if(!y||!v){const O=new Le(te.UNEXPECTED_ERROR,"can not find tracks in media stream");return d.onError(O),O.throw(x)}r.optimizationMode&&t2(c,v,r,Dh(r.encoderConfig));const w=new yP(y,t,m,a),R=new e2(v,r,h,r.scalabiltyMode?pP(r.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},r.optimizationMode,c);return d.onSuccess([w.getTrackId(),R.getTrackId()]),x.info("create camera video track(".concat(c,") and microphone audio track(").concat(a,") success")),[w,R]},createMicrophoneAudioTrack:async function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const r=mr(8,"track-mic-"),s=Nt.reportApiInvoke(null,{id:r,tag:Kr.TRACER,name:Ni.CREATE_MIC_AUDIO_TRACK,options:[t]}),a=V8(t);let c=null;x.info("start create microphone audio track with config",JSON.stringify(t),"trackId",r);try{c=(await sl({audio:a},r)).getAudioTracks()[0]||null}catch(h){throw s.onError(h),h}if(!c){const h=new Le(te.UNEXPECTED_ERROR,"can not find track in media stream");return s.onError(h),h.throw(x)}const d=new yP(c,t,a,r);return s.onSuccess(d.getTrackId()),x.info("create microphone audio track success, trackId:",r),d},createCustomAudioTrack:function(t){const r=mr(8,"track-cus-"),s=Nt.reportApiInvoke(null,{id:r,tag:Kr.TRACER,name:Ni.CREATE_CUSTOM_AUDIO_TRACK,options:[t]}),a=new Qr(t.mediaStreamTrack,t.encoderConfig?fP(t.encoderConfig):{},r,!1);return x.info("create custom audio track success with config",t,"trackId",a.getTrackId()),s.onSuccess(a.getTrackId()),a},createBufferSourceAudioTrack:async function(t){var r;const{cacheOnlineFile:s,encoderConfig:a}=t;let{source:c}=t;const d={source:c instanceof AudioBuffer?"AudioBuffer":c instanceof File?(r=File.name)!==null&&r!==void 0?r:"File":c,cacheOnlineFile:s,encoderConfig:a},h=mr(8,"track-buf-"),m=Nt.reportApiInvoke(null,{id:h,tag:Kr.TRACER,name:Ni.CREATE_BUFFER_AUDIO_TRACK,options:[d]});if(oe("DISABLE_WEBAUDIO"))throw new Le(te.NOT_SUPPORTED,"can not create BufferSourceAudioTrack when WebAudio disabled");x.info("start create buffer source audio track with config",JSON.stringify(d),"trackId",h);const y=c;if(!(c instanceof AudioBuffer))try{c=await async function(R,O){let D=null;if(typeof R=="string"){const j=TG.get(R);if(j)return x.debug("use cached audio resource: ",R),j;try{D=(await kd(()=>va.get(R,{responseType:"arraybuffer"}),void 0,void 0,{maxRetryCount:3})).data}catch(W){throw new Le(te.FETCH_AUDIO_FILE_FAILED,W.toString())}}else D=await new pt((W,Q)=>{const ee=new FileReader;ee.onload=fe=>{fe.target?W(fe.target.result):Q(new Le(te.READ_LOCAL_AUDIO_FILE_ERROR))},ee.onerror=()=>{Q(new Le(te.READ_LOCAL_AUDIO_FILE_ERROR))},ee.readAsArrayBuffer(R)});const G=await function(j){const W=oS();return new pt((Q,ee)=>{W.decodeAudioData(j,fe=>{Q(fe)},fe=>{ee(new Le(te.DECODE_AUDIO_FILE_FAILED,fe.toString()))})})}(D);return typeof R=="string"&&O&&TG.set(R,G),G}(c,s)}catch(R){return m.onError(R),R.throw(x)}const v=new jme(c),w=new Vme(y,v,a?fP(a):{},h);return x.info("create buffer source audio track success, trackId:",h),m.onSuccess(w.getTrackId()),w},setAppType:function(t){if(x.debug("setAppType: ".concat(t)),!(Number.isInteger(t)&&t>=0))throw x.debug("Invalid appType"),new Ae(te.INVALID_PARAMS,"invalid app type",t);sr("APP_TYPE",Math.floor(t))},setLogLevel:function(t){x.setLogLevel(t)},enableLogUpload:function(){oe("USE_NEW_LOG")?sr("UPLOAD_LOG",!0):x.enableLogUpload()},disableLogUpload:function(){oe("USE_NEW_LOG")?sr("UPLOAD_LOG",!1):x.disableLogUpload()},createChannelMediaRelayConfiguration:function(){return new T9},checkAudioTrackIsActive:async function(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const s=Nt.reportApiInvoke(null,{tag:Kr.TRACER,name:Ni.CHECK_AUDIO_TRACK_IS_ACTIVE,options:[r]});if(!(t instanceof Qr||t instanceof lS)){const y=new Ae(te.INVALID_TRACK,"the parameter is not a audio track");return s.onError(y),y.throw()}r&&r<1e3&&(r=1e3);const a=t instanceof Qr?t.getTrackLabel():"remote_track",c=t.getVolumeLevel();let d=c,h=c;const m=Date.now();return new pt(y=>{const v=setInterval(()=>{const w=t.getVolumeLevel();d=w>d?w:d,h=w<h?w:h;const R=d-h>1e-4,O=Date.now()-m;if(R||O>r){clearInterval(v);const D=R,G={duration:O,deviceLabel:a,maxVolumeLevel:d,result:D};x.info("[track-".concat(t.getTrackId(),"] check audio track active completed. ").concat(JSON.stringify(G))),s.onSuccess(G),y(D)}},200)})},checkVideoTrackIsActive:async function(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const s=Nt.reportApiInvoke(null,{tag:Kr.TRACER,name:Ni.CHECK_VIDEO_TRACK_IS_ACTIVE,options:[r]});if(!(t instanceof Ir||t instanceof cS)){const R=new Ae(te.INVALID_TRACK,"the parameter is not a video track");return s.onError(R),R.throw()}r&&r<1e3&&(r=1e3);const a=t instanceof Ir?t.getTrackLabel():"remote_track",c=t.getMediaStreamTrack(!0),d=document.createElement("video");d.style.width="1px",d.style.height="1px",d.setAttribute("muted",""),d.muted=!0,d.setAttribute("playsinline",""),d.controls=!1,(xs()||nP())&&(d.style.opacity="0.01",d.style.position="fixed",d.style.left="0",d.style.top="0",document.body.appendChild(d)),d.srcObject=new MediaStream([c]),d.play();const h=document.createElement("canvas");h.width=160,h.height=120;let m=0,y=0;try{const R=Date.now();m=await function(O,D,G,j){let W,Q=0,ee=null;return new pt((fe,ye)=>{function Ee(){Q>j&&W&&(W(),fe(Q));const _e=G.getContext("2d");if(!_e){const ft=new Ae(te.UNEXPECTED_ERROR,"can not get canvas 2d context.");return x.error(ft.toString()),void ye(ft)}_e.drawImage(O,0,0,160,120);const Ne=_e.getImageData(0,0,G.width,G.height),Ze=Math.floor(Ne.data.length/3);if(ee){for(let ft=0;ft<Ze;ft+=3)if(Ne.data[ft]!==ee[ft])return Q+=1,void(ee=Ne.data);ee=Ne.data}else ee=Ne.data}setTimeout(()=>{W&&(W(),fe(Q))},D),W=qL(()=>{Ee()},30)})}(d,r,h,4),y=Date.now()-R}catch(R){throw s.onError(R),R}i_e===$n.SAFARI&&(d.pause(),d.remove()),d.srcObject=null;const v=m>4,w={duration:y,changedPicNum:m,deviceLabel:a,result:v};return x.info("[track-".concat(t.getTrackId(),"] check video track active completed. ").concat(JSON.stringify(w))),s.onSuccess(w),v},setArea:R2,audioElementPlayCenter:Sa,resumeAudioContext:function(){Sa.autoResumeAfterInterruption(!0)},processExternalMediaAEC:function(t){S_e.processExternalMediaAEC(t)},registerExtensions:function(t){const r=oe("PLUGIN_INFO")||[];t.forEach(s=>{"name"in s&&!lt(r).call(r,s.name)&&r.push(s.name);const a=s;a.__registered__=!0,a.logger.hookLog=x.extLog,a.reporter.hookApiInvoke=Nt.extApiInvoke,a.parameters&&Object.keys(a.parameters).forEach(c=>{a.parameters[c]=oe(c)})}),RK("PLUGIN_INFO",r)},ChannelMediaRelayError:hS,ChannelMediaRelayEvent:Ef,ChannelMediaRelayState:Ja,RemoteStreamFallbackType:kme,RemoteStreamType:Ome,ConnectionDisconnectedReason:Xn,AudienceLatencyLevelType:ame,AREAS:Kn,preload:async function(t,r,s,a){return J9(t,r,s,a)}});return Object.defineProperties(xi,{onAudioAutoplayFailed:{get:()=>al.onAudioAutoplayFailed,set:t=>{al.onAudioAutoplayFailed=t}},onAutoplayFailed:{get:()=>al.onAutoplayFailed,set:t=>{al.onAutoplayFailed=t}},_onSecurityPolicyViolation:{value:void 0,writable:!0},_cspEventHandlerPointer:{value:void 0,writable:!0},onSecurityPolicyViolation:{get:()=>xi._onSecurityPolicyViolation,set(t){xi._onSecurityPolicyViolation=t,o7(t)}},__CLIENT_LIST__:{get:()=>oe("SHOW_GLOBAL_CLIENT_LIST")?iy:[]}}),ol.on(ey.CAMERA_DEVICE_CHANGED,t=>{x.info("camera device changed",JSON.stringify(t)),xi.onCameraChanged&&xi.onCameraChanged(t),xi.safeEmit(Mh.CAMERA_CHANGED,t)}),ol.on(ey.RECORDING_DEVICE_CHANGED,t=>{x.info("microphone device changed",JSON.stringify(t)),xi.onMicrophoneChanged&&xi.onMicrophoneChanged(t),xi.safeEmit(Mh.MICROPHONE_CHANGED,t)}),ol.on(ey.PLAYOUT_DEVICE_CHANGED,t=>{x.debug("playout device changed",JSON.stringify(t)),xi.onPlaybackDeviceChanged&&xi.onPlaybackDeviceChanged(t),xi.safeEmit(Mh.PLAYBACK_DEVICE_CHANGED,t)}),Sa.onAutoplayFailed=()=>{x.info("detect audio element autoplay failed"),al.onAudioAutoplayFailed&&al.onAudioAutoplayFailed()},or.on("autoplay-failed",()=>{x.info("detect webaudio autoplay failed"),al.onAudioAutoplayFailed&&al.onAudioAutoplayFailed(),xi.safeEmit(Mh.AUTOPLAY_FAILED)}),or.on(vs.STATE_CHANGE,(t,r)=>{x.info("audio context state changed: ".concat(r," => ").concat(t)),xi.onAudioContextStateChanged&&xi.onAudioContextStateChanged(t,r),xi.safeEmit(Mh.AUDIO_CONTEXT_STATE_CHANGED,t,r)}),Si.on(qv.NETWORK_STATE_CHANGE,(t,r)=>{x.info("[network-indicator] network state changed, ".concat(r," => ").concat(t))}),window&&(window.__ARTC__=xi),xi})}(Vk)),Vk.exports}var b8e=S8e();const sR=Yg(b8e),w8e="a2a7f4eb05284449b1063eb71d8301dc",T8e=sR.createClient({mode:"rtc",codec:"vp8"});let WT=null;const vae=k.createContext(null),Sae=({children:n,appId:e=w8e,channel:i=null,token:o=null,uid:l=null,enabled:u=!0,startMuted:f=!0,onClientReady:_=()=>{}})=>{const[E,b]=k.useState(!1),[C,I]=k.useState(!1),[P,L]=k.useState([]),[M,F]=k.useState(null),[B,Z]=k.useState(null),[K,re]=k.useState(null),[ae,ne]=k.useState(!1),[pe,X]=k.useState(!1),[J,Y]=k.useState(!1),[ie,le]=k.useState(null),[de,ue]=k.useState(!1),Oe=ta(),Ve=k.useRef(T8e),xe=k.useRef({appId:e,channel:i,uid:l,enabled:u}),Re=k.useRef(!1),ve=k.useRef(null);k.useRef(null),k.useEffect(()=>{xe.current={appId:e,channel:i,uid:l,enabled:u}},[e,i,l,u]),k.useEffect(()=>{Z(i)},[i]),k.useEffect(()=>{if(!Ve.current)return;const $e=st=>{H.log(`Connection state changed to: ${st}`),st==="DISCONNECTED"?(b(!1),H.log("Disconnected from Agora")):st==="CONNECTED"&&(b(!0),F(null))};return Ve.current.on("connection-state-change",$e),()=>{Ve.current.off("connection-state-change",$e)}},[]),k.useEffect(()=>{if(!i||!u)return;const $e=async(He,ut)=>{H.log(`User published: ${He.uid}, mediaType: ${ut}`);try{await Ve.current.subscribe(He,ut),ut==="audio"&&He.audioTrack.play(),L(mt=>mt.some(Lt=>Lt.uid===He.uid)?mt:[...mt,He])}catch(mt){H.error("Error subscribing to user:",mt)}},st=(He,ut)=>{H.log(`User unpublished: ${He.uid}, mediaType: ${ut}`),ut==="audio"&&He.audioTrack&&He.audioTrack.stop()},Je=He=>{H.log(`User joined: ${He.uid}`),L(ut=>ut.some(mt=>mt.uid===He.uid)?ut:[...ut,He])},Rt=He=>{H.log(`User left: ${He.uid}`),L(ut=>ut.filter(mt=>mt.uid!==He.uid))};return Ve.current.on("user-published",$e),Ve.current.on("user-unpublished",st),Ve.current.on("user-joined",Je),Ve.current.on("user-left",Rt),(async()=>{if(Re.current){H.log("Already initializing, skipping duplicate initialization");return}Re.current=!0;try{if(E&&ve.current===i){H.log(`Already joined to channel ${i}`),ne(!0),_(Ve.current);return}if(Ve.current.connectionState==="CONNECTING"||Ve.current.connectionState==="CONNECTED")if(ve.current&&ve.current!==i){H.log("Connected to different channel, leaving first");try{await Pe()}catch(He){H.error("Error leaving channel:",He)}}else{b(!0),ne(!0),ve.current=i,WT=i,_(Ve.current);return}H.log(`Joining channel ${i}`),await We(),H.log("Join channel completed")}catch(He){H.error("Error during initialization:",He)}finally{Re.current=!1}})(),()=>{H.log("Cleaning up event listeners"),Ve.current.off("user-published",$e),Ve.current.off("user-unpublished",st),Ve.current.off("user-joined",Je),Ve.current.off("user-left",Rt)}},[i,u,l,_,E]);const be=async()=>{if(!u||K)return K;H.log("Initializing microphone");try{const $e=await sR.createMicrophoneAudioTrack();return await $e.setMuted(f),re($e),H.log("Microphone initialized successfully"),$e}catch($e){return H.error("Error initializing microphone:",$e),F("Failed to initialize microphone. Please check your permissions."),null}};k.useEffect(()=>{(async()=>{if(i)try{const Rt=await Xu(i);Rt&&Rt.voiceDisabled?(H.log("Voice is disabled for this space"),ue(!0),E&&await Pe()):ue(!1)}catch(Je){H.error("Error checking if voice is disabled:",Je)}})();const st=Je=>{Je.detail&&typeof Je.detail.voiceDisabled=="boolean"&&(H.log("Voice setting changed:",Je.detail.voiceDisabled),ue(Je.detail.voiceDisabled),Je.detail.voiceDisabled&&E?Pe():!Je.detail.voiceDisabled&&!E&&u&&i&&We())};return window.addEventListener("SpaceVoiceSettingChanged",st),()=>{window.removeEventListener("SpaceVoiceSettingChanged",st)}},[i,E,u]);const We=async()=>{if(!u)return H.log("Agora is disabled, not joining channel"),!1;if(de)return H.log("Voice is disabled for this space, not joining channel"),F("Voice chat is disabled for this space"),!1;if(!i)return H.error("AgoraProvider: No channel specified"),F("No channel specified"),!1;if(H.log(`joinChannel called for channel ${i} with UID ${l}`),H.log("Current state:",{isJoined:E,isJoining:pe,connectionState:Ve.current.connectionState,joinedChannel:ve.current}),E&&ve.current===i)return H.log(`Already joined to channel: ${i}`),!0;if(pe)return H.log("AgoraProvider: Already in the process of joining"),!1;if(Ve.current.connectionState==="CONNECTED")if(ve.current&&ve.current!==i){H.log("Connected to different channel, leaving first");try{await Pe()}catch($e){H.error("Error leaving channel:",$e)}}else return H.log("Client already connected, setting joined state to true"),b(!0),ne(!0),ve.current=i,WT=i,_(Ve.current),!0;if(Ve.current.connectionState==="CONNECTING")return H.log("Client already connecting, waiting for connection"),X(!0),new Promise($e=>{const st=setInterval(()=>{Ve.current.connectionState==="CONNECTED"&&(clearInterval(st),b(!0),X(!1),ne(!0),ve.current=i,WT=i,_(Ve.current),$e(!0))},500);setTimeout(()=>{clearInterval(st),H.log("AgoraProvider: Connection timeout, considering join failed"),X(!1),$e(!1)},1e4)});try{if(H.log(`Joining channel: ${i} with UID: ${l||"random"}`),H.log(`Using appId: ${e}, Type: ${typeof e}, Length: ${e.length}`),!e||e.trim()===""){const st="AgoraProvider: App ID is empty or invalid";return H.error(st),F(st),X(!1),!1}X(!0);const $e=l||Math.floor(Math.random()*1e6);return await Ve.current.join(e,i,o,$e),H.log(`Joined channel successfully with UID: ${Ve.current.uid}`),b(!0),X(!1),ne(!0),ve.current=i,WT=i,_(Ve.current),!0}catch($e){return H.error("Error joining channel:",$e),F(`Error joining channel: ${$e.toString()}`),X(!1),!1}},Pe=async()=>{if(E)try{K&&await Ve.current.unpublish(K),await Ve.current.leave(),WT=null,ve.current=null,H.log("Left channel successfully"),b(!1),L([])}catch($e){H.error("Error leaving channel:",$e),F($e.message||"Failed to leave channel")}};k.useEffect(()=>()=>{K&&K.close()},[]),k.useEffect(()=>{u&&i&&(!E||ve.current!==i)&&We()},[u,i,E]);const Te=()=>{if(!K)return!1;try{return K.isActive&&!K.muted}catch($e){return H.error("Error checking microphone status:",$e),!1}};k.useEffect(()=>{const $e=()=>{const Je=Te();Je!==C&&(H.log("Syncing microphone state:",{actualStatus:Je,currentState:C}),I(Je),window.dispatchEvent(new CustomEvent("VoiceToggled",{detail:{enabled:Je}})),window.agoraClient&&(window.agoraClient.isVoiceEnabled=Je,window.agoraClient.microphoneTrack=K))};K&&$e();const st=setInterval($e,1e3);return()=>{clearInterval(st)}},[K,C]);const ke=async()=>{var $e;if(de)return H.log("Voice is disabled for this space, cannot toggle"),Oe({title:"Voice Chat Disabled",description:"Voice chat has been disabled for this space by the owner.",status:"info",duration:3e3,isClosable:!0}),!1;try{const st=C!==void 0?C:K?!K.muted:!1;if(H.log("AgoraProvider: Toggling voice, current state:",{isVoiceEnabled:C,currentState:st,hasMicTrack:!!K,trackMuted:K==null?void 0:K.muted}),!K&&(H.log("AgoraProvider: No microphone track, initializing..."),!await be()))return H.error("AgoraProvider: Failed to initialize microphone"),st;const Je=!st;if(H.log("AgoraProvider: New voice state will be:",Je),st){if(K)try{H.log("AgoraProvider: Muting microphone track"),await K.setMuted(!0),K.muted||(H.warn("AgoraProvider: Track not muted after setMuted(true), trying again"),await K.setEnabled(!1)),H.log("AgoraProvider: Microphone track muted successfully, muted state:",K.muted)}catch(Rt){return H.error("Error muting track:",Rt),st}}else if(K)try{Ve.current&&E&&!(($e=Ve.current.localTracks)!=null&&$e.includes(K))&&(H.log("AgoraProvider: Publishing microphone track"),await Ve.current.publish(K),H.log("AgoraProvider: Microphone track published successfully")),H.log("AgoraProvider: Unmuting microphone track"),await K.setMuted(!1),K.muted&&(H.warn("AgoraProvider: Track still muted after setMuted(false), trying again"),await K.setEnabled(!0)),H.log("AgoraProvider: Microphone track unmuted successfully, muted state:",K.muted)}catch(Rt){return H.error("Error unmuting track:",Rt),st}return I(Je),Je}catch(st){return H.error("Error toggling voice:",st),C}},Ue=async $e=>{try{re($e),H.log("Microphone track updated successfully")}catch(st){throw H.error("Error updating microphone track:",st),st}},Be=async()=>{if(!Ve.current||!i)return H.error("AgoraProvider: Voice chat not connected"),!1;try{if(J)return H.log("AgoraProvider: Stopping screen share"),ie&&(Array.isArray(ie)?(await Ve.current.unpublish(ie),ie.forEach($e=>$e.close())):(await Ve.current.unpublish(ie),ie.close()),le(null)),Y(!1),H.log("AgoraProvider: Screen sharing stopped"),typeof window<"u"&&(window.agoraClient||(window.agoraClient={}),window.agoraClient.isScreenSharing=!1,window.agoraClient.screenTrack=null,window.dispatchEvent(new CustomEvent("ScreenShareToggled",{detail:{enabled:!1}}))),!1;H.log("AgoraProvider: Starting screen share");try{const $e=await sR.createScreenVideoTrack({encoderConfig:"1080p_1",optimizationMode:"detail"});return H.log("AgoraProvider: Screen track created:",$e),$e.on("track-ended",()=>{H.log("AgoraProvider: Screen sharing ended by browser UI"),Ve.current.unpublish($e),$e.close(),le(null),Y(!1),typeof window<"u"&&(window.agoraClient||(window.agoraClient={}),window.agoraClient.isScreenSharing=!1,window.agoraClient.screenTrack=null,window.dispatchEvent(new CustomEvent("ScreenShareToggled",{detail:{enabled:!1}})))}),await Ve.current.publish($e),le($e),Y(!0),H.log("AgoraProvider: Screen sharing started"),typeof window<"u"&&(window.agoraClient||(window.agoraClient={}),window.agoraClient.isScreenSharing=!0,window.agoraClient.screenTrack=$e,window.dispatchEvent(new CustomEvent("ScreenShareToggled",{detail:{enabled:!0}}))),!0}catch($e){return H.error("AgoraProvider: Error creating screen track:",$e),Y(!1),le(null),!1}}catch($e){return H.error("AgoraProvider: Error toggling screen share:",$e),Y(!1),le(null),!1}};k.useEffect(()=>{if(H.log("AgoraProvider: Initializing window.agoraClient"),typeof window<"u"){window.agoraClient={isVoiceEnabled:!1,isJoined:!1,client:Ve.current,isScreenSharing:!1,screenTrack:null};const $e=Je=>{H.log("AgoraProvider: Received ToggleScreenShare event"),Be().then(Rt=>{Je.detail&&Je.detail.callback&&Je.detail.callback(!0,Rt)}).catch(Rt=>{H.error("AgoraProvider: Error handling ToggleScreenShare event:",Rt),Je.detail&&Je.detail.callback&&Je.detail.callback(!1,J)})},st=Je=>{H.log("AgoraProvider: Received JoinVoiceChat event"),We().then(Rt=>{Je.detail&&Je.detail.callback&&Je.detail.callback(Rt)}).catch(Rt=>{H.error("AgoraProvider: Error handling JoinVoiceChat event:",Rt),Je.detail&&Je.detail.callback&&Je.detail.callback(!1)})};return window.addEventListener("ToggleScreenShare",$e),window.addEventListener("JoinVoiceChat",st),()=>{window.removeEventListener("ToggleScreenShare",$e),window.removeEventListener("JoinVoiceChat",st),typeof window<"u"&&window.agoraClient&&(H.log("AgoraProvider: Cleaning up window.agoraClient"),window.agoraClient=null)}}return()=>{typeof window<"u"&&window.agoraClient&&(H.log("AgoraProvider: Cleaning up window.agoraClient"),window.agoraClient=null)}},[]),k.useEffect(()=>{H.log("AgoraProvider: Voice enabled state changed:",C),typeof window<"u"&&(window.agoraClient||(window.agoraClient={}),window.agoraClient.isVoiceEnabled=C,window.agoraClient.microphoneTrack=K,window.agoraClient.client=Ve.current,window.dispatchEvent(new CustomEvent("VoiceToggled",{detail:{enabled:C}})),H.log("AgoraProvider: Updated window.agoraClient and dispatched event:",{isVoiceEnabled:C}))},[C,K]);const qe={client:Ve.current,isJoined:E,isVoiceEnabled:C,users:P,error:M,channel:B,appId:e,toggleVoice:ke,leaveChannel:Pe,joinChannel:We,microphoneTrack:K,isReady:ae,createMicrophoneTrack:Ue,isScreenSharing:J,screenTrack:ie,toggleScreenShare:Be,voiceDisabled:de};return S.jsx(vae.Provider,{value:qe,children:n})},bae=()=>{const n=k.useContext(vae);if(!n)throw new Error("useAgoraContext must be used within an AgoraProvider");return n};Sae.propTypes={children:yn.node.isRequired,appId:yn.string.isRequired,channel:yn.string.isRequired,token:yn.string,uid:yn.oneOfType([yn.string,yn.number])};const C8e=()=>{var Re,ve;const{client:n,isVoiceEnabled:e,isJoined:i,users:o,error:l,microphoneTrack:u,isReady:f,channel:_,appId:E,toggleVoice:b,joinChannel:C,leaveChannel:I,createMicrophoneTrack:P,isScreenSharing:L,screenTrack:M,toggleScreenShare:F,voiceDisabled:B}=bae(),[Z,K]=k.useState(e!==void 0?e:((Re=window.agoraClient)==null?void 0:Re.isVoiceEnabled)||!1),[re,ae]=k.useState(L!==void 0?L:((ve=window.agoraClient)==null?void 0:ve.isScreenSharing)||!1),[ne,pe]=k.useState(B!==void 0?B:!1),[X,J]=k.useState(!0);k.useEffect(()=>{var be;e!==void 0?K(e):((be=window.agoraClient)==null?void 0:be.isVoiceEnabled)!==void 0?K(window.agoraClient.isVoiceEnabled):u&&K(!u.muted)},[e,u]),k.useEffect(()=>{var be;L!==void 0?ae(L):((be=window.agoraClient)==null?void 0:be.isScreenSharing)!==void 0&&ae(window.agoraClient.isScreenSharing)},[L]),k.useEffect(()=>{B!==void 0&&pe(B)},[B]);const Y=k.useRef({isVoiceEnabled:Z,isScreenSharing:re,isJoined:i,users:o,error:l,isReady:f,channel:_,appId:E,voiceDisabled:ne});k.useEffect(()=>{Y.current={isVoiceEnabled:Z,isScreenSharing:re,isJoined:i,users:o,error:l,isReady:f,channel:_,appId:E,voiceDisabled:ne}},[Z,re,i,o,l,f,_,E,ne]),k.useEffect(()=>{const be=setTimeout(()=>{J(!1)},5e3);return()=>clearTimeout(be)},[]),k.useEffect(()=>{f&&J(!1)},[f]),k.useEffect(()=>{console.log("useVoiceChat context:",{contextIsVoiceEnabled:e,localVoiceEnabled:Z,contextIsScreenSharing:L,localScreenSharing:re,isJoined:i,users:o.length,error:l,isReady:f,channel:_,appId:E,hasMicrophoneTrack:!!u,trackMuted:u==null?void 0:u.muted,hasScreenTrack:!!M})},[e,Z,L,re,i,o,l,f,_,E,u,M]);const ie=async()=>{try{console.log("useVoiceChat: Toggling voice from:",Z);const be=await b();if(console.log("useVoiceChat: Toggle result:",be),be!==void 0)K(be);else{const We=!Z;K(We),window.agoraClient&&(window.agoraClient.isVoiceEnabled=We)}return be!==void 0?be:!Z}catch(be){return console.error("useVoiceChat: Error toggling voice:",be),Z}},le=async()=>{try{console.log("useVoiceChat: Toggling screen share from:",re);const be=await F();if(console.log("useVoiceChat: Screen share toggle result:",be),be!==void 0)ae(be);else{const We=!re;ae(We),window.agoraClient&&(window.agoraClient.isScreenSharing=We)}return be!==void 0?be:!re}catch(be){return console.error("useVoiceChat: Error toggling screen share:",be),re}},de=async()=>{Z&&u&&await ie()},ue=async()=>{!Z&&u&&await ie()},Oe=be=>o.some(We=>{var Pe;return We.uid===be&&((Pe=We.audioTrack)==null?void 0:Pe.isPlaying)}),Ve=k.useCallback(()=>{if(!u||!Z)return 0;try{return u.getVolumeLevel()}catch(be){return console.error("Error getting volume level:",be),0}},[u,Z]);return{isVoiceEnabled:Z,isScreenSharing:re,isJoined:i,users:o,error:l,toggleVoice:ie,toggleScreenShare:le,mute:de,unmute:ue,isUserSpeaking:Oe,getVolumeLevel:Ve,microphoneTrack:u,screenTrack:M,isLoading:X,channel:_,appId:E,joinChannel:C,leaveChannel:I,client:n,setMicrophoneDevice:async be=>{try{if(!be){console.error("No device ID provided");return}if(!n||!i){console.error("Client not initialized or not joined to a channel");return}u&&(Z&&await n.unpublish(u),await u.close());const We=await sR.createMicrophoneAudioTrack({microphoneId:be,encoderConfig:"music_standard"});P&&await P(We),Z&&await n.publish(We),console.log("Microphone device changed successfully")}catch(We){throw console.error("Error changing microphone device:",We),We}},voiceDisabled:ne}},R8e=({size:n="md",tooltipPlacement:e="top",defaultMuted:i=!0,joinOnClick:o=!0,className:l="voice-button"})=>{const{isVoiceEnabled:u,toggleVoice:f,isJoined:_,joinChannel:E,channel:b,client:C,voiceDisabled:I}=C8e(),[P,L]=k.useState(!1),[M,F]=k.useState(!1);k.useEffect(()=>{const K=()=>{H.log("VoiceButton: Player instantiated, showing button"),F(!0)};return window.addEventListener("PlayerInstantiated",K),window.isPlayerInstantiated&&(H.log("VoiceButton: Player was already instantiated"),F(!0)),()=>{window.removeEventListener("PlayerInstantiated",K)}},[]),k.useEffect(()=>{console.log("VoiceButton: State:",{isVoiceEnabled:u,isJoined:_,channel:b,hasClient:!!C,clientState:C==null?void 0:C.connectionState,windowAgoraClient:window.agoraClient,isPlayerReady:M,voiceDisabled:I})},[u,_,b,C,M,I]);const B=async()=>{if(!(P||I)){L(!0),console.log("VoiceButton: Handling click, current state:",{isVoiceEnabled:u,isJoined:_});try{if(!_&&o)try{console.log("VoiceButton: Not joined, attempting to join channel"),await E(),console.log("VoiceButton: Joined channel successfully")}catch(re){re.message&&re.message.includes("already in connecting/connected state")?console.log("VoiceButton: Already connected to channel"):console.error("VoiceButton: Error joining channel:",re)}console.log("VoiceButton: Toggling voice state from:",u);const K=await f();console.log("VoiceButton: Voice toggled, new state:",K)}catch(K){console.error("VoiceButton: Error toggling voice:",K)}finally{L(!1)}}},Z=()=>I?"Voice chat is disabled for this space":M?P?"Processing...":_?u?"Turn microphone off":"Turn microphone on":"Connecting to voice chat...":"Waiting for player to be ready...";return!M||I?null:S.jsx(Kf,{label:Z(),placement:e,hasArrow:!0,children:S.jsxs(ct,{position:"relative",cursor:"pointer",onClick:B,children:[S.jsx(eu,{size:n,borderRadius:"full",bg:u?"green.500":"red.500",icon:u?S.jsx(Lj,{color:"white"}):S.jsx(xj,{color:"white"}),borderWidth:"1px",borderColor:"whiteAlpha.300",className:l,"data-testid":"voice-button"}),P&&S.jsx(ct,{position:"absolute",top:"0",left:"0",right:"0",bottom:"0",display:"flex",alignItems:"center",justifyContent:"center",bg:"rgba(0, 0, 0, 0.6)",borderRadius:"full",children:S.jsx(nd,{size:"sm",color:"white"})})]})})},I8e=gi.createContext({user:null}),A8e=({userNickname:n})=>{const{client:e,channel:i,screenTrack:o,isScreenSharing:l,toggleScreenShare:u}=bae(),[f,_]=k.useState([]),[E,b]=k.useState(!1),[C,I]=k.useState(!0);k.useRef({});const P=k.useRef(null);k.useRef(null);const{user:L}=k.useContext(I8e)||{user:null},[M,F]=k.useState({}),B=k.useRef(o),[Z,K]=k.useState(null),{isOpen:re,onOpen:ae,onClose:ne}=Xd(),[pe,X]=k.useState(!1),J=k.useRef(null),Y=k.useRef(null);k.useEffect(()=>{B.current=o},[o]),k.useEffect(()=>{if(!e||!i){b(!1);return}const Oe=setTimeout(()=>{I(!1)},5e3);console.log("Setting up screen share display with existing client:",e),console.log("Current channel:",i);const Ve=e.connectionState;if(console.log("Current connection state:",Ve),Ve==="CONNECTED")b(!0),I(!1);else{b(!1);const xe=Re=>{console.log("Connection state changed:",Re),Re==="CONNECTED"?(b(!0),I(!1)):b(!1)};return e.on("connection-state-change",xe),()=>{e.off("connection-state-change",xe),clearTimeout(Oe)}}return()=>{clearTimeout(Oe)}},[e,i]),k.useEffect(()=>{const Oe=async()=>{const Ve={...M};let xe=!1;for(const Re of f){if(M[Re.uid])continue;let ve=null,be=Re.uid;if(typeof be=="string"&&(be.includes("-")?(ve=be.split("-")[0],be=be.split("-")[1]):be.includes("_")&&(ve=be.split("_")[0],be=be.split("_")[1])),be)try{console.log("Trying to fetch nickname for user ID:",be);const We=await td(be);We&&We.Nickname?(console.log("Found nickname in Firebase for user ID:",be,"Nickname:",We.Nickname),Ve[Re.uid]=We.Nickname,xe=!0):ve?(console.log("Using extracted name for user ID:",be,"Name:",ve),Ve[Re.uid]=ve,xe=!0):(Ve[Re.uid]="User",xe=!0)}catch(We){console.error("Error fetching user profile:",We),ve?(Ve[Re.uid]=ve,xe=!0):(Ve[Re.uid]="User",xe=!0)}else ve?(Ve[Re.uid]=ve,xe=!0):(Ve[Re.uid]="User",xe=!0)}xe&&F(Ve)};f.length>0&&Oe()},[f,M]),k.useEffect(()=>{if(!e||!i||!E)return;console.log("Setting up screen share event handlers");const Oe=async(Re,ve)=>{if(console.log("User published:",Re.uid,ve,Re),ve==="video"){console.log("Remote video track detected:",Re.uid);try{await e.subscribe(Re,ve),console.log("Subscribed to remote video track:",Re.uid),_(be=>be.some(We=>We.uid===Re.uid)?be:[...be,Re])}catch(be){console.error("Error subscribing to remote video track:",be)}}},Ve=(Re,ve)=>{if(console.log("User unpublished:",Re.uid,ve),ve==="video"){if(console.log("Remote video track unpublished:",Re.uid),Re.videoTrack)try{Re.videoTrack.stop()}catch(be){console.error("Error stopping video track:",be)}if(_(be=>be.filter(We=>We.uid!==Re.uid)),l&&B.current&&P.current)try{console.log("Ensuring local screen track is still playing after remote user unpublished"),B.current.play(P.current)}catch(be){console.error("Error replaying local screen track:",be)}}},xe=Re=>{console.log("User left:",Re.uid);const ve=f.find(be=>be.uid===Re.uid);if(ve&&ve.videoTrack)try{ve.videoTrack.stop()}catch(be){console.error("Error stopping video track:",be)}if(_(be=>be.filter(We=>We.uid!==Re.uid)),l&&B.current&&P.current)try{console.log("Ensuring local screen track is still playing after remote user left"),B.current.play(P.current)}catch(be){console.error("Error replaying local screen track:",be)}};return e.on("user-published",Oe),e.on("user-unpublished",Ve),e.on("user-left",xe),()=>{e.off("user-published",Oe),e.off("user-unpublished",Ve),e.off("user-left",xe)}},[e,i,E,f,l]),k.useEffect(()=>{if(console.log("Remote screens changed:",f.length,f),f.forEach(Oe=>{if(Oe.videoTrack)try{console.log("Playing video track for:",Oe.uid),Oe.videoTrack.play(`video-container-${Oe.uid}`)}catch(Ve){console.error("Error playing video track:",Ve)}}),l&&B.current&&P.current)try{console.log("Ensuring local screen track is still playing after remote screens changed"),B.current.play(P.current)}catch(Oe){console.error("Error replaying local screen track:",Oe)}},[f,l]),k.useEffect(()=>{if(console.log("Local screen sharing state changed:",l,o),l&&o&&P.current)try{console.log("Playing local screen track"),o.play(P.current)}catch(Oe){console.error("Error playing local screen track:",Oe)}},[l,o]),k.useEffect(()=>()=>{if(f.forEach(Oe=>{if(Oe.videoTrack)try{Oe.videoTrack.stop()}catch(Ve){console.error("Error stopping video track on unmount:",Ve)}}),o)try{o.stop()}catch(Oe){console.error("Error stopping local screen track on unmount:",Oe)}},[f,o]);const ie=()=>{console.log("Stopping local screen share"),u()},le=Oe=>(console.log("Getting display name for UID:",Oe,"type:",typeof Oe),l&&L&&(Oe===L.uid||Oe===(e==null?void 0:e.uid))?n||"You":M[Oe]?M[Oe]:typeof Oe=="string"?Oe.includes("-")?Oe.split("-")[0]:Oe.includes("_")?Oe.split("_")[0]:Oe:"User"),de=Oe=>{console.log("Opening modal for remote screen",Oe),K(Oe),ae()},ue=()=>{console.log("Opening modal for local screen"),K({isLocal:!0}),ae()};return k.useEffect(()=>{re&&Z?(console.log("Modal opened, activeScreen:",Z),setTimeout(()=>{if(Z.isLocal&&B.current)try{console.log("Playing local screen in modal"),B.current.play("modal-screen-container"),X(!0)}catch(Oe){console.error("Error playing local screen in modal:",Oe)}else if(Z.videoTrack)try{console.log("Playing remote screen in modal"),Z.videoTrack.play("modal-screen-container"),X(!0)}catch(Oe){console.error("Error playing remote screen in modal:",Oe)}},500)):re||(X(!1),K(null),setTimeout(()=>{if(l&&B.current)try{B.current.play("local-screen-container")}catch(Oe){console.error("Error playing local screen in small container:",Oe)}f.forEach(Oe=>{if(Oe.videoTrack)try{Oe.videoTrack.play(`video-container-${Oe.uid}`)}catch(Ve){console.error(`Error playing remote screen ${Oe.uid} in small container:`,Ve)}})},500))},[re,Z,l,f]),!E||C&&f.length===0&&!l||f.length===0&&!l?null:S.jsxs(S.Fragment,{children:[!re&&S.jsxs(ct,{position:"fixed",top:"20px",left:"20px",zIndex:1e4,overflow:"visible",ref:J,children:[l&&o&&S.jsxs(ct,{position:"relative",mb:4,borderRadius:"md",overflow:"hidden",boxShadow:"xl",bg:"black",width:"200px",height:"120px",cursor:"pointer",transition:"all 0.2s",_hover:{filter:"brightness(0.8)",transform:"scale(1.05)"},onClick:ue,children:[S.jsx(ct,{id:"local-screen-container",width:"100%",height:"100%",position:"relative"}),S.jsx(ct,{position:"absolute",bottom:2,left:2,color:"white",fontSize:"xs",bg:"rgba(0,0,0,0.5)",px:2,py:1,borderRadius:"md",zIndex:5,children:n?`${n}'s Screen`:"Your Screen"})]}),f.map(Oe=>{const Ve=M[Oe.uid]||le(Oe.uid);return S.jsxs(ct,{position:"relative",mb:4,borderRadius:"md",overflow:"hidden",boxShadow:"xl",bg:"black",width:"200px",height:"120px",cursor:"pointer",transition:"all 0.2s",_hover:{filter:"brightness(0.8)",transform:"scale(1.05)"},onClick:()=>de(Oe),children:[S.jsx(ct,{id:`video-container-${Oe.uid}`,width:"100%",height:"100%",position:"relative"}),S.jsx(ct,{position:"absolute",bottom:2,left:2,color:"white",fontSize:"xs",bg:"rgba(0,0,0,0.5)",px:2,py:1,borderRadius:"md",zIndex:5,children:`${Ve}'s Screen`})]},Oe.uid)})]}),re&&S.jsx(ct,{position:"fixed",top:"0",left:"0",width:"100vw",height:"100vh",bg:"rgba(0,0,0,0.8)",zIndex:1e4,display:"flex",justifyContent:"center",alignItems:"center",onClick:ne,children:S.jsxs(ct,{width:"80vw",height:"80vh",bg:"black",borderRadius:"md",overflow:"hidden",position:"relative",onClick:Oe=>Oe.stopPropagation(),children:[!pe&&S.jsxs(ct,{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",color:"white",textAlign:"center",children:[S.jsx(nd,{size:"xl"}),S.jsx(tt,{mt:4,children:"Loading screen share..."})]}),S.jsx(ct,{id:"modal-screen-container",width:"100%",height:"100%",position:"relative",ref:Y}),S.jsx(ct,{position:"absolute",top:2,right:2,color:"white",bg:"rgba(0,0,0,0.5)",borderRadius:"full",width:"30px",height:"30px",display:"flex",justifyContent:"center",alignItems:"center",cursor:"pointer",onClick:ne,children:""}),S.jsx(ct,{position:"absolute",bottom:4,left:4,color:"white",fontSize:"sm",bg:"rgba(0,0,0,0.5)",px:3,py:2,borderRadius:"md",children:Z!=null&&Z.isLocal?n?`${n}'s Screen`:"Your Screen":`${M[Z==null?void 0:Z.uid]||le(Z==null?void 0:Z.uid)}'s Screen`}),(Z==null?void 0:Z.isLocal)&&S.jsx(ct,{position:"absolute",bottom:4,right:4,children:S.jsx(jn,{colorScheme:"red",size:"sm",onClick:ie,children:"Stop Sharing"})})]})})]})},P8e=({onClose:n})=>{const e=ta(),[i,o]=k.useState(!1),[l,u]=k.useState(!1);k.useEffect(()=>{const E=()=>{window.agoraClient&&u(!!window.agoraClient.isScreenSharing)};E();const b=setInterval(E,1e3),C=()=>{E()};return window.addEventListener("ScreenShareToggled",C),()=>{clearInterval(b),window.removeEventListener("ScreenShareToggled",C)}},[]);const f=async E=>{if(E.preventDefault(),E.stopPropagation(),n&&n(),!window.agoraClient||!window.agoraClient.client){e({title:"Screen sharing not available",description:"Voice chat must be connected to use screen sharing",status:"warning",duration:3e3,isClosable:!0});return}try{if(o(!0),window.agoraClient.isJoined)_();else{console.log("ScreenShareMenuOption: Not joined to voice chat, joining automatically");const b=new CustomEvent("JoinVoiceChat",{detail:{callback:C=>{if(!C){console.error("ScreenShareMenuOption: Failed to join voice chat"),e({title:"Connection failed",description:"Could not connect to voice chat",status:"error",duration:3e3,isClosable:!0}),o(!1);return}_()}}});window.dispatchEvent(b)}}catch(b){console.error("Error in screen share handler:",b),o(!1),e({title:"Screen sharing error",description:b.message||"Failed to toggle screen sharing",status:"error",duration:5e3,isClosable:!0})}},_=async()=>{try{const E=new CustomEvent("ToggleScreenShare",{detail:{callback:(b,C)=>{o(!1),b?(u(C),e(C?{title:"Screen sharing started",status:"success",duration:3e3,isClosable:!0}:{title:"Screen sharing stopped",status:"info",duration:3e3,isClosable:!0})):e({title:"Screen sharing error",description:"Failed to toggle screen sharing",status:"error",duration:5e3,isClosable:!0})}}});window.dispatchEvent(E)}catch(E){console.error("Error toggling screen share:",E),o(!1),e({title:"Screen sharing error",description:E.message||"Failed to toggle screen sharing",status:"error",duration:5e3,isClosable:!0})}};return S.jsx(tt,{fontSize:"md",cursor:"pointer",_hover:{bg:"whiteAlpha.200"},p:2,borderRadius:"md",onClick:f,color:l?"red.300":"white",children:i?"Connecting...":l?"Stop Screen Sharing":"Share Screen"})};function O8e({open:n,onClose:e}){const[i,o]=k.useState(0);return S.jsxs(hs,{isOpen:n,onClose:e,size:"md",isCentered:!0,children:[S.jsx(fs,{backdropFilter:"blur(4px)"}),S.jsxs(ps,{bg:"rgba(23, 25, 35, 0.95)",color:"white",borderRadius:"md",boxShadow:"0 4px 20px rgba(0, 0, 0, 0.5)",maxW:"600px",h:"350px",overflow:"hidden",children:[S.jsx(yo,{borderBottom:"1px solid",borderColor:"whiteAlpha.200",py:2,fontSize:"md",fontWeight:"600",children:"Controls"}),S.jsx($s,{size:"sm",color:"whiteAlpha.700",_hover:{color:"white",bg:"whiteAlpha.100"}}),S.jsx(bs,{p:0,display:"flex",children:S.jsxs(L0,{orientation:"vertical",variant:"unstyled",index:i,onChange:o,display:"flex",flexGrow:1,children:[S.jsxs(M0,{bg:"rgba(0, 0, 0, 0.2)",w:"80px",py:4,borderRight:"1px solid",borderColor:"whiteAlpha.200",children:[S.jsxs(Pa,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[S.jsx(vn,{as:i8e,mb:1}),S.jsx(tt,{fontSize:"xs",children:"Movement"})]}),S.jsxs(Pa,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[S.jsx(vn,{as:s8e,mb:1}),S.jsx(tt,{fontSize:"xs",children:"Camera"})]}),S.jsxs(Pa,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[S.jsx(vn,{as:n8e,mb:1}),S.jsx(tt,{fontSize:"xs",children:"Actions"})]}),S.jsxs(Pa,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[S.jsx(vn,{as:r8e,mb:1}),S.jsx(tt,{fontSize:"xs",children:"Tips"})]})]}),S.jsxs(KC,{flexGrow:1,display:"flex",flexDirection:"column",children:[S.jsxs(Oc,{p:4,display:"flex",flexDirection:"column",h:"100%",children:[S.jsx(tt,{fontSize:"sm",fontWeight:"600",mb:3,color:"blue.300",children:"Movement Controls"}),S.jsxs(Cr,{wrap:"wrap",gap:3,children:[S.jsx(Hl,{keyLabel:"W",description:"Move Forward"}),S.jsx(Hl,{keyLabel:"A",description:"Move Left"}),S.jsx(Hl,{keyLabel:"S",description:"Move Backward"}),S.jsx(Hl,{keyLabel:"D",description:"Move Right"}),S.jsx(Hl,{keyLabel:"Shift",description:"Run"}),S.jsx(Hl,{keyLabel:"Space",description:"Jump / Double Jump"})]})]}),S.jsxs(Oc,{p:4,display:"flex",flexDirection:"column",h:"100%",children:[S.jsx(tt,{fontSize:"sm",fontWeight:"600",mb:3,color:"blue.300",children:"Camera Controls"}),S.jsxs(Cr,{wrap:"wrap",gap:3,children:[S.jsx(Hl,{keyLabel:"Mouse",description:"Look Around"}),S.jsx(Hl,{keyLabel:"Click + Drag",description:"Rotate Camera"}),S.jsx(Hl,{keyLabel:"Scroll",description:"Zoom In/Out"})]})]}),S.jsxs(Oc,{p:4,display:"flex",flexDirection:"column",h:"100%",children:[S.jsx(tt,{fontSize:"sm",fontWeight:"600",mb:3,color:"blue.300",children:"Action Controls"}),S.jsxs(Cr,{wrap:"wrap",gap:3,children:[S.jsx(Hl,{keyLabel:"E",description:"Interact"}),S.jsx(Hl,{keyLabel:"F",description:"Emote Menu"}),S.jsx(Hl,{keyLabel:"T",description:"Chat"}),S.jsx(Hl,{keyLabel:"M",description:"Mute Mic"})]})]}),S.jsxs(Oc,{p:4,display:"flex",flexDirection:"column",h:"100%",children:[S.jsx(tt,{fontSize:"sm",fontWeight:"600",mb:3,color:"blue.300",children:"Tips & Tricks"}),S.jsxs(Fr,{align:"stretch",spacing:2,children:[S.jsx(tt,{fontSize:"xs",children:" Double-tap Shift to auto-run"}),S.jsx(tt,{fontSize:"xs",children:" Press ESC to access settings"}),S.jsx(tt,{fontSize:"xs",children:" Click on players to view their profile"}),S.jsx(tt,{fontSize:"xs",children:" Use the minimap to navigate"})]})]})]})]})})]})]})}const Hl=({keyLabel:n,description:e})=>S.jsx(ct,{bg:"whiteAlpha.100",borderRadius:"md",p:2,minW:"120px",maxW:"180px",children:S.jsxs(Er,{spacing:2,children:[S.jsx(ct,{bg:"whiteAlpha.200",borderRadius:"md",px:2,py:1,fontSize:"xs",fontWeight:"bold",minW:"30px",textAlign:"center",children:n}),S.jsx(tt,{fontSize:"xs",children:e})]})}),k8e=()=>{const[n,e]=k.useState([]),[i,o]=k.useState(""),[l,u]=k.useState(0),[f,_]=k.useState(100),[E,b]=k.useState(100),[C,I]=k.useState(!0),[P,L]=k.useState(!0),[M,F]=k.useState(!1);k.useEffect(()=>{(async()=>{try{await navigator.mediaDevices.getUserMedia({audio:!0});const ne=await sR.getMicrophones();e(ne),ne.length>0&&o(ne[0].deviceId)}catch(ne){console.error("Error getting audio devices:",ne)}})()},[]),k.useEffect(()=>{const ae=setInterval(()=>{u(M?Math.random()*50:0)},100);return()=>clearInterval(ae)},[M]);const B=ae=>{const ne=ae.target.value;o(ne),console.log("Microphone changed to:",ne)},Z=ae=>{_(ae),console.log("Microphone volume set to:",ae)},K=ae=>{b(ae),console.log("Speaker volume set to:",ae)},re=()=>{F(!M)};return S.jsxs(Fr,{spacing:6,align:"stretch",children:[S.jsxs(ur,{children:[S.jsxs(ei,{children:["Microphone",S.jsx(Vf,{ml:2,colorScheme:M?"green":"red",children:M?"Enabled":"Muted"})]}),S.jsxs(Lre,{value:i,onChange:B,bg:"gray.700",borderColor:"gray.600",_hover:{borderColor:"gray.500"},children:[n.map(ae=>S.jsx("option",{value:ae.deviceId,children:ae.label||`Microphone ${ae.deviceId.slice(0,5)}...`},ae.deviceId)),n.length===0&&S.jsx("option",{value:"",children:"No microphones found"})]})]}),S.jsxs(ct,{children:[S.jsx(tt,{mb:2,children:"Microphone Level"}),S.jsx(Ky,{value:l,colorScheme:"green",size:"sm",borderRadius:"md",hasStripe:l>20,isAnimated:l>20})]}),S.jsxs(ur,{children:[S.jsxs(ei,{children:["Microphone Volume: ",f,"%"]}),S.jsxs(HV,{value:f,onChange:Z,min:0,max:100,step:1,colorScheme:"blue",children:[S.jsx(KV,{bg:"gray.700",children:S.jsx(qV,{})}),S.jsx($V,{boxSize:6})]})]}),S.jsxs(ur,{children:[S.jsxs(ei,{children:["Speaker Volume: ",E,"%"]}),S.jsxs(HV,{value:E,onChange:K,min:0,max:100,step:1,colorScheme:"blue",children:[S.jsx(KV,{bg:"gray.700",children:S.jsx(qV,{})}),S.jsx($V,{boxSize:6})]})]}),S.jsxs(ur,{display:"flex",alignItems:"center",children:[S.jsx(ei,{mb:"0",children:"Microphone Enabled"}),S.jsx(yp,{isChecked:M,onChange:re,colorScheme:"green",size:"lg"})]}),S.jsxs(ur,{display:"flex",alignItems:"center",children:[S.jsx(ei,{mb:"0",children:"Echo Cancellation"}),S.jsx(yp,{isChecked:C,onChange:()=>I(!C),colorScheme:"green",size:"lg"})]}),S.jsxs(ur,{display:"flex",alignItems:"center",children:[S.jsx(ei,{mb:"0",children:"Noise Suppression"}),S.jsx(yp,{isChecked:P,onChange:()=>L(!P),colorScheme:"green",size:"lg"})]}),S.jsxs(op,{status:"info",borderRadius:"md",children:[S.jsx(ap,{}),"Note: These settings will be applied when you join a voice chat."]})]})};function N8e({open:n,onClose:e,containerRef:i}){return S.jsx(ru,{containerRef:i,children:S.jsxs(hs,{isOpen:n,onClose:e,size:"lg",isCentered:!0,children:[S.jsx(fs,{}),S.jsxs(ps,{bg:"gray.900",color:"white",borderRadius:"lg",children:[S.jsx(yo,{children:"Settings"}),S.jsx($s,{size:"lg",bg:"gray.700",color:"white",borderRadius:"full",_hover:{bg:"gray.600"},_focus:{boxShadow:"none"}}),S.jsx(bs,{children:S.jsxs(L0,{variant:"enclosed",children:[S.jsxs(M0,{mb:4,children:[S.jsx(Pa,{_selected:{color:"white",borderBottom:"2px solid white"},children:"Audio"}),S.jsx(Pa,{_selected:{color:"white",borderBottom:"2px solid white"},children:"Graphics"})]}),S.jsxs(KC,{children:[S.jsx(Oc,{children:S.jsx(ct,{p:4,bg:"gray.800",borderRadius:"md",children:S.jsx(k8e,{})})}),S.jsx(Oc,{children:S.jsx(ct,{p:4,bg:"gray.800",borderRadius:"md",children:"Graphics settings content goes here."})})]})]})})]})]})})}function D8e(n){return xr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"circle",attr:{cx:"12",cy:"8",r:"7"}},{tag:"polyline",attr:{points:"8.21 13.89 7 23 12 20 17 23 15.79 13.88"}}]})(n)}function x8e(n){return xr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"}},{tag:"circle",attr:{cx:"12",cy:"13",r:"4"}}]})(n)}function qQ(n){return xr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"rect",attr:{x:"2",y:"2",width:"20",height:"20",rx:"2.18",ry:"2.18"}},{tag:"line",attr:{x1:"7",y1:"2",x2:"7",y2:"22"}},{tag:"line",attr:{x1:"17",y1:"2",x2:"17",y2:"22"}},{tag:"line",attr:{x1:"2",y1:"12",x2:"22",y2:"12"}},{tag:"line",attr:{x1:"2",y1:"7",x2:"7",y2:"7"}},{tag:"line",attr:{x1:"2",y1:"17",x2:"7",y2:"17"}},{tag:"line",attr:{x1:"17",y1:"17",x2:"22",y2:"17"}},{tag:"line",attr:{x1:"17",y1:"7",x2:"22",y2:"7"}}]})(n)}function My(n){return xr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"rect",attr:{x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2"}},{tag:"circle",attr:{cx:"8.5",cy:"8.5",r:"1.5"}},{tag:"polyline",attr:{points:"21 15 16 10 5 21"}}]})(n)}function wae(n){return xr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"circle",attr:{cx:"12",cy:"12",r:"10"}},{tag:"line",attr:{x1:"12",y1:"16",x2:"12",y2:"12"}},{tag:"line",attr:{x1:"12",y1:"8",x2:"12.01",y2:"8"}}]})(n)}function L8e(n){return xr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"}},{tag:"path",attr:{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"}}]})(n)}function M8e(n){return xr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"circle",attr:{cx:"12",cy:"12",r:"3"}},{tag:"path",attr:{d:"M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"}}]})(n)}function U8e(n){return xr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polygon",attr:{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"}}]})(n)}function b0(n){return xr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polyline",attr:{points:"3 6 5 6 21 6"}},{tag:"path",attr:{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"}},{tag:"line",attr:{x1:"10",y1:"11",x2:"10",y2:"17"}},{tag:"line",attr:{x1:"14",y1:"11",x2:"14",y2:"17"}}]})(n)}function jk(n){return xr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}},{tag:"polyline",attr:{points:"17 8 12 3 7 8"}},{tag:"line",attr:{x1:"12",y1:"3",x2:"12",y2:"15"}}]})(n)}function YQ(n){return xr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"}},{tag:"circle",attr:{cx:"9",cy:"7",r:"4"}},{tag:"path",attr:{d:"M23 21v-2a4 4 0 0 0-3-3.87"}},{tag:"path",attr:{d:"M16 3.13a4 4 0 0 1 0 7.75"}}]})(n)}function o0(n){return xr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polygon",attr:{points:"23 7 16 12 23 17 23 7"}},{tag:"rect",attr:{x:"1",y:"5",width:"15",height:"14",rx:"2",ry:"2"}}]})(n)}function V8e(n){return xr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polygon",attr:{points:"11 5 6 9 2 9 2 15 6 15 11 19 11 5"}},{tag:"path",attr:{d:"M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"}}]})(n)}const j8e=async()=>{try{H.log("tagsFirestore: Fetching all tags");const n=Sl(Dn,"tags"),e=await ed(n),i=[];return e.forEach(o=>{i.push({id:o.id,...o.data()})}),i}catch(n){throw H.error("tagsFirestore: Error fetching tags:",n),n}},F8e=async n=>{try{H.log(`tagsFirestore: Fetching tag with ID: ${n}`);const e=dr(Dn,"tags",n),i=await _o(e);return i.exists()?{id:i.id,...i.data()}:(H.warn(`tagsFirestore: Tag with ID ${n} not found`),null)}catch(e){throw H.error(`tagsFirestore: Error fetching tag with ID ${n}:`,e),e}},B8e=async({id:n,name:e,color:i,description:o})=>{try{H.log(`tagsFirestore: Creating new tag: ${e}`);const l={name:e,color:i||"#808080",description:o||"",createdAt:new Date,updatedAt:new Date};let u;if(n){const f=dr(Dn,"tags",n);await qg(f,l),u=n}else{const f=Sl(Dn,"tags");u=(await BBe(f,l)).id}return{id:u,...l}}catch(l){throw H.error("tagsFirestore: Error creating tag:",l),l}},W8e=async(n,e)=>{try{H.log(`tagsFirestore: Adding tag ${e} to space ${n}`);const i=dr(Dn,"tags",e);if(!(await _o(i)).exists())throw new Error(`Tag with ID ${e} does not exist`);const l=dr(Dn,"spaces",n);return await ms(l,{tags:WBe(e)}),!0}catch(i){throw H.error(`tagsFirestore: Error adding tag ${e} to space ${n}:`,i),i}},z8e=async(n,e)=>{try{H.log(`tagsFirestore: Removing tag ${e} from space ${n}`);const i=dr(Dn,"spaces",n);return await ms(i,{tags:zBe(e)}),!0}catch(i){throw H.error(`tagsFirestore: Error removing tag ${e} from space ${n}:`,i),i}},G8e=async n=>{try{H.log(`tagsFirestore: Getting tags for space ${n}`);const e=dr(Dn,"spaces",n),i=await _o(e);if(!i.exists())throw new Error(`Space with ID ${n} not found`);const l=i.data().tags||[];if(l.length===0)return[];const u=[];for(const f of l){const _=await F8e(f);_&&u.push(_)}return u}catch(e){throw H.error(`tagsFirestore: Error getting tags for space ${n}:`,e),e}},H8e=async()=>{H.log("tagsFirestore: Initializing default tags");const n=[{id:"collaboration",name:"Collaboration",color:"#4287f5",description:"Spaces designed for team collaboration and meetings"},{id:"social",name:"Social",color:"#f54242",description:"Social gathering and networking spaces"},{id:"education",name:"Education",color:"#42f581",description:"Learning and educational environments"},{id:"events",name:"Events",color:"#f5a742",description:"Spaces optimized for hosting events"},{id:"showcase",name:"Showcase",color:"#9f42f5",description:"Spaces for exhibiting content and creations"},{id:"entertainment",name:"Entertainment",color:"#f542b3",description:"Entertainment and leisure spaces"},{id:"productivity",name:"Productivity",color:"#42dbf5",description:"Spaces focused on work and productivity"},{id:"featured",name:"Featured",color:"#f5f242",description:"Featured and highlighted spaces"}];try{let e=0,i=0;for(const o of n){H.log(`tagsFirestore: Processing tag: ${o.name}`);const l=dr(Dn,"tags",o.id);(await _o(l)).exists()?(H.log(`tagsFirestore: Tag ${o.id} already exists, skipping`),i++):(await B8e(o),e++,H.log(`tagsFirestore: Created tag: ${o.name}`))}return H.log(`tagsFirestore: Tags initialization complete. Created: ${e}, Skipped: ${i}`),{created:e,skipped:i}}catch(e){throw H.error("tagsFirestore: Error initializing default tags:",e),e}},Tae=({spaceID:n})=>{const[e,i]=k.useState([]),[o,l]=k.useState([]),[u,f]=k.useState(!0),[_,E]=k.useState(!1),[b,C]=k.useState(!1),[I,P]=k.useState(null),{isOpen:L,onOpen:M,onClose:F}=Xd(),B=ta(),{user:Z}=k.useContext(Uo),K=(Z==null?void 0:Z.groups)&&(Z.groups.includes("disruptiveAdmin")||Z.groups.includes("admin"));k.useEffect(()=>{re()},[n]);const re=async()=>{f(!0);try{let Y=[];try{Y=await j8e(),i(Y)}catch(ie){H.error("SpaceTagsManager: Error loading available tags:",ie),i([]),B({title:"Error loading tags",description:"Failed to load available tags. Please try again later.",status:"error",duration:3e3,isClosable:!0})}if(n)try{const ie=await G8e(n);l(ie)}catch(ie){H.error("SpaceTagsManager: Error loading space tags:",ie),l([]),B({title:"Error loading space tags",description:"Failed to load this space's tags. Please try again later.",status:"error",duration:3e3,isClosable:!0})}}catch(Y){H.error("SpaceTagsManager: Error in loadTags:",Y),B({title:"Error loading tags",description:"Failed to load tags. Please try again later.",status:"error",duration:3e3,isClosable:!0})}finally{f(!1)}},ae=async()=>{C(!0),P(null);try{const Y=await H8e();console.log("Tag initialization result:",Y),P(Y),B({title:"Tags initialized",description:`Successfully created ${Y.created} tags. Skipped ${Y.skipped} existing tags.`,status:"success",duration:4e3,isClosable:!0}),await re()}catch(Y){H.error("SpaceTagsManager: Error initializing tags:",Y),P(!1),B({title:"Error initializing tags",description:"Failed to initialize tags. Please try again later.",status:"error",duration:4e3,isClosable:!0})}finally{C(!1)}},ne=async Y=>{if(!(!n||!Y)){E(!0);try{await W8e(n,Y);const ie=e.find(le=>le.id===Y);ie&&l(le=>[...le,ie]),B({title:"Tag added",description:"Tag has been added to the space.",status:"success",duration:2e3,isClosable:!0})}catch(ie){H.error(`SpaceTagsManager: Error adding tag ${Y} to space:`,ie),B({title:"Error adding tag",description:"Failed to add tag to the space.",status:"error",duration:3e3,isClosable:!0})}finally{E(!1)}}},pe=async Y=>{if(!(!n||!Y)){E(!0);try{await z8e(n,Y),l(ie=>ie.filter(le=>le.id!==Y)),B({title:"Tag removed",description:"Tag has been removed from the space.",status:"info",duration:2e3,isClosable:!0})}catch(ie){H.error(`SpaceTagsManager: Error removing tag ${Y} from space:`,ie),B({title:"Error removing tag",description:"Failed to remove tag from the space.",status:"error",duration:3e3,isClosable:!0})}finally{E(!1)}}},X=()=>{const Y=o.map(ie=>ie.id);return e.filter(ie=>!Y.includes(ie.id))},J=X().length===0;return S.jsxs(ct,{children:[S.jsx(Cr,{mb:3,justifyContent:"space-between",alignItems:"center",children:S.jsxs(Er,{spacing:2,ml:"auto",children:[K&&S.jsx(jn,{size:"xs",leftIcon:S.jsx(AWe,{}),onClick:M,variant:"outline",colorScheme:"purple",children:"Admin"}),S.jsxs(bR,{children:[S.jsx(wR,{as:jn,size:"xs",leftIcon:S.jsx(IWe,{}),rightIcon:S.jsx(zoe,{}),isDisabled:u||_||J,children:J?"No Available Tags":"Add Tag"}),S.jsx(TR,{zIndex:1e3,bg:"gray.800",borderColor:"gray.700",color:"white",children:X().length>0?X().map(Y=>S.jsx(Lf,{onClick:()=>ne(Y.id),icon:S.jsx(ct,{width:"12px",height:"12px",borderRadius:"full",bg:Y.color||"#888"}),_hover:{bg:"gray.700"},_focus:{bg:"gray.700"},_active:{bg:"gray.700"},_focusVisible:{bg:"gray.700"},bg:"gray.800",color:"white",children:Y.name},Y.id)):S.jsx(Lf,{isDisabled:!0,bg:"gray.800",color:"gray.400",children:"No available tags to add"})})]})]})}),u?S.jsx(Cr,{justify:"center",py:4,children:S.jsx(nd,{size:"sm",color:"blue.300"})}):e.length===0?S.jsx(ct,{children:S.jsxs(tt,{fontSize:"sm",color:"red.400",mb:2,children:["No tags have been created in the system yet.",K?" Use the Admin button to initialize tags.":" Ask an admin to initialize tags."]})}):o.length===0?S.jsx(tt,{fontSize:"sm",color:"gray.400",fontStyle:"italic",children:"No tags assigned to this space."}):S.jsx($re,{spacing:2,children:o.map(Y=>S.jsx(_4,{children:S.jsxs(Bre,{size:"md",borderRadius:"full",variant:"subtle",colorScheme:"gray",boxShadow:`0 0 0 1px ${Y.color||"#888"}`,children:[S.jsx(ct,{width:"8px",height:"8px",borderRadius:"full",bg:Y.color||"#888",mr:1}),S.jsx(Wre,{children:Y.name}),S.jsx(Gre,{onClick:()=>pe(Y.id),isDisabled:_})]})},Y.id))}),S.jsxs(hs,{isOpen:L,onClose:F,size:"md",children:[S.jsx(fs,{backdropFilter:"blur(4px)"}),S.jsxs(ps,{bg:"gray.800",color:"white",children:[S.jsx(yo,{fontSize:"md",children:"Tag System Administration"}),S.jsx($s,{}),S.jsxs(bs,{children:[S.jsx(tt,{fontSize:"sm",mb:4,children:"Initialize the default tags in your Firestore database. This will create a set of predefined tags if they don't already exist."}),I&&S.jsxs(op,{status:"success",mb:4,borderRadius:"md",size:"sm",children:[S.jsx(ap,{}),S.jsxs(tt,{fontSize:"sm",children:["Tags initialized. Created: ",S.jsx("b",{children:I.created}),", Skipped: ",S.jsx("b",{children:I.skipped})]})]}),S.jsx(jn,{colorScheme:"blue",onClick:ae,isLoading:b,loadingText:"Initializing...",size:"sm",width:"full",children:"Initialize Default Tags"})]}),S.jsx(Cp,{children:S.jsx(jn,{variant:"ghost",size:"sm",onClick:F,children:"Close"})})]})]})]})};Tae.propTypes={spaceID:yn.string.isRequired};const $8e=({isOpen:n,onClose:e})=>{const{spaceID:i}=ea(),[o,l]=k.useState(0),[u,f]=k.useState(""),[_,E]=k.useState(""),[b,C]=k.useState(!1),[I,P]=k.useState(null),[L,M]=k.useState(null),[F,B]=k.useState(!1),[Z,K]=k.useState(0),[re,ae]=k.useState(null),ne=k.useRef(null),[pe,X]=k.useState(null),[J,Y]=k.useState(null),[ie,le]=k.useState(!1),[de,ue]=k.useState(0),[Oe,Ve]=k.useState(null),xe=k.useRef(null),[Re,ve]=k.useState(null),[be,We]=k.useState(null),[Pe,Te]=k.useState(!1),[ke,Ue]=k.useState(0),[Be,qe]=k.useState(null),$e=k.useRef(null),[st,Je]=k.useState([]),[Rt,kt]=k.useState([]),[He,ut]=k.useState(!1),[mt,Lt]=k.useState(!1),[Xt,$t]=k.useState(!0),[we,je]=k.useState(!1),[Ke,gt]=k.useState(!1),[Et,Tt]=k.useState(""),[Kt,gn]=k.useState(""),[Sn,sn]=k.useState(""),[wt,ir]=k.useState(!1),{setHLSStreamUrl:Vt,savedStreamData:zt}=oae(),_n=ta();k.useEffect(()=>{n&&i&&Ui()},[n,i]);const Ui=async()=>{try{const vt=await Xu(i);vt.logoUrl&&ae(vt.logoUrl),vt.backgroundUrl&&Ve(vt.backgroundUrl),vt.videoBackgroundUrl&&qe(vt.videoBackgroundUrl),vt.voiceDisabled!==void 0&&Lt(vt.voiceDisabled),vt.accessibleToAllUsers!==void 0&&$t(vt.accessibleToAllUsers),f(vt.name||""),E(vt.description||"");try{const pn=await Foe(i);if(pn){Tt(pn.streamUrl||""),gn(pn.rtmpUrl||""),sn(pn.streamKey||"");const Sr=pn.enabled===!0;gt(Sr),H.log("SpaceManageModal: Directly loaded streaming enabled state from Firebase:",{enabled:Sr,rawValue:pn.enabled})}else gt(!1),H.log("SpaceManageModal: No stream data found in Firebase, defaulting enabled to false")}catch(pn){if(H.error("Error fetching stream data directly:",pn),zt){Tt(zt.streamUrl||""),gn(zt.rtmpUrl||""),sn(zt.streamKey||"");const Sr=zt.enabled===!0;gt(Sr),H.log("SpaceManageModal: Loaded streaming enabled state from savedStreamData:",{enabled:Sr,rawValue:zt.enabled})}else gt(!1),H.log("SpaceManageModal: No savedStreamData available, defaulting enabled to false")}Ts(vt)}catch(vt){H.error("Error fetching space data:",vt),_n({title:"Error",description:"Failed to load space data",status:"error",duration:3e3,isClosable:!0})}};k.useEffect(()=>{if(zt){if(!wt){Tt(zt.streamUrl||""),gn(zt.rtmpUrl||""),sn(zt.streamKey||"");const vt=zt.enabled===!0;gt(vt),H.log("SpaceManageModal: Updated streaming enabled state from savedStreamData:",{enabled:vt,rawValue:zt.enabled})}}else n&&!wt&&H.log("SpaceManageModal: No savedStreamData available but NOT defaulting enabled to false (preserving current state)")},[zt,wt,n]);const Ts=async vt=>{if(i&&n){ut(!0);try{const pn=vj(),Sr=`space_${i}_owners`,yi=b1(Sl(pn,"users"),cQ("groups","array-contains",Sr)),jo=await ed(yi),vo=[];for(const Ai of jo.docs){const So=Ai.data(),Gi=await td(Ai.id);vo.push({uid:Ai.id,email:So.email,displayName:So.displayName||Gi.Nickname||"Unknown User",photoURL:So.photoURL||Gi.photoURL,firstName:Gi.firstName,lastName:Gi.lastName})}Je(vo);const iu=`space_${i}_hosts`,kp=b1(Sl(pn,"users"),cQ("groups","array-contains",iu)),Tl=await ed(kp),su=[];for(const Ai of Tl.docs){const So=Ai.data(),Gi=await td(Ai.id);su.push({uid:Ai.id,email:So.email,displayName:So.displayName||Gi.Nickname||"Unknown User",photoURL:So.photoURL||Gi.photoURL,firstName:Gi.firstName,lastName:Gi.lastName})}kt(su)}catch(pn){H.error("Error fetching space users:",pn),_n({title:"Error",description:"Failed to load space users",status:"error",duration:3e3,isClosable:!0})}finally{ut(!1)}}};k.useEffect(()=>{i&&n&&o===4&&Ts()},[i,n,o]);const ui=vt=>{const pn=vt.target.files[0];if(pn){if(!pn.type.startsWith("image/")){_n({title:"Invalid file type",description:"Please select an image file",status:"error",duration:5e3,isClosable:!0});return}P(pn);const Sr=new FileReader;Sr.onloadend=()=>{M(Sr.result)},Sr.readAsDataURL(pn)}},na=vt=>{const pn=vt.target.files[0];if(pn){if(!pn.type.startsWith("image/")){_n({title:"Invalid file type",description:"Please select an image file",status:"error",duration:5e3,isClosable:!0});return}X(pn);const Sr=new FileReader;Sr.onloadend=()=>{Y(Sr.result)},Sr.readAsDataURL(pn)}},dc=vt=>{const pn=vt.target.files[0];if(pn){if(!pn.type.startsWith("video/")){_n({title:"Invalid file type",description:"Please select a video file",status:"error",duration:5e3,isClosable:!0});return}const Sr=5*1024*1024;if(pn.size>Sr){_n({title:"File too large",description:"Video file must be smaller than 5MB",status:"error",duration:5e3,isClosable:!0});return}ve(pn);const yi=new FileReader;yi.onloadend=()=>{We(yi.result)},yi.readAsDataURL(pn)}},oo=async()=>{if(!I){_n({title:"No file selected",description:"Please select a file to upload",status:"warning",duration:5e3,isClosable:!0});return}try{B(!0);const vt=setInterval(()=>{K(Sr=>{const yi=Sr+10;return yi>=90?90:yi})},300),pn=await yWe(i,I);clearInterval(vt),K(100),ae(pn),_n({title:"Upload successful",description:"Space logo has been updated",status:"success",duration:5e3,isClosable:!0}),setTimeout(()=>{P(null),M(null),K(0),B(!1)},1e3),window.dispatchEvent(new CustomEvent("SpaceLogoUpdated",{detail:{logoUrl:pn}}))}catch(vt){console.error("Error uploading logo:",vt),_n({title:"Upload failed",description:vt.message||"An error occurred during upload",status:"error",duration:5e3,isClosable:!0}),B(!1),K(0)}},ao=async()=>{if(!pe){_n({title:"No file selected",description:"Please select a file to upload",status:"warning",duration:5e3,isClosable:!0});return}try{le(!0);const vt=setInterval(()=>{ue(Sr=>{const yi=Sr+10;return yi>=90?90:yi})},300),pn=await vWe(i,pe);clearInterval(vt),ue(100),Ve(pn),_n({title:"Upload successful",description:"Space background has been updated",status:"success",duration:5e3,isClosable:!0}),setTimeout(()=>{X(null),Y(null),ue(0),le(!1)},1e3),window.dispatchEvent(new CustomEvent("SpaceBackgroundUpdated",{detail:{backgroundUrl:pn}}))}catch(vt){console.error("Error uploading background:",vt),_n({title:"Upload failed",description:vt.message||"An error occurred during upload",status:"error",duration:5e3,isClosable:!0}),le(!1),ue(0)}},xc=async()=>{if(re)try{B(!0),await EWe(i),ae(null),_n({title:"Logo removed",description:"Space logo has been removed",status:"info",duration:5e3,isClosable:!0}),B(!1),window.dispatchEvent(new CustomEvent("SpaceLogoUpdated",{detail:{logoUrl:null}}))}catch(vt){console.error("Error deleting logo:",vt),_n({title:"Deletion failed",description:vt.message||"An error occurred during deletion",status:"error",duration:5e3,isClosable:!0}),B(!1)}},Cs=async()=>{if(Oe)try{le(!0),await SWe(i),Ve(null),_n({title:"Background removed",description:"Space background has been removed",status:"info",duration:5e3,isClosable:!0}),le(!1),window.dispatchEvent(new CustomEvent("SpaceBackgroundUpdated",{detail:{backgroundUrl:null}}))}catch(vt){console.error("Error deleting background:",vt),_n({title:"Deletion failed",description:vt.message||"An error occurred during deletion",status:"error",duration:5e3,isClosable:!0}),le(!1)}},La=async()=>{if(!Re){_n({title:"No file selected",description:"Please select a file to upload",status:"warning",duration:5e3,isClosable:!0});return}try{Te(!0);const vt=setInterval(()=>{Ue(Sr=>{const yi=Sr+10;return yi>=90?90:yi})},300),pn=await TWe(i,Re);clearInterval(vt),Ue(100),qe(pn),_n({title:"Upload successful",description:"Space video background has been updated",status:"success",duration:5e3,isClosable:!0}),setTimeout(()=>{ve(null),We(null),Ue(0),Te(!1)},1e3),window.dispatchEvent(new CustomEvent("SpaceVideoBackgroundUpdated",{detail:{videoBackgroundUrl:pn}}))}catch(vt){console.error("Error uploading video background:",vt),_n({title:"Upload failed",description:vt.message||"An error occurred during upload",status:"error",duration:5e3,isClosable:!0}),Te(!1),Ue(0)}},Vo=async()=>{if(Be)try{Te(!0),await CWe(i),qe(null),_n({title:"Video background removed",description:"Space video background has been removed",status:"info",duration:5e3,isClosable:!0}),Te(!1),window.dispatchEvent(new CustomEvent("SpaceVideoBackgroundUpdated",{detail:{videoBackgroundUrl:null}}))}catch(vt){console.error("Error deleting video background:",vt),_n({title:"Deletion failed",description:vt.message||"An error occurred during deletion",status:"error",duration:5e3,isClosable:!0}),Te(!1)}},Ma=()=>{ne.current&&ne.current.click()},hc=()=>{xe.current&&xe.current.click()},wl=()=>{$e.current&&$e.current.click()},Ua=async()=>{je(!0);try{await bWe(i,{voiceDisabled:!mt}),Lt(!mt),_n({title:"Settings Updated",description:`Voice chat has been ${mt?"enabled":"disabled"} for this space.`,status:"success",duration:3e3,isClosable:!0})}catch(vt){H.error("Error updating voice settings:",vt),_n({title:"Error",description:"Failed to update voice settings",status:"error",duration:3e3,isClosable:!0})}finally{je(!1)}},pc=async()=>{je(!0);try{await wWe(i,!Xt),$t(!Xt),_n({title:"Settings Updated",description:`Space is now ${Xt?"not accessible":"accessible"} to all users.`,status:"success",duration:3e3,isClosable:!0})}catch(vt){H.error("Error updating accessibility settings:",vt),_n({title:"Error",description:"Failed to update accessibility settings",status:"error",duration:3e3,isClosable:!0})}finally{je(!1)}},Eo=async()=>{if(i){C(!0);try{const vt=vj(),pn=dr(vt,"spaces",i);await ms(pn,{name:u,description:_}),_n({title:"Success",description:"Space details updated successfully",status:"success",duration:3e3,isClosable:!0}),window.dispatchEvent(new CustomEvent("SpaceDetailsUpdated",{detail:{name:u,description:_}}))}catch(vt){H.error("Error updating space details:",vt),_n({title:"Error",description:"Failed to update space details",status:"error",duration:3e3,isClosable:!0})}finally{C(!1)}}},Vi=async()=>{if(i){ir(!0);try{const vt={enabled:Ke,streamUrl:Et,rtmpUrl:Kt,streamKey:Sn,playerIndex:"0",updatedAt:new Date().toISOString()};H.log("SpaceManageModal: Saving stream settings to Firebase:",{enabled:Ke,url:Et,hasRtmp:!!Kt,hasKey:!!Sn});try{await Tj(i,vt),H.log("SpaceManageModal: Successfully updated stream settings in Firebase directly")}catch(pn){throw H.error("SpaceManageModal: Error updating stream settings directly in Firebase:",pn),pn}await Vt(Et,0,{enabled:Ke,rtmpUrl:Kt,streamKey:Sn}),window.dispatchEvent(new CustomEvent("StreamSettingsChanged",{detail:{enabled:Ke,spaceId:i}})),_n({title:"Success",description:`Stream settings updated successfully. Streaming is now ${Ke?"enabled":"disabled"}.`,status:"success",duration:3e3,isClosable:!0}),setTimeout(()=>{Ui()},500)}catch(vt){H.error("Error updating stream settings:",vt),_n({title:"Error",description:"Failed to update stream settings",status:"error",duration:3e3,isClosable:!0})}finally{ir(!1)}}};return S.jsxs(hs,{isOpen:n,onClose:e,size:"lg",isCentered:!0,children:[S.jsx(fs,{backdropFilter:"blur(4px)"}),S.jsxs(ps,{bg:"rgba(23, 25, 35, 0.95)",color:"white",borderRadius:"md",boxShadow:"0 4px 20px rgba(0, 0, 0, 0.5)",maxW:"800px",maxH:"90vh",overflow:"hidden",children:[S.jsx(yo,{borderBottom:"1px solid",borderColor:"whiteAlpha.200",py:2,fontSize:"md",fontWeight:"600",children:"Manage Space"}),S.jsx($s,{size:"sm",color:"whiteAlpha.700",_hover:{color:"white",bg:"whiteAlpha.100"}}),S.jsx(bs,{p:0,display:"flex",overflow:"hidden",children:S.jsxs(L0,{orientation:"vertical",variant:"unstyled",index:o,onChange:l,display:"flex",width:"100%",height:"100%",children:[S.jsxs(M0,{bg:"rgba(0, 0, 0, 0.2)",w:"80px",py:4,borderRight:"1px solid",borderColor:"whiteAlpha.200",flexShrink:0,children:[S.jsxs(Pa,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[S.jsx(vn,{as:wae,mb:1}),S.jsx(tt,{fontSize:"xs",children:"Details"})]}),S.jsxs(Pa,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[S.jsx(vn,{as:My,mb:1}),S.jsx(tt,{fontSize:"xs",children:"Logo"})]}),S.jsxs(Pa,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[S.jsx(vn,{as:x8e,mb:1}),S.jsx(tt,{fontSize:"xs",children:"Background"})]}),S.jsxs(Pa,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[S.jsx(vn,{as:M8e,mb:1}),S.jsx(tt,{fontSize:"xs",children:"Settings"})]}),S.jsxs(Pa,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[S.jsx(vn,{as:YQ,mb:1}),S.jsx(tt,{fontSize:"xs",children:"Users"})]}),S.jsxs(Pa,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[S.jsx(vn,{as:o0,mb:1}),S.jsx(tt,{fontSize:"xs",children:"Stream"})]})]}),S.jsxs(KC,{flexGrow:1,display:"flex",flexDirection:"column",overflowY:"auto",css:{"&::-webkit-scrollbar":{width:"8px"},"&::-webkit-scrollbar-track":{background:"rgba(0,0,0,0.1)"},"&::-webkit-scrollbar-thumb":{background:"rgba(255,255,255,0.3)",borderRadius:"4px"}},children:[S.jsxs(Oc,{p:4,display:"flex",flexDirection:"column",children:[S.jsx(tt,{fontSize:"sm",fontWeight:"600",mb:3,color:"blue.300",children:"Space Details"}),S.jsxs(Fr,{spacing:4,align:"stretch",children:[S.jsxs(ur,{children:[S.jsx(ei,{fontSize:"xs",children:"Space Name"}),S.jsx(ti,{value:u,onChange:vt=>f(vt.target.value),placeholder:"Enter space name",size:"sm",bg:"whiteAlpha.100",borderColor:"whiteAlpha.200",_hover:{borderColor:"whiteAlpha.300"},_focus:{borderColor:"blue.300",boxShadow:"0 0 0 1px #63B3ED"},color:"white",maxLength:100})]}),S.jsxs(ur,{children:[S.jsx(ei,{fontSize:"xs",children:"Description"}),S.jsx(Hre,{value:_,onChange:vt=>E(vt.target.value),placeholder:"Enter space description",size:"sm",bg:"whiteAlpha.100",borderColor:"whiteAlpha.200",_hover:{borderColor:"whiteAlpha.300"},_focus:{borderColor:"blue.300",boxShadow:"0 0 0 1px #63B3ED"},rows:4,resize:"vertical",maxLength:500})]}),S.jsxs(ur,{children:[S.jsx(ei,{fontSize:"xs",children:"Space Tags"}),S.jsx(ct,{p:3,bg:"whiteAlpha.50",borderWidth:"1px",borderColor:"whiteAlpha.200",borderRadius:"md",children:i?S.jsx(Tae,{spaceID:i}):S.jsxs(op,{status:"warning",variant:"subtle",borderRadius:"md",children:[S.jsx(ap,{}),S.jsx(n0,{fontSize:"sm",children:"Space ID missing"}),S.jsx(r0,{fontSize:"xs",children:"Unable to load tags without a valid space ID."})]})})]}),S.jsx(jn,{colorScheme:"blue",size:"sm",onClick:Eo,isLoading:b,loadingText:"Saving...",alignSelf:"flex-start",mt:2,children:"Save Details"})]})]}),S.jsxs(Oc,{p:4,display:"flex",flexDirection:"column",children:[S.jsx(tt,{fontSize:"sm",fontWeight:"600",mb:3,color:"blue.300",children:"Space Logo"}),S.jsx(tt,{fontSize:"xs",mb:4,children:"Upload a logo for your space. This will be displayed during loading."}),(re||L)&&S.jsxs(Cr,{direction:{base:"column",md:"row"},gap:4,mb:4,children:[re&&S.jsxs(ct,{borderWidth:"1px",borderRadius:"md",p:3,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",flex:"1",children:[S.jsx(tt,{fontSize:"xs",fontWeight:"medium",mb:2,children:"Current Logo"}),S.jsx(cp,{src:re,alt:"Space Logo",maxH:"120px",mx:"auto",objectFit:"contain"}),S.jsx(jn,{mt:3,colorScheme:"red",leftIcon:S.jsx(vn,{as:b0}),onClick:xc,isLoading:F,loadingText:"Removing...",size:"xs",variant:"ghost",children:"Remove Logo"})]}),L&&S.jsxs(ct,{borderWidth:"1px",borderRadius:"md",p:3,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",flex:"1",children:[S.jsx(tt,{fontSize:"xs",fontWeight:"medium",mb:2,children:"Preview"}),S.jsx(cp,{src:L,alt:"Preview",maxH:"120px",mx:"auto",objectFit:"contain"})]})]}),S.jsxs(ur,{children:[S.jsx(ei,{fontSize:"xs",children:"Upload New Logo"}),S.jsx(ti,{type:"file",accept:"image/*",onChange:ui,ref:ne,display:"none"}),F&&S.jsxs(ct,{mt:3,mb:3,children:[S.jsxs(tt,{fontSize:"xs",mb:1,children:["Uploading... ",Z,"%"]}),S.jsx(Ky,{value:Z,size:"xs",colorScheme:"blue",borderRadius:"full"})]}),S.jsxs(Er,{mt:3,spacing:3,children:[S.jsx(jn,{colorScheme:"blue",leftIcon:S.jsx(vn,{as:My}),onClick:Ma,isDisabled:F,size:"sm",variant:"outline",children:"Browse"}),S.jsx(jn,{colorScheme:"green",leftIcon:S.jsx(vn,{as:jk}),onClick:oo,isLoading:F,loadingText:"Uploading...",isDisabled:!I||F,size:"sm",children:"Upload"})]}),S.jsx(Gy,{fontSize:"xs",color:"whiteAlpha.700",mt:2,children:"Recommended: PNG format with transparent background. Max height: 400px."})]})]}),S.jsxs(Oc,{p:4,display:"flex",flexDirection:"column",children:[S.jsx(tt,{fontSize:"sm",fontWeight:"600",mb:3,color:"blue.300",children:"Background"}),S.jsx(tt,{fontSize:"xs",mb:4,children:"Upload a background for your space. This will be displayed during loading."}),S.jsxs(L0,{variant:"enclosed",colorScheme:"blue",size:"md",mb:4,borderColor:"blue.300",children:[S.jsxs(M0,{children:[S.jsxs(Pa,{fontSize:"sm",fontWeight:"medium",_selected:{color:"blue.300",bg:"whiteAlpha.200"},p:3,children:[S.jsx(vn,{as:My,mr:2}),"Image"]}),S.jsxs(Pa,{fontSize:"sm",fontWeight:"medium",_selected:{color:"blue.300",bg:"whiteAlpha.200"},p:3,children:[S.jsx(vn,{as:qQ,mr:2}),"Video (max 5MB)"]})]}),S.jsxs(KC,{mt:4,children:[S.jsxs(Oc,{p:0,children:[(Oe||J)&&S.jsxs(Cr,{direction:{base:"column",md:"row"},gap:4,mb:4,children:[Oe&&S.jsxs(ct,{borderWidth:"1px",borderRadius:"md",p:3,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",flex:"1",children:[S.jsx(tt,{fontSize:"xs",fontWeight:"medium",mb:2,children:"Current Background"}),S.jsx(cp,{src:Oe,alt:"Space Background",maxH:"120px",mx:"auto",objectFit:"contain"}),S.jsx(jn,{mt:3,colorScheme:"red",leftIcon:S.jsx(vn,{as:b0}),onClick:Cs,isLoading:ie,loadingText:"Removing...",size:"xs",variant:"ghost",children:"Remove Background"})]}),J&&S.jsxs(ct,{borderWidth:"1px",borderRadius:"md",p:3,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",flex:"1",children:[S.jsx(tt,{fontSize:"xs",fontWeight:"medium",mb:2,children:"Preview"}),S.jsx(cp,{src:J,alt:"Preview",maxH:"120px",mx:"auto",objectFit:"contain"})]})]}),S.jsxs(ur,{children:[S.jsx(ei,{fontSize:"xs",children:"Upload New Background Image"}),S.jsx(ti,{type:"file",accept:"image/*",onChange:na,ref:xe,display:"none"}),ie&&S.jsxs(ct,{mt:3,mb:3,children:[S.jsxs(tt,{fontSize:"xs",mb:1,children:["Uploading... ",de,"%"]}),S.jsx(Ky,{value:de,size:"xs",colorScheme:"blue",borderRadius:"full"})]}),S.jsxs(Er,{mt:3,spacing:3,children:[S.jsx(jn,{colorScheme:"blue",leftIcon:S.jsx(vn,{as:My}),onClick:hc,isDisabled:ie,size:"sm",variant:"outline",children:"Browse"}),S.jsx(jn,{colorScheme:"green",leftIcon:S.jsx(vn,{as:jk}),onClick:ao,isLoading:ie,loadingText:"Uploading...",isDisabled:!pe||ie,size:"sm",children:"Upload"})]}),S.jsx(Gy,{fontSize:"xs",color:"whiteAlpha.700",mt:2,children:"Recommended: High-quality image (1920x1080 or higher) that works well with the frosted glass overlay."})]})]}),S.jsxs(Oc,{p:0,children:[(Be||be)&&S.jsxs(Cr,{direction:{base:"column",md:"row"},gap:4,mb:4,children:[Be&&S.jsxs(ct,{borderWidth:"1px",borderRadius:"md",p:3,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",flex:"1",children:[S.jsx(tt,{fontSize:"xs",fontWeight:"medium",mb:2,children:"Current Video Background"}),S.jsx(ct,{maxH:"160px",overflow:"hidden",position:"relative",children:S.jsx("video",{src:Be,controls:!0,muted:!0,style:{width:"100%",maxHeight:"120px",objectFit:"contain"}})}),S.jsx(jn,{mt:3,colorScheme:"red",leftIcon:S.jsx(vn,{as:b0}),onClick:Vo,isLoading:Pe,loadingText:"Removing...",size:"xs",variant:"ghost",children:"Remove Video"})]}),be&&S.jsxs(ct,{borderWidth:"1px",borderRadius:"md",p:3,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",flex:"1",children:[S.jsx(tt,{fontSize:"xs",fontWeight:"medium",mb:2,children:"Preview"}),S.jsx(ct,{maxH:"160px",overflow:"hidden",children:S.jsx("video",{src:be,controls:!0,muted:!0,style:{width:"100%",maxHeight:"120px",objectFit:"contain"}})})]})]}),S.jsxs(ur,{children:[S.jsx(ei,{fontSize:"xs",children:"Upload New Video Background"}),S.jsx(ti,{type:"file",accept:"video/*",onChange:dc,ref:$e,display:"none"}),Pe&&S.jsxs(ct,{mt:3,mb:3,children:[S.jsxs(tt,{fontSize:"xs",mb:1,children:["Uploading... ",ke,"%"]}),S.jsx(Ky,{value:ke,size:"xs",colorScheme:"blue",borderRadius:"full"})]}),S.jsxs(Er,{mt:3,spacing:3,children:[S.jsx(jn,{colorScheme:"blue",leftIcon:S.jsx(vn,{as:qQ}),onClick:wl,isDisabled:Pe,size:"sm",variant:"outline",children:"Browse"}),S.jsx(jn,{colorScheme:"green",leftIcon:S.jsx(vn,{as:jk}),onClick:La,isLoading:Pe,loadingText:"Uploading...",isDisabled:!Re||Pe,size:"sm",children:"Upload"})]}),S.jsx(Gy,{fontSize:"xs",color:"whiteAlpha.700",mt:2,children:"Recommended: MP4 format. Maximum file size: 5MB. Short looping videos work best."})]})]})]})]})]}),S.jsxs(Oc,{p:4,display:"flex",flexDirection:"column",children:[S.jsx(tt,{fontSize:"sm",fontWeight:"600",mb:3,color:"blue.300",children:"Space Settings"}),S.jsx(tt,{fontSize:"xs",mb:4,children:"Configure settings for your space."}),S.jsxs(Fr,{spacing:4,align:"stretch",children:[S.jsx(ct,{borderWidth:"1px",borderRadius:"md",p:3,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",children:S.jsxs(Er,{justify:"space-between",align:"center",children:[S.jsxs(ct,{children:[S.jsxs(Er,{mb:1,spacing:2,children:[S.jsxs(ct,{position:"relative",w:"16px",h:"16px",children:[S.jsx(vn,{as:V8e,color:mt?"red.400":"green.400"}),mt&&S.jsx(ct,{position:"absolute",top:"50%",left:"0",right:"0",height:"2px",bg:"red.400",transform:"rotate(45deg)",transformOrigin:"center"})]}),S.jsx(tt,{fontSize:"sm",fontWeight:"600",children:"Voice Chat"})]}),S.jsx(tt,{fontSize:"xs",color:"whiteAlpha.800",children:mt?"Voice chat is currently disabled for all users in this space.":"Voice chat is currently enabled for all users in this space."})]}),S.jsx(yp,{isChecked:!mt,onChange:Ua,colorScheme:"green",size:"md",isDisabled:we})]})}),S.jsx(ct,{borderWidth:"1px",borderRadius:"md",p:3,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",children:S.jsxs(Er,{justify:"space-between",align:"center",children:[S.jsxs(ct,{children:[S.jsxs(Er,{mb:1,spacing:2,children:[S.jsx(ct,{position:"relative",w:"16px",h:"16px",children:S.jsx(vn,{as:YQ,color:Xt?"green.400":"red.400"})}),S.jsx(tt,{fontSize:"sm",fontWeight:"600",children:"Public Access"})]}),S.jsx(tt,{fontSize:"xs",color:"whiteAlpha.800",children:Xt?"This space is accessible to all users in the 'users' group.":"This space is only accessible to specific users."}),S.jsx(tt,{fontSize:"xs",color:"blue.300",mt:1,children:"Note: Space owners and hosts will always have access regardless of this setting."})]}),S.jsx(yp,{isChecked:Xt,onChange:pc,colorScheme:"green",size:"md",isDisabled:we})]})}),S.jsxs(op,{status:"info",variant:"subtle",bg:"whiteAlpha.100",borderRadius:"md",borderWidth:"1px",borderColor:"blue.800",children:[S.jsx(ap,{color:"blue.300"}),S.jsxs(ct,{children:[S.jsx(n0,{fontSize:"xs",fontWeight:"medium",children:"Coming Soon"}),S.jsx(r0,{fontSize:"xs",children:"Additional space configuration options will be available in a future update."})]})]})]})]}),S.jsxs(Oc,{p:4,display:"flex",flexDirection:"column",children:[S.jsx(tt,{fontSize:"sm",fontWeight:"600",mb:3,color:"blue.300",children:"Manage Users"}),S.jsx(tt,{fontSize:"xs",mb:4,children:"View and manage the owners and hosts of this space."}),He?S.jsx(Cr,{justify:"center",align:"center",h:"200px",children:S.jsx(nd,{color:"blue.300"})}):S.jsxs(Fr,{spacing:4,align:"stretch",children:[S.jsxs(ct,{children:[S.jsxs(Er,{mb:2,children:[S.jsx(vn,{as:D8e,color:"green.400"}),S.jsx(tt,{fontSize:"sm",fontWeight:"600",children:"Owners"}),S.jsx(Vf,{colorScheme:"green",ml:2,children:st.length})]}),S.jsx(ct,{borderWidth:"1px",borderRadius:"md",p:2,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",maxH:"120px",overflowY:"auto",css:{"&::-webkit-scrollbar":{width:"4px"},"&::-webkit-scrollbar-track":{background:"rgba(0,0,0,0.1)"},"&::-webkit-scrollbar-thumb":{background:"rgba(255,255,255,0.3)",borderRadius:"2px"}},children:st.length===0?S.jsx(tt,{fontSize:"xs",color:"whiteAlpha.600",children:"No owners found"}):S.jsx(Fr,{spacing:1,align:"stretch",children:st.map(vt=>S.jsxs(Er,{spacing:2,p:1,borderRadius:"md",_hover:{bg:"whiteAlpha.100"},children:[S.jsx(eu,{size:"xs",src:vt.photoURL,name:vt.displayName}),S.jsxs(ct,{children:[S.jsx(tt,{fontSize:"xs",children:vt.displayName}),S.jsx(tt,{fontSize:"xs",color:"whiteAlpha.600",children:vt.firstName&&vt.lastName?`${vt.firstName} ${vt.lastName}`:"Full name not available"})]}),S.jsx($C,{}),S.jsx(Vf,{colorScheme:"green",variant:"solid",fontSize:"2xs",children:"Owner"})]},vt.uid))})})]}),S.jsxs(ct,{children:[S.jsxs(Er,{mb:2,children:[S.jsx(vn,{as:U8e,color:"purple.400"}),S.jsx(tt,{fontSize:"sm",fontWeight:"600",children:"Hosts"}),S.jsx(Vf,{colorScheme:"purple",ml:2,children:Rt.length})]}),S.jsx(ct,{borderWidth:"1px",borderRadius:"md",p:2,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",maxH:"120px",overflowY:"auto",css:{"&::-webkit-scrollbar":{width:"4px"},"&::-webkit-scrollbar-track":{background:"rgba(0,0,0,0.1)"},"&::-webkit-scrollbar-thumb":{background:"rgba(255,255,255,0.3)",borderRadius:"2px"}},children:Rt.length===0?S.jsx(tt,{fontSize:"xs",color:"whiteAlpha.600",children:"No hosts found"}):S.jsx(Fr,{spacing:1,align:"stretch",children:Rt.map(vt=>S.jsxs(Er,{spacing:2,p:1,borderRadius:"md",_hover:{bg:"whiteAlpha.100"},children:[S.jsx(eu,{size:"xs",src:vt.photoURL,name:vt.displayName}),S.jsxs(ct,{children:[S.jsx(tt,{fontSize:"xs",children:vt.displayName}),S.jsx(tt,{fontSize:"xs",color:"whiteAlpha.600",children:vt.firstName&&vt.lastName?`${vt.firstName} ${vt.lastName}`:"Full name not available"})]}),S.jsx($C,{}),S.jsx(Vf,{colorScheme:"purple",variant:"solid",fontSize:"2xs",children:"Host"})]},vt.uid))})})]}),S.jsx(gp,{borderColor:"whiteAlpha.200"}),S.jsxs(op,{status:"info",variant:"subtle",bg:"whiteAlpha.100",borderRadius:"md",borderWidth:"1px",borderColor:"blue.800",py:2,fontSize:"xs",children:[S.jsx(ap,{color:"blue.300",boxSize:4}),S.jsxs(ct,{children:[S.jsx(n0,{fontSize:"xs",fontWeight:"medium",children:"Coming Soon"}),S.jsx(r0,{fontSize:"xs",children:"User management features like adding/removing hosts and owners will be available in a future update."})]})]})]})]}),S.jsxs(Oc,{p:4,display:"flex",flexDirection:"column",children:[S.jsx(tt,{fontSize:"sm",fontWeight:"600",mb:3,color:"blue.300",children:"Stream Settings"}),S.jsxs(Fr,{spacing:4,align:"stretch",children:[S.jsx(ct,{borderWidth:"1px",borderRadius:"md",p:3,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",children:S.jsxs(Er,{justify:"space-between",align:"center",children:[S.jsx(ct,{children:S.jsxs(Er,{mb:1,spacing:2,children:[S.jsx(ct,{position:"relative",w:"16px",h:"16px",children:S.jsx(vn,{as:o0,color:Ke?"green.400":"red.400"})}),S.jsx(tt,{fontSize:"sm",fontWeight:"600",children:"Streaming Enabled"})]})}),S.jsx(yp,{isChecked:Ke,onChange:async()=>{const vt=!Ke;gt(vt),ir(!0);try{H.log("SpaceManageModal: Auto-saving streaming enabled state:",vt);const pn={enabled:vt,streamUrl:Et||"",rtmpUrl:Kt||"",streamKey:Sn||"",playerIndex:"0",updatedAt:new Date().toISOString()};try{await Tj(i,pn),H.log("SpaceManageModal: Successfully updated streaming enabled state in Firebase directly")}catch(Sr){throw H.error("SpaceManageModal: Error updating streaming state directly in Firebase:",Sr),Sr}await Vt(Et,0,{enabled:vt,rtmpUrl:Kt,streamKey:Sn}),window.dispatchEvent(new CustomEvent("StreamSettingsChanged",{detail:{enabled:vt,spaceId:i}})),_n({title:"Streaming "+(vt?"Enabled":"Disabled"),description:`Streaming is now ${vt?"enabled":"disabled"}.`,status:"success",duration:2e3,isClosable:!0})}catch(pn){H.error("Error auto-saving streaming state:",pn),gt(!vt),_n({title:"Error",description:"Failed to update streaming status",status:"error",duration:3e3,isClosable:!0})}finally{ir(!1),setTimeout(()=>{Ui()},500)}},colorScheme:"green",size:"md",isDisabled:wt})]})}),S.jsxs(ct,{borderWidth:"1px",borderRadius:"md",p:4,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",children:[S.jsx(tt,{fontSize:"sm",fontWeight:"600",mb:3,children:"Stream Configuration"}),S.jsxs(ur,{mb:4,children:[S.jsx(ei,{fontSize:"xs",children:"Stream URL"}),S.jsx(ti,{value:Et,onChange:vt=>Tt(vt.target.value),placeholder:"https://example.com/stream.m3u8",size:"sm",bg:"whiteAlpha.100",borderColor:"whiteAlpha.200",_hover:{borderColor:"whiteAlpha.300"},_focus:{borderColor:"blue.300",boxShadow:"0 0 0 1px #63B3ED"},color:"white",isDisabled:wt})]}),S.jsx(gp,{my:3,borderColor:"whiteAlpha.200"}),S.jsx(tt,{fontSize:"sm",fontWeight:"600",mb:3,children:"RTMP Configuration"}),S.jsxs(ur,{mb:3,children:[S.jsx(ei,{fontSize:"xs",children:"RTMP URL"}),S.jsx(ti,{value:Kt,onChange:vt=>gn(vt.target.value),placeholder:"rtmp://example.com/live",size:"sm",bg:"whiteAlpha.100",borderColor:"whiteAlpha.200",_hover:{borderColor:"whiteAlpha.300"},_focus:{borderColor:"blue.300",boxShadow:"0 0 0 1px #63B3ED"},color:"white",isDisabled:wt})]}),S.jsxs(ur,{mb:3,children:[S.jsx(ei,{fontSize:"xs",children:"Stream Key"}),S.jsx(ti,{value:Sn,onChange:vt=>sn(vt.target.value),placeholder:"xxxxxxxxxxxxxxxxxxxxxxxx",size:"sm",bg:"whiteAlpha.100",borderColor:"whiteAlpha.200",_hover:{borderColor:"whiteAlpha.300"},_focus:{borderColor:"blue.300",boxShadow:"0 0 0 1px #63B3ED"},color:"white",isDisabled:wt,type:"password"})]})]}),S.jsx(jn,{colorScheme:"blue",size:"sm",onClick:Vi,isLoading:wt,loadingText:"Saving...",alignSelf:"flex-start",mt:2,display:Ke?"inline-flex":"none",children:"Save Stream Settings"}),S.jsxs(op,{status:"info",variant:"subtle",bg:"whiteAlpha.100",borderRadius:"md",borderWidth:"1px",borderColor:"blue.800",mt:2,mb:8,children:[S.jsx(ap,{color:"blue.300"}),S.jsxs(ct,{children:[S.jsx(n0,{fontSize:"xs",fontWeight:"medium",children:"HLS Streaming"}),S.jsx(r0,{fontSize:"xs",children:"After saving, the stream will be available on all screens. Player index: 0"})]})]})]})]})]})]})})]})]})},Cae="spaces",Rae="portals",K8e=async(n,e,i)=>{try{const o=dr(Dn,Cae,n,Rae,e),l={...i,sourceSpaceId:n,portalId:e,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};return await qg(o,l),H.log(`Saved portal ${e} to space ${n}`),!0}catch(o){return H.error("Error saving portal:",o),!1}},XQ=async(n,e,i)=>{try{const o=dr(Dn,Cae,n,Rae,e),l={...i,updatedAt:new Date().toISOString()};return await ms(o,l),H.log(`Updated portal ${e} in space ${n}`),!0}catch(o){return H.error("Error updating portal:",o),!1}},q8e=({isOpen:n,onClose:e,currentSpaceId:i})=>{const[o,l]=k.useState([]),[u,f]=k.useState(!1),[_,E]=k.useState(null),[b,C]=k.useState(!1),I=ta(),{placePortal:P,directPlacePortal:L}=uae(),M=kg("rgba(240, 240, 240, 0.95)","rgba(35, 35, 35, 0.95)"),F=kg("gray.800","white"),B=kg("gray.200","whiteAlpha.200"),Z=kg("gray.200","whiteAlpha.300");k.useEffect(()=>{n&&(async()=>{f(!0),E(null),l([]);try{const ne=Sl(Dn,"spaces"),X=(await ed(ne)).docs.map(J=>({id:J.id,name:J.data().name||`Space ID: ${J.id}`}));l(X)}catch(ne){H.error("PortalAdminModal: Error fetching spaces:",ne),E("Failed to load spaces. Please check your connection and try again.")}f(!1)})()},[n]);const K=async(ae,ne)=>{if(!i){H.error("PortalAdminModal: currentSpaceId is not defined. Cannot save portal."),I({title:"Error",description:"Cannot place portal: Current space ID is missing.",status:"error",duration:5e3,isClosable:!0});return}C(!0),H.log(`PortalAdminModal: Attempting to place portal to ${ne} (${ae}) in space ${i}`);try{const pe=await Xu(ae);if(!pe)throw new Error(`Failed to fetch target space data for ${ae}`);const X=pe.backgroundUrl||pe.backgroundGsUrl;X||H.warn(`PortalAdminModal: No background image URL found for target space: ${ae}`);const J="PortalObjectPrefab",Y={x:0,y:1.5,z:0},ie={x:0,y:0,z:0},le={x:1,y:1,z:1},de=`portal_${i}_${ae}_${Date.now()}`;if(!await K8e(i,de,{type:"portal",targetSpaceId:ae,targetSpaceName:ne,portalId:de,position:Y,rotation:ie,scale:le,prefabName:J,initialImageUrl:X})){H.error(`PortalAdminModal: Failed to save portal data to Firebase for space ${i}.`),I({title:"Save Error",description:"Failed to save portal data to database.",status:"error",duration:5e3,isClosable:!0}),C(!1);return}H.log(`PortalAdminModal: Portal data saved to Firebase for space ${i}.`);let Ve=!1;try{const xe={portalId:de,prefabName:J,position:Y,rotation:ie,scale:le,initialImageUrl:X};Ve=P(de,J,Y,ie,le,X),Ve||(Ve=L(de,J,Y,ie,le,X)),H.log("PortalAdminModal: Portal placement in Unity:",Ve)}catch(xe){H.error("PortalAdminModal: Error placing portal in Unity:",xe)}Ve?(I({title:"Portal Placed",description:`Portal to ${ne} created successfully.`,status:"success",duration:3e3,isClosable:!0}),e()):(I({title:"Portal Saved",description:"Portal data saved. It will appear when Unity is ready.",status:"info",duration:5e3,isClosable:!0}),e())}catch(pe){H.error("PortalAdminModal: Error creating portal:",pe),I({title:"Error",description:"Failed to create portal. Please try again.",status:"error",duration:5e3,isClosable:!0})}finally{C(!1)}},re=u||b;return S.jsxs(hs,{isOpen:n,onClose:e,size:"lg",isCentered:!0,scrollBehavior:"inside",children:[S.jsx(fs,{bg:"blackAlpha.700",backdropFilter:"blur(8px)"}),S.jsxs(ps,{bg:M,backdropFilter:"blur(18px)",color:F,borderRadius:"lg",maxHeight:"80vh",boxShadow:"2xl",children:[S.jsx(yo,{borderBottom:"1px solid",borderColor:Z,fontSize:"lg",fontWeight:"semibold",children:"Select a Space to Create Portal To"}),S.jsx($s,{}),S.jsxs(bs,{p:6,children:[re&&S.jsxs(Fr,{justifyContent:"center",alignItems:"center",height:"200px",children:[S.jsx(nd,{size:"xl",thickness:"4px",speed:"0.65s",emptyColor:"gray.200",color:"blue.500"}),S.jsx(tt,{mt:3,children:"Loading Spaces..."})]}),_&&S.jsxs(op,{status:"error",borderRadius:"md",variant:"subtle",children:[S.jsx(ap,{}),_]}),!u&&!_&&o.length===0&&S.jsx(tt,{textAlign:"center",py:10,children:"No spaces found or you may not have permission to view them."}),!u&&!_&&o.length>0&&S.jsx(Q1,{spacing:3,children:o.map(ae=>S.jsx(tre,{p:3,borderRadius:"md",_hover:{bg:B,cursor:re?"not-allowed":"pointer",transform:re?"none":"scale(1.02)"},transition:"background-color 0.2s ease-in-out, transform 0.2s ease-in-out",onClick:()=>!re&&K(ae.id,ae.name),borderWidth:"1px",borderColor:"transparent",_focus:{boxShadow:"outline"},opacity:re?.7:1,pointerEvents:re?"none":"auto",children:ae.name},ae.id))})]})]})]})},JQ=["Recent","Furniture","Objects","Upload","Portals"],Y8e={Furniture:"chair",Objects:"misc"},X8e=({isOpen:n,onClose:e,settings:i})=>{const[o,l]=k.useState(JQ[0]),[u,f]=k.useState(""),[_,E]=k.useState(!1),[b,C]=k.useState(!1),[I,P]=k.useState([]),[L,M]=k.useState(!0),[F,B]=k.useState(null),{placeCatalogueItem:Z}=dae(),K=kg("blue.500","blue.300"),re=kg("gray.500","gray.400"),ae=kg("whiteAlpha.200","whiteAlpha.200");k.useEffect(()=>{n&&(async()=>{M(!0),B(null),P([]);try{const de=Sl(Dn,"catalogue"),ue=await ed(de),Oe=[];ue.forEach(Ve=>{var ve,be;const xe=Ve.data(),Re=["chair","misc"];xe.glbUrl&&((ve=xe.categories)!=null&&ve.some(We=>Re.includes(We)))&&Oe.push({id:Ve.id,name:xe.name||"Unnamed Item",thumbnail:((be=xe.thumbnail)==null?void 0:be.src)||"https://via.placeholder.com/150",glbUrl:xe.glbUrl,categories:xe.categories})}),P(Oe)}catch(de){console.error("Error fetching catalogue items:",de),B("Failed to load catalogue items. Please check your connection and try again.")}M(!1)})()},[n]);const ne=le=>{l(le),f(""),E(le==="Portals")},pe=(le,de)=>{const ue=Y8e[de];let Oe=le;return ue&&(Oe=Oe.filter(Ve=>{var xe;return(xe=Ve.categories)==null?void 0:xe.includes(ue)})),u&&(Oe=Oe.filter(Ve=>Ve.name.toLowerCase().includes(u.toLowerCase()))),Oe},X=["Furniture","Objects"].includes(o)?pe(I,o):[],J=async le=>{console.log(`Placing item: ${le.name}`);try{if(!le.glbUrl){console.error("Item is missing GLB URL");return}const de=`item_${i.spaceID}_${Date.now()}`,ue={x:0,y:0,z:0},Oe={x:0,y:0,z:0},Ve={x:1,y:1,z:1},xe={itemId:de,name:le.name||"Unnamed Item",glbUrl:le.glbUrl,thumbnail:le.thumbnail||"https://via.placeholder.com/150",position:ue,rotation:Oe,scale:Ve,createdAt:Date.now(),updatedAt:Date.now(),categories:le.categories||[]};if(!xe.glbUrl)throw new Error("GLB URL is required");await qg(dr(Dn,"spaces",i.spaceID,"catalogue",de),xe),Z(de,xe.glbUrl,ue,Oe,Ve)?e():console.error("Failed to place item in Unity")}catch(de){console.error("Error placing item:",de)}},Y=()=>{C(!0)},ie=()=>{C(!1)};return S.jsxs(hs,{isOpen:n,onClose:e,size:"5xl",isCentered:!0,children:[S.jsx(fs,{bg:"blackAlpha.600",backdropFilter:"blur(5px)"}),S.jsxs(ps,{bg:"rgba(30, 30, 30, 0.85)",backdropFilter:"blur(15px)",color:"white",borderRadius:"xl",height:"85vh",maxHeight:"750px",width:"85vw",maxWidth:"1200px",overflow:"hidden",children:[S.jsx(yo,{pb:2,borderBottom:"1px solid",borderColor:"whiteAlpha.300",children:_?"Create New Portal":"Content Catalogue"}),S.jsx($s,{top:"14px"}),S.jsxs(bs,{p:0,display:"flex",flexDirection:"column",height:"calc(100% - 60px)",children:[S.jsxs(Er,{spacing:4,p:4,borderBottom:"1px solid",borderColor:"whiteAlpha.300",overflowX:"auto",children:[JQ.filter(le=>le!=="Portals").map(le=>S.jsx(jn,{variant:"ghost",size:"md",fontWeight:o===le?"semibold":"normal",color:o===le?"white":re,bg:o===le?ae:"transparent",borderBottom:o===le?`2px solid ${K}`:"2px solid transparent",borderRadius:"md",_hover:{bg:o!==le?"whiteAlpha.100":ae,color:"white"},onClick:()=>ne(le),px:4,whiteSpace:"nowrap",children:le},le)),S.jsx($C,{}),S.jsx(jn,{variant:"ghost",size:"md",fontWeight:o==="Portals"?"semibold":"normal",color:o==="Portals"?"white":re,bg:o==="Portals"?ae:"transparent",borderBottom:o==="Portals"?`2px solid ${K}`:"2px solid transparent",borderRadius:"md",_hover:{bg:o!=="Portals"?"whiteAlpha.100":ae,color:"white"},onClick:()=>ne("Portals"),px:4,whiteSpace:"nowrap",children:"Portals"},"Portals")]}),_&&o==="Portals"?S.jsx(ct,{p:4,flexGrow:1,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",children:S.jsx(jn,{size:"lg",colorScheme:"blue",onClick:Y,children:"Browse"})}):S.jsxs(S.Fragment,{children:[S.jsx(ct,{p:4,children:S.jsx(ti,{placeholder:`Search in ${o}...`,value:u,onChange:le=>f(le.target.value),bg:"rgba(255, 255, 255, 0.05)",borderColor:"rgba(255, 255, 255, 0.2)",borderRadius:"md",size:"md",_placeholder:{color:"whiteAlpha.500"}})}),S.jsx(ct,{p:4,pt:0,overflowY:"auto",flexGrow:1,children:S.jsx(s4,{templateColumns:"repeat(auto-fill, minmax(140px, 1fr))",gap:4,children:L?S.jsx(tt,{color:"whiteAlpha.700",children:"Loading items..."}):X.length>0?X.map(le=>S.jsxs(ct,{p:2,bg:"whiteAlpha.100",borderRadius:"lg",textAlign:"center",cursor:"pointer",_hover:{bg:"whiteAlpha.300",transform:"scale(1.03)"},onClick:()=>J(le),transition:"all 0.2s ease-in-out",display:"flex",flexDirection:"column",children:[S.jsx(ct,{bgImage:`url(${le.thumbnail})`,bgSize:"contain",bgRepeat:"no-repeat",bgPos:"center",borderRadius:"md",h:"100px",mb:2,flexShrink:0}),S.jsx(tt,{fontSize:"xs",noOfLines:2,flexGrow:1,display:"flex",alignItems:"center",justifyContent:"center",children:le.name})]},le.id)):S.jsxs(tt,{color:"whiteAlpha.700",children:[o==="Furniture"&&"No chairs found in the catalogue.",o==="Objects"&&"No miscellaneous objects found in the catalogue.",!["Furniture","Objects"].includes(o)&&`No items found in "${o}"${u&&` matching "${u}"`}.`]})})})]})]})]}),S.jsx(q8e,{isOpen:b,onClose:ie,currentSpaceId:i==null?void 0:i.spaceID})]})},J8e=({onTogglePlayerList:n,spaceID:e})=>{const{fullscreenRef:i}=Zd(),[o,l]=k.useState(!0),[u,f]=k.useState(!1),[_,E]=k.useState(!1),[b,C]=k.useState(!1),[I,P]=k.useState(!1),[L,M]=k.useState(!1),[F,B]=k.useState(!1),[Z,K]=k.useState(null),[re,ae]=k.useState(!1),[ne,pe]=k.useState(!1),[X,J]=k.useState(!1),[Y,ie]=k.useState(!1),le=ta(),{user:de}=k.useContext(Uo),ue=(de==null?void 0:de.Nickname)||"Unknown",[Oe,Ve]=k.useState(!1),xe=async()=>{if(de!=null&&de.uid&&e)try{const qe=await td(de.uid);let $e=!1,st=!1;if(qe.groups){const Rt=`space_${e}_owners`,kt=`space_${e}_hosts`;$e=qe.groups.includes(Rt),st=qe.groups.includes(kt)}const Je=await MN(de.uid,"disruptiveAdmin");if(ie(Je),K({rpmURL:qe.rpmURL?qe.rpmURL.replace(".glb",".png?scene=fullbody-portrait-closeupfront&w=640&q=75"):null}),pe($e||Je),J(st),!$e&&!Je&&re){ae(!1);const Rt=new CustomEvent("editModeChanged",{detail:{enabled:!1}});window.dispatchEvent(Rt),le({title:"Edit Mode Disabled",description:"You don't have permission to edit this space.",status:"warning",duration:5e3,isClosable:!0,position:"top"})}}catch(qe){console.error("Error fetching profile data:",qe),pe(!1),J(!1),ie(!1)}else pe(!1),J(!1),ie(!1)};k.useEffect(()=>{xe()},[de==null?void 0:de.uid,e,re]),k.useEffect(()=>{const qe=()=>{l(!0)};return window.addEventListener("PlayerInstantiated",qe),()=>{window.removeEventListener("PlayerInstantiated",qe)}},[]),k.useEffect(()=>{(async()=>{try{window.agoraClient&&typeof window.agoraClient.voiceDisabled=="boolean"&&Ve(window.agoraClient.voiceDisabled)}catch(st){console.error("Error checking if voice is disabled:",st)}})();const $e=st=>{st.detail&&typeof st.detail.voiceDisabled=="boolean"&&(console.log("Voice setting changed:",st.detail.voiceDisabled),Ve(st.detail.voiceDisabled))};return window.addEventListener("SpaceVoiceSettingChanged",$e),()=>{window.removeEventListener("SpaceVoiceSettingChanged",$e)}},[]);const Re=()=>E(!_),ve=()=>C(!b),be=()=>{M(!L),Ue()},We=()=>{P(!1),xe()},Pe=()=>{B(!1)},Te=()=>{B(!0),Ue()},ke=qe=>{qe.stopPropagation(),typeof n=="function"&&(H.log("CanvasMainMenu: Toggling player list"),n())},Ue=()=>{f(!1)},Be=qe=>{if(qe.stopPropagation(),!ne){le({title:"Permission Denied",description:"You don't have permission to edit this space. Only space owners can use Edit Mode.",status:"error",duration:5e3,isClosable:!0,position:"top"});return}const $e=!re;ae($e);const st=new CustomEvent("editModeChanged",{detail:{enabled:$e}});window.dispatchEvent(st),le({title:$e?"Edit Mode Enabled":"Edit Mode Disabled",description:$e?"You can now make changes to the scene.":"Scene editing is now disabled.",status:$e?"info":"success",duration:3e3,isClosable:!0,position:"top"})};return S.jsxs(S.Fragment,{children:[S.jsxs(bR,{isOpen:u,onClose:()=>f(!1),children:[S.jsx(wR,{as:Do,icon:S.jsx(NWe,{}),"aria-label":"Main menu",variant:"ghost",color:"white",bg:u?"whiteAlpha.400":"whiteAlpha.200",_hover:{bg:u?"whiteAlpha.500":"whiteAlpha.300"},size:"md",onClick:()=>f(!u)}),S.jsx(ru,{containerRef:i,children:S.jsx(TR,{bg:"rgba(0,0,0,0.4)",backdropFilter:"blur(10px)",border:"none",boxShadow:"lg",color:"white",width:"300px",p:4,borderRadius:"xl",zIndex:9999,transform:"none !important",children:S.jsxs(Fr,{align:"stretch",spacing:4,children:[S.jsxs(Er,{children:[S.jsx(eu,{size:"md",src:Z==null?void 0:Z.rpmURL,bg:"white",name:" ",borderWidth:"1px",borderColor:"whiteAlpha.300"}),S.jsxs(Fr,{align:"start",spacing:0,children:[S.jsxs(Er,{children:[S.jsx(tt,{fontWeight:"bold",children:ue}),ne&&!Y&&S.jsx(Kf,{label:"Owner",placement:"top",hasArrow:!0,zIndex:1e4,openDelay:300,gutter:8,portalProps:{containerRef:i},children:S.jsx(ct,{display:"inline-block",children:S.jsx(vn,{as:Dj,color:"green.400",boxSize:3})})}),!ne&&X&&!Y&&S.jsx(Kf,{label:"Host",placement:"top",hasArrow:!0,zIndex:1e4,openDelay:300,gutter:8,portalProps:{containerRef:i},children:S.jsx(ct,{display:"inline-block",children:S.jsx(vn,{as:Mj,color:"purple.400",boxSize:3})})}),Y&&S.jsx(Kf,{label:"Admin",placement:"top",hasArrow:!0,zIndex:1e4,openDelay:300,gutter:8,portalProps:{containerRef:i},children:S.jsx(ct,{display:"inline-block",children:S.jsx(vn,{as:a8e,color:"blue.400",boxSize:3})})})]}),S.jsx(tt,{fontSize:"sm",color:"whiteAlpha.800",children:"Spaces Metaverse"})]})]}),S.jsxs(Er,{spacing:4,justify:"center",children:[S.jsx(Do,{icon:S.jsx(l8e,{}),variant:"ghost",colorScheme:"whiteAlpha",size:"sm","aria-label":"People",_hover:{bg:"whiteAlpha.200"},onClick:ke}),ne&&S.jsx(Do,{icon:S.jsx(e8e,{}),variant:"ghost",colorScheme:re?"green":"whiteAlpha",size:"sm","aria-label":"Edit Mode",_hover:{bg:"whiteAlpha.200"},onClick:Be}),!re&&S.jsx(Do,{icon:S.jsx(ct,{w:"4",h:"4"}),variant:"ghost",colorScheme:"whiteAlpha",size:"sm","aria-label":"Action 3",_hover:{bg:"whiteAlpha.200"},isDisabled:!0}),re&&S.jsx(Do,{icon:S.jsx(Zze,{}),variant:"ghost",colorScheme:"whiteAlpha",size:"sm","aria-label":"Catalogue",_hover:{bg:"whiteAlpha.200"},onClick:Te}),S.jsx(Do,{icon:S.jsx(ct,{w:"4",h:"4"}),variant:"ghost",colorScheme:"whiteAlpha",size:"sm","aria-label":"Action 4",_hover:{bg:"whiteAlpha.200"}})]}),S.jsx(gp,{borderColor:"whiteAlpha.300"}),S.jsxs(Fr,{align:"stretch",spacing:2,children:[ne&&S.jsxs(Er,{p:2,borderRadius:"md",_hover:{bg:"whiteAlpha.200"},justify:"space-between",children:[S.jsx(tt,{fontSize:"md",children:"Edit Mode"}),S.jsx(yp,{id:"edit-mode-toggle",isChecked:re,onChange:Be,colorScheme:"green",sx:{"& .chakra-switch__track":{bg:re?"green.500":"black"}}})]}),ne&&S.jsx(tt,{fontSize:"md",cursor:"pointer",_hover:{bg:"whiteAlpha.200"},p:2,borderRadius:"md",onClick:be,children:"Manage Space"}),de&&e&&!Oe&&S.jsx(P8e,{onClose:Ue}),S.jsx(tt,{fontSize:"md",cursor:"pointer",_hover:{bg:"whiteAlpha.200"},p:2,borderRadius:"md",onClick:Re,children:"Settings"}),S.jsx(tt,{fontSize:"md",cursor:"pointer",_hover:{bg:"whiteAlpha.200"},p:2,borderRadius:"md",onClick:ve,children:"Controls"}),S.jsx(tt,{fontSize:"md",cursor:"pointer",_hover:{bg:"whiteAlpha.200"},p:2,borderRadius:"md",onClick:()=>window.open("https://support.spacesmetaverse.com/","_blank"),children:"Support"}),S.jsx(tt,{fontSize:"md",cursor:"pointer",_hover:{bg:"whiteAlpha.200"},p:2,borderRadius:"md",color:"red.300",children:"Leave"})]})]})})})]}),b&&S.jsx(O8e,{open:b,onClose:ve}),_&&S.jsx(N8e,{open:_,onClose:Re}),I&&S.jsx(_ae,{open:I,onClose:We}),S.jsx($8e,{isOpen:L,onClose:be}),S.jsx(X8e,{isOpen:F,onClose:Pe,settings:{spaceID:e}})]})},Q8e=({isOpen:n,onClose:e,mediaScreenId:i,onImageChange:o})=>{const{spaceID:l}=ea(),u=uc(),f=ta(),_=k.useRef(null),E=k.useRef(null),b=k.useRef(),[C,I]=k.useState(null),[P,L]=k.useState(""),[M,F]=k.useState(!1),[B,Z]=k.useState(0),[K,re]=k.useState(null),[ae,ne]=k.useState(!0),[pe,X]=k.useState(!1),[J,Y]=k.useState(!1),[ie,le]=k.useState(0),[de,ue]=k.useState("image"),[Oe,Ve]=k.useState(""),[xe,Re]=k.useState(!1);k.useEffect(()=>{(async()=>{if(n&&i&&l){ne(!0);try{const Rt=await Wf(l,i);if(Rt&&(Rt.imageUrl||Rt.videoUrl)){re(Rt);const kt=Rt.mediaType==="video";ue(kt?"video":"image"),Re(Rt.displayAsVideo||!1),kt&&Rt.videoUrl&&(Ve(Rt.videoUrl),le(1))}else re(null)}catch(Rt){H.error("Error fetching existing image:",Rt),re(null)}finally{ne(!1)}}})()},[n,i,l]),k.useEffect(()=>{n||(I(null),L(""),Z(0),Ve(""))},[n]);const ve=k.useCallback(Je=>{Je.preventDefault(),Je.stopPropagation(),Y(!0)},[]),be=k.useCallback(Je=>{Je.preventDefault(),Je.stopPropagation(),Y(!1)},[]),We=k.useCallback(Je=>{Je.preventDefault(),Je.stopPropagation()},[]),Pe=k.useCallback(Je=>{if(Je.preventDefault(),Je.stopPropagation(),Y(!1),Je.dataTransfer.files&&Je.dataTransfer.files.length>0){const Rt=Je.dataTransfer.files[0];Te(Rt)}},[]);k.useEffect(()=>{const Je=E.current;if(Je)return Je.addEventListener("dragenter",ve),Je.addEventListener("dragleave",be),Je.addEventListener("dragover",We),Je.addEventListener("drop",Pe),()=>{Je.removeEventListener("dragenter",ve),Je.removeEventListener("dragleave",be),Je.removeEventListener("dragover",We),Je.removeEventListener("drop",Pe)}},[ve,be,We,Pe]);const Te=Je=>{if(!Je)return;if(!Je.type.startsWith("image/")){f({title:"Invalid file type",description:"Please select an image file (PNG, JPEG, etc.)",status:"error",duration:5e3,isClosable:!0});return}I(Je);const Rt=new FileReader;Rt.onloadend=()=>{L(Rt.result)},Rt.readAsDataURL(Je)},ke=Je=>{const Rt=Je.target.files[0];Te(Rt)},Ue=async Je=>{const Rt=Je.target.checked;if(Re(Rt),K)try{await Pze(l,i,Rt),Rt?u("SetMediaScreenImage",{mediaScreenId:i,imageUrl:null,videoUrl:K.videoUrl||null,mediaType:K.mediaType||"image",displayAsVideo:!0}):u("SetMediaScreenImage",{mediaScreenId:i,imageUrl:K.imageUrl||null,videoUrl:K.videoUrl||null,mediaType:K.mediaType||"image",displayAsVideo:!1}),re({...K,displayAsVideo:Rt}),f({title:"Display mode updated",description:`The media screen will now be displayed as ${Rt?"video":"image"}`,status:"success",duration:3e3,isClosable:!0}),H.log(`Updated display mode for media screen ${i} to ${Rt?"video":"image"}`),o&&o({type:"update",mediaScreenId:i,displayAsVideo:Rt})}catch(kt){H.error("Error updating display mode:",kt),f({title:"Update failed",description:kt.message||"An error occurred while updating the display mode",status:"error",duration:5e3,isClosable:!0}),Re(!Rt)}},Be=async()=>{if(de==="image"&&!C){f({title:"No file selected",description:"Please select an image to upload",status:"warning",duration:5e3,isClosable:!0});return}if(de==="video"&&!Oe){f({title:"No video URL",description:"Please enter a video URL",status:"warning",duration:5e3,isClosable:!0});return}try{F(!0);const Je=setInterval(()=>{Z(ut=>{const mt=ut+10;return mt>=90?90:mt})},300);let Rt;de==="image"?Rt=await FQ(l,i,C,{mediaType:de,displayAsVideo:xe}):(Rt=Oe,await FQ(l,i,null,{mediaType:"video",directUrl:Oe,displayAsVideo:xe})),clearInterval(Je),Z(100);let kt=null,He=null;de==="image"?(kt=xe?null:Rt,He=(K==null?void 0:K.videoUrl)||null):(kt=!xe&&(K!=null&&K.imageUrl)?K.imageUrl:null,He=Rt),u("SetMediaScreenImage",{mediaScreenId:i,imageUrl:kt,videoUrl:He,mediaType:de,displayAsVideo:xe}),H.log(`Uploaded and sent ${de} for media screen ${i} (display as video: ${xe})`),o&&o({type:"upload",mediaScreenId:i,imageUrl:de==="image"?Rt:K==null?void 0:K.imageUrl,videoUrl:de==="video"?Rt:K==null?void 0:K.videoUrl,mediaType:de,displayAsVideo:xe}),f({title:"Upload successful",description:`The ${de} has been uploaded and applied to the media screen`,status:"success",duration:5e3,isClosable:!0}),setTimeout(()=>{I(null),L(""),F(!1),Z(0),e()},1e3)}catch(Je){H.error(`Error uploading ${de}:`,Je),f({title:"Upload failed",description:Je.message||`An error occurred while uploading the ${de}`,status:"error",duration:5e3,isClosable:!0}),F(!1),Z(0)}},qe=async()=>{X(!1);try{F(!0),await Aze(l,i),u("SetMediaScreenImage",{mediaScreenId:i,imageUrl:de==="image"?null:(K==null?void 0:K.imageUrl)||null,videoUrl:de==="video"?null:(K==null?void 0:K.videoUrl)||null,mediaType:null,displayAsVideo:!1}),H.log(`Deleted ${de} for media screen ${i}`),o&&o({type:"delete",mediaScreenId:i}),f({title:`${de==="image"?"Image":"Video"} deleted`,description:`The ${de} has been removed from the media screen`,status:"success",duration:5e3,isClosable:!0}),re(null),F(!1),Ve(""),Re(!1),setTimeout(()=>{e()},500)}catch(Je){H.error(`Error deleting ${de}:`,Je),f({title:"Deletion failed",description:Je.message||`An error occurred while deleting the ${de}`,status:"error",duration:5e3,isClosable:!0}),F(!1)}},$e=()=>{M||(I(null),L(""),Z(0),e())},st=Je=>{le(Je),ue(Je===0?"image":"video")};return S.jsxs(S.Fragment,{children:[S.jsxs(hs,{isOpen:n,onClose:$e,size:"xl",children:[S.jsx(fs,{backdropFilter:"blur(10px)"}),S.jsxs(ps,{bg:"gray.800",color:"white",maxW:"900px",children:[S.jsx(yo,{children:"Media Screen Content"}),S.jsx($s,{isDisabled:M}),S.jsxs(ct,{px:6,pb:2,children:[S.jsxs(Cr,{justify:"space-between",align:"center",bg:"gray.700",p:4,borderRadius:"md",mb:4,children:[S.jsxs(Er,{spacing:4,children:[S.jsx(tt,{fontWeight:"medium",children:"Display as:"}),S.jsxs(Er,{spacing:2,children:[S.jsx(vn,{as:My,color:xe?"gray.400":"green.300"}),S.jsx(yp,{colorScheme:"purple",size:"md",isChecked:xe,onChange:Ue}),S.jsx(vn,{as:o0,color:xe?"purple.300":"gray.400"})]})]}),S.jsx(Vf,{colorScheme:xe?"purple":"green",fontSize:"sm",px:2,py:1,borderRadius:"md",children:xe?"Video Output":"Image Output"})]}),S.jsxs(tt,{fontSize:"sm",color:"gray.400",mb:1,children:["Media Screen ID: ",S.jsx("strong",{children:i})]}),S.jsx(tt,{fontSize:"xs",color:"gray.500",mb:2,children:"The toggle above controls how the content will be displayed in the 3D space, regardless of the content type you upload."}),S.jsx(gp,{mb:4})]}),S.jsx(bs,{children:S.jsxs(Cr,{children:[S.jsx(L0,{orientation:"vertical",variant:"solid-rounded",colorScheme:"blue",index:ie,onChange:st,h:"100%",minW:"120px",mr:4,children:S.jsxs(M0,{children:[S.jsxs(Pa,{_selected:{color:"white",bg:"blue.500"},mb:2,py:6,justifyContent:"flex-start",children:[S.jsx(vn,{as:My,mr:2})," Image"]}),S.jsxs(Pa,{_selected:{color:"white",bg:"blue.500"},py:6,justifyContent:"flex-start",children:[S.jsx(vn,{as:o0,mr:2})," Video"]})]})}),S.jsx(ct,{flex:"1",children:ae?S.jsx(Cr,{justify:"center",align:"center",h:"150px",children:S.jsx(nd,{size:"xl",color:"blue.400"})}):S.jsxs(S.Fragment,{children:[S.jsx(ct,{children:ie===0?S.jsxs(Fr,{spacing:4,align:"stretch",children:[K&&K.imageUrl&&de==="image"&&S.jsxs(ct,{children:[S.jsx(tt,{fontWeight:"semibold",mb:2,children:"Current Image:"}),S.jsxs(Cr,{children:[S.jsx(ct,{borderWidth:"1px",borderRadius:"md",overflow:"hidden",mb:2,maxW:"200px",mr:4,children:S.jsx(cp,{src:K.imageUrl,alt:"Current image",maxHeight:"150px",width:"100%",objectFit:"contain"})}),S.jsxs(Fr,{align:"flex-start",spacing:2,children:[S.jsxs(tt,{fontSize:"xs",color:"gray.400",children:["Uploaded: ",new Date(K.uploadedAt).toLocaleString()]}),S.jsxs(tt,{fontSize:"xs",color:"gray.400",children:["Display Mode: ",K.displayAsVideo?"Video":"Image"]}),S.jsx(jn,{size:"sm",colorScheme:"red",variant:"outline",leftIcon:S.jsx(vn,{as:b0}),onClick:()=>X(!0),isDisabled:M,children:"Delete"})]})]}),S.jsx(gp,{my:4})]}),S.jsx(tt,{fontWeight:"semibold",mb:2,children:K&&K.imageUrl&&de==="image"?"Replace with new image:":"Upload new image:"}),S.jsxs(ct,{ref:E,borderWidth:"2px",borderRadius:"md",borderStyle:"dashed",borderColor:J?"blue.400":"gray.500",bg:J?"blue.900":"gray.700",p:6,textAlign:"center",transition:"all 0.2s",_hover:{borderColor:"blue.400",bg:"gray.600"},cursor:"pointer",onClick:()=>_.current.click(),children:[P?S.jsx(ct,{borderRadius:"md",overflow:"hidden",maxH:"200px",children:S.jsx(cp,{src:P,alt:"Preview",maxHeight:"200px",width:"100%",objectFit:"contain"})}):S.jsxs(Fr,{spacing:2,children:[S.jsx(vn,{as:jk,boxSize:"24px",color:"gray.400"}),S.jsx(tt,{children:"Drag and drop an image here, or click to browse"}),S.jsx(tt,{fontSize:"xs",color:"gray.400",children:"Supports PNG, JPG, JPEG, GIF"})]}),S.jsx(ti,{type:"file",accept:"image/*",onChange:ke,ref:_,display:"none"})]}),C&&S.jsxs(tt,{fontSize:"sm",children:["Selected file: ",C.name," (",Math.round(C.size/1024)," KB)"]})]}):S.jsxs(Fr,{spacing:4,align:"stretch",children:[K&&K.videoUrl&&de==="video"&&S.jsxs(ct,{children:[S.jsx(tt,{fontWeight:"semibold",mb:2,children:"Current Video URL:"}),S.jsxs(Cr,{children:[S.jsx(ct,{borderWidth:"1px",borderRadius:"md",p:3,mb:2,flex:"1",mr:4,bg:"gray.700",children:S.jsx(tt,{fontSize:"sm",wordBreak:"break-all",children:K.videoUrl})}),S.jsxs(Fr,{align:"flex-start",spacing:2,children:[S.jsxs(tt,{fontSize:"xs",color:"gray.400",children:["Added: ",new Date(K.uploadedAt).toLocaleString()]}),S.jsxs(tt,{fontSize:"xs",color:"gray.400",children:["Display Mode: ",K.displayAsVideo?"Video":"Image"]}),S.jsx(jn,{size:"sm",colorScheme:"red",variant:"outline",leftIcon:S.jsx(vn,{as:b0}),onClick:()=>X(!0),isDisabled:M,children:"Delete"})]})]}),S.jsx(gp,{my:4})]}),S.jsx(tt,{fontWeight:"semibold",mb:2,children:K&&K.videoUrl&&de==="video"?"Replace with new video:":"Add video URL:"}),S.jsx(ct,{p:3,bg:"blue.900",borderRadius:"md",mb:4,borderLeftWidth:"4px",borderLeftColor:"blue.400",children:S.jsxs(Er,{children:[S.jsx(vn,{as:wae,color:"blue.300"}),S.jsx(tt,{fontSize:"sm",fontWeight:"medium",children:'After entering a URL, click the "Save Video URL" button at the bottom to save your changes.'})]})}),S.jsxs(ur,{children:[S.jsx(ei,{fontSize:"sm",children:"Video URL"}),S.jsx(ti,{placeholder:"Enter video URL (YouTube, Vimeo, etc.)",value:Oe,onChange:Je=>Ve(Je.target.value),bg:"gray.700",borderColor:"gray.600",_hover:{borderColor:"blue.400"},_focus:{borderColor:"blue.400",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},size:"lg"}),S.jsx(tt,{fontSize:"xs",color:"gray.400",mt:1,children:"Enter a URL from YouTube, Vimeo, or other video hosting services"})]}),S.jsxs(ct,{mt:4,p:4,bg:"gray.700",borderRadius:"md",children:[S.jsxs(Er,{children:[S.jsx(vn,{as:o0,color:"blue.300"}),S.jsx(tt,{fontWeight:"medium",children:"Video Support"})]}),S.jsx(tt,{fontSize:"sm",mt:2,color:"gray.300",children:"Video playback will be implemented in a future update. For now, you can add the URL which will be stored with the media screen."}),S.jsx(tt,{fontSize:"sm",mt:2,color:"yellow.300",fontWeight:"medium",children:'Important: Click the "Upload" button at the bottom to save your video URL.'})]}),Oe&&S.jsxs(ct,{mt:4,p:4,bg:"gray.900",borderRadius:"md",borderWidth:"1px",borderColor:"blue.500",children:[S.jsxs(Er,{mb:2,children:[S.jsx(vn,{as:L8e,color:"blue.300"}),S.jsx(tt,{fontWeight:"medium",children:"URL Preview"})]}),S.jsx(tt,{fontSize:"sm",wordBreak:"break-all",color:"gray.300",children:Oe}),S.jsx(tt,{fontSize:"xs",color:"gray.400",mt:2,children:"This URL will be saved when you click the Upload button below"})]})]})}),M&&S.jsxs(ct,{mt:4,children:[S.jsxs(tt,{mb:2,children:["Uploading: ",B,"%"]}),S.jsx(Ky,{value:B,colorScheme:"blue",size:"sm",borderRadius:"md"})]})]})})]})}),S.jsxs(Cp,{children:[S.jsx(jn,{variant:"ghost",mr:3,onClick:$e,isDisabled:M,children:"Cancel"}),S.jsx(jn,{colorScheme:"blue",onClick:Be,isLoading:M,loadingText:"Uploading",isDisabled:de==="image"&&!C||de==="video"&&!Oe||M||ae,leftIcon:S.jsx(vn,{as:de==="image"?My:o0}),size:"lg",px:6,children:de==="image"?"Upload Image":"Save Video URL"})]})]})]}),S.jsx(OMe,{isOpen:pe,leastDestructiveRef:b,onClose:()=>X(!1),children:S.jsx(fs,{children:S.jsxs(kMe,{bg:"gray.800",color:"white",children:[S.jsxs(yo,{fontSize:"lg",fontWeight:"bold",children:["Delete ",de==="video"?"Video":"Image"]}),S.jsxs(bs,{children:["Are you sure you want to delete this ",de,"? This will revert the media screen to its blank state."]}),S.jsxs(Cp,{children:[S.jsx(jn,{ref:b,onClick:()=>X(!1),children:"Cancel"}),S.jsx(jn,{colorScheme:"red",onClick:qe,ml:3,leftIcon:S.jsx(vn,{as:b0}),children:"Delete"})]})]})})})]})},Z8e=n=>{const[e,i]=k.useState(null),[o,l]=k.useState(""),[u,f]=k.useState(null),[_,E]=k.useState(!1),b=bl(),{spaceID:C}=ea(),I=k.useCallback(M=>{var F,B;try{if(!M)return null;if(M.includes("youtube.com")||M.includes("youtu.be")){let Z="";return M.includes("youtube.com/watch")?Z=new URLSearchParams(new URL(M).search).get("v"):M.includes("youtu.be/")&&(Z=M.split("youtu.be/")[1].split("?")[0]),Z?`https://www.youtube.com/embed/${Z}?autoplay=1`:M}if(M.includes("vimeo.com")){if(M.includes("player.vimeo.com/video"))return M;const Z=(B=(F=M.split("vimeo.com/")[1])==null?void 0:F.split("?")[0])==null?void 0:B.split("/")[0];return Z?`https://player.vimeo.com/video/${Z}?autoplay=1`:M}return M}catch(Z){return H.error("Error converting to embed URL:",Z),M}},[]),P=k.useCallback(()=>{setTimeout(()=>{E(!1),H.log("Video processing state reset")},100)},[]);k.useEffect(()=>{let M=!0,F=null;const Z=b("PlayMediaScreenVideo",async K=>{try{console.log("[DEBUG] PlayMediaScreenVideo event received:",K,"isEditMode:",n),console.log("PlayMediaScreenVideo event received:",K);const{mediaScreenId:re,videoUrl:ae}=K||{};if(!re){H.error("Media screen ID is missing in Unity event data."),P();return}if(n){console.log(`[DEBUG] Edit mode is active for screen ${re}, setting ID but not playing video`),H.log("Edit mode is active, setting media screen ID but not playing video"),f(re);return}if(E(!0),F=setTimeout(()=>{M&&(H.warn("Video processing timeout reached, resetting state"),E(!1))},5e3),ae){if(console.log(`Using direct video URL from event: ${ae}`),M)try{const ne=I(ae);console.log(`Setting video URL to: ${ne} (original: ${ae})`),i(ne),l(`Media Screen ${re}`),f(re),H.log("Media screen video URL set directly from event:",ne)}catch(ne){H.error("Error setting video URL from direct URL:",ne)}finally{P(),clearTimeout(F)}return}console.log(`Fetching media screen data for ID: ${re}`);try{const ne=await Wf(C,re);if(console.log("Media screen data from Firestore:",ne),!ne||!ne.videoUrl){H.error("No video URL found for media screen:",re),P(),clearTimeout(F);return}if(!ne.displayAsVideo){H.log("Media screen is not set to display as video:",re),console.log("displayAsVideo flag is false for this media screen"),P(),clearTimeout(F);return}if(M)try{const pe=I(ne.videoUrl);console.log(`Setting video URL to: ${pe} (original: ${ne.videoUrl})`),i(pe),l(ne.title||`Media Screen ${re}`),f(re),H.log("Media screen video URL set to:",pe)}catch(pe){H.error("Error setting video URL from Firestore:",pe)}finally{P(),clearTimeout(F)}}catch(ne){H.error(`Error fetching media screen data for ${re}:`,ne),P(),clearTimeout(F)}}catch(re){H.error("Error handling media screen video play:",re),console.error("Error handling media screen video play:",re),P(),clearTimeout(F)}});return()=>{M=!1,F&&clearTimeout(F),Z()}},[b,C,n,I,P]);const L=k.useCallback(()=>{i(null),l(""),f(null),E(!1),H.log("Video player state reset")},[]);return[e,o,u,L,_]},eGe=()=>{const{spaceID:n}=ea(),e=uc(),i=bl(),[o,l]=k.useState(!1);k.useEffect(()=>{if(window.isPlayerInstantiated){H.log("useMediaScreenThumbnails: Unity already ready (via window flag)"),l(!0);return}const b=()=>{H.log("useMediaScreenThumbnails: Unity is now ready (PlayerInstantiated event)"),l(!0)};return window.addEventListener("PlayerInstantiated",b),()=>{window.removeEventListener("PlayerInstantiated",b)}},[]);const u=k.useCallback(async b=>{try{return b.includes("vimeo.com")?await f(b):b.includes("youtube.com")||b.includes("youtu.be")?await _(b):"https://via.placeholder.com/640x360?text=Video"}catch(C){return H.error(`Error fetching thumbnail for ${b}:`,C),"https://via.placeholder.com/640x360?text=Error"}},[]),f=async b=>{try{const C=`https://vimeo.com/api/oembed.json?url=${encodeURIComponent(b)}`,I=await fetch(C);if(!I.ok)throw new Error(`Failed to fetch Vimeo thumbnail: ${I.statusText}`);const P=await I.json(),L=P.thumbnail_url.replace(/_\d+x\d+/,""),M=["640x360","295x166"];let F=null;for(let B of M){const Z=`https://i.vimeocdn.com/filter/overlay?src0=${encodeURIComponent(`${L}_${B}`)}&src1=http://f.vimeocdn.com/p/images/crawler_play.png`;try{if((await fetch(Z,{method:"HEAD"})).ok){F=Z;break}}catch(K){H.warn(`Failed to validate thumbnail URL: ${Z}`,K)}}return F||P.thumbnail_url}catch(C){return H.error(`Error fetching Vimeo thumbnail: ${C.message}`),"https://via.placeholder.com/640x360?text=Vimeo+Video"}},_=async b=>{let C="";if(b.includes("youtube.com/watch")?C=new URLSearchParams(new URL(b).search).get("v"):b.includes("youtu.be/")&&(C=b.split("youtu.be/")[1].split("?")[0]),!C)throw new Error("Could not extract YouTube video ID");const I=`https://img.youtube.com/vi/${C}/maxresdefault.jpg`;try{if((await fetch(I,{method:"HEAD"})).ok)return I}catch(P){H.warn(`Failed to validate maxresdefault thumbnail for YouTube video ${C}`,P)}return`https://img.youtube.com/vi/${C}/hqdefault.jpg`},E=k.useCallback(async b=>{try{if(!n||!b)return;H.log(`Refreshing thumbnail for media screen ${b}`);const C=await Wf(n,b);if(!C){H.log(`No media screen found with ID ${b}`);return}if(H.log("Media screen data:",C),!C.displayAsVideo||!C.videoUrl){H.log(`Media screen ${b} is not set to display as video or has no video URL`);return}const I=await u(C.videoUrl);e("SetMediaScreenThumbnail",{mediaScreenId:b,thumbnailUrl:I}),H.log(`Sent refreshed thumbnail for media screen ${b}: ${I}`)}catch(C){H.error(`Error refreshing thumbnail for media screen ${b}:`,C)}},[n,u,e]);k.useEffect(()=>{if(!o){H.log("useMediaScreenThumbnails: Waiting for Unity to be ready before setting up thumbnail listeners");return}H.log("useMediaScreenThumbnails: Unity is ready, now setting up thumbnail listeners");const C=i("SetMediaScreenThumbnail",async I=>{try{const{mediaScreenId:P,thumbnailUrl:L}=I;L==="refresh"&&P&&(console.log(`Received request to refresh thumbnail for media screen ${P}`),await E(P))}catch(P){console.error("Error handling SetMediaScreenThumbnail event:",P)}});return()=>{C()}},[i,E,o]),k.useEffect(()=>{if(!o){H.log("useMediaScreenThumbnails: Waiting for Unity to be ready before fetching thumbnails");return}H.log("useMediaScreenThumbnails: Unity is ready, now fetching thumbnails");const b=async()=>{try{if(!n)throw new Error("spaceID is not defined.");H.log("Fetching media screens for thumbnails...");const I=await N3(n);H.log("All media screens:",I);const P=I.filter(F=>F.displayAsVideo&&F.videoUrl);if(H.log("Media screens set to display as videos:",P),P.length===0){H.log("No media screens set to display as videos found.");return}H.log(`Found ${P.length} media screens set to display as videos.`);const L=P.map(async F=>{try{const B=await u(F.videoUrl);return H.log(`Fetched thumbnail for ${F.id}: ${B}`),{mediaScreenId:F.id,thumbnailUrl:B}}catch(B){return H.error(`Error processing thumbnail for media screen ${F.id}:`,B),{mediaScreenId:F.id,thumbnailUrl:"https://via.placeholder.com/640x360?text=Error"}}}),M=await Promise.all(L);H.log("Fetched Media Screen Thumbnails",M),M.forEach(({mediaScreenId:F,thumbnailUrl:B})=>{e("SetMediaScreenThumbnail",{mediaScreenId:F,thumbnailUrl:B}),H.log(`Sent thumbnail to Unity for media screen ${F}: ${B}`)})}catch(I){H.error("Error fetching media screen thumbnails:",I)}};b();const C=setInterval(b,5*60*1e3);return()=>{clearInterval(C)}},[e,n,u,o])},QQ={iframeContainer:{position:"relative",paddingBottom:"56.25%",height:0,overflow:"hidden",width:"100%",pointerEvents:"auto !important"},iframe:{position:"absolute",top:0,left:0,width:"100%",height:"100%",border:"none",pointerEvents:"auto !important",zIndex:1e4}},tGe=()=>S.jsx("style",{dangerouslySetInnerHTML:{__html:`
        /* Disable pointer events on Unity elements when modal is open */
        body.unity-input-disabled #unity-container,
        body.unity-input-disabled #unity-canvas {
          pointer-events: none !important;
        }
        
        /* Make sure the modal is above Unity */
        .chakra-modal__overlay {
          z-index: 1001 !important;
          pointer-events: auto !important;
        }
        
        .chakra-modal__content {
          z-index: 1002 !important;
          pointer-events: auto !important;
        }
        
        /* Make sure the iframe is visible and interactive */
        .video-iframe {
          z-index: 1003 !important;
          pointer-events: auto !important;
        }
        
        /* Make sure the close button is accessible */
        .chakra-modal__close-btn {
          z-index: 1004 !important;
        }
        
        /* Ensure the iframe container allows clicks */
        .iframe-container {
          pointer-events: auto !important;
        }
        
        /* Remove the full-screen blocker */
      `}}),nGe=({videoUrl:n,videoTitle:e,mediaScreenId:i,isOpen:o,onClose:l})=>{const{fullscreenRef:u}=Zd();return zN(o,`video-modal-${i}`),k.useEffect(()=>{if(o){const f=b=>{b.target.classList&&b.target.classList.contains("chakra-modal__overlay")&&(b.stopPropagation(),b.preventDefault())};document.addEventListener("mousemove",f,!0),document.addEventListener("mousedown",f,!0),document.addEventListener("mouseup",f,!0),document.addEventListener("click",f,!0),document.addEventListener("wheel",f,!0);const _=document.getElementById("unity-canvas"),E=document.getElementById("unity-container");if(_&&(_.style.pointerEvents="none"),E&&(E.style.pointerEvents="none"),document.body.classList.add("unity-input-disabled"),window.unityInstance)try{window.unityInstance.SendMessage("WebGLInputManager","Disable"),window.unityInstance.SendMessage("CameraController","DisableInput","VideoModal")}catch(b){console.error("Error disabling Unity input:",b)}return()=>{if(document.removeEventListener("mousemove",f,!0),document.removeEventListener("mousedown",f,!0),document.removeEventListener("mouseup",f,!0),document.removeEventListener("click",f,!0),document.removeEventListener("wheel",f,!0),_&&(_.style.pointerEvents="auto"),E&&(E.style.pointerEvents="auto"),document.body.classList.remove("unity-input-disabled"),window.unityInstance)try{window.unityInstance.SendMessage("WebGLInputManager","Enable"),window.unityInstance.SendMessage("CameraController","EnableInput","VideoModal")}catch(b){console.error("Error re-enabling Unity input:",b)}}}},[o]),S.jsxs(S.Fragment,{children:[S.jsx(tGe,{}),S.jsxs(hs,{isOpen:o,onClose:l,size:"xl",isCentered:!0,portalProps:{containerRef:u},closeOnOverlayClick:!0,closeOnEsc:!0,id:`video-modal-${i}`,children:[S.jsx(fs,{bg:"rgba(0, 0, 0, 0.8)",onClick:f=>{f.target===f.currentTarget&&(l(),f.stopPropagation(),f.preventDefault())},onMouseMove:f=>{f.target===f.currentTarget&&(f.stopPropagation(),f.preventDefault())},onMouseDown:f=>{f.target===f.currentTarget&&(f.stopPropagation(),f.preventDefault())},onMouseUp:f=>{f.target===f.currentTarget&&(f.stopPropagation(),f.preventDefault())},onWheel:f=>{f.target===f.currentTarget&&(f.stopPropagation(),f.preventDefault())},style:{pointerEvents:"auto"}}),S.jsxs(ps,{bg:"gray.900",color:"white",borderRadius:"lg",overflow:"hidden",maxWidth:"80vw",maxHeight:"80vh",className:"video-modal-content",children:[S.jsx($s,{size:"lg",bg:"gray.700",color:"white",borderRadius:"full",zIndex:"10004",_hover:{bg:"gray.600"},position:"absolute",top:"10px",right:"10px"}),S.jsx(bs,{p:0,width:"100%",children:n?S.jsx(ct,{className:"iframe-container",style:QQ.iframeContainer,children:S.jsx("iframe",{className:"video-iframe",src:n,style:QQ.iframe,allow:"autoplay; fullscreen",allowFullScreen:!0,title:e||"Video Player"})}):S.jsxs(Cr,{direction:"column",align:"center",justify:"center",h:"400px",children:[S.jsx(nd,{size:"xl",mb:4}),S.jsx(tt,{children:"Unable to load video"}),S.jsx(tt,{fontSize:"sm",color:"gray.400",mt:2,children:"No video URL provided"})]})})]})]})]})},eo=(...n)=>{},rGe=()=>{const{isOpen:n,onOpen:e,onClose:i}=Xd(),[o,l]=k.useState(null),[u,f]=k.useState("image"),_=k.useRef(null);zN(n,"image-viewer-modal");const E=k.useCallback(I=>{I.stopPropagation()},[]);return k.useEffect(()=>{if(n&&_.current){const I=_.current;I.addEventListener("mousemove",E),I.addEventListener("mousedown",E),I.addEventListener("mouseup",E),I.addEventListener("wheel",E);const P=document.getElementById("unity-canvas");return P&&(P.style.pointerEvents="none"),()=>{I.removeEventListener("mousemove",E),I.removeEventListener("mousedown",E),I.removeEventListener("mouseup",E),I.removeEventListener("wheel",E),P&&(P.style.pointerEvents="auto")}}},[n,E]),{isOpen:n,currentImageUrl:o,currentMediaType:u,openImageViewer:(I,P="image")=>{console.log(`[DEBUG] Opening image viewer with URL: ${I} and original media type: ${P}`);const L=typeof I=="string"&&(I.match(/\.(jpeg|jpg|gif|png|webp)($|\?)/i)||I.includes("firebasestorage")&&!I.includes("video")),M=L?"image":P;console.log(`[DEBUG] Detected URL as ${L?"image":"non-image"}, using media type: ${M}`),l(I),f(M),e()},closeImageViewer:()=>{i(),setTimeout(()=>{l(null),f("image")},300)},modalContentRef:_,preventPropagation:E}},iGe=()=>S.jsx("style",{dangerouslySetInnerHTML:{__html:`
        body.unity-input-disabled #unity-container,
        body.unity-input-disabled #unity-canvas {
          pointer-events: none !important;
        }
        
        .image-viewer-modal-content {
          pointer-events: auto !important;
        }
        
        .chakra-modal__overlay {
          pointer-events: auto !important;
        }
      `}}),KU=n=>{if(!n)return null;try{if(n.includes("firebasestorage.googleapis.com")){const e=new URL(n),i=e.searchParams.get("alt"),o=e.searchParams.get("token");return e.search="",i&&e.searchParams.set("alt",i),o&&e.searchParams.set("token",o),eo(`Cleaned Firebase URL from ${n} to ${e.toString()}`),e.toString()}return n}catch(e){return console.error("Error cleaning Firebase URL:",e),n}},sGe=()=>{const{spaceID:n}=ea(),[e,i]=k.useState(!1),[o,l]=k.useState([]),[u,f]=k.useState(null),{isOpen:_,onOpen:E,onClose:b}=Xd(),[C,I]=k.useState({}),[P,L]=k.useState(0);k.useRef(null);const M=uc(),{fullscreenRef:F}=Zd(),B=bl(),[Z,K]=k.useState(!1),{isOpen:re,currentImageUrl:ae,currentMediaType:ne,openImageViewer:pe,closeImageViewer:X,modalContentRef:J,preventPropagation:Y}=rGe(),[ie,le,de,ue,Oe]=Z8e(e),{isOpen:Ve,onOpen:xe,onClose:Re}=Xd();eGe(),aae(),k.useEffect(()=>{if(window.isPlayerInstantiated){K(!0);return}const Te=()=>{K(!0)};return window.addEventListener("PlayerInstantiated",Te),()=>{window.removeEventListener("PlayerInstantiated",Te)}},[]);const ve=k.useCallback(Te=>{if(Array.isArray(o)&&o.length>0){const ke=o.find(Ue=>Ue.mediaScreenId===Te);if(ke){const Ue=ke.imageUrl,Be=ke.videoUrl;return{screen:ke,imageUrl:Ue,videoUrl:Be,mediaType:ke.mediaType||"image",displayAsVideo:ke.displayAsVideo||!1}}}else console.warn("mediaScreens is not an array or is empty:",o);if(ae){let ke=null;return Array.isArray(o)&&(ke=o.find(Ue=>Ue.mediaScreenId===Te)),{screen:ke||{mediaScreenId:Te},imageUrl:ae,videoUrl:null,mediaType:(ke==null?void 0:ke.mediaType)||"image",displayAsVideo:(ke==null?void 0:ke.displayAsVideo)||!1}}return n&&Te&&Wf(n,Te).then(ke=>{ke&&l(Ue=>Array.isArray(Ue)&&Ue.some(qe=>qe.mediaScreenId===Te)?Ue.map(qe=>qe.mediaScreenId===Te?{...qe,imageUrl:ke.imageUrl,videoUrl:ke.videoUrl,mediaType:ke.mediaType||"image",displayAsVideo:ke.displayAsVideo||!1,hasImage:!!ke.imageUrl,source:"firestore-fetch",lastUpdated:new Date().toISOString()}:qe):[...Array.isArray(Ue)?Ue:[],{mediaScreenId:Te,imageUrl:ke.imageUrl,videoUrl:ke.videoUrl,mediaType:ke.mediaType||"image",displayAsVideo:ke.displayAsVideo||!1,hasImage:!!ke.imageUrl,source:"firestore-fetch",firstDetected:new Date().toISOString(),lastUpdated:new Date().toISOString()}])}).catch(ke=>{console.error(`Error fetching media screen data for ${Te}:`,ke)}),console.warn("No screen data found for:",Te),null},[o,ae,n,l]),be=k.useCallback(Te=>{if(console.log(`[DEBUG] Processing click on screen: ${Te}, isEditMode: ${e}`),f(Te),e)console.log(`[DEBUG] Opening upload modal for screen: ${Te} in edit mode`),E();else{const ke=ve(Te);if(ke){if(console.log(`[DEBUG] Screen data for ${Te}:`,ke),eo("Screen data details:",{mediaScreenId:Te,imageUrl:ke.imageUrl,videoUrl:ke.videoUrl,mediaType:ke.mediaType,displayAsVideo:ke.displayAsVideo}),Ve&&de===Te)return;if(ke.displayAsVideo&&ke.videoUrl)eo(`Opening video player for: ${ke.videoUrl}`),M("PlayMediaScreenVideo",{mediaScreenId:Te,videoUrl:ke.videoUrl});else if(ke.imageUrl){eo(`Opening viewer modal with ${ke.mediaType}: ${ke.imageUrl}`);const Be=KU(ke.imageUrl);pe(Be,ke.mediaType||"image")}else n&&Wf(n,Te).then(Be=>{if(Be){if(Be.displayAsVideo&&Be.videoUrl)eo(`Opening video player for: ${Be.videoUrl}`),M("PlayMediaScreenVideo",{mediaScreenId:Te,videoUrl:Be.videoUrl});else if(Be.imageUrl){eo(`Opening viewer modal with image: ${Be.imageUrl}`);const qe=KU(Be.imageUrl);pe(qe,Be.mediaType||"image")}l(qe=>Array.isArray(qe)&&qe.some(st=>st.mediaScreenId===Te)?qe.map(st=>st.mediaScreenId===Te?{...st,...Be,mediaScreenId:Te,source:"firestore-click",lastUpdated:new Date().toISOString()}:st):[...Array.isArray(qe)?qe:[],{...Be,mediaScreenId:Te,source:"firestore-click",firstDetected:new Date().toISOString(),lastUpdated:new Date().toISOString()}])}}).catch(Be=>{console.error(`Error fetching media screen data for ${Te}:`,Be)})}else n&&Wf(n,Te).then(Ue=>{if(Ue){if(Ue.displayAsVideo&&Ue.videoUrl)eo(`Opening video player for: ${Ue.videoUrl}`),M("PlayMediaScreenVideo",{mediaScreenId:Te,videoUrl:Ue.videoUrl});else if(Ue.imageUrl){eo(`Opening viewer modal with image: ${Ue.imageUrl}`);const Be=KU(Ue.imageUrl);pe(Be,Ue.mediaType||"image")}l(Be=>Array.isArray(Be)&&Be.some($e=>$e.mediaScreenId===Te)?Be.map($e=>$e.mediaScreenId===Te?{...$e,...Ue,mediaScreenId:Te,source:"firestore-click",lastUpdated:new Date().toISOString()}:$e):[...Array.isArray(Be)?Be:[],{...Ue,mediaScreenId:Te,source:"firestore-click",firstDetected:new Date().toISOString(),lastUpdated:new Date().toISOString()}])}}).catch(Ue=>{console.error(`Error fetching media screen data for ${Te}:`,Ue)})}},[e,E,ve,Ve,de,M,pe,n]);k.useEffect(()=>{if(!Z)return;const Te=async()=>{if(n)try{const Ue=await N3(n),Be={};Ue.forEach(qe=>{qe.id&&qe.imageUrl&&(Be[qe.id]=qe.imageUrl)}),l(qe=>qe.map($e=>{const st=!!Be[$e.mediaScreenId],Je=Be[$e.mediaScreenId],Rt=$e.mediaType||"image";return{...$e,hasImage:st,imageUrl:Je,mediaType:Rt}}))}catch(Ue){console.error("Error fetching media screen images:",Ue)}};Te();let ke=null;return e&&(ke=setInterval(Te,5e3)),()=>{ke&&clearInterval(ke)}},[n,e,P,Z]);const We=Te=>{l(ke=>ke.map(Ue=>{if(Ue.mediaScreenId===Te.mediaScreenId){if(Te.type==="upload")return{...Ue,hasImage:!0,imageUrl:Te.imageUrl,mediaType:Te.mediaType||"image"};if(Te.type==="delete")return{...Ue,hasImage:!1,imageUrl:null,mediaType:null}}return Ue})),Te.type==="delete"?(setTimeout(()=>{l(ke=>ke.filter(Ue=>Ue.mediaScreenId!==Te.mediaScreenId))},100),setTimeout(()=>{l(ke=>ke.filter(Ue=>Ue.mediaScreenId!==Te.mediaScreenId))},1500)):setTimeout(()=>{l(ke=>ke.some(Be=>Be.mediaScreenId===Te.mediaScreenId)?ke.map(Be=>Be.mediaScreenId===Te.mediaScreenId?{...Be,imageUrl:Te.imageUrl,hasImage:!0,mediaType:Te.mediaType||"image"}:Be):[...ke,{mediaScreenId:Te.mediaScreenId,imageUrl:Te.imageUrl,hasImage:!0,mediaType:Te.mediaType||"image",source:"delayed-update",firstDetected:new Date().toISOString(),lastUpdated:new Date().toISOString()}])},1e3)};k.useEffect(()=>{const Te=ke=>{const Ue=ke.detail.enabled;i(Ue),Ue?M("SetMediaScreenEditMode",{enabled:!0,showUploadIcon:!0}):M("SetMediaScreenEditMode",{enabled:!1,showUploadIcon:!1})};return window.addEventListener("editModeChanged",Te),()=>{window.removeEventListener("editModeChanged",Te)}},[M]),k.useEffect(()=>(window.JsSendMediaScreenClick=function(Te){console.log("Unity: MediaScreenClick received with data:",Te);try{const ke=JSON.parse(Te),Ue=new CustomEvent("MediaScreenClick",{detail:JSON.stringify(ke)});window.dispatchEvent(Ue)}catch(ke){console.error("Error processing MediaScreenClick data:",ke)}},window.handleMediaScreenClick=function(Te){console.log("Direct call to handleMediaScreenClick with ID:",Te),be(Te)},window.TestJavaScriptFromUnity=function(Te){console.log("Unity called TestJavaScriptFromUnity with:",Te),alert("Unity called JavaScript: "+Te)},()=>{delete window.JsSendMediaScreenClick,delete window.handleMediaScreenClick,delete window.TestJavaScriptFromUnity}),[be]),k.useEffect(()=>{const Te=Be=>{try{const qe=JSON.parse(Be.detail);H.log(`MediaScreen registered: ${qe.mediaScreenId}`),eo("MediaScreen registered from Unity:",qe),l(st=>st.some(Rt=>Rt.mediaScreenId===qe.mediaScreenId)?st.map(Rt=>Rt.mediaScreenId===qe.mediaScreenId?{...Rt,...qe,source:"event",lastUpdated:new Date().toISOString()}:Rt):[...st,{...qe,source:"event",firstDetected:new Date().toISOString(),lastUpdated:new Date().toISOString()}]),e&&M("SetMediaScreenEditMode",{mediaScreenId:qe.mediaScreenId,enabled:!0,showUploadIcon:!0});const $e=qe.mediaScreenId;$e&&Wf(n,$e).then(st=>{st&&(eo(`Media screen data for ${$e}:`,st),st.displayAsVideo&&st.videoUrl&&(eo(`Media screen ${$e} should display as video, sending null imageUrl`),M("SetMediaScreenImage",{mediaScreenId:$e,imageUrl:null,displayAsVideo:!0})))}).catch(st=>{console.error(`Error fetching media screen data for ${$e}:`,st)})}catch(qe){console.error("Error handling MediaScreen registration:",qe)}},ke=Be=>{try{eo("MediaScreenClick event received:",Be);let qe;if(typeof Be=="string")qe=Be,eo("MediaScreenClick: Direct call with ID:",qe);else{eo("MediaScreenClick: Event from Unity:",Be),eo("MediaScreenClick: Event detail:",Be.detail);try{qe=JSON.parse(Be.detail).mediaScreenId,eo("MediaScreenClick: Parsed mediaScreenId:",qe)}catch($e){if(console.error("MediaScreenClick: Error parsing event detail:",$e),Be.detail&&Be.detail.mediaScreenId)qe=Be.detail.mediaScreenId,eo("MediaScreenClick: Using direct mediaScreenId from detail:",qe);else throw new Error("Could not extract mediaScreenId from event")}}H.log(`MediaScreen clicked: ${qe}`),eo("MediaScreen clicked:",qe),be(qe)}catch(qe){console.error("Error handling MediaScreen click:",qe)}},Ue=Be=>{if(Be.detail&&Be.detail.eventName==="RegisterMediaScreen")Te({detail:Be.detail.eventData});else if(Be.detail&&Be.detail.eventName==="MediaScreenClick")ke({detail:Be.detail.eventData});else if(Be.detail&&Be.detail.eventName==="SetMediaScreenImage")try{const qe=JSON.parse(Be.detail.eventData);qe.mediaScreenId&&(eo("SetMediaScreenImage event received:",qe),l($e=>Array.isArray($e)&&$e.some(Je=>Je.mediaScreenId===qe.mediaScreenId)?$e.map(Je=>Je.mediaScreenId===qe.mediaScreenId?{...Je,imageUrl:qe.imageUrl,hasImage:!!qe.imageUrl,displayAsVideo:qe.displayAsVideo||!1,lastUpdated:new Date().toISOString()}:Je):[...Array.isArray($e)?$e:[],{mediaScreenId:qe.mediaScreenId,imageUrl:qe.imageUrl,hasImage:!!qe.imageUrl,displayAsVideo:qe.displayAsVideo||!1,source:"set-media-screen-image",firstDetected:new Date().toISOString(),lastUpdated:new Date().toISOString()}]))}catch(qe){console.error("Error handling SetMediaScreenImage event:",qe)}};return window.addEventListener("RegisterMediaScreen",Te),window.addEventListener("MediaScreenClick",ke),window.addEventListener("reactUnityEvent",Ue),()=>{window.removeEventListener("RegisterMediaScreen",Te),window.removeEventListener("MediaScreenClick",ke),window.removeEventListener("reactUnityEvent",Ue)}},[e,E,M,o,re,Ve,pe,be,n]),k.useEffect(()=>{const Te=ke=>{try{eo("Direct MediaScreenClick event received:",ke);let Ue;if(ke.detail)try{Ue=JSON.parse(ke.detail).mediaScreenId}catch(Be){console.error("Error parsing MediaScreenClick event detail:",Be);return}if(!Ue){console.error("No mediaScreenId found in MediaScreenClick event");return}eo(`Direct handler: Processing click for media screen ${Ue}`),be(Ue)}catch(Ue){console.error("Error in direct MediaScreenClick handler:",Ue)}};return window.addEventListener("MediaScreenClick",Te),()=>{window.removeEventListener("MediaScreenClick",Te)}},[be]),k.useEffect(()=>{ie&&xe()},[ie,xe]);const Pe=()=>{ue(),Re()};return k.useEffect(()=>{const ke=B("RegisterMediaScreen",Ue=>{try{if(H.log("Direct RegisterMediaScreen event received with data:",Ue),!Ue||!Ue.mediaScreenId){H.warn("RegisterMediaScreen event received with invalid data");return}const Be=Ue.mediaScreenId;H.log(`Media screen registered directly: ${Be}`),l(qe=>qe.some(st=>st.mediaScreenId===Be)?qe.map(st=>st.mediaScreenId===Be?{...st,...Ue,source:"direct-event",lastUpdated:new Date().toISOString()}:st):[...qe,{...Ue,source:"direct-event",firstDetected:new Date().toISOString(),lastUpdated:new Date().toISOString()}]),e&&M("SetMediaScreenEditMode",{mediaScreenId:Be,enabled:!0,showUploadIcon:!0})}catch(Be){console.error("Error handling direct RegisterMediaScreen event:",Be)}});return()=>{ke()}},[B,e,M]),k.useEffect(()=>{const ke=B("MediaScreenClick",Ue=>{try{if(H.log("Direct MediaScreenClick event received with data:",Ue),!Ue||!Ue.mediaScreenId){H.warn("MediaScreenClick event received with invalid data");return}const Be=Ue.mediaScreenId;H.log(`Media screen clicked directly: ${Be}`),be(Be)}catch(Be){console.error("Error handling direct MediaScreenClick event:",Be)}});return()=>{ke()}},[B,be]),k.useEffect(()=>{e&&de&&(console.log(`[DEBUG] Detected currentVideoMediaScreenId change in edit mode: ${de}`),f(de),E(),ue())},[e,de,E,ue]),S.jsxs(S.Fragment,{children:[S.jsx(Q8e,{isOpen:_,onClose:b,mediaScreenId:u,onImageChange:We}),S.jsx(iGe,{}),S.jsx(ru,{containerRef:F,children:S.jsxs(hs,{isOpen:re,onClose:X,size:"lg",isCentered:!0,portalProps:{containerRef:F},id:"image-viewer-modal",blockScrollOnMount:!0,children:[S.jsx(fs,{bg:"rgba(0, 0, 0, 0.8)",onClick:Y,onMouseMove:Y,onMouseDown:Y,onMouseUp:Y,onWheel:Y}),S.jsxs(ps,{ref:J,bg:"gray.900",color:"white",borderRadius:"lg",overflow:"hidden",maxWidth:"80vw",maxHeight:"80vh",display:"flex",justifyContent:"center",alignItems:"center",position:"relative",zIndex:"10000",className:"image-viewer-modal-content",onClick:Y,onMouseMove:Y,onMouseDown:Y,onMouseUp:Y,onWheel:Y,children:[S.jsx($s,{size:"lg",bg:"gray.700",color:"white",borderRadius:"full",zIndex:"modal",_hover:{bg:"gray.600"},_focus:{boxShadow:"none"},position:"absolute",top:"10px",right:"10px"}),S.jsx(bs,{p:0,width:"100%",onClick:Y,onMouseMove:Y,onMouseDown:Y,onMouseUp:Y,onWheel:Y,children:ae?S.jsx(ct,{position:"relative",width:"100%",height:"100%",display:"flex",justifyContent:"center",alignItems:"center",onClick:Y,onMouseMove:Y,onMouseDown:Y,onMouseUp:Y,onWheel:Y,children:ne==="image"?S.jsx(cp,{src:ae,maxWidth:"100%",maxHeight:"80vh",objectFit:"contain",alt:"Media Screen Image",onLoad:()=>console.log("Image loaded successfully:",ae),onError:Te=>console.error("Error loading image:",Te,ae),onClick:Y}):S.jsxs(ct,{width:"100%",textAlign:"center",onClick:Y,onMouseMove:Y,onMouseDown:Y,onMouseUp:Y,onWheel:Y,children:[S.jsx(tt,{mb:4,fontSize:"lg",children:"Video URL:"}),S.jsx(tt,{p:3,bg:"gray.800",borderRadius:"md",fontSize:"sm",wordBreak:"break-all",maxWidth:"100%",children:ae}),S.jsx(tt,{mt:4,fontSize:"sm",color:"gray.400",children:"Video playback will be implemented in a future update"})]})}):S.jsx(Cr,{direction:"column",align:"center",justify:"center",h:"400px",onClick:Y,onMouseMove:Y,onMouseDown:Y,onMouseUp:Y,onWheel:Y,children:S.jsx(tt,{children:"No image available"})})})]})]})}),S.jsx(nGe,{videoUrl:ie,videoTitle:le,mediaScreenId:de,isOpen:Ve,onClose:Pe})]})},Iae=({backgroundUrl:n=null,videoBackgroundUrl:e=null,containerRef:i})=>{const[o,l]=k.useState(!1),[u,f]=k.useState(n),[_,E]=k.useState(e),b=k.useRef(null),C=k.useRef(null),I=k.useRef(null),P=k.useRef(!1),L=k.useRef(!1);k.useEffect(()=>{if(!(P.current||L.current)){if(L.current=!0,console.log(` PersistentBackground: Initializing with props - videoUrl: ${e}, imageUrl: ${n}`),e){console.log(` PersistentBackground: Using provided video URL: ${e}`),F(e),P.current=!0;return}if(n){console.log(` PersistentBackground: No video available, using image: ${n}`),B(n),P.current=!0;return}M()}},[n,e]),k.useEffect(()=>{const re=ae=>{const{videoBackgroundUrl:ne}=ae.detail;console.log(` PersistentBackground: Received video background update event: ${ne}`),ne&&!P.current&&(F(ne),P.current=!0)};return window.addEventListener("SpaceVideoBackgroundUpdated",re),()=>{window.removeEventListener("SpaceVideoBackgroundUpdated",re)}},[]);const M=()=>{const ae=window.location.pathname.match(/\/space\/([^\/]+)/);if(!ae||!ae[1]){console.warn(" PersistentBackground: Couldn't extract space ID from URL");return}const ne=ae[1];console.log(` PersistentBackground: Found space ID: ${ne}`),Xu(ne).then(pe=>{if(console.log(` PersistentBackground: Retrieved space data for ${ne}:`,pe?"success":"null"),pe&&pe.videoBackgroundUrl)console.log(` PersistentBackground: VIDEO FOUND: ${pe.videoBackgroundUrl}`),F(pe.videoBackgroundUrl),P.current=!0;else if(pe&&(pe.backgroundUrl||pe.backgroundGsUrl)){const X=pe.backgroundUrl||pe.backgroundGsUrl;console.log(` PersistentBackground: No video available, using image backdrop: ${X}`),B(X),P.current=!0}}).catch(pe=>{console.error(" PersistentBackground: Error fetching space data:",pe)})},F=re=>{if(!i||!i.current)return;console.log(` PersistentBackground: Setting up video background: ${re}`),K();const ae=document.createElement("video");I.current=ae,ae.autoplay=!0,ae.loop=!0,ae.muted=!0,ae.playsInline=!0,ae.setAttribute("playsinline",""),ae.setAttribute("webkit-playsinline",""),ae.setAttribute("preload","auto"),ae.src=re,Object.assign(ae.style,{position:"absolute",top:"0",left:"0",width:"100%",height:"100%",objectFit:"cover",zIndex:"20",transition:"opacity 1.5s ease-in-out",pointerEvents:"none"}),i.current.appendChild(ae),Z(),ae.load();try{ae.play().then(()=>console.log(" VIDEO PLAYING SUCCESSFULLY")).catch(ne=>{console.warn(" First video play attempt failed:",ne);const pe=()=>{ae.play().then(()=>console.log(" Video started after user interaction")).catch(X=>console.error(" Video still failed to play:",X))};window.addEventListener("click",pe,{once:!0}),window.addEventListener("touchstart",pe,{once:!0}),setTimeout(()=>{ae.play().then(()=>console.log(" Video started after timeout")).catch(X=>console.error(" Video still failed to play after timeout:",X))},1e3)})}catch(ne){console.error(" Error attempting to play video:",ne)}},B=re=>{if(!i||!i.current||!re)return;console.log(` PersistentBackground: Setting up image background: ${re}`);const ae=document.createElement("div");b.current=ae,Object.assign(ae.style,{position:"absolute",top:"0",left:"0",width:"100%",height:"100%",backgroundImage:`url('${re}')`,backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat",zIndex:"19",transition:"opacity 1.5s ease-in-out",pointerEvents:"none"}),i.current.appendChild(ae),Z()},Z=()=>{if(!i||!i.current)return;const re=document.createElement("div");C.current=re,Object.assign(re.style,{position:"absolute",top:"0",left:"0",width:"100%",height:"100%",backdropFilter:"blur(5px)",WebkitBackdropFilter:"blur(5px)",backgroundColor:"rgba(255, 255, 255, 0.08)",zIndex:"21",transition:"opacity 1.5s ease-in-out",pointerEvents:"none"}),i.current.appendChild(re)},K=()=>{!i||!i.current||(b.current&&i.current.contains(b.current)&&(i.current.removeChild(b.current),b.current=null),I.current&&i.current.contains(I.current)&&(I.current.pause(),I.current.src="",I.current.load(),i.current.removeChild(I.current),I.current=null),C.current&&i.current.contains(C.current)&&(i.current.removeChild(C.current),C.current=null))};return k.useEffect(()=>{if(!i||!i.current)return;const re=()=>{console.log(" PersistentBackground: Player instantiated, removing background"),l(!0),b.current&&(b.current.style.opacity="0"),I.current&&(I.current.style.opacity="0"),C.current&&(C.current.style.opacity="0"),setTimeout(()=>{K()},1500)};if(window.isPlayerInstantiated){console.log(" PersistentBackground: Player was already instantiated"),re();return}Yd.subscribe(qd.playerInstantiated,re),window.addEventListener("PlayerInstantiated",re);const ae=setTimeout(()=>{console.log(" PersistentBackground: Timeout reached, removing background"),re()},3e4);return()=>{Yd.unsubscribe(qd.playerInstantiated,re),window.removeEventListener("PlayerInstantiated",re),clearTimeout(ae),K()}},[i]),null};Iae.propTypes={backgroundUrl:yn.string,videoBackgroundUrl:yn.string,containerRef:yn.shape({current:yn.instanceOf(Element)})};const ZQ="https://www.spacesmetaverse.com/assets/images/SpacesLogo_Loader.png",Aae=({containerRef:n})=>{const{spaceID:e}=ea(),[i,o]=k.useState(!1),[l,u]=k.useState(!1),[f,_]=k.useState(0),[E,b]=k.useState("Initialising World"),[C,I]=k.useState(null),P=k.useRef(null),L=k.useRef(null),M=k.useRef(null),F=k.useRef(null),B=k.useRef(null),Z=k.useRef(null);k.useEffect(()=>(H.log("PersistentLoader: Component mounted with spaceID:",e),H.log("PersistentLoader: Container ref:",n),()=>{H.log("PersistentLoader: Component unmounting")}),[]);const{error:K}=ea(),[re,ae]=k.useState(!1);return k.useEffect(()=>{K&&(H.error("PersistentLoader: Unity error detected:",K),ae(!0),setTimeout(()=>{if(P.current){const ne=P.current.querySelector("div:first-child");ne&&(ne.textContent="Reconnecting...")}},3e3))},[K]),k.useEffect(()=>{(async()=>{if(e){H.log(`PersistentLoader: Fetching logo for space ${e}`);try{const pe=await Xu(e);pe&&pe.logoUrl?(H.log(`PersistentLoader: Found logo URL: ${pe.logoUrl}`),I(pe.logoUrl)):H.log(`PersistentLoader: No logo URL found for space ${e}`)}catch(pe){H.error("PersistentLoader: Error fetching space logo:",pe)}}else H.warn("PersistentLoader: No spaceID provided, cannot fetch logo")})()},[e]),k.useEffect(()=>{const ne=pe=>{const{logoUrl:X}=pe.detail;H.log(`PersistentLoader: Logo update event received with URL: ${X}`),I(X),L.current?X?(H.log("PersistentLoader: Updating logo element with new URL"),L.current.src=X,M.current.style.display="flex"):(H.log("PersistentLoader: Hiding logo element (no URL)"),M.current.style.display="none"):H.warn("PersistentLoader: Logo ref is null during update")};return H.log("PersistentLoader: Adding SpaceLogoUpdated event listener"),window.addEventListener("SpaceLogoUpdated",ne),()=>{H.log("PersistentLoader: Removing SpaceLogoUpdated event listener"),window.removeEventListener("SpaceLogoUpdated",ne)}},[]),k.useEffect(()=>{if(!n||!n.current){H.error("PersistentLoader: Container ref is null or has no current property");return}H.log("PersistentLoader: Creating loader elements");const ne=document.createElement("div");if(P.current=ne,Object.assign(ne.style,{position:"absolute",top:"60%",left:"50%",transform:"translate(-50%, -50%)",width:"300px",padding:"16px",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",zIndex:"50",transition:"opacity 0.8s ease-in-out",pointerEvents:"none",color:"white",fontFamily:"Arial, sans-serif",backgroundColor:"rgba(0, 0, 0, 0.4)",backdropFilter:"blur(10px)",WebkitBackdropFilter:"blur(10px)",borderRadius:"12px",boxShadow:"0 0 20px rgba(0, 0, 0, 0.3), inset 0 0 1px rgba(255, 255, 255, 0.3)",border:"1px solid rgba(255, 255, 255, 0.1)",opacity:"0"}),C){H.log(`PersistentLoader: Creating logo element with URL: ${C}`);const Re=document.createElement("div");M.current=Re,Object.assign(Re.style,{position:"absolute",top:"37.5%",left:"50%",transform:"translate(-50%, -50%)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:"50",transition:"opacity 0.8s ease-in-out",pointerEvents:"none",padding:"8px",width:"280px",opacity:"0"});const ve=document.createElement("img");L.current=ve,ve.src=C,ve.alt="Space Logo",ve.style.maxHeight="100px",ve.style.maxWidth="100%",ve.style.objectFit="contain",ve.style.filter="drop-shadow(0 0 8px rgba(0, 0, 0, 0.7))",Re.appendChild(ve),n.current.appendChild(Re),H.log("PersistentLoader: Logo container added to main container")}else H.log("PersistentLoader: No logo URL available, skipping logo creation");const pe=document.createElement("style");pe.textContent=`
      @keyframes progress-glow {
        0% { background-position: 0% 50%; }
        50% { background-position: 100% 50%; }
        100% { background-position: 0% 50%; }
      }
    `,document.head.appendChild(pe),H.log("PersistentLoader: Animation styles added to document head");const X=document.createElement("div");X.style.fontSize="16px",X.style.fontWeight="bold",X.style.textAlign="center",X.style.marginBottom="16px",X.style.color="#ffffff",X.textContent="Initialising World";const J=document.createElement("div");J.style.width="240px",J.style.height="100px",J.style.position="relative",J.style.marginBottom="15px",J.style.padding="0px",J.style.overflow="hidden",J.style.boxSizing="border-box",J.style.transition="opacity 0.8s ease-in-out",J.style.opacity="0";const Y=document.createElement("div");Y.style.width="100%",Y.style.height="100%",Y.style.position="absolute",Y.style.top="0",Y.style.left="0",Y.style.maskImage=`url(${ZQ})`,Y.style.maskSize="contain",Y.style.maskPosition="center",Y.style.maskRepeat="no-repeat",Y.style.webkitMaskImage=`url(${ZQ})`,Y.style.webkitMaskSize="contain",Y.style.webkitMaskPosition="center",Y.style.webkitMaskRepeat="no-repeat",Y.style.background="linear-gradient(to right, #4facfe 0%, #00f2fe 15%, white 15%, white 100%)",Y.style.backgroundSize="100% 100%",Y.style.transition="background 0.5s ease-out",F.current=Y,B.current=null,J.appendChild(Y);const ie=document.createElement("div");ie.style.marginTop="8px",ie.style.fontSize="14px",ie.style.fontWeight="bold",ie.style.color="#ffffff",ie.textContent="0%",ne.appendChild(X),ne.appendChild(J),ne.appendChild(ie),n.current.appendChild(ne),H.log("PersistentLoader: Loader element added to container"),setTimeout(()=>{M.current&&(M.current.style.opacity="1"),ne.style.opacity="1",J.style.opacity="1"},500);const le=Re=>{_(Re);const ve=Math.round(Re*100),be=`linear-gradient(to right, #4facfe 0%, #00f2fe ${ve}%, white ${ve}%, white 100%)`;Y.style.background=be,ie.textContent=`${ve}%`,H.log(`PersistentLoader: Progress updated to ${ve}%`)},de=Re=>{b(Re),X.textContent=Re,H.log(`PersistentLoader: Loading stage updated to "${Re}"`)},ue=[{stage:"Initialising World",progress:.33},{stage:"Loading Assets",progress:.66},{stage:"Loading User",progress:1}];re&&(ue[0].stage="Connecting to Space",ue[1].stage="Reconnecting...",ue[2].stage="Please Wait"),de(ue[0].stage),le(.25);const Oe=Re=>{const ve=Re.detail.progress;H.log(`PersistentLoader: Progress event received with value: ${ve}`),le(ve),ve<.33?de(ue[0].stage):ve<.66?de(ue[1].stage):de(ue[2].stage)},Ve=()=>{H.log("PersistentLoader: First scene loaded event received"),o(!0),de(ue[1].stage),le(.66)},xe=()=>{if(H.log("PersistentLoader: Player instantiated event received"),Z.current&&(clearInterval(Z.current),H.log("PersistentLoader: Progress interval cleared")),u(!0),de(ue[2].stage),le(1),re){H.log("PersistentLoader: Keeping loader visible due to Unity error");return}ne.style.transition="all 0.5s ease-in-out",J.style.transition="opacity 1.2s ease-in-out",X.style.transition="opacity 0.4s ease-in-out",ie.style.transition="opacity 0.4s ease-in-out",M.current&&(M.current.style.transition="opacity 0.5s ease-in-out"),ne.style.backgroundColor="rgba(0, 0, 0, 0)",ne.style.backdropFilter="blur(0px)",ne.style.WebkitBackdropFilter="blur(0px)",ne.style.boxShadow="0 0 0 rgba(0, 0, 0, 0)",ne.style.border="1px solid rgba(255, 255, 255, 0)",X.style.opacity="0",ie.style.opacity="0",M.current&&(M.current.style.opacity="0"),setTimeout(()=>{J.style.opacity="0",setTimeout(()=>{n.current&&n.current.contains(ne)?(n.current.removeChild(ne),H.log("PersistentLoader: Loader element removed after fade")):H.warn("PersistentLoader: Could not remove loader element (not found in container)"),M.current&&n.current&&n.current.contains(M.current)?(n.current.removeChild(M.current),H.log("PersistentLoader: Logo container removed after fade")):M.current&&H.warn("PersistentLoader: Could not remove logo container (not found in container)")},1300)},400)};if(window.isPlayerInstantiated)H.log("PersistentLoader: Player was already instantiated"),xe();else{H.log("PersistentLoader: Subscribing to playerInstantiated event"),Yd.subscribe(qd.playerInstantiated,xe);const Re=()=>xe();H.log("PersistentLoader: Adding PlayerInstantiated event listener"),window.addEventListener("PlayerInstantiated",Re),H.log("PersistentLoader: Adding firstSceneLoaded event listener"),Yd.subscribe(qd.firstSceneLoaded,Ve),H.log("PersistentLoader: Adding UnityProgress event listener"),window.addEventListener("UnityProgress",Oe),Z.current=setInterval(()=>{l||_(be=>{const We=Math.min(be+.02,.95);return le(We),We<.33&&E!==ue[0].stage?de(ue[0].stage):We>=.33&&We<.66&&E!==ue[1].stage?de(ue[1].stage):We>=.66&&E!==ue[2].stage&&de(ue[2].stage),We})},300);const ve=setTimeout(()=>{H.log("PersistentLoader: Forcing loader removal after timeout"),xe()},6e4);return()=>{H.log("PersistentLoader: Cleaning up event listeners"),Yd.unsubscribe(qd.playerInstantiated,xe),window.removeEventListener("PlayerInstantiated",Re),Yd.unsubscribe(qd.firstSceneLoaded,Ve),window.removeEventListener("UnityProgress",Oe),clearInterval(Z.current),clearTimeout(ve),n.current&&n.current.contains(ne)&&(n.current.removeChild(ne),H.log("PersistentLoader: Loader element removed during cleanup")),M.current&&n.current&&n.current.contains(M.current)&&(n.current.removeChild(M.current),H.log("PersistentLoader: Logo container removed during cleanup"))}}},[C,n]),null};Aae.propTypes={containerRef:yn.shape({current:yn.instanceOf(Element)})};const oGe=({size:n="md",tooltipPlacement:e="top",className:i="livestream-button"})=>{const[o,l]=k.useState(!1),[u,f]=k.useState(!1),{savedStreamData:_,reloadStreamData:E}=oae(),{spaceID:b}=ea(),{user:C}=k.useContext(Uo),I=ta(),[P,L]=k.useState(!1),M=KK((_==null?void 0:_.rtmpUrl)||""),F=KK((_==null?void 0:_.streamKey)||"");k.useEffect(()=>{if(b){H.log("LiveStreamButton: Forcing reload of stream data"),E();const K=()=>{H.log("LiveStreamButton: Stream settings changed, reloading data"),E()};return window.addEventListener("StreamSettingsChanged",K),()=>{window.removeEventListener("StreamSettingsChanged",K)}}},[b,E]),k.useEffect(()=>{(async()=>{if(!(C!=null&&C.uid)||!b){L(!1);return}try{const re=await JBe(C.uid,"disruptiveAdmin"),ae=await n6e(C,b);L(re||ae)}catch(re){H.error("Error checking user permissions:",re),L(!1)}})()},[C==null?void 0:C.uid,b]),k.useEffect(()=>{H.log("LiveStreamButton: Current streaming data:",{enabled:_==null?void 0:_.enabled,hasRtmpUrl:!!(_!=null&&_.rtmpUrl),hasStreamKey:!!(_!=null&&_.streamKey),hasPermission:P,isPlayerReady:u})},[_,P,u]),k.useEffect(()=>{const K=()=>{H.log("LiveStreamButton: Player instantiated, showing button"),f(!0)};return window.addEventListener("PlayerInstantiated",K),window.isPlayerInstantiated&&(H.log("LiveStreamButton: Player was already instantiated"),f(!0)),()=>{window.removeEventListener("PlayerInstantiated",K)}},[]);const B=()=>{window.dispatchEvent(new Event("modal-opened")),l(!0)},Z=()=>{window.dispatchEvent(new Event("modal-closed")),l(!1)};return!u||!P||(_==null?void 0:_.enabled)!==!0?(H.log("LiveStreamButton: Not rendering button because:",{playerNotReady:!u,noPermission:!P,streamingDisabled:(_==null?void 0:_.enabled)!==!0,enabledValue:_==null?void 0:_.enabled}),null):S.jsxs(S.Fragment,{children:[S.jsx(Kf,{label:"Live Stream Info",placement:e,hasArrow:!0,children:S.jsx(eu,{size:n,borderRadius:"full",bg:"black",icon:S.jsx(d8e,{color:"white"}),borderWidth:"1px",borderColor:"whiteAlpha.300",className:i,"data-testid":"livestream-button",cursor:"pointer",onClick:B})}),S.jsxs(hs,{isOpen:o,onClose:Z,isCentered:!0,size:"md",children:[S.jsx(fs,{backdropFilter:"blur(4px)"}),S.jsxs(ps,{bg:"rgba(23, 25, 35, 0.95)",color:"white",borderRadius:"md",boxShadow:"0 4px 20px rgba(0, 0, 0, 0.5)",children:[S.jsx(yo,{borderBottom:"1px solid",borderColor:"whiteAlpha.200",py:2,fontSize:"md",fontWeight:"600",children:"Live Stream Info"}),S.jsx($s,{size:"sm",color:"whiteAlpha.700",_hover:{color:"white",bg:"whiteAlpha.100"}}),S.jsx(bs,{p:4,children:_!=null&&_.rtmpUrl&&(_!=null&&_.streamKey)?S.jsxs(ct,{children:[S.jsx(tt,{fontSize:"sm",mb:4,color:"white",children:"Copy these details to your streaming software (OBS, Streamlabs, etc.)"}),S.jsxs(ct,{mb:4,children:[S.jsx(tt,{fontSize:"xs",fontWeight:"600",mb:1,color:"white",children:"RTMP URL"}),S.jsx(Cr,{children:S.jsxs(Dg,{size:"sm",children:[S.jsx(ti,{value:_.rtmpUrl,isReadOnly:!0,bg:"whiteAlpha.100",borderColor:"whiteAlpha.200",_hover:{borderColor:"whiteAlpha.300"},pr:"2.5rem",color:"white"}),S.jsx(Zk,{children:S.jsx(Do,{"aria-label":"Copy RTMP URL",icon:M.hasCopied?S.jsx(GQ,{}):S.jsx(HQ,{}),size:"xs",colorScheme:M.hasCopied?"green":"blue",onClick:()=>{M.onCopy(),I({title:"RTMP URL copied",status:"success",duration:2e3,isClosable:!0,position:"top"})}})})]})})]}),S.jsxs(ct,{mb:4,children:[S.jsx(tt,{fontSize:"xs",fontWeight:"600",mb:1,color:"white",children:"Stream Key"}),S.jsx(Cr,{children:S.jsxs(Dg,{size:"sm",children:[S.jsx(ti,{value:_.streamKey,isReadOnly:!0,bg:"whiteAlpha.100",borderColor:"whiteAlpha.200",_hover:{borderColor:"whiteAlpha.300"},pr:"2.5rem",type:"password",color:"white"}),S.jsx(Zk,{children:S.jsx(Do,{"aria-label":"Copy Stream Key",icon:F.hasCopied?S.jsx(GQ,{}):S.jsx(HQ,{}),size:"xs",colorScheme:F.hasCopied?"green":"blue",onClick:()=>{F.onCopy(),I({title:"Stream Key copied",status:"success",duration:2e3,isClosable:!0,position:"top"})}})})]})})]}),S.jsx(tt,{fontSize:"xs",color:"whiteAlpha.800",mt:4,children:"Stream to this RTMP server using the Stream Key above. View and manage stream settings in the Space Manager."})]}):S.jsxs(ct,{textAlign:"center",p:4,children:[S.jsx(tt,{color:"white",children:"No stream configuration found for this space."}),S.jsx(tt,{fontSize:"xs",mt:2,color:"whiteAlpha.800",children:"Configure streaming in the Space Manager under Stream tab."})]})})]})]})]})},Pae=({settings:n})=>{const{placePrefab:e,directPlacePrefab:i,isUnityLoaded:o}=lae(),l=ta(),[u,f]=k.useState({x:0,y:1,z:0}),[_,E]=k.useState({x:0,y:0,z:0}),[b,C]=k.useState({x:1,y:1,z:1}),[I,P]=k.useState("TestPrefab"),[L,M]=k.useState(!1),[F,B]=k.useState(!1),[Z,K]=k.useState(!1),{user:re}=k.useContext(Uo),ae=n==null?void 0:n.spaceID,{saveObject:ne,isLoading:pe}=Bze(ae);k.useEffect(()=>{(async()=>{if(re!=null&&re.uid)try{const le=await MN(re.uid,"disruptiveAdmin");K(le)}catch(le){console.error("Error checking admin status:",le),K(!1)}})()},[re==null?void 0:re.uid]),k.useEffect(()=>{const ie=le=>{B(le.detail.enabled)};return window.addEventListener("editModeChanged",ie),()=>{window.removeEventListener("editModeChanged",ie)}},[]);const X=(ie,le)=>{f(de=>({...de,[ie]:parseFloat(le)}))},J=async()=>{H.log("Placing prefab with values:",{prefabName:I,position:u,rotation:_,scale:b,useDirect:L,spaceId:ae});let ie;if(L?(ie=i(I,u,_,b),H.log("Used direct method to place prefab")):(ie=e(I,u,_,b),H.log("Used hook method to place prefab")),ie)if(ae&&F){const le=await ne(I,u,_,b);l(le?{title:"Success",description:"Prefab placed and saved to space",status:"success",duration:3e3,isClosable:!0}:{title:"Warning",description:"Prefab placed but failed to save to space",status:"warning",duration:3e3,isClosable:!0})}else l({title:"Success",description:"Prefab placed",status:"success",duration:3e3,isClosable:!0});else l({title:"Error",description:"Failed to place prefab",status:"error",duration:3e3,isClosable:!0})},Y=()=>{const ie={x:(Math.random()*10-5).toFixed(2),y:(Math.random()*2).toFixed(2),z:(Math.random()*10-5).toFixed(2)};f({x:parseFloat(ie.x),y:parseFloat(ie.y),z:parseFloat(ie.z)}),H.log("Set random position:",ie)};return!F||!Z?null:S.jsxs(ct,{className:"prefab-placer",bg:"rgba(0, 0, 0, 0.7)",color:"white",p:4,borderRadius:"md",maxW:"300px",boxShadow:"0 4px 6px rgba(0, 0, 0, 0.1)",children:[S.jsx(tt,{fontWeight:"bold",mb:2,children:"Place Prefab in Unity"}),S.jsxs(ct,{mb:3,children:[S.jsx(tt,{fontSize:"sm",children:"Prefab Name:"}),S.jsx("input",{type:"text",value:I,onChange:ie=>P(ie.target.value),style:{width:"100%",padding:"8px",marginTop:"4px",background:"rgba(255, 255, 255, 0.1)",border:"1px solid rgba(255, 255, 255, 0.3)",borderRadius:"4px",color:"white"}})]}),S.jsxs(Cr,{direction:"column",gap:2,mb:3,children:[S.jsx(tt,{fontSize:"sm",children:"Position:"}),S.jsxs(Cr,{gap:2,children:[S.jsxs(ct,{children:[S.jsx(tt,{fontSize:"xs",children:"X"}),S.jsxs(Bs,{value:u.x,onChange:ie=>X("x",ie),step:.5,precision:2,size:"sm",children:[S.jsx(zs,{bg:"rgba(255, 255, 255, 0.1)",borderColor:"rgba(255, 255, 255, 0.3)"}),S.jsxs(Ws,{children:[S.jsx(Hs,{}),S.jsx(Gs,{})]})]})]}),S.jsxs(ct,{children:[S.jsx(tt,{fontSize:"xs",children:"Y"}),S.jsxs(Bs,{value:u.y,onChange:ie=>X("y",ie),step:.5,precision:2,size:"sm",children:[S.jsx(zs,{bg:"rgba(255, 255, 255, 0.1)",borderColor:"rgba(255, 255, 255, 0.3)"}),S.jsxs(Ws,{children:[S.jsx(Hs,{}),S.jsx(Gs,{})]})]})]}),S.jsxs(ct,{children:[S.jsx(tt,{fontSize:"xs",children:"Z"}),S.jsxs(Bs,{value:u.z,onChange:ie=>X("z",ie),step:.5,precision:2,size:"sm",children:[S.jsx(zs,{bg:"rgba(255, 255, 255, 0.1)",borderColor:"rgba(255, 255, 255, 0.3)"}),S.jsxs(Ws,{children:[S.jsx(Hs,{}),S.jsx(Gs,{})]})]})]})]}),S.jsx(jn,{onClick:Y,size:"xs",colorScheme:"blue",variant:"outline",mt:1,children:"Random Position"})]}),S.jsxs(ur,{display:"flex",alignItems:"center",mb:3,children:[S.jsx(ei,{htmlFor:"use-direct",mb:"0",fontSize:"sm",children:"Use Direct Method"}),S.jsx(yp,{id:"use-direct",colorScheme:"green",isChecked:L,onChange:ie=>M(ie.target.checked)})]}),S.jsx(jn,{onClick:J,colorScheme:"green",width:"100%",isDisabled:!o||pe,children:pe?"Loading...":"Place Prefab"}),!o&&S.jsx(tt,{fontSize:"xs",color:"red.300",mt:1,children:"Waiting for Unity to load..."}),!ae&&S.jsx(tt,{fontSize:"xs",color:"yellow.300",mt:1,children:"No space ID available - prefabs won't be saved"})]})};Pae.propTypes={settings:yn.shape({spaceID:yn.string})};function aGe(n,e,i){const o=k.useRef();k.useEffect(()=>(o.current&&clearTimeout(o.current),o.current=setTimeout(n,e),()=>clearTimeout(o.current)),i)}const cGe=({isOpen:n,onClose:e,portal:i,spaceId:o,style:l})=>{if(!n||!i)return null;const[u,f]=k.useState({x:0,y:1.5,z:0}),[_,E]=k.useState({x:0,y:0,z:0}),[b,C]=k.useState({x:1,y:1,z:1}),I=uc(),P=ta();k.useEffect(()=>{i&&(f(i.position||{x:0,y:1.5,z:0}),E(i.rotation||{x:0,y:0,z:0}),C(i.scale||{x:1,y:1,z:1}))},[i]),k.useEffect(()=>{I("UpdatePortalTransform",{portalId:i.portalId,position:u,rotation:_,scale:b})},[u,_,b,i.portalId,I]),aGe(()=>{const M={...i,position:u,rotation:_,scale:b};XQ(o,i.portalId,M)},300,[u,_,b,o,i.portalId]);const L=async()=>{try{if(I("DeletePortal",{portalId:i.portalId}),await XQ(o,i.portalId,null))P({title:"Portal Deleted",description:"The portal has been removed.",status:"success",duration:3e3,isClosable:!0}),e();else throw new Error("Failed to delete portal from Firebase")}catch{P({title:"Delete Error",description:"Failed to delete portal. Please try again.",status:"error",duration:5e3,isClosable:!0})}};return S.jsxs(ct,{position:"absolute",top:"72px",right:"24px",zIndex:2e3,minW:"340px",maxW:"360px",bg:"rgba(255,255,255,0.15)",boxShadow:"0 8px 32px 0 rgba(31, 38, 135, 0.18)",borderRadius:"2xl",p:6,border:"1px solid rgba(255,255,255,0.2)",style:{backdropFilter:"blur(18px)",WebkitBackdropFilter:"blur(18px)",...l},color:"gray.900",children:[S.jsx(ct,{fontWeight:"bold",fontSize:"lg",mb:2,children:"Edit Portal"}),S.jsxs(Fr,{spacing:4,align:"stretch",children:[S.jsxs(ur,{children:[S.jsx(ei,{children:"Position"}),S.jsxs(Er,{children:[S.jsxs(Bs,{value:u.x,onChange:(M,F)=>f(B=>({...B,x:F})),step:.1,precision:2,children:[S.jsx(zs,{placeholder:"X"}),S.jsxs(Ws,{children:[S.jsx(Hs,{}),S.jsx(Gs,{})]})]}),S.jsxs(Bs,{value:u.y,onChange:(M,F)=>f(B=>({...B,y:F})),step:.1,precision:2,children:[S.jsx(zs,{placeholder:"Y"}),S.jsxs(Ws,{children:[S.jsx(Hs,{}),S.jsx(Gs,{})]})]}),S.jsxs(Bs,{value:u.z,onChange:(M,F)=>f(B=>({...B,z:F})),step:.1,precision:2,children:[S.jsx(zs,{placeholder:"Z"}),S.jsxs(Ws,{children:[S.jsx(Hs,{}),S.jsx(Gs,{})]})]})]})]}),S.jsxs(ur,{children:[S.jsx(ei,{children:"Rotation"}),S.jsxs(Er,{children:[S.jsxs(Bs,{value:_.x,onChange:(M,F)=>E(B=>({...B,x:F})),step:1,children:[S.jsx(zs,{placeholder:"X"}),S.jsxs(Ws,{children:[S.jsx(Hs,{}),S.jsx(Gs,{})]})]}),S.jsxs(Bs,{value:_.y,onChange:(M,F)=>E(B=>({...B,y:F})),step:1,children:[S.jsx(zs,{placeholder:"Y"}),S.jsxs(Ws,{children:[S.jsx(Hs,{}),S.jsx(Gs,{})]})]}),S.jsxs(Bs,{value:_.z,onChange:(M,F)=>E(B=>({...B,z:F})),step:1,children:[S.jsx(zs,{placeholder:"Z"}),S.jsxs(Ws,{children:[S.jsx(Hs,{}),S.jsx(Gs,{})]})]})]})]}),S.jsxs(ur,{children:[S.jsx(ei,{children:"Scale"}),S.jsxs(Er,{children:[S.jsxs(Bs,{value:b.x,onChange:(M,F)=>C(B=>({...B,x:F})),step:.1,precision:2,min:.1,children:[S.jsx(zs,{placeholder:"X"}),S.jsxs(Ws,{children:[S.jsx(Hs,{}),S.jsx(Gs,{})]})]}),S.jsxs(Bs,{value:b.y,onChange:(M,F)=>C(B=>({...B,y:F})),step:.1,precision:2,min:.1,children:[S.jsx(zs,{placeholder:"Y"}),S.jsxs(Ws,{children:[S.jsx(Hs,{}),S.jsx(Gs,{})]})]}),S.jsxs(Bs,{value:b.z,onChange:(M,F)=>C(B=>({...B,z:F})),step:.1,precision:2,min:.1,children:[S.jsx(zs,{placeholder:"Z"}),S.jsxs(Ws,{children:[S.jsx(Hs,{}),S.jsx(Gs,{})]})]})]})]}),S.jsx(Er,{spacing:4,width:"100%",justify:"flex-end",children:S.jsx(jn,{colorScheme:"red",onClick:L,variant:"outline",children:"Delete Portal"})}),S.jsx(jn,{mt:2,variant:"ghost",colorScheme:"whiteAlpha",onClick:e,children:"Close"})]})]})},lGe=n=>{if(!n)return null;try{if(n.includes("firebasestorage.googleapis.com")){const e=new URL(n),i=e.searchParams.get("alt"),o=e.searchParams.get("token");return e.search="",i&&e.searchParams.set("alt",i),o&&e.searchParams.set("token",o),console.log(`Cleaned Firebase URL from ${n} to ${e.toString()}`),e.toString()}return n}catch(e){return console.error("Error cleaning Firebase URL:",e),n}},uGe=()=>{const{spaceID:n}=ea(),e=uc(),[i,o]=k.useState(!1);k.useEffect(()=>{if(window.isPlayerInstantiated){H.log("useUnityPortalImages: Unity already ready (via window flag)"),o(!0);return}const l=()=>{H.log("useUnityPortalImages: Unity is now ready (PlayerInstantiated event)"),o(!0)};return window.addEventListener("PlayerInstantiated",l),()=>{window.removeEventListener("PlayerInstantiated",l)}},[]),k.useEffect(()=>{if(!i){H.log("useUnityPortalImages: Waiting for Unity to be ready before loading portal images");return}H.log("useUnityPortalImages: Unity is ready, now loading portal images"),(async()=>{try{if(!n)throw new Error("spaceID is not defined.");const u=Sl(Dn,"spaces",n,"portals"),f=await ed(u);if(f.empty){H.log("useUnityPortalImages: No portals found for space:",n);return}H.log(`useUnityPortalImages: Found ${f.size} portals for space ${n}`);for(const _ of f.docs){const E=_.data(),b=E.portalId,C=E.targetSpaceId;if(!C){H.warn(`useUnityPortalImages: No target space ID found for portal: ${b}`);continue}const I=await Xu(C);if(!I){H.warn(`useUnityPortalImages: No space data found for target space: ${C}`);continue}const P=I.backgroundUrl||I.backgroundGsUrl;if(!P){H.warn(`useUnityPortalImages: No background image URL found for target space: ${C}`);continue}const L=lGe(P);e("SetPortalImage",JSON.stringify({portalId:b,imageUrl:L})),H.log(`Sent portal image data to Unity for portal ${b}: ${L}`)}}catch(u){H.error("Error fetching portal images:",u)}})()},[e,n,i])},dGe=()=>(uGe(),null);function hGe(n,e,i){const o=k.useRef();k.useEffect(()=>(o.current&&clearTimeout(o.current),o.current=setTimeout(n,e),()=>clearTimeout(o.current)),i)}const pGe=({isOpen:n,onClose:e,item:i,spaceId:o,style:l})=>{if(!n||!i)return null;const[u,f]=k.useState({x:0,y:0,z:0}),[_,E]=k.useState({x:0,y:0,z:0}),[b,C]=k.useState({x:1,y:1,z:1}),I=uc(),P=ta();k.useEffect(()=>{i&&(f(i.position||{x:0,y:0,z:0}),E(i.rotation||{x:0,y:0,z:0}),C(i.scale||{x:1,y:1,z:1}))},[i]),k.useEffect(()=>{I("UpdateCatalogueItem",{hotspotId:i.hotspotId,position:u,rotation:_,scale:b})},[u,_,b,i.hotspotId,I]),hGe(()=>{const M=dr(Dn,"spaces",o,"catalogue",i.hotspotId);ms(M,{position:u,rotation:_,scale:b,updatedAt:Date.now()})},300,[u,_,b,o,i.hotspotId]);const L=async()=>{try{I("DeleteCatalogueItem",{hotspotId:i.hotspotId});const M=dr(Dn,"spaces",o,"catalogue",i.hotspotId);await ms(M,{deleted:!0}),P({title:"Item Deleted",description:"The item has been removed.",status:"success",duration:3e3,isClosable:!0}),e()}catch{P({title:"Delete Error",description:"Failed to delete item. Please try again.",status:"error",duration:5e3,isClosable:!0})}};return S.jsxs(ct,{position:"absolute",top:"72px",right:"24px",zIndex:2e3,minW:"340px",maxW:"360px",bg:"rgba(255,255,255,0.15)",boxShadow:"0 8px 32px 0 rgba(31, 38, 135, 0.18)",borderRadius:"2xl",p:6,border:"1px solid rgba(255,255,255,0.2)",style:{backdropFilter:"blur(18px)",WebkitBackdropFilter:"blur(18px)",...l},color:"gray.900",children:[S.jsx(ct,{fontWeight:"bold",fontSize:"lg",mb:2,children:"Edit Catalogue Item"}),S.jsxs(Fr,{spacing:4,align:"stretch",children:[S.jsxs(ur,{children:[S.jsx(ei,{children:"Position"}),S.jsxs(Er,{children:[S.jsxs(Bs,{value:u.x,onChange:(M,F)=>f(B=>({...B,x:F})),step:.1,precision:2,children:[S.jsx(zs,{placeholder:"X"}),S.jsxs(Ws,{children:[S.jsx(Hs,{}),S.jsx(Gs,{})]})]}),S.jsxs(Bs,{value:u.y,onChange:(M,F)=>f(B=>({...B,y:F})),step:.1,precision:2,children:[S.jsx(zs,{placeholder:"Y"}),S.jsxs(Ws,{children:[S.jsx(Hs,{}),S.jsx(Gs,{})]})]}),S.jsxs(Bs,{value:u.z,onChange:(M,F)=>f(B=>({...B,z:F})),step:.1,precision:2,children:[S.jsx(zs,{placeholder:"Z"}),S.jsxs(Ws,{children:[S.jsx(Hs,{}),S.jsx(Gs,{})]})]})]})]}),S.jsxs(ur,{children:[S.jsx(ei,{children:"Rotation"}),S.jsxs(Er,{children:[S.jsxs(Bs,{value:_.x,onChange:(M,F)=>E(B=>({...B,x:F})),step:1,children:[S.jsx(zs,{placeholder:"X"}),S.jsxs(Ws,{children:[S.jsx(Hs,{}),S.jsx(Gs,{})]})]}),S.jsxs(Bs,{value:_.y,onChange:(M,F)=>E(B=>({...B,y:F})),step:1,children:[S.jsx(zs,{placeholder:"Y"}),S.jsxs(Ws,{children:[S.jsx(Hs,{}),S.jsx(Gs,{})]})]}),S.jsxs(Bs,{value:_.z,onChange:(M,F)=>E(B=>({...B,z:F})),step:1,children:[S.jsx(zs,{placeholder:"Z"}),S.jsxs(Ws,{children:[S.jsx(Hs,{}),S.jsx(Gs,{})]})]})]})]}),S.jsxs(ur,{children:[S.jsx(ei,{children:"Scale"}),S.jsxs(Er,{children:[S.jsxs(Bs,{value:b.x,onChange:(M,F)=>C(B=>({...B,x:F})),step:.1,precision:2,min:.1,children:[S.jsx(zs,{placeholder:"X"}),S.jsxs(Ws,{children:[S.jsx(Hs,{}),S.jsx(Gs,{})]})]}),S.jsxs(Bs,{value:b.y,onChange:(M,F)=>C(B=>({...B,y:F})),step:.1,precision:2,min:.1,children:[S.jsx(zs,{placeholder:"Y"}),S.jsxs(Ws,{children:[S.jsx(Hs,{}),S.jsx(Gs,{})]})]}),S.jsxs(Bs,{value:b.z,onChange:(M,F)=>C(B=>({...B,z:F})),step:.1,precision:2,min:.1,children:[S.jsx(zs,{placeholder:"Z"}),S.jsxs(Ws,{children:[S.jsx(Hs,{}),S.jsx(Gs,{})]})]})]})]}),S.jsx(Er,{spacing:4,width:"100%",justify:"flex-end",children:S.jsx(jn,{colorScheme:"red",onClick:L,variant:"outline",children:"Delete Item"})}),S.jsx(jn,{mt:2,variant:"ghost",colorScheme:"whiteAlpha",onClick:e,children:"Close"})]})]})};function fGe(){const{clickedItem:n,clearClickedItem:e}=hae(),[i,o]=k.useState(!1);k.useEffect(()=>{const f=_=>{_!=null&&_.detail&&typeof _.detail.enabled=="boolean"&&(o(_.detail.enabled),_.detail.enabled||e())};return window.addEventListener("editModeChanged",f),()=>window.removeEventListener("editModeChanged",f)},[e]);const l=()=>{e()};let u="";if(n!=null&&n.hotspotId){const f=n.hotspotId.split("_");f.length>=3&&(u=f.slice(1,-1).join("_"))}return S.jsx(S.Fragment,{children:n&&i&&S.jsx(pGe,{isOpen:!!n&&i,onClose:l,item:n,spaceId:u})})}const mGe="a2a7f4eb05284449b1063eb71d8301dc",qU=()=>document.querySelector("canvas")||document.getElementById("unity-canvas"),D3=k.forwardRef(({settings:n},e)=>{const{unityProvider:i,isLoaded:o,error:l}=ea(),u=Cze();Ize();const f=uc(),_=Kze(u),{user:E}=k.useContext(Uo),[b,C]=k.useState(!1),[I,P]=k.useState(window.devicePixelRatio),[L,M]=Rze();cae().find(kt=>kt.isLocalPlayer);const[B,Z]=k.useState(!0),[K,re]=k.useState(!0),ae=n.spaceID||"default";Hze(),zze(ae);const[ne,pe]=k.useState(!1),[X,J]=k.useState(!1),[Y,ie]=k.useState(!1),le=k.useMemo(()=>{const ut=new URLSearchParams(window.location.search).get("sessionId")||ae;return console.log("WebGLRenderer: Using session ID:",ut),ut},[ae]),[de,ue]=k.useState(null);k.useEffect(()=>{E!=null&&E.uid&&td(E.uid).then(kt=>{ue(kt),console.log("WebGLRenderer: User profile loaded:",(kt==null?void 0:kt.Nickname)||"Unknown")}).catch(kt=>{console.error("Error fetching user profile:",kt)})},[E==null?void 0:E.uid]),k.useEffect(()=>{if(l||!E){console.log("WebGLRenderer: User not logged in or Unity error, showing sign-in modal");const kt=setTimeout(()=>{J(!0),ie(!0)},1e3);return()=>clearTimeout(kt)}else J(!1)},[l,E]),k.useEffect(()=>{console.log("WebGLRenderer: Setting up player instantiation listener");const kt=()=>{console.log("WebGLRenderer: Player instantiated event received"),re(!0),window.dispatchEvent(new CustomEvent("PlayerInstantiated")),window.isPlayerInstantiated=!0};window.isPlayerInstantiated&&(console.log("WebGLRenderer: Player was already instantiated from previous mount"),re(!0)),Yd.subscribe(qd.playerInstantiated,kt);const He=setTimeout(()=>{K||(console.log("WebGLRenderer: Forcing player instantiation after timeout"),re(!0),window.isPlayerInstantiated=!0,window.dispatchEvent(new CustomEvent("PlayerInstantiated")))},5e3);return()=>{Yd.unsubscribe(qd.playerInstantiated,kt),clearTimeout(He)}},[K]),k.useEffect(()=>{const kt=()=>{console.log("WebGLRenderer: Modal opened"),ie(!0)},He=()=>{console.log("WebGLRenderer: Modal closed"),ie(!1)};return window.addEventListener("modal-opened",kt),window.addEventListener("modal-closed",He),()=>{window.removeEventListener("modal-opened",kt),window.removeEventListener("modal-closed",He)}},[]),k.useEffect(()=>{ie(L!==null)},[L]),k.useEffect(()=>{o||u?setTimeout(()=>{C(!0),console.log("WebGLRenderer: Unity is ready to receive messages.")},5e3):console.warn("WebGLRenderer: Unity is NOT ready yet.")},[o,u]),k.useEffect(()=>{o&&i&&setTimeout(()=>{if(window.unityInstance)try{console.log("WebGLRenderer: Disabling Unity keyboard capture on initialization"),window.unityInstance.SendMessage("WebGLInput","SetCaptureAllKeyboardInput",!1)}catch(kt){console.error("WebGLRenderer: Error disabling Unity keyboard capture:",kt)}},1e3)},[o,i]),k.useEffect(()=>{const kt=document.getElementById("webgl-root");return kt?(console.log("WebGLRenderer: Found webgl-root element, ensuring it is visible"),kt.style.display="block",kt.getAttribute("data-space-id")!==ae&&(kt.setAttribute("data-space-id",ae),console.log(`WebGLRenderer: Set data-space-id attribute to ${ae}`))):console.error("WebGLRenderer: Could not find webgl-root element"),()=>{}},[ae]),k.useEffect(()=>{const kt=()=>{const mt=qU();mt?(console.log("WebGLRenderer: Configuring Unity canvas for keyboard input"),mt.tabIndex=1,mt.style.outline="none",mt.addEventListener("click",()=>{console.log("WebGLRenderer: Unity canvas clicked, enabling keyboard capture"),Y||s0(!0)}),console.log("WebGLRenderer: Unity canvas configured with tabIndex=1")):console.warn("WebGLRenderer: Could not find Unity canvas to configure")};kt();const He=setTimeout(kt,1e3),ut=()=>{console.log("WebGLRenderer: Received unityReady event, configuring canvas"),kt()};return window.addEventListener("unityReady",ut),()=>{clearTimeout(He),window.removeEventListener("unityReady",ut)}},[o,Y]);const Oe=k.useCallback(()=>{console.log("WebGLRenderer: Unity canvas clicked, enabling keyboard capture"),Y||s0(!0)},[Y]);k.useEffect(()=>{if(o&&i){const kt=qU();if(kt)return console.log("WebGLRenderer: Adding click handler to Unity canvas"),kt.addEventListener("click",Oe),()=>{kt.removeEventListener("click",Oe)}}},[o,i,Oe]),k.useEffect(()=>{if(o&&i){console.log("WebGLRenderer: Setting up global click handler for focus management");const kt=He=>{if(Y){console.log("WebGLRenderer: Modal is open, not refocusing Unity on click");return}if(He.target.tagName==="INPUT"||He.target.tagName==="TEXTAREA"||He.target.tagName==="SELECT"||He.target.tagName==="BUTTON"){console.log("WebGLRenderer: Clicked on form element, not refocusing Unity");return}if(He.target.closest(".chakra-modal__content")||He.target.closest('[role="dialog"]')||He.target.closest('[role="menu"]')||He.target.closest(".chakra-popover__content")||He.target.closest('[role="tooltip"]')){console.log("WebGLRenderer: Clicked inside modal/dialog content, not refocusing Unity");return}const ut=qU();if(ut&&(He.target===ut||ut.contains(He.target)))return;if(He.target.closest(".webgl-overlay")||He.target.closest(".game-ui")||He.target.closest(".player-list")||He.target.closest(".unity-ui-overlay")){console.log("WebGLRenderer: Clicked on UI overlay that should allow keyboard events"),setTimeout(()=>{Y||s0(!0)},50);return}console.log("WebGLRenderer: Clicked outside forms/modals/special UI, refocusing Unity canvas"),setTimeout(()=>{ut&&!Y&&((ut.tabIndex===void 0||ut.tabIndex<0)&&(ut.tabIndex=1),ut.focus(),s0(!0))},50)};return document.addEventListener("click",kt,!0),()=>{document.removeEventListener("click",kt,!0)}}},[o,i,Y]),k.useEffect(()=>{const kt=He=>{console.log("WebGLRenderer: Received 'sendUserToUnity' event"),f("FirebaseUserFromReact",He)};return Yd.subscribe(qd.sendUserToUnity,kt),()=>Yd.unsubscribe(qd.sendUserToUnity,kt)},[f]);const{setFullscreenRef:Ve,fullscreenRef:xe}=Zd();k.useEffect(()=>{Ve(e.current)},[e,Ve]);const Re=()=>{Z(!B)},ve=E&&n.enableVoiceChat;console.log("WebGLRenderer: Render with state:",{user:!!E,userId:E==null?void 0:E.uid,isPlayerInstantiated:K,showVoiceChat:ve,sessionId:le}),k.useEffect(()=>{const kt=He=>{console.log("Edit mode changed event:",He.detail),pe(He.detail.enabled)};return window.addEventListener("editModeChanged",kt),()=>{window.removeEventListener("editModeChanged",kt)}},[]),aae(),kze();const be=k.useRef(null),{clickedPortal:We,clearClickedPortal:Pe}=Gze(),[Te,ke]=k.useState(!1),[Ue,Be]=k.useState(!1),[qe,$e]=k.useState(""),[st,Je]=k.useState("");k.useEffect(()=>{async function kt(){if($e(""),Je(""),We&&!ne){let He=We.targetSpaceId;if(!He&&We.portalId)try{const ut=dr(Dn,"spaces",ae,"portals",We.portalId),mt=await _o(ut);mt.exists()&&(He=mt.data().targetSpaceId)}catch{}if(He)try{const ut=await Xu(He);$e((ut==null?void 0:ut.name)||He),Je((ut==null?void 0:ut.slug)||""),Be(!0)}catch{$e(He),Je(""),Be(!0)}else $e(""),Je(""),Be(!0)}}We&&ne&&ke(!0),We&&!ne&&kt()},[We,ne,ae]);const Rt=()=>{console.log("Closing portal editor"),ke(!1),Pe()};return console.log("WebGLRenderer render state:",{isPortalEditorOpen:Te,clickedPortal:We,isEditMode:ne}),$ze(ae),hae(),S.jsxs(ct,{className:"webgl-renderer",children:[n.urlLoadingBackground&&S.jsx(Iae,{backgroundUrl:n.urlLoadingBackground,videoBackgroundUrl:n.videoBackgroundUrl,containerRef:be}),!X&&S.jsx(Aae,{containerRef:be}),X&&S.jsx(ct,{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",zIndex:"100",width:"100%",height:"100%",display:"flex",justifyContent:"center",alignItems:"center",children:S.jsx(HN,{mode:"button",label:"Sign In",initialIsOpen:!0,buttonProps:{size:"lg",colorScheme:"blue"}})}),S.jsx(fGe,{spaceId:ae,isEditMode:ne}),S.jsx(nF,{containerRef:xe.current?xe:document.body,children:S.jsxs("div",{ref:e,style:{width:"100%",height:"100%",aspectRatio:"auto",position:"absolute"},children:[S.jsxs(ct,{position:"absolute",zIndex:"10",top:4,right:4,display:"flex",alignItems:"center",gap:2,children:[n.showAuthButton&&S.jsx(Yze,{}),E&&S.jsx(oGe,{size:"md"}),ve&&S.jsxs(Sae,{appId:mGe,channel:le,uid:E==null?void 0:E.uid,enabled:!0,children:[S.jsx(R8e,{size:"md",defaultMuted:!0,joinOnClick:!0}),S.jsx(A8e,{userNickname:de==null?void 0:de.Nickname})]}),S.jsx(p8e,{}),S.jsx(ct,{position:"relative",zIndex:"9999",children:S.jsx(J8e,{onTogglePlayerList:Re,spaceID:ae})})]}),S.jsxs(ct,{ref:be,position:"relative",overflow:"hidden",width:"100%",height:"100%",bgRepeat:"no-repeat",bgSize:"cover",bgPosition:"center",bgColor:"#666666",children:[S.jsx(ct,{position:"absolute",top:"0",left:"0",width:"100%",height:"100%",backdropFilter:"blur(8px)",backgroundColor:"rgba(255, 255, 255, 0.1)",zIndex:"0"}),S.jsx(ct,{..._,width:"100%",height:"100%",position:"absolute",zIndex:"1",children:i?S.jsx(sae.Unity,{unityProvider:i,style:{width:"100%",height:"100%"},devicePixelRatio:I,tabIndex:1}):S.jsx(ct,{width:"100%",height:"100%"})}),S.jsx(ct,{position:"absolute",zIndex:"6",width:"100%",height:"100%",style:{display:"none"},children:S.jsx(qze,{})})]}),S.jsx(ct,{..._,position:"absolute",zIndex:"2",top:4,left:4,display:"flex",alignItems:"flex-start",gap:3,height:"50px",children:n.showDisruptiveLogo&&S.jsx(cp,{src:n.urlDisruptiveLogo,width:"100px",alt:"Disruptive Logo"})}),S.jsx(ct,{..._,position:"absolute",zIndex:"2",bottom:4,left:4,display:"flex",alignItems:"flex-start",gap:3,children:E&&S.jsx(Pae,{settings:n})}),S.jsxs(ct,{..._,position:"absolute",zIndex:"2",bottom:4,right:4,display:"flex",alignItems:"flex-start",gap:3,children:[n.showHelpButton&&S.jsx(Xze,{}),S.jsx(g8e,{})]}),S.jsx(_8e,{}),S.jsx(y8e,{isOpen:L!==null,onClose:()=>{console.log(" Closing nameplate modal"),M()},playerName:(L==null?void 0:L.playerName)||"Unknown Player",playerId:(L==null?void 0:L.playerId)||"Unknown ID"}),S.jsx(E8e,{isVisible:B,onToggleVisibility:Z,spaceID:ae}),S.jsx(sGe,{}),S.jsx(ct,{position:"absolute",top:4,right:4,zIndex:1e3,children:Te&&We&&S.jsx(cGe,{isOpen:Te,onClose:Rt,portal:We,spaceId:ae})}),!ne&&Ue&&S.jsxs(hs,{isOpen:Ue,onClose:()=>{Be(!1),Pe(),$e(""),Je("")},isCentered:!0,children:[S.jsx(fs,{}),S.jsxs(ps,{bg:"#181818",borderRadius:"2xl",boxShadow:"2xl",maxW:"420px",p:0,children:[S.jsx(yo,{textAlign:"center",fontWeight:"extrabold",fontSize:"2xl",color:"white",pt:8,pb:4,children:qe?`Visit ${qe}?`:"Visit Space?"}),S.jsx($s,{color:"white",top:4,right:4}),S.jsx(bs,{pb:8,pt:2,px:8,children:S.jsxs(Cr,{mt:4,gap:6,justify:"center",children:[S.jsx(jn,{variant:"outline",borderColor:"whiteAlpha.400",color:"white",fontWeight:"bold",borderRadius:"2xl",px:10,py:6,fontSize:"lg",onClick:()=>{Be(!1),Pe(),$e(""),Je("")},_hover:{bg:"whiteAlpha.100"},children:"Cancel"}),S.jsx(jn,{colorScheme:"whiteAlpha",bg:"white",color:"#181818",fontWeight:"bold",borderRadius:"2xl",px:10,py:6,fontSize:"lg",onClick:()=>{st&&window.open(`https://www.spacesmetaverse.com/w/${st}`,"_blank","noopener"),Be(!1),Pe(),$e(""),Je("")},_hover:{bg:"gray.100"},children:"Visit"})]})})]})]}),S.jsx(dGe,{})]})})]})});D3.displayName="WebGLRenderer";D3.propTypes={settings:yn.shape({urlLoadingBackground:yn.string,videoBackgroundUrl:yn.string,showAuthButton:yn.bool,showDisruptiveLogo:yn.bool,urlDisruptiveLogo:yn.string,showHelpButton:yn.bool,enableVoiceChat:yn.bool,spaceID:yn.string})};typeof window<"u"&&!window.MultipleView&&(console.log("Defining fallback MultipleView class - scripts may not be loaded yet"),window.MultipleView=class{constructor(){console.log("HISPlayer: Fallback MultipleView constructor called"),this.multiView={getPlayer:()=>(console.log("HISPlayer: getPlayer called from fallback"),{isPlaying:!1,play:()=>(console.log("HISPlayer: play called"),!0),pause:()=>(console.log("HISPlayer: pause called"),!0),mute:e=>(console.log("HISPlayer: mute called with state:",e),!0),isMuted:!1,seek:e=>(console.log("HISPlayer: seek called with time:",e),!0),setVolume:e=>(console.log("HISPlayer: setVolume called with volume:",e),!0),getVolume:()=>(console.log("HISPlayer: getVolume called"),1),getCurrentTime:()=>(console.log("HISPlayer: getCurrentTime called"),0),getDuration:()=>(console.log("HISPlayer: getDuration called"),100)}),initialize:()=>(console.log("HISPlayer: initialize called"),!0),setUnityContext:e=>(console.log("HISPlayer: setUnityContext called with:",e),window.hisPlayerContextId=e,!0),release:()=>(console.log("HISPlayer: release called"),!0),setProperties:e=>(console.log("HISPlayer: setProperties called with:",e),!0),setMultiPaths:e=>(console.log("HISPlayer: setMultiPaths called with:",e),window._hisplayer_paths=e,!0)}}});if(typeof window<"u"&&!window._hisPlayerInitialized){if(H.log("WebGLLoader: Initializing HISPlayer functions"),window._hisPlayerInitialized=!0,window._hisplayer_event_queue=window._hisplayer_event_queue||[],window._hisplayer_error_queue=window._hisplayer_error_queue||[],!document.getElementById("hisplayer-error")){const n=document.createElement("div");n.id="hisplayer-error",n.style.position="absolute",n.style.top="10px",n.style.left="50%",n.style.transform="translateX(-50%)",n.style.color="red",n.style.zIndex="9999",document.body.appendChild(n),H.log("WebGLLoader: Created hisplayer-error div")}window.isErrorQueueEmpty=window.isErrorQueueEmpty||function(){return window._hisplayer_error_queue.length===0},window.getNextError=window.getNextError||function(){return window._hisplayer_error_queue.length>0?window._hisplayer_error_queue.shift():""},window.isEventQueueEmpty=window.isEventQueueEmpty||function(){return window._hisplayer_event_queue.length===0},window.getNextEvent=window.getNextEvent||function(){return window._hisplayer_event_queue.length>0?window._hisplayer_event_queue.shift():""},window.setUpContext=window.setUpContext||function(n){console.log("HISPlayer: setUpContext called with contextId:",n),window.hisPlayerContextId=n;try{if(window.MultipleView){console.log("HISPlayer: Creating MultipleView instance");const e=new window.MultipleView;if(e&&e.multiView&&typeof e.multiView.setUnityContext=="function")return e.multiView.setUnityContext(n),window._hisplayer_instance=e,console.log("HISPlayer: Successfully set Unity context ID"),!0;console.error("HISPlayer: Player initialization failed - missing expected methods")}else{console.error("HISPlayer: MultipleView class not found"),window.MultipleView=class{constructor(){console.log("HISPlayer: Backup MultipleView constructor called"),this.multiView={getPlayer:()=>(console.log("HISPlayer: getPlayer called from backup"),{isPlaying:!1,play:()=>!0,pause:()=>!0,mute:()=>!0,isMuted:!1,seek:()=>!0,setVolume:()=>!0,getVolume:()=>1,getCurrentTime:()=>0,getDuration:()=>100}),initialize:()=>!0,setUnityContext:o=>(window.hisPlayerContextId=o,!0),release:()=>!0,setProperties:()=>!0,setMultiPaths:()=>!0}}},console.log("HISPlayer: Trying again with backup MultipleView");const e=new window.MultipleView;return e.multiView.setUnityContext(n),window._hisplayer_instance=e,!0}}catch(e){console.error("HISPlayer: Error in setUpContext:",e);const i=document.getElementById("hisplayer-error");i&&(i.innerHTML="Error: "+e.message)}return!1}}const x3=({spaceID:n,overrideSettings:e})=>{const i=k.useRef(null),[o,l]=k.useState(!0),[u,f]=k.useState({spaceID:n,loaderUrl:"",dataUrl:"",frameworkUrl:"",codeUrl:""}),[_,E]=k.useState({urlDisruptiveLogo:"gs://disruptive-metaverse.appspot.com/common/images/Disruptive-logo-white-p-500.png",urlLoadingBackground:"",videoBackgroundUrl:"",showDisruptiveLogo:null,showAuthButton:null,showHelpButton:null,enableVoiceChat:!0,spaceID:n});return k.useEffect(()=>{(async()=>{try{const C=await Xu(n);if(C){console.log("Space data: ",C),f(M=>({...M,spaceID:n,loaderUrl:C.loaderUrl,dataUrl:C.dataUrl,frameworkUrl:C.frameworkUrl,codeUrl:C.codeUrl}));const I=await Lk(_.urlDisruptiveLogo);let P="";if(C.backgroundUrl)P=C.backgroundUrl;else if(C.backgroundGsUrl)try{P=await Lk(C.backgroundGsUrl)}catch(M){H.warn("WebGLLoader: Error fetching background from GS URL:",M)}else if(C.gsUrlLoadingBackground)try{P=await Lk(C.gsUrlLoadingBackground)}catch(M){H.warn("WebGLLoader: Error fetching background from legacy GS URL:",M)}let L="";C.videoBackgroundUrl&&(L=C.videoBackgroundUrl,console.log("WebGLLoader: Found video background URL:",L)),E(M=>({...M,urlLoadingBackground:P,videoBackgroundUrl:L,showAuthButton:C.showAuthButton!==void 0?C.showAuthButton:!0,showDisruptiveLogo:C.showDisruptiveLogo!==void 0?C.showDisruptiveLogo:!0,showHelpButton:C.showHelpButton!==void 0?C.showHelpButton:!0,enableVoiceChat:C.enableVoiceChat!==void 0?C.enableVoiceChat:!0,urlDisruptiveLogo:I,spaceID:n,...e||{}})),L&&(console.log("WebGLLoader: Dispatching video background event with URL:",L),window.dispatchEvent(new CustomEvent("SpaceVideoBackgroundUpdated",{detail:{videoBackgroundUrl:L}}))),l(!1)}else H.error(`WebGLLoader: No configuration found for spaceID: ${n}`)}catch(C){H.error("WebGLLoader: Error fetching space data:",C)}finally{l(!1)}})()},[n,_.urlDisruptiveLogo,e]),k.useEffect(()=>{o||(H.log("WebGLLoader: Unity config from Firebase",u),H.log("WebGLLoader: Space settings from Firebase",_))},[o]),S.jsx(S.Fragment,{children:o?S.jsx("div",{className:"flex justify-center items-center h-full mt-12",children:"Getting space data..."}):S.jsx(Tze,{...u,children:S.jsx(D3,{ref:i,settings:_})})})};x3.propTypes={spaceID:yn.string.isRequired,overrideSettings:yn.object};function eZ(){const n=document.getElementById("webgl-root");if(n){const e=n.getAttribute("data-space-id"),i=n.getAttribute("data-theme")||"default",o=()=>{const[l,u]=k.useState(null);return k.useEffect(()=>{YC(i).then(u)},[]),l?S.jsx(Y1,{theme:l,children:S.jsx(FN,{children:S.jsx(T3,{children:S.jsx(x3,{spaceID:e})})})}):S.jsx("div",{children:"Loading theme..."})};try{P1.createRoot(n).render(S.jsx(o,{}))}catch(l){console.warn("Error initializing WebGL:",l)}}}typeof window<"u"&&(document.readyState==="loading"?document.addEventListener("DOMContentLoaded",eZ):eZ());const gGe=(n,e)=>{try{const i=Sl(Dn,`spaces/${n}/chatMessages`),o=new Date,l=b1(i,xBe("timestamp","asc"),MBe(o));return voe(l,u=>{const f=[];u.docChanges().forEach(_=>{if(_.type==="added"){const E=_.doc.data();console.log("Firestore document data:",E),f.push({id:_.doc.id,...E})}}),f.length>0&&e(f)})}catch(i){throw H.error("Error subscribing to space chat messages:",i),i}};function eh(n){const e=Object.prototype.toString.call(n);return n instanceof Date||typeof n=="object"&&e==="[object Date]"?new n.constructor(+n):typeof n=="number"||e==="[object Number]"||typeof n=="string"||e==="[object String]"?new Date(n):new Date(NaN)}function cE(n,e){return n instanceof Date?new n.constructor(e):new Date(e)}const Oae=6048e5,_Ge=864e5;let yGe={};function qN(){return yGe}function oR(n,e){var _,E,b,C;const i=qN(),o=(e==null?void 0:e.weekStartsOn)??((E=(_=e==null?void 0:e.locale)==null?void 0:_.options)==null?void 0:E.weekStartsOn)??i.weekStartsOn??((C=(b=i.locale)==null?void 0:b.options)==null?void 0:C.weekStartsOn)??0,l=eh(n),u=l.getDay(),f=(u<o?7:0)+u-o;return l.setDate(l.getDate()-f),l.setHours(0,0,0,0),l}function A1(n){return oR(n,{weekStartsOn:1})}function kae(n){const e=eh(n),i=e.getFullYear(),o=cE(n,0);o.setFullYear(i+1,0,4),o.setHours(0,0,0,0);const l=A1(o),u=cE(n,0);u.setFullYear(i,0,4),u.setHours(0,0,0,0);const f=A1(u);return e.getTime()>=l.getTime()?i+1:e.getTime()>=f.getTime()?i:i-1}function tZ(n){const e=eh(n);return e.setHours(0,0,0,0),e}function nZ(n){const e=eh(n),i=new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds()));return i.setUTCFullYear(e.getFullYear()),+n-+i}function EGe(n,e){const i=tZ(n),o=tZ(e),l=+i-nZ(i),u=+o-nZ(o);return Math.round((l-u)/_Ge)}function vGe(n){const e=kae(n),i=cE(n,0);return i.setFullYear(e,0,4),i.setHours(0,0,0,0),A1(i)}function SGe(n){return n instanceof Date||typeof n=="object"&&Object.prototype.toString.call(n)==="[object Date]"}function bGe(n){if(!SGe(n)&&typeof n!="number")return!1;const e=eh(n);return!isNaN(Number(e))}function wGe(n){const e=eh(n),i=cE(n,0);return i.setFullYear(e.getFullYear(),0,1),i.setHours(0,0,0,0),i}const TGe={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},CGe=(n,e,i)=>{let o;const l=TGe[n];return typeof l=="string"?o=l:e===1?o=l.one:o=l.other.replace("{{count}}",e.toString()),i!=null&&i.addSuffix?i.comparison&&i.comparison>0?"in "+o:o+" ago":o};function YU(n){return(e={})=>{const i=e.width?String(e.width):n.defaultWidth;return n.formats[i]||n.formats[n.defaultWidth]}}const RGe={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},IGe={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},AGe={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},PGe={date:YU({formats:RGe,defaultWidth:"full"}),time:YU({formats:IGe,defaultWidth:"full"}),dateTime:YU({formats:AGe,defaultWidth:"full"})},OGe={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},kGe=(n,e,i,o)=>OGe[n];function zT(n){return(e,i)=>{const o=i!=null&&i.context?String(i.context):"standalone";let l;if(o==="formatting"&&n.formattingValues){const f=n.defaultFormattingWidth||n.defaultWidth,_=i!=null&&i.width?String(i.width):f;l=n.formattingValues[_]||n.formattingValues[f]}else{const f=n.defaultWidth,_=i!=null&&i.width?String(i.width):n.defaultWidth;l=n.values[_]||n.values[f]}const u=n.argumentCallback?n.argumentCallback(e):e;return l[u]}}const NGe={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},DGe={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},xGe={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},LGe={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},MGe={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},UGe={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},VGe=(n,e)=>{const i=Number(n),o=i%100;if(o>20||o<10)switch(o%10){case 1:return i+"st";case 2:return i+"nd";case 3:return i+"rd"}return i+"th"},jGe={ordinalNumber:VGe,era:zT({values:NGe,defaultWidth:"wide"}),quarter:zT({values:DGe,defaultWidth:"wide",argumentCallback:n=>n-1}),month:zT({values:xGe,defaultWidth:"wide"}),day:zT({values:LGe,defaultWidth:"wide"}),dayPeriod:zT({values:MGe,defaultWidth:"wide",formattingValues:UGe,defaultFormattingWidth:"wide"})};function GT(n){return(e,i={})=>{const o=i.width,l=o&&n.matchPatterns[o]||n.matchPatterns[n.defaultMatchWidth],u=e.match(l);if(!u)return null;const f=u[0],_=o&&n.parsePatterns[o]||n.parsePatterns[n.defaultParseWidth],E=Array.isArray(_)?BGe(_,I=>I.test(f)):FGe(_,I=>I.test(f));let b;b=n.valueCallback?n.valueCallback(E):E,b=i.valueCallback?i.valueCallback(b):b;const C=e.slice(f.length);return{value:b,rest:C}}}function FGe(n,e){for(const i in n)if(Object.prototype.hasOwnProperty.call(n,i)&&e(n[i]))return i}function BGe(n,e){for(let i=0;i<n.length;i++)if(e(n[i]))return i}function WGe(n){return(e,i={})=>{const o=e.match(n.matchPattern);if(!o)return null;const l=o[0],u=e.match(n.parsePattern);if(!u)return null;let f=n.valueCallback?n.valueCallback(u[0]):u[0];f=i.valueCallback?i.valueCallback(f):f;const _=e.slice(l.length);return{value:f,rest:_}}}const zGe=/^(\d+)(th|st|nd|rd)?/i,GGe=/\d+/i,HGe={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},$Ge={any:[/^b/i,/^(a|c)/i]},KGe={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},qGe={any:[/1/i,/2/i,/3/i,/4/i]},YGe={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},XGe={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},JGe={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},QGe={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},ZGe={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},eHe={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},tHe={ordinalNumber:WGe({matchPattern:zGe,parsePattern:GGe,valueCallback:n=>parseInt(n,10)}),era:GT({matchPatterns:HGe,defaultMatchWidth:"wide",parsePatterns:$Ge,defaultParseWidth:"any"}),quarter:GT({matchPatterns:KGe,defaultMatchWidth:"wide",parsePatterns:qGe,defaultParseWidth:"any",valueCallback:n=>n+1}),month:GT({matchPatterns:YGe,defaultMatchWidth:"wide",parsePatterns:XGe,defaultParseWidth:"any"}),day:GT({matchPatterns:JGe,defaultMatchWidth:"wide",parsePatterns:QGe,defaultParseWidth:"any"}),dayPeriod:GT({matchPatterns:ZGe,defaultMatchWidth:"any",parsePatterns:eHe,defaultParseWidth:"any"})},nHe={code:"en-US",formatDistance:CGe,formatLong:PGe,formatRelative:kGe,localize:jGe,match:tHe,options:{weekStartsOn:0,firstWeekContainsDate:1}};function rHe(n){const e=eh(n);return EGe(e,wGe(e))+1}function iHe(n){const e=eh(n),i=+A1(e)-+vGe(e);return Math.round(i/Oae)+1}function Nae(n,e){var C,I,P,L;const i=eh(n),o=i.getFullYear(),l=qN(),u=(e==null?void 0:e.firstWeekContainsDate)??((I=(C=e==null?void 0:e.locale)==null?void 0:C.options)==null?void 0:I.firstWeekContainsDate)??l.firstWeekContainsDate??((L=(P=l.locale)==null?void 0:P.options)==null?void 0:L.firstWeekContainsDate)??1,f=cE(n,0);f.setFullYear(o+1,0,u),f.setHours(0,0,0,0);const _=oR(f,e),E=cE(n,0);E.setFullYear(o,0,u),E.setHours(0,0,0,0);const b=oR(E,e);return i.getTime()>=_.getTime()?o+1:i.getTime()>=b.getTime()?o:o-1}function sHe(n,e){var _,E,b,C;const i=qN(),o=(e==null?void 0:e.firstWeekContainsDate)??((E=(_=e==null?void 0:e.locale)==null?void 0:_.options)==null?void 0:E.firstWeekContainsDate)??i.firstWeekContainsDate??((C=(b=i.locale)==null?void 0:b.options)==null?void 0:C.firstWeekContainsDate)??1,l=Nae(n,e),u=cE(n,0);return u.setFullYear(l,0,o),u.setHours(0,0,0,0),oR(u,e)}function oHe(n,e){const i=eh(n),o=+oR(i,e)-+sHe(i,e);return Math.round(o/Oae)+1}function Ri(n,e){const i=n<0?"-":"",o=Math.abs(n).toString().padStart(e,"0");return i+o}const vg={y(n,e){const i=n.getFullYear(),o=i>0?i:1-i;return Ri(e==="yy"?o%100:o,e.length)},M(n,e){const i=n.getMonth();return e==="M"?String(i+1):Ri(i+1,2)},d(n,e){return Ri(n.getDate(),e.length)},a(n,e){const i=n.getHours()/12>=1?"pm":"am";switch(e){case"a":case"aa":return i.toUpperCase();case"aaa":return i;case"aaaaa":return i[0];case"aaaa":default:return i==="am"?"a.m.":"p.m."}},h(n,e){return Ri(n.getHours()%12||12,e.length)},H(n,e){return Ri(n.getHours(),e.length)},m(n,e){return Ri(n.getMinutes(),e.length)},s(n,e){return Ri(n.getSeconds(),e.length)},S(n,e){const i=e.length,o=n.getMilliseconds(),l=Math.trunc(o*Math.pow(10,i-3));return Ri(l,e.length)}},jS={midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},rZ={G:function(n,e,i){const o=n.getFullYear()>0?1:0;switch(e){case"G":case"GG":case"GGG":return i.era(o,{width:"abbreviated"});case"GGGGG":return i.era(o,{width:"narrow"});case"GGGG":default:return i.era(o,{width:"wide"})}},y:function(n,e,i){if(e==="yo"){const o=n.getFullYear(),l=o>0?o:1-o;return i.ordinalNumber(l,{unit:"year"})}return vg.y(n,e)},Y:function(n,e,i,o){const l=Nae(n,o),u=l>0?l:1-l;if(e==="YY"){const f=u%100;return Ri(f,2)}return e==="Yo"?i.ordinalNumber(u,{unit:"year"}):Ri(u,e.length)},R:function(n,e){const i=kae(n);return Ri(i,e.length)},u:function(n,e){const i=n.getFullYear();return Ri(i,e.length)},Q:function(n,e,i){const o=Math.ceil((n.getMonth()+1)/3);switch(e){case"Q":return String(o);case"QQ":return Ri(o,2);case"Qo":return i.ordinalNumber(o,{unit:"quarter"});case"QQQ":return i.quarter(o,{width:"abbreviated",context:"formatting"});case"QQQQQ":return i.quarter(o,{width:"narrow",context:"formatting"});case"QQQQ":default:return i.quarter(o,{width:"wide",context:"formatting"})}},q:function(n,e,i){const o=Math.ceil((n.getMonth()+1)/3);switch(e){case"q":return String(o);case"qq":return Ri(o,2);case"qo":return i.ordinalNumber(o,{unit:"quarter"});case"qqq":return i.quarter(o,{width:"abbreviated",context:"standalone"});case"qqqqq":return i.quarter(o,{width:"narrow",context:"standalone"});case"qqqq":default:return i.quarter(o,{width:"wide",context:"standalone"})}},M:function(n,e,i){const o=n.getMonth();switch(e){case"M":case"MM":return vg.M(n,e);case"Mo":return i.ordinalNumber(o+1,{unit:"month"});case"MMM":return i.month(o,{width:"abbreviated",context:"formatting"});case"MMMMM":return i.month(o,{width:"narrow",context:"formatting"});case"MMMM":default:return i.month(o,{width:"wide",context:"formatting"})}},L:function(n,e,i){const o=n.getMonth();switch(e){case"L":return String(o+1);case"LL":return Ri(o+1,2);case"Lo":return i.ordinalNumber(o+1,{unit:"month"});case"LLL":return i.month(o,{width:"abbreviated",context:"standalone"});case"LLLLL":return i.month(o,{width:"narrow",context:"standalone"});case"LLLL":default:return i.month(o,{width:"wide",context:"standalone"})}},w:function(n,e,i,o){const l=oHe(n,o);return e==="wo"?i.ordinalNumber(l,{unit:"week"}):Ri(l,e.length)},I:function(n,e,i){const o=iHe(n);return e==="Io"?i.ordinalNumber(o,{unit:"week"}):Ri(o,e.length)},d:function(n,e,i){return e==="do"?i.ordinalNumber(n.getDate(),{unit:"date"}):vg.d(n,e)},D:function(n,e,i){const o=rHe(n);return e==="Do"?i.ordinalNumber(o,{unit:"dayOfYear"}):Ri(o,e.length)},E:function(n,e,i){const o=n.getDay();switch(e){case"E":case"EE":case"EEE":return i.day(o,{width:"abbreviated",context:"formatting"});case"EEEEE":return i.day(o,{width:"narrow",context:"formatting"});case"EEEEEE":return i.day(o,{width:"short",context:"formatting"});case"EEEE":default:return i.day(o,{width:"wide",context:"formatting"})}},e:function(n,e,i,o){const l=n.getDay(),u=(l-o.weekStartsOn+8)%7||7;switch(e){case"e":return String(u);case"ee":return Ri(u,2);case"eo":return i.ordinalNumber(u,{unit:"day"});case"eee":return i.day(l,{width:"abbreviated",context:"formatting"});case"eeeee":return i.day(l,{width:"narrow",context:"formatting"});case"eeeeee":return i.day(l,{width:"short",context:"formatting"});case"eeee":default:return i.day(l,{width:"wide",context:"formatting"})}},c:function(n,e,i,o){const l=n.getDay(),u=(l-o.weekStartsOn+8)%7||7;switch(e){case"c":return String(u);case"cc":return Ri(u,e.length);case"co":return i.ordinalNumber(u,{unit:"day"});case"ccc":return i.day(l,{width:"abbreviated",context:"standalone"});case"ccccc":return i.day(l,{width:"narrow",context:"standalone"});case"cccccc":return i.day(l,{width:"short",context:"standalone"});case"cccc":default:return i.day(l,{width:"wide",context:"standalone"})}},i:function(n,e,i){const o=n.getDay(),l=o===0?7:o;switch(e){case"i":return String(l);case"ii":return Ri(l,e.length);case"io":return i.ordinalNumber(l,{unit:"day"});case"iii":return i.day(o,{width:"abbreviated",context:"formatting"});case"iiiii":return i.day(o,{width:"narrow",context:"formatting"});case"iiiiii":return i.day(o,{width:"short",context:"formatting"});case"iiii":default:return i.day(o,{width:"wide",context:"formatting"})}},a:function(n,e,i){const l=n.getHours()/12>=1?"pm":"am";switch(e){case"a":case"aa":return i.dayPeriod(l,{width:"abbreviated",context:"formatting"});case"aaa":return i.dayPeriod(l,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return i.dayPeriod(l,{width:"narrow",context:"formatting"});case"aaaa":default:return i.dayPeriod(l,{width:"wide",context:"formatting"})}},b:function(n,e,i){const o=n.getHours();let l;switch(o===12?l=jS.noon:o===0?l=jS.midnight:l=o/12>=1?"pm":"am",e){case"b":case"bb":return i.dayPeriod(l,{width:"abbreviated",context:"formatting"});case"bbb":return i.dayPeriod(l,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return i.dayPeriod(l,{width:"narrow",context:"formatting"});case"bbbb":default:return i.dayPeriod(l,{width:"wide",context:"formatting"})}},B:function(n,e,i){const o=n.getHours();let l;switch(o>=17?l=jS.evening:o>=12?l=jS.afternoon:o>=4?l=jS.morning:l=jS.night,e){case"B":case"BB":case"BBB":return i.dayPeriod(l,{width:"abbreviated",context:"formatting"});case"BBBBB":return i.dayPeriod(l,{width:"narrow",context:"formatting"});case"BBBB":default:return i.dayPeriod(l,{width:"wide",context:"formatting"})}},h:function(n,e,i){if(e==="ho"){let o=n.getHours()%12;return o===0&&(o=12),i.ordinalNumber(o,{unit:"hour"})}return vg.h(n,e)},H:function(n,e,i){return e==="Ho"?i.ordinalNumber(n.getHours(),{unit:"hour"}):vg.H(n,e)},K:function(n,e,i){const o=n.getHours()%12;return e==="Ko"?i.ordinalNumber(o,{unit:"hour"}):Ri(o,e.length)},k:function(n,e,i){let o=n.getHours();return o===0&&(o=24),e==="ko"?i.ordinalNumber(o,{unit:"hour"}):Ri(o,e.length)},m:function(n,e,i){return e==="mo"?i.ordinalNumber(n.getMinutes(),{unit:"minute"}):vg.m(n,e)},s:function(n,e,i){return e==="so"?i.ordinalNumber(n.getSeconds(),{unit:"second"}):vg.s(n,e)},S:function(n,e){return vg.S(n,e)},X:function(n,e,i){const o=n.getTimezoneOffset();if(o===0)return"Z";switch(e){case"X":return sZ(o);case"XXXX":case"XX":return Py(o);case"XXXXX":case"XXX":default:return Py(o,":")}},x:function(n,e,i){const o=n.getTimezoneOffset();switch(e){case"x":return sZ(o);case"xxxx":case"xx":return Py(o);case"xxxxx":case"xxx":default:return Py(o,":")}},O:function(n,e,i){const o=n.getTimezoneOffset();switch(e){case"O":case"OO":case"OOO":return"GMT"+iZ(o,":");case"OOOO":default:return"GMT"+Py(o,":")}},z:function(n,e,i){const o=n.getTimezoneOffset();switch(e){case"z":case"zz":case"zzz":return"GMT"+iZ(o,":");case"zzzz":default:return"GMT"+Py(o,":")}},t:function(n,e,i){const o=Math.trunc(n.getTime()/1e3);return Ri(o,e.length)},T:function(n,e,i){const o=n.getTime();return Ri(o,e.length)}};function iZ(n,e=""){const i=n>0?"-":"+",o=Math.abs(n),l=Math.trunc(o/60),u=o%60;return u===0?i+String(l):i+String(l)+e+Ri(u,2)}function sZ(n,e){return n%60===0?(n>0?"-":"+")+Ri(Math.abs(n)/60,2):Py(n,e)}function Py(n,e=""){const i=n>0?"-":"+",o=Math.abs(n),l=Ri(Math.trunc(o/60),2),u=Ri(o%60,2);return i+l+e+u}const oZ=(n,e)=>{switch(n){case"P":return e.date({width:"short"});case"PP":return e.date({width:"medium"});case"PPP":return e.date({width:"long"});case"PPPP":default:return e.date({width:"full"})}},Dae=(n,e)=>{switch(n){case"p":return e.time({width:"short"});case"pp":return e.time({width:"medium"});case"ppp":return e.time({width:"long"});case"pppp":default:return e.time({width:"full"})}},aHe=(n,e)=>{const i=n.match(/(P+)(p+)?/)||[],o=i[1],l=i[2];if(!l)return oZ(n,e);let u;switch(o){case"P":u=e.dateTime({width:"short"});break;case"PP":u=e.dateTime({width:"medium"});break;case"PPP":u=e.dateTime({width:"long"});break;case"PPPP":default:u=e.dateTime({width:"full"});break}return u.replace("{{date}}",oZ(o,e)).replace("{{time}}",Dae(l,e))},cHe={p:Dae,P:aHe},lHe=/^D+$/,uHe=/^Y+$/,dHe=["D","DD","YY","YYYY"];function hHe(n){return lHe.test(n)}function pHe(n){return uHe.test(n)}function fHe(n,e,i){const o=mHe(n,e,i);if(console.warn(o),dHe.includes(n))throw new RangeError(o)}function mHe(n,e,i){const o=n[0]==="Y"?"years":"days of the month";return`Use \`${n.toLowerCase()}\` instead of \`${n}\` (in \`${e}\`) for formatting ${o} to the input \`${i}\`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md`}const gHe=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,_He=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,yHe=/^'([^]*?)'?$/,EHe=/''/g,vHe=/[a-zA-Z]/;function SHe(n,e,i){var C,I,P,L;const o=qN(),l=o.locale??nHe,u=o.firstWeekContainsDate??((I=(C=o.locale)==null?void 0:C.options)==null?void 0:I.firstWeekContainsDate)??1,f=o.weekStartsOn??((L=(P=o.locale)==null?void 0:P.options)==null?void 0:L.weekStartsOn)??0,_=eh(n);if(!bGe(_))throw new RangeError("Invalid time value");let E=e.match(_He).map(M=>{const F=M[0];if(F==="p"||F==="P"){const B=cHe[F];return B(M,l.formatLong)}return M}).join("").match(gHe).map(M=>{if(M==="''")return{isToken:!1,value:"'"};const F=M[0];if(F==="'")return{isToken:!1,value:bHe(M)};if(rZ[F])return{isToken:!0,value:M};if(F.match(vHe))throw new RangeError("Format string contains an unescaped latin alphabet character `"+F+"`");return{isToken:!1,value:M}});l.localize.preprocessor&&(E=l.localize.preprocessor(_,E));const b={firstWeekContainsDate:u,weekStartsOn:f,locale:l};return E.map(M=>{if(!M.isToken)return M.value;const F=M.value;(pHe(F)||hHe(F))&&fHe(F,e,String(n));const B=rZ[F[0]];return B(_,F,l.localize,b)}).join("")}function bHe(n){const e=n.match(yHe);return e?e[1].replace(EHe,"'"):n}const wHe=Ip(ct),xae=({name:n,timestamp:e,text:i,isCurrentUser:o})=>{console.log("Message props:",{name:n,timestamp:e,text:i,isCurrentUser:o});const l=e&&e.toDate?SHe(e.toDate(),"HH:mm"):"Invalid date";return S.jsxs(wHe,{display:"flex",flexDirection:"column",alignItems:o?"flex-end":"flex-start",initial:{opacity:0},animate:{opacity:1},transition:{duration:.5},children:[S.jsxs(ct,{w:"auto",maxW:"80%",bg:o?"secondary.500":"primary.200",color:o?"white":"black",p:"10px",borderRadius:"10px",alignSelf:o?"flex-end":"flex-start",wordBreak:"break-word",children:[S.jsx(tt,{fontWeight:"bold",children:n}),S.jsx(tt,{children:i})]}),S.jsx(tt,{color:"copy.light",fontSize:"xs",mt:"4px",mx:"6px",mb:"10px",textAlign:o?"right":"left",children:l})]})};xae.propTypes={name:yn.string.isRequired,timestamp:yn.object,text:yn.string.isRequired,isCurrentUser:yn.bool.isRequired};const THe=({spaceID:n})=>{const[e,i]=k.useState([]),{user:o}=k.useContext(Uo),l=k.useRef(null);return k.useEffect(()=>{const u=gGe(n,f=>{console.log("New messages received:",f),i(_=>[..._,...f]),H.log("Messages updated:",f)});return()=>u()},[n]),k.useEffect(()=>{l.current&&l.current.scrollIntoView({behavior:"smooth"})},[e]),S.jsxs(ct,{className:"messages-container",display:"flex",flexDirection:"column",my:"10px",overflowY:"auto",maxHeight:"80vh",children:[e.map(u=>{const f=u.uid===(o==null?void 0:o.uid);return S.jsx(xae,{name:u.user,timestamp:u.timestamp,text:u.text,isCurrentUser:f},u.id)}),S.jsx("div",{ref:l})]})},CHe=({spaceID:n})=>{},Lae=({spaceID:n})=>{const{user:e}=k.useContext(Uo);return e?S.jsxs(ct,{children:[S.jsx(ct,{height:"400px",overflowY:"auto",border:"1px solid #ccc",backgroundColor:"tertiaryAlpha.600",padding:"10px",children:S.jsx(THe,{spaceID:n})}),S.jsx(ct,{mt:"8px",children:S.jsx(CHe,{spaceID:n})})]}):(console.log("No user found, returning login message"),S.jsx(ct,{children:S.jsx(tt,{children:"Please log in to view the chat."})}))},nk=document.getElementById("chat-root");if(nk){const n=nk.getAttribute("data-space-id"),e=nk.getAttribute("data-theme")||"default",i=()=>{const[o,l]=k.useState(null);return k.useEffect(()=>{YC(e).then(l)},[]),o?S.jsx(Y1,{theme:o,children:S.jsx(FN,{children:S.jsx(Lae,{spaceID:n})})}):S.jsx("div",{children:"Loading theme..."})};P1.createRoot(nk).render(S.jsx(i,{}))}else console.error("Root element 'chat-root' not found.");class RHe extends k.Component{constructor(e){super(e),this.state={hasError:!1}}static getDerivedStateFromError(e){return{hasError:!0}}componentDidCatch(e,i){console.error("WebGL Error:",e,i)}render(){return this.state.hasError?S.jsx(ct,{p:4,bg:"red.100",color:"red.900",borderRadius:"md",children:S.jsx(tt,{children:"WebGL component error. Please refresh the page."})}):this.props.children}}const rk=document.getElementById("root");if(rk){const n=rk.getAttribute("data-space-id"),e=rk.getAttribute("data-theme")||"default",i=()=>{const[o,l]=k.useState(null);return k.useEffect(()=>{YC(e).then(l);const u=()=>{document.hidden||YC(e).then(l)};return document.addEventListener("visibilitychange",u),()=>{document.removeEventListener("visibilitychange",u)}},[]),o?S.jsx(Y1,{theme:o,children:S.jsx(FN,{children:S.jsx(T3,{children:S.jsxs(Fr,{spacing:4,align:"stretch",children:[S.jsxs(Cr,{justify:"space-between",align:"center",p:4,bg:"gray.700",m:0,position:"relative",zIndex:"100",children:[S.jsx(tt,{fontSize:"xl",fontWeight:"bold",color:"white",children:"LOGO"}),S.jsx(ct,{zIndex:"100",position:"relative",children:S.jsx(nae,{})})]}),S.jsx(NV,{maxW:"container.xl",p:0,zIndex:"1",children:S.jsx(dne,{ratio:16/9,bg:"blue.100",m:0,children:S.jsx(ct,{id:"webgl-root","data-space-id":n,w:"100%",m:0,children:S.jsx(RHe,{children:S.jsx(x3,{spaceID:n})})})})}),S.jsx(NV,{maxW:"container.xl",p:0,children:S.jsx(Lae,{spaceID:n})})]})})})}):S.jsx("div",{children:"Loading theme..."})};P1.createRoot(rk).render(S.jsx(i,{}))}else console.error("Root element 'root' not found.");export{UEe as a,l0e as b,Yi as c,o0e as d,AHe as e,IHe as f,QSe as g,Ku as i,sp as m,aIe as t};
