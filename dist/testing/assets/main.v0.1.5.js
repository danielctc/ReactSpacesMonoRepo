function iEe(n,e){for(var i=0;i<e.length;i++){const o=e[i];if(typeof o!="string"&&!Array.isArray(o)){for(const l in o)if(l!=="default"&&!(l in n)){const d=Object.getOwnPropertyDescriptor(o,l);d&&Object.defineProperty(n,l,d.get?d:{enumerable:!0,get:()=>o[l]})}}}return Object.freeze(Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}))}var wy=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Bg(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var gM={exports:{}},yw={},_M={exports:{}},Sr={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var CK;function sEe(){if(CK)return Sr;CK=1;var n=Symbol.for("react.element"),e=Symbol.for("react.portal"),i=Symbol.for("react.fragment"),o=Symbol.for("react.strict_mode"),l=Symbol.for("react.profiler"),d=Symbol.for("react.provider"),p=Symbol.for("react.context"),_=Symbol.for("react.forward_ref"),E=Symbol.for("react.suspense"),b=Symbol.for("react.memo"),C=Symbol.for("react.lazy"),I=Symbol.iterator;function O(Te){return Te===null||typeof Te!="object"?null:(Te=I&&Te[I]||Te["@@iterator"],typeof Te=="function"?Te:null)}var L={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},U=Object.assign,B={};function W(Te,be,Pe){this.props=Te,this.context=be,this.refs=B,this.updater=Pe||L}W.prototype.isReactComponent={},W.prototype.setState=function(Te,be){if(typeof Te!="object"&&typeof Te!="function"&&Te!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,Te,be,"setState")},W.prototype.forceUpdate=function(Te){this.updater.enqueueForceUpdate(this,Te,"forceUpdate")};function J(){}J.prototype=W.prototype;function $(Te,be,Pe){this.props=Te,this.context=be,this.refs=B,this.updater=Pe||L}var ie=$.prototype=new J;ie.constructor=$,U(ie,W.prototype),ie.isPureReactComponent=!0;var ce=Array.isArray,ne=Object.prototype.hasOwnProperty,de={current:null},Q={key:!0,ref:!0,__self:!0,__source:!0};function Z(Te,be,Pe){var Le,ze={},Je=null,et=null;if(be!=null)for(Le in be.ref!==void 0&&(et=be.ref),be.key!==void 0&&(Je=""+be.key),be)ne.call(be,Le)&&!Q.hasOwnProperty(Le)&&(ze[Le]=be[Le]);var ut=arguments.length-2;if(ut===1)ze.children=Pe;else if(1<ut){for(var rt=Array(ut),It=0;It<ut;It++)rt[It]=arguments[It+2];ze.children=rt}if(Te&&Te.defaultProps)for(Le in ut=Te.defaultProps,ut)ze[Le]===void 0&&(ze[Le]=ut[Le]);return{$$typeof:n,type:Te,key:Je,ref:et,props:ze,_owner:de.current}}function X(Te,be){return{$$typeof:n,type:Te.type,key:be,ref:Te.ref,props:Te.props,_owner:Te._owner}}function re(Te){return typeof Te=="object"&&Te!==null&&Te.$$typeof===n}function pe(Te){var be={"=":"=0",":":"=2"};return"$"+Te.replace(/[=:]/g,function(Pe){return be[Pe]})}var he=/\/+/g;function ue(Te,be){return typeof Te=="object"&&Te!==null&&Te.key!=null?pe(""+Te.key):be.toString(36)}function xe(Te,be,Pe,Le,ze){var Je=typeof Te;(Je==="undefined"||Je==="boolean")&&(Te=null);var et=!1;if(Te===null)et=!0;else switch(Je){case"string":case"number":et=!0;break;case"object":switch(Te.$$typeof){case n:case e:et=!0}}if(et)return et=Te,ze=ze(et),Te=Le===""?"."+ue(et,0):Le,ce(ze)?(Pe="",Te!=null&&(Pe=Te.replace(he,"$&/")+"/"),xe(ze,be,Pe,"",function(It){return It})):ze!=null&&(re(ze)&&(ze=X(ze,Pe+(!ze.key||et&&et.key===ze.key?"":(""+ze.key).replace(he,"$&/")+"/")+Te)),be.push(ze)),1;if(et=0,Le=Le===""?".":Le+":",ce(Te))for(var ut=0;ut<Te.length;ut++){Je=Te[ut];var rt=Le+ue(Je,ut);et+=xe(Je,be,Pe,rt,ze)}else if(rt=O(Te),typeof rt=="function")for(Te=rt.call(Te),ut=0;!(Je=Te.next()).done;)Je=Je.value,rt=Le+ue(Je,ut++),et+=xe(Je,be,Pe,rt,ze);else if(Je==="object")throw be=String(Te),Error("Objects are not valid as a React child (found: "+(be==="[object Object]"?"object with keys {"+Object.keys(Te).join(", ")+"}":be)+"). If you meant to render a collection of children, use an array instead.");return et}function We(Te,be,Pe){if(Te==null)return Te;var Le=[],ze=0;return xe(Te,Le,"","",function(Je){return be.call(Pe,Je,ze++)}),Le}function $e(Te){if(Te._status===-1){var be=Te._result;be=be(),be.then(function(Pe){(Te._status===0||Te._status===-1)&&(Te._status=1,Te._result=Pe)},function(Pe){(Te._status===0||Te._status===-1)&&(Te._status=2,Te._result=Pe)}),Te._status===-1&&(Te._status=0,Te._result=be)}if(Te._status===1)return Te._result.default;throw Te._result}var ve={current:null},_e={transition:null},Ee={ReactCurrentDispatcher:ve,ReactCurrentBatchConfig:_e,ReactCurrentOwner:de};function ke(){throw Error("act(...) is not supported in production builds of React.")}return Sr.Children={map:We,forEach:function(Te,be,Pe){We(Te,function(){be.apply(this,arguments)},Pe)},count:function(Te){var be=0;return We(Te,function(){be++}),be},toArray:function(Te){return We(Te,function(be){return be})||[]},only:function(Te){if(!re(Te))throw Error("React.Children.only expected to receive a single React element child.");return Te}},Sr.Component=W,Sr.Fragment=i,Sr.Profiler=l,Sr.PureComponent=$,Sr.StrictMode=o,Sr.Suspense=E,Sr.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Ee,Sr.act=ke,Sr.cloneElement=function(Te,be,Pe){if(Te==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+Te+".");var Le=U({},Te.props),ze=Te.key,Je=Te.ref,et=Te._owner;if(be!=null){if(be.ref!==void 0&&(Je=be.ref,et=de.current),be.key!==void 0&&(ze=""+be.key),Te.type&&Te.type.defaultProps)var ut=Te.type.defaultProps;for(rt in be)ne.call(be,rt)&&!Q.hasOwnProperty(rt)&&(Le[rt]=be[rt]===void 0&&ut!==void 0?ut[rt]:be[rt])}var rt=arguments.length-2;if(rt===1)Le.children=Pe;else if(1<rt){ut=Array(rt);for(var It=0;It<rt;It++)ut[It]=arguments[It+2];Le.children=ut}return{$$typeof:n,type:Te.type,key:ze,ref:Je,props:Le,_owner:et}},Sr.createContext=function(Te){return Te={$$typeof:p,_currentValue:Te,_currentValue2:Te,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},Te.Provider={$$typeof:d,_context:Te},Te.Consumer=Te},Sr.createElement=Z,Sr.createFactory=function(Te){var be=Z.bind(null,Te);return be.type=Te,be},Sr.createRef=function(){return{current:null}},Sr.forwardRef=function(Te){return{$$typeof:_,render:Te}},Sr.isValidElement=re,Sr.lazy=function(Te){return{$$typeof:C,_payload:{_status:-1,_result:Te},_init:$e}},Sr.memo=function(Te,be){return{$$typeof:b,type:Te,compare:be===void 0?null:be}},Sr.startTransition=function(Te){var be=_e.transition;_e.transition={};try{Te()}finally{_e.transition=be}},Sr.unstable_act=ke,Sr.useCallback=function(Te,be){return ve.current.useCallback(Te,be)},Sr.useContext=function(Te){return ve.current.useContext(Te)},Sr.useDebugValue=function(){},Sr.useDeferredValue=function(Te){return ve.current.useDeferredValue(Te)},Sr.useEffect=function(Te,be){return ve.current.useEffect(Te,be)},Sr.useId=function(){return ve.current.useId()},Sr.useImperativeHandle=function(Te,be,Pe){return ve.current.useImperativeHandle(Te,be,Pe)},Sr.useInsertionEffect=function(Te,be){return ve.current.useInsertionEffect(Te,be)},Sr.useLayoutEffect=function(Te,be){return ve.current.useLayoutEffect(Te,be)},Sr.useMemo=function(Te,be){return ve.current.useMemo(Te,be)},Sr.useReducer=function(Te,be,Pe){return ve.current.useReducer(Te,be,Pe)},Sr.useRef=function(Te){return ve.current.useRef(Te)},Sr.useState=function(Te){return ve.current.useState(Te)},Sr.useSyncExternalStore=function(Te,be,Pe){return ve.current.useSyncExternalStore(Te,be,Pe)},Sr.useTransition=function(){return ve.current.useTransition()},Sr.version="18.3.1",Sr}var RK;function Wu(){return RK||(RK=1,_M.exports=sEe()),_M.exports}/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var IK;function oEe(){if(IK)return yw;IK=1;var n=Wu(),e=Symbol.for("react.element"),i=Symbol.for("react.fragment"),o=Object.prototype.hasOwnProperty,l=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,d={key:!0,ref:!0,__self:!0,__source:!0};function p(_,E,b){var C,I={},O=null,L=null;b!==void 0&&(O=""+b),E.key!==void 0&&(O=""+E.key),E.ref!==void 0&&(L=E.ref);for(C in E)o.call(E,C)&&!d.hasOwnProperty(C)&&(I[C]=E[C]);if(_&&_.defaultProps)for(C in E=_.defaultProps,E)I[C]===void 0&&(I[C]=E[C]);return{$$typeof:e,type:_,key:O,ref:L,props:I,_owner:l.current}}return yw.Fragment=i,yw.jsx=p,yw.jsxs=p,yw}var AK;function aEe(){return AK||(AK=1,gM.exports=oEe()),gM.exports}var w=aEe(),N=Wu();const mi=Bg(N),PK=iEe({__proto__:null,default:mi},[N]);var _O={},yM={exports:{}},il={},EM={exports:{}},vM={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var OK;function cEe(){return OK||(OK=1,function(n){function e(_e,Ee){var ke=_e.length;_e.push(Ee);e:for(;0<ke;){var Te=ke-1>>>1,be=_e[Te];if(0<l(be,Ee))_e[Te]=Ee,_e[ke]=be,ke=Te;else break e}}function i(_e){return _e.length===0?null:_e[0]}function o(_e){if(_e.length===0)return null;var Ee=_e[0],ke=_e.pop();if(ke!==Ee){_e[0]=ke;e:for(var Te=0,be=_e.length,Pe=be>>>1;Te<Pe;){var Le=2*(Te+1)-1,ze=_e[Le],Je=Le+1,et=_e[Je];if(0>l(ze,ke))Je<be&&0>l(et,ze)?(_e[Te]=et,_e[Je]=ke,Te=Je):(_e[Te]=ze,_e[Le]=ke,Te=Le);else if(Je<be&&0>l(et,ke))_e[Te]=et,_e[Je]=ke,Te=Je;else break e}}return Ee}function l(_e,Ee){var ke=_e.sortIndex-Ee.sortIndex;return ke!==0?ke:_e.id-Ee.id}if(typeof performance=="object"&&typeof performance.now=="function"){var d=performance;n.unstable_now=function(){return d.now()}}else{var p=Date,_=p.now();n.unstable_now=function(){return p.now()-_}}var E=[],b=[],C=1,I=null,O=3,L=!1,U=!1,B=!1,W=typeof setTimeout=="function"?setTimeout:null,J=typeof clearTimeout=="function"?clearTimeout:null,$=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function ie(_e){for(var Ee=i(b);Ee!==null;){if(Ee.callback===null)o(b);else if(Ee.startTime<=_e)o(b),Ee.sortIndex=Ee.expirationTime,e(E,Ee);else break;Ee=i(b)}}function ce(_e){if(B=!1,ie(_e),!U)if(i(E)!==null)U=!0,$e(ne);else{var Ee=i(b);Ee!==null&&ve(ce,Ee.startTime-_e)}}function ne(_e,Ee){U=!1,B&&(B=!1,J(Z),Z=-1),L=!0;var ke=O;try{for(ie(Ee),I=i(E);I!==null&&(!(I.expirationTime>Ee)||_e&&!pe());){var Te=I.callback;if(typeof Te=="function"){I.callback=null,O=I.priorityLevel;var be=Te(I.expirationTime<=Ee);Ee=n.unstable_now(),typeof be=="function"?I.callback=be:I===i(E)&&o(E),ie(Ee)}else o(E);I=i(E)}if(I!==null)var Pe=!0;else{var Le=i(b);Le!==null&&ve(ce,Le.startTime-Ee),Pe=!1}return Pe}finally{I=null,O=ke,L=!1}}var de=!1,Q=null,Z=-1,X=5,re=-1;function pe(){return!(n.unstable_now()-re<X)}function he(){if(Q!==null){var _e=n.unstable_now();re=_e;var Ee=!0;try{Ee=Q(!0,_e)}finally{Ee?ue():(de=!1,Q=null)}}else de=!1}var ue;if(typeof $=="function")ue=function(){$(he)};else if(typeof MessageChannel<"u"){var xe=new MessageChannel,We=xe.port2;xe.port1.onmessage=he,ue=function(){We.postMessage(null)}}else ue=function(){W(he,0)};function $e(_e){Q=_e,de||(de=!0,ue())}function ve(_e,Ee){Z=W(function(){_e(n.unstable_now())},Ee)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(_e){_e.callback=null},n.unstable_continueExecution=function(){U||L||(U=!0,$e(ne))},n.unstable_forceFrameRate=function(_e){0>_e||125<_e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):X=0<_e?Math.floor(1e3/_e):5},n.unstable_getCurrentPriorityLevel=function(){return O},n.unstable_getFirstCallbackNode=function(){return i(E)},n.unstable_next=function(_e){switch(O){case 1:case 2:case 3:var Ee=3;break;default:Ee=O}var ke=O;O=Ee;try{return _e()}finally{O=ke}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=function(){},n.unstable_runWithPriority=function(_e,Ee){switch(_e){case 1:case 2:case 3:case 4:case 5:break;default:_e=3}var ke=O;O=_e;try{return Ee()}finally{O=ke}},n.unstable_scheduleCallback=function(_e,Ee,ke){var Te=n.unstable_now();switch(typeof ke=="object"&&ke!==null?(ke=ke.delay,ke=typeof ke=="number"&&0<ke?Te+ke:Te):ke=Te,_e){case 1:var be=-1;break;case 2:be=250;break;case 5:be=1073741823;break;case 4:be=1e4;break;default:be=5e3}return be=ke+be,_e={id:C++,callback:Ee,priorityLevel:_e,startTime:ke,expirationTime:be,sortIndex:-1},ke>Te?(_e.sortIndex=ke,e(b,_e),i(E)===null&&_e===i(b)&&(B?(J(Z),Z=-1):B=!0,ve(ce,ke-Te))):(_e.sortIndex=be,e(E,_e),U||L||(U=!0,$e(ne))),_e},n.unstable_shouldYield=pe,n.unstable_wrapCallback=function(_e){var Ee=O;return function(){var ke=O;O=Ee;try{return _e.apply(this,arguments)}finally{O=ke}}}}(vM)),vM}var kK;function lEe(){return kK||(kK=1,EM.exports=cEe()),EM.exports}/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var NK;function uEe(){if(NK)return il;NK=1;var n=Wu(),e=lEe();function i(f){for(var g="https://reactjs.org/docs/error-decoder.html?invariant="+f,T=1;T<arguments.length;T++)g+="&args[]="+encodeURIComponent(arguments[T]);return"Minified React error #"+f+"; visit "+g+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var o=new Set,l={};function d(f,g){p(f,g),p(f+"Capture",g)}function p(f,g){for(l[f]=g,f=0;f<g.length;f++)o.add(g[f])}var _=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),E=Object.prototype.hasOwnProperty,b=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,C={},I={};function O(f){return E.call(I,f)?!0:E.call(C,f)?!1:b.test(f)?I[f]=!0:(C[f]=!0,!1)}function L(f,g,T,k){if(T!==null&&T.type===0)return!1;switch(typeof g){case"function":case"symbol":return!0;case"boolean":return k?!1:T!==null?!T.acceptsBooleans:(f=f.toLowerCase().slice(0,5),f!=="data-"&&f!=="aria-");default:return!1}}function U(f,g,T,k){if(g===null||typeof g>"u"||L(f,g,T,k))return!0;if(k)return!1;if(T!==null)switch(T.type){case 3:return!g;case 4:return g===!1;case 5:return isNaN(g);case 6:return isNaN(g)||1>g}return!1}function B(f,g,T,k,V,H,le){this.acceptsBooleans=g===2||g===3||g===4,this.attributeName=k,this.attributeNamespace=V,this.mustUseProperty=T,this.propertyName=f,this.type=g,this.sanitizeURL=H,this.removeEmptyString=le}var W={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(f){W[f]=new B(f,0,!1,f,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(f){var g=f[0];W[g]=new B(g,1,!1,f[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(f){W[f]=new B(f,2,!1,f.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(f){W[f]=new B(f,2,!1,f,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(f){W[f]=new B(f,3,!1,f.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(f){W[f]=new B(f,3,!0,f,null,!1,!1)}),["capture","download"].forEach(function(f){W[f]=new B(f,4,!1,f,null,!1,!1)}),["cols","rows","size","span"].forEach(function(f){W[f]=new B(f,6,!1,f,null,!1,!1)}),["rowSpan","start"].forEach(function(f){W[f]=new B(f,5,!1,f.toLowerCase(),null,!1,!1)});var J=/[\-:]([a-z])/g;function $(f){return f[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(f){var g=f.replace(J,$);W[g]=new B(g,1,!1,f,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(f){var g=f.replace(J,$);W[g]=new B(g,1,!1,f,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(f){var g=f.replace(J,$);W[g]=new B(g,1,!1,f,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(f){W[f]=new B(f,1,!1,f.toLowerCase(),null,!1,!1)}),W.xlinkHref=new B("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(f){W[f]=new B(f,1,!1,f.toLowerCase(),null,!0,!0)});function ie(f,g,T,k){var V=W.hasOwnProperty(g)?W[g]:null;(V!==null?V.type!==0:k||!(2<g.length)||g[0]!=="o"&&g[0]!=="O"||g[1]!=="n"&&g[1]!=="N")&&(U(g,T,V,k)&&(T=null),k||V===null?O(g)&&(T===null?f.removeAttribute(g):f.setAttribute(g,""+T)):V.mustUseProperty?f[V.propertyName]=T===null?V.type===3?!1:"":T:(g=V.attributeName,k=V.attributeNamespace,T===null?f.removeAttribute(g):(V=V.type,T=V===3||V===4&&T===!0?"":""+T,k?f.setAttributeNS(k,g,T):f.setAttribute(g,T))))}var ce=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,ne=Symbol.for("react.element"),de=Symbol.for("react.portal"),Q=Symbol.for("react.fragment"),Z=Symbol.for("react.strict_mode"),X=Symbol.for("react.profiler"),re=Symbol.for("react.provider"),pe=Symbol.for("react.context"),he=Symbol.for("react.forward_ref"),ue=Symbol.for("react.suspense"),xe=Symbol.for("react.suspense_list"),We=Symbol.for("react.memo"),$e=Symbol.for("react.lazy"),ve=Symbol.for("react.offscreen"),_e=Symbol.iterator;function Ee(f){return f===null||typeof f!="object"?null:(f=_e&&f[_e]||f["@@iterator"],typeof f=="function"?f:null)}var ke=Object.assign,Te;function be(f){if(Te===void 0)try{throw Error()}catch(T){var g=T.stack.trim().match(/\n( *(at )?)/);Te=g&&g[1]||""}return`
`+Te+f}var Pe=!1;function Le(f,g){if(!f||Pe)return"";Pe=!0;var T=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(g)if(g=function(){throw Error()},Object.defineProperty(g.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(g,[])}catch(it){var k=it}Reflect.construct(f,[],g)}else{try{g.call()}catch(it){k=it}f.call(g.prototype)}else{try{throw Error()}catch(it){k=it}f()}}catch(it){if(it&&k&&typeof it.stack=="string"){for(var V=it.stack.split(`
`),H=k.stack.split(`
`),le=V.length-1,Ie=H.length-1;1<=le&&0<=Ie&&V[le]!==H[Ie];)Ie--;for(;1<=le&&0<=Ie;le--,Ie--)if(V[le]!==H[Ie]){if(le!==1||Ie!==1)do if(le--,Ie--,0>Ie||V[le]!==H[Ie]){var Ue=`
`+V[le].replace(" at new "," at ");return f.displayName&&Ue.includes("<anonymous>")&&(Ue=Ue.replace("<anonymous>",f.displayName)),Ue}while(1<=le&&0<=Ie);break}}}finally{Pe=!1,Error.prepareStackTrace=T}return(f=f?f.displayName||f.name:"")?be(f):""}function ze(f){switch(f.tag){case 5:return be(f.type);case 16:return be("Lazy");case 13:return be("Suspense");case 19:return be("SuspenseList");case 0:case 2:case 15:return f=Le(f.type,!1),f;case 11:return f=Le(f.type.render,!1),f;case 1:return f=Le(f.type,!0),f;default:return""}}function Je(f){if(f==null)return null;if(typeof f=="function")return f.displayName||f.name||null;if(typeof f=="string")return f;switch(f){case Q:return"Fragment";case de:return"Portal";case X:return"Profiler";case Z:return"StrictMode";case ue:return"Suspense";case xe:return"SuspenseList"}if(typeof f=="object")switch(f.$$typeof){case pe:return(f.displayName||"Context")+".Consumer";case re:return(f._context.displayName||"Context")+".Provider";case he:var g=f.render;return f=f.displayName,f||(f=g.displayName||g.name||"",f=f!==""?"ForwardRef("+f+")":"ForwardRef"),f;case We:return g=f.displayName||null,g!==null?g:Je(f.type)||"Memo";case $e:g=f._payload,f=f._init;try{return Je(f(g))}catch{}}return null}function et(f){var g=f.type;switch(f.tag){case 24:return"Cache";case 9:return(g.displayName||"Context")+".Consumer";case 10:return(g._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return f=g.render,f=f.displayName||f.name||"",g.displayName||(f!==""?"ForwardRef("+f+")":"ForwardRef");case 7:return"Fragment";case 5:return g;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Je(g);case 8:return g===Z?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof g=="function")return g.displayName||g.name||null;if(typeof g=="string")return g}return null}function ut(f){switch(typeof f){case"boolean":case"number":case"string":case"undefined":return f;case"object":return f;default:return""}}function rt(f){var g=f.type;return(f=f.nodeName)&&f.toLowerCase()==="input"&&(g==="checkbox"||g==="radio")}function It(f){var g=rt(f)?"checked":"value",T=Object.getOwnPropertyDescriptor(f.constructor.prototype,g),k=""+f[g];if(!f.hasOwnProperty(g)&&typeof T<"u"&&typeof T.get=="function"&&typeof T.set=="function"){var V=T.get,H=T.set;return Object.defineProperty(f,g,{configurable:!0,get:function(){return V.call(this)},set:function(le){k=""+le,H.call(this,le)}}),Object.defineProperty(f,g,{enumerable:T.enumerable}),{getValue:function(){return k},setValue:function(le){k=""+le},stopTracking:function(){f._valueTracker=null,delete f[g]}}}}function pn(f){f._valueTracker||(f._valueTracker=It(f))}function Ft(f){if(!f)return!1;var g=f._valueTracker;if(!g)return!0;var T=g.getValue(),k="";return f&&(k=rt(f)?f.checked?"true":"false":f.value),f=k,f!==T?(g.setValue(f),!0):!1}function an(f){if(f=f||(typeof document<"u"?document:void 0),typeof f>"u")return null;try{return f.activeElement||f.body}catch{return f.body}}function en(f,g){var T=g.checked;return ke({},g,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:T??f._wrapperState.initialChecked})}function Xt(f,g){var T=g.defaultValue==null?"":g.defaultValue,k=g.checked!=null?g.checked:g.defaultChecked;T=ut(g.value!=null?g.value:T),f._wrapperState={initialChecked:k,initialValue:T,controlled:g.type==="checkbox"||g.type==="radio"?g.checked!=null:g.value!=null}}function Vn(f,g){g=g.checked,g!=null&&ie(f,"checked",g,!1)}function Kt(f,g){Vn(f,g);var T=ut(g.value),k=g.type;if(T!=null)k==="number"?(T===0&&f.value===""||f.value!=T)&&(f.value=""+T):f.value!==""+T&&(f.value=""+T);else if(k==="submit"||k==="reset"){f.removeAttribute("value");return}g.hasOwnProperty("value")?Ve(f,g.type,T):g.hasOwnProperty("defaultValue")&&Ve(f,g.type,ut(g.defaultValue)),g.checked==null&&g.defaultChecked!=null&&(f.defaultChecked=!!g.defaultChecked)}function Re(f,g,T){if(g.hasOwnProperty("value")||g.hasOwnProperty("defaultValue")){var k=g.type;if(!(k!=="submit"&&k!=="reset"||g.value!==void 0&&g.value!==null))return;g=""+f._wrapperState.initialValue,T||g===f.value||(f.value=g),f.defaultValue=g}T=f.name,T!==""&&(f.name=""),f.defaultChecked=!!f._wrapperState.initialChecked,T!==""&&(f.name=T)}function Ve(f,g,T){(g!=="number"||an(f.ownerDocument)!==f)&&(T==null?f.defaultValue=""+f._wrapperState.initialValue:f.defaultValue!==""+T&&(f.defaultValue=""+T))}var Ge=Array.isArray;function ft(f,g,T,k){if(f=f.options,g){g={};for(var V=0;V<T.length;V++)g["$"+T[V]]=!0;for(T=0;T<f.length;T++)V=g.hasOwnProperty("$"+f[T].value),f[T].selected!==V&&(f[T].selected=V),V&&k&&(f[T].defaultSelected=!0)}else{for(T=""+ut(T),g=null,V=0;V<f.length;V++){if(f[V].value===T){f[V].selected=!0,k&&(f[V].defaultSelected=!0);return}g!==null||f[V].disabled||(g=f[V])}g!==null&&(g.selected=!0)}}function gt(f,g){if(g.dangerouslySetInnerHTML!=null)throw Error(i(91));return ke({},g,{value:void 0,defaultValue:void 0,children:""+f._wrapperState.initialValue})}function St(f,g){var T=g.value;if(T==null){if(T=g.children,g=g.defaultValue,T!=null){if(g!=null)throw Error(i(92));if(Ge(T)){if(1<T.length)throw Error(i(93));T=T[0]}g=T}g==null&&(g=""),T=g}f._wrapperState={initialValue:ut(T)}}function Wt(f,g){var T=ut(g.value),k=ut(g.defaultValue);T!=null&&(T=""+T,T!==f.value&&(f.value=T),g.defaultValue==null&&f.defaultValue!==T&&(f.defaultValue=T)),k!=null&&(f.defaultValue=""+k)}function mn(f){var g=f.textContent;g===f._wrapperState.initialValue&&g!==""&&g!==null&&(f.value=g)}function vn(f){switch(f){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function tn(f,g){return f==null||f==="http://www.w3.org/1999/xhtml"?vn(g):f==="http://www.w3.org/2000/svg"&&g==="foreignObject"?"http://www.w3.org/1999/xhtml":f}var vt,nr=function(f){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(g,T,k,V){MSApp.execUnsafeLocalFunction(function(){return f(g,T,k,V)})}:f}(function(f,g){if(f.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in f)f.innerHTML=g;else{for(vt=vt||document.createElement("div"),vt.innerHTML="<svg>"+g.valueOf().toString()+"</svg>",g=vt.firstChild;f.firstChild;)f.removeChild(f.firstChild);for(;g.firstChild;)f.appendChild(g.firstChild)}});function Dt(f,g){if(g){var T=f.firstChild;if(T&&T===f.lastChild&&T.nodeType===3){T.nodeValue=g;return}}f.textContent=g}var Ut={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},gn=["Webkit","ms","Moz","O"];Object.keys(Ut).forEach(function(f){gn.forEach(function(g){g=g+f.charAt(0).toUpperCase()+f.substring(1),Ut[g]=Ut[f]})});function Li(f,g,T){return g==null||typeof g=="boolean"||g===""?"":T||typeof g!="number"||g===0||Ut.hasOwnProperty(f)&&Ut[f]?(""+g).trim():g+"px"}function Es(f,g){f=f.style;for(var T in g)if(g.hasOwnProperty(T)){var k=T.indexOf("--")===0,V=Li(T,g[T],k);T==="float"&&(T="cssFloat"),k?f.setProperty(T,V):f[T]=V}}var ci=ke({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function qo(f,g){if(g){if(ci[f]&&(g.children!=null||g.dangerouslySetInnerHTML!=null))throw Error(i(137,f));if(g.dangerouslySetInnerHTML!=null){if(g.children!=null)throw Error(i(60));if(typeof g.dangerouslySetInnerHTML!="object"||!("__html"in g.dangerouslySetInnerHTML))throw Error(i(61))}if(g.style!=null&&typeof g.style!="object")throw Error(i(62))}}function ic(f,g){if(f.indexOf("-")===-1)return typeof g.is=="string";switch(f){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Xs=null;function Js(f){return f=f.target||f.srcElement||window,f.correspondingUseElement&&(f=f.correspondingUseElement),f.nodeType===3?f.parentNode:f}var Ac=null,vs=null,Ia=null;function Po(f){if(f=Em(f)){if(typeof Ac!="function")throw Error(i(280));var g=f.stateNode;g&&(g=vm(g),Ac(f.stateNode,f.type,g))}}function Aa(f){vs?Ia?Ia.push(f):Ia=[f]:vs=f}function sc(){if(vs){var f=vs,g=Ia;if(Ia=vs=null,Po(f),g)for(f=0;f<g.length;f++)Po(g[f])}}function ml(f,g){return f(g)}function Pa(){}var oc=!1;function lo(f,g,T){if(oc)return f(g,T);oc=!0;try{return ml(f,g,T)}finally{oc=!1,(vs!==null||Ia!==null)&&(Pa(),sc())}}function Mi(f,g){var T=f.stateNode;if(T===null)return null;var k=vm(T);if(k===null)return null;T=k[g];e:switch(g){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(k=!k.disabled)||(f=f.type,k=!(f==="button"||f==="input"||f==="select"||f==="textarea")),f=!k;break e;default:f=!1}if(f)return null;if(T&&typeof T!="function")throw Error(i(231,g,typeof T));return T}var _t=!1;if(_)try{var hn={};Object.defineProperty(hn,"passive",{get:function(){_t=!0}}),window.addEventListener("test",hn,hn),window.removeEventListener("test",hn,hn)}catch{_t=!1}function yr(f,g,T,k,V,H,le,Ie,Ue){var it=Array.prototype.slice.call(arguments,3);try{g.apply(T,it)}catch(Ot){this.onError(Ot)}}var _i=!1,Oo=null,uo=!1,Xl=null,Tf={onError:function(f){_i=!0,Oo=f}};function gl(f,g,T,k,V,H,le,Ie,Ue){_i=!1,Oo=null,yr.apply(Tf,arguments)}function Jl(f,g,T,k,V,H,le,Ie,Ue){if(gl.apply(this,arguments),_i){if(_i){var it=Oo;_i=!1,Oo=null}else throw Error(i(198));uo||(uo=!0,Xl=it)}}function Ri(f){var g=f,T=f;if(f.alternate)for(;g.return;)g=g.return;else{f=g;do g=f,(g.flags&4098)!==0&&(T=g.return),f=g.return;while(f)}return g.tag===3?T:null}function ho(f){if(f.tag===13){var g=f.memoizedState;if(g===null&&(f=f.alternate,f!==null&&(g=f.memoizedState)),g!==null)return g.dehydrated}return null}function zi(f){if(Ri(f)!==f)throw Error(i(188))}function $d(f){var g=f.alternate;if(!g){if(g=Ri(f),g===null)throw Error(i(188));return g!==f?null:f}for(var T=f,k=g;;){var V=T.return;if(V===null)break;var H=V.alternate;if(H===null){if(k=V.return,k!==null){T=k;continue}break}if(V.child===H.child){for(H=V.child;H;){if(H===T)return zi(V),f;if(H===k)return zi(V),g;H=H.sibling}throw Error(i(188))}if(T.return!==k.return)T=V,k=H;else{for(var le=!1,Ie=V.child;Ie;){if(Ie===T){le=!0,T=V,k=H;break}if(Ie===k){le=!0,k=V,T=H;break}Ie=Ie.sibling}if(!le){for(Ie=H.child;Ie;){if(Ie===T){le=!0,T=H,k=V;break}if(Ie===k){le=!0,k=H,T=V;break}Ie=Ie.sibling}if(!le)throw Error(i(189))}}if(T.alternate!==k)throw Error(i(190))}if(T.tag!==3)throw Error(i(188));return T.stateNode.current===T?f:g}function Kd(f){return f=$d(f),f!==null?ac(f):null}function ac(f){if(f.tag===5||f.tag===6)return f;for(f=f.child;f!==null;){var g=ac(f);if(g!==null)return g;f=f.sibling}return null}var qd=e.unstable_scheduleCallback,$u=e.unstable_cancelCallback,Yo=e.unstable_shouldYield,Yd=e.unstable_requestPaint,qr=e.unstable_now,Ii=e.unstable_getCurrentPriorityLevel,Pc=e.unstable_ImmediatePriority,_l=e.unstable_UserBlockingPriority,Oa=e.unstable_NormalPriority,wf=e.unstable_LowPriority,Xd=e.unstable_IdlePriority,Ql=null,ko=null;function im(f){if(ko&&typeof ko.onCommitFiberRoot=="function")try{ko.onCommitFiberRoot(Ql,f,void 0,(f.current.flags&128)===128)}catch{}}var fo=Math.clz32?Math.clz32:Jd,Cf=Math.log,yl=Math.LN2;function Jd(f){return f>>>=0,f===0?32:31-(Cf(f)/yl|0)|0}var Qd=64,Er=4194304;function Zl(f){switch(f&-f){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return f&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return f&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return f}}function eu(f,g){var T=f.pendingLanes;if(T===0)return 0;var k=0,V=f.suspendedLanes,H=f.pingedLanes,le=T&268435455;if(le!==0){var Ie=le&~V;Ie!==0?k=Zl(Ie):(H&=le,H!==0&&(k=Zl(H)))}else le=T&~V,le!==0?k=Zl(le):H!==0&&(k=Zl(H));if(k===0)return 0;if(g!==0&&g!==k&&(g&V)===0&&(V=k&-k,H=g&-g,V>=H||V===16&&(H&4194240)!==0))return g;if((k&4)!==0&&(k|=T&16),g=f.entangledLanes,g!==0)for(f=f.entanglements,g&=k;0<g;)T=31-fo(g),V=1<<T,k|=f[T],g&=~V;return k}function Ku(f,g){switch(f){case 1:case 2:case 4:return g+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return g+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function cc(f,g){for(var T=f.suspendedLanes,k=f.pingedLanes,V=f.expirationTimes,H=f.pendingLanes;0<H;){var le=31-fo(H),Ie=1<<le,Ue=V[le];Ue===-1?((Ie&T)===0||(Ie&k)!==0)&&(V[le]=Ku(Ie,g)):Ue<=g&&(f.expiredLanes|=Ie),H&=~Ie}}function Xo(f){return f=f.pendingLanes&-1073741825,f!==0?f:f&1073741824?1073741824:0}function qu(){var f=Qd;return Qd<<=1,(Qd&4194240)===0&&(Qd=64),f}function El(f){for(var g=[],T=0;31>T;T++)g.push(f);return g}function tu(f,g,T){f.pendingLanes|=g,g!==536870912&&(f.suspendedLanes=0,f.pingedLanes=0),f=f.eventTimes,g=31-fo(g),f[g]=T}function Zr(f,g){var T=f.pendingLanes&~g;f.pendingLanes=g,f.suspendedLanes=0,f.pingedLanes=0,f.expiredLanes&=g,f.mutableReadLanes&=g,f.entangledLanes&=g,g=f.entanglements;var k=f.eventTimes;for(f=f.expirationTimes;0<T;){var V=31-fo(T),H=1<<V;g[V]=0,k[V]=-1,f[V]=-1,T&=~H}}function lc(f,g){var T=f.entangledLanes|=g;for(f=f.entanglements;T;){var k=31-fo(T),V=1<<k;V&g|f[k]&g&&(f[k]|=g),T&=~V}}var cr=0;function Oc(f){return f&=-f,1<f?4<f?(f&268435455)!==0?16:536870912:4:1}var sm,nu,Zd,Rf,om,If=!1,Jo=[],hs=null,Qo=null,Zo=null,ru=new Map,ea=new Map,ta=[],am="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function kc(f,g){switch(f){case"focusin":case"focusout":hs=null;break;case"dragenter":case"dragleave":Qo=null;break;case"mouseover":case"mouseout":Zo=null;break;case"pointerover":case"pointerout":ru.delete(g.pointerId);break;case"gotpointercapture":case"lostpointercapture":ea.delete(g.pointerId)}}function Ss(f,g,T,k,V,H){return f===null||f.nativeEvent!==H?(f={blockedOn:g,domEventName:T,eventSystemFlags:k,nativeEvent:H,targetContainers:[V]},g!==null&&(g=Em(g),g!==null&&nu(g)),f):(f.eventSystemFlags|=k,g=f.targetContainers,V!==null&&g.indexOf(V)===-1&&g.push(V),f)}function Yu(f,g,T,k,V){switch(g){case"focusin":return hs=Ss(hs,f,g,T,k,V),!0;case"dragenter":return Qo=Ss(Qo,f,g,T,k,V),!0;case"mouseover":return Zo=Ss(Zo,f,g,T,k,V),!0;case"pointerover":var H=V.pointerId;return ru.set(H,Ss(ru.get(H)||null,f,g,T,k,V)),!0;case"gotpointercapture":return H=V.pointerId,ea.set(H,Ss(ea.get(H)||null,f,g,T,k,V)),!0}return!1}function Af(f){var g=Mf(f.target);if(g!==null){var T=Ri(g);if(T!==null){if(g=T.tag,g===13){if(g=ho(T),g!==null){f.blockedOn=g,om(f.priority,function(){Zd(T)});return}}else if(g===3&&T.stateNode.current.memoizedState.isDehydrated){f.blockedOn=T.tag===3?T.stateNode.containerInfo:null;return}}}f.blockedOn=null}function vl(f){if(f.blockedOn!==null)return!1;for(var g=f.targetContainers;0<g.length;){var T=Rr(f.domEventName,f.eventSystemFlags,g[0],f.nativeEvent);if(T===null){T=f.nativeEvent;var k=new T.constructor(T.type,T);Xs=k,T.target.dispatchEvent(k),Xs=null}else return g=Em(T),g!==null&&nu(g),f.blockedOn=T,!1;g.shift()}return!0}function iu(f,g,T){vl(f)&&T.delete(g)}function cm(){If=!1,hs!==null&&vl(hs)&&(hs=null),Qo!==null&&vl(Qo)&&(Qo=null),Zo!==null&&vl(Zo)&&(Zo=null),ru.forEach(iu),ea.forEach(iu)}function ka(f,g){f.blockedOn===g&&(f.blockedOn=null,If||(If=!0,e.unstable_scheduleCallback(e.unstable_NormalPriority,cm)))}function Na(f){function g(V){return ka(V,f)}if(0<Jo.length){ka(Jo[0],f);for(var T=1;T<Jo.length;T++){var k=Jo[T];k.blockedOn===f&&(k.blockedOn=null)}}for(hs!==null&&ka(hs,f),Qo!==null&&ka(Qo,f),Zo!==null&&ka(Zo,f),ru.forEach(g),ea.forEach(g),T=0;T<ta.length;T++)k=ta[T],k.blockedOn===f&&(k.blockedOn=null);for(;0<ta.length&&(T=ta[0],T.blockedOn===null);)Af(T),T.blockedOn===null&&ta.shift()}var Sl=ce.ReactCurrentBatchConfig,Ce=!0;function De(f,g,T,k){var V=cr,H=Sl.transition;Sl.transition=null;try{cr=1,Qt(f,g,T,k)}finally{cr=V,Sl.transition=H}}function nt(f,g,T,k){var V=cr,H=Sl.transition;Sl.transition=null;try{cr=4,Qt(f,g,T,k)}finally{cr=V,Sl.transition=H}}function Qt(f,g,T,k){if(Ce){var V=Rr(f,g,T,k);if(V===null)_E(f,g,k,Qn,T),kc(f,k);else if(Yu(V,f,g,T,k))k.stopPropagation();else if(kc(f,k),g&4&&-1<am.indexOf(f)){for(;V!==null;){var H=Em(V);if(H!==null&&sm(H),H=Rr(f,g,T,k),H===null&&_E(f,g,k,Qn,T),H===V)break;V=H}V!==null&&k.stopPropagation()}else _E(f,g,k,null,T)}}var Qn=null;function Rr(f,g,T,k){if(Qn=null,f=Js(k),f=Mf(f),f!==null)if(g=Ri(f),g===null)f=null;else if(T=g.tag,T===13){if(f=ho(g),f!==null)return f;f=null}else if(T===3){if(g.stateNode.current.memoizedState.isDehydrated)return g.tag===3?g.stateNode.containerInfo:null;f=null}else g!==f&&(f=null);return Qn=f,null}function Yr(f){switch(f){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Ii()){case Pc:return 1;case _l:return 4;case Oa:case wf:return 16;case Xd:return 536870912;default:return 16}default:return 16}}var fn=null,Wr=null,Ai=null;function Vs(){if(Ai)return Ai;var f,g=Wr,T=g.length,k,V="value"in fn?fn.value:fn.textContent,H=V.length;for(f=0;f<T&&g[f]===V[f];f++);var le=T-f;for(k=1;k<=le&&g[T-k]===V[H-k];k++);return Ai=V.slice(f,1<k?1-k:void 0)}function na(f){var g=f.keyCode;return"charCode"in f?(f=f.charCode,f===0&&g===13&&(f=13)):f=g,f===10&&(f=13),32<=f||f===13?f:0}function ra(){return!0}function Xu(){return!1}function os(f){function g(T,k,V,H,le){this._reactName=T,this._targetInst=V,this.type=k,this.nativeEvent=H,this.target=le,this.currentTarget=null;for(var Ie in f)f.hasOwnProperty(Ie)&&(T=f[Ie],this[Ie]=T?T(H):H[Ie]);return this.isDefaultPrevented=(H.defaultPrevented!=null?H.defaultPrevented:H.returnValue===!1)?ra:Xu,this.isPropagationStopped=Xu,this}return ke(g.prototype,{preventDefault:function(){this.defaultPrevented=!0;var T=this.nativeEvent;T&&(T.preventDefault?T.preventDefault():typeof T.returnValue!="unknown"&&(T.returnValue=!1),this.isDefaultPrevented=ra)},stopPropagation:function(){var T=this.nativeEvent;T&&(T.stopPropagation?T.stopPropagation():typeof T.cancelBubble!="unknown"&&(T.cancelBubble=!0),this.isPropagationStopped=ra)},persist:function(){},isPersistent:ra}),g}var bl={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(f){return f.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},eh=os(bl),Nc=ke({},bl,{view:0,detail:0}),qg=os(Nc),lm,Ju,ia,su=ke({},Nc,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Dc,button:0,buttons:0,relatedTarget:function(f){return f.relatedTarget===void 0?f.fromElement===f.srcElement?f.toElement:f.fromElement:f.relatedTarget},movementX:function(f){return"movementX"in f?f.movementX:(f!==ia&&(ia&&f.type==="mousemove"?(lm=f.screenX-ia.screenX,Ju=f.screenY-ia.screenY):Ju=lm=0,ia=f),lm)},movementY:function(f){return"movementY"in f?f.movementY:Ju}}),um=os(su),Yg=ke({},su,{dataTransfer:0}),lE=os(Yg),dm=ke({},Nc,{relatedTarget:0}),hm=os(dm),Qu=ke({},bl,{animationName:0,elapsedTime:0,pseudoElement:0}),Zu=os(Qu),ed=ke({},bl,{clipboardData:function(f){return"clipboardData"in f?f.clipboardData:window.clipboardData}}),Xg=os(ed),uE=ke({},bl,{data:0}),zn=os(uE),fm={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},sa={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},dE={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function hE(f){var g=this.nativeEvent;return g.getModifierState?g.getModifierState(f):(f=dE[f])?!!g[f]:!1}function Dc(){return hE}var A=ke({},Nc,{key:function(f){if(f.key){var g=fm[f.key]||f.key;if(g!=="Unidentified")return g}return f.type==="keypress"?(f=na(f),f===13?"Enter":String.fromCharCode(f)):f.type==="keydown"||f.type==="keyup"?sa[f.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Dc,charCode:function(f){return f.type==="keypress"?na(f):0},keyCode:function(f){return f.type==="keydown"||f.type==="keyup"?f.keyCode:0},which:function(f){return f.type==="keypress"?na(f):f.type==="keydown"||f.type==="keyup"?f.keyCode:0}}),z=os(A),se=ke({},su,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),ge=os(se),qe=ke({},Nc,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Dc}),at=os(qe),Vt=ke({},bl,{propertyName:0,elapsedTime:0,pseudoElement:0}),ei=os(Vt),yi=ke({},su,{deltaX:function(f){return"deltaX"in f?f.deltaX:"wheelDeltaX"in f?-f.wheelDeltaX:0},deltaY:function(f){return"deltaY"in f?f.deltaY:"wheelDeltaY"in f?-f.wheelDeltaY:"wheelDelta"in f?-f.wheelDelta:0},deltaZ:0,deltaMode:0}),Ir=os(yi),Qs=[9,13,27,32],bs=_&&"CompositionEvent"in window,uc=null;_&&"documentMode"in document&&(uc=document.documentMode);var oa=_&&"TextEvent"in window&&!uc,Pf=_&&(!bs||uc&&8<uc&&11>=uc),pm=" ",dc=!1;function NR(f,g){switch(f){case"keyup":return Qs.indexOf(g.keyCode)!==-1;case"keydown":return g.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function DR(f){return f=f.detail,typeof f=="object"&&"data"in f?f.data:null}var mm=!1;function HN(f,g){switch(f){case"compositionend":return DR(g);case"keypress":return g.which!==32?null:(dc=!0,pm);case"textInput":return f=g.data,f===pm&&dc?null:f;default:return null}}function xR(f,g){if(mm)return f==="compositionend"||!bs&&NR(f,g)?(f=Vs(),Ai=Wr=fn=null,mm=!1,f):null;switch(f){case"paste":return null;case"keypress":if(!(g.ctrlKey||g.altKey||g.metaKey)||g.ctrlKey&&g.altKey){if(g.char&&1<g.char.length)return g.char;if(g.which)return String.fromCharCode(g.which)}return null;case"compositionend":return Pf&&g.locale!=="ko"?null:g.data;default:return null}}var $N={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function LR(f){var g=f&&f.nodeName&&f.nodeName.toLowerCase();return g==="input"?!!$N[f.type]:g==="textarea"}function nb(f,g,T,k){Aa(k),g=yE(g,"onChange"),0<g.length&&(T=new eh("onChange","change",null,T,k),f.push({event:T,listeners:g}))}var Of=null,Jg=null;function KN(f){lb(f,0)}function kf(f){var g=Uf(f);if(Ft(g))return f}function qN(f,g){if(f==="change")return g}var MR=!1;if(_){var rb;if(_){var xc="oninput"in document;if(!xc){var UR=document.createElement("div");UR.setAttribute("oninput","return;"),xc=typeof UR.oninput=="function"}rb=xc}else rb=!1;MR=rb&&(!document.documentMode||9<document.documentMode)}function VR(){Of&&(Of.detachEvent("onpropertychange",Da),Jg=Of=null)}function Da(f){if(f.propertyName==="value"&&kf(Jg)){var g=[];nb(g,Jg,f,Js(f)),lo(KN,g)}}function YN(f,g,T){f==="focusin"?(VR(),Of=g,Jg=T,Of.attachEvent("onpropertychange",Da)):f==="focusout"&&VR()}function XN(f){if(f==="selectionchange"||f==="keyup"||f==="keydown")return kf(Jg)}function JN(f,g){if(f==="click")return kf(g)}function QN(f,g){if(f==="input"||f==="change")return kf(g)}function FR(f,g){return f===g&&(f!==0||1/f===1/g)||f!==f&&g!==g}var Tl=typeof Object.is=="function"?Object.is:FR;function Qg(f,g){if(Tl(f,g))return!0;if(typeof f!="object"||f===null||typeof g!="object"||g===null)return!1;var T=Object.keys(f),k=Object.keys(g);if(T.length!==k.length)return!1;for(k=0;k<T.length;k++){var V=T[k];if(!E.call(g,V)||!Tl(f[V],g[V]))return!1}return!0}function jR(f){for(;f&&f.firstChild;)f=f.firstChild;return f}function ib(f,g){var T=jR(f);f=0;for(var k;T;){if(T.nodeType===3){if(k=f+T.textContent.length,f<=g&&k>=g)return{node:T,offset:g-f};f=k}e:{for(;T;){if(T.nextSibling){T=T.nextSibling;break e}T=T.parentNode}T=void 0}T=jR(T)}}function BR(f,g){return f&&g?f===g?!0:f&&f.nodeType===3?!1:g&&g.nodeType===3?BR(f,g.parentNode):"contains"in f?f.contains(g):f.compareDocumentPosition?!!(f.compareDocumentPosition(g)&16):!1:!1}function WR(){for(var f=window,g=an();g instanceof f.HTMLIFrameElement;){try{var T=typeof g.contentWindow.location.href=="string"}catch{T=!1}if(T)f=g.contentWindow;else break;g=an(f.document)}return g}function Zg(f){var g=f&&f.nodeName&&f.nodeName.toLowerCase();return g&&(g==="input"&&(f.type==="text"||f.type==="search"||f.type==="tel"||f.type==="url"||f.type==="password")||g==="textarea"||f.contentEditable==="true")}function sb(f){var g=WR(),T=f.focusedElem,k=f.selectionRange;if(g!==T&&T&&T.ownerDocument&&BR(T.ownerDocument.documentElement,T)){if(k!==null&&Zg(T)){if(g=k.start,f=k.end,f===void 0&&(f=g),"selectionStart"in T)T.selectionStart=g,T.selectionEnd=Math.min(f,T.value.length);else if(f=(g=T.ownerDocument||document)&&g.defaultView||window,f.getSelection){f=f.getSelection();var V=T.textContent.length,H=Math.min(k.start,V);k=k.end===void 0?H:Math.min(k.end,V),!f.extend&&H>k&&(V=k,k=H,H=V),V=ib(T,H);var le=ib(T,k);V&&le&&(f.rangeCount!==1||f.anchorNode!==V.node||f.anchorOffset!==V.offset||f.focusNode!==le.node||f.focusOffset!==le.offset)&&(g=g.createRange(),g.setStart(V.node,V.offset),f.removeAllRanges(),H>k?(f.addRange(g),f.extend(le.node,le.offset)):(g.setEnd(le.node,le.offset),f.addRange(g)))}}for(g=[],f=T;f=f.parentNode;)f.nodeType===1&&g.push({element:f,left:f.scrollLeft,top:f.scrollTop});for(typeof T.focus=="function"&&T.focus(),T=0;T<g.length;T++)f=g[T],f.element.scrollLeft=f.left,f.element.scrollTop=f.top}}var ZN=_&&"documentMode"in document&&11>=document.documentMode,ot=null,ob=null,e_=null,ab=!1;function zR(f,g,T){var k=T.window===T?T.document:T.nodeType===9?T:T.ownerDocument;ab||ot==null||ot!==an(k)||(k=ot,"selectionStart"in k&&Zg(k)?k={start:k.selectionStart,end:k.selectionEnd}:(k=(k.ownerDocument&&k.ownerDocument.defaultView||window).getSelection(),k={anchorNode:k.anchorNode,anchorOffset:k.anchorOffset,focusNode:k.focusNode,focusOffset:k.focusOffset}),e_&&Qg(e_,k)||(e_=k,k=yE(ob,"onSelect"),0<k.length&&(g=new eh("onSelect","select",null,g,T),f.push({event:g,listeners:k}),g.target=ot)))}function fE(f,g){var T={};return T[f.toLowerCase()]=g.toLowerCase(),T["Webkit"+f]="webkit"+g,T["Moz"+f]="moz"+g,T}var gm={animationend:fE("Animation","AnimationEnd"),animationiteration:fE("Animation","AnimationIteration"),animationstart:fE("Animation","AnimationStart"),transitionend:fE("Transition","TransitionEnd")},cb={},GR={};_&&(GR=document.createElement("div").style,"AnimationEvent"in window||(delete gm.animationend.animation,delete gm.animationiteration.animation,delete gm.animationstart.animation),"TransitionEvent"in window||delete gm.transitionend.transition);function Nf(f){if(cb[f])return cb[f];if(!gm[f])return f;var g=gm[f],T;for(T in g)if(g.hasOwnProperty(T)&&T in GR)return cb[f]=g[T];return f}var Df=Nf("animationend"),HR=Nf("animationiteration"),$R=Nf("animationstart"),KR=Nf("transitionend"),qR=new Map,pE="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function th(f,g){qR.set(f,g),d(g,[f])}for(var mE=0;mE<pE.length;mE++){var hc=pE[mE],eD=hc.toLowerCase(),t_=hc[0].toUpperCase()+hc.slice(1);th(eD,"on"+t_)}th(Df,"onAnimationEnd"),th(HR,"onAnimationIteration"),th($R,"onAnimationStart"),th("dblclick","onDoubleClick"),th("focusin","onFocus"),th("focusout","onBlur"),th(KR,"onTransitionEnd"),p("onMouseEnter",["mouseout","mouseover"]),p("onMouseLeave",["mouseout","mouseover"]),p("onPointerEnter",["pointerout","pointerover"]),p("onPointerLeave",["pointerout","pointerover"]),d("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),d("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),d("onBeforeInput",["compositionend","keypress","textInput","paste"]),d("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),d("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),d("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var n_="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),tD=new Set("cancel close invalid load scroll toggle".split(" ").concat(n_));function YR(f,g,T){var k=f.type||"unknown-event";f.currentTarget=T,Jl(k,g,void 0,f),f.currentTarget=null}function lb(f,g){g=(g&4)!==0;for(var T=0;T<f.length;T++){var k=f[T],V=k.event;k=k.listeners;e:{var H=void 0;if(g)for(var le=k.length-1;0<=le;le--){var Ie=k[le],Ue=Ie.instance,it=Ie.currentTarget;if(Ie=Ie.listener,Ue!==H&&V.isPropagationStopped())break e;YR(V,Ie,it),H=Ue}else for(le=0;le<k.length;le++){if(Ie=k[le],Ue=Ie.instance,it=Ie.currentTarget,Ie=Ie.listener,Ue!==H&&V.isPropagationStopped())break e;YR(V,Ie,it),H=Ue}}}if(uo)throw f=Xl,uo=!1,Xl=null,f}function Ui(f,g){var T=g[o_];T===void 0&&(T=g[o_]=new Set);var k=f+"__bubble";T.has(k)||(XR(g,f,2,!1),T.add(k))}function ub(f,g,T){var k=0;g&&(k|=4),XR(T,f,k,g)}var gE="_reactListening"+Math.random().toString(36).slice(2);function xf(f){if(!f[gE]){f[gE]=!0,o.forEach(function(T){T!=="selectionchange"&&(tD.has(T)||ub(T,!1,f),ub(T,!0,f))});var g=f.nodeType===9?f:f.ownerDocument;g===null||g[gE]||(g[gE]=!0,ub("selectionchange",!1,g))}}function XR(f,g,T,k){switch(Yr(g)){case 1:var V=De;break;case 4:V=nt;break;default:V=Qt}T=V.bind(null,g,T,f),V=void 0,!_t||g!=="touchstart"&&g!=="touchmove"&&g!=="wheel"||(V=!0),k?V!==void 0?f.addEventListener(g,T,{capture:!0,passive:V}):f.addEventListener(g,T,!0):V!==void 0?f.addEventListener(g,T,{passive:V}):f.addEventListener(g,T,!1)}function _E(f,g,T,k,V){var H=k;if((g&1)===0&&(g&2)===0&&k!==null)e:for(;;){if(k===null)return;var le=k.tag;if(le===3||le===4){var Ie=k.stateNode.containerInfo;if(Ie===V||Ie.nodeType===8&&Ie.parentNode===V)break;if(le===4)for(le=k.return;le!==null;){var Ue=le.tag;if((Ue===3||Ue===4)&&(Ue=le.stateNode.containerInfo,Ue===V||Ue.nodeType===8&&Ue.parentNode===V))return;le=le.return}for(;Ie!==null;){if(le=Mf(Ie),le===null)return;if(Ue=le.tag,Ue===5||Ue===6){k=H=le;continue e}Ie=Ie.parentNode}}k=k.return}lo(function(){var it=H,Ot=Js(T),kt=[];e:{var Pt=qR.get(f);if(Pt!==void 0){var Yt=eh,sn=f;switch(f){case"keypress":if(na(T)===0)break e;case"keydown":case"keyup":Yt=z;break;case"focusin":sn="focus",Yt=hm;break;case"focusout":sn="blur",Yt=hm;break;case"beforeblur":case"afterblur":Yt=hm;break;case"click":if(T.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Yt=um;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Yt=lE;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Yt=at;break;case Df:case HR:case $R:Yt=Zu;break;case KR:Yt=ei;break;case"scroll":Yt=qg;break;case"wheel":Yt=Ir;break;case"copy":case"cut":case"paste":Yt=Xg;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Yt=ge}var on=(g&4)!==0,cs=!on&&f==="scroll",Xe=on?Pt!==null?Pt+"Capture":null:Pt;on=[];for(var Fe=it,tt;Fe!==null;){tt=Fe;var Lt=tt.stateNode;if(tt.tag===5&&Lt!==null&&(tt=Lt,Xe!==null&&(Lt=Mi(Fe,Xe),Lt!=null&&on.push(_m(Fe,Lt,tt)))),cs)break;Fe=Fe.return}0<on.length&&(Pt=new Yt(Pt,sn,null,T,Ot),kt.push({event:Pt,listeners:on}))}}if((g&7)===0){e:{if(Pt=f==="mouseover"||f==="pointerover",Yt=f==="mouseout"||f==="pointerout",Pt&&T!==Xs&&(sn=T.relatedTarget||T.fromElement)&&(Mf(sn)||sn[Lc]))break e;if((Yt||Pt)&&(Pt=Ot.window===Ot?Ot:(Pt=Ot.ownerDocument)?Pt.defaultView||Pt.parentWindow:window,Yt?(sn=T.relatedTarget||T.toElement,Yt=it,sn=sn?Mf(sn):null,sn!==null&&(cs=Ri(sn),sn!==cs||sn.tag!==5&&sn.tag!==6)&&(sn=null)):(Yt=null,sn=it),Yt!==sn)){if(on=um,Lt="onMouseLeave",Xe="onMouseEnter",Fe="mouse",(f==="pointerout"||f==="pointerover")&&(on=ge,Lt="onPointerLeave",Xe="onPointerEnter",Fe="pointer"),cs=Yt==null?Pt:Uf(Yt),tt=sn==null?Pt:Uf(sn),Pt=new on(Lt,Fe+"leave",Yt,T,Ot),Pt.target=cs,Pt.relatedTarget=tt,Lt=null,Mf(Ot)===it&&(on=new on(Xe,Fe+"enter",sn,T,Ot),on.target=tt,on.relatedTarget=cs,Lt=on),cs=Lt,Yt&&sn)t:{for(on=Yt,Xe=sn,Fe=0,tt=on;tt;tt=Lf(tt))Fe++;for(tt=0,Lt=Xe;Lt;Lt=Lf(Lt))tt++;for(;0<Fe-tt;)on=Lf(on),Fe--;for(;0<tt-Fe;)Xe=Lf(Xe),tt--;for(;Fe--;){if(on===Xe||Xe!==null&&on===Xe.alternate)break t;on=Lf(on),Xe=Lf(Xe)}on=null}else on=null;Yt!==null&&r_(kt,Pt,Yt,on,!1),sn!==null&&cs!==null&&r_(kt,cs,sn,on,!0)}}e:{if(Pt=it?Uf(it):window,Yt=Pt.nodeName&&Pt.nodeName.toLowerCase(),Yt==="select"||Yt==="input"&&Pt.type==="file")var cn=qN;else if(LR(Pt))if(MR)cn=QN;else{cn=XN;var Sn=YN}else(Yt=Pt.nodeName)&&Yt.toLowerCase()==="input"&&(Pt.type==="checkbox"||Pt.type==="radio")&&(cn=JN);if(cn&&(cn=cn(f,it))){nb(kt,cn,T,Ot);break e}Sn&&Sn(f,Pt,it),f==="focusout"&&(Sn=Pt._wrapperState)&&Sn.controlled&&Pt.type==="number"&&Ve(Pt,"number",Pt.value)}switch(Sn=it?Uf(it):window,f){case"focusin":(LR(Sn)||Sn.contentEditable==="true")&&(ot=Sn,ob=it,e_=null);break;case"focusout":e_=ob=ot=null;break;case"mousedown":ab=!0;break;case"contextmenu":case"mouseup":case"dragend":ab=!1,zR(kt,T,Ot);break;case"selectionchange":if(ZN)break;case"keydown":case"keyup":zR(kt,T,Ot)}var Rn;if(bs)e:{switch(f){case"compositionstart":var Fn="onCompositionStart";break e;case"compositionend":Fn="onCompositionEnd";break e;case"compositionupdate":Fn="onCompositionUpdate";break e}Fn=void 0}else mm?NR(f,T)&&(Fn="onCompositionEnd"):f==="keydown"&&T.keyCode===229&&(Fn="onCompositionStart");Fn&&(Pf&&T.locale!=="ko"&&(mm||Fn!=="onCompositionStart"?Fn==="onCompositionEnd"&&mm&&(Rn=Vs()):(fn=Ot,Wr="value"in fn?fn.value:fn.textContent,mm=!0)),Sn=yE(it,Fn),0<Sn.length&&(Fn=new zn(Fn,f,null,T,Ot),kt.push({event:Fn,listeners:Sn}),Rn?Fn.data=Rn:(Rn=DR(T),Rn!==null&&(Fn.data=Rn)))),(Rn=oa?HN(f,T):xR(f,T))&&(it=yE(it,"onBeforeInput"),0<it.length&&(Ot=new zn("onBeforeInput","beforeinput",null,T,Ot),kt.push({event:Ot,listeners:it}),Ot.data=Rn))}lb(kt,g)})}function _m(f,g,T){return{instance:f,listener:g,currentTarget:T}}function yE(f,g){for(var T=g+"Capture",k=[];f!==null;){var V=f,H=V.stateNode;V.tag===5&&H!==null&&(V=H,H=Mi(f,T),H!=null&&k.unshift(_m(f,H,V)),H=Mi(f,g),H!=null&&k.push(_m(f,H,V))),f=f.return}return k}function Lf(f){if(f===null)return null;do f=f.return;while(f&&f.tag!==5);return f||null}function r_(f,g,T,k,V){for(var H=g._reactName,le=[];T!==null&&T!==k;){var Ie=T,Ue=Ie.alternate,it=Ie.stateNode;if(Ue!==null&&Ue===k)break;Ie.tag===5&&it!==null&&(Ie=it,V?(Ue=Mi(T,H),Ue!=null&&le.unshift(_m(T,Ue,Ie))):V||(Ue=Mi(T,H),Ue!=null&&le.push(_m(T,Ue,Ie)))),T=T.return}le.length!==0&&f.push({event:g,listeners:le})}var nD=/\r\n?/g,rD=/\u0000|\uFFFD/g;function JR(f){return(typeof f=="string"?f:""+f).replace(nD,`
`).replace(rD,"")}function EE(f,g,T){if(g=JR(g),JR(f)!==g&&T)throw Error(i(425))}function vE(){}var SE=null,i_=null;function db(f,g){return f==="textarea"||f==="noscript"||typeof g.children=="string"||typeof g.children=="number"||typeof g.dangerouslySetInnerHTML=="object"&&g.dangerouslySetInnerHTML!==null&&g.dangerouslySetInnerHTML.__html!=null}var s_=typeof setTimeout=="function"?setTimeout:void 0,iD=typeof clearTimeout=="function"?clearTimeout:void 0,QR=typeof Promise=="function"?Promise:void 0,sD=typeof queueMicrotask=="function"?queueMicrotask:typeof QR<"u"?function(f){return QR.resolve(null).then(f).catch(oD)}:s_;function oD(f){setTimeout(function(){throw f})}function hb(f,g){var T=g,k=0;do{var V=T.nextSibling;if(f.removeChild(T),V&&V.nodeType===8)if(T=V.data,T==="/$"){if(k===0){f.removeChild(V),Na(g);return}k--}else T!=="$"&&T!=="$?"&&T!=="$!"||k++;T=V}while(T);Na(g)}function nh(f){for(;f!=null;f=f.nextSibling){var g=f.nodeType;if(g===1||g===3)break;if(g===8){if(g=f.data,g==="$"||g==="$!"||g==="$?")break;if(g==="/$")return null}}return f}function ZR(f){f=f.previousSibling;for(var g=0;f;){if(f.nodeType===8){var T=f.data;if(T==="$"||T==="$!"||T==="$?"){if(g===0)return f;g--}else T==="/$"&&g++}f=f.previousSibling}return null}var ym=Math.random().toString(36).slice(2),ou="__reactFiber$"+ym,rh="__reactProps$"+ym,Lc="__reactContainer$"+ym,o_="__reactEvents$"+ym,aD="__reactListeners$"+ym,cD="__reactHandles$"+ym;function Mf(f){var g=f[ou];if(g)return g;for(var T=f.parentNode;T;){if(g=T[Lc]||T[ou]){if(T=g.alternate,g.child!==null||T!==null&&T.child!==null)for(f=ZR(f);f!==null;){if(T=f[ou])return T;f=ZR(f)}return g}f=T,T=f.parentNode}return null}function Em(f){return f=f[ou]||f[Lc],!f||f.tag!==5&&f.tag!==6&&f.tag!==13&&f.tag!==3?null:f}function Uf(f){if(f.tag===5||f.tag===6)return f.stateNode;throw Error(i(33))}function vm(f){return f[rh]||null}var fb=[],Sm=-1;function Mc(f){return{current:f}}function Vi(f){0>Sm||(f.current=fb[Sm],fb[Sm]=null,Sm--)}function Pi(f,g){Sm++,fb[Sm]=f.current,f.current=g}var ih={},No=Mc(ih),xa=Mc(!1),Vf=ih;function Ff(f,g){var T=f.type.contextTypes;if(!T)return ih;var k=f.stateNode;if(k&&k.__reactInternalMemoizedUnmaskedChildContext===g)return k.__reactInternalMemoizedMaskedChildContext;var V={},H;for(H in T)V[H]=g[H];return k&&(f=f.stateNode,f.__reactInternalMemoizedUnmaskedChildContext=g,f.__reactInternalMemoizedMaskedChildContext=V),V}function La(f){return f=f.childContextTypes,f!=null}function bE(){Vi(xa),Vi(No)}function eI(f,g,T){if(No.current!==ih)throw Error(i(168));Pi(No,g),Pi(xa,T)}function TE(f,g,T){var k=f.stateNode;if(g=g.childContextTypes,typeof k.getChildContext!="function")return T;k=k.getChildContext();for(var V in k)if(!(V in g))throw Error(i(108,et(f)||"Unknown",V));return ke({},T,k)}function wE(f){return f=(f=f.stateNode)&&f.__reactInternalMemoizedMergedChildContext||ih,Vf=No.current,Pi(No,f),Pi(xa,xa.current),!0}function tI(f,g,T){var k=f.stateNode;if(!k)throw Error(i(169));T?(f=TE(f,g,Vf),k.__reactInternalMemoizedMergedChildContext=f,Vi(xa),Vi(No),Pi(No,f)):Vi(xa),Pi(xa,T)}var Uc=null,CE=!1,pb=!1;function nI(f){Uc===null?Uc=[f]:Uc.push(f)}function lD(f){CE=!0,nI(f)}function sh(){if(!pb&&Uc!==null){pb=!0;var f=0,g=cr;try{var T=Uc;for(cr=1;f<T.length;f++){var k=T[f];do k=k(!0);while(k!==null)}Uc=null,CE=!1}catch(V){throw Uc!==null&&(Uc=Uc.slice(f+1)),qd(Pc,sh),V}finally{cr=g,pb=!1}}return null}var bm=[],td=0,a_=null,RE=0,Vc=[],fc=0,jf=null,nd=1,rd="";function id(f,g){bm[td++]=RE,bm[td++]=a_,a_=f,RE=g}function IE(f,g,T){Vc[fc++]=nd,Vc[fc++]=rd,Vc[fc++]=jf,jf=f;var k=nd;f=rd;var V=32-fo(k)-1;k&=~(1<<V),T+=1;var H=32-fo(g)+V;if(30<H){var le=V-V%5;H=(k&(1<<le)-1).toString(32),k>>=le,V-=le,nd=1<<32-fo(g)+V|T<<V|k,rd=H+f}else nd=1<<H|T<<V|k,rd=f}function AE(f){f.return!==null&&(id(f,1),IE(f,1,0))}function c_(f){for(;f===a_;)a_=bm[--td],bm[td]=null,RE=bm[--td],bm[td]=null;for(;f===jf;)jf=Vc[--fc],Vc[fc]=null,rd=Vc[--fc],Vc[fc]=null,nd=Vc[--fc],Vc[fc]=null}var Ma=null,Ua=null,Ei=!1,aa=null;function rI(f,g){var T=gc(5,null,null,0);T.elementType="DELETED",T.stateNode=g,T.return=f,g=f.deletions,g===null?(f.deletions=[T],f.flags|=16):g.push(T)}function iI(f,g){switch(f.tag){case 5:var T=f.type;return g=g.nodeType!==1||T.toLowerCase()!==g.nodeName.toLowerCase()?null:g,g!==null?(f.stateNode=g,Ma=f,Ua=nh(g.firstChild),!0):!1;case 6:return g=f.pendingProps===""||g.nodeType!==3?null:g,g!==null?(f.stateNode=g,Ma=f,Ua=null,!0):!1;case 13:return g=g.nodeType!==8?null:g,g!==null?(T=jf!==null?{id:nd,overflow:rd}:null,f.memoizedState={dehydrated:g,treeContext:T,retryLane:1073741824},T=gc(18,null,null,0),T.stateNode=g,T.return=f,f.child=T,Ma=f,Ua=null,!0):!1;default:return!1}}function PE(f){return(f.mode&1)!==0&&(f.flags&128)===0}function mb(f){if(Ei){var g=Ua;if(g){var T=g;if(!iI(f,g)){if(PE(f))throw Error(i(418));g=nh(T.nextSibling);var k=Ma;g&&iI(f,g)?rI(k,T):(f.flags=f.flags&-4097|2,Ei=!1,Ma=f)}}else{if(PE(f))throw Error(i(418));f.flags=f.flags&-4097|2,Ei=!1,Ma=f}}}function sI(f){for(f=f.return;f!==null&&f.tag!==5&&f.tag!==3&&f.tag!==13;)f=f.return;Ma=f}function l_(f){if(f!==Ma)return!1;if(!Ei)return sI(f),Ei=!0,!1;var g;if((g=f.tag!==3)&&!(g=f.tag!==5)&&(g=f.type,g=g!=="head"&&g!=="body"&&!db(f.type,f.memoizedProps)),g&&(g=Ua)){if(PE(f))throw oI(),Error(i(418));for(;g;)rI(f,g),g=nh(g.nextSibling)}if(sI(f),f.tag===13){if(f=f.memoizedState,f=f!==null?f.dehydrated:null,!f)throw Error(i(317));e:{for(f=f.nextSibling,g=0;f;){if(f.nodeType===8){var T=f.data;if(T==="/$"){if(g===0){Ua=nh(f.nextSibling);break e}g--}else T!=="$"&&T!=="$!"&&T!=="$?"||g++}f=f.nextSibling}Ua=null}}else Ua=Ma?nh(f.stateNode.nextSibling):null;return!0}function oI(){for(var f=Ua;f;)f=nh(f.nextSibling)}function Tm(){Ua=Ma=null,Ei=!1}function gb(f){aa===null?aa=[f]:aa.push(f)}var uD=ce.ReactCurrentBatchConfig;function u_(f,g,T){if(f=T.ref,f!==null&&typeof f!="function"&&typeof f!="object"){if(T._owner){if(T=T._owner,T){if(T.tag!==1)throw Error(i(309));var k=T.stateNode}if(!k)throw Error(i(147,f));var V=k,H=""+f;return g!==null&&g.ref!==null&&typeof g.ref=="function"&&g.ref._stringRef===H?g.ref:(g=function(le){var Ie=V.refs;le===null?delete Ie[H]:Ie[H]=le},g._stringRef=H,g)}if(typeof f!="string")throw Error(i(284));if(!T._owner)throw Error(i(290,f))}return f}function OE(f,g){throw f=Object.prototype.toString.call(g),Error(i(31,f==="[object Object]"?"object with keys {"+Object.keys(g).join(", ")+"}":f))}function _b(f){var g=f._init;return g(f._payload)}function oh(f){function g(Xe,Fe){if(f){var tt=Xe.deletions;tt===null?(Xe.deletions=[Fe],Xe.flags|=16):tt.push(Fe)}}function T(Xe,Fe){if(!f)return null;for(;Fe!==null;)g(Xe,Fe),Fe=Fe.sibling;return null}function k(Xe,Fe){for(Xe=new Map;Fe!==null;)Fe.key!==null?Xe.set(Fe.key,Fe):Xe.set(Fe.index,Fe),Fe=Fe.sibling;return Xe}function V(Xe,Fe){return Xe=hd(Xe,Fe),Xe.index=0,Xe.sibling=null,Xe}function H(Xe,Fe,tt){return Xe.index=tt,f?(tt=Xe.alternate,tt!==null?(tt=tt.index,tt<Fe?(Xe.flags|=2,Fe):tt):(Xe.flags|=2,Fe)):(Xe.flags|=1048576,Fe)}function le(Xe){return f&&Xe.alternate===null&&(Xe.flags|=2),Xe}function Ie(Xe,Fe,tt,Lt){return Fe===null||Fe.tag!==6?(Fe=eT(tt,Xe.mode,Lt),Fe.return=Xe,Fe):(Fe=V(Fe,tt),Fe.return=Xe,Fe)}function Ue(Xe,Fe,tt,Lt){var cn=tt.type;return cn===Q?Ot(Xe,Fe,tt.props.children,Lt,tt.key):Fe!==null&&(Fe.elementType===cn||typeof cn=="object"&&cn!==null&&cn.$$typeof===$e&&_b(cn)===Fe.type)?(Lt=V(Fe,tt.props),Lt.ref=u_(Xe,Fe,tt),Lt.return=Xe,Lt):(Lt=gv(tt.type,tt.key,tt.props,null,Xe.mode,Lt),Lt.ref=u_(Xe,Fe,tt),Lt.return=Xe,Lt)}function it(Xe,Fe,tt,Lt){return Fe===null||Fe.tag!==4||Fe.stateNode.containerInfo!==tt.containerInfo||Fe.stateNode.implementation!==tt.implementation?(Fe=tT(tt,Xe.mode,Lt),Fe.return=Xe,Fe):(Fe=V(Fe,tt.children||[]),Fe.return=Xe,Fe)}function Ot(Xe,Fe,tt,Lt,cn){return Fe===null||Fe.tag!==7?(Fe=Qf(tt,Xe.mode,Lt,cn),Fe.return=Xe,Fe):(Fe=V(Fe,tt),Fe.return=Xe,Fe)}function kt(Xe,Fe,tt){if(typeof Fe=="string"&&Fe!==""||typeof Fe=="number")return Fe=eT(""+Fe,Xe.mode,tt),Fe.return=Xe,Fe;if(typeof Fe=="object"&&Fe!==null){switch(Fe.$$typeof){case ne:return tt=gv(Fe.type,Fe.key,Fe.props,null,Xe.mode,tt),tt.ref=u_(Xe,null,Fe),tt.return=Xe,tt;case de:return Fe=tT(Fe,Xe.mode,tt),Fe.return=Xe,Fe;case $e:var Lt=Fe._init;return kt(Xe,Lt(Fe._payload),tt)}if(Ge(Fe)||Ee(Fe))return Fe=Qf(Fe,Xe.mode,tt,null),Fe.return=Xe,Fe;OE(Xe,Fe)}return null}function Pt(Xe,Fe,tt,Lt){var cn=Fe!==null?Fe.key:null;if(typeof tt=="string"&&tt!==""||typeof tt=="number")return cn!==null?null:Ie(Xe,Fe,""+tt,Lt);if(typeof tt=="object"&&tt!==null){switch(tt.$$typeof){case ne:return tt.key===cn?Ue(Xe,Fe,tt,Lt):null;case de:return tt.key===cn?it(Xe,Fe,tt,Lt):null;case $e:return cn=tt._init,Pt(Xe,Fe,cn(tt._payload),Lt)}if(Ge(tt)||Ee(tt))return cn!==null?null:Ot(Xe,Fe,tt,Lt,null);OE(Xe,tt)}return null}function Yt(Xe,Fe,tt,Lt,cn){if(typeof Lt=="string"&&Lt!==""||typeof Lt=="number")return Xe=Xe.get(tt)||null,Ie(Fe,Xe,""+Lt,cn);if(typeof Lt=="object"&&Lt!==null){switch(Lt.$$typeof){case ne:return Xe=Xe.get(Lt.key===null?tt:Lt.key)||null,Ue(Fe,Xe,Lt,cn);case de:return Xe=Xe.get(Lt.key===null?tt:Lt.key)||null,it(Fe,Xe,Lt,cn);case $e:var Sn=Lt._init;return Yt(Xe,Fe,tt,Sn(Lt._payload),cn)}if(Ge(Lt)||Ee(Lt))return Xe=Xe.get(tt)||null,Ot(Fe,Xe,Lt,cn,null);OE(Fe,Lt)}return null}function sn(Xe,Fe,tt,Lt){for(var cn=null,Sn=null,Rn=Fe,Fn=Fe=0,Is=null;Rn!==null&&Fn<tt.length;Fn++){Rn.index>Fn?(Is=Rn,Rn=null):Is=Rn.sibling;var Ar=Pt(Xe,Rn,tt[Fn],Lt);if(Ar===null){Rn===null&&(Rn=Is);break}f&&Rn&&Ar.alternate===null&&g(Xe,Rn),Fe=H(Ar,Fe,Fn),Sn===null?cn=Ar:Sn.sibling=Ar,Sn=Ar,Rn=Is}if(Fn===tt.length)return T(Xe,Rn),Ei&&id(Xe,Fn),cn;if(Rn===null){for(;Fn<tt.length;Fn++)Rn=kt(Xe,tt[Fn],Lt),Rn!==null&&(Fe=H(Rn,Fe,Fn),Sn===null?cn=Rn:Sn.sibling=Rn,Sn=Rn);return Ei&&id(Xe,Fn),cn}for(Rn=k(Xe,Rn);Fn<tt.length;Fn++)Is=Yt(Rn,Xe,Fn,tt[Fn],Lt),Is!==null&&(f&&Is.alternate!==null&&Rn.delete(Is.key===null?Fn:Is.key),Fe=H(Is,Fe,Fn),Sn===null?cn=Is:Sn.sibling=Is,Sn=Is);return f&&Rn.forEach(function(_h){return g(Xe,_h)}),Ei&&id(Xe,Fn),cn}function on(Xe,Fe,tt,Lt){var cn=Ee(tt);if(typeof cn!="function")throw Error(i(150));if(tt=cn.call(tt),tt==null)throw Error(i(151));for(var Sn=cn=null,Rn=Fe,Fn=Fe=0,Is=null,Ar=tt.next();Rn!==null&&!Ar.done;Fn++,Ar=tt.next()){Rn.index>Fn?(Is=Rn,Rn=null):Is=Rn.sibling;var _h=Pt(Xe,Rn,Ar.value,Lt);if(_h===null){Rn===null&&(Rn=Is);break}f&&Rn&&_h.alternate===null&&g(Xe,Rn),Fe=H(_h,Fe,Fn),Sn===null?cn=_h:Sn.sibling=_h,Sn=_h,Rn=Is}if(Ar.done)return T(Xe,Rn),Ei&&id(Xe,Fn),cn;if(Rn===null){for(;!Ar.done;Fn++,Ar=tt.next())Ar=kt(Xe,Ar.value,Lt),Ar!==null&&(Fe=H(Ar,Fe,Fn),Sn===null?cn=Ar:Sn.sibling=Ar,Sn=Ar);return Ei&&id(Xe,Fn),cn}for(Rn=k(Xe,Rn);!Ar.done;Fn++,Ar=tt.next())Ar=Yt(Rn,Xe,Fn,Ar.value,Lt),Ar!==null&&(f&&Ar.alternate!==null&&Rn.delete(Ar.key===null?Fn:Ar.key),Fe=H(Ar,Fe,Fn),Sn===null?cn=Ar:Sn.sibling=Ar,Sn=Ar);return f&&Rn.forEach(function(RD){return g(Xe,RD)}),Ei&&id(Xe,Fn),cn}function cs(Xe,Fe,tt,Lt){if(typeof tt=="object"&&tt!==null&&tt.type===Q&&tt.key===null&&(tt=tt.props.children),typeof tt=="object"&&tt!==null){switch(tt.$$typeof){case ne:e:{for(var cn=tt.key,Sn=Fe;Sn!==null;){if(Sn.key===cn){if(cn=tt.type,cn===Q){if(Sn.tag===7){T(Xe,Sn.sibling),Fe=V(Sn,tt.props.children),Fe.return=Xe,Xe=Fe;break e}}else if(Sn.elementType===cn||typeof cn=="object"&&cn!==null&&cn.$$typeof===$e&&_b(cn)===Sn.type){T(Xe,Sn.sibling),Fe=V(Sn,tt.props),Fe.ref=u_(Xe,Sn,tt),Fe.return=Xe,Xe=Fe;break e}T(Xe,Sn);break}else g(Xe,Sn);Sn=Sn.sibling}tt.type===Q?(Fe=Qf(tt.props.children,Xe.mode,Lt,tt.key),Fe.return=Xe,Xe=Fe):(Lt=gv(tt.type,tt.key,tt.props,null,Xe.mode,Lt),Lt.ref=u_(Xe,Fe,tt),Lt.return=Xe,Xe=Lt)}return le(Xe);case de:e:{for(Sn=tt.key;Fe!==null;){if(Fe.key===Sn)if(Fe.tag===4&&Fe.stateNode.containerInfo===tt.containerInfo&&Fe.stateNode.implementation===tt.implementation){T(Xe,Fe.sibling),Fe=V(Fe,tt.children||[]),Fe.return=Xe,Xe=Fe;break e}else{T(Xe,Fe);break}else g(Xe,Fe);Fe=Fe.sibling}Fe=tT(tt,Xe.mode,Lt),Fe.return=Xe,Xe=Fe}return le(Xe);case $e:return Sn=tt._init,cs(Xe,Fe,Sn(tt._payload),Lt)}if(Ge(tt))return sn(Xe,Fe,tt,Lt);if(Ee(tt))return on(Xe,Fe,tt,Lt);OE(Xe,tt)}return typeof tt=="string"&&tt!==""||typeof tt=="number"?(tt=""+tt,Fe!==null&&Fe.tag===6?(T(Xe,Fe.sibling),Fe=V(Fe,tt),Fe.return=Xe,Xe=Fe):(T(Xe,Fe),Fe=eT(tt,Xe.mode,Lt),Fe.return=Xe,Xe=Fe),le(Xe)):T(Xe,Fe)}return cs}var wm=oh(!0),aI=oh(!1),kE=Mc(null),d_=null,Cm=null,NE=null;function yb(){NE=Cm=d_=null}function Eb(f){var g=kE.current;Vi(kE),f._currentValue=g}function vb(f,g,T){for(;f!==null;){var k=f.alternate;if((f.childLanes&g)!==g?(f.childLanes|=g,k!==null&&(k.childLanes|=g)):k!==null&&(k.childLanes&g)!==g&&(k.childLanes|=g),f===T)break;f=f.return}}function sd(f,g){d_=f,NE=Cm=null,f=f.dependencies,f!==null&&f.firstContext!==null&&((f.lanes&g)!==0&&(Fa=!0),f.firstContext=null)}function Fc(f){var g=f._currentValue;if(NE!==f)if(f={context:f,memoizedValue:g,next:null},Cm===null){if(d_===null)throw Error(i(308));Cm=f,d_.dependencies={lanes:0,firstContext:f}}else Cm=Cm.next=f;return g}var Bf=null;function Sb(f){Bf===null?Bf=[f]:Bf.push(f)}function cI(f,g,T,k){var V=g.interleaved;return V===null?(T.next=T,Sb(g)):(T.next=V.next,V.next=T),g.interleaved=T,od(f,k)}function od(f,g){f.lanes|=g;var T=f.alternate;for(T!==null&&(T.lanes|=g),T=f,f=f.return;f!==null;)f.childLanes|=g,T=f.alternate,T!==null&&(T.childLanes|=g),T=f,f=f.return;return T.tag===3?T.stateNode:null}var ah=!1;function h_(f){f.updateQueue={baseState:f.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function lI(f,g){f=f.updateQueue,g.updateQueue===f&&(g.updateQueue={baseState:f.baseState,firstBaseUpdate:f.firstBaseUpdate,lastBaseUpdate:f.lastBaseUpdate,shared:f.shared,effects:f.effects})}function au(f,g){return{eventTime:f,lane:g,tag:0,payload:null,callback:null,next:null}}function ch(f,g,T){var k=f.updateQueue;if(k===null)return null;if(k=k.shared,(Dr&2)!==0){var V=k.pending;return V===null?g.next=g:(g.next=V.next,V.next=g),k.pending=g,od(f,T)}return V=k.interleaved,V===null?(g.next=g,Sb(k)):(g.next=V.next,V.next=g),k.interleaved=g,od(f,T)}function f_(f,g,T){if(g=g.updateQueue,g!==null&&(g=g.shared,(T&4194240)!==0)){var k=g.lanes;k&=f.pendingLanes,T|=k,g.lanes=T,lc(f,T)}}function uI(f,g){var T=f.updateQueue,k=f.alternate;if(k!==null&&(k=k.updateQueue,T===k)){var V=null,H=null;if(T=T.firstBaseUpdate,T!==null){do{var le={eventTime:T.eventTime,lane:T.lane,tag:T.tag,payload:T.payload,callback:T.callback,next:null};H===null?V=H=le:H=H.next=le,T=T.next}while(T!==null);H===null?V=H=g:H=H.next=g}else V=H=g;T={baseState:k.baseState,firstBaseUpdate:V,lastBaseUpdate:H,shared:k.shared,effects:k.effects},f.updateQueue=T;return}f=T.lastBaseUpdate,f===null?T.firstBaseUpdate=g:f.next=g,T.lastBaseUpdate=g}function DE(f,g,T,k){var V=f.updateQueue;ah=!1;var H=V.firstBaseUpdate,le=V.lastBaseUpdate,Ie=V.shared.pending;if(Ie!==null){V.shared.pending=null;var Ue=Ie,it=Ue.next;Ue.next=null,le===null?H=it:le.next=it,le=Ue;var Ot=f.alternate;Ot!==null&&(Ot=Ot.updateQueue,Ie=Ot.lastBaseUpdate,Ie!==le&&(Ie===null?Ot.firstBaseUpdate=it:Ie.next=it,Ot.lastBaseUpdate=Ue))}if(H!==null){var kt=V.baseState;le=0,Ot=it=Ue=null,Ie=H;do{var Pt=Ie.lane,Yt=Ie.eventTime;if((k&Pt)===Pt){Ot!==null&&(Ot=Ot.next={eventTime:Yt,lane:0,tag:Ie.tag,payload:Ie.payload,callback:Ie.callback,next:null});e:{var sn=f,on=Ie;switch(Pt=g,Yt=T,on.tag){case 1:if(sn=on.payload,typeof sn=="function"){kt=sn.call(Yt,kt,Pt);break e}kt=sn;break e;case 3:sn.flags=sn.flags&-65537|128;case 0:if(sn=on.payload,Pt=typeof sn=="function"?sn.call(Yt,kt,Pt):sn,Pt==null)break e;kt=ke({},kt,Pt);break e;case 2:ah=!0}}Ie.callback!==null&&Ie.lane!==0&&(f.flags|=64,Pt=V.effects,Pt===null?V.effects=[Ie]:Pt.push(Ie))}else Yt={eventTime:Yt,lane:Pt,tag:Ie.tag,payload:Ie.payload,callback:Ie.callback,next:null},Ot===null?(it=Ot=Yt,Ue=kt):Ot=Ot.next=Yt,le|=Pt;if(Ie=Ie.next,Ie===null){if(Ie=V.shared.pending,Ie===null)break;Pt=Ie,Ie=Pt.next,Pt.next=null,V.lastBaseUpdate=Pt,V.shared.pending=null}}while(!0);if(Ot===null&&(Ue=kt),V.baseState=Ue,V.firstBaseUpdate=it,V.lastBaseUpdate=Ot,g=V.shared.interleaved,g!==null){V=g;do le|=V.lane,V=V.next;while(V!==g)}else H===null&&(V.shared.lanes=0);Kf|=le,f.lanes=le,f.memoizedState=kt}}function dI(f,g,T){if(f=g.effects,g.effects=null,f!==null)for(g=0;g<f.length;g++){var k=f[g],V=k.callback;if(V!==null){if(k.callback=null,k=T,typeof V!="function")throw Error(i(191,V));V.call(k)}}}var p_={},cu=Mc(p_),m_=Mc(p_),Rm=Mc(p_);function Wf(f){if(f===p_)throw Error(i(174));return f}function bb(f,g){switch(Pi(Rm,g),Pi(m_,f),Pi(cu,p_),f=g.nodeType,f){case 9:case 11:g=(g=g.documentElement)?g.namespaceURI:tn(null,"");break;default:f=f===8?g.parentNode:g,g=f.namespaceURI||null,f=f.tagName,g=tn(g,f)}Vi(cu),Pi(cu,g)}function zf(){Vi(cu),Vi(m_),Vi(Rm)}function hI(f){Wf(Rm.current);var g=Wf(cu.current),T=tn(g,f.type);g!==T&&(Pi(m_,f),Pi(cu,T))}function Im(f){m_.current===f&&(Vi(cu),Vi(m_))}var Gi=Mc(0);function lh(f){for(var g=f;g!==null;){if(g.tag===13){var T=g.memoizedState;if(T!==null&&(T=T.dehydrated,T===null||T.data==="$?"||T.data==="$!"))return g}else if(g.tag===19&&g.memoizedProps.revealOrder!==void 0){if((g.flags&128)!==0)return g}else if(g.child!==null){g.child.return=g,g=g.child;continue}if(g===f)break;for(;g.sibling===null;){if(g.return===null||g.return===f)return null;g=g.return}g.sibling.return=g.return,g=g.sibling}return null}var Tb=[];function wb(){for(var f=0;f<Tb.length;f++)Tb[f]._workInProgressVersionPrimary=null;Tb.length=0}var xE=ce.ReactCurrentDispatcher,Cb=ce.ReactCurrentBatchConfig,lu=0,Xi=null,Ts=null,ws=null,Am=!1,g_=!1,__=0,dD=0;function Do(){throw Error(i(321))}function Rb(f,g){if(g===null)return!1;for(var T=0;T<g.length&&T<f.length;T++)if(!Tl(f[T],g[T]))return!1;return!0}function Pm(f,g,T,k,V,H){if(lu=H,Xi=g,g.memoizedState=null,g.updateQueue=null,g.lanes=0,xE.current=f===null||f.memoizedState===null?pD:TI,f=T(k,V),g_){H=0;do{if(g_=!1,__=0,25<=H)throw Error(i(301));H+=1,ws=Ts=null,g.updateQueue=null,xE.current=mD,f=T(k,V)}while(g_)}if(xE.current=VE,g=Ts!==null&&Ts.next!==null,lu=0,ws=Ts=Xi=null,Am=!1,g)throw Error(i(300));return f}function Ib(){var f=__!==0;return __=0,f}function ca(){var f={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return ws===null?Xi.memoizedState=ws=f:ws=ws.next=f,ws}function Va(){if(Ts===null){var f=Xi.alternate;f=f!==null?f.memoizedState:null}else f=Ts.next;var g=ws===null?Xi.memoizedState:ws.next;if(g!==null)ws=g,Ts=f;else{if(f===null)throw Error(i(310));Ts=f,f={memoizedState:Ts.memoizedState,baseState:Ts.baseState,baseQueue:Ts.baseQueue,queue:Ts.queue,next:null},ws===null?Xi.memoizedState=ws=f:ws=ws.next=f}return ws}function uh(f,g){return typeof g=="function"?g(f):g}function Gf(f){var g=Va(),T=g.queue;if(T===null)throw Error(i(311));T.lastRenderedReducer=f;var k=Ts,V=k.baseQueue,H=T.pending;if(H!==null){if(V!==null){var le=V.next;V.next=H.next,H.next=le}k.baseQueue=V=H,T.pending=null}if(V!==null){H=V.next,k=k.baseState;var Ie=le=null,Ue=null,it=H;do{var Ot=it.lane;if((lu&Ot)===Ot)Ue!==null&&(Ue=Ue.next={lane:0,action:it.action,hasEagerState:it.hasEagerState,eagerState:it.eagerState,next:null}),k=it.hasEagerState?it.eagerState:f(k,it.action);else{var kt={lane:Ot,action:it.action,hasEagerState:it.hasEagerState,eagerState:it.eagerState,next:null};Ue===null?(Ie=Ue=kt,le=k):Ue=Ue.next=kt,Xi.lanes|=Ot,Kf|=Ot}it=it.next}while(it!==null&&it!==H);Ue===null?le=k:Ue.next=Ie,Tl(k,g.memoizedState)||(Fa=!0),g.memoizedState=k,g.baseState=le,g.baseQueue=Ue,T.lastRenderedState=k}if(f=T.interleaved,f!==null){V=f;do H=V.lane,Xi.lanes|=H,Kf|=H,V=V.next;while(V!==f)}else V===null&&(T.lanes=0);return[g.memoizedState,T.dispatch]}function Om(f){var g=Va(),T=g.queue;if(T===null)throw Error(i(311));T.lastRenderedReducer=f;var k=T.dispatch,V=T.pending,H=g.memoizedState;if(V!==null){T.pending=null;var le=V=V.next;do H=f(H,le.action),le=le.next;while(le!==V);Tl(H,g.memoizedState)||(Fa=!0),g.memoizedState=H,g.baseQueue===null&&(g.baseState=H),T.lastRenderedState=H}return[H,k]}function fI(){}function Ab(f,g){var T=Xi,k=Va(),V=g(),H=!Tl(k.memoizedState,V);if(H&&(k.memoizedState=V,Fa=!0),k=k.queue,jc(mI.bind(null,T,k,f),[f]),k.getSnapshot!==g||H||ws!==null&&ws.memoizedState.tag&1){if(T.flags|=2048,y_(9,Pb.bind(null,T,k,V,g),void 0,null),Zs===null)throw Error(i(349));(lu&30)!==0||pI(T,g,V)}return V}function pI(f,g,T){f.flags|=16384,f={getSnapshot:g,value:T},g=Xi.updateQueue,g===null?(g={lastEffect:null,stores:null},Xi.updateQueue=g,g.stores=[f]):(T=g.stores,T===null?g.stores=[f]:T.push(f))}function Pb(f,g,T,k){g.value=T,g.getSnapshot=k,gI(g)&&LE(f)}function mI(f,g,T){return T(function(){gI(g)&&LE(f)})}function gI(f){var g=f.getSnapshot;f=f.value;try{var T=g();return!Tl(f,T)}catch{return!0}}function LE(f){var g=od(f,1);g!==null&&Gc(g,f,1,-1)}function ME(f){var g=ca();return typeof f=="function"&&(f=f()),g.memoizedState=g.baseState=f,f={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:uh,lastRenderedState:f},g.queue=f,f=f.dispatch=fD.bind(null,Xi,f),[g.memoizedState,f]}function y_(f,g,T,k){return f={tag:f,create:g,destroy:T,deps:k,next:null},g=Xi.updateQueue,g===null?(g={lastEffect:null,stores:null},Xi.updateQueue=g,g.lastEffect=f.next=f):(T=g.lastEffect,T===null?g.lastEffect=f.next=f:(k=T.next,T.next=f,f.next=k,g.lastEffect=f)),f}function _I(){return Va().memoizedState}function E_(f,g,T,k){var V=ca();Xi.flags|=f,V.memoizedState=y_(1|g,T,void 0,k===void 0?null:k)}function km(f,g,T,k){var V=Va();k=k===void 0?null:k;var H=void 0;if(Ts!==null){var le=Ts.memoizedState;if(H=le.destroy,k!==null&&Rb(k,le.deps)){V.memoizedState=y_(g,T,H,k);return}}Xi.flags|=f,V.memoizedState=y_(1|g,T,H,k)}function yI(f,g){return E_(8390656,8,f,g)}function jc(f,g){return km(2048,8,f,g)}function Hf(f,g){return km(4,2,f,g)}function dh(f,g){return km(4,4,f,g)}function Ob(f,g){if(typeof g=="function")return f=f(),g(f),function(){g(null)};if(g!=null)return f=f(),g.current=f,function(){g.current=null}}function kb(f,g,T){return T=T!=null?T.concat([f]):null,km(4,4,Ob.bind(null,g,f),T)}function ad(){}function UE(f,g){var T=Va();g=g===void 0?null:g;var k=T.memoizedState;return k!==null&&g!==null&&Rb(g,k[1])?k[0]:(T.memoizedState=[f,g],f)}function EI(f,g){var T=Va();g=g===void 0?null:g;var k=T.memoizedState;return k!==null&&g!==null&&Rb(g,k[1])?k[0]:(f=f(),T.memoizedState=[f,g],f)}function Nb(f,g,T){return(lu&21)===0?(f.baseState&&(f.baseState=!1,Fa=!0),f.memoizedState=T):(Tl(T,g)||(T=qu(),Xi.lanes|=T,Kf|=T,f.baseState=!0),g)}function hD(f,g){var T=cr;cr=T!==0&&4>T?T:4,f(!0);var k=Cb.transition;Cb.transition={};try{f(!1),g()}finally{cr=T,Cb.transition=k}}function Db(){return Va().memoizedState}function vI(f,g,T){var k=zc(f);if(T={lane:k,action:T,hasEagerState:!1,eagerState:null,next:null},cd(f))SI(g,T);else if(T=cI(f,g,T,k),T!==null){var V=go();Gc(T,f,k,V),bI(T,g,k)}}function fD(f,g,T){var k=zc(f),V={lane:k,action:T,hasEagerState:!1,eagerState:null,next:null};if(cd(f))SI(g,V);else{var H=f.alternate;if(f.lanes===0&&(H===null||H.lanes===0)&&(H=g.lastRenderedReducer,H!==null))try{var le=g.lastRenderedState,Ie=H(le,T);if(V.hasEagerState=!0,V.eagerState=Ie,Tl(Ie,le)){var Ue=g.interleaved;Ue===null?(V.next=V,Sb(g)):(V.next=Ue.next,Ue.next=V),g.interleaved=V;return}}catch{}finally{}T=cI(f,g,V,k),T!==null&&(V=go(),Gc(T,f,k,V),bI(T,g,k))}}function cd(f){var g=f.alternate;return f===Xi||g!==null&&g===Xi}function SI(f,g){g_=Am=!0;var T=f.pending;T===null?g.next=g:(g.next=T.next,T.next=g),f.pending=g}function bI(f,g,T){if((T&4194240)!==0){var k=g.lanes;k&=f.pendingLanes,T|=k,g.lanes=T,lc(f,T)}}var VE={readContext:Fc,useCallback:Do,useContext:Do,useEffect:Do,useImperativeHandle:Do,useInsertionEffect:Do,useLayoutEffect:Do,useMemo:Do,useReducer:Do,useRef:Do,useState:Do,useDebugValue:Do,useDeferredValue:Do,useTransition:Do,useMutableSource:Do,useSyncExternalStore:Do,useId:Do,unstable_isNewReconciler:!1},pD={readContext:Fc,useCallback:function(f,g){return ca().memoizedState=[f,g===void 0?null:g],f},useContext:Fc,useEffect:yI,useImperativeHandle:function(f,g,T){return T=T!=null?T.concat([f]):null,E_(4194308,4,Ob.bind(null,g,f),T)},useLayoutEffect:function(f,g){return E_(4194308,4,f,g)},useInsertionEffect:function(f,g){return E_(4,2,f,g)},useMemo:function(f,g){var T=ca();return g=g===void 0?null:g,f=f(),T.memoizedState=[f,g],f},useReducer:function(f,g,T){var k=ca();return g=T!==void 0?T(g):g,k.memoizedState=k.baseState=g,f={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:f,lastRenderedState:g},k.queue=f,f=f.dispatch=vI.bind(null,Xi,f),[k.memoizedState,f]},useRef:function(f){var g=ca();return f={current:f},g.memoizedState=f},useState:ME,useDebugValue:ad,useDeferredValue:function(f){return ca().memoizedState=f},useTransition:function(){var f=ME(!1),g=f[0];return f=hD.bind(null,f[1]),ca().memoizedState=f,[g,f]},useMutableSource:function(){},useSyncExternalStore:function(f,g,T){var k=Xi,V=ca();if(Ei){if(T===void 0)throw Error(i(407));T=T()}else{if(T=g(),Zs===null)throw Error(i(349));(lu&30)!==0||pI(k,g,T)}V.memoizedState=T;var H={value:T,getSnapshot:g};return V.queue=H,yI(mI.bind(null,k,H,f),[f]),k.flags|=2048,y_(9,Pb.bind(null,k,H,T,g),void 0,null),T},useId:function(){var f=ca(),g=Zs.identifierPrefix;if(Ei){var T=rd,k=nd;T=(k&~(1<<32-fo(k)-1)).toString(32)+T,g=":"+g+"R"+T,T=__++,0<T&&(g+="H"+T.toString(32)),g+=":"}else T=dD++,g=":"+g+"r"+T.toString(32)+":";return f.memoizedState=g},unstable_isNewReconciler:!1},TI={readContext:Fc,useCallback:UE,useContext:Fc,useEffect:jc,useImperativeHandle:kb,useInsertionEffect:Hf,useLayoutEffect:dh,useMemo:EI,useReducer:Gf,useRef:_I,useState:function(){return Gf(uh)},useDebugValue:ad,useDeferredValue:function(f){var g=Va();return Nb(g,Ts.memoizedState,f)},useTransition:function(){var f=Gf(uh)[0],g=Va().memoizedState;return[f,g]},useMutableSource:fI,useSyncExternalStore:Ab,useId:Db,unstable_isNewReconciler:!1},mD={readContext:Fc,useCallback:UE,useContext:Fc,useEffect:jc,useImperativeHandle:kb,useInsertionEffect:Hf,useLayoutEffect:dh,useMemo:EI,useReducer:Om,useRef:_I,useState:function(){return Om(uh)},useDebugValue:ad,useDeferredValue:function(f){var g=Va();return Ts===null?g.memoizedState=f:Nb(g,Ts.memoizedState,f)},useTransition:function(){var f=Om(uh)[0],g=Va().memoizedState;return[f,g]},useMutableSource:fI,useSyncExternalStore:Ab,useId:Db,unstable_isNewReconciler:!1};function pc(f,g){if(f&&f.defaultProps){g=ke({},g),f=f.defaultProps;for(var T in f)g[T]===void 0&&(g[T]=f[T]);return g}return g}function FE(f,g,T,k){g=f.memoizedState,T=T(k,g),T=T==null?g:ke({},g,T),f.memoizedState=T,f.lanes===0&&(f.updateQueue.baseState=T)}var jE={isMounted:function(f){return(f=f._reactInternals)?Ri(f)===f:!1},enqueueSetState:function(f,g,T){f=f._reactInternals;var k=go(),V=zc(f),H=au(k,V);H.payload=g,T!=null&&(H.callback=T),g=ch(f,H,V),g!==null&&(Gc(g,f,V,k),f_(g,f,V))},enqueueReplaceState:function(f,g,T){f=f._reactInternals;var k=go(),V=zc(f),H=au(k,V);H.tag=1,H.payload=g,T!=null&&(H.callback=T),g=ch(f,H,V),g!==null&&(Gc(g,f,V,k),f_(g,f,V))},enqueueForceUpdate:function(f,g){f=f._reactInternals;var T=go(),k=zc(f),V=au(T,k);V.tag=2,g!=null&&(V.callback=g),g=ch(f,V,k),g!==null&&(Gc(g,f,k,T),f_(g,f,k))}};function xb(f,g,T,k,V,H,le){return f=f.stateNode,typeof f.shouldComponentUpdate=="function"?f.shouldComponentUpdate(k,H,le):g.prototype&&g.prototype.isPureReactComponent?!Qg(T,k)||!Qg(V,H):!0}function wI(f,g,T){var k=!1,V=ih,H=g.contextType;return typeof H=="object"&&H!==null?H=Fc(H):(V=La(g)?Vf:No.current,k=g.contextTypes,H=(k=k!=null)?Ff(f,V):ih),g=new g(T,H),f.memoizedState=g.state!==null&&g.state!==void 0?g.state:null,g.updater=jE,f.stateNode=g,g._reactInternals=f,k&&(f=f.stateNode,f.__reactInternalMemoizedUnmaskedChildContext=V,f.__reactInternalMemoizedMaskedChildContext=H),g}function CI(f,g,T,k){f=g.state,typeof g.componentWillReceiveProps=="function"&&g.componentWillReceiveProps(T,k),typeof g.UNSAFE_componentWillReceiveProps=="function"&&g.UNSAFE_componentWillReceiveProps(T,k),g.state!==f&&jE.enqueueReplaceState(g,g.state,null)}function Lb(f,g,T,k){var V=f.stateNode;V.props=T,V.state=f.memoizedState,V.refs={},h_(f);var H=g.contextType;typeof H=="object"&&H!==null?V.context=Fc(H):(H=La(g)?Vf:No.current,V.context=Ff(f,H)),V.state=f.memoizedState,H=g.getDerivedStateFromProps,typeof H=="function"&&(FE(f,g,H,T),V.state=f.memoizedState),typeof g.getDerivedStateFromProps=="function"||typeof V.getSnapshotBeforeUpdate=="function"||typeof V.UNSAFE_componentWillMount!="function"&&typeof V.componentWillMount!="function"||(g=V.state,typeof V.componentWillMount=="function"&&V.componentWillMount(),typeof V.UNSAFE_componentWillMount=="function"&&V.UNSAFE_componentWillMount(),g!==V.state&&jE.enqueueReplaceState(V,V.state,null),DE(f,T,V,k),V.state=f.memoizedState),typeof V.componentDidMount=="function"&&(f.flags|=4194308)}function Nm(f,g){try{var T="",k=g;do T+=ze(k),k=k.return;while(k);var V=T}catch(H){V=`
Error generating stack: `+H.message+`
`+H.stack}return{value:f,source:g,stack:V,digest:null}}function Mb(f,g,T){return{value:f,source:null,stack:T??null,digest:g??null}}function Ub(f,g){try{console.error(g.value)}catch(T){setTimeout(function(){throw T})}}var gD=typeof WeakMap=="function"?WeakMap:Map;function Vb(f,g,T){T=au(-1,T),T.tag=3,T.payload={element:null};var k=g.value;return T.callback=function(){iv||(iv=!0,Yb=k),Ub(f,g)},T}function ld(f,g,T){T=au(-1,T),T.tag=3;var k=f.type.getDerivedStateFromError;if(typeof k=="function"){var V=g.value;T.payload=function(){return k(V)},T.callback=function(){Ub(f,g)}}var H=f.stateNode;return H!==null&&typeof H.componentDidCatch=="function"&&(T.callback=function(){Ub(f,g),typeof k!="function"&&(hh===null?hh=new Set([this]):hh.add(this));var le=g.stack;this.componentDidCatch(g.value,{componentStack:le!==null?le:""})}),T}function RI(f,g,T){var k=f.pingCache;if(k===null){k=f.pingCache=new gD;var V=new Set;k.set(g,V)}else V=k.get(g),V===void 0&&(V=new Set,k.set(g,V));V.has(T)||(V.add(T),f=XI.bind(null,f,g,T),g.then(f,f))}function II(f){do{var g;if((g=f.tag===13)&&(g=f.memoizedState,g=g!==null?g.dehydrated!==null:!0),g)return f;f=f.return}while(f!==null);return null}function AI(f,g,T,k,V){return(f.mode&1)===0?(f===g?f.flags|=65536:(f.flags|=128,T.flags|=131072,T.flags&=-52805,T.tag===1&&(T.alternate===null?T.tag=17:(g=au(-1,1),g.tag=2,ch(T,g,1))),T.lanes|=1),f):(f.flags|=65536,f.lanes=V,f)}var _D=ce.ReactCurrentOwner,Fa=!1;function la(f,g,T,k){g.child=f===null?aI(g,null,T,k):wm(g,f.child,T,k)}function BE(f,g,T,k,V){T=T.render;var H=g.ref;return sd(g,V),k=Pm(f,g,T,k,H,V),T=Ib(),f!==null&&!Fa?(g.updateQueue=f.updateQueue,g.flags&=-2053,f.lanes&=~V,uu(f,g,V)):(Ei&&T&&AE(g),g.flags|=1,la(f,g,k,V),g.child)}function PI(f,g,T,k,V){if(f===null){var H=T.type;return typeof H=="function"&&!ph(H)&&H.defaultProps===void 0&&T.compare===null&&T.defaultProps===void 0?(g.tag=15,g.type=H,OI(f,g,H,k,V)):(f=gv(T.type,null,k,g,g.mode,V),f.ref=g.ref,f.return=g,g.child=f)}if(H=f.child,(f.lanes&V)===0){var le=H.memoizedProps;if(T=T.compare,T=T!==null?T:Qg,T(le,k)&&f.ref===g.ref)return uu(f,g,V)}return g.flags|=1,f=hd(H,k),f.ref=g.ref,f.return=g,g.child=f}function OI(f,g,T,k,V){if(f!==null){var H=f.memoizedProps;if(Qg(H,k)&&f.ref===g.ref)if(Fa=!1,g.pendingProps=k=H,(f.lanes&V)!==0)(f.flags&131072)!==0&&(Fa=!0);else return g.lanes=f.lanes,uu(f,g,V)}return Fb(f,g,T,k,V)}function kI(f,g,T){var k=g.pendingProps,V=k.children,H=f!==null?f.memoizedState:null;if(k.mode==="hidden")if((g.mode&1)===0)g.memoizedState={baseLanes:0,cachePool:null,transitions:null},Pi(wl,mc),mc|=T;else{if((T&1073741824)===0)return f=H!==null?H.baseLanes|T:T,g.lanes=g.childLanes=1073741824,g.memoizedState={baseLanes:f,cachePool:null,transitions:null},g.updateQueue=null,Pi(wl,mc),mc|=f,null;g.memoizedState={baseLanes:0,cachePool:null,transitions:null},k=H!==null?H.baseLanes:T,Pi(wl,mc),mc|=k}else H!==null?(k=H.baseLanes|T,g.memoizedState=null):k=T,Pi(wl,mc),mc|=k;return la(f,g,V,T),g.child}function NI(f,g){var T=g.ref;(f===null&&T!==null||f!==null&&f.ref!==T)&&(g.flags|=512,g.flags|=2097152)}function Fb(f,g,T,k,V){var H=La(T)?Vf:No.current;return H=Ff(g,H),sd(g,V),T=Pm(f,g,T,k,H,V),k=Ib(),f!==null&&!Fa?(g.updateQueue=f.updateQueue,g.flags&=-2053,f.lanes&=~V,uu(f,g,V)):(Ei&&k&&AE(g),g.flags|=1,la(f,g,T,V),g.child)}function DI(f,g,T,k,V){if(La(T)){var H=!0;wE(g)}else H=!1;if(sd(g,V),g.stateNode===null)KE(f,g),wI(g,T,k),Lb(g,T,k,V),k=!0;else if(f===null){var le=g.stateNode,Ie=g.memoizedProps;le.props=Ie;var Ue=le.context,it=T.contextType;typeof it=="object"&&it!==null?it=Fc(it):(it=La(T)?Vf:No.current,it=Ff(g,it));var Ot=T.getDerivedStateFromProps,kt=typeof Ot=="function"||typeof le.getSnapshotBeforeUpdate=="function";kt||typeof le.UNSAFE_componentWillReceiveProps!="function"&&typeof le.componentWillReceiveProps!="function"||(Ie!==k||Ue!==it)&&CI(g,le,k,it),ah=!1;var Pt=g.memoizedState;le.state=Pt,DE(g,k,le,V),Ue=g.memoizedState,Ie!==k||Pt!==Ue||xa.current||ah?(typeof Ot=="function"&&(FE(g,T,Ot,k),Ue=g.memoizedState),(Ie=ah||xb(g,T,Ie,k,Pt,Ue,it))?(kt||typeof le.UNSAFE_componentWillMount!="function"&&typeof le.componentWillMount!="function"||(typeof le.componentWillMount=="function"&&le.componentWillMount(),typeof le.UNSAFE_componentWillMount=="function"&&le.UNSAFE_componentWillMount()),typeof le.componentDidMount=="function"&&(g.flags|=4194308)):(typeof le.componentDidMount=="function"&&(g.flags|=4194308),g.memoizedProps=k,g.memoizedState=Ue),le.props=k,le.state=Ue,le.context=it,k=Ie):(typeof le.componentDidMount=="function"&&(g.flags|=4194308),k=!1)}else{le=g.stateNode,lI(f,g),Ie=g.memoizedProps,it=g.type===g.elementType?Ie:pc(g.type,Ie),le.props=it,kt=g.pendingProps,Pt=le.context,Ue=T.contextType,typeof Ue=="object"&&Ue!==null?Ue=Fc(Ue):(Ue=La(T)?Vf:No.current,Ue=Ff(g,Ue));var Yt=T.getDerivedStateFromProps;(Ot=typeof Yt=="function"||typeof le.getSnapshotBeforeUpdate=="function")||typeof le.UNSAFE_componentWillReceiveProps!="function"&&typeof le.componentWillReceiveProps!="function"||(Ie!==kt||Pt!==Ue)&&CI(g,le,k,Ue),ah=!1,Pt=g.memoizedState,le.state=Pt,DE(g,k,le,V);var sn=g.memoizedState;Ie!==kt||Pt!==sn||xa.current||ah?(typeof Yt=="function"&&(FE(g,T,Yt,k),sn=g.memoizedState),(it=ah||xb(g,T,it,k,Pt,sn,Ue)||!1)?(Ot||typeof le.UNSAFE_componentWillUpdate!="function"&&typeof le.componentWillUpdate!="function"||(typeof le.componentWillUpdate=="function"&&le.componentWillUpdate(k,sn,Ue),typeof le.UNSAFE_componentWillUpdate=="function"&&le.UNSAFE_componentWillUpdate(k,sn,Ue)),typeof le.componentDidUpdate=="function"&&(g.flags|=4),typeof le.getSnapshotBeforeUpdate=="function"&&(g.flags|=1024)):(typeof le.componentDidUpdate!="function"||Ie===f.memoizedProps&&Pt===f.memoizedState||(g.flags|=4),typeof le.getSnapshotBeforeUpdate!="function"||Ie===f.memoizedProps&&Pt===f.memoizedState||(g.flags|=1024),g.memoizedProps=k,g.memoizedState=sn),le.props=k,le.state=sn,le.context=Ue,k=it):(typeof le.componentDidUpdate!="function"||Ie===f.memoizedProps&&Pt===f.memoizedState||(g.flags|=4),typeof le.getSnapshotBeforeUpdate!="function"||Ie===f.memoizedProps&&Pt===f.memoizedState||(g.flags|=1024),k=!1)}return WE(f,g,T,k,H,V)}function WE(f,g,T,k,V,H){NI(f,g);var le=(g.flags&128)!==0;if(!k&&!le)return V&&tI(g,T,!1),uu(f,g,H);k=g.stateNode,_D.current=g;var Ie=le&&typeof T.getDerivedStateFromError!="function"?null:k.render();return g.flags|=1,f!==null&&le?(g.child=wm(g,f.child,null,H),g.child=wm(g,null,Ie,H)):la(f,g,Ie,H),g.memoizedState=k.state,V&&tI(g,T,!0),g.child}function jb(f){var g=f.stateNode;g.pendingContext?eI(f,g.pendingContext,g.pendingContext!==g.context):g.context&&eI(f,g.context,!1),bb(f,g.containerInfo)}function xI(f,g,T,k,V){return Tm(),gb(V),g.flags|=256,la(f,g,T,k),g.child}var Bb={dehydrated:null,treeContext:null,retryLane:0};function Dm(f){return{baseLanes:f,cachePool:null,transitions:null}}function zE(f,g,T){var k=g.pendingProps,V=Gi.current,H=!1,le=(g.flags&128)!==0,Ie;if((Ie=le)||(Ie=f!==null&&f.memoizedState===null?!1:(V&2)!==0),Ie?(H=!0,g.flags&=-129):(f===null||f.memoizedState!==null)&&(V|=1),Pi(Gi,V&1),f===null)return mb(g),f=g.memoizedState,f!==null&&(f=f.dehydrated,f!==null)?((g.mode&1)===0?g.lanes=1:f.data==="$!"?g.lanes=8:g.lanes=1073741824,null):(le=k.children,f=k.fallback,H?(k=g.mode,H=g.child,le={mode:"hidden",children:le},(k&1)===0&&H!==null?(H.childLanes=0,H.pendingProps=le):H=mh(le,k,0,null),f=Qf(f,k,T,null),H.return=g,f.return=g,H.sibling=f,g.child=H,g.child.memoizedState=Dm(T),g.memoizedState=Bb,f):GE(g,le));if(V=f.memoizedState,V!==null&&(Ie=V.dehydrated,Ie!==null))return LI(f,g,le,k,Ie,V,T);if(H){H=k.fallback,le=g.mode,V=f.child,Ie=V.sibling;var Ue={mode:"hidden",children:k.children};return(le&1)===0&&g.child!==V?(k=g.child,k.childLanes=0,k.pendingProps=Ue,g.deletions=null):(k=hd(V,Ue),k.subtreeFlags=V.subtreeFlags&14680064),Ie!==null?H=hd(Ie,H):(H=Qf(H,le,T,null),H.flags|=2),H.return=g,k.return=g,k.sibling=H,g.child=k,k=H,H=g.child,le=f.child.memoizedState,le=le===null?Dm(T):{baseLanes:le.baseLanes|T,cachePool:null,transitions:le.transitions},H.memoizedState=le,H.childLanes=f.childLanes&~T,g.memoizedState=Bb,k}return H=f.child,f=H.sibling,k=hd(H,{mode:"visible",children:k.children}),(g.mode&1)===0&&(k.lanes=T),k.return=g,k.sibling=null,f!==null&&(T=g.deletions,T===null?(g.deletions=[f],g.flags|=16):T.push(f)),g.child=k,g.memoizedState=null,k}function GE(f,g){return g=mh({mode:"visible",children:g},f.mode,0,null),g.return=f,f.child=g}function $f(f,g,T,k){return k!==null&&gb(k),wm(g,f.child,null,T),f=GE(g,g.pendingProps.children),f.flags|=2,g.memoizedState=null,f}function LI(f,g,T,k,V,H,le){if(T)return g.flags&256?(g.flags&=-257,k=Mb(Error(i(422))),$f(f,g,le,k)):g.memoizedState!==null?(g.child=f.child,g.flags|=128,null):(H=k.fallback,V=g.mode,k=mh({mode:"visible",children:k.children},V,0,null),H=Qf(H,V,le,null),H.flags|=2,k.return=g,H.return=g,k.sibling=H,g.child=k,(g.mode&1)!==0&&wm(g,f.child,null,le),g.child.memoizedState=Dm(le),g.memoizedState=Bb,H);if((g.mode&1)===0)return $f(f,g,le,null);if(V.data==="$!"){if(k=V.nextSibling&&V.nextSibling.dataset,k)var Ie=k.dgst;return k=Ie,H=Error(i(419)),k=Mb(H,k,void 0),$f(f,g,le,k)}if(Ie=(le&f.childLanes)!==0,Fa||Ie){if(k=Zs,k!==null){switch(le&-le){case 4:V=2;break;case 16:V=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:V=32;break;case 536870912:V=268435456;break;default:V=0}V=(V&(k.suspendedLanes|le))!==0?0:V,V!==0&&V!==H.retryLane&&(H.retryLane=V,od(f,V),Gc(k,f,V,-1))}return Qb(),k=Mb(Error(i(421))),$f(f,g,le,k)}return V.data==="$?"?(g.flags|=128,g.child=f.child,g=fv.bind(null,f),V._reactRetry=g,null):(f=H.treeContext,Ua=nh(V.nextSibling),Ma=g,Ei=!0,aa=null,f!==null&&(Vc[fc++]=nd,Vc[fc++]=rd,Vc[fc++]=jf,nd=f.id,rd=f.overflow,jf=g),g=GE(g,k.children),g.flags|=4096,g)}function MI(f,g,T){f.lanes|=g;var k=f.alternate;k!==null&&(k.lanes|=g),vb(f.return,g,T)}function HE(f,g,T,k,V){var H=f.memoizedState;H===null?f.memoizedState={isBackwards:g,rendering:null,renderingStartTime:0,last:k,tail:T,tailMode:V}:(H.isBackwards=g,H.rendering=null,H.renderingStartTime=0,H.last=k,H.tail=T,H.tailMode=V)}function $E(f,g,T){var k=g.pendingProps,V=k.revealOrder,H=k.tail;if(la(f,g,k.children,T),k=Gi.current,(k&2)!==0)k=k&1|2,g.flags|=128;else{if(f!==null&&(f.flags&128)!==0)e:for(f=g.child;f!==null;){if(f.tag===13)f.memoizedState!==null&&MI(f,T,g);else if(f.tag===19)MI(f,T,g);else if(f.child!==null){f.child.return=f,f=f.child;continue}if(f===g)break e;for(;f.sibling===null;){if(f.return===null||f.return===g)break e;f=f.return}f.sibling.return=f.return,f=f.sibling}k&=1}if(Pi(Gi,k),(g.mode&1)===0)g.memoizedState=null;else switch(V){case"forwards":for(T=g.child,V=null;T!==null;)f=T.alternate,f!==null&&lh(f)===null&&(V=T),T=T.sibling;T=V,T===null?(V=g.child,g.child=null):(V=T.sibling,T.sibling=null),HE(g,!1,V,T,H);break;case"backwards":for(T=null,V=g.child,g.child=null;V!==null;){if(f=V.alternate,f!==null&&lh(f)===null){g.child=V;break}f=V.sibling,V.sibling=T,T=V,V=f}HE(g,!0,T,null,H);break;case"together":HE(g,!1,null,null,void 0);break;default:g.memoizedState=null}return g.child}function KE(f,g){(g.mode&1)===0&&f!==null&&(f.alternate=null,g.alternate=null,g.flags|=2)}function uu(f,g,T){if(f!==null&&(g.dependencies=f.dependencies),Kf|=g.lanes,(T&g.childLanes)===0)return null;if(f!==null&&g.child!==f.child)throw Error(i(153));if(g.child!==null){for(f=g.child,T=hd(f,f.pendingProps),g.child=T,T.return=g;f.sibling!==null;)f=f.sibling,T=T.sibling=hd(f,f.pendingProps),T.return=g;T.sibling=null}return g.child}function UI(f,g,T){switch(g.tag){case 3:jb(g),Tm();break;case 5:hI(g);break;case 1:La(g.type)&&wE(g);break;case 4:bb(g,g.stateNode.containerInfo);break;case 10:var k=g.type._context,V=g.memoizedProps.value;Pi(kE,k._currentValue),k._currentValue=V;break;case 13:if(k=g.memoizedState,k!==null)return k.dehydrated!==null?(Pi(Gi,Gi.current&1),g.flags|=128,null):(T&g.child.childLanes)!==0?zE(f,g,T):(Pi(Gi,Gi.current&1),f=uu(f,g,T),f!==null?f.sibling:null);Pi(Gi,Gi.current&1);break;case 19:if(k=(T&g.childLanes)!==0,(f.flags&128)!==0){if(k)return $E(f,g,T);g.flags|=128}if(V=g.memoizedState,V!==null&&(V.rendering=null,V.tail=null,V.lastEffect=null),Pi(Gi,Gi.current),k)break;return null;case 22:case 23:return g.lanes=0,kI(f,g,T)}return uu(f,g,T)}var VI,qE,Wb,FI;VI=function(f,g){for(var T=g.child;T!==null;){if(T.tag===5||T.tag===6)f.appendChild(T.stateNode);else if(T.tag!==4&&T.child!==null){T.child.return=T,T=T.child;continue}if(T===g)break;for(;T.sibling===null;){if(T.return===null||T.return===g)return;T=T.return}T.sibling.return=T.return,T=T.sibling}},qE=function(){},Wb=function(f,g,T,k){var V=f.memoizedProps;if(V!==k){f=g.stateNode,Wf(cu.current);var H=null;switch(T){case"input":V=en(f,V),k=en(f,k),H=[];break;case"select":V=ke({},V,{value:void 0}),k=ke({},k,{value:void 0}),H=[];break;case"textarea":V=gt(f,V),k=gt(f,k),H=[];break;default:typeof V.onClick!="function"&&typeof k.onClick=="function"&&(f.onclick=vE)}qo(T,k);var le;T=null;for(it in V)if(!k.hasOwnProperty(it)&&V.hasOwnProperty(it)&&V[it]!=null)if(it==="style"){var Ie=V[it];for(le in Ie)Ie.hasOwnProperty(le)&&(T||(T={}),T[le]="")}else it!=="dangerouslySetInnerHTML"&&it!=="children"&&it!=="suppressContentEditableWarning"&&it!=="suppressHydrationWarning"&&it!=="autoFocus"&&(l.hasOwnProperty(it)?H||(H=[]):(H=H||[]).push(it,null));for(it in k){var Ue=k[it];if(Ie=V!=null?V[it]:void 0,k.hasOwnProperty(it)&&Ue!==Ie&&(Ue!=null||Ie!=null))if(it==="style")if(Ie){for(le in Ie)!Ie.hasOwnProperty(le)||Ue&&Ue.hasOwnProperty(le)||(T||(T={}),T[le]="");for(le in Ue)Ue.hasOwnProperty(le)&&Ie[le]!==Ue[le]&&(T||(T={}),T[le]=Ue[le])}else T||(H||(H=[]),H.push(it,T)),T=Ue;else it==="dangerouslySetInnerHTML"?(Ue=Ue?Ue.__html:void 0,Ie=Ie?Ie.__html:void 0,Ue!=null&&Ie!==Ue&&(H=H||[]).push(it,Ue)):it==="children"?typeof Ue!="string"&&typeof Ue!="number"||(H=H||[]).push(it,""+Ue):it!=="suppressContentEditableWarning"&&it!=="suppressHydrationWarning"&&(l.hasOwnProperty(it)?(Ue!=null&&it==="onScroll"&&Ui("scroll",f),H||Ie===Ue||(H=[])):(H=H||[]).push(it,Ue))}T&&(H=H||[]).push("style",T);var it=H;(g.updateQueue=it)&&(g.flags|=4)}},FI=function(f,g,T,k){T!==k&&(g.flags|=4)};function v_(f,g){if(!Ei)switch(f.tailMode){case"hidden":g=f.tail;for(var T=null;g!==null;)g.alternate!==null&&(T=g),g=g.sibling;T===null?f.tail=null:T.sibling=null;break;case"collapsed":T=f.tail;for(var k=null;T!==null;)T.alternate!==null&&(k=T),T=T.sibling;k===null?g||f.tail===null?f.tail=null:f.tail.sibling=null:k.sibling=null}}function xo(f){var g=f.alternate!==null&&f.alternate.child===f.child,T=0,k=0;if(g)for(var V=f.child;V!==null;)T|=V.lanes|V.childLanes,k|=V.subtreeFlags&14680064,k|=V.flags&14680064,V.return=f,V=V.sibling;else for(V=f.child;V!==null;)T|=V.lanes|V.childLanes,k|=V.subtreeFlags,k|=V.flags,V.return=f,V=V.sibling;return f.subtreeFlags|=k,f.childLanes=T,g}function YE(f,g,T){var k=g.pendingProps;switch(c_(g),g.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return xo(g),null;case 1:return La(g.type)&&bE(),xo(g),null;case 3:return k=g.stateNode,zf(),Vi(xa),Vi(No),wb(),k.pendingContext&&(k.context=k.pendingContext,k.pendingContext=null),(f===null||f.child===null)&&(l_(g)?g.flags|=4:f===null||f.memoizedState.isDehydrated&&(g.flags&256)===0||(g.flags|=1024,aa!==null&&(lv(aa),aa=null))),qE(f,g),xo(g),null;case 5:Im(g);var V=Wf(Rm.current);if(T=g.type,f!==null&&g.stateNode!=null)Wb(f,g,T,k,V),f.ref!==g.ref&&(g.flags|=512,g.flags|=2097152);else{if(!k){if(g.stateNode===null)throw Error(i(166));return xo(g),null}if(f=Wf(cu.current),l_(g)){k=g.stateNode,T=g.type;var H=g.memoizedProps;switch(k[ou]=g,k[rh]=H,f=(g.mode&1)!==0,T){case"dialog":Ui("cancel",k),Ui("close",k);break;case"iframe":case"object":case"embed":Ui("load",k);break;case"video":case"audio":for(V=0;V<n_.length;V++)Ui(n_[V],k);break;case"source":Ui("error",k);break;case"img":case"image":case"link":Ui("error",k),Ui("load",k);break;case"details":Ui("toggle",k);break;case"input":Xt(k,H),Ui("invalid",k);break;case"select":k._wrapperState={wasMultiple:!!H.multiple},Ui("invalid",k);break;case"textarea":St(k,H),Ui("invalid",k)}qo(T,H),V=null;for(var le in H)if(H.hasOwnProperty(le)){var Ie=H[le];le==="children"?typeof Ie=="string"?k.textContent!==Ie&&(H.suppressHydrationWarning!==!0&&EE(k.textContent,Ie,f),V=["children",Ie]):typeof Ie=="number"&&k.textContent!==""+Ie&&(H.suppressHydrationWarning!==!0&&EE(k.textContent,Ie,f),V=["children",""+Ie]):l.hasOwnProperty(le)&&Ie!=null&&le==="onScroll"&&Ui("scroll",k)}switch(T){case"input":pn(k),Re(k,H,!0);break;case"textarea":pn(k),mn(k);break;case"select":case"option":break;default:typeof H.onClick=="function"&&(k.onclick=vE)}k=V,g.updateQueue=k,k!==null&&(g.flags|=4)}else{le=V.nodeType===9?V:V.ownerDocument,f==="http://www.w3.org/1999/xhtml"&&(f=vn(T)),f==="http://www.w3.org/1999/xhtml"?T==="script"?(f=le.createElement("div"),f.innerHTML="<script><\/script>",f=f.removeChild(f.firstChild)):typeof k.is=="string"?f=le.createElement(T,{is:k.is}):(f=le.createElement(T),T==="select"&&(le=f,k.multiple?le.multiple=!0:k.size&&(le.size=k.size))):f=le.createElementNS(f,T),f[ou]=g,f[rh]=k,VI(f,g,!1,!1),g.stateNode=f;e:{switch(le=ic(T,k),T){case"dialog":Ui("cancel",f),Ui("close",f),V=k;break;case"iframe":case"object":case"embed":Ui("load",f),V=k;break;case"video":case"audio":for(V=0;V<n_.length;V++)Ui(n_[V],f);V=k;break;case"source":Ui("error",f),V=k;break;case"img":case"image":case"link":Ui("error",f),Ui("load",f),V=k;break;case"details":Ui("toggle",f),V=k;break;case"input":Xt(f,k),V=en(f,k),Ui("invalid",f);break;case"option":V=k;break;case"select":f._wrapperState={wasMultiple:!!k.multiple},V=ke({},k,{value:void 0}),Ui("invalid",f);break;case"textarea":St(f,k),V=gt(f,k),Ui("invalid",f);break;default:V=k}qo(T,V),Ie=V;for(H in Ie)if(Ie.hasOwnProperty(H)){var Ue=Ie[H];H==="style"?Es(f,Ue):H==="dangerouslySetInnerHTML"?(Ue=Ue?Ue.__html:void 0,Ue!=null&&nr(f,Ue)):H==="children"?typeof Ue=="string"?(T!=="textarea"||Ue!=="")&&Dt(f,Ue):typeof Ue=="number"&&Dt(f,""+Ue):H!=="suppressContentEditableWarning"&&H!=="suppressHydrationWarning"&&H!=="autoFocus"&&(l.hasOwnProperty(H)?Ue!=null&&H==="onScroll"&&Ui("scroll",f):Ue!=null&&ie(f,H,Ue,le))}switch(T){case"input":pn(f),Re(f,k,!1);break;case"textarea":pn(f),mn(f);break;case"option":k.value!=null&&f.setAttribute("value",""+ut(k.value));break;case"select":f.multiple=!!k.multiple,H=k.value,H!=null?ft(f,!!k.multiple,H,!1):k.defaultValue!=null&&ft(f,!!k.multiple,k.defaultValue,!0);break;default:typeof V.onClick=="function"&&(f.onclick=vE)}switch(T){case"button":case"input":case"select":case"textarea":k=!!k.autoFocus;break e;case"img":k=!0;break e;default:k=!1}}k&&(g.flags|=4)}g.ref!==null&&(g.flags|=512,g.flags|=2097152)}return xo(g),null;case 6:if(f&&g.stateNode!=null)FI(f,g,f.memoizedProps,k);else{if(typeof k!="string"&&g.stateNode===null)throw Error(i(166));if(T=Wf(Rm.current),Wf(cu.current),l_(g)){if(k=g.stateNode,T=g.memoizedProps,k[ou]=g,(H=k.nodeValue!==T)&&(f=Ma,f!==null))switch(f.tag){case 3:EE(k.nodeValue,T,(f.mode&1)!==0);break;case 5:f.memoizedProps.suppressHydrationWarning!==!0&&EE(k.nodeValue,T,(f.mode&1)!==0)}H&&(g.flags|=4)}else k=(T.nodeType===9?T:T.ownerDocument).createTextNode(k),k[ou]=g,g.stateNode=k}return xo(g),null;case 13:if(Vi(Gi),k=g.memoizedState,f===null||f.memoizedState!==null&&f.memoizedState.dehydrated!==null){if(Ei&&Ua!==null&&(g.mode&1)!==0&&(g.flags&128)===0)oI(),Tm(),g.flags|=98560,H=!1;else if(H=l_(g),k!==null&&k.dehydrated!==null){if(f===null){if(!H)throw Error(i(318));if(H=g.memoizedState,H=H!==null?H.dehydrated:null,!H)throw Error(i(317));H[ou]=g}else Tm(),(g.flags&128)===0&&(g.memoizedState=null),g.flags|=4;xo(g),H=!1}else aa!==null&&(lv(aa),aa=null),H=!0;if(!H)return g.flags&65536?g:null}return(g.flags&128)!==0?(g.lanes=T,g):(k=k!==null,k!==(f!==null&&f.memoizedState!==null)&&k&&(g.child.flags|=8192,(g.mode&1)!==0&&(f===null||(Gi.current&1)!==0?Rs===0&&(Rs=3):Qb())),g.updateQueue!==null&&(g.flags|=4),xo(g),null);case 4:return zf(),qE(f,g),f===null&&xf(g.stateNode.containerInfo),xo(g),null;case 10:return Eb(g.type._context),xo(g),null;case 17:return La(g.type)&&bE(),xo(g),null;case 19:if(Vi(Gi),H=g.memoizedState,H===null)return xo(g),null;if(k=(g.flags&128)!==0,le=H.rendering,le===null)if(k)v_(H,!1);else{if(Rs!==0||f!==null&&(f.flags&128)!==0)for(f=g.child;f!==null;){if(le=lh(f),le!==null){for(g.flags|=128,v_(H,!1),k=le.updateQueue,k!==null&&(g.updateQueue=k,g.flags|=4),g.subtreeFlags=0,k=T,T=g.child;T!==null;)H=T,f=k,H.flags&=14680066,le=H.alternate,le===null?(H.childLanes=0,H.lanes=f,H.child=null,H.subtreeFlags=0,H.memoizedProps=null,H.memoizedState=null,H.updateQueue=null,H.dependencies=null,H.stateNode=null):(H.childLanes=le.childLanes,H.lanes=le.lanes,H.child=le.child,H.subtreeFlags=0,H.deletions=null,H.memoizedProps=le.memoizedProps,H.memoizedState=le.memoizedState,H.updateQueue=le.updateQueue,H.type=le.type,f=le.dependencies,H.dependencies=f===null?null:{lanes:f.lanes,firstContext:f.firstContext}),T=T.sibling;return Pi(Gi,Gi.current&1|2),g.child}f=f.sibling}H.tail!==null&&qr()>Mm&&(g.flags|=128,k=!0,v_(H,!1),g.lanes=4194304)}else{if(!k)if(f=lh(le),f!==null){if(g.flags|=128,k=!0,T=f.updateQueue,T!==null&&(g.updateQueue=T,g.flags|=4),v_(H,!0),H.tail===null&&H.tailMode==="hidden"&&!le.alternate&&!Ei)return xo(g),null}else 2*qr()-H.renderingStartTime>Mm&&T!==1073741824&&(g.flags|=128,k=!0,v_(H,!1),g.lanes=4194304);H.isBackwards?(le.sibling=g.child,g.child=le):(T=H.last,T!==null?T.sibling=le:g.child=le,H.last=le)}return H.tail!==null?(g=H.tail,H.rendering=g,H.tail=g.sibling,H.renderingStartTime=qr(),g.sibling=null,T=Gi.current,Pi(Gi,k?T&1|2:T&1),g):(xo(g),null);case 22:case 23:return A_(),k=g.memoizedState!==null,f!==null&&f.memoizedState!==null!==k&&(g.flags|=8192),k&&(g.mode&1)!==0?(mc&1073741824)!==0&&(xo(g),g.subtreeFlags&6&&(g.flags|=8192)):xo(g),null;case 24:return null;case 25:return null}throw Error(i(156,g.tag))}function yD(f,g){switch(c_(g),g.tag){case 1:return La(g.type)&&bE(),f=g.flags,f&65536?(g.flags=f&-65537|128,g):null;case 3:return zf(),Vi(xa),Vi(No),wb(),f=g.flags,(f&65536)!==0&&(f&128)===0?(g.flags=f&-65537|128,g):null;case 5:return Im(g),null;case 13:if(Vi(Gi),f=g.memoizedState,f!==null&&f.dehydrated!==null){if(g.alternate===null)throw Error(i(340));Tm()}return f=g.flags,f&65536?(g.flags=f&-65537|128,g):null;case 19:return Vi(Gi),null;case 4:return zf(),null;case 10:return Eb(g.type._context),null;case 22:case 23:return A_(),null;case 24:return null;default:return null}}var XE=!1,Lo=!1,jI=typeof WeakSet=="function"?WeakSet:Set,nn=null;function xm(f,g){var T=f.ref;if(T!==null)if(typeof T=="function")try{T(null)}catch(k){Ji(f,g,k)}else T.current=null}function S_(f,g,T){try{T()}catch(k){Ji(f,g,k)}}var BI=!1;function zb(f,g){if(SE=Ce,f=WR(),Zg(f)){if("selectionStart"in f)var T={start:f.selectionStart,end:f.selectionEnd};else e:{T=(T=f.ownerDocument)&&T.defaultView||window;var k=T.getSelection&&T.getSelection();if(k&&k.rangeCount!==0){T=k.anchorNode;var V=k.anchorOffset,H=k.focusNode;k=k.focusOffset;try{T.nodeType,H.nodeType}catch{T=null;break e}var le=0,Ie=-1,Ue=-1,it=0,Ot=0,kt=f,Pt=null;t:for(;;){for(var Yt;kt!==T||V!==0&&kt.nodeType!==3||(Ie=le+V),kt!==H||k!==0&&kt.nodeType!==3||(Ue=le+k),kt.nodeType===3&&(le+=kt.nodeValue.length),(Yt=kt.firstChild)!==null;)Pt=kt,kt=Yt;for(;;){if(kt===f)break t;if(Pt===T&&++it===V&&(Ie=le),Pt===H&&++Ot===k&&(Ue=le),(Yt=kt.nextSibling)!==null)break;kt=Pt,Pt=kt.parentNode}kt=Yt}T=Ie===-1||Ue===-1?null:{start:Ie,end:Ue}}else T=null}T=T||{start:0,end:0}}else T=null;for(i_={focusedElem:f,selectionRange:T},Ce=!1,nn=g;nn!==null;)if(g=nn,f=g.child,(g.subtreeFlags&1028)!==0&&f!==null)f.return=g,nn=f;else for(;nn!==null;){g=nn;try{var sn=g.alternate;if((g.flags&1024)!==0)switch(g.tag){case 0:case 11:case 15:break;case 1:if(sn!==null){var on=sn.memoizedProps,cs=sn.memoizedState,Xe=g.stateNode,Fe=Xe.getSnapshotBeforeUpdate(g.elementType===g.type?on:pc(g.type,on),cs);Xe.__reactInternalSnapshotBeforeUpdate=Fe}break;case 3:var tt=g.stateNode.containerInfo;tt.nodeType===1?tt.textContent="":tt.nodeType===9&&tt.documentElement&&tt.removeChild(tt.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(i(163))}}catch(Lt){Ji(g,g.return,Lt)}if(f=g.sibling,f!==null){f.return=g.return,nn=f;break}nn=g.return}return sn=BI,BI=!1,sn}function b_(f,g,T){var k=g.updateQueue;if(k=k!==null?k.lastEffect:null,k!==null){var V=k=k.next;do{if((V.tag&f)===f){var H=V.destroy;V.destroy=void 0,H!==void 0&&S_(g,T,H)}V=V.next}while(V!==k)}}function T_(f,g){if(g=g.updateQueue,g=g!==null?g.lastEffect:null,g!==null){var T=g=g.next;do{if((T.tag&f)===f){var k=T.create;T.destroy=k()}T=T.next}while(T!==g)}}function Gb(f){var g=f.ref;if(g!==null){var T=f.stateNode;switch(f.tag){case 5:f=T;break;default:f=T}typeof g=="function"?g(f):g.current=f}}function WI(f){var g=f.alternate;g!==null&&(f.alternate=null,WI(g)),f.child=null,f.deletions=null,f.sibling=null,f.tag===5&&(g=f.stateNode,g!==null&&(delete g[ou],delete g[rh],delete g[o_],delete g[aD],delete g[cD])),f.stateNode=null,f.return=null,f.dependencies=null,f.memoizedProps=null,f.memoizedState=null,f.pendingProps=null,f.stateNode=null,f.updateQueue=null}function Hb(f){return f.tag===5||f.tag===3||f.tag===4}function zI(f){e:for(;;){for(;f.sibling===null;){if(f.return===null||Hb(f.return))return null;f=f.return}for(f.sibling.return=f.return,f=f.sibling;f.tag!==5&&f.tag!==6&&f.tag!==18;){if(f.flags&2||f.child===null||f.tag===4)continue e;f.child.return=f,f=f.child}if(!(f.flags&2))return f.stateNode}}function $b(f,g,T){var k=f.tag;if(k===5||k===6)f=f.stateNode,g?T.nodeType===8?T.parentNode.insertBefore(f,g):T.insertBefore(f,g):(T.nodeType===8?(g=T.parentNode,g.insertBefore(f,T)):(g=T,g.appendChild(f)),T=T._reactRootContainer,T!=null||g.onclick!==null||(g.onclick=vE));else if(k!==4&&(f=f.child,f!==null))for($b(f,g,T),f=f.sibling;f!==null;)$b(f,g,T),f=f.sibling}function JE(f,g,T){var k=f.tag;if(k===5||k===6)f=f.stateNode,g?T.insertBefore(f,g):T.appendChild(f);else if(k!==4&&(f=f.child,f!==null))for(JE(f,g,T),f=f.sibling;f!==null;)JE(f,g,T),f=f.sibling}var po=null,Bc=!1;function du(f,g,T){for(T=T.child;T!==null;)GI(f,g,T),T=T.sibling}function GI(f,g,T){if(ko&&typeof ko.onCommitFiberUnmount=="function")try{ko.onCommitFiberUnmount(Ql,T)}catch{}switch(T.tag){case 5:Lo||xm(T,g);case 6:var k=po,V=Bc;po=null,du(f,g,T),po=k,Bc=V,po!==null&&(Bc?(f=po,T=T.stateNode,f.nodeType===8?f.parentNode.removeChild(T):f.removeChild(T)):po.removeChild(T.stateNode));break;case 18:po!==null&&(Bc?(f=po,T=T.stateNode,f.nodeType===8?hb(f.parentNode,T):f.nodeType===1&&hb(f,T),Na(f)):hb(po,T.stateNode));break;case 4:k=po,V=Bc,po=T.stateNode.containerInfo,Bc=!0,du(f,g,T),po=k,Bc=V;break;case 0:case 11:case 14:case 15:if(!Lo&&(k=T.updateQueue,k!==null&&(k=k.lastEffect,k!==null))){V=k=k.next;do{var H=V,le=H.destroy;H=H.tag,le!==void 0&&((H&2)!==0||(H&4)!==0)&&S_(T,g,le),V=V.next}while(V!==k)}du(f,g,T);break;case 1:if(!Lo&&(xm(T,g),k=T.stateNode,typeof k.componentWillUnmount=="function"))try{k.props=T.memoizedProps,k.state=T.memoizedState,k.componentWillUnmount()}catch(Ie){Ji(T,g,Ie)}du(f,g,T);break;case 21:du(f,g,T);break;case 22:T.mode&1?(Lo=(k=Lo)||T.memoizedState!==null,du(f,g,T),Lo=k):du(f,g,T);break;default:du(f,g,T)}}function HI(f){var g=f.updateQueue;if(g!==null){f.updateQueue=null;var T=f.stateNode;T===null&&(T=f.stateNode=new jI),g.forEach(function(k){var V=JI.bind(null,f,k);T.has(k)||(T.add(k),k.then(V,V))})}}function ua(f,g){var T=g.deletions;if(T!==null)for(var k=0;k<T.length;k++){var V=T[k];try{var H=f,le=g,Ie=le;e:for(;Ie!==null;){switch(Ie.tag){case 5:po=Ie.stateNode,Bc=!1;break e;case 3:po=Ie.stateNode.containerInfo,Bc=!0;break e;case 4:po=Ie.stateNode.containerInfo,Bc=!0;break e}Ie=Ie.return}if(po===null)throw Error(i(160));GI(H,le,V),po=null,Bc=!1;var Ue=V.alternate;Ue!==null&&(Ue.return=null),V.return=null}catch(it){Ji(V,g,it)}}if(g.subtreeFlags&12854)for(g=g.child;g!==null;)Kb(g,f),g=g.sibling}function Kb(f,g){var T=f.alternate,k=f.flags;switch(f.tag){case 0:case 11:case 14:case 15:if(ua(g,f),ja(f),k&4){try{b_(3,f,f.return),T_(3,f)}catch(on){Ji(f,f.return,on)}try{b_(5,f,f.return)}catch(on){Ji(f,f.return,on)}}break;case 1:ua(g,f),ja(f),k&512&&T!==null&&xm(T,T.return);break;case 5:if(ua(g,f),ja(f),k&512&&T!==null&&xm(T,T.return),f.flags&32){var V=f.stateNode;try{Dt(V,"")}catch(on){Ji(f,f.return,on)}}if(k&4&&(V=f.stateNode,V!=null)){var H=f.memoizedProps,le=T!==null?T.memoizedProps:H,Ie=f.type,Ue=f.updateQueue;if(f.updateQueue=null,Ue!==null)try{Ie==="input"&&H.type==="radio"&&H.name!=null&&Vn(V,H),ic(Ie,le);var it=ic(Ie,H);for(le=0;le<Ue.length;le+=2){var Ot=Ue[le],kt=Ue[le+1];Ot==="style"?Es(V,kt):Ot==="dangerouslySetInnerHTML"?nr(V,kt):Ot==="children"?Dt(V,kt):ie(V,Ot,kt,it)}switch(Ie){case"input":Kt(V,H);break;case"textarea":Wt(V,H);break;case"select":var Pt=V._wrapperState.wasMultiple;V._wrapperState.wasMultiple=!!H.multiple;var Yt=H.value;Yt!=null?ft(V,!!H.multiple,Yt,!1):Pt!==!!H.multiple&&(H.defaultValue!=null?ft(V,!!H.multiple,H.defaultValue,!0):ft(V,!!H.multiple,H.multiple?[]:"",!1))}V[rh]=H}catch(on){Ji(f,f.return,on)}}break;case 6:if(ua(g,f),ja(f),k&4){if(f.stateNode===null)throw Error(i(162));V=f.stateNode,H=f.memoizedProps;try{V.nodeValue=H}catch(on){Ji(f,f.return,on)}}break;case 3:if(ua(g,f),ja(f),k&4&&T!==null&&T.memoizedState.isDehydrated)try{Na(g.containerInfo)}catch(on){Ji(f,f.return,on)}break;case 4:ua(g,f),ja(f);break;case 13:ua(g,f),ja(f),V=f.child,V.flags&8192&&(H=V.memoizedState!==null,V.stateNode.isHidden=H,!H||V.alternate!==null&&V.alternate.memoizedState!==null||(rv=qr())),k&4&&HI(f);break;case 22:if(Ot=T!==null&&T.memoizedState!==null,f.mode&1?(Lo=(it=Lo)||Ot,ua(g,f),Lo=it):ua(g,f),ja(f),k&8192){if(it=f.memoizedState!==null,(f.stateNode.isHidden=it)&&!Ot&&(f.mode&1)!==0)for(nn=f,Ot=f.child;Ot!==null;){for(kt=nn=Ot;nn!==null;){switch(Pt=nn,Yt=Pt.child,Pt.tag){case 0:case 11:case 14:case 15:b_(4,Pt,Pt.return);break;case 1:xm(Pt,Pt.return);var sn=Pt.stateNode;if(typeof sn.componentWillUnmount=="function"){k=Pt,T=Pt.return;try{g=k,sn.props=g.memoizedProps,sn.state=g.memoizedState,sn.componentWillUnmount()}catch(on){Ji(k,T,on)}}break;case 5:xm(Pt,Pt.return);break;case 22:if(Pt.memoizedState!==null){w_(kt);continue}}Yt!==null?(Yt.return=Pt,nn=Yt):w_(kt)}Ot=Ot.sibling}e:for(Ot=null,kt=f;;){if(kt.tag===5){if(Ot===null){Ot=kt;try{V=kt.stateNode,it?(H=V.style,typeof H.setProperty=="function"?H.setProperty("display","none","important"):H.display="none"):(Ie=kt.stateNode,Ue=kt.memoizedProps.style,le=Ue!=null&&Ue.hasOwnProperty("display")?Ue.display:null,Ie.style.display=Li("display",le))}catch(on){Ji(f,f.return,on)}}}else if(kt.tag===6){if(Ot===null)try{kt.stateNode.nodeValue=it?"":kt.memoizedProps}catch(on){Ji(f,f.return,on)}}else if((kt.tag!==22&&kt.tag!==23||kt.memoizedState===null||kt===f)&&kt.child!==null){kt.child.return=kt,kt=kt.child;continue}if(kt===f)break e;for(;kt.sibling===null;){if(kt.return===null||kt.return===f)break e;Ot===kt&&(Ot=null),kt=kt.return}Ot===kt&&(Ot=null),kt.sibling.return=kt.return,kt=kt.sibling}}break;case 19:ua(g,f),ja(f),k&4&&HI(f);break;case 21:break;default:ua(g,f),ja(f)}}function ja(f){var g=f.flags;if(g&2){try{e:{for(var T=f.return;T!==null;){if(Hb(T)){var k=T;break e}T=T.return}throw Error(i(160))}switch(k.tag){case 5:var V=k.stateNode;k.flags&32&&(Dt(V,""),k.flags&=-33);var H=zI(f);JE(f,H,V);break;case 3:case 4:var le=k.stateNode.containerInfo,Ie=zI(f);$b(f,Ie,le);break;default:throw Error(i(161))}}catch(Ue){Ji(f,f.return,Ue)}f.flags&=-3}g&4096&&(f.flags&=-4097)}function Lm(f,g,T){nn=f,qb(f)}function qb(f,g,T){for(var k=(f.mode&1)!==0;nn!==null;){var V=nn,H=V.child;if(V.tag===22&&k){var le=V.memoizedState!==null||XE;if(!le){var Ie=V.alternate,Ue=Ie!==null&&Ie.memoizedState!==null||Lo;Ie=XE;var it=Lo;if(XE=le,(Lo=Ue)&&!it)for(nn=V;nn!==null;)le=nn,Ue=le.child,le.tag===22&&le.memoizedState!==null?$I(V):Ue!==null?(Ue.return=le,nn=Ue):$I(V);for(;H!==null;)nn=H,qb(H),H=H.sibling;nn=V,XE=Ie,Lo=it}QE(f)}else(V.subtreeFlags&8772)!==0&&H!==null?(H.return=V,nn=H):QE(f)}}function QE(f){for(;nn!==null;){var g=nn;if((g.flags&8772)!==0){var T=g.alternate;try{if((g.flags&8772)!==0)switch(g.tag){case 0:case 11:case 15:Lo||T_(5,g);break;case 1:var k=g.stateNode;if(g.flags&4&&!Lo)if(T===null)k.componentDidMount();else{var V=g.elementType===g.type?T.memoizedProps:pc(g.type,T.memoizedProps);k.componentDidUpdate(V,T.memoizedState,k.__reactInternalSnapshotBeforeUpdate)}var H=g.updateQueue;H!==null&&dI(g,H,k);break;case 3:var le=g.updateQueue;if(le!==null){if(T=null,g.child!==null)switch(g.child.tag){case 5:T=g.child.stateNode;break;case 1:T=g.child.stateNode}dI(g,le,T)}break;case 5:var Ie=g.stateNode;if(T===null&&g.flags&4){T=Ie;var Ue=g.memoizedProps;switch(g.type){case"button":case"input":case"select":case"textarea":Ue.autoFocus&&T.focus();break;case"img":Ue.src&&(T.src=Ue.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(g.memoizedState===null){var it=g.alternate;if(it!==null){var Ot=it.memoizedState;if(Ot!==null){var kt=Ot.dehydrated;kt!==null&&Na(kt)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(i(163))}Lo||g.flags&512&&Gb(g)}catch(Pt){Ji(g,g.return,Pt)}}if(g===f){nn=null;break}if(T=g.sibling,T!==null){T.return=g.return,nn=T;break}nn=g.return}}function w_(f){for(;nn!==null;){var g=nn;if(g===f){nn=null;break}var T=g.sibling;if(T!==null){T.return=g.return,nn=T;break}nn=g.return}}function $I(f){for(;nn!==null;){var g=nn;try{switch(g.tag){case 0:case 11:case 15:var T=g.return;try{T_(4,g)}catch(Ue){Ji(g,T,Ue)}break;case 1:var k=g.stateNode;if(typeof k.componentDidMount=="function"){var V=g.return;try{k.componentDidMount()}catch(Ue){Ji(g,V,Ue)}}var H=g.return;try{Gb(g)}catch(Ue){Ji(g,H,Ue)}break;case 5:var le=g.return;try{Gb(g)}catch(Ue){Ji(g,le,Ue)}}}catch(Ue){Ji(g,g.return,Ue)}if(g===f){nn=null;break}var Ie=g.sibling;if(Ie!==null){Ie.return=g.return,nn=Ie;break}nn=g.return}}var ED=Math.ceil,ZE=ce.ReactCurrentDispatcher,ev=ce.ReactCurrentOwner,Wc=ce.ReactCurrentBatchConfig,Dr=0,Zs=null,as=null,Cs=0,mc=0,wl=Mc(0),Rs=0,mo=null,Kf=0,tv=0,nv=0,C_=null,da=null,rv=0,Mm=1/0,hu=null,iv=!1,Yb=null,hh=null,Um=!1,fu=null,sv=0,qf=0,Xb=null,R_=-1,ov=0;function go(){return(Dr&6)!==0?qr():R_!==-1?R_:R_=qr()}function zc(f){return(f.mode&1)===0?1:(Dr&2)!==0&&Cs!==0?Cs&-Cs:uD.transition!==null?(ov===0&&(ov=qu()),ov):(f=cr,f!==0||(f=window.event,f=f===void 0?16:Yr(f.type)),f)}function Gc(f,g,T,k){if(50<qf)throw qf=0,Xb=null,Error(i(185));tu(f,T,k),((Dr&2)===0||f!==Zs)&&(f===Zs&&((Dr&2)===0&&(tv|=T),Rs===4&&ud(f,Cs)),Mo(f,k),T===1&&Dr===0&&(g.mode&1)===0&&(Mm=qr()+500,CE&&sh()))}function Mo(f,g){var T=f.callbackNode;cc(f,g);var k=eu(f,f===Zs?Cs:0);if(k===0)T!==null&&$u(T),f.callbackNode=null,f.callbackPriority=0;else if(g=k&-k,f.callbackPriority!==g){if(T!=null&&$u(T),g===1)f.tag===0?lD(Yf.bind(null,f)):nI(Yf.bind(null,f)),sD(function(){(Dr&6)===0&&sh()}),T=null;else{switch(Oc(k)){case 1:T=Pc;break;case 4:T=_l;break;case 16:T=Oa;break;case 536870912:T=Xd;break;default:T=Oa}T=P_(T,av.bind(null,f))}f.callbackPriority=g,f.callbackNode=T}}function av(f,g){if(R_=-1,ov=0,(Dr&6)!==0)throw Error(i(327));var T=f.callbackNode;if(Vm()&&f.callbackNode!==T)return null;var k=eu(f,f===Zs?Cs:0);if(k===0)return null;if((k&30)!==0||(k&f.expiredLanes)!==0||g)g=pu(f,k);else{g=k;var V=Dr;Dr|=2;var H=KI();(Zs!==f||Cs!==g)&&(hu=null,Mm=qr()+500,fh(f,g));do try{vD();break}catch(Ie){Jb(f,Ie)}while(!0);yb(),ZE.current=H,Dr=V,as!==null?g=0:(Zs=null,Cs=0,g=Rs)}if(g!==0){if(g===2&&(V=Xo(f),V!==0&&(k=V,g=cv(f,V))),g===1)throw T=mo,fh(f,0),ud(f,k),Mo(f,qr()),T;if(g===6)ud(f,k);else{if(V=f.current.alternate,(k&30)===0&&!uv(V)&&(g=pu(f,k),g===2&&(H=Xo(f),H!==0&&(k=H,g=cv(f,H))),g===1))throw T=mo,fh(f,0),ud(f,k),Mo(f,qr()),T;switch(f.finishedWork=V,f.finishedLanes=k,g){case 0:case 1:throw Error(i(345));case 2:Xf(f,da,hu);break;case 3:if(ud(f,k),(k&130023424)===k&&(g=rv+500-qr(),10<g)){if(eu(f,0)!==0)break;if(V=f.suspendedLanes,(V&k)!==k){go(),f.pingedLanes|=f.suspendedLanes&V;break}f.timeoutHandle=s_(Xf.bind(null,f,da,hu),g);break}Xf(f,da,hu);break;case 4:if(ud(f,k),(k&4194240)===k)break;for(g=f.eventTimes,V=-1;0<k;){var le=31-fo(k);H=1<<le,le=g[le],le>V&&(V=le),k&=~H}if(k=V,k=qr()-k,k=(120>k?120:480>k?480:1080>k?1080:1920>k?1920:3e3>k?3e3:4320>k?4320:1960*ED(k/1960))-k,10<k){f.timeoutHandle=s_(Xf.bind(null,f,da,hu),k);break}Xf(f,da,hu);break;case 5:Xf(f,da,hu);break;default:throw Error(i(329))}}}return Mo(f,qr()),f.callbackNode===T?av.bind(null,f):null}function cv(f,g){var T=C_;return f.current.memoizedState.isDehydrated&&(fh(f,g).flags|=256),f=pu(f,g),f!==2&&(g=da,da=T,g!==null&&lv(g)),f}function lv(f){da===null?da=f:da.push.apply(da,f)}function uv(f){for(var g=f;;){if(g.flags&16384){var T=g.updateQueue;if(T!==null&&(T=T.stores,T!==null))for(var k=0;k<T.length;k++){var V=T[k],H=V.getSnapshot;V=V.value;try{if(!Tl(H(),V))return!1}catch{return!1}}}if(T=g.child,g.subtreeFlags&16384&&T!==null)T.return=g,g=T;else{if(g===f)break;for(;g.sibling===null;){if(g.return===null||g.return===f)return!0;g=g.return}g.sibling.return=g.return,g=g.sibling}}return!0}function ud(f,g){for(g&=~nv,g&=~tv,f.suspendedLanes|=g,f.pingedLanes&=~g,f=f.expirationTimes;0<g;){var T=31-fo(g),k=1<<T;f[T]=-1,g&=~k}}function Yf(f){if((Dr&6)!==0)throw Error(i(327));Vm();var g=eu(f,0);if((g&1)===0)return Mo(f,qr()),null;var T=pu(f,g);if(f.tag!==0&&T===2){var k=Xo(f);k!==0&&(g=k,T=cv(f,k))}if(T===1)throw T=mo,fh(f,0),ud(f,g),Mo(f,qr()),T;if(T===6)throw Error(i(345));return f.finishedWork=f.current.alternate,f.finishedLanes=g,Xf(f,da,hu),Mo(f,qr()),null}function I_(f,g){var T=Dr;Dr|=1;try{return f(g)}finally{Dr=T,Dr===0&&(Mm=qr()+500,CE&&sh())}}function dd(f){fu!==null&&fu.tag===0&&(Dr&6)===0&&Vm();var g=Dr;Dr|=1;var T=Wc.transition,k=cr;try{if(Wc.transition=null,cr=1,f)return f()}finally{cr=k,Wc.transition=T,Dr=g,(Dr&6)===0&&sh()}}function A_(){mc=wl.current,Vi(wl)}function fh(f,g){f.finishedWork=null,f.finishedLanes=0;var T=f.timeoutHandle;if(T!==-1&&(f.timeoutHandle=-1,iD(T)),as!==null)for(T=as.return;T!==null;){var k=T;switch(c_(k),k.tag){case 1:k=k.type.childContextTypes,k!=null&&bE();break;case 3:zf(),Vi(xa),Vi(No),wb();break;case 5:Im(k);break;case 4:zf();break;case 13:Vi(Gi);break;case 19:Vi(Gi);break;case 10:Eb(k.type._context);break;case 22:case 23:A_()}T=T.return}if(Zs=f,as=f=hd(f.current,null),Cs=mc=g,Rs=0,mo=null,nv=tv=Kf=0,da=C_=null,Bf!==null){for(g=0;g<Bf.length;g++)if(T=Bf[g],k=T.interleaved,k!==null){T.interleaved=null;var V=k.next,H=T.pending;if(H!==null){var le=H.next;H.next=V,k.next=le}T.pending=k}Bf=null}return f}function Jb(f,g){do{var T=as;try{if(yb(),xE.current=VE,Am){for(var k=Xi.memoizedState;k!==null;){var V=k.queue;V!==null&&(V.pending=null),k=k.next}Am=!1}if(lu=0,ws=Ts=Xi=null,g_=!1,__=0,ev.current=null,T===null||T.return===null){Rs=1,mo=g,as=null;break}e:{var H=f,le=T.return,Ie=T,Ue=g;if(g=Cs,Ie.flags|=32768,Ue!==null&&typeof Ue=="object"&&typeof Ue.then=="function"){var it=Ue,Ot=Ie,kt=Ot.tag;if((Ot.mode&1)===0&&(kt===0||kt===11||kt===15)){var Pt=Ot.alternate;Pt?(Ot.updateQueue=Pt.updateQueue,Ot.memoizedState=Pt.memoizedState,Ot.lanes=Pt.lanes):(Ot.updateQueue=null,Ot.memoizedState=null)}var Yt=II(le);if(Yt!==null){Yt.flags&=-257,AI(Yt,le,Ie,H,g),Yt.mode&1&&RI(H,it,g),g=Yt,Ue=it;var sn=g.updateQueue;if(sn===null){var on=new Set;on.add(Ue),g.updateQueue=on}else sn.add(Ue);break e}else{if((g&1)===0){RI(H,it,g),Qb();break e}Ue=Error(i(426))}}else if(Ei&&Ie.mode&1){var cs=II(le);if(cs!==null){(cs.flags&65536)===0&&(cs.flags|=256),AI(cs,le,Ie,H,g),gb(Nm(Ue,Ie));break e}}H=Ue=Nm(Ue,Ie),Rs!==4&&(Rs=2),C_===null?C_=[H]:C_.push(H),H=le;do{switch(H.tag){case 3:H.flags|=65536,g&=-g,H.lanes|=g;var Xe=Vb(H,Ue,g);uI(H,Xe);break e;case 1:Ie=Ue;var Fe=H.type,tt=H.stateNode;if((H.flags&128)===0&&(typeof Fe.getDerivedStateFromError=="function"||tt!==null&&typeof tt.componentDidCatch=="function"&&(hh===null||!hh.has(tt)))){H.flags|=65536,g&=-g,H.lanes|=g;var Lt=ld(H,Ie,g);uI(H,Lt);break e}}H=H.return}while(H!==null)}YI(T)}catch(cn){g=cn,as===T&&T!==null&&(as=T=T.return);continue}break}while(!0)}function KI(){var f=ZE.current;return ZE.current=VE,f===null?VE:f}function Qb(){(Rs===0||Rs===3||Rs===2)&&(Rs=4),Zs===null||(Kf&268435455)===0&&(tv&268435455)===0||ud(Zs,Cs)}function pu(f,g){var T=Dr;Dr|=2;var k=KI();(Zs!==f||Cs!==g)&&(hu=null,fh(f,g));do try{qI();break}catch(V){Jb(f,V)}while(!0);if(yb(),Dr=T,ZE.current=k,as!==null)throw Error(i(261));return Zs=null,Cs=0,Rs}function qI(){for(;as!==null;)dv(as)}function vD(){for(;as!==null&&!Yo();)dv(as)}function dv(f){var g=pv(f.alternate,f,mc);f.memoizedProps=f.pendingProps,g===null?YI(f):as=g,ev.current=null}function YI(f){var g=f;do{var T=g.alternate;if(f=g.return,(g.flags&32768)===0){if(T=YE(T,g,mc),T!==null){as=T;return}}else{if(T=yD(T,g),T!==null){T.flags&=32767,as=T;return}if(f!==null)f.flags|=32768,f.subtreeFlags=0,f.deletions=null;else{Rs=6,as=null;return}}if(g=g.sibling,g!==null){as=g;return}as=g=f}while(g!==null);Rs===0&&(Rs=5)}function Xf(f,g,T){var k=cr,V=Wc.transition;try{Wc.transition=null,cr=1,SD(f,g,T,k)}finally{Wc.transition=V,cr=k}return null}function SD(f,g,T,k){do Vm();while(fu!==null);if((Dr&6)!==0)throw Error(i(327));T=f.finishedWork;var V=f.finishedLanes;if(T===null)return null;if(f.finishedWork=null,f.finishedLanes=0,T===f.current)throw Error(i(177));f.callbackNode=null,f.callbackPriority=0;var H=T.lanes|T.childLanes;if(Zr(f,H),f===Zs&&(as=Zs=null,Cs=0),(T.subtreeFlags&2064)===0&&(T.flags&2064)===0||Um||(Um=!0,P_(Oa,function(){return Vm(),null})),H=(T.flags&15990)!==0,(T.subtreeFlags&15990)!==0||H){H=Wc.transition,Wc.transition=null;var le=cr;cr=1;var Ie=Dr;Dr|=4,ev.current=null,zb(f,T),Kb(T,f),sb(i_),Ce=!!SE,i_=SE=null,f.current=T,Lm(T),Yd(),Dr=Ie,cr=le,Wc.transition=H}else f.current=T;if(Um&&(Um=!1,fu=f,sv=V),H=f.pendingLanes,H===0&&(hh=null),im(T.stateNode),Mo(f,qr()),g!==null)for(k=f.onRecoverableError,T=0;T<g.length;T++)V=g[T],k(V.value,{componentStack:V.stack,digest:V.digest});if(iv)throw iv=!1,f=Yb,Yb=null,f;return(sv&1)!==0&&f.tag!==0&&Vm(),H=f.pendingLanes,(H&1)!==0?f===Xb?qf++:(qf=0,Xb=f):qf=0,sh(),null}function Vm(){if(fu!==null){var f=Oc(sv),g=Wc.transition,T=cr;try{if(Wc.transition=null,cr=16>f?16:f,fu===null)var k=!1;else{if(f=fu,fu=null,sv=0,(Dr&6)!==0)throw Error(i(331));var V=Dr;for(Dr|=4,nn=f.current;nn!==null;){var H=nn,le=H.child;if((nn.flags&16)!==0){var Ie=H.deletions;if(Ie!==null){for(var Ue=0;Ue<Ie.length;Ue++){var it=Ie[Ue];for(nn=it;nn!==null;){var Ot=nn;switch(Ot.tag){case 0:case 11:case 15:b_(8,Ot,H)}var kt=Ot.child;if(kt!==null)kt.return=Ot,nn=kt;else for(;nn!==null;){Ot=nn;var Pt=Ot.sibling,Yt=Ot.return;if(WI(Ot),Ot===it){nn=null;break}if(Pt!==null){Pt.return=Yt,nn=Pt;break}nn=Yt}}}var sn=H.alternate;if(sn!==null){var on=sn.child;if(on!==null){sn.child=null;do{var cs=on.sibling;on.sibling=null,on=cs}while(on!==null)}}nn=H}}if((H.subtreeFlags&2064)!==0&&le!==null)le.return=H,nn=le;else e:for(;nn!==null;){if(H=nn,(H.flags&2048)!==0)switch(H.tag){case 0:case 11:case 15:b_(9,H,H.return)}var Xe=H.sibling;if(Xe!==null){Xe.return=H.return,nn=Xe;break e}nn=H.return}}var Fe=f.current;for(nn=Fe;nn!==null;){le=nn;var tt=le.child;if((le.subtreeFlags&2064)!==0&&tt!==null)tt.return=le,nn=tt;else e:for(le=Fe;nn!==null;){if(Ie=nn,(Ie.flags&2048)!==0)try{switch(Ie.tag){case 0:case 11:case 15:T_(9,Ie)}}catch(cn){Ji(Ie,Ie.return,cn)}if(Ie===le){nn=null;break e}var Lt=Ie.sibling;if(Lt!==null){Lt.return=Ie.return,nn=Lt;break e}nn=Ie.return}}if(Dr=V,sh(),ko&&typeof ko.onPostCommitFiberRoot=="function")try{ko.onPostCommitFiberRoot(Ql,f)}catch{}k=!0}return k}finally{cr=T,Wc.transition=g}}return!1}function hv(f,g,T){g=Nm(T,g),g=Vb(f,g,1),f=ch(f,g,1),g=go(),f!==null&&(tu(f,1,g),Mo(f,g))}function Ji(f,g,T){if(f.tag===3)hv(f,f,T);else for(;g!==null;){if(g.tag===3){hv(g,f,T);break}else if(g.tag===1){var k=g.stateNode;if(typeof g.type.getDerivedStateFromError=="function"||typeof k.componentDidCatch=="function"&&(hh===null||!hh.has(k))){f=Nm(T,f),f=ld(g,f,1),g=ch(g,f,1),f=go(),g!==null&&(tu(g,1,f),Mo(g,f));break}}g=g.return}}function XI(f,g,T){var k=f.pingCache;k!==null&&k.delete(g),g=go(),f.pingedLanes|=f.suspendedLanes&T,Zs===f&&(Cs&T)===T&&(Rs===4||Rs===3&&(Cs&130023424)===Cs&&500>qr()-rv?fh(f,0):nv|=T),Mo(f,g)}function Zb(f,g){g===0&&((f.mode&1)===0?g=1:(g=Er,Er<<=1,(Er&130023424)===0&&(Er=4194304)));var T=go();f=od(f,g),f!==null&&(tu(f,g,T),Mo(f,T))}function fv(f){var g=f.memoizedState,T=0;g!==null&&(T=g.retryLane),Zb(f,T)}function JI(f,g){var T=0;switch(f.tag){case 13:var k=f.stateNode,V=f.memoizedState;V!==null&&(T=V.retryLane);break;case 19:k=f.stateNode;break;default:throw Error(i(314))}k!==null&&k.delete(g),Zb(f,T)}var pv;pv=function(f,g,T){if(f!==null)if(f.memoizedProps!==g.pendingProps||xa.current)Fa=!0;else{if((f.lanes&T)===0&&(g.flags&128)===0)return Fa=!1,UI(f,g,T);Fa=(f.flags&131072)!==0}else Fa=!1,Ei&&(g.flags&1048576)!==0&&IE(g,RE,g.index);switch(g.lanes=0,g.tag){case 2:var k=g.type;KE(f,g),f=g.pendingProps;var V=Ff(g,No.current);sd(g,T),V=Pm(null,g,k,f,V,T);var H=Ib();return g.flags|=1,typeof V=="object"&&V!==null&&typeof V.render=="function"&&V.$$typeof===void 0?(g.tag=1,g.memoizedState=null,g.updateQueue=null,La(k)?(H=!0,wE(g)):H=!1,g.memoizedState=V.state!==null&&V.state!==void 0?V.state:null,h_(g),V.updater=jE,g.stateNode=V,V._reactInternals=g,Lb(g,k,f,T),g=WE(null,g,k,!0,H,T)):(g.tag=0,Ei&&H&&AE(g),la(null,g,V,T),g=g.child),g;case 16:k=g.elementType;e:{switch(KE(f,g),f=g.pendingProps,V=k._init,k=V(k._payload),g.type=k,V=g.tag=Jf(k),f=pc(k,f),V){case 0:g=Fb(null,g,k,f,T);break e;case 1:g=DI(null,g,k,f,T);break e;case 11:g=BE(null,g,k,f,T);break e;case 14:g=PI(null,g,k,pc(k.type,f),T);break e}throw Error(i(306,k,""))}return g;case 0:return k=g.type,V=g.pendingProps,V=g.elementType===k?V:pc(k,V),Fb(f,g,k,V,T);case 1:return k=g.type,V=g.pendingProps,V=g.elementType===k?V:pc(k,V),DI(f,g,k,V,T);case 3:e:{if(jb(g),f===null)throw Error(i(387));k=g.pendingProps,H=g.memoizedState,V=H.element,lI(f,g),DE(g,k,null,T);var le=g.memoizedState;if(k=le.element,H.isDehydrated)if(H={element:k,isDehydrated:!1,cache:le.cache,pendingSuspenseBoundaries:le.pendingSuspenseBoundaries,transitions:le.transitions},g.updateQueue.baseState=H,g.memoizedState=H,g.flags&256){V=Nm(Error(i(423)),g),g=xI(f,g,k,T,V);break e}else if(k!==V){V=Nm(Error(i(424)),g),g=xI(f,g,k,T,V);break e}else for(Ua=nh(g.stateNode.containerInfo.firstChild),Ma=g,Ei=!0,aa=null,T=aI(g,null,k,T),g.child=T;T;)T.flags=T.flags&-3|4096,T=T.sibling;else{if(Tm(),k===V){g=uu(f,g,T);break e}la(f,g,k,T)}g=g.child}return g;case 5:return hI(g),f===null&&mb(g),k=g.type,V=g.pendingProps,H=f!==null?f.memoizedProps:null,le=V.children,db(k,V)?le=null:H!==null&&db(k,H)&&(g.flags|=32),NI(f,g),la(f,g,le,T),g.child;case 6:return f===null&&mb(g),null;case 13:return zE(f,g,T);case 4:return bb(g,g.stateNode.containerInfo),k=g.pendingProps,f===null?g.child=wm(g,null,k,T):la(f,g,k,T),g.child;case 11:return k=g.type,V=g.pendingProps,V=g.elementType===k?V:pc(k,V),BE(f,g,k,V,T);case 7:return la(f,g,g.pendingProps,T),g.child;case 8:return la(f,g,g.pendingProps.children,T),g.child;case 12:return la(f,g,g.pendingProps.children,T),g.child;case 10:e:{if(k=g.type._context,V=g.pendingProps,H=g.memoizedProps,le=V.value,Pi(kE,k._currentValue),k._currentValue=le,H!==null)if(Tl(H.value,le)){if(H.children===V.children&&!xa.current){g=uu(f,g,T);break e}}else for(H=g.child,H!==null&&(H.return=g);H!==null;){var Ie=H.dependencies;if(Ie!==null){le=H.child;for(var Ue=Ie.firstContext;Ue!==null;){if(Ue.context===k){if(H.tag===1){Ue=au(-1,T&-T),Ue.tag=2;var it=H.updateQueue;if(it!==null){it=it.shared;var Ot=it.pending;Ot===null?Ue.next=Ue:(Ue.next=Ot.next,Ot.next=Ue),it.pending=Ue}}H.lanes|=T,Ue=H.alternate,Ue!==null&&(Ue.lanes|=T),vb(H.return,T,g),Ie.lanes|=T;break}Ue=Ue.next}}else if(H.tag===10)le=H.type===g.type?null:H.child;else if(H.tag===18){if(le=H.return,le===null)throw Error(i(341));le.lanes|=T,Ie=le.alternate,Ie!==null&&(Ie.lanes|=T),vb(le,T,g),le=H.sibling}else le=H.child;if(le!==null)le.return=H;else for(le=H;le!==null;){if(le===g){le=null;break}if(H=le.sibling,H!==null){H.return=le.return,le=H;break}le=le.return}H=le}la(f,g,V.children,T),g=g.child}return g;case 9:return V=g.type,k=g.pendingProps.children,sd(g,T),V=Fc(V),k=k(V),g.flags|=1,la(f,g,k,T),g.child;case 14:return k=g.type,V=pc(k,g.pendingProps),V=pc(k.type,V),PI(f,g,k,V,T);case 15:return OI(f,g,g.type,g.pendingProps,T);case 17:return k=g.type,V=g.pendingProps,V=g.elementType===k?V:pc(k,V),KE(f,g),g.tag=1,La(k)?(f=!0,wE(g)):f=!1,sd(g,T),wI(g,k,V),Lb(g,k,V,T),WE(null,g,k,!0,f,T);case 19:return $E(f,g,T);case 22:return kI(f,g,T)}throw Error(i(156,g.tag))};function P_(f,g){return qd(f,g)}function mv(f,g,T,k){this.tag=f,this.key=T,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=g,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=k,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function gc(f,g,T,k){return new mv(f,g,T,k)}function ph(f){return f=f.prototype,!(!f||!f.isReactComponent)}function Jf(f){if(typeof f=="function")return ph(f)?1:0;if(f!=null){if(f=f.$$typeof,f===he)return 11;if(f===We)return 14}return 2}function hd(f,g){var T=f.alternate;return T===null?(T=gc(f.tag,g,f.key,f.mode),T.elementType=f.elementType,T.type=f.type,T.stateNode=f.stateNode,T.alternate=f,f.alternate=T):(T.pendingProps=g,T.type=f.type,T.flags=0,T.subtreeFlags=0,T.deletions=null),T.flags=f.flags&14680064,T.childLanes=f.childLanes,T.lanes=f.lanes,T.child=f.child,T.memoizedProps=f.memoizedProps,T.memoizedState=f.memoizedState,T.updateQueue=f.updateQueue,g=f.dependencies,T.dependencies=g===null?null:{lanes:g.lanes,firstContext:g.firstContext},T.sibling=f.sibling,T.index=f.index,T.ref=f.ref,T}function gv(f,g,T,k,V,H){var le=2;if(k=f,typeof f=="function")ph(f)&&(le=1);else if(typeof f=="string")le=5;else e:switch(f){case Q:return Qf(T.children,V,H,g);case Z:le=8,V|=8;break;case X:return f=gc(12,T,g,V|2),f.elementType=X,f.lanes=H,f;case ue:return f=gc(13,T,g,V),f.elementType=ue,f.lanes=H,f;case xe:return f=gc(19,T,g,V),f.elementType=xe,f.lanes=H,f;case ve:return mh(T,V,H,g);default:if(typeof f=="object"&&f!==null)switch(f.$$typeof){case re:le=10;break e;case pe:le=9;break e;case he:le=11;break e;case We:le=14;break e;case $e:le=16,k=null;break e}throw Error(i(130,f==null?f:typeof f,""))}return g=gc(le,T,g,V),g.elementType=f,g.type=k,g.lanes=H,g}function Qf(f,g,T,k){return f=gc(7,f,k,g),f.lanes=T,f}function mh(f,g,T,k){return f=gc(22,f,k,g),f.elementType=ve,f.lanes=T,f.stateNode={isHidden:!1},f}function eT(f,g,T){return f=gc(6,f,null,g),f.lanes=T,f}function tT(f,g,T){return g=gc(4,f.children!==null?f.children:[],f.key,g),g.lanes=T,g.stateNode={containerInfo:f.containerInfo,pendingChildren:null,implementation:f.implementation},g}function bD(f,g,T,k,V){this.tag=g,this.containerInfo=f,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=El(0),this.expirationTimes=El(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=El(0),this.identifierPrefix=k,this.onRecoverableError=V,this.mutableSourceEagerHydrationData=null}function nT(f,g,T,k,V,H,le,Ie,Ue){return f=new bD(f,g,T,Ie,Ue),g===1?(g=1,H===!0&&(g|=8)):g=0,H=gc(3,null,null,g),f.current=H,H.stateNode=f,H.memoizedState={element:k,isDehydrated:T,cache:null,transitions:null,pendingSuspenseBoundaries:null},h_(H),f}function TD(f,g,T){var k=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:de,key:k==null?null:""+k,children:f,containerInfo:g,implementation:T}}function QI(f){if(!f)return ih;f=f._reactInternals;e:{if(Ri(f)!==f||f.tag!==1)throw Error(i(170));var g=f;do{switch(g.tag){case 3:g=g.stateNode.context;break e;case 1:if(La(g.type)){g=g.stateNode.__reactInternalMemoizedMergedChildContext;break e}}g=g.return}while(g!==null);throw Error(i(171))}if(f.tag===1){var T=f.type;if(La(T))return TE(f,T,g)}return g}function _v(f,g,T,k,V,H,le,Ie,Ue){return f=nT(T,k,!0,f,V,H,le,Ie,Ue),f.context=QI(null),T=f.current,k=go(),V=zc(T),H=au(k,V),H.callback=g??null,ch(T,H,V),f.current.lanes=V,tu(f,V,k),Mo(f,k),f}function O_(f,g,T,k){var V=g.current,H=go(),le=zc(V);return T=QI(T),g.context===null?g.context=T:g.pendingContext=T,g=au(H,le),g.payload={element:f},k=k===void 0?null:k,k!==null&&(g.callback=k),f=ch(V,g,le),f!==null&&(Gc(f,V,le,H),f_(f,V,le)),le}function yv(f){if(f=f.current,!f.child)return null;switch(f.child.tag){case 5:return f.child.stateNode;default:return f.child.stateNode}}function rT(f,g){if(f=f.memoizedState,f!==null&&f.dehydrated!==null){var T=f.retryLane;f.retryLane=T!==0&&T<g?T:g}}function iT(f,g){rT(f,g),(f=f.alternate)&&rT(f,g)}function k_(){return null}var Cl=typeof reportError=="function"?reportError:function(f){console.error(f)};function Ev(f){this._internalRoot=f}vv.prototype.render=Ev.prototype.render=function(f){var g=this._internalRoot;if(g===null)throw Error(i(409));O_(f,g,null,null)},vv.prototype.unmount=Ev.prototype.unmount=function(){var f=this._internalRoot;if(f!==null){this._internalRoot=null;var g=f.containerInfo;dd(function(){O_(null,f,null,null)}),g[Lc]=null}};function vv(f){this._internalRoot=f}vv.prototype.unstable_scheduleHydration=function(f){if(f){var g=Rf();f={blockedOn:null,target:f,priority:g};for(var T=0;T<ta.length&&g!==0&&g<ta[T].priority;T++);ta.splice(T,0,f),T===0&&Af(f)}};function sT(f){return!(!f||f.nodeType!==1&&f.nodeType!==9&&f.nodeType!==11)}function Fm(f){return!(!f||f.nodeType!==1&&f.nodeType!==9&&f.nodeType!==11&&(f.nodeType!==8||f.nodeValue!==" react-mount-point-unstable "))}function oT(){}function wD(f,g,T,k,V){if(V){if(typeof k=="function"){var H=k;k=function(){var it=yv(le);H.call(it)}}var le=_v(g,k,f,0,null,!1,!1,"",oT);return f._reactRootContainer=le,f[Lc]=le.current,xf(f.nodeType===8?f.parentNode:f),dd(),le}for(;V=f.lastChild;)f.removeChild(V);if(typeof k=="function"){var Ie=k;k=function(){var it=yv(Ue);Ie.call(it)}}var Ue=nT(f,0,!1,null,null,!1,!1,"",oT);return f._reactRootContainer=Ue,f[Lc]=Ue.current,xf(f.nodeType===8?f.parentNode:f),dd(function(){O_(g,Ue,T,k)}),Ue}function Zf(f,g,T,k,V){var H=T._reactRootContainer;if(H){var le=H;if(typeof V=="function"){var Ie=V;V=function(){var Ue=yv(le);Ie.call(Ue)}}O_(g,le,f,V)}else le=wD(T,g,f,V,k);return yv(le)}sm=function(f){switch(f.tag){case 3:var g=f.stateNode;if(g.current.memoizedState.isDehydrated){var T=Zl(g.pendingLanes);T!==0&&(lc(g,T|1),Mo(g,qr()),(Dr&6)===0&&(Mm=qr()+500,sh()))}break;case 13:dd(function(){var k=od(f,1);if(k!==null){var V=go();Gc(k,f,1,V)}}),iT(f,1)}},nu=function(f){if(f.tag===13){var g=od(f,134217728);if(g!==null){var T=go();Gc(g,f,134217728,T)}iT(f,134217728)}},Zd=function(f){if(f.tag===13){var g=zc(f),T=od(f,g);if(T!==null){var k=go();Gc(T,f,g,k)}iT(f,g)}},Rf=function(){return cr},om=function(f,g){var T=cr;try{return cr=f,g()}finally{cr=T}},Ac=function(f,g,T){switch(g){case"input":if(Kt(f,T),g=T.name,T.type==="radio"&&g!=null){for(T=f;T.parentNode;)T=T.parentNode;for(T=T.querySelectorAll("input[name="+JSON.stringify(""+g)+'][type="radio"]'),g=0;g<T.length;g++){var k=T[g];if(k!==f&&k.form===f.form){var V=vm(k);if(!V)throw Error(i(90));Ft(k),Kt(k,V)}}}break;case"textarea":Wt(f,T);break;case"select":g=T.value,g!=null&&ft(f,!!T.multiple,g,!1)}},ml=I_,Pa=dd;var gh={usingClientEntryPoint:!1,Events:[Em,Uf,vm,Aa,sc,I_]},fd={findFiberByHostInstance:Mf,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},CD={bundleType:fd.bundleType,version:fd.version,rendererPackageName:fd.rendererPackageName,rendererConfig:fd.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:ce.ReactCurrentDispatcher,findHostInstanceByFiber:function(f){return f=Kd(f),f===null?null:f.stateNode},findFiberByHostInstance:fd.findFiberByHostInstance||k_,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Sv=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Sv.isDisabled&&Sv.supportsFiber)try{Ql=Sv.inject(CD),ko=Sv}catch{}}return il.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=gh,il.createPortal=function(f,g){var T=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!sT(g))throw Error(i(200));return TD(f,g,null,T)},il.createRoot=function(f,g){if(!sT(f))throw Error(i(299));var T=!1,k="",V=Cl;return g!=null&&(g.unstable_strictMode===!0&&(T=!0),g.identifierPrefix!==void 0&&(k=g.identifierPrefix),g.onRecoverableError!==void 0&&(V=g.onRecoverableError)),g=nT(f,1,!1,null,null,T,!1,k,V),f[Lc]=g.current,xf(f.nodeType===8?f.parentNode:f),new Ev(g)},il.findDOMNode=function(f){if(f==null)return null;if(f.nodeType===1)return f;var g=f._reactInternals;if(g===void 0)throw typeof f.render=="function"?Error(i(188)):(f=Object.keys(f).join(","),Error(i(268,f)));return f=Kd(g),f=f===null?null:f.stateNode,f},il.flushSync=function(f){return dd(f)},il.hydrate=function(f,g,T){if(!Fm(g))throw Error(i(200));return Zf(null,f,g,!0,T)},il.hydrateRoot=function(f,g,T){if(!sT(f))throw Error(i(405));var k=T!=null&&T.hydratedSources||null,V=!1,H="",le=Cl;if(T!=null&&(T.unstable_strictMode===!0&&(V=!0),T.identifierPrefix!==void 0&&(H=T.identifierPrefix),T.onRecoverableError!==void 0&&(le=T.onRecoverableError)),g=_v(g,null,f,1,T??null,V,!1,H,le),f[Lc]=g.current,xf(f),k)for(f=0;f<k.length;f++)T=k[f],V=T._getVersion,V=V(T._source),g.mutableSourceEagerHydrationData==null?g.mutableSourceEagerHydrationData=[T,V]:g.mutableSourceEagerHydrationData.push(T,V);return new vv(g)},il.render=function(f,g,T){if(!Fm(g))throw Error(i(200));return Zf(null,f,g,!1,T)},il.unmountComponentAtNode=function(f){if(!Fm(f))throw Error(i(40));return f._reactRootContainer?(dd(function(){Zf(null,null,f,!1,function(){f._reactRootContainer=null,f[Lc]=null})}),!0):!1},il.unstable_batchedUpdates=I_,il.unstable_renderSubtreeIntoContainer=function(f,g,T,k){if(!Fm(T))throw Error(i(200));if(f==null||f._reactInternals===void 0)throw Error(i(38));return Zf(f,g,T,!1,k)},il.version="18.3.1-next-f1338f8080-20240426",il}var DK;function EZ(){if(DK)return yM.exports;DK=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(e){console.error(e)}}return n(),yM.exports=uEe(),yM.exports}var xK;function dEe(){if(xK)return _O;xK=1;var n=EZ();return _O.createRoot=n.createRoot,_O.hydrateRoot=n.hydrateRoot,_O}var hEe=dEe();const A1=Bg(hEe);function fEe(n,e,i,o){return n.addEventListener(e,i,o),()=>{n.removeEventListener(e,i,o)}}function P1(n){return n!=null&&typeof n=="object"&&"nodeType"in n&&n.nodeType===Node.ELEMENT_NODE}function pEe(){return!!(globalThis!=null&&globalThis.document)}function vZ(n){return n.parentElement&&vZ(n.parentElement)?!0:n.hidden}function mEe(n){const e=n.getAttribute("contenteditable");return e!=="false"&&e!=null}function gEe(n){return!!n.getAttribute("disabled")||!!n.getAttribute("aria-disabled")}function _Ee(n){var e;return((e=SZ(n))==null?void 0:e.defaultView)??window}function SZ(n){return P1(n)?n.ownerDocument:document}function yEe(n){return n.view??window}function EEe(n){return SZ(n).activeElement}function vEe(n){const e=yEe(n);return typeof e.PointerEvent<"u"&&n instanceof e.PointerEvent?n.pointerType==="mouse":n instanceof e.MouseEvent}function bZ(n){return!!n.touches}function SEe(n){return bZ(n)&&n.touches.length>1}function bEe(n,e="page"){const i=n.touches[0]||n.changedTouches[0];return{x:i[`${e}X`],y:i[`${e}Y`]}}function TEe(n,e="page"){return{x:n[`${e}X`],y:n[`${e}Y`]}}function TZ(n,e="page"){return bZ(n)?bEe(n,e):TEe(n,e)}function wEe(n){return e=>{const i=vEe(e);(!i||i&&e.button===0)&&n(e)}}function CEe(n,e=!1){function i(l){n(l,{point:TZ(l)})}return e?wEe(i):i}function JO(n,e,i,o){return fEe(n,e,CEe(i,e==="pointerdown"),o)}function REe(n,...e){if(n==null)throw new TypeError("Cannot convert undefined or null to object");const i={...n};for(const o of e)if(o!=null)for(const l in o)Object.prototype.hasOwnProperty.call(o,l)&&(l in i&&delete i[l],i[l]=o[l]);return i}const er=n=>n?"":void 0,xp=n=>n?!0:void 0;function IEe(n){return Array.isArray(n)}function Fu(n){const e=typeof n;return n!=null&&(e==="object"||e==="function")&&!IEe(n)}function AEe(n){const e=n==null?0:n.length;return e?n[e-1]:void 0}function PEe(n){const e=parseFloat(n.toString()),i=n.toString().replace(String(e),"");return{unitless:!i,value:e,unit:i}}function $U(n){if(n==null)return n;const{unitless:e}=PEe(n);return e||typeof n=="number"?`${n}px`:n}const wZ=(n,e)=>parseInt(n[1],10)>parseInt(e[1],10)?1:-1,DF=n=>Object.fromEntries(Object.entries(n).sort(wZ));function LK(n){const e=DF(n);return Object.assign(Object.values(e),e)}function OEe(n){const e=Object.keys(DF(n));return new Set(e)}function MK(n){if(!n)return n;n=$U(n)??n;const e=-.02;return typeof n=="number"?`${n+e}`:n.replace(/(\d+\.?\d*)/u,i=>`${parseFloat(i)+e}`)}function jw(n,e){const i=["@media screen"];return n&&i.push("and",`(min-width: ${$U(n)})`),e&&i.push("and",`(max-width: ${$U(e)})`),i.join(" ")}function kEe(n){if(!n)return null;n.base=n.base??"0px";const e=LK(n),i=Object.entries(n).sort(wZ).map(([d,p],_,E)=>{let[,b]=E[_+1]??[];return b=parseFloat(b)>0?MK(b):void 0,{_minW:MK(p),breakpoint:d,minW:p,maxW:b,maxWQuery:jw(null,b),minWQuery:jw(p),minMaxQuery:jw(p,b)}}),o=OEe(n),l=Array.from(o.values());return{keys:o,normalized:e,isResponsive(d){const p=Object.keys(d);return p.length>0&&p.every(_=>o.has(_))},asObject:DF(n),asArray:LK(n),details:i,get(d){return i.find(p=>p.breakpoint===d)},media:[null,...e.map(d=>jw(d)).slice(1)],toArrayValue(d){if(!Fu(d))throw new Error("toArrayValue: value must be an object");const p=l.map(_=>d[_]??null);for(;AEe(p)===null;)p.pop();return p},toObjectValue(d){if(!Array.isArray(d))throw new Error("toObjectValue: value must be an array");return d.reduce((p,_,E)=>{const b=l[E];return b!=null&&_!=null&&(p[b]=_),p},{})}}}function CZ(...n){return function(...i){n.forEach(o=>o==null?void 0:o(...i))}}function kn(...n){return function(i){n.some(o=>(o==null||o(i),i==null?void 0:i.defaultPrevented))}}function xF(n){return N.Children.toArray(n).filter(e=>N.isValidElement(e))}function O1(n){const e=Object.assign({},n);for(let i in e)e[i]===void 0&&delete e[i];return e}function NEe(n,e){return`${n} returned \`undefined\`. Seems you forgot to wrap component within ${e}`}function xi(n={}){const{name:e,strict:i=!0,hookName:o="useContext",providerName:l="Provider",errorMessage:d,defaultValue:p}=n,_=N.createContext(p);_.displayName=e;function E(){var C;const b=N.useContext(_);if(!b&&i){const I=new Error(d??NEe(o,l));throw I.name="ContextError",(C=Error.captureStackTrace)==null||C.call(Error,I,E),I}return b}return[_.Provider,E,_]}const dn=(...n)=>n.filter(Boolean).join(" "),RZ=n=>n.hasAttribute("tabindex"),DEe=n=>RZ(n)&&n.tabIndex===-1;function Vk(n){if(!P1(n)||vZ(n)||gEe(n))return!1;const{localName:e}=n;if(["input","select","textarea","button"].indexOf(e)>=0)return!0;const o={a:()=>n.hasAttribute("href"),audio:()=>n.hasAttribute("controls"),video:()=>n.hasAttribute("controls")};return e in o?o[e]():mEe(n)?!0:RZ(n)}function xEe(n){return n?P1(n)&&Vk(n)&&!DEe(n):!1}const LEe=["input:not(:disabled):not([disabled])","select:not(:disabled):not([disabled])","textarea:not(:disabled):not([disabled])","embed","iframe","object","a[href]","area[href]","button:not(:disabled):not([disabled])","[tabindex]","audio[controls]","video[controls]","*[tabindex]:not([aria-disabled])","*[contenteditable]"],MEe=LEe.join(),UEe=n=>n.offsetWidth>0&&n.offsetHeight>0;function IZ(n){const e=Array.from(n.querySelectorAll(MEe));return e.unshift(n),e.filter(i=>Vk(i)&&UEe(i))}function VEe(n,e,i,o){const l=typeof e=="string"?e.split("."):[e];for(o=0;o<l.length&&n;o+=1)n=n[l[o]];return n===void 0?i:n}const FEe=n=>{const e=new WeakMap;return(o,l,d,p)=>{if(typeof o>"u")return n(o,l,d);e.has(o)||e.set(o,new Map);const _=e.get(o);if(_.has(l))return _.get(l);const E=n(o,l,d,p);return _.set(l,E),E}},AZ=FEe(VEe),jEe=n=>n.default||n;function LF(n){const{wasSelected:e,enabled:i,isSelected:o,mode:l="unmount"}=n;return!!(!i||o||l==="keepMounted"&&e)}function BEe(n){const e=parseFloat(n);return typeof e!="number"||Number.isNaN(e)?0:e}function MF(n,e){let i=BEe(n);const o=10**(e??10);return i=Math.round(i*o)/o,e?i.toFixed(e):i.toString()}function KU(n){if(!Number.isFinite(n))return 0;let e=1,i=0;for(;Math.round(n*e)/e!==n;)e*=10,i+=1;return i}function UK(n,e,i){return(n-e)*100/(i-e)}function WEe(n,e,i){return(i-e)*n+e}function VK(n,e,i){const o=Math.round((n-e)/i)*i+e,l=KU(i);return MF(o,l)}function QO(n,e,i){return n==null?n:(i<e&&console.warn("clamp: max cannot be less than min"),Math.min(Math.max(n,e),i))}function W0(n,e=[]){const i=Object.assign({},n);for(const o of e)o in i&&delete i[o];return i}function PZ(n,e){const i={};for(const o of e)o in n&&(i[o]=n[o]);return i}function k1(n,e){return Array.isArray(n)?n.map(i=>i===null?null:e(i)):Fu(n)?Object.keys(n).reduce((i,o)=>(i[o]=e(n[o]),i),{}):n!=null?e(n):null}const zEe=n=>typeof n=="function";function ul(n,...e){return zEe(n)?n(...e):n}function GEe(n){const e=n.ownerDocument.defaultView||window,{overflow:i,overflowX:o,overflowY:l}=e.getComputedStyle(n);return/auto|scroll|overlay|hidden/.test(i+l+o)}function HEe(n){return n.localName==="html"?n:n.assignedSlot||n.parentElement||n.ownerDocument.documentElement}function OZ(n){return["html","body","#document"].includes(n.localName)?n.ownerDocument.body:P1(n)&&GEe(n)?n:OZ(HEe(n))}function $Ee(n,e){const i={},o={};for(const[l,d]of Object.entries(n))e.includes(l)?i[l]=d:o[l]=d;return[i,o]}function KEe(n,...e){const i=Object.getOwnPropertyDescriptors(n),o=Object.keys(i),l=p=>{const _={};for(let E=0;E<p.length;E++){const b=p[E];i[b]&&(Object.defineProperty(_,b,i[b]),delete i[b])}return _},d=p=>l(Array.isArray(p)?p:o.filter(p));return e.map(d).concat(l(o))}function FK(n,e,i={}){const{stop:o,getKey:l}=i;function d(p,_=[]){if(Fu(p)||Array.isArray(p)){const E={};for(const[b,C]of Object.entries(p)){const I=(l==null?void 0:l(b))??b,O=[..._,I];if(o!=null&&o(p,O))return e(p,_);E[I]=d(C,O)}return E}return e(p,_)}return d(n)}var Bw={exports:{}};Bw.exports;var jK;function qEe(){return jK||(jK=1,function(n,e){var i=200,o="__lodash_hash_undefined__",l=800,d=16,p=9007199254740991,_="[object Arguments]",E="[object Array]",b="[object AsyncFunction]",C="[object Boolean]",I="[object Date]",O="[object Error]",L="[object Function]",U="[object GeneratorFunction]",B="[object Map]",W="[object Number]",J="[object Null]",$="[object Object]",ie="[object Proxy]",ce="[object RegExp]",ne="[object Set]",de="[object String]",Q="[object Undefined]",Z="[object WeakMap]",X="[object ArrayBuffer]",re="[object DataView]",pe="[object Float32Array]",he="[object Float64Array]",ue="[object Int8Array]",xe="[object Int16Array]",We="[object Int32Array]",$e="[object Uint8Array]",ve="[object Uint8ClampedArray]",_e="[object Uint16Array]",Ee="[object Uint32Array]",ke=/[\\^$.*+?()[\]{}|]/g,Te=/^\[object .+?Constructor\]$/,be=/^(?:0|[1-9]\d*)$/,Pe={};Pe[pe]=Pe[he]=Pe[ue]=Pe[xe]=Pe[We]=Pe[$e]=Pe[ve]=Pe[_e]=Pe[Ee]=!0,Pe[_]=Pe[E]=Pe[X]=Pe[C]=Pe[re]=Pe[I]=Pe[O]=Pe[L]=Pe[B]=Pe[W]=Pe[$]=Pe[ce]=Pe[ne]=Pe[de]=Pe[Z]=!1;var Le=typeof wy=="object"&&wy&&wy.Object===Object&&wy,ze=typeof self=="object"&&self&&self.Object===Object&&self,Je=Le||ze||Function("return this")(),et=e&&!e.nodeType&&e,ut=et&&!0&&n&&!n.nodeType&&n,rt=ut&&ut.exports===et,It=rt&&Le.process,pn=function(){try{var Ce=ut&&ut.require&&ut.require("util").types;return Ce||It&&It.binding&&It.binding("util")}catch{}}(),Ft=pn&&pn.isTypedArray;function an(Ce,De,nt){switch(nt.length){case 0:return Ce.call(De);case 1:return Ce.call(De,nt[0]);case 2:return Ce.call(De,nt[0],nt[1]);case 3:return Ce.call(De,nt[0],nt[1],nt[2])}return Ce.apply(De,nt)}function en(Ce,De){for(var nt=-1,Qt=Array(Ce);++nt<Ce;)Qt[nt]=De(nt);return Qt}function Xt(Ce){return function(De){return Ce(De)}}function Vn(Ce,De){return Ce==null?void 0:Ce[De]}function Kt(Ce,De){return function(nt){return Ce(De(nt))}}var Re=Array.prototype,Ve=Function.prototype,Ge=Object.prototype,ft=Je["__core-js_shared__"],gt=Ve.toString,St=Ge.hasOwnProperty,Wt=function(){var Ce=/[^.]+$/.exec(ft&&ft.keys&&ft.keys.IE_PROTO||"");return Ce?"Symbol(src)_1."+Ce:""}(),mn=Ge.toString,vn=gt.call(Object),tn=RegExp("^"+gt.call(St).replace(ke,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),vt=rt?Je.Buffer:void 0,nr=Je.Symbol,Dt=Je.Uint8Array;vt&&vt.allocUnsafe;var Ut=Kt(Object.getPrototypeOf,Object),gn=Object.create,Li=Ge.propertyIsEnumerable,Es=Re.splice,ci=nr?nr.toStringTag:void 0,qo=function(){try{var Ce=cc(Object,"defineProperty");return Ce({},"",{}),Ce}catch{}}(),ic=vt?vt.isBuffer:void 0,Xs=Math.max,Js=Date.now,Ac=cc(Je,"Map"),vs=cc(Object,"create"),Ia=function(){function Ce(){}return function(De){if(!kc(De))return{};if(gn)return gn(De);Ce.prototype=De;var nt=new Ce;return Ce.prototype=void 0,nt}}();function Po(Ce){var De=-1,nt=Ce==null?0:Ce.length;for(this.clear();++De<nt;){var Qt=Ce[De];this.set(Qt[0],Qt[1])}}function Aa(){this.__data__=vs?vs(null):{},this.size=0}function sc(Ce){var De=this.has(Ce)&&delete this.__data__[Ce];return this.size-=De?1:0,De}function ml(Ce){var De=this.__data__;if(vs){var nt=De[Ce];return nt===o?void 0:nt}return St.call(De,Ce)?De[Ce]:void 0}function Pa(Ce){var De=this.__data__;return vs?De[Ce]!==void 0:St.call(De,Ce)}function oc(Ce,De){var nt=this.__data__;return this.size+=this.has(Ce)?0:1,nt[Ce]=vs&&De===void 0?o:De,this}Po.prototype.clear=Aa,Po.prototype.delete=sc,Po.prototype.get=ml,Po.prototype.has=Pa,Po.prototype.set=oc;function lo(Ce){var De=-1,nt=Ce==null?0:Ce.length;for(this.clear();++De<nt;){var Qt=Ce[De];this.set(Qt[0],Qt[1])}}function Mi(){this.__data__=[],this.size=0}function _t(Ce){var De=this.__data__,nt=Yd(De,Ce);if(nt<0)return!1;var Qt=De.length-1;return nt==Qt?De.pop():Es.call(De,nt,1),--this.size,!0}function hn(Ce){var De=this.__data__,nt=Yd(De,Ce);return nt<0?void 0:De[nt][1]}function yr(Ce){return Yd(this.__data__,Ce)>-1}function _i(Ce,De){var nt=this.__data__,Qt=Yd(nt,Ce);return Qt<0?(++this.size,nt.push([Ce,De])):nt[Qt][1]=De,this}lo.prototype.clear=Mi,lo.prototype.delete=_t,lo.prototype.get=hn,lo.prototype.has=yr,lo.prototype.set=_i;function Oo(Ce){var De=-1,nt=Ce==null?0:Ce.length;for(this.clear();++De<nt;){var Qt=Ce[De];this.set(Qt[0],Qt[1])}}function uo(){this.size=0,this.__data__={hash:new Po,map:new(Ac||lo),string:new Po}}function Xl(Ce){var De=Ku(this,Ce).delete(Ce);return this.size-=De?1:0,De}function Tf(Ce){return Ku(this,Ce).get(Ce)}function gl(Ce){return Ku(this,Ce).has(Ce)}function Jl(Ce,De){var nt=Ku(this,Ce),Qt=nt.size;return nt.set(Ce,De),this.size+=nt.size==Qt?0:1,this}Oo.prototype.clear=uo,Oo.prototype.delete=Xl,Oo.prototype.get=Tf,Oo.prototype.has=gl,Oo.prototype.set=Jl;function Ri(Ce){var De=this.__data__=new lo(Ce);this.size=De.size}function ho(){this.__data__=new lo,this.size=0}function zi(Ce){var De=this.__data__,nt=De.delete(Ce);return this.size=De.size,nt}function $d(Ce){return this.__data__.get(Ce)}function Kd(Ce){return this.__data__.has(Ce)}function ac(Ce,De){var nt=this.__data__;if(nt instanceof lo){var Qt=nt.__data__;if(!Ac||Qt.length<i-1)return Qt.push([Ce,De]),this.size=++nt.size,this;nt=this.__data__=new Oo(Qt)}return nt.set(Ce,De),this.size=nt.size,this}Ri.prototype.clear=ho,Ri.prototype.delete=zi,Ri.prototype.get=$d,Ri.prototype.has=Kd,Ri.prototype.set=ac;function qd(Ce,De){var nt=Qo(Ce),Qt=!nt&&hs(Ce),Qn=!nt&&!Qt&&ea(Ce),Rr=!nt&&!Qt&&!Qn&&Af(Ce),Yr=nt||Qt||Qn||Rr,fn=Yr?en(Ce.length,String):[],Wr=fn.length;for(var Ai in Ce)Yr&&(Ai=="length"||Qn&&(Ai=="offset"||Ai=="parent")||Rr&&(Ai=="buffer"||Ai=="byteLength"||Ai=="byteOffset")||El(Ai,Wr))||fn.push(Ai);return fn}function $u(Ce,De,nt){(nt!==void 0&&!Jo(Ce[De],nt)||nt===void 0&&!(De in Ce))&&qr(Ce,De,nt)}function Yo(Ce,De,nt){var Qt=Ce[De];(!(St.call(Ce,De)&&Jo(Qt,nt))||nt===void 0&&!(De in Ce))&&qr(Ce,De,nt)}function Yd(Ce,De){for(var nt=Ce.length;nt--;)if(Jo(Ce[nt][0],De))return nt;return-1}function qr(Ce,De,nt){De=="__proto__"&&qo?qo(Ce,De,{configurable:!0,enumerable:!0,value:nt,writable:!0}):Ce[De]=nt}var Ii=eu();function Pc(Ce){return Ce==null?Ce===void 0?Q:J:ci&&ci in Object(Ce)?Xo(Ce):sm(Ce)}function _l(Ce){return Ss(Ce)&&Pc(Ce)==_}function Oa(Ce){if(!kc(Ce)||lc(Ce))return!1;var De=ta(Ce)?tn:Te;return De.test(If(Ce))}function wf(Ce){return Ss(Ce)&&am(Ce.length)&&!!Pe[Pc(Ce)]}function Xd(Ce){if(!kc(Ce))return Oc(Ce);var De=cr(Ce),nt=[];for(var Qt in Ce)Qt=="constructor"&&(De||!St.call(Ce,Qt))||nt.push(Qt);return nt}function Ql(Ce,De,nt,Qt,Qn){Ce!==De&&Ii(De,function(Rr,Yr){if(Qn||(Qn=new Ri),kc(Rr))ko(Ce,De,Yr,nt,Ql,Qt,Qn);else{var fn=Qt?Qt(Zd(Ce,Yr),Rr,Yr+"",Ce,De,Qn):void 0;fn===void 0&&(fn=Rr),$u(Ce,Yr,fn)}},iu)}function ko(Ce,De,nt,Qt,Qn,Rr,Yr){var fn=Zd(Ce,nt),Wr=Zd(De,nt),Ai=Yr.get(Wr);if(Ai){$u(Ce,nt,Ai);return}var Vs=Rr?Rr(fn,Wr,nt+"",Ce,De,Yr):void 0,na=Vs===void 0;if(na){var ra=Qo(Wr),Xu=!ra&&ea(Wr),os=!ra&&!Xu&&Af(Wr);Vs=Wr,ra||Xu||os?Qo(fn)?Vs=fn:ru(fn)?Vs=Qd(fn):Xu?(na=!1,Vs=Cf(Wr)):os?(na=!1,Vs=Jd(Wr)):Vs=[]:Yu(Wr)||hs(Wr)?(Vs=fn,hs(fn)?Vs=vl(fn):(!kc(fn)||ta(fn))&&(Vs=qu(Wr))):na=!1}na&&(Yr.set(Wr,Vs),Qn(Vs,Wr,Qt,Rr,Yr),Yr.delete(Wr)),$u(Ce,nt,Vs)}function im(Ce,De){return Rf(nu(Ce,De,Na),Ce+"")}var fo=qo?function(Ce,De){return qo(Ce,"toString",{configurable:!0,enumerable:!1,value:ka(De),writable:!0})}:Na;function Cf(Ce,De){return Ce.slice()}function yl(Ce){var De=new Ce.constructor(Ce.byteLength);return new Dt(De).set(new Dt(Ce)),De}function Jd(Ce,De){var nt=yl(Ce.buffer);return new Ce.constructor(nt,Ce.byteOffset,Ce.length)}function Qd(Ce,De){var nt=-1,Qt=Ce.length;for(De||(De=Array(Qt));++nt<Qt;)De[nt]=Ce[nt];return De}function Er(Ce,De,nt,Qt){var Qn=!nt;nt||(nt={});for(var Rr=-1,Yr=De.length;++Rr<Yr;){var fn=De[Rr],Wr=void 0;Wr===void 0&&(Wr=Ce[fn]),Qn?qr(nt,fn,Wr):Yo(nt,fn,Wr)}return nt}function Zl(Ce){return im(function(De,nt){var Qt=-1,Qn=nt.length,Rr=Qn>1?nt[Qn-1]:void 0,Yr=Qn>2?nt[2]:void 0;for(Rr=Ce.length>3&&typeof Rr=="function"?(Qn--,Rr):void 0,Yr&&tu(nt[0],nt[1],Yr)&&(Rr=Qn<3?void 0:Rr,Qn=1),De=Object(De);++Qt<Qn;){var fn=nt[Qt];fn&&Ce(De,fn,Qt,Rr)}return De})}function eu(Ce){return function(De,nt,Qt){for(var Qn=-1,Rr=Object(De),Yr=Qt(De),fn=Yr.length;fn--;){var Wr=Yr[++Qn];if(nt(Rr[Wr],Wr,Rr)===!1)break}return De}}function Ku(Ce,De){var nt=Ce.__data__;return Zr(De)?nt[typeof De=="string"?"string":"hash"]:nt.map}function cc(Ce,De){var nt=Vn(Ce,De);return Oa(nt)?nt:void 0}function Xo(Ce){var De=St.call(Ce,ci),nt=Ce[ci];try{Ce[ci]=void 0;var Qt=!0}catch{}var Qn=mn.call(Ce);return Qt&&(De?Ce[ci]=nt:delete Ce[ci]),Qn}function qu(Ce){return typeof Ce.constructor=="function"&&!cr(Ce)?Ia(Ut(Ce)):{}}function El(Ce,De){var nt=typeof Ce;return De=De??p,!!De&&(nt=="number"||nt!="symbol"&&be.test(Ce))&&Ce>-1&&Ce%1==0&&Ce<De}function tu(Ce,De,nt){if(!kc(nt))return!1;var Qt=typeof De;return(Qt=="number"?Zo(nt)&&El(De,nt.length):Qt=="string"&&De in nt)?Jo(nt[De],Ce):!1}function Zr(Ce){var De=typeof Ce;return De=="string"||De=="number"||De=="symbol"||De=="boolean"?Ce!=="__proto__":Ce===null}function lc(Ce){return!!Wt&&Wt in Ce}function cr(Ce){var De=Ce&&Ce.constructor,nt=typeof De=="function"&&De.prototype||Ge;return Ce===nt}function Oc(Ce){var De=[];if(Ce!=null)for(var nt in Object(Ce))De.push(nt);return De}function sm(Ce){return mn.call(Ce)}function nu(Ce,De,nt){return De=Xs(De===void 0?Ce.length-1:De,0),function(){for(var Qt=arguments,Qn=-1,Rr=Xs(Qt.length-De,0),Yr=Array(Rr);++Qn<Rr;)Yr[Qn]=Qt[De+Qn];Qn=-1;for(var fn=Array(De+1);++Qn<De;)fn[Qn]=Qt[Qn];return fn[De]=nt(Yr),an(Ce,this,fn)}}function Zd(Ce,De){if(!(De==="constructor"&&typeof Ce[De]=="function")&&De!="__proto__")return Ce[De]}var Rf=om(fo);function om(Ce){var De=0,nt=0;return function(){var Qt=Js(),Qn=d-(Qt-nt);if(nt=Qt,Qn>0){if(++De>=l)return arguments[0]}else De=0;return Ce.apply(void 0,arguments)}}function If(Ce){if(Ce!=null){try{return gt.call(Ce)}catch{}try{return Ce+""}catch{}}return""}function Jo(Ce,De){return Ce===De||Ce!==Ce&&De!==De}var hs=_l(function(){return arguments}())?_l:function(Ce){return Ss(Ce)&&St.call(Ce,"callee")&&!Li.call(Ce,"callee")},Qo=Array.isArray;function Zo(Ce){return Ce!=null&&am(Ce.length)&&!ta(Ce)}function ru(Ce){return Ss(Ce)&&Zo(Ce)}var ea=ic||Sl;function ta(Ce){if(!kc(Ce))return!1;var De=Pc(Ce);return De==L||De==U||De==b||De==ie}function am(Ce){return typeof Ce=="number"&&Ce>-1&&Ce%1==0&&Ce<=p}function kc(Ce){var De=typeof Ce;return Ce!=null&&(De=="object"||De=="function")}function Ss(Ce){return Ce!=null&&typeof Ce=="object"}function Yu(Ce){if(!Ss(Ce)||Pc(Ce)!=$)return!1;var De=Ut(Ce);if(De===null)return!0;var nt=St.call(De,"constructor")&&De.constructor;return typeof nt=="function"&&nt instanceof nt&&gt.call(nt)==vn}var Af=Ft?Xt(Ft):wf;function vl(Ce){return Er(Ce,iu(Ce))}function iu(Ce){return Zo(Ce)?qd(Ce):Xd(Ce)}var cm=Zl(function(Ce,De,nt,Qt){Ql(Ce,De,nt,Qt)});function ka(Ce){return function(){return Ce}}function Na(Ce){return Ce}function Sl(){return!1}n.exports=cm}(Bw,Bw.exports)),Bw.exports}var YEe=qEe();const Xh=Bg(YEe);function $s(n,e=[]){const i=N.useRef(n);return N.useEffect(()=>{i.current=n}),N.useCallback((...o)=>{var l;return(l=i.current)==null?void 0:l.call(i,...o)},e)}function Oy(n,e,i,o){const l=$s(i);return N.useEffect(()=>{const d=typeof n=="function"?n():n??document;if(!(!i||!d))return d.addEventListener(e,l,o),()=>{d.removeEventListener(e,l,o)}},[e,n,o,l,i]),()=>{const d=typeof n=="function"?n():n??document;d==null||d.removeEventListener(e,l,o)}}function kZ(n){const{isOpen:e,ref:i}=n,[o,l]=N.useState(e),[d,p]=N.useState(!1);return N.useEffect(()=>{d||(l(e),p(!0))},[e,d,o]),Oy(()=>i.current,"animationend",()=>{l(e)}),{present:!(e?!1:!o),onComplete(){var C;const E=_Ee(i.current),b=new E.CustomEvent("animationend",{bubbles:!0});(C=i.current)==null||C.dispatchEvent(b)}}}var SM,BK;function XEe(){return BK||(BK=1,SM=function(){var n=document.getSelection();if(!n.rangeCount)return function(){};for(var e=document.activeElement,i=[],o=0;o<n.rangeCount;o++)i.push(n.getRangeAt(o));switch(e.tagName.toUpperCase()){case"INPUT":case"TEXTAREA":e.blur();break;default:e=null;break}return n.removeAllRanges(),function(){n.type==="Caret"&&n.removeAllRanges(),n.rangeCount||i.forEach(function(l){n.addRange(l)}),e&&e.focus()}}),SM}var bM,WK;function JEe(){if(WK)return bM;WK=1;var n=XEe(),e={"text/plain":"Text","text/html":"Url",default:"Text"},i="Copy to clipboard: #{key}, Enter";function o(d){var p=(/mac os x/i.test(navigator.userAgent)?"":"Ctrl")+"+C";return d.replace(/#{\s*key\s*}/g,p)}function l(d,p){var _,E,b,C,I,O,L=!1;p||(p={}),_=p.debug||!1;try{b=n(),C=document.createRange(),I=document.getSelection(),O=document.createElement("span"),O.textContent=d,O.ariaHidden="true",O.style.all="unset",O.style.position="fixed",O.style.top=0,O.style.clip="rect(0, 0, 0, 0)",O.style.whiteSpace="pre",O.style.webkitUserSelect="text",O.style.MozUserSelect="text",O.style.msUserSelect="text",O.style.userSelect="text",O.addEventListener("copy",function(B){if(B.stopPropagation(),p.format)if(B.preventDefault(),typeof B.clipboardData>"u"){_&&console.warn("unable to use e.clipboardData"),_&&console.warn("trying IE specific stuff"),window.clipboardData.clearData();var W=e[p.format]||e.default;window.clipboardData.setData(W,d)}else B.clipboardData.clearData(),B.clipboardData.setData(p.format,d);p.onCopy&&(B.preventDefault(),p.onCopy(B.clipboardData))}),document.body.appendChild(O),C.selectNodeContents(O),I.addRange(C);var U=document.execCommand("copy");if(!U)throw new Error("copy command was unsuccessful");L=!0}catch(B){_&&console.error("unable to copy using execCommand: ",B),_&&console.warn("trying IE specific stuff");try{window.clipboardData.setData(p.format||"text",d),p.onCopy&&p.onCopy(window.clipboardData),L=!0}catch(W){_&&console.error("unable to copy using clipboardData: ",W),_&&console.error("falling back to prompt"),E=o("message"in p?p.message:i),window.prompt(E,d)}}finally{I&&(typeof I.removeRange=="function"?I.removeRange(C):I.removeAllRanges()),O&&document.body.removeChild(O),b()}return L}return bM=l,bM}var QEe=JEe();const zK=Bg(QEe);function GK(n,e={}){const[i,o]=N.useState(!1),[l,d]=N.useState(n);N.useEffect(()=>d(n),[n]);const{timeout:p=1500,..._}=typeof e=="number"?{timeout:e}:e,E=N.useCallback(b=>{const C=typeof b=="string"?b:l;"clipboard"in navigator?navigator.clipboard.writeText(C).then(()=>o(!0)).catch(()=>o(zK(C,_))):o(zK(C,_))},[l,_]);return N.useEffect(()=>{let b=null;return i&&(b=window.setTimeout(()=>{o(!1)},p)),()=>{b&&window.clearTimeout(b)}},[p,i]),{value:l,setValue:d,onCopy:E,hasCopied:i}}function NZ(n){const{value:e,defaultValue:i,onChange:o,shouldUpdate:l=(O,L)=>O!==L}=n,d=$s(o),p=$s(l),[_,E]=N.useState(i),b=e!==void 0,C=b?e:_,I=$s(O=>{const U=typeof O=="function"?O(C):O;p(C,U)&&(b||E(U),d(U))},[b,d,C,p]);return[C,I]}function ZEe(n={}){const{onChange:e,precision:i,defaultValue:o,value:l,step:d=1,min:p=Number.MIN_SAFE_INTEGER,max:_=Number.MAX_SAFE_INTEGER,keepWithinRange:E=!0}=n,b=$s(e),[C,I]=N.useState(()=>o==null?"":TM(o,d,i)??""),O=typeof l<"u",L=O?l:C,U=DZ(mg(L),d),B=i??U,W=N.useCallback(re=>{re!==L&&(O||I(re.toString()),b==null||b(re.toString(),mg(re)))},[b,O,L]),J=N.useCallback(re=>{let pe=re;return E&&(pe=QO(pe,p,_)),MF(pe,B)},[B,E,_,p]),$=N.useCallback((re=d)=>{let pe;L===""?pe=mg(re):pe=mg(L)+re,pe=J(pe),W(pe)},[J,d,W,L]),ie=N.useCallback((re=d)=>{let pe;L===""?pe=mg(-re):pe=mg(L)-re,pe=J(pe),W(pe)},[J,d,W,L]),ce=N.useCallback(()=>{let re;o==null?re="":re=TM(o,d,i)??p,W(re)},[o,i,d,W,p]),ne=N.useCallback(re=>{const pe=TM(re,d,B)??p;W(pe)},[B,d,W,p]),de=mg(L);return{isOutOfRange:de>_||de<p,isAtMax:de===_,isAtMin:de===p,precision:B,value:L,valueAsNumber:de,update:W,reset:ce,increment:$,decrement:ie,clamp:J,cast:ne,setValue:I}}function mg(n){return parseFloat(n.toString().replace(/[^\w.-]+/g,""))}function DZ(n,e){return Math.max(KU(e),KU(n))}function TM(n,e,i){const o=mg(n);if(Number.isNaN(o))return;const l=DZ(o,e);return MF(o,i??l)}function pf(n={}){const{onClose:e,onOpen:i,isOpen:o,id:l}=n,d=$s(i),p=$s(e),[_,E]=N.useState(n.defaultIsOpen||!1),b=o!==void 0?o:_,C=o!==void 0,I=N.useId(),O=l??`disclosure-${I}`,L=N.useCallback(()=>{C||E(!1),p==null||p()},[C,p]),U=N.useCallback(()=>{C||E(!0),d==null||d()},[C,d]),B=N.useCallback(()=>{b?L():U()},[b,U,L]);function W($={}){return{...$,"aria-expanded":b,"aria-controls":O,onClick(ie){var ce;(ce=$.onClick)==null||ce.call($,ie),B()}}}function J($={}){return{...$,hidden:!b,id:O}}return{isOpen:b,onOpen:U,onClose:L,onToggle:B,isControlled:C,getButtonProps:W,getDisclosureProps:J}}const ef=globalThis!=null&&globalThis.document?N.useLayoutEffect:N.useEffect,Wp=(n,e)=>{const i=N.useRef(!1),o=N.useRef(!1);N.useEffect(()=>{if(i.current&&o.current)return n();o.current=!0},e),N.useEffect(()=>(i.current=!0,()=>{i.current=!1}),[])};function eve(n){const e=n.current;if(!e)return!1;const i=EEe(e);return!i||e.contains(i)?!1:!!xEe(i)}function xZ(n,e){const{shouldFocus:i,visible:o,focusRef:l}=e,d=i&&!o;Wp(()=>{if(!d||eve(n))return;const p=(l==null?void 0:l.current)||n.current;let _;if(p)return _=requestAnimationFrame(()=>{p.focus({preventScroll:!0})}),()=>{cancelAnimationFrame(_)}},[d,n,l])}const tve={preventScroll:!0,shouldFocus:!1};function nve(n,e=tve){const{focusRef:i,preventScroll:o,shouldFocus:l,visible:d}=e,p=rve(n)?n.current:n,_=l&&d,E=N.useRef(_),b=N.useRef(d);ef(()=>{!b.current&&d&&(E.current=_),b.current=d},[d,_]);const C=N.useCallback(()=>{if(!(!d||!p||!E.current)&&(E.current=!1,!p.contains(document.activeElement)))if(i!=null&&i.current)requestAnimationFrame(()=>{var I;(I=i.current)==null||I.focus({preventScroll:o})});else{const I=IZ(p);I.length>0&&requestAnimationFrame(()=>{I[0].focus({preventScroll:o})})}},[d,o,p,i]);Wp(()=>{C()},[C]),Oy(p,"transitionend",C)}function rve(n){return"current"in n}function ive(n){return"current"in n}const LZ=()=>typeof window<"u";function sve(){const n=navigator.userAgentData;return(n==null?void 0:n.platform)??navigator.platform}const ove=n=>LZ()&&n.test(navigator.vendor),ave=n=>LZ()&&n.test(sve()),cve=()=>ave(/mac|iphone|ipad|ipod/i),lve=()=>cve()&&ove(/apple/i);function uve(n){const{ref:e,elements:i,enabled:o}=n,l=()=>{var d;return((d=e.current)==null?void 0:d.ownerDocument)??document};Oy(l,"pointerdown",d=>{var b,C;if(!lve()||!o)return;const p=((C=(b=d.composedPath)==null?void 0:b.call(d))==null?void 0:C[0])??d.target,E=(i??[e]).some(I=>{const O=ive(I)?I.current:I;return(O==null?void 0:O.contains(p))||O===p});l().activeElement!==p&&E&&(d.preventDefault(),p.focus())})}function dve(n,e){const i=N.useId();return N.useMemo(()=>n||[e,i].filter(Boolean).join("-"),[n,e,i])}function hve(n,...e){const i=dve(n);return N.useMemo(()=>e.map(o=>`${o}-${i}`),[i,e])}function fve(n,e){const i=$s(n);N.useEffect(()=>{let o=null;const l=()=>i();return e!==null&&(o=window.setInterval(l,e)),()=>{o&&window.clearInterval(o)}},[e,i])}function MZ(n){const e=N.useRef(null);return e.current=n,e}function pve(n,e){if(n!=null){if(typeof n=="function"){n(e);return}try{n.current=e}catch{throw new Error(`Cannot assign value '${e}' to ref '${n}'`)}}}function Bi(...n){return e=>{n.forEach(i=>{pve(i,e)})}}function mve(...n){return N.useMemo(()=>Bi(...n),n)}function UZ(n){const{ref:e,handler:i,enabled:o=!0}=n,l=$s(i),p=N.useRef({isPointerDown:!1,ignoreEmulatedMouseEvents:!1}).current;N.useEffect(()=>{if(!o)return;const _=I=>{wM(I,e)&&(p.isPointerDown=!0)},E=I=>{if(p.ignoreEmulatedMouseEvents){p.ignoreEmulatedMouseEvents=!1;return}p.isPointerDown&&i&&wM(I,e)&&(p.isPointerDown=!1,l(I))},b=I=>{p.ignoreEmulatedMouseEvents=!0,i&&p.isPointerDown&&wM(I,e)&&(p.isPointerDown=!1,l(I))},C=VZ(e.current);return C.addEventListener("mousedown",_,!0),C.addEventListener("mouseup",E,!0),C.addEventListener("touchstart",_,!0),C.addEventListener("touchend",b,!0),()=>{C.removeEventListener("mousedown",_,!0),C.removeEventListener("mouseup",E,!0),C.removeEventListener("touchstart",_,!0),C.removeEventListener("touchend",b,!0)}},[i,e,l,p,o])}function wM(n,e){var o,l;const i=((o=n.composedPath)==null?void 0:o.call(n)[0])??n.target;return i&&!VZ(i).contains(i)?!1:!((l=e.current)!=null&&l.contains(i))}function VZ(n){return(n==null?void 0:n.ownerDocument)??document}function gve(n,e){const i=$s(n);N.useEffect(()=>{if(e==null)return;let o=null;return o=window.setTimeout(()=>{i()},e),()=>{o&&window.clearTimeout(o)}},[e,i])}const FZ=1/60*1e3,_ve=typeof performance<"u"?()=>performance.now():()=>Date.now(),jZ=typeof window<"u"?n=>window.requestAnimationFrame(n):n=>setTimeout(()=>n(_ve()),FZ);function yve(n){let e=[],i=[],o=0,l=!1,d=!1;const p=new WeakSet,_={schedule:(E,b=!1,C=!1)=>{const I=C&&l,O=I?e:i;return b&&p.add(E),O.indexOf(E)===-1&&(O.push(E),I&&l&&(o=e.length)),E},cancel:E=>{const b=i.indexOf(E);b!==-1&&i.splice(b,1),p.delete(E)},process:E=>{if(l){d=!0;return}if(l=!0,[e,i]=[i,e],i.length=0,o=e.length,o)for(let b=0;b<o;b++){const C=e[b];C(E),p.has(C)&&(_.schedule(C),n())}l=!1,d&&(d=!1,_.process(E))}};return _}const Eve=40;let qU=!0,TC=!1,YU=!1;const e0={delta:0,timestamp:0},tR=["read","update","preRender","render","postRender"],N1=tR.reduce((n,e)=>(n[e]=yve(()=>TC=!0),n),{}),vve=tR.reduce((n,e)=>{const i=N1[e];return n[e]=(o,l=!1,d=!1)=>(TC||Tve(),i.schedule(o,l,d)),n},{}),Sve=tR.reduce((n,e)=>(n[e]=N1[e].cancel,n),{});tR.reduce((n,e)=>(n[e]=()=>N1[e].process(e0),n),{});const bve=n=>N1[n].process(e0),BZ=n=>{TC=!1,e0.delta=qU?FZ:Math.max(Math.min(n-e0.timestamp,Eve),1),e0.timestamp=n,YU=!0,tR.forEach(bve),YU=!1,TC&&(qU=!1,jZ(BZ))},Tve=()=>{TC=!0,qU=!0,YU||jZ(BZ)},HK=()=>e0;var wve=Object.defineProperty,Cve=(n,e,i)=>e in n?wve(n,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):n[e]=i,Od=(n,e,i)=>(Cve(n,typeof e!="symbol"?e+"":e,i),i);class Rve{constructor(e,i,o){if(Od(this,"history",[]),Od(this,"startEvent",null),Od(this,"lastEvent",null),Od(this,"lastEventInfo",null),Od(this,"handlers",{}),Od(this,"removeListeners",()=>{}),Od(this,"threshold",3),Od(this,"win"),Od(this,"updatePoint",()=>{if(!(this.lastEvent&&this.lastEventInfo))return;const _=CM(this.lastEventInfo,this.history),E=this.startEvent!==null,b=Ove(_.offset,{x:0,y:0})>=this.threshold;if(!E&&!b)return;const{timestamp:C}=HK();this.history.push({..._.point,timestamp:C});const{onStart:I,onMove:O}=this.handlers;E||(I==null||I(this.lastEvent,_),this.startEvent=this.lastEvent),O==null||O(this.lastEvent,_)}),Od(this,"onPointerMove",(_,E)=>{this.lastEvent=_,this.lastEventInfo=E,vve.update(this.updatePoint,!0)}),Od(this,"onPointerUp",(_,E)=>{const b=CM(E,this.history),{onEnd:C,onSessionEnd:I}=this.handlers;I==null||I(_,b),this.end(),!(!C||!this.startEvent)&&(C==null||C(_,b))}),this.win=e.view??window,SEe(e))return;this.handlers=i,o&&(this.threshold=o),e.stopPropagation(),e.preventDefault();const l={point:TZ(e)},{timestamp:d}=HK();this.history=[{...l.point,timestamp:d}];const{onSessionStart:p}=i;p==null||p(e,CM(l,this.history)),this.removeListeners=Pve(JO(this.win,"pointermove",this.onPointerMove),JO(this.win,"pointerup",this.onPointerUp),JO(this.win,"pointercancel",this.onPointerUp))}updateHandlers(e){this.handlers=e}end(){var e;(e=this.removeListeners)==null||e.call(this),Sve.update(this.updatePoint)}}function $K(n,e){return{x:n.x-e.x,y:n.y-e.y}}function CM(n,e){return{point:n.point,delta:$K(n.point,e[e.length-1]),offset:$K(n.point,e[0]),velocity:Ave(e,.1)}}const Ive=n=>n*1e3;function Ave(n,e){if(n.length<2)return{x:0,y:0};let i=n.length-1,o=null;const l=n[n.length-1];for(;i>=0&&(o=n[i],!(l.timestamp-o.timestamp>Ive(e)));)i--;if(!o)return{x:0,y:0};const d=(l.timestamp-o.timestamp)/1e3;if(d===0)return{x:0,y:0};const p={x:(l.x-o.x)/d,y:(l.y-o.y)/d};return p.x===1/0&&(p.x=0),p.y===1/0&&(p.y=0),p}function Pve(...n){return e=>n.reduce((i,o)=>o(i),e)}function RM(n,e){return Math.abs(n-e)}function KK(n){return"x"in n&&"y"in n}function Ove(n,e){if(typeof n=="number"&&typeof e=="number")return RM(n,e);if(KK(n)&&KK(e)){const i=RM(n.x,e.x),o=RM(n.y,e.y);return Math.sqrt(i**2+o**2)}return 0}function kve(n,e){const{onPan:i,onPanStart:o,onPanEnd:l,onPanSessionStart:d,onPanSessionEnd:p,threshold:_}=e,E=!!(i||o||l||d||p),b=N.useRef(null),C=MZ({onSessionStart:d,onSessionEnd:p,onStart:o,onMove:i,onEnd(I,O){b.current=null,l==null||l(I,O)}});N.useEffect(()=>{var I;(I=b.current)==null||I.updateHandlers(C.current)}),N.useEffect(()=>{const I=n.current;if(!I||!E)return;function O(L){b.current=new Rve(L,C.current,_)}return JO(I,"pointerdown",O)},[n,E,C,_]),N.useEffect(()=>()=>{var I;(I=b.current)==null||I.end(),b.current=null},[])}const bo={open:(n,e)=>`${n}[data-open], ${n}[open], ${n}[data-state=open] ${e}`,closed:(n,e)=>`${n}[data-closed], ${n}[data-state=closed] ${e}`,hover:(n,e)=>`${n}:hover ${e}, ${n}[data-hover] ${e}`,focus:(n,e)=>`${n}:focus ${e}, ${n}[data-focus] ${e}`,focusVisible:(n,e)=>`${n}:focus-visible ${e}`,focusWithin:(n,e)=>`${n}:focus-within ${e}`,active:(n,e)=>`${n}:active ${e}, ${n}[data-active] ${e}`,disabled:(n,e)=>`${n}:disabled ${e}, ${n}[data-disabled] ${e}`,invalid:(n,e)=>`${n}:invalid ${e}, ${n}[data-invalid] ${e}`,checked:(n,e)=>`${n}:checked ${e}, ${n}[data-checked] ${e}`,placeholderShown:(n,e)=>`${n}:placeholder-shown ${e}`},Fh=n=>WZ(e=>n(e,"&"),"[role=group]","[data-group]",".group"),Ep=n=>WZ(e=>n(e,"~ &"),"[data-peer]",".peer"),WZ=(n,...e)=>e.map(n).join(", "),t0={_hover:"&:hover, &[data-hover]",_active:"&:active, &[data-active]",_focus:"&:focus, &[data-focus]",_highlighted:"&[data-highlighted]",_focusWithin:"&:focus-within, &[data-focus-within]",_focusVisible:"&:focus-visible, &[data-focus-visible]",_disabled:"&:disabled, &[disabled], &[aria-disabled=true], &[data-disabled]",_readOnly:"&[aria-readonly=true], &[readonly], &[data-readonly]",_before:"&::before",_after:"&::after",_empty:"&:empty, &[data-empty]",_expanded:"&[aria-expanded=true], &[data-expanded], &[data-state=expanded]",_checked:"&[aria-checked=true], &[data-checked], &[data-state=checked]",_grabbed:"&[aria-grabbed=true], &[data-grabbed]",_pressed:"&[aria-pressed=true], &[data-pressed]",_invalid:"&[aria-invalid=true], &[data-invalid]",_valid:"&[data-valid], &[data-state=valid]",_loading:"&[data-loading], &[aria-busy=true]",_selected:"&[aria-selected=true], &[data-selected]",_hidden:"&[hidden], &[data-hidden]",_autofill:"&:-webkit-autofill",_even:"&:nth-of-type(even)",_odd:"&:nth-of-type(odd)",_first:"&:first-of-type",_firstLetter:"&::first-letter",_last:"&:last-of-type",_notFirst:"&:not(:first-of-type)",_notLast:"&:not(:last-of-type)",_visited:"&:visited",_activeLink:"&[aria-current=page]",_activeStep:"&[aria-current=step]",_indeterminate:"&:indeterminate, &[aria-checked=mixed], &[data-indeterminate], &[data-state=indeterminate]",_groupOpen:Fh(bo.open),_groupClosed:Fh(bo.closed),_groupHover:Fh(bo.hover),_peerHover:Ep(bo.hover),_groupFocus:Fh(bo.focus),_peerFocus:Ep(bo.focus),_groupFocusVisible:Fh(bo.focusVisible),_peerFocusVisible:Ep(bo.focusVisible),_groupActive:Fh(bo.active),_peerActive:Ep(bo.active),_groupDisabled:Fh(bo.disabled),_peerDisabled:Ep(bo.disabled),_groupInvalid:Fh(bo.invalid),_peerInvalid:Ep(bo.invalid),_groupChecked:Fh(bo.checked),_peerChecked:Ep(bo.checked),_groupFocusWithin:Fh(bo.focusWithin),_peerFocusWithin:Ep(bo.focusWithin),_peerPlaceholderShown:Ep(bo.placeholderShown),_placeholder:"&::placeholder, &[data-placeholder]",_placeholderShown:"&:placeholder-shown, &[data-placeholder-shown]",_fullScreen:"&:fullscreen, &[data-fullscreen]",_selection:"&::selection",_rtl:"[dir=rtl] &, &[dir=rtl]",_ltr:"[dir=ltr] &, &[dir=ltr]",_mediaDark:"@media (prefers-color-scheme: dark)",_mediaReduceMotion:"@media (prefers-reduced-motion: reduce)",_dark:".chakra-ui-dark &:not([data-theme]),[data-theme=dark] &:not([data-theme]),&[data-theme=dark]",_light:".chakra-ui-light &:not([data-theme]),[data-theme=light] &:not([data-theme]),&[data-theme=light]",_horizontal:"&[data-orientation=horizontal]",_vertical:"&[data-orientation=vertical]",_open:"&[data-open], &[open], &[data-state=open]",_closed:"&[data-closed], &[data-state=closed]",_complete:"&[data-complete]",_incomplete:"&[data-incomplete]",_current:"&[data-current]"},zZ=Object.keys(t0),Nve=n=>/!(important)?$/.test(n),qK=n=>typeof n=="string"?n.replace(/!(important)?$/,"").trim():n,Dve=(n,e)=>i=>{const o=String(e),l=Nve(o),d=qK(o),p=n?`${n}.${d}`:d;let _=Fu(i.__cssMap)&&p in i.__cssMap?i.__cssMap[p].varRef:e;return _=qK(_),l?`${_} !important`:_};function UF(n){const{scale:e,transform:i,compose:o}=n;return(d,p)=>{const _=Dve(e,d)(p);let E=(i==null?void 0:i(_,p))??_;return o&&(E=o(E,p)),E}}const yO=(...n)=>e=>n.reduce((i,o)=>o(i),e);function Du(n,e){return i=>{const o={property:i,scale:n};return o.transform=UF({scale:n,transform:e}),o}}const xve=({rtl:n,ltr:e})=>i=>i.direction==="rtl"?n:e;function Lve(n){const{property:e,scale:i,transform:o}=n;return{scale:i,property:xve(e),transform:i?UF({scale:i,compose:o}):o}}const GZ=["rotate(var(--chakra-rotate, 0))","scaleX(var(--chakra-scale-x, 1))","scaleY(var(--chakra-scale-y, 1))","skewX(var(--chakra-skew-x, 0))","skewY(var(--chakra-skew-y, 0))"];function Mve(){return["translateX(var(--chakra-translate-x, 0))","translateY(var(--chakra-translate-y, 0))",...GZ].join(" ")}function Uve(){return["translate3d(var(--chakra-translate-x, 0), var(--chakra-translate-y, 0), 0)",...GZ].join(" ")}const Vve={"--chakra-blur":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-brightness":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-contrast":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-grayscale":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-hue-rotate":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-invert":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-saturate":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-sepia":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-drop-shadow":"var(--chakra-empty,/*!*/ /*!*/)",filter:["var(--chakra-blur)","var(--chakra-brightness)","var(--chakra-contrast)","var(--chakra-grayscale)","var(--chakra-hue-rotate)","var(--chakra-invert)","var(--chakra-saturate)","var(--chakra-sepia)","var(--chakra-drop-shadow)"].join(" ")},Fve={backdropFilter:["var(--chakra-backdrop-blur)","var(--chakra-backdrop-brightness)","var(--chakra-backdrop-contrast)","var(--chakra-backdrop-grayscale)","var(--chakra-backdrop-hue-rotate)","var(--chakra-backdrop-invert)","var(--chakra-backdrop-opacity)","var(--chakra-backdrop-saturate)","var(--chakra-backdrop-sepia)"].join(" "),"--chakra-backdrop-blur":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-brightness":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-contrast":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-grayscale":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-hue-rotate":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-invert":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-opacity":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-saturate":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-sepia":"var(--chakra-empty,/*!*/ /*!*/)"};function jve(n){return{"--chakra-ring-offset-shadow":"var(--chakra-ring-inset) 0 0 0 var(--chakra-ring-offset-width) var(--chakra-ring-offset-color)","--chakra-ring-shadow":"var(--chakra-ring-inset) 0 0 0 calc(var(--chakra-ring-width) + var(--chakra-ring-offset-width)) var(--chakra-ring-color)","--chakra-ring-width":n,boxShadow:["var(--chakra-ring-offset-shadow)","var(--chakra-ring-shadow)","var(--chakra-shadow, 0 0 #0000)"].join(", ")}}const Bve={"row-reverse":{space:"--chakra-space-x-reverse",divide:"--chakra-divide-x-reverse"},"column-reverse":{space:"--chakra-space-y-reverse",divide:"--chakra-divide-y-reverse"}},XU={"to-t":"to top","to-tr":"to top right","to-r":"to right","to-br":"to bottom right","to-b":"to bottom","to-bl":"to bottom left","to-l":"to left","to-tl":"to top left"},Wve=new Set(Object.values(XU)),JU=new Set(["none","-moz-initial","inherit","initial","revert","unset"]),zve=n=>n.trim();function Gve(n,e){if(n==null||JU.has(n))return n;if(!(QU(n)||JU.has(n)))return`url('${n}')`;const l=/(^[a-z-A-Z]+)\((.*)\)/g.exec(n),d=l==null?void 0:l[1],p=l==null?void 0:l[2];if(!d||!p)return n;const _=d.includes("-gradient")?d:`${d}-gradient`,[E,...b]=p.split(",").map(zve).filter(Boolean);if((b==null?void 0:b.length)===0)return n;const C=E in XU?XU[E]:E;b.unshift(C);const I=b.map(O=>{if(Wve.has(O))return O;const L=O.indexOf(" "),[U,B]=L!==-1?[O.substr(0,L),O.substr(L+1)]:[O],W=QU(B)?B:B&&B.split(" "),J=`colors.${U}`,$=J in e.__cssMap?e.__cssMap[J].varRef:U;return W?[$,...Array.isArray(W)?W:[W]].join(" "):$});return`${_}(${I.join(", ")})`}const QU=n=>typeof n=="string"&&n.includes("(")&&n.includes(")"),Hve=(n,e)=>Gve(n,e??{});function $ve(n){return/^var\(--.+\)$/.test(n)}const Kve=n=>{const e=parseFloat(n.toString()),i=n.toString().replace(String(e),"");return{unitless:!i,value:e,unit:i}},jh=n=>e=>`${n}(${e})`,Ur={filter(n){return n!=="auto"?n:Vve},backdropFilter(n){return n!=="auto"?n:Fve},ring(n){return jve(Ur.px(n))},bgClip(n){return n==="text"?{color:"transparent",backgroundClip:"text"}:{backgroundClip:n}},transform(n){return n==="auto"?Mve():n==="auto-gpu"?Uve():n},vh(n){return n==="$100vh"?"var(--chakra-vh)":n},px(n){if(n==null)return n;const{unitless:e}=Kve(n);return e||typeof n=="number"?`${n}px`:n},fraction(n){return typeof n!="number"||n>1?n:`${n*100}%`},float(n,e){const i={left:"right",right:"left"};return e.direction==="rtl"?i[n]:n},degree(n){if($ve(n)||n==null)return n;const e=typeof n=="string"&&!n.endsWith("deg");return typeof n=="number"||e?`${n}deg`:n},gradient:Hve,blur:jh("blur"),opacity:jh("opacity"),brightness:jh("brightness"),contrast:jh("contrast"),dropShadow:jh("drop-shadow"),grayscale:jh("grayscale"),hueRotate:n=>jh("hue-rotate")(Ur.degree(n)),invert:jh("invert"),saturate:jh("saturate"),sepia:jh("sepia"),bgImage(n){return n==null||QU(n)||JU.has(n)?n:`url(${n})`},outline(n){const e=String(n)==="0"||String(n)==="none";return n!==null&&e?{outline:"2px solid transparent",outlineOffset:"2px"}:{outline:n}},flexDirection(n){const{space:e,divide:i}=Bve[n]??{},o={flexDirection:n};return e&&(o[e]=1),i&&(o[i]=1),o}},Be={borderWidths:Du("borderWidths"),borderStyles:Du("borderStyles"),colors:Du("colors"),borders:Du("borders"),gradients:Du("gradients",Ur.gradient),radii:Du("radii",Ur.px),space:Du("space",yO(Ur.vh,Ur.px)),spaceT:Du("space",yO(Ur.vh,Ur.px)),degreeT(n){return{property:n,transform:Ur.degree}},prop(n,e,i){return{property:n,scale:e,...e&&{transform:UF({scale:e,transform:i})}}},propT(n,e){return{property:n,transform:e}},sizes:Du("sizes",yO(Ur.vh,Ur.px)),sizesT:Du("sizes",yO(Ur.vh,Ur.fraction)),shadows:Du("shadows"),logical:Lve,blur:Du("blur",Ur.blur)},ZO={background:Be.colors("background"),backgroundColor:Be.colors("backgroundColor"),backgroundImage:Be.gradients("backgroundImage"),backgroundSize:!0,backgroundPosition:!0,backgroundRepeat:!0,backgroundAttachment:!0,backgroundClip:{transform:Ur.bgClip},bgSize:Be.prop("backgroundSize"),bgPosition:Be.prop("backgroundPosition"),bg:Be.colors("background"),bgColor:Be.colors("backgroundColor"),bgPos:Be.prop("backgroundPosition"),bgRepeat:Be.prop("backgroundRepeat"),bgAttachment:Be.prop("backgroundAttachment"),bgGradient:Be.gradients("backgroundImage"),bgClip:{transform:Ur.bgClip}};Object.assign(ZO,{bgImage:ZO.backgroundImage,bgImg:ZO.backgroundImage});const ni={border:Be.borders("border"),borderWidth:Be.borderWidths("borderWidth"),borderStyle:Be.borderStyles("borderStyle"),borderColor:Be.colors("borderColor"),borderRadius:Be.radii("borderRadius"),borderTop:Be.borders("borderTop"),borderBlockStart:Be.borders("borderBlockStart"),borderTopLeftRadius:Be.radii("borderTopLeftRadius"),borderStartStartRadius:Be.logical({scale:"radii",property:{ltr:"borderTopLeftRadius",rtl:"borderTopRightRadius"}}),borderEndStartRadius:Be.logical({scale:"radii",property:{ltr:"borderBottomLeftRadius",rtl:"borderBottomRightRadius"}}),borderTopRightRadius:Be.radii("borderTopRightRadius"),borderStartEndRadius:Be.logical({scale:"radii",property:{ltr:"borderTopRightRadius",rtl:"borderTopLeftRadius"}}),borderEndEndRadius:Be.logical({scale:"radii",property:{ltr:"borderBottomRightRadius",rtl:"borderBottomLeftRadius"}}),borderRight:Be.borders("borderRight"),borderInlineEnd:Be.borders("borderInlineEnd"),borderBottom:Be.borders("borderBottom"),borderBlockEnd:Be.borders("borderBlockEnd"),borderBottomLeftRadius:Be.radii("borderBottomLeftRadius"),borderBottomRightRadius:Be.radii("borderBottomRightRadius"),borderLeft:Be.borders("borderLeft"),borderInlineStart:{property:"borderInlineStart",scale:"borders"},borderInlineStartRadius:Be.logical({scale:"radii",property:{ltr:["borderTopLeftRadius","borderBottomLeftRadius"],rtl:["borderTopRightRadius","borderBottomRightRadius"]}}),borderInlineEndRadius:Be.logical({scale:"radii",property:{ltr:["borderTopRightRadius","borderBottomRightRadius"],rtl:["borderTopLeftRadius","borderBottomLeftRadius"]}}),borderX:Be.borders(["borderLeft","borderRight"]),borderInline:Be.borders("borderInline"),borderY:Be.borders(["borderTop","borderBottom"]),borderBlock:Be.borders("borderBlock"),borderTopWidth:Be.borderWidths("borderTopWidth"),borderBlockStartWidth:Be.borderWidths("borderBlockStartWidth"),borderTopColor:Be.colors("borderTopColor"),borderBlockStartColor:Be.colors("borderBlockStartColor"),borderTopStyle:Be.borderStyles("borderTopStyle"),borderBlockStartStyle:Be.borderStyles("borderBlockStartStyle"),borderBottomWidth:Be.borderWidths("borderBottomWidth"),borderBlockEndWidth:Be.borderWidths("borderBlockEndWidth"),borderBottomColor:Be.colors("borderBottomColor"),borderBlockEndColor:Be.colors("borderBlockEndColor"),borderBottomStyle:Be.borderStyles("borderBottomStyle"),borderBlockEndStyle:Be.borderStyles("borderBlockEndStyle"),borderLeftWidth:Be.borderWidths("borderLeftWidth"),borderInlineStartWidth:Be.borderWidths("borderInlineStartWidth"),borderLeftColor:Be.colors("borderLeftColor"),borderInlineStartColor:Be.colors("borderInlineStartColor"),borderLeftStyle:Be.borderStyles("borderLeftStyle"),borderInlineStartStyle:Be.borderStyles("borderInlineStartStyle"),borderRightWidth:Be.borderWidths("borderRightWidth"),borderInlineEndWidth:Be.borderWidths("borderInlineEndWidth"),borderRightColor:Be.colors("borderRightColor"),borderInlineEndColor:Be.colors("borderInlineEndColor"),borderRightStyle:Be.borderStyles("borderRightStyle"),borderInlineEndStyle:Be.borderStyles("borderInlineEndStyle"),borderTopRadius:Be.radii(["borderTopLeftRadius","borderTopRightRadius"]),borderBottomRadius:Be.radii(["borderBottomLeftRadius","borderBottomRightRadius"]),borderLeftRadius:Be.radii(["borderTopLeftRadius","borderBottomLeftRadius"]),borderRightRadius:Be.radii(["borderTopRightRadius","borderBottomRightRadius"])};Object.assign(ni,{rounded:ni.borderRadius,roundedTop:ni.borderTopRadius,roundedTopLeft:ni.borderTopLeftRadius,roundedTopRight:ni.borderTopRightRadius,roundedTopStart:ni.borderStartStartRadius,roundedTopEnd:ni.borderStartEndRadius,roundedBottom:ni.borderBottomRadius,roundedBottomLeft:ni.borderBottomLeftRadius,roundedBottomRight:ni.borderBottomRightRadius,roundedBottomStart:ni.borderEndStartRadius,roundedBottomEnd:ni.borderEndEndRadius,roundedLeft:ni.borderLeftRadius,roundedRight:ni.borderRightRadius,roundedStart:ni.borderInlineStartRadius,roundedEnd:ni.borderInlineEndRadius,borderStart:ni.borderInlineStart,borderEnd:ni.borderInlineEnd,borderTopStartRadius:ni.borderStartStartRadius,borderTopEndRadius:ni.borderStartEndRadius,borderBottomStartRadius:ni.borderEndStartRadius,borderBottomEndRadius:ni.borderEndEndRadius,borderStartRadius:ni.borderInlineStartRadius,borderEndRadius:ni.borderInlineEndRadius,borderStartWidth:ni.borderInlineStartWidth,borderEndWidth:ni.borderInlineEndWidth,borderStartColor:ni.borderInlineStartColor,borderEndColor:ni.borderInlineEndColor,borderStartStyle:ni.borderInlineStartStyle,borderEndStyle:ni.borderInlineEndStyle});const qve={color:Be.colors("color"),textColor:Be.colors("color"),fill:Be.colors("fill"),stroke:Be.colors("stroke"),accentColor:Be.colors("accentColor"),textFillColor:Be.colors("textFillColor")},Fk={alignItems:!0,alignContent:!0,justifyItems:!0,justifyContent:!0,flexWrap:!0,flexDirection:{transform:Ur.flexDirection},flex:!0,flexFlow:!0,flexGrow:!0,flexShrink:!0,flexBasis:Be.sizes("flexBasis"),justifySelf:!0,alignSelf:!0,order:!0,placeItems:!0,placeContent:!0,placeSelf:!0,gap:Be.space("gap"),rowGap:Be.space("rowGap"),columnGap:Be.space("columnGap")};Object.assign(Fk,{flexDir:Fk.flexDirection});const Mu={width:Be.sizesT("width"),inlineSize:Be.sizesT("inlineSize"),height:Be.sizes("height"),blockSize:Be.sizes("blockSize"),boxSize:Be.sizes(["width","height"]),minWidth:Be.sizes("minWidth"),minInlineSize:Be.sizes("minInlineSize"),minHeight:Be.sizes("minHeight"),minBlockSize:Be.sizes("minBlockSize"),maxWidth:Be.sizes("maxWidth"),maxInlineSize:Be.sizes("maxInlineSize"),maxHeight:Be.sizes("maxHeight"),maxBlockSize:Be.sizes("maxBlockSize"),overflow:!0,overflowX:!0,overflowY:!0,overscrollBehavior:!0,overscrollBehaviorX:!0,overscrollBehaviorY:!0,display:!0,aspectRatio:!0,hideFrom:{scale:"breakpoints",transform:(n,e)=>{var l,d;return{[`@media screen and (min-width: ${((d=(l=e.__breakpoints)==null?void 0:l.get(n))==null?void 0:d.minW)??n})`]:{display:"none"}}}},hideBelow:{scale:"breakpoints",transform:(n,e)=>{var l,d;return{[`@media screen and (max-width: ${((d=(l=e.__breakpoints)==null?void 0:l.get(n))==null?void 0:d._minW)??n})`]:{display:"none"}}}},verticalAlign:!0,boxSizing:!0,boxDecorationBreak:!0,float:Be.propT("float",Ur.float),objectFit:!0,objectPosition:!0,visibility:!0,isolation:!0};Object.assign(Mu,{w:Mu.width,h:Mu.height,minW:Mu.minWidth,maxW:Mu.maxWidth,minH:Mu.minHeight,maxH:Mu.maxHeight,overscroll:Mu.overscrollBehavior,overscrollX:Mu.overscrollBehaviorX,overscrollY:Mu.overscrollBehaviorY});const Yve={filter:{transform:Ur.filter},blur:Be.blur("--chakra-blur"),brightness:Be.propT("--chakra-brightness",Ur.brightness),contrast:Be.propT("--chakra-contrast",Ur.contrast),hueRotate:Be.propT("--chakra-hue-rotate",Ur.hueRotate),invert:Be.propT("--chakra-invert",Ur.invert),saturate:Be.propT("--chakra-saturate",Ur.saturate),dropShadow:Be.propT("--chakra-drop-shadow",Ur.dropShadow),backdropFilter:{transform:Ur.backdropFilter},backdropBlur:Be.blur("--chakra-backdrop-blur"),backdropBrightness:Be.propT("--chakra-backdrop-brightness",Ur.brightness),backdropContrast:Be.propT("--chakra-backdrop-contrast",Ur.contrast),backdropHueRotate:Be.propT("--chakra-backdrop-hue-rotate",Ur.hueRotate),backdropInvert:Be.propT("--chakra-backdrop-invert",Ur.invert),backdropSaturate:Be.propT("--chakra-backdrop-saturate",Ur.saturate)},Xve={ring:{transform:Ur.ring},ringColor:Be.colors("--chakra-ring-color"),ringOffset:Be.prop("--chakra-ring-offset-width"),ringOffsetColor:Be.colors("--chakra-ring-offset-color"),ringInset:Be.prop("--chakra-ring-inset")},Jve={appearance:!0,cursor:!0,resize:!0,userSelect:!0,pointerEvents:!0,outline:{transform:Ur.outline},outlineOffset:!0,outlineColor:Be.colors("outlineColor")},HZ={gridGap:Be.space("gridGap"),gridColumnGap:Be.space("gridColumnGap"),gridRowGap:Be.space("gridRowGap"),gridColumn:!0,gridRow:!0,gridAutoFlow:!0,gridAutoColumns:!0,gridColumnStart:!0,gridColumnEnd:!0,gridRowStart:!0,gridRowEnd:!0,gridAutoRows:!0,gridTemplate:!0,gridTemplateColumns:!0,gridTemplateRows:!0,gridTemplateAreas:!0,gridArea:!0};function Qve(n,e,i,o){const l=typeof e=="string"?e.split("."):[e];for(o=0;o<l.length&&n;o+=1)n=n[l[o]];return n===void 0?i:n}const Zve=n=>{const e=new WeakMap;return(o,l,d,p)=>{if(typeof o>"u")return n(o,l,d);e.has(o)||e.set(o,new Map);const _=e.get(o);if(_.has(l))return _.get(l);const E=n(o,l,d,p);return _.set(l,E),E}},eSe=Zve(Qve),tSe={border:"0px",clip:"rect(0, 0, 0, 0)",width:"1px",height:"1px",margin:"-1px",padding:"0px",overflow:"hidden",whiteSpace:"nowrap",position:"absolute"},nSe={position:"static",width:"auto",height:"auto",clip:"auto",padding:"0",margin:"0",overflow:"visible",whiteSpace:"normal"},IM=(n,e,i)=>{const o={},l=eSe(n,e,{});for(const d in l)d in i&&i[d]!=null||(o[d]=l[d]);return o},rSe={srOnly:{transform(n){return n===!0?tSe:n==="focusable"?nSe:{}}},layerStyle:{processResult:!0,transform:(n,e,i)=>IM(e,`layerStyles.${n}`,i)},textStyle:{processResult:!0,transform:(n,e,i)=>IM(e,`textStyles.${n}`,i)},apply:{processResult:!0,transform:(n,e,i)=>IM(e,n,i)}},iC={position:!0,pos:Be.prop("position"),zIndex:Be.prop("zIndex","zIndices"),inset:Be.spaceT("inset"),insetX:Be.spaceT(["left","right"]),insetInline:Be.spaceT("insetInline"),insetY:Be.spaceT(["top","bottom"]),insetBlock:Be.spaceT("insetBlock"),top:Be.spaceT("top"),insetBlockStart:Be.spaceT("insetBlockStart"),bottom:Be.spaceT("bottom"),insetBlockEnd:Be.spaceT("insetBlockEnd"),left:Be.spaceT("left"),insetInlineStart:Be.logical({scale:"space",property:{ltr:"left",rtl:"right"}}),right:Be.spaceT("right"),insetInlineEnd:Be.logical({scale:"space",property:{ltr:"right",rtl:"left"}})};Object.assign(iC,{insetStart:iC.insetInlineStart,insetEnd:iC.insetInlineEnd});const ZU={boxShadow:Be.shadows("boxShadow"),mixBlendMode:!0,blendMode:Be.prop("mixBlendMode"),backgroundBlendMode:!0,bgBlendMode:Be.prop("backgroundBlendMode"),opacity:!0};Object.assign(ZU,{shadow:ZU.boxShadow});const rs={margin:Be.spaceT("margin"),marginTop:Be.spaceT("marginTop"),marginBlockStart:Be.spaceT("marginBlockStart"),marginRight:Be.spaceT("marginRight"),marginInlineEnd:Be.spaceT("marginInlineEnd"),marginBottom:Be.spaceT("marginBottom"),marginBlockEnd:Be.spaceT("marginBlockEnd"),marginLeft:Be.spaceT("marginLeft"),marginInlineStart:Be.spaceT("marginInlineStart"),marginX:Be.spaceT(["marginInlineStart","marginInlineEnd"]),marginInline:Be.spaceT("marginInline"),marginY:Be.spaceT(["marginTop","marginBottom"]),marginBlock:Be.spaceT("marginBlock"),padding:Be.space("padding"),paddingTop:Be.space("paddingTop"),paddingBlockStart:Be.space("paddingBlockStart"),paddingRight:Be.space("paddingRight"),paddingBottom:Be.space("paddingBottom"),paddingBlockEnd:Be.space("paddingBlockEnd"),paddingLeft:Be.space("paddingLeft"),paddingInlineStart:Be.space("paddingInlineStart"),paddingInlineEnd:Be.space("paddingInlineEnd"),paddingX:Be.space(["paddingInlineStart","paddingInlineEnd"]),paddingInline:Be.space("paddingInline"),paddingY:Be.space(["paddingTop","paddingBottom"]),paddingBlock:Be.space("paddingBlock")};Object.assign(rs,{m:rs.margin,mt:rs.marginTop,mr:rs.marginRight,me:rs.marginInlineEnd,marginEnd:rs.marginInlineEnd,mb:rs.marginBottom,ml:rs.marginLeft,ms:rs.marginInlineStart,marginStart:rs.marginInlineStart,mx:rs.marginX,my:rs.marginY,p:rs.padding,pt:rs.paddingTop,py:rs.paddingY,px:rs.paddingX,pb:rs.paddingBottom,pl:rs.paddingLeft,ps:rs.paddingInlineStart,paddingStart:rs.paddingInlineStart,pr:rs.paddingRight,pe:rs.paddingInlineEnd,paddingEnd:rs.paddingInlineEnd});const iSe={scrollBehavior:!0,scrollSnapAlign:!0,scrollSnapStop:!0,scrollSnapType:!0,scrollMargin:Be.spaceT("scrollMargin"),scrollMarginTop:Be.spaceT("scrollMarginTop"),scrollMarginBottom:Be.spaceT("scrollMarginBottom"),scrollMarginLeft:Be.spaceT("scrollMarginLeft"),scrollMarginRight:Be.spaceT("scrollMarginRight"),scrollMarginX:Be.spaceT(["scrollMarginLeft","scrollMarginRight"]),scrollMarginY:Be.spaceT(["scrollMarginTop","scrollMarginBottom"]),scrollPadding:Be.spaceT("scrollPadding"),scrollPaddingTop:Be.spaceT("scrollPaddingTop"),scrollPaddingBottom:Be.spaceT("scrollPaddingBottom"),scrollPaddingLeft:Be.spaceT("scrollPaddingLeft"),scrollPaddingRight:Be.spaceT("scrollPaddingRight"),scrollPaddingX:Be.spaceT(["scrollPaddingLeft","scrollPaddingRight"]),scrollPaddingY:Be.spaceT(["scrollPaddingTop","scrollPaddingBottom"])},sSe={fontFamily:Be.prop("fontFamily","fonts"),fontSize:Be.prop("fontSize","fontSizes",Ur.px),fontWeight:Be.prop("fontWeight","fontWeights"),lineHeight:Be.prop("lineHeight","lineHeights"),letterSpacing:Be.prop("letterSpacing","letterSpacings"),textAlign:!0,fontStyle:!0,textIndent:!0,wordBreak:!0,overflowWrap:!0,textOverflow:!0,textTransform:!0,whiteSpace:!0,isTruncated:{transform(n){if(n===!0)return{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}}},noOfLines:{static:{overflow:"hidden",textOverflow:"ellipsis",display:"-webkit-box",WebkitBoxOrient:"vertical",WebkitLineClamp:"var(--chakra-line-clamp)"},property:"--chakra-line-clamp"}},oSe={textDecorationColor:Be.colors("textDecorationColor"),textDecoration:!0,textDecor:{property:"textDecoration"},textDecorationLine:!0,textDecorationStyle:!0,textDecorationThickness:!0,textUnderlineOffset:!0,textShadow:Be.shadows("textShadow")},aSe={clipPath:!0,transform:Be.propT("transform",Ur.transform),transformOrigin:!0,translateX:Be.spaceT("--chakra-translate-x"),translateY:Be.spaceT("--chakra-translate-y"),skewX:Be.degreeT("--chakra-skew-x"),skewY:Be.degreeT("--chakra-skew-y"),scaleX:Be.prop("--chakra-scale-x"),scaleY:Be.prop("--chakra-scale-y"),scale:Be.prop(["--chakra-scale-x","--chakra-scale-y"]),rotate:Be.degreeT("--chakra-rotate")},cSe={listStyleType:!0,listStylePosition:!0,listStylePos:Be.prop("listStylePosition"),listStyleImage:!0,listStyleImg:Be.prop("listStyleImage")},lSe={transition:!0,transitionDelay:!0,animation:!0,willChange:!0,transitionDuration:Be.prop("transitionDuration","transition.duration"),transitionProperty:Be.prop("transitionProperty","transition.property"),transitionTimingFunction:Be.prop("transitionTimingFunction","transition.easing")},VF=Xh({},ZO,ni,qve,Fk,Mu,Yve,Xve,Jve,HZ,rSe,iC,ZU,rs,iSe,sSe,oSe,aSe,cSe,lSe),uSe=Object.assign({},rs,Mu,Fk,HZ,iC),dSe=Object.keys(uSe),hSe=[...Object.keys(VF),...zZ],fSe={...VF,...t0},pSe=n=>n in fSe,mSe=n=>e=>{if(!e.__breakpoints)return n;const{isResponsive:i,toArrayValue:o,media:l}=e.__breakpoints,d={};for(const p in n){let _=ul(n[p],e);if(_==null)continue;if(_=Fu(_)&&i(_)?o(_):_,!Array.isArray(_)){d[p]=_;continue}const E=_.slice(0,l.length).length;for(let b=0;b<E;b+=1){const C=l==null?void 0:l[b];if(!C){d[p]=_[b];continue}d[C]=d[C]||{},_[b]!=null&&(d[C][p]=_[b])}}return d};function gSe(n){const e=[];let i="",o=!1;for(let l=0;l<n.length;l++){const d=n[l];d==="("?(o=!0,i+=d):d===")"?(o=!1,i+=d):d===","&&!o?(e.push(i),i=""):i+=d}return i=i.trim(),i&&e.push(i),e}function _Se(n){return/^var\(--.+\)$/.test(n)}const ySe=(n,e)=>n.startsWith("--")&&typeof e=="string"&&!_Se(e),ESe=(n,e)=>{if(e==null)return e;const i=p=>{var _,E;return(E=(_=n.__cssMap)==null?void 0:_[p])==null?void 0:E.varRef},o=p=>i(p)??p,[l,d]=gSe(e);return e=i(l)??o(d)??o(e),e};function vSe(n){const{configs:e={},pseudos:i={},theme:o}=n,l=(d,p=!1)=>{var C;const _=ul(d,o),E=mSe(_)(o);let b={};for(let I in E){const O=E[I];let L=ul(O,o);I in i&&(I=i[I]),ySe(I,L)&&(L=ESe(o,L));let U=e[I];if(U===!0&&(U={property:I}),Fu(L)){b[I]=b[I]??{},b[I]=Xh({},b[I],l(L,!0));continue}let B=((C=U==null?void 0:U.transform)==null?void 0:C.call(U,L,o,_))??L;B=U!=null&&U.processResult?l(B,!0):B;const W=ul(U==null?void 0:U.property,o);if(!p&&(U!=null&&U.static)){const J=ul(U.static,o);b=Xh({},b,J)}if(W&&Array.isArray(W)){for(const J of W)b[J]=B;continue}if(W){W==="&"&&Fu(B)?b=Xh({},b,B):b[W]=B;continue}if(Fu(B)){b=Xh({},b,B);continue}b[I]=B}return b};return l}const $Z=n=>e=>vSe({theme:e,pseudos:t0,configs:VF})(n);function QGe(n){return n}function ZGe(n){return n}function Yi(n){return{definePartsStyle(e){return e},defineMultiStyleConfig(e){return{parts:n,...e}}}}function SSe(n,e,i){var o,l;return((l=(o=n.__cssMap)==null?void 0:o[`${e}.${i}`])==null?void 0:l.varRef)??i}function bSe(n,e){if(Array.isArray(n))return n;if(Fu(n))return e(n);if(n!=null)return[n]}function TSe(n,e){for(let i=e+1;i<n.length;i++)if(n[i]!=null)return i;return-1}function wSe(n){const e=n.__breakpoints;return function(o,l,d,p){var O,L;if(!e)return;const _={},E=bSe(d,e.toArrayValue);if(!E)return _;const b=E.length,C=b===1,I=!!o.parts;for(let U=0;U<b;U++){const B=e.details[U],W=e.details[TSe(E,U)],J=jw(B.minW,W==null?void 0:W._minW),$=ul((O=o[l])==null?void 0:O[E[U]],p);if($){if(I){(L=o.parts)==null||L.forEach(ie=>{Xh(_,{[ie]:C?$[ie]:{[J]:$[ie]}})});continue}if(!I){C?Xh(_,$):_[J]=$;continue}_[J]=$}}return _}}function CSe(n){return e=>{const{variant:i,size:o,theme:l}=e,d=wSe(l);return Xh({},ul(n.baseStyle??{},e),d(n,"sizes",o,e),d(n,"variants",i,e))}}function Wi(n){return W0(n,["styleConfig","size","variant","colorScheme"])}function KZ(n){return Fu(n)&&n.reference?n.reference:String(n)}const D1=(n,...e)=>e.map(KZ).join(` ${n} `).replace(/calc/g,""),YK=(...n)=>`calc(${D1("+",...n)})`,XK=(...n)=>`calc(${D1("-",...n)})`,eV=(...n)=>`calc(${D1("*",...n)})`,JK=(...n)=>`calc(${D1("/",...n)})`,QK=n=>{const e=KZ(n);return e!=null&&!Number.isNaN(parseFloat(e))?String(e).startsWith("-")?String(e).slice(1):`-${e}`:eV(e,-1)},Tp=Object.assign(n=>({add:(...e)=>Tp(YK(n,...e)),subtract:(...e)=>Tp(XK(n,...e)),multiply:(...e)=>Tp(eV(n,...e)),divide:(...e)=>Tp(JK(n,...e)),negate:()=>Tp(QK(n)),toString:()=>n.toString()}),{add:YK,subtract:XK,multiply:eV,divide:JK,negate:QK});function RSe(n,e="-"){return n.replace(/\s+/g,e)}function ISe(n){const e=RSe(n.toString());return PSe(ASe(e))}function ASe(n){return n.includes("\\.")?n:!Number.isInteger(parseFloat(n.toString()))?n.replace(".","\\."):n}function PSe(n){return n.replace(/[!-,/:-@[-^`{-~]/g,"\\$&")}function OSe(n,e=""){return[e,n].filter(Boolean).join("-")}function kSe(n,e){return`var(${n}${e?`, ${e}`:""})`}function NSe(n,e=""){return ISe(`--${OSe(n,e)}`)}function Un(n,e,i){const o=NSe(n,i);return{variable:o,reference:kSe(o,e)}}function DSe(n,e){const i={};for(const o of e){if(Array.isArray(o)){const[l,d]=o;i[l]=Un(`${n}-${l}`,d);continue}i[o]=Un(`${n}-${o}`)}return i}const xSe=["colors","borders","borderWidths","borderStyles","fonts","fontSizes","fontWeights","gradients","letterSpacings","lineHeights","radii","space","shadows","sizes","zIndices","transition","blur","breakpoints"];function LSe(n){return PZ(n,xSe)}function MSe(n){return n.semanticTokens}function USe(n){const{__cssMap:e,__cssVars:i,__breakpoints:o,...l}=n;return l}function VSe(n){const e=LSe(n),i=MSe(n),o=d=>zZ.includes(d)||d==="default",l={};return FK(e,(d,p)=>{d!=null&&(l[p.join(".")]={isSemantic:!1,value:d})}),FK(i,(d,p)=>{d!=null&&(l[p.join(".")]={isSemantic:!0,value:d})},{stop:d=>Object.keys(d).every(o)}),l}function ZK(n,e){return Un(String(n).replace(/\./g,"-"),void 0,e)}function FSe(n){var p;const e=VSe(n),i=(p=n.config)==null?void 0:p.cssVarPrefix;let o={};const l={};function d(_,E){const C=[String(_).split(".")[0],E].join(".");if(!e[C])return E;const{reference:O}=ZK(C,i);return O}for(const[_,E]of Object.entries(e)){const{isSemantic:b,value:C}=E,{variable:I,reference:O}=ZK(_,i);if(!b){if(_.startsWith("space")){const U=_.split("."),[B,...W]=U,J=`${B}.-${W.join(".")}`,$=Tp.negate(C),ie=Tp.negate(O);l[J]={value:$,var:I,varRef:ie}}o[I]=C,l[_]={value:C,var:I,varRef:O};continue}const L=Fu(C)?C:{default:C};o=Xh(o,Object.entries(L).reduce((U,[B,W])=>{if(!W)return U;const J=d(_,`${W}`);if(B==="default")return U[I]=J,U;const $=(t0==null?void 0:t0[B])??B;return U[$]={[I]:J},U},{})),l[_]={value:O,var:I,varRef:O}}return{cssVars:o,cssMap:l}}function jSe(n){const e=USe(n),{cssMap:i,cssVars:o}=FSe(e);return Object.assign(e,{__cssVars:{...{"--chakra-ring-inset":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-ring-offset-width":"0px","--chakra-ring-offset-color":"#fff","--chakra-ring-color":"rgba(66, 153, 225, 0.6)","--chakra-ring-offset-shadow":"0 0 #0000","--chakra-ring-shadow":"0 0 #0000","--chakra-space-x-reverse":"0","--chakra-space-y-reverse":"0"},...o},__cssMap:i,__breakpoints:kEe(e.breakpoints)}),e}function ai(n,e={}){let i=!1;function o(){if(!i){i=!0;return}throw new Error("[anatomy] .part(...) should only be called once. Did you mean to use .extend(...) ?")}function l(...C){o();for(const I of C)e[I]=E(I);return ai(n,e)}function d(...C){for(const I of C)I in e||(e[I]=E(I));return ai(n,e)}function p(){return Object.fromEntries(Object.entries(e).map(([I,O])=>[I,O.selector]))}function _(){return Object.fromEntries(Object.entries(e).map(([I,O])=>[I,O.className]))}function E(C){const L=`chakra-${(["container","root"].includes(C??"")?[n]:[n,C]).filter(Boolean).join("__")}`;return{className:L,selector:`.${L}`,toString:()=>C}}return{parts:l,toPart:E,extend:d,selectors:p,classnames:_,get keys(){return Object.keys(e)},__type:{}}}const BSe=ai("accordion").parts("root","container","button","panel","icon"),WSe=ai("alert").parts("title","description","container","icon","spinner"),zSe=ai("avatar").parts("label","badge","container","excessLabel","group"),GSe=ai("breadcrumb").parts("link","item","container","separator");ai("button").parts();const HSe=ai("checkbox").parts("control","icon","container","label");ai("progress").parts("track","filledTrack","label");const $Se=ai("drawer").parts("overlay","dialogContainer","dialog","header","closeButton","body","footer"),KSe=ai("editable").parts("preview","input","textarea"),qSe=ai("form").parts("container","requiredIndicator","helperText"),YSe=ai("formError").parts("text","icon"),XSe=ai("input").parts("addon","field","element","group"),JSe=ai("list").parts("container","item","icon"),QSe=ai("menu").parts("button","list","item","groupTitle","icon","command","divider"),ZSe=ai("modal").parts("overlay","dialogContainer","dialog","header","closeButton","body","footer"),e0e=ai("numberinput").parts("root","field","stepperGroup","stepper");ai("pininput").parts("field");const t0e=ai("popover").parts("content","header","body","footer","popper","arrow","closeButton"),n0e=ai("progress").parts("label","filledTrack","track"),r0e=ai("radio").parts("container","control","label"),i0e=ai("select").parts("field","icon"),s0e=ai("slider").parts("container","track","thumb","filledTrack","mark"),o0e=ai("stat").parts("container","label","helpText","number","icon"),a0e=ai("switch").parts("container","track","thumb","label"),c0e=ai("table").parts("table","thead","tbody","tr","th","td","tfoot","caption"),l0e=ai("tabs").parts("root","tab","tablist","tabpanel","tabpanels","indicator"),u0e=ai("tag").parts("container","label","closeButton"),d0e=ai("card").parts("container","header","body","footer");ai("stepper").parts("stepper","step","title","description","indicator","separator","icon","number");const{definePartsStyle:h0e,defineMultiStyleConfig:f0e}=Yi(BSe.keys),p0e={borderTopWidth:"1px",borderColor:"inherit",_last:{borderBottomWidth:"1px"}},m0e={transitionProperty:"common",transitionDuration:"normal",fontSize:"md",_focusVisible:{boxShadow:"outline"},_hover:{bg:"blackAlpha.50"},_disabled:{opacity:.4,cursor:"not-allowed"},px:"4",py:"2"},g0e={pt:"2",px:"4",pb:"5"},_0e={fontSize:"1.25em"},y0e=h0e({container:p0e,button:m0e,panel:g0e,icon:_0e}),E0e=f0e({baseStyle:y0e});function Cy(n,e,i){return Math.min(Math.max(n,i),e)}class v0e extends Error{constructor(e){super(`Failed to parse color: "${e}"`)}}var Ww=v0e;function FF(n){if(typeof n!="string")throw new Ww(n);if(n.trim().toLowerCase()==="transparent")return[0,0,0,0];let e=n.trim();e=A0e.test(n)?T0e(n):n;const i=w0e.exec(e);if(i){const p=Array.from(i).slice(1);return[...p.slice(0,3).map(_=>parseInt(wC(_,2),16)),parseInt(wC(p[3]||"f",2),16)/255]}const o=C0e.exec(e);if(o){const p=Array.from(o).slice(1);return[...p.slice(0,3).map(_=>parseInt(_,16)),parseInt(p[3]||"ff",16)/255]}const l=R0e.exec(e);if(l){const p=Array.from(l).slice(1);return[...p.slice(0,3).map(_=>parseInt(_,10)),parseFloat(p[3]||"1")]}const d=I0e.exec(e);if(d){const[p,_,E,b]=Array.from(d).slice(1).map(parseFloat);if(Cy(0,100,_)!==_)throw new Ww(n);if(Cy(0,100,E)!==E)throw new Ww(n);return[...P0e(p,_,E),Number.isNaN(b)?1:b]}throw new Ww(n)}function S0e(n){let e=5381,i=n.length;for(;i;)e=e*33^n.charCodeAt(--i);return(e>>>0)%2341}const eq=n=>parseInt(n.replace(/_/g,""),36),b0e="1q29ehhb 1n09sgk7 1kl1ekf_ _yl4zsno 16z9eiv3 1p29lhp8 _bd9zg04 17u0____ _iw9zhe5 _to73___ _r45e31e _7l6g016 _jh8ouiv _zn3qba8 1jy4zshs 11u87k0u 1ro9yvyo 1aj3xael 1gz9zjz0 _3w8l4xo 1bf1ekf_ _ke3v___ _4rrkb__ 13j776yz _646mbhl _nrjr4__ _le6mbhl 1n37ehkb _m75f91n _qj3bzfz 1939yygw 11i5z6x8 _1k5f8xs 1509441m 15t5lwgf _ae2th1n _tg1ugcv 1lp1ugcv 16e14up_ _h55rw7n _ny9yavn _7a11xb_ 1ih442g9 _pv442g9 1mv16xof 14e6y7tu 1oo9zkds 17d1cisi _4v9y70f _y98m8kc 1019pq0v 12o9zda8 _348j4f4 1et50i2o _8epa8__ _ts6senj 1o350i2o 1mi9eiuo 1259yrp0 1ln80gnw _632xcoy 1cn9zldc _f29edu4 1n490c8q _9f9ziet 1b94vk74 _m49zkct 1kz6s73a 1eu9dtog _q58s1rz 1dy9sjiq __u89jo3 _aj5nkwg _ld89jo3 13h9z6wx _qa9z2ii _l119xgq _bs5arju 1hj4nwk9 1qt4nwk9 1ge6wau6 14j9zlcw 11p1edc_ _ms1zcxe _439shk6 _jt9y70f _754zsow 1la40eju _oq5p___ _x279qkz 1fa5r3rv _yd2d9ip _424tcku _8y1di2_ _zi2uabw _yy7rn9h 12yz980_ __39ljp6 1b59zg0x _n39zfzp 1fy9zest _b33k___ _hp9wq92 1il50hz4 _io472ub _lj9z3eo 19z9ykg0 _8t8iu3a 12b9bl4a 1ak5yw0o _896v4ku _tb8k8lv _s59zi6t _c09ze0p 1lg80oqn 1id9z8wb _238nba5 1kq6wgdi _154zssg _tn3zk49 _da9y6tc 1sg7cv4f _r12jvtt 1gq5fmkz 1cs9rvci _lp9jn1c _xw1tdnb 13f9zje6 16f6973h _vo7ir40 _bt5arjf _rc45e4t _hr4e100 10v4e100 _hc9zke2 _w91egv_ _sj2r1kk 13c87yx8 _vqpds__ _ni8ggk8 _tj9yqfb 1ia2j4r4 _7x9b10u 1fc9ld4j 1eq9zldr _5j9lhpx _ez9zl6o _md61fzm".split(" ").reduce((n,e)=>{const i=eq(e.substring(0,3)),o=eq(e.substring(3)).toString(16);let l="";for(let d=0;d<6-o.length;d++)l+="0";return n[i]=`${l}${o}`,n},{});function T0e(n){const e=n.toLowerCase().trim(),i=b0e[S0e(e)];if(!i)throw new Ww(n);return`#${i}`}const wC=(n,e)=>Array.from(Array(e)).map(()=>n).join(""),w0e=new RegExp(`^#${wC("([a-f0-9])",3)}([a-f0-9])?$`,"i"),C0e=new RegExp(`^#${wC("([a-f0-9]{2})",3)}([a-f0-9]{2})?$`,"i"),R0e=new RegExp(`^rgba?\\(\\s*(\\d+)\\s*${wC(",\\s*(\\d+)\\s*",2)}(?:,\\s*([\\d.]+))?\\s*\\)$`,"i"),I0e=/^hsla?\(\s*([\d.]+)\s*,\s*([\d.]+)%\s*,\s*([\d.]+)%(?:\s*,\s*([\d.]+))?\s*\)$/i,A0e=/^[a-z]+$/i,tq=n=>Math.round(n*255),P0e=(n,e,i)=>{let o=i/100;if(e===0)return[o,o,o].map(tq);const l=(n%360+360)%360/60,d=(1-Math.abs(2*o-1))*(e/100),p=d*(1-Math.abs(l%2-1));let _=0,E=0,b=0;l>=0&&l<1?(_=d,E=p):l>=1&&l<2?(_=p,E=d):l>=2&&l<3?(E=d,b=p):l>=3&&l<4?(E=p,b=d):l>=4&&l<5?(_=p,b=d):l>=5&&l<6&&(_=d,b=p);const C=o-d/2,I=_+C,O=E+C,L=b+C;return[I,O,L].map(tq)};function O0e(n,e,i,o){return`rgba(${Cy(0,255,n).toFixed()}, ${Cy(0,255,e).toFixed()}, ${Cy(0,255,i).toFixed()}, ${parseFloat(Cy(0,1,o).toFixed(3))})`}function k0e(n,e){const[i,o,l,d]=FF(n);return O0e(i,o,l,d-e)}function N0e(n){const[e,i,o,l]=FF(n);let d=p=>{const _=Cy(0,255,p).toString(16);return _.length===1?`0${_}`:_};return`#${d(e)}${d(i)}${d(o)}${l<1?d(Math.round(l*255)):""}`}const D0e=n=>Object.keys(n).length===0;function x0e(n,e,i,o,l){for(e=e.split?e.split("."):e,o=0;o<e.length;o++)n=n?n[e[o]]:l;return n===l?i:n}const Cc=(n,e,i)=>{const o=x0e(n,`colors.${e}`,e);try{return N0e(o),o}catch{return i??"#000000"}},L0e=n=>{const[e,i,o]=FF(n);return(e*299+i*587+o*114)/1e3},M0e=n=>e=>{const i=Cc(e,n);return L0e(i)<128?"dark":"light"},U0e=n=>e=>M0e(n)(e)==="dark",g0=(n,e)=>i=>{const o=Cc(i,n);return k0e(o,1-e)};function nq(n="1rem",e="rgba(255, 255, 255, 0.15)"){return{backgroundImage:`linear-gradient(
    45deg,
    ${e} 25%,
    transparent 25%,
    transparent 50%,
    ${e} 50%,
    ${e} 75%,
    transparent 75%,
    transparent
  )`,backgroundSize:`${n} ${n}`}}const V0e=()=>`#${Math.floor(Math.random()*16777215).toString(16).padEnd(6,"0")}`;function F0e(n){const e=V0e();return!n||D0e(n)?e:n.string&&n.colors?B0e(n.string,n.colors):n.string&&!n.colors?j0e(n.string):n.colors&&!n.string?W0e(n.colors):e}function j0e(n){let e=0;if(n.length===0)return e.toString();for(let o=0;o<n.length;o+=1)e=n.charCodeAt(o)+((e<<5)-e),e=e&e;let i="#";for(let o=0;o<3;o+=1){const l=e>>o*8&255;i+=`00${l.toString(16)}`.substr(-2)}return i}function B0e(n,e){let i=0;if(n.length===0)return e[0];for(let o=0;o<n.length;o+=1)i=n.charCodeAt(o)+((i<<5)-i),i=i&i;return i=(i%e.length+e.length)%e.length,e[i]}function W0e(n){return n[Math.floor(Math.random()*n.length)]}function Mn(n,e){return i=>i.colorMode==="dark"?e:n}function jF(n){const{orientation:e,vertical:i,horizontal:o}=n;return e?e==="vertical"?i:o:{}}function qZ(n){return Fu(n)&&n.reference?n.reference:String(n)}const x1=(n,...e)=>e.map(qZ).join(` ${n} `).replace(/calc/g,""),rq=(...n)=>`calc(${x1("+",...n)})`,iq=(...n)=>`calc(${x1("-",...n)})`,tV=(...n)=>`calc(${x1("*",...n)})`,sq=(...n)=>`calc(${x1("/",...n)})`,oq=n=>{const e=qZ(n);return e!=null&&!Number.isNaN(parseFloat(e))?String(e).startsWith("-")?String(e).slice(1):`-${e}`:tV(e,-1)},wp=Object.assign(n=>({add:(...e)=>wp(rq(n,...e)),subtract:(...e)=>wp(iq(n,...e)),multiply:(...e)=>wp(tV(n,...e)),divide:(...e)=>wp(sq(n,...e)),negate:()=>wp(oq(n)),toString:()=>n.toString()}),{add:rq,subtract:iq,multiply:tV,divide:sq,negate:oq});function z0e(n){return!Number.isInteger(parseFloat(n.toString()))}function G0e(n,e="-"){return n.replace(/\s+/g,e)}function YZ(n){const e=G0e(n.toString());return e.includes("\\.")?n:z0e(n)?e.replace(".","\\."):n}function H0e(n,e=""){return[e,YZ(n)].filter(Boolean).join("-")}function $0e(n,e){return`var(${YZ(n)}${e?`, ${e}`:""})`}function K0e(n,e=""){return`--${H0e(n,e)}`}function Io(n,e){const i=K0e(n,e==null?void 0:e.prefix);return{variable:i,reference:$0e(i,q0e(e==null?void 0:e.fallback))}}function q0e(n){return n==null?void 0:n.reference}const{definePartsStyle:nR,defineMultiStyleConfig:Y0e}=Yi(WSe.keys),Wl=Un("alert-fg"),zp=Un("alert-bg"),X0e=nR({container:{bg:zp.reference,px:"4",py:"3"},title:{fontWeight:"bold",lineHeight:"6",marginEnd:"2"},description:{lineHeight:"6"},icon:{color:Wl.reference,flexShrink:0,marginEnd:"3",w:"5",h:"6"},spinner:{color:Wl.reference,flexShrink:0,marginEnd:"3",w:"5",h:"5"}});function BF(n){const{theme:e,colorScheme:i}=n,o=g0(`${i}.200`,.16)(e);return{light:`colors.${i}.100`,dark:o}}const J0e=nR(n=>{const{colorScheme:e}=n,i=BF(n);return{container:{[Wl.variable]:`colors.${e}.600`,[zp.variable]:i.light,_dark:{[Wl.variable]:`colors.${e}.200`,[zp.variable]:i.dark}}}}),Q0e=nR(n=>{const{colorScheme:e}=n,i=BF(n);return{container:{[Wl.variable]:`colors.${e}.600`,[zp.variable]:i.light,_dark:{[Wl.variable]:`colors.${e}.200`,[zp.variable]:i.dark},paddingStart:"3",borderStartWidth:"4px",borderStartColor:Wl.reference}}}),Z0e=nR(n=>{const{colorScheme:e}=n,i=BF(n);return{container:{[Wl.variable]:`colors.${e}.600`,[zp.variable]:i.light,_dark:{[Wl.variable]:`colors.${e}.200`,[zp.variable]:i.dark},pt:"2",borderTopWidth:"4px",borderTopColor:Wl.reference}}}),ebe=nR(n=>{const{colorScheme:e}=n;return{container:{[Wl.variable]:"colors.white",[zp.variable]:`colors.${e}.600`,_dark:{[Wl.variable]:"colors.gray.900",[zp.variable]:`colors.${e}.200`},color:Wl.reference}}}),tbe={subtle:J0e,"left-accent":Q0e,"top-accent":Z0e,solid:ebe},nbe=Y0e({baseStyle:X0e,variants:tbe,defaultProps:{variant:"subtle",colorScheme:"blue"}}),XZ={px:"1px",.5:"0.125rem",1:"0.25rem",1.5:"0.375rem",2:"0.5rem",2.5:"0.625rem",3:"0.75rem",3.5:"0.875rem",4:"1rem",5:"1.25rem",6:"1.5rem",7:"1.75rem",8:"2rem",9:"2.25rem",10:"2.5rem",12:"3rem",14:"3.5rem",16:"4rem",20:"5rem",24:"6rem",28:"7rem",32:"8rem",36:"9rem",40:"10rem",44:"11rem",48:"12rem",52:"13rem",56:"14rem",60:"15rem",64:"16rem",72:"18rem",80:"20rem",96:"24rem"},rbe={max:"max-content",min:"min-content",full:"100%","3xs":"14rem","2xs":"16rem",xs:"20rem",sm:"24rem",md:"28rem",lg:"32rem",xl:"36rem","2xl":"42rem","3xl":"48rem","4xl":"56rem","5xl":"64rem","6xl":"72rem","7xl":"80rem","8xl":"90rem",prose:"60ch"},ibe={sm:"640px",md:"768px",lg:"1024px",xl:"1280px"},JZ={...XZ,...rbe,container:ibe},sbe=n=>typeof n=="function";function Rc(n,...e){return sbe(n)?n(...e):n}const{definePartsStyle:QZ,defineMultiStyleConfig:obe}=Yi(zSe.keys),n0=Un("avatar-border-color"),sC=Un("avatar-bg"),CC=Un("avatar-font-size"),_0=Un("avatar-size"),abe={borderRadius:"full",border:"0.2em solid",borderColor:n0.reference,[n0.variable]:"white",_dark:{[n0.variable]:"colors.gray.800"}},cbe={bg:sC.reference,fontSize:CC.reference,width:_0.reference,height:_0.reference,lineHeight:"1",[sC.variable]:"colors.gray.200",_dark:{[sC.variable]:"colors.whiteAlpha.400"}},lbe=n=>{const{name:e,theme:i}=n,o=e?F0e({string:e}):"colors.gray.400",l=U0e(o)(i);let d="white";return l||(d="gray.800"),{bg:sC.reference,fontSize:CC.reference,color:d,borderColor:n0.reference,verticalAlign:"top",width:_0.reference,height:_0.reference,"&:not([data-loaded])":{[sC.variable]:o},[n0.variable]:"colors.white",_dark:{[n0.variable]:"colors.gray.800"}}},ube={fontSize:CC.reference,lineHeight:"1"},dbe=QZ(n=>({badge:Rc(abe,n),excessLabel:Rc(cbe,n),container:Rc(lbe,n),label:ube}));function dg(n){const e=n!=="100%"?JZ[n]:void 0;return QZ({container:{[_0.variable]:e??n,[CC.variable]:`calc(${e??n} / 2.5)`},excessLabel:{[_0.variable]:e??n,[CC.variable]:`calc(${e??n} / 2.5)`}})}const hbe={"2xs":dg(4),xs:dg(6),sm:dg(8),md:dg(12),lg:dg(16),xl:dg(24),"2xl":dg(32),full:dg("100%")},fbe=obe({baseStyle:dbe,sizes:hbe,defaultProps:{size:"md"}}),Ks=DSe("badge",["bg","color","shadow"]),pbe={px:1,textTransform:"uppercase",fontSize:"xs",borderRadius:"sm",fontWeight:"bold",bg:Ks.bg.reference,color:Ks.color.reference,boxShadow:Ks.shadow.reference},mbe=n=>{const{colorScheme:e,theme:i}=n,o=g0(`${e}.500`,.6)(i);return{[Ks.bg.variable]:`colors.${e}.500`,[Ks.color.variable]:"colors.white",_dark:{[Ks.bg.variable]:o,[Ks.color.variable]:"colors.whiteAlpha.800"}}},gbe=n=>{const{colorScheme:e,theme:i}=n,o=g0(`${e}.200`,.16)(i);return{[Ks.bg.variable]:`colors.${e}.100`,[Ks.color.variable]:`colors.${e}.800`,_dark:{[Ks.bg.variable]:o,[Ks.color.variable]:`colors.${e}.200`}}},_be=n=>{const{colorScheme:e,theme:i}=n,o=g0(`${e}.200`,.8)(i);return{[Ks.color.variable]:`colors.${e}.500`,_dark:{[Ks.color.variable]:o},[Ks.shadow.variable]:`inset 0 0 0px 1px ${Ks.color.reference}`}},ybe={solid:mbe,subtle:gbe,outline:_be},oC={baseStyle:pbe,variants:ybe,defaultProps:{variant:"subtle",colorScheme:"gray"}},{defineMultiStyleConfig:Ebe,definePartsStyle:vbe}=Yi(GSe.keys),AM=Un("breadcrumb-link-decor"),Sbe={transitionProperty:"common",transitionDuration:"fast",transitionTimingFunction:"ease-out",outline:"none",color:"inherit",textDecoration:AM.reference,[AM.variable]:"none","&:not([aria-current=page])":{cursor:"pointer",_hover:{[AM.variable]:"underline"},_focusVisible:{boxShadow:"outline"}}},bbe=vbe({link:Sbe}),Tbe=Ebe({baseStyle:bbe}),wbe={lineHeight:"1.2",borderRadius:"md",fontWeight:"semibold",transitionProperty:"common",transitionDuration:"normal",_focusVisible:{boxShadow:"outline"},_disabled:{opacity:.4,cursor:"not-allowed",boxShadow:"none"},_hover:{_disabled:{bg:"initial"}}},ZZ=n=>{const{colorScheme:e,theme:i}=n;if(e==="gray")return{color:Mn("gray.800","whiteAlpha.900")(n),_hover:{bg:Mn("gray.100","whiteAlpha.200")(n)},_active:{bg:Mn("gray.200","whiteAlpha.300")(n)}};const o=g0(`${e}.200`,.12)(i),l=g0(`${e}.200`,.24)(i);return{color:Mn(`${e}.600`,`${e}.200`)(n),bg:"transparent",_hover:{bg:Mn(`${e}.50`,o)(n)},_active:{bg:Mn(`${e}.100`,l)(n)}}},Cbe=n=>{const{colorScheme:e}=n,i=Mn("gray.200","whiteAlpha.300")(n);return{border:"1px solid",borderColor:e==="gray"?i:"currentColor",".chakra-button__group[data-attached][data-orientation=horizontal] > &:not(:last-of-type)":{marginEnd:"-1px"},".chakra-button__group[data-attached][data-orientation=vertical] > &:not(:last-of-type)":{marginBottom:"-1px"},...Rc(ZZ,n)}},Rbe={yellow:{bg:"yellow.400",color:"black",hoverBg:"yellow.500",activeBg:"yellow.600"},cyan:{bg:"cyan.400",color:"black",hoverBg:"cyan.500",activeBg:"cyan.600"}},Ibe=n=>{const{colorScheme:e}=n;if(e==="gray"){const _=Mn("gray.100","whiteAlpha.200")(n);return{bg:_,color:Mn("gray.800","whiteAlpha.900")(n),_hover:{bg:Mn("gray.200","whiteAlpha.300")(n),_disabled:{bg:_}},_active:{bg:Mn("gray.300","whiteAlpha.400")(n)}}}const{bg:i=`${e}.500`,color:o="white",hoverBg:l=`${e}.600`,activeBg:d=`${e}.700`}=Rbe[e]??{},p=Mn(i,`${e}.200`)(n);return{bg:p,color:Mn(o,"gray.800")(n),_hover:{bg:Mn(l,`${e}.300`)(n),_disabled:{bg:p}},_active:{bg:Mn(d,`${e}.400`)(n)}}},Abe=n=>{const{colorScheme:e}=n;return{padding:0,height:"auto",lineHeight:"normal",verticalAlign:"baseline",color:Mn(`${e}.500`,`${e}.200`)(n),_hover:{textDecoration:"underline",_disabled:{textDecoration:"none"}},_active:{color:Mn(`${e}.700`,`${e}.500`)(n)}}},Pbe={bg:"none",color:"inherit",display:"inline",lineHeight:"inherit",m:"0",p:"0"},Obe={ghost:ZZ,outline:Cbe,solid:Ibe,link:Abe,unstyled:Pbe},kbe={lg:{h:"12",minW:"12",fontSize:"lg",px:"6"},md:{h:"10",minW:"10",fontSize:"md",px:"4"},sm:{h:"8",minW:"8",fontSize:"sm",px:"3"},xs:{h:"6",minW:"6",fontSize:"xs",px:"2"}},Nbe={baseStyle:wbe,variants:Obe,sizes:kbe,defaultProps:{variant:"solid",size:"md",colorScheme:"gray"}},{definePartsStyle:ky,defineMultiStyleConfig:Dbe}=Yi(d0e.keys),jk=Un("card-bg"),Lp=Un("card-padding"),eee=Un("card-shadow"),ek=Un("card-radius"),tee=Un("card-border-width","0"),nee=Un("card-border-color"),xbe=ky({container:{[jk.variable]:"colors.chakra-body-bg",backgroundColor:jk.reference,boxShadow:eee.reference,borderRadius:ek.reference,color:"chakra-body-text",borderWidth:tee.reference,borderColor:nee.reference},body:{padding:Lp.reference,flex:"1 1 0%"},header:{padding:Lp.reference},footer:{padding:Lp.reference}}),Lbe={sm:ky({container:{[ek.variable]:"radii.base",[Lp.variable]:"space.3"}}),md:ky({container:{[ek.variable]:"radii.md",[Lp.variable]:"space.5"}}),lg:ky({container:{[ek.variable]:"radii.xl",[Lp.variable]:"space.7"}})},Mbe={elevated:ky({container:{[eee.variable]:"shadows.base",_dark:{[jk.variable]:"colors.gray.700"}}}),outline:ky({container:{[tee.variable]:"1px",[nee.variable]:"colors.chakra-border-color"}}),filled:ky({container:{[jk.variable]:"colors.chakra-subtle-bg"}}),unstyled:{body:{[Lp.variable]:0},header:{[Lp.variable]:0},footer:{[Lp.variable]:0}}},Ube=Dbe({baseStyle:xbe,variants:Mbe,sizes:Lbe,defaultProps:{variant:"elevated",size:"md"}}),{definePartsStyle:tk,defineMultiStyleConfig:Vbe}=Yi(HSe.keys),aC=Un("checkbox-size"),Fbe=n=>{const{colorScheme:e}=n;return{w:aC.reference,h:aC.reference,transitionProperty:"box-shadow",transitionDuration:"normal",border:"2px solid",borderRadius:"sm",borderColor:"inherit",color:"white",_checked:{bg:Mn(`${e}.500`,`${e}.200`)(n),borderColor:Mn(`${e}.500`,`${e}.200`)(n),color:Mn("white","gray.900")(n),_hover:{bg:Mn(`${e}.600`,`${e}.300`)(n),borderColor:Mn(`${e}.600`,`${e}.300`)(n)},_disabled:{borderColor:Mn("gray.200","transparent")(n),bg:Mn("gray.200","whiteAlpha.300")(n),color:Mn("gray.500","whiteAlpha.500")(n)}},_indeterminate:{bg:Mn(`${e}.500`,`${e}.200`)(n),borderColor:Mn(`${e}.500`,`${e}.200`)(n),color:Mn("white","gray.900")(n)},_disabled:{bg:Mn("gray.100","whiteAlpha.100")(n),borderColor:Mn("gray.100","transparent")(n)},_focusVisible:{boxShadow:"outline"},_invalid:{borderColor:Mn("red.500","red.300")(n)}}},jbe={_disabled:{cursor:"not-allowed"}},Bbe={userSelect:"none",_disabled:{opacity:.4}},Wbe={transitionProperty:"transform",transitionDuration:"normal"},zbe=tk(n=>({icon:Wbe,container:jbe,control:Rc(Fbe,n),label:Bbe})),Gbe={sm:tk({control:{[aC.variable]:"sizes.3"},label:{fontSize:"sm"},icon:{fontSize:"3xs"}}),md:tk({control:{[aC.variable]:"sizes.4"},label:{fontSize:"md"},icon:{fontSize:"2xs"}}),lg:tk({control:{[aC.variable]:"sizes.5"},label:{fontSize:"lg"},icon:{fontSize:"2xs"}})},_g=Vbe({baseStyle:zbe,sizes:Gbe,defaultProps:{size:"md",colorScheme:"blue"}}),cC=Io("close-button-size"),Ew=Io("close-button-bg"),Hbe={w:[cC.reference],h:[cC.reference],borderRadius:"md",transitionProperty:"common",transitionDuration:"normal",_disabled:{opacity:.4,cursor:"not-allowed",boxShadow:"none"},_hover:{[Ew.variable]:"colors.blackAlpha.100",_dark:{[Ew.variable]:"colors.whiteAlpha.100"}},_active:{[Ew.variable]:"colors.blackAlpha.200",_dark:{[Ew.variable]:"colors.whiteAlpha.200"}},_focusVisible:{boxShadow:"outline"},bg:Ew.reference},$be={lg:{[cC.variable]:"sizes.10",fontSize:"md"},md:{[cC.variable]:"sizes.8",fontSize:"xs"},sm:{[cC.variable]:"sizes.6",fontSize:"2xs"}},Kbe={baseStyle:Hbe,sizes:$be,defaultProps:{size:"md"}},{variants:qbe,defaultProps:Ybe}=oC,Xbe={fontFamily:"mono",fontSize:"sm",px:"0.2em",borderRadius:"sm",bg:Ks.bg.reference,color:Ks.color.reference,boxShadow:Ks.shadow.reference},Jbe={baseStyle:Xbe,variants:qbe,defaultProps:Ybe},Qbe={w:"100%",mx:"auto",maxW:"prose",px:"4"},Zbe={baseStyle:Qbe},eTe={opacity:.6,borderColor:"inherit"},tTe={borderStyle:"solid"},nTe={borderStyle:"dashed"},rTe={solid:tTe,dashed:nTe},iTe={baseStyle:eTe,variants:rTe,defaultProps:{variant:"solid"}},{definePartsStyle:nV,defineMultiStyleConfig:sTe}=Yi($Se.keys),PM=Un("drawer-bg"),OM=Un("drawer-box-shadow");function CS(n){return nV(n==="full"?{dialog:{maxW:"100vw",h:"100vh"}}:{dialog:{maxW:n}})}const oTe={bg:"blackAlpha.600",zIndex:"modal"},aTe={display:"flex",zIndex:"modal",justifyContent:"center"},cTe=n=>{const{isFullHeight:e}=n;return{...e&&{height:"100vh"},zIndex:"modal",maxH:"100vh",color:"inherit",[PM.variable]:"colors.white",[OM.variable]:"shadows.lg",_dark:{[PM.variable]:"colors.gray.700",[OM.variable]:"shadows.dark-lg"},bg:PM.reference,boxShadow:OM.reference}},lTe={px:"6",py:"4",fontSize:"xl",fontWeight:"semibold"},uTe={position:"absolute",top:"2",insetEnd:"3"},dTe={px:"6",py:"2",flex:"1",overflow:"auto"},hTe={px:"6",py:"4"},fTe=nV(n=>({overlay:oTe,dialogContainer:aTe,dialog:Rc(cTe,n),header:lTe,closeButton:uTe,body:dTe,footer:hTe})),pTe={xs:CS("xs"),sm:CS("md"),md:CS("lg"),lg:CS("2xl"),xl:CS("4xl"),full:CS("full")},mTe=sTe({baseStyle:fTe,sizes:pTe,defaultProps:{size:"xs"}}),{definePartsStyle:gTe,defineMultiStyleConfig:_Te}=Yi(KSe.keys),yTe={borderRadius:"md",py:"1",transitionProperty:"common",transitionDuration:"normal"},ETe={borderRadius:"md",py:"1",transitionProperty:"common",transitionDuration:"normal",width:"full",_focusVisible:{boxShadow:"outline"},_placeholder:{opacity:.6}},vTe={borderRadius:"md",py:"1",transitionProperty:"common",transitionDuration:"normal",width:"full",_focusVisible:{boxShadow:"outline"},_placeholder:{opacity:.6}},STe=gTe({preview:yTe,input:ETe,textarea:vTe}),bTe=_Te({baseStyle:STe}),{definePartsStyle:TTe,defineMultiStyleConfig:wTe}=Yi(qSe.keys),r0=Un("form-control-color"),CTe={marginStart:"1",[r0.variable]:"colors.red.500",_dark:{[r0.variable]:"colors.red.300"},color:r0.reference},RTe={mt:"2",[r0.variable]:"colors.gray.600",_dark:{[r0.variable]:"colors.whiteAlpha.600"},color:r0.reference,lineHeight:"normal",fontSize:"sm"},ITe=TTe({container:{width:"100%",position:"relative"},requiredIndicator:CTe,helperText:RTe}),ATe=wTe({baseStyle:ITe}),{definePartsStyle:PTe,defineMultiStyleConfig:OTe}=Yi(YSe.keys),i0=Un("form-error-color"),kTe={[i0.variable]:"colors.red.500",_dark:{[i0.variable]:"colors.red.300"},color:i0.reference,mt:"2",fontSize:"sm",lineHeight:"normal"},NTe={marginEnd:"0.5em",[i0.variable]:"colors.red.500",_dark:{[i0.variable]:"colors.red.300"},color:i0.reference},DTe=PTe({text:kTe,icon:NTe}),xTe=OTe({baseStyle:DTe}),LTe={fontSize:"md",marginEnd:"3",mb:"2",fontWeight:"medium",transitionProperty:"common",transitionDuration:"normal",opacity:1,_disabled:{opacity:.4}},MTe={baseStyle:LTe},UTe={fontFamily:"heading",fontWeight:"bold"},VTe={"4xl":{fontSize:["6xl",null,"7xl"],lineHeight:1},"3xl":{fontSize:["5xl",null,"6xl"],lineHeight:1},"2xl":{fontSize:["4xl",null,"5xl"],lineHeight:[1.2,null,1]},xl:{fontSize:["3xl",null,"4xl"],lineHeight:[1.33,null,1.2]},lg:{fontSize:["2xl",null,"3xl"],lineHeight:[1.33,null,1.2]},md:{fontSize:"xl",lineHeight:1.2},sm:{fontSize:"md",lineHeight:1.2},xs:{fontSize:"sm",lineHeight:1.2}},FTe={baseStyle:UTe,sizes:VTe,defaultProps:{size:"xl"}},{definePartsStyle:Rp,defineMultiStyleConfig:jTe}=Yi(XSe.keys),FS=Un("input-height"),jS=Un("input-font-size"),BS=Un("input-padding"),WS=Un("input-border-radius"),BTe=Rp({addon:{height:FS.reference,fontSize:jS.reference,px:BS.reference,borderRadius:WS.reference},field:{width:"100%",height:FS.reference,fontSize:jS.reference,px:BS.reference,borderRadius:WS.reference,minWidth:0,outline:0,position:"relative",appearance:"none",transitionProperty:"common",transitionDuration:"normal",_disabled:{opacity:.4,cursor:"not-allowed"}}}),hg={lg:{[jS.variable]:"fontSizes.lg",[BS.variable]:"space.4",[WS.variable]:"radii.md",[FS.variable]:"sizes.12"},md:{[jS.variable]:"fontSizes.md",[BS.variable]:"space.4",[WS.variable]:"radii.md",[FS.variable]:"sizes.10"},sm:{[jS.variable]:"fontSizes.sm",[BS.variable]:"space.3",[WS.variable]:"radii.sm",[FS.variable]:"sizes.8"},xs:{[jS.variable]:"fontSizes.xs",[BS.variable]:"space.2",[WS.variable]:"radii.sm",[FS.variable]:"sizes.6"}},WTe={lg:Rp({field:hg.lg,group:hg.lg}),md:Rp({field:hg.md,group:hg.md}),sm:Rp({field:hg.sm,group:hg.sm}),xs:Rp({field:hg.xs,group:hg.xs})};function WF(n){const{focusBorderColor:e,errorBorderColor:i}=n;return{focusBorderColor:e||Mn("blue.500","blue.300")(n),errorBorderColor:i||Mn("red.500","red.300")(n)}}const zTe=Rp(n=>{const{theme:e}=n,{focusBorderColor:i,errorBorderColor:o}=WF(n);return{field:{border:"1px solid",borderColor:"inherit",bg:"inherit",_hover:{borderColor:Mn("gray.300","whiteAlpha.400")(n)},_readOnly:{boxShadow:"none !important",userSelect:"all"},_invalid:{borderColor:Cc(e,o),boxShadow:`0 0 0 1px ${Cc(e,o)}`},_focusVisible:{zIndex:1,borderColor:Cc(e,i),boxShadow:`0 0 0 1px ${Cc(e,i)}`}},addon:{border:"1px solid",borderColor:Mn("inherit","whiteAlpha.50")(n),bg:Mn("gray.100","whiteAlpha.300")(n)}}}),GTe=Rp(n=>{const{theme:e}=n,{focusBorderColor:i,errorBorderColor:o}=WF(n);return{field:{border:"2px solid",borderColor:"transparent",bg:Mn("gray.100","whiteAlpha.50")(n),_hover:{bg:Mn("gray.200","whiteAlpha.100")(n)},_readOnly:{boxShadow:"none !important",userSelect:"all"},_invalid:{borderColor:Cc(e,o)},_focusVisible:{bg:"transparent",borderColor:Cc(e,i)}},addon:{border:"2px solid",borderColor:"transparent",bg:Mn("gray.100","whiteAlpha.50")(n)}}}),HTe=Rp(n=>{const{theme:e}=n,{focusBorderColor:i,errorBorderColor:o}=WF(n);return{field:{borderBottom:"1px solid",borderColor:"inherit",borderRadius:"0",px:"0",bg:"transparent",_readOnly:{boxShadow:"none !important",userSelect:"all"},_invalid:{borderColor:Cc(e,o),boxShadow:`0px 1px 0px 0px ${Cc(e,o)}`},_focusVisible:{borderColor:Cc(e,i),boxShadow:`0px 1px 0px 0px ${Cc(e,i)}`}},addon:{borderBottom:"2px solid",borderColor:"inherit",borderRadius:"0",px:"0",bg:"transparent"}}}),$Te=Rp({field:{bg:"transparent",px:"0",height:"auto"},addon:{bg:"transparent",px:"0",height:"auto"}}),KTe={outline:zTe,filled:GTe,flushed:HTe,unstyled:$Te},si=jTe({baseStyle:BTe,sizes:WTe,variants:KTe,defaultProps:{size:"md",variant:"outline"}}),kM=Un("kbd-bg"),qTe={[kM.variable]:"colors.gray.100",_dark:{[kM.variable]:"colors.whiteAlpha.100"},bg:kM.reference,borderRadius:"md",borderWidth:"1px",borderBottomWidth:"3px",fontSize:"0.8em",fontWeight:"bold",lineHeight:"normal",px:"0.4em",whiteSpace:"nowrap"},YTe={baseStyle:qTe},XTe={transitionProperty:"common",transitionDuration:"fast",transitionTimingFunction:"ease-out",cursor:"pointer",textDecoration:"none",outline:"none",color:"inherit",_hover:{textDecoration:"underline"},_focusVisible:{boxShadow:"outline"}},JTe={baseStyle:XTe},{defineMultiStyleConfig:QTe,definePartsStyle:ZTe}=Yi(JSe.keys),ewe={marginEnd:"2",display:"inline",verticalAlign:"text-bottom"},twe=ZTe({icon:ewe}),nwe=QTe({baseStyle:twe}),{defineMultiStyleConfig:rwe,definePartsStyle:iwe}=Yi(QSe.keys),Bh=Un("menu-bg"),NM=Un("menu-shadow"),swe={[Bh.variable]:"#fff",[NM.variable]:"shadows.sm",_dark:{[Bh.variable]:"colors.gray.700",[NM.variable]:"shadows.dark-lg"},color:"inherit",minW:"3xs",py:"2",zIndex:"dropdown",borderRadius:"md",borderWidth:"1px",bg:Bh.reference,boxShadow:NM.reference},owe={py:"1.5",px:"3",transitionProperty:"background",transitionDuration:"ultra-fast",transitionTimingFunction:"ease-in",_focus:{[Bh.variable]:"colors.gray.100",_dark:{[Bh.variable]:"colors.whiteAlpha.100"}},_active:{[Bh.variable]:"colors.gray.200",_dark:{[Bh.variable]:"colors.whiteAlpha.200"}},_expanded:{[Bh.variable]:"colors.gray.100",_dark:{[Bh.variable]:"colors.whiteAlpha.100"}},_disabled:{opacity:.4,cursor:"not-allowed"},bg:Bh.reference},awe={mx:4,my:2,fontWeight:"semibold",fontSize:"sm"},cwe={display:"inline-flex",alignItems:"center",justifyContent:"center",flexShrink:0},lwe={opacity:.6},uwe={border:0,borderBottom:"1px solid",borderColor:"inherit",my:"2",opacity:.6},dwe={transitionProperty:"common",transitionDuration:"normal"},hwe=iwe({button:dwe,list:swe,item:owe,groupTitle:awe,icon:cwe,command:lwe,divider:uwe}),fwe=rwe({baseStyle:hwe}),{defineMultiStyleConfig:pwe,definePartsStyle:rV}=Yi(ZSe.keys),DM=Un("modal-bg"),xM=Un("modal-shadow"),mwe={bg:"blackAlpha.600",zIndex:"modal"},gwe=n=>{const{isCentered:e,scrollBehavior:i}=n;return{display:"flex",zIndex:"modal",justifyContent:"center",alignItems:e?"center":"flex-start",overflow:i==="inside"?"hidden":"auto",overscrollBehaviorY:"none"}},_we=n=>{const{isCentered:e,scrollBehavior:i}=n;return{borderRadius:"md",color:"inherit",my:e?"auto":"16",mx:e?"auto":void 0,zIndex:"modal",maxH:i==="inside"?"calc(100% - 7.5rem)":void 0,[DM.variable]:"colors.white",[xM.variable]:"shadows.lg",_dark:{[DM.variable]:"colors.gray.700",[xM.variable]:"shadows.dark-lg"},bg:DM.reference,boxShadow:xM.reference}},ywe={px:"6",py:"4",fontSize:"xl",fontWeight:"semibold"},Ewe={position:"absolute",top:"2",insetEnd:"3"},vwe=n=>{const{scrollBehavior:e}=n;return{px:"6",py:"2",flex:"1",overflow:e==="inside"?"auto":void 0}},Swe={px:"6",py:"4"},bwe=rV(n=>({overlay:mwe,dialogContainer:Rc(gwe,n),dialog:Rc(_we,n),header:ywe,closeButton:Ewe,body:Rc(vwe,n),footer:Swe}));function kd(n){return rV(n==="full"?{dialog:{maxW:"100vw",minH:"$100vh",my:"0",borderRadius:"0"}}:{dialog:{maxW:n}})}const Twe={xs:kd("xs"),sm:kd("sm"),md:kd("md"),lg:kd("lg"),xl:kd("xl"),"2xl":kd("2xl"),"3xl":kd("3xl"),"4xl":kd("4xl"),"5xl":kd("5xl"),"6xl":kd("6xl"),full:kd("full")},wwe=pwe({baseStyle:bwe,sizes:Twe,defaultProps:{size:"md"}}),ree={letterSpacings:{tighter:"-0.05em",tight:"-0.025em",normal:"0",wide:"0.025em",wider:"0.05em",widest:"0.1em"},lineHeights:{normal:"normal",none:1,shorter:1.25,short:1.375,base:1.5,tall:1.625,taller:"2",3:".75rem",4:"1rem",5:"1.25rem",6:"1.5rem",7:"1.75rem",8:"2rem",9:"2.25rem",10:"2.5rem"},fontWeights:{hairline:100,thin:200,light:300,normal:400,medium:500,semibold:600,bold:700,extrabold:800,black:900},fonts:{heading:'-apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"',body:'-apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"',mono:'SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace'},fontSizes:{"3xs":"0.45rem","2xs":"0.625rem",xs:"0.75rem",sm:"0.875rem",md:"1rem",lg:"1.125rem",xl:"1.25rem","2xl":"1.5rem","3xl":"1.875rem","4xl":"2.25rem","5xl":"3rem","6xl":"3.75rem","7xl":"4.5rem","8xl":"6rem","9xl":"8rem"}},{defineMultiStyleConfig:Cwe,definePartsStyle:iee}=Yi(e0e.keys),zF=Io("number-input-stepper-width"),see=Io("number-input-input-padding"),Rwe=wp(zF).add("0.5rem").toString(),LM=Io("number-input-bg"),MM=Io("number-input-color"),UM=Io("number-input-border-color"),Iwe={[zF.variable]:"sizes.6",[see.variable]:Rwe},Awe=n=>{var e;return((e=Rc(si.baseStyle,n))==null?void 0:e.field)??{}},Pwe={width:zF.reference},Owe={borderStart:"1px solid",borderStartColor:UM.reference,color:MM.reference,bg:LM.reference,[MM.variable]:"colors.chakra-body-text",[UM.variable]:"colors.chakra-border-color",_dark:{[MM.variable]:"colors.whiteAlpha.800",[UM.variable]:"colors.whiteAlpha.300"},_active:{[LM.variable]:"colors.gray.200",_dark:{[LM.variable]:"colors.whiteAlpha.300"}},_disabled:{opacity:.4,cursor:"not-allowed"}},kwe=iee(n=>({root:Iwe,field:Rc(Awe,n)??{},stepperGroup:Pwe,stepper:Owe}));function EO(n){var d,p;const e=(d=si.sizes)==null?void 0:d[n],i={lg:"md",md:"md",sm:"sm",xs:"sm"},o=((p=e.field)==null?void 0:p.fontSize)??"md",l=ree.fontSizes[o];return iee({field:{...e.field,paddingInlineEnd:see.reference,verticalAlign:"top"},stepper:{fontSize:wp(l).multiply(.75).toString(),_first:{borderTopEndRadius:i[n]},_last:{borderBottomEndRadius:i[n],mt:"-1px",borderTopWidth:1}}})}const Nwe={xs:EO("xs"),sm:EO("sm"),md:EO("md"),lg:EO("lg")},Dwe=Cwe({baseStyle:kwe,sizes:Nwe,variants:si.variants,defaultProps:si.defaultProps});var nZ;const xwe={...(nZ=si.baseStyle)==null?void 0:nZ.field,textAlign:"center"},Lwe={lg:{fontSize:"lg",w:12,h:12,borderRadius:"md"},md:{fontSize:"md",w:10,h:10,borderRadius:"md"},sm:{fontSize:"sm",w:8,h:8,borderRadius:"sm"},xs:{fontSize:"xs",w:6,h:6,borderRadius:"sm"}};var rZ;const Mwe={outline:n=>{var e,i;return((i=Rc((e=si.variants)==null?void 0:e.outline,n))==null?void 0:i.field)??{}},flushed:n=>{var e,i;return((i=Rc((e=si.variants)==null?void 0:e.flushed,n))==null?void 0:i.field)??{}},filled:n=>{var e,i;return((i=Rc((e=si.variants)==null?void 0:e.filled,n))==null?void 0:i.field)??{}},unstyled:((rZ=si.variants)==null?void 0:rZ.unstyled.field)??{}},Uwe={baseStyle:xwe,sizes:Lwe,variants:Mwe,defaultProps:si.defaultProps},{defineMultiStyleConfig:Vwe,definePartsStyle:Fwe}=Yi(t0e.keys),vO=Io("popper-bg"),jwe=Io("popper-arrow-bg"),aq=Io("popper-arrow-shadow-color"),Bwe={zIndex:"popover"},Wwe={[vO.variable]:"colors.white",bg:vO.reference,[jwe.variable]:vO.reference,[aq.variable]:"colors.gray.200",_dark:{[vO.variable]:"colors.gray.700",[aq.variable]:"colors.whiteAlpha.300"},width:"xs",border:"1px solid",borderColor:"inherit",borderRadius:"md",boxShadow:"sm",zIndex:"inherit",_focusVisible:{outline:0,boxShadow:"outline"}},zwe={px:3,py:2,borderBottomWidth:"1px"},Gwe={px:3,py:2},Hwe={px:3,py:2,borderTopWidth:"1px"},$we={position:"absolute",borderRadius:"md",top:1,insetEnd:2,padding:2},Kwe=Fwe({popper:Bwe,content:Wwe,header:zwe,body:Gwe,footer:Hwe,closeButton:$we}),qwe=Vwe({baseStyle:Kwe}),{defineMultiStyleConfig:Ywe,definePartsStyle:zw}=Yi(n0e.keys),Xwe=n=>{const{colorScheme:e,theme:i,isIndeterminate:o,hasStripe:l}=n,d=Mn(nq(),nq("1rem","rgba(0,0,0,0.1)"))(n),p=Mn(`${e}.500`,`${e}.200`)(n),_=`linear-gradient(
    to right,
    transparent 0%,
    ${Cc(i,p)} 50%,
    transparent 100%
  )`;return{...!o&&l&&d,...o?{bgImage:_}:{bgColor:p}}},Jwe={lineHeight:"1",fontSize:"0.25em",fontWeight:"bold",color:"white"},Qwe=n=>({bg:Mn("gray.100","whiteAlpha.300")(n)}),Zwe=n=>({transitionProperty:"common",transitionDuration:"slow",...Xwe(n)}),eCe=zw(n=>({label:Jwe,filledTrack:Zwe(n),track:Qwe(n)})),tCe={xs:zw({track:{h:"1"}}),sm:zw({track:{h:"2"}}),md:zw({track:{h:"3"}}),lg:zw({track:{h:"4"}})},nCe=Ywe({sizes:tCe,baseStyle:eCe,defaultProps:{size:"md",colorScheme:"blue"}}),{defineMultiStyleConfig:rCe,definePartsStyle:nk}=Yi(r0e.keys),iCe=n=>{var i;const e=(i=Rc(_g.baseStyle,n))==null?void 0:i.control;return{...e,borderRadius:"full",_checked:{...e==null?void 0:e._checked,_before:{content:'""',display:"inline-block",pos:"relative",w:"50%",h:"50%",borderRadius:"50%",bg:"currentColor"}}}},sCe=nk(n=>{var e,i;return{label:(e=_g.baseStyle)==null?void 0:e.call(_g,n).label,container:(i=_g.baseStyle)==null?void 0:i.call(_g,n).container,control:iCe(n)}}),oCe={md:nk({control:{w:"4",h:"4"},label:{fontSize:"md"}}),lg:nk({control:{w:"5",h:"5"},label:{fontSize:"lg"}}),sm:nk({control:{width:"3",height:"3"},label:{fontSize:"sm"}})},aCe=rCe({baseStyle:sCe,sizes:oCe,defaultProps:{size:"md",colorScheme:"blue"}}),{defineMultiStyleConfig:cCe,definePartsStyle:lCe}=Yi(i0e.keys),SO=Un("select-bg");var iZ;const uCe={...(iZ=si.baseStyle)==null?void 0:iZ.field,appearance:"none",paddingBottom:"1px",lineHeight:"normal",bg:SO.reference,[SO.variable]:"colors.white",_dark:{[SO.variable]:"colors.gray.700"},"> option, > optgroup":{bg:SO.reference}},dCe={width:"6",height:"100%",insetEnd:"2",position:"relative",color:"currentColor",fontSize:"xl",_disabled:{opacity:.5}},hCe=lCe({field:uCe,icon:dCe}),bO={paddingInlineEnd:"8"};var sZ,oZ,aZ,cZ,lZ,uZ,dZ,hZ;const fCe={lg:{...(sZ=si.sizes)==null?void 0:sZ.lg,field:{...(oZ=si.sizes)==null?void 0:oZ.lg.field,...bO}},md:{...(aZ=si.sizes)==null?void 0:aZ.md,field:{...(cZ=si.sizes)==null?void 0:cZ.md.field,...bO}},sm:{...(lZ=si.sizes)==null?void 0:lZ.sm,field:{...(uZ=si.sizes)==null?void 0:uZ.sm.field,...bO}},xs:{...(dZ=si.sizes)==null?void 0:dZ.xs,field:{...(hZ=si.sizes)==null?void 0:hZ.xs.field,...bO},icon:{insetEnd:"1"}}},pCe=cCe({baseStyle:hCe,sizes:fCe,variants:si.variants,defaultProps:si.defaultProps}),VM=Un("skeleton-start-color"),FM=Un("skeleton-end-color"),mCe={[VM.variable]:"colors.gray.100",[FM.variable]:"colors.gray.400",_dark:{[VM.variable]:"colors.gray.800",[FM.variable]:"colors.gray.600"},background:VM.reference,borderColor:FM.reference,opacity:.7,borderRadius:"sm"},gCe={baseStyle:mCe},jM=Un("skip-link-bg"),_Ce={borderRadius:"md",fontWeight:"semibold",_focusVisible:{boxShadow:"outline",padding:"4",position:"fixed",top:"6",insetStart:"6",[jM.variable]:"colors.white",_dark:{[jM.variable]:"colors.gray.700"},bg:jM.reference}},yCe={baseStyle:_Ce},{defineMultiStyleConfig:ECe,definePartsStyle:L1}=Yi(s0e.keys),Wy=Un("slider-thumb-size"),RC=Un("slider-track-size"),yg=Un("slider-bg"),vCe=n=>{const{orientation:e}=n;return{display:"inline-block",position:"relative",cursor:"pointer",_disabled:{opacity:.6,cursor:"default",pointerEvents:"none"},...jF({orientation:e,vertical:{h:"100%",px:Tp(Wy.reference).divide(2).toString()},horizontal:{w:"100%",py:Tp(Wy.reference).divide(2).toString()}})}},SCe=n=>({...jF({orientation:n.orientation,horizontal:{h:RC.reference},vertical:{w:RC.reference}}),overflow:"hidden",borderRadius:"sm",[yg.variable]:"colors.gray.200",_dark:{[yg.variable]:"colors.whiteAlpha.200"},_disabled:{[yg.variable]:"colors.gray.300",_dark:{[yg.variable]:"colors.whiteAlpha.300"}},bg:yg.reference}),bCe=n=>{const{orientation:e}=n;return{...jF({orientation:e,vertical:{left:"50%",transform:"translateX(-50%)",_active:{transform:"translateX(-50%) scale(1.15)"}},horizontal:{top:"50%",transform:"translateY(-50%)",_active:{transform:"translateY(-50%) scale(1.15)"}}}),w:Wy.reference,h:Wy.reference,display:"flex",alignItems:"center",justifyContent:"center",position:"absolute",outline:0,zIndex:1,borderRadius:"full",bg:"white",boxShadow:"base",border:"1px solid",borderColor:"transparent",transitionProperty:"transform",transitionDuration:"normal",_focusVisible:{boxShadow:"outline"},_disabled:{bg:"gray.300"}}},TCe=n=>{const{colorScheme:e}=n;return{width:"inherit",height:"inherit",[yg.variable]:`colors.${e}.500`,_dark:{[yg.variable]:`colors.${e}.200`},bg:yg.reference}},wCe=L1(n=>({container:vCe(n),track:SCe(n),thumb:bCe(n),filledTrack:TCe(n)})),CCe=L1({container:{[Wy.variable]:"sizes.4",[RC.variable]:"sizes.1"}}),RCe=L1({container:{[Wy.variable]:"sizes.3.5",[RC.variable]:"sizes.1"}}),ICe=L1({container:{[Wy.variable]:"sizes.2.5",[RC.variable]:"sizes.0.5"}}),ACe={lg:CCe,md:RCe,sm:ICe},PCe=ECe({baseStyle:wCe,sizes:ACe,defaultProps:{size:"md",colorScheme:"blue"}}),by=Io("spinner-size"),OCe={width:[by.reference],height:[by.reference]},kCe={xs:{[by.variable]:"sizes.3"},sm:{[by.variable]:"sizes.4"},md:{[by.variable]:"sizes.6"},lg:{[by.variable]:"sizes.8"},xl:{[by.variable]:"sizes.12"}},NCe={baseStyle:OCe,sizes:kCe,defaultProps:{size:"md"}},{defineMultiStyleConfig:DCe,definePartsStyle:oee}=Yi(o0e.keys),xCe={fontWeight:"medium"},LCe={opacity:.8,marginBottom:"2"},MCe={verticalAlign:"baseline",fontWeight:"semibold"},UCe={marginEnd:1,w:"3.5",h:"3.5",verticalAlign:"middle"},VCe=oee({container:{},label:xCe,helpText:LCe,number:MCe,icon:UCe}),FCe={md:oee({label:{fontSize:"sm"},helpText:{fontSize:"sm"},number:{fontSize:"2xl"}})},jCe=DCe({baseStyle:VCe,sizes:FCe,defaultProps:{size:"md"}}),{defineMultiStyleConfig:BCe,definePartsStyle:Gw}=Yi(["stepper","step","title","description","indicator","separator","icon","number"]),Cp=Un("stepper-indicator-size"),zS=Un("stepper-icon-size"),GS=Un("stepper-title-font-size"),Hw=Un("stepper-description-font-size"),vw=Un("stepper-accent-color"),WCe=Gw(({colorScheme:n})=>({stepper:{display:"flex",justifyContent:"space-between",gap:"4","&[data-orientation=vertical]":{flexDirection:"column",alignItems:"flex-start"},"&[data-orientation=horizontal]":{flexDirection:"row",alignItems:"center"},[vw.variable]:`colors.${n}.500`,_dark:{[vw.variable]:`colors.${n}.200`}},title:{fontSize:GS.reference,fontWeight:"medium"},description:{fontSize:Hw.reference,color:"chakra-subtle-text"},number:{fontSize:GS.reference},step:{flexShrink:0,position:"relative",display:"flex",gap:"2","&[data-orientation=horizontal]":{alignItems:"center"},flex:"1","&:last-of-type:not([data-stretch])":{flex:"initial"}},icon:{flexShrink:0,width:zS.reference,height:zS.reference},indicator:{flexShrink:0,borderRadius:"full",width:Cp.reference,height:Cp.reference,display:"flex",justifyContent:"center",alignItems:"center","&[data-status=active]":{borderWidth:"2px",borderColor:vw.reference},"&[data-status=complete]":{bg:vw.reference,color:"chakra-inverse-text"},"&[data-status=incomplete]":{borderWidth:"2px"}},separator:{bg:"chakra-border-color",flex:"1","&[data-status=complete]":{bg:vw.reference},"&[data-orientation=horizontal]":{width:"100%",height:"2px",marginStart:"2"},"&[data-orientation=vertical]":{width:"2px",position:"absolute",height:"100%",maxHeight:`calc(100% - ${Cp.reference} - 8px)`,top:`calc(${Cp.reference} + 4px)`,insetStart:`calc(${Cp.reference} / 2 - 1px)`}}})),zCe=BCe({baseStyle:WCe,sizes:{xs:Gw({stepper:{[Cp.variable]:"sizes.4",[zS.variable]:"sizes.3",[GS.variable]:"fontSizes.xs",[Hw.variable]:"fontSizes.xs"}}),sm:Gw({stepper:{[Cp.variable]:"sizes.6",[zS.variable]:"sizes.4",[GS.variable]:"fontSizes.sm",[Hw.variable]:"fontSizes.xs"}}),md:Gw({stepper:{[Cp.variable]:"sizes.8",[zS.variable]:"sizes.5",[GS.variable]:"fontSizes.md",[Hw.variable]:"fontSizes.sm"}}),lg:Gw({stepper:{[Cp.variable]:"sizes.10",[zS.variable]:"sizes.6",[GS.variable]:"fontSizes.lg",[Hw.variable]:"fontSizes.md"}})},defaultProps:{size:"md",colorScheme:"blue"}}),{defineMultiStyleConfig:GCe,definePartsStyle:rk}=Yi(a0e.keys),lC=Io("switch-track-width"),Ny=Io("switch-track-height"),BM=Io("switch-track-diff"),HCe=wp.subtract(lC,Ny),iV=Io("switch-thumb-x"),Sw=Io("switch-bg"),$Ce=n=>{const{colorScheme:e}=n;return{borderRadius:"full",p:"0.5",width:[lC.reference],height:[Ny.reference],transitionProperty:"common",transitionDuration:"fast",[Sw.variable]:"colors.gray.300",_dark:{[Sw.variable]:"colors.whiteAlpha.400"},_focusVisible:{boxShadow:"outline"},_disabled:{opacity:.4,cursor:"not-allowed"},_checked:{[Sw.variable]:`colors.${e}.500`,_dark:{[Sw.variable]:`colors.${e}.200`}},bg:Sw.reference}},KCe={bg:"white",transitionProperty:"transform",transitionDuration:"normal",borderRadius:"inherit",width:[Ny.reference],height:[Ny.reference],_checked:{transform:`translateX(${iV.reference})`}},qCe=rk(n=>({container:{[BM.variable]:HCe,[iV.variable]:BM.reference,_rtl:{[iV.variable]:wp(BM).negate().toString()}},track:$Ce(n),thumb:KCe})),YCe={sm:rk({container:{[lC.variable]:"1.375rem",[Ny.variable]:"sizes.3"}}),md:rk({container:{[lC.variable]:"1.875rem",[Ny.variable]:"sizes.4"}}),lg:rk({container:{[lC.variable]:"2.875rem",[Ny.variable]:"sizes.6"}})},XCe=GCe({baseStyle:qCe,sizes:YCe,defaultProps:{size:"md",colorScheme:"blue"}}),{defineMultiStyleConfig:JCe,definePartsStyle:s0}=Yi(c0e.keys),QCe=s0({table:{fontVariantNumeric:"lining-nums tabular-nums",borderCollapse:"collapse",width:"full"},th:{fontFamily:"heading",fontWeight:"bold",textTransform:"uppercase",letterSpacing:"wider",textAlign:"start"},td:{textAlign:"start"},caption:{mt:4,fontFamily:"heading",textAlign:"center",fontWeight:"medium"}}),Bk={"&[data-is-numeric=true]":{textAlign:"end"}},ZCe=s0(n=>{const{colorScheme:e}=n;return{th:{color:Mn("gray.600","gray.400")(n),borderBottom:"1px",borderColor:Mn(`${e}.100`,`${e}.700`)(n),...Bk},td:{borderBottom:"1px",borderColor:Mn(`${e}.100`,`${e}.700`)(n),...Bk},caption:{color:Mn("gray.600","gray.100")(n)},tfoot:{tr:{"&:last-of-type":{th:{borderBottomWidth:0}}}}}}),eRe=s0(n=>{const{colorScheme:e}=n;return{th:{color:Mn("gray.600","gray.400")(n),borderBottom:"1px",borderColor:Mn(`${e}.100`,`${e}.700`)(n),...Bk},td:{borderBottom:"1px",borderColor:Mn(`${e}.100`,`${e}.700`)(n),...Bk},caption:{color:Mn("gray.600","gray.100")(n)},tbody:{tr:{"&:nth-of-type(odd)":{"th, td":{borderBottomWidth:"1px",borderColor:Mn(`${e}.100`,`${e}.700`)(n)},td:{background:Mn(`${e}.100`,`${e}.700`)(n)}}}},tfoot:{tr:{"&:last-of-type":{th:{borderBottomWidth:0}}}}}}),tRe={simple:ZCe,striped:eRe,unstyled:{}},nRe={sm:s0({th:{px:"4",py:"1",lineHeight:"4",fontSize:"xs"},td:{px:"4",py:"2",fontSize:"sm",lineHeight:"4"},caption:{px:"4",py:"2",fontSize:"xs"}}),md:s0({th:{px:"6",py:"3",lineHeight:"4",fontSize:"xs"},td:{px:"6",py:"4",lineHeight:"5"},caption:{px:"6",py:"2",fontSize:"sm"}}),lg:s0({th:{px:"8",py:"4",lineHeight:"5",fontSize:"sm"},td:{px:"8",py:"5",lineHeight:"6"},caption:{px:"6",py:"2",fontSize:"md"}})},rRe=JCe({baseStyle:QCe,variants:tRe,sizes:nRe,defaultProps:{variant:"simple",size:"md",colorScheme:"gray"}}),cl=Un("tabs-color"),Ld=Un("tabs-bg"),TO=Un("tabs-border-color"),{defineMultiStyleConfig:iRe,definePartsStyle:tf}=Yi(l0e.keys),sRe=n=>{const{orientation:e}=n;return{display:e==="vertical"?"flex":"block"}},oRe=n=>{const{isFitted:e}=n;return{flex:e?1:void 0,transitionProperty:"common",transitionDuration:"normal",_focusVisible:{zIndex:1,boxShadow:"outline"},_disabled:{cursor:"not-allowed",opacity:.4}}},aRe=n=>{const{align:e="start",orientation:i}=n;return{justifyContent:{end:"flex-end",center:"center",start:"flex-start"}[e],flexDirection:i==="vertical"?"column":"row"}},cRe={p:4},lRe=tf(n=>({root:sRe(n),tab:oRe(n),tablist:aRe(n),tabpanel:cRe})),uRe={sm:tf({tab:{py:1,px:4,fontSize:"sm"}}),md:tf({tab:{fontSize:"md",py:2,px:4}}),lg:tf({tab:{fontSize:"lg",py:3,px:4}})},dRe=tf(n=>{const{colorScheme:e,orientation:i}=n,o=i==="vertical",l=o?"borderStart":"borderBottom",d=o?"marginStart":"marginBottom";return{tablist:{[l]:"2px solid",borderColor:"inherit"},tab:{[l]:"2px solid",borderColor:"transparent",[d]:"-2px",_selected:{[cl.variable]:`colors.${e}.600`,_dark:{[cl.variable]:`colors.${e}.300`},borderColor:"currentColor"},_active:{[Ld.variable]:"colors.gray.200",_dark:{[Ld.variable]:"colors.whiteAlpha.300"}},_disabled:{_active:{bg:"none"}},color:cl.reference,bg:Ld.reference}}}),hRe=tf(n=>{const{colorScheme:e}=n;return{tab:{borderTopRadius:"md",border:"1px solid",borderColor:"transparent",mb:"-1px",[TO.variable]:"transparent",_selected:{[cl.variable]:`colors.${e}.600`,[TO.variable]:"colors.white",_dark:{[cl.variable]:`colors.${e}.300`,[TO.variable]:"colors.gray.800"},borderColor:"inherit",borderBottomColor:TO.reference},color:cl.reference},tablist:{mb:"-1px",borderBottom:"1px solid",borderColor:"inherit"}}}),fRe=tf(n=>{const{colorScheme:e}=n;return{tab:{border:"1px solid",borderColor:"inherit",[Ld.variable]:"colors.gray.50",_dark:{[Ld.variable]:"colors.whiteAlpha.50"},mb:"-1px",_notLast:{marginEnd:"-1px"},_selected:{[Ld.variable]:"colors.white",[cl.variable]:`colors.${e}.600`,_dark:{[Ld.variable]:"colors.gray.800",[cl.variable]:`colors.${e}.300`},borderColor:"inherit",borderTopColor:"currentColor",borderBottomColor:"transparent"},color:cl.reference,bg:Ld.reference},tablist:{mb:"-1px",borderBottom:"1px solid",borderColor:"inherit"}}}),pRe=tf(n=>{const{colorScheme:e,theme:i}=n;return{tab:{borderRadius:"full",fontWeight:"semibold",color:"gray.600",_selected:{color:Cc(i,`${e}.700`),bg:Cc(i,`${e}.100`)}}}}),mRe=tf(n=>{const{colorScheme:e}=n;return{tab:{borderRadius:"full",fontWeight:"semibold",[cl.variable]:"colors.gray.600",_dark:{[cl.variable]:"inherit"},_selected:{[cl.variable]:"colors.white",[Ld.variable]:`colors.${e}.600`,_dark:{[cl.variable]:"colors.gray.800",[Ld.variable]:`colors.${e}.300`}},color:cl.reference,bg:Ld.reference}}}),gRe=tf({}),_Re={line:dRe,enclosed:hRe,"enclosed-colored":fRe,"soft-rounded":pRe,"solid-rounded":mRe,unstyled:gRe},yRe=iRe({baseStyle:lRe,sizes:uRe,variants:_Re,defaultProps:{size:"md",variant:"line",colorScheme:"blue"}}),{defineMultiStyleConfig:ERe,definePartsStyle:Dy}=Yi(u0e.keys),cq=Un("tag-bg"),lq=Un("tag-color"),WM=Un("tag-shadow"),ik=Un("tag-min-height"),sk=Un("tag-min-width"),ok=Un("tag-font-size"),ak=Un("tag-padding-inline"),vRe={fontWeight:"medium",lineHeight:1.2,outline:0,[lq.variable]:Ks.color.reference,[cq.variable]:Ks.bg.reference,[WM.variable]:Ks.shadow.reference,color:lq.reference,bg:cq.reference,boxShadow:WM.reference,borderRadius:"md",minH:ik.reference,minW:sk.reference,fontSize:ok.reference,px:ak.reference,_focusVisible:{[WM.variable]:"shadows.outline"}},SRe={lineHeight:1.2,overflow:"visible"},bRe={fontSize:"lg",w:"5",h:"5",transitionProperty:"common",transitionDuration:"normal",borderRadius:"full",marginStart:"1.5",marginEnd:"-1",opacity:.5,_disabled:{opacity:.4},_focusVisible:{boxShadow:"outline",bg:"rgba(0, 0, 0, 0.14)"},_hover:{opacity:.8},_active:{opacity:1}},TRe=Dy({container:vRe,label:SRe,closeButton:bRe}),wRe={sm:Dy({container:{[ik.variable]:"sizes.5",[sk.variable]:"sizes.5",[ok.variable]:"fontSizes.xs",[ak.variable]:"space.2"},closeButton:{marginEnd:"-2px",marginStart:"0.35rem"}}),md:Dy({container:{[ik.variable]:"sizes.6",[sk.variable]:"sizes.6",[ok.variable]:"fontSizes.sm",[ak.variable]:"space.2"}}),lg:Dy({container:{[ik.variable]:"sizes.8",[sk.variable]:"sizes.8",[ok.variable]:"fontSizes.md",[ak.variable]:"space.3"}})},CRe={subtle:Dy(n=>{var e;return{container:(e=oC.variants)==null?void 0:e.subtle(n)}}),solid:Dy(n=>{var e;return{container:(e=oC.variants)==null?void 0:e.solid(n)}}),outline:Dy(n=>{var e;return{container:(e=oC.variants)==null?void 0:e.outline(n)}})},RRe=ERe({variants:CRe,baseStyle:TRe,sizes:wRe,defaultProps:{size:"md",variant:"subtle",colorScheme:"gray"}});var fZ;const IRe={...(fZ=si.baseStyle)==null?void 0:fZ.field,paddingY:"2",minHeight:"20",lineHeight:"short",verticalAlign:"top"};var pZ;const ARe={outline:n=>{var e;return((e=si.variants)==null?void 0:e.outline(n).field)??{}},flushed:n=>{var e;return((e=si.variants)==null?void 0:e.flushed(n).field)??{}},filled:n=>{var e;return((e=si.variants)==null?void 0:e.filled(n).field)??{}},unstyled:((pZ=si.variants)==null?void 0:pZ.unstyled.field)??{}};var mZ,gZ,_Z,yZ;const PRe={xs:((mZ=si.sizes)==null?void 0:mZ.xs.field)??{},sm:((gZ=si.sizes)==null?void 0:gZ.sm.field)??{},md:((_Z=si.sizes)==null?void 0:_Z.md.field)??{},lg:((yZ=si.sizes)==null?void 0:yZ.lg.field)??{}},ORe={baseStyle:IRe,sizes:PRe,variants:ARe,defaultProps:{size:"md",variant:"outline"}},wO=Io("tooltip-bg"),zM=Io("tooltip-fg"),kRe=Io("popper-arrow-bg"),NRe={bg:wO.reference,color:zM.reference,[wO.variable]:"colors.gray.700",[zM.variable]:"colors.whiteAlpha.900",_dark:{[wO.variable]:"colors.gray.300",[zM.variable]:"colors.gray.900"},[kRe.variable]:wO.reference,px:"2",py:"0.5",borderRadius:"sm",fontWeight:"medium",fontSize:"sm",boxShadow:"md",maxW:"xs",zIndex:"tooltip"},DRe={baseStyle:NRe},xRe={Accordion:E0e,Alert:nbe,Avatar:fbe,Badge:oC,Breadcrumb:Tbe,Button:Nbe,Checkbox:_g,CloseButton:Kbe,Code:Jbe,Container:Zbe,Divider:iTe,Drawer:mTe,Editable:bTe,Form:ATe,FormError:xTe,FormLabel:MTe,Heading:FTe,Input:si,Kbd:YTe,Link:JTe,List:nwe,Menu:fwe,Modal:wwe,NumberInput:Dwe,PinInput:Uwe,Popover:qwe,Progress:nCe,Radio:aCe,Select:pCe,Skeleton:gCe,SkipLink:yCe,Slider:PCe,Spinner:NCe,Stat:jCe,Switch:XCe,Table:rRe,Tabs:yRe,Tag:RRe,Textarea:ORe,Tooltip:DRe,Card:Ube,Stepper:zCe},LRe={none:0,"1px":"1px solid","2px":"2px solid","4px":"4px solid","8px":"8px solid"},MRe={base:"0em",sm:"30em",md:"48em",lg:"62em",xl:"80em","2xl":"96em"},URe={transparent:"transparent",current:"currentColor",black:"#000000",white:"#FFFFFF",whiteAlpha:{50:"rgba(255, 255, 255, 0.04)",100:"rgba(255, 255, 255, 0.06)",200:"rgba(255, 255, 255, 0.08)",300:"rgba(255, 255, 255, 0.16)",400:"rgba(255, 255, 255, 0.24)",500:"rgba(255, 255, 255, 0.36)",600:"rgba(255, 255, 255, 0.48)",700:"rgba(255, 255, 255, 0.64)",800:"rgba(255, 255, 255, 0.80)",900:"rgba(255, 255, 255, 0.92)"},blackAlpha:{50:"rgba(0, 0, 0, 0.04)",100:"rgba(0, 0, 0, 0.06)",200:"rgba(0, 0, 0, 0.08)",300:"rgba(0, 0, 0, 0.16)",400:"rgba(0, 0, 0, 0.24)",500:"rgba(0, 0, 0, 0.36)",600:"rgba(0, 0, 0, 0.48)",700:"rgba(0, 0, 0, 0.64)",800:"rgba(0, 0, 0, 0.80)",900:"rgba(0, 0, 0, 0.92)"},gray:{50:"#F7FAFC",100:"#EDF2F7",200:"#E2E8F0",300:"#CBD5E0",400:"#A0AEC0",500:"#718096",600:"#4A5568",700:"#2D3748",800:"#1A202C",900:"#171923"},red:{50:"#FFF5F5",100:"#FED7D7",200:"#FEB2B2",300:"#FC8181",400:"#F56565",500:"#E53E3E",600:"#C53030",700:"#9B2C2C",800:"#822727",900:"#63171B"},orange:{50:"#FFFAF0",100:"#FEEBC8",200:"#FBD38D",300:"#F6AD55",400:"#ED8936",500:"#DD6B20",600:"#C05621",700:"#9C4221",800:"#7B341E",900:"#652B19"},yellow:{50:"#FFFFF0",100:"#FEFCBF",200:"#FAF089",300:"#F6E05E",400:"#ECC94B",500:"#D69E2E",600:"#B7791F",700:"#975A16",800:"#744210",900:"#5F370E"},green:{50:"#F0FFF4",100:"#C6F6D5",200:"#9AE6B4",300:"#68D391",400:"#48BB78",500:"#38A169",600:"#2F855A",700:"#276749",800:"#22543D",900:"#1C4532"},teal:{50:"#E6FFFA",100:"#B2F5EA",200:"#81E6D9",300:"#4FD1C5",400:"#38B2AC",500:"#319795",600:"#2C7A7B",700:"#285E61",800:"#234E52",900:"#1D4044"},blue:{50:"#ebf8ff",100:"#bee3f8",200:"#90cdf4",300:"#63b3ed",400:"#4299e1",500:"#3182ce",600:"#2b6cb0",700:"#2c5282",800:"#2a4365",900:"#1A365D"},cyan:{50:"#EDFDFD",100:"#C4F1F9",200:"#9DECF9",300:"#76E4F7",400:"#0BC5EA",500:"#00B5D8",600:"#00A3C4",700:"#0987A0",800:"#086F83",900:"#065666"},purple:{50:"#FAF5FF",100:"#E9D8FD",200:"#D6BCFA",300:"#B794F4",400:"#9F7AEA",500:"#805AD5",600:"#6B46C1",700:"#553C9A",800:"#44337A",900:"#322659"},pink:{50:"#FFF5F7",100:"#FED7E2",200:"#FBB6CE",300:"#F687B3",400:"#ED64A6",500:"#D53F8C",600:"#B83280",700:"#97266D",800:"#702459",900:"#521B41"}},VRe={none:"0",sm:"0.125rem",base:"0.25rem",md:"0.375rem",lg:"0.5rem",xl:"0.75rem","2xl":"1rem","3xl":"1.5rem",full:"9999px"},FRe={xs:"0 0 0 1px rgba(0, 0, 0, 0.05)",sm:"0 1px 2px 0 rgba(0, 0, 0, 0.05)",base:"0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06)",md:"0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)",lg:"0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05)",xl:"0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04)","2xl":"0 25px 50px -12px rgba(0, 0, 0, 0.25)",outline:"0 0 0 3px rgba(66, 153, 225, 0.6)",inner:"inset 0 2px 4px 0 rgba(0,0,0,0.06)",none:"none","dark-lg":"rgba(0, 0, 0, 0.1) 0px 0px 0px 1px, rgba(0, 0, 0, 0.2) 0px 5px 10px, rgba(0, 0, 0, 0.4) 0px 15px 40px"},jRe={common:"background-color, border-color, color, fill, stroke, opacity, box-shadow, transform",colors:"background-color, border-color, color, fill, stroke",dimensions:"width, height",position:"left, right, top, bottom",background:"background-color, background-image, background-position"},BRe={"ease-in":"cubic-bezier(0.4, 0, 1, 1)","ease-out":"cubic-bezier(0, 0, 0.2, 1)","ease-in-out":"cubic-bezier(0.4, 0, 0.2, 1)"},WRe={"ultra-fast":"50ms",faster:"100ms",fast:"150ms",normal:"200ms",slow:"300ms",slower:"400ms","ultra-slow":"500ms"},zRe={property:jRe,easing:BRe,duration:WRe},GRe={hide:-1,auto:"auto",base:0,docked:10,dropdown:1e3,sticky:1100,banner:1200,overlay:1300,modal:1400,popover:1500,skipLink:1600,toast:1700,tooltip:1800},HRe={none:0,sm:"4px",base:"8px",md:"12px",lg:"16px",xl:"24px","2xl":"40px","3xl":"64px"},$Re={breakpoints:MRe,zIndices:GRe,radii:VRe,blur:HRe,colors:URe,...ree,sizes:JZ,shadows:FRe,space:XZ,borders:LRe,transition:zRe},KRe={colors:{"chakra-body-text":{_light:"gray.800",_dark:"whiteAlpha.900"},"chakra-body-bg":{_light:"white",_dark:"gray.800"},"chakra-border-color":{_light:"gray.200",_dark:"whiteAlpha.300"},"chakra-inverse-text":{_light:"white",_dark:"gray.800"},"chakra-subtle-bg":{_light:"gray.100",_dark:"gray.700"},"chakra-subtle-text":{_light:"gray.600",_dark:"gray.400"},"chakra-placeholder-color":{_light:"gray.500",_dark:"whiteAlpha.400"}}},qRe={global:{body:{fontFamily:"body",color:"chakra-body-text",bg:"chakra-body-bg",transitionProperty:"background-color",transitionDuration:"normal",lineHeight:"base"},"*::placeholder":{color:"chakra-placeholder-color"},"*, *::before, &::after":{borderColor:"chakra-border-color"}}},YRe="ltr",XRe={useSystemColorMode:!1,initialColorMode:"light",cssVarPrefix:"chakra"},JRe={semanticTokens:KRe,direction:YRe,...$Re,components:xRe,styles:qRe,config:XRe};function QRe(n){if(n.sheet)return n.sheet;for(var e=0;e<document.styleSheets.length;e++)if(document.styleSheets[e].ownerNode===n)return document.styleSheets[e]}function ZRe(n){var e=document.createElement("style");return e.setAttribute("data-emotion",n.key),n.nonce!==void 0&&e.setAttribute("nonce",n.nonce),e.appendChild(document.createTextNode("")),e.setAttribute("data-s",""),e}var eIe=function(){function n(i){var o=this;this._insertTag=function(l){var d;o.tags.length===0?o.insertionPoint?d=o.insertionPoint.nextSibling:o.prepend?d=o.container.firstChild:d=o.before:d=o.tags[o.tags.length-1].nextSibling,o.container.insertBefore(l,d),o.tags.push(l)},this.isSpeedy=i.speedy===void 0?!0:i.speedy,this.tags=[],this.ctr=0,this.nonce=i.nonce,this.key=i.key,this.container=i.container,this.prepend=i.prepend,this.insertionPoint=i.insertionPoint,this.before=null}var e=n.prototype;return e.hydrate=function(o){o.forEach(this._insertTag)},e.insert=function(o){this.ctr%(this.isSpeedy?65e3:1)===0&&this._insertTag(ZRe(this));var l=this.tags[this.tags.length-1];if(this.isSpeedy){var d=QRe(l);try{d.insertRule(o,d.cssRules.length)}catch{}}else l.appendChild(document.createTextNode(o));this.ctr++},e.flush=function(){this.tags.forEach(function(o){var l;return(l=o.parentNode)==null?void 0:l.removeChild(o)}),this.tags=[],this.ctr=0},n}(),Ya="-ms-",Wk="-moz-",ri="-webkit-",aee="comm",GF="rule",HF="decl",tIe="@import",cee="@keyframes",nIe="@layer",rIe=Math.abs,M1=String.fromCharCode,iIe=Object.assign;function sIe(n,e){return Ta(n,0)^45?(((e<<2^Ta(n,0))<<2^Ta(n,1))<<2^Ta(n,2))<<2^Ta(n,3):0}function lee(n){return n.trim()}function oIe(n,e){return(n=e.exec(n))?n[0]:n}function ii(n,e,i){return n.replace(e,i)}function sV(n,e){return n.indexOf(e)}function Ta(n,e){return n.charCodeAt(e)|0}function IC(n,e,i){return n.slice(e,i)}function Gh(n){return n.length}function $F(n){return n.length}function CO(n,e){return e.push(n),n}function aIe(n,e){return n.map(e).join("")}var U1=1,y0=1,uee=0,pl=0,ro=0,z0="";function V1(n,e,i,o,l,d,p){return{value:n,root:e,parent:i,type:o,props:l,children:d,line:U1,column:y0,length:p,return:""}}function bw(n,e){return iIe(V1("",null,null,"",null,null,0),n,{length:-n.length},e)}function cIe(){return ro}function lIe(){return ro=pl>0?Ta(z0,--pl):0,y0--,ro===10&&(y0=1,U1--),ro}function zl(){return ro=pl<uee?Ta(z0,pl++):0,y0++,ro===10&&(y0=1,U1++),ro}function nf(){return Ta(z0,pl)}function ck(){return pl}function rR(n,e){return IC(z0,n,e)}function AC(n){switch(n){case 0:case 9:case 10:case 13:case 32:return 5;case 33:case 43:case 44:case 47:case 62:case 64:case 126:case 59:case 123:case 125:return 4;case 58:return 3;case 34:case 39:case 40:case 91:return 2;case 41:case 93:return 1}return 0}function dee(n){return U1=y0=1,uee=Gh(z0=n),pl=0,[]}function hee(n){return z0="",n}function lk(n){return lee(rR(pl-1,oV(n===91?n+2:n===40?n+1:n)))}function uIe(n){for(;(ro=nf())&&ro<33;)zl();return AC(n)>2||AC(ro)>3?"":" "}function dIe(n,e){for(;--e&&zl()&&!(ro<48||ro>102||ro>57&&ro<65||ro>70&&ro<97););return rR(n,ck()+(e<6&&nf()==32&&zl()==32))}function oV(n){for(;zl();)switch(ro){case n:return pl;case 34:case 39:n!==34&&n!==39&&oV(ro);break;case 40:n===41&&oV(n);break;case 92:zl();break}return pl}function hIe(n,e){for(;zl()&&n+ro!==57;)if(n+ro===84&&nf()===47)break;return"/*"+rR(e,pl-1)+"*"+M1(n===47?n:zl())}function fIe(n){for(;!AC(nf());)zl();return rR(n,pl)}function pIe(n){return hee(uk("",null,null,null,[""],n=dee(n),0,[0],n))}function uk(n,e,i,o,l,d,p,_,E){for(var b=0,C=0,I=p,O=0,L=0,U=0,B=1,W=1,J=1,$=0,ie="",ce=l,ne=d,de=o,Q=ie;W;)switch(U=$,$=zl()){case 40:if(U!=108&&Ta(Q,I-1)==58){sV(Q+=ii(lk($),"&","&\f"),"&\f")!=-1&&(J=-1);break}case 34:case 39:case 91:Q+=lk($);break;case 9:case 10:case 13:case 32:Q+=uIe(U);break;case 92:Q+=dIe(ck()-1,7);continue;case 47:switch(nf()){case 42:case 47:CO(mIe(hIe(zl(),ck()),e,i),E);break;default:Q+="/"}break;case 123*B:_[b++]=Gh(Q)*J;case 125*B:case 59:case 0:switch($){case 0:case 125:W=0;case 59+C:J==-1&&(Q=ii(Q,/\f/g,"")),L>0&&Gh(Q)-I&&CO(L>32?dq(Q+";",o,i,I-1):dq(ii(Q," ","")+";",o,i,I-2),E);break;case 59:Q+=";";default:if(CO(de=uq(Q,e,i,b,C,l,_,ie,ce=[],ne=[],I),d),$===123)if(C===0)uk(Q,e,de,de,ce,d,I,_,ne);else switch(O===99&&Ta(Q,3)===110?100:O){case 100:case 108:case 109:case 115:uk(n,de,de,o&&CO(uq(n,de,de,0,0,l,_,ie,l,ce=[],I),ne),l,ne,I,_,o?ce:ne);break;default:uk(Q,de,de,de,[""],ne,0,_,ne)}}b=C=L=0,B=J=1,ie=Q="",I=p;break;case 58:I=1+Gh(Q),L=U;default:if(B<1){if($==123)--B;else if($==125&&B++==0&&lIe()==125)continue}switch(Q+=M1($),$*B){case 38:J=C>0?1:(Q+="\f",-1);break;case 44:_[b++]=(Gh(Q)-1)*J,J=1;break;case 64:nf()===45&&(Q+=lk(zl())),O=nf(),C=I=Gh(ie=Q+=fIe(ck())),$++;break;case 45:U===45&&Gh(Q)==2&&(B=0)}}return d}function uq(n,e,i,o,l,d,p,_,E,b,C){for(var I=l-1,O=l===0?d:[""],L=$F(O),U=0,B=0,W=0;U<o;++U)for(var J=0,$=IC(n,I+1,I=rIe(B=p[U])),ie=n;J<L;++J)(ie=lee(B>0?O[J]+" "+$:ii($,/&\f/g,O[J])))&&(E[W++]=ie);return V1(n,e,i,l===0?GF:_,E,b,C)}function mIe(n,e,i){return V1(n,e,i,aee,M1(cIe()),IC(n,2,-2),0)}function dq(n,e,i,o){return V1(n,e,i,HF,IC(n,0,o),IC(n,o+1,-1),o)}function o0(n,e){for(var i="",o=$F(n),l=0;l<o;l++)i+=e(n[l],l,n,e)||"";return i}function gIe(n,e,i,o){switch(n.type){case nIe:if(n.children.length)break;case tIe:case HF:return n.return=n.return||n.value;case aee:return"";case cee:return n.return=n.value+"{"+o0(n.children,o)+"}";case GF:n.value=n.props.join(",")}return Gh(i=o0(n.children,o))?n.return=n.value+"{"+i+"}":""}function _Ie(n){var e=$F(n);return function(i,o,l,d){for(var p="",_=0;_<e;_++)p+=n[_](i,o,l,d)||"";return p}}function yIe(n){return function(e){e.root||(e=e.return)&&n(e)}}var hq=function(e){var i=new WeakMap;return function(o){if(i.has(o))return i.get(o);var l=e(o);return i.set(o,l),l}};function fee(n){var e=Object.create(null);return function(i){return e[i]===void 0&&(e[i]=n(i)),e[i]}}var EIe=function(e,i,o){for(var l=0,d=0;l=d,d=nf(),l===38&&d===12&&(i[o]=1),!AC(d);)zl();return rR(e,pl)},vIe=function(e,i){var o=-1,l=44;do switch(AC(l)){case 0:l===38&&nf()===12&&(i[o]=1),e[o]+=EIe(pl-1,i,o);break;case 2:e[o]+=lk(l);break;case 4:if(l===44){e[++o]=nf()===58?"&\f":"",i[o]=e[o].length;break}default:e[o]+=M1(l)}while(l=zl());return e},SIe=function(e,i){return hee(vIe(dee(e),i))},fq=new WeakMap,bIe=function(e){if(!(e.type!=="rule"||!e.parent||e.length<1)){for(var i=e.value,o=e.parent,l=e.column===o.column&&e.line===o.line;o.type!=="rule";)if(o=o.parent,!o)return;if(!(e.props.length===1&&i.charCodeAt(0)!==58&&!fq.get(o))&&!l){fq.set(e,!0);for(var d=[],p=SIe(i,d),_=o.props,E=0,b=0;E<p.length;E++)for(var C=0;C<_.length;C++,b++)e.props[b]=d[E]?p[E].replace(/&\f/g,_[C]):_[C]+" "+p[E]}}},TIe=function(e){if(e.type==="decl"){var i=e.value;i.charCodeAt(0)===108&&i.charCodeAt(2)===98&&(e.return="",e.value="")}};function pee(n,e){switch(sIe(n,e)){case 5103:return ri+"print-"+n+n;case 5737:case 4201:case 3177:case 3433:case 1641:case 4457:case 2921:case 5572:case 6356:case 5844:case 3191:case 6645:case 3005:case 6391:case 5879:case 5623:case 6135:case 4599:case 4855:case 4215:case 6389:case 5109:case 5365:case 5621:case 3829:return ri+n+n;case 5349:case 4246:case 4810:case 6968:case 2756:return ri+n+Wk+n+Ya+n+n;case 6828:case 4268:return ri+n+Ya+n+n;case 6165:return ri+n+Ya+"flex-"+n+n;case 5187:return ri+n+ii(n,/(\w+).+(:[^]+)/,ri+"box-$1$2"+Ya+"flex-$1$2")+n;case 5443:return ri+n+Ya+"flex-item-"+ii(n,/flex-|-self/,"")+n;case 4675:return ri+n+Ya+"flex-line-pack"+ii(n,/align-content|flex-|-self/,"")+n;case 5548:return ri+n+Ya+ii(n,"shrink","negative")+n;case 5292:return ri+n+Ya+ii(n,"basis","preferred-size")+n;case 6060:return ri+"box-"+ii(n,"-grow","")+ri+n+Ya+ii(n,"grow","positive")+n;case 4554:return ri+ii(n,/([^-])(transform)/g,"$1"+ri+"$2")+n;case 6187:return ii(ii(ii(n,/(zoom-|grab)/,ri+"$1"),/(image-set)/,ri+"$1"),n,"")+n;case 5495:case 3959:return ii(n,/(image-set\([^]*)/,ri+"$1$`$1");case 4968:return ii(ii(n,/(.+:)(flex-)?(.*)/,ri+"box-pack:$3"+Ya+"flex-pack:$3"),/s.+-b[^;]+/,"justify")+ri+n+n;case 4095:case 3583:case 4068:case 2532:return ii(n,/(.+)-inline(.+)/,ri+"$1$2")+n;case 8116:case 7059:case 5753:case 5535:case 5445:case 5701:case 4933:case 4677:case 5533:case 5789:case 5021:case 4765:if(Gh(n)-1-e>6)switch(Ta(n,e+1)){case 109:if(Ta(n,e+4)!==45)break;case 102:return ii(n,/(.+:)(.+)-([^]+)/,"$1"+ri+"$2-$3$1"+Wk+(Ta(n,e+3)==108?"$3":"$2-$3"))+n;case 115:return~sV(n,"stretch")?pee(ii(n,"stretch","fill-available"),e)+n:n}break;case 4949:if(Ta(n,e+1)!==115)break;case 6444:switch(Ta(n,Gh(n)-3-(~sV(n,"!important")&&10))){case 107:return ii(n,":",":"+ri)+n;case 101:return ii(n,/(.+:)([^;!]+)(;|!.+)?/,"$1"+ri+(Ta(n,14)===45?"inline-":"")+"box$3$1"+ri+"$2$3$1"+Ya+"$2box$3")+n}break;case 5936:switch(Ta(n,e+11)){case 114:return ri+n+Ya+ii(n,/[svh]\w+-[tblr]{2}/,"tb")+n;case 108:return ri+n+Ya+ii(n,/[svh]\w+-[tblr]{2}/,"tb-rl")+n;case 45:return ri+n+Ya+ii(n,/[svh]\w+-[tblr]{2}/,"lr")+n}return ri+n+Ya+n+n}return n}var wIe=function(e,i,o,l){if(e.length>-1&&!e.return)switch(e.type){case HF:e.return=pee(e.value,e.length);break;case cee:return o0([bw(e,{value:ii(e.value,"@","@"+ri)})],l);case GF:if(e.length)return aIe(e.props,function(d){switch(oIe(d,/(::plac\w+|:read-\w+)/)){case":read-only":case":read-write":return o0([bw(e,{props:[ii(d,/:(read-\w+)/,":"+Wk+"$1")]})],l);case"::placeholder":return o0([bw(e,{props:[ii(d,/:(plac\w+)/,":"+ri+"input-$1")]}),bw(e,{props:[ii(d,/:(plac\w+)/,":"+Wk+"$1")]}),bw(e,{props:[ii(d,/:(plac\w+)/,Ya+"input-$1")]})],l)}return""})}},CIe=[wIe],RIe=function(e){var i=e.key;if(i==="css"){var o=document.querySelectorAll("style[data-emotion]:not([data-s])");Array.prototype.forEach.call(o,function(B){var W=B.getAttribute("data-emotion");W.indexOf(" ")!==-1&&(document.head.appendChild(B),B.setAttribute("data-s",""))})}var l=e.stylisPlugins||CIe,d={},p,_=[];p=e.container||document.head,Array.prototype.forEach.call(document.querySelectorAll('style[data-emotion^="'+i+' "]'),function(B){for(var W=B.getAttribute("data-emotion").split(" "),J=1;J<W.length;J++)d[W[J]]=!0;_.push(B)});var E,b=[bIe,TIe];{var C,I=[gIe,yIe(function(B){C.insert(B)})],O=_Ie(b.concat(l,I)),L=function(W){return o0(pIe(W),O)};E=function(W,J,$,ie){C=$,L(W?W+"{"+J.styles+"}":J.styles),ie&&(U.inserted[J.name]=!0)}}var U={key:i,sheet:new eIe({key:i,container:p,nonce:e.nonce,speedy:e.speedy,prepend:e.prepend,insertionPoint:e.insertionPoint}),nonce:e.nonce,inserted:d,registered:{},insert:E};return U.sheet.hydrate(_),U};function zy(){return zy=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var o in i)({}).hasOwnProperty.call(i,o)&&(n[o]=i[o])}return n},zy.apply(null,arguments)}var GM={exports:{}},fi={};/** @license React v16.13.1
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var pq;function IIe(){if(pq)return fi;pq=1;var n=typeof Symbol=="function"&&Symbol.for,e=n?Symbol.for("react.element"):60103,i=n?Symbol.for("react.portal"):60106,o=n?Symbol.for("react.fragment"):60107,l=n?Symbol.for("react.strict_mode"):60108,d=n?Symbol.for("react.profiler"):60114,p=n?Symbol.for("react.provider"):60109,_=n?Symbol.for("react.context"):60110,E=n?Symbol.for("react.async_mode"):60111,b=n?Symbol.for("react.concurrent_mode"):60111,C=n?Symbol.for("react.forward_ref"):60112,I=n?Symbol.for("react.suspense"):60113,O=n?Symbol.for("react.suspense_list"):60120,L=n?Symbol.for("react.memo"):60115,U=n?Symbol.for("react.lazy"):60116,B=n?Symbol.for("react.block"):60121,W=n?Symbol.for("react.fundamental"):60117,J=n?Symbol.for("react.responder"):60118,$=n?Symbol.for("react.scope"):60119;function ie(ne){if(typeof ne=="object"&&ne!==null){var de=ne.$$typeof;switch(de){case e:switch(ne=ne.type,ne){case E:case b:case o:case d:case l:case I:return ne;default:switch(ne=ne&&ne.$$typeof,ne){case _:case C:case U:case L:case p:return ne;default:return de}}case i:return de}}}function ce(ne){return ie(ne)===b}return fi.AsyncMode=E,fi.ConcurrentMode=b,fi.ContextConsumer=_,fi.ContextProvider=p,fi.Element=e,fi.ForwardRef=C,fi.Fragment=o,fi.Lazy=U,fi.Memo=L,fi.Portal=i,fi.Profiler=d,fi.StrictMode=l,fi.Suspense=I,fi.isAsyncMode=function(ne){return ce(ne)||ie(ne)===E},fi.isConcurrentMode=ce,fi.isContextConsumer=function(ne){return ie(ne)===_},fi.isContextProvider=function(ne){return ie(ne)===p},fi.isElement=function(ne){return typeof ne=="object"&&ne!==null&&ne.$$typeof===e},fi.isForwardRef=function(ne){return ie(ne)===C},fi.isFragment=function(ne){return ie(ne)===o},fi.isLazy=function(ne){return ie(ne)===U},fi.isMemo=function(ne){return ie(ne)===L},fi.isPortal=function(ne){return ie(ne)===i},fi.isProfiler=function(ne){return ie(ne)===d},fi.isStrictMode=function(ne){return ie(ne)===l},fi.isSuspense=function(ne){return ie(ne)===I},fi.isValidElementType=function(ne){return typeof ne=="string"||typeof ne=="function"||ne===o||ne===b||ne===d||ne===l||ne===I||ne===O||typeof ne=="object"&&ne!==null&&(ne.$$typeof===U||ne.$$typeof===L||ne.$$typeof===p||ne.$$typeof===_||ne.$$typeof===C||ne.$$typeof===W||ne.$$typeof===J||ne.$$typeof===$||ne.$$typeof===B)},fi.typeOf=ie,fi}var mq;function AIe(){return mq||(mq=1,GM.exports=IIe()),GM.exports}var HM,gq;function PIe(){if(gq)return HM;gq=1;var n=AIe(),e={childContextTypes:!0,contextType:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromError:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},i={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},o={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},l={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},d={};d[n.ForwardRef]=o,d[n.Memo]=l;function p(U){return n.isMemo(U)?l:d[U.$$typeof]||e}var _=Object.defineProperty,E=Object.getOwnPropertyNames,b=Object.getOwnPropertySymbols,C=Object.getOwnPropertyDescriptor,I=Object.getPrototypeOf,O=Object.prototype;function L(U,B,W){if(typeof B!="string"){if(O){var J=I(B);J&&J!==O&&L(U,J,W)}var $=E(B);b&&($=$.concat(b(B)));for(var ie=p(U),ce=p(B),ne=0;ne<$.length;++ne){var de=$[ne];if(!i[de]&&!(W&&W[de])&&!(ce&&ce[de])&&!(ie&&ie[de])){var Q=C(B,de);try{_(U,de,Q)}catch{}}}}return U}return HM=L,HM}var OIe=PIe();const kIe=Bg(OIe);var NIe=!0;function mee(n,e,i){var o="";return i.split(" ").forEach(function(l){n[l]!==void 0?e.push(n[l]+";"):l&&(o+=l+" ")}),o}var KF=function(e,i,o){var l=e.key+"-"+i.name;(o===!1||NIe===!1)&&e.registered[l]===void 0&&(e.registered[l]=i.styles)},qF=function(e,i,o){KF(e,i,o);var l=e.key+"-"+i.name;if(e.inserted[i.name]===void 0){var d=i;do e.insert(i===d?"."+l:"",d,e.sheet,!0),d=d.next;while(d!==void 0)}};function DIe(n){for(var e=0,i,o=0,l=n.length;l>=4;++o,l-=4)i=n.charCodeAt(o)&255|(n.charCodeAt(++o)&255)<<8|(n.charCodeAt(++o)&255)<<16|(n.charCodeAt(++o)&255)<<24,i=(i&65535)*1540483477+((i>>>16)*59797<<16),i^=i>>>24,e=(i&65535)*1540483477+((i>>>16)*59797<<16)^(e&65535)*1540483477+((e>>>16)*59797<<16);switch(l){case 3:e^=(n.charCodeAt(o+2)&255)<<16;case 2:e^=(n.charCodeAt(o+1)&255)<<8;case 1:e^=n.charCodeAt(o)&255,e=(e&65535)*1540483477+((e>>>16)*59797<<16)}return e^=e>>>13,e=(e&65535)*1540483477+((e>>>16)*59797<<16),((e^e>>>15)>>>0).toString(36)}var xIe={animationIterationCount:1,aspectRatio:1,borderImageOutset:1,borderImageSlice:1,borderImageWidth:1,boxFlex:1,boxFlexGroup:1,boxOrdinalGroup:1,columnCount:1,columns:1,flex:1,flexGrow:1,flexPositive:1,flexShrink:1,flexNegative:1,flexOrder:1,gridRow:1,gridRowEnd:1,gridRowSpan:1,gridRowStart:1,gridColumn:1,gridColumnEnd:1,gridColumnSpan:1,gridColumnStart:1,msGridRow:1,msGridRowSpan:1,msGridColumn:1,msGridColumnSpan:1,fontWeight:1,lineHeight:1,opacity:1,order:1,orphans:1,scale:1,tabSize:1,widows:1,zIndex:1,zoom:1,WebkitLineClamp:1,fillOpacity:1,floodOpacity:1,stopOpacity:1,strokeDasharray:1,strokeDashoffset:1,strokeMiterlimit:1,strokeOpacity:1,strokeWidth:1},LIe=/[A-Z]|^ms/g,MIe=/_EMO_([^_]+?)_([^]*?)_EMO_/g,gee=function(e){return e.charCodeAt(1)===45},_q=function(e){return e!=null&&typeof e!="boolean"},$M=fee(function(n){return gee(n)?n:n.replace(LIe,"-$&").toLowerCase()}),yq=function(e,i){switch(e){case"animation":case"animationName":if(typeof i=="string")return i.replace(MIe,function(o,l,d){return Hh={name:l,styles:d,next:Hh},l})}return xIe[e]!==1&&!gee(e)&&typeof i=="number"&&i!==0?i+"px":i};function PC(n,e,i){if(i==null)return"";var o=i;if(o.__emotion_styles!==void 0)return o;switch(typeof i){case"boolean":return"";case"object":{var l=i;if(l.anim===1)return Hh={name:l.name,styles:l.styles,next:Hh},l.name;var d=i;if(d.styles!==void 0){var p=d.next;if(p!==void 0)for(;p!==void 0;)Hh={name:p.name,styles:p.styles,next:Hh},p=p.next;var _=d.styles+";";return _}return UIe(n,e,i)}case"function":{if(n!==void 0){var E=Hh,b=i(n);return Hh=E,PC(n,e,b)}break}}var C=i;if(e==null)return C;var I=e[C];return I!==void 0?I:C}function UIe(n,e,i){var o="";if(Array.isArray(i))for(var l=0;l<i.length;l++)o+=PC(n,e,i[l])+";";else for(var d in i){var p=i[d];if(typeof p!="object"){var _=p;e!=null&&e[_]!==void 0?o+=d+"{"+e[_]+"}":_q(_)&&(o+=$M(d)+":"+yq(d,_)+";")}else if(Array.isArray(p)&&typeof p[0]=="string"&&(e==null||e[p[0]]===void 0))for(var E=0;E<p.length;E++)_q(p[E])&&(o+=$M(d)+":"+yq(d,p[E])+";");else{var b=PC(n,e,p);switch(d){case"animation":case"animationName":{o+=$M(d)+":"+b+";";break}default:o+=d+"{"+b+"}"}}}return o}var Eq=/label:\s*([^\s;{]+)\s*(;|$)/g,Hh;function F1(n,e,i){if(n.length===1&&typeof n[0]=="object"&&n[0]!==null&&n[0].styles!==void 0)return n[0];var o=!0,l="";Hh=void 0;var d=n[0];if(d==null||d.raw===void 0)o=!1,l+=PC(i,e,d);else{var p=d;l+=p[0]}for(var _=1;_<n.length;_++)if(l+=PC(i,e,n[_]),o){var E=d;l+=E[_]}Eq.lastIndex=0;for(var b="",C;(C=Eq.exec(l))!==null;)b+="-"+C[1];var I=DIe(l)+b;return{name:I,styles:l,next:Hh}}var VIe=function(e){return e()},_ee=PK.useInsertionEffect?PK.useInsertionEffect:!1,yee=_ee||VIe,vq=_ee||N.useLayoutEffect,YF=N.createContext(typeof HTMLElement<"u"?RIe({key:"css"}):null);YF.Provider;var FIe=function(){return N.useContext(YF)},XF=function(e){return N.forwardRef(function(i,o){var l=N.useContext(YF);return e(i,l,o)})},E0=N.createContext({}),jIe=function(e,i){if(typeof i=="function"){var o=i(e);return o}return zy({},e,i)},BIe=hq(function(n){return hq(function(e){return jIe(n,e)})}),WIe=function(e){var i=N.useContext(E0);return e.theme!==i&&(i=BIe(i)(e.theme)),N.createElement(E0.Provider,{value:i},e.children)},JF={}.hasOwnProperty,aV="__EMOTION_TYPE_PLEASE_DO_NOT_USE__",zIe=function(e,i){var o={};for(var l in i)JF.call(i,l)&&(o[l]=i[l]);return o[aV]=e,o},GIe=function(e){var i=e.cache,o=e.serialized,l=e.isStringTag;return KF(i,o,l),yee(function(){return qF(i,o,l)}),null},HIe=XF(function(n,e,i){var o=n.css;typeof o=="string"&&e.registered[o]!==void 0&&(o=e.registered[o]);var l=n[aV],d=[o],p="";typeof n.className=="string"?p=mee(e.registered,d,n.className):n.className!=null&&(p=n.className+" ");var _=F1(d,void 0,N.useContext(E0));p+=e.key+"-"+_.name;var E={};for(var b in n)JF.call(n,b)&&b!=="css"&&b!==aV&&(E[b]=n[b]);return E.className=p,i&&(E.ref=i),N.createElement(N.Fragment,null,N.createElement(GIe,{cache:e,serialized:_,isStringTag:typeof l=="string"}),N.createElement(l,E))}),$Ie=HIe,Sq=function(e,i){var o=arguments;if(i==null||!JF.call(i,"css"))return N.createElement.apply(void 0,o);var l=o.length,d=new Array(l);d[0]=$Ie,d[1]=zIe(e,i);for(var p=2;p<l;p++)d[p]=o[p];return N.createElement.apply(null,d)};(function(n){var e;e||(e=n.JSX||(n.JSX={}))})(Sq||(Sq={}));var j1=XF(function(n,e){var i=n.styles,o=F1([i],void 0,N.useContext(E0)),l=N.useRef();return vq(function(){var d=e.key+"-global",p=new e.sheet.constructor({key:d,nonce:e.sheet.nonce,container:e.sheet.container,speedy:e.sheet.isSpeedy}),_=!1,E=document.querySelector('style[data-emotion="'+d+" "+o.name+'"]');return e.sheet.tags.length&&(p.before=e.sheet.tags[0]),E!==null&&(_=!0,E.setAttribute("data-emotion",d),p.hydrate([E])),l.current=[p,_],function(){p.flush()}},[e]),vq(function(){var d=l.current,p=d[0],_=d[1];if(_){d[1]=!1;return}if(o.next!==void 0&&qF(e,o.next,!0),p.tags.length){var E=p.tags[p.tags.length-1].nextElementSibling;p.before=E,p.flush()}e.insert("",o,p,!1)},[e,o.name]),null});function KIe(){for(var n=arguments.length,e=new Array(n),i=0;i<n;i++)e[i]=arguments[i];return F1(e)}function iR(){var n=KIe.apply(void 0,arguments),e="animation-"+n.name;return{name:e,styles:"@keyframes "+e+"{"+n.styles+"}",anim:1,toString:function(){return"_EMO_"+this.name+"_"+this.styles+"_EMO_"}}}const QF=N.createContext({});QF.displayName="ColorModeContext";function B1(){const n=N.useContext(QF);if(n===void 0)throw new Error("useColorMode must be used within a ColorModeProvider");return n}function qIe(n,e){const{colorMode:i}=B1();return i==="dark"?e:n}const RO={light:"chakra-ui-light",dark:"chakra-ui-dark"};function YIe(n={}){const{preventTransition:e=!0,nonce:i}=n,o={setDataset:l=>{const d=e?o.preventTransition():void 0;document.documentElement.dataset.theme=l,document.documentElement.style.colorScheme=l,d==null||d()},setClassName(l){document.body.classList.add(l?RO.dark:RO.light),document.body.classList.remove(l?RO.light:RO.dark)},query(){return window.matchMedia("(prefers-color-scheme: dark)")},getSystemTheme(l){return o.query().matches??l==="dark"?"dark":"light"},addListener(l){const d=o.query(),p=_=>{l(_.matches?"dark":"light")};return typeof d.addListener=="function"?d.addListener(p):d.addEventListener("change",p),()=>{typeof d.removeListener=="function"?d.removeListener(p):d.removeEventListener("change",p)}},preventTransition(){const l=document.createElement("style");return l.appendChild(document.createTextNode("*{-webkit-transition:none!important;-moz-transition:none!important;-o-transition:none!important;-ms-transition:none!important;transition:none!important}")),i!==void 0&&(l.nonce=i),document.head.appendChild(l),()=>{window.getComputedStyle(document.body),requestAnimationFrame(()=>{requestAnimationFrame(()=>{document.head.removeChild(l)})})}}};return o}const XIe="chakra-ui-color-mode";function JIe(n){return{ssr:!1,type:"localStorage",get(e){if(!(globalThis!=null&&globalThis.document))return e;let i;try{i=localStorage.getItem(n)||e}catch{}return i||e},set(e){try{localStorage.setItem(n,e)}catch{}}}}const QIe=JIe(XIe),bq=()=>{},ZIe=pEe()?N.useLayoutEffect:N.useEffect;function Tq(n,e){return n.type==="cookie"&&n.ssr?n.get(e):e}const Eee=function(e){const{value:i,children:o,options:{useSystemColorMode:l,initialColorMode:d,disableTransitionOnChange:p}={},colorModeManager:_=QIe}=e,E=FIe(),b=d==="dark"?"dark":"light",[C,I]=N.useState(()=>Tq(_,b)),[O,L]=N.useState(()=>Tq(_)),{getSystemTheme:U,setClassName:B,setDataset:W,addListener:J}=N.useMemo(()=>YIe({preventTransition:p,nonce:E==null?void 0:E.nonce}),[p,E==null?void 0:E.nonce]),$=d==="system"&&!C?O:C,ie=N.useCallback(de=>{const Q=de==="system"?U():de;I(Q),B(Q==="dark"),W(Q),_.set(Q)},[_,U,B,W]);ZIe(()=>{d==="system"&&L(U())},[]),N.useEffect(()=>{const de=_.get();if(de){ie(de);return}if(d==="system"){ie("system");return}ie(b)},[_,b,d,ie]);const ce=N.useCallback(()=>{ie($==="dark"?"light":"dark")},[$,ie]);N.useEffect(()=>{if(l)return J(ie)},[l,J,ie]);const ne=N.useMemo(()=>({colorMode:i??$,toggleColorMode:i?bq:ce,setColorMode:i?bq:ie,forced:i!==void 0}),[$,ce,ie,i]);return w.jsx(QF.Provider,{value:ne,children:o})};Eee.displayName="ColorModeProvider";const vee=String.raw,See=vee`
  :root,
  :host {
    --chakra-vh: 100vh;
  }

  @supports (height: -webkit-fill-available) {
    :root,
    :host {
      --chakra-vh: -webkit-fill-available;
    }
  }

  @supports (height: -moz-fill-available) {
    :root,
    :host {
      --chakra-vh: -moz-fill-available;
    }
  }

  @supports (height: 100dvh) {
    :root,
    :host {
      --chakra-vh: 100dvh;
    }
  }
`,eAe=()=>w.jsx(j1,{styles:See}),tAe=({scope:n=""})=>w.jsx(j1,{styles:vee`
      html {
        line-height: 1.5;
        -webkit-text-size-adjust: 100%;
        font-family: system-ui, sans-serif;
        -webkit-font-smoothing: antialiased;
        text-rendering: optimizeLegibility;
        -moz-osx-font-smoothing: grayscale;
        touch-action: manipulation;
      }

      body {
        position: relative;
        min-height: 100%;
        margin: 0;
        font-feature-settings: "kern";
      }

      ${n} :where(*, *::before, *::after) {
        border-width: 0;
        border-style: solid;
        box-sizing: border-box;
        word-wrap: break-word;
      }

      main {
        display: block;
      }

      ${n} hr {
        border-top-width: 1px;
        box-sizing: content-box;
        height: 0;
        overflow: visible;
      }

      ${n} :where(pre, code, kbd,samp) {
        font-family: SFMono-Regular, Menlo, Monaco, Consolas, monospace;
        font-size: 1em;
      }

      ${n} a {
        background-color: transparent;
        color: inherit;
        text-decoration: inherit;
      }

      ${n} abbr[title] {
        border-bottom: none;
        text-decoration: underline;
        -webkit-text-decoration: underline dotted;
        text-decoration: underline dotted;
      }

      ${n} :where(b, strong) {
        font-weight: bold;
      }

      ${n} small {
        font-size: 80%;
      }

      ${n} :where(sub,sup) {
        font-size: 75%;
        line-height: 0;
        position: relative;
        vertical-align: baseline;
      }

      ${n} sub {
        bottom: -0.25em;
      }

      ${n} sup {
        top: -0.5em;
      }

      ${n} img {
        border-style: none;
      }

      ${n} :where(button, input, optgroup, select, textarea) {
        font-family: inherit;
        font-size: 100%;
        line-height: 1.15;
        margin: 0;
      }

      ${n} :where(button, input) {
        overflow: visible;
      }

      ${n} :where(button, select) {
        text-transform: none;
      }

      ${n} :where(
          button::-moz-focus-inner,
          [type="button"]::-moz-focus-inner,
          [type="reset"]::-moz-focus-inner,
          [type="submit"]::-moz-focus-inner
        ) {
        border-style: none;
        padding: 0;
      }

      ${n} fieldset {
        padding: 0.35em 0.75em 0.625em;
      }

      ${n} legend {
        box-sizing: border-box;
        color: inherit;
        display: table;
        max-width: 100%;
        padding: 0;
        white-space: normal;
      }

      ${n} progress {
        vertical-align: baseline;
      }

      ${n} textarea {
        overflow: auto;
      }

      ${n} :where([type="checkbox"], [type="radio"]) {
        box-sizing: border-box;
        padding: 0;
      }

      ${n} input[type="number"]::-webkit-inner-spin-button,
      ${n} input[type="number"]::-webkit-outer-spin-button {
        -webkit-appearance: none !important;
      }

      ${n} input[type="number"] {
        -moz-appearance: textfield;
      }

      ${n} input[type="search"] {
        -webkit-appearance: textfield;
        outline-offset: -2px;
      }

      ${n} input[type="search"]::-webkit-search-decoration {
        -webkit-appearance: none !important;
      }

      ${n} ::-webkit-file-upload-button {
        -webkit-appearance: button;
        font: inherit;
      }

      ${n} details {
        display: block;
      }

      ${n} summary {
        display: list-item;
      }

      template {
        display: none;
      }

      [hidden] {
        display: none !important;
      }

      ${n} :where(
          blockquote,
          dl,
          dd,
          h1,
          h2,
          h3,
          h4,
          h5,
          h6,
          hr,
          figure,
          p,
          pre
        ) {
        margin: 0;
      }

      ${n} button {
        background: transparent;
        padding: 0;
      }

      ${n} fieldset {
        margin: 0;
        padding: 0;
      }

      ${n} :where(ol, ul) {
        margin: 0;
        padding: 0;
      }

      ${n} textarea {
        resize: vertical;
      }

      ${n} :where(button, [role="button"]) {
        cursor: pointer;
      }

      ${n} button::-moz-focus-inner {
        border: 0 !important;
      }

      ${n} table {
        border-collapse: collapse;
      }

      ${n} :where(h1, h2, h3, h4, h5, h6) {
        font-size: inherit;
        font-weight: inherit;
      }

      ${n} :where(button, input, optgroup, select, textarea) {
        padding: 0;
        line-height: inherit;
        color: inherit;
      }

      ${n} :where(img, svg, video, canvas, audio, iframe, embed, object) {
        display: block;
      }

      ${n} :where(img, video) {
        max-width: 100%;
        height: auto;
      }

      [data-js-focus-visible]
        :focus:not([data-focus-visible-added]):not(
          [data-focus-visible-disabled]
        ) {
        outline: none;
        box-shadow: none;
      }

      ${n} select::-ms-expand {
        display: none;
      }

      ${See}
    `});function nAe(n){const{cssVarsRoot:e,theme:i,children:o}=n,l=N.useMemo(()=>jSe(i),[i]);return w.jsxs(WIe,{theme:l,children:[w.jsx(rAe,{root:e}),o]})}function rAe({root:n=":host, :root"}){const e=[n,"[data-theme]"].join(",");return w.jsx(j1,{styles:i=>({[e]:i.__cssVars})})}xi({name:"StylesContext",errorMessage:"useStyles: `styles` is undefined. Seems you forgot to wrap the components in `<StylesProvider />` "});function iAe(){const{colorMode:n}=B1();return w.jsx(j1,{styles:e=>{const i=AZ(e,"styles.global"),o=ul(i,{theme:e,colorMode:n});return o?$Z(o)(e):void 0}})}const[sAe,oAe]=xi({strict:!1,name:"PortalManagerContext"});function ZF(n){const{children:e,zIndex:i}=n;return w.jsx(sAe,{value:{zIndex:i},children:e})}ZF.displayName="PortalManager";const ej=N.createContext({getDocument(){return document},getWindow(){return window}});ej.displayName="EnvironmentContext";function aAe({defer:n}={}){const[,e]=N.useReducer(i=>i+1,0);return ef(()=>{n&&e()},[n]),N.useContext(ej)}function bee(n){const{children:e,environment:i,disabled:o}=n,l=N.useRef(null),d=N.useMemo(()=>i||{getDocument:()=>{var _;return((_=l.current)==null?void 0:_.ownerDocument)??document},getWindow:()=>{var _;return((_=l.current)==null?void 0:_.ownerDocument.defaultView)??window}},[i]),p=!o||!i;return w.jsxs(ej.Provider,{value:d,children:[e,p&&w.jsx("span",{id:"__chakra_env",hidden:!0,ref:l})]})}bee.displayName="EnvironmentProvider";const cAe=n=>{const{children:e,colorModeManager:i,portalZIndex:o,resetScope:l,resetCSS:d=!0,theme:p={},environment:_,cssVarsRoot:E,disableEnvironment:b,disableGlobalStyle:C}=n,I=w.jsx(bee,{environment:_,disabled:b,children:e});return w.jsx(nAe,{theme:p,cssVarsRoot:E,children:w.jsxs(Eee,{colorModeManager:i,options:p.config,children:[d?w.jsx(tAe,{scope:l}):w.jsx(eAe,{}),!C&&w.jsx(iAe,{}),o?w.jsx(ZF,{zIndex:o,children:I}):I]})})},tj=N.createContext({});function nj(n){const e=N.useRef(null);return e.current===null&&(e.current=n()),e.current}const sR=N.createContext(null),rj=N.createContext({transformPagePoint:n=>n,isStatic:!1,reducedMotion:"never"});class lAe extends N.Component{getSnapshotBeforeUpdate(e){const i=this.props.childRef.current;if(i&&e.isPresent&&!this.props.isPresent){const o=this.props.sizeRef.current;o.height=i.offsetHeight||0,o.width=i.offsetWidth||0,o.top=i.offsetTop,o.left=i.offsetLeft}return null}componentDidUpdate(){}render(){return this.props.children}}function uAe({children:n,isPresent:e}){const i=N.useId(),o=N.useRef(null),l=N.useRef({width:0,height:0,top:0,left:0}),{nonce:d}=N.useContext(rj);return N.useInsertionEffect(()=>{const{width:p,height:_,top:E,left:b}=l.current;if(e||!o.current||!p||!_)return;o.current.dataset.motionPopId=i;const C=document.createElement("style");return d&&(C.nonce=d),document.head.appendChild(C),C.sheet&&C.sheet.insertRule(`
          [data-motion-pop-id="${i}"] {
            position: absolute !important;
            width: ${p}px !important;
            height: ${_}px !important;
            top: ${E}px !important;
            left: ${b}px !important;
          }
        `),()=>{document.head.removeChild(C)}},[e]),w.jsx(lAe,{isPresent:e,childRef:o,sizeRef:l,children:N.cloneElement(n,{ref:o})})}const dAe=({children:n,initial:e,isPresent:i,onExitComplete:o,custom:l,presenceAffectsLayout:d,mode:p})=>{const _=nj(hAe),E=N.useId(),b=N.useCallback(I=>{_.set(I,!0);for(const O of _.values())if(!O)return;o&&o()},[_,o]),C=N.useMemo(()=>({id:E,initial:e,isPresent:i,custom:l,onExitComplete:b,register:I=>(_.set(I,!1),()=>_.delete(I))}),d?[Math.random(),b]:[i,b]);return N.useMemo(()=>{_.forEach((I,O)=>_.set(O,!1))},[i]),N.useEffect(()=>{!i&&!_.size&&o&&o()},[i]),p==="popLayout"&&(n=w.jsx(uAe,{isPresent:i,children:n})),w.jsx(sR.Provider,{value:C,children:n})};function hAe(){return new Map}function ij(n=!0){const e=N.useContext(sR);if(e===null)return[!0,null];const{isPresent:i,onExitComplete:o,register:l}=e,d=N.useId();N.useEffect(()=>{n&&l(d)},[n]);const p=N.useCallback(()=>n&&o&&o(d),[d,o,n]);return!i&&o?[!1,p]:[!0]}function fAe(){return pAe(N.useContext(sR))}function pAe(n){return n===null?!0:n.isPresent}const IO=n=>n.key||"";function wq(n){const e=[];return N.Children.forEach(n,i=>{N.isValidElement(i)&&e.push(i)}),e}const sj=typeof window<"u",Tee=sj?N.useLayoutEffect:N.useEffect,G0=({children:n,custom:e,initial:i=!0,onExitComplete:o,presenceAffectsLayout:l=!0,mode:d="sync",propagate:p=!1})=>{const[_,E]=ij(p),b=N.useMemo(()=>wq(n),[n]),C=p&&!_?[]:b.map(IO),I=N.useRef(!0),O=N.useRef(b),L=nj(()=>new Map),[U,B]=N.useState(b),[W,J]=N.useState(b);Tee(()=>{I.current=!1,O.current=b;for(let ce=0;ce<W.length;ce++){const ne=IO(W[ce]);C.includes(ne)?L.delete(ne):L.get(ne)!==!0&&L.set(ne,!1)}},[W,C.length,C.join("-")]);const $=[];if(b!==U){let ce=[...b];for(let ne=0;ne<W.length;ne++){const de=W[ne],Q=IO(de);C.includes(Q)||(ce.splice(ne,0,de),$.push(de))}d==="wait"&&$.length&&(ce=$),J(wq(ce)),B(b);return}const{forceRender:ie}=N.useContext(tj);return w.jsx(w.Fragment,{children:W.map(ce=>{const ne=IO(ce),de=p&&!_?!1:b===W||C.includes(ne),Q=()=>{if(L.has(ne))L.set(ne,!0);else return;let Z=!0;L.forEach(X=>{X||(Z=!1)}),Z&&(ie==null||ie(),J(O.current),p&&(E==null||E()),o&&o())};return w.jsx(dAe,{isPresent:de,initial:!I.current||i?void 0:!1,custom:de?void 0:e,presenceAffectsLayout:l,mode:d,onExitComplete:de?void 0:Q,children:ce},ne)})})},Gl=n=>n;let wee=Gl;function oj(n){let e;return()=>(e===void 0&&(e=n()),e)}const v0=(n,e,i)=>{const o=e-n;return o===0?1:(i-n)/o},Mp=n=>n*1e3,Up=n=>n/1e3,mAe={useManualTiming:!1};function gAe(n){let e=new Set,i=new Set,o=!1,l=!1;const d=new WeakSet;let p={delta:0,timestamp:0,isProcessing:!1};function _(b){d.has(b)&&(E.schedule(b),n()),b(p)}const E={schedule:(b,C=!1,I=!1)=>{const L=I&&o?e:i;return C&&d.add(b),L.has(b)||L.add(b),b},cancel:b=>{i.delete(b),d.delete(b)},process:b=>{if(p=b,o){l=!0;return}o=!0,[e,i]=[i,e],e.forEach(_),e.clear(),o=!1,l&&(l=!1,E.process(b))}};return E}const AO=["read","resolveKeyframes","update","preRender","render","postRender"],_Ae=40;function Cee(n,e){let i=!1,o=!0;const l={delta:0,timestamp:0,isProcessing:!1},d=()=>i=!0,p=AO.reduce((J,$)=>(J[$]=gAe(d),J),{}),{read:_,resolveKeyframes:E,update:b,preRender:C,render:I,postRender:O}=p,L=()=>{const J=performance.now();i=!1,l.delta=o?1e3/60:Math.max(Math.min(J-l.timestamp,_Ae),1),l.timestamp=J,l.isProcessing=!0,_.process(l),E.process(l),b.process(l),C.process(l),I.process(l),O.process(l),l.isProcessing=!1,i&&e&&(o=!1,n(L))},U=()=>{i=!0,o=!0,l.isProcessing||n(L)};return{schedule:AO.reduce((J,$)=>{const ie=p[$];return J[$]=(ce,ne=!1,de=!1)=>(i||U(),ie.schedule(ce,ne,de)),J},{}),cancel:J=>{for(let $=0;$<AO.length;$++)p[AO[$]].cancel(J)},state:l,steps:p}}const{schedule:ss,cancel:Ng,state:va,steps:KM}=Cee(typeof requestAnimationFrame<"u"?requestAnimationFrame:Gl,!0),Ree=N.createContext({strict:!1}),Cq={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},S0={};for(const n in Cq)S0[n]={isEnabled:e=>Cq[n].some(i=>!!e[i])};function yAe(n){for(const e in n)S0[e]={...S0[e],...n[e]}}const EAe=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function zk(n){return n.startsWith("while")||n.startsWith("drag")&&n!=="draggable"||n.startsWith("layout")||n.startsWith("onTap")||n.startsWith("onPan")||n.startsWith("onLayout")||EAe.has(n)}let Iee=n=>!zk(n);function vAe(n){n&&(Iee=e=>e.startsWith("on")?!zk(e):n(e))}try{vAe(require("@emotion/is-prop-valid").default)}catch{}function SAe(n,e,i){const o={};for(const l in n)l==="values"&&typeof n.values=="object"||(Iee(l)||i===!0&&zk(l)||!e&&!zk(l)||n.draggable&&l.startsWith("onDrag"))&&(o[l]=n[l]);return o}function bAe(n){if(typeof Proxy>"u")return n;const e=new Map,i=(...o)=>n(...o);return new Proxy(i,{get:(o,l)=>l==="create"?n:(e.has(l)||e.set(l,n(l)),e.get(l))})}const W1=N.createContext({});function OC(n){return typeof n=="string"||Array.isArray(n)}function z1(n){return n!==null&&typeof n=="object"&&typeof n.start=="function"}const aj=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],cj=["initial",...aj];function G1(n){return z1(n.animate)||cj.some(e=>OC(n[e]))}function Aee(n){return!!(G1(n)||n.variants)}function TAe(n,e){if(G1(n)){const{initial:i,animate:o}=n;return{initial:i===!1||OC(i)?i:void 0,animate:OC(o)?o:void 0}}return n.inherit!==!1?e:{}}function wAe(n){const{initial:e,animate:i}=TAe(n,N.useContext(W1));return N.useMemo(()=>({initial:e,animate:i}),[Rq(e),Rq(i)])}function Rq(n){return Array.isArray(n)?n.join(" "):n}const CAe=Symbol.for("motionComponentSymbol");function HS(n){return n&&typeof n=="object"&&Object.prototype.hasOwnProperty.call(n,"current")}function RAe(n,e,i){return N.useCallback(o=>{o&&n.onMount&&n.onMount(o),e&&(o?e.mount(o):e.unmount()),i&&(typeof i=="function"?i(o):HS(i)&&(i.current=o))},[e])}const lj=n=>n.replace(/([a-z])([A-Z])/gu,"$1-$2").toLowerCase(),IAe="framerAppearId",Pee="data-"+lj(IAe),{schedule:uj}=Cee(queueMicrotask,!1),Oee=N.createContext({});function AAe(n,e,i,o,l){var d,p;const{visualElement:_}=N.useContext(W1),E=N.useContext(Ree),b=N.useContext(sR),C=N.useContext(rj).reducedMotion,I=N.useRef(null);o=o||E.renderer,!I.current&&o&&(I.current=o(n,{visualState:e,parent:_,props:i,presenceContext:b,blockInitialAnimation:b?b.initial===!1:!1,reducedMotionConfig:C}));const O=I.current,L=N.useContext(Oee);O&&!O.projection&&l&&(O.type==="html"||O.type==="svg")&&PAe(I.current,i,l,L);const U=N.useRef(!1);N.useInsertionEffect(()=>{O&&U.current&&O.update(i,b)});const B=i[Pee],W=N.useRef(!!B&&!(!((d=window.MotionHandoffIsComplete)===null||d===void 0)&&d.call(window,B))&&((p=window.MotionHasOptimisedAnimation)===null||p===void 0?void 0:p.call(window,B)));return Tee(()=>{O&&(U.current=!0,window.MotionIsMounted=!0,O.updateFeatures(),uj.render(O.render),W.current&&O.animationState&&O.animationState.animateChanges())}),N.useEffect(()=>{O&&(!W.current&&O.animationState&&O.animationState.animateChanges(),W.current&&(queueMicrotask(()=>{var J;(J=window.MotionHandoffMarkAsComplete)===null||J===void 0||J.call(window,B)}),W.current=!1))}),O}function PAe(n,e,i,o){const{layoutId:l,layout:d,drag:p,dragConstraints:_,layoutScroll:E,layoutRoot:b}=e;n.projection=new i(n.latestValues,e["data-framer-portal-id"]?void 0:kee(n.parent)),n.projection.setOptions({layoutId:l,layout:d,alwaysMeasureLayout:!!p||_&&HS(_),visualElement:n,animationType:typeof d=="string"?d:"both",initialPromotionConfig:o,layoutScroll:E,layoutRoot:b})}function kee(n){if(n)return n.options.allowProjection!==!1?n.projection:kee(n.parent)}function OAe({preloadedFeatures:n,createVisualElement:e,useRender:i,useVisualState:o,Component:l}){var d,p;n&&yAe(n);function _(b,C){let I;const O={...N.useContext(rj),...b,layoutId:kAe(b)},{isStatic:L}=O,U=wAe(b),B=o(b,L);if(!L&&sj){NAe();const W=DAe(O);I=W.MeasureLayout,U.visualElement=AAe(l,B,O,e,W.ProjectionNode)}return w.jsxs(W1.Provider,{value:U,children:[I&&U.visualElement?w.jsx(I,{visualElement:U.visualElement,...O}):null,i(l,b,RAe(B,U.visualElement,C),B,L,U.visualElement)]})}_.displayName=`motion.${typeof l=="string"?l:`create(${(p=(d=l.displayName)!==null&&d!==void 0?d:l.name)!==null&&p!==void 0?p:""})`}`;const E=N.forwardRef(_);return E[CAe]=l,E}function kAe({layoutId:n}){const e=N.useContext(tj).id;return e&&n!==void 0?e+"-"+n:n}function NAe(n,e){N.useContext(Ree).strict}function DAe(n){const{drag:e,layout:i}=S0;if(!e&&!i)return{};const o={...e,...i};return{MeasureLayout:e!=null&&e.isEnabled(n)||i!=null&&i.isEnabled(n)?o.MeasureLayout:void 0,ProjectionNode:o.ProjectionNode}}const xAe=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function dj(n){return typeof n!="string"||n.includes("-")?!1:!!(xAe.indexOf(n)>-1||/[A-Z]/u.test(n))}function Iq(n){const e=[{},{}];return n==null||n.values.forEach((i,o)=>{e[0][o]=i.get(),e[1][o]=i.getVelocity()}),e}function hj(n,e,i,o){if(typeof e=="function"){const[l,d]=Iq(o);e=e(i!==void 0?i:n.custom,l,d)}if(typeof e=="string"&&(e=n.variants&&n.variants[e]),typeof e=="function"){const[l,d]=Iq(o);e=e(i!==void 0?i:n.custom,l,d)}return e}const cV=n=>Array.isArray(n),LAe=n=>!!(n&&typeof n=="object"&&n.mix&&n.toValue),MAe=n=>cV(n)?n[n.length-1]||0:n,Za=n=>!!(n&&n.getVelocity);function dk(n){const e=Za(n)?n.get():n;return LAe(e)?e.toValue():e}function UAe({scrapeMotionValuesFromProps:n,createRenderState:e,onUpdate:i},o,l,d){const p={latestValues:VAe(o,l,d,n),renderState:e()};return i&&(p.onMount=_=>i({props:o,current:_,...p}),p.onUpdate=_=>i(_)),p}const Nee=n=>(e,i)=>{const o=N.useContext(W1),l=N.useContext(sR),d=()=>UAe(n,e,o,l);return i?d():nj(d)};function VAe(n,e,i,o){const l={},d=o(n,{});for(const O in d)l[O]=dk(d[O]);let{initial:p,animate:_}=n;const E=G1(n),b=Aee(n);e&&b&&!E&&n.inherit!==!1&&(p===void 0&&(p=e.initial),_===void 0&&(_=e.animate));let C=i?i.initial===!1:!1;C=C||p===!1;const I=C?_:p;if(I&&typeof I!="boolean"&&!z1(I)){const O=Array.isArray(I)?I:[I];for(let L=0;L<O.length;L++){const U=hj(n,O[L]);if(U){const{transitionEnd:B,transition:W,...J}=U;for(const $ in J){let ie=J[$];if(Array.isArray(ie)){const ce=C?ie.length-1:0;ie=ie[ce]}ie!==null&&(l[$]=ie)}for(const $ in B)l[$]=B[$]}}}return l}const H0=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],rE=new Set(H0),Dee=n=>e=>typeof e=="string"&&e.startsWith(n),xee=Dee("--"),FAe=Dee("var(--"),fj=n=>FAe(n)?jAe.test(n.split("/*")[0].trim()):!1,jAe=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu,Lee=(n,e)=>e&&typeof n=="number"?e.transform(n):n,Gp=(n,e,i)=>i>e?e:i<n?n:i,$0={test:n=>typeof n=="number",parse:parseFloat,transform:n=>n},kC={...$0,transform:n=>Gp(0,1,n)},PO={...$0,default:1},oR=n=>({test:e=>typeof e=="string"&&e.endsWith(n)&&e.split(" ").length===1,parse:parseFloat,transform:e=>`${e}${n}`}),gg=oR("deg"),rf=oR("%"),Bn=oR("px"),BAe=oR("vh"),WAe=oR("vw"),Aq={...rf,parse:n=>rf.parse(n)/100,transform:n=>rf.transform(n*100)},zAe={borderWidth:Bn,borderTopWidth:Bn,borderRightWidth:Bn,borderBottomWidth:Bn,borderLeftWidth:Bn,borderRadius:Bn,radius:Bn,borderTopLeftRadius:Bn,borderTopRightRadius:Bn,borderBottomRightRadius:Bn,borderBottomLeftRadius:Bn,width:Bn,maxWidth:Bn,height:Bn,maxHeight:Bn,top:Bn,right:Bn,bottom:Bn,left:Bn,padding:Bn,paddingTop:Bn,paddingRight:Bn,paddingBottom:Bn,paddingLeft:Bn,margin:Bn,marginTop:Bn,marginRight:Bn,marginBottom:Bn,marginLeft:Bn,backgroundPositionX:Bn,backgroundPositionY:Bn},GAe={rotate:gg,rotateX:gg,rotateY:gg,rotateZ:gg,scale:PO,scaleX:PO,scaleY:PO,scaleZ:PO,skew:gg,skewX:gg,skewY:gg,distance:Bn,translateX:Bn,translateY:Bn,translateZ:Bn,x:Bn,y:Bn,z:Bn,perspective:Bn,transformPerspective:Bn,opacity:kC,originX:Aq,originY:Aq,originZ:Bn},Pq={...$0,transform:Math.round},pj={...zAe,...GAe,zIndex:Pq,size:Bn,fillOpacity:kC,strokeOpacity:kC,numOctaves:Pq},HAe={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},$Ae=H0.length;function KAe(n,e,i){let o="",l=!0;for(let d=0;d<$Ae;d++){const p=H0[d],_=n[p];if(_===void 0)continue;let E=!0;if(typeof _=="number"?E=_===(p.startsWith("scale")?1:0):E=parseFloat(_)===0,!E||i){const b=Lee(_,pj[p]);if(!E){l=!1;const C=HAe[p]||p;o+=`${C}(${b}) `}i&&(e[p]=b)}}return o=o.trim(),i?o=i(e,l?"":o):l&&(o="none"),o}function mj(n,e,i){const{style:o,vars:l,transformOrigin:d}=n;let p=!1,_=!1;for(const E in e){const b=e[E];if(rE.has(E)){p=!0;continue}else if(xee(E)){l[E]=b;continue}else{const C=Lee(b,pj[E]);E.startsWith("origin")?(_=!0,d[E]=C):o[E]=C}}if(e.transform||(p||i?o.transform=KAe(e,n.transform,i):o.transform&&(o.transform="none")),_){const{originX:E="50%",originY:b="50%",originZ:C=0}=d;o.transformOrigin=`${E} ${b} ${C}`}}const qAe={offset:"stroke-dashoffset",array:"stroke-dasharray"},YAe={offset:"strokeDashoffset",array:"strokeDasharray"};function XAe(n,e,i=1,o=0,l=!0){n.pathLength=1;const d=l?qAe:YAe;n[d.offset]=Bn.transform(-o);const p=Bn.transform(e),_=Bn.transform(i);n[d.array]=`${p} ${_}`}function Oq(n,e,i){return typeof n=="string"?n:Bn.transform(e+i*n)}function JAe(n,e,i){const o=Oq(e,n.x,n.width),l=Oq(i,n.y,n.height);return`${o} ${l}`}function gj(n,{attrX:e,attrY:i,attrScale:o,originX:l,originY:d,pathLength:p,pathSpacing:_=1,pathOffset:E=0,...b},C,I){if(mj(n,b,I),C){n.style.viewBox&&(n.attrs.viewBox=n.style.viewBox);return}n.attrs=n.style,n.style={};const{attrs:O,style:L,dimensions:U}=n;O.transform&&(U&&(L.transform=O.transform),delete O.transform),U&&(l!==void 0||d!==void 0||L.transform)&&(L.transformOrigin=JAe(U,l!==void 0?l:.5,d!==void 0?d:.5)),e!==void 0&&(O.x=e),i!==void 0&&(O.y=i),o!==void 0&&(O.scale=o),p!==void 0&&XAe(O,p,_,E,!1)}const _j=()=>({style:{},transform:{},transformOrigin:{},vars:{}}),Mee=()=>({..._j(),attrs:{}}),yj=n=>typeof n=="string"&&n.toLowerCase()==="svg";function Uee(n,{style:e,vars:i},o,l){Object.assign(n.style,e,l&&l.getProjectionStyles(o));for(const d in i)n.style.setProperty(d,i[d])}const Vee=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);function Fee(n,e,i,o){Uee(n,e,void 0,o);for(const l in e.attrs)n.setAttribute(Vee.has(l)?l:lj(l),e.attrs[l])}const Gk={};function QAe(n){Object.assign(Gk,n)}function jee(n,{layout:e,layoutId:i}){return rE.has(n)||n.startsWith("origin")||(e||i!==void 0)&&(!!Gk[n]||n==="opacity")}function Ej(n,e,i){var o;const{style:l}=n,d={};for(const p in l)(Za(l[p])||e.style&&Za(e.style[p])||jee(p,n)||((o=i==null?void 0:i.getValue(p))===null||o===void 0?void 0:o.liveStyle)!==void 0)&&(d[p]=l[p]);return d}function Bee(n,e,i){const o=Ej(n,e,i);for(const l in n)if(Za(n[l])||Za(e[l])){const d=H0.indexOf(l)!==-1?"attr"+l.charAt(0).toUpperCase()+l.substring(1):l;o[d]=n[l]}return o}function ZAe(n,e){try{e.dimensions=typeof n.getBBox=="function"?n.getBBox():n.getBoundingClientRect()}catch{e.dimensions={x:0,y:0,width:0,height:0}}}const kq=["x","y","width","height","cx","cy","r"],ePe={useVisualState:Nee({scrapeMotionValuesFromProps:Bee,createRenderState:Mee,onUpdate:({props:n,prevProps:e,current:i,renderState:o,latestValues:l})=>{if(!i)return;let d=!!n.drag;if(!d){for(const _ in l)if(rE.has(_)){d=!0;break}}if(!d)return;let p=!e;if(e)for(let _=0;_<kq.length;_++){const E=kq[_];n[E]!==e[E]&&(p=!0)}p&&ss.read(()=>{ZAe(i,o),ss.render(()=>{gj(o,l,yj(i.tagName),n.transformTemplate),Fee(i,o)})})}})},tPe={useVisualState:Nee({scrapeMotionValuesFromProps:Ej,createRenderState:_j})};function Wee(n,e,i){for(const o in e)!Za(e[o])&&!jee(o,i)&&(n[o]=e[o])}function nPe({transformTemplate:n},e){return N.useMemo(()=>{const i=_j();return mj(i,e,n),Object.assign({},i.vars,i.style)},[e])}function rPe(n,e){const i=n.style||{},o={};return Wee(o,i,n),Object.assign(o,nPe(n,e)),o}function iPe(n,e){const i={},o=rPe(n,e);return n.drag&&n.dragListener!==!1&&(i.draggable=!1,o.userSelect=o.WebkitUserSelect=o.WebkitTouchCallout="none",o.touchAction=n.drag===!0?"none":`pan-${n.drag==="x"?"y":"x"}`),n.tabIndex===void 0&&(n.onTap||n.onTapStart||n.whileTap)&&(i.tabIndex=0),i.style=o,i}function sPe(n,e,i,o){const l=N.useMemo(()=>{const d=Mee();return gj(d,e,yj(o),n.transformTemplate),{...d.attrs,style:{...d.style}}},[e]);if(n.style){const d={};Wee(d,n.style,n),l.style={...d,...l.style}}return l}function oPe(n=!1){return(i,o,l,{latestValues:d},p)=>{const E=(dj(i)?sPe:iPe)(o,d,p,i),b=SAe(o,typeof i=="string",n),C=i!==N.Fragment?{...b,...E,ref:l}:{},{children:I}=o,O=N.useMemo(()=>Za(I)?I.get():I,[I]);return N.createElement(i,{...C,children:O})}}function aPe(n,e){return function(o,{forwardMotionProps:l}={forwardMotionProps:!1}){const p={...dj(o)?ePe:tPe,preloadedFeatures:n,useRender:oPe(l),createVisualElement:e,Component:o};return OAe(p)}}function zee(n,e){if(!Array.isArray(e))return!1;const i=e.length;if(i!==n.length)return!1;for(let o=0;o<i;o++)if(e[o]!==n[o])return!1;return!0}function H1(n,e,i){const o=n.getProps();return hj(o,e,i!==void 0?i:o.custom,n)}const cPe=oj(()=>window.ScrollTimeline!==void 0);class lPe{constructor(e){this.stop=()=>this.runAll("stop"),this.animations=e.filter(Boolean)}get finished(){return Promise.all(this.animations.map(e=>"finished"in e?e.finished:e))}getAll(e){return this.animations[0][e]}setAll(e,i){for(let o=0;o<this.animations.length;o++)this.animations[o][e]=i}attachTimeline(e,i){const o=this.animations.map(l=>{if(cPe()&&l.attachTimeline)return l.attachTimeline(e);if(typeof i=="function")return i(l)});return()=>{o.forEach((l,d)=>{l&&l(),this.animations[d].stop()})}}get time(){return this.getAll("time")}set time(e){this.setAll("time",e)}get speed(){return this.getAll("speed")}set speed(e){this.setAll("speed",e)}get startTime(){return this.getAll("startTime")}get duration(){let e=0;for(let i=0;i<this.animations.length;i++)e=Math.max(e,this.animations[i].duration);return e}runAll(e){this.animations.forEach(i=>i[e]())}flatten(){this.runAll("flatten")}play(){this.runAll("play")}pause(){this.runAll("pause")}cancel(){this.runAll("cancel")}complete(){this.runAll("complete")}}class uPe extends lPe{then(e,i){return Promise.all(this.animations).then(e).catch(i)}}function vj(n,e){return n?n[e]||n.default||n:void 0}const lV=2e4;function Gee(n){let e=0;const i=50;let o=n.next(e);for(;!o.done&&e<lV;)e+=i,o=n.next(e);return e>=lV?1/0:e}function Sj(n){return typeof n=="function"}function Nq(n,e){n.timeline=e,n.onfinish=null}const bj=n=>Array.isArray(n)&&typeof n[0]=="number",dPe={linearEasing:void 0};function hPe(n,e){const i=oj(n);return()=>{var o;return(o=dPe[e])!==null&&o!==void 0?o:i()}}const Hk=hPe(()=>{try{document.createElement("div").animate({opacity:0},{easing:"linear(0, 1)"})}catch{return!1}return!0},"linearEasing"),Hee=(n,e,i=10)=>{let o="";const l=Math.max(Math.round(e/i),2);for(let d=0;d<l;d++)o+=n(v0(0,l-1,d))+", ";return`linear(${o.substring(0,o.length-2)})`};function $ee(n){return!!(typeof n=="function"&&Hk()||!n||typeof n=="string"&&(n in uV||Hk())||bj(n)||Array.isArray(n)&&n.every($ee))}const $w=([n,e,i,o])=>`cubic-bezier(${n}, ${e}, ${i}, ${o})`,uV={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:$w([0,.65,.55,1]),circOut:$w([.55,0,1,.45]),backIn:$w([.31,.01,.66,-.59]),backOut:$w([.33,1.53,.69,.99])};function Kee(n,e){if(n)return typeof n=="function"&&Hk()?Hee(n,e):bj(n)?$w(n):Array.isArray(n)?n.map(i=>Kee(i,e)||uV.easeOut):uV[n]}const xd={x:!1,y:!1};function qee(){return xd.x||xd.y}function fPe(n,e,i){var o;if(n instanceof Element)return[n];if(typeof n=="string"){let l=document;const d=(o=void 0)!==null&&o!==void 0?o:l.querySelectorAll(n);return d?Array.from(d):[]}return Array.from(n)}function Yee(n,e){const i=fPe(n),o=new AbortController,l={passive:!0,...e,signal:o.signal};return[i,l,()=>o.abort()]}function Dq(n){return e=>{e.pointerType==="touch"||qee()||n(e)}}function pPe(n,e,i={}){const[o,l,d]=Yee(n,i),p=Dq(_=>{const{target:E}=_,b=e(_);if(typeof b!="function"||!E)return;const C=Dq(I=>{b(I),E.removeEventListener("pointerleave",C)});E.addEventListener("pointerleave",C,l)});return o.forEach(_=>{_.addEventListener("pointerenter",p,l)}),d}const Xee=(n,e)=>e?n===e?!0:Xee(n,e.parentElement):!1,Tj=n=>n.pointerType==="mouse"?typeof n.button!="number"||n.button<=0:n.isPrimary!==!1,mPe=new Set(["BUTTON","INPUT","SELECT","TEXTAREA","A"]);function gPe(n){return mPe.has(n.tagName)||n.tabIndex!==-1}const Kw=new WeakSet;function xq(n){return e=>{e.key==="Enter"&&n(e)}}function qM(n,e){n.dispatchEvent(new PointerEvent("pointer"+e,{isPrimary:!0,bubbles:!0}))}const _Pe=(n,e)=>{const i=n.currentTarget;if(!i)return;const o=xq(()=>{if(Kw.has(i))return;qM(i,"down");const l=xq(()=>{qM(i,"up")}),d=()=>qM(i,"cancel");i.addEventListener("keyup",l,e),i.addEventListener("blur",d,e)});i.addEventListener("keydown",o,e),i.addEventListener("blur",()=>i.removeEventListener("keydown",o),e)};function Lq(n){return Tj(n)&&!qee()}function yPe(n,e,i={}){const[o,l,d]=Yee(n,i),p=_=>{const E=_.currentTarget;if(!Lq(_)||Kw.has(E))return;Kw.add(E);const b=e(_),C=(L,U)=>{window.removeEventListener("pointerup",I),window.removeEventListener("pointercancel",O),!(!Lq(L)||!Kw.has(E))&&(Kw.delete(E),typeof b=="function"&&b(L,{success:U}))},I=L=>{C(L,i.useGlobalTarget||Xee(E,L.target))},O=L=>{C(L,!1)};window.addEventListener("pointerup",I,l),window.addEventListener("pointercancel",O,l)};return o.forEach(_=>{!gPe(_)&&_.getAttribute("tabindex")===null&&(_.tabIndex=0),(i.useGlobalTarget?window:_).addEventListener("pointerdown",p,l),_.addEventListener("focus",b=>_Pe(b,l),l)}),d}function EPe(n){return n==="x"||n==="y"?xd[n]?null:(xd[n]=!0,()=>{xd[n]=!1}):xd.x||xd.y?null:(xd.x=xd.y=!0,()=>{xd.x=xd.y=!1})}const Jee=new Set(["width","height","top","left","right","bottom",...H0]);let hk;function vPe(){hk=void 0}const sf={now:()=>(hk===void 0&&sf.set(va.isProcessing||mAe.useManualTiming?va.timestamp:performance.now()),hk),set:n=>{hk=n,queueMicrotask(vPe)}};function wj(n,e){n.indexOf(e)===-1&&n.push(e)}function Cj(n,e){const i=n.indexOf(e);i>-1&&n.splice(i,1)}class Rj{constructor(){this.subscriptions=[]}add(e){return wj(this.subscriptions,e),()=>Cj(this.subscriptions,e)}notify(e,i,o){const l=this.subscriptions.length;if(l)if(l===1)this.subscriptions[0](e,i,o);else for(let d=0;d<l;d++){const p=this.subscriptions[d];p&&p(e,i,o)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}function Qee(n,e){return e?n*(1e3/e):0}const Mq=30,SPe=n=>!isNaN(parseFloat(n));class bPe{constructor(e,i={}){this.version="11.18.2",this.canTrackVelocity=null,this.events={},this.updateAndNotify=(o,l=!0)=>{const d=sf.now();this.updatedAt!==d&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(o),this.current!==this.prev&&this.events.change&&this.events.change.notify(this.current),l&&this.events.renderRequest&&this.events.renderRequest.notify(this.current)},this.hasAnimated=!1,this.setCurrent(e),this.owner=i.owner}setCurrent(e){this.current=e,this.updatedAt=sf.now(),this.canTrackVelocity===null&&e!==void 0&&(this.canTrackVelocity=SPe(this.current))}setPrevFrameValue(e=this.current){this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt}onChange(e){return this.on("change",e)}on(e,i){this.events[e]||(this.events[e]=new Rj);const o=this.events[e].add(i);return e==="change"?()=>{o(),ss.read(()=>{this.events.change.getSize()||this.stop()})}:o}clearListeners(){for(const e in this.events)this.events[e].clear()}attach(e,i){this.passiveEffect=e,this.stopPassiveEffect=i}set(e,i=!0){!i||!this.passiveEffect?this.updateAndNotify(e,i):this.passiveEffect(e,this.updateAndNotify)}setWithVelocity(e,i,o){this.set(i),this.prev=void 0,this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt-o}jump(e,i=!0){this.updateAndNotify(e),this.prev=e,this.prevUpdatedAt=this.prevFrameValue=void 0,i&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}get(){return this.current}getPrevious(){return this.prev}getVelocity(){const e=sf.now();if(!this.canTrackVelocity||this.prevFrameValue===void 0||e-this.updatedAt>Mq)return 0;const i=Math.min(this.updatedAt-this.prevUpdatedAt,Mq);return Qee(parseFloat(this.current)-parseFloat(this.prevFrameValue),i)}start(e){return this.stop(),new Promise(i=>{this.hasAnimated=!0,this.animation=e(i),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function NC(n,e){return new bPe(n,e)}function TPe(n,e,i){n.hasValue(e)?n.getValue(e).set(i):n.addValue(e,NC(i))}function wPe(n,e){const i=H1(n,e);let{transitionEnd:o={},transition:l={},...d}=i||{};d={...d,...o};for(const p in d){const _=MAe(d[p]);TPe(n,p,_)}}function CPe(n){return!!(Za(n)&&n.add)}function dV(n,e){const i=n.getValue("willChange");if(CPe(i))return i.add(e)}function Zee(n){return n.props[Pee]}const ete=(n,e,i)=>(((1-3*i+3*e)*n+(3*i-6*e))*n+3*e)*n,RPe=1e-7,IPe=12;function APe(n,e,i,o,l){let d,p,_=0;do p=e+(i-e)/2,d=ete(p,o,l)-n,d>0?i=p:e=p;while(Math.abs(d)>RPe&&++_<IPe);return p}function aR(n,e,i,o){if(n===e&&i===o)return Gl;const l=d=>APe(d,0,1,n,i);return d=>d===0||d===1?d:ete(l(d),e,o)}const tte=n=>e=>e<=.5?n(2*e)/2:(2-n(2*(1-e)))/2,nte=n=>e=>1-n(1-e),rte=aR(.33,1.53,.69,.99),Ij=nte(rte),ite=tte(Ij),ste=n=>(n*=2)<1?.5*Ij(n):.5*(2-Math.pow(2,-10*(n-1))),Aj=n=>1-Math.sin(Math.acos(n)),ote=nte(Aj),ate=tte(Aj),cte=n=>/^0[^.\s]+$/u.test(n);function PPe(n){return typeof n=="number"?n===0:n!==null?n==="none"||n==="0"||cte(n):!0}const uC=n=>Math.round(n*1e5)/1e5,Pj=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu;function OPe(n){return n==null}const kPe=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu,Oj=(n,e)=>i=>!!(typeof i=="string"&&kPe.test(i)&&i.startsWith(n)||e&&!OPe(i)&&Object.prototype.hasOwnProperty.call(i,e)),lte=(n,e,i)=>o=>{if(typeof o!="string")return o;const[l,d,p,_]=o.match(Pj);return{[n]:parseFloat(l),[e]:parseFloat(d),[i]:parseFloat(p),alpha:_!==void 0?parseFloat(_):1}},NPe=n=>Gp(0,255,n),YM={...$0,transform:n=>Math.round(NPe(n))},Ry={test:Oj("rgb","red"),parse:lte("red","green","blue"),transform:({red:n,green:e,blue:i,alpha:o=1})=>"rgba("+YM.transform(n)+", "+YM.transform(e)+", "+YM.transform(i)+", "+uC(kC.transform(o))+")"};function DPe(n){let e="",i="",o="",l="";return n.length>5?(e=n.substring(1,3),i=n.substring(3,5),o=n.substring(5,7),l=n.substring(7,9)):(e=n.substring(1,2),i=n.substring(2,3),o=n.substring(3,4),l=n.substring(4,5),e+=e,i+=i,o+=o,l+=l),{red:parseInt(e,16),green:parseInt(i,16),blue:parseInt(o,16),alpha:l?parseInt(l,16)/255:1}}const hV={test:Oj("#"),parse:DPe,transform:Ry.transform},$S={test:Oj("hsl","hue"),parse:lte("hue","saturation","lightness"),transform:({hue:n,saturation:e,lightness:i,alpha:o=1})=>"hsla("+Math.round(n)+", "+rf.transform(uC(e))+", "+rf.transform(uC(i))+", "+uC(kC.transform(o))+")"},Xa={test:n=>Ry.test(n)||hV.test(n)||$S.test(n),parse:n=>Ry.test(n)?Ry.parse(n):$S.test(n)?$S.parse(n):hV.parse(n),transform:n=>typeof n=="string"?n:n.hasOwnProperty("red")?Ry.transform(n):$S.transform(n)},xPe=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu;function LPe(n){var e,i;return isNaN(n)&&typeof n=="string"&&(((e=n.match(Pj))===null||e===void 0?void 0:e.length)||0)+(((i=n.match(xPe))===null||i===void 0?void 0:i.length)||0)>0}const ute="number",dte="color",MPe="var",UPe="var(",Uq="${}",VPe=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function DC(n){const e=n.toString(),i=[],o={color:[],number:[],var:[]},l=[];let d=0;const _=e.replace(VPe,E=>(Xa.test(E)?(o.color.push(d),l.push(dte),i.push(Xa.parse(E))):E.startsWith(UPe)?(o.var.push(d),l.push(MPe),i.push(E)):(o.number.push(d),l.push(ute),i.push(parseFloat(E))),++d,Uq)).split(Uq);return{values:i,split:_,indexes:o,types:l}}function hte(n){return DC(n).values}function fte(n){const{split:e,types:i}=DC(n),o=e.length;return l=>{let d="";for(let p=0;p<o;p++)if(d+=e[p],l[p]!==void 0){const _=i[p];_===ute?d+=uC(l[p]):_===dte?d+=Xa.transform(l[p]):d+=l[p]}return d}}const FPe=n=>typeof n=="number"?0:n;function jPe(n){const e=hte(n);return fte(n)(e.map(FPe))}const Dg={test:LPe,parse:hte,createTransformer:fte,getAnimatableNone:jPe},BPe=new Set(["brightness","contrast","saturate","opacity"]);function WPe(n){const[e,i]=n.slice(0,-1).split("(");if(e==="drop-shadow")return n;const[o]=i.match(Pj)||[];if(!o)return n;const l=i.replace(o,"");let d=BPe.has(e)?1:0;return o!==i&&(d*=100),e+"("+d+l+")"}const zPe=/\b([a-z-]*)\(.*?\)/gu,fV={...Dg,getAnimatableNone:n=>{const e=n.match(zPe);return e?e.map(WPe).join(" "):n}},GPe={...pj,color:Xa,backgroundColor:Xa,outlineColor:Xa,fill:Xa,stroke:Xa,borderColor:Xa,borderTopColor:Xa,borderRightColor:Xa,borderBottomColor:Xa,borderLeftColor:Xa,filter:fV,WebkitFilter:fV},kj=n=>GPe[n];function pte(n,e){let i=kj(n);return i!==fV&&(i=Dg),i.getAnimatableNone?i.getAnimatableNone(e):void 0}const HPe=new Set(["auto","none","0"]);function $Pe(n,e,i){let o=0,l;for(;o<n.length&&!l;){const d=n[o];typeof d=="string"&&!HPe.has(d)&&DC(d).values.length&&(l=n[o]),o++}if(l&&i)for(const d of e)n[d]=pte(i,l)}const Vq=n=>n===$0||n===Bn,Fq=(n,e)=>parseFloat(n.split(", ")[e]),jq=(n,e)=>(i,{transform:o})=>{if(o==="none"||!o)return 0;const l=o.match(/^matrix3d\((.+)\)$/u);if(l)return Fq(l[1],e);{const d=o.match(/^matrix\((.+)\)$/u);return d?Fq(d[1],n):0}},KPe=new Set(["x","y","z"]),qPe=H0.filter(n=>!KPe.has(n));function YPe(n){const e=[];return qPe.forEach(i=>{const o=n.getValue(i);o!==void 0&&(e.push([i,o.get()]),o.set(i.startsWith("scale")?1:0))}),e}const b0={width:({x:n},{paddingLeft:e="0",paddingRight:i="0"})=>n.max-n.min-parseFloat(e)-parseFloat(i),height:({y:n},{paddingTop:e="0",paddingBottom:i="0"})=>n.max-n.min-parseFloat(e)-parseFloat(i),top:(n,{top:e})=>parseFloat(e),left:(n,{left:e})=>parseFloat(e),bottom:({y:n},{top:e})=>parseFloat(e)+(n.max-n.min),right:({x:n},{left:e})=>parseFloat(e)+(n.max-n.min),x:jq(4,13),y:jq(5,14)};b0.translateX=b0.x;b0.translateY=b0.y;const xy=new Set;let pV=!1,mV=!1;function mte(){if(mV){const n=Array.from(xy).filter(o=>o.needsMeasurement),e=new Set(n.map(o=>o.element)),i=new Map;e.forEach(o=>{const l=YPe(o);l.length&&(i.set(o,l),o.render())}),n.forEach(o=>o.measureInitialState()),e.forEach(o=>{o.render();const l=i.get(o);l&&l.forEach(([d,p])=>{var _;(_=o.getValue(d))===null||_===void 0||_.set(p)})}),n.forEach(o=>o.measureEndState()),n.forEach(o=>{o.suspendedScrollY!==void 0&&window.scrollTo(0,o.suspendedScrollY)})}mV=!1,pV=!1,xy.forEach(n=>n.complete()),xy.clear()}function gte(){xy.forEach(n=>{n.readKeyframes(),n.needsMeasurement&&(mV=!0)})}function XPe(){gte(),mte()}class Nj{constructor(e,i,o,l,d,p=!1){this.isComplete=!1,this.isAsync=!1,this.needsMeasurement=!1,this.isScheduled=!1,this.unresolvedKeyframes=[...e],this.onComplete=i,this.name=o,this.motionValue=l,this.element=d,this.isAsync=p}scheduleResolve(){this.isScheduled=!0,this.isAsync?(xy.add(this),pV||(pV=!0,ss.read(gte),ss.resolveKeyframes(mte))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:e,name:i,element:o,motionValue:l}=this;for(let d=0;d<e.length;d++)if(e[d]===null)if(d===0){const p=l==null?void 0:l.get(),_=e[e.length-1];if(p!==void 0)e[0]=p;else if(o&&i){const E=o.readValue(i,_);E!=null&&(e[0]=E)}e[0]===void 0&&(e[0]=_),l&&p===void 0&&l.set(e[0])}else e[d]=e[d-1]}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(){this.isComplete=!0,this.onComplete(this.unresolvedKeyframes,this.finalKeyframe),xy.delete(this)}cancel(){this.isComplete||(this.isScheduled=!1,xy.delete(this))}resume(){this.isComplete||this.scheduleResolve()}}const _te=n=>/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(n),JPe=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u;function QPe(n){const e=JPe.exec(n);if(!e)return[,];const[,i,o,l]=e;return[`--${i??o}`,l]}function yte(n,e,i=1){const[o,l]=QPe(n);if(!o)return;const d=window.getComputedStyle(e).getPropertyValue(o);if(d){const p=d.trim();return _te(p)?parseFloat(p):p}return fj(l)?yte(l,e,i+1):l}const Ete=n=>e=>e.test(n),ZPe={test:n=>n==="auto",parse:n=>n},vte=[$0,Bn,rf,gg,WAe,BAe,ZPe],Bq=n=>vte.find(Ete(n));class Ste extends Nj{constructor(e,i,o,l,d){super(e,i,o,l,d,!0)}readKeyframes(){const{unresolvedKeyframes:e,element:i,name:o}=this;if(!i||!i.current)return;super.readKeyframes();for(let E=0;E<e.length;E++){let b=e[E];if(typeof b=="string"&&(b=b.trim(),fj(b))){const C=yte(b,i.current);C!==void 0&&(e[E]=C),E===e.length-1&&(this.finalKeyframe=b)}}if(this.resolveNoneKeyframes(),!Jee.has(o)||e.length!==2)return;const[l,d]=e,p=Bq(l),_=Bq(d);if(p!==_)if(Vq(p)&&Vq(_))for(let E=0;E<e.length;E++){const b=e[E];typeof b=="string"&&(e[E]=parseFloat(b))}else this.needsMeasurement=!0}resolveNoneKeyframes(){const{unresolvedKeyframes:e,name:i}=this,o=[];for(let l=0;l<e.length;l++)PPe(e[l])&&o.push(l);o.length&&$Pe(e,o,i)}measureInitialState(){const{element:e,unresolvedKeyframes:i,name:o}=this;if(!e||!e.current)return;o==="height"&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=b0[o](e.measureViewportBox(),window.getComputedStyle(e.current)),i[0]=this.measuredOrigin;const l=i[i.length-1];l!==void 0&&e.getValue(o,l).jump(l,!1)}measureEndState(){var e;const{element:i,name:o,unresolvedKeyframes:l}=this;if(!i||!i.current)return;const d=i.getValue(o);d&&d.jump(this.measuredOrigin,!1);const p=l.length-1,_=l[p];l[p]=b0[o](i.measureViewportBox(),window.getComputedStyle(i.current)),_!==null&&this.finalKeyframe===void 0&&(this.finalKeyframe=_),!((e=this.removedTransforms)===null||e===void 0)&&e.length&&this.removedTransforms.forEach(([E,b])=>{i.getValue(E).set(b)}),this.resolveNoneKeyframes()}}const Wq=(n,e)=>e==="zIndex"?!1:!!(typeof n=="number"||Array.isArray(n)||typeof n=="string"&&(Dg.test(n)||n==="0")&&!n.startsWith("url("));function eOe(n){const e=n[0];if(n.length===1)return!0;for(let i=0;i<n.length;i++)if(n[i]!==e)return!0}function tOe(n,e,i,o){const l=n[0];if(l===null)return!1;if(e==="display"||e==="visibility")return!0;const d=n[n.length-1],p=Wq(l,e),_=Wq(d,e);return!p||!_?!1:eOe(n)||(i==="spring"||Sj(i))&&o}const nOe=n=>n!==null;function $1(n,{repeat:e,repeatType:i="loop"},o){const l=n.filter(nOe),d=e&&i!=="loop"&&e%2===1?0:l.length-1;return!d||o===void 0?l[d]:o}const rOe=40;class bte{constructor({autoplay:e=!0,delay:i=0,type:o="keyframes",repeat:l=0,repeatDelay:d=0,repeatType:p="loop",..._}){this.isStopped=!1,this.hasAttemptedResolve=!1,this.createdAt=sf.now(),this.options={autoplay:e,delay:i,type:o,repeat:l,repeatDelay:d,repeatType:p,..._},this.updateFinishedPromise()}calcStartTime(){return this.resolvedAt?this.resolvedAt-this.createdAt>rOe?this.resolvedAt:this.createdAt:this.createdAt}get resolved(){return!this._resolved&&!this.hasAttemptedResolve&&XPe(),this._resolved}onKeyframesResolved(e,i){this.resolvedAt=sf.now(),this.hasAttemptedResolve=!0;const{name:o,type:l,velocity:d,delay:p,onComplete:_,onUpdate:E,isGenerator:b}=this.options;if(!b&&!tOe(e,o,l,d))if(p)this.options.duration=0;else{E&&E($1(e,this.options,i)),_&&_(),this.resolveFinishedPromise();return}const C=this.initPlayback(e,i);C!==!1&&(this._resolved={keyframes:e,finalKeyframe:i,...C},this.onPostResolved())}onPostResolved(){}then(e,i){return this.currentFinishedPromise.then(e,i)}flatten(){this.options.type="keyframes",this.options.ease="linear"}updateFinishedPromise(){this.currentFinishedPromise=new Promise(e=>{this.resolveFinishedPromise=e})}}const _s=(n,e,i)=>n+(e-n)*i;function XM(n,e,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?n+(e-n)*6*i:i<1/2?e:i<2/3?n+(e-n)*(2/3-i)*6:n}function iOe({hue:n,saturation:e,lightness:i,alpha:o}){n/=360,e/=100,i/=100;let l=0,d=0,p=0;if(!e)l=d=p=i;else{const _=i<.5?i*(1+e):i+e-i*e,E=2*i-_;l=XM(E,_,n+1/3),d=XM(E,_,n),p=XM(E,_,n-1/3)}return{red:Math.round(l*255),green:Math.round(d*255),blue:Math.round(p*255),alpha:o}}function $k(n,e){return i=>i>0?e:n}const JM=(n,e,i)=>{const o=n*n,l=i*(e*e-o)+o;return l<0?0:Math.sqrt(l)},sOe=[hV,Ry,$S],oOe=n=>sOe.find(e=>e.test(n));function zq(n){const e=oOe(n);if(!e)return!1;let i=e.parse(n);return e===$S&&(i=iOe(i)),i}const Gq=(n,e)=>{const i=zq(n),o=zq(e);if(!i||!o)return $k(n,e);const l={...i};return d=>(l.red=JM(i.red,o.red,d),l.green=JM(i.green,o.green,d),l.blue=JM(i.blue,o.blue,d),l.alpha=_s(i.alpha,o.alpha,d),Ry.transform(l))},aOe=(n,e)=>i=>e(n(i)),cR=(...n)=>n.reduce(aOe),gV=new Set(["none","hidden"]);function cOe(n,e){return gV.has(n)?i=>i<=0?n:e:i=>i>=1?e:n}function lOe(n,e){return i=>_s(n,e,i)}function Dj(n){return typeof n=="number"?lOe:typeof n=="string"?fj(n)?$k:Xa.test(n)?Gq:hOe:Array.isArray(n)?Tte:typeof n=="object"?Xa.test(n)?Gq:uOe:$k}function Tte(n,e){const i=[...n],o=i.length,l=n.map((d,p)=>Dj(d)(d,e[p]));return d=>{for(let p=0;p<o;p++)i[p]=l[p](d);return i}}function uOe(n,e){const i={...n,...e},o={};for(const l in i)n[l]!==void 0&&e[l]!==void 0&&(o[l]=Dj(n[l])(n[l],e[l]));return l=>{for(const d in o)i[d]=o[d](l);return i}}function dOe(n,e){var i;const o=[],l={color:0,var:0,number:0};for(let d=0;d<e.values.length;d++){const p=e.types[d],_=n.indexes[p][l[p]],E=(i=n.values[_])!==null&&i!==void 0?i:0;o[d]=E,l[p]++}return o}const hOe=(n,e)=>{const i=Dg.createTransformer(e),o=DC(n),l=DC(e);return o.indexes.var.length===l.indexes.var.length&&o.indexes.color.length===l.indexes.color.length&&o.indexes.number.length>=l.indexes.number.length?gV.has(n)&&!l.values.length||gV.has(e)&&!o.values.length?cOe(n,e):cR(Tte(dOe(o,l),l.values),i):$k(n,e)};function wte(n,e,i){return typeof n=="number"&&typeof e=="number"&&typeof i=="number"?_s(n,e,i):Dj(n)(n,e)}const fOe=5;function Cte(n,e,i){const o=Math.max(e-fOe,0);return Qee(i-n(o),e-o)}const Ls={stiffness:100,damping:10,mass:1,velocity:0,duration:800,bounce:.3,visualDuration:.3,restSpeed:{granular:.01,default:2},restDelta:{granular:.005,default:.5},minDuration:.01,maxDuration:10,minDamping:.05,maxDamping:1},Hq=.001;function pOe({duration:n=Ls.duration,bounce:e=Ls.bounce,velocity:i=Ls.velocity,mass:o=Ls.mass}){let l,d,p=1-e;p=Gp(Ls.minDamping,Ls.maxDamping,p),n=Gp(Ls.minDuration,Ls.maxDuration,Up(n)),p<1?(l=b=>{const C=b*p,I=C*n,O=C-i,L=_V(b,p),U=Math.exp(-I);return Hq-O/L*U},d=b=>{const I=b*p*n,O=I*i+i,L=Math.pow(p,2)*Math.pow(b,2)*n,U=Math.exp(-I),B=_V(Math.pow(b,2),p);return(-l(b)+Hq>0?-1:1)*((O-L)*U)/B}):(l=b=>{const C=Math.exp(-b*n),I=(b-i)*n+1;return-.001+C*I},d=b=>{const C=Math.exp(-b*n),I=(i-b)*(n*n);return C*I});const _=5/n,E=gOe(l,d,_);if(n=Mp(n),isNaN(E))return{stiffness:Ls.stiffness,damping:Ls.damping,duration:n};{const b=Math.pow(E,2)*o;return{stiffness:b,damping:p*2*Math.sqrt(o*b),duration:n}}}const mOe=12;function gOe(n,e,i){let o=i;for(let l=1;l<mOe;l++)o=o-n(o)/e(o);return o}function _V(n,e){return n*Math.sqrt(1-e*e)}const _Oe=["duration","bounce"],yOe=["stiffness","damping","mass"];function $q(n,e){return e.some(i=>n[i]!==void 0)}function EOe(n){let e={velocity:Ls.velocity,stiffness:Ls.stiffness,damping:Ls.damping,mass:Ls.mass,isResolvedFromDuration:!1,...n};if(!$q(n,yOe)&&$q(n,_Oe))if(n.visualDuration){const i=n.visualDuration,o=2*Math.PI/(i*1.2),l=o*o,d=2*Gp(.05,1,1-(n.bounce||0))*Math.sqrt(l);e={...e,mass:Ls.mass,stiffness:l,damping:d}}else{const i=pOe(n);e={...e,...i,mass:Ls.mass},e.isResolvedFromDuration=!0}return e}function Rte(n=Ls.visualDuration,e=Ls.bounce){const i=typeof n!="object"?{visualDuration:n,keyframes:[0,1],bounce:e}:n;let{restSpeed:o,restDelta:l}=i;const d=i.keyframes[0],p=i.keyframes[i.keyframes.length-1],_={done:!1,value:d},{stiffness:E,damping:b,mass:C,duration:I,velocity:O,isResolvedFromDuration:L}=EOe({...i,velocity:-Up(i.velocity||0)}),U=O||0,B=b/(2*Math.sqrt(E*C)),W=p-d,J=Up(Math.sqrt(E/C)),$=Math.abs(W)<5;o||(o=$?Ls.restSpeed.granular:Ls.restSpeed.default),l||(l=$?Ls.restDelta.granular:Ls.restDelta.default);let ie;if(B<1){const ne=_V(J,B);ie=de=>{const Q=Math.exp(-B*J*de);return p-Q*((U+B*J*W)/ne*Math.sin(ne*de)+W*Math.cos(ne*de))}}else if(B===1)ie=ne=>p-Math.exp(-J*ne)*(W+(U+J*W)*ne);else{const ne=J*Math.sqrt(B*B-1);ie=de=>{const Q=Math.exp(-B*J*de),Z=Math.min(ne*de,300);return p-Q*((U+B*J*W)*Math.sinh(Z)+ne*W*Math.cosh(Z))/ne}}const ce={calculatedDuration:L&&I||null,next:ne=>{const de=ie(ne);if(L)_.done=ne>=I;else{let Q=0;B<1&&(Q=ne===0?Mp(U):Cte(ie,ne,de));const Z=Math.abs(Q)<=o,X=Math.abs(p-de)<=l;_.done=Z&&X}return _.value=_.done?p:de,_},toString:()=>{const ne=Math.min(Gee(ce),lV),de=Hee(Q=>ce.next(ne*Q).value,ne,30);return ne+"ms "+de}};return ce}function Kq({keyframes:n,velocity:e=0,power:i=.8,timeConstant:o=325,bounceDamping:l=10,bounceStiffness:d=500,modifyTarget:p,min:_,max:E,restDelta:b=.5,restSpeed:C}){const I=n[0],O={done:!1,value:I},L=Z=>_!==void 0&&Z<_||E!==void 0&&Z>E,U=Z=>_===void 0?E:E===void 0||Math.abs(_-Z)<Math.abs(E-Z)?_:E;let B=i*e;const W=I+B,J=p===void 0?W:p(W);J!==W&&(B=J-I);const $=Z=>-B*Math.exp(-Z/o),ie=Z=>J+$(Z),ce=Z=>{const X=$(Z),re=ie(Z);O.done=Math.abs(X)<=b,O.value=O.done?J:re};let ne,de;const Q=Z=>{L(O.value)&&(ne=Z,de=Rte({keyframes:[O.value,U(O.value)],velocity:Cte(ie,Z,O.value),damping:l,stiffness:d,restDelta:b,restSpeed:C}))};return Q(0),{calculatedDuration:null,next:Z=>{let X=!1;return!de&&ne===void 0&&(X=!0,ce(Z),Q(Z)),ne!==void 0&&Z>=ne?de.next(Z-ne):(!X&&ce(Z),O)}}}const vOe=aR(.42,0,1,1),SOe=aR(0,0,.58,1),Ite=aR(.42,0,.58,1),bOe=n=>Array.isArray(n)&&typeof n[0]!="number",TOe={linear:Gl,easeIn:vOe,easeInOut:Ite,easeOut:SOe,circIn:Aj,circInOut:ate,circOut:ote,backIn:Ij,backInOut:ite,backOut:rte,anticipate:ste},qq=n=>{if(bj(n)){wee(n.length===4);const[e,i,o,l]=n;return aR(e,i,o,l)}else if(typeof n=="string")return TOe[n];return n};function wOe(n,e,i){const o=[],l=i||wte,d=n.length-1;for(let p=0;p<d;p++){let _=l(n[p],n[p+1]);if(e){const E=Array.isArray(e)?e[p]||Gl:e;_=cR(E,_)}o.push(_)}return o}function COe(n,e,{clamp:i=!0,ease:o,mixer:l}={}){const d=n.length;if(wee(d===e.length),d===1)return()=>e[0];if(d===2&&e[0]===e[1])return()=>e[1];const p=n[0]===n[1];n[0]>n[d-1]&&(n=[...n].reverse(),e=[...e].reverse());const _=wOe(e,o,l),E=_.length,b=C=>{if(p&&C<n[0])return e[0];let I=0;if(E>1)for(;I<n.length-2&&!(C<n[I+1]);I++);const O=v0(n[I],n[I+1],C);return _[I](O)};return i?C=>b(Gp(n[0],n[d-1],C)):b}function ROe(n,e){const i=n[n.length-1];for(let o=1;o<=e;o++){const l=v0(0,e,o);n.push(_s(i,1,l))}}function IOe(n){const e=[0];return ROe(e,n.length-1),e}function AOe(n,e){return n.map(i=>i*e)}function POe(n,e){return n.map(()=>e||Ite).splice(0,n.length-1)}function Kk({duration:n=300,keyframes:e,times:i,ease:o="easeInOut"}){const l=bOe(o)?o.map(qq):qq(o),d={done:!1,value:e[0]},p=AOe(i&&i.length===e.length?i:IOe(e),n),_=COe(p,e,{ease:Array.isArray(l)?l:POe(e,l)});return{calculatedDuration:n,next:E=>(d.value=_(E),d.done=E>=n,d)}}const OOe=n=>{const e=({timestamp:i})=>n(i);return{start:()=>ss.update(e,!0),stop:()=>Ng(e),now:()=>va.isProcessing?va.timestamp:sf.now()}},kOe={decay:Kq,inertia:Kq,tween:Kk,keyframes:Kk,spring:Rte},NOe=n=>n/100;class xj extends bte{constructor(e){super(e),this.holdTime=null,this.cancelTime=null,this.currentTime=0,this.playbackSpeed=1,this.pendingPlayState="running",this.startTime=null,this.state="idle",this.stop=()=>{if(this.resolver.cancel(),this.isStopped=!0,this.state==="idle")return;this.teardown();const{onStop:E}=this.options;E&&E()};const{name:i,motionValue:o,element:l,keyframes:d}=this.options,p=(l==null?void 0:l.KeyframeResolver)||Nj,_=(E,b)=>this.onKeyframesResolved(E,b);this.resolver=new p(d,_,i,o,l),this.resolver.scheduleResolve()}flatten(){super.flatten(),this._resolved&&Object.assign(this._resolved,this.initPlayback(this._resolved.keyframes))}initPlayback(e){const{type:i="keyframes",repeat:o=0,repeatDelay:l=0,repeatType:d,velocity:p=0}=this.options,_=Sj(i)?i:kOe[i]||Kk;let E,b;_!==Kk&&typeof e[0]!="number"&&(E=cR(NOe,wte(e[0],e[1])),e=[0,100]);const C=_({...this.options,keyframes:e});d==="mirror"&&(b=_({...this.options,keyframes:[...e].reverse(),velocity:-p})),C.calculatedDuration===null&&(C.calculatedDuration=Gee(C));const{calculatedDuration:I}=C,O=I+l,L=O*(o+1)-l;return{generator:C,mirroredGenerator:b,mapPercentToKeyframes:E,calculatedDuration:I,resolvedDuration:O,totalDuration:L}}onPostResolved(){const{autoplay:e=!0}=this.options;this.play(),this.pendingPlayState==="paused"||!e?this.pause():this.state=this.pendingPlayState}tick(e,i=!1){const{resolved:o}=this;if(!o){const{keyframes:Z}=this.options;return{done:!0,value:Z[Z.length-1]}}const{finalKeyframe:l,generator:d,mirroredGenerator:p,mapPercentToKeyframes:_,keyframes:E,calculatedDuration:b,totalDuration:C,resolvedDuration:I}=o;if(this.startTime===null)return d.next(0);const{delay:O,repeat:L,repeatType:U,repeatDelay:B,onUpdate:W}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,e):this.speed<0&&(this.startTime=Math.min(e-C/this.speed,this.startTime)),i?this.currentTime=e:this.holdTime!==null?this.currentTime=this.holdTime:this.currentTime=Math.round(e-this.startTime)*this.speed;const J=this.currentTime-O*(this.speed>=0?1:-1),$=this.speed>=0?J<0:J>C;this.currentTime=Math.max(J,0),this.state==="finished"&&this.holdTime===null&&(this.currentTime=C);let ie=this.currentTime,ce=d;if(L){const Z=Math.min(this.currentTime,C)/I;let X=Math.floor(Z),re=Z%1;!re&&Z>=1&&(re=1),re===1&&X--,X=Math.min(X,L+1),!!(X%2)&&(U==="reverse"?(re=1-re,B&&(re-=B/I)):U==="mirror"&&(ce=p)),ie=Gp(0,1,re)*I}const ne=$?{done:!1,value:E[0]}:ce.next(ie);_&&(ne.value=_(ne.value));let{done:de}=ne;!$&&b!==null&&(de=this.speed>=0?this.currentTime>=C:this.currentTime<=0);const Q=this.holdTime===null&&(this.state==="finished"||this.state==="running"&&de);return Q&&l!==void 0&&(ne.value=$1(E,this.options,l)),W&&W(ne.value),Q&&this.finish(),ne}get duration(){const{resolved:e}=this;return e?Up(e.calculatedDuration):0}get time(){return Up(this.currentTime)}set time(e){e=Mp(e),this.currentTime=e,this.holdTime!==null||this.speed===0?this.holdTime=e:this.driver&&(this.startTime=this.driver.now()-e/this.speed)}get speed(){return this.playbackSpeed}set speed(e){const i=this.playbackSpeed!==e;this.playbackSpeed=e,i&&(this.time=Up(this.currentTime))}play(){if(this.resolver.isScheduled||this.resolver.resume(),!this._resolved){this.pendingPlayState="running";return}if(this.isStopped)return;const{driver:e=OOe,onPlay:i,startTime:o}=this.options;this.driver||(this.driver=e(d=>this.tick(d))),i&&i();const l=this.driver.now();this.holdTime!==null?this.startTime=l-this.holdTime:this.startTime?this.state==="finished"&&(this.startTime=l):this.startTime=o??this.calcStartTime(),this.state==="finished"&&this.updateFinishedPromise(),this.cancelTime=this.startTime,this.holdTime=null,this.state="running",this.driver.start()}pause(){var e;if(!this._resolved){this.pendingPlayState="paused";return}this.state="paused",this.holdTime=(e=this.currentTime)!==null&&e!==void 0?e:0}complete(){this.state!=="running"&&this.play(),this.pendingPlayState=this.state="finished",this.holdTime=null}finish(){this.teardown(),this.state="finished";const{onComplete:e}=this.options;e&&e()}cancel(){this.cancelTime!==null&&this.tick(this.cancelTime),this.teardown(),this.updateFinishedPromise()}teardown(){this.state="idle",this.stopDriver(),this.resolveFinishedPromise(),this.updateFinishedPromise(),this.startTime=this.cancelTime=null,this.resolver.cancel()}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(e){return this.startTime=0,this.tick(e,!0)}}const DOe=new Set(["opacity","clipPath","filter","transform"]);function xOe(n,e,i,{delay:o=0,duration:l=300,repeat:d=0,repeatType:p="loop",ease:_="easeInOut",times:E}={}){const b={[e]:i};E&&(b.offset=E);const C=Kee(_,l);return Array.isArray(C)&&(b.easing=C),n.animate(b,{delay:o,duration:l,easing:Array.isArray(C)?"linear":C,fill:"both",iterations:d+1,direction:p==="reverse"?"alternate":"normal"})}const LOe=oj(()=>Object.hasOwnProperty.call(Element.prototype,"animate")),qk=10,MOe=2e4;function UOe(n){return Sj(n.type)||n.type==="spring"||!$ee(n.ease)}function VOe(n,e){const i=new xj({...e,keyframes:n,repeat:0,delay:0,isGenerator:!0});let o={done:!1,value:n[0]};const l=[];let d=0;for(;!o.done&&d<MOe;)o=i.sample(d),l.push(o.value),d+=qk;return{times:void 0,keyframes:l,duration:d-qk,ease:"linear"}}const Ate={anticipate:ste,backInOut:ite,circInOut:ate};function FOe(n){return n in Ate}class Yq extends bte{constructor(e){super(e);const{name:i,motionValue:o,element:l,keyframes:d}=this.options;this.resolver=new Ste(d,(p,_)=>this.onKeyframesResolved(p,_),i,o,l),this.resolver.scheduleResolve()}initPlayback(e,i){let{duration:o=300,times:l,ease:d,type:p,motionValue:_,name:E,startTime:b}=this.options;if(!_.owner||!_.owner.current)return!1;if(typeof d=="string"&&Hk()&&FOe(d)&&(d=Ate[d]),UOe(this.options)){const{onComplete:I,onUpdate:O,motionValue:L,element:U,...B}=this.options,W=VOe(e,B);e=W.keyframes,e.length===1&&(e[1]=e[0]),o=W.duration,l=W.times,d=W.ease,p="keyframes"}const C=xOe(_.owner.current,E,e,{...this.options,duration:o,times:l,ease:d});return C.startTime=b??this.calcStartTime(),this.pendingTimeline?(Nq(C,this.pendingTimeline),this.pendingTimeline=void 0):C.onfinish=()=>{const{onComplete:I}=this.options;_.set($1(e,this.options,i)),I&&I(),this.cancel(),this.resolveFinishedPromise()},{animation:C,duration:o,times:l,type:p,ease:d,keyframes:e}}get duration(){const{resolved:e}=this;if(!e)return 0;const{duration:i}=e;return Up(i)}get time(){const{resolved:e}=this;if(!e)return 0;const{animation:i}=e;return Up(i.currentTime||0)}set time(e){const{resolved:i}=this;if(!i)return;const{animation:o}=i;o.currentTime=Mp(e)}get speed(){const{resolved:e}=this;if(!e)return 1;const{animation:i}=e;return i.playbackRate}set speed(e){const{resolved:i}=this;if(!i)return;const{animation:o}=i;o.playbackRate=e}get state(){const{resolved:e}=this;if(!e)return"idle";const{animation:i}=e;return i.playState}get startTime(){const{resolved:e}=this;if(!e)return null;const{animation:i}=e;return i.startTime}attachTimeline(e){if(!this._resolved)this.pendingTimeline=e;else{const{resolved:i}=this;if(!i)return Gl;const{animation:o}=i;Nq(o,e)}return Gl}play(){if(this.isStopped)return;const{resolved:e}=this;if(!e)return;const{animation:i}=e;i.playState==="finished"&&this.updateFinishedPromise(),i.play()}pause(){const{resolved:e}=this;if(!e)return;const{animation:i}=e;i.pause()}stop(){if(this.resolver.cancel(),this.isStopped=!0,this.state==="idle")return;this.resolveFinishedPromise(),this.updateFinishedPromise();const{resolved:e}=this;if(!e)return;const{animation:i,keyframes:o,duration:l,type:d,ease:p,times:_}=e;if(i.playState==="idle"||i.playState==="finished")return;if(this.time){const{motionValue:b,onUpdate:C,onComplete:I,element:O,...L}=this.options,U=new xj({...L,keyframes:o,duration:l,type:d,ease:p,times:_,isGenerator:!0}),B=Mp(this.time);b.setWithVelocity(U.sample(B-qk).value,U.sample(B).value,qk)}const{onStop:E}=this.options;E&&E(),this.cancel()}complete(){const{resolved:e}=this;e&&e.animation.finish()}cancel(){const{resolved:e}=this;e&&e.animation.cancel()}static supports(e){const{motionValue:i,name:o,repeatDelay:l,repeatType:d,damping:p,type:_}=e;if(!i||!i.owner||!(i.owner.current instanceof HTMLElement))return!1;const{onUpdate:E,transformTemplate:b}=i.owner.getProps();return LOe()&&o&&DOe.has(o)&&!E&&!b&&!l&&d!=="mirror"&&p!==0&&_!=="inertia"}}const jOe={type:"spring",stiffness:500,damping:25,restSpeed:10},BOe=n=>({type:"spring",stiffness:550,damping:n===0?2*Math.sqrt(550):30,restSpeed:10}),WOe={type:"keyframes",duration:.8},zOe={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},GOe=(n,{keyframes:e})=>e.length>2?WOe:rE.has(n)?n.startsWith("scale")?BOe(e[1]):jOe:zOe;function HOe({when:n,delay:e,delayChildren:i,staggerChildren:o,staggerDirection:l,repeat:d,repeatType:p,repeatDelay:_,from:E,elapsed:b,...C}){return!!Object.keys(C).length}const Lj=(n,e,i,o={},l,d)=>p=>{const _=vj(o,n)||{},E=_.delay||o.delay||0;let{elapsed:b=0}=o;b=b-Mp(E);let C={keyframes:Array.isArray(i)?i:[null,i],ease:"easeOut",velocity:e.getVelocity(),..._,delay:-b,onUpdate:O=>{e.set(O),_.onUpdate&&_.onUpdate(O)},onComplete:()=>{p(),_.onComplete&&_.onComplete()},name:n,motionValue:e,element:d?void 0:l};HOe(_)||(C={...C,...GOe(n,C)}),C.duration&&(C.duration=Mp(C.duration)),C.repeatDelay&&(C.repeatDelay=Mp(C.repeatDelay)),C.from!==void 0&&(C.keyframes[0]=C.from);let I=!1;if((C.type===!1||C.duration===0&&!C.repeatDelay)&&(C.duration=0,C.delay===0&&(I=!0)),I&&!d&&e.get()!==void 0){const O=$1(C.keyframes,_);if(O!==void 0)return ss.update(()=>{C.onUpdate(O),C.onComplete()}),new uPe([])}return!d&&Yq.supports(C)?new Yq(C):new xj(C)};function $Oe({protectedKeys:n,needsAnimating:e},i){const o=n.hasOwnProperty(i)&&e[i]!==!0;return e[i]=!1,o}function Pte(n,e,{delay:i=0,transitionOverride:o,type:l}={}){var d;let{transition:p=n.getDefaultTransition(),transitionEnd:_,...E}=e;o&&(p=o);const b=[],C=l&&n.animationState&&n.animationState.getState()[l];for(const I in E){const O=n.getValue(I,(d=n.latestValues[I])!==null&&d!==void 0?d:null),L=E[I];if(L===void 0||C&&$Oe(C,I))continue;const U={delay:i,...vj(p||{},I)};let B=!1;if(window.MotionHandoffAnimation){const J=Zee(n);if(J){const $=window.MotionHandoffAnimation(J,I,ss);$!==null&&(U.startTime=$,B=!0)}}dV(n,I),O.start(Lj(I,O,L,n.shouldReduceMotion&&Jee.has(I)?{type:!1}:U,n,B));const W=O.animation;W&&b.push(W)}return _&&Promise.all(b).then(()=>{ss.update(()=>{_&&wPe(n,_)})}),b}function yV(n,e,i={}){var o;const l=H1(n,e,i.type==="exit"?(o=n.presenceContext)===null||o===void 0?void 0:o.custom:void 0);let{transition:d=n.getDefaultTransition()||{}}=l||{};i.transitionOverride&&(d=i.transitionOverride);const p=l?()=>Promise.all(Pte(n,l,i)):()=>Promise.resolve(),_=n.variantChildren&&n.variantChildren.size?(b=0)=>{const{delayChildren:C=0,staggerChildren:I,staggerDirection:O}=d;return KOe(n,e,C+b,I,O,i)}:()=>Promise.resolve(),{when:E}=d;if(E){const[b,C]=E==="beforeChildren"?[p,_]:[_,p];return b().then(()=>C())}else return Promise.all([p(),_(i.delay)])}function KOe(n,e,i=0,o=0,l=1,d){const p=[],_=(n.variantChildren.size-1)*o,E=l===1?(b=0)=>b*o:(b=0)=>_-b*o;return Array.from(n.variantChildren).sort(qOe).forEach((b,C)=>{b.notify("AnimationStart",e),p.push(yV(b,e,{...d,delay:i+E(C)}).then(()=>b.notify("AnimationComplete",e)))}),Promise.all(p)}function qOe(n,e){return n.sortNodePosition(e)}function YOe(n,e,i={}){n.notify("AnimationStart",e);let o;if(Array.isArray(e)){const l=e.map(d=>yV(n,d,i));o=Promise.all(l)}else if(typeof e=="string")o=yV(n,e,i);else{const l=typeof e=="function"?H1(n,e,i.custom):e;o=Promise.all(Pte(n,l,i))}return o.then(()=>{n.notify("AnimationComplete",e)})}const XOe=cj.length;function Ote(n){if(!n)return;if(!n.isControllingVariants){const i=n.parent?Ote(n.parent)||{}:{};return n.props.initial!==void 0&&(i.initial=n.props.initial),i}const e={};for(let i=0;i<XOe;i++){const o=cj[i],l=n.props[o];(OC(l)||l===!1)&&(e[o]=l)}return e}const JOe=[...aj].reverse(),QOe=aj.length;function ZOe(n){return e=>Promise.all(e.map(({animation:i,options:o})=>YOe(n,i,o)))}function eke(n){let e=ZOe(n),i=Xq(),o=!0;const l=E=>(b,C)=>{var I;const O=H1(n,C,E==="exit"?(I=n.presenceContext)===null||I===void 0?void 0:I.custom:void 0);if(O){const{transition:L,transitionEnd:U,...B}=O;b={...b,...B,...U}}return b};function d(E){e=E(n)}function p(E){const{props:b}=n,C=Ote(n.parent)||{},I=[],O=new Set;let L={},U=1/0;for(let W=0;W<QOe;W++){const J=JOe[W],$=i[J],ie=b[J]!==void 0?b[J]:C[J],ce=OC(ie),ne=J===E?$.isActive:null;ne===!1&&(U=W);let de=ie===C[J]&&ie!==b[J]&&ce;if(de&&o&&n.manuallyAnimateOnMount&&(de=!1),$.protectedKeys={...L},!$.isActive&&ne===null||!ie&&!$.prevProp||z1(ie)||typeof ie=="boolean")continue;const Q=tke($.prevProp,ie);let Z=Q||J===E&&$.isActive&&!de&&ce||W>U&&ce,X=!1;const re=Array.isArray(ie)?ie:[ie];let pe=re.reduce(l(J),{});ne===!1&&(pe={});const{prevResolvedValues:he={}}=$,ue={...he,...pe},xe=ve=>{Z=!0,O.has(ve)&&(X=!0,O.delete(ve)),$.needsAnimating[ve]=!0;const _e=n.getValue(ve);_e&&(_e.liveStyle=!1)};for(const ve in ue){const _e=pe[ve],Ee=he[ve];if(L.hasOwnProperty(ve))continue;let ke=!1;cV(_e)&&cV(Ee)?ke=!zee(_e,Ee):ke=_e!==Ee,ke?_e!=null?xe(ve):O.add(ve):_e!==void 0&&O.has(ve)?xe(ve):$.protectedKeys[ve]=!0}$.prevProp=ie,$.prevResolvedValues=pe,$.isActive&&(L={...L,...pe}),o&&n.blockInitialAnimation&&(Z=!1),Z&&(!(de&&Q)||X)&&I.push(...re.map(ve=>({animation:ve,options:{type:J}})))}if(O.size){const W={};O.forEach(J=>{const $=n.getBaseTarget(J),ie=n.getValue(J);ie&&(ie.liveStyle=!0),W[J]=$??null}),I.push({animation:W})}let B=!!I.length;return o&&(b.initial===!1||b.initial===b.animate)&&!n.manuallyAnimateOnMount&&(B=!1),o=!1,B?e(I):Promise.resolve()}function _(E,b){var C;if(i[E].isActive===b)return Promise.resolve();(C=n.variantChildren)===null||C===void 0||C.forEach(O=>{var L;return(L=O.animationState)===null||L===void 0?void 0:L.setActive(E,b)}),i[E].isActive=b;const I=p(E);for(const O in i)i[O].protectedKeys={};return I}return{animateChanges:p,setActive:_,setAnimateFunction:d,getState:()=>i,reset:()=>{i=Xq(),o=!0}}}function tke(n,e){return typeof e=="string"?e!==n:Array.isArray(e)?!zee(e,n):!1}function my(n=!1){return{isActive:n,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function Xq(){return{animate:my(!0),whileInView:my(),whileHover:my(),whileTap:my(),whileDrag:my(),whileFocus:my(),exit:my()}}class Wg{constructor(e){this.isMounted=!1,this.node=e}update(){}}class nke extends Wg{constructor(e){super(e),e.animationState||(e.animationState=eke(e))}updateAnimationControlsSubscription(){const{animate:e}=this.node.getProps();z1(e)&&(this.unmountControls=e.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:e}=this.node.getProps(),{animate:i}=this.node.prevProps||{};e!==i&&this.updateAnimationControlsSubscription()}unmount(){var e;this.node.animationState.reset(),(e=this.unmountControls)===null||e===void 0||e.call(this)}}let rke=0;class ike extends Wg{constructor(){super(...arguments),this.id=rke++}update(){if(!this.node.presenceContext)return;const{isPresent:e,onExitComplete:i}=this.node.presenceContext,{isPresent:o}=this.node.prevPresenceContext||{};if(!this.node.animationState||e===o)return;const l=this.node.animationState.setActive("exit",!e);i&&!e&&l.then(()=>i(this.id))}mount(){const{register:e}=this.node.presenceContext||{};e&&(this.unmount=e(this.id))}unmount(){}}const ske={animation:{Feature:nke},exit:{Feature:ike}};function xC(n,e,i,o={passive:!0}){return n.addEventListener(e,i,o),()=>n.removeEventListener(e,i)}function lR(n){return{point:{x:n.pageX,y:n.pageY}}}const oke=n=>e=>Tj(e)&&n(e,lR(e));function dC(n,e,i,o){return xC(n,e,oke(i),o)}const Jq=(n,e)=>Math.abs(n-e);function ake(n,e){const i=Jq(n.x,e.x),o=Jq(n.y,e.y);return Math.sqrt(i**2+o**2)}class kte{constructor(e,i,{transformPagePoint:o,contextWindow:l,dragSnapToOrigin:d=!1}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const I=ZM(this.lastMoveEventInfo,this.history),O=this.startEvent!==null,L=ake(I.offset,{x:0,y:0})>=3;if(!O&&!L)return;const{point:U}=I,{timestamp:B}=va;this.history.push({...U,timestamp:B});const{onStart:W,onMove:J}=this.handlers;O||(W&&W(this.lastMoveEvent,I),this.startEvent=this.lastMoveEvent),J&&J(this.lastMoveEvent,I)},this.handlePointerMove=(I,O)=>{this.lastMoveEvent=I,this.lastMoveEventInfo=QM(O,this.transformPagePoint),ss.update(this.updatePoint,!0)},this.handlePointerUp=(I,O)=>{this.end();const{onEnd:L,onSessionEnd:U,resumeAnimation:B}=this.handlers;if(this.dragSnapToOrigin&&B&&B(),!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const W=ZM(I.type==="pointercancel"?this.lastMoveEventInfo:QM(O,this.transformPagePoint),this.history);this.startEvent&&L&&L(I,W),U&&U(I,W)},!Tj(e))return;this.dragSnapToOrigin=d,this.handlers=i,this.transformPagePoint=o,this.contextWindow=l||window;const p=lR(e),_=QM(p,this.transformPagePoint),{point:E}=_,{timestamp:b}=va;this.history=[{...E,timestamp:b}];const{onSessionStart:C}=i;C&&C(e,ZM(_,this.history)),this.removeListeners=cR(dC(this.contextWindow,"pointermove",this.handlePointerMove),dC(this.contextWindow,"pointerup",this.handlePointerUp),dC(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(e){this.handlers=e}end(){this.removeListeners&&this.removeListeners(),Ng(this.updatePoint)}}function QM(n,e){return e?{point:e(n.point)}:n}function Qq(n,e){return{x:n.x-e.x,y:n.y-e.y}}function ZM({point:n},e){return{point:n,delta:Qq(n,Nte(e)),offset:Qq(n,cke(e)),velocity:lke(e,.1)}}function cke(n){return n[0]}function Nte(n){return n[n.length-1]}function lke(n,e){if(n.length<2)return{x:0,y:0};let i=n.length-1,o=null;const l=Nte(n);for(;i>=0&&(o=n[i],!(l.timestamp-o.timestamp>Mp(e)));)i--;if(!o)return{x:0,y:0};const d=Up(l.timestamp-o.timestamp);if(d===0)return{x:0,y:0};const p={x:(l.x-o.x)/d,y:(l.y-o.y)/d};return p.x===1/0&&(p.x=0),p.y===1/0&&(p.y=0),p}const Dte=1e-4,uke=1-Dte,dke=1+Dte,xte=.01,hke=0-xte,fke=0+xte;function Hl(n){return n.max-n.min}function pke(n,e,i){return Math.abs(n-e)<=i}function Zq(n,e,i,o=.5){n.origin=o,n.originPoint=_s(e.min,e.max,n.origin),n.scale=Hl(i)/Hl(e),n.translate=_s(i.min,i.max,n.origin)-n.originPoint,(n.scale>=uke&&n.scale<=dke||isNaN(n.scale))&&(n.scale=1),(n.translate>=hke&&n.translate<=fke||isNaN(n.translate))&&(n.translate=0)}function hC(n,e,i,o){Zq(n.x,e.x,i.x,o?o.originX:void 0),Zq(n.y,e.y,i.y,o?o.originY:void 0)}function eY(n,e,i){n.min=i.min+e.min,n.max=n.min+Hl(e)}function mke(n,e,i){eY(n.x,e.x,i.x),eY(n.y,e.y,i.y)}function tY(n,e,i){n.min=e.min-i.min,n.max=n.min+Hl(e)}function fC(n,e,i){tY(n.x,e.x,i.x),tY(n.y,e.y,i.y)}function gke(n,{min:e,max:i},o){return e!==void 0&&n<e?n=o?_s(e,n,o.min):Math.max(n,e):i!==void 0&&n>i&&(n=o?_s(i,n,o.max):Math.min(n,i)),n}function nY(n,e,i){return{min:e!==void 0?n.min+e:void 0,max:i!==void 0?n.max+i-(n.max-n.min):void 0}}function _ke(n,{top:e,left:i,bottom:o,right:l}){return{x:nY(n.x,i,l),y:nY(n.y,e,o)}}function rY(n,e){let i=e.min-n.min,o=e.max-n.max;return e.max-e.min<n.max-n.min&&([i,o]=[o,i]),{min:i,max:o}}function yke(n,e){return{x:rY(n.x,e.x),y:rY(n.y,e.y)}}function Eke(n,e){let i=.5;const o=Hl(n),l=Hl(e);return l>o?i=v0(e.min,e.max-o,n.min):o>l&&(i=v0(n.min,n.max-l,e.min)),Gp(0,1,i)}function vke(n,e){const i={};return e.min!==void 0&&(i.min=e.min-n.min),e.max!==void 0&&(i.max=e.max-n.min),i}const EV=.35;function Ske(n=EV){return n===!1?n=0:n===!0&&(n=EV),{x:iY(n,"left","right"),y:iY(n,"top","bottom")}}function iY(n,e,i){return{min:sY(n,e),max:sY(n,i)}}function sY(n,e){return typeof n=="number"?n:n[e]||0}const oY=()=>({translate:0,scale:1,origin:0,originPoint:0}),KS=()=>({x:oY(),y:oY()}),aY=()=>({min:0,max:0}),Gs=()=>({x:aY(),y:aY()});function Uu(n){return[n("x"),n("y")]}function Lte({top:n,left:e,right:i,bottom:o}){return{x:{min:e,max:i},y:{min:n,max:o}}}function bke({x:n,y:e}){return{top:e.min,right:n.max,bottom:e.max,left:n.min}}function Tke(n,e){if(!e)return n;const i=e({x:n.left,y:n.top}),o=e({x:n.right,y:n.bottom});return{top:i.y,left:i.x,bottom:o.y,right:o.x}}function eU(n){return n===void 0||n===1}function vV({scale:n,scaleX:e,scaleY:i}){return!eU(n)||!eU(e)||!eU(i)}function _y(n){return vV(n)||Mte(n)||n.z||n.rotate||n.rotateX||n.rotateY||n.skewX||n.skewY}function Mte(n){return cY(n.x)||cY(n.y)}function cY(n){return n&&n!=="0%"}function Yk(n,e,i){const o=n-i,l=e*o;return i+l}function lY(n,e,i,o,l){return l!==void 0&&(n=Yk(n,l,o)),Yk(n,i,o)+e}function SV(n,e=0,i=1,o,l){n.min=lY(n.min,e,i,o,l),n.max=lY(n.max,e,i,o,l)}function Ute(n,{x:e,y:i}){SV(n.x,e.translate,e.scale,e.originPoint),SV(n.y,i.translate,i.scale,i.originPoint)}const uY=.999999999999,dY=1.0000000000001;function wke(n,e,i,o=!1){const l=i.length;if(!l)return;e.x=e.y=1;let d,p;for(let _=0;_<l;_++){d=i[_],p=d.projectionDelta;const{visualElement:E}=d.options;E&&E.props.style&&E.props.style.display==="contents"||(o&&d.options.layoutScroll&&d.scroll&&d!==d.root&&YS(n,{x:-d.scroll.offset.x,y:-d.scroll.offset.y}),p&&(e.x*=p.x.scale,e.y*=p.y.scale,Ute(n,p)),o&&_y(d.latestValues)&&YS(n,d.latestValues))}e.x<dY&&e.x>uY&&(e.x=1),e.y<dY&&e.y>uY&&(e.y=1)}function qS(n,e){n.min=n.min+e,n.max=n.max+e}function hY(n,e,i,o,l=.5){const d=_s(n.min,n.max,l);SV(n,e,i,d,o)}function YS(n,e){hY(n.x,e.x,e.scaleX,e.scale,e.originX),hY(n.y,e.y,e.scaleY,e.scale,e.originY)}function Vte(n,e){return Lte(Tke(n.getBoundingClientRect(),e))}function Cke(n,e,i){const o=Vte(n,i),{scroll:l}=e;return l&&(qS(o.x,l.offset.x),qS(o.y,l.offset.y)),o}const Fte=({current:n})=>n?n.ownerDocument.defaultView:null,Rke=new WeakMap;class Ike{constructor(e){this.openDragLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=Gs(),this.visualElement=e}start(e,{snapToCursor:i=!1}={}){const{presenceContext:o}=this.visualElement;if(o&&o.isPresent===!1)return;const l=C=>{const{dragSnapToOrigin:I}=this.getProps();I?this.pauseAnimation():this.stopAnimation(),i&&this.snapToCursor(lR(C).point)},d=(C,I)=>{const{drag:O,dragPropagation:L,onDragStart:U}=this.getProps();if(O&&!L&&(this.openDragLock&&this.openDragLock(),this.openDragLock=EPe(O),!this.openDragLock))return;this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),Uu(W=>{let J=this.getAxisMotionValue(W).get()||0;if(rf.test(J)){const{projection:$}=this.visualElement;if($&&$.layout){const ie=$.layout.layoutBox[W];ie&&(J=Hl(ie)*(parseFloat(J)/100))}}this.originPoint[W]=J}),U&&ss.postRender(()=>U(C,I)),dV(this.visualElement,"transform");const{animationState:B}=this.visualElement;B&&B.setActive("whileDrag",!0)},p=(C,I)=>{const{dragPropagation:O,dragDirectionLock:L,onDirectionLock:U,onDrag:B}=this.getProps();if(!O&&!this.openDragLock)return;const{offset:W}=I;if(L&&this.currentDirection===null){this.currentDirection=Ake(W),this.currentDirection!==null&&U&&U(this.currentDirection);return}this.updateAxis("x",I.point,W),this.updateAxis("y",I.point,W),this.visualElement.render(),B&&B(C,I)},_=(C,I)=>this.stop(C,I),E=()=>Uu(C=>{var I;return this.getAnimationState(C)==="paused"&&((I=this.getAxisMotionValue(C).animation)===null||I===void 0?void 0:I.play())}),{dragSnapToOrigin:b}=this.getProps();this.panSession=new kte(e,{onSessionStart:l,onStart:d,onMove:p,onSessionEnd:_,resumeAnimation:E},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:b,contextWindow:Fte(this.visualElement)})}stop(e,i){const o=this.isDragging;if(this.cancel(),!o)return;const{velocity:l}=i;this.startAnimation(l);const{onDragEnd:d}=this.getProps();d&&ss.postRender(()=>d(e,i))}cancel(){this.isDragging=!1;const{projection:e,animationState:i}=this.visualElement;e&&(e.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:o}=this.getProps();!o&&this.openDragLock&&(this.openDragLock(),this.openDragLock=null),i&&i.setActive("whileDrag",!1)}updateAxis(e,i,o){const{drag:l}=this.getProps();if(!o||!OO(e,l,this.currentDirection))return;const d=this.getAxisMotionValue(e);let p=this.originPoint[e]+o[e];this.constraints&&this.constraints[e]&&(p=gke(p,this.constraints[e],this.elastic[e])),d.set(p)}resolveConstraints(){var e;const{dragConstraints:i,dragElastic:o}=this.getProps(),l=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):(e=this.visualElement.projection)===null||e===void 0?void 0:e.layout,d=this.constraints;i&&HS(i)?this.constraints||(this.constraints=this.resolveRefConstraints()):i&&l?this.constraints=_ke(l.layoutBox,i):this.constraints=!1,this.elastic=Ske(o),d!==this.constraints&&l&&this.constraints&&!this.hasMutatedConstraints&&Uu(p=>{this.constraints!==!1&&this.getAxisMotionValue(p)&&(this.constraints[p]=vke(l.layoutBox[p],this.constraints[p]))})}resolveRefConstraints(){const{dragConstraints:e,onMeasureDragConstraints:i}=this.getProps();if(!e||!HS(e))return!1;const o=e.current,{projection:l}=this.visualElement;if(!l||!l.layout)return!1;const d=Cke(o,l.root,this.visualElement.getTransformPagePoint());let p=yke(l.layout.layoutBox,d);if(i){const _=i(bke(p));this.hasMutatedConstraints=!!_,_&&(p=Lte(_))}return p}startAnimation(e){const{drag:i,dragMomentum:o,dragElastic:l,dragTransition:d,dragSnapToOrigin:p,onDragTransitionEnd:_}=this.getProps(),E=this.constraints||{},b=Uu(C=>{if(!OO(C,i,this.currentDirection))return;let I=E&&E[C]||{};p&&(I={min:0,max:0});const O=l?200:1e6,L=l?40:1e7,U={type:"inertia",velocity:o?e[C]:0,bounceStiffness:O,bounceDamping:L,timeConstant:750,restDelta:1,restSpeed:10,...d,...I};return this.startAxisValueAnimation(C,U)});return Promise.all(b).then(_)}startAxisValueAnimation(e,i){const o=this.getAxisMotionValue(e);return dV(this.visualElement,e),o.start(Lj(e,o,0,i,this.visualElement,!1))}stopAnimation(){Uu(e=>this.getAxisMotionValue(e).stop())}pauseAnimation(){Uu(e=>{var i;return(i=this.getAxisMotionValue(e).animation)===null||i===void 0?void 0:i.pause()})}getAnimationState(e){var i;return(i=this.getAxisMotionValue(e).animation)===null||i===void 0?void 0:i.state}getAxisMotionValue(e){const i=`_drag${e.toUpperCase()}`,o=this.visualElement.getProps(),l=o[i];return l||this.visualElement.getValue(e,(o.initial?o.initial[e]:void 0)||0)}snapToCursor(e){Uu(i=>{const{drag:o}=this.getProps();if(!OO(i,o,this.currentDirection))return;const{projection:l}=this.visualElement,d=this.getAxisMotionValue(i);if(l&&l.layout){const{min:p,max:_}=l.layout.layoutBox[i];d.set(e[i]-_s(p,_,.5))}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:e,dragConstraints:i}=this.getProps(),{projection:o}=this.visualElement;if(!HS(i)||!o||!this.constraints)return;this.stopAnimation();const l={x:0,y:0};Uu(p=>{const _=this.getAxisMotionValue(p);if(_&&this.constraints!==!1){const E=_.get();l[p]=Eke({min:E,max:E},this.constraints[p])}});const{transformTemplate:d}=this.visualElement.getProps();this.visualElement.current.style.transform=d?d({},""):"none",o.root&&o.root.updateScroll(),o.updateLayout(),this.resolveConstraints(),Uu(p=>{if(!OO(p,e,null))return;const _=this.getAxisMotionValue(p),{min:E,max:b}=this.constraints[p];_.set(_s(E,b,l[p]))})}addListeners(){if(!this.visualElement.current)return;Rke.set(this.visualElement,this);const e=this.visualElement.current,i=dC(e,"pointerdown",E=>{const{drag:b,dragListener:C=!0}=this.getProps();b&&C&&this.start(E)}),o=()=>{const{dragConstraints:E}=this.getProps();HS(E)&&E.current&&(this.constraints=this.resolveRefConstraints())},{projection:l}=this.visualElement,d=l.addEventListener("measure",o);l&&!l.layout&&(l.root&&l.root.updateScroll(),l.updateLayout()),ss.read(o);const p=xC(window,"resize",()=>this.scalePositionWithinConstraints()),_=l.addEventListener("didUpdate",({delta:E,hasLayoutChanged:b})=>{this.isDragging&&b&&(Uu(C=>{const I=this.getAxisMotionValue(C);I&&(this.originPoint[C]+=E[C].translate,I.set(I.get()+E[C].translate))}),this.visualElement.render())});return()=>{p(),i(),d(),_&&_()}}getProps(){const e=this.visualElement.getProps(),{drag:i=!1,dragDirectionLock:o=!1,dragPropagation:l=!1,dragConstraints:d=!1,dragElastic:p=EV,dragMomentum:_=!0}=e;return{...e,drag:i,dragDirectionLock:o,dragPropagation:l,dragConstraints:d,dragElastic:p,dragMomentum:_}}}function OO(n,e,i){return(e===!0||e===n)&&(i===null||i===n)}function Ake(n,e=10){let i=null;return Math.abs(n.y)>e?i="y":Math.abs(n.x)>e&&(i="x"),i}class Pke extends Wg{constructor(e){super(e),this.removeGroupControls=Gl,this.removeListeners=Gl,this.controls=new Ike(e)}mount(){const{dragControls:e}=this.node.getProps();e&&(this.removeGroupControls=e.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||Gl}unmount(){this.removeGroupControls(),this.removeListeners()}}const fY=n=>(e,i)=>{n&&ss.postRender(()=>n(e,i))};class Oke extends Wg{constructor(){super(...arguments),this.removePointerDownListener=Gl}onPointerDown(e){this.session=new kte(e,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:Fte(this.node)})}createPanHandlers(){const{onPanSessionStart:e,onPanStart:i,onPan:o,onPanEnd:l}=this.node.getProps();return{onSessionStart:fY(e),onStart:fY(i),onMove:o,onEnd:(d,p)=>{delete this.session,l&&ss.postRender(()=>l(d,p))}}}mount(){this.removePointerDownListener=dC(this.node.current,"pointerdown",e=>this.onPointerDown(e))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}const fk={hasAnimatedSinceResize:!0,hasEverUpdated:!1};function pY(n,e){return e.max===e.min?0:n/(e.max-e.min)*100}const Tw={correct:(n,e)=>{if(!e.target)return n;if(typeof n=="string")if(Bn.test(n))n=parseFloat(n);else return n;const i=pY(n,e.target.x),o=pY(n,e.target.y);return`${i}% ${o}%`}},kke={correct:(n,{treeScale:e,projectionDelta:i})=>{const o=n,l=Dg.parse(n);if(l.length>5)return o;const d=Dg.createTransformer(n),p=typeof l[0]!="number"?1:0,_=i.x.scale*e.x,E=i.y.scale*e.y;l[0+p]/=_,l[1+p]/=E;const b=_s(_,E,.5);return typeof l[2+p]=="number"&&(l[2+p]/=b),typeof l[3+p]=="number"&&(l[3+p]/=b),d(l)}};class Nke extends N.Component{componentDidMount(){const{visualElement:e,layoutGroup:i,switchLayoutGroup:o,layoutId:l}=this.props,{projection:d}=e;QAe(Dke),d&&(i.group&&i.group.add(d),o&&o.register&&l&&o.register(d),d.root.didUpdate(),d.addEventListener("animationComplete",()=>{this.safeToRemove()}),d.setOptions({...d.options,onExitComplete:()=>this.safeToRemove()})),fk.hasEverUpdated=!0}getSnapshotBeforeUpdate(e){const{layoutDependency:i,visualElement:o,drag:l,isPresent:d}=this.props,p=o.projection;return p&&(p.isPresent=d,l||e.layoutDependency!==i||i===void 0?p.willUpdate():this.safeToRemove(),e.isPresent!==d&&(d?p.promote():p.relegate()||ss.postRender(()=>{const _=p.getStack();(!_||!_.members.length)&&this.safeToRemove()}))),null}componentDidUpdate(){const{projection:e}=this.props.visualElement;e&&(e.root.didUpdate(),uj.postRender(()=>{!e.currentAnimation&&e.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:e,layoutGroup:i,switchLayoutGroup:o}=this.props,{projection:l}=e;l&&(l.scheduleCheckAfterUnmount(),i&&i.group&&i.group.remove(l),o&&o.deregister&&o.deregister(l))}safeToRemove(){const{safeToRemove:e}=this.props;e&&e()}render(){return null}}function jte(n){const[e,i]=ij(),o=N.useContext(tj);return w.jsx(Nke,{...n,layoutGroup:o,switchLayoutGroup:N.useContext(Oee),isPresent:e,safeToRemove:i})}const Dke={borderRadius:{...Tw,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:Tw,borderTopRightRadius:Tw,borderBottomLeftRadius:Tw,borderBottomRightRadius:Tw,boxShadow:kke};function xke(n,e,i){const o=Za(n)?n:NC(n);return o.start(Lj("",o,e,i)),o.animation}function Lke(n){return n instanceof SVGElement&&n.tagName!=="svg"}const Mke=(n,e)=>n.depth-e.depth;class Uke{constructor(){this.children=[],this.isDirty=!1}add(e){wj(this.children,e),this.isDirty=!0}remove(e){Cj(this.children,e),this.isDirty=!0}forEach(e){this.isDirty&&this.children.sort(Mke),this.isDirty=!1,this.children.forEach(e)}}function Vke(n,e){const i=sf.now(),o=({timestamp:l})=>{const d=l-i;d>=e&&(Ng(o),n(d-e))};return ss.read(o,!0),()=>Ng(o)}const Bte=["TopLeft","TopRight","BottomLeft","BottomRight"],Fke=Bte.length,mY=n=>typeof n=="string"?parseFloat(n):n,gY=n=>typeof n=="number"||Bn.test(n);function jke(n,e,i,o,l,d){l?(n.opacity=_s(0,i.opacity!==void 0?i.opacity:1,Bke(o)),n.opacityExit=_s(e.opacity!==void 0?e.opacity:1,0,Wke(o))):d&&(n.opacity=_s(e.opacity!==void 0?e.opacity:1,i.opacity!==void 0?i.opacity:1,o));for(let p=0;p<Fke;p++){const _=`border${Bte[p]}Radius`;let E=_Y(e,_),b=_Y(i,_);if(E===void 0&&b===void 0)continue;E||(E=0),b||(b=0),E===0||b===0||gY(E)===gY(b)?(n[_]=Math.max(_s(mY(E),mY(b),o),0),(rf.test(b)||rf.test(E))&&(n[_]+="%")):n[_]=b}(e.rotate||i.rotate)&&(n.rotate=_s(e.rotate||0,i.rotate||0,o))}function _Y(n,e){return n[e]!==void 0?n[e]:n.borderRadius}const Bke=Wte(0,.5,ote),Wke=Wte(.5,.95,Gl);function Wte(n,e,i){return o=>o<n?0:o>e?1:i(v0(n,e,o))}function yY(n,e){n.min=e.min,n.max=e.max}function xu(n,e){yY(n.x,e.x),yY(n.y,e.y)}function EY(n,e){n.translate=e.translate,n.scale=e.scale,n.originPoint=e.originPoint,n.origin=e.origin}function vY(n,e,i,o,l){return n-=e,n=Yk(n,1/i,o),l!==void 0&&(n=Yk(n,1/l,o)),n}function zke(n,e=0,i=1,o=.5,l,d=n,p=n){if(rf.test(e)&&(e=parseFloat(e),e=_s(p.min,p.max,e/100)-p.min),typeof e!="number")return;let _=_s(d.min,d.max,o);n===d&&(_-=e),n.min=vY(n.min,e,i,_,l),n.max=vY(n.max,e,i,_,l)}function SY(n,e,[i,o,l],d,p){zke(n,e[i],e[o],e[l],e.scale,d,p)}const Gke=["x","scaleX","originX"],Hke=["y","scaleY","originY"];function bY(n,e,i,o){SY(n.x,e,Gke,i?i.x:void 0,o?o.x:void 0),SY(n.y,e,Hke,i?i.y:void 0,o?o.y:void 0)}function TY(n){return n.translate===0&&n.scale===1}function zte(n){return TY(n.x)&&TY(n.y)}function wY(n,e){return n.min===e.min&&n.max===e.max}function $ke(n,e){return wY(n.x,e.x)&&wY(n.y,e.y)}function CY(n,e){return Math.round(n.min)===Math.round(e.min)&&Math.round(n.max)===Math.round(e.max)}function Gte(n,e){return CY(n.x,e.x)&&CY(n.y,e.y)}function RY(n){return Hl(n.x)/Hl(n.y)}function IY(n,e){return n.translate===e.translate&&n.scale===e.scale&&n.originPoint===e.originPoint}class Kke{constructor(){this.members=[]}add(e){wj(this.members,e),e.scheduleRender()}remove(e){if(Cj(this.members,e),e===this.prevLead&&(this.prevLead=void 0),e===this.lead){const i=this.members[this.members.length-1];i&&this.promote(i)}}relegate(e){const i=this.members.findIndex(l=>e===l);if(i===0)return!1;let o;for(let l=i;l>=0;l--){const d=this.members[l];if(d.isPresent!==!1){o=d;break}}return o?(this.promote(o),!0):!1}promote(e,i){const o=this.lead;if(e!==o&&(this.prevLead=o,this.lead=e,e.show(),o)){o.instance&&o.scheduleRender(),e.scheduleRender(),e.resumeFrom=o,i&&(e.resumeFrom.preserveOpacity=!0),o.snapshot&&(e.snapshot=o.snapshot,e.snapshot.latestValues=o.animationValues||o.latestValues),e.root&&e.root.isUpdating&&(e.isLayoutDirty=!0);const{crossfade:l}=e.options;l===!1&&o.hide()}}exitAnimationComplete(){this.members.forEach(e=>{const{options:i,resumingFrom:o}=e;i.onExitComplete&&i.onExitComplete(),o&&o.options.onExitComplete&&o.options.onExitComplete()})}scheduleRender(){this.members.forEach(e=>{e.instance&&e.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}function qke(n,e,i){let o="";const l=n.x.translate/e.x,d=n.y.translate/e.y,p=(i==null?void 0:i.z)||0;if((l||d||p)&&(o=`translate3d(${l}px, ${d}px, ${p}px) `),(e.x!==1||e.y!==1)&&(o+=`scale(${1/e.x}, ${1/e.y}) `),i){const{transformPerspective:b,rotate:C,rotateX:I,rotateY:O,skewX:L,skewY:U}=i;b&&(o=`perspective(${b}px) ${o}`),C&&(o+=`rotate(${C}deg) `),I&&(o+=`rotateX(${I}deg) `),O&&(o+=`rotateY(${O}deg) `),L&&(o+=`skewX(${L}deg) `),U&&(o+=`skewY(${U}deg) `)}const _=n.x.scale*e.x,E=n.y.scale*e.y;return(_!==1||E!==1)&&(o+=`scale(${_}, ${E})`),o||"none"}const yy={type:"projectionFrame",totalNodes:0,resolvedTargetDeltas:0,recalculatedProjection:0},qw=typeof window<"u"&&window.MotionDebug!==void 0,tU=["","X","Y","Z"],Yke={visibility:"hidden"},AY=1e3;let Xke=0;function nU(n,e,i,o){const{latestValues:l}=e;l[n]&&(i[n]=l[n],e.setStaticValue(n,0),o&&(o[n]=0))}function Hte(n){if(n.hasCheckedOptimisedAppear=!0,n.root===n)return;const{visualElement:e}=n.options;if(!e)return;const i=Zee(e);if(window.MotionHasOptimisedAnimation(i,"transform")){const{layout:l,layoutId:d}=n.options;window.MotionCancelOptimisedAnimation(i,"transform",ss,!(l||d))}const{parent:o}=n;o&&!o.hasCheckedOptimisedAppear&&Hte(o)}function $te({attachResizeListener:n,defaultParent:e,measureScroll:i,checkIsScrollRoot:o,resetTransform:l}){return class{constructor(p={},_=e==null?void 0:e()){this.id=Xke++,this.animationId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.hasCheckedOptimisedAppear=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.updateScheduled=!1,this.scheduleUpdate=()=>this.update(),this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,qw&&(yy.totalNodes=yy.resolvedTargetDeltas=yy.recalculatedProjection=0),this.nodes.forEach(Zke),this.nodes.forEach(i1e),this.nodes.forEach(s1e),this.nodes.forEach(e1e),qw&&window.MotionDebug.record(yy)},this.resolvedRelativeTargetAt=0,this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=p,this.root=_?_.root||_:this,this.path=_?[..._.path,_]:[],this.parent=_,this.depth=_?_.depth+1:0;for(let E=0;E<this.path.length;E++)this.path[E].shouldResetTransform=!0;this.root===this&&(this.nodes=new Uke)}addEventListener(p,_){return this.eventHandlers.has(p)||this.eventHandlers.set(p,new Rj),this.eventHandlers.get(p).add(_)}notifyListeners(p,..._){const E=this.eventHandlers.get(p);E&&E.notify(..._)}hasListeners(p){return this.eventHandlers.has(p)}mount(p,_=this.root.hasTreeAnimated){if(this.instance)return;this.isSVG=Lke(p),this.instance=p;const{layoutId:E,layout:b,visualElement:C}=this.options;if(C&&!C.current&&C.mount(p),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),_&&(b||E)&&(this.isLayoutDirty=!0),n){let I;const O=()=>this.root.updateBlockedByResize=!1;n(p,()=>{this.root.updateBlockedByResize=!0,I&&I(),I=Vke(O,250),fk.hasAnimatedSinceResize&&(fk.hasAnimatedSinceResize=!1,this.nodes.forEach(OY))})}E&&this.root.registerSharedNode(E,this),this.options.animate!==!1&&C&&(E||b)&&this.addEventListener("didUpdate",({delta:I,hasLayoutChanged:O,hasRelativeTargetChanged:L,layout:U})=>{if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}const B=this.options.transition||C.getDefaultTransition()||u1e,{onLayoutAnimationStart:W,onLayoutAnimationComplete:J}=C.getProps(),$=!this.targetLayout||!Gte(this.targetLayout,U)||L,ie=!O&&L;if(this.options.layoutRoot||this.resumeFrom&&this.resumeFrom.instance||ie||O&&($||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0),this.setAnimationOrigin(I,ie);const ce={...vj(B,"layout"),onPlay:W,onComplete:J};(C.shouldReduceMotion||this.options.layoutRoot)&&(ce.delay=0,ce.type=!1),this.startAnimation(ce)}else O||OY(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=U})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const p=this.getStack();p&&p.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,Ng(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(o1e),this.animationId++)}getTransformTemplate(){const{visualElement:p}=this.options;return p&&p.getProps().transformTemplate}willUpdate(p=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked()){this.options.onExitComplete&&this.options.onExitComplete();return}if(window.MotionCancelOptimisedAnimation&&!this.hasCheckedOptimisedAppear&&Hte(this),!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let C=0;C<this.path.length;C++){const I=this.path[C];I.shouldResetTransform=!0,I.updateScroll("snapshot"),I.options.layoutRoot&&I.willUpdate(!1)}const{layoutId:_,layout:E}=this.options;if(_===void 0&&!E)return;const b=this.getTransformTemplate();this.prevTransformTemplateValue=b?b(this.latestValues,""):void 0,this.updateSnapshot(),p&&this.notifyListeners("willUpdate")}update(){if(this.updateScheduled=!1,this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach(PY);return}this.isUpdating||this.nodes.forEach(n1e),this.isUpdating=!1,this.nodes.forEach(r1e),this.nodes.forEach(Jke),this.nodes.forEach(Qke),this.clearAllSnapshots();const _=sf.now();va.delta=Gp(0,1e3/60,_-va.timestamp),va.timestamp=_,va.isProcessing=!0,KM.update.process(va),KM.preRender.process(va),KM.render.process(va),va.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,uj.read(this.scheduleUpdate))}clearAllSnapshots(){this.nodes.forEach(t1e),this.sharedNodes.forEach(a1e)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,ss.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){ss.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){this.snapshot||!this.instance||(this.snapshot=this.measure())}updateLayout(){if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let E=0;E<this.path.length;E++)this.path[E].updateScroll();const p=this.layout;this.layout=this.measure(!1),this.layoutCorrected=Gs(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:_}=this.options;_&&_.notify("LayoutMeasure",this.layout.layoutBox,p?p.layoutBox:void 0)}updateScroll(p="measure"){let _=!!(this.options.layoutScroll&&this.instance);if(this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===p&&(_=!1),_){const E=o(this.instance);this.scroll={animationId:this.root.animationId,phase:p,isRoot:E,offset:i(this.instance),wasRoot:this.scroll?this.scroll.isRoot:E}}}resetTransform(){if(!l)return;const p=this.isLayoutDirty||this.shouldResetTransform||this.options.alwaysMeasureLayout,_=this.projectionDelta&&!zte(this.projectionDelta),E=this.getTransformTemplate(),b=E?E(this.latestValues,""):void 0,C=b!==this.prevTransformTemplateValue;p&&(_||_y(this.latestValues)||C)&&(l(this.instance,b),this.shouldResetTransform=!1,this.scheduleRender())}measure(p=!0){const _=this.measurePageBox();let E=this.removeElementScroll(_);return p&&(E=this.removeTransform(E)),d1e(E),{animationId:this.root.animationId,measuredBox:_,layoutBox:E,latestValues:{},source:this.id}}measurePageBox(){var p;const{visualElement:_}=this.options;if(!_)return Gs();const E=_.measureViewportBox();if(!(((p=this.scroll)===null||p===void 0?void 0:p.wasRoot)||this.path.some(h1e))){const{scroll:C}=this.root;C&&(qS(E.x,C.offset.x),qS(E.y,C.offset.y))}return E}removeElementScroll(p){var _;const E=Gs();if(xu(E,p),!((_=this.scroll)===null||_===void 0)&&_.wasRoot)return E;for(let b=0;b<this.path.length;b++){const C=this.path[b],{scroll:I,options:O}=C;C!==this.root&&I&&O.layoutScroll&&(I.wasRoot&&xu(E,p),qS(E.x,I.offset.x),qS(E.y,I.offset.y))}return E}applyTransform(p,_=!1){const E=Gs();xu(E,p);for(let b=0;b<this.path.length;b++){const C=this.path[b];!_&&C.options.layoutScroll&&C.scroll&&C!==C.root&&YS(E,{x:-C.scroll.offset.x,y:-C.scroll.offset.y}),_y(C.latestValues)&&YS(E,C.latestValues)}return _y(this.latestValues)&&YS(E,this.latestValues),E}removeTransform(p){const _=Gs();xu(_,p);for(let E=0;E<this.path.length;E++){const b=this.path[E];if(!b.instance||!_y(b.latestValues))continue;vV(b.latestValues)&&b.updateSnapshot();const C=Gs(),I=b.measurePageBox();xu(C,I),bY(_,b.latestValues,b.snapshot?b.snapshot.layoutBox:void 0,C)}return _y(this.latestValues)&&bY(_,this.latestValues),_}setTargetDelta(p){this.targetDelta=p,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(p){this.options={...this.options,...p,crossfade:p.crossfade!==void 0?p.crossfade:!0}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==va.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(p=!1){var _;const E=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=E.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=E.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=E.isSharedProjectionDirty);const b=!!this.resumingFrom||this!==E;if(!(p||b&&this.isSharedProjectionDirty||this.isProjectionDirty||!((_=this.parent)===null||_===void 0)&&_.isProjectionDirty||this.attemptToResolveRelativeTarget||this.root.updateBlockedByResize))return;const{layout:I,layoutId:O}=this.options;if(!(!this.layout||!(I||O))){if(this.resolvedRelativeTargetAt=va.timestamp,!this.targetDelta&&!this.relativeTarget){const L=this.getClosestProjectingParent();L&&L.layout&&this.animationProgress!==1?(this.relativeParent=L,this.forceRelativeParentToResolveTarget(),this.relativeTarget=Gs(),this.relativeTargetOrigin=Gs(),fC(this.relativeTargetOrigin,this.layout.layoutBox,L.layout.layoutBox),xu(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}if(!(!this.relativeTarget&&!this.targetDelta)){if(this.target||(this.target=Gs(),this.targetWithTransforms=Gs()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),mke(this.target,this.relativeTarget,this.relativeParent.target)):this.targetDelta?(this.resumingFrom?this.target=this.applyTransform(this.layout.layoutBox):xu(this.target,this.layout.layoutBox),Ute(this.target,this.targetDelta)):xu(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget){this.attemptToResolveRelativeTarget=!1;const L=this.getClosestProjectingParent();L&&!!L.resumingFrom==!!this.resumingFrom&&!L.options.layoutScroll&&L.target&&this.animationProgress!==1?(this.relativeParent=L,this.forceRelativeParentToResolveTarget(),this.relativeTarget=Gs(),this.relativeTargetOrigin=Gs(),fC(this.relativeTargetOrigin,this.target,L.target),xu(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}qw&&yy.resolvedTargetDeltas++}}}getClosestProjectingParent(){if(!(!this.parent||vV(this.parent.latestValues)||Mte(this.parent.latestValues)))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return!!((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}calcProjection(){var p;const _=this.getLead(),E=!!this.resumingFrom||this!==_;let b=!0;if((this.isProjectionDirty||!((p=this.parent)===null||p===void 0)&&p.isProjectionDirty)&&(b=!1),E&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(b=!1),this.resolvedRelativeTargetAt===va.timestamp&&(b=!1),b)return;const{layout:C,layoutId:I}=this.options;if(this.isTreeAnimating=!!(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!(C||I))return;xu(this.layoutCorrected,this.layout.layoutBox);const O=this.treeScale.x,L=this.treeScale.y;wke(this.layoutCorrected,this.treeScale,this.path,E),_.layout&&!_.target&&(this.treeScale.x!==1||this.treeScale.y!==1)&&(_.target=_.layout.layoutBox,_.targetWithTransforms=Gs());const{target:U}=_;if(!U){this.prevProjectionDelta&&(this.createProjectionDeltas(),this.scheduleRender());return}!this.projectionDelta||!this.prevProjectionDelta?this.createProjectionDeltas():(EY(this.prevProjectionDelta.x,this.projectionDelta.x),EY(this.prevProjectionDelta.y,this.projectionDelta.y)),hC(this.projectionDelta,this.layoutCorrected,U,this.latestValues),(this.treeScale.x!==O||this.treeScale.y!==L||!IY(this.projectionDelta.x,this.prevProjectionDelta.x)||!IY(this.projectionDelta.y,this.prevProjectionDelta.y))&&(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",U)),qw&&yy.recalculatedProjection++}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(p=!0){var _;if((_=this.options.visualElement)===null||_===void 0||_.scheduleRender(),p){const E=this.getStack();E&&E.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}createProjectionDeltas(){this.prevProjectionDelta=KS(),this.projectionDelta=KS(),this.projectionDeltaWithTransform=KS()}setAnimationOrigin(p,_=!1){const E=this.snapshot,b=E?E.latestValues:{},C={...this.latestValues},I=KS();(!this.relativeParent||!this.relativeParent.options.layoutRoot)&&(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!_;const O=Gs(),L=E?E.source:void 0,U=this.layout?this.layout.source:void 0,B=L!==U,W=this.getStack(),J=!W||W.members.length<=1,$=!!(B&&!J&&this.options.crossfade===!0&&!this.path.some(l1e));this.animationProgress=0;let ie;this.mixTargetDelta=ce=>{const ne=ce/1e3;kY(I.x,p.x,ne),kY(I.y,p.y,ne),this.setTargetDelta(I),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(fC(O,this.layout.layoutBox,this.relativeParent.layout.layoutBox),c1e(this.relativeTarget,this.relativeTargetOrigin,O,ne),ie&&$ke(this.relativeTarget,ie)&&(this.isProjectionDirty=!1),ie||(ie=Gs()),xu(ie,this.relativeTarget)),B&&(this.animationValues=C,jke(C,b,this.latestValues,ne,$,J)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=ne},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(p){this.notifyListeners("animationStart"),this.currentAnimation&&this.currentAnimation.stop(),this.resumingFrom&&this.resumingFrom.currentAnimation&&this.resumingFrom.currentAnimation.stop(),this.pendingAnimation&&(Ng(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=ss.update(()=>{fk.hasAnimatedSinceResize=!0,this.currentAnimation=xke(0,AY,{...p,onUpdate:_=>{this.mixTargetDelta(_),p.onUpdate&&p.onUpdate(_)},onComplete:()=>{p.onComplete&&p.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const p=this.getStack();p&&p.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(AY),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const p=this.getLead();let{targetWithTransforms:_,target:E,layout:b,latestValues:C}=p;if(!(!_||!E||!b)){if(this!==p&&this.layout&&b&&Kte(this.options.animationType,this.layout.layoutBox,b.layoutBox)){E=this.target||Gs();const I=Hl(this.layout.layoutBox.x);E.x.min=p.target.x.min,E.x.max=E.x.min+I;const O=Hl(this.layout.layoutBox.y);E.y.min=p.target.y.min,E.y.max=E.y.min+O}xu(_,E),YS(_,C),hC(this.projectionDeltaWithTransform,this.layoutCorrected,_,C)}}registerSharedNode(p,_){this.sharedNodes.has(p)||this.sharedNodes.set(p,new Kke),this.sharedNodes.get(p).add(_);const b=_.options.initialPromotionConfig;_.promote({transition:b?b.transition:void 0,preserveFollowOpacity:b&&b.shouldPreserveFollowOpacity?b.shouldPreserveFollowOpacity(_):void 0})}isLead(){const p=this.getStack();return p?p.lead===this:!0}getLead(){var p;const{layoutId:_}=this.options;return _?((p=this.getStack())===null||p===void 0?void 0:p.lead)||this:this}getPrevLead(){var p;const{layoutId:_}=this.options;return _?(p=this.getStack())===null||p===void 0?void 0:p.prevLead:void 0}getStack(){const{layoutId:p}=this.options;if(p)return this.root.sharedNodes.get(p)}promote({needsReset:p,transition:_,preserveFollowOpacity:E}={}){const b=this.getStack();b&&b.promote(this,E),p&&(this.projectionDelta=void 0,this.needsReset=!0),_&&this.setOptions({transition:_})}relegate(){const p=this.getStack();return p?p.relegate(this):!1}resetSkewAndRotation(){const{visualElement:p}=this.options;if(!p)return;let _=!1;const{latestValues:E}=p;if((E.z||E.rotate||E.rotateX||E.rotateY||E.rotateZ||E.skewX||E.skewY)&&(_=!0),!_)return;const b={};E.z&&nU("z",p,b,this.animationValues);for(let C=0;C<tU.length;C++)nU(`rotate${tU[C]}`,p,b,this.animationValues),nU(`skew${tU[C]}`,p,b,this.animationValues);p.render();for(const C in b)p.setStaticValue(C,b[C]),this.animationValues&&(this.animationValues[C]=b[C]);p.scheduleRender()}getProjectionStyles(p){var _,E;if(!this.instance||this.isSVG)return;if(!this.isVisible)return Yke;const b={visibility:""},C=this.getTransformTemplate();if(this.needsReset)return this.needsReset=!1,b.opacity="",b.pointerEvents=dk(p==null?void 0:p.pointerEvents)||"",b.transform=C?C(this.latestValues,""):"none",b;const I=this.getLead();if(!this.projectionDelta||!this.layout||!I.target){const B={};return this.options.layoutId&&(B.opacity=this.latestValues.opacity!==void 0?this.latestValues.opacity:1,B.pointerEvents=dk(p==null?void 0:p.pointerEvents)||""),this.hasProjected&&!_y(this.latestValues)&&(B.transform=C?C({},""):"none",this.hasProjected=!1),B}const O=I.animationValues||I.latestValues;this.applyTransformsToTarget(),b.transform=qke(this.projectionDeltaWithTransform,this.treeScale,O),C&&(b.transform=C(O,b.transform));const{x:L,y:U}=this.projectionDelta;b.transformOrigin=`${L.origin*100}% ${U.origin*100}% 0`,I.animationValues?b.opacity=I===this?(E=(_=O.opacity)!==null&&_!==void 0?_:this.latestValues.opacity)!==null&&E!==void 0?E:1:this.preserveOpacity?this.latestValues.opacity:O.opacityExit:b.opacity=I===this?O.opacity!==void 0?O.opacity:"":O.opacityExit!==void 0?O.opacityExit:0;for(const B in Gk){if(O[B]===void 0)continue;const{correct:W,applyTo:J}=Gk[B],$=b.transform==="none"?O[B]:W(O[B],I);if(J){const ie=J.length;for(let ce=0;ce<ie;ce++)b[J[ce]]=$}else b[B]=$}return this.options.layoutId&&(b.pointerEvents=I===this?dk(p==null?void 0:p.pointerEvents)||"":"none"),b}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(p=>{var _;return(_=p.currentAnimation)===null||_===void 0?void 0:_.stop()}),this.root.nodes.forEach(PY),this.root.sharedNodes.clear()}}}function Jke(n){n.updateLayout()}function Qke(n){var e;const i=((e=n.resumeFrom)===null||e===void 0?void 0:e.snapshot)||n.snapshot;if(n.isLead()&&n.layout&&i&&n.hasListeners("didUpdate")){const{layoutBox:o,measuredBox:l}=n.layout,{animationType:d}=n.options,p=i.source!==n.layout.source;d==="size"?Uu(I=>{const O=p?i.measuredBox[I]:i.layoutBox[I],L=Hl(O);O.min=o[I].min,O.max=O.min+L}):Kte(d,i.layoutBox,o)&&Uu(I=>{const O=p?i.measuredBox[I]:i.layoutBox[I],L=Hl(o[I]);O.max=O.min+L,n.relativeTarget&&!n.currentAnimation&&(n.isProjectionDirty=!0,n.relativeTarget[I].max=n.relativeTarget[I].min+L)});const _=KS();hC(_,o,i.layoutBox);const E=KS();p?hC(E,n.applyTransform(l,!0),i.measuredBox):hC(E,o,i.layoutBox);const b=!zte(_);let C=!1;if(!n.resumeFrom){const I=n.getClosestProjectingParent();if(I&&!I.resumeFrom){const{snapshot:O,layout:L}=I;if(O&&L){const U=Gs();fC(U,i.layoutBox,O.layoutBox);const B=Gs();fC(B,o,L.layoutBox),Gte(U,B)||(C=!0),I.options.layoutRoot&&(n.relativeTarget=B,n.relativeTargetOrigin=U,n.relativeParent=I)}}}n.notifyListeners("didUpdate",{layout:o,snapshot:i,delta:E,layoutDelta:_,hasLayoutChanged:b,hasRelativeTargetChanged:C})}else if(n.isLead()){const{onExitComplete:o}=n.options;o&&o()}n.options.transition=void 0}function Zke(n){qw&&yy.totalNodes++,n.parent&&(n.isProjecting()||(n.isProjectionDirty=n.parent.isProjectionDirty),n.isSharedProjectionDirty||(n.isSharedProjectionDirty=!!(n.isProjectionDirty||n.parent.isProjectionDirty||n.parent.isSharedProjectionDirty)),n.isTransformDirty||(n.isTransformDirty=n.parent.isTransformDirty))}function e1e(n){n.isProjectionDirty=n.isSharedProjectionDirty=n.isTransformDirty=!1}function t1e(n){n.clearSnapshot()}function PY(n){n.clearMeasurements()}function n1e(n){n.isLayoutDirty=!1}function r1e(n){const{visualElement:e}=n.options;e&&e.getProps().onBeforeLayoutMeasure&&e.notify("BeforeLayoutMeasure"),n.resetTransform()}function OY(n){n.finishAnimation(),n.targetDelta=n.relativeTarget=n.target=void 0,n.isProjectionDirty=!0}function i1e(n){n.resolveTargetDelta()}function s1e(n){n.calcProjection()}function o1e(n){n.resetSkewAndRotation()}function a1e(n){n.removeLeadSnapshot()}function kY(n,e,i){n.translate=_s(e.translate,0,i),n.scale=_s(e.scale,1,i),n.origin=e.origin,n.originPoint=e.originPoint}function NY(n,e,i,o){n.min=_s(e.min,i.min,o),n.max=_s(e.max,i.max,o)}function c1e(n,e,i,o){NY(n.x,e.x,i.x,o),NY(n.y,e.y,i.y,o)}function l1e(n){return n.animationValues&&n.animationValues.opacityExit!==void 0}const u1e={duration:.45,ease:[.4,0,.1,1]},DY=n=>typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(n),xY=DY("applewebkit/")&&!DY("chrome/")?Math.round:Gl;function LY(n){n.min=xY(n.min),n.max=xY(n.max)}function d1e(n){LY(n.x),LY(n.y)}function Kte(n,e,i){return n==="position"||n==="preserve-aspect"&&!pke(RY(e),RY(i),.2)}function h1e(n){var e;return n!==n.root&&((e=n.scroll)===null||e===void 0?void 0:e.wasRoot)}const f1e=$te({attachResizeListener:(n,e)=>xC(n,"resize",e),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),rU={current:void 0},qte=$te({measureScroll:n=>({x:n.scrollLeft,y:n.scrollTop}),defaultParent:()=>{if(!rU.current){const n=new f1e({});n.mount(window),n.setOptions({layoutScroll:!0}),rU.current=n}return rU.current},resetTransform:(n,e)=>{n.style.transform=e!==void 0?e:"none"},checkIsScrollRoot:n=>window.getComputedStyle(n).position==="fixed"}),p1e={pan:{Feature:Oke},drag:{Feature:Pke,ProjectionNode:qte,MeasureLayout:jte}};function MY(n,e,i){const{props:o}=n;n.animationState&&o.whileHover&&n.animationState.setActive("whileHover",i==="Start");const l="onHover"+i,d=o[l];d&&ss.postRender(()=>d(e,lR(e)))}class m1e extends Wg{mount(){const{current:e}=this.node;e&&(this.unmount=pPe(e,i=>(MY(this.node,i,"Start"),o=>MY(this.node,o,"End"))))}unmount(){}}class g1e extends Wg{constructor(){super(...arguments),this.isActive=!1}onFocus(){let e=!1;try{e=this.node.current.matches(":focus-visible")}catch{e=!0}!e||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){!this.isActive||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=cR(xC(this.node.current,"focus",()=>this.onFocus()),xC(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}function UY(n,e,i){const{props:o}=n;n.animationState&&o.whileTap&&n.animationState.setActive("whileTap",i==="Start");const l="onTap"+(i==="End"?"":i),d=o[l];d&&ss.postRender(()=>d(e,lR(e)))}class _1e extends Wg{mount(){const{current:e}=this.node;e&&(this.unmount=yPe(e,i=>(UY(this.node,i,"Start"),(o,{success:l})=>UY(this.node,o,l?"End":"Cancel")),{useGlobalTarget:this.node.props.globalTapTarget}))}unmount(){}}const bV=new WeakMap,iU=new WeakMap,y1e=n=>{const e=bV.get(n.target);e&&e(n)},E1e=n=>{n.forEach(y1e)};function v1e({root:n,...e}){const i=n||document;iU.has(i)||iU.set(i,{});const o=iU.get(i),l=JSON.stringify(e);return o[l]||(o[l]=new IntersectionObserver(E1e,{root:n,...e})),o[l]}function S1e(n,e,i){const o=v1e(e);return bV.set(n,i),o.observe(n),()=>{bV.delete(n),o.unobserve(n)}}const b1e={some:0,all:1};class T1e extends Wg{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:e={}}=this.node.getProps(),{root:i,margin:o,amount:l="some",once:d}=e,p={root:i?i.current:void 0,rootMargin:o,threshold:typeof l=="number"?l:b1e[l]},_=E=>{const{isIntersecting:b}=E;if(this.isInView===b||(this.isInView=b,d&&!b&&this.hasEnteredView))return;b&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",b);const{onViewportEnter:C,onViewportLeave:I}=this.node.getProps(),O=b?C:I;O&&O(E)};return S1e(this.node.current,p,_)}mount(){this.startObserver()}update(){if(typeof IntersectionObserver>"u")return;const{props:e,prevProps:i}=this.node;["amount","margin","root"].some(w1e(e,i))&&this.startObserver()}unmount(){}}function w1e({viewport:n={}},{viewport:e={}}={}){return i=>n[i]!==e[i]}const C1e={inView:{Feature:T1e},tap:{Feature:_1e},focus:{Feature:g1e},hover:{Feature:m1e}},R1e={layout:{ProjectionNode:qte,MeasureLayout:jte}},TV={current:null},Yte={current:!1};function I1e(){if(Yte.current=!0,!!sj)if(window.matchMedia){const n=window.matchMedia("(prefers-reduced-motion)"),e=()=>TV.current=n.matches;n.addListener(e),e()}else TV.current=!1}const A1e=[...vte,Xa,Dg],P1e=n=>A1e.find(Ete(n)),VY=new WeakMap;function O1e(n,e,i){for(const o in e){const l=e[o],d=i[o];if(Za(l))n.addValue(o,l);else if(Za(d))n.addValue(o,NC(l,{owner:n}));else if(d!==l)if(n.hasValue(o)){const p=n.getValue(o);p.liveStyle===!0?p.jump(l):p.hasAnimated||p.set(l)}else{const p=n.getStaticValue(o);n.addValue(o,NC(p!==void 0?p:l,{owner:n}))}}for(const o in i)e[o]===void 0&&n.removeValue(o);return e}const FY=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"];class k1e{scrapeMotionValuesFromProps(e,i,o){return{}}constructor({parent:e,props:i,presenceContext:o,reducedMotionConfig:l,blockInitialAnimation:d,visualState:p},_={}){this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.KeyframeResolver=Nj,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.renderScheduledAt=0,this.scheduleRender=()=>{const L=sf.now();this.renderScheduledAt<L&&(this.renderScheduledAt=L,ss.render(this.render,!1,!0))};const{latestValues:E,renderState:b,onUpdate:C}=p;this.onUpdate=C,this.latestValues=E,this.baseTarget={...E},this.initialValues=i.initial?{...E}:{},this.renderState=b,this.parent=e,this.props=i,this.presenceContext=o,this.depth=e?e.depth+1:0,this.reducedMotionConfig=l,this.options=_,this.blockInitialAnimation=!!d,this.isControllingVariants=G1(i),this.isVariantNode=Aee(i),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=!!(e&&e.current);const{willChange:I,...O}=this.scrapeMotionValuesFromProps(i,{},this);for(const L in O){const U=O[L];E[L]!==void 0&&Za(U)&&U.set(E[L],!1)}}mount(e){this.current=e,VY.set(e,this),this.projection&&!this.projection.instance&&this.projection.mount(e),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((i,o)=>this.bindToMotionValue(o,i)),Yte.current||I1e(),this.shouldReduceMotion=this.reducedMotionConfig==="never"?!1:this.reducedMotionConfig==="always"?!0:TV.current,this.parent&&this.parent.children.add(this),this.update(this.props,this.presenceContext)}unmount(){VY.delete(this.current),this.projection&&this.projection.unmount(),Ng(this.notifyUpdate),Ng(this.render),this.valueSubscriptions.forEach(e=>e()),this.valueSubscriptions.clear(),this.removeFromVariantTree&&this.removeFromVariantTree(),this.parent&&this.parent.children.delete(this);for(const e in this.events)this.events[e].clear();for(const e in this.features){const i=this.features[e];i&&(i.unmount(),i.isMounted=!1)}this.current=null}bindToMotionValue(e,i){this.valueSubscriptions.has(e)&&this.valueSubscriptions.get(e)();const o=rE.has(e),l=i.on("change",_=>{this.latestValues[e]=_,this.props.onUpdate&&ss.preRender(this.notifyUpdate),o&&this.projection&&(this.projection.isTransformDirty=!0)}),d=i.on("renderRequest",this.scheduleRender);let p;window.MotionCheckAppearSync&&(p=window.MotionCheckAppearSync(this,e,i)),this.valueSubscriptions.set(e,()=>{l(),d(),p&&p(),i.owner&&i.stop()})}sortNodePosition(e){return!this.current||!this.sortInstanceNodePosition||this.type!==e.type?0:this.sortInstanceNodePosition(this.current,e.current)}updateFeatures(){let e="animation";for(e in S0){const i=S0[e];if(!i)continue;const{isEnabled:o,Feature:l}=i;if(!this.features[e]&&l&&o(this.props)&&(this.features[e]=new l(this)),this.features[e]){const d=this.features[e];d.isMounted?d.update():(d.mount(),d.isMounted=!0)}}}triggerBuild(){this.build(this.renderState,this.latestValues,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):Gs()}getStaticValue(e){return this.latestValues[e]}setStaticValue(e,i){this.latestValues[e]=i}update(e,i){(e.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=e,this.prevPresenceContext=this.presenceContext,this.presenceContext=i;for(let o=0;o<FY.length;o++){const l=FY[o];this.propEventSubscriptions[l]&&(this.propEventSubscriptions[l](),delete this.propEventSubscriptions[l]);const d="on"+l,p=e[d];p&&(this.propEventSubscriptions[l]=this.on(l,p))}this.prevMotionValues=O1e(this,this.scrapeMotionValuesFromProps(e,this.prevProps,this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue(),this.onUpdate&&this.onUpdate(this)}getProps(){return this.props}getVariant(e){return this.props.variants?this.props.variants[e]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}addVariantChild(e){const i=this.getClosestVariantNode();if(i)return i.variantChildren&&i.variantChildren.add(e),()=>i.variantChildren.delete(e)}addValue(e,i){const o=this.values.get(e);i!==o&&(o&&this.removeValue(e),this.bindToMotionValue(e,i),this.values.set(e,i),this.latestValues[e]=i.get())}removeValue(e){this.values.delete(e);const i=this.valueSubscriptions.get(e);i&&(i(),this.valueSubscriptions.delete(e)),delete this.latestValues[e],this.removeValueFromRenderState(e,this.renderState)}hasValue(e){return this.values.has(e)}getValue(e,i){if(this.props.values&&this.props.values[e])return this.props.values[e];let o=this.values.get(e);return o===void 0&&i!==void 0&&(o=NC(i===null?void 0:i,{owner:this}),this.addValue(e,o)),o}readValue(e,i){var o;let l=this.latestValues[e]!==void 0||!this.current?this.latestValues[e]:(o=this.getBaseTargetFromProps(this.props,e))!==null&&o!==void 0?o:this.readValueFromInstance(this.current,e,this.options);return l!=null&&(typeof l=="string"&&(_te(l)||cte(l))?l=parseFloat(l):!P1e(l)&&Dg.test(i)&&(l=pte(e,i)),this.setBaseTarget(e,Za(l)?l.get():l)),Za(l)?l.get():l}setBaseTarget(e,i){this.baseTarget[e]=i}getBaseTarget(e){var i;const{initial:o}=this.props;let l;if(typeof o=="string"||typeof o=="object"){const p=hj(this.props,o,(i=this.presenceContext)===null||i===void 0?void 0:i.custom);p&&(l=p[e])}if(o&&l!==void 0)return l;const d=this.getBaseTargetFromProps(this.props,e);return d!==void 0&&!Za(d)?d:this.initialValues[e]!==void 0&&l===void 0?void 0:this.baseTarget[e]}on(e,i){return this.events[e]||(this.events[e]=new Rj),this.events[e].add(i)}notify(e,...i){this.events[e]&&this.events[e].notify(...i)}}class Xte extends k1e{constructor(){super(...arguments),this.KeyframeResolver=Ste}sortInstanceNodePosition(e,i){return e.compareDocumentPosition(i)&2?1:-1}getBaseTargetFromProps(e,i){return e.style?e.style[i]:void 0}removeValueFromRenderState(e,{vars:i,style:o}){delete i[e],delete o[e]}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:e}=this.props;Za(e)&&(this.childSubscription=e.on("change",i=>{this.current&&(this.current.textContent=`${i}`)}))}}function N1e(n){return window.getComputedStyle(n)}class D1e extends Xte{constructor(){super(...arguments),this.type="html",this.renderInstance=Uee}readValueFromInstance(e,i){if(rE.has(i)){const o=kj(i);return o&&o.default||0}else{const o=N1e(e),l=(xee(i)?o.getPropertyValue(i):o[i])||0;return typeof l=="string"?l.trim():l}}measureInstanceViewportBox(e,{transformPagePoint:i}){return Vte(e,i)}build(e,i,o){mj(e,i,o.transformTemplate)}scrapeMotionValuesFromProps(e,i,o){return Ej(e,i,o)}}class x1e extends Xte{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1,this.measureInstanceViewportBox=Gs}getBaseTargetFromProps(e,i){return e[i]}readValueFromInstance(e,i){if(rE.has(i)){const o=kj(i);return o&&o.default||0}return i=Vee.has(i)?i:lj(i),e.getAttribute(i)}scrapeMotionValuesFromProps(e,i,o){return Bee(e,i,o)}build(e,i,o){gj(e,i,this.isSVGTag,o.transformTemplate)}renderInstance(e,i,o,l){Fee(e,i,o,l)}mount(e){this.isSVGTag=yj(e.tagName),super.mount(e)}}const L1e=(n,e)=>dj(n)?new x1e(e):new D1e(e,{allowProjection:n!==N.Fragment}),M1e=aPe({...ske,...C1e,...p1e,...R1e},L1e),_f=bAe(M1e),U1e=(n,e)=>n.find(i=>i.id===e);function jY(n,e){const i=Jte(n,e),o=i?n[i].findIndex(l=>l.id===e):-1;return{position:i,index:o}}function Jte(n,e){for(const[i,o]of Object.entries(n))if(U1e(o,e))return i}function V1e(n){const e=n.includes("right"),i=n.includes("left");let o="center";return e&&(o="flex-end"),i&&(o="flex-start"),{display:"flex",flexDirection:"column",alignItems:o}}function F1e(n){const i=n==="top"||n==="bottom"?"0 auto":void 0,o=n.includes("top")?"env(safe-area-inset-top, 0px)":void 0,l=n.includes("bottom")?"env(safe-area-inset-bottom, 0px)":void 0,d=n.includes("left")?void 0:"env(safe-area-inset-right, 0px)",p=n.includes("right")?void 0:"env(safe-area-inset-left, 0px)";return{position:"fixed",zIndex:"var(--toast-z-index, 5500)",pointerEvents:"none",display:"flex",flexDirection:"column",margin:i,top:o,bottom:l,right:d,left:p}}var j1e=/^((children|dangerouslySetInnerHTML|key|ref|autoFocus|defaultValue|defaultChecked|innerHTML|suppressContentEditableWarning|suppressHydrationWarning|valueLink|abbr|accept|acceptCharset|accessKey|action|allow|allowUserMedia|allowPaymentRequest|allowFullScreen|allowTransparency|alt|async|autoComplete|autoPlay|capture|cellPadding|cellSpacing|challenge|charSet|checked|cite|classID|className|cols|colSpan|content|contentEditable|contextMenu|controls|controlsList|coords|crossOrigin|data|dateTime|decoding|default|defer|dir|disabled|disablePictureInPicture|disableRemotePlayback|download|draggable|encType|enterKeyHint|fetchpriority|fetchPriority|form|formAction|formEncType|formMethod|formNoValidate|formTarget|frameBorder|headers|height|hidden|high|href|hrefLang|htmlFor|httpEquiv|id|inputMode|integrity|is|keyParams|keyType|kind|label|lang|list|loading|loop|low|marginHeight|marginWidth|max|maxLength|media|mediaGroup|method|min|minLength|multiple|muted|name|nonce|noValidate|open|optimum|pattern|placeholder|playsInline|poster|preload|profile|radioGroup|readOnly|referrerPolicy|rel|required|reversed|role|rows|rowSpan|sandbox|scope|scoped|scrolling|seamless|selected|shape|size|sizes|slot|span|spellCheck|src|srcDoc|srcLang|srcSet|start|step|style|summary|tabIndex|target|title|translate|type|useMap|value|width|wmode|wrap|about|datatype|inlist|prefix|property|resource|typeof|vocab|autoCapitalize|autoCorrect|autoSave|color|incremental|fallback|inert|itemProp|itemScope|itemType|itemID|itemRef|on|option|results|security|unselectable|accentHeight|accumulate|additive|alignmentBaseline|allowReorder|alphabetic|amplitude|arabicForm|ascent|attributeName|attributeType|autoReverse|azimuth|baseFrequency|baselineShift|baseProfile|bbox|begin|bias|by|calcMode|capHeight|clip|clipPathUnits|clipPath|clipRule|colorInterpolation|colorInterpolationFilters|colorProfile|colorRendering|contentScriptType|contentStyleType|cursor|cx|cy|d|decelerate|descent|diffuseConstant|direction|display|divisor|dominantBaseline|dur|dx|dy|edgeMode|elevation|enableBackground|end|exponent|externalResourcesRequired|fill|fillOpacity|fillRule|filter|filterRes|filterUnits|floodColor|floodOpacity|focusable|fontFamily|fontSize|fontSizeAdjust|fontStretch|fontStyle|fontVariant|fontWeight|format|from|fr|fx|fy|g1|g2|glyphName|glyphOrientationHorizontal|glyphOrientationVertical|glyphRef|gradientTransform|gradientUnits|hanging|horizAdvX|horizOriginX|ideographic|imageRendering|in|in2|intercept|k|k1|k2|k3|k4|kernelMatrix|kernelUnitLength|kerning|keyPoints|keySplines|keyTimes|lengthAdjust|letterSpacing|lightingColor|limitingConeAngle|local|markerEnd|markerMid|markerStart|markerHeight|markerUnits|markerWidth|mask|maskContentUnits|maskUnits|mathematical|mode|numOctaves|offset|opacity|operator|order|orient|orientation|origin|overflow|overlinePosition|overlineThickness|panose1|paintOrder|pathLength|patternContentUnits|patternTransform|patternUnits|pointerEvents|points|pointsAtX|pointsAtY|pointsAtZ|preserveAlpha|preserveAspectRatio|primitiveUnits|r|radius|refX|refY|renderingIntent|repeatCount|repeatDur|requiredExtensions|requiredFeatures|restart|result|rotate|rx|ry|scale|seed|shapeRendering|slope|spacing|specularConstant|specularExponent|speed|spreadMethod|startOffset|stdDeviation|stemh|stemv|stitchTiles|stopColor|stopOpacity|strikethroughPosition|strikethroughThickness|string|stroke|strokeDasharray|strokeDashoffset|strokeLinecap|strokeLinejoin|strokeMiterlimit|strokeOpacity|strokeWidth|surfaceScale|systemLanguage|tableValues|targetX|targetY|textAnchor|textDecoration|textRendering|textLength|to|transform|u1|u2|underlinePosition|underlineThickness|unicode|unicodeBidi|unicodeRange|unitsPerEm|vAlphabetic|vHanging|vIdeographic|vMathematical|values|vectorEffect|version|vertAdvY|vertOriginX|vertOriginY|viewBox|viewTarget|visibility|widths|wordSpacing|writingMode|x|xHeight|x1|x2|xChannelSelector|xlinkActuate|xlinkArcrole|xlinkHref|xlinkRole|xlinkShow|xlinkTitle|xlinkType|xmlBase|xmlns|xmlnsXlink|xmlLang|xmlSpace|y|y1|y2|yChannelSelector|z|zoomAndPan|for|class|autofocus)|(([Dd][Aa][Tt][Aa]|[Aa][Rr][Ii][Aa]|x)-.*))$/,B1e=fee(function(n){return j1e.test(n)||n.charCodeAt(0)===111&&n.charCodeAt(1)===110&&n.charCodeAt(2)<91}),W1e=B1e,z1e=function(e){return e!=="theme"},BY=function(e){return typeof e=="string"&&e.charCodeAt(0)>96?W1e:z1e},WY=function(e,i,o){var l;if(i){var d=i.shouldForwardProp;l=e.__emotion_forwardProp&&d?function(p){return e.__emotion_forwardProp(p)&&d(p)}:d}return typeof l!="function"&&o&&(l=e.__emotion_forwardProp),l},G1e=function(e){var i=e.cache,o=e.serialized,l=e.isStringTag;return KF(i,o,l),yee(function(){return qF(i,o,l)}),null},H1e=function n(e,i){var o=e.__emotion_real===e,l=o&&e.__emotion_base||e,d,p;i!==void 0&&(d=i.label,p=i.target);var _=WY(e,i,o),E=_||BY(l),b=!E("as");return function(){var C=arguments,I=o&&e.__emotion_styles!==void 0?e.__emotion_styles.slice(0):[];if(d!==void 0&&I.push("label:"+d+";"),C[0]==null||C[0].raw===void 0)I.push.apply(I,C);else{var O=C[0];I.push(O[0]);for(var L=C.length,U=1;U<L;U++)I.push(C[U],O[U])}var B=XF(function(W,J,$){var ie=b&&W.as||l,ce="",ne=[],de=W;if(W.theme==null){de={};for(var Q in W)de[Q]=W[Q];de.theme=N.useContext(E0)}typeof W.className=="string"?ce=mee(J.registered,ne,W.className):W.className!=null&&(ce=W.className+" ");var Z=F1(I.concat(ne),J.registered,de);ce+=J.key+"-"+Z.name,p!==void 0&&(ce+=" "+p);var X=b&&_===void 0?BY(ie):E,re={};for(var pe in W)b&&pe==="as"||X(pe)&&(re[pe]=W[pe]);return re.className=ce,$&&(re.ref=$),N.createElement(N.Fragment,null,N.createElement(G1e,{cache:J,serialized:Z,isStringTag:typeof ie=="string"}),N.createElement(ie,re))});return B.displayName=d!==void 0?d:"Styled("+(typeof l=="string"?l:l.displayName||l.name||"Component")+")",B.defaultProps=e.defaultProps,B.__emotion_real=B,B.__emotion_base=l,B.__emotion_styles=I,B.__emotion_forwardProp=_,Object.defineProperty(B,"toString",{value:function(){return"."+p}}),B.withComponent=function(W,J){var $=n(W,zy({},i,J,{shouldForwardProp:WY(B,J,!0)}));return $.apply(void 0,I)},B}},$1e=["a","abbr","address","area","article","aside","audio","b","base","bdi","bdo","big","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","data","datalist","dd","del","details","dfn","dialog","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","iframe","img","input","ins","kbd","keygen","label","legend","li","link","main","map","mark","marquee","menu","menuitem","meta","meter","nav","noscript","object","ol","optgroup","option","output","p","param","picture","pre","progress","q","rp","rt","ruby","s","samp","script","section","select","small","source","span","strong","style","sub","summary","sup","table","tbody","td","textarea","tfoot","th","thead","time","title","tr","track","u","ul","var","video","wbr","circle","clipPath","defs","ellipse","foreignObject","g","image","line","linearGradient","mask","path","pattern","polygon","polyline","radialGradient","rect","stop","svg","text","tspan"],wV=H1e.bind(null);$1e.forEach(function(n){wV[n]=wV(n)});const K1e=new Set([...hSe,"textStyle","layerStyle","apply","noOfLines","focusBorderColor","errorBorderColor","as","__css","css","sx"]),q1e=new Set(["htmlWidth","htmlHeight","htmlSize","htmlTranslate"]);function Y1e(n){return(q1e.has(n)||!K1e.has(n))&&n[0]!=="_"}const X1e=jEe(wV),J1e=({baseStyle:n})=>e=>{const{theme:i,css:o,__css:l,sx:d,...p}=e,[_]=KEe(p,pSe),E=ul(n,e),b=REe({},l,E,O1(_),d),C=$Z(b)(e.theme);return o?[C,o]:C};function sU(n,e){const{baseStyle:i,...o}=e??{};o.shouldForwardProp||(o.shouldForwardProp=Y1e);const l=J1e({baseStyle:i}),d=X1e(n,o)(l);return N.forwardRef(function(E,b){const{children:C,...I}=E,{colorMode:O,forced:L}=B1(),U=L?O:void 0;return N.createElement(d,{ref:b,"data-theme":U,...I},C)})}function Q1e(){const n=new Map;return new Proxy(sU,{apply(e,i,o){return sU(...o)},get(e,i){return n.has(i)||n.set(i,sU(i)),n.get(i)}})}const Nt=Q1e(),Z1e={initial:n=>{const{position:e}=n,i=["top","bottom"].includes(e)?"y":"x";let o=["top-right","bottom-right"].includes(e)?1:-1;return e==="bottom"&&(o=1),{opacity:0,[i]:o*24}},animate:{opacity:1,y:0,x:0,scale:1,transition:{duration:.4,ease:[.4,0,.2,1]}},exit:{opacity:0,scale:.85,transition:{duration:.2,ease:[.4,0,1,1]}}},Qte=N.memo(n=>{const{id:e,message:i,onCloseComplete:o,onRequestRemove:l,requestClose:d=!1,position:p="bottom",duration:_=5e3,containerStyle:E,motionVariants:b=Z1e,toastSpacing:C="0.5rem"}=n,[I,O]=N.useState(_),L=fAe();Wp(()=>{L||o==null||o()},[L]),Wp(()=>{O(_)},[_]);const U=()=>O(null),B=()=>O(_),W=()=>{L&&l()};N.useEffect(()=>{L&&d&&l()},[L,d,l]),gve(W,I);const J=N.useMemo(()=>({pointerEvents:"auto",maxWidth:560,minWidth:300,margin:C,...E}),[E,C]),$=N.useMemo(()=>V1e(p),[p]);return w.jsx(_f.div,{layout:!0,className:"chakra-toast",variants:b,initial:"initial",animate:"animate",exit:"exit",onHoverStart:U,onHoverEnd:B,custom:{position:p},style:$,children:w.jsx(Nt.div,{role:"status","aria-atomic":"true",className:"chakra-toast__inner",__css:J,children:ul(i,{id:e,onClose:W})})})});Qte.displayName="ToastComponent";function Bt(n){return N.forwardRef(n)}var oU,zY;function eNe(){if(zY)return oU;zY=1;var n=typeof Element<"u",e=typeof Map=="function",i=typeof Set=="function",o=typeof ArrayBuffer=="function"&&!!ArrayBuffer.isView;function l(d,p){if(d===p)return!0;if(d&&p&&typeof d=="object"&&typeof p=="object"){if(d.constructor!==p.constructor)return!1;var _,E,b;if(Array.isArray(d)){if(_=d.length,_!=p.length)return!1;for(E=_;E--!==0;)if(!l(d[E],p[E]))return!1;return!0}var C;if(e&&d instanceof Map&&p instanceof Map){if(d.size!==p.size)return!1;for(C=d.entries();!(E=C.next()).done;)if(!p.has(E.value[0]))return!1;for(C=d.entries();!(E=C.next()).done;)if(!l(E.value[1],p.get(E.value[0])))return!1;return!0}if(i&&d instanceof Set&&p instanceof Set){if(d.size!==p.size)return!1;for(C=d.entries();!(E=C.next()).done;)if(!p.has(E.value[0]))return!1;return!0}if(o&&ArrayBuffer.isView(d)&&ArrayBuffer.isView(p)){if(_=d.length,_!=p.length)return!1;for(E=_;E--!==0;)if(d[E]!==p[E])return!1;return!0}if(d.constructor===RegExp)return d.source===p.source&&d.flags===p.flags;if(d.valueOf!==Object.prototype.valueOf&&typeof d.valueOf=="function"&&typeof p.valueOf=="function")return d.valueOf()===p.valueOf();if(d.toString!==Object.prototype.toString&&typeof d.toString=="function"&&typeof p.toString=="function")return d.toString()===p.toString();if(b=Object.keys(d),_=b.length,_!==Object.keys(p).length)return!1;for(E=_;E--!==0;)if(!Object.prototype.hasOwnProperty.call(p,b[E]))return!1;if(n&&d instanceof Element)return!1;for(E=_;E--!==0;)if(!((b[E]==="_owner"||b[E]==="__v"||b[E]==="__o")&&d.$$typeof)&&!l(d[b[E]],p[b[E]]))return!1;return!0}return d!==d&&p!==p}return oU=function(p,_){try{return l(p,_)}catch(E){if((E.message||"").match(/stack|recursion/i))return console.warn("react-fast-compare cannot handle circular refs"),!1;throw E}},oU}var tNe=eNe();const nNe=Bg(tNe);function K0(){const n=N.useContext(E0);if(!n)throw Error("useTheme: `theme` is undefined. Seems you forgot to wrap your app in `<ChakraProvider />` or `<ThemeProvider />`");return n}function Zte(){const n=B1(),e=K0();return{...n,theme:e}}function rNe(n,e,i){if(e==null)return e;const o=l=>{var d,p;return(p=(d=n.__cssMap)==null?void 0:d[l])==null?void 0:p.value};return o(e)??o(i)??i}function iNe(n,e,i){const o=Array.isArray(e)?e:[e],l=Array.isArray(i)?i:[i];return d=>{const p=l.filter(Boolean),_=o.map((E,b)=>{const C=`${n}.${E}`;return rNe(d,C,p[b]??E)});return Array.isArray(e)?_:_[0]}}function ene(n,e={}){const{styleConfig:i,...o}=e,{theme:l,colorMode:d}=Zte(),p=n?AZ(l,`components.${n}`):void 0,_=i||p,E=Xh({theme:l,colorMode:d},(_==null?void 0:_.defaultProps)??{},O1(W0(o,["children"])),(C,I)=>C?void 0:I),b=N.useRef({});if(_){const I=CSe(_)(E);nNe(b.current,I)||(b.current=I)}return b.current}function ql(n,e={}){return ene(n,e)}function rc(n,e={}){return ene(n,e)}const GY={path:w.jsxs("g",{stroke:"currentColor",strokeWidth:"1.5",children:[w.jsx("path",{strokeLinecap:"round",fill:"none",d:"M9,9a3,3,0,1,1,4,2.829,1.5,1.5,0,0,0-1,1.415V14.25"}),w.jsx("path",{fill:"currentColor",strokeLinecap:"round",d:"M12,17.25a.375.375,0,1,0,.375.375A.375.375,0,0,0,12,17.25h0"}),w.jsx("circle",{fill:"none",strokeMiterlimit:"10",cx:"12",cy:"12",r:"11.25"})]}),viewBox:"0 0 24 24"},En=Bt((n,e)=>{const{as:i,viewBox:o,color:l="currentColor",focusable:d=!1,children:p,className:_,__css:E,...b}=n,C=dn("chakra-icon",_),I=ql("Icon",n),O={w:"1em",h:"1em",display:"inline-block",lineHeight:"1em",flexShrink:0,color:l,...E,...I},L={ref:e,focusable:d,className:C,__css:O},U=o??GY.viewBox;if(i&&typeof i!="string")return w.jsx(Nt.svg,{as:i,...L,...b});const B=p??GY.path;return w.jsx(Nt.svg,{verticalAlign:"middle",viewBox:U,...L,...b,children:B})});En.displayName="Icon";function sNe(n){return w.jsx(En,{viewBox:"0 0 24 24",...n,children:w.jsx("path",{fill:"currentColor",d:"M12,0A12,12,0,1,0,24,12,12.014,12.014,0,0,0,12,0Zm6.927,8.2-6.845,9.289a1.011,1.011,0,0,1-1.43.188L5.764,13.769a1,1,0,1,1,1.25-1.562l4.076,3.261,6.227-8.451A1,1,0,1,1,18.927,8.2Z"})})}function oNe(n){return w.jsx(En,{viewBox:"0 0 24 24",...n,children:w.jsx("path",{fill:"currentColor",d:"M12,0A12,12,0,1,0,24,12,12.013,12.013,0,0,0,12,0Zm.25,5a1.5,1.5,0,1,1-1.5,1.5A1.5,1.5,0,0,1,12.25,5ZM14.5,18.5h-4a1,1,0,0,1,0-2h.75a.25.25,0,0,0,.25-.25v-4.5a.25.25,0,0,0-.25-.25H10.5a1,1,0,0,1,0-2h1a2,2,0,0,1,2,2v4.75a.25.25,0,0,0,.25.25h.75a1,1,0,1,1,0,2Z"})})}function HY(n){return w.jsx(En,{viewBox:"0 0 24 24",...n,children:w.jsx("path",{fill:"currentColor",d:"M11.983,0a12.206,12.206,0,0,0-8.51,3.653A11.8,11.8,0,0,0,0,12.207,11.779,11.779,0,0,0,11.8,24h.214A12.111,12.111,0,0,0,24,11.791h0A11.766,11.766,0,0,0,11.983,0ZM10.5,16.542a1.476,1.476,0,0,1,1.449-1.53h.027a1.527,1.527,0,0,1,1.523,1.47,1.475,1.475,0,0,1-1.449,1.53h-.027A1.529,1.529,0,0,1,10.5,16.542ZM11,12.5v-6a1,1,0,0,1,2,0v6a1,1,0,1,1-2,0Z"})})}const aNe=iR({"0%":{transform:"rotate(0deg)"},"100%":{transform:"rotate(360deg)"}}),zd=Bt((n,e)=>{const i=ql("Spinner",n),{label:o="Loading...",thickness:l="2px",speed:d="0.45s",emptyColor:p="transparent",className:_,...E}=Wi(n),b=dn("chakra-spinner",_),C={display:"inline-block",borderColor:"currentColor",borderStyle:"solid",borderRadius:"99999px",borderWidth:l,borderBottomColor:p,borderLeftColor:p,animation:`${aNe} ${d} linear infinite`,...i};return w.jsx(Nt.div,{ref:e,__css:C,className:b,...E,children:o&&w.jsx(Nt.span,{srOnly:!0,children:o})})});zd.displayName="Spinner";const[cNe,Mj]=xi({name:"AlertContext",hookName:"useAlertContext",providerName:"<Alert />"}),[lNe,Uj]=xi({name:"AlertStylesContext",hookName:"useAlertStyles",providerName:"<Alert />"}),tne={info:{icon:oNe,colorScheme:"blue"},warning:{icon:HY,colorScheme:"orange"},success:{icon:sNe,colorScheme:"green"},error:{icon:HY,colorScheme:"red"},loading:{icon:zd,colorScheme:"blue"}};function uNe(n){return tne[n].colorScheme}function dNe(n){return tne[n].icon}const Ip=Bt(function(e,i){const{status:o="info",addRole:l=!0,...d}=Wi(e),p=e.colorScheme??uNe(o),_=rc("Alert",{...e,colorScheme:p}),E={width:"100%",display:"flex",alignItems:"center",position:"relative",overflow:"hidden",..._.container};return w.jsx(cNe,{value:{status:o},children:w.jsx(lNe,{value:_,children:w.jsx(Nt.div,{"data-status":o,role:l?"alert":void 0,ref:i,...d,className:dn("chakra-alert",e.className),__css:E})})})});Ip.displayName="Alert";function Ap(n){const{status:e}=Mj(),i=dNe(e),o=Uj(),l=e==="loading"?o.spinner:o.icon;return w.jsx(Nt.span,{display:"inherit","data-status":e,...n,className:dn("chakra-alert__icon",n.className),__css:l,children:n.children||w.jsx(i,{h:"100%",w:"100%"})})}Ap.displayName="AlertIcon";const XS=Bt(function(e,i){const o=Uj(),{status:l}=Mj();return w.jsx(Nt.div,{ref:i,"data-status":l,...e,className:dn("chakra-alert__title",e.className),__css:o.title})});XS.displayName="AlertTitle";const JS=Bt(function(e,i){const{status:o}=Mj(),l=Uj(),d={display:"inline",...l.description};return w.jsx(Nt.div,{ref:i,"data-status":o,...e,className:dn("chakra-alert__desc",e.className),__css:d})});JS.displayName="AlertDescription";function hNe(n){return w.jsx(En,{focusable:"false","aria-hidden":!0,...n,children:w.jsx("path",{fill:"currentColor",d:"M.439,21.44a1.5,1.5,0,0,0,2.122,2.121L11.823,14.3a.25.25,0,0,1,.354,0l9.262,9.263a1.5,1.5,0,1,0,2.122-2.121L14.3,12.177a.25.25,0,0,1,0-.354l9.263-9.262A1.5,1.5,0,0,0,21.439.44L12.177,9.7a.25.25,0,0,1-.354,0L2.561.44A1.5,1.5,0,0,0,.439,2.561L9.7,11.823a.25.25,0,0,1,0,.354Z"})})}const Vj=Bt(function(e,i){const o=ql("CloseButton",e),{children:l,isDisabled:d,__css:p,..._}=Wi(e),E={outline:0,display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0};return w.jsx(Nt.button,{type:"button","aria-label":"Close",ref:i,disabled:d,__css:{...E,...o,...p},..._,children:l||w.jsx(hNe,{width:"1em",height:"1em"})})});Vj.displayName="CloseButton";const fNe=n=>{const{status:e,variant:i="solid",id:o,title:l,isClosable:d,onClose:p,description:_,colorScheme:E,icon:b}=n,C=o?{root:`toast-${o}`,title:`toast-${o}-title`,description:`toast-${o}-description`}:void 0;return w.jsxs(Ip,{addRole:!1,status:e,variant:i,id:C==null?void 0:C.root,alignItems:"start",borderRadius:"md",boxShadow:"lg",paddingEnd:8,textAlign:"start",width:"auto",colorScheme:E,children:[w.jsx(Ap,{children:b}),w.jsxs(Nt.div,{flex:"1",maxWidth:"100%",children:[l&&w.jsx(XS,{id:C==null?void 0:C.title,children:l}),_&&w.jsx(JS,{id:C==null?void 0:C.description,display:"block",children:_})]}),d&&w.jsx(Vj,{size:"sm",onClick:p,position:"absolute",insetEnd:1,top:1})]})};function nne(n={}){const{render:e,toastComponent:i=fNe}=n;return l=>typeof e=="function"?e({...l,...n}):w.jsx(i,{...l,...n})}const pNe={top:[],"top-left":[],"top-right":[],"bottom-left":[],bottom:[],"bottom-right":[]},Kh=mNe(pNe);function mNe(n){let e=n;const i=new Set,o=l=>{e=l(e),i.forEach(d=>d())};return{getState:()=>e,subscribe:l=>(i.add(l),()=>{o(()=>n),i.delete(l)}),removeToast:(l,d)=>{o(p=>({...p,[d]:p[d].filter(_=>_.id!=l)}))},notify:(l,d)=>{const p=gNe(l,d),{position:_,id:E}=p;return o(b=>{const I=_.includes("top")?[p,...b[_]??[]]:[...b[_]??[],p];return{...b,[_]:I}}),E},update:(l,d)=>{l&&o(p=>{const _={...p},{position:E,index:b}=jY(_,l);return E&&b!==-1&&(_[E][b]={..._[E][b],...d,message:nne(d)}),_})},closeAll:({positions:l}={})=>{o(d=>(l??["bottom","bottom-right","bottom-left","top","top-left","top-right"]).reduce((E,b)=>(E[b]=d[b].map(C=>({...C,requestClose:!0})),E),{...d}))},close:l=>{o(d=>{const p=Jte(d,l);return p?{...d,[p]:d[p].map(_=>_.id==l?{..._,requestClose:!0}:_)}:d})},isActive:l=>!!jY(Kh.getState(),l).position}}let $Y=0;function gNe(n,e={}){$Y+=1;const i=e.id??$Y,o=e.position??"bottom";return{id:i,message:n,position:o,duration:e.duration,onCloseComplete:e.onCloseComplete,onRequestRemove:()=>Kh.removeToast(String(i),o),status:e.status,requestClose:!1,containerStyle:e.containerStyle}}var rne=EZ();const[ine,_Ne]=xi({strict:!1,name:"PortalContext"}),Fj="chakra-portal",yNe=".chakra-portal",ENe=n=>w.jsx("div",{className:"chakra-portal-zIndex",style:{position:"absolute",zIndex:n.zIndex,top:0,left:0,right:0},children:n.children}),vNe=n=>{const{appendToParentPortal:e,children:i}=n,[o,l]=N.useState(null),d=N.useRef(null),[,p]=N.useState({});N.useEffect(()=>p({}),[]);const _=_Ne(),E=oAe();ef(()=>{if(!o)return;const C=o.ownerDocument,I=e?_??C.body:C.body;if(!I)return;d.current=C.createElement("div"),d.current.className=Fj,I.appendChild(d.current),p({});const O=d.current;return()=>{I.contains(O)&&I.removeChild(O)}},[o]);const b=E!=null&&E.zIndex?w.jsx(ENe,{zIndex:E==null?void 0:E.zIndex,children:i}):i;return d.current?rne.createPortal(w.jsx(ine,{value:d.current,children:b}),d.current):w.jsx("span",{ref:C=>{C&&l(C)}})},SNe=n=>{const{children:e,containerRef:i,appendToParentPortal:o}=n,l=i.current,d=l??(typeof window<"u"?document.body:void 0),p=N.useMemo(()=>{const E=l==null?void 0:l.ownerDocument.createElement("div");return E&&(E.className=Fj),E},[l]),[,_]=N.useState({});return ef(()=>_({}),[]),ef(()=>{if(!(!p||!d))return d.appendChild(p),()=>{d.removeChild(p)}},[p,d]),d&&p?rne.createPortal(w.jsx(ine,{value:o?p:null,children:e}),p):null};function Yl(n){const e={appendToParentPortal:!0,...n},{containerRef:i,...o}=e;return i?w.jsx(SNe,{containerRef:i,...o}):w.jsx(vNe,{...o})}Yl.className=Fj;Yl.selector=yNe;Yl.displayName="Portal";const[bNe,TNe]=xi({name:"ToastOptionsContext",strict:!1}),wNe=n=>{const e=N.useSyncExternalStore(Kh.subscribe,Kh.getState,Kh.getState),{motionVariants:i,component:o=Qte,portalProps:l,animatePresenceProps:d}=n,_=Object.keys(e).map(E=>{const b=e[E];return w.jsx("div",{role:"region","aria-live":"polite","aria-label":`Notifications-${E}`,id:`chakra-toast-manager-${E}`,style:F1e(E),children:w.jsx(G0,{...d,initial:!1,children:b.map(C=>w.jsx(o,{motionVariants:i,...C},C.id))})},E)});return w.jsx(Yl,{...l,children:_})},CNe=n=>function({children:i,theme:o=n,toastOptions:l,...d}){return w.jsxs(cAe,{theme:o,...d,children:[w.jsx(bNe,{value:l==null?void 0:l.defaultOptions,children:i}),w.jsx(wNe,{...l})]})},K1=CNe(JRe);function KY(n){return n.sort((e,i)=>{const o=e.compareDocumentPosition(i);if(o&Node.DOCUMENT_POSITION_FOLLOWING||o&Node.DOCUMENT_POSITION_CONTAINED_BY)return-1;if(o&Node.DOCUMENT_POSITION_PRECEDING||o&Node.DOCUMENT_POSITION_CONTAINS)return 1;if(o&Node.DOCUMENT_POSITION_DISCONNECTED||o&Node.DOCUMENT_POSITION_IMPLEMENTATION_SPECIFIC)throw Error("Cannot sort the given nodes.");return 0})}const RNe=n=>typeof n=="object"&&"nodeType"in n&&n.nodeType===Node.ELEMENT_NODE;function qY(n,e,i){let o=n+1;return i&&o>=e&&(o=0),o}function YY(n,e,i){let o=n-1;return i&&o<0&&(o=e),o}const aU=typeof window<"u"?N.useLayoutEffect:N.useEffect,XY=n=>n;var INe=Object.defineProperty,ANe=(n,e,i)=>e in n?INe(n,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):n[e]=i,xs=(n,e,i)=>(ANe(n,typeof e!="symbol"?e+"":e,i),i);class PNe{constructor(){xs(this,"descendants",new Map),xs(this,"register",e=>{if(e!=null)return RNe(e)?this.registerNode(e):i=>{this.registerNode(i,e)}}),xs(this,"unregister",e=>{this.descendants.delete(e);const i=KY(Array.from(this.descendants.keys()));this.assignIndex(i)}),xs(this,"destroy",()=>{this.descendants.clear()}),xs(this,"assignIndex",e=>{this.descendants.forEach(i=>{const o=e.indexOf(i.node);i.index=o,i.node.dataset.index=i.index.toString()})}),xs(this,"count",()=>this.descendants.size),xs(this,"enabledCount",()=>this.enabledValues().length),xs(this,"values",()=>Array.from(this.descendants.values()).sort((i,o)=>i.index-o.index)),xs(this,"enabledValues",()=>this.values().filter(e=>!e.disabled)),xs(this,"item",e=>{if(this.count()!==0)return this.values()[e]}),xs(this,"enabledItem",e=>{if(this.enabledCount()!==0)return this.enabledValues()[e]}),xs(this,"first",()=>this.item(0)),xs(this,"firstEnabled",()=>this.enabledItem(0)),xs(this,"last",()=>this.item(this.descendants.size-1)),xs(this,"lastEnabled",()=>{const e=this.enabledValues().length-1;return this.enabledItem(e)}),xs(this,"indexOf",e=>{var i;return e?((i=this.descendants.get(e))==null?void 0:i.index)??-1:-1}),xs(this,"enabledIndexOf",e=>e==null?-1:this.enabledValues().findIndex(i=>i.node.isSameNode(e))),xs(this,"next",(e,i=!0)=>{const o=qY(e,this.count(),i);return this.item(o)}),xs(this,"nextEnabled",(e,i=!0)=>{const o=this.item(e);if(!o)return;const l=this.enabledIndexOf(o.node),d=qY(l,this.enabledCount(),i);return this.enabledItem(d)}),xs(this,"prev",(e,i=!0)=>{const o=YY(e,this.count()-1,i);return this.item(o)}),xs(this,"prevEnabled",(e,i=!0)=>{const o=this.item(e);if(!o)return;const l=this.enabledIndexOf(o.node),d=YY(l,this.enabledCount()-1,i);return this.enabledItem(d)}),xs(this,"registerNode",(e,i)=>{if(!e||this.descendants.has(e))return;const o=Array.from(this.descendants.keys()).concat(e),l=KY(o);i!=null&&i.disabled&&(i.disabled=!!i.disabled);const d={node:e,index:-1,...i};this.descendants.set(e,d),this.assignIndex(l)})}}function sne(){const[n,e]=xi({name:"DescendantsProvider",errorMessage:"useDescendantsContext must be used within DescendantsProvider"});return[n,e,()=>{const l=N.useRef(new PNe);return aU(()=>()=>l.current.destroy()),l.current},l=>{const d=e(),[p,_]=N.useState(-1),E=N.useRef(null);aU(()=>()=>{E.current&&d.unregister(E.current)},[]),aU(()=>{if(!E.current)return;const C=Number(E.current.dataset.index);p!=C&&!Number.isNaN(C)&&_(C)});const b=XY(l?d.register(l):d.register);return{descendants:d,index:p,enabledIndex:d.enabledIndexOf(E.current),register:Bi(b,E)}}]}const JY={easeIn:[.4,0,1,1],easeOut:[0,0,.2,1]},Ly={enter:{duration:.2,ease:JY.easeOut},exit:{duration:.1,ease:JY.easeIn}},My={enter:(n,e)=>({...n,delay:typeof e=="number"?e:e==null?void 0:e.enter}),exit:(n,e)=>({...n,delay:typeof e=="number"?e:e==null?void 0:e.exit})},one=Bt(function(n,e){const{ratio:i=4/3,children:o,className:l,...d}=n,p=N.Children.only(o),_=dn("chakra-aspect-ratio",l);return w.jsx(Nt.div,{ref:e,position:"relative",className:_,_before:{height:0,content:'""',display:"block",paddingBottom:k1(i,E=>`${1/E*100}%`)},__css:{"& > *:not(style)":{overflow:"hidden",position:"absolute",top:"0",right:"0",bottom:"0",left:"0",display:"flex",justifyContent:"center",alignItems:"center",width:"100%",height:"100%"},"& > img, & > video":{objectFit:"cover"}},...d,children:p})});one.displayName="AspectRatio";const[ONe,kNe]=xi({name:"AvatarStylesContext",hookName:"useAvatarStyles",providerName:"<Avatar/>"});function NNe(n){const e=n.trim().split(" "),i=e[0]??"",o=e.length>1?e[e.length-1]:"";return i&&o?`${i.charAt(0)}${o.charAt(0)}`:i.charAt(0)}function ane(n){const{name:e,getInitials:i,...o}=n,l=kNe();return w.jsx(Nt.div,{role:"img","aria-label":e,...o,__css:l.label,children:e?i==null?void 0:i(e):null})}ane.displayName="AvatarName";const cne=n=>w.jsxs(Nt.svg,{viewBox:"0 0 128 128",color:"#fff",width:"100%",height:"100%",className:"chakra-avatar__svg",...n,children:[w.jsx("path",{fill:"currentColor",d:"M103,102.1388 C93.094,111.92 79.3504,118 64.1638,118 C48.8056,118 34.9294,111.768 25,101.7892 L25,95.2 C25,86.8096 31.981,80 40.6,80 L87.4,80 C96.019,80 103,86.8096 103,95.2 L103,102.1388 Z"}),w.jsx("path",{fill:"currentColor",d:"M63.9961647,24 C51.2938136,24 41,34.2938136 41,46.9961647 C41,59.7061864 51.2938136,70 63.9961647,70 C76.6985159,70 87,59.7061864 87,46.9961647 C87,34.2938136 76.6985159,24 63.9961647,24"})]});function lne(n){const{loading:e,src:i,srcSet:o,onLoad:l,onError:d,crossOrigin:p,sizes:_,ignoreFallback:E}=n,[b,C]=N.useState("pending");N.useEffect(()=>{C(i?"loading":"pending")},[i]);const I=N.useRef(null),O=N.useCallback(()=>{if(!i)return;L();const U=new Image;U.src=i,p&&(U.crossOrigin=p),o&&(U.srcset=o),_&&(U.sizes=_),e&&(U.loading=e),U.onload=B=>{L(),C("loaded"),l==null||l(B)},U.onerror=B=>{L(),C("failed"),d==null||d(B)},I.current=U},[i,p,o,_,l,d,e]),L=()=>{I.current&&(I.current.onload=null,I.current.onerror=null,I.current=null)};return ef(()=>{if(!E)return b==="loading"&&O(),()=>{L()}},[b,O,E]),E?"loaded":b}const DNe=(n,e)=>n!=="loaded"&&e==="beforeLoadOrError"||n==="failed"&&e==="onError";function une(n){const{src:e,srcSet:i,onError:o,onLoad:l,getInitials:d,name:p,borderRadius:_,loading:E,iconLabel:b,icon:C=w.jsx(cne,{}),ignoreFallback:I,referrerPolicy:O,crossOrigin:L}=n,B=lne({src:e,onError:o,crossOrigin:L,ignoreFallback:I})==="loaded";return!e||!B?p?w.jsx(ane,{className:"chakra-avatar__initials",getInitials:d,name:p}):N.cloneElement(C,{role:"img","aria-label":b}):w.jsx(Nt.img,{src:e,srcSet:i,alt:p??b,onLoad:l,referrerPolicy:O,crossOrigin:L??void 0,className:"chakra-avatar__img",loading:E,__css:{width:"100%",height:"100%",objectFit:"cover",borderRadius:_}})}une.displayName="AvatarImage";const xNe={display:"inline-flex",alignItems:"center",justifyContent:"center",textAlign:"center",textTransform:"uppercase",fontWeight:"medium",position:"relative",flexShrink:0},$l=Bt((n,e)=>{const i=rc("Avatar",n),[o,l]=N.useState(!1),{src:d,srcSet:p,name:_,showBorder:E,borderRadius:b="full",onError:C,onLoad:I,getInitials:O=NNe,icon:L=w.jsx(cne,{}),iconLabel:U=" avatar",loading:B,children:W,borderColor:J,ignoreFallback:$,crossOrigin:ie,referrerPolicy:ce,...ne}=Wi(n),de={borderRadius:b,borderWidth:E?"2px":void 0,...xNe,...i.container};return J&&(de.borderColor=J),w.jsx(Nt.span,{ref:e,...ne,className:dn("chakra-avatar",n.className),"data-loaded":er(o),__css:de,children:w.jsxs(ONe,{value:i,children:[w.jsx(une,{src:d,srcSet:p,loading:B,onLoad:kn(I,()=>{l(!0)}),onError:C,getInitials:O,name:_,borderRadius:b,icon:L,iconLabel:U,ignoreFallback:$,crossOrigin:ie,referrerPolicy:ce}),W]})})});$l.displayName="Avatar";const Pp=Bt(function(e,i){const o=ql("Badge",e),{className:l,...d}=Wi(e);return w.jsx(Nt.span,{ref:i,className:dn("chakra-badge",e.className),...d,__css:{display:"inline-block",whiteSpace:"nowrap",verticalAlign:"middle",...o}})});Pp.displayName="Badge";const lt=Nt("div");lt.displayName="Box";const[tHe,LNe]=xi({strict:!1,name:"ButtonGroupContext"});function Yw(n){const{children:e,className:i,...o}=n,l=N.isValidElement(e)?N.cloneElement(e,{"aria-hidden":!0,focusable:!1}):e,d=dn("chakra-button__icon",i);return w.jsx(Nt.span,{display:"inline-flex",alignSelf:"center",flexShrink:0,...o,className:d,children:l})}Yw.displayName="ButtonIcon";function CV(n){const{label:e,placement:i,spacing:o="0.5rem",children:l=w.jsx(zd,{color:"currentColor",width:"1em",height:"1em"}),className:d,__css:p,..._}=n,E=dn("chakra-button__spinner",d),b=i==="start"?"marginEnd":"marginStart",C=N.useMemo(()=>({display:"flex",alignItems:"center",position:e?"relative":"absolute",[b]:e?o:0,fontSize:"1em",lineHeight:"normal",...p}),[p,e,b,o]);return w.jsx(Nt.div,{className:E,..._,__css:C,children:l})}CV.displayName="ButtonSpinner";function MNe(n){const[e,i]=N.useState(!n);return{ref:N.useCallback(d=>{d&&i(d.tagName==="BUTTON")},[]),type:e?"button":void 0}}const ur=Bt((n,e)=>{const i=LNe(),o=ql("Button",{...i,...n}),{isDisabled:l=i==null?void 0:i.isDisabled,isLoading:d,isActive:p,children:_,leftIcon:E,rightIcon:b,loadingText:C,iconSpacing:I="0.5rem",type:O,spinner:L,spinnerPlacement:U="start",className:B,as:W,shouldWrapChildren:J,...$}=Wi(n),ie=N.useMemo(()=>{const Q={...o==null?void 0:o._focus,zIndex:1};return{display:"inline-flex",appearance:"none",alignItems:"center",justifyContent:"center",userSelect:"none",position:"relative",whiteSpace:"nowrap",verticalAlign:"middle",outline:"none",...o,...!!i&&{_focus:Q}}},[o,i]),{ref:ce,type:ne}=MNe(W),de={rightIcon:b,leftIcon:E,iconSpacing:I,children:_,shouldWrapChildren:J};return w.jsxs(Nt.button,{disabled:l||d,ref:mve(e,ce),as:W,type:O??ne,"data-active":er(p),"data-loading":er(d),__css:ie,className:dn("chakra-button",B),...$,children:[d&&U==="start"&&w.jsx(CV,{className:"chakra-button__spinner--start",label:C,placement:"start",spacing:I,children:L}),d?C||w.jsx(Nt.span,{opacity:0,children:w.jsx(QY,{...de})}):w.jsx(QY,{...de}),d&&U==="end"&&w.jsx(CV,{className:"chakra-button__spinner--end",label:C,placement:"end",spacing:I,children:L})]})});ur.displayName="Button";function QY(n){const{leftIcon:e,rightIcon:i,children:o,iconSpacing:l,shouldWrapChildren:d}=n;return d?w.jsxs("span",{style:{display:"contents"},children:[e&&w.jsx(Yw,{marginEnd:l,children:e}),o,i&&w.jsx(Yw,{marginStart:l,children:i})]}):w.jsxs(w.Fragment,{children:[e&&w.jsx(Yw,{marginEnd:l,children:e}),o,i&&w.jsx(Yw,{marginStart:l,children:i})]})}const Ho=Bt((n,e)=>{const{icon:i,children:o,isRound:l,"aria-label":d,...p}=n,_=i||o,E=N.isValidElement(_)?N.cloneElement(_,{"aria-hidden":!0,focusable:!1}):null;return w.jsx(ur,{px:"0",py:"0",borderRadius:l?"full":void 0,ref:e,"aria-label":d,...p,children:E})});Ho.displayName="IconButton";const dne=Nt("div",{baseStyle:{display:"flex",alignItems:"center",justifyContent:"center"}});dne.displayName="Center";const UNe={horizontal:{insetStart:"50%",transform:"translateX(-50%)"},vertical:{top:"50%",transform:"translateY(-50%)"},both:{insetStart:"50%",top:"50%",transform:"translate(-50%, -50%)"}};Bt(function(e,i){const{axis:o="both",...l}=e;return w.jsx(Nt.div,{ref:i,__css:UNe[o],...l,position:"absolute"})});var VNe=()=>typeof document<"u",ZY=!1,uR=null,Gy=!1,RV=!1,IV=new Set;function jj(n,e){IV.forEach(i=>i(n,e))}var FNe=typeof window<"u"&&window.navigator!=null?/^Mac/.test(window.navigator.platform):!1;function jNe(n){return!(n.metaKey||!FNe&&n.altKey||n.ctrlKey||n.key==="Control"||n.key==="Shift"||n.key==="Meta")}function eX(n){Gy=!0,jNe(n)&&(uR="keyboard",jj("keyboard",n))}function RS(n){if(uR="pointer",n.type==="mousedown"||n.type==="pointerdown"){Gy=!0;const e=n.composedPath?n.composedPath()[0]:n.target;let i=!1;try{i=e.matches(":focus-visible")}catch{}if(i)return;jj("pointer",n)}}function BNe(n){return n.mozInputSource===0&&n.isTrusted?!0:n.detail===0&&!n.pointerType}function WNe(n){BNe(n)&&(Gy=!0,uR="virtual")}function zNe(n){n.target===window||n.target===document||n.target instanceof Element&&n.target.hasAttribute("tabindex")||(!Gy&&!RV&&(uR="virtual",jj("virtual",n)),Gy=!1,RV=!1)}function GNe(){Gy=!1,RV=!0}function tX(){return uR!=="pointer"}function HNe(){if(!VNe()||ZY)return;const{focus:n}=HTMLElement.prototype;HTMLElement.prototype.focus=function(...i){Gy=!0,n.apply(this,i)},document.addEventListener("keydown",eX,!0),document.addEventListener("keyup",eX,!0),document.addEventListener("click",WNe,!0),window.addEventListener("focus",zNe,!0),window.addEventListener("blur",GNe,!1),typeof PointerEvent<"u"?(document.addEventListener("pointerdown",RS,!0),document.addEventListener("pointermove",RS,!0),document.addEventListener("pointerup",RS,!0)):(document.addEventListener("mousedown",RS,!0),document.addEventListener("mousemove",RS,!0),document.addEventListener("mouseup",RS,!0)),ZY=!0}function $Ne(n){HNe(),n(tX());const e=()=>n(tX());return IV.add(e),()=>{IV.delete(e)}}const[KNe,hne]=xi({name:"FormControlStylesContext",errorMessage:`useFormControlStyles returned is 'undefined'. Seems you forgot to wrap the components in "<FormControl />" `}),[qNe,q0]=xi({strict:!1,name:"FormControlContext"});function YNe(n){const{id:e,isRequired:i,isInvalid:o,isDisabled:l,isReadOnly:d,...p}=n,_=N.useId(),E=e||`field-${_}`,b=`${E}-label`,C=`${E}-feedback`,I=`${E}-helptext`,[O,L]=N.useState(!1),[U,B]=N.useState(!1),[W,J]=N.useState(!1),$=N.useCallback((Q={},Z=null)=>({id:I,...Q,ref:Bi(Z,X=>{X&&B(!0)})}),[I]),ie=N.useCallback((Q={},Z=null)=>({...Q,ref:Z,"data-focus":er(W),"data-disabled":er(l),"data-invalid":er(o),"data-readonly":er(d),id:Q.id!==void 0?Q.id:b,htmlFor:Q.htmlFor!==void 0?Q.htmlFor:E}),[E,l,W,o,d,b]),ce=N.useCallback((Q={},Z=null)=>({id:C,...Q,ref:Bi(Z,X=>{X&&L(!0)}),"aria-live":"polite"}),[C]),ne=N.useCallback((Q={},Z=null)=>({...Q,...p,ref:Z,role:"group","data-focus":er(W),"data-disabled":er(l),"data-invalid":er(o),"data-readonly":er(d)}),[p,l,W,o,d]),de=N.useCallback((Q={},Z=null)=>({...Q,ref:Z,role:"presentation","aria-hidden":!0,children:Q.children||"*"}),[]);return{isRequired:!!i,isInvalid:!!o,isReadOnly:!!d,isDisabled:!!l,isFocused:!!W,onFocus:()=>J(!0),onBlur:()=>J(!1),hasFeedbackText:O,setHasFeedbackText:L,hasHelpText:U,setHasHelpText:B,id:E,labelId:b,feedbackId:C,helpTextId:I,htmlProps:p,getHelpTextProps:$,getErrorMessageProps:ce,getRootProps:ne,getLabelProps:ie,getRequiredIndicatorProps:de}}const kr=Bt(function(e,i){const o=rc("Form",e),l=Wi(e),{getRootProps:d,htmlProps:p,..._}=YNe(l),E=dn("chakra-form-control",e.className);return w.jsx(qNe,{value:_,children:w.jsx(KNe,{value:o,children:w.jsx(Nt.div,{...d({},i),className:E,__css:o.container})})})});kr.displayName="FormControl";const Uy=Bt(function(e,i){const o=q0(),l=hne(),d=dn("chakra-form__helper-text",e.className);return w.jsx(Nt.div,{...o==null?void 0:o.getHelpTextProps(e,i),__css:l.helperText,className:d})});Uy.displayName="FormHelperText";function Bj(n){const{isDisabled:e,isInvalid:i,isReadOnly:o,isRequired:l,...d}=Wj(n);return{...d,disabled:e,readOnly:o,required:l,"aria-invalid":xp(i),"aria-required":xp(l),"aria-readonly":xp(o)}}function Wj(n){const e=q0(),{id:i,disabled:o,readOnly:l,required:d,isRequired:p,isInvalid:_,isReadOnly:E,isDisabled:b,onFocus:C,onBlur:I,...O}=n,L=n["aria-describedby"]?[n["aria-describedby"]]:[];return e!=null&&e.hasFeedbackText&&(e!=null&&e.isInvalid)&&L.push(e.feedbackId),e!=null&&e.hasHelpText&&L.push(e.helpTextId),{...O,"aria-describedby":L.join(" ")||void 0,id:i??(e==null?void 0:e.id),isDisabled:o??b??(e==null?void 0:e.isDisabled),isReadOnly:l??E??(e==null?void 0:e.isReadOnly),isRequired:d??p??(e==null?void 0:e.isRequired),isInvalid:_??(e==null?void 0:e.isInvalid),onFocus:kn(e==null?void 0:e.onFocus,C),onBlur:kn(e==null?void 0:e.onBlur,I)}}const XNe={border:"0",clip:"rect(0, 0, 0, 0)",height:"1px",width:"1px",margin:"-1px",padding:"0",overflow:"hidden",whiteSpace:"nowrap",position:"absolute"};function JNe(n={}){const e=Wj(n),{isDisabled:i,isReadOnly:o,isRequired:l,isInvalid:d,id:p,onBlur:_,onFocus:E,"aria-describedby":b}=e,{defaultChecked:C,isChecked:I,isFocusable:O,onChange:L,isIndeterminate:U,name:B,value:W,tabIndex:J=void 0,"aria-label":$,"aria-labelledby":ie,"aria-invalid":ce,...ne}=n,de=W0(ne,["isDisabled","isReadOnly","isRequired","isInvalid","id","onBlur","onFocus","aria-describedby"]),Q=$s(L),Z=$s(_),X=$s(E),[re,pe]=N.useState(!1),[he,ue]=N.useState(!1),[xe,We]=N.useState(!1),[$e,ve]=N.useState(!1);N.useEffect(()=>$Ne(pe),[]);const _e=N.useRef(null),[Ee,ke]=N.useState(!0),[Te,be]=N.useState(!!C),Pe=I!==void 0,Le=Pe?I:Te,ze=N.useCallback(Xt=>{if(o||i){Xt.preventDefault();return}Pe||be(Le?Xt.currentTarget.checked:U?!0:Xt.currentTarget.checked),Q==null||Q(Xt)},[o,i,Le,Pe,U,Q]);ef(()=>{_e.current&&(_e.current.indeterminate=!!U)},[U]),Wp(()=>{i&&ue(!1)},[i,ue]),ef(()=>{const Xt=_e.current;if(!(Xt!=null&&Xt.form))return;const Vn=()=>{be(!!C)};return Xt.form.addEventListener("reset",Vn),()=>{var Kt;return(Kt=Xt.form)==null?void 0:Kt.removeEventListener("reset",Vn)}},[]);const Je=i&&!O,et=N.useCallback(Xt=>{Xt.key===" "&&ve(!0)},[ve]),ut=N.useCallback(Xt=>{Xt.key===" "&&ve(!1)},[ve]);ef(()=>{if(!_e.current)return;_e.current.checked!==Le&&be(_e.current.checked)},[_e.current]);const rt=N.useCallback((Xt={},Vn=null)=>{const Kt=Re=>{he&&Re.preventDefault(),ve(!0)};return{...Xt,ref:Vn,"data-active":er($e),"data-hover":er(xe),"data-checked":er(Le),"data-focus":er(he),"data-focus-visible":er(he&&re),"data-indeterminate":er(U),"data-disabled":er(i),"data-invalid":er(d),"data-readonly":er(o),"aria-hidden":!0,onMouseDown:kn(Xt.onMouseDown,Kt),onMouseUp:kn(Xt.onMouseUp,()=>ve(!1)),onMouseEnter:kn(Xt.onMouseEnter,()=>We(!0)),onMouseLeave:kn(Xt.onMouseLeave,()=>We(!1))}},[$e,Le,i,he,re,xe,U,d,o]),It=N.useCallback((Xt={},Vn=null)=>({...Xt,ref:Vn,"data-active":er($e),"data-hover":er(xe),"data-checked":er(Le),"data-focus":er(he),"data-focus-visible":er(he&&re),"data-indeterminate":er(U),"data-disabled":er(i),"data-invalid":er(d),"data-readonly":er(o)}),[$e,Le,i,he,re,xe,U,d,o]),pn=N.useCallback((Xt={},Vn=null)=>({...de,htmlFor:Ee?p:void 0,...Xt,ref:Bi(Vn,Kt=>{Kt&&ke(Kt.tagName==="LABEL")}),onClick:kn(Xt.onClick,()=>{var Kt;Ee||((Kt=_e.current)==null||Kt.click(),requestAnimationFrame(()=>{var Re;(Re=_e.current)==null||Re.focus({preventScroll:!0})}))}),"data-disabled":er(i),"data-checked":er(Le),"data-invalid":er(d)}),[de,i,Le,d,Ee,p]),Ft=N.useCallback((Xt={},Vn=null)=>({...Xt,ref:Bi(_e,Vn),type:"checkbox",name:B,value:W,id:p,tabIndex:J,onChange:kn(Xt.onChange,ze),onBlur:kn(Xt.onBlur,Z,()=>ue(!1)),onFocus:kn(Xt.onFocus,X,()=>ue(!0)),onKeyDown:kn(Xt.onKeyDown,et),onKeyUp:kn(Xt.onKeyUp,ut),required:l,checked:Le,disabled:Je,readOnly:o,"aria-label":$,"aria-labelledby":ie,"aria-invalid":ce?!!ce:d,"aria-describedby":b,"aria-disabled":i,"aria-checked":U?"mixed":Le,style:XNe}),[B,W,p,J,ze,Z,X,et,ut,l,Le,Je,o,$,ie,ce,d,b,i,U]),an=N.useCallback((Xt={},Vn=null)=>({...Xt,ref:Vn,onMouseDown:kn(Xt.onMouseDown,QNe),"data-disabled":er(i),"data-checked":er(Le),"data-invalid":er(d)}),[Le,i,d]);return{state:{isInvalid:d,isFocused:he,isChecked:Le,isActive:$e,isHovered:xe,isIndeterminate:U,isDisabled:i,isReadOnly:o,isRequired:l},getRootProps:pn,getCheckboxProps:rt,getIndicatorProps:It,getInputProps:Ft,getLabelProps:an,htmlProps:de}}function QNe(n){n.preventDefault(),n.stopPropagation()}const AV=Bt(function(e,i){const{className:o,centerContent:l,...d}=Wi(e),p=ql("Container",e);return w.jsx(Nt.div,{ref:i,className:dn("chakra-container",o),...d,__css:{...p,...l&&{display:"flex",flexDirection:"column",alignItems:"center"}}})});AV.displayName="Container";const of=Bt(function(e,i){const{borderLeftWidth:o,borderBottomWidth:l,borderTopWidth:d,borderRightWidth:p,borderWidth:_,borderStyle:E,borderColor:b,...C}=ql("Divider",e),{className:I,orientation:O="horizontal",__css:L,...U}=Wi(e),B={vertical:{borderLeftWidth:o||p||_||"1px",height:"100%"},horizontal:{borderBottomWidth:l||d||_||"1px",width:"100%"}};return w.jsx(Nt.hr,{ref:i,"aria-orientation":O,...U,__css:{...C,border:"0",borderColor:b,borderStyle:E,...B[O],...L},className:dn("chakra-divider",I)})});of.displayName="Divider";const wr=Bt(function(e,i){const{direction:o,align:l,justify:d,wrap:p,basis:_,grow:E,shrink:b,...C}=e,I={display:"flex",flexDirection:o,alignItems:l,justifyContent:d,flexWrap:p,flexBasis:_,flexGrow:E,flexShrink:b};return w.jsx(Nt.div,{ref:i,__css:I,...C})});wr.displayName="Flex";function ZNe(n,e){if(n==null)return{};var i={};for(var o in n)if({}.hasOwnProperty.call(n,o)){if(e.indexOf(o)!==-1)continue;i[o]=n[o]}return i}var cU={exports:{}},lU,nX;function eDe(){if(nX)return lU;nX=1;var n="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";return lU=n,lU}var uU,rX;function tDe(){if(rX)return uU;rX=1;var n=eDe();function e(){}function i(){}return i.resetWarningCache=e,uU=function(){function o(p,_,E,b,C,I){if(I!==n){var O=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw O.name="Invariant Violation",O}}o.isRequired=o;function l(){return o}var d={array:o,bigint:o,bool:o,func:o,number:o,object:o,string:o,symbol:o,any:o,arrayOf:l,element:o,elementType:o,instanceOf:l,node:o,objectOf:l,oneOf:l,oneOfType:l,shape:l,exact:l,checkPropTypes:i,resetWarningCache:e};return d.PropTypes=d,d},uU}var iX;function nDe(){return iX||(iX=1,cU.exports=tDe()()),cU.exports}var rDe=nDe();const _n=Bg(rDe);var PV="data-focus-lock",fne="data-focus-lock-disabled",iDe="data-no-focus-lock",sDe="data-autofocus-inside",oDe="data-no-autofocus";function dU(n,e){return typeof n=="function"?n(e):n&&(n.current=e),n}function aDe(n,e){var i=N.useState(function(){return{value:n,callback:e,facade:{get current(){return i.value},set current(o){var l=i.value;l!==o&&(i.value=o,i.callback(o,l))}}}})[0];return i.callback=e,i.facade}var cDe=typeof window<"u"?N.useLayoutEffect:N.useEffect,sX=new WeakMap;function pne(n,e){var i=aDe(null,function(o){return n.forEach(function(l){return dU(l,o)})});return cDe(function(){var o=sX.get(i);if(o){var l=new Set(o),d=new Set(n),p=i.current;l.forEach(function(_){d.has(_)||dU(_,null)}),d.forEach(function(_){l.has(_)||dU(_,p)})}sX.set(i,n)},[n]),i}var hU={width:"1px",height:"0px",padding:0,overflow:"hidden",position:"fixed",top:"1px",left:"1px"},qh=function(){return qh=Object.assign||function(e){for(var i,o=1,l=arguments.length;o<l;o++){i=arguments[o];for(var d in i)Object.prototype.hasOwnProperty.call(i,d)&&(e[d]=i[d])}return e},qh.apply(this,arguments)};function dR(n,e){var i={};for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&e.indexOf(o)<0&&(i[o]=n[o]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var l=0,o=Object.getOwnPropertySymbols(n);l<o.length;l++)e.indexOf(o[l])<0&&Object.prototype.propertyIsEnumerable.call(n,o[l])&&(i[o[l]]=n[o[l]]);return i}function lDe(n,e,i){if(i||arguments.length===2)for(var o=0,l=e.length,d;o<l;o++)(d||!(o in e))&&(d||(d=Array.prototype.slice.call(e,0,o)),d[o]=e[o]);return n.concat(d||Array.prototype.slice.call(e))}function mne(n){return n}function gne(n,e){e===void 0&&(e=mne);var i=[],o=!1,l={read:function(){if(o)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return i.length?i[i.length-1]:n},useMedium:function(d){var p=e(d,o);return i.push(p),function(){i=i.filter(function(_){return _!==p})}},assignSyncMedium:function(d){for(o=!0;i.length;){var p=i;i=[],p.forEach(d)}i={push:function(_){return d(_)},filter:function(){return i}}},assignMedium:function(d){o=!0;var p=[];if(i.length){var _=i;i=[],_.forEach(d),p=i}var E=function(){var C=p;p=[],C.forEach(d)},b=function(){return Promise.resolve().then(E)};b(),i={push:function(C){p.push(C),b()},filter:function(C){return p=p.filter(C),i}}}};return l}function zj(n,e){return e===void 0&&(e=mne),gne(n,e)}function _ne(n){n===void 0&&(n={});var e=gne(null);return e.options=qh({async:!0,ssr:!1},n),e}var yne=function(n){var e=n.sideCar,i=dR(n,["sideCar"]);if(!e)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var o=e.read();if(!o)throw new Error("Sidecar medium not found");return N.createElement(o,qh({},i))};yne.isSideCarExport=!0;function uDe(n,e){return n.useMedium(e),yne}var Ene=zj({},function(n){var e=n.target,i=n.currentTarget;return{target:e,currentTarget:i}}),vne=zj(),dDe=zj(),hDe=_ne({async:!0,ssr:typeof document<"u"}),fDe=N.createContext(void 0),pDe=[],Gj=N.forwardRef(function(e,i){var o,l=N.useState(),d=l[0],p=l[1],_=N.useRef(),E=N.useRef(!1),b=N.useRef(null),C=N.useState({}),I=C[1],O=e.children,L=e.disabled,U=L===void 0?!1:L,B=e.noFocusGuards,W=B===void 0?!1:B,J=e.persistentFocus,$=J===void 0?!1:J,ie=e.crossFrame,ce=ie===void 0?!0:ie,ne=e.autoFocus,de=ne===void 0?!0:ne;e.allowTextSelection;var Q=e.group,Z=e.className,X=e.whiteList,re=e.hasPositiveIndices,pe=e.shards,he=pe===void 0?pDe:pe,ue=e.as,xe=ue===void 0?"div":ue,We=e.lockProps,$e=We===void 0?{}:We,ve=e.sideCar,_e=e.returnFocus,Ee=_e===void 0?!1:_e,ke=e.focusOptions,Te=e.onActivation,be=e.onDeactivation,Pe=N.useState({}),Le=Pe[0],ze=N.useCallback(function(Vn){var Kt=Vn.captureFocusRestore;if(!b.current){var Re,Ve=(Re=document)==null?void 0:Re.activeElement;b.current=Ve,Ve!==document.body&&(b.current=Kt(Ve))}_.current&&Te&&Te(_.current),E.current=!0,I()},[Te]),Je=N.useCallback(function(){E.current=!1,be&&be(_.current),I()},[be]),et=N.useCallback(function(Vn){var Kt=b.current;if(Kt){var Re=(typeof Kt=="function"?Kt():Kt)||document.body,Ve=typeof Ee=="function"?Ee(Re):Ee;if(Ve){var Ge=typeof Ve=="object"?Ve:void 0;b.current=null,Vn?Promise.resolve().then(function(){return Re.focus(Ge)}):Re.focus(Ge)}}},[Ee]),ut=N.useCallback(function(Vn){E.current&&Ene.useMedium(Vn)},[]),rt=vne.useMedium,It=N.useCallback(function(Vn){_.current!==Vn&&(_.current=Vn,p(Vn))},[]),pn=zy((o={},o[fne]=U&&"disabled",o[PV]=Q,o),$e),Ft=W!==!0,an=Ft&&W!=="tail",en=pne([i,It]),Xt=N.useMemo(function(){return{observed:_,shards:he,enabled:!U,active:E.current}},[U,E.current,he,d]);return mi.createElement(N.Fragment,null,Ft&&[mi.createElement("div",{key:"guard-first","data-focus-guard":!0,tabIndex:U?-1:0,style:hU}),re?mi.createElement("div",{key:"guard-nearest","data-focus-guard":!0,tabIndex:U?-1:1,style:hU}):null],!U&&mi.createElement(ve,{id:Le,sideCar:hDe,observed:d,disabled:U,persistentFocus:$,crossFrame:ce,autoFocus:de,whiteList:X,shards:he,onActivation:ze,onDeactivation:Je,returnFocus:et,focusOptions:ke,noFocusGuards:W}),mi.createElement(xe,zy({ref:en},pn,{className:Z,onBlur:rt,onFocus:ut}),mi.createElement(fDe.Provider,{value:Xt},O)),an&&mi.createElement("div",{"data-focus-guard":!0,tabIndex:U?-1:0,style:hU}))});Gj.propTypes={};function OV(n,e){return OV=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(i,o){return i.__proto__=o,i},OV(n,e)}function mDe(n,e){n.prototype=Object.create(e.prototype),n.prototype.constructor=n,OV(n,e)}function LC(n){"@babel/helpers - typeof";return LC=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},LC(n)}function gDe(n,e){if(LC(n)!="object"||!n)return n;var i=n[Symbol.toPrimitive];if(i!==void 0){var o=i.call(n,e);if(LC(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(n)}function _De(n){var e=gDe(n,"string");return LC(e)=="symbol"?e:e+""}function yDe(n,e,i){return(e=_De(e))in n?Object.defineProperty(n,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):n[e]=i,n}function EDe(n,e){function i(o){return o.displayName||o.name||"Component"}return function(l){var d=[],p;function _(){p=n(d.map(function(b){return b.props})),e(p)}var E=function(b){mDe(C,b);function C(){return b.apply(this,arguments)||this}C.peek=function(){return p};var I=C.prototype;return I.componentDidMount=function(){d.push(this),_()},I.componentDidUpdate=function(){_()},I.componentWillUnmount=function(){var L=d.indexOf(this);d.splice(L,1),_()},I.render=function(){return mi.createElement(l,this.props)},C}(N.PureComponent);return yDe(E,"displayName","SideEffect("+i(l)+")"),E}}var yf=function(n){for(var e=Array(n.length),i=0;i<n.length;++i)e[i]=n[i];return e},Hy=function(n){return Array.isArray(n)?n:[n]},Sne=function(n){return Array.isArray(n)?n[0]:n},vDe=function(n){if(n.nodeType!==Node.ELEMENT_NODE)return!1;var e=window.getComputedStyle(n,null);return!e||!e.getPropertyValue?!1:e.getPropertyValue("display")==="none"||e.getPropertyValue("visibility")==="hidden"},bne=function(n){return n.parentNode&&n.parentNode.nodeType===Node.DOCUMENT_FRAGMENT_NODE?n.parentNode.host:n.parentNode},Tne=function(n){return n===document||n&&n.nodeType===Node.DOCUMENT_NODE},SDe=function(n){return n.hasAttribute("inert")},bDe=function(n,e){return!n||Tne(n)||!vDe(n)&&!SDe(n)&&e(bne(n))},wne=function(n,e){var i=n.get(e);if(i!==void 0)return i;var o=bDe(e,wne.bind(void 0,n));return n.set(e,o),o},TDe=function(n,e){return n&&!Tne(n)?RDe(n)?e(bne(n)):!1:!0},Cne=function(n,e){var i=n.get(e);if(i!==void 0)return i;var o=TDe(e,Cne.bind(void 0,n));return n.set(e,o),o},Rne=function(n){return n.dataset},wDe=function(n){return n.tagName==="BUTTON"},Ine=function(n){return n.tagName==="INPUT"},Ane=function(n){return Ine(n)&&n.type==="radio"},CDe=function(n){return!((Ine(n)||wDe(n))&&(n.type==="hidden"||n.disabled))},RDe=function(n){var e=n.getAttribute(oDe);return![!0,"true",""].includes(e)},Hj=function(n){var e;return!!(n&&(!((e=Rne(n))===null||e===void 0)&&e.focusGuard))},kV=function(n){return!Hj(n)},IDe=function(n){return!!n},ADe=function(n,e){var i=Math.max(0,n.tabIndex),o=Math.max(0,e.tabIndex),l=i-o,d=n.index-e.index;if(l){if(!i)return 1;if(!o)return-1}return l||d},PDe=function(n){return n.tabIndex<0&&!n.hasAttribute("tabindex")?0:n.tabIndex},$j=function(n,e,i){return yf(n).map(function(o,l){var d=PDe(o);return{node:o,index:l,tabIndex:i&&d===-1?(o.dataset||{}).focusGuard?0:-1:d}}).filter(function(o){return!e||o.tabIndex>=0}).sort(ADe)},ODe=["button:enabled","select:enabled","textarea:enabled","input:enabled","a[href]","area[href]","summary","iframe","object","embed","audio[controls]","video[controls]","[tabindex]","[contenteditable]","[autofocus]"],Kj=ODe.join(","),kDe="".concat(Kj,", [data-focus-guard]"),Pne=function(n,e){return yf((n.shadowRoot||n).children).reduce(function(i,o){return i.concat(o.matches(e?kDe:Kj)?[o]:[],Pne(o))},[])},NDe=function(n,e){var i;return n instanceof HTMLIFrameElement&&(!((i=n.contentDocument)===null||i===void 0)&&i.body)?T0([n.contentDocument.body],e):[n]},T0=function(n,e){return n.reduce(function(i,o){var l,d=Pne(o,e),p=(l=[]).concat.apply(l,d.map(function(_){return NDe(_,e)}));return i.concat(p,o.parentNode?yf(o.parentNode.querySelectorAll(Kj)).filter(function(_){return _===o}):[])},[])},DDe=function(n){var e=n.querySelectorAll("[".concat(sDe,"]"));return yf(e).map(function(i){return T0([i])}).reduce(function(i,o){return i.concat(o)},[])},qj=function(n,e){return yf(n).filter(function(i){return wne(e,i)}).filter(function(i){return CDe(i)})},oX=function(n,e){return e===void 0&&(e=new Map),yf(n).filter(function(i){return Cne(e,i)})},Yj=function(n,e,i){return $j(qj(T0(n,i),e),!0,i)},MC=function(n,e){return $j(qj(T0(n),e),!1)},xDe=function(n,e){return qj(DDe(n),e)},Vy=function(n,e){return n.shadowRoot?Vy(n.shadowRoot,e):Object.getPrototypeOf(n).contains!==void 0&&Object.getPrototypeOf(n).contains.call(n,e)?!0:yf(n.children).some(function(i){var o;if(i instanceof HTMLIFrameElement){var l=(o=i.contentDocument)===null||o===void 0?void 0:o.body;return l?Vy(l,e):!1}return Vy(i,e)})},LDe=function(n){for(var e=new Set,i=n.length,o=0;o<i;o+=1)for(var l=o+1;l<i;l+=1){var d=n[o].compareDocumentPosition(n[l]);(d&Node.DOCUMENT_POSITION_CONTAINED_BY)>0&&e.add(l),(d&Node.DOCUMENT_POSITION_CONTAINS)>0&&e.add(o)}return n.filter(function(p,_){return!e.has(_)})},One=function(n){return n.parentNode?One(n.parentNode):n},Xj=function(n){var e=Hy(n);return e.filter(Boolean).reduce(function(i,o){var l=o.getAttribute(PV);return i.push.apply(i,l?LDe(yf(One(o).querySelectorAll("[".concat(PV,'="').concat(l,'"]:not([').concat(fne,'="disabled"])')))):[o]),i},[])},MDe=function(n){try{return n()}catch{return}},UC=function(n){if(n===void 0&&(n=document),!(!n||!n.activeElement)){var e=n.activeElement;return e.shadowRoot?UC(e.shadowRoot):e instanceof HTMLIFrameElement&&MDe(function(){return e.contentWindow.document})?UC(e.contentWindow.document):e}},UDe=function(n,e){return n===e},VDe=function(n,e){return!!yf(n.querySelectorAll("iframe")).some(function(i){return UDe(i,e)})},kne=function(n,e){return e===void 0&&(e=UC(Sne(n).ownerDocument)),!e||e.dataset&&e.dataset.focusGuard?!1:Xj(n).some(function(i){return Vy(i,e)||VDe(i,e)})},FDe=function(n){n===void 0&&(n=document);var e=UC(n);return e?yf(n.querySelectorAll("[".concat(iDe,"]"))).some(function(i){return Vy(i,e)}):!1},jDe=function(n,e){return e.filter(Ane).filter(function(i){return i.name===n.name}).filter(function(i){return i.checked})[0]||n},Jj=function(n,e){return Ane(n)&&n.name?jDe(n,e):n},BDe=function(n){var e=new Set;return n.forEach(function(i){return e.add(Jj(i,n))}),n.filter(function(i){return e.has(i)})},aX=function(n){return n[0]&&n.length>1?Jj(n[0],n):n[0]},cX=function(n,e){return n.indexOf(Jj(e,n))},NV="NEW_FOCUS",WDe=function(n,e,i,o,l){var d=n.length,p=n[0],_=n[d-1],E=Hj(o);if(!(o&&n.indexOf(o)>=0)){var b=o!==void 0?i.indexOf(o):-1,C=l?i.indexOf(l):b,I=l?n.indexOf(l):-1;if(b===-1)return I!==-1?I:NV;if(I===-1)return NV;var O=b-C,L=i.indexOf(p),U=i.indexOf(_),B=BDe(i),W=o!==void 0?B.indexOf(o):-1,J=l?B.indexOf(l):W,$=B.filter(function(Z){return Z.tabIndex>=0}),ie=o!==void 0?$.indexOf(o):-1,ce=l?$.indexOf(l):ie,ne=ie>=0&&ce>=0?ce-ie:J-W;if(!O&&I>=0||e.length===0)return I;var de=cX(n,e[0]),Q=cX(n,e[e.length-1]);if(b<=L&&E&&Math.abs(O)>1)return Q;if(b>=U&&E&&Math.abs(O)>1)return de;if(O&&Math.abs(ne)>1)return I;if(b<=L)return Q;if(b>U)return de;if(O)return Math.abs(O)>1?I:(d+I+O)%d}},zDe=function(n){return function(e){var i,o=(i=Rne(e))===null||i===void 0?void 0:i.autofocus;return e.autofocus||o!==void 0&&o!=="false"||n.indexOf(e)>=0}},lX=function(n,e,i){var o=n.map(function(d){var p=d.node;return p}),l=oX(o.filter(zDe(i)));return l&&l.length?aX(l):aX(oX(e))},DV=function(n,e){return e===void 0&&(e=[]),e.push(n),n.parentNode&&DV(n.parentNode.host||n.parentNode,e),e},fU=function(n,e){for(var i=DV(n),o=DV(e),l=0;l<i.length;l+=1){var d=i[l];if(o.indexOf(d)>=0)return d}return!1},Nne=function(n,e,i){var o=Hy(n),l=Hy(e),d=o[0],p=!1;return l.filter(Boolean).forEach(function(_){p=fU(p||_,_)||p,i.filter(Boolean).forEach(function(E){var b=fU(d,E);b&&(!p||Vy(b,p)?p=b:p=fU(b,p))})}),p},uX=function(n,e){return n.reduce(function(i,o){return i.concat(xDe(o,e))},[])},GDe=function(n,e){var i=new Map;return e.forEach(function(o){return i.set(o.node,o)}),n.map(function(o){return i.get(o)}).filter(IDe)},HDe=function(n,e){var i=UC(Hy(n).length>0?document:Sne(n).ownerDocument),o=Xj(n).filter(kV),l=Nne(i||n,n,o),d=new Map,p=MC(o,d),_=p.filter(function(U){var B=U.node;return kV(B)});if(_[0]){var E=MC([l],d).map(function(U){var B=U.node;return B}),b=GDe(E,_),C=b.map(function(U){var B=U.node;return B}),I=b.filter(function(U){var B=U.tabIndex;return B>=0}).map(function(U){var B=U.node;return B}),O=WDe(C,I,E,i,e);if(O===NV){var L=lX(p,I,uX(o,d))||lX(p,C,uX(o,d));if(L)return{node:L};console.warn("focus-lock: cannot find any node to move focus into");return}return O===void 0?O:b[O]}},$De=function(n){var e=Xj(n).filter(kV),i=Nne(n,n,e),o=$j(T0([i],!0),!0,!0),l=T0(e,!1);return o.map(function(d){var p=d.node,_=d.index;return{node:p,index:_,lockItem:l.indexOf(p)>=0,guard:Hj(p)}})},Qj=function(n,e){n&&("focus"in n&&n.focus(e),"contentWindow"in n&&n.contentWindow&&n.contentWindow.focus())},pU=0,mU=!1,Dne=function(n,e,i){i===void 0&&(i={});var o=HDe(n,e);if(!mU&&o){if(pU>2){console.error("FocusLock: focus-fighting detected. Only one focus management system could be active. See https://github.com/theKashey/focus-lock/#focus-fighting"),mU=!0,setTimeout(function(){mU=!1},1);return}pU++,Qj(o.node,i.focusOptions),pU--}};function ww(n){if(!n)return null;if(typeof WeakRef>"u")return function(){return n||null};var e=n?new WeakRef(n):null;return function(){return(e==null?void 0:e.deref())||null}}var KDe=function(n){if(!n)return null;for(var e=[],i=n;i&&i!==document.body;)e.push({current:ww(i),parent:ww(i.parentElement),left:ww(i.previousElementSibling),right:ww(i.nextElementSibling)}),i=i.parentElement;return{element:ww(n),stack:e,ownerDocument:n.ownerDocument}},qDe=function(n){var e,i,o,l,d;if(n)for(var p=n.stack,_=n.ownerDocument,E=new Map,b=0,C=p;b<C.length;b++){var I=C[b],O=(e=I.parent)===null||e===void 0?void 0:e.call(I);if(O&&_.contains(O)){for(var L=(i=I.left)===null||i===void 0?void 0:i.call(I),U=I.current(),B=O.contains(U)?U:void 0,W=(o=I.right)===null||o===void 0?void 0:o.call(I),J=Yj([O],E),$=(d=(l=B??(L==null?void 0:L.nextElementSibling))!==null&&l!==void 0?l:W)!==null&&d!==void 0?d:L;$;){for(var ie=0,ce=J;ie<ce.length;ie++){var ne=ce[ie];if($!=null&&$.contains(ne.node))return ne.node}$=$.nextElementSibling}if(J.length)return J[0].node}}},xne=function(n){var e=KDe(n);return function(){return qDe(e)}},YDe=function(n,e,i){if(!n||!e)return console.error("no element or scope given"),{};var o=Hy(e);if(o.every(function(p){return!Vy(p,n)}))return console.error("Active element is not contained in the scope"),{};var l=i?Yj(o,new Map):MC(o,new Map),d=l.findIndex(function(p){var _=p.node;return _===n});if(d!==-1)return{prev:l[d-1],next:l[d+1],first:l[0],last:l[l.length-1]}},XDe=function(n,e){var i=e?Yj(Hy(n),new Map):MC(Hy(n),new Map);return{first:i[0],last:i[i.length-1]}},JDe=function(n){return Object.assign({scope:document.body,cycle:!0,onlyTabbable:!0},n)},Lne=function(n,e,i){e===void 0&&(e={});var o=JDe(e),l=YDe(n,o.scope,o.onlyTabbable);if(l){var d=i(l,o.cycle);d&&Qj(d.node,o.focusOptions)}},QDe=function(n,e){e===void 0&&(e={}),Lne(n,e,function(i,o){var l=i.next,d=i.first;return l||o&&d})},ZDe=function(n,e){e===void 0&&(e={}),Lne(n,e,function(i,o){var l=i.prev,d=i.last;return l||o&&d})},Mne=function(n,e,i){var o,l=XDe(n,(o=e.onlyTabbable)!==null&&o!==void 0?o:!0),d=l[i];d&&Qj(d.node,e.focusOptions)},exe=function(n,e){e===void 0&&(e={}),Mne(n,e,"first")},txe=function(n,e){e===void 0&&(e={}),Mne(n,e,"last")};function Zj(n){setTimeout(n,1)}var nxe=function(e){return e&&"current"in e?e.current:e},Une=function(){return document&&document.activeElement===document.body},rxe=function(){return Une()||FDe()},a0=null,sl=null,dX=function(){return null},c0=null,VC=!1,e4=!1,ixe=function(){return!0},sxe=function(e){return(a0.whiteList||ixe)(e)},oxe=function(e,i){c0={observerNode:e,portaledElement:i}},axe=function(e){return c0&&c0.portaledElement===e};function hX(n,e,i,o){var l=null,d=n;do{var p=o[d];if(p.guard)p.node.dataset.focusAutoGuard&&(l=p);else if(p.lockItem){if(d!==n)return;l=null}else break}while((d+=i)!==e);l&&(l.node.tabIndex=0)}var cxe=function(e){return e?!!VC:VC==="meanwhile"},lxe=function n(e,i,o){return i&&(i.host===e&&(!i.activeElement||o.contains(i.activeElement))||i.parentNode&&n(e,i.parentNode,o))},uxe=function(e,i){return i.some(function(o){return lxe(e,o,o)})},Vne=function(e){return MC(e,new Map)},dxe=function(e){return!Vne([e.parentNode]).some(function(i){return i.node===e})},Xk=function(){var e=!1;if(a0){var i=a0,o=i.observed,l=i.persistentFocus,d=i.autoFocus,p=i.shards,_=i.crossFrame,E=i.focusOptions,b=i.noFocusGuards,C=o||c0&&c0.portaledElement;if(Une()&&sl&&sl!==document.body&&(!document.body.contains(sl)||dxe(sl))){var I=dX();I&&I.focus()}var O=document&&document.activeElement;if(C){var L=[C].concat(p.map(nxe).filter(Boolean)),U=function(){if(!cxe(_)||!b||!sl||e4)return!1;var ie=Vne(L),ce=ie.findIndex(function(ne){var de=ne.node;return de===sl});return ce===0||ce===ie.length-1};if((!O||sxe(O))&&(l||U()||!rxe()||!sl&&d)&&(C&&!(kne(L)||O&&uxe(O,L)||axe(O))&&(document&&!sl&&O&&!d?(O.blur&&O.blur(),document.body.focus()):(e=Dne(L,sl,{focusOptions:E}),c0={})),sl=document&&document.activeElement,sl!==document.body&&(dX=xne(sl)),VC=!1),document&&O!==document.activeElement&&document.querySelector("[data-focus-auto-guard]")){var B=document&&document.activeElement,W=$De(L),J=W.map(function($){var ie=$.node;return ie}).indexOf(B);J>-1&&(W.filter(function($){var ie=$.guard,ce=$.node;return ie&&ce.dataset.focusAutoGuard}).forEach(function($){var ie=$.node;return ie.removeAttribute("tabIndex")}),hX(J,W.length,1,W),hX(J,-1,-1,W))}}}return e},Fne=function(e){Xk()&&e&&(e.stopPropagation(),e.preventDefault())},t4=function(){return Zj(Xk)},hxe=function(e){var i=e.target,o=e.currentTarget;o.contains(i)||oxe(o,i)},fxe=function(){return null},jne=function(){e4=!0},Bne=function(){e4=!1,VC="just",Zj(function(){VC="meanwhile"})},pxe=function(){document.addEventListener("focusin",Fne),document.addEventListener("focusout",t4),window.addEventListener("focus",jne),window.addEventListener("blur",Bne)},mxe=function(){document.removeEventListener("focusin",Fne),document.removeEventListener("focusout",t4),window.removeEventListener("focus",jne),window.removeEventListener("blur",Bne)};function gxe(n){return n.filter(function(e){var i=e.disabled;return!i})}var Wne={moveFocusInside:Dne,focusInside:kne,focusNextElement:QDe,focusPrevElement:ZDe,focusFirstElement:exe,focusLastElement:txe,captureFocusRestore:xne};function _xe(n){var e=n.slice(-1)[0];e&&!a0&&pxe();var i=a0,o=i&&e&&e.id===i.id;a0=e,i&&!o&&(i.onDeactivation(),n.filter(function(l){var d=l.id;return d===i.id}).length||i.returnFocus(!e)),e?(sl=null,(!o||i.observed!==e.observed)&&e.onActivation(Wne),Xk(),Zj(Xk)):(mxe(),sl=null)}Ene.assignSyncMedium(hxe);vne.assignMedium(t4);dDe.assignMedium(function(n){return n(Wne)});const yxe=EDe(gxe,_xe)(fxe);var xV=N.forwardRef(function(e,i){return mi.createElement(Gj,zy({sideCar:yxe,ref:i},e))}),zne=Gj.propTypes||{};zne.sideCar;ZNe(zne,["sideCar"]);xV.propTypes={};const Exe=xV.default??xV,Gne=n=>{const{initialFocusRef:e,finalFocusRef:i,contentRef:o,restoreFocus:l,children:d,isDisabled:p,autoFocus:_,persistentFocus:E,lockFocusAcrossFrames:b}=n,C=N.useCallback(()=>{e!=null&&e.current?e.current.focus():o!=null&&o.current&&IZ(o.current).length===0&&requestAnimationFrame(()=>{var U;(U=o.current)==null||U.focus()})},[e,o]),I=N.useCallback(()=>{var L;(L=i==null?void 0:i.current)==null||L.focus()},[i]),O=l&&!i;return w.jsx(Exe,{crossFrame:b,persistentFocus:E,autoFocus:_,disabled:p,onActivation:C,onDeactivation:I,returnFocus:O,children:d})};Gne.displayName="FocusLock";const[vxe,Sxe]=xi({name:"FormErrorStylesContext",errorMessage:`useFormErrorStyles returned is 'undefined'. Seems you forgot to wrap the components in "<FormError />" `}),$h=Bt((n,e)=>{const i=rc("FormError",n),o=Wi(n),l=q0();return l!=null&&l.isInvalid?w.jsx(vxe,{value:i,children:w.jsx(Nt.div,{...l==null?void 0:l.getErrorMessageProps(o,e),className:dn("chakra-form__error-message",n.className),__css:{display:"flex",alignItems:"center",...i.text}})}):null});$h.displayName="FormErrorMessage";const bxe=Bt((n,e)=>{const i=Sxe(),o=q0();if(!(o!=null&&o.isInvalid))return null;const l=dn("chakra-form__error-icon",n.className);return w.jsx(En,{ref:e,"aria-hidden":!0,...n,__css:i.icon,className:l,children:w.jsx("path",{fill:"currentColor",d:"M11.983,0a12.206,12.206,0,0,0-8.51,3.653A11.8,11.8,0,0,0,0,12.207,11.779,11.779,0,0,0,11.8,24h.214A12.111,12.111,0,0,0,24,11.791h0A11.766,11.766,0,0,0,11.983,0ZM10.5,16.542a1.476,1.476,0,0,1,1.449-1.53h.027a1.527,1.527,0,0,1,1.523,1.47,1.475,1.475,0,0,1-1.449,1.53h-.027A1.529,1.529,0,0,1,10.5,16.542ZM11,12.5v-6a1,1,0,0,1,2,0v6a1,1,0,1,1-2,0Z"})})});bxe.displayName="FormErrorIcon";const $i=Bt(function(e,i){const o=ql("FormLabel",e),l=Wi(e),{className:d,children:p,requiredIndicator:_=w.jsx(Hne,{}),optionalIndicator:E=null,...b}=l,C=q0(),I=(C==null?void 0:C.getLabelProps(b,i))??{ref:i,...b};return w.jsxs(Nt.label,{...I,className:dn("chakra-form__label",l.className),__css:{display:"block",textAlign:"start",...o},children:[p,C!=null&&C.isRequired?_:E]})});$i.displayName="FormLabel";const Hne=Bt(function(e,i){const o=q0(),l=hne();if(!(o!=null&&o.isRequired))return null;const d=dn("chakra-form__required-indicator",e.className);return w.jsx(Nt.span,{...o==null?void 0:o.getRequiredIndicatorProps(e,i),__css:l.requiredIndicator,className:d})});Hne.displayName="RequiredIndicator";const $ne=Bt(function(e,i){const{templateAreas:o,gap:l,rowGap:d,columnGap:p,column:_,row:E,autoFlow:b,autoRows:C,templateRows:I,autoColumns:O,templateColumns:L,...U}=e,B={display:"grid",gridTemplateAreas:o,gridGap:l,gridRowGap:d,gridColumnGap:p,gridAutoColumns:O,gridColumn:_,gridRow:E,gridAutoFlow:b,gridAutoRows:C,gridTemplateRows:I,gridTemplateColumns:L};return w.jsx(Nt.div,{ref:i,__css:B,...U})});$ne.displayName="Grid";const Kne=Bt(function(e,i){const{columns:o,spacingX:l,spacingY:d,spacing:p,minChildWidth:_,...E}=e,b=K0(),C=_?wxe(_,b):Cxe(o);return w.jsx($ne,{ref:i,gap:p,columnGap:l,rowGap:d,templateColumns:C,...E})});Kne.displayName="SimpleGrid";function Txe(n){return typeof n=="number"?`${n}px`:n}function wxe(n,e){return k1(n,i=>{const o=iNe("sizes",i,Txe(i))(e);return i===null?null:`repeat(auto-fit, minmax(${o}, 1fr))`})}function Cxe(n){return k1(n,e=>e===null?null:`repeat(${e}, minmax(0, 1fr))`)}function zg(n){const{viewBox:e="0 0 24 24",d:i,displayName:o,defaultProps:l={}}=n,d=N.Children.toArray(n.path),p=Bt((_,E)=>w.jsx(En,{ref:E,viewBox:e,...l,..._,children:d.length?d:w.jsx("path",{fill:"currentColor",d:i})}));return p.displayName=o,p}const LV=Bt(function(e,i){const{htmlWidth:o,htmlHeight:l,alt:d,...p}=e;return w.jsx("img",{width:o,height:l,ref:i,alt:d,...p})});LV.displayName="NativeImage";const Jh=Bt(function(e,i){const{fallbackSrc:o,fallback:l,src:d,srcSet:p,align:_,fit:E,loading:b,ignoreFallback:C,crossOrigin:I,fallbackStrategy:O="beforeLoadOrError",referrerPolicy:L,...U}=e,B=o!==void 0||l!==void 0,W=b!=null||C||!B,J=lne({...e,crossOrigin:I,ignoreFallback:W}),$=DNe(J,O),ie={ref:i,objectFit:E,objectPosition:_,...W?U:W0(U,["onError","onLoad"])};return $?l||w.jsx(Nt.img,{as:LV,className:"chakra-image__placeholder",src:o,...ie}):w.jsx(Nt.img,{as:LV,src:d,srcSet:p,crossOrigin:I,loading:b,referrerPolicy:L,className:"chakra-image",...ie})});Jh.displayName="Image";const oi=Bt(function(e,i){const{htmlSize:o,...l}=e,d=rc("Input",l),p=Wi(l),_=Bj(p),E=dn("chakra-input",e.className);return w.jsx(Nt.input,{size:o,..._,__css:d.field,ref:i,className:E})});oi.displayName="Input";oi.id="Input";const[Rxe,qne]=xi({name:"InputGroupStylesContext",errorMessage:`useInputGroupStyles returned is 'undefined'. Seems you forgot to wrap the components in "<InputGroup />" `}),Rg=Bt(function(e,i){const o=rc("Input",e),{children:l,className:d,...p}=Wi(e),_=dn("chakra-input__group",d),E={},b=xF(l),C=o.field;b.forEach(O=>{o&&(C&&O.type.id==="InputLeftElement"&&(E.paddingStart=C.height??C.h),C&&O.type.id==="InputRightElement"&&(E.paddingEnd=C.height??C.h),O.type.id==="InputRightAddon"&&(E.borderEndRadius=0),O.type.id==="InputLeftAddon"&&(E.borderStartRadius=0))});const I=b.map(O=>{var U,B;const L=O1({size:((U=O.props)==null?void 0:U.size)||e.size,variant:((B=O.props)==null?void 0:B.variant)||e.variant});return O.type.id!=="Input"?N.cloneElement(O,L):N.cloneElement(O,Object.assign(L,E,O.props))});return w.jsx(Nt.div,{className:_,ref:i,__css:{width:"100%",display:"flex",position:"relative",isolation:"isolate",...o.group},"data-group":!0,...p,children:w.jsx(Rxe,{value:o,children:I})})});Rg.displayName="InputGroup";const Ixe={left:{marginEnd:"-1px",borderEndRadius:0,borderEndColor:"transparent"},right:{marginStart:"-1px",borderStartRadius:0,borderStartColor:"transparent"}},Axe=Nt("div",{baseStyle:{flex:"0 0 auto",width:"auto",display:"flex",alignItems:"center",whiteSpace:"nowrap"}}),n4=Bt(function(e,i){const{placement:o="left",...l}=e,d=Ixe[o]??{},p=qne();return w.jsx(Axe,{ref:i,...l,__css:{...p.addon,...d}})});n4.displayName="InputAddon";const q1=Bt(function(e,i){return w.jsx(n4,{ref:i,placement:"left",...e,className:dn("chakra-input__left-addon",e.className)})});q1.displayName="InputLeftAddon";q1.id="InputLeftAddon";const Yne=Bt(function(e,i){return w.jsx(n4,{ref:i,placement:"right",...e,className:dn("chakra-input__right-addon",e.className)})});Yne.displayName="InputRightAddon";Yne.id="InputRightAddon";const Pxe=Nt("div",{baseStyle:{display:"flex",alignItems:"center",justifyContent:"center",position:"absolute",top:"0",zIndex:2}}),Y1=Bt(function(e,i){const{placement:o="left",...l}=e,d=qne(),p=d.field,E={[o==="left"?"insetStart":"insetEnd"]:"0",width:(p==null?void 0:p.height)??(p==null?void 0:p.h),height:(p==null?void 0:p.height)??(p==null?void 0:p.h),fontSize:p==null?void 0:p.fontSize,...d.element};return w.jsx(Pxe,{ref:i,__css:E,...l})});Y1.id="InputElement";Y1.displayName="InputElement";const pC=Bt(function(e,i){const{className:o,...l}=e,d=dn("chakra-input__left-element",o);return w.jsx(Y1,{ref:i,placement:"left",className:d,...l})});pC.id="InputLeftElement";pC.displayName="InputLeftElement";const Jk=Bt(function(e,i){const{className:o,...l}=e,d=dn("chakra-input__right-element",o);return w.jsx(Y1,{ref:i,placement:"right",className:d,...l})});Jk.id="InputRightElement";Jk.displayName="InputRightElement";const Fl=Bt(function(e,i){const o=ql("Link",e),{className:l,isExternal:d,...p}=Wi(e);return w.jsx(Nt.a,{target:d?"_blank":void 0,rel:d?"noopener":void 0,ref:i,className:dn("chakra-link",l),...p,__css:o})});Fl.displayName="Link";function Oxe(n,e={}){const{ssr:i=!0,fallback:o}=e,{getWindow:l}=aAe(),d=Array.isArray(n)?n:[n];let p=Array.isArray(o)?o:[o];p=p.filter(b=>b!=null);const[_,E]=N.useState(()=>d.map((b,C)=>({media:b,matches:i?!!p[C]:l().matchMedia(b).matches})));return N.useEffect(()=>{const b=l();E(d.map(O=>({media:O,matches:b.matchMedia(O).matches})));const C=d.map(O=>b.matchMedia(O)),I=O=>{E(L=>L.slice().map(U=>U.media===O.media?{...U,matches:O.matches}:U))};return C.forEach(O=>{typeof O.addListener=="function"?O.addListener(I):O.addEventListener("change",I)}),()=>{C.forEach(O=>{typeof O.removeListener=="function"?O.removeListener(I):O.removeEventListener("change",I)})}},[l]),_.map(b=>b.matches)}function kxe(n,e,i,o){if(e==null)return o;if(!o)return n.find(p=>i(p).toLowerCase().startsWith(e.toLowerCase()));const l=n.filter(d=>i(d).toLowerCase().startsWith(e.toLowerCase()));if(l.length>0){let d;return l.includes(o)?(d=l.indexOf(o)+1,d===l.length&&(d=0),l[d]):(d=n.indexOf(l[0]),n[d])}return o}function Nxe(n){const{key:e}=n;return e.length===1||e.length>1&&/[^a-zA-Z0-9]/.test(e)}function Dxe(n={}){const{timeout:e=300,preventDefault:i=()=>!0}=n,[o,l]=N.useState([]),d=N.useRef(void 0),p=()=>{d.current&&(clearTimeout(d.current),d.current=null)},_=()=>{p(),d.current=setTimeout(()=>{l([]),d.current=null},e)};N.useEffect(()=>p,[]);function E(b){return C=>{if(C.key==="Backspace"){const I=[...o];I.pop(),l(I);return}if(Nxe(C)){const I=o.concat(C.key);i(C)&&(C.preventDefault(),C.stopPropagation()),l(I),b(I.join("")),_()}}}return E}var dl="top",zu="bottom",Gu="right",hl="left",r4="auto",hR=[dl,zu,Gu,hl],w0="start",FC="end",xxe="clippingParents",Xne="viewport",Cw="popper",Lxe="reference",fX=hR.reduce(function(n,e){return n.concat([e+"-"+w0,e+"-"+FC])},[]),Jne=[].concat(hR,[r4]).reduce(function(n,e){return n.concat([e,e+"-"+w0,e+"-"+FC])},[]),Mxe="beforeRead",Uxe="read",Vxe="afterRead",Fxe="beforeMain",jxe="main",Bxe="afterMain",Wxe="beforeWrite",zxe="write",Gxe="afterWrite",Hxe=[Mxe,Uxe,Vxe,Fxe,jxe,Bxe,Wxe,zxe,Gxe];function mf(n){return n?(n.nodeName||"").toLowerCase():null}function Kl(n){if(n==null)return window;if(n.toString()!=="[object Window]"){var e=n.ownerDocument;return e&&e.defaultView||window}return n}function $y(n){var e=Kl(n).Element;return n instanceof e||n instanceof Element}function ju(n){var e=Kl(n).HTMLElement;return n instanceof e||n instanceof HTMLElement}function i4(n){if(typeof ShadowRoot>"u")return!1;var e=Kl(n).ShadowRoot;return n instanceof e||n instanceof ShadowRoot}function $xe(n){var e=n.state;Object.keys(e.elements).forEach(function(i){var o=e.styles[i]||{},l=e.attributes[i]||{},d=e.elements[i];!ju(d)||!mf(d)||(Object.assign(d.style,o),Object.keys(l).forEach(function(p){var _=l[p];_===!1?d.removeAttribute(p):d.setAttribute(p,_===!0?"":_)}))})}function Kxe(n){var e=n.state,i={popper:{position:e.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(e.elements.popper.style,i.popper),e.styles=i,e.elements.arrow&&Object.assign(e.elements.arrow.style,i.arrow),function(){Object.keys(e.elements).forEach(function(o){var l=e.elements[o],d=e.attributes[o]||{},p=Object.keys(e.styles.hasOwnProperty(o)?e.styles[o]:i[o]),_=p.reduce(function(E,b){return E[b]="",E},{});!ju(l)||!mf(l)||(Object.assign(l.style,_),Object.keys(d).forEach(function(E){l.removeAttribute(E)}))})}}const qxe={name:"applyStyles",enabled:!0,phase:"write",fn:$xe,effect:Kxe,requires:["computeStyles"]};function af(n){return n.split("-")[0]}var Fy=Math.max,Qk=Math.min,C0=Math.round;function MV(){var n=navigator.userAgentData;return n!=null&&n.brands&&Array.isArray(n.brands)?n.brands.map(function(e){return e.brand+"/"+e.version}).join(" "):navigator.userAgent}function Qne(){return!/^((?!chrome|android).)*safari/i.test(MV())}function R0(n,e,i){e===void 0&&(e=!1),i===void 0&&(i=!1);var o=n.getBoundingClientRect(),l=1,d=1;e&&ju(n)&&(l=n.offsetWidth>0&&C0(o.width)/n.offsetWidth||1,d=n.offsetHeight>0&&C0(o.height)/n.offsetHeight||1);var p=$y(n)?Kl(n):window,_=p.visualViewport,E=!Qne()&&i,b=(o.left+(E&&_?_.offsetLeft:0))/l,C=(o.top+(E&&_?_.offsetTop:0))/d,I=o.width/l,O=o.height/d;return{width:I,height:O,top:C,right:b+I,bottom:C+O,left:b,x:b,y:C}}function s4(n){var e=R0(n),i=n.offsetWidth,o=n.offsetHeight;return Math.abs(e.width-i)<=1&&(i=e.width),Math.abs(e.height-o)<=1&&(o=e.height),{x:n.offsetLeft,y:n.offsetTop,width:i,height:o}}function Zne(n,e){var i=e.getRootNode&&e.getRootNode();if(n.contains(e))return!0;if(i&&i4(i)){var o=e;do{if(o&&n.isSameNode(o))return!0;o=o.parentNode||o.host}while(o)}return!1}function Hp(n){return Kl(n).getComputedStyle(n)}function Yxe(n){return["table","td","th"].indexOf(mf(n))>=0}function Gg(n){return(($y(n)?n.ownerDocument:n.document)||window.document).documentElement}function X1(n){return mf(n)==="html"?n:n.assignedSlot||n.parentNode||(i4(n)?n.host:null)||Gg(n)}function pX(n){return!ju(n)||Hp(n).position==="fixed"?null:n.offsetParent}function Xxe(n){var e=/firefox/i.test(MV()),i=/Trident/i.test(MV());if(i&&ju(n)){var o=Hp(n);if(o.position==="fixed")return null}var l=X1(n);for(i4(l)&&(l=l.host);ju(l)&&["html","body"].indexOf(mf(l))<0;){var d=Hp(l);if(d.transform!=="none"||d.perspective!=="none"||d.contain==="paint"||["transform","perspective"].indexOf(d.willChange)!==-1||e&&d.willChange==="filter"||e&&d.filter&&d.filter!=="none")return l;l=l.parentNode}return null}function fR(n){for(var e=Kl(n),i=pX(n);i&&Yxe(i)&&Hp(i).position==="static";)i=pX(i);return i&&(mf(i)==="html"||mf(i)==="body"&&Hp(i).position==="static")?e:i||Xxe(n)||e}function o4(n){return["top","bottom"].indexOf(n)>=0?"x":"y"}function mC(n,e,i){return Fy(n,Qk(e,i))}function Jxe(n,e,i){var o=mC(n,e,i);return o>i?i:o}function ere(){return{top:0,right:0,bottom:0,left:0}}function tre(n){return Object.assign({},ere(),n)}function nre(n,e){return e.reduce(function(i,o){return i[o]=n,i},{})}var Qxe=function(e,i){return e=typeof e=="function"?e(Object.assign({},i.rects,{placement:i.placement})):e,tre(typeof e!="number"?e:nre(e,hR))};function Zxe(n){var e,i=n.state,o=n.name,l=n.options,d=i.elements.arrow,p=i.modifiersData.popperOffsets,_=af(i.placement),E=o4(_),b=[hl,Gu].indexOf(_)>=0,C=b?"height":"width";if(!(!d||!p)){var I=Qxe(l.padding,i),O=s4(d),L=E==="y"?dl:hl,U=E==="y"?zu:Gu,B=i.rects.reference[C]+i.rects.reference[E]-p[E]-i.rects.popper[C],W=p[E]-i.rects.reference[E],J=fR(d),$=J?E==="y"?J.clientHeight||0:J.clientWidth||0:0,ie=B/2-W/2,ce=I[L],ne=$-O[C]-I[U],de=$/2-O[C]/2+ie,Q=mC(ce,de,ne),Z=E;i.modifiersData[o]=(e={},e[Z]=Q,e.centerOffset=Q-de,e)}}function eLe(n){var e=n.state,i=n.options,o=i.element,l=o===void 0?"[data-popper-arrow]":o;l!=null&&(typeof l=="string"&&(l=e.elements.popper.querySelector(l),!l)||Zne(e.elements.popper,l)&&(e.elements.arrow=l))}const tLe={name:"arrow",enabled:!0,phase:"main",fn:Zxe,effect:eLe,requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function I0(n){return n.split("-")[1]}var nLe={top:"auto",right:"auto",bottom:"auto",left:"auto"};function rLe(n,e){var i=n.x,o=n.y,l=e.devicePixelRatio||1;return{x:C0(i*l)/l||0,y:C0(o*l)/l||0}}function mX(n){var e,i=n.popper,o=n.popperRect,l=n.placement,d=n.variation,p=n.offsets,_=n.position,E=n.gpuAcceleration,b=n.adaptive,C=n.roundOffsets,I=n.isFixed,O=p.x,L=O===void 0?0:O,U=p.y,B=U===void 0?0:U,W=typeof C=="function"?C({x:L,y:B}):{x:L,y:B};L=W.x,B=W.y;var J=p.hasOwnProperty("x"),$=p.hasOwnProperty("y"),ie=hl,ce=dl,ne=window;if(b){var de=fR(i),Q="clientHeight",Z="clientWidth";if(de===Kl(i)&&(de=Gg(i),Hp(de).position!=="static"&&_==="absolute"&&(Q="scrollHeight",Z="scrollWidth")),de=de,l===dl||(l===hl||l===Gu)&&d===FC){ce=zu;var X=I&&de===ne&&ne.visualViewport?ne.visualViewport.height:de[Q];B-=X-o.height,B*=E?1:-1}if(l===hl||(l===dl||l===zu)&&d===FC){ie=Gu;var re=I&&de===ne&&ne.visualViewport?ne.visualViewport.width:de[Z];L-=re-o.width,L*=E?1:-1}}var pe=Object.assign({position:_},b&&nLe),he=C===!0?rLe({x:L,y:B},Kl(i)):{x:L,y:B};if(L=he.x,B=he.y,E){var ue;return Object.assign({},pe,(ue={},ue[ce]=$?"0":"",ue[ie]=J?"0":"",ue.transform=(ne.devicePixelRatio||1)<=1?"translate("+L+"px, "+B+"px)":"translate3d("+L+"px, "+B+"px, 0)",ue))}return Object.assign({},pe,(e={},e[ce]=$?B+"px":"",e[ie]=J?L+"px":"",e.transform="",e))}function iLe(n){var e=n.state,i=n.options,o=i.gpuAcceleration,l=o===void 0?!0:o,d=i.adaptive,p=d===void 0?!0:d,_=i.roundOffsets,E=_===void 0?!0:_,b={placement:af(e.placement),variation:I0(e.placement),popper:e.elements.popper,popperRect:e.rects.popper,gpuAcceleration:l,isFixed:e.options.strategy==="fixed"};e.modifiersData.popperOffsets!=null&&(e.styles.popper=Object.assign({},e.styles.popper,mX(Object.assign({},b,{offsets:e.modifiersData.popperOffsets,position:e.options.strategy,adaptive:p,roundOffsets:E})))),e.modifiersData.arrow!=null&&(e.styles.arrow=Object.assign({},e.styles.arrow,mX(Object.assign({},b,{offsets:e.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:E})))),e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-placement":e.placement})}const sLe={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:iLe,data:{}};var kO={passive:!0};function oLe(n){var e=n.state,i=n.instance,o=n.options,l=o.scroll,d=l===void 0?!0:l,p=o.resize,_=p===void 0?!0:p,E=Kl(e.elements.popper),b=[].concat(e.scrollParents.reference,e.scrollParents.popper);return d&&b.forEach(function(C){C.addEventListener("scroll",i.update,kO)}),_&&E.addEventListener("resize",i.update,kO),function(){d&&b.forEach(function(C){C.removeEventListener("scroll",i.update,kO)}),_&&E.removeEventListener("resize",i.update,kO)}}const aLe={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:oLe,data:{}};var cLe={left:"right",right:"left",bottom:"top",top:"bottom"};function pk(n){return n.replace(/left|right|bottom|top/g,function(e){return cLe[e]})}var lLe={start:"end",end:"start"};function gX(n){return n.replace(/start|end/g,function(e){return lLe[e]})}function a4(n){var e=Kl(n),i=e.pageXOffset,o=e.pageYOffset;return{scrollLeft:i,scrollTop:o}}function c4(n){return R0(Gg(n)).left+a4(n).scrollLeft}function uLe(n,e){var i=Kl(n),o=Gg(n),l=i.visualViewport,d=o.clientWidth,p=o.clientHeight,_=0,E=0;if(l){d=l.width,p=l.height;var b=Qne();(b||!b&&e==="fixed")&&(_=l.offsetLeft,E=l.offsetTop)}return{width:d,height:p,x:_+c4(n),y:E}}function dLe(n){var e,i=Gg(n),o=a4(n),l=(e=n.ownerDocument)==null?void 0:e.body,d=Fy(i.scrollWidth,i.clientWidth,l?l.scrollWidth:0,l?l.clientWidth:0),p=Fy(i.scrollHeight,i.clientHeight,l?l.scrollHeight:0,l?l.clientHeight:0),_=-o.scrollLeft+c4(n),E=-o.scrollTop;return Hp(l||i).direction==="rtl"&&(_+=Fy(i.clientWidth,l?l.clientWidth:0)-d),{width:d,height:p,x:_,y:E}}function l4(n){var e=Hp(n),i=e.overflow,o=e.overflowX,l=e.overflowY;return/auto|scroll|overlay|hidden/.test(i+l+o)}function rre(n){return["html","body","#document"].indexOf(mf(n))>=0?n.ownerDocument.body:ju(n)&&l4(n)?n:rre(X1(n))}function gC(n,e){var i;e===void 0&&(e=[]);var o=rre(n),l=o===((i=n.ownerDocument)==null?void 0:i.body),d=Kl(o),p=l?[d].concat(d.visualViewport||[],l4(o)?o:[]):o,_=e.concat(p);return l?_:_.concat(gC(X1(p)))}function UV(n){return Object.assign({},n,{left:n.x,top:n.y,right:n.x+n.width,bottom:n.y+n.height})}function hLe(n,e){var i=R0(n,!1,e==="fixed");return i.top=i.top+n.clientTop,i.left=i.left+n.clientLeft,i.bottom=i.top+n.clientHeight,i.right=i.left+n.clientWidth,i.width=n.clientWidth,i.height=n.clientHeight,i.x=i.left,i.y=i.top,i}function _X(n,e,i){return e===Xne?UV(uLe(n,i)):$y(e)?hLe(e,i):UV(dLe(Gg(n)))}function fLe(n){var e=gC(X1(n)),i=["absolute","fixed"].indexOf(Hp(n).position)>=0,o=i&&ju(n)?fR(n):n;return $y(o)?e.filter(function(l){return $y(l)&&Zne(l,o)&&mf(l)!=="body"}):[]}function pLe(n,e,i,o){var l=e==="clippingParents"?fLe(n):[].concat(e),d=[].concat(l,[i]),p=d[0],_=d.reduce(function(E,b){var C=_X(n,b,o);return E.top=Fy(C.top,E.top),E.right=Qk(C.right,E.right),E.bottom=Qk(C.bottom,E.bottom),E.left=Fy(C.left,E.left),E},_X(n,p,o));return _.width=_.right-_.left,_.height=_.bottom-_.top,_.x=_.left,_.y=_.top,_}function ire(n){var e=n.reference,i=n.element,o=n.placement,l=o?af(o):null,d=o?I0(o):null,p=e.x+e.width/2-i.width/2,_=e.y+e.height/2-i.height/2,E;switch(l){case dl:E={x:p,y:e.y-i.height};break;case zu:E={x:p,y:e.y+e.height};break;case Gu:E={x:e.x+e.width,y:_};break;case hl:E={x:e.x-i.width,y:_};break;default:E={x:e.x,y:e.y}}var b=l?o4(l):null;if(b!=null){var C=b==="y"?"height":"width";switch(d){case w0:E[b]=E[b]-(e[C]/2-i[C]/2);break;case FC:E[b]=E[b]+(e[C]/2-i[C]/2);break}}return E}function jC(n,e){e===void 0&&(e={});var i=e,o=i.placement,l=o===void 0?n.placement:o,d=i.strategy,p=d===void 0?n.strategy:d,_=i.boundary,E=_===void 0?xxe:_,b=i.rootBoundary,C=b===void 0?Xne:b,I=i.elementContext,O=I===void 0?Cw:I,L=i.altBoundary,U=L===void 0?!1:L,B=i.padding,W=B===void 0?0:B,J=tre(typeof W!="number"?W:nre(W,hR)),$=O===Cw?Lxe:Cw,ie=n.rects.popper,ce=n.elements[U?$:O],ne=pLe($y(ce)?ce:ce.contextElement||Gg(n.elements.popper),E,C,p),de=R0(n.elements.reference),Q=ire({reference:de,element:ie,placement:l}),Z=UV(Object.assign({},ie,Q)),X=O===Cw?Z:de,re={top:ne.top-X.top+J.top,bottom:X.bottom-ne.bottom+J.bottom,left:ne.left-X.left+J.left,right:X.right-ne.right+J.right},pe=n.modifiersData.offset;if(O===Cw&&pe){var he=pe[l];Object.keys(re).forEach(function(ue){var xe=[Gu,zu].indexOf(ue)>=0?1:-1,We=[dl,zu].indexOf(ue)>=0?"y":"x";re[ue]+=he[We]*xe})}return re}function mLe(n,e){e===void 0&&(e={});var i=e,o=i.placement,l=i.boundary,d=i.rootBoundary,p=i.padding,_=i.flipVariations,E=i.allowedAutoPlacements,b=E===void 0?Jne:E,C=I0(o),I=C?_?fX:fX.filter(function(U){return I0(U)===C}):hR,O=I.filter(function(U){return b.indexOf(U)>=0});O.length===0&&(O=I);var L=O.reduce(function(U,B){return U[B]=jC(n,{placement:B,boundary:l,rootBoundary:d,padding:p})[af(B)],U},{});return Object.keys(L).sort(function(U,B){return L[U]-L[B]})}function gLe(n){if(af(n)===r4)return[];var e=pk(n);return[gX(n),e,gX(e)]}function _Le(n){var e=n.state,i=n.options,o=n.name;if(!e.modifiersData[o]._skip){for(var l=i.mainAxis,d=l===void 0?!0:l,p=i.altAxis,_=p===void 0?!0:p,E=i.fallbackPlacements,b=i.padding,C=i.boundary,I=i.rootBoundary,O=i.altBoundary,L=i.flipVariations,U=L===void 0?!0:L,B=i.allowedAutoPlacements,W=e.options.placement,J=af(W),$=J===W,ie=E||($||!U?[pk(W)]:gLe(W)),ce=[W].concat(ie).reduce(function(Le,ze){return Le.concat(af(ze)===r4?mLe(e,{placement:ze,boundary:C,rootBoundary:I,padding:b,flipVariations:U,allowedAutoPlacements:B}):ze)},[]),ne=e.rects.reference,de=e.rects.popper,Q=new Map,Z=!0,X=ce[0],re=0;re<ce.length;re++){var pe=ce[re],he=af(pe),ue=I0(pe)===w0,xe=[dl,zu].indexOf(he)>=0,We=xe?"width":"height",$e=jC(e,{placement:pe,boundary:C,rootBoundary:I,altBoundary:O,padding:b}),ve=xe?ue?Gu:hl:ue?zu:dl;ne[We]>de[We]&&(ve=pk(ve));var _e=pk(ve),Ee=[];if(d&&Ee.push($e[he]<=0),_&&Ee.push($e[ve]<=0,$e[_e]<=0),Ee.every(function(Le){return Le})){X=pe,Z=!1;break}Q.set(pe,Ee)}if(Z)for(var ke=U?3:1,Te=function(ze){var Je=ce.find(function(et){var ut=Q.get(et);if(ut)return ut.slice(0,ze).every(function(rt){return rt})});if(Je)return X=Je,"break"},be=ke;be>0;be--){var Pe=Te(be);if(Pe==="break")break}e.placement!==X&&(e.modifiersData[o]._skip=!0,e.placement=X,e.reset=!0)}}const yLe={name:"flip",enabled:!0,phase:"main",fn:_Le,requiresIfExists:["offset"],data:{_skip:!1}};function yX(n,e,i){return i===void 0&&(i={x:0,y:0}),{top:n.top-e.height-i.y,right:n.right-e.width+i.x,bottom:n.bottom-e.height+i.y,left:n.left-e.width-i.x}}function EX(n){return[dl,Gu,zu,hl].some(function(e){return n[e]>=0})}function ELe(n){var e=n.state,i=n.name,o=e.rects.reference,l=e.rects.popper,d=e.modifiersData.preventOverflow,p=jC(e,{elementContext:"reference"}),_=jC(e,{altBoundary:!0}),E=yX(p,o),b=yX(_,l,d),C=EX(E),I=EX(b);e.modifiersData[i]={referenceClippingOffsets:E,popperEscapeOffsets:b,isReferenceHidden:C,hasPopperEscaped:I},e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-reference-hidden":C,"data-popper-escaped":I})}const vLe={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:ELe};function SLe(n,e,i){var o=af(n),l=[hl,dl].indexOf(o)>=0?-1:1,d=typeof i=="function"?i(Object.assign({},e,{placement:n})):i,p=d[0],_=d[1];return p=p||0,_=(_||0)*l,[hl,Gu].indexOf(o)>=0?{x:_,y:p}:{x:p,y:_}}function bLe(n){var e=n.state,i=n.options,o=n.name,l=i.offset,d=l===void 0?[0,0]:l,p=Jne.reduce(function(C,I){return C[I]=SLe(I,e.rects,d),C},{}),_=p[e.placement],E=_.x,b=_.y;e.modifiersData.popperOffsets!=null&&(e.modifiersData.popperOffsets.x+=E,e.modifiersData.popperOffsets.y+=b),e.modifiersData[o]=p}const TLe={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:bLe};function wLe(n){var e=n.state,i=n.name;e.modifiersData[i]=ire({reference:e.rects.reference,element:e.rects.popper,placement:e.placement})}const CLe={name:"popperOffsets",enabled:!0,phase:"read",fn:wLe,data:{}};function RLe(n){return n==="x"?"y":"x"}function ILe(n){var e=n.state,i=n.options,o=n.name,l=i.mainAxis,d=l===void 0?!0:l,p=i.altAxis,_=p===void 0?!1:p,E=i.boundary,b=i.rootBoundary,C=i.altBoundary,I=i.padding,O=i.tether,L=O===void 0?!0:O,U=i.tetherOffset,B=U===void 0?0:U,W=jC(e,{boundary:E,rootBoundary:b,padding:I,altBoundary:C}),J=af(e.placement),$=I0(e.placement),ie=!$,ce=o4(J),ne=RLe(ce),de=e.modifiersData.popperOffsets,Q=e.rects.reference,Z=e.rects.popper,X=typeof B=="function"?B(Object.assign({},e.rects,{placement:e.placement})):B,re=typeof X=="number"?{mainAxis:X,altAxis:X}:Object.assign({mainAxis:0,altAxis:0},X),pe=e.modifiersData.offset?e.modifiersData.offset[e.placement]:null,he={x:0,y:0};if(de){if(d){var ue,xe=ce==="y"?dl:hl,We=ce==="y"?zu:Gu,$e=ce==="y"?"height":"width",ve=de[ce],_e=ve+W[xe],Ee=ve-W[We],ke=L?-Z[$e]/2:0,Te=$===w0?Q[$e]:Z[$e],be=$===w0?-Z[$e]:-Q[$e],Pe=e.elements.arrow,Le=L&&Pe?s4(Pe):{width:0,height:0},ze=e.modifiersData["arrow#persistent"]?e.modifiersData["arrow#persistent"].padding:ere(),Je=ze[xe],et=ze[We],ut=mC(0,Q[$e],Le[$e]),rt=ie?Q[$e]/2-ke-ut-Je-re.mainAxis:Te-ut-Je-re.mainAxis,It=ie?-Q[$e]/2+ke+ut+et+re.mainAxis:be+ut+et+re.mainAxis,pn=e.elements.arrow&&fR(e.elements.arrow),Ft=pn?ce==="y"?pn.clientTop||0:pn.clientLeft||0:0,an=(ue=pe==null?void 0:pe[ce])!=null?ue:0,en=ve+rt-an-Ft,Xt=ve+It-an,Vn=mC(L?Qk(_e,en):_e,ve,L?Fy(Ee,Xt):Ee);de[ce]=Vn,he[ce]=Vn-ve}if(_){var Kt,Re=ce==="x"?dl:hl,Ve=ce==="x"?zu:Gu,Ge=de[ne],ft=ne==="y"?"height":"width",gt=Ge+W[Re],St=Ge-W[Ve],Wt=[dl,hl].indexOf(J)!==-1,mn=(Kt=pe==null?void 0:pe[ne])!=null?Kt:0,vn=Wt?gt:Ge-Q[ft]-Z[ft]-mn+re.altAxis,tn=Wt?Ge+Q[ft]+Z[ft]-mn-re.altAxis:St,vt=L&&Wt?Jxe(vn,Ge,tn):mC(L?vn:gt,Ge,L?tn:St);de[ne]=vt,he[ne]=vt-Ge}e.modifiersData[o]=he}}const ALe={name:"preventOverflow",enabled:!0,phase:"main",fn:ILe,requiresIfExists:["offset"]};function PLe(n){return{scrollLeft:n.scrollLeft,scrollTop:n.scrollTop}}function OLe(n){return n===Kl(n)||!ju(n)?a4(n):PLe(n)}function kLe(n){var e=n.getBoundingClientRect(),i=C0(e.width)/n.offsetWidth||1,o=C0(e.height)/n.offsetHeight||1;return i!==1||o!==1}function NLe(n,e,i){i===void 0&&(i=!1);var o=ju(e),l=ju(e)&&kLe(e),d=Gg(e),p=R0(n,l,i),_={scrollLeft:0,scrollTop:0},E={x:0,y:0};return(o||!o&&!i)&&((mf(e)!=="body"||l4(d))&&(_=OLe(e)),ju(e)?(E=R0(e,!0),E.x+=e.clientLeft,E.y+=e.clientTop):d&&(E.x=c4(d))),{x:p.left+_.scrollLeft-E.x,y:p.top+_.scrollTop-E.y,width:p.width,height:p.height}}function DLe(n){var e=new Map,i=new Set,o=[];n.forEach(function(d){e.set(d.name,d)});function l(d){i.add(d.name);var p=[].concat(d.requires||[],d.requiresIfExists||[]);p.forEach(function(_){if(!i.has(_)){var E=e.get(_);E&&l(E)}}),o.push(d)}return n.forEach(function(d){i.has(d.name)||l(d)}),o}function xLe(n){var e=DLe(n);return Hxe.reduce(function(i,o){return i.concat(e.filter(function(l){return l.phase===o}))},[])}function LLe(n){var e;return function(){return e||(e=new Promise(function(i){Promise.resolve().then(function(){e=void 0,i(n())})})),e}}function MLe(n){var e=n.reduce(function(i,o){var l=i[o.name];return i[o.name]=l?Object.assign({},l,o,{options:Object.assign({},l.options,o.options),data:Object.assign({},l.data,o.data)}):o,i},{});return Object.keys(e).map(function(i){return e[i]})}var vX={placement:"bottom",modifiers:[],strategy:"absolute"};function SX(){for(var n=arguments.length,e=new Array(n),i=0;i<n;i++)e[i]=arguments[i];return!e.some(function(o){return!(o&&typeof o.getBoundingClientRect=="function")})}function ULe(n){n===void 0&&(n={});var e=n,i=e.defaultModifiers,o=i===void 0?[]:i,l=e.defaultOptions,d=l===void 0?vX:l;return function(_,E,b){b===void 0&&(b=d);var C={placement:"bottom",orderedModifiers:[],options:Object.assign({},vX,d),modifiersData:{},elements:{reference:_,popper:E},attributes:{},styles:{}},I=[],O=!1,L={state:C,setOptions:function(J){var $=typeof J=="function"?J(C.options):J;B(),C.options=Object.assign({},d,C.options,$),C.scrollParents={reference:$y(_)?gC(_):_.contextElement?gC(_.contextElement):[],popper:gC(E)};var ie=xLe(MLe([].concat(o,C.options.modifiers)));return C.orderedModifiers=ie.filter(function(ce){return ce.enabled}),U(),L.update()},forceUpdate:function(){if(!O){var J=C.elements,$=J.reference,ie=J.popper;if(SX($,ie)){C.rects={reference:NLe($,fR(ie),C.options.strategy==="fixed"),popper:s4(ie)},C.reset=!1,C.placement=C.options.placement,C.orderedModifiers.forEach(function(re){return C.modifiersData[re.name]=Object.assign({},re.data)});for(var ce=0;ce<C.orderedModifiers.length;ce++){if(C.reset===!0){C.reset=!1,ce=-1;continue}var ne=C.orderedModifiers[ce],de=ne.fn,Q=ne.options,Z=Q===void 0?{}:Q,X=ne.name;typeof de=="function"&&(C=de({state:C,options:Z,name:X,instance:L})||C)}}}},update:LLe(function(){return new Promise(function(W){L.forceUpdate(),W(C)})}),destroy:function(){B(),O=!0}};if(!SX(_,E))return L;L.setOptions(b).then(function(W){!O&&b.onFirstUpdate&&b.onFirstUpdate(W)});function U(){C.orderedModifiers.forEach(function(W){var J=W.name,$=W.options,ie=$===void 0?{}:$,ce=W.effect;if(typeof ce=="function"){var ne=ce({state:C,name:J,instance:L,options:ie}),de=function(){};I.push(ne||de)}})}function B(){I.forEach(function(W){return W()}),I=[]}return L}}var VLe=[aLe,CLe,sLe,qxe,TLe,yLe,ALe,tLe,vLe],FLe=ULe({defaultModifiers:VLe});const IS=(n,e)=>({var:n,varRef:e?`var(${n}, ${e})`:`var(${n})`}),io={arrowShadowColor:IS("--popper-arrow-shadow-color"),arrowSize:IS("--popper-arrow-size","8px"),arrowSizeHalf:IS("--popper-arrow-size-half"),arrowBg:IS("--popper-arrow-bg"),transformOrigin:IS("--popper-transform-origin"),arrowOffset:IS("--popper-arrow-offset")};function jLe(n){if(n.includes("top"))return"1px 1px 0px 0 var(--popper-arrow-shadow-color)";if(n.includes("bottom"))return"-1px -1px 0px 0 var(--popper-arrow-shadow-color)";if(n.includes("right"))return"-1px 1px 0px 0 var(--popper-arrow-shadow-color)";if(n.includes("left"))return"1px -1px 0px 0 var(--popper-arrow-shadow-color)"}const BLe={top:"bottom center","top-start":"bottom left","top-end":"bottom right",bottom:"top center","bottom-start":"top left","bottom-end":"top right",left:"right center","left-start":"right top","left-end":"right bottom",right:"left center","right-start":"left top","right-end":"left bottom"},WLe=n=>BLe[n],bX={scroll:!0,resize:!0};function zLe(n){let e;return typeof n=="object"?e={enabled:!0,options:{...bX,...n}}:e={enabled:n,options:bX},e}const GLe={name:"matchWidth",enabled:!0,phase:"beforeWrite",requires:["computeStyles"],fn:({state:n})=>{n.styles.popper.width=`${n.rects.reference.width}px`},effect:({state:n})=>()=>{const e=n.elements.reference;n.elements.popper.style.width=`${e.offsetWidth}px`}},HLe={name:"transformOrigin",enabled:!0,phase:"write",fn:({state:n})=>{TX(n)},effect:({state:n})=>()=>{TX(n)}},TX=n=>{n.elements.popper.style.setProperty(io.transformOrigin.var,WLe(n.placement))},$Le={name:"positionArrow",enabled:!0,phase:"afterWrite",fn:({state:n})=>{KLe(n)}},KLe=n=>{var i;if(!n.placement)return;const e=qLe(n.placement);if((i=n.elements)!=null&&i.arrow&&e){Object.assign(n.elements.arrow.style,{[e.property]:e.value,width:io.arrowSize.varRef,height:io.arrowSize.varRef,zIndex:-1});const o={[io.arrowSizeHalf.var]:`calc(${io.arrowSize.varRef} / 2 - 1px)`,[io.arrowOffset.var]:`calc(${io.arrowSizeHalf.varRef} * -1)`};for(const l in o)n.elements.arrow.style.setProperty(l,o[l])}},qLe=n=>{if(n.startsWith("top"))return{property:"bottom",value:io.arrowOffset.varRef};if(n.startsWith("bottom"))return{property:"top",value:io.arrowOffset.varRef};if(n.startsWith("left"))return{property:"right",value:io.arrowOffset.varRef};if(n.startsWith("right"))return{property:"left",value:io.arrowOffset.varRef}},YLe={name:"innerArrow",enabled:!0,phase:"main",requires:["arrow"],fn:({state:n})=>{wX(n)},effect:({state:n})=>()=>{wX(n)}},wX=n=>{if(!n.elements.arrow)return;const e=n.elements.arrow.querySelector("[data-popper-arrow-inner]");if(!e)return;const i=jLe(n.placement);i&&e.style.setProperty("--popper-arrow-default-shadow",i),Object.assign(e.style,{transform:"rotate(45deg)",background:io.arrowBg.varRef,top:0,left:0,width:"100%",height:"100%",position:"absolute",zIndex:"inherit",boxShadow:"var(--popper-arrow-shadow, var(--popper-arrow-default-shadow))"})},XLe={"start-start":{ltr:"left-start",rtl:"right-start"},"start-end":{ltr:"left-end",rtl:"right-end"},"end-start":{ltr:"right-start",rtl:"left-start"},"end-end":{ltr:"right-end",rtl:"left-end"},start:{ltr:"left",rtl:"right"},end:{ltr:"right",rtl:"left"}},JLe={"auto-start":"auto-end","auto-end":"auto-start","top-start":"top-end","top-end":"top-start","bottom-start":"bottom-end","bottom-end":"bottom-start"};function QLe(n,e="ltr"){var o;const i=((o=XLe[n])==null?void 0:o[e])||n;return e==="ltr"?i:JLe[n]??i}function u4(n={}){const{enabled:e=!0,modifiers:i,placement:o="bottom",strategy:l="absolute",arrowPadding:d=8,eventListeners:p=!0,offset:_,gutter:E=8,flip:b=!0,boundary:C="clippingParents",preventOverflow:I=!0,matchWidth:O,direction:L="ltr"}=n,U=N.useRef(null),B=N.useRef(null),W=N.useRef(null),J=QLe(o,L),$=N.useRef(()=>{}),ie=N.useCallback(()=>{var re;!e||!U.current||!B.current||((re=$.current)==null||re.call($),W.current=FLe(U.current,B.current,{placement:J,modifiers:[YLe,$Le,HLe,{...GLe,enabled:!!O},{name:"eventListeners",...zLe(p)},{name:"arrow",options:{padding:d}},{name:"offset",options:{offset:_??[0,E]}},{name:"flip",enabled:!!b,options:{padding:8}},{name:"preventOverflow",enabled:!!I,options:{boundary:C}},...i??[]],strategy:l}),W.current.forceUpdate(),$.current=W.current.destroy)},[J,e,i,O,p,d,_,E,b,I,C,l]);N.useEffect(()=>()=>{var re;!U.current&&!B.current&&((re=W.current)==null||re.destroy(),W.current=null)},[]);const ce=N.useCallback(re=>{U.current=re,ie()},[ie]),ne=N.useCallback((re={},pe=null)=>({...re,ref:Bi(ce,pe)}),[ce]),de=N.useCallback(re=>{B.current=re,ie()},[ie]),Q=N.useCallback((re={},pe=null)=>({...re,ref:Bi(de,pe),style:{...re.style,position:l,minWidth:O?void 0:"max-content",inset:"0 auto auto 0"}}),[l,de,O]),Z=N.useCallback((re={},pe=null)=>{const{size:he,shadowColor:ue,bg:xe,style:We,...$e}=re;return{...$e,ref:pe,"data-popper-arrow":"",style:ZLe(re)}},[]),X=N.useCallback((re={},pe=null)=>({...re,ref:pe,"data-popper-arrow-inner":""}),[]);return{update(){var re;(re=W.current)==null||re.update()},forceUpdate(){var re;(re=W.current)==null||re.forceUpdate()},transformOrigin:io.transformOrigin.varRef,referenceRef:ce,popperRef:de,getPopperProps:Q,getArrowProps:Z,getArrowInnerProps:X,getReferenceProps:ne}}function ZLe(n){const{size:e,shadowColor:i,bg:o,style:l}=n,d={...l,position:"absolute"};return e&&(d["--popper-arrow-size"]=e),i&&(d["--popper-arrow-shadow-color"]=i),o&&(d["--popper-arrow-bg"]=o),d}function e2e(){const n=N.useRef(new Map),e=n.current,i=N.useCallback((l,d,p,_)=>{n.current.set(p,{type:d,el:l,options:_}),l.addEventListener(d,p,_)},[]),o=N.useCallback((l,d,p,_)=>{l.removeEventListener(d,p,_),n.current.delete(p)},[]);return N.useEffect(()=>()=>{e.forEach((l,d)=>{o(l.el,l.type,d,l.options)})},[o,e]),{add:i,remove:o}}function gU(n){var l,d;const e=((d=(l=n.composedPath)==null?void 0:l.call(n))==null?void 0:d[0])??n.target,{tagName:i,isContentEditable:o}=e;return i!=="INPUT"&&i!=="TEXTAREA"&&o!==!0}function sre(n={}){const{ref:e,isDisabled:i,isFocusable:o,clickOnEnter:l=!0,clickOnSpace:d=!0,onMouseDown:p,onMouseUp:_,onClick:E,onKeyDown:b,onKeyUp:C,tabIndex:I,onMouseOver:O,onMouseLeave:L,...U}=n,[B,W]=N.useState(!0),[J,$]=N.useState(!1),ie=e2e(),ce=ve=>{ve&&ve.tagName!=="BUTTON"&&W(!1)},ne=B?I:I||0,de=i&&!o,Q=N.useCallback(ve=>{if(i){ve.stopPropagation(),ve.preventDefault();return}ve.currentTarget.focus(),E==null||E(ve)},[i,E]),Z=N.useCallback(ve=>{J&&gU(ve)&&(ve.preventDefault(),ve.stopPropagation(),$(!1),ie.remove(document,"keyup",Z,!1))},[J,ie]),X=N.useCallback(ve=>{if(b==null||b(ve),i||ve.defaultPrevented||ve.metaKey||!gU(ve.nativeEvent)||B)return;const _e=l&&ve.key==="Enter";d&&ve.key===" "&&(ve.preventDefault(),$(!0)),_e&&(ve.preventDefault(),ve.currentTarget.click()),ie.add(document,"keyup",Z,!1)},[i,B,b,l,d,ie,Z]),re=N.useCallback(ve=>{if(C==null||C(ve),i||ve.defaultPrevented||ve.metaKey||!gU(ve.nativeEvent)||B)return;d&&ve.key===" "&&(ve.preventDefault(),$(!1),ve.currentTarget.click())},[d,B,i,C]),pe=N.useCallback(ve=>{ve.button===0&&($(!1),ie.remove(document,"mouseup",pe,!1))},[ie]),he=N.useCallback(ve=>{if(ve.button!==0)return;if(i){ve.stopPropagation(),ve.preventDefault();return}B||$(!0),ve.currentTarget.focus({preventScroll:!0}),ie.add(document,"mouseup",pe,!1),p==null||p(ve)},[i,B,p,ie,pe]),ue=N.useCallback(ve=>{ve.button===0&&(B||$(!1),_==null||_(ve))},[_,B]),xe=N.useCallback(ve=>{if(i){ve.preventDefault();return}O==null||O(ve)},[i,O]),We=N.useCallback(ve=>{J&&(ve.preventDefault(),$(!1)),L==null||L(ve)},[J,L]),$e=Bi(e,ce);return B?{...U,ref:$e,type:"button","aria-disabled":de?void 0:i,disabled:de,onClick:Q,onMouseDown:p,onMouseUp:_,onKeyUp:C,onKeyDown:b,onMouseOver:O,onMouseLeave:L}:{...U,ref:$e,role:"button","data-active":er(J),"aria-disabled":i?"true":void 0,tabIndex:de?void 0:ne,onClick:Q,onMouseDown:he,onMouseUp:ue,onKeyUp:re,onKeyDown:X,onMouseOver:xe,onMouseLeave:We}}const[t2e,n2e,r2e,i2e]=sne(),[s2e,pR]=xi({strict:!1,name:"MenuContext"});function ore(n){return(n==null?void 0:n.ownerDocument)??document}function o2e(n){return ore(n).activeElement===n}function a2e(n={}){const{id:e,closeOnSelect:i=!0,closeOnBlur:o=!0,initialFocusRef:l,autoSelect:d=!0,isLazy:p,isOpen:_,defaultIsOpen:E,onClose:b,onOpen:C,placement:I="bottom-start",lazyBehavior:O="unmount",direction:L,computePositionOnMount:U=!1,...B}=n,W=N.useRef(null),J=N.useRef(null),$=N.useRef(!0),ie=r2e(),ce=N.useCallback(()=>{requestAnimationFrame(()=>{var Pe;(Pe=W.current)==null||Pe.focus({preventScroll:!1})})},[]),ne=N.useCallback(()=>{const Pe=setTimeout(()=>{var Le,ze;if(l)(Le=l.current)==null||Le.focus();else if(!ie.count())(ze=W.current)==null||ze.focus({preventScroll:!1});else{const Je=ie.firstEnabled();Je&&xe(Je.index)}});Ee.current.add(Pe)},[ie,l]),de=N.useCallback(()=>{const Pe=setTimeout(()=>{var Le;if(!ie.count())(Le=W.current)==null||Le.focus({preventScroll:!1});else{const ze=ie.lastEnabled();ze&&xe(ze.index)}});Ee.current.add(Pe)},[ie]),Q=N.useCallback(()=>{C==null||C(),d?ne():ce()},[d,ne,ce,C]),{isOpen:Z,onOpen:X,onClose:re,onToggle:pe}=pf({isOpen:_,defaultIsOpen:E,onClose:b,onOpen:Q});UZ({enabled:Z&&o,ref:W,handler:Pe=>{var ze,Je,et;const Le=((Je=(ze=Pe.composedPath)==null?void 0:ze.call(Pe))==null?void 0:Je[0])??Pe.target;(et=J.current)!=null&&et.contains(Le)||re()}});const he=u4({...B,enabled:Z||U,placement:I,direction:L}),[ue,xe]=N.useState(-1);xZ(W,{focusRef:J,visible:Z,shouldFocus:!0});const We=kZ({isOpen:Z,ref:W}),[$e,ve]=hve(e,"menu-button","menu-list"),_e=N.useCallback(()=>{X(),ce()},[X,ce]),Ee=N.useRef(new Set([]));N.useEffect(()=>{const Pe=Ee.current;return()=>{Pe.forEach(Le=>clearTimeout(Le)),Pe.clear()}},[]),Wp(()=>{var Pe;Z||(xe(-1),(Pe=W.current)==null||Pe.scrollTo(0,0))},[Z]),Wp(()=>{Z&&ue===-1&&ce()},[ue,Z]),N.useEffect(()=>{var Le;if(!Z)return;const Pe=ie.item(ue);(Le=Pe==null?void 0:Pe.node)==null||Le.focus({preventScroll:!$.current})},[ie,ue,Z]);const ke=N.useCallback(()=>{X(),ne()},[ne,X]),Te=N.useCallback(()=>{$.current=!0,X(),de()},[X,de]),be=N.useCallback(()=>{var et,ut;const Pe=ore(W.current),Le=(et=W.current)==null?void 0:et.contains(Pe.activeElement);if(!(Z&&!Le))return;const Je=(ut=ie.item(ue))==null?void 0:ut.node;Je==null||Je.focus({preventScroll:!$.current})},[Z,ue,ie]);return{openAndFocusMenu:_e,openAndFocusFirstItem:ke,openAndFocusLastItem:Te,onTransitionEnd:be,unstable__animationState:We,descendants:ie,popper:he,buttonId:$e,menuId:ve,forceUpdate:he.forceUpdate,orientation:"vertical",isOpen:Z,onToggle:pe,onOpen:X,onClose:re,menuRef:W,buttonRef:J,focusedIndex:ue,closeOnSelect:i,closeOnBlur:o,autoSelect:d,setFocusedIndex:xe,isLazy:p,lazyBehavior:O,initialFocusRef:l,scrollIntoViewRef:$}}function c2e(n={},e=null){const i=pR(),{onToggle:o,popper:l,openAndFocusFirstItem:d,openAndFocusLastItem:p,scrollIntoViewRef:_}=i,E=N.useCallback(b=>{const C=b.key,O={Enter:d,ArrowDown:d,ArrowUp:p}[C];O&&(_.current=!0,b.preventDefault(),b.stopPropagation(),O(b))},[d,p,_]);return{...n,ref:Bi(i.buttonRef,e,l.referenceRef),id:i.buttonId,"data-active":er(i.isOpen),"aria-expanded":i.isOpen,"aria-haspopup":"menu","aria-controls":i.menuId,onClick:kn(n.onClick,o),onKeyDown:kn(n.onKeyDown,E)}}function VV(n){var e;return h2e(n)&&!!((e=n==null?void 0:n.getAttribute("role"))!=null&&e.startsWith("menuitem"))}function l2e(n={},e=null){const i=pR();if(!i)throw new Error("useMenuContext: context is undefined. Seems you forgot to wrap component within <Menu>");const{focusedIndex:o,setFocusedIndex:l,menuRef:d,isOpen:p,onClose:_,menuId:E,isLazy:b,lazyBehavior:C,scrollIntoViewRef:I,unstable__animationState:O}=i,L=n2e(),U=Dxe({preventDefault:$=>$.key!==" "&&VV($.target)}),B=N.useCallback($=>{if(!$.currentTarget.contains($.target))return;const ie=$.key,ne={Tab:Q=>Q.preventDefault(),Escape:Q=>{Q.stopPropagation(),_()},ArrowDown:()=>{I.current=!0;const Q=L.nextEnabled(o)??L.firstEnabled();Q&&l(Q.index)},ArrowUp:()=>{I.current=!0;const Q=L.prevEnabled(o)??L.firstEnabled();Q&&l(Q.index)}}[ie];if(ne){$.preventDefault(),ne($);return}const de=U(Q=>{const Z=kxe(L.values(),Q,X=>{var re;return((re=X==null?void 0:X.node)==null?void 0:re.textContent)??""},L.item(o));if(Z){const X=L.indexOf(Z.node);l(X)}});VV($.target)&&de($)},[L,o,U,_,l,I]),W=N.useRef(!1);p&&(W.current=!0);const J=LF({wasSelected:W.current,enabled:b,mode:C,isSelected:O.present});return{...n,ref:Bi(d,e),children:J?n.children:null,tabIndex:-1,role:"menu",id:E,style:{...n.style,transformOrigin:"var(--popper-transform-origin)"},"aria-orientation":"vertical",onKeyDown:kn(n.onKeyDown,B)}}function u2e(n={}){const{popper:e,isOpen:i}=pR();return e.getPopperProps({...n,style:{visibility:i?"visible":"hidden",...n.style}})}function d2e(n={},e=null){const{onMouseEnter:i,onMouseMove:o,onMouseLeave:l,onClick:d,onFocus:p,isDisabled:_,isFocusable:E,closeOnSelect:b,type:C,...I}=n,O=pR(),{setFocusedIndex:L,focusedIndex:U,closeOnSelect:B,onClose:W,menuId:J,scrollIntoViewRef:$}=O,ie=N.useRef(null),ce=`${J}-menuitem-${N.useId()}`,{index:ne,register:de}=i2e({disabled:_&&!E}),Q=N.useCallback(xe=>{i==null||i(xe),!_&&($.current=!1,L(ne))},[L,ne,_,i,$]),Z=N.useCallback(xe=>{o==null||o(xe),ie.current&&!o2e(ie.current)&&Q(xe)},[Q,o]),X=N.useCallback(xe=>{l==null||l(xe),!_&&L(-1)},[L,_,l]),re=N.useCallback(xe=>{d==null||d(xe),VV(xe.currentTarget)&&(b??B)&&W()},[W,d,B,b]),pe=N.useCallback(xe=>{p==null||p(xe),L(ne)},[L,p,ne]),he=ne===U,ue=sre({onClick:re,onFocus:pe,onMouseEnter:Q,onMouseMove:Z,onMouseLeave:X,ref:Bi(de,ie,e),isDisabled:_,isFocusable:E});return{...I,...ue,type:C??ue.type,id:ce,role:"menuitem",tabIndex:he?0:-1}}function h2e(n){if(!f2e(n))return!1;const e=n.ownerDocument.defaultView??window;return n instanceof e.HTMLElement}function f2e(n){return n!=null&&typeof n=="object"&&"nodeType"in n&&n.nodeType===Node.ELEMENT_NODE}const[p2e,Y0]=xi({name:"MenuStylesContext",errorMessage:`useMenuStyles returned is 'undefined'. Seems you forgot to wrap the components in "<Menu />" `}),mR=n=>{const{children:e}=n,i=rc("Menu",n),o=Wi(n),{direction:l}=K0(),{descendants:d,...p}=a2e({...o,direction:l}),_=N.useMemo(()=>p,[p]),{isOpen:E,onClose:b,forceUpdate:C}=_;return w.jsx(t2e,{value:d,children:w.jsx(s2e,{value:_,children:w.jsx(p2e,{value:i,children:ul(e,{isOpen:E,onClose:b,forceUpdate:C})})})})};mR.displayName="Menu";const m2e=Bt((n,e)=>{const i=Y0();return w.jsx(Nt.button,{ref:e,...n,__css:{display:"inline-flex",appearance:"none",alignItems:"center",outline:0,...i.button}})}),gR=Bt((n,e)=>{const{children:i,as:o,...l}=n,d=c2e(l,e),p=o||m2e;return w.jsx(p,{...d,className:dn("chakra-menu__menu-button",n.className),children:w.jsx(Nt.span,{__css:{pointerEvents:"none",flex:"1 1 auto",minW:0},children:n.children})})});gR.displayName="MenuButton";const are=Bt((n,e)=>{const i=Y0();return w.jsx(Nt.span,{ref:e,...n,__css:i.command,className:"chakra-menu__command"})});are.displayName="MenuCommand";const cre=n=>{const{className:e,...i}=n,o=Y0();return w.jsx(Nt.hr,{"aria-orientation":"horizontal",className:dn("chakra-menu__divider",e),...i,__css:o.divider})};cre.displayName="MenuDivider";const lre=n=>{const{className:e,children:i,...o}=n,l=Y0(),d=N.Children.only(i),p=N.isValidElement(d)?N.cloneElement(d,{focusable:"false","aria-hidden":!0,className:dn("chakra-menu__icon",d.props.className)}):null,_=dn("chakra-menu__icon-wrapper",e);return w.jsx(Nt.span,{className:_,...o,__css:l.icon,children:p})};lre.displayName="MenuIcon";const g2e=Bt((n,e)=>{const{type:i,...o}=n,l=Y0(),d=o.as||i?i??void 0:"button",p=N.useMemo(()=>({textDecoration:"none",color:"inherit",userSelect:"none",display:"flex",width:"100%",alignItems:"center",textAlign:"start",flex:"0 0 auto",outline:0,...l.item}),[l.item]);return w.jsx(Nt.button,{ref:e,type:d,...o,__css:p})}),Md=Bt((n,e)=>{const{icon:i,iconSpacing:o="0.75rem",command:l,commandSpacing:d="0.75rem",children:p,..._}=n,E=d2e(_,e),C=i||l?w.jsx("span",{style:{pointerEvents:"none",flex:1},children:p}):p;return w.jsxs(g2e,{...E,className:dn("chakra-menu__menuitem",E.className),children:[i&&w.jsx(lre,{fontSize:"0.8em",marginEnd:o,children:i}),C,l&&w.jsx(are,{marginStart:d,children:l})]})});Md.displayName="MenuItem";const _2e={enter:{visibility:"visible",opacity:1,scale:1,transition:{duration:.2,ease:[.4,0,.2,1]}},exit:{transitionEnd:{visibility:"hidden"},opacity:0,scale:.8,transition:{duration:.1,easings:"easeOut"}}},y2e=Nt(_f.div),_R=Bt(function(e,i){var O;const{rootProps:o,motionProps:l,...d}=e,{isOpen:p,onTransitionEnd:_,unstable__animationState:E}=pR(),b=l2e(d,i),C=u2e(o),I=Y0();return w.jsx(Nt.div,{...C,__css:{zIndex:e.zIndex??((O=I.list)==null?void 0:O.zIndex)},children:w.jsx(y2e,{variants:_2e,initial:!1,animate:p?"enter":"exit",__css:{outline:0,...I.list},...l,...b,className:dn("chakra-menu__menu-list",b.className),onUpdate:_,onAnimationComplete:CZ(E.onComplete,b.onAnimationComplete)})})});_R.displayName="MenuList";var E2e=function(n){if(typeof document>"u")return null;var e=Array.isArray(n)?n[0]:n;return e.ownerDocument.body},AS=new WeakMap,NO=new WeakMap,DO={},_U=0,ure=function(n){return n&&(n.host||ure(n.parentNode))},v2e=function(n,e){return e.map(function(i){if(n.contains(i))return i;var o=ure(i);return o&&n.contains(o)?o:(console.error("aria-hidden",i,"in not contained inside",n,". Doing nothing"),null)}).filter(function(i){return!!i})},S2e=function(n,e,i,o){var l=v2e(e,Array.isArray(n)?n:[n]);DO[i]||(DO[i]=new WeakMap);var d=DO[i],p=[],_=new Set,E=new Set(l),b=function(I){!I||_.has(I)||(_.add(I),b(I.parentNode))};l.forEach(b);var C=function(I){!I||E.has(I)||Array.prototype.forEach.call(I.children,function(O){if(_.has(O))C(O);else try{var L=O.getAttribute(o),U=L!==null&&L!=="false",B=(AS.get(O)||0)+1,W=(d.get(O)||0)+1;AS.set(O,B),d.set(O,W),p.push(O),B===1&&U&&NO.set(O,!0),W===1&&O.setAttribute(i,"true"),U||O.setAttribute(o,"true")}catch(J){console.error("aria-hidden: cannot operate on ",O,J)}})};return C(e),_.clear(),_U++,function(){p.forEach(function(I){var O=AS.get(I)-1,L=d.get(I)-1;AS.set(I,O),d.set(I,L),O||(NO.has(I)||I.removeAttribute(o),NO.delete(I)),L||I.removeAttribute(i)}),_U--,_U||(AS=new WeakMap,AS=new WeakMap,NO=new WeakMap,DO={})}},b2e=function(n,e,i){i===void 0&&(i="data-aria-hidden");var o=Array.from(Array.isArray(n)?n:[n]),l=E2e(n);return l?(o.push.apply(o,Array.from(l.querySelectorAll("[aria-live]"))),S2e(o,l,i,"aria-hidden")):function(){return null}},T2e=Object.defineProperty,w2e=(n,e,i)=>e in n?T2e(n,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):n[e]=i,C2e=(n,e,i)=>(w2e(n,e+"",i),i);class R2e{constructor(){C2e(this,"modals"),this.modals=new Set}add(e){return this.modals.add(e),this.modals.size}remove(e){this.modals.delete(e)}isTopModal(e){if(!e)return!1;const i=Array.from(this.modals)[this.modals.size-1];return e===i}}const FV=new R2e;function dre(n,e){const[i,o]=N.useState(0);return N.useEffect(()=>{const l=n.current;if(l){if(e){const d=FV.add(l);o(d)}return()=>{FV.remove(l),o(0)}}},[e,n]),i}function I2e(n){const{isOpen:e,onClose:i,id:o,closeOnOverlayClick:l=!0,closeOnEsc:d=!0,useInert:p=!0,onOverlayClick:_,onEsc:E}=n,b=N.useRef(null),C=N.useRef(null),[I,O,L]=P2e(o,"chakra-modal","chakra-modal--header","chakra-modal--body");A2e(b,e&&p);const U=dre(b,e),B=N.useRef(null),W=N.useCallback(X=>{B.current=X.target},[]),J=N.useCallback(X=>{X.key==="Escape"&&(X.stopPropagation(),d&&(i==null||i()),E==null||E())},[d,i,E]),[$,ie]=N.useState(!1),[ce,ne]=N.useState(!1),de=N.useCallback((X={},re=null)=>({role:"dialog",...X,ref:Bi(re,b),id:I,tabIndex:-1,"aria-modal":!0,"aria-labelledby":$?O:void 0,"aria-describedby":ce?L:void 0,onClick:kn(X.onClick,pe=>pe.stopPropagation())}),[L,ce,I,O,$]),Q=N.useCallback(X=>{X.stopPropagation(),B.current===X.target&&FV.isTopModal(b.current)&&(l&&(i==null||i()),_==null||_())},[i,l,_]),Z=N.useCallback((X={},re=null)=>({...X,ref:Bi(re,C),onClick:kn(X.onClick,Q),onKeyDown:kn(X.onKeyDown,J),onMouseDown:kn(X.onMouseDown,W)}),[J,W,Q]);return{isOpen:e,onClose:i,headerId:O,bodyId:L,setBodyMounted:ne,setHeaderMounted:ie,dialogRef:b,overlayRef:C,getDialogProps:de,getDialogContainerProps:Z,index:U}}function A2e(n,e){const i=n.current;N.useEffect(()=>{if(!(!n.current||!e))return b2e(n.current)},[e,n,i])}function P2e(n,...e){const i=N.useId(),o=n||i;return N.useMemo(()=>e.map(l=>`${l}-${o}`),[o,e])}const[O2e,X0]=xi({name:"ModalStylesContext",errorMessage:`useModalStyles returned is 'undefined'. Seems you forgot to wrap the components in "<Modal />" `}),[k2e,Ky]=xi({strict:!0,name:"ModalContext",errorMessage:"useModalContext: `context` is undefined. Seems you forgot to wrap modal components in `<Modal />`"}),oo=n=>{const e={scrollBehavior:"outside",autoFocus:!0,trapFocus:!0,returnFocusOnClose:!0,blockScrollOnMount:!0,allowPinchZoom:!1,preserveScrollBarGap:!0,motionPreset:"scale",...n,lockFocusAcrossFrames:n.lockFocusAcrossFrames||!0},{portalProps:i,children:o,autoFocus:l,trapFocus:d,initialFocusRef:p,finalFocusRef:_,returnFocusOnClose:E,blockScrollOnMount:b,allowPinchZoom:C,preserveScrollBarGap:I,motionPreset:O,lockFocusAcrossFrames:L,animatePresenceProps:U,onCloseComplete:B}=e,W=rc("Modal",e),$={...I2e(e),autoFocus:l,trapFocus:d,initialFocusRef:p,finalFocusRef:_,returnFocusOnClose:E,blockScrollOnMount:b,allowPinchZoom:C,preserveScrollBarGap:I,motionPreset:O,lockFocusAcrossFrames:L};return w.jsx(k2e,{value:$,children:w.jsx(O2e,{value:W,children:w.jsx(G0,{...U,onExitComplete:B,children:$.isOpen&&w.jsx(Yl,{...i,children:o})})})})};oo.displayName="Modal";var mk="right-scroll-bar-position",gk="width-before-scroll-bar",N2e="with-scroll-bars-hidden",D2e="--removed-body-scroll-bar-size",hre=_ne(),yU=function(){},J1=N.forwardRef(function(n,e){var i=N.useRef(null),o=N.useState({onScrollCapture:yU,onWheelCapture:yU,onTouchMoveCapture:yU}),l=o[0],d=o[1],p=n.forwardProps,_=n.children,E=n.className,b=n.removeScrollBar,C=n.enabled,I=n.shards,O=n.sideCar,L=n.noIsolation,U=n.inert,B=n.allowPinchZoom,W=n.as,J=W===void 0?"div":W,$=n.gapMode,ie=dR(n,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noIsolation","inert","allowPinchZoom","as","gapMode"]),ce=O,ne=pne([i,e]),de=qh(qh({},ie),l);return N.createElement(N.Fragment,null,C&&N.createElement(ce,{sideCar:hre,removeScrollBar:b,shards:I,noIsolation:L,inert:U,setCallbacks:d,allowPinchZoom:!!B,lockRef:i,gapMode:$}),p?N.cloneElement(N.Children.only(_),qh(qh({},de),{ref:ne})):N.createElement(J,qh({},de,{className:E,ref:ne}),_))});J1.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1};J1.classNames={fullWidth:gk,zeroRight:mk};var x2e=function(){if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function L2e(){if(!document)return null;var n=document.createElement("style");n.type="text/css";var e=x2e();return e&&n.setAttribute("nonce",e),n}function M2e(n,e){n.styleSheet?n.styleSheet.cssText=e:n.appendChild(document.createTextNode(e))}function U2e(n){var e=document.head||document.getElementsByTagName("head")[0];e.appendChild(n)}var V2e=function(){var n=0,e=null;return{add:function(i){n==0&&(e=L2e())&&(M2e(e,i),U2e(e)),n++},remove:function(){n--,!n&&e&&(e.parentNode&&e.parentNode.removeChild(e),e=null)}}},F2e=function(){var n=V2e();return function(e,i){N.useEffect(function(){return n.add(e),function(){n.remove()}},[e&&i])}},fre=function(){var n=F2e(),e=function(i){var o=i.styles,l=i.dynamic;return n(o,l),null};return e},j2e={left:0,top:0,right:0,gap:0},EU=function(n){return parseInt(n||"",10)||0},B2e=function(n){var e=window.getComputedStyle(document.body),i=e[n==="padding"?"paddingLeft":"marginLeft"],o=e[n==="padding"?"paddingTop":"marginTop"],l=e[n==="padding"?"paddingRight":"marginRight"];return[EU(i),EU(o),EU(l)]},W2e=function(n){if(n===void 0&&(n="margin"),typeof window>"u")return j2e;var e=B2e(n),i=document.documentElement.clientWidth,o=window.innerWidth;return{left:e[0],top:e[1],right:e[2],gap:Math.max(0,o-i+e[2]-e[0])}},z2e=fre(),l0="data-scroll-locked",G2e=function(n,e,i,o){var l=n.left,d=n.top,p=n.right,_=n.gap;return i===void 0&&(i="margin"),`
  .`.concat(N2e,` {
   overflow: hidden `).concat(o,`;
   padding-right: `).concat(_,"px ").concat(o,`;
  }
  body[`).concat(l0,`] {
    overflow: hidden `).concat(o,`;
    overscroll-behavior: contain;
    `).concat([e&&"position: relative ".concat(o,";"),i==="margin"&&`
    padding-left: `.concat(l,`px;
    padding-top: `).concat(d,`px;
    padding-right: `).concat(p,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(_,"px ").concat(o,`;
    `),i==="padding"&&"padding-right: ".concat(_,"px ").concat(o,";")].filter(Boolean).join(""),`
  }
  
  .`).concat(mk,` {
    right: `).concat(_,"px ").concat(o,`;
  }
  
  .`).concat(gk,` {
    margin-right: `).concat(_,"px ").concat(o,`;
  }
  
  .`).concat(mk," .").concat(mk,` {
    right: 0 `).concat(o,`;
  }
  
  .`).concat(gk," .").concat(gk,` {
    margin-right: 0 `).concat(o,`;
  }
  
  body[`).concat(l0,`] {
    `).concat(D2e,": ").concat(_,`px;
  }
`)},CX=function(){var n=parseInt(document.body.getAttribute(l0)||"0",10);return isFinite(n)?n:0},H2e=function(){N.useEffect(function(){return document.body.setAttribute(l0,(CX()+1).toString()),function(){var n=CX()-1;n<=0?document.body.removeAttribute(l0):document.body.setAttribute(l0,n.toString())}},[])},$2e=function(n){var e=n.noRelative,i=n.noImportant,o=n.gapMode,l=o===void 0?"margin":o;H2e();var d=N.useMemo(function(){return W2e(l)},[l]);return N.createElement(z2e,{styles:G2e(d,!e,l,i?"":"!important")})},jV=!1;if(typeof window<"u")try{var xO=Object.defineProperty({},"passive",{get:function(){return jV=!0,!0}});window.addEventListener("test",xO,xO),window.removeEventListener("test",xO,xO)}catch{jV=!1}var PS=jV?{passive:!1}:!1,K2e=function(n){return n.tagName==="TEXTAREA"},pre=function(n,e){if(!(n instanceof Element))return!1;var i=window.getComputedStyle(n);return i[e]!=="hidden"&&!(i.overflowY===i.overflowX&&!K2e(n)&&i[e]==="visible")},q2e=function(n){return pre(n,"overflowY")},Y2e=function(n){return pre(n,"overflowX")},RX=function(n,e){var i=e.ownerDocument,o=e;do{typeof ShadowRoot<"u"&&o instanceof ShadowRoot&&(o=o.host);var l=mre(n,o);if(l){var d=gre(n,o),p=d[1],_=d[2];if(p>_)return!0}o=o.parentNode}while(o&&o!==i.body);return!1},X2e=function(n){var e=n.scrollTop,i=n.scrollHeight,o=n.clientHeight;return[e,i,o]},J2e=function(n){var e=n.scrollLeft,i=n.scrollWidth,o=n.clientWidth;return[e,i,o]},mre=function(n,e){return n==="v"?q2e(e):Y2e(e)},gre=function(n,e){return n==="v"?X2e(e):J2e(e)},Q2e=function(n,e){return n==="h"&&e==="rtl"?-1:1},Z2e=function(n,e,i,o,l){var d=Q2e(n,window.getComputedStyle(e).direction),p=d*o,_=i.target,E=e.contains(_),b=!1,C=p>0,I=0,O=0;do{var L=gre(n,_),U=L[0],B=L[1],W=L[2],J=B-W-d*U;(U||J)&&mre(n,_)&&(I+=J,O+=U),_ instanceof ShadowRoot?_=_.host:_=_.parentNode}while(!E&&_!==document.body||E&&(e.contains(_)||e===_));return(C&&Math.abs(I)<1||!C&&Math.abs(O)<1)&&(b=!0),b},LO=function(n){return"changedTouches"in n?[n.changedTouches[0].clientX,n.changedTouches[0].clientY]:[0,0]},IX=function(n){return[n.deltaX,n.deltaY]},AX=function(n){return n&&"current"in n?n.current:n},eMe=function(n,e){return n[0]===e[0]&&n[1]===e[1]},tMe=function(n){return`
  .block-interactivity-`.concat(n,` {pointer-events: none;}
  .allow-interactivity-`).concat(n,` {pointer-events: all;}
`)},nMe=0,OS=[];function rMe(n){var e=N.useRef([]),i=N.useRef([0,0]),o=N.useRef(),l=N.useState(nMe++)[0],d=N.useState(fre)[0],p=N.useRef(n);N.useEffect(function(){p.current=n},[n]),N.useEffect(function(){if(n.inert){document.body.classList.add("block-interactivity-".concat(l));var B=lDe([n.lockRef.current],(n.shards||[]).map(AX),!0).filter(Boolean);return B.forEach(function(W){return W.classList.add("allow-interactivity-".concat(l))}),function(){document.body.classList.remove("block-interactivity-".concat(l)),B.forEach(function(W){return W.classList.remove("allow-interactivity-".concat(l))})}}},[n.inert,n.lockRef.current,n.shards]);var _=N.useCallback(function(B,W){if("touches"in B&&B.touches.length===2||B.type==="wheel"&&B.ctrlKey)return!p.current.allowPinchZoom;var J=LO(B),$=i.current,ie="deltaX"in B?B.deltaX:$[0]-J[0],ce="deltaY"in B?B.deltaY:$[1]-J[1],ne,de=B.target,Q=Math.abs(ie)>Math.abs(ce)?"h":"v";if("touches"in B&&Q==="h"&&de.type==="range")return!1;var Z=RX(Q,de);if(!Z)return!0;if(Z?ne=Q:(ne=Q==="v"?"h":"v",Z=RX(Q,de)),!Z)return!1;if(!o.current&&"changedTouches"in B&&(ie||ce)&&(o.current=ne),!ne)return!0;var X=o.current||ne;return Z2e(X,W,B,X==="h"?ie:ce)},[]),E=N.useCallback(function(B){var W=B;if(!(!OS.length||OS[OS.length-1]!==d)){var J="deltaY"in W?IX(W):LO(W),$=e.current.filter(function(ne){return ne.name===W.type&&(ne.target===W.target||W.target===ne.shadowParent)&&eMe(ne.delta,J)})[0];if($&&$.should){W.cancelable&&W.preventDefault();return}if(!$){var ie=(p.current.shards||[]).map(AX).filter(Boolean).filter(function(ne){return ne.contains(W.target)}),ce=ie.length>0?_(W,ie[0]):!p.current.noIsolation;ce&&W.cancelable&&W.preventDefault()}}},[]),b=N.useCallback(function(B,W,J,$){var ie={name:B,delta:W,target:J,should:$,shadowParent:iMe(J)};e.current.push(ie),setTimeout(function(){e.current=e.current.filter(function(ce){return ce!==ie})},1)},[]),C=N.useCallback(function(B){i.current=LO(B),o.current=void 0},[]),I=N.useCallback(function(B){b(B.type,IX(B),B.target,_(B,n.lockRef.current))},[]),O=N.useCallback(function(B){b(B.type,LO(B),B.target,_(B,n.lockRef.current))},[]);N.useEffect(function(){return OS.push(d),n.setCallbacks({onScrollCapture:I,onWheelCapture:I,onTouchMoveCapture:O}),document.addEventListener("wheel",E,PS),document.addEventListener("touchmove",E,PS),document.addEventListener("touchstart",C,PS),function(){OS=OS.filter(function(B){return B!==d}),document.removeEventListener("wheel",E,PS),document.removeEventListener("touchmove",E,PS),document.removeEventListener("touchstart",C,PS)}},[]);var L=n.removeScrollBar,U=n.inert;return N.createElement(N.Fragment,null,U?N.createElement(d,{styles:tMe(l)}):null,L?N.createElement($2e,{gapMode:n.gapMode}):null)}function iMe(n){for(var e=null;n!==null;)n instanceof ShadowRoot&&(e=n.host,n=n.host),n=n.parentNode;return e}const sMe=uDe(hre,rMe);var _re=N.forwardRef(function(n,e){return N.createElement(J1,qh({},n,{ref:e,sideCar:sMe}))});_re.classNames=J1.classNames;function oMe(n){const{autoFocus:e,trapFocus:i,dialogRef:o,initialFocusRef:l,blockScrollOnMount:d,allowPinchZoom:p,finalFocusRef:_,returnFocusOnClose:E,preserveScrollBarGap:b,lockFocusAcrossFrames:C,isOpen:I}=Ky(),[O,L]=ij();N.useEffect(()=>{!O&&L&&setTimeout(L)},[O,L]);const U=dre(o,I);return w.jsx(Gne,{autoFocus:e,isDisabled:!i,initialFocusRef:l,finalFocusRef:_,restoreFocus:E,contentRef:o,lockFocusAcrossFrames:C,children:w.jsx(_re,{removeScrollBar:!b,allowPinchZoom:p,enabled:U===1&&d,forwardProps:!0,children:n.children})})}const aMe={initial:({offsetX:n,offsetY:e,transition:i,transitionEnd:o,delay:l})=>({opacity:0,x:n,y:e,transition:(i==null?void 0:i.exit)??My.exit(Ly.exit,l),transitionEnd:o==null?void 0:o.exit}),enter:({transition:n,transitionEnd:e,delay:i})=>({opacity:1,x:0,y:0,transition:(n==null?void 0:n.enter)??My.enter(Ly.enter,i),transitionEnd:e==null?void 0:e.enter}),exit:({offsetY:n,offsetX:e,transition:i,transitionEnd:o,reverse:l,delay:d})=>{const p={x:e,y:n};return{opacity:0,transition:(i==null?void 0:i.exit)??My.exit(Ly.exit,d),...l?{...p,transitionEnd:o==null?void 0:o.exit}:{transitionEnd:{...p,...o==null?void 0:o.exit}}}}},Xw={initial:"initial",animate:"enter",exit:"exit",variants:aMe},cMe=N.forwardRef(function(e,i){const{unmountOnExit:o,in:l,reverse:d=!0,className:p,offsetX:_=0,offsetY:E=8,transition:b,transitionEnd:C,delay:I,animatePresenceProps:O,...L}=e,U=o?l&&o:!0,B=l||o?"enter":"exit",W={offsetX:_,offsetY:E,reverse:d,transition:b,transitionEnd:C,delay:I};return w.jsx(G0,{...O,custom:W,children:U&&w.jsx(_f.div,{ref:i,className:dn("chakra-offset-slide",p),custom:W,...Xw,animate:B,...L})})});cMe.displayName="SlideFade";const lMe={exit:({reverse:n,initialScale:e,transition:i,transitionEnd:o,delay:l})=>({opacity:0,...n?{scale:e,transitionEnd:o==null?void 0:o.exit}:{transitionEnd:{scale:e,...o==null?void 0:o.exit}},transition:(i==null?void 0:i.exit)??My.exit(Ly.exit,l)}),enter:({transitionEnd:n,transition:e,delay:i})=>({opacity:1,scale:1,transition:(e==null?void 0:e.enter)??My.enter(Ly.enter,i),transitionEnd:n==null?void 0:n.enter})},yre={initial:"exit",animate:"enter",exit:"exit",variants:lMe},uMe=N.forwardRef(function(e,i){const{unmountOnExit:o,in:l,reverse:d=!0,initialScale:p=.95,className:_,transition:E,transitionEnd:b,delay:C,animatePresenceProps:I,...O}=e,L=o?l&&o:!0,U=l||o?"enter":"exit",B={initialScale:p,reverse:d,transition:E,transitionEnd:b,delay:C};return w.jsx(G0,{...I,custom:B,children:L&&w.jsx(_f.div,{ref:i,className:dn("chakra-offset-slide",_),...yre,animate:U,custom:B,...O})})});uMe.displayName="ScaleFade";const dMe={slideInBottom:{...Xw,custom:{offsetY:16,reverse:!0}},slideInRight:{...Xw,custom:{offsetX:16,reverse:!0}},slideInTop:{...Xw,custom:{offsetY:-16,reverse:!0}},slideInLeft:{...Xw,custom:{offsetX:-16,reverse:!0}},scale:{...yre,custom:{initialScale:.95,reverse:!0}},none:{}},hMe=Nt(_f.section),fMe=n=>dMe[n||"none"],Ere=N.forwardRef((n,e)=>{const{preset:i,motionProps:o=fMe(i),...l}=n;return w.jsx(hMe,{ref:e,...o,...l})});Ere.displayName="ModalTransition";const ao=Bt((n,e)=>{const{className:i,children:o,containerProps:l,motionProps:d,...p}=n,{getDialogProps:_,getDialogContainerProps:E}=Ky(),b=_(p,e),C=E(l),I=dn("chakra-modal__content",i),O=X0(),L={display:"flex",flexDirection:"column",position:"relative",width:"100%",outline:0,...O.dialog},U={display:"flex",width:"100vw",height:"$100vh",position:"fixed",left:0,top:0,...O.dialogContainer},{motionPreset:B}=Ky();return w.jsx(oMe,{children:w.jsx(Nt.div,{...C,className:"chakra-modal__content-container",tabIndex:-1,__css:U,children:w.jsx(Ere,{preset:B,motionProps:d,className:I,...b,__css:L,children:o})})})});ao.displayName="ModalContent";const Ro=Bt((n,e)=>{const{className:i,...o}=n,{bodyId:l,setBodyMounted:d}=Ky();N.useEffect(()=>(d(!0),()=>d(!1)),[d]);const p=dn("chakra-modal__body",i),_=X0();return w.jsx(Nt.div,{ref:e,className:p,id:l,...o,__css:_.body})});Ro.displayName="ModalBody";const Ko=Bt((n,e)=>{const{onClick:i,className:o,...l}=n,{onClose:d}=Ky(),p=dn("chakra-modal__close-btn",o),_=X0();return w.jsx(Vj,{ref:e,__css:_.closeButton,className:p,onClick:kn(i,E=>{E.stopPropagation(),d()}),...l})});Ko.displayName="ModalCloseButton";const $p=Bt((n,e)=>{const{className:i,...o}=n,l=dn("chakra-modal__footer",i),d=X0(),p={display:"flex",alignItems:"center",justifyContent:"flex-end",...d.footer};return w.jsx(Nt.footer,{ref:e,...o,__css:p,className:l})});$p.displayName="ModalFooter";const tc=Bt((n,e)=>{const{className:i,...o}=n,{headerId:l,setHeaderMounted:d}=Ky();N.useEffect(()=>(d(!0),()=>d(!1)),[d]);const p=dn("chakra-modal__header",i),_=X0(),E={flex:0,..._.header};return w.jsx(Nt.header,{ref:e,className:p,id:l,...o,__css:E})});tc.displayName="ModalHeader";const pMe={enter:({transition:n,transitionEnd:e,delay:i}={})=>({opacity:1,transition:(n==null?void 0:n.enter)??My.enter(Ly.enter,i),transitionEnd:e==null?void 0:e.enter}),exit:({transition:n,transitionEnd:e,delay:i}={})=>({opacity:0,transition:(n==null?void 0:n.exit)??My.exit(Ly.exit,i),transitionEnd:e==null?void 0:e.exit})},vre={initial:"exit",animate:"enter",exit:"exit",variants:pMe},mMe=N.forwardRef(function(e,i){const{unmountOnExit:o,in:l,className:d,transition:p,transitionEnd:_,delay:E,animatePresenceProps:b,...C}=e,I=l||o?"enter":"exit",O=o?l&&o:!0,L={transition:p,transitionEnd:_,delay:E};return w.jsx(G0,{...b,custom:L,children:O&&w.jsx(_f.div,{ref:i,className:dn("chakra-fade",d),custom:L,...vre,animate:I,...C})})});mMe.displayName="Fade";const gMe=Nt(_f.div),co=Bt((n,e)=>{const{className:i,transition:o,motionProps:l,...d}=n,p=dn("chakra-modal__overlay",i),E={pos:"fixed",left:"0",top:"0",w:"100vw",h:"100vh",...X0().overlay},{motionPreset:b}=Ky(),I=l||(b==="none"?{}:vre);return w.jsx(gMe,{...I,__css:E,ref:e,className:p,...d})});co.displayName="ModalOverlay";function _Me(n){const{leastDestructiveRef:e,...i}=n;return w.jsx(oo,{...i,initialFocusRef:e})}const yMe=Bt((n,e)=>w.jsx(ao,{ref:e,role:"alertdialog",...n})),EMe=n=>w.jsx(En,{viewBox:"0 0 24 24",...n,children:w.jsx("path",{fill:"currentColor",d:"M21,5H3C2.621,5,2.275,5.214,2.105,5.553C1.937,5.892,1.973,6.297,2.2,6.6l9,12 c0.188,0.252,0.485,0.4,0.8,0.4s0.611-0.148,0.8-0.4l9-12c0.228-0.303,0.264-0.708,0.095-1.047C21.725,5.214,21.379,5,21,5z"})}),vMe=n=>w.jsx(En,{viewBox:"0 0 24 24",...n,children:w.jsx("path",{fill:"currentColor",d:"M12.8,5.4c-0.377-0.504-1.223-0.504-1.6,0l-9,12c-0.228,0.303-0.264,0.708-0.095,1.047 C2.275,18.786,2.621,19,3,19h18c0.379,0,0.725-0.214,0.895-0.553c0.169-0.339,0.133-0.744-0.095-1.047L12.8,5.4z"})});function PX(n,e,i,o){N.useEffect(()=>{if(!n.current||!o)return;const l=n.current.ownerDocument.defaultView??window,d=Array.isArray(e)?e:[e],p=new l.MutationObserver(_=>{for(const E of _)E.type==="attributes"&&E.attributeName&&d.includes(E.attributeName)&&i(E)});return p.observe(n.current,{attributes:!0,attributeFilter:d}),()=>p.disconnect()})}const SMe=50,OX=300;function bMe(n,e){const[i,o]=N.useState(!1),[l,d]=N.useState(null),[p,_]=N.useState(!0),E=N.useRef(null),b=()=>clearTimeout(E.current);fve(()=>{l==="increment"&&n(),l==="decrement"&&e()},i?SMe:null);const C=N.useCallback(()=>{p&&n(),E.current=setTimeout(()=>{_(!1),o(!0),d("increment")},OX)},[n,p]),I=N.useCallback(()=>{p&&e(),E.current=setTimeout(()=>{_(!1),o(!0),d("decrement")},OX)},[e,p]),O=N.useCallback(()=>{_(!0),o(!1),b()},[]);return N.useEffect(()=>()=>b(),[]),{up:C,down:I,stop:O,isSpinning:i}}const TMe=/^[Ee0-9+\-.]$/;function wMe(n){return TMe.test(n)}function CMe(n,e){if(n.key==null)return!0;const i=n.ctrlKey||n.altKey||n.metaKey;return!(n.key.length===1)||i?!0:e(n.key)}function RMe(n={}){const{focusInputOnChange:e=!0,clampValueOnBlur:i=!0,keepWithinRange:o=!0,min:l=Number.MIN_SAFE_INTEGER,max:d=Number.MAX_SAFE_INTEGER,step:p=1,isReadOnly:_,isDisabled:E,isRequired:b,isInvalid:C,pattern:I="[0-9]*(.[0-9]+)?",inputMode:O="decimal",allowMouseWheel:L,id:U,onChange:B,precision:W,name:J,"aria-describedby":$,"aria-label":ie,"aria-labelledby":ce,onFocus:ne,onBlur:de,onInvalid:Q,getAriaValueText:Z,isValidCharacter:X,format:re,parse:pe,...he}=n,ue=$s(ne),xe=$s(de),We=$s(Q),$e=$s(X??wMe),ve=$s(Z),_e=ZEe(n),{update:Ee,increment:ke,decrement:Te}=_e,[be,Pe]=N.useState(!1),Le=!(_||E),ze=N.useRef(null),Je=N.useRef(null),et=N.useRef(null),ut=N.useRef(null),rt=N.useCallback(vt=>vt.split("").filter($e).join(""),[$e]),It=N.useCallback(vt=>(pe==null?void 0:pe(vt))??vt,[pe]),pn=N.useCallback(vt=>((re==null?void 0:re(vt))??vt).toString(),[re]);Wp(()=>{(_e.valueAsNumber>d||_e.valueAsNumber<l)&&(We==null||We("rangeOverflow",pn(_e.value),_e.valueAsNumber))},[_e.valueAsNumber,_e.value,pn,We]),ef(()=>{if(!ze.current)return;if(ze.current.value!=_e.value){const nr=It(ze.current.value);_e.setValue(rt(nr))}},[It,rt]);const Ft=N.useCallback((vt=p)=>{Le&&ke(vt)},[ke,Le,p]),an=N.useCallback((vt=p)=>{Le&&Te(vt)},[Te,Le,p]),en=bMe(Ft,an);PX(et,"disabled",en.stop,en.isSpinning),PX(ut,"disabled",en.stop,en.isSpinning);const Xt=N.useCallback(vt=>{if(vt.nativeEvent.isComposing)return;const Dt=It(vt.currentTarget.value);Ee(rt(Dt)),Je.current={start:vt.currentTarget.selectionStart,end:vt.currentTarget.selectionEnd}},[Ee,rt,It]),Vn=N.useCallback(vt=>{var nr;ue==null||ue(vt),Je.current&&(vt.currentTarget.selectionStart=Je.current.start??((nr=vt.currentTarget.value)==null?void 0:nr.length),vt.currentTarget.selectionEnd=Je.current.end??vt.currentTarget.selectionStart)},[ue]),Kt=N.useCallback(vt=>{if(vt.nativeEvent.isComposing)return;CMe(vt,$e)||vt.preventDefault();const nr=Re(vt)*p,Dt=vt.key,gn={ArrowUp:()=>Ft(nr),ArrowDown:()=>an(nr),Home:()=>Ee(l),End:()=>Ee(d)}[Dt];gn&&(vt.preventDefault(),gn(vt))},[$e,p,Ft,an,Ee,l,d]),Re=vt=>{let nr=1;return(vt.metaKey||vt.ctrlKey)&&(nr=.1),vt.shiftKey&&(nr=10),nr},Ve=N.useMemo(()=>{const vt=ve==null?void 0:ve(_e.value);if(vt!=null)return vt;const nr=_e.value.toString();return nr||void 0},[_e.value,ve]),Ge=N.useCallback(()=>{let vt=_e.value;if(_e.value==="")return;/^[eE]/.test(_e.value.toString())?_e.setValue(""):(_e.valueAsNumber<l&&(vt=l),_e.valueAsNumber>d&&(vt=d),_e.cast(vt))},[_e,d,l]),ft=N.useCallback(()=>{Pe(!1),i&&Ge()},[i,Pe,Ge]),gt=N.useCallback(()=>{e&&requestAnimationFrame(()=>{var vt;(vt=ze.current)==null||vt.focus()})},[e]),St=N.useCallback(vt=>{vt.preventDefault(),en.up(),gt()},[gt,en]),Wt=N.useCallback(vt=>{vt.preventDefault(),en.down(),gt()},[gt,en]);Oy(()=>ze.current,"wheel",vt=>{var Li;const Dt=(((Li=ze.current)==null?void 0:Li.ownerDocument)??document).activeElement===ze.current;if(!L||!Dt)return;vt.preventDefault();const Ut=Re(vt)*p,gn=Math.sign(vt.deltaY);gn===-1?Ft(Ut):gn===1&&an(Ut)},{passive:!1});const mn=N.useCallback((vt={},nr=null)=>{const Dt=E||o&&_e.isAtMax;return{...vt,ref:Bi(nr,et),role:"button",tabIndex:-1,onPointerDown:kn(vt.onPointerDown,Ut=>{Ut.button!==0||Dt||St(Ut)}),onPointerLeave:kn(vt.onPointerLeave,en.stop),onPointerUp:kn(vt.onPointerUp,en.stop),disabled:Dt,"aria-disabled":xp(Dt)}},[_e.isAtMax,o,St,en.stop,E]),vn=N.useCallback((vt={},nr=null)=>{const Dt=E||o&&_e.isAtMin;return{...vt,ref:Bi(nr,ut),role:"button",tabIndex:-1,onPointerDown:kn(vt.onPointerDown,Ut=>{Ut.button!==0||Dt||Wt(Ut)}),onPointerLeave:kn(vt.onPointerLeave,en.stop),onPointerUp:kn(vt.onPointerUp,en.stop),disabled:Dt,"aria-disabled":xp(Dt)}},[_e.isAtMin,o,Wt,en.stop,E]),tn=N.useCallback((vt={},nr=null)=>({name:J,inputMode:O,type:"text",pattern:I,"aria-labelledby":ce,"aria-label":ie,"aria-describedby":$,id:U,disabled:E,role:"spinbutton",...vt,readOnly:vt.readOnly??_,"aria-readonly":vt.readOnly??_,"aria-required":vt.required??b,required:vt.required??b,ref:Bi(ze,nr),value:pn(_e.value),"aria-valuemin":l,"aria-valuemax":d,"aria-valuenow":Number.isNaN(_e.valueAsNumber)?void 0:_e.valueAsNumber,"aria-invalid":xp(C??_e.isOutOfRange),"aria-valuetext":Ve,autoComplete:"off",autoCorrect:"off",onChange:kn(vt.onChange,Xt),onKeyDown:kn(vt.onKeyDown,Kt),onFocus:kn(vt.onFocus,Vn,()=>Pe(!0)),onBlur:kn(vt.onBlur,xe,ft)}),[J,O,I,ce,ie,pn,$,U,E,b,_,C,_e.value,_e.valueAsNumber,_e.isOutOfRange,l,d,Ve,Xt,Kt,Vn,xe,ft]);return{value:pn(_e.value),valueAsNumber:_e.valueAsNumber,isFocused:be,isDisabled:E,isReadOnly:_,getIncrementButtonProps:mn,getDecrementButtonProps:vn,getInputProps:tn,htmlProps:he}}const[IMe,Q1]=xi({name:"NumberInputStylesContext",errorMessage:`useNumberInputStyles returned is 'undefined'. Seems you forgot to wrap the components in "<NumberInput />" `}),[AMe,d4]=xi({name:"NumberInputContext",errorMessage:"useNumberInputContext: `context` is undefined. Seems you forgot to wrap number-input's components within <NumberInput />"}),_k=Bt(function(e,i){const o=rc("NumberInput",e),l=Wi(e),d=Wj(l),{htmlProps:p,..._}=RMe(d),E=N.useMemo(()=>_,[_]);return w.jsx(AMe,{value:E,children:w.jsx(IMe,{value:o,children:w.jsx(Nt.div,{...p,ref:i,className:dn("chakra-numberinput",e.className),__css:{position:"relative",zIndex:0,...o.root}})})})});_k.displayName="NumberInput";const yk=Bt(function(e,i){const o=Q1();return w.jsx(Nt.div,{"aria-hidden":!0,ref:i,...e,__css:{display:"flex",flexDirection:"column",position:"absolute",top:"0",insetEnd:"0px",margin:"1px",height:"calc(100% - 2px)",zIndex:1,...o.stepperGroup}})});yk.displayName="NumberInputStepper";const Ek=Bt(function(e,i){const{getInputProps:o}=d4(),l=o(e,i),d=Q1();return w.jsx(Nt.input,{...l,className:dn("chakra-numberinput__field",e.className),__css:{width:"100%",...d.field}})});Ek.displayName="NumberInputField";const Sre=Nt("div",{baseStyle:{display:"flex",justifyContent:"center",alignItems:"center",flex:1,transitionProperty:"common",transitionDuration:"normal",userSelect:"none",cursor:"pointer",lineHeight:"normal"}}),vk=Bt(function(e,i){const o=Q1(),{getDecrementButtonProps:l}=d4(),d=l(e,i);return w.jsx(Sre,{...d,__css:o.stepper,children:e.children??w.jsx(EMe,{})})});vk.displayName="NumberDecrementStepper";const Sk=Bt(function(e,i){const{getIncrementButtonProps:o}=d4(),l=o(e,i),d=Q1();return w.jsx(Sre,{...l,__css:d.stepper,children:e.children??w.jsx(vMe,{})})});Sk.displayName="NumberIncrementStepper";const[PMe,Z1]=xi({name:"PopoverContext",errorMessage:"usePopoverContext: `context` is undefined. Seems you forgot to wrap all popover components within `<Popover />`"}),[OMe,bre]=xi({name:"PopoverStylesContext",errorMessage:`usePopoverStyles returned is 'undefined'. Seems you forgot to wrap the components in "<Popover />" `}),kS={click:"click",hover:"hover"};function kMe(n={}){const{closeOnBlur:e=!0,closeOnEsc:i=!0,initialFocusRef:o,id:l,returnFocusOnClose:d=!0,autoFocus:p=!0,arrowSize:_,arrowShadowColor:E,trigger:b=kS.click,openDelay:C=200,closeDelay:I=200,isLazy:O,lazyBehavior:L="unmount",computePositionOnMount:U,...B}=n,{isOpen:W,onClose:J,onOpen:$,onToggle:ie}=pf(n),[ce,ne]=N.useState(d);N.useEffect(()=>ne(d),[d]);const de=N.useRef(null),Q=N.useRef(null),Z=N.useRef(null),X=N.useRef(!1),re=N.useRef(!1);W&&(re.current=!0);const[pe,he]=N.useState(!1),[ue,xe]=N.useState(!1),We=N.useId(),$e=l??We,[ve,_e,Ee,ke]=["popover-trigger","popover-content","popover-header","popover-body"].map(Kt=>`${Kt}-${$e}`),{referenceRef:Te,getArrowProps:be,getPopperProps:Pe,getArrowInnerProps:Le,forceUpdate:ze}=u4({...B,enabled:W||!!U}),Je=kZ({isOpen:W,ref:Z});uve({enabled:W,ref:Q}),xZ(Z,{focusRef:Q,visible:W,shouldFocus:ce&&b===kS.click}),nve(Z,{focusRef:o,visible:W,shouldFocus:p&&b===kS.click}),UZ({enabled:W&&e,ref:Z,handler(Kt){var Ve;const Re=((Ve=Kt.composedPath)==null?void 0:Ve.call(Kt)[0])??[Kt.target];MO(Q.current,Re)||(Re&&ne(!Vk(Re)),J())}});const et=LF({wasSelected:re.current,enabled:O,mode:L,isSelected:Je.present}),ut=N.useCallback((Kt={},Re=null)=>{const Ve={...Kt,style:{...Kt.style,transformOrigin:io.transformOrigin.varRef,[io.arrowSize.var]:_?`${_}px`:void 0,[io.arrowShadowColor.var]:E},ref:Bi(Z,Re),children:et?Kt.children:null,id:_e,tabIndex:-1,role:"dialog",onKeyDown:kn(Kt.onKeyDown,Ge=>{Ge.nativeEvent.isComposing||i&&Ge.key==="Escape"&&(Ge.preventDefault(),Ge.stopPropagation(),J())}),onBlur:kn(Kt.onBlur,Ge=>{const ft=kX(Ge),gt=MO(Z.current,ft),St=MO(Q.current,ft),Wt=!gt&&!St;ft&&ne(!Vk(ft)),W&&e&&Wt&&J()}),"aria-labelledby":pe?Ee:void 0,"aria-describedby":ue?ke:void 0};return b===kS.hover&&(Ve.role="tooltip",Ve.onMouseEnter=kn(Kt.onMouseEnter,()=>{X.current=!0}),Ve.onMouseLeave=kn(Kt.onMouseLeave,Ge=>{Ge.nativeEvent.relatedTarget!==null&&(X.current=!1,setTimeout(()=>J(),I))})),Ve},[et,_e,pe,Ee,ue,ke,b,i,J,W,e,I,E,_]),rt=N.useCallback((Kt={},Re=null)=>Pe({...Kt,style:{visibility:W?"visible":"hidden",...Kt.style}},Re),[W,Pe]),It=N.useCallback((Kt,Re=null)=>({...Kt,ref:Bi(Re,de,Te)}),[de,Te]),pn=N.useRef(void 0),Ft=N.useRef(void 0),an=N.useCallback(Kt=>{de.current==null&&Te(Kt)},[Te]),en=N.useCallback((Kt={},Re=null)=>{const Ve={...Kt,ref:Bi(Q,Re,an),id:ve,"aria-haspopup":"dialog","aria-expanded":W,"aria-controls":_e};return b===kS.click&&(Ve.onClick=kn(Kt.onClick,ie)),b===kS.hover&&(Ve.onFocus=kn(Kt.onFocus,()=>{pn.current===void 0&&$()}),Ve.onBlur=kn(Kt.onBlur,Ge=>{const ft=kX(Ge),gt=!MO(Z.current,ft);W&&e&&gt&&J()}),Ve.onKeyDown=kn(Kt.onKeyDown,Ge=>{Ge.key==="Escape"&&J()}),Ve.onMouseEnter=kn(Kt.onMouseEnter,()=>{X.current=!0,pn.current=window.setTimeout(()=>$(),C)}),Ve.onMouseLeave=kn(Kt.onMouseLeave,()=>{X.current=!1,pn.current&&(clearTimeout(pn.current),pn.current=void 0),Ft.current=window.setTimeout(()=>{X.current===!1&&J()},I)})),Ve},[ve,W,_e,b,an,ie,$,e,J,C,I]);N.useEffect(()=>()=>{pn.current&&clearTimeout(pn.current),Ft.current&&clearTimeout(Ft.current)},[]);const Xt=N.useCallback((Kt={},Re=null)=>({...Kt,id:Ee,ref:Bi(Re,Ve=>{he(!!Ve)})}),[Ee]),Vn=N.useCallback((Kt={},Re=null)=>({...Kt,id:ke,ref:Bi(Re,Ve=>{xe(!!Ve)})}),[ke]);return{forceUpdate:ze,isOpen:W,onAnimationComplete:Je.onComplete,onClose:J,getAnchorProps:It,getArrowProps:be,getArrowInnerProps:Le,getPopoverPositionerProps:rt,getPopoverProps:ut,getTriggerProps:en,getHeaderProps:Xt,getBodyProps:Vn}}function MO(n,e){return n===e||(n==null?void 0:n.contains(e))}function kX(n){const e=n.currentTarget.ownerDocument.activeElement;return n.relatedTarget??e}function Tre(n){const e=rc("Popover",n),{children:i,...o}=Wi(n),l=K0(),d=kMe({...o,direction:l.direction});return w.jsx(PMe,{value:d,children:w.jsx(OMe,{value:e,children:ul(i,{isOpen:d.isOpen,onClose:d.onClose,forceUpdate:d.forceUpdate})})})}Tre.displayName="Popover";function wre(n){var i;const e=N.version;return typeof e!="string"||e.startsWith("18.")?n==null?void 0:n.ref:(i=n==null?void 0:n.props)==null?void 0:i.ref}const Cre=Bt(function(e,i){const{getBodyProps:o}=Z1(),l=bre();return w.jsx(Nt.div,{...o(e,i),className:dn("chakra-popover__body",e.className),__css:l.body})});Cre.displayName="PopoverBody";function NMe(n){if(n)return{enter:{...n.enter,visibility:"visible"},exit:{...n.exit,transitionEnd:{visibility:"hidden"}}}}const DMe={exit:{opacity:0,scale:.95,transition:{duration:.1,ease:[.4,0,1,1]}},enter:{scale:1,opacity:1,transition:{duration:.15,ease:[0,0,.2,1]}}},xMe=Nt(_f.section),Rre=Bt(function(e,i){const{variants:o=DMe,...l}=e,{isOpen:d}=Z1();return w.jsx(xMe,{ref:i,variants:NMe(o),initial:!1,animate:d?"enter":"exit",...l})});Rre.displayName="PopoverTransition";const Ire=Bt(function(e,i){const{rootProps:o,motionProps:l,...d}=e,{getPopoverProps:p,getPopoverPositionerProps:_,onAnimationComplete:E}=Z1(),b=bre(),C={position:"relative",display:"flex",flexDirection:"column",...b.content};return w.jsx(Nt.div,{..._(o),__css:b.popper,className:"chakra-popover__popper",children:w.jsx(Rre,{...l,...p(d,i),onAnimationComplete:CZ(E,d.onAnimationComplete),className:dn("chakra-popover__content",e.className),__css:C})})});Ire.displayName="PopoverContent";function Are(n){const e=N.Children.only(n.children),{getTriggerProps:i}=Z1();return w.jsx(w.Fragment,{children:N.cloneElement(e,i(e.props,wre(e)))})}Are.displayName="PopoverTrigger";function LMe(n,e,i){return(n-e)*100/(i-e)}iR({"0%":{strokeDasharray:"1, 400",strokeDashoffset:"0"},"50%":{strokeDasharray:"400, 400",strokeDashoffset:"-100"},"100%":{strokeDasharray:"400, 400",strokeDashoffset:"-260"}});iR({"0%":{transform:"rotate(0deg)"},"100%":{transform:"rotate(360deg)"}});const MMe=iR({"0%":{left:"-40%"},"100%":{left:"100%"}}),UMe=iR({from:{backgroundPosition:"1rem 0"},to:{backgroundPosition:"0 0"}});function VMe(n){const{value:e=0,min:i,max:o,valueText:l,getValueText:d,isIndeterminate:p,role:_="progressbar"}=n,E=LMe(e,i,o);return{bind:{"data-indeterminate":p?"":void 0,"aria-valuemax":o,"aria-valuemin":i,"aria-valuenow":p?void 0:e,"aria-valuetext":(()=>{if(e!=null)return typeof d=="function"?d(e,E):l})(),role:_},percent:E,value:e}}const[FMe,jMe]=xi({name:"ProgressStylesContext",errorMessage:`useProgressStyles returned is 'undefined'. Seems you forgot to wrap the components in "<Progress />" `}),BMe=Bt((n,e)=>{const{min:i,max:o,value:l,isIndeterminate:d,role:p,..._}=n,E=VMe({value:l,min:i,max:o,isIndeterminate:d,role:p}),C={height:"100%",...jMe().filledTrack};return w.jsx(Nt.div,{ref:e,style:{width:`${E.percent}%`,..._.style},...E.bind,..._,__css:C})}),jy=Bt((n,e)=>{var Q;const{value:i,min:o=0,max:l=100,hasStripe:d,isAnimated:p,children:_,borderRadius:E,isIndeterminate:b,"aria-label":C,"aria-labelledby":I,"aria-valuetext":O,title:L,role:U,...B}=Wi(n),W=rc("Progress",n),J=E??((Q=W.track)==null?void 0:Q.borderRadius),$={animation:`${UMe} 1s linear infinite`},ne={...!b&&d&&p&&$,...b&&{position:"absolute",willChange:"left",minWidth:"50%",animation:`${MMe} 1s ease infinite normal none running`}},de={overflow:"hidden",position:"relative",...W.track};return w.jsx(Nt.div,{ref:e,borderRadius:J,__css:de,...B,children:w.jsxs(FMe,{value:W,children:[w.jsx(BMe,{"aria-label":C,"aria-labelledby":I,"aria-valuetext":O,min:o,max:l,value:i,isIndeterminate:b,css:ne,borderRadius:J,title:L,role:U}),_]})})});jy.displayName="Progress";const Pre=Bt(function(e,i){const{children:o,placeholder:l,className:d,...p}=e;return w.jsxs(Nt.select,{...p,ref:i,className:dn("chakra-select",d),children:[l&&w.jsx("option",{value:"",children:l}),o]})});Pre.displayName="SelectField";const Ore=Bt((n,e)=>{var ie;const i=rc("Select",n),{rootProps:o,placeholder:l,icon:d,color:p,height:_,h:E,minH:b,minHeight:C,iconColor:I,iconSize:O,...L}=Wi(n),[U,B]=$Ee(L,dSe),W=Bj(B),J={width:"100%",height:"fit-content",position:"relative",color:p},$={paddingEnd:"2rem",...i.field,_focus:{zIndex:"unset",...(ie=i.field)==null?void 0:ie._focus}};return w.jsxs(Nt.div,{className:"chakra-select__wrapper",__css:J,...U,...o,children:[w.jsx(Pre,{ref:e,height:E??_,minH:b??C,placeholder:l,...W,__css:$,children:n.children}),w.jsx(kre,{"data-disabled":er(W.disabled),...(I||p)&&{color:I||p},__css:i.icon,...O&&{fontSize:O},children:d})]})});Ore.displayName="Select";const WMe=n=>w.jsx("svg",{viewBox:"0 0 24 24",...n,children:w.jsx("path",{fill:"currentColor",d:"M16.59 8.59L12 13.17 7.41 8.59 6 10l6 6 6-6z"})}),zMe=Nt("div",{baseStyle:{position:"absolute",display:"inline-flex",alignItems:"center",justifyContent:"center",pointerEvents:"none",top:"50%",transform:"translateY(-50%)"}}),kre=n=>{const{children:e=w.jsx(WMe,{}),...i}=n,o=N.cloneElement(e,{role:"presentation",className:"chakra-select__icon",focusable:!1,"aria-hidden":!0,style:{width:"1em",height:"1em",color:"currentColor"}});return w.jsx(zMe,{...i,className:"chakra-select__icon-wrapper",children:N.isValidElement(e)?o:null})};kre.displayName="SelectIcon";function vU(n){const{orientation:e,vertical:i,horizontal:o}=n;return e==="vertical"?i:o}function GMe(n){const{orientation:e,thumbPercents:i,isReversed:o}=n,l=L=>({position:"absolute",userSelect:"none",WebkitUserSelect:"none",MozUserSelect:"none",msUserSelect:"none",touchAction:"none",...vU({orientation:e,vertical:{bottom:`calc(${i[L]}% - var(--slider-thumb-size) / 2)`},horizontal:{left:`calc(${i[L]}% - var(--slider-thumb-size) / 2)`}})}),d={position:"relative",touchAction:"none",WebkitTapHighlightColor:"rgba(0,0,0,0)",userSelect:"none",outline:0},p={position:"absolute",...vU({orientation:e,vertical:{left:"50%",transform:"translateX(-50%)",height:"100%"},horizontal:{top:"50%",transform:"translateY(-50%)",width:"100%"}})},_=i.length===1,E=[0,o?100-i[0]:i[0]],b=_?E:i;let C=b[0];!_&&o&&(C=100-C);const I=Math.abs(b[b.length-1]-b[0]),O={...p,...vU({orientation:e,vertical:o?{height:`${I}%`,top:`${C}%`}:{height:`${I}%`,bottom:`${C}%`},horizontal:o?{width:`${I}%`,right:`${C}%`}:{width:`${I}%`,left:`${C}%`}})};return{trackStyle:p,innerTrackStyle:O,rootStyle:d,getThumbStyle:l}}function HMe(n){const{isReversed:e,direction:i,orientation:o}=n;return i==="ltr"||o==="vertical"?e:!e}function $Me(n){const{min:e=0,max:i=100,onChange:o,value:l,defaultValue:d,isReversed:p,direction:_="ltr",orientation:E="horizontal",id:b,isDisabled:C,isReadOnly:I,onChangeStart:O,onChangeEnd:L,step:U=1,getAriaValueText:B,"aria-valuetext":W,"aria-label":J,"aria-labelledby":$,name:ie,focusThumbOnChange:ce=!0,...ne}=n,de=$s(O),Q=$s(L),Z=$s(B),X=HMe({isReversed:p,direction:_,orientation:E}),[re,pe]=NZ({value:l,defaultValue:d??qMe(e,i),onChange:o}),[he,ue]=N.useState(!1),[xe,We]=N.useState(!1),$e=!(C||I),ve=(i-e)/10,_e=U||(i-e)/100,Ee=QO(re,e,i),ke=i-Ee+e,be=UK(X?ke:Ee,e,i),Pe=E==="vertical",Le=MZ({min:e,max:i,step:U,isDisabled:C,value:Ee,isInteractive:$e,isReversed:X,isVertical:Pe,eventSource:null,focusThumbOnChange:ce,orientation:E}),ze=N.useRef(null),Je=N.useRef(null),et=N.useRef(null),ut=N.useId(),rt=b??ut,[It,pn]=[`slider-thumb-${rt}`,`slider-track-${rt}`],Ft=N.useCallback(Dt=>{var Js;if(!ze.current)return;const Ut=Le.current;Ut.eventSource="pointer";const gn=ze.current.getBoundingClientRect(),{clientX:Li,clientY:Es}=((Js=Dt.touches)==null?void 0:Js[0])??Dt,ci=Pe?gn.bottom-Es:Li-gn.left,qo=Pe?gn.height:gn.width;let ic=ci/qo;X&&(ic=1-ic);let Xs=WEe(ic,Ut.min,Ut.max);return Ut.step&&(Xs=parseFloat(VK(Xs,Ut.min,Ut.step))),Xs=QO(Xs,Ut.min,Ut.max),Xs},[Pe,X,Le]),an=N.useCallback(Dt=>{const Ut=Le.current;Ut.isInteractive&&(Dt=parseFloat(VK(Dt,Ut.min,_e)),Dt=QO(Dt,Ut.min,Ut.max),pe(Dt))},[_e,pe,Le]),en=N.useMemo(()=>({stepUp(Dt=_e){const Ut=X?Ee-Dt:Ee+Dt;an(Ut)},stepDown(Dt=_e){const Ut=X?Ee+Dt:Ee-Dt;an(Ut)},reset(){an(d||0)},stepTo(Dt){an(Dt)}}),[an,X,Ee,_e,d]),Xt=N.useCallback(Dt=>{const Ut=Le.current,Li={ArrowRight:()=>en.stepUp(),ArrowUp:()=>en.stepUp(),ArrowLeft:()=>en.stepDown(),ArrowDown:()=>en.stepDown(),PageUp:()=>en.stepUp(ve),PageDown:()=>en.stepDown(ve),Home:()=>an(Ut.min),End:()=>an(Ut.max)}[Dt.key];Li&&(Dt.preventDefault(),Dt.stopPropagation(),Li(Dt),Ut.eventSource="keyboard")},[en,an,ve,Le]),Vn=(Z==null?void 0:Z(Ee))??W,{getThumbStyle:Kt,rootStyle:Re,trackStyle:Ve,innerTrackStyle:Ge}=N.useMemo(()=>{const Dt=Le.current;return GMe({isReversed:X,orientation:Dt.orientation,thumbPercents:[be]})},[X,be,Le]),ft=N.useCallback(()=>{Le.current.focusThumbOnChange&&setTimeout(()=>{var Ut;return(Ut=Je.current)==null?void 0:Ut.focus()})},[Le]);Wp(()=>{const Dt=Le.current;ft(),Dt.eventSource==="keyboard"&&(Q==null||Q(Dt.value))},[Ee,Q]);function gt(Dt){const Ut=Ft(Dt);Ut!=null&&Ut!==Le.current.value&&pe(Ut)}kve(et,{onPanSessionStart(Dt){const Ut=Le.current;Ut.isInteractive&&(ue(!0),ft(),gt(Dt),de==null||de(Ut.value))},onPanSessionEnd(){const Dt=Le.current;Dt.isInteractive&&(ue(!1),Q==null||Q(Dt.value))},onPan(Dt){Le.current.isInteractive&&gt(Dt)}});const St=N.useCallback((Dt={},Ut=null)=>({...Dt,...ne,ref:Bi(Ut,et),tabIndex:-1,"aria-disabled":xp(C),"data-focused":er(xe),style:{...Dt.style,...Re}}),[ne,C,xe,Re]),Wt=N.useCallback((Dt={},Ut=null)=>({...Dt,ref:Bi(Ut,ze),id:pn,"data-disabled":er(C),style:{...Dt.style,...Ve}}),[C,pn,Ve]),mn=N.useCallback((Dt={},Ut=null)=>({...Dt,ref:Ut,style:{...Dt.style,...Ge}}),[Ge]),vn=N.useCallback((Dt={},Ut=null)=>({...Dt,ref:Bi(Ut,Je),role:"slider",tabIndex:$e?0:void 0,id:It,"data-active":er(he),"aria-valuetext":Vn,"aria-valuemin":e,"aria-valuemax":i,"aria-valuenow":Ee,"aria-orientation":E,"aria-disabled":xp(C),"aria-readonly":xp(I),"aria-label":J,"aria-labelledby":J?void 0:$,style:{...Dt.style,...Kt(0)},onKeyDown:kn(Dt.onKeyDown,Xt),onFocus:kn(Dt.onFocus,()=>We(!0)),onBlur:kn(Dt.onBlur,()=>We(!1))}),[$e,It,he,Vn,e,i,Ee,E,C,I,J,$,Kt,Xt]),tn=N.useCallback((Dt,Ut=null)=>{const gn=!(Dt.value<e||Dt.value>i),Li=Ee>=Dt.value,Es=UK(Dt.value,e,i),ci={position:"absolute",pointerEvents:"none",...KMe({orientation:E,vertical:{bottom:X?`${100-Es}%`:`${Es}%`},horizontal:{left:X?`${100-Es}%`:`${Es}%`}})};return{...Dt,ref:Ut,role:"presentation","aria-hidden":!0,"data-disabled":er(C),"data-invalid":er(!gn),"data-highlighted":er(Li),style:{...Dt.style,...ci}}},[C,X,i,e,E,Ee]),vt=N.useCallback((Dt={},Ut=null)=>({...Dt,ref:Ut,type:"hidden",value:Ee,name:ie}),[ie,Ee]);return{state:{value:Ee,isFocused:xe,isDragging:he},actions:en,getRootProps:St,getTrackProps:Wt,getInnerTrackProps:mn,getThumbProps:vn,getMarkerProps:tn,getInputProps:vt}}function KMe(n){const{orientation:e,vertical:i,horizontal:o}=n;return e==="vertical"?i:o}function qMe(n,e){return e<n?n:n+(e-n)/2}const[YMe,eN]=xi({name:"SliderContext",hookName:"useSliderContext",providerName:"<Slider />"}),[XMe,tN]=xi({name:"SliderStylesContext",hookName:"useSliderStyles",providerName:"<Slider />"}),BV=Bt((n,e)=>{const i={...n,orientation:(n==null?void 0:n.orientation)??"horizontal"},o=rc("Slider",i),l=Wi(i),{direction:d}=K0();l.direction=d;const{getInputProps:p,getRootProps:_,...E}=$Me(l),b=_(),C=p({},e);return w.jsx(YMe,{value:E,children:w.jsx(XMe,{value:o,children:w.jsxs(Nt.div,{...b,className:dn("chakra-slider",i.className),__css:o.container,children:[i.children,w.jsx("input",{...C})]})})})});BV.displayName="Slider";const WV=Bt((n,e)=>{const{getThumbProps:i}=eN(),o=tN(),l=i(n,e);return w.jsx(Nt.div,{...l,className:dn("chakra-slider__thumb",n.className),__css:o.thumb})});WV.displayName="SliderThumb";const zV=Bt((n,e)=>{const{getTrackProps:i}=eN(),o=tN(),l=i(n,e);return w.jsx(Nt.div,{...l,className:dn("chakra-slider__track",n.className),__css:o.track})});zV.displayName="SliderTrack";const GV=Bt((n,e)=>{const{getInnerTrackProps:i}=eN(),o=tN(),l=i(n,e);return w.jsx(Nt.div,{...l,className:dn("chakra-slider__filled-track",n.className),__css:o.filledTrack})});GV.displayName="SliderFilledTrack";const JMe=Bt((n,e)=>{const{getMarkerProps:i}=eN(),o=tN(),l=i(n,e);return w.jsx(Nt.div,{...l,className:dn("chakra-slider__marker",n.className),__css:o.mark})});JMe.displayName="SliderMark";const Zk=Nt("div",{baseStyle:{flex:1,justifySelf:"stretch",alignSelf:"stretch"}});Zk.displayName="Spacer";const Nre=n=>w.jsx(Nt.div,{className:"chakra-stack__item",...n,__css:{display:"inline-block",flex:"0 0 auto",minWidth:0,...n.__css}});Nre.displayName="StackItem";function QMe(n){const{spacing:e,direction:i}=n,o={column:{my:e,mx:0,borderLeftWidth:0,borderBottomWidth:"1px"},"column-reverse":{my:e,mx:0,borderLeftWidth:0,borderBottomWidth:"1px"},row:{mx:e,my:0,borderLeftWidth:"1px",borderBottomWidth:0},"row-reverse":{mx:e,my:0,borderLeftWidth:"1px",borderBottomWidth:0}};return{"&":k1(i,l=>o[l])}}const h4=Bt((n,e)=>{const{isInline:i,direction:o,align:l,justify:d,spacing:p="0.5rem",wrap:_,children:E,divider:b,className:C,shouldWrapChildren:I,...O}=n,L=i?"row":o??"column",U=N.useMemo(()=>QMe({spacing:p,direction:L}),[p,L]),B=!!b,W=!I&&!B,J=N.useMemo(()=>{const ie=xF(E);return W?ie:ie.map((ce,ne)=>{const de=typeof ce.key<"u"?ce.key:ne,Q=ne+1===ie.length,X=I?w.jsx(Nre,{children:ce},de):ce;if(!B)return X;const re=N.cloneElement(b,{__css:U}),pe=Q?null:re;return w.jsxs(N.Fragment,{children:[X,pe]},de)})},[b,U,B,W,I,E]),$=dn("chakra-stack",C);return w.jsx(Nt.div,{ref:e,display:"flex",alignItems:l,justifyContent:d,flexDirection:L,flexWrap:_,gap:B?void 0:p,className:$,...O,children:J})});h4.displayName="Stack";const pi=Bt((n,e)=>w.jsx(h4,{align:"center",...n,direction:"row",ref:e}));pi.displayName="HStack";const Qr=Bt((n,e)=>w.jsx(h4,{align:"center",...n,direction:"column",ref:e}));Qr.displayName="VStack";const cf=Bt(function(e,i){const o=rc("Switch",e),{spacing:l="0.5rem",children:d,...p}=Wi(e),{getIndicatorProps:_,getInputProps:E,getCheckboxProps:b,getRootProps:C,getLabelProps:I}=JNe(p),O=N.useMemo(()=>({display:"inline-block",position:"relative",verticalAlign:"middle",lineHeight:0,...o.container}),[o.container]),L=N.useMemo(()=>({display:"inline-flex",flexShrink:0,justifyContent:"flex-start",boxSizing:"content-box",cursor:"pointer",...o.track}),[o.track]),U=N.useMemo(()=>({userSelect:"none",marginStart:l,...o.label}),[l,o.label]);return w.jsxs(Nt.label,{...C(),className:dn("chakra-switch",e.className),__css:O,children:[w.jsx("input",{className:"chakra-switch__input",...E({},i)}),w.jsx(Nt.span,{...b(),className:"chakra-switch__track",__css:L,children:w.jsx(Nt.span,{__css:o.thumb,className:"chakra-switch__thumb",..._()})}),d&&w.jsx(Nt.span,{className:"chakra-switch__label",...I(),__css:U,children:d})]})});cf.displayName="Switch";const[ZMe,eUe,tUe,nUe]=sne();function rUe(n){const{defaultIndex:e,onChange:i,index:o,isManual:l,isLazy:d,lazyBehavior:p="unmount",orientation:_="horizontal",direction:E="ltr",...b}=n,[C,I]=N.useState(e??0),[O,L]=NZ({defaultValue:e??0,value:o,onChange:i});N.useEffect(()=>{o!=null&&I(o)},[o]);const U=tUe(),B=N.useId();return{id:`tabs-${n.id??B}`,selectedIndex:O,focusedIndex:C,setSelectedIndex:L,setFocusedIndex:I,isManual:l,isLazy:d,lazyBehavior:p,orientation:_,descendants:U,direction:E,htmlProps:b}}const[iUe,nN]=xi({name:"TabsContext",errorMessage:"useTabsContext: `context` is undefined. Seems you forgot to wrap all tabs components within <Tabs />"});function sUe(n){const{focusedIndex:e,orientation:i,direction:o}=nN(),l=eUe(),d=N.useCallback(p=>{const _=()=>{var ie;const $=l.nextEnabled(e);$&&((ie=$.node)==null||ie.focus())},E=()=>{var ie;const $=l.prevEnabled(e);$&&((ie=$.node)==null||ie.focus())},b=()=>{var ie;const $=l.firstEnabled();$&&((ie=$.node)==null||ie.focus())},C=()=>{var ie;const $=l.lastEnabled();$&&((ie=$.node)==null||ie.focus())},I=i==="horizontal",O=i==="vertical",L=p.key,U=o==="ltr"?"ArrowLeft":"ArrowRight",B=o==="ltr"?"ArrowRight":"ArrowLeft",J={[U]:()=>I&&E(),[B]:()=>I&&_(),ArrowDown:()=>O&&_(),ArrowUp:()=>O&&E(),Home:b,End:C}[L];J&&(p.preventDefault(),J(p))},[l,e,i,o]);return{...n,role:"tablist","aria-orientation":i,onKeyDown:kn(n.onKeyDown,d)}}function oUe(n){const{isDisabled:e=!1,isFocusable:i=!1,...o}=n,{setSelectedIndex:l,isManual:d,id:p,setFocusedIndex:_,selectedIndex:E}=nN(),{index:b,register:C}=nUe({disabled:e&&!i}),I=b===E,O=()=>{l(b)},L=()=>{_(b),!d&&!(e&&i)&&l(b)};return{...sre({...o,ref:Bi(C,n.ref),isDisabled:e,isFocusable:i,onClick:kn(n.onClick,O)}),id:Dre(p,b),role:"tab",tabIndex:I?0:-1,type:"button","aria-selected":I,"aria-controls":xre(p,b),onFocus:e?void 0:kn(n.onFocus,L)}}const[aUe,cUe]=xi({});function lUe(n){const e=nN(),{id:i,selectedIndex:o}=e,d=xF(n.children).map((p,_)=>N.createElement(aUe,{key:p.key??_,value:{isSelected:_===o,id:xre(i,_),tabId:Dre(i,_),selectedIndex:o}},p));return{...n,children:d}}function uUe(n){const{children:e,...i}=n,{isLazy:o,lazyBehavior:l}=nN(),{isSelected:d,id:p,tabId:_}=cUe(),E=N.useRef(!1);d&&(E.current=!0);const b=LF({wasSelected:E.current,isSelected:d,enabled:o,mode:l});return{tabIndex:0,...i,children:b?e:null,role:"tabpanel","aria-labelledby":_,hidden:!d,id:p}}function Dre(n,e){return`${n}--tab-${e}`}function xre(n,e){return`${n}--tabpanel-${e}`}const[dUe,rN]=xi({name:"TabsStylesContext",errorMessage:`useTabsStyles returned is 'undefined'. Seems you forgot to wrap the components in "<Tabs />" `}),A0=Bt(function(e,i){const o=rc("Tabs",e),{children:l,className:d,...p}=Wi(e),{htmlProps:_,descendants:E,...b}=rUe(p),C=N.useMemo(()=>b,[b]),{isFitted:I,...O}=_,L={position:"relative",...o.root};return w.jsx(ZMe,{value:E,children:w.jsx(iUe,{value:C,children:w.jsx(dUe,{value:o,children:w.jsx(Nt.div,{className:dn("chakra-tabs",d),ref:i,...O,__css:L,children:l})})})})});A0.displayName="Tabs";const Sa=Bt(function(e,i){const o=rN(),l=oUe({...e,ref:i}),d={outline:"0",display:"flex",alignItems:"center",justifyContent:"center",...o.tab};return w.jsx(Nt.button,{...l,className:dn("chakra-tabs__tab",e.className),__css:d})});Sa.displayName="Tab";const P0=Bt(function(e,i){const o=sUe({...e,ref:i}),l=rN(),d={display:"flex",...l.tablist};return w.jsx(Nt.div,{...o,className:dn("chakra-tabs__tablist",e.className),__css:d})});P0.displayName="TabList";const Tc=Bt(function(e,i){const o=uUe({...e,ref:i}),l=rN();return w.jsx(Nt.div,{outline:"0",...o,className:dn("chakra-tabs__tab-panel",e.className),__css:l.tabpanel})});Tc.displayName="TabPanel";const BC=Bt(function(e,i){const o=lUe(e),l=rN();return w.jsx(Nt.div,{...o,width:"100%",ref:i,className:dn("chakra-tabs__tab-panels",e.className),__css:l.tabpanels})});BC.displayName="TabPanels";const[hUe,Lre]=xi({name:"TagStylesContext",errorMessage:`useTagStyles returned is 'undefined'. Seems you forgot to wrap the components in "<Tag />" `}),Mre=Bt((n,e)=>{const i=rc("Tag",n),o=Wi(n),l={display:"inline-flex",verticalAlign:"top",alignItems:"center",maxWidth:"100%",...i.container};return w.jsx(hUe,{value:i,children:w.jsx(Nt.span,{ref:e,...o,__css:l})})});Mre.displayName="Tag";const Ure=Bt((n,e)=>{const i=Lre();return w.jsx(Nt.span,{ref:e,noOfLines:1,...n,__css:i.label})});Ure.displayName="TagLabel";const fUe=Bt((n,e)=>w.jsx(En,{ref:e,verticalAlign:"top",marginEnd:"0.5rem",...n}));fUe.displayName="TagLeftIcon";const pUe=Bt((n,e)=>w.jsx(En,{ref:e,verticalAlign:"top",marginStart:"0.5rem",...n}));pUe.displayName="TagRightIcon";const Vre=n=>w.jsx(En,{verticalAlign:"inherit",viewBox:"0 0 512 512",...n,children:w.jsx("path",{fill:"currentColor",d:"M289.94 256l95-95A24 24 0 00351 127l-95 95-95-95a24 24 0 00-34 34l95 95-95 95a24 24 0 1034 34l95-95 95 95a24 24 0 0034-34z"})});Vre.displayName="TagCloseIcon";const Fre=Bt((n,e)=>{const{isDisabled:i,children:o,...l}=n,p={display:"flex",alignItems:"center",justifyContent:"center",outline:"0",...Lre().closeButton};return w.jsx(Nt.button,{ref:e,"aria-label":"close",...l,type:"button",disabled:i,__css:p,children:o||w.jsx(Vre,{})})});Fre.displayName="TagCloseButton";const mUe=["h","minH","height","minHeight"],jre=Bt((n,e)=>{const i=ql("Textarea",n),{className:o,rows:l,...d}=Wi(n),p=Bj(d),_=l?W0(i,mUe):i;return w.jsx(Nt.textarea,{ref:e,rows:l,...p,className:dn("chakra-textarea",o),__css:_})});jre.displayName="Textarea";function gUe(n,e){const i=n??"bottom",l={"top-start":{ltr:"top-left",rtl:"top-right"},"top-end":{ltr:"top-right",rtl:"top-left"},"bottom-start":{ltr:"bottom-left",rtl:"bottom-right"},"bottom-end":{ltr:"bottom-right",rtl:"bottom-left"}}[i];return(l==null?void 0:l[e])??i}function _Ue(n,e){const i=l=>({...e,...l,position:gUe((l==null?void 0:l.position)??(e==null?void 0:e.position),n)}),o=l=>{const d=i(l),p=nne(d);return Kh.notify(p,d)};return o.update=(l,d)=>{Kh.update(l,i(d))},o.promise=(l,d)=>{const p=o({...d.loading,status:"loading",duration:null});l.then(_=>o.update(p,{status:"success",duration:5e3,...ul(d.success,_)})).catch(_=>o.update(p,{status:"error",duration:5e3,...ul(d.error,_)}))},o.closeAll=Kh.closeAll,o.close=Kh.close,o.isActive=Kh.isActive,o}function Ic(n){const{theme:e}=Zte(),i=TNe();return N.useMemo(()=>_Ue(e.direction,{...i,...n}),[n,e.direction,i])}const yUe={exit:{scale:.85,opacity:0,transition:{opacity:{duration:.15,easings:"easeInOut"},scale:{duration:.2,easings:"easeInOut"}}},enter:{scale:1,opacity:1,transition:{opacity:{easings:"easeOut",duration:.2},scale:{duration:.2,ease:[.175,.885,.4,1.1]}}}},HV=n=>{var e;return((e=n.current)==null?void 0:e.ownerDocument)||document},bk=n=>{var e,i;return((i=(e=n.current)==null?void 0:e.ownerDocument)==null?void 0:i.defaultView)||window};function EUe(n={}){const{openDelay:e=0,closeDelay:i=0,closeOnClick:o=!0,closeOnMouseDown:l,closeOnScroll:d,closeOnPointerDown:p=l,closeOnEsc:_=!0,onOpen:E,onClose:b,placement:C,id:I,isOpen:O,defaultIsOpen:L,arrowSize:U=10,arrowShadowColor:B,arrowPadding:W,modifiers:J,isDisabled:$,gutter:ie,offset:ce,direction:ne,...de}=n,{isOpen:Q,onOpen:Z,onClose:X}=pf({isOpen:O,defaultIsOpen:L,onOpen:E,onClose:b}),{referenceRef:re,getPopperProps:pe,getArrowInnerProps:he,getArrowProps:ue}=u4({enabled:Q,placement:C,arrowPadding:W,modifiers:J,gutter:ie,offset:ce,direction:ne}),xe=N.useId(),$e=`tooltip-${I??xe}`,ve=N.useRef(null),_e=N.useRef(void 0),Ee=N.useCallback(()=>{_e.current&&(clearTimeout(_e.current),_e.current=void 0)},[]),ke=N.useRef(void 0),Te=N.useCallback(()=>{ke.current&&(clearTimeout(ke.current),ke.current=void 0)},[]),be=N.useCallback(()=>{Te(),X()},[X,Te]),Pe=vUe(ve,be),Le=N.useCallback(()=>{if(!$&&!_e.current){Q&&Pe();const Ft=bk(ve);_e.current=Ft.setTimeout(Z,e)}},[Pe,$,Q,Z,e]),ze=N.useCallback(()=>{Ee();const Ft=bk(ve);ke.current=Ft.setTimeout(be,i)},[i,be,Ee]),Je=N.useCallback(()=>{Q&&o&&ze()},[o,ze,Q]),et=N.useCallback(()=>{Q&&p&&ze()},[p,ze,Q]),ut=N.useCallback(Ft=>{Q&&Ft.key==="Escape"&&ze()},[Q,ze]);Oy(()=>HV(ve),"keydown",_?ut:void 0),Oy(()=>{if(!d)return null;const Ft=ve.current;if(!Ft)return null;const an=OZ(Ft);return an.localName==="body"?bk(ve):an},"scroll",()=>{Q&&d&&be()},{passive:!0,capture:!0}),N.useEffect(()=>{$&&(Ee(),Q&&X())},[$,Q,X,Ee]),N.useEffect(()=>()=>{Ee(),Te()},[Ee,Te]),Oy(()=>ve.current,"pointerleave",ze);const rt=N.useCallback((Ft={},an=null)=>({...Ft,ref:Bi(ve,an,re),onPointerEnter:kn(Ft.onPointerEnter,Xt=>{Xt.pointerType!=="touch"&&Le()}),onClick:kn(Ft.onClick,Je),onPointerDown:kn(Ft.onPointerDown,et),onFocus:kn(Ft.onFocus,Le),onBlur:kn(Ft.onBlur,ze),"aria-describedby":Q?$e:void 0}),[Le,ze,et,Q,$e,Je,re]),It=N.useCallback((Ft={},an=null)=>pe({...Ft,style:{...Ft.style,[io.arrowSize.var]:U?`${U}px`:void 0,[io.arrowShadowColor.var]:B}},an),[pe,U,B]),pn=N.useCallback((Ft={},an=null)=>{const en={...Ft.style,position:"relative",transformOrigin:io.transformOrigin.varRef};return{ref:an,...de,...Ft,id:$e,role:"tooltip",style:en}},[de,$e]);return{isOpen:Q,show:Le,hide:ze,getTriggerProps:rt,getTooltipProps:pn,getTooltipPositionerProps:It,getArrowProps:ue,getArrowInnerProps:he}}const SU="chakra-ui:close-tooltip";function vUe(n,e){return N.useEffect(()=>{const i=HV(n);return i.addEventListener(SU,e),()=>i.removeEventListener(SU,e)},[e,n]),()=>{const i=HV(n),o=bk(n);i.dispatchEvent(new o.CustomEvent(SU))}}const SUe=Nt(_f.div),Vp=Bt((n,e)=>{const i=ql("Tooltip",n),o=Wi(n),l=K0(),{children:d,label:p,shouldWrapChildren:_,"aria-label":E,hasArrow:b,bg:C,portalProps:I,background:O,backgroundColor:L,bgColor:U,motionProps:B,animatePresenceProps:W,...J}=o,$=O??L??C??U;if($){i.bg=$;const re=SSe(l,"colors",$);i[io.arrowBg.var]=re}const ie=EUe({...J,direction:l.direction}),ce=!N.isValidElement(d)||_;let ne;if(ce)ne=w.jsx(Nt.span,{display:"inline-block",tabIndex:0,...ie.getTriggerProps(),children:d});else{const re=N.Children.only(d);ne=N.cloneElement(re,ie.getTriggerProps(re.props,wre(re)))}const de=!!E,Q=ie.getTooltipProps({},e),Z=de?W0(Q,["role","id"]):Q,X=PZ(Q,["role","id"]);return p?w.jsxs(w.Fragment,{children:[ne,w.jsx(G0,{...W,children:ie.isOpen&&w.jsx(Yl,{...I,children:w.jsx(Nt.div,{...ie.getTooltipPositionerProps(),__css:{zIndex:i.zIndex,pointerEvents:"none"},children:w.jsxs(SUe,{variants:yUe,initial:"exit",animate:"enter",exit:"exit",...B,...Z,__css:i,children:[p,de&&w.jsx(Nt.span,{srOnly:!0,...X,children:E}),b&&w.jsx(Nt.div,{"data-popper-arrow":!0,className:"chakra-tooltip__arrow-wrapper",children:w.jsx(Nt.div,{"data-popper-arrow-inner":!0,className:"chakra-tooltip__arrow",__css:{bg:i.bg}})})]})})})})]}):w.jsx(w.Fragment,{children:d})});Vp.displayName="Tooltip";const WC=Bt(function(e,i){const o=ql("Heading",e),{className:l,...d}=Wi(e);return w.jsx(Nt.h2,{ref:i,className:dn("chakra-heading",e.className),...d,__css:o})});WC.displayName="Heading";const Ze=Bt(function(e,i){const o=ql("Text",e),{className:l,align:d,decoration:p,casing:_,...E}=Wi(e),b=O1({textAlign:e.align,textDecoration:e.decoration,textTransform:e.casing});return w.jsx(Nt.p,{ref:i,className:dn("chakra-text",e.className),...b,...E,__css:o})});Ze.displayName="Text";const Bre=Bt(function(e,i){const{spacing:o="0.5rem",spacingX:l,spacingY:d,children:p,justify:_,direction:E,align:b,className:C,shouldWrapChildren:I,...O}=e,L=N.useMemo(()=>I?N.Children.map(p,(U,B)=>w.jsx(f4,{children:U},B)):p,[p,I]);return w.jsx(Nt.div,{ref:i,className:dn("chakra-wrap",C),...O,children:w.jsx(Nt.ul,{className:"chakra-wrap__list",__css:{display:"flex",flexWrap:"wrap",justifyContent:_,alignItems:b,flexDirection:E,listStyleType:"none",gap:o,columnGap:l,rowGap:d,padding:"0"},children:L})})});Bre.displayName="Wrap";const f4=Bt(function(e,i){const{className:o,...l}=e;return w.jsx(Nt.li,{ref:i,__css:{display:"flex",alignItems:"flex-start"},className:dn("chakra-wrap__listitem",o),...l})});f4.displayName="WrapItem";const bUe="modulepreload",TUe=function(n,e){return new URL(n,e).href},NX={},bU=function(e,i,o){let l=Promise.resolve();if(i&&i.length>0){const p=document.getElementsByTagName("link"),_=document.querySelector("meta[property=csp-nonce]"),E=(_==null?void 0:_.nonce)||(_==null?void 0:_.getAttribute("nonce"));l=Promise.allSettled(i.map(b=>{if(b=TUe(b,o),b in NX)return;NX[b]=!0;const C=b.endsWith(".css"),I=C?'[rel="stylesheet"]':"";if(!!o)for(let U=p.length-1;U>=0;U--){const B=p[U];if(B.href===b&&(!C||B.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${b}"]${I}`))return;const L=document.createElement("link");if(L.rel=C?"stylesheet":bUe,C||(L.as="script"),L.crossOrigin="",L.href=b,E&&L.setAttribute("nonce",E),document.head.appendChild(L),C)return new Promise((U,B)=>{L.addEventListener("load",U),L.addEventListener("error",()=>B(new Error(`Unable to preload CSS for ${b}`)))})}))}function d(p){const _=new Event("vite:preloadError",{cancelable:!0});if(_.payload=p,window.dispatchEvent(_),!_.defaultPrevented)throw p}return l.then(p=>{for(const _ of p||[])_.status==="rejected"&&d(_.reason);return e().catch(d)})},UO=()=>{const n=new Date,e=n.getHours().toString().padStart(2,"0"),i=n.getMinutes().toString().padStart(2,"0"),o=n.getSeconds().toString().padStart(2,"0"),l=n.getMilliseconds().toString().padStart(3,"0");return`${e}:${i}:${o}.${l}`},q={log:(...n)=>{{const e=n.map((i,o)=>o===0&&typeof i=="string"?`
${i}`:i);console.log(`[LOG] [${UO()}] `,...e)}},error:(...n)=>{{const e=n.map((i,o)=>o===0&&typeof i=="string"?`
${i}`:i);console.error(`[ERROR] [${UO()}] `,...e)}},warn:(...n)=>{{const e=n.map((i,o)=>o===0&&typeof i=="string"?`
${i}`:i);console.warn(`[WARN] [${UO()}]`,...e)}},trace:n=>{console.trace(`[TRACE] [${UO()}] ${n}`)}};async function zC(n){let e;try{switch(n){case"default":e=await bU(()=>import("./index.v0.1.5.js"),[],import.meta.url);break;default:e=await bU(()=>import("./index.v0.1.5.js"),[],import.meta.url)}return e.default}catch(i){return q.error("Failed to load theme:",i),e=await bU(()=>import("./index.v0.1.5.js"),[],import.meta.url),e.default}}const wUe=()=>{};var DX={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Wre=function(n){const e=[];let i=0;for(let o=0;o<n.length;o++){let l=n.charCodeAt(o);l<128?e[i++]=l:l<2048?(e[i++]=l>>6|192,e[i++]=l&63|128):(l&64512)===55296&&o+1<n.length&&(n.charCodeAt(o+1)&64512)===56320?(l=65536+((l&1023)<<10)+(n.charCodeAt(++o)&1023),e[i++]=l>>18|240,e[i++]=l>>12&63|128,e[i++]=l>>6&63|128,e[i++]=l&63|128):(e[i++]=l>>12|224,e[i++]=l>>6&63|128,e[i++]=l&63|128)}return e},CUe=function(n){const e=[];let i=0,o=0;for(;i<n.length;){const l=n[i++];if(l<128)e[o++]=String.fromCharCode(l);else if(l>191&&l<224){const d=n[i++];e[o++]=String.fromCharCode((l&31)<<6|d&63)}else if(l>239&&l<365){const d=n[i++],p=n[i++],_=n[i++],E=((l&7)<<18|(d&63)<<12|(p&63)<<6|_&63)-65536;e[o++]=String.fromCharCode(55296+(E>>10)),e[o++]=String.fromCharCode(56320+(E&1023))}else{const d=n[i++],p=n[i++];e[o++]=String.fromCharCode((l&15)<<12|(d&63)<<6|p&63)}}return e.join("")},zre={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const i=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,o=[];for(let l=0;l<n.length;l+=3){const d=n[l],p=l+1<n.length,_=p?n[l+1]:0,E=l+2<n.length,b=E?n[l+2]:0,C=d>>2,I=(d&3)<<4|_>>4;let O=(_&15)<<2|b>>6,L=b&63;E||(L=64,p||(O=64)),o.push(i[C],i[I],i[O],i[L])}return o.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(Wre(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):CUe(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();const i=e?this.charToByteMapWebSafe_:this.charToByteMap_,o=[];for(let l=0;l<n.length;){const d=i[n.charAt(l++)],_=l<n.length?i[n.charAt(l)]:0;++l;const b=l<n.length?i[n.charAt(l)]:64;++l;const I=l<n.length?i[n.charAt(l)]:64;if(++l,d==null||_==null||b==null||I==null)throw new RUe;const O=d<<2|_>>4;if(o.push(O),b!==64){const L=_<<4&240|b>>2;if(o.push(L),I!==64){const U=b<<6&192|I;o.push(U)}}}return o},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class RUe extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const IUe=function(n){const e=Wre(n);return zre.encodeByteArray(e,!0)},e1=function(n){return IUe(n).replace(/\./g,"")},Gre=function(n){try{return zre.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function AUe(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const PUe=()=>AUe().__FIREBASE_DEFAULTS__,OUe=()=>{if(typeof process>"u"||typeof DX>"u")return;const n=DX.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},kUe=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=n&&Gre(n[1]);return e&&JSON.parse(e)},iN=()=>{try{return wUe()||PUe()||OUe()||kUe()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},Hre=n=>{var e,i;return(i=(e=iN())===null||e===void 0?void 0:e.emulatorHosts)===null||i===void 0?void 0:i[n]},$re=n=>{const e=Hre(n);if(!e)return;const i=e.lastIndexOf(":");if(i<=0||i+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const o=parseInt(e.substring(i+1),10);return e[0]==="["?[e.substring(1,i-1),o]:[e.substring(0,i),o]},Kre=()=>{var n;return(n=iN())===null||n===void 0?void 0:n.config},qre=n=>{var e;return(e=iN())===null||e===void 0?void 0:e[`_${n}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class NUe{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,i)=>{this.resolve=e,this.reject=i})}wrapCallback(e){return(i,o)=>{i?this.reject(i):this.resolve(o),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(i):e(i,o))}}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Yre(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const i={alg:"none",type:"JWT"},o=e||"demo-project",l=n.iat||0,d=n.sub||n.user_id;if(!d)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const p=Object.assign({iss:`https://securetoken.google.com/${o}`,aud:o,iat:l,exp:l+3600,auth_time:l,sub:d,user_id:d,firebase:{sign_in_provider:"custom",identities:{}}},n);return[e1(JSON.stringify(i)),e1(JSON.stringify(p)),""].join(".")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nc(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function DUe(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(nc())}function xUe(){var n;const e=(n=iN())===null||n===void 0?void 0:n.forceEnvironment;if(e==="node")return!0;if(e==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function LUe(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function MUe(){const n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function UUe(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function VUe(){const n=nc();return n.indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0}function FUe(){return!xUe()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function jUe(){try{return typeof indexedDB=="object"}catch{return!1}}function BUe(){return new Promise((n,e)=>{try{let i=!0;const o="validate-browser-context-for-indexeddb-analytics-module",l=self.indexedDB.open(o);l.onsuccess=()=>{l.result.close(),i||self.indexedDB.deleteDatabase(o),n(!0)},l.onupgradeneeded=()=>{i=!1},l.onerror=()=>{var d;e(((d=l.error)===null||d===void 0?void 0:d.message)||"")}}catch(i){e(i)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const WUe="FirebaseError";class Ef extends Error{constructor(e,i,o){super(i),this.code=e,this.customData=o,this.name=WUe,Object.setPrototypeOf(this,Ef.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,yR.prototype.create)}}class yR{constructor(e,i,o){this.service=e,this.serviceName=i,this.errors=o}create(e,...i){const o=i[0]||{},l=`${this.service}/${e}`,d=this.errors[e],p=d?zUe(d,o):"Error",_=`${this.serviceName}: ${p} (${l}).`;return new Ef(l,_,o)}}function zUe(n,e){return n.replace(GUe,(i,o)=>{const l=e[o];return l!=null?String(l):`<${o}?>`})}const GUe=/\{\$([^}]+)}/g;function HUe(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function Kp(n,e){if(n===e)return!0;const i=Object.keys(n),o=Object.keys(e);for(const l of i){if(!o.includes(l))return!1;const d=n[l],p=e[l];if(xX(d)&&xX(p)){if(!Kp(d,p))return!1}else if(d!==p)return!1}for(const l of o)if(!i.includes(l))return!1;return!0}function xX(n){return n!==null&&typeof n=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ER(n){const e=[];for(const[i,o]of Object.entries(n))Array.isArray(o)?o.forEach(l=>{e.push(encodeURIComponent(i)+"="+encodeURIComponent(l))}):e.push(encodeURIComponent(i)+"="+encodeURIComponent(o));return e.length?"&"+e.join("&"):""}function Jw(n){const e={};return n.replace(/^\?/,"").split("&").forEach(o=>{if(o){const[l,d]=o.split("=");e[decodeURIComponent(l)]=decodeURIComponent(d)}}),e}function Qw(n){const e=n.indexOf("?");if(!e)return"";const i=n.indexOf("#",e);return n.substring(e,i>0?i:void 0)}function $Ue(n,e){const i=new KUe(n,e);return i.subscribe.bind(i)}class KUe{constructor(e,i){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=i,this.task.then(()=>{e(this)}).catch(o=>{this.error(o)})}next(e){this.forEachObserver(i=>{i.next(e)})}error(e){this.forEachObserver(i=>{i.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,i,o){let l;if(e===void 0&&i===void 0&&o===void 0)throw new Error("Missing Observer.");qUe(e,["next","error","complete"])?l=e:l={next:e,error:i,complete:o},l.next===void 0&&(l.next=TU),l.error===void 0&&(l.error=TU),l.complete===void 0&&(l.complete=TU);const d=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?l.error(this.finalError):l.complete()}catch{}}),this.observers.push(l),d}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let i=0;i<this.observers.length;i++)this.sendOne(i,e)}sendOne(e,i){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{i(this.observers[e])}catch(o){typeof console<"u"&&console.error&&console.error(o)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function qUe(n,e){if(typeof n!="object"||n===null)return!1;for(const i of e)if(i in n&&typeof n[i]=="function")return!0;return!1}function TU(){}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qi(n){return n&&n._delegate?n._delegate:n}class xg{constructor(e,i,o){this.name=e,this.instanceFactory=i,this.type=o,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ey="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class YUe{constructor(e,i){this.name=e,this.container=i,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const i=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(i)){const o=new NUe;if(this.instancesDeferred.set(i,o),this.isInitialized(i)||this.shouldAutoInitialize())try{const l=this.getOrInitializeService({instanceIdentifier:i});l&&o.resolve(l)}catch{}}return this.instancesDeferred.get(i).promise}getImmediate(e){var i;const o=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),l=(i=e==null?void 0:e.optional)!==null&&i!==void 0?i:!1;if(this.isInitialized(o)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:o})}catch(d){if(l)return null;throw d}else{if(l)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(JUe(e))try{this.getOrInitializeService({instanceIdentifier:Ey})}catch{}for(const[i,o]of this.instancesDeferred.entries()){const l=this.normalizeInstanceIdentifier(i);try{const d=this.getOrInitializeService({instanceIdentifier:l});o.resolve(d)}catch{}}}}clearInstance(e=Ey){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(i=>"INTERNAL"in i).map(i=>i.INTERNAL.delete()),...e.filter(i=>"_delete"in i).map(i=>i._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=Ey){return this.instances.has(e)}getOptions(e=Ey){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:i={}}=e,o=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(o))throw Error(`${this.name}(${o}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const l=this.getOrInitializeService({instanceIdentifier:o,options:i});for(const[d,p]of this.instancesDeferred.entries()){const _=this.normalizeInstanceIdentifier(d);o===_&&p.resolve(l)}return l}onInit(e,i){var o;const l=this.normalizeInstanceIdentifier(i),d=(o=this.onInitCallbacks.get(l))!==null&&o!==void 0?o:new Set;d.add(e),this.onInitCallbacks.set(l,d);const p=this.instances.get(l);return p&&e(p,l),()=>{d.delete(e)}}invokeOnInitCallbacks(e,i){const o=this.onInitCallbacks.get(i);if(o)for(const l of o)try{l(e,i)}catch{}}getOrInitializeService({instanceIdentifier:e,options:i={}}){let o=this.instances.get(e);if(!o&&this.component&&(o=this.component.instanceFactory(this.container,{instanceIdentifier:XUe(e),options:i}),this.instances.set(e,o),this.instancesOptions.set(e,i),this.invokeOnInitCallbacks(o,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,o)}catch{}return o||null}normalizeInstanceIdentifier(e=Ey){return this.component?this.component.multipleInstances?e:Ey:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function XUe(n){return n===Ey?void 0:n}function JUe(n){return n.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class QUe{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const i=this.getProvider(e.name);if(i.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);i.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const i=new YUe(e,this);return this.providers.set(e,i),i}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Or;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(Or||(Or={}));const ZUe={debug:Or.DEBUG,verbose:Or.VERBOSE,info:Or.INFO,warn:Or.WARN,error:Or.ERROR,silent:Or.SILENT},eVe=Or.INFO,tVe={[Or.DEBUG]:"log",[Or.VERBOSE]:"log",[Or.INFO]:"info",[Or.WARN]:"warn",[Or.ERROR]:"error"},nVe=(n,e,...i)=>{if(e<n.logLevel)return;const o=new Date().toISOString(),l=tVe[e];if(l)console[l](`[${o}]  ${n.name}:`,...i);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class p4{constructor(e){this.name=e,this._logLevel=eVe,this._logHandler=nVe,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in Or))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?ZUe[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,Or.DEBUG,...e),this._logHandler(this,Or.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,Or.VERBOSE,...e),this._logHandler(this,Or.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,Or.INFO,...e),this._logHandler(this,Or.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,Or.WARN,...e),this._logHandler(this,Or.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,Or.ERROR,...e),this._logHandler(this,Or.ERROR,...e)}}const rVe=(n,e)=>e.some(i=>n instanceof i);let LX,MX;function iVe(){return LX||(LX=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function sVe(){return MX||(MX=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const Xre=new WeakMap,$V=new WeakMap,Jre=new WeakMap,wU=new WeakMap,m4=new WeakMap;function oVe(n){const e=new Promise((i,o)=>{const l=()=>{n.removeEventListener("success",d),n.removeEventListener("error",p)},d=()=>{i(Ig(n.result)),l()},p=()=>{o(n.error),l()};n.addEventListener("success",d),n.addEventListener("error",p)});return e.then(i=>{i instanceof IDBCursor&&Xre.set(i,n)}).catch(()=>{}),m4.set(e,n),e}function aVe(n){if($V.has(n))return;const e=new Promise((i,o)=>{const l=()=>{n.removeEventListener("complete",d),n.removeEventListener("error",p),n.removeEventListener("abort",p)},d=()=>{i(),l()},p=()=>{o(n.error||new DOMException("AbortError","AbortError")),l()};n.addEventListener("complete",d),n.addEventListener("error",p),n.addEventListener("abort",p)});$V.set(n,e)}let KV={get(n,e,i){if(n instanceof IDBTransaction){if(e==="done")return $V.get(n);if(e==="objectStoreNames")return n.objectStoreNames||Jre.get(n);if(e==="store")return i.objectStoreNames[1]?void 0:i.objectStore(i.objectStoreNames[0])}return Ig(n[e])},set(n,e,i){return n[e]=i,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function cVe(n){KV=n(KV)}function lVe(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...i){const o=n.call(CU(this),e,...i);return Jre.set(o,e.sort?e.sort():[e]),Ig(o)}:sVe().includes(n)?function(...e){return n.apply(CU(this),e),Ig(Xre.get(this))}:function(...e){return Ig(n.apply(CU(this),e))}}function uVe(n){return typeof n=="function"?lVe(n):(n instanceof IDBTransaction&&aVe(n),rVe(n,iVe())?new Proxy(n,KV):n)}function Ig(n){if(n instanceof IDBRequest)return oVe(n);if(wU.has(n))return wU.get(n);const e=uVe(n);return e!==n&&(wU.set(n,e),m4.set(e,n)),e}const CU=n=>m4.get(n);function dVe(n,e,{blocked:i,upgrade:o,blocking:l,terminated:d}={}){const p=indexedDB.open(n,e),_=Ig(p);return o&&p.addEventListener("upgradeneeded",E=>{o(Ig(p.result),E.oldVersion,E.newVersion,Ig(p.transaction),E)}),i&&p.addEventListener("blocked",E=>i(E.oldVersion,E.newVersion,E)),_.then(E=>{d&&E.addEventListener("close",()=>d()),l&&E.addEventListener("versionchange",b=>l(b.oldVersion,b.newVersion,b))}).catch(()=>{}),_}const hVe=["get","getKey","getAll","getAllKeys","count"],fVe=["put","add","delete","clear"],RU=new Map;function UX(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(RU.get(e))return RU.get(e);const i=e.replace(/FromIndex$/,""),o=e!==i,l=fVe.includes(i);if(!(i in(o?IDBIndex:IDBObjectStore).prototype)||!(l||hVe.includes(i)))return;const d=async function(p,..._){const E=this.transaction(p,l?"readwrite":"readonly");let b=E.store;return o&&(b=b.index(_.shift())),(await Promise.all([b[i](..._),l&&E.done]))[0]};return RU.set(e,d),d}cVe(n=>({...n,get:(e,i,o)=>UX(e,i)||n.get(e,i,o),has:(e,i)=>!!UX(e,i)||n.has(e,i)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pVe{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(i=>{if(mVe(i)){const o=i.getImmediate();return`${o.library}/${o.version}`}else return null}).filter(i=>i).join(" ")}}function mVe(n){const e=n.getComponent();return(e==null?void 0:e.type)==="VERSION"}const qV="@firebase/app",VX="0.11.3";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qp=new p4("@firebase/app"),gVe="@firebase/app-compat",_Ve="@firebase/analytics-compat",yVe="@firebase/analytics",EVe="@firebase/app-check-compat",vVe="@firebase/app-check",SVe="@firebase/auth",bVe="@firebase/auth-compat",TVe="@firebase/database",wVe="@firebase/data-connect",CVe="@firebase/database-compat",RVe="@firebase/functions",IVe="@firebase/functions-compat",AVe="@firebase/installations",PVe="@firebase/installations-compat",OVe="@firebase/messaging",kVe="@firebase/messaging-compat",NVe="@firebase/performance",DVe="@firebase/performance-compat",xVe="@firebase/remote-config",LVe="@firebase/remote-config-compat",MVe="@firebase/storage",UVe="@firebase/storage-compat",VVe="@firebase/firestore",FVe="@firebase/vertexai",jVe="@firebase/firestore-compat",BVe="firebase",WVe="11.5.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const YV="[DEFAULT]",zVe={[qV]:"fire-core",[gVe]:"fire-core-compat",[yVe]:"fire-analytics",[_Ve]:"fire-analytics-compat",[vVe]:"fire-app-check",[EVe]:"fire-app-check-compat",[SVe]:"fire-auth",[bVe]:"fire-auth-compat",[TVe]:"fire-rtdb",[wVe]:"fire-data-connect",[CVe]:"fire-rtdb-compat",[RVe]:"fire-fn",[IVe]:"fire-fn-compat",[AVe]:"fire-iid",[PVe]:"fire-iid-compat",[OVe]:"fire-fcm",[kVe]:"fire-fcm-compat",[NVe]:"fire-perf",[DVe]:"fire-perf-compat",[xVe]:"fire-rc",[LVe]:"fire-rc-compat",[MVe]:"fire-gcs",[UVe]:"fire-gcs-compat",[VVe]:"fire-fst",[jVe]:"fire-fst-compat",[FVe]:"fire-vertex","fire-js":"fire-js",[BVe]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const t1=new Map,GVe=new Map,XV=new Map;function FX(n,e){try{n.container.addComponent(e)}catch(i){qp.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,i)}}function qy(n){const e=n.name;if(XV.has(e))return qp.debug(`There were multiple attempts to register component ${e}.`),!1;XV.set(e,n);for(const i of t1.values())FX(i,n);for(const i of GVe.values())FX(i,n);return!0}function sN(n,e){const i=n.container.getProvider("heartbeat").getImmediate({optional:!0});return i&&i.triggerHeartbeat(),n.container.getProvider(e)}function Vl(n){return n==null?!1:n.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const HVe={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},Ag=new yR("app","Firebase",HVe);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $Ve{constructor(e,i,o){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},i),this._name=i.name,this._automaticDataCollectionEnabled=i.automaticDataCollectionEnabled,this._container=o,this.container.addComponent(new xg("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw Ag.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const iE=WVe;function Qre(n,e={}){let i=n;typeof e!="object"&&(e={name:e});const o=Object.assign({name:YV,automaticDataCollectionEnabled:!1},e),l=o.name;if(typeof l!="string"||!l)throw Ag.create("bad-app-name",{appName:String(l)});if(i||(i=Kre()),!i)throw Ag.create("no-options");const d=t1.get(l);if(d){if(Kp(i,d.options)&&Kp(o,d.config))return d;throw Ag.create("duplicate-app",{appName:l})}const p=new QUe(l);for(const E of XV.values())p.addComponent(E);const _=new $Ve(i,o,p);return t1.set(l,_),_}function g4(n=YV){const e=t1.get(n);if(!e&&n===YV&&Kre())return Qre();if(!e)throw Ag.create("no-app",{appName:n});return e}function lf(n,e,i){var o;let l=(o=zVe[n])!==null&&o!==void 0?o:n;i&&(l+=`-${i}`);const d=l.match(/\s|\//),p=e.match(/\s|\//);if(d||p){const _=[`Unable to register library "${l}" with version "${e}":`];d&&_.push(`library name "${l}" contains illegal characters (whitespace or "/")`),d&&p&&_.push("and"),p&&_.push(`version name "${e}" contains illegal characters (whitespace or "/")`),qp.warn(_.join(" "));return}qy(new xg(`${l}-version`,()=>({library:l,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const KVe="firebase-heartbeat-database",qVe=1,GC="firebase-heartbeat-store";let IU=null;function Zre(){return IU||(IU=dVe(KVe,qVe,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(GC)}catch(i){console.warn(i)}}}}).catch(n=>{throw Ag.create("idb-open",{originalErrorMessage:n.message})})),IU}async function YVe(n){try{const i=(await Zre()).transaction(GC),o=await i.objectStore(GC).get(eie(n));return await i.done,o}catch(e){if(e instanceof Ef)qp.warn(e.message);else{const i=Ag.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});qp.warn(i.message)}}}async function jX(n,e){try{const o=(await Zre()).transaction(GC,"readwrite");await o.objectStore(GC).put(e,eie(n)),await o.done}catch(i){if(i instanceof Ef)qp.warn(i.message);else{const o=Ag.create("idb-set",{originalErrorMessage:i==null?void 0:i.message});qp.warn(o.message)}}}function eie(n){return`${n.name}!${n.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const XVe=1024,JVe=30;class QVe{constructor(e){this.container=e,this._heartbeatsCache=null;const i=this.container.getProvider("app").getImmediate();this._storage=new eFe(i),this._heartbeatsCachePromise=this._storage.read().then(o=>(this._heartbeatsCache=o,o))}async triggerHeartbeat(){var e,i;try{const l=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),d=BX();if(((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((i=this._heartbeatsCache)===null||i===void 0?void 0:i.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===d||this._heartbeatsCache.heartbeats.some(p=>p.date===d))return;if(this._heartbeatsCache.heartbeats.push({date:d,agent:l}),this._heartbeatsCache.heartbeats.length>JVe){const p=tFe(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(p,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(o){qp.warn(o)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const i=BX(),{heartbeatsToSend:o,unsentEntries:l}=ZVe(this._heartbeatsCache.heartbeats),d=e1(JSON.stringify({version:2,heartbeats:o}));return this._heartbeatsCache.lastSentHeartbeatDate=i,l.length>0?(this._heartbeatsCache.heartbeats=l,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),d}catch(i){return qp.warn(i),""}}}function BX(){return new Date().toISOString().substring(0,10)}function ZVe(n,e=XVe){const i=[];let o=n.slice();for(const l of n){const d=i.find(p=>p.agent===l.agent);if(d){if(d.dates.push(l.date),WX(i)>e){d.dates.pop();break}}else if(i.push({agent:l.agent,dates:[l.date]}),WX(i)>e){i.pop();break}o=o.slice(1)}return{heartbeatsToSend:i,unsentEntries:o}}class eFe{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return jUe()?BUe().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const i=await YVe(this.app);return i!=null&&i.heartbeats?i:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){var i;if(await this._canUseIndexedDBPromise){const l=await this.read();return jX(this.app,{lastSentHeartbeatDate:(i=e.lastSentHeartbeatDate)!==null&&i!==void 0?i:l.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){var i;if(await this._canUseIndexedDBPromise){const l=await this.read();return jX(this.app,{lastSentHeartbeatDate:(i=e.lastSentHeartbeatDate)!==null&&i!==void 0?i:l.lastSentHeartbeatDate,heartbeats:[...l.heartbeats,...e.heartbeats]})}else return}}function WX(n){return e1(JSON.stringify({version:2,heartbeats:n})).length}function tFe(n){if(n.length===0)return-1;let e=0,i=n[0].date;for(let o=1;o<n.length;o++)n[o].date<i&&(i=n[o].date,e=o);return e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nFe(n){qy(new xg("platform-logger",e=>new pVe(e),"PRIVATE")),qy(new xg("heartbeat",e=>new QVe(e),"PRIVATE")),lf(qV,VX,n),lf(qV,VX,"esm2017"),lf("fire-js","")}nFe("");function tie(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const rFe=tie,nie=new yR("auth","Firebase",tie());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const n1=new p4("@firebase/auth");function iFe(n,...e){n1.logLevel<=Or.WARN&&n1.warn(`Auth (${iE}): ${n}`,...e)}function Tk(n,...e){n1.logLevel<=Or.ERROR&&n1.error(`Auth (${iE}): ${n}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Bd(n,...e){throw _4(n,...e)}function uf(n,...e){return _4(n,...e)}function rie(n,e,i){const o=Object.assign(Object.assign({},rFe()),{[e]:i});return new yR("auth","Firebase",o).create(e,{appName:n.name})}function Fp(n){return rie(n,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function _4(n,...e){if(typeof n!="string"){const i=e[0],o=[...e.slice(1)];return o[0]&&(o[0].appName=n.name),n._errorFactory.create(i,...o)}return nie.create(n,...e)}function Wn(n,e,...i){if(!n)throw _4(e,...i)}function Op(n){const e="INTERNAL ASSERTION FAILED: "+n;throw Tk(e),new Error(e)}function Yp(n,e){n||Op(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function JV(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.href)||""}function sFe(){return zX()==="http:"||zX()==="https:"}function zX(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function oFe(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(sFe()||MUe()||"connection"in navigator)?navigator.onLine:!0}function aFe(){if(typeof navigator>"u")return null;const n=navigator;return n.languages&&n.languages[0]||n.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vR{constructor(e,i){this.shortDelay=e,this.longDelay=i,Yp(i>e,"Short delay should be less than long delay!"),this.isMobile=DUe()||UUe()}get(){return oFe()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function y4(n,e){Yp(n.emulator,"Emulator should always be set here");const{url:i}=n.emulator;return e?`${i}${e.startsWith("/")?e.slice(1):e}`:i}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iie{static initialize(e,i,o){this.fetchImpl=e,i&&(this.headersImpl=i),o&&(this.responseImpl=o)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;Op("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;Op("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;Op("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cFe={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lFe=new vR(3e4,6e4);function em(n,e){return n.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:n.tenantId}):e}async function tm(n,e,i,o,l={}){return sie(n,l,async()=>{let d={},p={};o&&(e==="GET"?p=o:d={body:JSON.stringify(o)});const _=ER(Object.assign({key:n.config.apiKey},p)).slice(1),E=await n._getAdditionalHeaders();E["Content-Type"]="application/json",n.languageCode&&(E["X-Firebase-Locale"]=n.languageCode);const b=Object.assign({method:e,headers:E},d);return LUe()||(b.referrerPolicy="no-referrer"),iie.fetch()(oie(n,n.config.apiHost,i,_),b)})}async function sie(n,e,i){n._canInitEmulator=!1;const o=Object.assign(Object.assign({},cFe),e);try{const l=new dFe(n),d=await Promise.race([i(),l.promise]);l.clearNetworkTimeout();const p=await d.json();if("needConfirmation"in p)throw VO(n,"account-exists-with-different-credential",p);if(d.ok&&!("errorMessage"in p))return p;{const _=d.ok?p.errorMessage:p.error.message,[E,b]=_.split(" : ");if(E==="FEDERATED_USER_ID_ALREADY_LINKED")throw VO(n,"credential-already-in-use",p);if(E==="EMAIL_EXISTS")throw VO(n,"email-already-in-use",p);if(E==="USER_DISABLED")throw VO(n,"user-disabled",p);const C=o[E]||E.toLowerCase().replace(/[_\s]+/g,"-");if(b)throw rie(n,C,b);Bd(n,C)}}catch(l){if(l instanceof Ef)throw l;Bd(n,"network-request-failed",{message:String(l)})}}async function SR(n,e,i,o,l={}){const d=await tm(n,e,i,o,l);return"mfaPendingCredential"in d&&Bd(n,"multi-factor-auth-required",{_serverResponse:d}),d}function oie(n,e,i,o){const l=`${e}${i}?${o}`;return n.config.emulator?y4(n.config,l):`${n.config.apiScheme}://${l}`}function uFe(n){switch(n){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class dFe{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((i,o)=>{this.timer=setTimeout(()=>o(uf(this.auth,"network-request-failed")),lFe.get())})}}function VO(n,e,i){const o={appName:n.name};i.email&&(o.email=i.email),i.phoneNumber&&(o.phoneNumber=i.phoneNumber);const l=uf(n,e,o);return l.customData._tokenResponse=i,l}function GX(n){return n!==void 0&&n.enterprise!==void 0}class hFe{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const i of this.recaptchaEnforcementState)if(i.provider&&i.provider===e)return uFe(i.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function fFe(n,e){return tm(n,"GET","/v2/recaptchaConfig",em(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function pFe(n,e){return tm(n,"POST","/v1/accounts:delete",e)}async function aie(n,e){return tm(n,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _C(n){if(n)try{const e=new Date(Number(n));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function mFe(n,e=!1){const i=qi(n),o=await i.getIdToken(e),l=E4(o);Wn(l&&l.exp&&l.auth_time&&l.iat,i.auth,"internal-error");const d=typeof l.firebase=="object"?l.firebase:void 0,p=d==null?void 0:d.sign_in_provider;return{claims:l,token:o,authTime:_C(AU(l.auth_time)),issuedAtTime:_C(AU(l.iat)),expirationTime:_C(AU(l.exp)),signInProvider:p||null,signInSecondFactor:(d==null?void 0:d.sign_in_second_factor)||null}}function AU(n){return Number(n)*1e3}function E4(n){const[e,i,o]=n.split(".");if(e===void 0||i===void 0||o===void 0)return Tk("JWT malformed, contained fewer than 3 sections"),null;try{const l=Gre(i);return l?JSON.parse(l):(Tk("Failed to decode base64 JWT payload"),null)}catch(l){return Tk("Caught error parsing JWT payload as JSON",l==null?void 0:l.toString()),null}}function HX(n){const e=E4(n);return Wn(e,"internal-error"),Wn(typeof e.exp<"u","internal-error"),Wn(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function HC(n,e,i=!1){if(i)return e;try{return await e}catch(o){throw o instanceof Ef&&gFe(o)&&n.auth.currentUser===n&&await n.auth.signOut(),o}}function gFe({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _Fe{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){var i;if(e){const o=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),o}else{this.errorBackoff=3e4;const l=((i=this.user.stsTokenManager.expirationTime)!==null&&i!==void 0?i:0)-Date.now()-3e5;return Math.max(0,l)}}schedule(e=!1){if(!this.isRunning)return;const i=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},i)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(e==null?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class QV{constructor(e,i){this.createdAt=e,this.lastLoginAt=i,this._initializeTime()}_initializeTime(){this.lastSignInTime=_C(this.lastLoginAt),this.creationTime=_C(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function r1(n){var e;const i=n.auth,o=await n.getIdToken(),l=await HC(n,aie(i,{idToken:o}));Wn(l==null?void 0:l.users.length,i,"internal-error");const d=l.users[0];n._notifyReloadListener(d);const p=!((e=d.providerUserInfo)===null||e===void 0)&&e.length?cie(d.providerUserInfo):[],_=EFe(n.providerData,p),E=n.isAnonymous,b=!(n.email&&d.passwordHash)&&!(_!=null&&_.length),C=E?b:!1,I={uid:d.localId,displayName:d.displayName||null,photoURL:d.photoUrl||null,email:d.email||null,emailVerified:d.emailVerified||!1,phoneNumber:d.phoneNumber||null,tenantId:d.tenantId||null,providerData:_,metadata:new QV(d.createdAt,d.lastLoginAt),isAnonymous:C};Object.assign(n,I)}async function yFe(n){const e=qi(n);await r1(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function EFe(n,e){return[...n.filter(o=>!e.some(l=>l.providerId===o.providerId)),...e]}function cie(n){return n.map(e=>{var{providerId:i}=e,o=dR(e,["providerId"]);return{providerId:i,uid:o.rawId||"",displayName:o.displayName||null,email:o.email||null,phoneNumber:o.phoneNumber||null,photoURL:o.photoUrl||null}})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function vFe(n,e){const i=await sie(n,{},async()=>{const o=ER({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:l,apiKey:d}=n.config,p=oie(n,l,"/v1/token",`key=${d}`),_=await n._getAdditionalHeaders();return _["Content-Type"]="application/x-www-form-urlencoded",iie.fetch()(p,{method:"POST",headers:_,body:o})});return{accessToken:i.access_token,expiresIn:i.expires_in,refreshToken:i.refresh_token}}async function SFe(n,e){return tm(n,"POST","/v2/accounts:revokeToken",em(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class u0{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){Wn(e.idToken,"internal-error"),Wn(typeof e.idToken<"u","internal-error"),Wn(typeof e.refreshToken<"u","internal-error");const i="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):HX(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,i)}updateFromIdToken(e){Wn(e.length!==0,"internal-error");const i=HX(e);this.updateTokensAndExpiration(e,null,i)}async getToken(e,i=!1){return!i&&this.accessToken&&!this.isExpired?this.accessToken:(Wn(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,i){const{accessToken:o,refreshToken:l,expiresIn:d}=await vFe(e,i);this.updateTokensAndExpiration(o,l,Number(d))}updateTokensAndExpiration(e,i,o){this.refreshToken=i||null,this.accessToken=e||null,this.expirationTime=Date.now()+o*1e3}static fromJSON(e,i){const{refreshToken:o,accessToken:l,expirationTime:d}=i,p=new u0;return o&&(Wn(typeof o=="string","internal-error",{appName:e}),p.refreshToken=o),l&&(Wn(typeof l=="string","internal-error",{appName:e}),p.accessToken=l),d&&(Wn(typeof d=="number","internal-error",{appName:e}),p.expirationTime=d),p}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new u0,this.toJSON())}_performRefresh(){return Op("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fg(n,e){Wn(typeof n=="string"||typeof n>"u","internal-error",{appName:e})}class kp{constructor(e){var{uid:i,auth:o,stsTokenManager:l}=e,d=dR(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new _Fe(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=i,this.auth=o,this.stsTokenManager=l,this.accessToken=l.accessToken,this.displayName=d.displayName||null,this.email=d.email||null,this.emailVerified=d.emailVerified||!1,this.phoneNumber=d.phoneNumber||null,this.photoURL=d.photoURL||null,this.isAnonymous=d.isAnonymous||!1,this.tenantId=d.tenantId||null,this.providerData=d.providerData?[...d.providerData]:[],this.metadata=new QV(d.createdAt||void 0,d.lastLoginAt||void 0)}async getIdToken(e){const i=await HC(this,this.stsTokenManager.getToken(this.auth,e));return Wn(i,this.auth,"internal-error"),this.accessToken!==i&&(this.accessToken=i,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),i}getIdTokenResult(e){return mFe(this,e)}reload(){return yFe(this)}_assign(e){this!==e&&(Wn(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(i=>Object.assign({},i)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const i=new kp(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return i.metadata._copy(this.metadata),i}_onReload(e){Wn(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,i=!1){let o=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),o=!0),i&&await r1(this),await this.auth._persistUserIfCurrent(this),o&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(Vl(this.auth.app))return Promise.reject(Fp(this.auth));const e=await this.getIdToken();return await HC(this,pFe(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,i){var o,l,d,p,_,E,b,C;const I=(o=i.displayName)!==null&&o!==void 0?o:void 0,O=(l=i.email)!==null&&l!==void 0?l:void 0,L=(d=i.phoneNumber)!==null&&d!==void 0?d:void 0,U=(p=i.photoURL)!==null&&p!==void 0?p:void 0,B=(_=i.tenantId)!==null&&_!==void 0?_:void 0,W=(E=i._redirectEventId)!==null&&E!==void 0?E:void 0,J=(b=i.createdAt)!==null&&b!==void 0?b:void 0,$=(C=i.lastLoginAt)!==null&&C!==void 0?C:void 0,{uid:ie,emailVerified:ce,isAnonymous:ne,providerData:de,stsTokenManager:Q}=i;Wn(ie&&Q,e,"internal-error");const Z=u0.fromJSON(this.name,Q);Wn(typeof ie=="string",e,"internal-error"),fg(I,e.name),fg(O,e.name),Wn(typeof ce=="boolean",e,"internal-error"),Wn(typeof ne=="boolean",e,"internal-error"),fg(L,e.name),fg(U,e.name),fg(B,e.name),fg(W,e.name),fg(J,e.name),fg($,e.name);const X=new kp({uid:ie,auth:e,email:O,emailVerified:ce,displayName:I,isAnonymous:ne,photoURL:U,phoneNumber:L,tenantId:B,stsTokenManager:Z,createdAt:J,lastLoginAt:$});return de&&Array.isArray(de)&&(X.providerData=de.map(re=>Object.assign({},re))),W&&(X._redirectEventId=W),X}static async _fromIdTokenResponse(e,i,o=!1){const l=new u0;l.updateFromServerResponse(i);const d=new kp({uid:i.localId,auth:e,stsTokenManager:l,isAnonymous:o});return await r1(d),d}static async _fromGetAccountInfoResponse(e,i,o){const l=i.users[0];Wn(l.localId!==void 0,"internal-error");const d=l.providerUserInfo!==void 0?cie(l.providerUserInfo):[],p=!(l.email&&l.passwordHash)&&!(d!=null&&d.length),_=new u0;_.updateFromIdToken(o);const E=new kp({uid:l.localId,auth:e,stsTokenManager:_,isAnonymous:p}),b={uid:l.localId,displayName:l.displayName||null,photoURL:l.photoUrl||null,email:l.email||null,emailVerified:l.emailVerified||!1,phoneNumber:l.phoneNumber||null,tenantId:l.tenantId||null,providerData:d,metadata:new QV(l.createdAt,l.lastLoginAt),isAnonymous:!(l.email&&l.passwordHash)&&!(d!=null&&d.length)};return Object.assign(E,b),E}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $X=new Map;function Np(n){Yp(n instanceof Function,"Expected a class definition");let e=$X.get(n);return e?(Yp(e instanceof n,"Instance stored in cache mismatched with class"),e):(e=new n,$X.set(n,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lie{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,i){this.storage[e]=i}async _get(e){const i=this.storage[e];return i===void 0?null:i}async _remove(e){delete this.storage[e]}_addListener(e,i){}_removeListener(e,i){}}lie.type="NONE";const KX=lie;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wk(n,e,i){return`firebase:${n}:${e}:${i}`}class d0{constructor(e,i,o){this.persistence=e,this.auth=i,this.userKey=o;const{config:l,name:d}=this.auth;this.fullUserKey=wk(this.userKey,l.apiKey,d),this.fullPersistenceKey=wk("persistence",l.apiKey,d),this.boundEventHandler=i._onStorageEvent.bind(i),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);return e?kp._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const i=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,i)return this.setCurrentUser(i)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,i,o="authUser"){if(!i.length)return new d0(Np(KX),e,o);const l=(await Promise.all(i.map(async b=>{if(await b._isAvailable())return b}))).filter(b=>b);let d=l[0]||Np(KX);const p=wk(o,e.config.apiKey,e.name);let _=null;for(const b of i)try{const C=await b._get(p);if(C){const I=kp._fromJSON(e,C);b!==d&&(_=I),d=b;break}}catch{}const E=l.filter(b=>b._shouldAllowMigration);return!d._shouldAllowMigration||!E.length?new d0(d,e,o):(d=E[0],_&&await d._set(p,_.toJSON()),await Promise.all(i.map(async b=>{if(b!==d)try{await b._remove(p)}catch{}})),new d0(d,e,o))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qX(n){const e=n.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(fie(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(uie(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(mie(e))return"Blackberry";if(gie(e))return"Webos";if(die(e))return"Safari";if((e.includes("chrome/")||hie(e))&&!e.includes("edge/"))return"Chrome";if(pie(e))return"Android";{const i=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,o=n.match(i);if((o==null?void 0:o.length)===2)return o[1]}return"Other"}function uie(n=nc()){return/firefox\//i.test(n)}function die(n=nc()){const e=n.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function hie(n=nc()){return/crios\//i.test(n)}function fie(n=nc()){return/iemobile/i.test(n)}function pie(n=nc()){return/android/i.test(n)}function mie(n=nc()){return/blackberry/i.test(n)}function gie(n=nc()){return/webos/i.test(n)}function v4(n=nc()){return/iphone|ipad|ipod/i.test(n)||/macintosh/i.test(n)&&/mobile/i.test(n)}function bFe(n=nc()){var e;return v4(n)&&!!(!((e=window.navigator)===null||e===void 0)&&e.standalone)}function TFe(){return VUe()&&document.documentMode===10}function _ie(n=nc()){return v4(n)||pie(n)||gie(n)||mie(n)||/windows phone/i.test(n)||fie(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yie(n,e=[]){let i;switch(n){case"Browser":i=qX(nc());break;case"Worker":i=`${qX(nc())}-${n}`;break;default:i=n}const o=e.length?e.join(","):"FirebaseCore-web";return`${i}/JsCore/${iE}/${o}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wFe{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,i){const o=d=>new Promise((p,_)=>{try{const E=e(d);p(E)}catch(E){_(E)}});o.onAbort=i,this.queue.push(o);const l=this.queue.length-1;return()=>{this.queue[l]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const i=[];try{for(const o of this.queue)await o(e),o.onAbort&&i.push(o.onAbort)}catch(o){i.reverse();for(const l of i)try{l()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:o==null?void 0:o.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function CFe(n,e={}){return tm(n,"GET","/v2/passwordPolicy",em(n,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const RFe=6;class IFe{constructor(e){var i,o,l,d;const p=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(i=p.minPasswordLength)!==null&&i!==void 0?i:RFe,p.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=p.maxPasswordLength),p.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=p.containsLowercaseCharacter),p.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=p.containsUppercaseCharacter),p.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=p.containsNumericCharacter),p.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=p.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(l=(o=e.allowedNonAlphanumericCharacters)===null||o===void 0?void 0:o.join(""))!==null&&l!==void 0?l:"",this.forceUpgradeOnSignin=(d=e.forceUpgradeOnSignin)!==null&&d!==void 0?d:!1,this.schemaVersion=e.schemaVersion}validatePassword(e){var i,o,l,d,p,_;const E={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,E),this.validatePasswordCharacterOptions(e,E),E.isValid&&(E.isValid=(i=E.meetsMinPasswordLength)!==null&&i!==void 0?i:!0),E.isValid&&(E.isValid=(o=E.meetsMaxPasswordLength)!==null&&o!==void 0?o:!0),E.isValid&&(E.isValid=(l=E.containsLowercaseLetter)!==null&&l!==void 0?l:!0),E.isValid&&(E.isValid=(d=E.containsUppercaseLetter)!==null&&d!==void 0?d:!0),E.isValid&&(E.isValid=(p=E.containsNumericCharacter)!==null&&p!==void 0?p:!0),E.isValid&&(E.isValid=(_=E.containsNonAlphanumericCharacter)!==null&&_!==void 0?_:!0),E}validatePasswordLengthOptions(e,i){const o=this.customStrengthOptions.minPasswordLength,l=this.customStrengthOptions.maxPasswordLength;o&&(i.meetsMinPasswordLength=e.length>=o),l&&(i.meetsMaxPasswordLength=e.length<=l)}validatePasswordCharacterOptions(e,i){this.updatePasswordCharacterOptionsStatuses(i,!1,!1,!1,!1);let o;for(let l=0;l<e.length;l++)o=e.charAt(l),this.updatePasswordCharacterOptionsStatuses(i,o>="a"&&o<="z",o>="A"&&o<="Z",o>="0"&&o<="9",this.allowedNonAlphanumericCharacters.includes(o))}updatePasswordCharacterOptionsStatuses(e,i,o,l,d){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=i)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=o)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=l)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=d))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AFe{constructor(e,i,o,l){this.app=e,this.heartbeatServiceProvider=i,this.appCheckServiceProvider=o,this.config=l,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new YX(this),this.idTokenSubscription=new YX(this),this.beforeStateQueue=new wFe(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=nie,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=l.sdkClientVersion}_initializeWithPersistence(e,i){return i&&(this._popupRedirectResolver=Np(i)),this._initializationPromise=this.queue(async()=>{var o,l;if(!this._deleted&&(this.persistenceManager=await d0.create(this,e),!this._deleted)){if(!((o=this._popupRedirectResolver)===null||o===void 0)&&o._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(i),this.lastNotifiedUid=((l=this.currentUser)===null||l===void 0?void 0:l.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const i=await aie(this,{idToken:e}),o=await kp._fromGetAccountInfoResponse(this,i,e);await this.directlySetCurrentUser(o)}catch(i){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",i),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var i;if(Vl(this.app)){const p=this.app.settings.authIdToken;return p?new Promise(_=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(p).then(_,_))}):this.directlySetCurrentUser(null)}const o=await this.assertedPersistence.getCurrentUser();let l=o,d=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const p=(i=this.redirectUser)===null||i===void 0?void 0:i._redirectEventId,_=l==null?void 0:l._redirectEventId,E=await this.tryRedirectSignIn(e);(!p||p===_)&&(E!=null&&E.user)&&(l=E.user,d=!0)}if(!l)return this.directlySetCurrentUser(null);if(!l._redirectEventId){if(d)try{await this.beforeStateQueue.runMiddleware(l)}catch(p){l=o,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(p))}return l?this.reloadAndSetCurrentUserOrClear(l):this.directlySetCurrentUser(null)}return Wn(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===l._redirectEventId?this.directlySetCurrentUser(l):this.reloadAndSetCurrentUserOrClear(l)}async tryRedirectSignIn(e){let i=null;try{i=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return i}async reloadAndSetCurrentUserOrClear(e){try{await r1(e)}catch(i){if((i==null?void 0:i.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=aFe()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(Vl(this.app))return Promise.reject(Fp(this));const i=e?qi(e):null;return i&&Wn(i.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(i&&i._clone(this))}async _updateCurrentUser(e,i=!1){if(!this._deleted)return e&&Wn(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),i||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return Vl(this.app)?Promise.reject(Fp(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return Vl(this.app)?Promise.reject(Fp(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(Np(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const i=this._getPasswordPolicyInternal();return i.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):i.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await CFe(this),i=new IFe(e);this.tenantId===null?this._projectPasswordPolicy=i:this._tenantPasswordPolicies[this.tenantId]=i}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new yR("auth","Firebase",e())}onAuthStateChanged(e,i,o){return this.registerStateListener(this.authStateSubscription,e,i,o)}beforeAuthStateChanged(e,i){return this.beforeStateQueue.pushCallback(e,i)}onIdTokenChanged(e,i,o){return this.registerStateListener(this.idTokenSubscription,e,i,o)}authStateReady(){return new Promise((e,i)=>{if(this.currentUser)e();else{const o=this.onAuthStateChanged(()=>{o(),e()},i)}})}async revokeAccessToken(e){if(this.currentUser){const i=await this.currentUser.getIdToken(),o={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:i};this.tenantId!=null&&(o.tenantId=this.tenantId),await SFe(this,o)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)===null||e===void 0?void 0:e.toJSON()}}async _setRedirectUser(e,i){const o=await this.getOrInitRedirectPersistenceManager(i);return e===null?o.removeCurrentUser():o.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const i=e&&Np(e)||this._popupRedirectResolver;Wn(i,this,"argument-error"),this.redirectPersistenceManager=await d0.create(this,[Np(i._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var i,o;return this._isInitialized&&await this.queue(async()=>{}),((i=this._currentUser)===null||i===void 0?void 0:i._redirectEventId)===e?this._currentUser:((o=this.redirectUser)===null||o===void 0?void 0:o._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,i;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const o=(i=(e=this.currentUser)===null||e===void 0?void 0:e.uid)!==null&&i!==void 0?i:null;this.lastNotifiedUid!==o&&(this.lastNotifiedUid=o,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,i,o,l){if(this._deleted)return()=>{};const d=typeof i=="function"?i:i.next.bind(i);let p=!1;const _=this._isInitialized?Promise.resolve():this._initializationPromise;if(Wn(_,this,"internal-error"),_.then(()=>{p||d(this.currentUser)}),typeof i=="function"){const E=e.addObserver(i,o,l);return()=>{p=!0,E()}}else{const E=e.addObserver(i);return()=>{p=!0,E()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return Wn(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=yie(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const i={"X-Client-Version":this.clientVersion};this.app.options.appId&&(i["X-Firebase-gmpid"]=this.app.options.appId);const o=await((e=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getHeartbeatsHeader());o&&(i["X-Firebase-Client"]=o);const l=await this._getAppCheckToken();return l&&(i["X-Firebase-AppCheck"]=l),i}async _getAppCheckToken(){var e;if(Vl(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const i=await((e=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getToken());return i!=null&&i.error&&iFe(`Error while retrieving App Check token: ${i.error}`),i==null?void 0:i.token}}function Hg(n){return qi(n)}class YX{constructor(e){this.auth=e,this.observer=null,this.addObserver=$Ue(i=>this.observer=i)}get next(){return Wn(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let oN={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function PFe(n){oN=n}function Eie(n){return oN.loadJS(n)}function OFe(){return oN.recaptchaEnterpriseScript}function kFe(){return oN.gapiScript}function NFe(n){return`__${n}${Math.floor(Math.random()*1e6)}`}class DFe{constructor(){this.enterprise=new xFe}ready(e){e()}execute(e,i){return Promise.resolve("token")}render(e,i){return""}}class xFe{ready(e){e()}execute(e,i){return Promise.resolve("token")}render(e,i){return""}}const LFe="recaptcha-enterprise",vie="NO_RECAPTCHA";class MFe{constructor(e){this.type=LFe,this.auth=Hg(e)}async verify(e="verify",i=!1){async function o(d){if(!i){if(d.tenantId==null&&d._agentRecaptchaConfig!=null)return d._agentRecaptchaConfig.siteKey;if(d.tenantId!=null&&d._tenantRecaptchaConfigs[d.tenantId]!==void 0)return d._tenantRecaptchaConfigs[d.tenantId].siteKey}return new Promise(async(p,_)=>{fFe(d,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(E=>{if(E.recaptchaKey===void 0)_(new Error("recaptcha Enterprise site key undefined"));else{const b=new hFe(E);return d.tenantId==null?d._agentRecaptchaConfig=b:d._tenantRecaptchaConfigs[d.tenantId]=b,p(b.siteKey)}}).catch(E=>{_(E)})})}function l(d,p,_){const E=window.grecaptcha;GX(E)?E.enterprise.ready(()=>{E.enterprise.execute(d,{action:e}).then(b=>{p(b)}).catch(()=>{p(vie)})}):_(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new DFe().execute("siteKey",{action:"verify"}):new Promise((d,p)=>{o(this.auth).then(_=>{if(!i&&GX(window.grecaptcha))l(_,d,p);else{if(typeof window>"u"){p(new Error("RecaptchaVerifier is only supported in browser"));return}let E=OFe();E.length!==0&&(E+=_),Eie(E).then(()=>{l(_,d,p)}).catch(b=>{p(b)})}}).catch(_=>{p(_)})})}}async function XX(n,e,i,o=!1,l=!1){const d=new MFe(n);let p;if(l)p=vie;else try{p=await d.verify(i)}catch{p=await d.verify(i,!0)}const _=Object.assign({},e);if(i==="mfaSmsEnrollment"||i==="mfaSmsSignIn"){if("phoneEnrollmentInfo"in _){const E=_.phoneEnrollmentInfo.phoneNumber,b=_.phoneEnrollmentInfo.recaptchaToken;Object.assign(_,{phoneEnrollmentInfo:{phoneNumber:E,recaptchaToken:b,captchaResponse:p,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in _){const E=_.phoneSignInInfo.recaptchaToken;Object.assign(_,{phoneSignInInfo:{recaptchaToken:E,captchaResponse:p,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return _}return o?Object.assign(_,{captchaResp:p}):Object.assign(_,{captchaResponse:p}),Object.assign(_,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(_,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),_}async function i1(n,e,i,o,l){var d;if(!((d=n._getRecaptchaConfig())===null||d===void 0)&&d.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const p=await XX(n,e,i,i==="getOobCode");return o(n,p)}else return o(n,e).catch(async p=>{if(p.code==="auth/missing-recaptcha-token"){console.log(`${i} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const _=await XX(n,e,i,i==="getOobCode");return o(n,_)}else return Promise.reject(p)})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function UFe(n,e){const i=sN(n,"auth");if(i.isInitialized()){const l=i.getImmediate(),d=i.getOptions();if(Kp(d,e??{}))return l;Bd(l,"already-initialized")}return i.initialize({options:e})}function VFe(n,e){const i=(e==null?void 0:e.persistence)||[],o=(Array.isArray(i)?i:[i]).map(Np);e!=null&&e.errorMap&&n._updateErrorMap(e.errorMap),n._initializeWithPersistence(o,e==null?void 0:e.popupRedirectResolver)}function FFe(n,e,i){const o=Hg(n);Wn(/^https?:\/\//.test(e),o,"invalid-emulator-scheme");const l=!1,d=Sie(e),{host:p,port:_}=jFe(e),E=_===null?"":`:${_}`,b={url:`${d}//${p}${E}/`},C=Object.freeze({host:p,port:_,protocol:d.replace(":",""),options:Object.freeze({disableWarnings:l})});if(!o._canInitEmulator){Wn(o.config.emulator&&o.emulatorConfig,o,"emulator-config-failed"),Wn(Kp(b,o.config.emulator)&&Kp(C,o.emulatorConfig),o,"emulator-config-failed");return}o.config.emulator=b,o.emulatorConfig=C,o.settings.appVerificationDisabledForTesting=!0,BFe()}function Sie(n){const e=n.indexOf(":");return e<0?"":n.substr(0,e+1)}function jFe(n){const e=Sie(n),i=/(\/\/)?([^?#/]+)/.exec(n.substr(e.length));if(!i)return{host:"",port:null};const o=i[2].split("@").pop()||"",l=/^(\[[^\]]+\])(:|$)/.exec(o);if(l){const d=l[1];return{host:d,port:JX(o.substr(d.length+1))}}else{const[d,p]=o.split(":");return{host:d,port:JX(p)}}}function JX(n){if(!n)return null;const e=Number(n);return isNaN(e)?null:e}function BFe(){function n(){const e=document.createElement("p"),i=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",i.position="fixed",i.width="100%",i.backgroundColor="#ffffff",i.border=".1em solid #000000",i.color="#b50000",i.bottom="0px",i.left="0px",i.margin="0px",i.zIndex="10000",i.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",n):n())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class S4{constructor(e,i){this.providerId=e,this.signInMethod=i}toJSON(){return Op("not implemented")}_getIdTokenResponse(e){return Op("not implemented")}_linkToIdToken(e,i){return Op("not implemented")}_getReauthenticationResolver(e){return Op("not implemented")}}async function WFe(n,e){return tm(n,"POST","/v1/accounts:signUp",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function zFe(n,e){return SR(n,"POST","/v1/accounts:signInWithPassword",em(n,e))}async function bie(n,e){return tm(n,"POST","/v1/accounts:sendOobCode",em(n,e))}async function GFe(n,e){return bie(n,e)}async function HFe(n,e){return bie(n,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function $Fe(n,e){return SR(n,"POST","/v1/accounts:signInWithEmailLink",em(n,e))}async function KFe(n,e){return SR(n,"POST","/v1/accounts:signInWithEmailLink",em(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $C extends S4{constructor(e,i,o,l=null){super("password",o),this._email=e,this._password=i,this._tenantId=l}static _fromEmailAndPassword(e,i){return new $C(e,i,"password")}static _fromEmailAndCode(e,i,o=null){return new $C(e,i,"emailLink",o)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const i=typeof e=="string"?JSON.parse(e):e;if(i!=null&&i.email&&(i!=null&&i.password)){if(i.signInMethod==="password")return this._fromEmailAndPassword(i.email,i.password);if(i.signInMethod==="emailLink")return this._fromEmailAndCode(i.email,i.password,i.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":const i={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return i1(e,i,"signInWithPassword",zFe);case"emailLink":return $Fe(e,{email:this._email,oobCode:this._password});default:Bd(e,"internal-error")}}async _linkToIdToken(e,i){switch(this.signInMethod){case"password":const o={idToken:i,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return i1(e,o,"signUpPassword",WFe);case"emailLink":return KFe(e,{idToken:i,email:this._email,oobCode:this._password});default:Bd(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function h0(n,e){return SR(n,"POST","/v1/accounts:signInWithIdp",em(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qFe="http://localhost";class Yy extends S4{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const i=new Yy(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(i.idToken=e.idToken),e.accessToken&&(i.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(i.nonce=e.nonce),e.pendingToken&&(i.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(i.accessToken=e.oauthToken,i.secret=e.oauthTokenSecret):Bd("argument-error"),i}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const i=typeof e=="string"?JSON.parse(e):e,{providerId:o,signInMethod:l}=i,d=dR(i,["providerId","signInMethod"]);if(!o||!l)return null;const p=new Yy(o,l);return p.idToken=d.idToken||void 0,p.accessToken=d.accessToken||void 0,p.secret=d.secret,p.nonce=d.nonce,p.pendingToken=d.pendingToken||null,p}_getIdTokenResponse(e){const i=this.buildRequest();return h0(e,i)}_linkToIdToken(e,i){const o=this.buildRequest();return o.idToken=i,h0(e,o)}_getReauthenticationResolver(e){const i=this.buildRequest();return i.autoCreate=!1,h0(e,i)}buildRequest(){const e={requestUri:qFe,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const i={};this.idToken&&(i.id_token=this.idToken),this.accessToken&&(i.access_token=this.accessToken),this.secret&&(i.oauth_token_secret=this.secret),i.providerId=this.providerId,this.nonce&&!this.pendingToken&&(i.nonce=this.nonce),e.postBody=ER(i)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function YFe(n){switch(n){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function XFe(n){const e=Jw(Qw(n)).link,i=e?Jw(Qw(e)).deep_link_id:null,o=Jw(Qw(n)).deep_link_id;return(o?Jw(Qw(o)).link:null)||o||i||e||n}class b4{constructor(e){var i,o,l,d,p,_;const E=Jw(Qw(e)),b=(i=E.apiKey)!==null&&i!==void 0?i:null,C=(o=E.oobCode)!==null&&o!==void 0?o:null,I=YFe((l=E.mode)!==null&&l!==void 0?l:null);Wn(b&&C&&I,"argument-error"),this.apiKey=b,this.operation=I,this.code=C,this.continueUrl=(d=E.continueUrl)!==null&&d!==void 0?d:null,this.languageCode=(p=E.languageCode)!==null&&p!==void 0?p:null,this.tenantId=(_=E.tenantId)!==null&&_!==void 0?_:null}static parseLink(e){const i=XFe(e);try{return new b4(i)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class J0{constructor(){this.providerId=J0.PROVIDER_ID}static credential(e,i){return $C._fromEmailAndPassword(e,i)}static credentialWithLink(e,i){const o=b4.parseLink(i);return Wn(o,"argument-error"),$C._fromEmailAndCode(e,o.code,o.tenantId)}}J0.PROVIDER_ID="password";J0.EMAIL_PASSWORD_SIGN_IN_METHOD="password";J0.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tie{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bR extends Tie{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Eg extends bR{constructor(){super("facebook.com")}static credential(e){return Yy._fromParams({providerId:Eg.PROVIDER_ID,signInMethod:Eg.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Eg.credentialFromTaggedObject(e)}static credentialFromError(e){return Eg.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Eg.credential(e.oauthAccessToken)}catch{return null}}}Eg.FACEBOOK_SIGN_IN_METHOD="facebook.com";Eg.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vg extends bR{constructor(){super("google.com"),this.addScope("profile")}static credential(e,i){return Yy._fromParams({providerId:vg.PROVIDER_ID,signInMethod:vg.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:i})}static credentialFromResult(e){return vg.credentialFromTaggedObject(e)}static credentialFromError(e){return vg.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:i,oauthAccessToken:o}=e;if(!i&&!o)return null;try{return vg.credential(i,o)}catch{return null}}}vg.GOOGLE_SIGN_IN_METHOD="google.com";vg.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sg extends bR{constructor(){super("github.com")}static credential(e){return Yy._fromParams({providerId:Sg.PROVIDER_ID,signInMethod:Sg.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Sg.credentialFromTaggedObject(e)}static credentialFromError(e){return Sg.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Sg.credential(e.oauthAccessToken)}catch{return null}}}Sg.GITHUB_SIGN_IN_METHOD="github.com";Sg.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bg extends bR{constructor(){super("twitter.com")}static credential(e,i){return Yy._fromParams({providerId:bg.PROVIDER_ID,signInMethod:bg.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:i})}static credentialFromResult(e){return bg.credentialFromTaggedObject(e)}static credentialFromError(e){return bg.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:i,oauthTokenSecret:o}=e;if(!i||!o)return null;try{return bg.credential(i,o)}catch{return null}}}bg.TWITTER_SIGN_IN_METHOD="twitter.com";bg.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function JFe(n,e){return SR(n,"POST","/v1/accounts:signUp",em(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xy{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,i,o,l=!1){const d=await kp._fromIdTokenResponse(e,o,l),p=QX(o);return new Xy({user:d,providerId:p,_tokenResponse:o,operationType:i})}static async _forOperation(e,i,o){await e._updateTokensIfNecessary(o,!0);const l=QX(o);return new Xy({user:e,providerId:l,_tokenResponse:o,operationType:i})}}function QX(n){return n.providerId?n.providerId:"phoneNumber"in n?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class s1 extends Ef{constructor(e,i,o,l){var d;super(i.code,i.message),this.operationType=o,this.user=l,Object.setPrototypeOf(this,s1.prototype),this.customData={appName:e.name,tenantId:(d=e.tenantId)!==null&&d!==void 0?d:void 0,_serverResponse:i.customData._serverResponse,operationType:o}}static _fromErrorAndOperation(e,i,o,l){return new s1(e,i,o,l)}}function wie(n,e,i,o){return(e==="reauthenticate"?i._getReauthenticationResolver(n):i._getIdTokenResponse(n)).catch(d=>{throw d.code==="auth/multi-factor-auth-required"?s1._fromErrorAndOperation(n,d,e,o):d})}async function QFe(n,e,i=!1){const o=await HC(n,e._linkToIdToken(n.auth,await n.getIdToken()),i);return Xy._forOperation(n,"link",o)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function ZFe(n,e,i=!1){const{auth:o}=n;if(Vl(o.app))return Promise.reject(Fp(o));const l="reauthenticate";try{const d=await HC(n,wie(o,l,e,n),i);Wn(d.idToken,o,"internal-error");const p=E4(d.idToken);Wn(p,o,"internal-error");const{sub:_}=p;return Wn(n.uid===_,o,"user-mismatch"),Xy._forOperation(n,l,d)}catch(d){throw(d==null?void 0:d.code)==="auth/user-not-found"&&Bd(o,"user-mismatch"),d}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Cie(n,e,i=!1){if(Vl(n.app))return Promise.reject(Fp(n));const o="signIn",l=await wie(n,o,e),d=await Xy._fromIdTokenResponse(n,o,l);return i||await n._updateCurrentUser(d.user),d}async function eje(n,e){return Cie(Hg(n),e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Rie(n){const e=Hg(n);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}async function tje(n,e,i){const o=Hg(n);await i1(o,{requestType:"PASSWORD_RESET",email:e,clientType:"CLIENT_TYPE_WEB"},"getOobCode",HFe)}async function nje(n,e,i){if(Vl(n.app))return Promise.reject(Fp(n));const o=Hg(n),p=await i1(o,{returnSecureToken:!0,email:e,password:i,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",JFe).catch(E=>{throw E.code==="auth/password-does-not-meet-requirements"&&Rie(n),E}),_=await Xy._fromIdTokenResponse(o,"signIn",p);return await o._updateCurrentUser(_.user),_}function rje(n,e,i){return Vl(n.app)?Promise.reject(Fp(n)):eje(qi(n),J0.credential(e,i)).catch(async o=>{throw o.code==="auth/password-does-not-meet-requirements"&&Rie(n),o})}async function Iie(n,e){const i=qi(n),l={requestType:"VERIFY_EMAIL",idToken:await n.getIdToken()},{email:d}=await GFe(i.auth,l);d!==n.email&&await n.reload()}function ije(n,e,i,o){return qi(n).onIdTokenChanged(e,i,o)}function sje(n,e,i){return qi(n).beforeAuthStateChanged(e,i)}function oje(n,e,i,o){return qi(n).onAuthStateChanged(e,i,o)}function aje(n){return qi(n).signOut()}const o1="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Aie{constructor(e,i){this.storageRetriever=e,this.type=i}_isAvailable(){try{return this.storage?(this.storage.setItem(o1,"1"),this.storage.removeItem(o1),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,i){return this.storage.setItem(e,JSON.stringify(i)),Promise.resolve()}_get(e){const i=this.storage.getItem(e);return Promise.resolve(i?JSON.parse(i):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cje=1e3,lje=10;class Pie extends Aie{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,i)=>this.onStorageEvent(e,i),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=_ie(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const i of Object.keys(this.listeners)){const o=this.storage.getItem(i),l=this.localCache[i];o!==l&&e(i,l,o)}}onStorageEvent(e,i=!1){if(!e.key){this.forAllChangedKeys((p,_,E)=>{this.notifyListeners(p,E)});return}const o=e.key;i?this.detachListener():this.stopPolling();const l=()=>{const p=this.storage.getItem(o);!i&&this.localCache[o]===p||this.notifyListeners(o,p)},d=this.storage.getItem(o);TFe()&&d!==e.newValue&&e.newValue!==e.oldValue?setTimeout(l,lje):l()}notifyListeners(e,i){this.localCache[e]=i;const o=this.listeners[e];if(o)for(const l of Array.from(o))l(i&&JSON.parse(i))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,i,o)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:i,newValue:o}),!0)})},cje)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,i){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(i)}_removeListener(e,i){this.listeners[e]&&(this.listeners[e].delete(i),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,i){await super._set(e,i),this.localCache[e]=JSON.stringify(i)}async _get(e){const i=await super._get(e);return this.localCache[e]=JSON.stringify(i),i}async _remove(e){await super._remove(e),delete this.localCache[e]}}Pie.type="LOCAL";const uje=Pie;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Oie extends Aie{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,i){}_removeListener(e,i){}}Oie.type="SESSION";const kie=Oie;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function dje(n){return Promise.all(n.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(i){return{fulfilled:!1,reason:i}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aN{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const i=this.receivers.find(l=>l.isListeningto(e));if(i)return i;const o=new aN(e);return this.receivers.push(o),o}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const i=e,{eventId:o,eventType:l,data:d}=i.data,p=this.handlersMap[l];if(!(p!=null&&p.size))return;i.ports[0].postMessage({status:"ack",eventId:o,eventType:l});const _=Array.from(p).map(async b=>b(i.origin,d)),E=await dje(_);i.ports[0].postMessage({status:"done",eventId:o,eventType:l,response:E})}_subscribe(e,i){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(i)}_unsubscribe(e,i){this.handlersMap[e]&&i&&this.handlersMap[e].delete(i),(!i||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}aN.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function T4(n="",e=10){let i="";for(let o=0;o<e;o++)i+=Math.floor(Math.random()*10);return n+i}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hje{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,i,o=50){const l=typeof MessageChannel<"u"?new MessageChannel:null;if(!l)throw new Error("connection_unavailable");let d,p;return new Promise((_,E)=>{const b=T4("",20);l.port1.start();const C=setTimeout(()=>{E(new Error("unsupported_event"))},o);p={messageChannel:l,onMessage(I){const O=I;if(O.data.eventId===b)switch(O.data.status){case"ack":clearTimeout(C),d=setTimeout(()=>{E(new Error("timeout"))},3e3);break;case"done":clearTimeout(d),_(O.data.response);break;default:clearTimeout(C),clearTimeout(d),E(new Error("invalid_response"));break}}},this.handlers.add(p),l.port1.addEventListener("message",p.onMessage),this.target.postMessage({eventType:e,eventId:b,data:i},[l.port2])}).finally(()=>{p&&this.removeMessageHandler(p)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function df(){return window}function fje(n){df().location.href=n}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Nie(){return typeof df().WorkerGlobalScope<"u"&&typeof df().importScripts=="function"}async function pje(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function mje(){var n;return((n=navigator==null?void 0:navigator.serviceWorker)===null||n===void 0?void 0:n.controller)||null}function gje(){return Nie()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Die="firebaseLocalStorageDb",_je=1,a1="firebaseLocalStorage",xie="fbase_key";class TR{constructor(e){this.request=e}toPromise(){return new Promise((e,i)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{i(this.request.error)})})}}function cN(n,e){return n.transaction([a1],e?"readwrite":"readonly").objectStore(a1)}function yje(){const n=indexedDB.deleteDatabase(Die);return new TR(n).toPromise()}function ZV(){const n=indexedDB.open(Die,_je);return new Promise((e,i)=>{n.addEventListener("error",()=>{i(n.error)}),n.addEventListener("upgradeneeded",()=>{const o=n.result;try{o.createObjectStore(a1,{keyPath:xie})}catch(l){i(l)}}),n.addEventListener("success",async()=>{const o=n.result;o.objectStoreNames.contains(a1)?e(o):(o.close(),await yje(),e(await ZV()))})})}async function ZX(n,e,i){const o=cN(n,!0).put({[xie]:e,value:i});return new TR(o).toPromise()}async function Eje(n,e){const i=cN(n,!1).get(e),o=await new TR(i).toPromise();return o===void 0?null:o.value}function eJ(n,e){const i=cN(n,!0).delete(e);return new TR(i).toPromise()}const vje=800,Sje=3;class Lie{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await ZV(),this.db)}async _withRetries(e){let i=0;for(;;)try{const o=await this._openDb();return await e(o)}catch(o){if(i++>Sje)throw o;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return Nie()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=aN._getInstance(gje()),this.receiver._subscribe("keyChanged",async(e,i)=>({keyProcessed:(await this._poll()).includes(i.key)})),this.receiver._subscribe("ping",async(e,i)=>["keyChanged"])}async initializeSender(){var e,i;if(this.activeServiceWorker=await pje(),!this.activeServiceWorker)return;this.sender=new hje(this.activeServiceWorker);const o=await this.sender._send("ping",{},800);o&&!((e=o[0])===null||e===void 0)&&e.fulfilled&&!((i=o[0])===null||i===void 0)&&i.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||mje()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await ZV();return await ZX(e,o1,"1"),await eJ(e,o1),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,i){return this._withPendingWrite(async()=>(await this._withRetries(o=>ZX(o,e,i)),this.localCache[e]=i,this.notifyServiceWorker(e)))}async _get(e){const i=await this._withRetries(o=>Eje(o,e));return this.localCache[e]=i,i}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(i=>eJ(i,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(l=>{const d=cN(l,!1).getAll();return new TR(d).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const i=[],o=new Set;if(e.length!==0)for(const{fbase_key:l,value:d}of e)o.add(l),JSON.stringify(this.localCache[l])!==JSON.stringify(d)&&(this.notifyListeners(l,d),i.push(l));for(const l of Object.keys(this.localCache))this.localCache[l]&&!o.has(l)&&(this.notifyListeners(l,null),i.push(l));return i}notifyListeners(e,i){this.localCache[e]=i;const o=this.listeners[e];if(o)for(const l of Array.from(o))l(i)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),vje)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,i){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(i)}_removeListener(e,i){this.listeners[e]&&(this.listeners[e].delete(i),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}Lie.type="LOCAL";const bje=Lie;new vR(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Tje(n,e){return e?Np(e):(Wn(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class w4 extends S4{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return h0(e,this._buildIdpRequest())}_linkToIdToken(e,i){return h0(e,this._buildIdpRequest(i))}_getReauthenticationResolver(e){return h0(e,this._buildIdpRequest())}_buildIdpRequest(e){const i={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(i.idToken=e),i}}function wje(n){return Cie(n.auth,new w4(n),n.bypassAuthState)}function Cje(n){const{auth:e,user:i}=n;return Wn(i,e,"internal-error"),ZFe(i,new w4(n),n.bypassAuthState)}async function Rje(n){const{auth:e,user:i}=n;return Wn(i,e,"internal-error"),QFe(i,new w4(n),n.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mie{constructor(e,i,o,l,d=!1){this.auth=e,this.resolver=o,this.user=l,this.bypassAuthState=d,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(i)?i:[i]}execute(){return new Promise(async(e,i)=>{this.pendingPromise={resolve:e,reject:i};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(o){this.reject(o)}})}async onAuthEvent(e){const{urlResponse:i,sessionId:o,postBody:l,tenantId:d,error:p,type:_}=e;if(p){this.reject(p);return}const E={auth:this.auth,requestUri:i,sessionId:o,tenantId:d||void 0,postBody:l||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(_)(E))}catch(b){this.reject(b)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return wje;case"linkViaPopup":case"linkViaRedirect":return Rje;case"reauthViaPopup":case"reauthViaRedirect":return Cje;default:Bd(this.auth,"internal-error")}}resolve(e){Yp(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){Yp(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ije=new vR(2e3,1e4);class QS extends Mie{constructor(e,i,o,l,d){super(e,i,l,d),this.provider=o,this.authWindow=null,this.pollId=null,QS.currentPopupAction&&QS.currentPopupAction.cancel(),QS.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return Wn(e,this.auth,"internal-error"),e}async onExecution(){Yp(this.filter.length===1,"Popup operations only handle one event");const e=T4();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(i=>{this.reject(i)}),this.resolver._isIframeWebStorageSupported(this.auth,i=>{i||this.reject(uf(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)===null||e===void 0?void 0:e.associatedEvent)||null}cancel(){this.reject(uf(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,QS.currentPopupAction=null}pollUserCancellation(){const e=()=>{var i,o;if(!((o=(i=this.authWindow)===null||i===void 0?void 0:i.window)===null||o===void 0)&&o.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(uf(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,Ije.get())};e()}}QS.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Aje="pendingRedirect",Ck=new Map;class Pje extends Mie{constructor(e,i,o=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],i,void 0,o),this.eventId=null}async execute(){let e=Ck.get(this.auth._key());if(!e){try{const o=await Oje(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(o)}catch(i){e=()=>Promise.reject(i)}Ck.set(this.auth._key(),e)}return this.bypassAuthState||Ck.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const i=await this.auth._redirectUserForId(e.eventId);if(i)return this.user=i,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function Oje(n,e){const i=Dje(e),o=Nje(n);if(!await o._isAvailable())return!1;const l=await o._get(i)==="true";return await o._remove(i),l}function kje(n,e){Ck.set(n._key(),e)}function Nje(n){return Np(n._redirectPersistence)}function Dje(n){return wk(Aje,n.config.apiKey,n.name)}async function xje(n,e,i=!1){if(Vl(n.app))return Promise.reject(Fp(n));const o=Hg(n),l=Tje(o,e),p=await new Pje(o,l,i).execute();return p&&!i&&(delete p.user._redirectEventId,await o._persistUserIfCurrent(p.user),await o._setRedirectUser(null,e)),p}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Lje=10*60*1e3;class Mje{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let i=!1;return this.consumers.forEach(o=>{this.isEventForConsumer(e,o)&&(i=!0,this.sendToConsumer(e,o),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!Uje(e)||(this.hasHandledPotentialRedirect=!0,i||(this.queuedRedirectEvent=e,i=!0)),i}sendToConsumer(e,i){var o;if(e.error&&!Uie(e)){const l=((o=e.error.code)===null||o===void 0?void 0:o.split("auth/")[1])||"internal-error";i.onError(uf(this.auth,l))}else i.onAuthEvent(e)}isEventForConsumer(e,i){const o=i.eventId===null||!!e.eventId&&e.eventId===i.eventId;return i.filter.includes(e.type)&&o}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=Lje&&this.cachedEventUids.clear(),this.cachedEventUids.has(tJ(e))}saveEventToCache(e){this.cachedEventUids.add(tJ(e)),this.lastProcessedEventTime=Date.now()}}function tJ(n){return[n.type,n.eventId,n.sessionId,n.tenantId].filter(e=>e).join("-")}function Uie({type:n,error:e}){return n==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function Uje(n){switch(n.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return Uie(n);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Vje(n,e={}){return tm(n,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Fje=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,jje=/^https?/;async function Bje(n){if(n.config.emulator)return;const{authorizedDomains:e}=await Vje(n);for(const i of e)try{if(Wje(i))return}catch{}Bd(n,"unauthorized-domain")}function Wje(n){const e=JV(),{protocol:i,hostname:o}=new URL(e);if(n.startsWith("chrome-extension://")){const p=new URL(n);return p.hostname===""&&o===""?i==="chrome-extension:"&&n.replace("chrome-extension://","")===e.replace("chrome-extension://",""):i==="chrome-extension:"&&p.hostname===o}if(!jje.test(i))return!1;if(Fje.test(n))return o===n;const l=n.replace(/\./g,"\\.");return new RegExp("^(.+\\."+l+"|"+l+")$","i").test(o)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zje=new vR(3e4,6e4);function nJ(){const n=df().___jsl;if(n!=null&&n.H){for(const e of Object.keys(n.H))if(n.H[e].r=n.H[e].r||[],n.H[e].L=n.H[e].L||[],n.H[e].r=[...n.H[e].L],n.CP)for(let i=0;i<n.CP.length;i++)n.CP[i]=null}}function Gje(n){return new Promise((e,i)=>{var o,l,d;function p(){nJ(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{nJ(),i(uf(n,"network-request-failed"))},timeout:zje.get()})}if(!((l=(o=df().gapi)===null||o===void 0?void 0:o.iframes)===null||l===void 0)&&l.Iframe)e(gapi.iframes.getContext());else if(!((d=df().gapi)===null||d===void 0)&&d.load)p();else{const _=NFe("iframefcb");return df()[_]=()=>{gapi.load?p():i(uf(n,"network-request-failed"))},Eie(`${kFe()}?onload=${_}`).catch(E=>i(E))}}).catch(e=>{throw Rk=null,e})}let Rk=null;function Hje(n){return Rk=Rk||Gje(n),Rk}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $je=new vR(5e3,15e3),Kje="__/auth/iframe",qje="emulator/auth/iframe",Yje={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},Xje=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function Jje(n){const e=n.config;Wn(e.authDomain,n,"auth-domain-config-required");const i=e.emulator?y4(e,qje):`https://${n.config.authDomain}/${Kje}`,o={apiKey:e.apiKey,appName:n.name,v:iE},l=Xje.get(n.config.apiHost);l&&(o.eid=l);const d=n._getFrameworks();return d.length&&(o.fw=d.join(",")),`${i}?${ER(o).slice(1)}`}async function Qje(n){const e=await Hje(n),i=df().gapi;return Wn(i,n,"internal-error"),e.open({where:document.body,url:Jje(n),messageHandlersFilter:i.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:Yje,dontclear:!0},o=>new Promise(async(l,d)=>{await o.restyle({setHideOnLeave:!1});const p=uf(n,"network-request-failed"),_=df().setTimeout(()=>{d(p)},$je.get());function E(){df().clearTimeout(_),l(o)}o.ping(E).then(E,()=>{d(p)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Zje={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},e4e=500,t4e=600,n4e="_blank",r4e="http://localhost";class rJ{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function i4e(n,e,i,o=e4e,l=t4e){const d=Math.max((window.screen.availHeight-l)/2,0).toString(),p=Math.max((window.screen.availWidth-o)/2,0).toString();let _="";const E=Object.assign(Object.assign({},Zje),{width:o.toString(),height:l.toString(),top:d,left:p}),b=nc().toLowerCase();i&&(_=hie(b)?n4e:i),uie(b)&&(e=e||r4e,E.scrollbars="yes");const C=Object.entries(E).reduce((O,[L,U])=>`${O}${L}=${U},`,"");if(bFe(b)&&_!=="_self")return s4e(e||"",_),new rJ(null);const I=window.open(e||"",_,C);Wn(I,n,"popup-blocked");try{I.focus()}catch{}return new rJ(I)}function s4e(n,e){const i=document.createElement("a");i.href=n,i.target=e;const o=document.createEvent("MouseEvent");o.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),i.dispatchEvent(o)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const o4e="__/auth/handler",a4e="emulator/auth/handler",c4e=encodeURIComponent("fac");async function iJ(n,e,i,o,l,d){Wn(n.config.authDomain,n,"auth-domain-config-required"),Wn(n.config.apiKey,n,"invalid-api-key");const p={apiKey:n.config.apiKey,appName:n.name,authType:i,redirectUrl:o,v:iE,eventId:l};if(e instanceof Tie){e.setDefaultLanguage(n.languageCode),p.providerId=e.providerId||"",HUe(e.getCustomParameters())||(p.customParameters=JSON.stringify(e.getCustomParameters()));for(const[C,I]of Object.entries({}))p[C]=I}if(e instanceof bR){const C=e.getScopes().filter(I=>I!=="");C.length>0&&(p.scopes=C.join(","))}n.tenantId&&(p.tid=n.tenantId);const _=p;for(const C of Object.keys(_))_[C]===void 0&&delete _[C];const E=await n._getAppCheckToken(),b=E?`#${c4e}=${encodeURIComponent(E)}`:"";return`${l4e(n)}?${ER(_).slice(1)}${b}`}function l4e({config:n}){return n.emulator?y4(n,a4e):`https://${n.authDomain}/${o4e}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const PU="webStorageSupport";class u4e{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=kie,this._completeRedirectFn=xje,this._overrideRedirectResult=kje}async _openPopup(e,i,o,l){var d;Yp((d=this.eventManagers[e._key()])===null||d===void 0?void 0:d.manager,"_initialize() not called before _openPopup()");const p=await iJ(e,i,o,JV(),l);return i4e(e,p,T4())}async _openRedirect(e,i,o,l){await this._originValidation(e);const d=await iJ(e,i,o,JV(),l);return fje(d),new Promise(()=>{})}_initialize(e){const i=e._key();if(this.eventManagers[i]){const{manager:l,promise:d}=this.eventManagers[i];return l?Promise.resolve(l):(Yp(d,"If manager is not set, promise should be"),d)}const o=this.initAndGetManager(e);return this.eventManagers[i]={promise:o},o.catch(()=>{delete this.eventManagers[i]}),o}async initAndGetManager(e){const i=await Qje(e),o=new Mje(e);return i.register("authEvent",l=>(Wn(l==null?void 0:l.authEvent,e,"invalid-auth-event"),{status:o.onEvent(l.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:o},this.iframes[e._key()]=i,o}_isIframeWebStorageSupported(e,i){this.iframes[e._key()].send(PU,{type:PU},l=>{var d;const p=(d=l==null?void 0:l[0])===null||d===void 0?void 0:d[PU];p!==void 0&&i(!!p),Bd(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const i=e._key();return this.originValidationPromises[i]||(this.originValidationPromises[i]=Bje(e)),this.originValidationPromises[i]}get _shouldInitProactively(){return _ie()||die()||v4()}}const d4e=u4e;var sJ="@firebase/auth",oJ="1.9.1";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class h4e{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)===null||e===void 0?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const i=this.auth.onIdTokenChanged(o=>{e((o==null?void 0:o.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,i),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const i=this.internalListeners.get(e);i&&(this.internalListeners.delete(e),i(),this.updateProactiveRefresh())}assertAuthConfigured(){Wn(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function f4e(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function p4e(n){qy(new xg("auth",(e,{options:i})=>{const o=e.getProvider("app").getImmediate(),l=e.getProvider("heartbeat"),d=e.getProvider("app-check-internal"),{apiKey:p,authDomain:_}=o.options;Wn(p&&!p.includes(":"),"invalid-api-key",{appName:o.name});const E={apiKey:p,authDomain:_,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:yie(n)},b=new AFe(o,l,d,E);return VFe(b,i),b},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,i,o)=>{e.getProvider("auth-internal").initialize()})),qy(new xg("auth-internal",e=>{const i=Hg(e.getProvider("auth").getImmediate());return(o=>new h4e(o))(i)},"PRIVATE").setInstantiationMode("EXPLICIT")),lf(sJ,oJ,f4e(n)),lf(sJ,oJ,"esm2017")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const m4e=5*60,g4e=qre("authIdTokenMaxAge")||m4e;let aJ=null;const _4e=n=>async e=>{const i=e&&await e.getIdTokenResult(),o=i&&(new Date().getTime()-Date.parse(i.issuedAtTime))/1e3;if(o&&o>g4e)return;const l=i==null?void 0:i.token;aJ!==l&&(aJ=l,await fetch(n,{method:l?"POST":"DELETE",headers:l?{Authorization:`Bearer ${l}`}:{}}))};function lN(n=g4()){const e=sN(n,"auth");if(e.isInitialized())return e.getImmediate();const i=UFe(n,{popupRedirectResolver:d4e,persistence:[bje,uje,kie]}),o=qre("authTokenSyncURL");if(o&&typeof isSecureContext=="boolean"&&isSecureContext){const d=new URL(o,location.origin);if(location.origin===d.origin){const p=_4e(d.toString());sje(i,p,()=>p(i.currentUser)),ije(i,_=>p(_))}}const l=Hre("auth");return l&&FFe(i,`http://${l}`),i}function y4e(){var n,e;return(e=(n=document.getElementsByTagName("head"))===null||n===void 0?void 0:n[0])!==null&&e!==void 0?e:document}PFe({loadJS(n){return new Promise((e,i)=>{const o=document.createElement("script");o.setAttribute("src",n),o.onload=e,o.onerror=l=>{const d=uf("internal-error");d.customData=l,i(d)},o.type="text/javascript",o.charset="UTF-8",y4e().appendChild(o)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});p4e("Browser");var cJ=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var Pg,Vie;(function(){var n;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(Q,Z){function X(){}X.prototype=Z.prototype,Q.D=Z.prototype,Q.prototype=new X,Q.prototype.constructor=Q,Q.C=function(re,pe,he){for(var ue=Array(arguments.length-2),xe=2;xe<arguments.length;xe++)ue[xe-2]=arguments[xe];return Z.prototype[pe].apply(re,ue)}}function i(){this.blockSize=-1}function o(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(o,i),o.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function l(Q,Z,X){X||(X=0);var re=Array(16);if(typeof Z=="string")for(var pe=0;16>pe;++pe)re[pe]=Z.charCodeAt(X++)|Z.charCodeAt(X++)<<8|Z.charCodeAt(X++)<<16|Z.charCodeAt(X++)<<24;else for(pe=0;16>pe;++pe)re[pe]=Z[X++]|Z[X++]<<8|Z[X++]<<16|Z[X++]<<24;Z=Q.g[0],X=Q.g[1],pe=Q.g[2];var he=Q.g[3],ue=Z+(he^X&(pe^he))+re[0]+3614090360&4294967295;Z=X+(ue<<7&4294967295|ue>>>25),ue=he+(pe^Z&(X^pe))+re[1]+3905402710&4294967295,he=Z+(ue<<12&4294967295|ue>>>20),ue=pe+(X^he&(Z^X))+re[2]+606105819&4294967295,pe=he+(ue<<17&4294967295|ue>>>15),ue=X+(Z^pe&(he^Z))+re[3]+3250441966&4294967295,X=pe+(ue<<22&4294967295|ue>>>10),ue=Z+(he^X&(pe^he))+re[4]+4118548399&4294967295,Z=X+(ue<<7&4294967295|ue>>>25),ue=he+(pe^Z&(X^pe))+re[5]+1200080426&4294967295,he=Z+(ue<<12&4294967295|ue>>>20),ue=pe+(X^he&(Z^X))+re[6]+2821735955&4294967295,pe=he+(ue<<17&4294967295|ue>>>15),ue=X+(Z^pe&(he^Z))+re[7]+4249261313&4294967295,X=pe+(ue<<22&4294967295|ue>>>10),ue=Z+(he^X&(pe^he))+re[8]+1770035416&4294967295,Z=X+(ue<<7&4294967295|ue>>>25),ue=he+(pe^Z&(X^pe))+re[9]+2336552879&4294967295,he=Z+(ue<<12&4294967295|ue>>>20),ue=pe+(X^he&(Z^X))+re[10]+4294925233&4294967295,pe=he+(ue<<17&4294967295|ue>>>15),ue=X+(Z^pe&(he^Z))+re[11]+2304563134&4294967295,X=pe+(ue<<22&4294967295|ue>>>10),ue=Z+(he^X&(pe^he))+re[12]+1804603682&4294967295,Z=X+(ue<<7&4294967295|ue>>>25),ue=he+(pe^Z&(X^pe))+re[13]+4254626195&4294967295,he=Z+(ue<<12&4294967295|ue>>>20),ue=pe+(X^he&(Z^X))+re[14]+2792965006&4294967295,pe=he+(ue<<17&4294967295|ue>>>15),ue=X+(Z^pe&(he^Z))+re[15]+1236535329&4294967295,X=pe+(ue<<22&4294967295|ue>>>10),ue=Z+(pe^he&(X^pe))+re[1]+4129170786&4294967295,Z=X+(ue<<5&4294967295|ue>>>27),ue=he+(X^pe&(Z^X))+re[6]+3225465664&4294967295,he=Z+(ue<<9&4294967295|ue>>>23),ue=pe+(Z^X&(he^Z))+re[11]+643717713&4294967295,pe=he+(ue<<14&4294967295|ue>>>18),ue=X+(he^Z&(pe^he))+re[0]+3921069994&4294967295,X=pe+(ue<<20&4294967295|ue>>>12),ue=Z+(pe^he&(X^pe))+re[5]+3593408605&4294967295,Z=X+(ue<<5&4294967295|ue>>>27),ue=he+(X^pe&(Z^X))+re[10]+38016083&4294967295,he=Z+(ue<<9&4294967295|ue>>>23),ue=pe+(Z^X&(he^Z))+re[15]+3634488961&4294967295,pe=he+(ue<<14&4294967295|ue>>>18),ue=X+(he^Z&(pe^he))+re[4]+3889429448&4294967295,X=pe+(ue<<20&4294967295|ue>>>12),ue=Z+(pe^he&(X^pe))+re[9]+568446438&4294967295,Z=X+(ue<<5&4294967295|ue>>>27),ue=he+(X^pe&(Z^X))+re[14]+3275163606&4294967295,he=Z+(ue<<9&4294967295|ue>>>23),ue=pe+(Z^X&(he^Z))+re[3]+4107603335&4294967295,pe=he+(ue<<14&4294967295|ue>>>18),ue=X+(he^Z&(pe^he))+re[8]+1163531501&4294967295,X=pe+(ue<<20&4294967295|ue>>>12),ue=Z+(pe^he&(X^pe))+re[13]+2850285829&4294967295,Z=X+(ue<<5&4294967295|ue>>>27),ue=he+(X^pe&(Z^X))+re[2]+4243563512&4294967295,he=Z+(ue<<9&4294967295|ue>>>23),ue=pe+(Z^X&(he^Z))+re[7]+1735328473&4294967295,pe=he+(ue<<14&4294967295|ue>>>18),ue=X+(he^Z&(pe^he))+re[12]+2368359562&4294967295,X=pe+(ue<<20&4294967295|ue>>>12),ue=Z+(X^pe^he)+re[5]+4294588738&4294967295,Z=X+(ue<<4&4294967295|ue>>>28),ue=he+(Z^X^pe)+re[8]+2272392833&4294967295,he=Z+(ue<<11&4294967295|ue>>>21),ue=pe+(he^Z^X)+re[11]+1839030562&4294967295,pe=he+(ue<<16&4294967295|ue>>>16),ue=X+(pe^he^Z)+re[14]+4259657740&4294967295,X=pe+(ue<<23&4294967295|ue>>>9),ue=Z+(X^pe^he)+re[1]+2763975236&4294967295,Z=X+(ue<<4&4294967295|ue>>>28),ue=he+(Z^X^pe)+re[4]+1272893353&4294967295,he=Z+(ue<<11&4294967295|ue>>>21),ue=pe+(he^Z^X)+re[7]+4139469664&4294967295,pe=he+(ue<<16&4294967295|ue>>>16),ue=X+(pe^he^Z)+re[10]+3200236656&4294967295,X=pe+(ue<<23&4294967295|ue>>>9),ue=Z+(X^pe^he)+re[13]+681279174&4294967295,Z=X+(ue<<4&4294967295|ue>>>28),ue=he+(Z^X^pe)+re[0]+3936430074&4294967295,he=Z+(ue<<11&4294967295|ue>>>21),ue=pe+(he^Z^X)+re[3]+3572445317&4294967295,pe=he+(ue<<16&4294967295|ue>>>16),ue=X+(pe^he^Z)+re[6]+76029189&4294967295,X=pe+(ue<<23&4294967295|ue>>>9),ue=Z+(X^pe^he)+re[9]+3654602809&4294967295,Z=X+(ue<<4&4294967295|ue>>>28),ue=he+(Z^X^pe)+re[12]+3873151461&4294967295,he=Z+(ue<<11&4294967295|ue>>>21),ue=pe+(he^Z^X)+re[15]+530742520&4294967295,pe=he+(ue<<16&4294967295|ue>>>16),ue=X+(pe^he^Z)+re[2]+3299628645&4294967295,X=pe+(ue<<23&4294967295|ue>>>9),ue=Z+(pe^(X|~he))+re[0]+4096336452&4294967295,Z=X+(ue<<6&4294967295|ue>>>26),ue=he+(X^(Z|~pe))+re[7]+1126891415&4294967295,he=Z+(ue<<10&4294967295|ue>>>22),ue=pe+(Z^(he|~X))+re[14]+2878612391&4294967295,pe=he+(ue<<15&4294967295|ue>>>17),ue=X+(he^(pe|~Z))+re[5]+4237533241&4294967295,X=pe+(ue<<21&4294967295|ue>>>11),ue=Z+(pe^(X|~he))+re[12]+1700485571&4294967295,Z=X+(ue<<6&4294967295|ue>>>26),ue=he+(X^(Z|~pe))+re[3]+2399980690&4294967295,he=Z+(ue<<10&4294967295|ue>>>22),ue=pe+(Z^(he|~X))+re[10]+4293915773&4294967295,pe=he+(ue<<15&4294967295|ue>>>17),ue=X+(he^(pe|~Z))+re[1]+2240044497&4294967295,X=pe+(ue<<21&4294967295|ue>>>11),ue=Z+(pe^(X|~he))+re[8]+1873313359&4294967295,Z=X+(ue<<6&4294967295|ue>>>26),ue=he+(X^(Z|~pe))+re[15]+4264355552&4294967295,he=Z+(ue<<10&4294967295|ue>>>22),ue=pe+(Z^(he|~X))+re[6]+2734768916&4294967295,pe=he+(ue<<15&4294967295|ue>>>17),ue=X+(he^(pe|~Z))+re[13]+1309151649&4294967295,X=pe+(ue<<21&4294967295|ue>>>11),ue=Z+(pe^(X|~he))+re[4]+4149444226&4294967295,Z=X+(ue<<6&4294967295|ue>>>26),ue=he+(X^(Z|~pe))+re[11]+3174756917&4294967295,he=Z+(ue<<10&4294967295|ue>>>22),ue=pe+(Z^(he|~X))+re[2]+718787259&4294967295,pe=he+(ue<<15&4294967295|ue>>>17),ue=X+(he^(pe|~Z))+re[9]+3951481745&4294967295,Q.g[0]=Q.g[0]+Z&4294967295,Q.g[1]=Q.g[1]+(pe+(ue<<21&4294967295|ue>>>11))&4294967295,Q.g[2]=Q.g[2]+pe&4294967295,Q.g[3]=Q.g[3]+he&4294967295}o.prototype.u=function(Q,Z){Z===void 0&&(Z=Q.length);for(var X=Z-this.blockSize,re=this.B,pe=this.h,he=0;he<Z;){if(pe==0)for(;he<=X;)l(this,Q,he),he+=this.blockSize;if(typeof Q=="string"){for(;he<Z;)if(re[pe++]=Q.charCodeAt(he++),pe==this.blockSize){l(this,re),pe=0;break}}else for(;he<Z;)if(re[pe++]=Q[he++],pe==this.blockSize){l(this,re),pe=0;break}}this.h=pe,this.o+=Z},o.prototype.v=function(){var Q=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);Q[0]=128;for(var Z=1;Z<Q.length-8;++Z)Q[Z]=0;var X=8*this.o;for(Z=Q.length-8;Z<Q.length;++Z)Q[Z]=X&255,X/=256;for(this.u(Q),Q=Array(16),Z=X=0;4>Z;++Z)for(var re=0;32>re;re+=8)Q[X++]=this.g[Z]>>>re&255;return Q};function d(Q,Z){var X=_;return Object.prototype.hasOwnProperty.call(X,Q)?X[Q]:X[Q]=Z(Q)}function p(Q,Z){this.h=Z;for(var X=[],re=!0,pe=Q.length-1;0<=pe;pe--){var he=Q[pe]|0;re&&he==Z||(X[pe]=he,re=!1)}this.g=X}var _={};function E(Q){return-128<=Q&&128>Q?d(Q,function(Z){return new p([Z|0],0>Z?-1:0)}):new p([Q|0],0>Q?-1:0)}function b(Q){if(isNaN(Q)||!isFinite(Q))return I;if(0>Q)return W(b(-Q));for(var Z=[],X=1,re=0;Q>=X;re++)Z[re]=Q/X|0,X*=4294967296;return new p(Z,0)}function C(Q,Z){if(Q.length==0)throw Error("number format error: empty string");if(Z=Z||10,2>Z||36<Z)throw Error("radix out of range: "+Z);if(Q.charAt(0)=="-")return W(C(Q.substring(1),Z));if(0<=Q.indexOf("-"))throw Error('number format error: interior "-" character');for(var X=b(Math.pow(Z,8)),re=I,pe=0;pe<Q.length;pe+=8){var he=Math.min(8,Q.length-pe),ue=parseInt(Q.substring(pe,pe+he),Z);8>he?(he=b(Math.pow(Z,he)),re=re.j(he).add(b(ue))):(re=re.j(X),re=re.add(b(ue)))}return re}var I=E(0),O=E(1),L=E(16777216);n=p.prototype,n.m=function(){if(B(this))return-W(this).m();for(var Q=0,Z=1,X=0;X<this.g.length;X++){var re=this.i(X);Q+=(0<=re?re:4294967296+re)*Z,Z*=4294967296}return Q},n.toString=function(Q){if(Q=Q||10,2>Q||36<Q)throw Error("radix out of range: "+Q);if(U(this))return"0";if(B(this))return"-"+W(this).toString(Q);for(var Z=b(Math.pow(Q,6)),X=this,re="";;){var pe=ce(X,Z).g;X=J(X,pe.j(Z));var he=((0<X.g.length?X.g[0]:X.h)>>>0).toString(Q);if(X=pe,U(X))return he+re;for(;6>he.length;)he="0"+he;re=he+re}},n.i=function(Q){return 0>Q?0:Q<this.g.length?this.g[Q]:this.h};function U(Q){if(Q.h!=0)return!1;for(var Z=0;Z<Q.g.length;Z++)if(Q.g[Z]!=0)return!1;return!0}function B(Q){return Q.h==-1}n.l=function(Q){return Q=J(this,Q),B(Q)?-1:U(Q)?0:1};function W(Q){for(var Z=Q.g.length,X=[],re=0;re<Z;re++)X[re]=~Q.g[re];return new p(X,~Q.h).add(O)}n.abs=function(){return B(this)?W(this):this},n.add=function(Q){for(var Z=Math.max(this.g.length,Q.g.length),X=[],re=0,pe=0;pe<=Z;pe++){var he=re+(this.i(pe)&65535)+(Q.i(pe)&65535),ue=(he>>>16)+(this.i(pe)>>>16)+(Q.i(pe)>>>16);re=ue>>>16,he&=65535,ue&=65535,X[pe]=ue<<16|he}return new p(X,X[X.length-1]&-2147483648?-1:0)};function J(Q,Z){return Q.add(W(Z))}n.j=function(Q){if(U(this)||U(Q))return I;if(B(this))return B(Q)?W(this).j(W(Q)):W(W(this).j(Q));if(B(Q))return W(this.j(W(Q)));if(0>this.l(L)&&0>Q.l(L))return b(this.m()*Q.m());for(var Z=this.g.length+Q.g.length,X=[],re=0;re<2*Z;re++)X[re]=0;for(re=0;re<this.g.length;re++)for(var pe=0;pe<Q.g.length;pe++){var he=this.i(re)>>>16,ue=this.i(re)&65535,xe=Q.i(pe)>>>16,We=Q.i(pe)&65535;X[2*re+2*pe]+=ue*We,$(X,2*re+2*pe),X[2*re+2*pe+1]+=he*We,$(X,2*re+2*pe+1),X[2*re+2*pe+1]+=ue*xe,$(X,2*re+2*pe+1),X[2*re+2*pe+2]+=he*xe,$(X,2*re+2*pe+2)}for(re=0;re<Z;re++)X[re]=X[2*re+1]<<16|X[2*re];for(re=Z;re<2*Z;re++)X[re]=0;return new p(X,0)};function $(Q,Z){for(;(Q[Z]&65535)!=Q[Z];)Q[Z+1]+=Q[Z]>>>16,Q[Z]&=65535,Z++}function ie(Q,Z){this.g=Q,this.h=Z}function ce(Q,Z){if(U(Z))throw Error("division by zero");if(U(Q))return new ie(I,I);if(B(Q))return Z=ce(W(Q),Z),new ie(W(Z.g),W(Z.h));if(B(Z))return Z=ce(Q,W(Z)),new ie(W(Z.g),Z.h);if(30<Q.g.length){if(B(Q)||B(Z))throw Error("slowDivide_ only works with positive integers.");for(var X=O,re=Z;0>=re.l(Q);)X=ne(X),re=ne(re);var pe=de(X,1),he=de(re,1);for(re=de(re,2),X=de(X,2);!U(re);){var ue=he.add(re);0>=ue.l(Q)&&(pe=pe.add(X),he=ue),re=de(re,1),X=de(X,1)}return Z=J(Q,pe.j(Z)),new ie(pe,Z)}for(pe=I;0<=Q.l(Z);){for(X=Math.max(1,Math.floor(Q.m()/Z.m())),re=Math.ceil(Math.log(X)/Math.LN2),re=48>=re?1:Math.pow(2,re-48),he=b(X),ue=he.j(Z);B(ue)||0<ue.l(Q);)X-=re,he=b(X),ue=he.j(Z);U(he)&&(he=O),pe=pe.add(he),Q=J(Q,ue)}return new ie(pe,Q)}n.A=function(Q){return ce(this,Q).h},n.and=function(Q){for(var Z=Math.max(this.g.length,Q.g.length),X=[],re=0;re<Z;re++)X[re]=this.i(re)&Q.i(re);return new p(X,this.h&Q.h)},n.or=function(Q){for(var Z=Math.max(this.g.length,Q.g.length),X=[],re=0;re<Z;re++)X[re]=this.i(re)|Q.i(re);return new p(X,this.h|Q.h)},n.xor=function(Q){for(var Z=Math.max(this.g.length,Q.g.length),X=[],re=0;re<Z;re++)X[re]=this.i(re)^Q.i(re);return new p(X,this.h^Q.h)};function ne(Q){for(var Z=Q.g.length+1,X=[],re=0;re<Z;re++)X[re]=Q.i(re)<<1|Q.i(re-1)>>>31;return new p(X,Q.h)}function de(Q,Z){var X=Z>>5;Z%=32;for(var re=Q.g.length-X,pe=[],he=0;he<re;he++)pe[he]=0<Z?Q.i(he+X)>>>Z|Q.i(he+X+1)<<32-Z:Q.i(he+X);return new p(pe,Q.h)}o.prototype.digest=o.prototype.v,o.prototype.reset=o.prototype.s,o.prototype.update=o.prototype.u,Vie=o,p.prototype.add=p.prototype.add,p.prototype.multiply=p.prototype.j,p.prototype.modulo=p.prototype.A,p.prototype.compare=p.prototype.l,p.prototype.toNumber=p.prototype.m,p.prototype.toString=p.prototype.toString,p.prototype.getBits=p.prototype.i,p.fromNumber=b,p.fromString=C,Pg=p}).apply(typeof cJ<"u"?cJ:typeof self<"u"?self:typeof window<"u"?window:{});var FO=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var Fie,Zw,jie,Ik,eF,Bie,Wie,zie;(function(){var n,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(A,z,se){return A==Array.prototype||A==Object.prototype||(A[z]=se.value),A};function i(A){A=[typeof globalThis=="object"&&globalThis,A,typeof window=="object"&&window,typeof self=="object"&&self,typeof FO=="object"&&FO];for(var z=0;z<A.length;++z){var se=A[z];if(se&&se.Math==Math)return se}throw Error("Cannot find global object")}var o=i(this);function l(A,z){if(z)e:{var se=o;A=A.split(".");for(var ge=0;ge<A.length-1;ge++){var qe=A[ge];if(!(qe in se))break e;se=se[qe]}A=A[A.length-1],ge=se[A],z=z(ge),z!=ge&&z!=null&&e(se,A,{configurable:!0,writable:!0,value:z})}}function d(A,z){A instanceof String&&(A+="");var se=0,ge=!1,qe={next:function(){if(!ge&&se<A.length){var at=se++;return{value:z(at,A[at]),done:!1}}return ge=!0,{done:!0,value:void 0}}};return qe[Symbol.iterator]=function(){return qe},qe}l("Array.prototype.values",function(A){return A||function(){return d(this,function(z,se){return se})}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var p=p||{},_=this||self;function E(A){var z=typeof A;return z=z!="object"?z:A?Array.isArray(A)?"array":z:"null",z=="array"||z=="object"&&typeof A.length=="number"}function b(A){var z=typeof A;return z=="object"&&A!=null||z=="function"}function C(A,z,se){return A.call.apply(A.bind,arguments)}function I(A,z,se){if(!A)throw Error();if(2<arguments.length){var ge=Array.prototype.slice.call(arguments,2);return function(){var qe=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(qe,ge),A.apply(z,qe)}}return function(){return A.apply(z,arguments)}}function O(A,z,se){return O=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?C:I,O.apply(null,arguments)}function L(A,z){var se=Array.prototype.slice.call(arguments,1);return function(){var ge=se.slice();return ge.push.apply(ge,arguments),A.apply(this,ge)}}function U(A,z){function se(){}se.prototype=z.prototype,A.aa=z.prototype,A.prototype=new se,A.prototype.constructor=A,A.Qb=function(ge,qe,at){for(var Vt=Array(arguments.length-2),ei=2;ei<arguments.length;ei++)Vt[ei-2]=arguments[ei];return z.prototype[qe].apply(ge,Vt)}}function B(A){const z=A.length;if(0<z){const se=Array(z);for(let ge=0;ge<z;ge++)se[ge]=A[ge];return se}return[]}function W(A,z){for(let se=1;se<arguments.length;se++){const ge=arguments[se];if(E(ge)){const qe=A.length||0,at=ge.length||0;A.length=qe+at;for(let Vt=0;Vt<at;Vt++)A[qe+Vt]=ge[Vt]}else A.push(ge)}}class J{constructor(z,se){this.i=z,this.j=se,this.h=0,this.g=null}get(){let z;return 0<this.h?(this.h--,z=this.g,this.g=z.next,z.next=null):z=this.i(),z}}function $(A){return/^[\s\xa0]*$/.test(A)}function ie(){var A=_.navigator;return A&&(A=A.userAgent)?A:""}function ce(A){return ce[" "](A),A}ce[" "]=function(){};var ne=ie().indexOf("Gecko")!=-1&&!(ie().toLowerCase().indexOf("webkit")!=-1&&ie().indexOf("Edge")==-1)&&!(ie().indexOf("Trident")!=-1||ie().indexOf("MSIE")!=-1)&&ie().indexOf("Edge")==-1;function de(A,z,se){for(const ge in A)z.call(se,A[ge],ge,A)}function Q(A,z){for(const se in A)z.call(void 0,A[se],se,A)}function Z(A){const z={};for(const se in A)z[se]=A[se];return z}const X="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function re(A,z){let se,ge;for(let qe=1;qe<arguments.length;qe++){ge=arguments[qe];for(se in ge)A[se]=ge[se];for(let at=0;at<X.length;at++)se=X[at],Object.prototype.hasOwnProperty.call(ge,se)&&(A[se]=ge[se])}}function pe(A){var z=1;A=A.split(":");const se=[];for(;0<z&&A.length;)se.push(A.shift()),z--;return A.length&&se.push(A.join(":")),se}function he(A){_.setTimeout(()=>{throw A},0)}function ue(){var A=Ee;let z=null;return A.g&&(z=A.g,A.g=A.g.next,A.g||(A.h=null),z.next=null),z}class xe{constructor(){this.h=this.g=null}add(z,se){const ge=We.get();ge.set(z,se),this.h?this.h.next=ge:this.g=ge,this.h=ge}}var We=new J(()=>new $e,A=>A.reset());class $e{constructor(){this.next=this.g=this.h=null}set(z,se){this.h=z,this.g=se,this.next=null}reset(){this.next=this.g=this.h=null}}let ve,_e=!1,Ee=new xe,ke=()=>{const A=_.Promise.resolve(void 0);ve=()=>{A.then(Te)}};var Te=()=>{for(var A;A=ue();){try{A.h.call(A.g)}catch(se){he(se)}var z=We;z.j(A),100>z.h&&(z.h++,A.next=z.g,z.g=A)}_e=!1};function be(){this.s=this.s,this.C=this.C}be.prototype.s=!1,be.prototype.ma=function(){this.s||(this.s=!0,this.N())},be.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function Pe(A,z){this.type=A,this.g=this.target=z,this.defaultPrevented=!1}Pe.prototype.h=function(){this.defaultPrevented=!0};var Le=function(){if(!_.addEventListener||!Object.defineProperty)return!1;var A=!1,z=Object.defineProperty({},"passive",{get:function(){A=!0}});try{const se=()=>{};_.addEventListener("test",se,z),_.removeEventListener("test",se,z)}catch{}return A}();function ze(A,z){if(Pe.call(this,A?A.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,A){var se=this.type=A.type,ge=A.changedTouches&&A.changedTouches.length?A.changedTouches[0]:null;if(this.target=A.target||A.srcElement,this.g=z,z=A.relatedTarget){if(ne){e:{try{ce(z.nodeName);var qe=!0;break e}catch{}qe=!1}qe||(z=null)}}else se=="mouseover"?z=A.fromElement:se=="mouseout"&&(z=A.toElement);this.relatedTarget=z,ge?(this.clientX=ge.clientX!==void 0?ge.clientX:ge.pageX,this.clientY=ge.clientY!==void 0?ge.clientY:ge.pageY,this.screenX=ge.screenX||0,this.screenY=ge.screenY||0):(this.clientX=A.clientX!==void 0?A.clientX:A.pageX,this.clientY=A.clientY!==void 0?A.clientY:A.pageY,this.screenX=A.screenX||0,this.screenY=A.screenY||0),this.button=A.button,this.key=A.key||"",this.ctrlKey=A.ctrlKey,this.altKey=A.altKey,this.shiftKey=A.shiftKey,this.metaKey=A.metaKey,this.pointerId=A.pointerId||0,this.pointerType=typeof A.pointerType=="string"?A.pointerType:Je[A.pointerType]||"",this.state=A.state,this.i=A,A.defaultPrevented&&ze.aa.h.call(this)}}U(ze,Pe);var Je={2:"touch",3:"pen",4:"mouse"};ze.prototype.h=function(){ze.aa.h.call(this);var A=this.i;A.preventDefault?A.preventDefault():A.returnValue=!1};var et="closure_listenable_"+(1e6*Math.random()|0),ut=0;function rt(A,z,se,ge,qe){this.listener=A,this.proxy=null,this.src=z,this.type=se,this.capture=!!ge,this.ha=qe,this.key=++ut,this.da=this.fa=!1}function It(A){A.da=!0,A.listener=null,A.proxy=null,A.src=null,A.ha=null}function pn(A){this.src=A,this.g={},this.h=0}pn.prototype.add=function(A,z,se,ge,qe){var at=A.toString();A=this.g[at],A||(A=this.g[at]=[],this.h++);var Vt=an(A,z,ge,qe);return-1<Vt?(z=A[Vt],se||(z.fa=!1)):(z=new rt(z,this.src,at,!!ge,qe),z.fa=se,A.push(z)),z};function Ft(A,z){var se=z.type;if(se in A.g){var ge=A.g[se],qe=Array.prototype.indexOf.call(ge,z,void 0),at;(at=0<=qe)&&Array.prototype.splice.call(ge,qe,1),at&&(It(z),A.g[se].length==0&&(delete A.g[se],A.h--))}}function an(A,z,se,ge){for(var qe=0;qe<A.length;++qe){var at=A[qe];if(!at.da&&at.listener==z&&at.capture==!!se&&at.ha==ge)return qe}return-1}var en="closure_lm_"+(1e6*Math.random()|0),Xt={};function Vn(A,z,se,ge,qe){if(Array.isArray(z)){for(var at=0;at<z.length;at++)Vn(A,z[at],se,ge,qe);return null}return se=mn(se),A&&A[et]?A.K(z,se,b(ge)?!!ge.capture:!1,qe):Kt(A,z,se,!1,ge,qe)}function Kt(A,z,se,ge,qe,at){if(!z)throw Error("Invalid event type");var Vt=b(qe)?!!qe.capture:!!qe,ei=St(A);if(ei||(A[en]=ei=new pn(A)),se=ei.add(z,se,ge,Vt,at),se.proxy)return se;if(ge=Re(),se.proxy=ge,ge.src=A,ge.listener=se,A.addEventListener)Le||(qe=Vt),qe===void 0&&(qe=!1),A.addEventListener(z.toString(),ge,qe);else if(A.attachEvent)A.attachEvent(ft(z.toString()),ge);else if(A.addListener&&A.removeListener)A.addListener(ge);else throw Error("addEventListener and attachEvent are unavailable.");return se}function Re(){function A(se){return z.call(A.src,A.listener,se)}const z=gt;return A}function Ve(A,z,se,ge,qe){if(Array.isArray(z))for(var at=0;at<z.length;at++)Ve(A,z[at],se,ge,qe);else ge=b(ge)?!!ge.capture:!!ge,se=mn(se),A&&A[et]?(A=A.i,z=String(z).toString(),z in A.g&&(at=A.g[z],se=an(at,se,ge,qe),-1<se&&(It(at[se]),Array.prototype.splice.call(at,se,1),at.length==0&&(delete A.g[z],A.h--)))):A&&(A=St(A))&&(z=A.g[z.toString()],A=-1,z&&(A=an(z,se,ge,qe)),(se=-1<A?z[A]:null)&&Ge(se))}function Ge(A){if(typeof A!="number"&&A&&!A.da){var z=A.src;if(z&&z[et])Ft(z.i,A);else{var se=A.type,ge=A.proxy;z.removeEventListener?z.removeEventListener(se,ge,A.capture):z.detachEvent?z.detachEvent(ft(se),ge):z.addListener&&z.removeListener&&z.removeListener(ge),(se=St(z))?(Ft(se,A),se.h==0&&(se.src=null,z[en]=null)):It(A)}}}function ft(A){return A in Xt?Xt[A]:Xt[A]="on"+A}function gt(A,z){if(A.da)A=!0;else{z=new ze(z,this);var se=A.listener,ge=A.ha||A.src;A.fa&&Ge(A),A=se.call(ge,z)}return A}function St(A){return A=A[en],A instanceof pn?A:null}var Wt="__closure_events_fn_"+(1e9*Math.random()>>>0);function mn(A){return typeof A=="function"?A:(A[Wt]||(A[Wt]=function(z){return A.handleEvent(z)}),A[Wt])}function vn(){be.call(this),this.i=new pn(this),this.M=this,this.F=null}U(vn,be),vn.prototype[et]=!0,vn.prototype.removeEventListener=function(A,z,se,ge){Ve(this,A,z,se,ge)};function tn(A,z){var se,ge=A.F;if(ge)for(se=[];ge;ge=ge.F)se.push(ge);if(A=A.M,ge=z.type||z,typeof z=="string")z=new Pe(z,A);else if(z instanceof Pe)z.target=z.target||A;else{var qe=z;z=new Pe(ge,A),re(z,qe)}if(qe=!0,se)for(var at=se.length-1;0<=at;at--){var Vt=z.g=se[at];qe=vt(Vt,ge,!0,z)&&qe}if(Vt=z.g=A,qe=vt(Vt,ge,!0,z)&&qe,qe=vt(Vt,ge,!1,z)&&qe,se)for(at=0;at<se.length;at++)Vt=z.g=se[at],qe=vt(Vt,ge,!1,z)&&qe}vn.prototype.N=function(){if(vn.aa.N.call(this),this.i){var A=this.i,z;for(z in A.g){for(var se=A.g[z],ge=0;ge<se.length;ge++)It(se[ge]);delete A.g[z],A.h--}}this.F=null},vn.prototype.K=function(A,z,se,ge){return this.i.add(String(A),z,!1,se,ge)},vn.prototype.L=function(A,z,se,ge){return this.i.add(String(A),z,!0,se,ge)};function vt(A,z,se,ge){if(z=A.i.g[String(z)],!z)return!0;z=z.concat();for(var qe=!0,at=0;at<z.length;++at){var Vt=z[at];if(Vt&&!Vt.da&&Vt.capture==se){var ei=Vt.listener,yi=Vt.ha||Vt.src;Vt.fa&&Ft(A.i,Vt),qe=ei.call(yi,ge)!==!1&&qe}}return qe&&!ge.defaultPrevented}function nr(A,z,se){if(typeof A=="function")se&&(A=O(A,se));else if(A&&typeof A.handleEvent=="function")A=O(A.handleEvent,A);else throw Error("Invalid listener argument");return 2147483647<Number(z)?-1:_.setTimeout(A,z||0)}function Dt(A){A.g=nr(()=>{A.g=null,A.i&&(A.i=!1,Dt(A))},A.l);const z=A.h;A.h=null,A.m.apply(null,z)}class Ut extends be{constructor(z,se){super(),this.m=z,this.l=se,this.h=null,this.i=!1,this.g=null}j(z){this.h=arguments,this.g?this.i=!0:Dt(this)}N(){super.N(),this.g&&(_.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function gn(A){be.call(this),this.h=A,this.g={}}U(gn,be);var Li=[];function Es(A){de(A.g,function(z,se){this.g.hasOwnProperty(se)&&Ge(z)},A),A.g={}}gn.prototype.N=function(){gn.aa.N.call(this),Es(this)},gn.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var ci=_.JSON.stringify,qo=_.JSON.parse,ic=class{stringify(A){return _.JSON.stringify(A,void 0)}parse(A){return _.JSON.parse(A,void 0)}};function Xs(){}Xs.prototype.h=null;function Js(A){return A.h||(A.h=A.i())}function Ac(){}var vs={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function Ia(){Pe.call(this,"d")}U(Ia,Pe);function Po(){Pe.call(this,"c")}U(Po,Pe);var Aa={},sc=null;function ml(){return sc=sc||new vn}Aa.La="serverreachability";function Pa(A){Pe.call(this,Aa.La,A)}U(Pa,Pe);function oc(A){const z=ml();tn(z,new Pa(z))}Aa.STAT_EVENT="statevent";function lo(A,z){Pe.call(this,Aa.STAT_EVENT,A),this.stat=z}U(lo,Pe);function Mi(A){const z=ml();tn(z,new lo(z,A))}Aa.Ma="timingevent";function _t(A,z){Pe.call(this,Aa.Ma,A),this.size=z}U(_t,Pe);function hn(A,z){if(typeof A!="function")throw Error("Fn must not be null and must be a function");return _.setTimeout(function(){A()},z)}function yr(){this.g=!0}yr.prototype.xa=function(){this.g=!1};function _i(A,z,se,ge,qe,at){A.info(function(){if(A.g)if(at)for(var Vt="",ei=at.split("&"),yi=0;yi<ei.length;yi++){var Ir=ei[yi].split("=");if(1<Ir.length){var Qs=Ir[0];Ir=Ir[1];var bs=Qs.split("_");Vt=2<=bs.length&&bs[1]=="type"?Vt+(Qs+"="+Ir+"&"):Vt+(Qs+"=redacted&")}}else Vt=null;else Vt=at;return"XMLHTTP REQ ("+ge+") [attempt "+qe+"]: "+z+`
`+se+`
`+Vt})}function Oo(A,z,se,ge,qe,at,Vt){A.info(function(){return"XMLHTTP RESP ("+ge+") [ attempt "+qe+"]: "+z+`
`+se+`
`+at+" "+Vt})}function uo(A,z,se,ge){A.info(function(){return"XMLHTTP TEXT ("+z+"): "+Tf(A,se)+(ge?" "+ge:"")})}function Xl(A,z){A.info(function(){return"TIMEOUT: "+z})}yr.prototype.info=function(){};function Tf(A,z){if(!A.g)return z;if(!z)return null;try{var se=JSON.parse(z);if(se){for(A=0;A<se.length;A++)if(Array.isArray(se[A])){var ge=se[A];if(!(2>ge.length)){var qe=ge[1];if(Array.isArray(qe)&&!(1>qe.length)){var at=qe[0];if(at!="noop"&&at!="stop"&&at!="close")for(var Vt=1;Vt<qe.length;Vt++)qe[Vt]=""}}}}return ci(se)}catch{return z}}var gl={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},Jl={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},Ri;function ho(){}U(ho,Xs),ho.prototype.g=function(){return new XMLHttpRequest},ho.prototype.i=function(){return{}},Ri=new ho;function zi(A,z,se,ge){this.j=A,this.i=z,this.l=se,this.R=ge||1,this.U=new gn(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new $d}function $d(){this.i=null,this.g="",this.h=!1}var Kd={},ac={};function qd(A,z,se){A.L=1,A.v=lc(Xo(z)),A.m=se,A.P=!0,$u(A,null)}function $u(A,z){A.F=Date.now(),qr(A),A.A=Xo(A.v);var se=A.A,ge=A.R;Array.isArray(ge)||(ge=[String(ge)]),ru(se.i,"t",ge),A.C=0,se=A.j.J,A.h=new $d,A.g=uE(A.j,se?z:null,!A.m),0<A.O&&(A.M=new Ut(O(A.Y,A,A.g),A.O)),z=A.U,se=A.g,ge=A.ca;var qe="readystatechange";Array.isArray(qe)||(qe&&(Li[0]=qe.toString()),qe=Li);for(var at=0;at<qe.length;at++){var Vt=Vn(se,qe[at],ge||z.handleEvent,!1,z.h||z);if(!Vt)break;z.g[Vt.key]=Vt}z=A.H?Z(A.H):{},A.m?(A.u||(A.u="POST"),z["Content-Type"]="application/x-www-form-urlencoded",A.g.ea(A.A,A.u,A.m,z)):(A.u="GET",A.g.ea(A.A,A.u,null,z)),oc(),_i(A.i,A.u,A.A,A.l,A.R,A.m)}zi.prototype.ca=function(A){A=A.target;const z=this.M;z&&Ai(A)==3?z.j():this.Y(A)},zi.prototype.Y=function(A){try{if(A==this.g)e:{const bs=Ai(this.g);var z=this.g.Ba();const uc=this.g.Z();if(!(3>bs)&&(bs!=3||this.g&&(this.h.h||this.g.oa()||Vs(this.g)))){this.J||bs!=4||z==7||(z==8||0>=uc?oc(3):oc(2)),Pc(this);var se=this.g.Z();this.X=se;t:if(Yo(this)){var ge=Vs(this.g);A="";var qe=ge.length,at=Ai(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){Oa(this),_l(this);var Vt="";break t}this.h.i=new _.TextDecoder}for(z=0;z<qe;z++)this.h.h=!0,A+=this.h.i.decode(ge[z],{stream:!(at&&z==qe-1)});ge.length=0,this.h.g+=A,this.C=0,Vt=this.h.g}else Vt=this.g.oa();if(this.o=se==200,Oo(this.i,this.u,this.A,this.l,this.R,bs,se),this.o){if(this.T&&!this.K){t:{if(this.g){var ei,yi=this.g;if((ei=yi.g?yi.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!$(ei)){var Ir=ei;break t}}Ir=null}if(se=Ir)uo(this.i,this.l,se,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,wf(this,se);else{this.o=!1,this.s=3,Mi(12),Oa(this),_l(this);break e}}if(this.P){se=!0;let oa;for(;!this.J&&this.C<Vt.length;)if(oa=Yd(this,Vt),oa==ac){bs==4&&(this.s=4,Mi(14),se=!1),uo(this.i,this.l,null,"[Incomplete Response]");break}else if(oa==Kd){this.s=4,Mi(15),uo(this.i,this.l,Vt,"[Invalid Chunk]"),se=!1;break}else uo(this.i,this.l,oa,null),wf(this,oa);if(Yo(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),bs!=4||Vt.length!=0||this.h.h||(this.s=1,Mi(16),se=!1),this.o=this.o&&se,!se)uo(this.i,this.l,Vt,"[Invalid Chunked Response]"),Oa(this),_l(this);else if(0<Vt.length&&!this.W){this.W=!0;var Qs=this.j;Qs.g==this&&Qs.ba&&!Qs.M&&(Qs.j.info("Great, no buffering proxy detected. Bytes received: "+Vt.length),Yg(Qs),Qs.M=!0,Mi(11))}}else uo(this.i,this.l,Vt,null),wf(this,Vt);bs==4&&Oa(this),this.o&&!this.J&&(bs==4?hm(this.j,this):(this.o=!1,qr(this)))}else na(this.g),se==400&&0<Vt.indexOf("Unknown SID")?(this.s=3,Mi(12)):(this.s=0,Mi(13)),Oa(this),_l(this)}}}catch{}finally{}};function Yo(A){return A.g?A.u=="GET"&&A.L!=2&&A.j.Ca:!1}function Yd(A,z){var se=A.C,ge=z.indexOf(`
`,se);return ge==-1?ac:(se=Number(z.substring(se,ge)),isNaN(se)?Kd:(ge+=1,ge+se>z.length?ac:(z=z.slice(ge,ge+se),A.C=ge+se,z)))}zi.prototype.cancel=function(){this.J=!0,Oa(this)};function qr(A){A.S=Date.now()+A.I,Ii(A,A.I)}function Ii(A,z){if(A.B!=null)throw Error("WatchDog timer not null");A.B=hn(O(A.ba,A),z)}function Pc(A){A.B&&(_.clearTimeout(A.B),A.B=null)}zi.prototype.ba=function(){this.B=null;const A=Date.now();0<=A-this.S?(Xl(this.i,this.A),this.L!=2&&(oc(),Mi(17)),Oa(this),this.s=2,_l(this)):Ii(this,this.S-A)};function _l(A){A.j.G==0||A.J||hm(A.j,A)}function Oa(A){Pc(A);var z=A.M;z&&typeof z.ma=="function"&&z.ma(),A.M=null,Es(A.U),A.g&&(z=A.g,A.g=null,z.abort(),z.ma())}function wf(A,z){try{var se=A.j;if(se.G!=0&&(se.g==A||fo(se.h,A))){if(!A.K&&fo(se.h,A)&&se.G==3){try{var ge=se.Da.g.parse(z)}catch{ge=null}if(Array.isArray(ge)&&ge.length==3){var qe=ge;if(qe[0]==0){e:if(!se.u){if(se.g)if(se.g.F+3e3<A.F)dm(se),bl(se);else break e;um(se),Mi(18)}}else se.za=qe[1],0<se.za-se.T&&37500>qe[2]&&se.F&&se.v==0&&!se.C&&(se.C=hn(O(se.Za,se),6e3));if(1>=im(se.h)&&se.ca){try{se.ca()}catch{}se.ca=void 0}}else Zu(se,11)}else if((A.K||se.g==A)&&dm(se),!$(z))for(qe=se.Da.g.parse(z),z=0;z<qe.length;z++){let Ir=qe[z];if(se.T=Ir[0],Ir=Ir[1],se.G==2)if(Ir[0]=="c"){se.K=Ir[1],se.ia=Ir[2];const Qs=Ir[3];Qs!=null&&(se.la=Qs,se.j.info("VER="+se.la));const bs=Ir[4];bs!=null&&(se.Aa=bs,se.j.info("SVER="+se.Aa));const uc=Ir[5];uc!=null&&typeof uc=="number"&&0<uc&&(ge=1.5*uc,se.L=ge,se.j.info("backChannelRequestTimeoutMs_="+ge)),ge=se;const oa=A.g;if(oa){const Pf=oa.g?oa.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(Pf){var at=ge.h;at.g||Pf.indexOf("spdy")==-1&&Pf.indexOf("quic")==-1&&Pf.indexOf("h2")==-1||(at.j=at.l,at.g=new Set,at.h&&(Cf(at,at.h),at.h=null))}if(ge.D){const pm=oa.g?oa.g.getResponseHeader("X-HTTP-Session-Id"):null;pm&&(ge.ya=pm,Zr(ge.I,ge.D,pm))}}se.G=3,se.l&&se.l.ua(),se.ba&&(se.R=Date.now()-A.F,se.j.info("Handshake RTT: "+se.R+"ms")),ge=se;var Vt=A;if(ge.qa=Xg(ge,ge.J?ge.ia:null,ge.W),Vt.K){yl(ge.h,Vt);var ei=Vt,yi=ge.L;yi&&(ei.I=yi),ei.B&&(Pc(ei),qr(ei)),ge.g=Vt}else su(ge);0<se.i.length&&Nc(se)}else Ir[0]!="stop"&&Ir[0]!="close"||Zu(se,7);else se.G==3&&(Ir[0]=="stop"||Ir[0]=="close"?Ir[0]=="stop"?Zu(se,7):os(se):Ir[0]!="noop"&&se.l&&se.l.ta(Ir),se.v=0)}}oc(4)}catch{}}var Xd=class{constructor(A,z){this.g=A,this.map=z}};function Ql(A){this.l=A||10,_.PerformanceNavigationTiming?(A=_.performance.getEntriesByType("navigation"),A=0<A.length&&(A[0].nextHopProtocol=="hq"||A[0].nextHopProtocol=="h2")):A=!!(_.chrome&&_.chrome.loadTimes&&_.chrome.loadTimes()&&_.chrome.loadTimes().wasFetchedViaSpdy),this.j=A?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function ko(A){return A.h?!0:A.g?A.g.size>=A.j:!1}function im(A){return A.h?1:A.g?A.g.size:0}function fo(A,z){return A.h?A.h==z:A.g?A.g.has(z):!1}function Cf(A,z){A.g?A.g.add(z):A.h=z}function yl(A,z){A.h&&A.h==z?A.h=null:A.g&&A.g.has(z)&&A.g.delete(z)}Ql.prototype.cancel=function(){if(this.i=Jd(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const A of this.g.values())A.cancel();this.g.clear()}};function Jd(A){if(A.h!=null)return A.i.concat(A.h.D);if(A.g!=null&&A.g.size!==0){let z=A.i;for(const se of A.g.values())z=z.concat(se.D);return z}return B(A.i)}function Qd(A){if(A.V&&typeof A.V=="function")return A.V();if(typeof Map<"u"&&A instanceof Map||typeof Set<"u"&&A instanceof Set)return Array.from(A.values());if(typeof A=="string")return A.split("");if(E(A)){for(var z=[],se=A.length,ge=0;ge<se;ge++)z.push(A[ge]);return z}z=[],se=0;for(ge in A)z[se++]=A[ge];return z}function Er(A){if(A.na&&typeof A.na=="function")return A.na();if(!A.V||typeof A.V!="function"){if(typeof Map<"u"&&A instanceof Map)return Array.from(A.keys());if(!(typeof Set<"u"&&A instanceof Set)){if(E(A)||typeof A=="string"){var z=[];A=A.length;for(var se=0;se<A;se++)z.push(se);return z}z=[],se=0;for(const ge in A)z[se++]=ge;return z}}}function Zl(A,z){if(A.forEach&&typeof A.forEach=="function")A.forEach(z,void 0);else if(E(A)||typeof A=="string")Array.prototype.forEach.call(A,z,void 0);else for(var se=Er(A),ge=Qd(A),qe=ge.length,at=0;at<qe;at++)z.call(void 0,ge[at],se&&se[at],A)}var eu=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Ku(A,z){if(A){A=A.split("&");for(var se=0;se<A.length;se++){var ge=A[se].indexOf("="),qe=null;if(0<=ge){var at=A[se].substring(0,ge);qe=A[se].substring(ge+1)}else at=A[se];z(at,qe?decodeURIComponent(qe.replace(/\+/g," ")):"")}}}function cc(A){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,A instanceof cc){this.h=A.h,qu(this,A.j),this.o=A.o,this.g=A.g,El(this,A.s),this.l=A.l;var z=A.i,se=new Jo;se.i=z.i,z.g&&(se.g=new Map(z.g),se.h=z.h),tu(this,se),this.m=A.m}else A&&(z=String(A).match(eu))?(this.h=!1,qu(this,z[1]||"",!0),this.o=cr(z[2]||""),this.g=cr(z[3]||"",!0),El(this,z[4]),this.l=cr(z[5]||"",!0),tu(this,z[6]||"",!0),this.m=cr(z[7]||"")):(this.h=!1,this.i=new Jo(null,this.h))}cc.prototype.toString=function(){var A=[],z=this.j;z&&A.push(Oc(z,nu,!0),":");var se=this.g;return(se||z=="file")&&(A.push("//"),(z=this.o)&&A.push(Oc(z,nu,!0),"@"),A.push(encodeURIComponent(String(se)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),se=this.s,se!=null&&A.push(":",String(se))),(se=this.l)&&(this.g&&se.charAt(0)!="/"&&A.push("/"),A.push(Oc(se,se.charAt(0)=="/"?Rf:Zd,!0))),(se=this.i.toString())&&A.push("?",se),(se=this.m)&&A.push("#",Oc(se,If)),A.join("")};function Xo(A){return new cc(A)}function qu(A,z,se){A.j=se?cr(z,!0):z,A.j&&(A.j=A.j.replace(/:$/,""))}function El(A,z){if(z){if(z=Number(z),isNaN(z)||0>z)throw Error("Bad port number "+z);A.s=z}else A.s=null}function tu(A,z,se){z instanceof Jo?(A.i=z,ta(A.i,A.h)):(se||(z=Oc(z,om)),A.i=new Jo(z,A.h))}function Zr(A,z,se){A.i.set(z,se)}function lc(A){return Zr(A,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),A}function cr(A,z){return A?z?decodeURI(A.replace(/%25/g,"%2525")):decodeURIComponent(A):""}function Oc(A,z,se){return typeof A=="string"?(A=encodeURI(A).replace(z,sm),se&&(A=A.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),A):null}function sm(A){return A=A.charCodeAt(0),"%"+(A>>4&15).toString(16)+(A&15).toString(16)}var nu=/[#\/\?@]/g,Zd=/[#\?:]/g,Rf=/[#\?]/g,om=/[#\?@]/g,If=/#/g;function Jo(A,z){this.h=this.g=null,this.i=A||null,this.j=!!z}function hs(A){A.g||(A.g=new Map,A.h=0,A.i&&Ku(A.i,function(z,se){A.add(decodeURIComponent(z.replace(/\+/g," ")),se)}))}n=Jo.prototype,n.add=function(A,z){hs(this),this.i=null,A=ea(this,A);var se=this.g.get(A);return se||this.g.set(A,se=[]),se.push(z),this.h+=1,this};function Qo(A,z){hs(A),z=ea(A,z),A.g.has(z)&&(A.i=null,A.h-=A.g.get(z).length,A.g.delete(z))}function Zo(A,z){return hs(A),z=ea(A,z),A.g.has(z)}n.forEach=function(A,z){hs(this),this.g.forEach(function(se,ge){se.forEach(function(qe){A.call(z,qe,ge,this)},this)},this)},n.na=function(){hs(this);const A=Array.from(this.g.values()),z=Array.from(this.g.keys()),se=[];for(let ge=0;ge<z.length;ge++){const qe=A[ge];for(let at=0;at<qe.length;at++)se.push(z[ge])}return se},n.V=function(A){hs(this);let z=[];if(typeof A=="string")Zo(this,A)&&(z=z.concat(this.g.get(ea(this,A))));else{A=Array.from(this.g.values());for(let se=0;se<A.length;se++)z=z.concat(A[se])}return z},n.set=function(A,z){return hs(this),this.i=null,A=ea(this,A),Zo(this,A)&&(this.h-=this.g.get(A).length),this.g.set(A,[z]),this.h+=1,this},n.get=function(A,z){return A?(A=this.V(A),0<A.length?String(A[0]):z):z};function ru(A,z,se){Qo(A,z),0<se.length&&(A.i=null,A.g.set(ea(A,z),B(se)),A.h+=se.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";const A=[],z=Array.from(this.g.keys());for(var se=0;se<z.length;se++){var ge=z[se];const at=encodeURIComponent(String(ge)),Vt=this.V(ge);for(ge=0;ge<Vt.length;ge++){var qe=at;Vt[ge]!==""&&(qe+="="+encodeURIComponent(String(Vt[ge]))),A.push(qe)}}return this.i=A.join("&")};function ea(A,z){return z=String(z),A.j&&(z=z.toLowerCase()),z}function ta(A,z){z&&!A.j&&(hs(A),A.i=null,A.g.forEach(function(se,ge){var qe=ge.toLowerCase();ge!=qe&&(Qo(this,ge),ru(this,qe,se))},A)),A.j=z}function am(A,z){const se=new yr;if(_.Image){const ge=new Image;ge.onload=L(Ss,se,"TestLoadImage: loaded",!0,z,ge),ge.onerror=L(Ss,se,"TestLoadImage: error",!1,z,ge),ge.onabort=L(Ss,se,"TestLoadImage: abort",!1,z,ge),ge.ontimeout=L(Ss,se,"TestLoadImage: timeout",!1,z,ge),_.setTimeout(function(){ge.ontimeout&&ge.ontimeout()},1e4),ge.src=A}else z(!1)}function kc(A,z){const se=new yr,ge=new AbortController,qe=setTimeout(()=>{ge.abort(),Ss(se,"TestPingServer: timeout",!1,z)},1e4);fetch(A,{signal:ge.signal}).then(at=>{clearTimeout(qe),at.ok?Ss(se,"TestPingServer: ok",!0,z):Ss(se,"TestPingServer: server error",!1,z)}).catch(()=>{clearTimeout(qe),Ss(se,"TestPingServer: error",!1,z)})}function Ss(A,z,se,ge,qe){try{qe&&(qe.onload=null,qe.onerror=null,qe.onabort=null,qe.ontimeout=null),ge(se)}catch{}}function Yu(){this.g=new ic}function Af(A,z,se){const ge=se||"";try{Zl(A,function(qe,at){let Vt=qe;b(qe)&&(Vt=ci(qe)),z.push(ge+at+"="+encodeURIComponent(Vt))})}catch(qe){throw z.push(ge+"type="+encodeURIComponent("_badmap")),qe}}function vl(A){this.l=A.Ub||null,this.j=A.eb||!1}U(vl,Xs),vl.prototype.g=function(){return new iu(this.l,this.j)},vl.prototype.i=function(A){return function(){return A}}({});function iu(A,z){vn.call(this),this.D=A,this.o=z,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}U(iu,vn),n=iu.prototype,n.open=function(A,z){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=A,this.A=z,this.readyState=1,Na(this)},n.send=function(A){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const z={headers:this.u,method:this.B,credentials:this.m,cache:void 0};A&&(z.body=A),(this.D||_).fetch(new Request(this.A,z)).then(this.Sa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,ka(this)),this.readyState=0},n.Sa=function(A){if(this.g&&(this.l=A,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=A.headers,this.readyState=2,Na(this)),this.g&&(this.readyState=3,Na(this),this.g)))if(this.responseType==="arraybuffer")A.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof _.ReadableStream<"u"&&"body"in A){if(this.j=A.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;cm(this)}else A.text().then(this.Ra.bind(this),this.ga.bind(this))};function cm(A){A.j.read().then(A.Pa.bind(A)).catch(A.ga.bind(A))}n.Pa=function(A){if(this.g){if(this.o&&A.value)this.response.push(A.value);else if(!this.o){var z=A.value?A.value:new Uint8Array(0);(z=this.v.decode(z,{stream:!A.done}))&&(this.response=this.responseText+=z)}A.done?ka(this):Na(this),this.readyState==3&&cm(this)}},n.Ra=function(A){this.g&&(this.response=this.responseText=A,ka(this))},n.Qa=function(A){this.g&&(this.response=A,ka(this))},n.ga=function(){this.g&&ka(this)};function ka(A){A.readyState=4,A.l=null,A.j=null,A.v=null,Na(A)}n.setRequestHeader=function(A,z){this.u.append(A,z)},n.getResponseHeader=function(A){return this.h&&this.h.get(A.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";const A=[],z=this.h.entries();for(var se=z.next();!se.done;)se=se.value,A.push(se[0]+": "+se[1]),se=z.next();return A.join(`\r
`)};function Na(A){A.onreadystatechange&&A.onreadystatechange.call(A)}Object.defineProperty(iu.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(A){this.m=A?"include":"same-origin"}});function Sl(A){let z="";return de(A,function(se,ge){z+=ge,z+=":",z+=se,z+=`\r
`}),z}function Ce(A,z,se){e:{for(ge in se){var ge=!1;break e}ge=!0}ge||(se=Sl(se),typeof A=="string"?se!=null&&encodeURIComponent(String(se)):Zr(A,z,se))}function De(A){vn.call(this),this.headers=new Map,this.o=A||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}U(De,vn);var nt=/^https?$/i,Qt=["POST","PUT"];n=De.prototype,n.Ha=function(A){this.J=A},n.ea=function(A,z,se,ge){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+A);z=z?z.toUpperCase():"GET",this.D=A,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():Ri.g(),this.v=this.o?Js(this.o):Js(Ri),this.g.onreadystatechange=O(this.Ea,this);try{this.B=!0,this.g.open(z,String(A),!0),this.B=!1}catch(at){Qn(this,at);return}if(A=se||"",se=new Map(this.headers),ge)if(Object.getPrototypeOf(ge)===Object.prototype)for(var qe in ge)se.set(qe,ge[qe]);else if(typeof ge.keys=="function"&&typeof ge.get=="function")for(const at of ge.keys())se.set(at,ge.get(at));else throw Error("Unknown input type for opt_headers: "+String(ge));ge=Array.from(se.keys()).find(at=>at.toLowerCase()=="content-type"),qe=_.FormData&&A instanceof _.FormData,!(0<=Array.prototype.indexOf.call(Qt,z,void 0))||ge||qe||se.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[at,Vt]of se)this.g.setRequestHeader(at,Vt);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{Wr(this),this.u=!0,this.g.send(A),this.u=!1}catch(at){Qn(this,at)}};function Qn(A,z){A.h=!1,A.g&&(A.j=!0,A.g.abort(),A.j=!1),A.l=z,A.m=5,Rr(A),fn(A)}function Rr(A){A.A||(A.A=!0,tn(A,"complete"),tn(A,"error"))}n.abort=function(A){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=A||7,tn(this,"complete"),tn(this,"abort"),fn(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),fn(this,!0)),De.aa.N.call(this)},n.Ea=function(){this.s||(this.B||this.u||this.j?Yr(this):this.bb())},n.bb=function(){Yr(this)};function Yr(A){if(A.h&&typeof p<"u"&&(!A.v[1]||Ai(A)!=4||A.Z()!=2)){if(A.u&&Ai(A)==4)nr(A.Ea,0,A);else if(tn(A,"readystatechange"),Ai(A)==4){A.h=!1;try{const Vt=A.Z();e:switch(Vt){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var z=!0;break e;default:z=!1}var se;if(!(se=z)){var ge;if(ge=Vt===0){var qe=String(A.D).match(eu)[1]||null;!qe&&_.self&&_.self.location&&(qe=_.self.location.protocol.slice(0,-1)),ge=!nt.test(qe?qe.toLowerCase():"")}se=ge}if(se)tn(A,"complete"),tn(A,"success");else{A.m=6;try{var at=2<Ai(A)?A.g.statusText:""}catch{at=""}A.l=at+" ["+A.Z()+"]",Rr(A)}}finally{fn(A)}}}}function fn(A,z){if(A.g){Wr(A);const se=A.g,ge=A.v[0]?()=>{}:null;A.g=null,A.v=null,z||tn(A,"ready");try{se.onreadystatechange=ge}catch{}}}function Wr(A){A.I&&(_.clearTimeout(A.I),A.I=null)}n.isActive=function(){return!!this.g};function Ai(A){return A.g?A.g.readyState:0}n.Z=function(){try{return 2<Ai(this)?this.g.status:-1}catch{return-1}},n.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.Oa=function(A){if(this.g){var z=this.g.responseText;return A&&z.indexOf(A)==0&&(z=z.substring(A.length)),qo(z)}};function Vs(A){try{if(!A.g)return null;if("response"in A.g)return A.g.response;switch(A.H){case"":case"text":return A.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in A.g)return A.g.mozResponseArrayBuffer}return null}catch{return null}}function na(A){const z={};A=(A.g&&2<=Ai(A)&&A.g.getAllResponseHeaders()||"").split(`\r
`);for(let ge=0;ge<A.length;ge++){if($(A[ge]))continue;var se=pe(A[ge]);const qe=se[0];if(se=se[1],typeof se!="string")continue;se=se.trim();const at=z[qe]||[];z[qe]=at,at.push(se)}Q(z,function(ge){return ge.join(", ")})}n.Ba=function(){return this.m},n.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function ra(A,z,se){return se&&se.internalChannelParams&&se.internalChannelParams[A]||z}function Xu(A){this.Aa=0,this.i=[],this.j=new yr,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=ra("failFast",!1,A),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=ra("baseRetryDelayMs",5e3,A),this.cb=ra("retryDelaySeedMs",1e4,A),this.Wa=ra("forwardChannelMaxRetries",2,A),this.wa=ra("forwardChannelRequestTimeoutMs",2e4,A),this.pa=A&&A.xmlHttpFactory||void 0,this.Xa=A&&A.Tb||void 0,this.Ca=A&&A.useFetchStreams||!1,this.L=void 0,this.J=A&&A.supportsCrossDomainXhr||!1,this.K="",this.h=new Ql(A&&A.concurrentRequestLimit),this.Da=new Yu,this.P=A&&A.fastHandshake||!1,this.O=A&&A.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=A&&A.Rb||!1,A&&A.xa&&this.j.xa(),A&&A.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&A&&A.detectBufferingProxy||!1,this.ja=void 0,A&&A.longPollingTimeout&&0<A.longPollingTimeout&&(this.ja=A.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}n=Xu.prototype,n.la=8,n.G=1,n.connect=function(A,z,se,ge){Mi(0),this.W=A,this.H=z||{},se&&ge!==void 0&&(this.H.OSID=se,this.H.OAID=ge),this.F=this.X,this.I=Xg(this,null,this.W),Nc(this)};function os(A){if(eh(A),A.G==3){var z=A.U++,se=Xo(A.I);if(Zr(se,"SID",A.K),Zr(se,"RID",z),Zr(se,"TYPE","terminate"),Ju(A,se),z=new zi(A,A.j,z),z.L=2,z.v=lc(Xo(se)),se=!1,_.navigator&&_.navigator.sendBeacon)try{se=_.navigator.sendBeacon(z.v.toString(),"")}catch{}!se&&_.Image&&(new Image().src=z.v,se=!0),se||(z.g=uE(z.j,null),z.g.ea(z.v)),z.F=Date.now(),qr(z)}ed(A)}function bl(A){A.g&&(Yg(A),A.g.cancel(),A.g=null)}function eh(A){bl(A),A.u&&(_.clearTimeout(A.u),A.u=null),dm(A),A.h.cancel(),A.s&&(typeof A.s=="number"&&_.clearTimeout(A.s),A.s=null)}function Nc(A){if(!ko(A.h)&&!A.s){A.s=!0;var z=A.Ga;ve||ke(),_e||(ve(),_e=!0),Ee.add(z,A),A.B=0}}function qg(A,z){return im(A.h)>=A.h.j-(A.s?1:0)?!1:A.s?(A.i=z.D.concat(A.i),!0):A.G==1||A.G==2||A.B>=(A.Va?0:A.Wa)?!1:(A.s=hn(O(A.Ga,A,z),Qu(A,A.B)),A.B++,!0)}n.Ga=function(A){if(this.s)if(this.s=null,this.G==1){if(!A){this.U=Math.floor(1e5*Math.random()),A=this.U++;const qe=new zi(this,this.j,A);let at=this.o;if(this.S&&(at?(at=Z(at),re(at,this.S)):at=this.S),this.m!==null||this.O||(qe.H=at,at=null),this.P)e:{for(var z=0,se=0;se<this.i.length;se++){t:{var ge=this.i[se];if("__data__"in ge.map&&(ge=ge.map.__data__,typeof ge=="string")){ge=ge.length;break t}ge=void 0}if(ge===void 0)break;if(z+=ge,4096<z){z=se;break e}if(z===4096||se===this.i.length-1){z=se+1;break e}}z=1e3}else z=1e3;z=ia(this,qe,z),se=Xo(this.I),Zr(se,"RID",A),Zr(se,"CVER",22),this.D&&Zr(se,"X-HTTP-Session-Id",this.D),Ju(this,se),at&&(this.O?z="headers="+encodeURIComponent(String(Sl(at)))+"&"+z:this.m&&Ce(se,this.m,at)),Cf(this.h,qe),this.Ua&&Zr(se,"TYPE","init"),this.P?(Zr(se,"$req",z),Zr(se,"SID","null"),qe.T=!0,qd(qe,se,null)):qd(qe,se,z),this.G=2}}else this.G==3&&(A?lm(this,A):this.i.length==0||ko(this.h)||lm(this))};function lm(A,z){var se;z?se=z.l:se=A.U++;const ge=Xo(A.I);Zr(ge,"SID",A.K),Zr(ge,"RID",se),Zr(ge,"AID",A.T),Ju(A,ge),A.m&&A.o&&Ce(ge,A.m,A.o),se=new zi(A,A.j,se,A.B+1),A.m===null&&(se.H=A.o),z&&(A.i=z.D.concat(A.i)),z=ia(A,se,1e3),se.I=Math.round(.5*A.wa)+Math.round(.5*A.wa*Math.random()),Cf(A.h,se),qd(se,ge,z)}function Ju(A,z){A.H&&de(A.H,function(se,ge){Zr(z,ge,se)}),A.l&&Zl({},function(se,ge){Zr(z,ge,se)})}function ia(A,z,se){se=Math.min(A.i.length,se);var ge=A.l?O(A.l.Na,A.l,A):null;e:{var qe=A.i;let at=-1;for(;;){const Vt=["count="+se];at==-1?0<se?(at=qe[0].g,Vt.push("ofs="+at)):at=0:Vt.push("ofs="+at);let ei=!0;for(let yi=0;yi<se;yi++){let Ir=qe[yi].g;const Qs=qe[yi].map;if(Ir-=at,0>Ir)at=Math.max(0,qe[yi].g-100),ei=!1;else try{Af(Qs,Vt,"req"+Ir+"_")}catch{ge&&ge(Qs)}}if(ei){ge=Vt.join("&");break e}}}return A=A.i.splice(0,se),z.D=A,ge}function su(A){if(!A.g&&!A.u){A.Y=1;var z=A.Fa;ve||ke(),_e||(ve(),_e=!0),Ee.add(z,A),A.v=0}}function um(A){return A.g||A.u||3<=A.v?!1:(A.Y++,A.u=hn(O(A.Fa,A),Qu(A,A.v)),A.v++,!0)}n.Fa=function(){if(this.u=null,lE(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var A=2*this.R;this.j.info("BP detection timer enabled: "+A),this.A=hn(O(this.ab,this),A)}},n.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,Mi(10),bl(this),lE(this))};function Yg(A){A.A!=null&&(_.clearTimeout(A.A),A.A=null)}function lE(A){A.g=new zi(A,A.j,"rpc",A.Y),A.m===null&&(A.g.H=A.o),A.g.O=0;var z=Xo(A.qa);Zr(z,"RID","rpc"),Zr(z,"SID",A.K),Zr(z,"AID",A.T),Zr(z,"CI",A.F?"0":"1"),!A.F&&A.ja&&Zr(z,"TO",A.ja),Zr(z,"TYPE","xmlhttp"),Ju(A,z),A.m&&A.o&&Ce(z,A.m,A.o),A.L&&(A.g.I=A.L);var se=A.g;A=A.ia,se.L=1,se.v=lc(Xo(z)),se.m=null,se.P=!0,$u(se,A)}n.Za=function(){this.C!=null&&(this.C=null,bl(this),um(this),Mi(19))};function dm(A){A.C!=null&&(_.clearTimeout(A.C),A.C=null)}function hm(A,z){var se=null;if(A.g==z){dm(A),Yg(A),A.g=null;var ge=2}else if(fo(A.h,z))se=z.D,yl(A.h,z),ge=1;else return;if(A.G!=0){if(z.o)if(ge==1){se=z.m?z.m.length:0,z=Date.now()-z.F;var qe=A.B;ge=ml(),tn(ge,new _t(ge,se)),Nc(A)}else su(A);else if(qe=z.s,qe==3||qe==0&&0<z.X||!(ge==1&&qg(A,z)||ge==2&&um(A)))switch(se&&0<se.length&&(z=A.h,z.i=z.i.concat(se)),qe){case 1:Zu(A,5);break;case 4:Zu(A,10);break;case 3:Zu(A,6);break;default:Zu(A,2)}}}function Qu(A,z){let se=A.Ta+Math.floor(Math.random()*A.cb);return A.isActive()||(se*=2),se*z}function Zu(A,z){if(A.j.info("Error code "+z),z==2){var se=O(A.fb,A),ge=A.Xa;const qe=!ge;ge=new cc(ge||"//www.google.com/images/cleardot.gif"),_.location&&_.location.protocol=="http"||qu(ge,"https"),lc(ge),qe?am(ge.toString(),se):kc(ge.toString(),se)}else Mi(2);A.G=0,A.l&&A.l.sa(z),ed(A),eh(A)}n.fb=function(A){A?(this.j.info("Successfully pinged google.com"),Mi(2)):(this.j.info("Failed to ping google.com"),Mi(1))};function ed(A){if(A.G=0,A.ka=[],A.l){const z=Jd(A.h);(z.length!=0||A.i.length!=0)&&(W(A.ka,z),W(A.ka,A.i),A.h.i.length=0,B(A.i),A.i.length=0),A.l.ra()}}function Xg(A,z,se){var ge=se instanceof cc?Xo(se):new cc(se);if(ge.g!="")z&&(ge.g=z+"."+ge.g),El(ge,ge.s);else{var qe=_.location;ge=qe.protocol,z=z?z+"."+qe.hostname:qe.hostname,qe=+qe.port;var at=new cc(null);ge&&qu(at,ge),z&&(at.g=z),qe&&El(at,qe),se&&(at.l=se),ge=at}return se=A.D,z=A.ya,se&&z&&Zr(ge,se,z),Zr(ge,"VER",A.la),Ju(A,ge),ge}function uE(A,z,se){if(z&&!A.J)throw Error("Can't create secondary domain capable XhrIo object.");return z=A.Ca&&!A.pa?new De(new vl({eb:se})):new De(A.pa),z.Ha(A.J),z}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function zn(){}n=zn.prototype,n.ua=function(){},n.ta=function(){},n.sa=function(){},n.ra=function(){},n.isActive=function(){return!0},n.Na=function(){};function fm(){}fm.prototype.g=function(A,z){return new sa(A,z)};function sa(A,z){vn.call(this),this.g=new Xu(z),this.l=A,this.h=z&&z.messageUrlParams||null,A=z&&z.messageHeaders||null,z&&z.clientProtocolHeaderRequired&&(A?A["X-Client-Protocol"]="webchannel":A={"X-Client-Protocol":"webchannel"}),this.g.o=A,A=z&&z.initMessageHeaders||null,z&&z.messageContentType&&(A?A["X-WebChannel-Content-Type"]=z.messageContentType:A={"X-WebChannel-Content-Type":z.messageContentType}),z&&z.va&&(A?A["X-WebChannel-Client-Profile"]=z.va:A={"X-WebChannel-Client-Profile":z.va}),this.g.S=A,(A=z&&z.Sb)&&!$(A)&&(this.g.m=A),this.v=z&&z.supportsCrossDomainXhr||!1,this.u=z&&z.sendRawJson||!1,(z=z&&z.httpSessionIdParam)&&!$(z)&&(this.g.D=z,A=this.h,A!==null&&z in A&&(A=this.h,z in A&&delete A[z])),this.j=new Dc(this)}U(sa,vn),sa.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},sa.prototype.close=function(){os(this.g)},sa.prototype.o=function(A){var z=this.g;if(typeof A=="string"){var se={};se.__data__=A,A=se}else this.u&&(se={},se.__data__=ci(A),A=se);z.i.push(new Xd(z.Ya++,A)),z.G==3&&Nc(z)},sa.prototype.N=function(){this.g.l=null,delete this.j,os(this.g),delete this.g,sa.aa.N.call(this)};function dE(A){Ia.call(this),A.__headers__&&(this.headers=A.__headers__,this.statusCode=A.__status__,delete A.__headers__,delete A.__status__);var z=A.__sm__;if(z){e:{for(const se in z){A=se;break e}A=void 0}(this.i=A)&&(A=this.i,z=z!==null&&A in z?z[A]:void 0),this.data=z}else this.data=A}U(dE,Ia);function hE(){Po.call(this),this.status=1}U(hE,Po);function Dc(A){this.g=A}U(Dc,zn),Dc.prototype.ua=function(){tn(this.g,"a")},Dc.prototype.ta=function(A){tn(this.g,new dE(A))},Dc.prototype.sa=function(A){tn(this.g,new hE)},Dc.prototype.ra=function(){tn(this.g,"b")},fm.prototype.createWebChannel=fm.prototype.g,sa.prototype.send=sa.prototype.o,sa.prototype.open=sa.prototype.m,sa.prototype.close=sa.prototype.close,zie=function(){return new fm},Wie=function(){return ml()},Bie=Aa,eF={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},gl.NO_ERROR=0,gl.TIMEOUT=8,gl.HTTP_ERROR=6,Ik=gl,Jl.COMPLETE="complete",jie=Jl,Ac.EventType=vs,vs.OPEN="a",vs.CLOSE="b",vs.ERROR="c",vs.MESSAGE="d",vn.prototype.listen=vn.prototype.K,Zw=Ac,De.prototype.listenOnce=De.prototype.L,De.prototype.getLastError=De.prototype.Ka,De.prototype.getLastErrorCode=De.prototype.Ba,De.prototype.getStatus=De.prototype.Z,De.prototype.getResponseJson=De.prototype.Oa,De.prototype.getResponseText=De.prototype.oa,De.prototype.send=De.prototype.ea,De.prototype.setWithCredentials=De.prototype.Ha,Fie=De}).apply(typeof FO<"u"?FO:typeof self<"u"?self:typeof window<"u"?window:{});const lJ="@firebase/firestore",uJ="4.7.10";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ja{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}Ja.UNAUTHENTICATED=new Ja(null),Ja.GOOGLE_CREDENTIALS=new Ja("google-credentials-uid"),Ja.FIRST_PARTY=new Ja("first-party-uid"),Ja.MOCK_USER=new Ja("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Q0="11.5.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Jy=new p4("@firebase/firestore");function xS(){return Jy.logLevel}function rn(n,...e){if(Jy.logLevel<=Or.DEBUG){const i=e.map(C4);Jy.debug(`Firestore (${Q0}): ${n}`,...i)}}function Xp(n,...e){if(Jy.logLevel<=Or.ERROR){const i=e.map(C4);Jy.error(`Firestore (${Q0}): ${n}`,...i)}}function O0(n,...e){if(Jy.logLevel<=Or.WARN){const i=e.map(C4);Jy.warn(`Firestore (${Q0}): ${n}`,...i)}}function C4(n){if(typeof n=="string")return n;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return function(i){return JSON.stringify(i)}(n)}catch{return n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Kn(n="Unexpected state"){const e=`FIRESTORE (${Q0}) INTERNAL ASSERTION FAILED: `+n;throw Xp(e),new Error(e)}function gi(n,e){n||Kn()}function tr(n,e){return n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bt={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class $t extends Ef{constructor(e,i){super(e,i),this.code=e,this.message=i,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jp{constructor(){this.promise=new Promise((e,i)=>{this.resolve=e,this.reject=i})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gie{constructor(e,i){this.user=i,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class E4e{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,i){e.enqueueRetryable(()=>i(Ja.UNAUTHENTICATED))}shutdown(){}}class v4e{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,i){this.changeListener=i,e.enqueueRetryable(()=>i(this.token.user))}shutdown(){this.changeListener=null}}class S4e{constructor(e){this.t=e,this.currentUser=Ja.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,i){gi(this.o===void 0);let o=this.i;const l=E=>this.i!==o?(o=this.i,i(E)):Promise.resolve();let d=new jp;this.o=()=>{this.i++,this.currentUser=this.u(),d.resolve(),d=new jp,e.enqueueRetryable(()=>l(this.currentUser))};const p=()=>{const E=d;e.enqueueRetryable(async()=>{await E.promise,await l(this.currentUser)})},_=E=>{rn("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=E,this.o&&(this.auth.addAuthTokenListener(this.o),p())};this.t.onInit(E=>_(E)),setTimeout(()=>{if(!this.auth){const E=this.t.getImmediate({optional:!0});E?_(E):(rn("FirebaseAuthCredentialsProvider","Auth not yet detected"),d.resolve(),d=new jp)}},0),p()}getToken(){const e=this.i,i=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(i).then(o=>this.i!==e?(rn("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):o?(gi(typeof o.accessToken=="string"),new Gie(o.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return gi(e===null||typeof e=="string"),new Ja(e)}}class b4e{constructor(e,i,o){this.l=e,this.h=i,this.P=o,this.type="FirstParty",this.user=Ja.FIRST_PARTY,this.T=new Map}I(){return this.P?this.P():null}get headers(){this.T.set("X-Goog-AuthUser",this.l);const e=this.I();return e&&this.T.set("Authorization",e),this.h&&this.T.set("X-Goog-Iam-Authorization-Token",this.h),this.T}}class T4e{constructor(e,i,o){this.l=e,this.h=i,this.P=o}getToken(){return Promise.resolve(new b4e(this.l,this.h,this.P))}start(e,i){e.enqueueRetryable(()=>i(Ja.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class dJ{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class w4e{constructor(e,i){this.A=i,this.forceRefresh=!1,this.appCheck=null,this.R=null,this.V=null,Vl(e)&&e.settings.appCheckToken&&(this.V=e.settings.appCheckToken)}start(e,i){gi(this.o===void 0);const o=d=>{d.error!=null&&rn("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${d.error.message}`);const p=d.token!==this.R;return this.R=d.token,rn("FirebaseAppCheckTokenProvider",`Received ${p?"new":"existing"} token.`),p?i(d.token):Promise.resolve()};this.o=d=>{e.enqueueRetryable(()=>o(d))};const l=d=>{rn("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=d,this.o&&this.appCheck.addTokenListener(this.o)};this.A.onInit(d=>l(d)),setTimeout(()=>{if(!this.appCheck){const d=this.A.getImmediate({optional:!0});d?l(d):rn("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.V)return Promise.resolve(new dJ(this.V));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(i=>i?(gi(typeof i.token=="string"),this.R=i.token,new dJ(i.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function C4e(n){const e=typeof self<"u"&&(self.crypto||self.msCrypto),i=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(i);else for(let o=0;o<n;o++)i[o]=Math.floor(256*Math.random());return i}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Hie(){return new TextEncoder}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $ie{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",i=62*Math.floor(4.129032258064516);let o="";for(;o.length<20;){const l=C4e(40);for(let d=0;d<l.length;++d)o.length<20&&l[d]<i&&(o+=e.charAt(l[d]%62))}return o}}function _r(n,e){return n<e?-1:n>e?1:0}function tF(n,e){let i=0;for(;i<n.length&&i<e.length;){const o=n.codePointAt(i),l=e.codePointAt(i);if(o!==l){if(o<128&&l<128)return _r(o,l);{const d=Hie(),p=R4e(d.encode(hJ(n,i)),d.encode(hJ(e,i)));return p!==0?p:_r(o,l)}}i+=o>65535?2:1}return _r(n.length,e.length)}function hJ(n,e){return n.codePointAt(e)>65535?n.substring(e,e+2):n.substring(e,e+1)}function R4e(n,e){for(let i=0;i<n.length&&i<e.length;++i)if(n[i]!==e[i])return _r(n[i],e[i]);return _r(n.length,e.length)}function k0(n,e,i){return n.length===e.length&&n.every((o,l)=>i(o,e[l]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fJ=-62135596800,pJ=1e6;class wo{static now(){return wo.fromMillis(Date.now())}static fromDate(e){return wo.fromMillis(e.getTime())}static fromMillis(e){const i=Math.floor(e/1e3),o=Math.floor((e-1e3*i)*pJ);return new wo(i,o)}constructor(e,i){if(this.seconds=e,this.nanoseconds=i,i<0)throw new $t(bt.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+i);if(i>=1e9)throw new $t(bt.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+i);if(e<fJ)throw new $t(bt.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new $t(bt.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/pJ}_compareTo(e){return this.seconds===e.seconds?_r(this.nanoseconds,e.nanoseconds):_r(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds-fJ;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jn{static fromTimestamp(e){return new Jn(e)}static min(){return new Jn(new wo(0,0))}static max(){return new Jn(new wo(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mJ="__name__";class Wh{constructor(e,i,o){i===void 0?i=0:i>e.length&&Kn(),o===void 0?o=e.length-i:o>e.length-i&&Kn(),this.segments=e,this.offset=i,this.len=o}get length(){return this.len}isEqual(e){return Wh.comparator(this,e)===0}child(e){const i=this.segments.slice(this.offset,this.limit());return e instanceof Wh?e.forEach(o=>{i.push(o)}):i.push(e),this.construct(i)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let i=0;i<this.length;i++)if(this.get(i)!==e.get(i))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let i=0;i<this.length;i++)if(this.get(i)!==e.get(i))return!1;return!0}forEach(e){for(let i=this.offset,o=this.limit();i<o;i++)e(this.segments[i])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,i){const o=Math.min(e.length,i.length);for(let l=0;l<o;l++){const d=Wh.compareSegments(e.get(l),i.get(l));if(d!==0)return d}return _r(e.length,i.length)}static compareSegments(e,i){const o=Wh.isNumericId(e),l=Wh.isNumericId(i);return o&&!l?-1:!o&&l?1:o&&l?Wh.extractNumericId(e).compare(Wh.extractNumericId(i)):tF(e,i)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return Pg.fromString(e.substring(4,e.length-2))}}class Ki extends Wh{construct(e,i,o){return new Ki(e,i,o)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const i=[];for(const o of e){if(o.indexOf("//")>=0)throw new $t(bt.INVALID_ARGUMENT,`Invalid segment (${o}). Paths must not contain // in them.`);i.push(...o.split("/").filter(l=>l.length>0))}return new Ki(i)}static emptyPath(){return new Ki([])}}const I4e=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class wa extends Wh{construct(e,i,o){return new wa(e,i,o)}static isValidIdentifier(e){return I4e.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),wa.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===mJ}static keyField(){return new wa([mJ])}static fromServerFormat(e){const i=[];let o="",l=0;const d=()=>{if(o.length===0)throw new $t(bt.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);i.push(o),o=""};let p=!1;for(;l<e.length;){const _=e[l];if(_==="\\"){if(l+1===e.length)throw new $t(bt.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const E=e[l+1];if(E!=="\\"&&E!=="."&&E!=="`")throw new $t(bt.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);o+=E,l+=2}else _==="`"?(p=!p,l++):_!=="."||p?(o+=_,l++):(d(),l++)}if(d(),p)throw new $t(bt.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new wa(i)}static emptyPath(){return new wa([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cn{constructor(e){this.path=e}static fromPath(e){return new Cn(Ki.fromString(e))}static fromName(e){return new Cn(Ki.fromString(e).popFirst(5))}static empty(){return new Cn(Ki.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&Ki.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,i){return Ki.comparator(e.path,i.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new Cn(new Ki(e.slice()))}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const KC=-1;function A4e(n,e){const i=n.toTimestamp().seconds,o=n.toTimestamp().nanoseconds+1,l=Jn.fromTimestamp(o===1e9?new wo(i+1,0):new wo(i,o));return new Lg(l,Cn.empty(),e)}function P4e(n){return new Lg(n.readTime,n.key,KC)}class Lg{constructor(e,i,o){this.readTime=e,this.documentKey=i,this.largestBatchId=o}static min(){return new Lg(Jn.min(),Cn.empty(),KC)}static max(){return new Lg(Jn.max(),Cn.empty(),KC)}}function O4e(n,e){let i=n.readTime.compareTo(e.readTime);return i!==0?i:(i=Cn.comparator(n.documentKey,e.documentKey),i!==0?i:_r(n.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const k4e="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class N4e{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Z0(n){if(n.code!==bt.FAILED_PRECONDITION||n.message!==k4e)throw n;rn("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rt{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(i=>{this.isDone=!0,this.result=i,this.nextCallback&&this.nextCallback(i)},i=>{this.isDone=!0,this.error=i,this.catchCallback&&this.catchCallback(i)})}catch(e){return this.next(void 0,e)}next(e,i){return this.callbackAttached&&Kn(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(i,this.error):this.wrapSuccess(e,this.result):new Rt((o,l)=>{this.nextCallback=d=>{this.wrapSuccess(e,d).next(o,l)},this.catchCallback=d=>{this.wrapFailure(i,d).next(o,l)}})}toPromise(){return new Promise((e,i)=>{this.next(e,i)})}wrapUserFunction(e){try{const i=e();return i instanceof Rt?i:Rt.resolve(i)}catch(i){return Rt.reject(i)}}wrapSuccess(e,i){return e?this.wrapUserFunction(()=>e(i)):Rt.resolve(i)}wrapFailure(e,i){return e?this.wrapUserFunction(()=>e(i)):Rt.reject(i)}static resolve(e){return new Rt((i,o)=>{i(e)})}static reject(e){return new Rt((i,o)=>{o(e)})}static waitFor(e){return new Rt((i,o)=>{let l=0,d=0,p=!1;e.forEach(_=>{++l,_.next(()=>{++d,p&&d===l&&i()},E=>o(E))}),p=!0,d===l&&i()})}static or(e){let i=Rt.resolve(!1);for(const o of e)i=i.next(l=>l?Rt.resolve(l):o());return i}static forEach(e,i){const o=[];return e.forEach((l,d)=>{o.push(i.call(this,l,d))}),this.waitFor(o)}static mapArray(e,i){return new Rt((o,l)=>{const d=e.length,p=new Array(d);let _=0;for(let E=0;E<d;E++){const b=E;i(e[b]).next(C=>{p[b]=C,++_,_===d&&o(p)},C=>l(C))}})}static doWhile(e,i){return new Rt((o,l)=>{const d=()=>{e()===!0?i().next(()=>{d()},l):o()};d()})}}function D4e(n){const e=n.match(/Android ([\d.]+)/i),i=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(i)}function eb(n){return n.name==="IndexedDbTransactionError"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uN{constructor(e,i){this.previousValue=e,i&&(i.sequenceNumberHandler=o=>this.oe(o),this._e=o=>i.writeSequenceNumber(o))}oe(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this._e&&this._e(e),e}}uN.ae=-1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const R4=-1;function dN(n){return n==null}function c1(n){return n===0&&1/n==-1/0}function x4e(n){return typeof n=="number"&&Number.isInteger(n)&&!c1(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Kie="";function L4e(n){let e="";for(let i=0;i<n.length;i++)e.length>0&&(e=gJ(e)),e=M4e(n.get(i),e);return gJ(e)}function M4e(n,e){let i=e;const o=n.length;for(let l=0;l<o;l++){const d=n.charAt(l);switch(d){case"\0":i+="";break;case Kie:i+="";break;default:i+=d}}return i}function gJ(n){return n+Kie+""}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _J(n){let e=0;for(const i in n)Object.prototype.hasOwnProperty.call(n,i)&&e++;return e}function $g(n,e){for(const i in n)Object.prototype.hasOwnProperty.call(n,i)&&e(i,n[i])}function qie(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ys{constructor(e,i){this.comparator=e,this.root=i||ba.EMPTY}insert(e,i){return new ys(this.comparator,this.root.insert(e,i,this.comparator).copy(null,null,ba.BLACK,null,null))}remove(e){return new ys(this.comparator,this.root.remove(e,this.comparator).copy(null,null,ba.BLACK,null,null))}get(e){let i=this.root;for(;!i.isEmpty();){const o=this.comparator(e,i.key);if(o===0)return i.value;o<0?i=i.left:o>0&&(i=i.right)}return null}indexOf(e){let i=0,o=this.root;for(;!o.isEmpty();){const l=this.comparator(e,o.key);if(l===0)return i+o.left.size;l<0?o=o.left:(i+=o.left.size+1,o=o.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((i,o)=>(e(i,o),!1))}toString(){const e=[];return this.inorderTraversal((i,o)=>(e.push(`${i}:${o}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new jO(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new jO(this.root,e,this.comparator,!1)}getReverseIterator(){return new jO(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new jO(this.root,e,this.comparator,!0)}}class jO{constructor(e,i,o,l){this.isReverse=l,this.nodeStack=[];let d=1;for(;!e.isEmpty();)if(d=i?o(e.key,i):1,i&&l&&(d*=-1),d<0)e=this.isReverse?e.left:e.right;else{if(d===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const i={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return i}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class ba{constructor(e,i,o,l,d){this.key=e,this.value=i,this.color=o??ba.RED,this.left=l??ba.EMPTY,this.right=d??ba.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,i,o,l,d){return new ba(e??this.key,i??this.value,o??this.color,l??this.left,d??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,i,o){let l=this;const d=o(e,l.key);return l=d<0?l.copy(null,null,null,l.left.insert(e,i,o),null):d===0?l.copy(null,i,null,null,null):l.copy(null,null,null,null,l.right.insert(e,i,o)),l.fixUp()}removeMin(){if(this.left.isEmpty())return ba.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,i){let o,l=this;if(i(e,l.key)<0)l.left.isEmpty()||l.left.isRed()||l.left.left.isRed()||(l=l.moveRedLeft()),l=l.copy(null,null,null,l.left.remove(e,i),null);else{if(l.left.isRed()&&(l=l.rotateRight()),l.right.isEmpty()||l.right.isRed()||l.right.left.isRed()||(l=l.moveRedRight()),i(e,l.key)===0){if(l.right.isEmpty())return ba.EMPTY;o=l.right.min(),l=l.copy(o.key,o.value,null,null,l.right.removeMin())}l=l.copy(null,null,null,null,l.right.remove(e,i))}return l.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,ba.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,ba.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),i=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,i)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw Kn();const e=this.left.check();if(e!==this.right.check())throw Kn();return e+(this.isRed()?0:1)}}ba.EMPTY=null,ba.RED=!0,ba.BLACK=!1;ba.EMPTY=new class{constructor(){this.size=0}get key(){throw Kn()}get value(){throw Kn()}get color(){throw Kn()}get left(){throw Kn()}get right(){throw Kn()}copy(e,i,o,l,d){return this}insert(e,i,o){return new ba(e,i)}remove(e,i){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Co{constructor(e){this.comparator=e,this.data=new ys(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((i,o)=>(e(i),!1))}forEachInRange(e,i){const o=this.data.getIteratorFrom(e[0]);for(;o.hasNext();){const l=o.getNext();if(this.comparator(l.key,e[1])>=0)return;i(l.key)}}forEachWhile(e,i){let o;for(o=i!==void 0?this.data.getIteratorFrom(i):this.data.getIterator();o.hasNext();)if(!e(o.getNext().key))return}firstAfterOrEqual(e){const i=this.data.getIteratorFrom(e);return i.hasNext()?i.getNext().key:null}getIterator(){return new yJ(this.data.getIterator())}getIteratorFrom(e){return new yJ(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let i=this;return i.size<e.size&&(i=e,e=this),e.forEach(o=>{i=i.add(o)}),i}isEqual(e){if(!(e instanceof Co)||this.size!==e.size)return!1;const i=this.data.getIterator(),o=e.data.getIterator();for(;i.hasNext();){const l=i.getNext().key,d=o.getNext().key;if(this.comparator(l,d)!==0)return!1}return!0}toArray(){const e=[];return this.forEach(i=>{e.push(i)}),e}toString(){const e=[];return this.forEach(i=>e.push(i)),"SortedSet("+e.toString()+")"}copy(e){const i=new Co(this.comparator);return i.data=e,i}}class yJ{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jl{constructor(e){this.fields=e,e.sort(wa.comparator)}static empty(){return new jl([])}unionWith(e){let i=new Co(wa.comparator);for(const o of this.fields)i=i.add(o);for(const o of e)i=i.add(o);return new jl(i.toArray())}covers(e){for(const i of this.fields)if(i.isPrefixOf(e))return!0;return!1}isEqual(e){return k0(this.fields,e.fields,(i,o)=>i.isEqual(o))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yie extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ca{constructor(e){this.binaryString=e}static fromBase64String(e){const i=function(l){try{return atob(l)}catch(d){throw typeof DOMException<"u"&&d instanceof DOMException?new Yie("Invalid base64 string: "+d):d}}(e);return new Ca(i)}static fromUint8Array(e){const i=function(l){let d="";for(let p=0;p<l.length;++p)d+=String.fromCharCode(l[p]);return d}(e);return new Ca(i)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(i){return btoa(i)}(this.binaryString)}toUint8Array(){return function(i){const o=new Uint8Array(i.length);for(let l=0;l<i.length;l++)o[l]=i.charCodeAt(l);return o}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return _r(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Ca.EMPTY_BYTE_STRING=new Ca("");const U4e=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Mg(n){if(gi(!!n),typeof n=="string"){let e=0;const i=U4e.exec(n);if(gi(!!i),i[1]){let l=i[1];l=(l+"000000000").substr(0,9),e=Number(l)}const o=new Date(n);return{seconds:Math.floor(o.getTime()/1e3),nanos:e}}return{seconds:Hs(n.seconds),nanos:Hs(n.nanos)}}function Hs(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function Ug(n){return typeof n=="string"?Ca.fromBase64String(n):Ca.fromUint8Array(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Xie="server_timestamp",Jie="__type__",Qie="__previous_value__",Zie="__local_write_time__";function hN(n){var e,i;return((i=(((e=n==null?void 0:n.mapValue)===null||e===void 0?void 0:e.fields)||{})[Jie])===null||i===void 0?void 0:i.stringValue)===Xie}function fN(n){const e=n.mapValue.fields[Qie];return hN(e)?fN(e):e}function qC(n){const e=Mg(n.mapValue.fields[Zie].timestampValue);return new wo(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class V4e{constructor(e,i,o,l,d,p,_,E,b){this.databaseId=e,this.appId=i,this.persistenceKey=o,this.host=l,this.ssl=d,this.forceLongPolling=p,this.autoDetectLongPolling=_,this.longPollingOptions=E,this.useFetchStreams=b}}const l1="(default)";class YC{constructor(e,i){this.projectId=e,this.database=i||l1}static empty(){return new YC("","")}get isDefaultDatabase(){return this.database===l1}isEqual(e){return e instanceof YC&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ese="__type__",F4e="__max__",BO={mapValue:{}},tse="__vector__",u1="value";function Vg(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?hN(n)?4:B4e(n)?9007199254740991:j4e(n)?10:11:Kn()}function gf(n,e){if(n===e)return!0;const i=Vg(n);if(i!==Vg(e))return!1;switch(i){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return qC(n).isEqual(qC(e));case 3:return function(l,d){if(typeof l.timestampValue=="string"&&typeof d.timestampValue=="string"&&l.timestampValue.length===d.timestampValue.length)return l.timestampValue===d.timestampValue;const p=Mg(l.timestampValue),_=Mg(d.timestampValue);return p.seconds===_.seconds&&p.nanos===_.nanos}(n,e);case 5:return n.stringValue===e.stringValue;case 6:return function(l,d){return Ug(l.bytesValue).isEqual(Ug(d.bytesValue))}(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return function(l,d){return Hs(l.geoPointValue.latitude)===Hs(d.geoPointValue.latitude)&&Hs(l.geoPointValue.longitude)===Hs(d.geoPointValue.longitude)}(n,e);case 2:return function(l,d){if("integerValue"in l&&"integerValue"in d)return Hs(l.integerValue)===Hs(d.integerValue);if("doubleValue"in l&&"doubleValue"in d){const p=Hs(l.doubleValue),_=Hs(d.doubleValue);return p===_?c1(p)===c1(_):isNaN(p)&&isNaN(_)}return!1}(n,e);case 9:return k0(n.arrayValue.values||[],e.arrayValue.values||[],gf);case 10:case 11:return function(l,d){const p=l.mapValue.fields||{},_=d.mapValue.fields||{};if(_J(p)!==_J(_))return!1;for(const E in p)if(p.hasOwnProperty(E)&&(_[E]===void 0||!gf(p[E],_[E])))return!1;return!0}(n,e);default:return Kn()}}function XC(n,e){return(n.values||[]).find(i=>gf(i,e))!==void 0}function N0(n,e){if(n===e)return 0;const i=Vg(n),o=Vg(e);if(i!==o)return _r(i,o);switch(i){case 0:case 9007199254740991:return 0;case 1:return _r(n.booleanValue,e.booleanValue);case 2:return function(d,p){const _=Hs(d.integerValue||d.doubleValue),E=Hs(p.integerValue||p.doubleValue);return _<E?-1:_>E?1:_===E?0:isNaN(_)?isNaN(E)?0:-1:1}(n,e);case 3:return EJ(n.timestampValue,e.timestampValue);case 4:return EJ(qC(n),qC(e));case 5:return tF(n.stringValue,e.stringValue);case 6:return function(d,p){const _=Ug(d),E=Ug(p);return _.compareTo(E)}(n.bytesValue,e.bytesValue);case 7:return function(d,p){const _=d.split("/"),E=p.split("/");for(let b=0;b<_.length&&b<E.length;b++){const C=_r(_[b],E[b]);if(C!==0)return C}return _r(_.length,E.length)}(n.referenceValue,e.referenceValue);case 8:return function(d,p){const _=_r(Hs(d.latitude),Hs(p.latitude));return _!==0?_:_r(Hs(d.longitude),Hs(p.longitude))}(n.geoPointValue,e.geoPointValue);case 9:return vJ(n.arrayValue,e.arrayValue);case 10:return function(d,p){var _,E,b,C;const I=d.fields||{},O=p.fields||{},L=(_=I[u1])===null||_===void 0?void 0:_.arrayValue,U=(E=O[u1])===null||E===void 0?void 0:E.arrayValue,B=_r(((b=L==null?void 0:L.values)===null||b===void 0?void 0:b.length)||0,((C=U==null?void 0:U.values)===null||C===void 0?void 0:C.length)||0);return B!==0?B:vJ(L,U)}(n.mapValue,e.mapValue);case 11:return function(d,p){if(d===BO.mapValue&&p===BO.mapValue)return 0;if(d===BO.mapValue)return 1;if(p===BO.mapValue)return-1;const _=d.fields||{},E=Object.keys(_),b=p.fields||{},C=Object.keys(b);E.sort(),C.sort();for(let I=0;I<E.length&&I<C.length;++I){const O=tF(E[I],C[I]);if(O!==0)return O;const L=N0(_[E[I]],b[C[I]]);if(L!==0)return L}return _r(E.length,C.length)}(n.mapValue,e.mapValue);default:throw Kn()}}function EJ(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return _r(n,e);const i=Mg(n),o=Mg(e),l=_r(i.seconds,o.seconds);return l!==0?l:_r(i.nanos,o.nanos)}function vJ(n,e){const i=n.values||[],o=e.values||[];for(let l=0;l<i.length&&l<o.length;++l){const d=N0(i[l],o[l]);if(d)return d}return _r(i.length,o.length)}function D0(n){return nF(n)}function nF(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(i){const o=Mg(i);return`time(${o.seconds},${o.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?function(i){return Ug(i).toBase64()}(n.bytesValue):"referenceValue"in n?function(i){return Cn.fromName(i).toString()}(n.referenceValue):"geoPointValue"in n?function(i){return`geo(${i.latitude},${i.longitude})`}(n.geoPointValue):"arrayValue"in n?function(i){let o="[",l=!0;for(const d of i.values||[])l?l=!1:o+=",",o+=nF(d);return o+"]"}(n.arrayValue):"mapValue"in n?function(i){const o=Object.keys(i.fields||{}).sort();let l="{",d=!0;for(const p of o)d?d=!1:l+=",",l+=`${p}:${nF(i.fields[p])}`;return l+"}"}(n.mapValue):Kn()}function Ak(n){switch(Vg(n)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=fN(n);return e?16+Ak(e):16;case 5:return 2*n.stringValue.length;case 6:return Ug(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 9:return function(o){return(o.values||[]).reduce((l,d)=>l+Ak(d),0)}(n.arrayValue);case 10:case 11:return function(o){let l=0;return $g(o.fields,(d,p)=>{l+=d.length+Ak(p)}),l}(n.mapValue);default:throw Kn()}}function d1(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function rF(n){return!!n&&"integerValue"in n}function I4(n){return!!n&&"arrayValue"in n}function SJ(n){return!!n&&"nullValue"in n}function bJ(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function Pk(n){return!!n&&"mapValue"in n}function j4e(n){var e,i;return((i=(((e=n==null?void 0:n.mapValue)===null||e===void 0?void 0:e.fields)||{})[ese])===null||i===void 0?void 0:i.stringValue)===tse}function yC(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){const e={mapValue:{fields:{}}};return $g(n.mapValue.fields,(i,o)=>e.mapValue.fields[i]=yC(o)),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let i=0;i<(n.arrayValue.values||[]).length;++i)e.arrayValue.values[i]=yC(n.arrayValue.values[i]);return e}return Object.assign({},n)}function B4e(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue===F4e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ll{constructor(e){this.value=e}static empty(){return new ll({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let i=this.value;for(let o=0;o<e.length-1;++o)if(i=(i.mapValue.fields||{})[e.get(o)],!Pk(i))return null;return i=(i.mapValue.fields||{})[e.lastSegment()],i||null}}set(e,i){this.getFieldsMap(e.popLast())[e.lastSegment()]=yC(i)}setAll(e){let i=wa.emptyPath(),o={},l=[];e.forEach((p,_)=>{if(!i.isImmediateParentOf(_)){const E=this.getFieldsMap(i);this.applyChanges(E,o,l),o={},l=[],i=_.popLast()}p?o[_.lastSegment()]=yC(p):l.push(_.lastSegment())});const d=this.getFieldsMap(i);this.applyChanges(d,o,l)}delete(e){const i=this.field(e.popLast());Pk(i)&&i.mapValue.fields&&delete i.mapValue.fields[e.lastSegment()]}isEqual(e){return gf(this.value,e.value)}getFieldsMap(e){let i=this.value;i.mapValue.fields||(i.mapValue={fields:{}});for(let o=0;o<e.length;++o){let l=i.mapValue.fields[e.get(o)];Pk(l)&&l.mapValue.fields||(l={mapValue:{fields:{}}},i.mapValue.fields[e.get(o)]=l),i=l}return i.mapValue.fields}applyChanges(e,i,o){$g(i,(l,d)=>e[l]=d);for(const l of o)delete e[l]}clone(){return new ll(yC(this.value))}}function nse(n){const e=[];return $g(n.fields,(i,o)=>{const l=new wa([i]);if(Pk(o)){const d=nse(o.mapValue).fields;if(d.length===0)e.push(l);else for(const p of d)e.push(l.child(p))}else e.push(l)}),new jl(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qa{constructor(e,i,o,l,d,p,_){this.key=e,this.documentType=i,this.version=o,this.readTime=l,this.createTime=d,this.data=p,this.documentState=_}static newInvalidDocument(e){return new Qa(e,0,Jn.min(),Jn.min(),Jn.min(),ll.empty(),0)}static newFoundDocument(e,i,o,l){return new Qa(e,1,i,Jn.min(),o,l,0)}static newNoDocument(e,i){return new Qa(e,2,i,Jn.min(),Jn.min(),ll.empty(),0)}static newUnknownDocument(e,i){return new Qa(e,3,i,Jn.min(),Jn.min(),ll.empty(),2)}convertToFoundDocument(e,i){return!this.createTime.isEqual(Jn.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=i,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=ll.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=ll.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=Jn.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof Qa&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new Qa(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class x0{constructor(e,i){this.position=e,this.inclusive=i}}function TJ(n,e,i){let o=0;for(let l=0;l<n.position.length;l++){const d=e[l],p=n.position[l];if(d.field.isKeyField()?o=Cn.comparator(Cn.fromName(p.referenceValue),i.key):o=N0(p,i.data.field(d.field)),d.dir==="desc"&&(o*=-1),o!==0)break}return o}function wJ(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let i=0;i<n.position.length;i++)if(!gf(n.position[i],e.position[i]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class JC{constructor(e,i="asc"){this.field=e,this.dir=i}}function W4e(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rse{}class so extends rse{constructor(e,i,o){super(),this.field=e,this.op=i,this.value=o}static create(e,i,o){return e.isKeyField()?i==="in"||i==="not-in"?this.createKeyFieldInFilter(e,i,o):new G4e(e,i,o):i==="array-contains"?new K4e(e,o):i==="in"?new q4e(e,o):i==="not-in"?new Y4e(e,o):i==="array-contains-any"?new X4e(e,o):new so(e,i,o)}static createKeyFieldInFilter(e,i,o){return i==="in"?new H4e(e,o):new $4e(e,o)}matches(e){const i=e.data.field(this.field);return this.op==="!="?i!==null&&this.matchesComparison(N0(i,this.value)):i!==null&&Vg(this.value)===Vg(i)&&this.matchesComparison(N0(i,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return Kn()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class Wd extends rse{constructor(e,i){super(),this.filters=e,this.op=i,this.ce=null}static create(e,i){return new Wd(e,i)}matches(e){return ise(this)?this.filters.find(i=>!i.matches(e))===void 0:this.filters.find(i=>i.matches(e))!==void 0}getFlattenedFilters(){return this.ce!==null||(this.ce=this.filters.reduce((e,i)=>e.concat(i.getFlattenedFilters()),[])),this.ce}getFilters(){return Object.assign([],this.filters)}}function ise(n){return n.op==="and"}function sse(n){return z4e(n)&&ise(n)}function z4e(n){for(const e of n.filters)if(e instanceof Wd)return!1;return!0}function iF(n){if(n instanceof so)return n.field.canonicalString()+n.op.toString()+D0(n.value);if(sse(n))return n.filters.map(e=>iF(e)).join(",");{const e=n.filters.map(i=>iF(i)).join(",");return`${n.op}(${e})`}}function ose(n,e){return n instanceof so?function(o,l){return l instanceof so&&o.op===l.op&&o.field.isEqual(l.field)&&gf(o.value,l.value)}(n,e):n instanceof Wd?function(o,l){return l instanceof Wd&&o.op===l.op&&o.filters.length===l.filters.length?o.filters.reduce((d,p,_)=>d&&ose(p,l.filters[_]),!0):!1}(n,e):void Kn()}function ase(n){return n instanceof so?function(i){return`${i.field.canonicalString()} ${i.op} ${D0(i.value)}`}(n):n instanceof Wd?function(i){return i.op.toString()+" {"+i.getFilters().map(ase).join(" ,")+"}"}(n):"Filter"}class G4e extends so{constructor(e,i,o){super(e,i,o),this.key=Cn.fromName(o.referenceValue)}matches(e){const i=Cn.comparator(e.key,this.key);return this.matchesComparison(i)}}class H4e extends so{constructor(e,i){super(e,"in",i),this.keys=cse("in",i)}matches(e){return this.keys.some(i=>i.isEqual(e.key))}}class $4e extends so{constructor(e,i){super(e,"not-in",i),this.keys=cse("not-in",i)}matches(e){return!this.keys.some(i=>i.isEqual(e.key))}}function cse(n,e){var i;return(((i=e.arrayValue)===null||i===void 0?void 0:i.values)||[]).map(o=>Cn.fromName(o.referenceValue))}class K4e extends so{constructor(e,i){super(e,"array-contains",i)}matches(e){const i=e.data.field(this.field);return I4(i)&&XC(i.arrayValue,this.value)}}class q4e extends so{constructor(e,i){super(e,"in",i)}matches(e){const i=e.data.field(this.field);return i!==null&&XC(this.value.arrayValue,i)}}class Y4e extends so{constructor(e,i){super(e,"not-in",i)}matches(e){if(XC(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const i=e.data.field(this.field);return i!==null&&!XC(this.value.arrayValue,i)}}class X4e extends so{constructor(e,i){super(e,"array-contains-any",i)}matches(e){const i=e.data.field(this.field);return!(!I4(i)||!i.arrayValue.values)&&i.arrayValue.values.some(o=>XC(this.value.arrayValue,o))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class J4e{constructor(e,i=null,o=[],l=[],d=null,p=null,_=null){this.path=e,this.collectionGroup=i,this.orderBy=o,this.filters=l,this.limit=d,this.startAt=p,this.endAt=_,this.le=null}}function CJ(n,e=null,i=[],o=[],l=null,d=null,p=null){return new J4e(n,e,i,o,l,d,p)}function A4(n){const e=tr(n);if(e.le===null){let i=e.path.canonicalString();e.collectionGroup!==null&&(i+="|cg:"+e.collectionGroup),i+="|f:",i+=e.filters.map(o=>iF(o)).join(","),i+="|ob:",i+=e.orderBy.map(o=>function(d){return d.field.canonicalString()+d.dir}(o)).join(","),dN(e.limit)||(i+="|l:",i+=e.limit),e.startAt&&(i+="|lb:",i+=e.startAt.inclusive?"b:":"a:",i+=e.startAt.position.map(o=>D0(o)).join(",")),e.endAt&&(i+="|ub:",i+=e.endAt.inclusive?"a:":"b:",i+=e.endAt.position.map(o=>D0(o)).join(",")),e.le=i}return e.le}function P4(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let i=0;i<n.orderBy.length;i++)if(!W4e(n.orderBy[i],e.orderBy[i]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let i=0;i<n.filters.length;i++)if(!ose(n.filters[i],e.filters[i]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!wJ(n.startAt,e.startAt)&&wJ(n.endAt,e.endAt)}function sF(n){return Cn.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sE{constructor(e,i=null,o=[],l=[],d=null,p="F",_=null,E=null){this.path=e,this.collectionGroup=i,this.explicitOrderBy=o,this.filters=l,this.limit=d,this.limitType=p,this.startAt=_,this.endAt=E,this.he=null,this.Pe=null,this.Te=null,this.startAt,this.endAt}}function Q4e(n,e,i,o,l,d,p,_){return new sE(n,e,i,o,l,d,p,_)}function pN(n){return new sE(n)}function RJ(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function O4(n){return n.collectionGroup!==null}function f0(n){const e=tr(n);if(e.he===null){e.he=[];const i=new Set;for(const d of e.explicitOrderBy)e.he.push(d),i.add(d.field.canonicalString());const o=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(p){let _=new Co(wa.comparator);return p.filters.forEach(E=>{E.getFlattenedFilters().forEach(b=>{b.isInequality()&&(_=_.add(b.field))})}),_})(e).forEach(d=>{i.has(d.canonicalString())||d.isKeyField()||e.he.push(new JC(d,o))}),i.has(wa.keyField().canonicalString())||e.he.push(new JC(wa.keyField(),o))}return e.he}function hf(n){const e=tr(n);return e.Pe||(e.Pe=Z4e(e,f0(n))),e.Pe}function Z4e(n,e){if(n.limitType==="F")return CJ(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map(l=>{const d=l.dir==="desc"?"asc":"desc";return new JC(l.field,d)});const i=n.endAt?new x0(n.endAt.position,n.endAt.inclusive):null,o=n.startAt?new x0(n.startAt.position,n.startAt.inclusive):null;return CJ(n.path,n.collectionGroup,e,n.filters,n.limit,i,o)}}function oF(n,e){const i=n.filters.concat([e]);return new sE(n.path,n.collectionGroup,n.explicitOrderBy.slice(),i,n.limit,n.limitType,n.startAt,n.endAt)}function h1(n,e,i){return new sE(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,i,n.startAt,n.endAt)}function mN(n,e){return P4(hf(n),hf(e))&&n.limitType===e.limitType}function lse(n){return`${A4(hf(n))}|lt:${n.limitType}`}function LS(n){return`Query(target=${function(i){let o=i.path.canonicalString();return i.collectionGroup!==null&&(o+=" collectionGroup="+i.collectionGroup),i.filters.length>0&&(o+=`, filters: [${i.filters.map(l=>ase(l)).join(", ")}]`),dN(i.limit)||(o+=", limit: "+i.limit),i.orderBy.length>0&&(o+=`, orderBy: [${i.orderBy.map(l=>function(p){return`${p.field.canonicalString()} (${p.dir})`}(l)).join(", ")}]`),i.startAt&&(o+=", startAt: ",o+=i.startAt.inclusive?"b:":"a:",o+=i.startAt.position.map(l=>D0(l)).join(",")),i.endAt&&(o+=", endAt: ",o+=i.endAt.inclusive?"a:":"b:",o+=i.endAt.position.map(l=>D0(l)).join(",")),`Target(${o})`}(hf(n))}; limitType=${n.limitType})`}function gN(n,e){return e.isFoundDocument()&&function(o,l){const d=l.key.path;return o.collectionGroup!==null?l.key.hasCollectionId(o.collectionGroup)&&o.path.isPrefixOf(d):Cn.isDocumentKey(o.path)?o.path.isEqual(d):o.path.isImmediateParentOf(d)}(n,e)&&function(o,l){for(const d of f0(o))if(!d.field.isKeyField()&&l.data.field(d.field)===null)return!1;return!0}(n,e)&&function(o,l){for(const d of o.filters)if(!d.matches(l))return!1;return!0}(n,e)&&function(o,l){return!(o.startAt&&!function(p,_,E){const b=TJ(p,_,E);return p.inclusive?b<=0:b<0}(o.startAt,f0(o),l)||o.endAt&&!function(p,_,E){const b=TJ(p,_,E);return p.inclusive?b>=0:b>0}(o.endAt,f0(o),l))}(n,e)}function e3e(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function use(n){return(e,i)=>{let o=!1;for(const l of f0(n)){const d=t3e(l,e,i);if(d!==0)return d;o=o||l.field.isKeyField()}return 0}}function t3e(n,e,i){const o=n.field.isKeyField()?Cn.comparator(e.key,i.key):function(d,p,_){const E=p.data.field(d),b=_.data.field(d);return E!==null&&b!==null?N0(E,b):Kn()}(n.field,e,i);switch(n.dir){case"asc":return o;case"desc":return-1*o;default:return Kn()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oE{constructor(e,i){this.mapKeyFn=e,this.equalsFn=i,this.inner={},this.innerSize=0}get(e){const i=this.mapKeyFn(e),o=this.inner[i];if(o!==void 0){for(const[l,d]of o)if(this.equalsFn(l,e))return d}}has(e){return this.get(e)!==void 0}set(e,i){const o=this.mapKeyFn(e),l=this.inner[o];if(l===void 0)return this.inner[o]=[[e,i]],void this.innerSize++;for(let d=0;d<l.length;d++)if(this.equalsFn(l[d][0],e))return void(l[d]=[e,i]);l.push([e,i]),this.innerSize++}delete(e){const i=this.mapKeyFn(e),o=this.inner[i];if(o===void 0)return!1;for(let l=0;l<o.length;l++)if(this.equalsFn(o[l][0],e))return o.length===1?delete this.inner[i]:o.splice(l,1),this.innerSize--,!0;return!1}forEach(e){$g(this.inner,(i,o)=>{for(const[l,d]of o)e(l,d)})}isEmpty(){return qie(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const n3e=new ys(Cn.comparator);function Jp(){return n3e}const dse=new ys(Cn.comparator);function eC(...n){let e=dse;for(const i of n)e=e.insert(i.key,i);return e}function hse(n){let e=dse;return n.forEach((i,o)=>e=e.insert(i,o.overlayedDocument)),e}function Iy(){return EC()}function fse(){return EC()}function EC(){return new oE(n=>n.toString(),(n,e)=>n.isEqual(e))}const r3e=new ys(Cn.comparator),i3e=new Co(Cn.comparator);function Nr(...n){let e=i3e;for(const i of n)e=e.add(i);return e}const s3e=new Co(_r);function o3e(){return s3e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function k4(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:c1(e)?"-0":e}}function pse(n){return{integerValue:""+n}}function a3e(n,e){return x4e(e)?pse(e):k4(n,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _N{constructor(){this._=void 0}}function c3e(n,e,i){return n instanceof f1?function(l,d){const p={fields:{[Jie]:{stringValue:Xie},[Zie]:{timestampValue:{seconds:l.seconds,nanos:l.nanoseconds}}}};return d&&hN(d)&&(d=fN(d)),d&&(p.fields[Qie]=d),{mapValue:p}}(i,e):n instanceof L0?gse(n,e):n instanceof M0?_se(n,e):function(l,d){const p=mse(l,d),_=IJ(p)+IJ(l.Ie);return rF(p)&&rF(l.Ie)?pse(_):k4(l.serializer,_)}(n,e)}function l3e(n,e,i){return n instanceof L0?gse(n,e):n instanceof M0?_se(n,e):i}function mse(n,e){return n instanceof p1?function(o){return rF(o)||function(d){return!!d&&"doubleValue"in d}(o)}(e)?e:{integerValue:0}:null}class f1 extends _N{}class L0 extends _N{constructor(e){super(),this.elements=e}}function gse(n,e){const i=yse(e);for(const o of n.elements)i.some(l=>gf(l,o))||i.push(o);return{arrayValue:{values:i}}}class M0 extends _N{constructor(e){super(),this.elements=e}}function _se(n,e){let i=yse(e);for(const o of n.elements)i=i.filter(l=>!gf(l,o));return{arrayValue:{values:i}}}class p1 extends _N{constructor(e,i){super(),this.serializer=e,this.Ie=i}}function IJ(n){return Hs(n.integerValue||n.doubleValue)}function yse(n){return I4(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ese{constructor(e,i){this.field=e,this.transform=i}}function u3e(n,e){return n.field.isEqual(e.field)&&function(o,l){return o instanceof L0&&l instanceof L0||o instanceof M0&&l instanceof M0?k0(o.elements,l.elements,gf):o instanceof p1&&l instanceof p1?gf(o.Ie,l.Ie):o instanceof f1&&l instanceof f1}(n.transform,e.transform)}class d3e{constructor(e,i){this.version=e,this.transformResults=i}}class Bu{constructor(e,i){this.updateTime=e,this.exists=i}static none(){return new Bu}static exists(e){return new Bu(void 0,e)}static updateTime(e){return new Bu(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Ok(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}class yN{}function vse(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new N4(n.key,Bu.none()):new wR(n.key,n.data,Bu.none());{const i=n.data,o=ll.empty();let l=new Co(wa.comparator);for(let d of e.fields)if(!l.has(d)){let p=i.field(d);p===null&&d.length>1&&(d=d.popLast(),p=i.field(d)),p===null?o.delete(d):o.set(d,p),l=l.add(d)}return new Kg(n.key,o,new jl(l.toArray()),Bu.none())}}function h3e(n,e,i){n instanceof wR?function(l,d,p){const _=l.value.clone(),E=PJ(l.fieldTransforms,d,p.transformResults);_.setAll(E),d.convertToFoundDocument(p.version,_).setHasCommittedMutations()}(n,e,i):n instanceof Kg?function(l,d,p){if(!Ok(l.precondition,d))return void d.convertToUnknownDocument(p.version);const _=PJ(l.fieldTransforms,d,p.transformResults),E=d.data;E.setAll(Sse(l)),E.setAll(_),d.convertToFoundDocument(p.version,E).setHasCommittedMutations()}(n,e,i):function(l,d,p){d.convertToNoDocument(p.version).setHasCommittedMutations()}(0,e,i)}function vC(n,e,i,o){return n instanceof wR?function(d,p,_,E){if(!Ok(d.precondition,p))return _;const b=d.value.clone(),C=OJ(d.fieldTransforms,E,p);return b.setAll(C),p.convertToFoundDocument(p.version,b).setHasLocalMutations(),null}(n,e,i,o):n instanceof Kg?function(d,p,_,E){if(!Ok(d.precondition,p))return _;const b=OJ(d.fieldTransforms,E,p),C=p.data;return C.setAll(Sse(d)),C.setAll(b),p.convertToFoundDocument(p.version,C).setHasLocalMutations(),_===null?null:_.unionWith(d.fieldMask.fields).unionWith(d.fieldTransforms.map(I=>I.field))}(n,e,i,o):function(d,p,_){return Ok(d.precondition,p)?(p.convertToNoDocument(p.version).setHasLocalMutations(),null):_}(n,e,i)}function f3e(n,e){let i=null;for(const o of n.fieldTransforms){const l=e.data.field(o.field),d=mse(o.transform,l||null);d!=null&&(i===null&&(i=ll.empty()),i.set(o.field,d))}return i||null}function AJ(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!function(o,l){return o===void 0&&l===void 0||!(!o||!l)&&k0(o,l,(d,p)=>u3e(d,p))}(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}class wR extends yN{constructor(e,i,o,l=[]){super(),this.key=e,this.value=i,this.precondition=o,this.fieldTransforms=l,this.type=0}getFieldMask(){return null}}class Kg extends yN{constructor(e,i,o,l,d=[]){super(),this.key=e,this.data=i,this.fieldMask=o,this.precondition=l,this.fieldTransforms=d,this.type=1}getFieldMask(){return this.fieldMask}}function Sse(n){const e=new Map;return n.fieldMask.fields.forEach(i=>{if(!i.isEmpty()){const o=n.data.field(i);e.set(i,o)}}),e}function PJ(n,e,i){const o=new Map;gi(n.length===i.length);for(let l=0;l<i.length;l++){const d=n[l],p=d.transform,_=e.data.field(d.field);o.set(d.field,l3e(p,_,i[l]))}return o}function OJ(n,e,i){const o=new Map;for(const l of n){const d=l.transform,p=i.data.field(l.field);o.set(l.field,c3e(d,p,e))}return o}class N4 extends yN{constructor(e,i){super(),this.key=e,this.precondition=i,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class p3e extends yN{constructor(e,i){super(),this.key=e,this.precondition=i,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class m3e{constructor(e,i,o,l){this.batchId=e,this.localWriteTime=i,this.baseMutations=o,this.mutations=l}applyToRemoteDocument(e,i){const o=i.mutationResults;for(let l=0;l<this.mutations.length;l++){const d=this.mutations[l];d.key.isEqual(e.key)&&h3e(d,e,o[l])}}applyToLocalView(e,i){for(const o of this.baseMutations)o.key.isEqual(e.key)&&(i=vC(o,e,i,this.localWriteTime));for(const o of this.mutations)o.key.isEqual(e.key)&&(i=vC(o,e,i,this.localWriteTime));return i}applyToLocalDocumentSet(e,i){const o=fse();return this.mutations.forEach(l=>{const d=e.get(l.key),p=d.overlayedDocument;let _=this.applyToLocalView(p,d.mutatedFields);_=i.has(l.key)?null:_;const E=vse(p,_);E!==null&&o.set(l.key,E),p.isValidDocument()||p.convertToNoDocument(Jn.min())}),o}keys(){return this.mutations.reduce((e,i)=>e.add(i.key),Nr())}isEqual(e){return this.batchId===e.batchId&&k0(this.mutations,e.mutations,(i,o)=>AJ(i,o))&&k0(this.baseMutations,e.baseMutations,(i,o)=>AJ(i,o))}}class D4{constructor(e,i,o,l){this.batch=e,this.commitVersion=i,this.mutationResults=o,this.docVersions=l}static from(e,i,o){gi(e.mutations.length===o.length);let l=function(){return r3e}();const d=e.mutations;for(let p=0;p<d.length;p++)l=l.insert(d[p].key,o[p].version);return new D4(e,i,o,l)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class g3e{constructor(e,i){this.largestBatchId=e,this.mutation=i}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _3e{constructor(e,i){this.count=e,this.unchangedNames=i}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var to,Br;function y3e(n){switch(n){case bt.OK:return Kn();case bt.CANCELLED:case bt.UNKNOWN:case bt.DEADLINE_EXCEEDED:case bt.RESOURCE_EXHAUSTED:case bt.INTERNAL:case bt.UNAVAILABLE:case bt.UNAUTHENTICATED:return!1;case bt.INVALID_ARGUMENT:case bt.NOT_FOUND:case bt.ALREADY_EXISTS:case bt.PERMISSION_DENIED:case bt.FAILED_PRECONDITION:case bt.ABORTED:case bt.OUT_OF_RANGE:case bt.UNIMPLEMENTED:case bt.DATA_LOSS:return!0;default:return Kn()}}function bse(n){if(n===void 0)return Xp("GRPC error has no .code"),bt.UNKNOWN;switch(n){case to.OK:return bt.OK;case to.CANCELLED:return bt.CANCELLED;case to.UNKNOWN:return bt.UNKNOWN;case to.DEADLINE_EXCEEDED:return bt.DEADLINE_EXCEEDED;case to.RESOURCE_EXHAUSTED:return bt.RESOURCE_EXHAUSTED;case to.INTERNAL:return bt.INTERNAL;case to.UNAVAILABLE:return bt.UNAVAILABLE;case to.UNAUTHENTICATED:return bt.UNAUTHENTICATED;case to.INVALID_ARGUMENT:return bt.INVALID_ARGUMENT;case to.NOT_FOUND:return bt.NOT_FOUND;case to.ALREADY_EXISTS:return bt.ALREADY_EXISTS;case to.PERMISSION_DENIED:return bt.PERMISSION_DENIED;case to.FAILED_PRECONDITION:return bt.FAILED_PRECONDITION;case to.ABORTED:return bt.ABORTED;case to.OUT_OF_RANGE:return bt.OUT_OF_RANGE;case to.UNIMPLEMENTED:return bt.UNIMPLEMENTED;case to.DATA_LOSS:return bt.DATA_LOSS;default:return Kn()}}(Br=to||(to={}))[Br.OK=0]="OK",Br[Br.CANCELLED=1]="CANCELLED",Br[Br.UNKNOWN=2]="UNKNOWN",Br[Br.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Br[Br.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Br[Br.NOT_FOUND=5]="NOT_FOUND",Br[Br.ALREADY_EXISTS=6]="ALREADY_EXISTS",Br[Br.PERMISSION_DENIED=7]="PERMISSION_DENIED",Br[Br.UNAUTHENTICATED=16]="UNAUTHENTICATED",Br[Br.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Br[Br.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Br[Br.ABORTED=10]="ABORTED",Br[Br.OUT_OF_RANGE=11]="OUT_OF_RANGE",Br[Br.UNIMPLEMENTED=12]="UNIMPLEMENTED",Br[Br.INTERNAL=13]="INTERNAL",Br[Br.UNAVAILABLE=14]="UNAVAILABLE",Br[Br.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const E3e=new Pg([4294967295,4294967295],0);function kJ(n){const e=Hie().encode(n),i=new Vie;return i.update(e),new Uint8Array(i.digest())}function NJ(n){const e=new DataView(n.buffer),i=e.getUint32(0,!0),o=e.getUint32(4,!0),l=e.getUint32(8,!0),d=e.getUint32(12,!0);return[new Pg([i,o],0),new Pg([l,d],0)]}class x4{constructor(e,i,o){if(this.bitmap=e,this.padding=i,this.hashCount=o,i<0||i>=8)throw new tC(`Invalid padding: ${i}`);if(o<0)throw new tC(`Invalid hash count: ${o}`);if(e.length>0&&this.hashCount===0)throw new tC(`Invalid hash count: ${o}`);if(e.length===0&&i!==0)throw new tC(`Invalid padding when bitmap length is 0: ${i}`);this.Ee=8*e.length-i,this.de=Pg.fromNumber(this.Ee)}Ae(e,i,o){let l=e.add(i.multiply(Pg.fromNumber(o)));return l.compare(E3e)===1&&(l=new Pg([l.getBits(0),l.getBits(1)],0)),l.modulo(this.de).toNumber()}Re(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.Ee===0)return!1;const i=kJ(e),[o,l]=NJ(i);for(let d=0;d<this.hashCount;d++){const p=this.Ae(o,l,d);if(!this.Re(p))return!1}return!0}static create(e,i,o){const l=e%8==0?0:8-e%8,d=new Uint8Array(Math.ceil(e/8)),p=new x4(d,l,i);return o.forEach(_=>p.insert(_)),p}insert(e){if(this.Ee===0)return;const i=kJ(e),[o,l]=NJ(i);for(let d=0;d<this.hashCount;d++){const p=this.Ae(o,l,d);this.Ve(p)}}Ve(e){const i=Math.floor(e/8),o=e%8;this.bitmap[i]|=1<<o}}class tC extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class EN{constructor(e,i,o,l,d){this.snapshotVersion=e,this.targetChanges=i,this.targetMismatches=o,this.documentUpdates=l,this.resolvedLimboDocuments=d}static createSynthesizedRemoteEventForCurrentChange(e,i,o){const l=new Map;return l.set(e,CR.createSynthesizedTargetChangeForCurrentChange(e,i,o)),new EN(Jn.min(),l,new ys(_r),Jp(),Nr())}}class CR{constructor(e,i,o,l,d){this.resumeToken=e,this.current=i,this.addedDocuments=o,this.modifiedDocuments=l,this.removedDocuments=d}static createSynthesizedTargetChangeForCurrentChange(e,i,o){return new CR(o,i,Nr(),Nr(),Nr())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kk{constructor(e,i,o,l){this.me=e,this.removedTargetIds=i,this.key=o,this.fe=l}}class Tse{constructor(e,i){this.targetId=e,this.ge=i}}class wse{constructor(e,i,o=Ca.EMPTY_BYTE_STRING,l=null){this.state=e,this.targetIds=i,this.resumeToken=o,this.cause=l}}class DJ{constructor(){this.pe=0,this.ye=xJ(),this.we=Ca.EMPTY_BYTE_STRING,this.Se=!1,this.be=!0}get current(){return this.Se}get resumeToken(){return this.we}get De(){return this.pe!==0}get ve(){return this.be}Ce(e){e.approximateByteSize()>0&&(this.be=!0,this.we=e)}Fe(){let e=Nr(),i=Nr(),o=Nr();return this.ye.forEach((l,d)=>{switch(d){case 0:e=e.add(l);break;case 2:i=i.add(l);break;case 1:o=o.add(l);break;default:Kn()}}),new CR(this.we,this.Se,e,i,o)}Me(){this.be=!1,this.ye=xJ()}xe(e,i){this.be=!0,this.ye=this.ye.insert(e,i)}Oe(e){this.be=!0,this.ye=this.ye.remove(e)}Ne(){this.pe+=1}Be(){this.pe-=1,gi(this.pe>=0)}Le(){this.be=!0,this.Se=!0}}class v3e{constructor(e){this.ke=e,this.qe=new Map,this.Qe=Jp(),this.$e=WO(),this.Ue=WO(),this.Ke=new ys(_r)}We(e){for(const i of e.me)e.fe&&e.fe.isFoundDocument()?this.Ge(i,e.fe):this.ze(i,e.key,e.fe);for(const i of e.removedTargetIds)this.ze(i,e.key,e.fe)}je(e){this.forEachTarget(e,i=>{const o=this.He(i);switch(e.state){case 0:this.Je(i)&&o.Ce(e.resumeToken);break;case 1:o.Be(),o.De||o.Me(),o.Ce(e.resumeToken);break;case 2:o.Be(),o.De||this.removeTarget(i);break;case 3:this.Je(i)&&(o.Le(),o.Ce(e.resumeToken));break;case 4:this.Je(i)&&(this.Ye(i),o.Ce(e.resumeToken));break;default:Kn()}})}forEachTarget(e,i){e.targetIds.length>0?e.targetIds.forEach(i):this.qe.forEach((o,l)=>{this.Je(l)&&i(l)})}Ze(e){const i=e.targetId,o=e.ge.count,l=this.Xe(i);if(l){const d=l.target;if(sF(d))if(o===0){const p=new Cn(d.path);this.ze(i,p,Qa.newNoDocument(p,Jn.min()))}else gi(o===1);else{const p=this.et(i);if(p!==o){const _=this.tt(e),E=_?this.nt(_,e,p):1;if(E!==0){this.Ye(i);const b=E===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ke=this.Ke.insert(i,b)}}}}}tt(e){const i=e.ge.unchangedNames;if(!i||!i.bits)return null;const{bits:{bitmap:o="",padding:l=0},hashCount:d=0}=i;let p,_;try{p=Ug(o).toUint8Array()}catch(E){if(E instanceof Yie)return O0("Decoding the base64 bloom filter in existence filter failed ("+E.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw E}try{_=new x4(p,l,d)}catch(E){return O0(E instanceof tC?"BloomFilter error: ":"Applying bloom filter failed: ",E),null}return _.Ee===0?null:_}nt(e,i,o){return i.ge.count===o-this.st(e,i.targetId)?0:2}st(e,i){const o=this.ke.getRemoteKeysForTarget(i);let l=0;return o.forEach(d=>{const p=this.ke.it(),_=`projects/${p.projectId}/databases/${p.database}/documents/${d.path.canonicalString()}`;e.mightContain(_)||(this.ze(i,d,null),l++)}),l}ot(e){const i=new Map;this.qe.forEach((d,p)=>{const _=this.Xe(p);if(_){if(d.current&&sF(_.target)){const E=new Cn(_.target.path);this._t(E).has(p)||this.ut(p,E)||this.ze(p,E,Qa.newNoDocument(E,e))}d.ve&&(i.set(p,d.Fe()),d.Me())}});let o=Nr();this.Ue.forEach((d,p)=>{let _=!0;p.forEachWhile(E=>{const b=this.Xe(E);return!b||b.purpose==="TargetPurposeLimboResolution"||(_=!1,!1)}),_&&(o=o.add(d))}),this.Qe.forEach((d,p)=>p.setReadTime(e));const l=new EN(e,i,this.Ke,this.Qe,o);return this.Qe=Jp(),this.$e=WO(),this.Ue=WO(),this.Ke=new ys(_r),l}Ge(e,i){if(!this.Je(e))return;const o=this.ut(e,i.key)?2:0;this.He(e).xe(i.key,o),this.Qe=this.Qe.insert(i.key,i),this.$e=this.$e.insert(i.key,this._t(i.key).add(e)),this.Ue=this.Ue.insert(i.key,this.ct(i.key).add(e))}ze(e,i,o){if(!this.Je(e))return;const l=this.He(e);this.ut(e,i)?l.xe(i,1):l.Oe(i),this.Ue=this.Ue.insert(i,this.ct(i).delete(e)),this.Ue=this.Ue.insert(i,this.ct(i).add(e)),o&&(this.Qe=this.Qe.insert(i,o))}removeTarget(e){this.qe.delete(e)}et(e){const i=this.He(e).Fe();return this.ke.getRemoteKeysForTarget(e).size+i.addedDocuments.size-i.removedDocuments.size}Ne(e){this.He(e).Ne()}He(e){let i=this.qe.get(e);return i||(i=new DJ,this.qe.set(e,i)),i}ct(e){let i=this.Ue.get(e);return i||(i=new Co(_r),this.Ue=this.Ue.insert(e,i)),i}_t(e){let i=this.$e.get(e);return i||(i=new Co(_r),this.$e=this.$e.insert(e,i)),i}Je(e){const i=this.Xe(e)!==null;return i||rn("WatchChangeAggregator","Detected inactive target",e),i}Xe(e){const i=this.qe.get(e);return i&&i.De?null:this.ke.lt(e)}Ye(e){this.qe.set(e,new DJ),this.ke.getRemoteKeysForTarget(e).forEach(i=>{this.ze(e,i,null)})}ut(e,i){return this.ke.getRemoteKeysForTarget(e).has(i)}}function WO(){return new ys(Cn.comparator)}function xJ(){return new ys(Cn.comparator)}const S3e={asc:"ASCENDING",desc:"DESCENDING"},b3e={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},T3e={and:"AND",or:"OR"};class w3e{constructor(e,i){this.databaseId=e,this.useProto3Json=i}}function aF(n,e){return n.useProto3Json||dN(e)?e:{value:e}}function m1(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function Cse(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function C3e(n,e){return m1(n,e.toTimestamp())}function ff(n){return gi(!!n),Jn.fromTimestamp(function(i){const o=Mg(i);return new wo(o.seconds,o.nanos)}(n))}function L4(n,e){return cF(n,e).canonicalString()}function cF(n,e){const i=function(l){return new Ki(["projects",l.projectId,"databases",l.database])}(n).child("documents");return e===void 0?i:i.child(e)}function Rse(n){const e=Ki.fromString(n);return gi(kse(e)),e}function lF(n,e){return L4(n.databaseId,e.path)}function OU(n,e){const i=Rse(e);if(i.get(1)!==n.databaseId.projectId)throw new $t(bt.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+i.get(1)+" vs "+n.databaseId.projectId);if(i.get(3)!==n.databaseId.database)throw new $t(bt.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+i.get(3)+" vs "+n.databaseId.database);return new Cn(Ase(i))}function Ise(n,e){return L4(n.databaseId,e)}function R3e(n){const e=Rse(n);return e.length===4?Ki.emptyPath():Ase(e)}function uF(n){return new Ki(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function Ase(n){return gi(n.length>4&&n.get(4)==="documents"),n.popFirst(5)}function LJ(n,e,i){return{name:lF(n,e),fields:i.value.mapValue.fields}}function I3e(n,e){let i;if("targetChange"in e){e.targetChange;const o=function(b){return b==="NO_CHANGE"?0:b==="ADD"?1:b==="REMOVE"?2:b==="CURRENT"?3:b==="RESET"?4:Kn()}(e.targetChange.targetChangeType||"NO_CHANGE"),l=e.targetChange.targetIds||[],d=function(b,C){return b.useProto3Json?(gi(C===void 0||typeof C=="string"),Ca.fromBase64String(C||"")):(gi(C===void 0||C instanceof Buffer||C instanceof Uint8Array),Ca.fromUint8Array(C||new Uint8Array))}(n,e.targetChange.resumeToken),p=e.targetChange.cause,_=p&&function(b){const C=b.code===void 0?bt.UNKNOWN:bse(b.code);return new $t(C,b.message||"")}(p);i=new wse(o,l,d,_||null)}else if("documentChange"in e){e.documentChange;const o=e.documentChange;o.document,o.document.name,o.document.updateTime;const l=OU(n,o.document.name),d=ff(o.document.updateTime),p=o.document.createTime?ff(o.document.createTime):Jn.min(),_=new ll({mapValue:{fields:o.document.fields}}),E=Qa.newFoundDocument(l,d,p,_),b=o.targetIds||[],C=o.removedTargetIds||[];i=new kk(b,C,E.key,E)}else if("documentDelete"in e){e.documentDelete;const o=e.documentDelete;o.document;const l=OU(n,o.document),d=o.readTime?ff(o.readTime):Jn.min(),p=Qa.newNoDocument(l,d),_=o.removedTargetIds||[];i=new kk([],_,p.key,p)}else if("documentRemove"in e){e.documentRemove;const o=e.documentRemove;o.document;const l=OU(n,o.document),d=o.removedTargetIds||[];i=new kk([],d,l,null)}else{if(!("filter"in e))return Kn();{e.filter;const o=e.filter;o.targetId;const{count:l=0,unchangedNames:d}=o,p=new _3e(l,d),_=o.targetId;i=new Tse(_,p)}}return i}function A3e(n,e){let i;if(e instanceof wR)i={update:LJ(n,e.key,e.value)};else if(e instanceof N4)i={delete:lF(n,e.key)};else if(e instanceof Kg)i={update:LJ(n,e.key,e.data),updateMask:U3e(e.fieldMask)};else{if(!(e instanceof p3e))return Kn();i={verify:lF(n,e.key)}}return e.fieldTransforms.length>0&&(i.updateTransforms=e.fieldTransforms.map(o=>function(d,p){const _=p.transform;if(_ instanceof f1)return{fieldPath:p.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(_ instanceof L0)return{fieldPath:p.field.canonicalString(),appendMissingElements:{values:_.elements}};if(_ instanceof M0)return{fieldPath:p.field.canonicalString(),removeAllFromArray:{values:_.elements}};if(_ instanceof p1)return{fieldPath:p.field.canonicalString(),increment:_.Ie};throw Kn()}(0,o))),e.precondition.isNone||(i.currentDocument=function(l,d){return d.updateTime!==void 0?{updateTime:C3e(l,d.updateTime)}:d.exists!==void 0?{exists:d.exists}:Kn()}(n,e.precondition)),i}function P3e(n,e){return n&&n.length>0?(gi(e!==void 0),n.map(i=>function(l,d){let p=l.updateTime?ff(l.updateTime):ff(d);return p.isEqual(Jn.min())&&(p=ff(d)),new d3e(p,l.transformResults||[])}(i,e))):[]}function O3e(n,e){return{documents:[Ise(n,e.path)]}}function k3e(n,e){const i={structuredQuery:{}},o=e.path;let l;e.collectionGroup!==null?(l=o,i.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(l=o.popLast(),i.structuredQuery.from=[{collectionId:o.lastSegment()}]),i.parent=Ise(n,l);const d=function(b){if(b.length!==0)return Ose(Wd.create(b,"and"))}(e.filters);d&&(i.structuredQuery.where=d);const p=function(b){if(b.length!==0)return b.map(C=>function(O){return{field:MS(O.field),direction:x3e(O.dir)}}(C))}(e.orderBy);p&&(i.structuredQuery.orderBy=p);const _=aF(n,e.limit);return _!==null&&(i.structuredQuery.limit=_),e.startAt&&(i.structuredQuery.startAt=function(b){return{before:b.inclusive,values:b.position}}(e.startAt)),e.endAt&&(i.structuredQuery.endAt=function(b){return{before:!b.inclusive,values:b.position}}(e.endAt)),{ht:i,parent:l}}function N3e(n){let e=R3e(n.parent);const i=n.structuredQuery,o=i.from?i.from.length:0;let l=null;if(o>0){gi(o===1);const C=i.from[0];C.allDescendants?l=C.collectionId:e=e.child(C.collectionId)}let d=[];i.where&&(d=function(I){const O=Pse(I);return O instanceof Wd&&sse(O)?O.getFilters():[O]}(i.where));let p=[];i.orderBy&&(p=function(I){return I.map(O=>function(U){return new JC(US(U.field),function(W){switch(W){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(U.direction))}(O))}(i.orderBy));let _=null;i.limit&&(_=function(I){let O;return O=typeof I=="object"?I.value:I,dN(O)?null:O}(i.limit));let E=null;i.startAt&&(E=function(I){const O=!!I.before,L=I.values||[];return new x0(L,O)}(i.startAt));let b=null;return i.endAt&&(b=function(I){const O=!I.before,L=I.values||[];return new x0(L,O)}(i.endAt)),Q4e(e,l,p,d,_,"F",E,b)}function D3e(n,e){const i=function(l){switch(l){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return Kn()}}(e.purpose);return i==null?null:{"goog-listen-tags":i}}function Pse(n){return n.unaryFilter!==void 0?function(i){switch(i.unaryFilter.op){case"IS_NAN":const o=US(i.unaryFilter.field);return so.create(o,"==",{doubleValue:NaN});case"IS_NULL":const l=US(i.unaryFilter.field);return so.create(l,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const d=US(i.unaryFilter.field);return so.create(d,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const p=US(i.unaryFilter.field);return so.create(p,"!=",{nullValue:"NULL_VALUE"});default:return Kn()}}(n):n.fieldFilter!==void 0?function(i){return so.create(US(i.fieldFilter.field),function(l){switch(l){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return Kn()}}(i.fieldFilter.op),i.fieldFilter.value)}(n):n.compositeFilter!==void 0?function(i){return Wd.create(i.compositeFilter.filters.map(o=>Pse(o)),function(l){switch(l){case"AND":return"and";case"OR":return"or";default:return Kn()}}(i.compositeFilter.op))}(n):Kn()}function x3e(n){return S3e[n]}function L3e(n){return b3e[n]}function M3e(n){return T3e[n]}function MS(n){return{fieldPath:n.canonicalString()}}function US(n){return wa.fromServerFormat(n.fieldPath)}function Ose(n){return n instanceof so?function(i){if(i.op==="=="){if(bJ(i.value))return{unaryFilter:{field:MS(i.field),op:"IS_NAN"}};if(SJ(i.value))return{unaryFilter:{field:MS(i.field),op:"IS_NULL"}}}else if(i.op==="!="){if(bJ(i.value))return{unaryFilter:{field:MS(i.field),op:"IS_NOT_NAN"}};if(SJ(i.value))return{unaryFilter:{field:MS(i.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:MS(i.field),op:L3e(i.op),value:i.value}}}(n):n instanceof Wd?function(i){const o=i.getFilters().map(l=>Ose(l));return o.length===1?o[0]:{compositeFilter:{op:M3e(i.op),filters:o}}}(n):Kn()}function U3e(n){const e=[];return n.fields.forEach(i=>e.push(i.canonicalString())),{fieldPaths:e}}function kse(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cg{constructor(e,i,o,l,d=Jn.min(),p=Jn.min(),_=Ca.EMPTY_BYTE_STRING,E=null){this.target=e,this.targetId=i,this.purpose=o,this.sequenceNumber=l,this.snapshotVersion=d,this.lastLimboFreeSnapshotVersion=p,this.resumeToken=_,this.expectedCount=E}withSequenceNumber(e){return new Cg(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,i){return new Cg(this.target,this.targetId,this.purpose,this.sequenceNumber,i,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new Cg(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new Cg(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class V3e{constructor(e){this.Tt=e}}function F3e(n){const e=N3e({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?h1(e,e.limit,"L"):e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class j3e{constructor(){this.Tn=new B3e}addToCollectionParentIndex(e,i){return this.Tn.add(i),Rt.resolve()}getCollectionParents(e,i){return Rt.resolve(this.Tn.getEntries(i))}addFieldIndex(e,i){return Rt.resolve()}deleteFieldIndex(e,i){return Rt.resolve()}deleteAllFieldIndexes(e){return Rt.resolve()}createTargetIndexes(e,i){return Rt.resolve()}getDocumentsMatchingTarget(e,i){return Rt.resolve(null)}getIndexType(e,i){return Rt.resolve(0)}getFieldIndexes(e,i){return Rt.resolve([])}getNextCollectionGroupToUpdate(e){return Rt.resolve(null)}getMinOffset(e,i){return Rt.resolve(Lg.min())}getMinOffsetFromCollectionGroup(e,i){return Rt.resolve(Lg.min())}updateCollectionGroup(e,i,o){return Rt.resolve()}updateIndexEntries(e,i){return Rt.resolve()}}class B3e{constructor(){this.index={}}add(e){const i=e.lastSegment(),o=e.popLast(),l=this.index[i]||new Co(Ki.comparator),d=!l.has(o);return this.index[i]=l.add(o),d}has(e){const i=e.lastSegment(),o=e.popLast(),l=this.index[i];return l&&l.has(o)}getEntries(e){return(this.index[e]||new Co(Ki.comparator)).toArray()}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const MJ={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},Nse=41943040;class al{static withCacheSize(e){return new al(e,al.DEFAULT_COLLECTION_PERCENTILE,al.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,i,o){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=i,this.maximumSequenceNumbersToCollect=o}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */al.DEFAULT_COLLECTION_PERCENTILE=10,al.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,al.DEFAULT=new al(Nse,al.DEFAULT_COLLECTION_PERCENTILE,al.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),al.DISABLED=new al(-1,0,0);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class U0{constructor(e){this.$n=e}next(){return this.$n+=2,this.$n}static Un(){return new U0(0)}static Kn(){return new U0(-1)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const UJ="LruGarbageCollector",W3e=1048576;function VJ([n,e],[i,o]){const l=_r(n,i);return l===0?_r(e,o):l}class z3e{constructor(e){this.Hn=e,this.buffer=new Co(VJ),this.Jn=0}Yn(){return++this.Jn}Zn(e){const i=[e,this.Yn()];if(this.buffer.size<this.Hn)this.buffer=this.buffer.add(i);else{const o=this.buffer.last();VJ(i,o)<0&&(this.buffer=this.buffer.delete(o).add(i))}}get maxValue(){return this.buffer.last()[0]}}class G3e{constructor(e,i,o){this.garbageCollector=e,this.asyncQueue=i,this.localStore=o,this.Xn=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.er(6e4)}stop(){this.Xn&&(this.Xn.cancel(),this.Xn=null)}get started(){return this.Xn!==null}er(e){rn(UJ,`Garbage collection scheduled in ${e}ms`),this.Xn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.Xn=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(i){eb(i)?rn(UJ,"Ignoring IndexedDB error during garbage collection: ",i):await Z0(i)}await this.er(3e5)})}}class H3e{constructor(e,i){this.tr=e,this.params=i}calculateTargetCount(e,i){return this.tr.nr(e).next(o=>Math.floor(i/100*o))}nthSequenceNumber(e,i){if(i===0)return Rt.resolve(uN.ae);const o=new z3e(i);return this.tr.forEachTarget(e,l=>o.Zn(l.sequenceNumber)).next(()=>this.tr.rr(e,l=>o.Zn(l))).next(()=>o.maxValue)}removeTargets(e,i,o){return this.tr.removeTargets(e,i,o)}removeOrphanedDocuments(e,i){return this.tr.removeOrphanedDocuments(e,i)}collect(e,i){return this.params.cacheSizeCollectionThreshold===-1?(rn("LruGarbageCollector","Garbage collection skipped; disabled"),Rt.resolve(MJ)):this.getCacheSize(e).next(o=>o<this.params.cacheSizeCollectionThreshold?(rn("LruGarbageCollector",`Garbage collection skipped; Cache size ${o} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),MJ):this.ir(e,i))}getCacheSize(e){return this.tr.getCacheSize(e)}ir(e,i){let o,l,d,p,_,E,b;const C=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(I=>(I>this.params.maximumSequenceNumbersToCollect?(rn("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${I}`),l=this.params.maximumSequenceNumbersToCollect):l=I,p=Date.now(),this.nthSequenceNumber(e,l))).next(I=>(o=I,_=Date.now(),this.removeTargets(e,o,i))).next(I=>(d=I,E=Date.now(),this.removeOrphanedDocuments(e,o))).next(I=>(b=Date.now(),xS()<=Or.DEBUG&&rn("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${p-C}ms
	Determined least recently used ${l} in `+(_-p)+`ms
	Removed ${d} targets in `+(E-_)+`ms
	Removed ${I} documents in `+(b-E)+`ms
Total Duration: ${b-C}ms`),Rt.resolve({didRun:!0,sequenceNumbersCollected:l,targetsRemoved:d,documentsRemoved:I})))}}function $3e(n,e){return new H3e(n,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class K3e{constructor(){this.changes=new oE(e=>e.toString(),(e,i)=>e.isEqual(i)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,i){this.assertNotApplied(),this.changes.set(e,Qa.newInvalidDocument(e).setReadTime(i))}getEntry(e,i){this.assertNotApplied();const o=this.changes.get(i);return o!==void 0?Rt.resolve(o):this.getFromCache(e,i)}getEntries(e,i){return this.getAllFromCache(e,i)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class q3e{constructor(e,i){this.overlayedDocument=e,this.mutatedFields=i}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Y3e{constructor(e,i,o,l){this.remoteDocumentCache=e,this.mutationQueue=i,this.documentOverlayCache=o,this.indexManager=l}getDocument(e,i){let o=null;return this.documentOverlayCache.getOverlay(e,i).next(l=>(o=l,this.remoteDocumentCache.getEntry(e,i))).next(l=>(o!==null&&vC(o.mutation,l,jl.empty(),wo.now()),l))}getDocuments(e,i){return this.remoteDocumentCache.getEntries(e,i).next(o=>this.getLocalViewOfDocuments(e,o,Nr()).next(()=>o))}getLocalViewOfDocuments(e,i,o=Nr()){const l=Iy();return this.populateOverlays(e,l,i).next(()=>this.computeViews(e,i,l,o).next(d=>{let p=eC();return d.forEach((_,E)=>{p=p.insert(_,E.overlayedDocument)}),p}))}getOverlayedDocuments(e,i){const o=Iy();return this.populateOverlays(e,o,i).next(()=>this.computeViews(e,i,o,Nr()))}populateOverlays(e,i,o){const l=[];return o.forEach(d=>{i.has(d)||l.push(d)}),this.documentOverlayCache.getOverlays(e,l).next(d=>{d.forEach((p,_)=>{i.set(p,_)})})}computeViews(e,i,o,l){let d=Jp();const p=EC(),_=function(){return EC()}();return i.forEach((E,b)=>{const C=o.get(b.key);l.has(b.key)&&(C===void 0||C.mutation instanceof Kg)?d=d.insert(b.key,b):C!==void 0?(p.set(b.key,C.mutation.getFieldMask()),vC(C.mutation,b,C.mutation.getFieldMask(),wo.now())):p.set(b.key,jl.empty())}),this.recalculateAndSaveOverlays(e,d).next(E=>(E.forEach((b,C)=>p.set(b,C)),i.forEach((b,C)=>{var I;return _.set(b,new q3e(C,(I=p.get(b))!==null&&I!==void 0?I:null))}),_))}recalculateAndSaveOverlays(e,i){const o=EC();let l=new ys((p,_)=>p-_),d=Nr();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,i).next(p=>{for(const _ of p)_.keys().forEach(E=>{const b=i.get(E);if(b===null)return;let C=o.get(E)||jl.empty();C=_.applyToLocalView(b,C),o.set(E,C);const I=(l.get(_.batchId)||Nr()).add(E);l=l.insert(_.batchId,I)})}).next(()=>{const p=[],_=l.getReverseIterator();for(;_.hasNext();){const E=_.getNext(),b=E.key,C=E.value,I=fse();C.forEach(O=>{if(!d.has(O)){const L=vse(i.get(O),o.get(O));L!==null&&I.set(O,L),d=d.add(O)}}),p.push(this.documentOverlayCache.saveOverlays(e,b,I))}return Rt.waitFor(p)}).next(()=>o)}recalculateAndSaveOverlaysForDocumentKeys(e,i){return this.remoteDocumentCache.getEntries(e,i).next(o=>this.recalculateAndSaveOverlays(e,o))}getDocumentsMatchingQuery(e,i,o,l){return function(p){return Cn.isDocumentKey(p.path)&&p.collectionGroup===null&&p.filters.length===0}(i)?this.getDocumentsMatchingDocumentQuery(e,i.path):O4(i)?this.getDocumentsMatchingCollectionGroupQuery(e,i,o,l):this.getDocumentsMatchingCollectionQuery(e,i,o,l)}getNextDocuments(e,i,o,l){return this.remoteDocumentCache.getAllFromCollectionGroup(e,i,o,l).next(d=>{const p=l-d.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,i,o.largestBatchId,l-d.size):Rt.resolve(Iy());let _=KC,E=d;return p.next(b=>Rt.forEach(b,(C,I)=>(_<I.largestBatchId&&(_=I.largestBatchId),d.get(C)?Rt.resolve():this.remoteDocumentCache.getEntry(e,C).next(O=>{E=E.insert(C,O)}))).next(()=>this.populateOverlays(e,b,d)).next(()=>this.computeViews(e,E,b,Nr())).next(C=>({batchId:_,changes:hse(C)})))})}getDocumentsMatchingDocumentQuery(e,i){return this.getDocument(e,new Cn(i)).next(o=>{let l=eC();return o.isFoundDocument()&&(l=l.insert(o.key,o)),l})}getDocumentsMatchingCollectionGroupQuery(e,i,o,l){const d=i.collectionGroup;let p=eC();return this.indexManager.getCollectionParents(e,d).next(_=>Rt.forEach(_,E=>{const b=function(I,O){return new sE(O,null,I.explicitOrderBy.slice(),I.filters.slice(),I.limit,I.limitType,I.startAt,I.endAt)}(i,E.child(d));return this.getDocumentsMatchingCollectionQuery(e,b,o,l).next(C=>{C.forEach((I,O)=>{p=p.insert(I,O)})})}).next(()=>p))}getDocumentsMatchingCollectionQuery(e,i,o,l){let d;return this.documentOverlayCache.getOverlaysForCollection(e,i.path,o.largestBatchId).next(p=>(d=p,this.remoteDocumentCache.getDocumentsMatchingQuery(e,i,o,d,l))).next(p=>{d.forEach((E,b)=>{const C=b.getKey();p.get(C)===null&&(p=p.insert(C,Qa.newInvalidDocument(C)))});let _=eC();return p.forEach((E,b)=>{const C=d.get(E);C!==void 0&&vC(C.mutation,b,jl.empty(),wo.now()),gN(i,b)&&(_=_.insert(E,b))}),_})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class X3e{constructor(e){this.serializer=e,this.dr=new Map,this.Ar=new Map}getBundleMetadata(e,i){return Rt.resolve(this.dr.get(i))}saveBundleMetadata(e,i){return this.dr.set(i.id,function(l){return{id:l.id,version:l.version,createTime:ff(l.createTime)}}(i)),Rt.resolve()}getNamedQuery(e,i){return Rt.resolve(this.Ar.get(i))}saveNamedQuery(e,i){return this.Ar.set(i.name,function(l){return{name:l.name,query:F3e(l.bundledQuery),readTime:ff(l.readTime)}}(i)),Rt.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class J3e{constructor(){this.overlays=new ys(Cn.comparator),this.Rr=new Map}getOverlay(e,i){return Rt.resolve(this.overlays.get(i))}getOverlays(e,i){const o=Iy();return Rt.forEach(i,l=>this.getOverlay(e,l).next(d=>{d!==null&&o.set(l,d)})).next(()=>o)}saveOverlays(e,i,o){return o.forEach((l,d)=>{this.Et(e,i,d)}),Rt.resolve()}removeOverlaysForBatchId(e,i,o){const l=this.Rr.get(o);return l!==void 0&&(l.forEach(d=>this.overlays=this.overlays.remove(d)),this.Rr.delete(o)),Rt.resolve()}getOverlaysForCollection(e,i,o){const l=Iy(),d=i.length+1,p=new Cn(i.child("")),_=this.overlays.getIteratorFrom(p);for(;_.hasNext();){const E=_.getNext().value,b=E.getKey();if(!i.isPrefixOf(b.path))break;b.path.length===d&&E.largestBatchId>o&&l.set(E.getKey(),E)}return Rt.resolve(l)}getOverlaysForCollectionGroup(e,i,o,l){let d=new ys((b,C)=>b-C);const p=this.overlays.getIterator();for(;p.hasNext();){const b=p.getNext().value;if(b.getKey().getCollectionGroup()===i&&b.largestBatchId>o){let C=d.get(b.largestBatchId);C===null&&(C=Iy(),d=d.insert(b.largestBatchId,C)),C.set(b.getKey(),b)}}const _=Iy(),E=d.getIterator();for(;E.hasNext()&&(E.getNext().value.forEach((b,C)=>_.set(b,C)),!(_.size()>=l)););return Rt.resolve(_)}Et(e,i,o){const l=this.overlays.get(o.key);if(l!==null){const p=this.Rr.get(l.largestBatchId).delete(o.key);this.Rr.set(l.largestBatchId,p)}this.overlays=this.overlays.insert(o.key,new g3e(i,o));let d=this.Rr.get(i);d===void 0&&(d=Nr(),this.Rr.set(i,d)),this.Rr.set(i,d.add(o.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Q3e{constructor(){this.sessionToken=Ca.EMPTY_BYTE_STRING}getSessionToken(e){return Rt.resolve(this.sessionToken)}setSessionToken(e,i){return this.sessionToken=i,Rt.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class M4{constructor(){this.Vr=new Co(Go.mr),this.gr=new Co(Go.pr)}isEmpty(){return this.Vr.isEmpty()}addReference(e,i){const o=new Go(e,i);this.Vr=this.Vr.add(o),this.gr=this.gr.add(o)}yr(e,i){e.forEach(o=>this.addReference(o,i))}removeReference(e,i){this.wr(new Go(e,i))}Sr(e,i){e.forEach(o=>this.removeReference(o,i))}br(e){const i=new Cn(new Ki([])),o=new Go(i,e),l=new Go(i,e+1),d=[];return this.gr.forEachInRange([o,l],p=>{this.wr(p),d.push(p.key)}),d}Dr(){this.Vr.forEach(e=>this.wr(e))}wr(e){this.Vr=this.Vr.delete(e),this.gr=this.gr.delete(e)}vr(e){const i=new Cn(new Ki([])),o=new Go(i,e),l=new Go(i,e+1);let d=Nr();return this.gr.forEachInRange([o,l],p=>{d=d.add(p.key)}),d}containsKey(e){const i=new Go(e,0),o=this.Vr.firstAfterOrEqual(i);return o!==null&&e.isEqual(o.key)}}class Go{constructor(e,i){this.key=e,this.Cr=i}static mr(e,i){return Cn.comparator(e.key,i.key)||_r(e.Cr,i.Cr)}static pr(e,i){return _r(e.Cr,i.Cr)||Cn.comparator(e.key,i.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Z3e{constructor(e,i){this.indexManager=e,this.referenceDelegate=i,this.mutationQueue=[],this.Fr=1,this.Mr=new Co(Go.mr)}checkEmpty(e){return Rt.resolve(this.mutationQueue.length===0)}addMutationBatch(e,i,o,l){const d=this.Fr;this.Fr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const p=new m3e(d,i,o,l);this.mutationQueue.push(p);for(const _ of l)this.Mr=this.Mr.add(new Go(_.key,d)),this.indexManager.addToCollectionParentIndex(e,_.key.path.popLast());return Rt.resolve(p)}lookupMutationBatch(e,i){return Rt.resolve(this.Or(i))}getNextMutationBatchAfterBatchId(e,i){const o=i+1,l=this.Nr(o),d=l<0?0:l;return Rt.resolve(this.mutationQueue.length>d?this.mutationQueue[d]:null)}getHighestUnacknowledgedBatchId(){return Rt.resolve(this.mutationQueue.length===0?R4:this.Fr-1)}getAllMutationBatches(e){return Rt.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,i){const o=new Go(i,0),l=new Go(i,Number.POSITIVE_INFINITY),d=[];return this.Mr.forEachInRange([o,l],p=>{const _=this.Or(p.Cr);d.push(_)}),Rt.resolve(d)}getAllMutationBatchesAffectingDocumentKeys(e,i){let o=new Co(_r);return i.forEach(l=>{const d=new Go(l,0),p=new Go(l,Number.POSITIVE_INFINITY);this.Mr.forEachInRange([d,p],_=>{o=o.add(_.Cr)})}),Rt.resolve(this.Br(o))}getAllMutationBatchesAffectingQuery(e,i){const o=i.path,l=o.length+1;let d=o;Cn.isDocumentKey(d)||(d=d.child(""));const p=new Go(new Cn(d),0);let _=new Co(_r);return this.Mr.forEachWhile(E=>{const b=E.key.path;return!!o.isPrefixOf(b)&&(b.length===l&&(_=_.add(E.Cr)),!0)},p),Rt.resolve(this.Br(_))}Br(e){const i=[];return e.forEach(o=>{const l=this.Or(o);l!==null&&i.push(l)}),i}removeMutationBatch(e,i){gi(this.Lr(i.batchId,"removed")===0),this.mutationQueue.shift();let o=this.Mr;return Rt.forEach(i.mutations,l=>{const d=new Go(l.key,i.batchId);return o=o.delete(d),this.referenceDelegate.markPotentiallyOrphaned(e,l.key)}).next(()=>{this.Mr=o})}qn(e){}containsKey(e,i){const o=new Go(i,0),l=this.Mr.firstAfterOrEqual(o);return Rt.resolve(i.isEqual(l&&l.key))}performConsistencyCheck(e){return this.mutationQueue.length,Rt.resolve()}Lr(e,i){return this.Nr(e)}Nr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Or(e){const i=this.Nr(e);return i<0||i>=this.mutationQueue.length?null:this.mutationQueue[i]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class e5e{constructor(e){this.kr=e,this.docs=function(){return new ys(Cn.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,i){const o=i.key,l=this.docs.get(o),d=l?l.size:0,p=this.kr(i);return this.docs=this.docs.insert(o,{document:i.mutableCopy(),size:p}),this.size+=p-d,this.indexManager.addToCollectionParentIndex(e,o.path.popLast())}removeEntry(e){const i=this.docs.get(e);i&&(this.docs=this.docs.remove(e),this.size-=i.size)}getEntry(e,i){const o=this.docs.get(i);return Rt.resolve(o?o.document.mutableCopy():Qa.newInvalidDocument(i))}getEntries(e,i){let o=Jp();return i.forEach(l=>{const d=this.docs.get(l);o=o.insert(l,d?d.document.mutableCopy():Qa.newInvalidDocument(l))}),Rt.resolve(o)}getDocumentsMatchingQuery(e,i,o,l){let d=Jp();const p=i.path,_=new Cn(p.child("__id-9223372036854775808__")),E=this.docs.getIteratorFrom(_);for(;E.hasNext();){const{key:b,value:{document:C}}=E.getNext();if(!p.isPrefixOf(b.path))break;b.path.length>p.length+1||O4e(P4e(C),o)<=0||(l.has(C.key)||gN(i,C))&&(d=d.insert(C.key,C.mutableCopy()))}return Rt.resolve(d)}getAllFromCollectionGroup(e,i,o,l){Kn()}qr(e,i){return Rt.forEach(this.docs,o=>i(o))}newChangeBuffer(e){return new t5e(this)}getSize(e){return Rt.resolve(this.size)}}class t5e extends K3e{constructor(e){super(),this.Ir=e}applyChanges(e){const i=[];return this.changes.forEach((o,l)=>{l.isValidDocument()?i.push(this.Ir.addEntry(e,l)):this.Ir.removeEntry(o)}),Rt.waitFor(i)}getFromCache(e,i){return this.Ir.getEntry(e,i)}getAllFromCache(e,i){return this.Ir.getEntries(e,i)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class n5e{constructor(e){this.persistence=e,this.Qr=new oE(i=>A4(i),P4),this.lastRemoteSnapshotVersion=Jn.min(),this.highestTargetId=0,this.$r=0,this.Ur=new M4,this.targetCount=0,this.Kr=U0.Un()}forEachTarget(e,i){return this.Qr.forEach((o,l)=>i(l)),Rt.resolve()}getLastRemoteSnapshotVersion(e){return Rt.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return Rt.resolve(this.$r)}allocateTargetId(e){return this.highestTargetId=this.Kr.next(),Rt.resolve(this.highestTargetId)}setTargetsMetadata(e,i,o){return o&&(this.lastRemoteSnapshotVersion=o),i>this.$r&&(this.$r=i),Rt.resolve()}zn(e){this.Qr.set(e.target,e);const i=e.targetId;i>this.highestTargetId&&(this.Kr=new U0(i),this.highestTargetId=i),e.sequenceNumber>this.$r&&(this.$r=e.sequenceNumber)}addTargetData(e,i){return this.zn(i),this.targetCount+=1,Rt.resolve()}updateTargetData(e,i){return this.zn(i),Rt.resolve()}removeTargetData(e,i){return this.Qr.delete(i.target),this.Ur.br(i.targetId),this.targetCount-=1,Rt.resolve()}removeTargets(e,i,o){let l=0;const d=[];return this.Qr.forEach((p,_)=>{_.sequenceNumber<=i&&o.get(_.targetId)===null&&(this.Qr.delete(p),d.push(this.removeMatchingKeysForTargetId(e,_.targetId)),l++)}),Rt.waitFor(d).next(()=>l)}getTargetCount(e){return Rt.resolve(this.targetCount)}getTargetData(e,i){const o=this.Qr.get(i)||null;return Rt.resolve(o)}addMatchingKeys(e,i,o){return this.Ur.yr(i,o),Rt.resolve()}removeMatchingKeys(e,i,o){this.Ur.Sr(i,o);const l=this.persistence.referenceDelegate,d=[];return l&&i.forEach(p=>{d.push(l.markPotentiallyOrphaned(e,p))}),Rt.waitFor(d)}removeMatchingKeysForTargetId(e,i){return this.Ur.br(i),Rt.resolve()}getMatchingKeysForTargetId(e,i){const o=this.Ur.vr(i);return Rt.resolve(o)}containsKey(e,i){return Rt.resolve(this.Ur.containsKey(i))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dse{constructor(e,i){this.Wr={},this.overlays={},this.Gr=new uN(0),this.zr=!1,this.zr=!0,this.jr=new Q3e,this.referenceDelegate=e(this),this.Hr=new n5e(this),this.indexManager=new j3e,this.remoteDocumentCache=function(l){return new e5e(l)}(o=>this.referenceDelegate.Jr(o)),this.serializer=new V3e(i),this.Yr=new X3e(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.zr=!1,Promise.resolve()}get started(){return this.zr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let i=this.overlays[e.toKey()];return i||(i=new J3e,this.overlays[e.toKey()]=i),i}getMutationQueue(e,i){let o=this.Wr[e.toKey()];return o||(o=new Z3e(i,this.referenceDelegate),this.Wr[e.toKey()]=o),o}getGlobalsCache(){return this.jr}getTargetCache(){return this.Hr}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Yr}runTransaction(e,i,o){rn("MemoryPersistence","Starting transaction:",e);const l=new r5e(this.Gr.next());return this.referenceDelegate.Zr(),o(l).next(d=>this.referenceDelegate.Xr(l).next(()=>d)).toPromise().then(d=>(l.raiseOnCommittedEvent(),d))}ei(e,i){return Rt.or(Object.values(this.Wr).map(o=>()=>o.containsKey(e,i)))}}class r5e extends N4e{constructor(e){super(),this.currentSequenceNumber=e}}class U4{constructor(e){this.persistence=e,this.ti=new M4,this.ni=null}static ri(e){return new U4(e)}get ii(){if(this.ni)return this.ni;throw Kn()}addReference(e,i,o){return this.ti.addReference(o,i),this.ii.delete(o.toString()),Rt.resolve()}removeReference(e,i,o){return this.ti.removeReference(o,i),this.ii.add(o.toString()),Rt.resolve()}markPotentiallyOrphaned(e,i){return this.ii.add(i.toString()),Rt.resolve()}removeTarget(e,i){this.ti.br(i.targetId).forEach(l=>this.ii.add(l.toString()));const o=this.persistence.getTargetCache();return o.getMatchingKeysForTargetId(e,i.targetId).next(l=>{l.forEach(d=>this.ii.add(d.toString()))}).next(()=>o.removeTargetData(e,i))}Zr(){this.ni=new Set}Xr(e){const i=this.persistence.getRemoteDocumentCache().newChangeBuffer();return Rt.forEach(this.ii,o=>{const l=Cn.fromPath(o);return this.si(e,l).next(d=>{d||i.removeEntry(l,Jn.min())})}).next(()=>(this.ni=null,i.apply(e)))}updateLimboDocument(e,i){return this.si(e,i).next(o=>{o?this.ii.delete(i.toString()):this.ii.add(i.toString())})}Jr(e){return 0}si(e,i){return Rt.or([()=>Rt.resolve(this.ti.containsKey(i)),()=>this.persistence.getTargetCache().containsKey(e,i),()=>this.persistence.ei(e,i)])}}class g1{constructor(e,i){this.persistence=e,this.oi=new oE(o=>L4e(o.path),(o,l)=>o.isEqual(l)),this.garbageCollector=$3e(this,i)}static ri(e,i){return new g1(e,i)}Zr(){}Xr(e){return Rt.resolve()}forEachTarget(e,i){return this.persistence.getTargetCache().forEachTarget(e,i)}nr(e){const i=this.sr(e);return this.persistence.getTargetCache().getTargetCount(e).next(o=>i.next(l=>o+l))}sr(e){let i=0;return this.rr(e,o=>{i++}).next(()=>i)}rr(e,i){return Rt.forEach(this.oi,(o,l)=>this.ar(e,o,l).next(d=>d?Rt.resolve():i(l)))}removeTargets(e,i,o){return this.persistence.getTargetCache().removeTargets(e,i,o)}removeOrphanedDocuments(e,i){let o=0;const l=this.persistence.getRemoteDocumentCache(),d=l.newChangeBuffer();return l.qr(e,p=>this.ar(e,p,i).next(_=>{_||(o++,d.removeEntry(p,Jn.min()))})).next(()=>d.apply(e)).next(()=>o)}markPotentiallyOrphaned(e,i){return this.oi.set(i,e.currentSequenceNumber),Rt.resolve()}removeTarget(e,i){const o=i.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,o)}addReference(e,i,o){return this.oi.set(o,e.currentSequenceNumber),Rt.resolve()}removeReference(e,i,o){return this.oi.set(o,e.currentSequenceNumber),Rt.resolve()}updateLimboDocument(e,i){return this.oi.set(i,e.currentSequenceNumber),Rt.resolve()}Jr(e){let i=e.key.toString().length;return e.isFoundDocument()&&(i+=Ak(e.data.value)),i}ar(e,i,o){return Rt.or([()=>this.persistence.ei(e,i),()=>this.persistence.getTargetCache().containsKey(e,i),()=>{const l=this.oi.get(i);return Rt.resolve(l!==void 0&&l>o)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class V4{constructor(e,i,o,l){this.targetId=e,this.fromCache=i,this.Hi=o,this.Ji=l}static Yi(e,i){let o=Nr(),l=Nr();for(const d of i.docChanges)switch(d.type){case 0:o=o.add(d.doc.key);break;case 1:l=l.add(d.doc.key)}return new V4(e,i.fromCache,o,l)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class i5e{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class s5e{constructor(){this.Zi=!1,this.Xi=!1,this.es=100,this.ts=function(){return FUe()?8:D4e(nc())>0?6:4}()}initialize(e,i){this.ns=e,this.indexManager=i,this.Zi=!0}getDocumentsMatchingQuery(e,i,o,l){const d={result:null};return this.rs(e,i).next(p=>{d.result=p}).next(()=>{if(!d.result)return this.ss(e,i,l,o).next(p=>{d.result=p})}).next(()=>{if(d.result)return;const p=new i5e;return this._s(e,i,p).next(_=>{if(d.result=_,this.Xi)return this.us(e,i,p,_.size)})}).next(()=>d.result)}us(e,i,o,l){return o.documentReadCount<this.es?(xS()<=Or.DEBUG&&rn("QueryEngine","SDK will not create cache indexes for query:",LS(i),"since it only creates cache indexes for collection contains","more than or equal to",this.es,"documents"),Rt.resolve()):(xS()<=Or.DEBUG&&rn("QueryEngine","Query:",LS(i),"scans",o.documentReadCount,"local documents and returns",l,"documents as results."),o.documentReadCount>this.ts*l?(xS()<=Or.DEBUG&&rn("QueryEngine","The SDK decides to create cache indexes for query:",LS(i),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,hf(i))):Rt.resolve())}rs(e,i){if(RJ(i))return Rt.resolve(null);let o=hf(i);return this.indexManager.getIndexType(e,o).next(l=>l===0?null:(i.limit!==null&&l===1&&(i=h1(i,null,"F"),o=hf(i)),this.indexManager.getDocumentsMatchingTarget(e,o).next(d=>{const p=Nr(...d);return this.ns.getDocuments(e,p).next(_=>this.indexManager.getMinOffset(e,o).next(E=>{const b=this.cs(i,_);return this.ls(i,b,p,E.readTime)?this.rs(e,h1(i,null,"F")):this.hs(e,b,i,E)}))})))}ss(e,i,o,l){return RJ(i)||l.isEqual(Jn.min())?Rt.resolve(null):this.ns.getDocuments(e,o).next(d=>{const p=this.cs(i,d);return this.ls(i,p,o,l)?Rt.resolve(null):(xS()<=Or.DEBUG&&rn("QueryEngine","Re-using previous result from %s to execute query: %s",l.toString(),LS(i)),this.hs(e,p,i,A4e(l,KC)).next(_=>_))})}cs(e,i){let o=new Co(use(e));return i.forEach((l,d)=>{gN(e,d)&&(o=o.add(d))}),o}ls(e,i,o,l){if(e.limit===null)return!1;if(o.size!==i.size)return!0;const d=e.limitType==="F"?i.last():i.first();return!!d&&(d.hasPendingWrites||d.version.compareTo(l)>0)}_s(e,i,o){return xS()<=Or.DEBUG&&rn("QueryEngine","Using full collection scan to execute query:",LS(i)),this.ns.getDocumentsMatchingQuery(e,i,Lg.min(),o)}hs(e,i,o,l){return this.ns.getDocumentsMatchingQuery(e,o,l).next(d=>(i.forEach(p=>{d=d.insert(p.key,p)}),d))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const F4="LocalStore",o5e=3e8;class a5e{constructor(e,i,o,l){this.persistence=e,this.Ps=i,this.serializer=l,this.Ts=new ys(_r),this.Is=new oE(d=>A4(d),P4),this.Es=new Map,this.ds=e.getRemoteDocumentCache(),this.Hr=e.getTargetCache(),this.Yr=e.getBundleCache(),this.As(o)}As(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new Y3e(this.ds,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.ds.setIndexManager(this.indexManager),this.Ps.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",i=>e.collect(i,this.Ts))}}function c5e(n,e,i,o){return new a5e(n,e,i,o)}async function xse(n,e){const i=tr(n);return await i.persistence.runTransaction("Handle user change","readonly",o=>{let l;return i.mutationQueue.getAllMutationBatches(o).next(d=>(l=d,i.As(e),i.mutationQueue.getAllMutationBatches(o))).next(d=>{const p=[],_=[];let E=Nr();for(const b of l){p.push(b.batchId);for(const C of b.mutations)E=E.add(C.key)}for(const b of d){_.push(b.batchId);for(const C of b.mutations)E=E.add(C.key)}return i.localDocuments.getDocuments(o,E).next(b=>({Rs:b,removedBatchIds:p,addedBatchIds:_}))})})}function l5e(n,e){const i=tr(n);return i.persistence.runTransaction("Acknowledge batch","readwrite-primary",o=>{const l=e.batch.keys(),d=i.ds.newChangeBuffer({trackRemovals:!0});return function(_,E,b,C){const I=b.batch,O=I.keys();let L=Rt.resolve();return O.forEach(U=>{L=L.next(()=>C.getEntry(E,U)).next(B=>{const W=b.docVersions.get(U);gi(W!==null),B.version.compareTo(W)<0&&(I.applyToRemoteDocument(B,b),B.isValidDocument()&&(B.setReadTime(b.commitVersion),C.addEntry(B)))})}),L.next(()=>_.mutationQueue.removeMutationBatch(E,I))}(i,o,e,d).next(()=>d.apply(o)).next(()=>i.mutationQueue.performConsistencyCheck(o)).next(()=>i.documentOverlayCache.removeOverlaysForBatchId(o,l,e.batch.batchId)).next(()=>i.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(o,function(_){let E=Nr();for(let b=0;b<_.mutationResults.length;++b)_.mutationResults[b].transformResults.length>0&&(E=E.add(_.batch.mutations[b].key));return E}(e))).next(()=>i.localDocuments.getDocuments(o,l))})}function Lse(n){const e=tr(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",i=>e.Hr.getLastRemoteSnapshotVersion(i))}function u5e(n,e){const i=tr(n),o=e.snapshotVersion;let l=i.Ts;return i.persistence.runTransaction("Apply remote event","readwrite-primary",d=>{const p=i.ds.newChangeBuffer({trackRemovals:!0});l=i.Ts;const _=[];e.targetChanges.forEach((C,I)=>{const O=l.get(I);if(!O)return;_.push(i.Hr.removeMatchingKeys(d,C.removedDocuments,I).next(()=>i.Hr.addMatchingKeys(d,C.addedDocuments,I)));let L=O.withSequenceNumber(d.currentSequenceNumber);e.targetMismatches.get(I)!==null?L=L.withResumeToken(Ca.EMPTY_BYTE_STRING,Jn.min()).withLastLimboFreeSnapshotVersion(Jn.min()):C.resumeToken.approximateByteSize()>0&&(L=L.withResumeToken(C.resumeToken,o)),l=l.insert(I,L),function(B,W,J){return B.resumeToken.approximateByteSize()===0||W.snapshotVersion.toMicroseconds()-B.snapshotVersion.toMicroseconds()>=o5e?!0:J.addedDocuments.size+J.modifiedDocuments.size+J.removedDocuments.size>0}(O,L,C)&&_.push(i.Hr.updateTargetData(d,L))});let E=Jp(),b=Nr();if(e.documentUpdates.forEach(C=>{e.resolvedLimboDocuments.has(C)&&_.push(i.persistence.referenceDelegate.updateLimboDocument(d,C))}),_.push(d5e(d,p,e.documentUpdates).next(C=>{E=C.Vs,b=C.fs})),!o.isEqual(Jn.min())){const C=i.Hr.getLastRemoteSnapshotVersion(d).next(I=>i.Hr.setTargetsMetadata(d,d.currentSequenceNumber,o));_.push(C)}return Rt.waitFor(_).next(()=>p.apply(d)).next(()=>i.localDocuments.getLocalViewOfDocuments(d,E,b)).next(()=>E)}).then(d=>(i.Ts=l,d))}function d5e(n,e,i){let o=Nr(),l=Nr();return i.forEach(d=>o=o.add(d)),e.getEntries(n,o).next(d=>{let p=Jp();return i.forEach((_,E)=>{const b=d.get(_);E.isFoundDocument()!==b.isFoundDocument()&&(l=l.add(_)),E.isNoDocument()&&E.version.isEqual(Jn.min())?(e.removeEntry(_,E.readTime),p=p.insert(_,E)):!b.isValidDocument()||E.version.compareTo(b.version)>0||E.version.compareTo(b.version)===0&&b.hasPendingWrites?(e.addEntry(E),p=p.insert(_,E)):rn(F4,"Ignoring outdated watch update for ",_,". Current version:",b.version," Watch version:",E.version)}),{Vs:p,fs:l}})}function h5e(n,e){const i=tr(n);return i.persistence.runTransaction("Get next mutation batch","readonly",o=>(e===void 0&&(e=R4),i.mutationQueue.getNextMutationBatchAfterBatchId(o,e)))}function f5e(n,e){const i=tr(n);return i.persistence.runTransaction("Allocate target","readwrite",o=>{let l;return i.Hr.getTargetData(o,e).next(d=>d?(l=d,Rt.resolve(l)):i.Hr.allocateTargetId(o).next(p=>(l=new Cg(e,p,"TargetPurposeListen",o.currentSequenceNumber),i.Hr.addTargetData(o,l).next(()=>l))))}).then(o=>{const l=i.Ts.get(o.targetId);return(l===null||o.snapshotVersion.compareTo(l.snapshotVersion)>0)&&(i.Ts=i.Ts.insert(o.targetId,o),i.Is.set(e,o.targetId)),o})}async function dF(n,e,i){const o=tr(n),l=o.Ts.get(e),d=i?"readwrite":"readwrite-primary";try{i||await o.persistence.runTransaction("Release target",d,p=>o.persistence.referenceDelegate.removeTarget(p,l))}catch(p){if(!eb(p))throw p;rn(F4,`Failed to update sequence numbers for target ${e}: ${p}`)}o.Ts=o.Ts.remove(e),o.Is.delete(l.target)}function FJ(n,e,i){const o=tr(n);let l=Jn.min(),d=Nr();return o.persistence.runTransaction("Execute query","readwrite",p=>function(E,b,C){const I=tr(E),O=I.Is.get(C);return O!==void 0?Rt.resolve(I.Ts.get(O)):I.Hr.getTargetData(b,C)}(o,p,hf(e)).next(_=>{if(_)return l=_.lastLimboFreeSnapshotVersion,o.Hr.getMatchingKeysForTargetId(p,_.targetId).next(E=>{d=E})}).next(()=>o.Ps.getDocumentsMatchingQuery(p,e,i?l:Jn.min(),i?d:Nr())).next(_=>(p5e(o,e3e(e),_),{documents:_,gs:d})))}function p5e(n,e,i){let o=n.Es.get(e)||Jn.min();i.forEach((l,d)=>{d.readTime.compareTo(o)>0&&(o=d.readTime)}),n.Es.set(e,o)}class jJ{constructor(){this.activeTargetIds=o3e()}Ds(e){this.activeTargetIds=this.activeTargetIds.add(e)}vs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}bs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class m5e{constructor(){this.ho=new jJ,this.Po={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,i,o){}addLocalQueryTarget(e,i=!0){return i&&this.ho.Ds(e),this.Po[e]||"not-current"}updateQueryState(e,i,o){this.Po[e]=i}removeLocalQueryTarget(e){this.ho.vs(e)}isLocalQueryTarget(e){return this.ho.activeTargetIds.has(e)}clearQueryState(e){delete this.Po[e]}getAllActiveQueryTargets(){return this.ho.activeTargetIds}isActiveQueryTarget(e){return this.ho.activeTargetIds.has(e)}start(){return this.ho=new jJ,Promise.resolve()}handleUserChange(e,i,o){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class g5e{To(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const BJ="ConnectivityMonitor";class WJ{constructor(){this.Io=()=>this.Eo(),this.Ao=()=>this.Ro(),this.Vo=[],this.mo()}To(e){this.Vo.push(e)}shutdown(){window.removeEventListener("online",this.Io),window.removeEventListener("offline",this.Ao)}mo(){window.addEventListener("online",this.Io),window.addEventListener("offline",this.Ao)}Eo(){rn(BJ,"Network connectivity changed: AVAILABLE");for(const e of this.Vo)e(0)}Ro(){rn(BJ,"Network connectivity changed: UNAVAILABLE");for(const e of this.Vo)e(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let zO=null;function hF(){return zO===null?zO=function(){return 268435456+Math.round(2147483648*Math.random())}():zO++,"0x"+zO.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kU="RestConnection",_5e={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class y5e{get fo(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const i=e.ssl?"https":"http",o=encodeURIComponent(this.databaseId.projectId),l=encodeURIComponent(this.databaseId.database);this.po=i+"://"+e.host,this.yo=`projects/${o}/databases/${l}`,this.wo=this.databaseId.database===l1?`project_id=${o}`:`project_id=${o}&database_id=${l}`}So(e,i,o,l,d){const p=hF(),_=this.bo(e,i.toUriEncodedString());rn(kU,`Sending RPC '${e}' ${p}:`,_,o);const E={"google-cloud-resource-prefix":this.yo,"x-goog-request-params":this.wo};return this.Do(E,l,d),this.vo(e,_,E,o).then(b=>(rn(kU,`Received RPC '${e}' ${p}: `,b),b),b=>{throw O0(kU,`RPC '${e}' ${p} failed with error: `,b,"url: ",_,"request:",o),b})}Co(e,i,o,l,d,p){return this.So(e,i,o,l,d)}Do(e,i,o){e["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+Q0}(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),i&&i.headers.forEach((l,d)=>e[d]=l),o&&o.headers.forEach((l,d)=>e[d]=l)}bo(e,i){const o=_5e[e];return`${this.po}/v1/${i}:${o}`}terminate(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class E5e{constructor(e){this.Fo=e.Fo,this.Mo=e.Mo}xo(e){this.Oo=e}No(e){this.Bo=e}Lo(e){this.ko=e}onMessage(e){this.qo=e}close(){this.Mo()}send(e){this.Fo(e)}Qo(){this.Oo()}$o(){this.Bo()}Uo(e){this.ko(e)}Ko(e){this.qo(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qa="WebChannelConnection";class v5e extends y5e{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}vo(e,i,o,l){const d=hF();return new Promise((p,_)=>{const E=new Fie;E.setWithCredentials(!0),E.listenOnce(jie.COMPLETE,()=>{try{switch(E.getLastErrorCode()){case Ik.NO_ERROR:const C=E.getResponseJson();rn(qa,`XHR for RPC '${e}' ${d} received:`,JSON.stringify(C)),p(C);break;case Ik.TIMEOUT:rn(qa,`RPC '${e}' ${d} timed out`),_(new $t(bt.DEADLINE_EXCEEDED,"Request time out"));break;case Ik.HTTP_ERROR:const I=E.getStatus();if(rn(qa,`RPC '${e}' ${d} failed with status:`,I,"response text:",E.getResponseText()),I>0){let O=E.getResponseJson();Array.isArray(O)&&(O=O[0]);const L=O==null?void 0:O.error;if(L&&L.status&&L.message){const U=function(W){const J=W.toLowerCase().replace(/_/g,"-");return Object.values(bt).indexOf(J)>=0?J:bt.UNKNOWN}(L.status);_(new $t(U,L.message))}else _(new $t(bt.UNKNOWN,"Server responded with status "+E.getStatus()))}else _(new $t(bt.UNAVAILABLE,"Connection failed."));break;default:Kn()}}finally{rn(qa,`RPC '${e}' ${d} completed.`)}});const b=JSON.stringify(l);rn(qa,`RPC '${e}' ${d} sending request:`,l),E.send(i,"POST",b,o,15)})}Wo(e,i,o){const l=hF(),d=[this.po,"/","google.firestore.v1.Firestore","/",e,"/channel"],p=zie(),_=Wie(),E={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},b=this.longPollingOptions.timeoutSeconds;b!==void 0&&(E.longPollingTimeout=Math.round(1e3*b)),this.useFetchStreams&&(E.useFetchStreams=!0),this.Do(E.initMessageHeaders,i,o),E.encodeInitMessageHeaders=!0;const C=d.join("");rn(qa,`Creating RPC '${e}' stream ${l}: ${C}`,E);const I=p.createWebChannel(C,E);let O=!1,L=!1;const U=new E5e({Fo:W=>{L?rn(qa,`Not sending because RPC '${e}' stream ${l} is closed:`,W):(O||(rn(qa,`Opening RPC '${e}' stream ${l} transport.`),I.open(),O=!0),rn(qa,`RPC '${e}' stream ${l} sending:`,W),I.send(W))},Mo:()=>I.close()}),B=(W,J,$)=>{W.listen(J,ie=>{try{$(ie)}catch(ce){setTimeout(()=>{throw ce},0)}})};return B(I,Zw.EventType.OPEN,()=>{L||(rn(qa,`RPC '${e}' stream ${l} transport opened.`),U.Qo())}),B(I,Zw.EventType.CLOSE,()=>{L||(L=!0,rn(qa,`RPC '${e}' stream ${l} transport closed`),U.Uo())}),B(I,Zw.EventType.ERROR,W=>{L||(L=!0,O0(qa,`RPC '${e}' stream ${l} transport errored:`,W),U.Uo(new $t(bt.UNAVAILABLE,"The operation could not be completed")))}),B(I,Zw.EventType.MESSAGE,W=>{var J;if(!L){const $=W.data[0];gi(!!$);const ie=$,ce=(ie==null?void 0:ie.error)||((J=ie[0])===null||J===void 0?void 0:J.error);if(ce){rn(qa,`RPC '${e}' stream ${l} received error:`,ce);const ne=ce.status;let de=function(X){const re=to[X];if(re!==void 0)return bse(re)}(ne),Q=ce.message;de===void 0&&(de=bt.INTERNAL,Q="Unknown error status: "+ne+" with message "+ce.message),L=!0,U.Uo(new $t(de,Q)),I.close()}else rn(qa,`RPC '${e}' stream ${l} received:`,$),U.Ko($)}}),B(_,Bie.STAT_EVENT,W=>{W.stat===eF.PROXY?rn(qa,`RPC '${e}' stream ${l} detected buffering proxy`):W.stat===eF.NOPROXY&&rn(qa,`RPC '${e}' stream ${l} detected no buffering proxy`)}),setTimeout(()=>{U.$o()},0),U}}function NU(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vN(n){return new w3e(n,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mse{constructor(e,i,o=1e3,l=1.5,d=6e4){this.Ti=e,this.timerId=i,this.Go=o,this.zo=l,this.jo=d,this.Ho=0,this.Jo=null,this.Yo=Date.now(),this.reset()}reset(){this.Ho=0}Zo(){this.Ho=this.jo}Xo(e){this.cancel();const i=Math.floor(this.Ho+this.e_()),o=Math.max(0,Date.now()-this.Yo),l=Math.max(0,i-o);l>0&&rn("ExponentialBackoff",`Backing off for ${l} ms (base delay: ${this.Ho} ms, delay with jitter: ${i} ms, last attempt: ${o} ms ago)`),this.Jo=this.Ti.enqueueAfterDelay(this.timerId,l,()=>(this.Yo=Date.now(),e())),this.Ho*=this.zo,this.Ho<this.Go&&(this.Ho=this.Go),this.Ho>this.jo&&(this.Ho=this.jo)}t_(){this.Jo!==null&&(this.Jo.skipDelay(),this.Jo=null)}cancel(){this.Jo!==null&&(this.Jo.cancel(),this.Jo=null)}e_(){return(Math.random()-.5)*this.Ho}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zJ="PersistentStream";class Use{constructor(e,i,o,l,d,p,_,E){this.Ti=e,this.n_=o,this.r_=l,this.connection=d,this.authCredentialsProvider=p,this.appCheckCredentialsProvider=_,this.listener=E,this.state=0,this.i_=0,this.s_=null,this.o_=null,this.stream=null,this.__=0,this.a_=new Mse(e,i)}u_(){return this.state===1||this.state===5||this.c_()}c_(){return this.state===2||this.state===3}start(){this.__=0,this.state!==4?this.auth():this.l_()}async stop(){this.u_()&&await this.close(0)}h_(){this.state=0,this.a_.reset()}P_(){this.c_()&&this.s_===null&&(this.s_=this.Ti.enqueueAfterDelay(this.n_,6e4,()=>this.T_()))}I_(e){this.E_(),this.stream.send(e)}async T_(){if(this.c_())return this.close(0)}E_(){this.s_&&(this.s_.cancel(),this.s_=null)}d_(){this.o_&&(this.o_.cancel(),this.o_=null)}async close(e,i){this.E_(),this.d_(),this.a_.cancel(),this.i_++,e!==4?this.a_.reset():i&&i.code===bt.RESOURCE_EXHAUSTED?(Xp(i.toString()),Xp("Using maximum backoff delay to prevent overloading the backend."),this.a_.Zo()):i&&i.code===bt.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.A_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.Lo(i)}A_(){}auth(){this.state=1;const e=this.R_(this.i_),i=this.i_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([o,l])=>{this.i_===i&&this.V_(o,l)},o=>{e(()=>{const l=new $t(bt.UNKNOWN,"Fetching auth token failed: "+o.message);return this.m_(l)})})}V_(e,i){const o=this.R_(this.i_);this.stream=this.f_(e,i),this.stream.xo(()=>{o(()=>this.listener.xo())}),this.stream.No(()=>{o(()=>(this.state=2,this.o_=this.Ti.enqueueAfterDelay(this.r_,1e4,()=>(this.c_()&&(this.state=3),Promise.resolve())),this.listener.No()))}),this.stream.Lo(l=>{o(()=>this.m_(l))}),this.stream.onMessage(l=>{o(()=>++this.__==1?this.g_(l):this.onNext(l))})}l_(){this.state=5,this.a_.Xo(async()=>{this.state=0,this.start()})}m_(e){return rn(zJ,`close with error: ${e}`),this.stream=null,this.close(4,e)}R_(e){return i=>{this.Ti.enqueueAndForget(()=>this.i_===e?i():(rn(zJ,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class S5e extends Use{constructor(e,i,o,l,d,p){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",i,o,l,p),this.serializer=d}f_(e,i){return this.connection.Wo("Listen",e,i)}g_(e){return this.onNext(e)}onNext(e){this.a_.reset();const i=I3e(this.serializer,e),o=function(d){if(!("targetChange"in d))return Jn.min();const p=d.targetChange;return p.targetIds&&p.targetIds.length?Jn.min():p.readTime?ff(p.readTime):Jn.min()}(e);return this.listener.p_(i,o)}y_(e){const i={};i.database=uF(this.serializer),i.addTarget=function(d,p){let _;const E=p.target;if(_=sF(E)?{documents:O3e(d,E)}:{query:k3e(d,E).ht},_.targetId=p.targetId,p.resumeToken.approximateByteSize()>0){_.resumeToken=Cse(d,p.resumeToken);const b=aF(d,p.expectedCount);b!==null&&(_.expectedCount=b)}else if(p.snapshotVersion.compareTo(Jn.min())>0){_.readTime=m1(d,p.snapshotVersion.toTimestamp());const b=aF(d,p.expectedCount);b!==null&&(_.expectedCount=b)}return _}(this.serializer,e);const o=D3e(this.serializer,e);o&&(i.labels=o),this.I_(i)}w_(e){const i={};i.database=uF(this.serializer),i.removeTarget=e,this.I_(i)}}class b5e extends Use{constructor(e,i,o,l,d,p){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",i,o,l,p),this.serializer=d}get S_(){return this.__>0}start(){this.lastStreamToken=void 0,super.start()}A_(){this.S_&&this.b_([])}f_(e,i){return this.connection.Wo("Write",e,i)}g_(e){return gi(!!e.streamToken),this.lastStreamToken=e.streamToken,gi(!e.writeResults||e.writeResults.length===0),this.listener.D_()}onNext(e){gi(!!e.streamToken),this.lastStreamToken=e.streamToken,this.a_.reset();const i=P3e(e.writeResults,e.commitTime),o=ff(e.commitTime);return this.listener.v_(o,i)}C_(){const e={};e.database=uF(this.serializer),this.I_(e)}b_(e){const i={streamToken:this.lastStreamToken,writes:e.map(o=>A3e(this.serializer,o))};this.I_(i)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class T5e{}class w5e extends T5e{constructor(e,i,o,l){super(),this.authCredentials=e,this.appCheckCredentials=i,this.connection=o,this.serializer=l,this.F_=!1}M_(){if(this.F_)throw new $t(bt.FAILED_PRECONDITION,"The client has already been terminated.")}So(e,i,o,l){return this.M_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([d,p])=>this.connection.So(e,cF(i,o),l,d,p)).catch(d=>{throw d.name==="FirebaseError"?(d.code===bt.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),d):new $t(bt.UNKNOWN,d.toString())})}Co(e,i,o,l,d){return this.M_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([p,_])=>this.connection.Co(e,cF(i,o),l,p,_,d)).catch(p=>{throw p.name==="FirebaseError"?(p.code===bt.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),p):new $t(bt.UNKNOWN,p.toString())})}terminate(){this.F_=!0,this.connection.terminate()}}class C5e{constructor(e,i){this.asyncQueue=e,this.onlineStateHandler=i,this.state="Unknown",this.x_=0,this.O_=null,this.N_=!0}B_(){this.x_===0&&(this.L_("Unknown"),this.O_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.O_=null,this.k_("Backend didn't respond within 10 seconds."),this.L_("Offline"),Promise.resolve())))}q_(e){this.state==="Online"?this.L_("Unknown"):(this.x_++,this.x_>=1&&(this.Q_(),this.k_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.L_("Offline")))}set(e){this.Q_(),this.x_=0,e==="Online"&&(this.N_=!1),this.L_(e)}L_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}k_(e){const i=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.N_?(Xp(i),this.N_=!1):rn("OnlineStateTracker",i)}Q_(){this.O_!==null&&(this.O_.cancel(),this.O_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Qy="RemoteStore";class R5e{constructor(e,i,o,l,d){this.localStore=e,this.datastore=i,this.asyncQueue=o,this.remoteSyncer={},this.U_=[],this.K_=new Map,this.W_=new Set,this.G_=[],this.z_=d,this.z_.To(p=>{o.enqueueAndForget(async()=>{aE(this)&&(rn(Qy,"Restarting streams for network reachability change."),await async function(E){const b=tr(E);b.W_.add(4),await RR(b),b.j_.set("Unknown"),b.W_.delete(4),await SN(b)}(this))})}),this.j_=new C5e(o,l)}}async function SN(n){if(aE(n))for(const e of n.G_)await e(!0)}async function RR(n){for(const e of n.G_)await e(!1)}function Vse(n,e){const i=tr(n);i.K_.has(e.targetId)||(i.K_.set(e.targetId,e),z4(i)?W4(i):tb(i).c_()&&B4(i,e))}function j4(n,e){const i=tr(n),o=tb(i);i.K_.delete(e),o.c_()&&Fse(i,e),i.K_.size===0&&(o.c_()?o.P_():aE(i)&&i.j_.set("Unknown"))}function B4(n,e){if(n.H_.Ne(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(Jn.min())>0){const i=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(i)}tb(n).y_(e)}function Fse(n,e){n.H_.Ne(e),tb(n).w_(e)}function W4(n){n.H_=new v3e({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),lt:e=>n.K_.get(e)||null,it:()=>n.datastore.serializer.databaseId}),tb(n).start(),n.j_.B_()}function z4(n){return aE(n)&&!tb(n).u_()&&n.K_.size>0}function aE(n){return tr(n).W_.size===0}function jse(n){n.H_=void 0}async function I5e(n){n.j_.set("Online")}async function A5e(n){n.K_.forEach((e,i)=>{B4(n,e)})}async function P5e(n,e){jse(n),z4(n)?(n.j_.q_(e),W4(n)):n.j_.set("Unknown")}async function O5e(n,e,i){if(n.j_.set("Online"),e instanceof wse&&e.state===2&&e.cause)try{await async function(l,d){const p=d.cause;for(const _ of d.targetIds)l.K_.has(_)&&(await l.remoteSyncer.rejectListen(_,p),l.K_.delete(_),l.H_.removeTarget(_))}(n,e)}catch(o){rn(Qy,"Failed to remove targets %s: %s ",e.targetIds.join(","),o),await _1(n,o)}else if(e instanceof kk?n.H_.We(e):e instanceof Tse?n.H_.Ze(e):n.H_.je(e),!i.isEqual(Jn.min()))try{const o=await Lse(n.localStore);i.compareTo(o)>=0&&await function(d,p){const _=d.H_.ot(p);return _.targetChanges.forEach((E,b)=>{if(E.resumeToken.approximateByteSize()>0){const C=d.K_.get(b);C&&d.K_.set(b,C.withResumeToken(E.resumeToken,p))}}),_.targetMismatches.forEach((E,b)=>{const C=d.K_.get(E);if(!C)return;d.K_.set(E,C.withResumeToken(Ca.EMPTY_BYTE_STRING,C.snapshotVersion)),Fse(d,E);const I=new Cg(C.target,E,b,C.sequenceNumber);B4(d,I)}),d.remoteSyncer.applyRemoteEvent(_)}(n,i)}catch(o){rn(Qy,"Failed to raise snapshot:",o),await _1(n,o)}}async function _1(n,e,i){if(!eb(e))throw e;n.W_.add(1),await RR(n),n.j_.set("Offline"),i||(i=()=>Lse(n.localStore)),n.asyncQueue.enqueueRetryable(async()=>{rn(Qy,"Retrying IndexedDB access"),await i(),n.W_.delete(1),await SN(n)})}function Bse(n,e){return e().catch(i=>_1(n,i,e))}async function bN(n){const e=tr(n),i=Fg(e);let o=e.U_.length>0?e.U_[e.U_.length-1].batchId:R4;for(;k5e(e);)try{const l=await h5e(e.localStore,o);if(l===null){e.U_.length===0&&i.P_();break}o=l.batchId,N5e(e,l)}catch(l){await _1(e,l)}Wse(e)&&zse(e)}function k5e(n){return aE(n)&&n.U_.length<10}function N5e(n,e){n.U_.push(e);const i=Fg(n);i.c_()&&i.S_&&i.b_(e.mutations)}function Wse(n){return aE(n)&&!Fg(n).u_()&&n.U_.length>0}function zse(n){Fg(n).start()}async function D5e(n){Fg(n).C_()}async function x5e(n){const e=Fg(n);for(const i of n.U_)e.b_(i.mutations)}async function L5e(n,e,i){const o=n.U_.shift(),l=D4.from(o,e,i);await Bse(n,()=>n.remoteSyncer.applySuccessfulWrite(l)),await bN(n)}async function M5e(n,e){e&&Fg(n).S_&&await async function(o,l){if(function(p){return y3e(p)&&p!==bt.ABORTED}(l.code)){const d=o.U_.shift();Fg(o).h_(),await Bse(o,()=>o.remoteSyncer.rejectFailedWrite(d.batchId,l)),await bN(o)}}(n,e),Wse(n)&&zse(n)}async function GJ(n,e){const i=tr(n);i.asyncQueue.verifyOperationInProgress(),rn(Qy,"RemoteStore received new credentials");const o=aE(i);i.W_.add(3),await RR(i),o&&i.j_.set("Unknown"),await i.remoteSyncer.handleCredentialChange(e),i.W_.delete(3),await SN(i)}async function U5e(n,e){const i=tr(n);e?(i.W_.delete(2),await SN(i)):e||(i.W_.add(2),await RR(i),i.j_.set("Unknown"))}function tb(n){return n.J_||(n.J_=function(i,o,l){const d=tr(i);return d.M_(),new S5e(o,d.connection,d.authCredentials,d.appCheckCredentials,d.serializer,l)}(n.datastore,n.asyncQueue,{xo:I5e.bind(null,n),No:A5e.bind(null,n),Lo:P5e.bind(null,n),p_:O5e.bind(null,n)}),n.G_.push(async e=>{e?(n.J_.h_(),z4(n)?W4(n):n.j_.set("Unknown")):(await n.J_.stop(),jse(n))})),n.J_}function Fg(n){return n.Y_||(n.Y_=function(i,o,l){const d=tr(i);return d.M_(),new b5e(o,d.connection,d.authCredentials,d.appCheckCredentials,d.serializer,l)}(n.datastore,n.asyncQueue,{xo:()=>Promise.resolve(),No:D5e.bind(null,n),Lo:M5e.bind(null,n),D_:x5e.bind(null,n),v_:L5e.bind(null,n)}),n.G_.push(async e=>{e?(n.Y_.h_(),await bN(n)):(await n.Y_.stop(),n.U_.length>0&&(rn(Qy,`Stopping write stream with ${n.U_.length} pending writes`),n.U_=[]))})),n.Y_}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class G4{constructor(e,i,o,l,d){this.asyncQueue=e,this.timerId=i,this.targetTimeMs=o,this.op=l,this.removalCallback=d,this.deferred=new jp,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(p=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,i,o,l,d){const p=Date.now()+o,_=new G4(e,i,p,l,d);return _.start(o),_}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new $t(bt.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function H4(n,e){if(Xp("AsyncQueue",`${e}: ${n}`),eb(n))return new $t(bt.UNAVAILABLE,`${e}: ${n}`);throw n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class p0{static emptySet(e){return new p0(e.comparator)}constructor(e){this.comparator=e?(i,o)=>e(i,o)||Cn.comparator(i.key,o.key):(i,o)=>Cn.comparator(i.key,o.key),this.keyedMap=eC(),this.sortedSet=new ys(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const i=this.keyedMap.get(e);return i?this.sortedSet.indexOf(i):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((i,o)=>(e(i),!1))}add(e){const i=this.delete(e.key);return i.copy(i.keyedMap.insert(e.key,e),i.sortedSet.insert(e,null))}delete(e){const i=this.get(e);return i?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(i)):this}isEqual(e){if(!(e instanceof p0)||this.size!==e.size)return!1;const i=this.sortedSet.getIterator(),o=e.sortedSet.getIterator();for(;i.hasNext();){const l=i.getNext().key,d=o.getNext().key;if(!l.isEqual(d))return!1}return!0}toString(){const e=[];return this.forEach(i=>{e.push(i.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,i){const o=new p0;return o.comparator=this.comparator,o.keyedMap=e,o.sortedSet=i,o}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class HJ{constructor(){this.Z_=new ys(Cn.comparator)}track(e){const i=e.doc.key,o=this.Z_.get(i);o?e.type!==0&&o.type===3?this.Z_=this.Z_.insert(i,e):e.type===3&&o.type!==1?this.Z_=this.Z_.insert(i,{type:o.type,doc:e.doc}):e.type===2&&o.type===2?this.Z_=this.Z_.insert(i,{type:2,doc:e.doc}):e.type===2&&o.type===0?this.Z_=this.Z_.insert(i,{type:0,doc:e.doc}):e.type===1&&o.type===0?this.Z_=this.Z_.remove(i):e.type===1&&o.type===2?this.Z_=this.Z_.insert(i,{type:1,doc:o.doc}):e.type===0&&o.type===1?this.Z_=this.Z_.insert(i,{type:2,doc:e.doc}):Kn():this.Z_=this.Z_.insert(i,e)}X_(){const e=[];return this.Z_.inorderTraversal((i,o)=>{e.push(o)}),e}}class V0{constructor(e,i,o,l,d,p,_,E,b){this.query=e,this.docs=i,this.oldDocs=o,this.docChanges=l,this.mutatedKeys=d,this.fromCache=p,this.syncStateChanged=_,this.excludesMetadataChanges=E,this.hasCachedResults=b}static fromInitialDocuments(e,i,o,l,d){const p=[];return i.forEach(_=>{p.push({type:0,doc:_})}),new V0(e,i,p0.emptySet(i),p,o,l,!0,!1,d)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&mN(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const i=this.docChanges,o=e.docChanges;if(i.length!==o.length)return!1;for(let l=0;l<i.length;l++)if(i[l].type!==o[l].type||!i[l].doc.isEqual(o[l].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class V5e{constructor(){this.ea=void 0,this.ta=[]}na(){return this.ta.some(e=>e.ra())}}class F5e{constructor(){this.queries=$J(),this.onlineState="Unknown",this.ia=new Set}terminate(){(function(i,o){const l=tr(i),d=l.queries;l.queries=$J(),d.forEach((p,_)=>{for(const E of _.ta)E.onError(o)})})(this,new $t(bt.ABORTED,"Firestore shutting down"))}}function $J(){return new oE(n=>lse(n),mN)}async function $4(n,e){const i=tr(n);let o=3;const l=e.query;let d=i.queries.get(l);d?!d.na()&&e.ra()&&(o=2):(d=new V5e,o=e.ra()?0:1);try{switch(o){case 0:d.ea=await i.onListen(l,!0);break;case 1:d.ea=await i.onListen(l,!1);break;case 2:await i.onFirstRemoteStoreListen(l)}}catch(p){const _=H4(p,`Initialization of query '${LS(e.query)}' failed`);return void e.onError(_)}i.queries.set(l,d),d.ta.push(e),e.sa(i.onlineState),d.ea&&e.oa(d.ea)&&q4(i)}async function K4(n,e){const i=tr(n),o=e.query;let l=3;const d=i.queries.get(o);if(d){const p=d.ta.indexOf(e);p>=0&&(d.ta.splice(p,1),d.ta.length===0?l=e.ra()?0:1:!d.na()&&e.ra()&&(l=2))}switch(l){case 0:return i.queries.delete(o),i.onUnlisten(o,!0);case 1:return i.queries.delete(o),i.onUnlisten(o,!1);case 2:return i.onLastRemoteStoreUnlisten(o);default:return}}function j5e(n,e){const i=tr(n);let o=!1;for(const l of e){const d=l.query,p=i.queries.get(d);if(p){for(const _ of p.ta)_.oa(l)&&(o=!0);p.ea=l}}o&&q4(i)}function B5e(n,e,i){const o=tr(n),l=o.queries.get(e);if(l)for(const d of l.ta)d.onError(i);o.queries.delete(e)}function q4(n){n.ia.forEach(e=>{e.next()})}var fF,KJ;(KJ=fF||(fF={}))._a="default",KJ.Cache="cache";class Y4{constructor(e,i,o){this.query=e,this.aa=i,this.ua=!1,this.ca=null,this.onlineState="Unknown",this.options=o||{}}oa(e){if(!this.options.includeMetadataChanges){const o=[];for(const l of e.docChanges)l.type!==3&&o.push(l);e=new V0(e.query,e.docs,e.oldDocs,o,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let i=!1;return this.ua?this.la(e)&&(this.aa.next(e),i=!0):this.ha(e,this.onlineState)&&(this.Pa(e),i=!0),this.ca=e,i}onError(e){this.aa.error(e)}sa(e){this.onlineState=e;let i=!1;return this.ca&&!this.ua&&this.ha(this.ca,e)&&(this.Pa(this.ca),i=!0),i}ha(e,i){if(!e.fromCache||!this.ra())return!0;const o=i!=="Offline";return(!this.options.Ta||!o)&&(!e.docs.isEmpty()||e.hasCachedResults||i==="Offline")}la(e){if(e.docChanges.length>0)return!0;const i=this.ca&&this.ca.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!i)&&this.options.includeMetadataChanges===!0}Pa(e){e=V0.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.ua=!0,this.aa.next(e)}ra(){return this.options.source!==fF.Cache}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gse{constructor(e){this.key=e}}class Hse{constructor(e){this.key=e}}class W5e{constructor(e,i){this.query=e,this.fa=i,this.ga=null,this.hasCachedResults=!1,this.current=!1,this.pa=Nr(),this.mutatedKeys=Nr(),this.ya=use(e),this.wa=new p0(this.ya)}get Sa(){return this.fa}ba(e,i){const o=i?i.Da:new HJ,l=i?i.wa:this.wa;let d=i?i.mutatedKeys:this.mutatedKeys,p=l,_=!1;const E=this.query.limitType==="F"&&l.size===this.query.limit?l.last():null,b=this.query.limitType==="L"&&l.size===this.query.limit?l.first():null;if(e.inorderTraversal((C,I)=>{const O=l.get(C),L=gN(this.query,I)?I:null,U=!!O&&this.mutatedKeys.has(O.key),B=!!L&&(L.hasLocalMutations||this.mutatedKeys.has(L.key)&&L.hasCommittedMutations);let W=!1;O&&L?O.data.isEqual(L.data)?U!==B&&(o.track({type:3,doc:L}),W=!0):this.va(O,L)||(o.track({type:2,doc:L}),W=!0,(E&&this.ya(L,E)>0||b&&this.ya(L,b)<0)&&(_=!0)):!O&&L?(o.track({type:0,doc:L}),W=!0):O&&!L&&(o.track({type:1,doc:O}),W=!0,(E||b)&&(_=!0)),W&&(L?(p=p.add(L),d=B?d.add(C):d.delete(C)):(p=p.delete(C),d=d.delete(C)))}),this.query.limit!==null)for(;p.size>this.query.limit;){const C=this.query.limitType==="F"?p.last():p.first();p=p.delete(C.key),d=d.delete(C.key),o.track({type:1,doc:C})}return{wa:p,Da:o,ls:_,mutatedKeys:d}}va(e,i){return e.hasLocalMutations&&i.hasCommittedMutations&&!i.hasLocalMutations}applyChanges(e,i,o,l){const d=this.wa;this.wa=e.wa,this.mutatedKeys=e.mutatedKeys;const p=e.Da.X_();p.sort((C,I)=>function(L,U){const B=W=>{switch(W){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Kn()}};return B(L)-B(U)}(C.type,I.type)||this.ya(C.doc,I.doc)),this.Ca(o),l=l!=null&&l;const _=i&&!l?this.Fa():[],E=this.pa.size===0&&this.current&&!l?1:0,b=E!==this.ga;return this.ga=E,p.length!==0||b?{snapshot:new V0(this.query,e.wa,d,p,e.mutatedKeys,E===0,b,!1,!!o&&o.resumeToken.approximateByteSize()>0),Ma:_}:{Ma:_}}sa(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({wa:this.wa,Da:new HJ,mutatedKeys:this.mutatedKeys,ls:!1},!1)):{Ma:[]}}xa(e){return!this.fa.has(e)&&!!this.wa.has(e)&&!this.wa.get(e).hasLocalMutations}Ca(e){e&&(e.addedDocuments.forEach(i=>this.fa=this.fa.add(i)),e.modifiedDocuments.forEach(i=>{}),e.removedDocuments.forEach(i=>this.fa=this.fa.delete(i)),this.current=e.current)}Fa(){if(!this.current)return[];const e=this.pa;this.pa=Nr(),this.wa.forEach(o=>{this.xa(o.key)&&(this.pa=this.pa.add(o.key))});const i=[];return e.forEach(o=>{this.pa.has(o)||i.push(new Hse(o))}),this.pa.forEach(o=>{e.has(o)||i.push(new Gse(o))}),i}Oa(e){this.fa=e.gs,this.pa=Nr();const i=this.ba(e.documents);return this.applyChanges(i,!0)}Na(){return V0.fromInitialDocuments(this.query,this.wa,this.mutatedKeys,this.ga===0,this.hasCachedResults)}}const X4="SyncEngine";class z5e{constructor(e,i,o){this.query=e,this.targetId=i,this.view=o}}class G5e{constructor(e){this.key=e,this.Ba=!1}}class H5e{constructor(e,i,o,l,d,p){this.localStore=e,this.remoteStore=i,this.eventManager=o,this.sharedClientState=l,this.currentUser=d,this.maxConcurrentLimboResolutions=p,this.La={},this.ka=new oE(_=>lse(_),mN),this.qa=new Map,this.Qa=new Set,this.$a=new ys(Cn.comparator),this.Ua=new Map,this.Ka=new M4,this.Wa={},this.Ga=new Map,this.za=U0.Kn(),this.onlineState="Unknown",this.ja=void 0}get isPrimaryClient(){return this.ja===!0}}async function $5e(n,e,i=!0){const o=Jse(n);let l;const d=o.ka.get(e);return d?(o.sharedClientState.addLocalQueryTarget(d.targetId),l=d.view.Na()):l=await $se(o,e,i,!0),l}async function K5e(n,e){const i=Jse(n);await $se(i,e,!0,!1)}async function $se(n,e,i,o){const l=await f5e(n.localStore,hf(e)),d=l.targetId,p=n.sharedClientState.addLocalQueryTarget(d,i);let _;return o&&(_=await q5e(n,e,d,p==="current",l.resumeToken)),n.isPrimaryClient&&i&&Vse(n.remoteStore,l),_}async function q5e(n,e,i,o,l){n.Ha=(I,O,L)=>async function(B,W,J,$){let ie=W.view.ba(J);ie.ls&&(ie=await FJ(B.localStore,W.query,!1).then(({documents:Q})=>W.view.ba(Q,ie)));const ce=$&&$.targetChanges.get(W.targetId),ne=$&&$.targetMismatches.get(W.targetId)!=null,de=W.view.applyChanges(ie,B.isPrimaryClient,ce,ne);return YJ(B,W.targetId,de.Ma),de.snapshot}(n,I,O,L);const d=await FJ(n.localStore,e,!0),p=new W5e(e,d.gs),_=p.ba(d.documents),E=CR.createSynthesizedTargetChangeForCurrentChange(i,o&&n.onlineState!=="Offline",l),b=p.applyChanges(_,n.isPrimaryClient,E);YJ(n,i,b.Ma);const C=new z5e(e,i,p);return n.ka.set(e,C),n.qa.has(i)?n.qa.get(i).push(e):n.qa.set(i,[e]),b.snapshot}async function Y5e(n,e,i){const o=tr(n),l=o.ka.get(e),d=o.qa.get(l.targetId);if(d.length>1)return o.qa.set(l.targetId,d.filter(p=>!mN(p,e))),void o.ka.delete(e);o.isPrimaryClient?(o.sharedClientState.removeLocalQueryTarget(l.targetId),o.sharedClientState.isActiveQueryTarget(l.targetId)||await dF(o.localStore,l.targetId,!1).then(()=>{o.sharedClientState.clearQueryState(l.targetId),i&&j4(o.remoteStore,l.targetId),pF(o,l.targetId)}).catch(Z0)):(pF(o,l.targetId),await dF(o.localStore,l.targetId,!0))}async function X5e(n,e){const i=tr(n),o=i.ka.get(e),l=i.qa.get(o.targetId);i.isPrimaryClient&&l.length===1&&(i.sharedClientState.removeLocalQueryTarget(o.targetId),j4(i.remoteStore,o.targetId))}async function J5e(n,e,i){const o=iBe(n);try{const l=await function(p,_){const E=tr(p),b=wo.now(),C=_.reduce((L,U)=>L.add(U.key),Nr());let I,O;return E.persistence.runTransaction("Locally write mutations","readwrite",L=>{let U=Jp(),B=Nr();return E.ds.getEntries(L,C).next(W=>{U=W,U.forEach((J,$)=>{$.isValidDocument()||(B=B.add(J))})}).next(()=>E.localDocuments.getOverlayedDocuments(L,U)).next(W=>{I=W;const J=[];for(const $ of _){const ie=f3e($,I.get($.key).overlayedDocument);ie!=null&&J.push(new Kg($.key,ie,nse(ie.value.mapValue),Bu.exists(!0)))}return E.mutationQueue.addMutationBatch(L,b,J,_)}).next(W=>{O=W;const J=W.applyToLocalDocumentSet(I,B);return E.documentOverlayCache.saveOverlays(L,W.batchId,J)})}).then(()=>({batchId:O.batchId,changes:hse(I)}))}(o.localStore,e);o.sharedClientState.addPendingMutation(l.batchId),function(p,_,E){let b=p.Wa[p.currentUser.toKey()];b||(b=new ys(_r)),b=b.insert(_,E),p.Wa[p.currentUser.toKey()]=b}(o,l.batchId,i),await IR(o,l.changes),await bN(o.remoteStore)}catch(l){const d=H4(l,"Failed to persist write");i.reject(d)}}async function Kse(n,e){const i=tr(n);try{const o=await u5e(i.localStore,e);e.targetChanges.forEach((l,d)=>{const p=i.Ua.get(d);p&&(gi(l.addedDocuments.size+l.modifiedDocuments.size+l.removedDocuments.size<=1),l.addedDocuments.size>0?p.Ba=!0:l.modifiedDocuments.size>0?gi(p.Ba):l.removedDocuments.size>0&&(gi(p.Ba),p.Ba=!1))}),await IR(i,o,e)}catch(o){await Z0(o)}}function qJ(n,e,i){const o=tr(n);if(o.isPrimaryClient&&i===0||!o.isPrimaryClient&&i===1){const l=[];o.ka.forEach((d,p)=>{const _=p.view.sa(e);_.snapshot&&l.push(_.snapshot)}),function(p,_){const E=tr(p);E.onlineState=_;let b=!1;E.queries.forEach((C,I)=>{for(const O of I.ta)O.sa(_)&&(b=!0)}),b&&q4(E)}(o.eventManager,e),l.length&&o.La.p_(l),o.onlineState=e,o.isPrimaryClient&&o.sharedClientState.setOnlineState(e)}}async function Q5e(n,e,i){const o=tr(n);o.sharedClientState.updateQueryState(e,"rejected",i);const l=o.Ua.get(e),d=l&&l.key;if(d){let p=new ys(Cn.comparator);p=p.insert(d,Qa.newNoDocument(d,Jn.min()));const _=Nr().add(d),E=new EN(Jn.min(),new Map,new ys(_r),p,_);await Kse(o,E),o.$a=o.$a.remove(d),o.Ua.delete(e),J4(o)}else await dF(o.localStore,e,!1).then(()=>pF(o,e,i)).catch(Z0)}async function Z5e(n,e){const i=tr(n),o=e.batch.batchId;try{const l=await l5e(i.localStore,e);Yse(i,o,null),qse(i,o),i.sharedClientState.updateMutationState(o,"acknowledged"),await IR(i,l)}catch(l){await Z0(l)}}async function eBe(n,e,i){const o=tr(n);try{const l=await function(p,_){const E=tr(p);return E.persistence.runTransaction("Reject batch","readwrite-primary",b=>{let C;return E.mutationQueue.lookupMutationBatch(b,_).next(I=>(gi(I!==null),C=I.keys(),E.mutationQueue.removeMutationBatch(b,I))).next(()=>E.mutationQueue.performConsistencyCheck(b)).next(()=>E.documentOverlayCache.removeOverlaysForBatchId(b,C,_)).next(()=>E.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(b,C)).next(()=>E.localDocuments.getDocuments(b,C))})}(o.localStore,e);Yse(o,e,i),qse(o,e),o.sharedClientState.updateMutationState(e,"rejected",i),await IR(o,l)}catch(l){await Z0(l)}}function qse(n,e){(n.Ga.get(e)||[]).forEach(i=>{i.resolve()}),n.Ga.delete(e)}function Yse(n,e,i){const o=tr(n);let l=o.Wa[o.currentUser.toKey()];if(l){const d=l.get(e);d&&(i?d.reject(i):d.resolve(),l=l.remove(e)),o.Wa[o.currentUser.toKey()]=l}}function pF(n,e,i=null){n.sharedClientState.removeLocalQueryTarget(e);for(const o of n.qa.get(e))n.ka.delete(o),i&&n.La.Ja(o,i);n.qa.delete(e),n.isPrimaryClient&&n.Ka.br(e).forEach(o=>{n.Ka.containsKey(o)||Xse(n,o)})}function Xse(n,e){n.Qa.delete(e.path.canonicalString());const i=n.$a.get(e);i!==null&&(j4(n.remoteStore,i),n.$a=n.$a.remove(e),n.Ua.delete(i),J4(n))}function YJ(n,e,i){for(const o of i)o instanceof Gse?(n.Ka.addReference(o.key,e),tBe(n,o)):o instanceof Hse?(rn(X4,"Document no longer in limbo: "+o.key),n.Ka.removeReference(o.key,e),n.Ka.containsKey(o.key)||Xse(n,o.key)):Kn()}function tBe(n,e){const i=e.key,o=i.path.canonicalString();n.$a.get(i)||n.Qa.has(o)||(rn(X4,"New document in limbo: "+i),n.Qa.add(o),J4(n))}function J4(n){for(;n.Qa.size>0&&n.$a.size<n.maxConcurrentLimboResolutions;){const e=n.Qa.values().next().value;n.Qa.delete(e);const i=new Cn(Ki.fromString(e)),o=n.za.next();n.Ua.set(o,new G5e(i)),n.$a=n.$a.insert(i,o),Vse(n.remoteStore,new Cg(hf(pN(i.path)),o,"TargetPurposeLimboResolution",uN.ae))}}async function IR(n,e,i){const o=tr(n),l=[],d=[],p=[];o.ka.isEmpty()||(o.ka.forEach((_,E)=>{p.push(o.Ha(E,e,i).then(b=>{var C;if((b||i)&&o.isPrimaryClient){const I=b?!b.fromCache:(C=i==null?void 0:i.targetChanges.get(E.targetId))===null||C===void 0?void 0:C.current;o.sharedClientState.updateQueryState(E.targetId,I?"current":"not-current")}if(b){l.push(b);const I=V4.Yi(E.targetId,b);d.push(I)}}))}),await Promise.all(p),o.La.p_(l),await async function(E,b){const C=tr(E);try{await C.persistence.runTransaction("notifyLocalViewChanges","readwrite",I=>Rt.forEach(b,O=>Rt.forEach(O.Hi,L=>C.persistence.referenceDelegate.addReference(I,O.targetId,L)).next(()=>Rt.forEach(O.Ji,L=>C.persistence.referenceDelegate.removeReference(I,O.targetId,L)))))}catch(I){if(!eb(I))throw I;rn(F4,"Failed to update sequence numbers: "+I)}for(const I of b){const O=I.targetId;if(!I.fromCache){const L=C.Ts.get(O),U=L.snapshotVersion,B=L.withLastLimboFreeSnapshotVersion(U);C.Ts=C.Ts.insert(O,B)}}}(o.localStore,d))}async function nBe(n,e){const i=tr(n);if(!i.currentUser.isEqual(e)){rn(X4,"User change. New user:",e.toKey());const o=await xse(i.localStore,e);i.currentUser=e,function(d,p){d.Ga.forEach(_=>{_.forEach(E=>{E.reject(new $t(bt.CANCELLED,p))})}),d.Ga.clear()}(i,"'waitForPendingWrites' promise is rejected due to a user change."),i.sharedClientState.handleUserChange(e,o.removedBatchIds,o.addedBatchIds),await IR(i,o.Rs)}}function rBe(n,e){const i=tr(n),o=i.Ua.get(e);if(o&&o.Ba)return Nr().add(o.key);{let l=Nr();const d=i.qa.get(e);if(!d)return l;for(const p of d){const _=i.ka.get(p);l=l.unionWith(_.view.Sa)}return l}}function Jse(n){const e=tr(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=Kse.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=rBe.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=Q5e.bind(null,e),e.La.p_=j5e.bind(null,e.eventManager),e.La.Ja=B5e.bind(null,e.eventManager),e}function iBe(n){const e=tr(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=Z5e.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=eBe.bind(null,e),e}class y1{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=vN(e.databaseInfo.databaseId),this.sharedClientState=this.Za(e),this.persistence=this.Xa(e),await this.persistence.start(),this.localStore=this.eu(e),this.gcScheduler=this.tu(e,this.localStore),this.indexBackfillerScheduler=this.nu(e,this.localStore)}tu(e,i){return null}nu(e,i){return null}eu(e){return c5e(this.persistence,new s5e,e.initialUser,this.serializer)}Xa(e){return new Dse(U4.ri,this.serializer)}Za(e){return new m5e}async terminate(){var e,i;(e=this.gcScheduler)===null||e===void 0||e.stop(),(i=this.indexBackfillerScheduler)===null||i===void 0||i.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}y1.provider={build:()=>new y1};class sBe extends y1{constructor(e){super(),this.cacheSizeBytes=e}tu(e,i){gi(this.persistence.referenceDelegate instanceof g1);const o=this.persistence.referenceDelegate.garbageCollector;return new G3e(o,e.asyncQueue,i)}Xa(e){const i=this.cacheSizeBytes!==void 0?al.withCacheSize(this.cacheSizeBytes):al.DEFAULT;return new Dse(o=>g1.ri(o,i),this.serializer)}}class mF{async initialize(e,i){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(i),this.remoteStore=this.createRemoteStore(i),this.eventManager=this.createEventManager(i),this.syncEngine=this.createSyncEngine(i,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=o=>qJ(this.syncEngine,o,1),this.remoteStore.remoteSyncer.handleCredentialChange=nBe.bind(null,this.syncEngine),await U5e(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return function(){return new F5e}()}createDatastore(e){const i=vN(e.databaseInfo.databaseId),o=function(d){return new v5e(d)}(e.databaseInfo);return function(d,p,_,E){return new w5e(d,p,_,E)}(e.authCredentials,e.appCheckCredentials,o,i)}createRemoteStore(e){return function(o,l,d,p,_){return new R5e(o,l,d,p,_)}(this.localStore,this.datastore,e.asyncQueue,i=>qJ(this.syncEngine,i,0),function(){return WJ.D()?new WJ:new g5e}())}createSyncEngine(e,i){return function(l,d,p,_,E,b,C){const I=new H5e(l,d,p,_,E,b);return C&&(I.ja=!0),I}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,i)}async terminate(){var e,i;await async function(l){const d=tr(l);rn(Qy,"RemoteStore shutting down."),d.W_.add(5),await RR(d),d.z_.shutdown(),d.j_.set("Unknown")}(this.remoteStore),(e=this.datastore)===null||e===void 0||e.terminate(),(i=this.eventManager)===null||i===void 0||i.terminate()}}mF.provider={build:()=>new mF};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Q4{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.iu(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.iu(this.observer.error,e):Xp("Uncaught Error in snapshot listener:",e.toString()))}su(){this.muted=!0}iu(e,i){setTimeout(()=>{this.muted||e(i)},0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jg="FirestoreClient";class oBe{constructor(e,i,o,l,d){this.authCredentials=e,this.appCheckCredentials=i,this.asyncQueue=o,this.databaseInfo=l,this.user=Ja.UNAUTHENTICATED,this.clientId=$ie.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=d,this.authCredentials.start(o,async p=>{rn(jg,"Received user=",p.uid),await this.authCredentialListener(p),this.user=p}),this.appCheckCredentials.start(o,p=>(rn(jg,"Received new app check token=",p),this.appCheckCredentialListener(p,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new jp;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(i){const o=H4(i,"Failed to shutdown persistence");e.reject(o)}}),e.promise}}async function DU(n,e){n.asyncQueue.verifyOperationInProgress(),rn(jg,"Initializing OfflineComponentProvider");const i=n.configuration;await e.initialize(i);let o=i.initialUser;n.setCredentialChangeListener(async l=>{o.isEqual(l)||(await xse(e.localStore,l),o=l)}),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=e}async function XJ(n,e){n.asyncQueue.verifyOperationInProgress();const i=await aBe(n);rn(jg,"Initializing OnlineComponentProvider"),await e.initialize(i,n.configuration),n.setCredentialChangeListener(o=>GJ(e.remoteStore,o)),n.setAppCheckTokenChangeListener((o,l)=>GJ(e.remoteStore,l)),n._onlineComponents=e}async function aBe(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){rn(jg,"Using user provided OfflineComponentProvider");try{await DU(n,n._uninitializedComponentsProvider._offline)}catch(e){const i=e;if(!function(l){return l.name==="FirebaseError"?l.code===bt.FAILED_PRECONDITION||l.code===bt.UNIMPLEMENTED:!(typeof DOMException<"u"&&l instanceof DOMException)||l.code===22||l.code===20||l.code===11}(i))throw i;O0("Error using user provided cache. Falling back to memory cache: "+i),await DU(n,new y1)}}else rn(jg,"Using default OfflineComponentProvider"),await DU(n,new sBe(void 0));return n._offlineComponents}async function Qse(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(rn(jg,"Using user provided OnlineComponentProvider"),await XJ(n,n._uninitializedComponentsProvider._online)):(rn(jg,"Using default OnlineComponentProvider"),await XJ(n,new mF))),n._onlineComponents}function cBe(n){return Qse(n).then(e=>e.syncEngine)}async function E1(n){const e=await Qse(n),i=e.eventManager;return i.onListen=$5e.bind(null,e.syncEngine),i.onUnlisten=Y5e.bind(null,e.syncEngine),i.onFirstRemoteStoreListen=K5e.bind(null,e.syncEngine),i.onLastRemoteStoreUnlisten=X5e.bind(null,e.syncEngine),i}function lBe(n,e,i={}){const o=new jp;return n.asyncQueue.enqueueAndForget(async()=>function(d,p,_,E,b){const C=new Q4({next:O=>{C.su(),p.enqueueAndForget(()=>K4(d,I));const L=O.docs.has(_);!L&&O.fromCache?b.reject(new $t(bt.UNAVAILABLE,"Failed to get document because the client is offline.")):L&&O.fromCache&&E&&E.source==="server"?b.reject(new $t(bt.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):b.resolve(O)},error:O=>b.reject(O)}),I=new Y4(pN(_.path),C,{includeMetadataChanges:!0,Ta:!0});return $4(d,I)}(await E1(n),n.asyncQueue,e,i,o)),o.promise}function uBe(n,e,i={}){const o=new jp;return n.asyncQueue.enqueueAndForget(async()=>function(d,p,_,E,b){const C=new Q4({next:O=>{C.su(),p.enqueueAndForget(()=>K4(d,I)),O.fromCache&&E.source==="server"?b.reject(new $t(bt.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):b.resolve(O)},error:O=>b.reject(O)}),I=new Y4(_,C,{includeMetadataChanges:!0,Ta:!0});return $4(d,I)}(await E1(n),n.asyncQueue,e,i,o)),o.promise}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Zse(n){const e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const JJ=new Map;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function eoe(n,e,i){if(!i)throw new $t(bt.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function dBe(n,e,i,o){if(e===!0&&o===!0)throw new $t(bt.INVALID_ARGUMENT,`${n} and ${i} cannot be used together.`)}function QJ(n){if(!Cn.isDocumentKey(n))throw new $t(bt.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function ZJ(n){if(Cn.isDocumentKey(n))throw new $t(bt.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function TN(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{const e=function(o){return o.constructor?o.constructor.name:null}(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":Kn()}function fl(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new $t(bt.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const i=TN(n);throw new $t(bt.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${i}`)}}return n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const toe="firestore.googleapis.com",eQ=!0;class tQ{constructor(e){var i,o;if(e.host===void 0){if(e.ssl!==void 0)throw new $t(bt.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=toe,this.ssl=eQ}else this.host=e.host,this.ssl=(i=e.ssl)!==null&&i!==void 0?i:eQ;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=Nse;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<W3e)throw new $t(bt.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}dBe("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=Zse((o=e.experimentalLongPollingOptions)!==null&&o!==void 0?o:{}),function(d){if(d.timeoutSeconds!==void 0){if(isNaN(d.timeoutSeconds))throw new $t(bt.INVALID_ARGUMENT,`invalid long polling timeout: ${d.timeoutSeconds} (must not be NaN)`);if(d.timeoutSeconds<5)throw new $t(bt.INVALID_ARGUMENT,`invalid long polling timeout: ${d.timeoutSeconds} (minimum allowed value is 5)`);if(d.timeoutSeconds>30)throw new $t(bt.INVALID_ARGUMENT,`invalid long polling timeout: ${d.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(o,l){return o.timeoutSeconds===l.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class wN{constructor(e,i,o,l){this._authCredentials=e,this._appCheckCredentials=i,this._databaseId=o,this._app=l,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new tQ({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new $t(bt.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new $t(bt.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new tQ(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=function(o){if(!o)return new E4e;switch(o.type){case"firstParty":return new T4e(o.sessionIndex||"0",o.iamToken||null,o.authTokenFactory||null);case"provider":return o.client;default:throw new $t(bt.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(i){const o=JJ.get(i);o&&(rn("ComponentProvider","Removing Datastore"),JJ.delete(i),o.terminate())}(this),Promise.resolve()}}function hBe(n,e,i,o={}){var l;const d=(n=fl(n,wN))._getSettings(),p=Object.assign(Object.assign({},d),{emulatorOptions:n._getEmulatorOptions()}),_=`${e}:${i}`;d.host!==toe&&d.host!==_&&O0("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const E=Object.assign(Object.assign({},d),{host:_,ssl:!1,emulatorOptions:o});if(!Kp(E,p)&&(n._setSettings(E),o.mockUserToken)){let b,C;if(typeof o.mockUserToken=="string")b=o.mockUserToken,C=Ja.MOCK_USER;else{b=Yre(o.mockUserToken,(l=n._app)===null||l===void 0?void 0:l.options.projectId);const I=o.mockUserToken.sub||o.mockUserToken.user_id;if(!I)throw new $t(bt.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");C=new Ja(I)}n._authCredentials=new v4e(new Gie(b,C))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vf{constructor(e,i,o){this.converter=i,this._query=o,this.type="query",this.firestore=e}withConverter(e){return new vf(this.firestore,e,this._query)}}class ec{constructor(e,i,o){this.converter=i,this._key=o,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Og(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new ec(this.firestore,e,this._key)}}class Og extends vf{constructor(e,i,o){super(e,i,pN(o)),this._path=o,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new ec(this.firestore,null,new Cn(e))}withConverter(e){return new Og(this.firestore,e,this._path)}}function Qp(n,e,...i){if(n=qi(n),eoe("collection","path",e),n instanceof wN){const o=Ki.fromString(e,...i);return ZJ(o),new Og(n,null,o)}{if(!(n instanceof ec||n instanceof Og))throw new $t(bt.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const o=n._path.child(Ki.fromString(e,...i));return ZJ(o),new Og(n.firestore,null,o)}}function Vr(n,e,...i){if(n=qi(n),arguments.length===1&&(e=$ie.newId()),eoe("doc","path",e),n instanceof wN){const o=Ki.fromString(e,...i);return QJ(o),new ec(n,null,new Cn(o))}{if(!(n instanceof ec||n instanceof Og))throw new $t(bt.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const o=n._path.child(Ki.fromString(e,...i));return QJ(o),new ec(n.firestore,n instanceof Og?n.converter:null,new Cn(o))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nQ="AsyncQueue";class rQ{constructor(e=Promise.resolve()){this.Vu=[],this.mu=!1,this.fu=[],this.gu=null,this.pu=!1,this.yu=!1,this.wu=[],this.a_=new Mse(this,"async_queue_retry"),this.Su=()=>{const o=NU();o&&rn(nQ,"Visibility state changed to "+o.visibilityState),this.a_.t_()},this.bu=e;const i=NU();i&&typeof i.addEventListener=="function"&&i.addEventListener("visibilitychange",this.Su)}get isShuttingDown(){return this.mu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.Du(),this.vu(e)}enterRestrictedMode(e){if(!this.mu){this.mu=!0,this.yu=e||!1;const i=NU();i&&typeof i.removeEventListener=="function"&&i.removeEventListener("visibilitychange",this.Su)}}enqueue(e){if(this.Du(),this.mu)return new Promise(()=>{});const i=new jp;return this.vu(()=>this.mu&&this.yu?Promise.resolve():(e().then(i.resolve,i.reject),i.promise)).then(()=>i.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Vu.push(e),this.Cu()))}async Cu(){if(this.Vu.length!==0){try{await this.Vu[0](),this.Vu.shift(),this.a_.reset()}catch(e){if(!eb(e))throw e;rn(nQ,"Operation failed with retryable error: "+e)}this.Vu.length>0&&this.a_.Xo(()=>this.Cu())}}vu(e){const i=this.bu.then(()=>(this.pu=!0,e().catch(o=>{this.gu=o,this.pu=!1;const l=function(p){let _=p.message||"";return p.stack&&(_=p.stack.includes(p.message)?p.stack:p.message+`
`+p.stack),_}(o);throw Xp("INTERNAL UNHANDLED ERROR: ",l),o}).then(o=>(this.pu=!1,o))));return this.bu=i,i}enqueueAfterDelay(e,i,o){this.Du(),this.wu.indexOf(e)>-1&&(i=0);const l=G4.createAndSchedule(this,e,i,o,d=>this.Fu(d));return this.fu.push(l),l}Du(){this.gu&&Kn()}verifyOperationInProgress(){}async Mu(){let e;do e=this.bu,await e;while(e!==this.bu)}xu(e){for(const i of this.fu)if(i.timerId===e)return!0;return!1}Ou(e){return this.Mu().then(()=>{this.fu.sort((i,o)=>i.targetTimeMs-o.targetTimeMs);for(const i of this.fu)if(i.skipDelay(),e!=="all"&&i.timerId===e)break;return this.Mu()})}Nu(e){this.wu.push(e)}Fu(e){const i=this.fu.indexOf(e);this.fu.splice(i,1)}}function iQ(n){return function(i,o){if(typeof i!="object"||i===null)return!1;const l=i;for(const d of o)if(d in l&&typeof l[d]=="function")return!0;return!1}(n,["next","error","complete"])}class Zp extends wN{constructor(e,i,o,l){super(e,i,o,l),this.type="firestore",this._queue=new rQ,this._persistenceKey=(l==null?void 0:l.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new rQ(e),this._firestoreClient=void 0,await e}}}function gF(n,e){const i=typeof n=="object"?n:g4(),o=typeof n=="string"?n:l1,l=sN(i,"firestore").getImmediate({identifier:o});if(!l._initialized){const d=$re("firestore");d&&hBe(l,...d)}return l}function CN(n){if(n._terminated)throw new $t(bt.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||fBe(n),n._firestoreClient}function fBe(n){var e,i,o;const l=n._freezeSettings(),d=function(_,E,b,C){return new V4e(_,E,b,C.host,C.ssl,C.experimentalForceLongPolling,C.experimentalAutoDetectLongPolling,Zse(C.experimentalLongPollingOptions),C.useFetchStreams)}(n._databaseId,((e=n._app)===null||e===void 0?void 0:e.options.appId)||"",n._persistenceKey,l);n._componentsProvider||!((i=l.localCache)===null||i===void 0)&&i._offlineComponentProvider&&(!((o=l.localCache)===null||o===void 0)&&o._onlineComponentProvider)&&(n._componentsProvider={_offline:l.localCache._offlineComponentProvider,_online:l.localCache._onlineComponentProvider}),n._firestoreClient=new oBe(n._authCredentials,n._appCheckCredentials,n._queue,d,n._componentsProvider&&function(_){const E=_==null?void 0:_._online.build();return{_offline:_==null?void 0:_._offline.build(E),_online:E}}(n._componentsProvider))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class F0{constructor(e){this._byteString=e}static fromBase64String(e){try{return new F0(Ca.fromBase64String(e))}catch(i){throw new $t(bt.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+i)}}static fromUint8Array(e){return new F0(Ca.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class RN{constructor(...e){for(let i=0;i<e.length;++i)if(e[i].length===0)throw new $t(bt.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new wa(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AR{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Z4{constructor(e,i){if(!isFinite(e)||e<-90||e>90)throw new $t(bt.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(i)||i<-180||i>180)throw new $t(bt.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+i);this._lat=e,this._long=i}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return _r(this._lat,e._lat)||_r(this._long,e._long)}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class e3{constructor(e){this._values=(e||[]).map(i=>i)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(o,l){if(o.length!==l.length)return!1;for(let d=0;d<o.length;++d)if(o[d]!==l[d])return!1;return!0}(this._values,e._values)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pBe=/^__.*__$/;class mBe{constructor(e,i,o){this.data=e,this.fieldMask=i,this.fieldTransforms=o}toMutation(e,i){return this.fieldMask!==null?new Kg(e,this.data,this.fieldMask,i,this.fieldTransforms):new wR(e,this.data,i,this.fieldTransforms)}}class noe{constructor(e,i,o){this.data=e,this.fieldMask=i,this.fieldTransforms=o}toMutation(e,i){return new Kg(e,this.data,this.fieldMask,i,this.fieldTransforms)}}function roe(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Kn()}}class IN{constructor(e,i,o,l,d,p){this.settings=e,this.databaseId=i,this.serializer=o,this.ignoreUndefinedProperties=l,d===void 0&&this.Bu(),this.fieldTransforms=d||[],this.fieldMask=p||[]}get path(){return this.settings.path}get Lu(){return this.settings.Lu}ku(e){return new IN(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}qu(e){var i;const o=(i=this.path)===null||i===void 0?void 0:i.child(e),l=this.ku({path:o,Qu:!1});return l.$u(e),l}Uu(e){var i;const o=(i=this.path)===null||i===void 0?void 0:i.child(e),l=this.ku({path:o,Qu:!1});return l.Bu(),l}Ku(e){return this.ku({path:void 0,Qu:!0})}Wu(e){return v1(e,this.settings.methodName,this.settings.Gu||!1,this.path,this.settings.zu)}contains(e){return this.fieldMask.find(i=>e.isPrefixOf(i))!==void 0||this.fieldTransforms.find(i=>e.isPrefixOf(i.field))!==void 0}Bu(){if(this.path)for(let e=0;e<this.path.length;e++)this.$u(this.path.get(e))}$u(e){if(e.length===0)throw this.Wu("Document fields must not be empty");if(roe(this.Lu)&&pBe.test(e))throw this.Wu('Document fields cannot begin and end with "__"')}}class gBe{constructor(e,i,o){this.databaseId=e,this.ignoreUndefinedProperties=i,this.serializer=o||vN(e)}ju(e,i,o,l=!1){return new IN({Lu:e,methodName:i,zu:o,path:wa.emptyPath(),Qu:!1,Gu:l},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function PR(n){const e=n._freezeSettings(),i=vN(n._databaseId);return new gBe(n._databaseId,!!e.ignoreUndefinedProperties,i)}function ioe(n,e,i,o,l,d={}){const p=n.ju(d.merge||d.mergeFields?2:0,e,i,l);r3("Data must be an object, but it was:",p,o);const _=aoe(o,p);let E,b;if(d.merge)E=new jl(p.fieldMask),b=p.fieldTransforms;else if(d.mergeFields){const C=[];for(const I of d.mergeFields){const O=_F(e,I,i);if(!p.contains(O))throw new $t(bt.INVALID_ARGUMENT,`Field '${O}' is specified in your field mask but missing from your input data.`);loe(C,O)||C.push(O)}E=new jl(C),b=p.fieldTransforms.filter(I=>E.covers(I.field))}else E=null,b=p.fieldTransforms;return new mBe(new ll(_),E,b)}class AN extends AR{_toFieldTransform(e){if(e.Lu!==2)throw e.Lu===1?e.Wu(`${this._methodName}() can only appear at the top level of your update data`):e.Wu(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof AN}}function soe(n,e,i){return new IN({Lu:3,zu:e.settings.zu,methodName:n._methodName,Qu:i},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}class t3 extends AR{constructor(e,i){super(e),this.Hu=i}_toFieldTransform(e){const i=soe(this,e,!0),o=this.Hu.map(d=>cE(d,i)),l=new L0(o);return new Ese(e.path,l)}isEqual(e){return e instanceof t3&&Kp(this.Hu,e.Hu)}}class n3 extends AR{constructor(e,i){super(e),this.Hu=i}_toFieldTransform(e){const i=soe(this,e,!0),o=this.Hu.map(d=>cE(d,i)),l=new M0(o);return new Ese(e.path,l)}isEqual(e){return e instanceof n3&&Kp(this.Hu,e.Hu)}}function _Be(n,e,i,o){const l=n.ju(1,e,i);r3("Data must be an object, but it was:",l,o);const d=[],p=ll.empty();$g(o,(E,b)=>{const C=i3(e,E,i);b=qi(b);const I=l.Uu(C);if(b instanceof AN)d.push(C);else{const O=cE(b,I);O!=null&&(d.push(C),p.set(C,O))}});const _=new jl(d);return new noe(p,_,l.fieldTransforms)}function yBe(n,e,i,o,l,d){const p=n.ju(1,e,i),_=[_F(e,o,i)],E=[l];if(d.length%2!=0)throw new $t(bt.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let O=0;O<d.length;O+=2)_.push(_F(e,d[O])),E.push(d[O+1]);const b=[],C=ll.empty();for(let O=_.length-1;O>=0;--O)if(!loe(b,_[O])){const L=_[O];let U=E[O];U=qi(U);const B=p.Uu(L);if(U instanceof AN)b.push(L);else{const W=cE(U,B);W!=null&&(b.push(L),C.set(L,W))}}const I=new jl(b);return new noe(C,I,p.fieldTransforms)}function ooe(n,e,i,o=!1){return cE(i,n.ju(o?4:3,e))}function cE(n,e){if(coe(n=qi(n)))return r3("Unsupported field value:",e,n),aoe(n,e);if(n instanceof AR)return function(o,l){if(!roe(l.Lu))throw l.Wu(`${o._methodName}() can only be used with update() and set()`);if(!l.path)throw l.Wu(`${o._methodName}() is not currently supported inside arrays`);const d=o._toFieldTransform(l);d&&l.fieldTransforms.push(d)}(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.Qu&&e.Lu!==4)throw e.Wu("Nested arrays are not supported");return function(o,l){const d=[];let p=0;for(const _ of o){let E=cE(_,l.Ku(p));E==null&&(E={nullValue:"NULL_VALUE"}),d.push(E),p++}return{arrayValue:{values:d}}}(n,e)}return function(o,l){if((o=qi(o))===null)return{nullValue:"NULL_VALUE"};if(typeof o=="number")return a3e(l.serializer,o);if(typeof o=="boolean")return{booleanValue:o};if(typeof o=="string")return{stringValue:o};if(o instanceof Date){const d=wo.fromDate(o);return{timestampValue:m1(l.serializer,d)}}if(o instanceof wo){const d=new wo(o.seconds,1e3*Math.floor(o.nanoseconds/1e3));return{timestampValue:m1(l.serializer,d)}}if(o instanceof Z4)return{geoPointValue:{latitude:o.latitude,longitude:o.longitude}};if(o instanceof F0)return{bytesValue:Cse(l.serializer,o._byteString)};if(o instanceof ec){const d=l.databaseId,p=o.firestore._databaseId;if(!p.isEqual(d))throw l.Wu(`Document reference is for database ${p.projectId}/${p.database} but should be for database ${d.projectId}/${d.database}`);return{referenceValue:L4(o.firestore._databaseId||l.databaseId,o._key.path)}}if(o instanceof e3)return function(p,_){return{mapValue:{fields:{[ese]:{stringValue:tse},[u1]:{arrayValue:{values:p.toArray().map(b=>{if(typeof b!="number")throw _.Wu("VectorValues must only contain numeric values.");return k4(_.serializer,b)})}}}}}}(o,l);throw l.Wu(`Unsupported field value: ${TN(o)}`)}(n,e)}function aoe(n,e){const i={};return qie(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):$g(n,(o,l)=>{const d=cE(l,e.qu(o));d!=null&&(i[o]=d)}),{mapValue:{fields:i}}}function coe(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof wo||n instanceof Z4||n instanceof F0||n instanceof ec||n instanceof AR||n instanceof e3)}function r3(n,e,i){if(!coe(i)||!function(l){return typeof l=="object"&&l!==null&&(Object.getPrototypeOf(l)===Object.prototype||Object.getPrototypeOf(l)===null)}(i)){const o=TN(i);throw o==="an object"?e.Wu(n+" a custom object"):e.Wu(n+" "+o)}}function _F(n,e,i){if((e=qi(e))instanceof RN)return e._internalPath;if(typeof e=="string")return i3(n,e);throw v1("Field path arguments must be of type string or ",n,!1,void 0,i)}const EBe=new RegExp("[~\\*/\\[\\]]");function i3(n,e,i){if(e.search(EBe)>=0)throw v1(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,i);try{return new RN(...e.split("."))._internalPath}catch{throw v1(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,i)}}function v1(n,e,i,o,l){const d=o&&!o.isEmpty(),p=l!==void 0;let _=`Function ${e}() called with invalid data`;i&&(_+=" (via `toFirestore()`)"),_+=". ";let E="";return(d||p)&&(E+=" (found",d&&(E+=` in field ${o}`),p&&(E+=` in document ${l}`),E+=")"),new $t(bt.INVALID_ARGUMENT,_+n+E)}function loe(n,e){return n.some(i=>i.isEqual(e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class s3{constructor(e,i,o,l,d){this._firestore=e,this._userDataWriter=i,this._key=o,this._document=l,this._converter=d}get id(){return this._key.path.lastSegment()}get ref(){return new ec(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new vBe(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const i=this._document.data.field(PN("DocumentSnapshot.get",e));if(i!==null)return this._userDataWriter.convertValue(i)}}}class vBe extends s3{data(){return super.data()}}function PN(n,e){return typeof e=="string"?i3(n,e):e instanceof RN?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function uoe(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new $t(bt.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class o3{}class ON extends o3{}function S1(n,e,...i){let o=[];e instanceof o3&&o.push(e),o=o.concat(i),function(d){const p=d.filter(E=>E instanceof a3).length,_=d.filter(E=>E instanceof kN).length;if(p>1||p>0&&_>0)throw new $t(bt.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(o);for(const l of o)n=l._apply(n);return n}class kN extends ON{constructor(e,i,o){super(),this._field=e,this._op=i,this._value=o,this.type="where"}static _create(e,i,o){return new kN(e,i,o)}_apply(e){const i=this._parse(e);return doe(e._query,i),new vf(e.firestore,e.converter,oF(e._query,i))}_parse(e){const i=PR(e.firestore);return function(d,p,_,E,b,C,I){let O;if(b.isKeyField()){if(C==="array-contains"||C==="array-contains-any")throw new $t(bt.INVALID_ARGUMENT,`Invalid Query. You can't perform '${C}' queries on documentId().`);if(C==="in"||C==="not-in"){aQ(I,C);const U=[];for(const B of I)U.push(oQ(E,d,B));O={arrayValue:{values:U}}}else O=oQ(E,d,I)}else C!=="in"&&C!=="not-in"&&C!=="array-contains-any"||aQ(I,C),O=ooe(_,p,I,C==="in"||C==="not-in");return so.create(b,C,O)}(e._query,"where",i,e.firestore._databaseId,this._field,this._op,this._value)}}function sQ(n,e,i){const o=e,l=PN("where",n);return kN._create(l,o,i)}class a3 extends o3{constructor(e,i){super(),this.type=e,this._queryConstraints=i}static _create(e,i){return new a3(e,i)}_parse(e){const i=this._queryConstraints.map(o=>o._parse(e)).filter(o=>o.getFilters().length>0);return i.length===1?i[0]:Wd.create(i,this._getOperator())}_apply(e){const i=this._parse(e);return i.getFilters().length===0?e:(function(l,d){let p=l;const _=d.getFlattenedFilters();for(const E of _)doe(p,E),p=oF(p,E)}(e._query,i),new vf(e.firestore,e.converter,oF(e._query,i)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}class c3 extends ON{constructor(e,i){super(),this._field=e,this._direction=i,this.type="orderBy"}static _create(e,i){return new c3(e,i)}_apply(e){const i=function(l,d,p){if(l.startAt!==null)throw new $t(bt.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(l.endAt!==null)throw new $t(bt.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new JC(d,p)}(e._query,this._field,this._direction);return new vf(e.firestore,e.converter,function(l,d){const p=l.explicitOrderBy.concat([d]);return new sE(l.path,l.collectionGroup,p,l.filters.slice(),l.limit,l.limitType,l.startAt,l.endAt)}(e._query,i))}}function SBe(n,e="asc"){const i=e,o=PN("orderBy",n);return c3._create(o,i)}class l3 extends ON{constructor(e,i,o){super(),this.type=e,this._limit=i,this._limitType=o}static _create(e,i,o){return new l3(e,i,o)}_apply(e){return new vf(e.firestore,e.converter,h1(e._query,this._limit,this._limitType))}}function bBe(n){return l3._create("limit",n,"F")}class u3 extends ON{constructor(e,i,o){super(),this.type=e,this._docOrFields=i,this._inclusive=o}static _create(e,i,o){return new u3(e,i,o)}_apply(e){const i=wBe(e,this.type,this._docOrFields,this._inclusive);return new vf(e.firestore,e.converter,function(l,d){return new sE(l.path,l.collectionGroup,l.explicitOrderBy.slice(),l.filters.slice(),l.limit,l.limitType,d,l.endAt)}(e._query,i))}}function TBe(...n){return u3._create("startAt",n,!0)}function wBe(n,e,i,o){if(i[0]=qi(i[0]),i[0]instanceof s3)return function(d,p,_,E,b){if(!E)throw new $t(bt.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${_}().`);const C=[];for(const I of f0(d))if(I.field.isKeyField())C.push(d1(p,E.key));else{const O=E.data.field(I.field);if(hN(O))throw new $t(bt.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+I.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(O===null){const L=I.field.canonicalString();throw new $t(bt.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${L}' (used as the orderBy) does not exist.`)}C.push(O)}return new x0(C,b)}(n._query,n.firestore._databaseId,e,i[0]._document,o);{const l=PR(n.firestore);return function(p,_,E,b,C,I){const O=p.explicitOrderBy;if(C.length>O.length)throw new $t(bt.INVALID_ARGUMENT,`Too many arguments provided to ${b}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const L=[];for(let U=0;U<C.length;U++){const B=C[U];if(O[U].field.isKeyField()){if(typeof B!="string")throw new $t(bt.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${b}(), but got a ${typeof B}`);if(!O4(p)&&B.indexOf("/")!==-1)throw new $t(bt.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${b}() must be a plain document ID, but '${B}' contains a slash.`);const W=p.path.child(Ki.fromString(B));if(!Cn.isDocumentKey(W))throw new $t(bt.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${b}() must result in a valid document path, but '${W}' is not because it contains an odd number of segments.`);const J=new Cn(W);L.push(d1(_,J))}else{const W=ooe(E,b,B);L.push(W)}}return new x0(L,I)}(n._query,n.firestore._databaseId,l,e,i,o)}}function oQ(n,e,i){if(typeof(i=qi(i))=="string"){if(i==="")throw new $t(bt.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!O4(e)&&i.indexOf("/")!==-1)throw new $t(bt.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${i}' contains a '/' character.`);const o=e.path.child(Ki.fromString(i));if(!Cn.isDocumentKey(o))throw new $t(bt.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${o}' is not because it has an odd number of segments (${o.length}).`);return d1(n,new Cn(o))}if(i instanceof ec)return d1(n,i._key);throw new $t(bt.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${TN(i)}.`)}function aQ(n,e){if(!Array.isArray(n)||n.length===0)throw new $t(bt.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function doe(n,e){const i=function(l,d){for(const p of l)for(const _ of p.getFlattenedFilters())if(d.indexOf(_.op)>=0)return _.op;return null}(n.filters,function(l){switch(l){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(i!==null)throw i===e.op?new $t(bt.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new $t(bt.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${i.toString()}' filters.`)}class CBe{convertValue(e,i="none"){switch(Vg(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Hs(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,i);case 5:return e.stringValue;case 6:return this.convertBytes(Ug(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,i);case 11:return this.convertObject(e.mapValue,i);case 10:return this.convertVectorValue(e.mapValue);default:throw Kn()}}convertObject(e,i){return this.convertObjectMap(e.fields,i)}convertObjectMap(e,i="none"){const o={};return $g(e,(l,d)=>{o[l]=this.convertValue(d,i)}),o}convertVectorValue(e){var i,o,l;const d=(l=(o=(i=e.fields)===null||i===void 0?void 0:i[u1].arrayValue)===null||o===void 0?void 0:o.values)===null||l===void 0?void 0:l.map(p=>Hs(p.doubleValue));return new e3(d)}convertGeoPoint(e){return new Z4(Hs(e.latitude),Hs(e.longitude))}convertArray(e,i){return(e.values||[]).map(o=>this.convertValue(o,i))}convertServerTimestamp(e,i){switch(i){case"previous":const o=fN(e);return o==null?null:this.convertValue(o,i);case"estimate":return this.convertTimestamp(qC(e));default:return null}}convertTimestamp(e){const i=Mg(e);return new wo(i.seconds,i.nanos)}convertDocumentKey(e,i){const o=Ki.fromString(e);gi(kse(o));const l=new YC(o.get(1),o.get(3)),d=new Cn(o.popFirst(5));return l.isEqual(i)||Xp(`Document ${d} contains a document reference within a different database (${l.projectId}/${l.database}) which is not supported. It will be treated as a reference in the current database (${i.projectId}/${i.database}) instead.`),d}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hoe(n,e,i){let o;return o=n?i&&(i.merge||i.mergeFields)?n.toFirestore(e,i):n.toFirestore(e):e,o}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nC{constructor(e,i){this.hasPendingWrites=e,this.fromCache=i}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class foe extends s3{constructor(e,i,o,l,d,p){super(e,i,o,l,p),this._firestore=e,this._firestoreImpl=e,this.metadata=d}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const i=new Nk(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(i,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,i={}){if(this._document){const o=this._document.data.field(PN("DocumentSnapshot.get",e));if(o!==null)return this._userDataWriter.convertValue(o,i.serverTimestamps)}}}class Nk extends foe{data(e={}){return super.data(e)}}class poe{constructor(e,i,o,l){this._firestore=e,this._userDataWriter=i,this._snapshot=l,this.metadata=new nC(l.hasPendingWrites,l.fromCache),this.query=o}get docs(){const e=[];return this.forEach(i=>e.push(i)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,i){this._snapshot.docs.forEach(o=>{e.call(i,new Nk(this._firestore,this._userDataWriter,o.key,o,new nC(this._snapshot.mutatedKeys.has(o.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const i=!!e.includeMetadataChanges;if(i&&this._snapshot.excludesMetadataChanges)throw new $t(bt.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===i||(this._cachedChanges=function(l,d){if(l._snapshot.oldDocs.isEmpty()){let p=0;return l._snapshot.docChanges.map(_=>{const E=new Nk(l._firestore,l._userDataWriter,_.doc.key,_.doc,new nC(l._snapshot.mutatedKeys.has(_.doc.key),l._snapshot.fromCache),l.query.converter);return _.doc,{type:"added",doc:E,oldIndex:-1,newIndex:p++}})}{let p=l._snapshot.oldDocs;return l._snapshot.docChanges.filter(_=>d||_.type!==3).map(_=>{const E=new Nk(l._firestore,l._userDataWriter,_.doc.key,_.doc,new nC(l._snapshot.mutatedKeys.has(_.doc.key),l._snapshot.fromCache),l.query.converter);let b=-1,C=-1;return _.type!==0&&(b=p.indexOf(_.doc.key),p=p.delete(_.doc.key)),_.type!==1&&(p=p.add(_.doc),C=p.indexOf(_.doc.key)),{type:RBe(_.type),doc:E,oldIndex:b,newIndex:C}})}}(this,i),this._cachedChangesIncludeMetadataChanges=i),this._cachedChanges}}function RBe(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Kn()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $o(n){n=fl(n,ec);const e=fl(n.firestore,Zp);return lBe(CN(e),n._key).then(i=>goe(e,n,i))}class d3 extends CBe{constructor(e){super(),this.firestore=e}convertBytes(e){return new F0(e)}convertReference(e){const i=this.convertDocumentKey(e,this.firestore._databaseId);return new ec(this.firestore,null,i)}}function Zy(n){n=fl(n,vf);const e=fl(n.firestore,Zp),i=CN(e),o=new d3(e);return uoe(n._query),uBe(i,n._query).then(l=>new poe(e,o,n,l))}function j0(n,e,i){n=fl(n,ec);const o=fl(n.firestore,Zp),l=hoe(n.converter,e,i);return NN(o,[ioe(PR(o),"setDoc",n._key,l,n.converter!==null,i).toMutation(n._key,Bu.none())])}function Ys(n,e,i,...o){n=fl(n,ec);const l=fl(n.firestore,Zp),d=PR(l);let p;return p=typeof(e=qi(e))=="string"||e instanceof RN?yBe(d,"updateDoc",n._key,e,i,o):_Be(d,"updateDoc",n._key,e),NN(l,[p.toMutation(n._key,Bu.exists(!0))])}function IBe(n){return NN(fl(n.firestore,Zp),[new N4(n._key,Bu.none())])}function ABe(n,e){const i=fl(n.firestore,Zp),o=Vr(n),l=hoe(n.converter,e);return NN(i,[ioe(PR(n.firestore),"addDoc",o._key,l,n.converter!==null,{}).toMutation(o._key,Bu.exists(!1))]).then(()=>o)}function moe(n,...e){var i,o,l;n=qi(n);let d={includeMetadataChanges:!1,source:"default"},p=0;typeof e[p]!="object"||iQ(e[p])||(d=e[p],p++);const _={includeMetadataChanges:d.includeMetadataChanges,source:d.source};if(iQ(e[p])){const I=e[p];e[p]=(i=I.next)===null||i===void 0?void 0:i.bind(I),e[p+1]=(o=I.error)===null||o===void 0?void 0:o.bind(I),e[p+2]=(l=I.complete)===null||l===void 0?void 0:l.bind(I)}let E,b,C;if(n instanceof ec)b=fl(n.firestore,Zp),C=pN(n._key.path),E={next:I=>{e[p]&&e[p](goe(b,n,I))},error:e[p+1],complete:e[p+2]};else{const I=fl(n,vf);b=fl(I.firestore,Zp),C=I._query;const O=new d3(b);E={next:L=>{e[p]&&e[p](new poe(b,O,I,L))},error:e[p+1],complete:e[p+2]},uoe(n._query)}return function(O,L,U,B){const W=new Q4(B),J=new Y4(L,W,U);return O.asyncQueue.enqueueAndForget(async()=>$4(await E1(O),J)),()=>{W.su(),O.asyncQueue.enqueueAndForget(async()=>K4(await E1(O),J))}}(CN(b),C,_,E)}function NN(n,e){return function(o,l){const d=new jp;return o.asyncQueue.enqueueAndForget(async()=>J5e(await cBe(o),l,d)),d.promise}(CN(n),e)}function goe(n,e,i){const o=i.docs.get(e._key),l=new d3(n);return new foe(n,l,e._key,o,new nC(i.hasPendingWrites,i.fromCache),e.converter)}function PBe(...n){return new t3("arrayUnion",n)}function OBe(...n){return new n3("arrayRemove",n)}(function(e,i=!0){(function(l){Q0=l})(iE),qy(new xg("firestore",(o,{instanceIdentifier:l,options:d})=>{const p=o.getProvider("app").getImmediate(),_=new Zp(new S4e(o.getProvider("auth-internal")),new w4e(p,o.getProvider("app-check-internal")),function(b,C){if(!Object.prototype.hasOwnProperty.apply(b.options,["projectId"]))throw new $t(bt.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new YC(b.options.projectId,C)}(p,l),p);return d=Object.assign({useFetchStreams:i},d),_._setSettings(d),_},"PUBLIC").setMultipleInstances(!0)),lf(lJ,uJ,e),lf(lJ,uJ,"esm2017")})();var kBe="firebase",NBe="11.5.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */lf(kBe,NBe,"app");const DBe=[{key:"VITE_FIREBASE_API_KEY",value:void 0},{key:"VITE_FIREBASE_AUTH_DOMAIN",value:void 0},{key:"VITE_FIREBASE_PROJECT_ID",value:void 0},{key:"VITE_FIREBASE_STORAGE_BUCKET",value:void 0},{key:"VITE_FIREBASE_MESSAGING_SENDER_ID",value:void 0},{key:"VITE_FIREBASE_APP_ID",value:void 0}],yF=DBe.filter(n=>!n.value);if(yF.length>0){const e=`Missing environment variables: ${yF.map(i=>i.key).join(", ")}. Using fallback values. For production, it's recommended to set up your .env file.`;q.warn(e),console.warn(e)}const xBe={apiKey:"AIzaSyCaxoNKRIMaXhotGzdAjXc5gkARoqtS3bU",authDomain:"disruptive-metaverse.firebaseapp.com",projectId:"disruptive-metaverse",storageBucket:"disruptive-metaverse.appspot.com",messagingSenderId:"294433070603",appId:"1:294433070603:web:136cddd196eea9614fb10e"},LBe=yF.length>0;q.log(`Firebase initializing with ${LBe?"fallback":"environment"} configuration`);let xU,h3,dr;try{xU=Qre(xBe),h3=lN(xU),dr=gF(xU),q.log("Firebase initialized successfully")}catch(n){q.error("Failed to initialize Firebase:",n),console.error("Failed to initialize Firebase:",n)}const Vu=n=>!0,cQ=(n,e)=>{const o=(n+e.charAt(0)).toLowerCase().replace(/[^a-z0-9]/g,"").substring(0,11),l=Math.floor(1e3+Math.random()*9e3);return o+l},QC=async n=>{try{if(!n||typeof n!="string"||n.trim()==="")return q.error("userFirestore: Invalid username provided to isUsernameTaken"),!0;const e=n.toLowerCase().trim();q.log(`userFirestore: Checking if username "${e}" is taken`);const i=Qp(dr,"users"),o=S1(i,bBe(100)),l=await Zy(o);let d=!1;return l.forEach(p=>{const _=p.data();_.username&&_.username.toLowerCase()===e&&(d=!0)}),q.log(`userFirestore: Username "${e}" is ${d?"taken":"available"}`),d}catch(e){return q.error("userFirestore: Error checking username availability:",e),!0}},MBe=async(n,e)=>{let i=cQ(n,e),o=0;const l=10;for(;o<l;){if(!await QC(i))return i;i=cQ(n,e),o++}return i+Math.floor(Math.random()*100)},Hu=async n=>{try{q.log("userFirestore: Get user PUBLIC profile data for user ID: "+n);const e=Vr(dr,"users",n),i=await $o(e);if(i.exists()){const o=i.data();return q.log("userFirestore: Found PUBLIC Profile for : "+o.Nickname),delete o.email,delete o.emailVerified,o}else return q.error("userFirestore: user profile document not found"),null}catch(e){throw q.error("userFirestore: Error fetching user public profile data:",e),e}},UBe=async(n,e,i)=>{try{if(q.log("userFirestore: Starting registerUser process"),q.log("userFirestore: Fields in additionalData:",Object.keys(i||{}).join(", ")),!i)throw q.error("userFirestore: additionalData is null or undefined"),new Error("Registration data is missing");const o={firstName:i.firstName||"",lastName:i.lastName||"",companyName:i.companyName||"",linkedInProfile:i.linkedInProfile||"",username:i.username||"",Nickname:i.Nickname||"",rpmURL:i.rpmURL||"https://models.readyplayer.me/67c8408d38f7924e15a8bd0a.glb"};q.log("userFirestore: Critical fields captured for registration"),q.log("userFirestore: Creating user auth record");const d=(await nje(h3,n,e)).user;await Iie(d),q.log("userFirestore: Verification email sent"),q.log("userFirestore: Waiting for Cloud Function to create initial document..."),await new Promise(L=>setTimeout(L,5e3));const p=Vr(dr,"users",d.uid),_=await $o(p);if(_.exists()){q.log("userFirestore: Found document created by Cloud Function, updating with missing fields");const L=_.data(),U={};L.firstName||(U.firstName=o.firstName),L.lastName||(U.lastName=o.lastName),L.Nickname||(U.Nickname=o.Nickname),L.username||(U.username=o.username),L.companyName||(U.companyName=o.companyName),L.linkedInProfile||(U.linkedInProfile=o.linkedInProfile),L.rpmURL||(U.rpmURL=o.rpmURL),Object.keys(U).length>0&&(q.log("userFirestore: Updating document with fields:",Object.keys(U).join(", ")),await Ys(p,{...U,lastUpdated:new Date}))}else{q.error("userFirestore: Cloud Function failed to create user document, creating manually"),await j0(p,{...o,id:d.uid,groups:["users"],createdAt:new Date,lastUpdated:new Date});const L=Vr(dr,"users",d.uid,"private","data");await j0(L,{email:d.email,emailVerified:!1})}const E=await $o(p);if(!E.exists())throw new Error("User document does not exist even after creation attempts");let b=E.data();b.firstName||(b.firstName=o.firstName),b.lastName||(b.lastName=o.lastName),b.Nickname||(b.Nickname=o.Nickname),b.username||(b.username=o.username),b.companyName||(b.companyName=o.companyName);let C=!1,I={};for(const L in o)(!b[L]||b[L]==="")&&(I[L]=o[L],C=!0);(!b.groups||!b.groups.includes("users"))&&(I.groups=b.groups?[...b.groups,"users"]:["users"],C=!0,q.log("userFirestore: Adding user to users group")),C&&(q.log("userFirestore: Updating user document with missing fields"),q.log("userFirestore: Fields being updated:",Object.keys(I).join(", ")),await Ys(p,I),b=(await $o(p)).data());const O={...d,...b,firstName:o.firstName,lastName:o.lastName,Nickname:o.Nickname,username:o.username,companyName:o.companyName,linkedInProfile:o.linkedInProfile};return q.log("userFirestore: Registration complete, returning user data"),q.log("userFirestore: Fields included in return data:",Object.keys(O).join(", ")),O}catch(o){throw q.error("userFirestore: Error creating user:",o),o}},_oe=async(n,e)=>{try{q.log(`userFirestore: Updating rpmURL for user ID: ${n}`);const i=Vr(dr,"users",n);await Ys(i,{rpmURL:e,lastUpdated:new Date().toISOString()}),q.log("userFirestore: rpmURL updated successfully.")}catch(i){throw q.error("userFirestore: Error updating rpmURL:",i),i}},VBe=async(n,e)=>{try{const i=await Hu(n);return i&&i.groups?i.groups.includes(e):!1}catch(i){return q.error("userFirestore: Error checking group membership:",i),!1}},FBe=async(n,e)=>{try{if(Vu(e),await QC(e))throw new Error("Username is already taken");const o=Vr(dr,"users",n);return await Ys(o,{username:e,lastUpdated:new Date}),q.log(`userFirestore: Username updated for user ${n}`),!0}catch(i){throw q.error("userFirestore: Error updating username:",i),i}};var jBe={};const b1=()=>{const n=typeof process<"u"&&jBe&&!1;return typeof window<"u"&&new URLSearchParams(window.location.search).has("dev_mode"),n},BBe=(n,e)=>{if(!b1())return q.warn(" SECURITY WARNING: Permission override attempted outside of development environment"),!1},WBe=(n,e)=>{if(!b1())return q.warn(" SECURITY WARNING: Permission override attempted outside of development environment"),!1},f3=typeof b1=="function"?b1():!1;f3&&q.warn(" SECURITY WARNING: Permission overrides are ENABLED. This should only happen in development.");const zBe=async(n,e)=>{if(f3)return BBe();if(!n||!n.uid)return!1;try{if(n.groups){const l=`space_${e}_owners`;if(n.groups.includes(l))return console.log(`User ${n.uid} is an owner via groups property`),!0}const o=lN().currentUser;if(o&&o.uid===n.uid)try{const d=(await o.getIdTokenResult(!0)).claims.groups||[],p=`space_${e}_owners`;if(d.includes(p))return console.log(`User ${n.uid} is an owner via Firebase token claims`),!0}catch(l){console.error("Error getting token result:",l)}return!1}catch(i){return q.error("Error checking space owner permissions:",i),!1}},p3=async(n,e)=>{if(f3)return WBe();try{if(q.log(`userPermissions: Checking if user ${n} belongs to group ${e}`),e==="users")return q.log(`userPermissions: TESTING MODE - Always allowing access to 'users' group for user ${n}`),!0;if(n){const i=await Hu(n);if(q.log(`userPermissions: User profile for ${n}:`,i),i&&i.groups&&Array.isArray(i.groups)){if(q.log(`userPermissions: User ${n} has groups:`,i.groups),i.groups.includes(e))return q.log(`userPermissions: User ${n} belongs to group ${e} (from user document)`),!0}else q.log(`userPermissions: User ${n} has no groups or groups is not an array`);if(e==="disruptiveAdmin")try{const l=lN().currentUser;if(l&&l.uid===n){const d=await l.getIdTokenResult();if(q.log(`userPermissions: Token claims for ${n}:`,d.claims),d.claims&&d.claims.groups&&Array.isArray(d.claims.groups)&&d.claims.groups.includes(e))return q.log(`userPermissions: User ${n} belongs to group ${e} (from token claims)`),!0}}catch(o){q.error("userPermissions: Error checking token claims:",o)}}return q.log(`userPermissions: User ${n} does not belong to group ${e}`),!1}catch(i){return q.error("userPermissions: Error checking if user belongs to group:",i),!1}},GBe=["email","name","rpmURL","Nickname","username","created_on","height_cm","companyName","firstName","lastName","linkedInProfile","groups"],Fd={sendUserToUnity:"sendUserToUnity"};class HBe{constructor(){this.events={}}subscribe(e,i){this.events[e]||(this.events[e]=[]),this.events[e].push(i)}publish(e,i){const o=this.events[e];o?(o.forEach(l=>{l(i)}),q.log(`EventBus: Published event '${e}'`)):q.log(`EventBus: No subscribers for event '${e}'`)}unsubscribe(e,i){var l;const o=(l=this.events[e])==null?void 0:l.indexOf(i);o>-1&&this.events[e].splice(o,1)}}const jd=new HBe;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yoe="firebasestorage.googleapis.com",Eoe="storageBucket",$Be=2*60*1e3,KBe=10*60*1e3;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Us extends Ef{constructor(e,i,o=0){super(LU(e),`Firebase Storage: ${i} (${LU(e)})`),this.status_=o,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,Us.prototype)}get status(){return this.status_}set status(e){this.status_=e}_codeEquals(e){return LU(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message=`${this._baseMessage}
${this.customData.serverResponse}`:this.message=this._baseMessage}}var Ms;(function(n){n.UNKNOWN="unknown",n.OBJECT_NOT_FOUND="object-not-found",n.BUCKET_NOT_FOUND="bucket-not-found",n.PROJECT_NOT_FOUND="project-not-found",n.QUOTA_EXCEEDED="quota-exceeded",n.UNAUTHENTICATED="unauthenticated",n.UNAUTHORIZED="unauthorized",n.UNAUTHORIZED_APP="unauthorized-app",n.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",n.INVALID_CHECKSUM="invalid-checksum",n.CANCELED="canceled",n.INVALID_EVENT_NAME="invalid-event-name",n.INVALID_URL="invalid-url",n.INVALID_DEFAULT_BUCKET="invalid-default-bucket",n.NO_DEFAULT_BUCKET="no-default-bucket",n.CANNOT_SLICE_BLOB="cannot-slice-blob",n.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",n.NO_DOWNLOAD_URL="no-download-url",n.INVALID_ARGUMENT="invalid-argument",n.INVALID_ARGUMENT_COUNT="invalid-argument-count",n.APP_DELETED="app-deleted",n.INVALID_ROOT_OPERATION="invalid-root-operation",n.INVALID_FORMAT="invalid-format",n.INTERNAL_ERROR="internal-error",n.UNSUPPORTED_ENVIRONMENT="unsupported-environment"})(Ms||(Ms={}));function LU(n){return"storage/"+n}function m3(){const n="An unknown error occurred, please check the error payload for server response.";return new Us(Ms.UNKNOWN,n)}function qBe(n){return new Us(Ms.OBJECT_NOT_FOUND,"Object '"+n+"' does not exist.")}function YBe(n){return new Us(Ms.QUOTA_EXCEEDED,"Quota for bucket '"+n+"' exceeded, please view quota on https://firebase.google.com/pricing/.")}function XBe(){const n="User is not authenticated, please authenticate using Firebase Authentication and try again.";return new Us(Ms.UNAUTHENTICATED,n)}function JBe(){return new Us(Ms.UNAUTHORIZED_APP,"This app does not have permission to access Firebase Storage on this project.")}function QBe(n){return new Us(Ms.UNAUTHORIZED,"User does not have permission to access '"+n+"'.")}function ZBe(){return new Us(Ms.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function e6e(){return new Us(Ms.CANCELED,"User canceled the upload/download.")}function t6e(n){return new Us(Ms.INVALID_URL,"Invalid URL '"+n+"'.")}function n6e(n){return new Us(Ms.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+n+"'.")}function r6e(){return new Us(Ms.NO_DEFAULT_BUCKET,"No default bucket found. Did you set the '"+Eoe+"' property when initializing the app?")}function i6e(){return new Us(Ms.CANNOT_SLICE_BLOB,"Cannot slice blob for upload. Please retry the upload.")}function s6e(){return new Us(Ms.NO_DOWNLOAD_URL,"The given file does not have any download URLs.")}function o6e(n){return new Us(Ms.UNSUPPORTED_ENVIRONMENT,`${n} is missing. Make sure to install the required polyfills. See https://firebase.google.com/docs/web/environments-js-sdk#polyfills for more information.`)}function EF(n){return new Us(Ms.INVALID_ARGUMENT,n)}function voe(){return new Us(Ms.APP_DELETED,"The Firebase app was deleted.")}function a6e(n){return new Us(Ms.INVALID_ROOT_OPERATION,"The operation '"+n+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}function SC(n,e){return new Us(Ms.INVALID_FORMAT,"String does not match format '"+n+"': "+e)}function Rw(n){throw new Us(Ms.INTERNAL_ERROR,"Internal error: "+n)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bl{constructor(e,i){this.bucket=e,this.path_=i}get path(){return this.path_}get isRoot(){return this.path.length===0}fullServerUrl(){const e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(e,i){let o;try{o=Bl.makeFromUrl(e,i)}catch{return new Bl(e,"")}if(o.path==="")return o;throw n6e(e)}static makeFromUrl(e,i){let o=null;const l="([A-Za-z0-9.\\-_]+)";function d(ce){ce.path.charAt(ce.path.length-1)==="/"&&(ce.path_=ce.path_.slice(0,-1))}const p="(/(.*))?$",_=new RegExp("^gs://"+l+p,"i"),E={bucket:1,path:3};function b(ce){ce.path_=decodeURIComponent(ce.path)}const C="v[A-Za-z0-9_]+",I=i.replace(/[.]/g,"\\."),O="(/([^?#]*).*)?$",L=new RegExp(`^https?://${I}/${C}/b/${l}/o${O}`,"i"),U={bucket:1,path:3},B=i===yoe?"(?:storage.googleapis.com|storage.cloud.google.com)":i,W="([^?#]*)",J=new RegExp(`^https?://${B}/${l}/${W}`,"i"),ie=[{regex:_,indices:E,postModify:d},{regex:L,indices:U,postModify:b},{regex:J,indices:{bucket:1,path:2},postModify:b}];for(let ce=0;ce<ie.length;ce++){const ne=ie[ce],de=ne.regex.exec(e);if(de){const Q=de[ne.indices.bucket];let Z=de[ne.indices.path];Z||(Z=""),o=new Bl(Q,Z),ne.postModify(o);break}}if(o==null)throw t6e(e);return o}}class c6e{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(e=!1){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function l6e(n,e,i){let o=1,l=null,d=null,p=!1,_=0;function E(){return _===2}let b=!1;function C(...W){b||(b=!0,e.apply(null,W))}function I(W){l=setTimeout(()=>{l=null,n(L,E())},W)}function O(){d&&clearTimeout(d)}function L(W,...J){if(b){O();return}if(W){O(),C.call(null,W,...J);return}if(E()||p){O(),C.call(null,W,...J);return}o<64&&(o*=2);let ie;_===1?(_=2,ie=0):ie=(o+Math.random())*1e3,I(ie)}let U=!1;function B(W){U||(U=!0,O(),!b&&(l!==null?(W||(_=2),clearTimeout(l),I(0)):W||(_=1)))}return I(0),d=setTimeout(()=>{p=!0,B(!0)},i),B}function u6e(n){n(!1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function d6e(n){return n!==void 0}function h6e(n){return typeof n=="object"&&!Array.isArray(n)}function g3(n){return typeof n=="string"||n instanceof String}function lQ(n){return _3()&&n instanceof Blob}function _3(){return typeof Blob<"u"}function uQ(n,e,i,o){if(o<e)throw EF(`Invalid value for '${n}'. Expected ${e} or greater.`);if(o>i)throw EF(`Invalid value for '${n}'. Expected ${i} or less.`)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function DN(n,e,i){let o=e;return i==null&&(o=`https://${e}`),`${i}://${o}/v0${n}`}function Soe(n){const e=encodeURIComponent;let i="?";for(const o in n)if(n.hasOwnProperty(o)){const l=e(o)+"="+e(n[o]);i=i+l+"&"}return i=i.slice(0,-1),i}var By;(function(n){n[n.NO_ERROR=0]="NO_ERROR",n[n.NETWORK_ERROR=1]="NETWORK_ERROR",n[n.ABORT=2]="ABORT"})(By||(By={}));/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function f6e(n,e){const i=n>=500&&n<600,l=[408,429].indexOf(n)!==-1,d=e.indexOf(n)!==-1;return i||l||d}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class p6e{constructor(e,i,o,l,d,p,_,E,b,C,I,O=!0){this.url_=e,this.method_=i,this.headers_=o,this.body_=l,this.successCodes_=d,this.additionalRetryCodes_=p,this.callback_=_,this.errorCallback_=E,this.timeout_=b,this.progressCallback_=C,this.connectionFactory_=I,this.retry=O,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((L,U)=>{this.resolve_=L,this.reject_=U,this.start_()})}start_(){const e=(o,l)=>{if(l){o(!1,new GO(!1,null,!0));return}const d=this.connectionFactory_();this.pendingConnection_=d;const p=_=>{const E=_.loaded,b=_.lengthComputable?_.total:-1;this.progressCallback_!==null&&this.progressCallback_(E,b)};this.progressCallback_!==null&&d.addUploadProgressListener(p),d.send(this.url_,this.method_,this.body_,this.headers_).then(()=>{this.progressCallback_!==null&&d.removeUploadProgressListener(p),this.pendingConnection_=null;const _=d.getErrorCode()===By.NO_ERROR,E=d.getStatus();if(!_||f6e(E,this.additionalRetryCodes_)&&this.retry){const C=d.getErrorCode()===By.ABORT;o(!1,new GO(!1,null,C));return}const b=this.successCodes_.indexOf(E)!==-1;o(!0,new GO(b,d))})},i=(o,l)=>{const d=this.resolve_,p=this.reject_,_=l.connection;if(l.wasSuccessCode)try{const E=this.callback_(_,_.getResponse());d6e(E)?d(E):d()}catch(E){p(E)}else if(_!==null){const E=m3();E.serverResponse=_.getErrorText(),this.errorCallback_?p(this.errorCallback_(_,E)):p(E)}else if(l.canceled){const E=this.appDelete_?voe():e6e();p(E)}else{const E=ZBe();p(E)}};this.canceled_?i(!1,new GO(!1,null,!0)):this.backoffId_=l6e(e,i,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,this.backoffId_!==null&&u6e(this.backoffId_),this.pendingConnection_!==null&&this.pendingConnection_.abort()}}class GO{constructor(e,i,o){this.wasSuccessCode=e,this.connection=i,this.canceled=!!o}}function m6e(n,e){e!==null&&e.length>0&&(n.Authorization="Firebase "+e)}function g6e(n,e){n["X-Firebase-Storage-Version"]="webjs/"+(e??"AppManager")}function _6e(n,e){e&&(n["X-Firebase-GMPID"]=e)}function y6e(n,e){e!==null&&(n["X-Firebase-AppCheck"]=e)}function E6e(n,e,i,o,l,d,p=!0){const _=Soe(n.urlParams),E=n.url+_,b=Object.assign({},n.headers);return _6e(b,e),m6e(b,i),g6e(b,d),y6e(b,o),new p6e(E,n.method,b,n.body,n.successCodes,n.additionalRetryCodes,n.handler,n.errorHandler,n.timeout,n.progressCallback,l,p)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function v6e(){return typeof BlobBuilder<"u"?BlobBuilder:typeof WebKitBlobBuilder<"u"?WebKitBlobBuilder:void 0}function S6e(...n){const e=v6e();if(e!==void 0){const i=new e;for(let o=0;o<n.length;o++)i.append(n[o]);return i.getBlob()}else{if(_3())return new Blob(n);throw new Us(Ms.UNSUPPORTED_ENVIRONMENT,"This browser doesn't seem to support creating Blobs")}}function b6e(n,e,i){return n.webkitSlice?n.webkitSlice(e,i):n.mozSlice?n.mozSlice(e,i):n.slice?n.slice(e,i):null}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function T6e(n){if(typeof atob>"u")throw o6e("base-64");return atob(n)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Qh={RAW:"raw",BASE64:"base64",BASE64URL:"base64url",DATA_URL:"data_url"};class MU{constructor(e,i){this.data=e,this.contentType=i||null}}function w6e(n,e){switch(n){case Qh.RAW:return new MU(boe(e));case Qh.BASE64:case Qh.BASE64URL:return new MU(Toe(n,e));case Qh.DATA_URL:return new MU(R6e(e),I6e(e))}throw m3()}function boe(n){const e=[];for(let i=0;i<n.length;i++){let o=n.charCodeAt(i);if(o<=127)e.push(o);else if(o<=2047)e.push(192|o>>6,128|o&63);else if((o&64512)===55296)if(!(i<n.length-1&&(n.charCodeAt(i+1)&64512)===56320))e.push(239,191,189);else{const d=o,p=n.charCodeAt(++i);o=65536|(d&1023)<<10|p&1023,e.push(240|o>>18,128|o>>12&63,128|o>>6&63,128|o&63)}else(o&64512)===56320?e.push(239,191,189):e.push(224|o>>12,128|o>>6&63,128|o&63)}return new Uint8Array(e)}function C6e(n){let e;try{e=decodeURIComponent(n)}catch{throw SC(Qh.DATA_URL,"Malformed data URL.")}return boe(e)}function Toe(n,e){switch(n){case Qh.BASE64:{const l=e.indexOf("-")!==-1,d=e.indexOf("_")!==-1;if(l||d)throw SC(n,"Invalid character '"+(l?"-":"_")+"' found: is it base64url encoded?");break}case Qh.BASE64URL:{const l=e.indexOf("+")!==-1,d=e.indexOf("/")!==-1;if(l||d)throw SC(n,"Invalid character '"+(l?"+":"/")+"' found: is it base64 encoded?");e=e.replace(/-/g,"+").replace(/_/g,"/");break}}let i;try{i=T6e(e)}catch(l){throw l.message.includes("polyfill")?l:SC(n,"Invalid character found")}const o=new Uint8Array(i.length);for(let l=0;l<i.length;l++)o[l]=i.charCodeAt(l);return o}class woe{constructor(e){this.base64=!1,this.contentType=null;const i=e.match(/^data:([^,]+)?,/);if(i===null)throw SC(Qh.DATA_URL,"Must be formatted 'data:[<mediatype>][;base64],<data>");const o=i[1]||null;o!=null&&(this.base64=A6e(o,";base64"),this.contentType=this.base64?o.substring(0,o.length-7):o),this.rest=e.substring(e.indexOf(",")+1)}}function R6e(n){const e=new woe(n);return e.base64?Toe(Qh.BASE64,e.rest):C6e(e.rest)}function I6e(n){return new woe(n).contentType}function A6e(n,e){return n.length>=e.length?n.substring(n.length-e.length)===e:!1}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tg{constructor(e,i){let o=0,l="";lQ(e)?(this.data_=e,o=e.size,l=e.type):e instanceof ArrayBuffer?(i?this.data_=new Uint8Array(e):(this.data_=new Uint8Array(e.byteLength),this.data_.set(new Uint8Array(e))),o=this.data_.length):e instanceof Uint8Array&&(i?this.data_=e:(this.data_=new Uint8Array(e.length),this.data_.set(e)),o=e.length),this.size_=o,this.type_=l}size(){return this.size_}type(){return this.type_}slice(e,i){if(lQ(this.data_)){const o=this.data_,l=b6e(o,e,i);return l===null?null:new Tg(l)}else{const o=new Uint8Array(this.data_.buffer,e,i-e);return new Tg(o,!0)}}static getBlob(...e){if(_3()){const i=e.map(o=>o instanceof Tg?o.data_:o);return new Tg(S6e.apply(null,i))}else{const i=e.map(p=>g3(p)?w6e(Qh.RAW,p).data:p.data_);let o=0;i.forEach(p=>{o+=p.byteLength});const l=new Uint8Array(o);let d=0;return i.forEach(p=>{for(let _=0;_<p.length;_++)l[d++]=p[_]}),new Tg(l,!0)}}uploadData(){return this.data_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Coe(n){let e;try{e=JSON.parse(n)}catch{return null}return h6e(e)?e:null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function P6e(n){if(n.length===0)return null;const e=n.lastIndexOf("/");return e===-1?"":n.slice(0,e)}function O6e(n,e){const i=e.split("/").filter(o=>o.length>0).join("/");return n.length===0?i:n+"/"+i}function Roe(n){const e=n.lastIndexOf("/",n.length-2);return e===-1?n:n.slice(e+1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function k6e(n,e){return e}class bc{constructor(e,i,o,l){this.server=e,this.local=i||e,this.writable=!!o,this.xform=l||k6e}}let HO=null;function N6e(n){return!g3(n)||n.length<2?n:Roe(n)}function Ioe(){if(HO)return HO;const n=[];n.push(new bc("bucket")),n.push(new bc("generation")),n.push(new bc("metageneration")),n.push(new bc("name","fullPath",!0));function e(d,p){return N6e(p)}const i=new bc("name");i.xform=e,n.push(i);function o(d,p){return p!==void 0?Number(p):p}const l=new bc("size");return l.xform=o,n.push(l),n.push(new bc("timeCreated")),n.push(new bc("updated")),n.push(new bc("md5Hash",null,!0)),n.push(new bc("cacheControl",null,!0)),n.push(new bc("contentDisposition",null,!0)),n.push(new bc("contentEncoding",null,!0)),n.push(new bc("contentLanguage",null,!0)),n.push(new bc("contentType",null,!0)),n.push(new bc("metadata","customMetadata",!0)),HO=n,HO}function D6e(n,e){function i(){const o=n.bucket,l=n.fullPath,d=new Bl(o,l);return e._makeStorageReference(d)}Object.defineProperty(n,"ref",{get:i})}function x6e(n,e,i){const o={};o.type="file";const l=i.length;for(let d=0;d<l;d++){const p=i[d];o[p.local]=p.xform(o,e[p.server])}return D6e(o,n),o}function Aoe(n,e,i){const o=Coe(e);return o===null?null:x6e(n,o,i)}function L6e(n,e,i,o){const l=Coe(e);if(l===null||!g3(l.downloadTokens))return null;const d=l.downloadTokens;if(d.length===0)return null;const p=encodeURIComponent;return d.split(",").map(b=>{const C=n.bucket,I=n.fullPath,O="/b/"+p(C)+"/o/"+p(I),L=DN(O,i,o),U=Soe({alt:"media",token:b});return L+U})[0]}function M6e(n,e){const i={},o=e.length;for(let l=0;l<o;l++){const d=e[l];d.writable&&(i[d.server]=n[d.local])}return JSON.stringify(i)}class y3{constructor(e,i,o,l){this.url=e,this.method=i,this.handler=o,this.timeout=l,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Poe(n){if(!n)throw m3()}function U6e(n,e){function i(o,l){const d=Aoe(n,l,e);return Poe(d!==null),d}return i}function V6e(n,e){function i(o,l){const d=Aoe(n,l,e);return Poe(d!==null),L6e(d,l,n.host,n._protocol)}return i}function Ooe(n){function e(i,o){let l;return i.getStatus()===401?i.getErrorText().includes("Firebase App Check token is invalid")?l=JBe():l=XBe():i.getStatus()===402?l=YBe(n.bucket):i.getStatus()===403?l=QBe(n.path):l=o,l.status=i.getStatus(),l.serverResponse=o.serverResponse,l}return e}function koe(n){const e=Ooe(n);function i(o,l){let d=e(o,l);return o.getStatus()===404&&(d=qBe(n.path)),d.serverResponse=l.serverResponse,d}return i}function F6e(n,e,i){const o=e.fullServerUrl(),l=DN(o,n.host,n._protocol),d="GET",p=n.maxOperationRetryTime,_=new y3(l,d,V6e(n,i),p);return _.errorHandler=koe(e),_}function j6e(n,e){const i=e.fullServerUrl(),o=DN(i,n.host,n._protocol),l="DELETE",d=n.maxOperationRetryTime;function p(E,b){}const _=new y3(o,l,p,d);return _.successCodes=[200,204],_.errorHandler=koe(e),_}function B6e(n,e){return n&&n.contentType||e&&e.type()||"application/octet-stream"}function W6e(n,e,i){const o=Object.assign({},i);return o.fullPath=n.path,o.size=e.size(),o.contentType||(o.contentType=B6e(null,e)),o}function z6e(n,e,i,o,l){const d=e.bucketOnlyServerUrl(),p={"X-Goog-Upload-Protocol":"multipart"};function _(){let ie="";for(let ce=0;ce<2;ce++)ie=ie+Math.random().toString().slice(2);return ie}const E=_();p["Content-Type"]="multipart/related; boundary="+E;const b=W6e(e,o,l),C=M6e(b,i),I="--"+E+`\r
Content-Type: application/json; charset=utf-8\r
\r
`+C+`\r
--`+E+`\r
Content-Type: `+b.contentType+`\r
\r
`,O=`\r
--`+E+"--",L=Tg.getBlob(I,o,O);if(L===null)throw i6e();const U={name:b.fullPath},B=DN(d,n.host,n._protocol),W="POST",J=n.maxUploadRetryTime,$=new y3(B,W,U6e(n,i),J);return $.urlParams=U,$.headers=p,$.body=L.uploadData(),$.errorHandler=Ooe(e),$}class G6e{constructor(){this.sent_=!1,this.xhr_=new XMLHttpRequest,this.initXhr(),this.errorCode_=By.NO_ERROR,this.sendPromise_=new Promise(e=>{this.xhr_.addEventListener("abort",()=>{this.errorCode_=By.ABORT,e()}),this.xhr_.addEventListener("error",()=>{this.errorCode_=By.NETWORK_ERROR,e()}),this.xhr_.addEventListener("load",()=>{e()})})}send(e,i,o,l){if(this.sent_)throw Rw("cannot .send() more than once");if(this.sent_=!0,this.xhr_.open(i,e,!0),l!==void 0)for(const d in l)l.hasOwnProperty(d)&&this.xhr_.setRequestHeader(d,l[d].toString());return o!==void 0?this.xhr_.send(o):this.xhr_.send(),this.sendPromise_}getErrorCode(){if(!this.sent_)throw Rw("cannot .getErrorCode() before sending");return this.errorCode_}getStatus(){if(!this.sent_)throw Rw("cannot .getStatus() before sending");try{return this.xhr_.status}catch{return-1}}getResponse(){if(!this.sent_)throw Rw("cannot .getResponse() before sending");return this.xhr_.response}getErrorText(){if(!this.sent_)throw Rw("cannot .getErrorText() before sending");return this.xhr_.statusText}abort(){this.xhr_.abort()}getResponseHeader(e){return this.xhr_.getResponseHeader(e)}addUploadProgressListener(e){this.xhr_.upload!=null&&this.xhr_.upload.addEventListener("progress",e)}removeUploadProgressListener(e){this.xhr_.upload!=null&&this.xhr_.upload.removeEventListener("progress",e)}}class H6e extends G6e{initXhr(){this.xhr_.responseType="text"}}function E3(){return new H6e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eE{constructor(e,i){this._service=e,i instanceof Bl?this._location=i:this._location=Bl.makeFromUrl(i,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,i){return new eE(e,i)}get root(){const e=new Bl(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return Roe(this._location.path)}get storage(){return this._service}get parent(){const e=P6e(this._location.path);if(e===null)return null;const i=new Bl(this._location.bucket,e);return new eE(this._service,i)}_throwIfRoot(e){if(this._location.path==="")throw a6e(e)}}function $6e(n,e,i){n._throwIfRoot("uploadBytes");const o=z6e(n.storage,n._location,Ioe(),new Tg(e,!0),i);return n.storage.makeRequestWithTokens(o,E3).then(l=>({metadata:l,ref:n}))}function K6e(n){n._throwIfRoot("getDownloadURL");const e=F6e(n.storage,n._location,Ioe());return n.storage.makeRequestWithTokens(e,E3).then(i=>{if(i===null)throw s6e();return i})}function q6e(n){n._throwIfRoot("deleteObject");const e=j6e(n.storage,n._location);return n.storage.makeRequestWithTokens(e,E3)}function Y6e(n,e){const i=O6e(n._location.path,e),o=new Bl(n._location.bucket,i);return new eE(n.storage,o)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function X6e(n){return/^[A-Za-z]+:\/\//.test(n)}function J6e(n,e){return new eE(n,e)}function Noe(n,e){if(n instanceof v3){const i=n;if(i._bucket==null)throw r6e();const o=new eE(i,i._bucket);return e!=null?Noe(o,e):o}else return e!==void 0?Y6e(n,e):n}function Q6e(n,e){if(e&&X6e(e)){if(n instanceof v3)return J6e(n,e);throw EF("To use ref(service, url), the first argument must be a Storage instance.")}else return Noe(n,e)}function dQ(n,e){const i=e==null?void 0:e[Eoe];return i==null?null:Bl.makeFromBucketSpec(i,n)}function Z6e(n,e,i,o={}){n.host=`${e}:${i}`,n._protocol="http";const{mockUserToken:l}=o;l&&(n._overrideAuthToken=typeof l=="string"?l:Yre(l,n.app.options.projectId))}class v3{constructor(e,i,o,l,d){this.app=e,this._authProvider=i,this._appCheckProvider=o,this._url=l,this._firebaseVersion=d,this._bucket=null,this._host=yoe,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=$Be,this._maxUploadRetryTime=KBe,this._requests=new Set,l!=null?this._bucket=Bl.makeFromBucketSpec(l,this._host):this._bucket=dQ(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,this._url!=null?this._bucket=Bl.makeFromBucketSpec(this._url,e):this._bucket=dQ(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){uQ("time",0,Number.POSITIVE_INFINITY,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){uQ("time",0,Number.POSITIVE_INFINITY,e),this._maxOperationRetryTime=e}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const e=this._authProvider.getImmediate({optional:!0});if(e){const i=await e.getToken();if(i!==null)return i.accessToken}return null}async _getAppCheckToken(){if(Vl(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=this._appCheckProvider.getImmediate({optional:!0});return e?(await e.getToken()).token:null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(e=>e.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new eE(this,e)}_makeRequest(e,i,o,l,d=!0){if(this._deleted)return new c6e(voe());{const p=E6e(e,this._appId,o,l,i,this._firebaseVersion,d);return this._requests.add(p),p.getPromise().then(()=>this._requests.delete(p),()=>this._requests.delete(p)),p}}async makeRequestWithTokens(e,i){const[o,l]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(e,i,o,l).getPromise()}}const hQ="@firebase/storage",fQ="0.13.7";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Doe="storage";function xN(n,e,i){return n=qi(n),$6e(n,e,i)}function OR(n){return n=qi(n),K6e(n)}function LN(n){return n=qi(n),q6e(n)}function nm(n,e){return n=qi(n),Q6e(n,e)}function rm(n=g4(),e){n=qi(n);const o=sN(n,Doe).getImmediate({identifier:e}),l=$re("storage");return l&&eWe(o,...l),o}function eWe(n,e,i,o={}){Z6e(n,e,i,o)}function tWe(n,{instanceIdentifier:e}){const i=n.getProvider("app").getImmediate(),o=n.getProvider("auth-internal"),l=n.getProvider("app-check-internal");return new v3(i,o,l,e,iE)}function nWe(){qy(new xg(Doe,tWe,"PUBLIC").setMultipleInstances(!0)),lf(hQ,fQ,""),lf(hQ,fQ,"esm2017")}nWe();const Dk=async n=>{const e=rm(),i=nm(e,n);try{return await OR(i)}catch(o){throw q.error("Failed to fetch HTTP URL from gs:// URL:","/src/packages/shared/firebase/firebaseStorage.js",o),o}};let tE={};const Bp=async n=>{try{const e=Vr(dr,"spaces",n),i=await $o(e);if(i.exists()){let o=i.data();const l=o.name,d=o.description;if(o.webglBuildId){const p=Vr(dr,"webglBuilds",o.webglBuildId),_=await $o(p);if(_.exists()){const E=_.data();o={...o,...E,name:l||E.name,description:d||E.description}}else q.warn(`spacesFirestore: No document found for webglBuildId: ${o.webglBuildId}`)}return o=await rWe(o),o=iWe(o),console.log("Space data:",o),q.log(`spacesFirestore: Caching space data for: ${n}`),tE[n]=o,o}else return q.warn(`spacesFirestore: No document found for item ID: ${n}`),null}catch(e){throw q.error("spacesFirestore: Error fetching item data:",e),e}},rWe=async n=>{const i=["gsUrlCode","gsUrlData","gsUrlFramework","gsUrlLoader","gsUrlLoadingBackground"].map(async o=>{const l=n[o];l&&l.startsWith("gs://")&&(n[o]=await Dk(l))});return await Promise.all(i),n},iWe=n=>{const{gsUrlCode:e,gsUrlData:i,gsUrlFramework:o,gsUrlLoader:l,...d}=n;return{...d,codeUrl:e,dataUrl:i,frameworkUrl:o,loaderUrl:l}};let UU={};const xoe=async n=>{q.log("spacesFirestore: Get Videos from Firestore for space: ",n);try{if(UU[n])return q.log("spacesFirestore: Returning cached videos for space:",n),UU[n];const e=Qp(dr,`spaces/${n}/videos`),i=await Zy(e),o=[];return i.forEach(l=>{o.push({id:l.id,...l.data()})}),UU[n]=o,o}catch(e){throw q.error("spacesFirestore: Error fetching Space videos from Firestore:",e),e}},sWe=async(n,e)=>{try{if(!n||!e)throw new Error("Missing required parameters: spaceId and logoFile");if(!e.type.startsWith("image/"))throw new Error("File must be an image");const i=rm(),o=Date.now(),l=e.name.split(".").pop(),d=`logo_${o}.${l}`,p=nm(i,`spaces/${n}/logo/${d}`);q.log(`Uploading logo for space ${n}`);const _=await xN(p,e),E=await OR(_.ref),b=Vr(dr,"spaces",n);return await Ys(b,{logoUrl:E,logoGsUrl:`gs://${_.ref.bucket}/${_.ref.fullPath}`,logoFileName:d,updatedAt:new Date().toISOString()}),q.log(`Successfully uploaded logo for space ${n}`),E}catch(i){throw q.error("Error uploading space logo:",i),i}},oWe=async n=>{try{const e=Vr(dr,"spaces",n),i=await $o(e);if(!i.exists())return q.warn(`No space found with ID: ${n}`),!1;const o=i.data();if(o.logoGsUrl){const l=rm(),d=nm(l,o.logoGsUrl);try{await LN(d),q.log(`Deleted logo file from storage: ${o.logoGsUrl}`)}catch(p){q.warn(`Could not delete logo file from storage: ${p.message}`)}}return await Ys(e,{logoUrl:null,logoGsUrl:null,logoFileName:null,updatedAt:new Date().toISOString()}),q.log(`Successfully removed logo for space ${n}`),!0}catch(e){throw q.error("Error deleting space logo:",e),e}},aWe=async(n,e)=>{try{if(!n||!e)throw new Error("Missing required parameters: spaceId and backgroundFile");if(!e.type.startsWith("image/"))throw new Error("File must be an image");const i=rm(),o=Date.now(),l=e.name.split(".").pop(),d=`background_${o}.${l}`,p=nm(i,`spaces/${n}/background/${d}`);q.log(`Uploading background for space ${n}`);const _=await xN(p,e),E=await OR(_.ref),b=Vr(dr,"spaces",n);return await Ys(b,{backgroundUrl:E,backgroundGsUrl:`gs://${_.ref.bucket}/${_.ref.fullPath}`,backgroundFileName:d,gsUrlLoadingBackground:`gs://${_.ref.bucket}/${_.ref.fullPath}`,updatedAt:new Date().toISOString()}),q.log(`Successfully uploaded background for space ${n}`),E}catch(i){throw q.error("Error uploading space background:",i),i}},cWe=async n=>{try{const e=Vr(dr,"spaces",n),i=await $o(e);if(!i.exists())return q.warn(`No space found with ID: ${n}`),!1;const o=i.data();if(o.backgroundGsUrl){const l=rm(),d=nm(l,o.backgroundGsUrl);try{await LN(d),q.log(`Deleted background file from storage: ${o.backgroundGsUrl}`)}catch(p){q.warn(`Could not delete background file from storage: ${p.message}`)}}return await Ys(e,{backgroundUrl:null,backgroundGsUrl:null,backgroundFileName:null,gsUrlLoadingBackground:null,updatedAt:new Date().toISOString()}),q.log(`Successfully removed background references for space ${n}`),!0}catch(e){throw q.error("Error deleting space background:",e),e}},lWe=async(n,e)=>{try{q.log(`spacesFirestore: Updating settings for space: ${n}`,e);const i=Vr(dr,"spaces",n),o=await $o(i);if(!o.exists())throw new Error(`Space with ID ${n} not found`);const l=o.data(),d={...e,accessibleToAllUsers:e.accessibleToAllUsers!==void 0?e.accessibleToAllUsers:l.accessibleToAllUsers!==void 0?l.accessibleToAllUsers:!0,updatedAt:new Date().toISOString()};await Ys(i,d),tE[n]&&delete tE[n],q.log(`spacesFirestore: Successfully updated settings for space: ${n}`)}catch(i){throw q.error(`spacesFirestore: Error updating settings for space: ${n}`,i),i}},uWe=async(n,e)=>{try{q.log(`spacesFirestore: Setting accessibleToAllUsers=${e} for space: ${n}`);const i=Vr(dr,"spaces",n);if(!(await $o(i)).exists())throw new Error(`Space with ID ${n} not found`);await Ys(i,{accessibleToAllUsers:e,updatedAt:new Date().toISOString()}),tE[n]&&delete tE[n],typeof window<"u"&&window.dispatchEvent(new CustomEvent("SpaceAccessibilityChanged",{detail:{spaceId:n,accessibleToAllUsers:e}})),q.log(`spacesFirestore: Successfully updated accessibleToAllUsers for space: ${n}`)}catch(i){throw q.error(`spacesFirestore: Error updating accessibleToAllUsers for space: ${n}`,i),i}},vF=async(n,e)=>{try{q.log(`spacesFirestore: Updating HLS stream for space: ${n}`,e);const i=Vr(dr,"spaces",n);if(!(await $o(i)).exists())throw new Error(`Space with ID ${n} not found`);const{streamUrl:l,playerIndex:d="0",enabled:p=!0,rtmpUrl:_="",streamKey:E=""}=e,b={HLSStreamURL:{streamUrl:l,playerIndex:d,enabled:p,rtmpUrl:_,streamKey:E,updatedAt:new Date().toISOString()},updatedAt:new Date().toISOString()};return await Ys(i,b),tE[n]&&delete tE[n],typeof window<"u"&&window.dispatchEvent(new CustomEvent("SpaceHLSStreamUpdated",{detail:{spaceId:n,streamUrl:l,playerIndex:d,enabled:p,rtmpUrl:_,streamKey:E}})),q.log(`spacesFirestore: Successfully updated HLS stream for space: ${n}`),!0}catch(i){throw q.error(`spacesFirestore: Error updating HLS stream for space: ${n}`,i),i}},Loe=async n=>{try{q.log(`spacesFirestore: Getting HLS stream for space: ${n}`);const e=Vr(dr,"spaces",n),i=await $o(e);if(!i.exists())return q.warn(`spacesFirestore: Space with ID ${n} not found`),null;const o=i.data();return o.HLSStreamURL?(q.log(`spacesFirestore: Found HLS stream for space: ${n}`,o.HLSStreamURL),o.HLSStreamURL):(q.log(`spacesFirestore: No HLS stream found for space: ${n}`),null)}catch(e){throw q.error(`spacesFirestore: Error getting HLS stream for space: ${n}`,e),e}},dWe=async(n,e)=>{try{if(!n||!e)throw new Error("Missing required parameters: spaceId and videoFile");if(!e.type.startsWith("video/"))throw new Error("File must be a video");const i=5*1024*1024;if(e.size>i)throw new Error("Video file must be smaller than 5MB");const o=rm(),l=Date.now(),d=e.name.split(".").pop(),p=`video_bg_${l}.${d}`,_=nm(o,`spaces/${n}/video_background/${p}`);q.log(`Uploading video background for space ${n}`);const E=await xN(_,e),b=await OR(E.ref),C=Vr(dr,"spaces",n);return await Ys(C,{videoBackgroundUrl:b,videoBackgroundGsUrl:`gs://${E.ref.bucket}/${E.ref.fullPath}`,videoBackgroundFileName:p,updatedAt:new Date().toISOString()}),q.log(`Successfully uploaded video background for space ${n}`),b}catch(i){throw q.error("Error uploading space video background:",i),i}},hWe=async n=>{try{if(!n)throw new Error("Missing required parameter: spaceId");const e=Vr(dr,"spaces",n),i=await $o(e);if(!i.exists())throw new Error(`Space with ID ${n} not found`);const o=i.data();if(!o.videoBackgroundGsUrl){q.log(`No video background found for space ${n}`);return}const l=rm(),p=o.videoBackgroundGsUrl.replace("gs://",""),[_,...E]=p.split("/"),b=E.join("/"),C=nm(l,b);try{await LN(C),q.log(`Deleted video background file from storage for space ${n}`)}catch(I){q.error(`Failed to delete video background file, it may not exist: ${I.message}`)}await Ys(e,{videoBackgroundUrl:null,videoBackgroundGsUrl:null,videoBackgroundFileName:null,updatedAt:new Date().toISOString()}),q.log(`Successfully removed video background for space ${n}`)}catch(e){throw q.error("Error deleting space video background:",e),e}},Ao=N.createContext(null),Moe=N.createContext(null),MN=({children:n})=>{const[e,i]=N.useState(null),o=N.useRef(null),[l,d]=N.useState(!0),[p,_]=N.useState(!1),E=lN(),b=ne=>ne?ne.Nickname?ne.Nickname:`${ne.firstName} ${ne.lastName}`:"Anon";N.useEffect(()=>{const ne=oje(E,async de=>{if(q.log("UserProvider: Firebase onAuthStateChanged() fired"),de)try{const Q=await Hu(de.uid),Z=b(Q),X={uid:de.uid,email:de.email,emailVerified:de.emailVerified,...Q,displayName:Z};q.log(`UserProvider: User authenticated: ${de.uid}`),i(X),o.current=X,L(X)}catch(Q){q.error("UserProvider: Error fetching user profile data:",Q)}else i(null),o.current=null;d(!1)});return()=>{ne&&ne()}},[]);const C=async(ne,de,Q)=>{try{_(!0),q.log("UserProvider: Starting registration process"),q.log("UserProvider: Registration includes fields:",Object.keys(Q||{}).join(", "));const Z={...Q},X=["firstName","lastName","username","companyName","linkedInProfile"],re=X.filter(ve=>!Z[ve]);re.length>0&&q.warn(`UserProvider: Registration missing fields: ${re.join(", ")}`);const pe=Z.firstName&&Z.lastName?`${Z.firstName}${Z.lastName.charAt(0).toUpperCase()}`:"";q.log("UserProvider: Generated default nickname for registration");const he={firstName:"",lastName:"",companyName:"",linkedInProfile:"",username:"",Nickname:Z.Nickname||pe,groups:["users"],rpmURL:"https://models.readyplayer.me/67c8408d38f7924e15a8bd0a.glb",...Z};q.log("UserProvider: Prepared registration data with fields:",Object.keys(he).join(", "));const ue=await UBe(ne,de,he);q.log("UserProvider: Registration successful, received user data");const xe=X.filter(ve=>!ue[ve]);xe.length>0&&q.warn(`UserProvider: Returned user data missing fields: ${xe.join(", ")}`),["firstName","lastName","Nickname","username","companyName"].forEach(ve=>{ue[ve]||(q.warn(`UserProvider: ${ve} is missing in returned data, using original value`),ue[ve]=he[ve])});const $e={uid:ue.uid,email:ue.email,...ue,displayName:b(ue)};return q.log("UserProvider: Created user object with fields:",Object.keys($e).join(", ")),i($e),o.current=$e,q.log("UserProvider: User registered successfully with groups:",he.groups),await new Promise(ve=>setTimeout(ve,2e3)),_(!1),$e}catch(Z){throw _(!1),q.error("UserProvider: Error during registration:",Z),Z}},I=async(ne,de,Q)=>{try{if(q.log("UserProvider: Signing in user"),!Q)throw new Error("CAPTCHA verification is required");const X=(await rje(E,ne,de)).user;return q.log("UserProvider: User signed in successfully:",X.email),X}catch(Z){throw q.error("UserProvider: Error signing in:",Z),Z}},O=async()=>{try{await aje(E),i(null),q.log("UserProvider: User signed out.")}catch(ne){throw q.error("UserProvider: Error signing out:",ne),ne}},L=()=>{const ne=o.current;if(ne){const de=U(ne);q.log("UserProvider: sendUserToUnity() using the eventBus",de),jd.publish(Fd.sendUserToUnity,de)}else q.log("UserProvider: No current user to send to Unity.")},U=ne=>{const de={};return[...GBe,"uid"].forEach(Z=>{ne.hasOwnProperty(Z)&&(de[Z]=ne[Z])}),de},B=async ne=>!e||!e.uid?!1:await p3(e.uid,ne),W=async ne=>{if(!e||!e.uid)return!1;try{const de=await Bp(ne);if(de.usersAllowed.includes(e.uid)||de.userAdmin.includes(e.uid)||de.usersModerators.includes(e.uid))return!0;if(e.groups&&Array.isArray(e.groups)){const Z=`space_${ne}_owners`,X=`space_${ne}_hosts`;if(e.groups.includes(Z)||e.groups.includes(X))return q.log(`UserProvider: User ${e.uid} has access to space ${ne} as owner/host`),!0}return de.accessibleToAllUsers===!0&&e.groups?e.groups.includes("users"):!1}catch(de){return q.error("UserProvider: Error verifying user access to space:",de),!1}},J=async ne=>{if(!e||!e.uid)return!1;try{return(await Bp(ne)).userAdmin.includes(e.uid)}catch(de){return q.error("UserProvider: Error verifying user admin status for space:",de),!1}},$=async ne=>{if(!e||!e.uid)return!1;try{return(await Bp(ne)).usersModerators.includes(e.uid)}catch(de){return q.error("UserProvider: Error verifying user moderator status for space:",de),!1}},ie=async()=>{try{const ne=E.currentUser;return ne&&!ne.emailVerified?(await Iie(ne),q.log("UserProvider: Verification email resent to:",ne.email),!0):!1}catch(ne){throw q.error("UserProvider: Error resending verification email:",ne),ne}},ce=async()=>{try{const ne=E.currentUser;if(!ne)return q.warn("UserProvider: updateUser called but no current user exists"),null;q.log("UserProvider: Updating user data from Firestore");const de=await Hu(ne.uid);if(!de)return q.error("UserProvider: Failed to fetch updated user profile"),null;const Q=b(de),Z={uid:ne.uid,email:ne.email,emailVerified:ne.emailVerified,...de,displayName:Q};return q.log("UserProvider: User data updated with fields:",Object.keys(Z).join(", ")),i(Z),o.current=Z,L(Z),Z}catch(ne){throw q.error("UserProvider: Error updating user data:",ne),ne}};return w.jsx(Moe.Provider,{value:{registrationInProgress:p},children:w.jsx(Ao.Provider,{value:{user:e,loading:l,register:C,signIn:I,signOut:O,sendUserToUnity:L,isUserInGroup:B,userHasAccessToSpace:W,userIsAdminOfSpace:J,userIsModeratorOfSpace:$,resendVerificationEmail:ie,updateUser:ce},children:n})})},fWe=()=>{const n=N.useContext(Moe);if(n===void 0)throw new Error("useRegistration must be used within a UserProvider");return n},Uoe=N.createContext(),Gd=()=>N.useContext(Uoe),S3=({children:n})=>{const[e,i]=N.useState(!1),o=N.useRef(null),[l,d]=N.useState(!1);N.useEffect(()=>{const E=()=>{const b=/iPhone|iPad|iPod|Android/i.test(navigator.userAgent);d(b)};return E(),window.addEventListener("resize",E),()=>window.removeEventListener("resize",E)},[]);const p=N.useCallback(E=>{o.current=E},[]),_=N.useCallback(()=>{const E=o.current;if(!E)return;const b=document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement;if(l){console.log("Attempting mobile fullscreen...");const C=E.querySelector("video")||E;if(/iPhone|iPad|iPod/i.test(navigator.userAgent)){if(C.webkitEnterFullscreen)try{C.webkitEnterFullscreen(),i(!0);return}catch(I){console.error("iOS fullscreen error:",I)}try{if(C.webkitRequestFullscreen){C.webkitRequestFullscreen(),i(!0);return}}catch(I){console.error("iOS fallback fullscreen error:",I)}}if(/Android/i.test(navigator.userAgent))try{b?(document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.msExitFullscreen&&document.msExitFullscreen(),i(!1)):(E.requestFullscreen?E.requestFullscreen():E.webkitRequestFullscreen?E.webkitRequestFullscreen():E.mozRequestFullScreen?E.mozRequestFullScreen():E.msRequestFullscreen&&E.msRequestFullscreen(),i(!0));return}catch(I){console.error("Android fullscreen error:",I)}}try{b?document.exitFullscreen?document.exitFullscreen().then(()=>{i(!1)}).catch(C=>console.error("Error exiting fullscreen:",C)):document.webkitExitFullscreen?(document.webkitExitFullscreen(),i(!1)):document.mozCancelFullScreen?(document.mozCancelFullScreen(),i(!1)):document.msExitFullscreen&&(document.msExitFullscreen(),i(!1)):E.requestFullscreen?E.requestFullscreen().then(()=>{i(!0)}).catch(C=>console.error("Error entering fullscreen:",C)):E.webkitRequestFullscreen?(E.webkitRequestFullscreen(),i(!0)):E.mozRequestFullScreen?(E.mozRequestFullScreen(),i(!0)):E.msRequestFullscreen&&(E.msRequestFullscreen(),i(!0))}catch(C){console.error("Fullscreen error:",C)}},[l]);return N.useEffect(()=>{const E=()=>{const b=document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement;i(!!b)};return document.addEventListener("fullscreenchange",E),document.addEventListener("webkitfullscreenchange",E),document.addEventListener("mozfullscreenchange",E),document.addEventListener("MSFullscreenChange",E),()=>{document.removeEventListener("fullscreenchange",E),document.removeEventListener("webkitfullscreenchange",E),document.removeEventListener("mozfullscreenchange",E),document.removeEventListener("MSFullscreenChange",E)}},[]),w.jsx(Uoe.Provider,{value:{isFullscreen:e,toggleFullscreen:_,fullscreenRef:o,setFullscreenRef:p,isMobile:l},children:w.jsx("div",{ref:p,style:{position:"relative",zIndex:1,width:"100%",height:"100%",overflow:"hidden"},children:n})})},pWe=zg({d:"M0,12a1.5,1.5,0,0,0,1.5,1.5h8.75a.25.25,0,0,1,.25.25V22.5a1.5,1.5,0,0,0,3,0V13.75a.25.25,0,0,1,.25-.25H22.5a1.5,1.5,0,0,0,0-3H13.75a.25.25,0,0,1-.25-.25V1.5a1.5,1.5,0,0,0-3,0v8.75a.25.25,0,0,1-.25.25H1.5A1.5,1.5,0,0,0,0,12Z",displayName:"AddIcon"}),mWe=zg({viewBox:"0 0 14 14",d:"M14,7.77 L14,6.17 L12.06,5.53 L11.61,4.44 L12.49,2.6 L11.36,1.47 L9.55,2.38 L8.46,1.93 L7.77,0.01 L6.17,0.01 L5.54,1.95 L4.43,2.4 L2.59,1.52 L1.46,2.65 L2.37,4.46 L1.92,5.55 L0,6.23 L0,7.82 L1.94,8.46 L2.39,9.55 L1.51,11.39 L2.64,12.52 L4.45,11.61 L5.54,12.06 L6.23,13.98 L7.82,13.98 L8.45,12.04 L9.56,11.59 L11.4,12.47 L12.53,11.34 L11.61,9.53 L12.08,8.44 L14,7.75 L14,7.77 Z M7,10 C5.34,10 4,8.66 4,7 C4,5.34 5.34,4 7,4 C8.66,4 10,5.34 10,7 C10,8.66 8.66,10 7,10 Z",displayName:"SettingsIcon"}),gWe=zg({d:"M19.5,9.5h-.75V6.75a6.75,6.75,0,0,0-13.5,0V9.5H4.5a2,2,0,0,0-2,2V22a2,2,0,0,0,2,2h15a2,2,0,0,0,2-2V11.5A2,2,0,0,0,19.5,9.5Zm-9.5,6a2,2,0,1,1,3,1.723V19.5a1,1,0,0,1-2,0V17.223A1.994,1.994,0,0,1,10,15.5ZM7.75,6.75a4.25,4.25,0,0,1,8.5,0V9a.5.5,0,0,1-.5.5H8.25a.5.5,0,0,1-.5-.5Z",displayName:"LockIcon"}),Voe=zg({displayName:"ChevronDownIcon",d:"M16.59 8.59L12 13.17 7.41 8.59 6 10l6 6 6-6z"}),pQ=zg({displayName:"EmailIcon",path:w.jsxs("g",{fill:"currentColor",children:[w.jsx("path",{d:"M11.114,14.556a1.252,1.252,0,0,0,1.768,0L22.568,4.87a.5.5,0,0,0-.281-.849A1.966,1.966,0,0,0,22,4H2a1.966,1.966,0,0,0-.289.021.5.5,0,0,0-.281.849Z"}),w.jsx("path",{d:"M23.888,5.832a.182.182,0,0,0-.2.039l-6.2,6.2a.251.251,0,0,0,0,.354l5.043,5.043a.75.75,0,1,1-1.06,1.061l-5.043-5.043a.25.25,0,0,0-.354,0l-2.129,2.129a2.75,2.75,0,0,1-3.888,0L7.926,13.488a.251.251,0,0,0-.354,0L2.529,18.531a.75.75,0,0,1-1.06-1.061l5.043-5.043a.251.251,0,0,0,0-.354l-6.2-6.2a.18.18,0,0,0-.2-.039A.182.182,0,0,0,0,6V18a2,2,0,0,0,2,2H22a2,2,0,0,0,2-2V6A.181.181,0,0,0,23.888,5.832Z"})]})}),_We=zg({displayName:"CloseIcon",d:"M.439,21.44a1.5,1.5,0,0,0,2.122,2.121L11.823,14.3a.25.25,0,0,1,.354,0l9.262,9.263a1.5,1.5,0,1,0,2.122-2.121L14.3,12.177a.25.25,0,0,1,0-.354l9.263-9.262A1.5,1.5,0,0,0,21.439.44L12.177,9.7a.25.25,0,0,1-.354,0L2.561.44A1.5,1.5,0,0,0,.439,2.561L9.7,11.823a.25.25,0,0,1,0,.354Z"}),yWe=zg({displayName:"QuestionOutlineIcon",path:w.jsxs("g",{stroke:"currentColor",strokeWidth:"1.5",children:[w.jsx("path",{strokeLinecap:"round",fill:"none",d:"M9,9a3,3,0,1,1,4,2.829,1.5,1.5,0,0,0-1,1.415V14.25"}),w.jsx("path",{fill:"none",strokeLinecap:"round",d:"M12,17.25a.375.375,0,1,0,.375.375A.375.375,0,0,0,12,17.25h0"}),w.jsx("circle",{fill:"none",strokeMiterlimit:"10",cx:"12",cy:"12",r:"11.25"})]})}),EWe=zg({displayName:"HamburgerIcon",viewBox:"0 0 24 24",d:"M 3 5 A 1.0001 1.0001 0 1 0 3 7 L 21 7 A 1.0001 1.0001 0 1 0 21 5 L 3 5 z M 3 11 A 1.0001 1.0001 0 1 0 3 13 L 21 13 A 1.0001 1.0001 0 1 0 21 11 L 3 11 z M 3 17 A 1.0001 1.0001 0 1 0 3 19 L 21 19 A 1.0001 1.0001 0 1 0 21 17 L 3 17 z"});var kR=n=>n.type==="checkbox",Ay=n=>n instanceof Date,wc=n=>n==null;const Foe=n=>typeof n=="object";var qs=n=>!wc(n)&&!Array.isArray(n)&&Foe(n)&&!Ay(n),vWe=n=>qs(n)&&n.target?kR(n.target)?n.target.checked:n.target.value:n,SWe=n=>n.substring(0,n.search(/\.\d+(\.|$)/))||n,bWe=(n,e)=>n.has(SWe(e)),TWe=n=>{const e=n.constructor&&n.constructor.prototype;return qs(e)&&e.hasOwnProperty("isPrototypeOf")},b3=typeof window<"u"&&typeof window.HTMLElement<"u"&&typeof document<"u";function Lu(n){let e;const i=Array.isArray(n),o=typeof FileList<"u"?n instanceof FileList:!1;if(n instanceof Date)e=new Date(n);else if(n instanceof Set)e=new Set(n);else if(!(b3&&(n instanceof Blob||o))&&(i||qs(n)))if(e=i?[]:{},!i&&!TWe(n))e=n;else for(const l in n)n.hasOwnProperty(l)&&(e[l]=Lu(n[l]));else return n;return e}var UN=n=>Array.isArray(n)?n.filter(Boolean):[],no=n=>n===void 0,un=(n,e,i)=>{if(!e||!qs(n))return i;const o=UN(e.split(/[,[\].]+?/)).reduce((l,d)=>wc(l)?l:l[d],n);return no(o)||o===n?no(n[e])?i:n[e]:o},zh=n=>typeof n=="boolean",T3=n=>/^\w*$/.test(n),joe=n=>UN(n.replace(/["|']|\]/g,"").split(/\.|\[/)),is=(n,e,i)=>{let o=-1;const l=T3(e)?[e]:joe(e),d=l.length,p=d-1;for(;++o<d;){const _=l[o];let E=i;if(o!==p){const b=n[_];E=qs(b)||Array.isArray(b)?b:isNaN(+l[o+1])?{}:[]}if(_==="__proto__"||_==="constructor"||_==="prototype")return;n[_]=E,n=n[_]}return n};const mQ={BLUR:"blur",FOCUS_OUT:"focusout"},Ud={onBlur:"onBlur",onChange:"onChange",onSubmit:"onSubmit",onTouched:"onTouched",all:"all"},vp={max:"max",min:"min",maxLength:"maxLength",minLength:"minLength",pattern:"pattern",required:"required",validate:"validate"};mi.createContext(null);var wWe=(n,e,i,o=!0)=>{const l={defaultValues:e._defaultValues};for(const d in n)Object.defineProperty(l,d,{get:()=>{const p=d;return e._proxyFormState[p]!==Ud.all&&(e._proxyFormState[p]=!o||Ud.all),n[p]}});return l},ol=n=>qs(n)&&!Object.keys(n).length,CWe=(n,e,i,o)=>{i(n);const{name:l,...d}=n;return ol(d)||Object.keys(d).length>=Object.keys(e).length||Object.keys(d).find(p=>e[p]===Ud.all)},xk=n=>Array.isArray(n)?n:[n];function RWe(n){const e=mi.useRef(n);e.current=n,mi.useEffect(()=>{const i=!n.disabled&&e.current.subject&&e.current.subject.subscribe({next:e.current.next});return()=>{i&&i.unsubscribe()}},[n.disabled])}var Zh=n=>typeof n=="string",IWe=(n,e,i,o,l)=>Zh(n)?(o&&e.watch.add(n),un(i,n,l)):Array.isArray(n)?n.map(d=>(o&&e.watch.add(d),un(i,d))):(o&&(e.watchAll=!0),i),AWe=(n,e,i,o,l)=>e?{...i[n],types:{...i[n]&&i[n].types?i[n].types:{},[o]:l||!0}}:{},gQ=n=>({isOnSubmit:!n||n===Ud.onSubmit,isOnBlur:n===Ud.onBlur,isOnChange:n===Ud.onChange,isOnAll:n===Ud.all,isOnTouch:n===Ud.onTouched}),_Q=(n,e,i)=>!i&&(e.watchAll||e.watch.has(n)||[...e.watch].some(o=>n.startsWith(o)&&/^\.\w+/.test(n.slice(o.length))));const bC=(n,e,i,o)=>{for(const l of i||Object.keys(n)){const d=un(n,l);if(d){const{_f:p,..._}=d;if(p){if(p.refs&&p.refs[0]&&e(p.refs[0],l)&&!o)return!0;if(p.ref&&e(p.ref,p.name)&&!o)return!0;if(bC(_,e))break}else if(qs(_)&&bC(_,e))break}}};var PWe=(n,e,i)=>{const o=xk(un(n,i));return is(o,"root",e[i]),is(n,i,o),n},w3=n=>n.type==="file",Yh=n=>typeof n=="function",T1=n=>{if(!b3)return!1;const e=n?n.ownerDocument:0;return n instanceof(e&&e.defaultView?e.defaultView.HTMLElement:HTMLElement)},Lk=n=>Zh(n),C3=n=>n.type==="radio",w1=n=>n instanceof RegExp;const yQ={value:!1,isValid:!1},EQ={value:!0,isValid:!0};var Boe=n=>{if(Array.isArray(n)){if(n.length>1){const e=n.filter(i=>i&&i.checked&&!i.disabled).map(i=>i.value);return{value:e,isValid:!!e.length}}return n[0].checked&&!n[0].disabled?n[0].attributes&&!no(n[0].attributes.value)?no(n[0].value)||n[0].value===""?EQ:{value:n[0].value,isValid:!0}:EQ:yQ}return yQ};const vQ={isValid:!1,value:null};var Woe=n=>Array.isArray(n)?n.reduce((e,i)=>i&&i.checked&&!i.disabled?{isValid:!0,value:i.value}:e,vQ):vQ;function SQ(n,e,i="validate"){if(Lk(n)||Array.isArray(n)&&n.every(Lk)||zh(n)&&!n)return{type:i,message:Lk(n)?n:"",ref:e}}var NS=n=>qs(n)&&!w1(n)?n:{value:n,message:""},bQ=async(n,e,i,o,l,d)=>{const{ref:p,refs:_,required:E,maxLength:b,minLength:C,min:I,max:O,pattern:L,validate:U,name:B,valueAsNumber:W,mount:J}=n._f,$=un(i,B);if(!J||e.has(B))return{};const ie=_?_[0]:p,ce=he=>{l&&ie.reportValidity&&(ie.setCustomValidity(zh(he)?"":he||""),ie.reportValidity())},ne={},de=C3(p),Q=kR(p),Z=de||Q,X=(W||w3(p))&&no(p.value)&&no($)||T1(p)&&p.value===""||$===""||Array.isArray($)&&!$.length,re=AWe.bind(null,B,o,ne),pe=(he,ue,xe,We=vp.maxLength,$e=vp.minLength)=>{const ve=he?ue:xe;ne[B]={type:he?We:$e,message:ve,ref:p,...re(he?We:$e,ve)}};if(d?!Array.isArray($)||!$.length:E&&(!Z&&(X||wc($))||zh($)&&!$||Q&&!Boe(_).isValid||de&&!Woe(_).isValid)){const{value:he,message:ue}=Lk(E)?{value:!!E,message:E}:NS(E);if(he&&(ne[B]={type:vp.required,message:ue,ref:ie,...re(vp.required,ue)},!o))return ce(ue),ne}if(!X&&(!wc(I)||!wc(O))){let he,ue;const xe=NS(O),We=NS(I);if(!wc($)&&!isNaN($)){const $e=p.valueAsNumber||$&&+$;wc(xe.value)||(he=$e>xe.value),wc(We.value)||(ue=$e<We.value)}else{const $e=p.valueAsDate||new Date($),ve=ke=>new Date(new Date().toDateString()+" "+ke),_e=p.type=="time",Ee=p.type=="week";Zh(xe.value)&&$&&(he=_e?ve($)>ve(xe.value):Ee?$>xe.value:$e>new Date(xe.value)),Zh(We.value)&&$&&(ue=_e?ve($)<ve(We.value):Ee?$<We.value:$e<new Date(We.value))}if((he||ue)&&(pe(!!he,xe.message,We.message,vp.max,vp.min),!o))return ce(ne[B].message),ne}if((b||C)&&!X&&(Zh($)||d&&Array.isArray($))){const he=NS(b),ue=NS(C),xe=!wc(he.value)&&$.length>+he.value,We=!wc(ue.value)&&$.length<+ue.value;if((xe||We)&&(pe(xe,he.message,ue.message),!o))return ce(ne[B].message),ne}if(L&&!X&&Zh($)){const{value:he,message:ue}=NS(L);if(w1(he)&&!$.match(he)&&(ne[B]={type:vp.pattern,message:ue,ref:p,...re(vp.pattern,ue)},!o))return ce(ue),ne}if(U){if(Yh(U)){const he=await U($,i),ue=SQ(he,ie);if(ue&&(ne[B]={...ue,...re(vp.validate,ue.message)},!o))return ce(ue.message),ne}else if(qs(U)){let he={};for(const ue in U){if(!ol(he)&&!o)break;const xe=SQ(await U[ue]($,i),ie,ue);xe&&(he={...xe,...re(ue,xe.message)},ce(xe.message),o&&(ne[B]=he))}if(!ol(he)&&(ne[B]={ref:ie,...he},!o))return ne}}return ce(!0),ne};function OWe(n,e){const i=e.slice(0,-1).length;let o=0;for(;o<i;)n=no(n)?o++:n[e[o++]];return n}function kWe(n){for(const e in n)if(n.hasOwnProperty(e)&&!no(n[e]))return!1;return!0}function To(n,e){const i=Array.isArray(e)?e:T3(e)?[e]:joe(e),o=i.length===1?n:OWe(n,i),l=i.length-1,d=i[l];return o&&delete o[d],l!==0&&(qs(o)&&ol(o)||Array.isArray(o)&&kWe(o))&&To(n,i.slice(0,-1)),n}var VU=()=>{let n=[];return{get observers(){return n},next:l=>{for(const d of n)d.next&&d.next(l)},subscribe:l=>(n.push(l),{unsubscribe:()=>{n=n.filter(d=>d!==l)}}),unsubscribe:()=>{n=[]}}},SF=n=>wc(n)||!Foe(n);function wg(n,e){if(SF(n)||SF(e))return n===e;if(Ay(n)&&Ay(e))return n.getTime()===e.getTime();const i=Object.keys(n),o=Object.keys(e);if(i.length!==o.length)return!1;for(const l of i){const d=n[l];if(!o.includes(l))return!1;if(l!=="ref"){const p=e[l];if(Ay(d)&&Ay(p)||qs(d)&&qs(p)||Array.isArray(d)&&Array.isArray(p)?!wg(d,p):d!==p)return!1}}return!0}var zoe=n=>n.type==="select-multiple",NWe=n=>C3(n)||kR(n),FU=n=>T1(n)&&n.isConnected,Goe=n=>{for(const e in n)if(Yh(n[e]))return!0;return!1};function C1(n,e={}){const i=Array.isArray(n);if(qs(n)||i)for(const o in n)Array.isArray(n[o])||qs(n[o])&&!Goe(n[o])?(e[o]=Array.isArray(n[o])?[]:{},C1(n[o],e[o])):wc(n[o])||(e[o]=!0);return e}function Hoe(n,e,i){const o=Array.isArray(n);if(qs(n)||o)for(const l in n)Array.isArray(n[l])||qs(n[l])&&!Goe(n[l])?no(e)||SF(i[l])?i[l]=Array.isArray(n[l])?C1(n[l],[]):{...C1(n[l])}:Hoe(n[l],wc(e)?{}:e[l],i[l]):i[l]=!wg(n[l],e[l]);return i}var Iw=(n,e)=>Hoe(n,e,C1(e)),$oe=(n,{valueAsNumber:e,valueAsDate:i,setValueAs:o})=>no(n)?n:e?n===""?NaN:n&&+n:i&&Zh(n)?new Date(n):o?o(n):n;function jU(n){const e=n.ref;return w3(e)?e.files:C3(e)?Woe(n.refs).value:zoe(e)?[...e.selectedOptions].map(({value:i})=>i):kR(e)?Boe(n.refs).value:$oe(no(e.value)?n.ref.value:e.value,n)}var DWe=(n,e,i,o)=>{const l={};for(const d of n){const p=un(e,d);p&&is(l,d,p._f)}return{criteriaMode:i,names:[...n],fields:l,shouldUseNativeValidation:o}},Aw=n=>no(n)?n:w1(n)?n.source:qs(n)?w1(n.value)?n.value.source:n.value:n;const TQ="AsyncFunction";var xWe=n=>!!n&&!!n.validate&&!!(Yh(n.validate)&&n.validate.constructor.name===TQ||qs(n.validate)&&Object.values(n.validate).find(e=>e.constructor.name===TQ)),LWe=n=>n.mount&&(n.required||n.min||n.max||n.maxLength||n.minLength||n.pattern||n.validate);function wQ(n,e,i){const o=un(n,i);if(o||T3(i))return{error:o,name:i};const l=i.split(".");for(;l.length;){const d=l.join("."),p=un(e,d),_=un(n,d);if(p&&!Array.isArray(p)&&i!==d)return{name:i};if(_&&_.type)return{name:d,error:_};l.pop()}return{name:i}}var MWe=(n,e,i,o,l)=>l.isOnAll?!1:!i&&l.isOnTouch?!(e||n):(i?o.isOnBlur:l.isOnBlur)?!n:(i?o.isOnChange:l.isOnChange)?n:!0,UWe=(n,e)=>!UN(un(n,e)).length&&To(n,e);const VWe={mode:Ud.onSubmit,reValidateMode:Ud.onChange,shouldFocusError:!0};function FWe(n={}){let e={...VWe,...n},i={submitCount:0,isDirty:!1,isLoading:Yh(e.defaultValues),isValidating:!1,isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,touchedFields:{},dirtyFields:{},validatingFields:{},errors:e.errors||{},disabled:e.disabled||!1},o={},l=qs(e.defaultValues)||qs(e.values)?Lu(e.defaultValues||e.values)||{}:{},d=e.shouldUnregister?{}:Lu(l),p={action:!1,mount:!1,watch:!1},_={mount:new Set,disabled:new Set,unMount:new Set,array:new Set,watch:new Set},E,b=0;const C={isDirty:!1,dirtyFields:!1,validatingFields:!1,touchedFields:!1,isValidating:!1,isValid:!1,errors:!1},I={values:VU(),array:VU(),state:VU()},O=gQ(e.mode),L=gQ(e.reValidateMode),U=e.criteriaMode===Ud.all,B=Re=>Ve=>{clearTimeout(b),b=setTimeout(Re,Ve)},W=async Re=>{if(!e.disabled&&(C.isValid||Re)){const Ve=e.resolver?ol((await Z()).errors):await re(o,!0);Ve!==i.isValid&&I.state.next({isValid:Ve})}},J=(Re,Ve)=>{!e.disabled&&(C.isValidating||C.validatingFields)&&((Re||Array.from(_.mount)).forEach(Ge=>{Ge&&(Ve?is(i.validatingFields,Ge,Ve):To(i.validatingFields,Ge))}),I.state.next({validatingFields:i.validatingFields,isValidating:!ol(i.validatingFields)}))},$=(Re,Ve=[],Ge,ft,gt=!0,St=!0)=>{if(ft&&Ge&&!e.disabled){if(p.action=!0,St&&Array.isArray(un(o,Re))){const Wt=Ge(un(o,Re),ft.argA,ft.argB);gt&&is(o,Re,Wt)}if(St&&Array.isArray(un(i.errors,Re))){const Wt=Ge(un(i.errors,Re),ft.argA,ft.argB);gt&&is(i.errors,Re,Wt),UWe(i.errors,Re)}if(C.touchedFields&&St&&Array.isArray(un(i.touchedFields,Re))){const Wt=Ge(un(i.touchedFields,Re),ft.argA,ft.argB);gt&&is(i.touchedFields,Re,Wt)}C.dirtyFields&&(i.dirtyFields=Iw(l,d)),I.state.next({name:Re,isDirty:he(Re,Ve),dirtyFields:i.dirtyFields,errors:i.errors,isValid:i.isValid})}else is(d,Re,Ve)},ie=(Re,Ve)=>{is(i.errors,Re,Ve),I.state.next({errors:i.errors})},ce=Re=>{i.errors=Re,I.state.next({errors:i.errors,isValid:!1})},ne=(Re,Ve,Ge,ft)=>{const gt=un(o,Re);if(gt){const St=un(d,Re,no(Ge)?un(l,Re):Ge);no(St)||ft&&ft.defaultChecked||Ve?is(d,Re,Ve?St:jU(gt._f)):We(Re,St),p.mount&&W()}},de=(Re,Ve,Ge,ft,gt)=>{let St=!1,Wt=!1;const mn={name:Re};if(!e.disabled){const vn=!!(un(o,Re)&&un(o,Re)._f&&un(o,Re)._f.disabled);if(!Ge||ft){C.isDirty&&(Wt=i.isDirty,i.isDirty=mn.isDirty=he(),St=Wt!==mn.isDirty);const tn=vn||wg(un(l,Re),Ve);Wt=!!(!vn&&un(i.dirtyFields,Re)),tn||vn?To(i.dirtyFields,Re):is(i.dirtyFields,Re,!0),mn.dirtyFields=i.dirtyFields,St=St||C.dirtyFields&&Wt!==!tn}if(Ge){const tn=un(i.touchedFields,Re);tn||(is(i.touchedFields,Re,Ge),mn.touchedFields=i.touchedFields,St=St||C.touchedFields&&tn!==Ge)}St&&gt&&I.state.next(mn)}return St?mn:{}},Q=(Re,Ve,Ge,ft)=>{const gt=un(i.errors,Re),St=C.isValid&&zh(Ve)&&i.isValid!==Ve;if(e.delayError&&Ge?(E=B(()=>ie(Re,Ge)),E(e.delayError)):(clearTimeout(b),E=null,Ge?is(i.errors,Re,Ge):To(i.errors,Re)),(Ge?!wg(gt,Ge):gt)||!ol(ft)||St){const Wt={...ft,...St&&zh(Ve)?{isValid:Ve}:{},errors:i.errors,name:Re};i={...i,...Wt},I.state.next(Wt)}},Z=async Re=>{J(Re,!0);const Ve=await e.resolver(d,e.context,DWe(Re||_.mount,o,e.criteriaMode,e.shouldUseNativeValidation));return J(Re),Ve},X=async Re=>{const{errors:Ve}=await Z(Re);if(Re)for(const Ge of Re){const ft=un(Ve,Ge);ft?is(i.errors,Ge,ft):To(i.errors,Ge)}else i.errors=Ve;return Ve},re=async(Re,Ve,Ge={valid:!0})=>{for(const ft in Re){const gt=Re[ft];if(gt){const{_f:St,...Wt}=gt;if(St){const mn=_.array.has(St.name),vn=gt._f&&xWe(gt._f);vn&&C.validatingFields&&J([ft],!0);const tn=await bQ(gt,_.disabled,d,U,e.shouldUseNativeValidation&&!Ve,mn);if(vn&&C.validatingFields&&J([ft]),tn[St.name]&&(Ge.valid=!1,Ve))break;!Ve&&(un(tn,St.name)?mn?PWe(i.errors,tn,St.name):is(i.errors,St.name,tn[St.name]):To(i.errors,St.name))}!ol(Wt)&&await re(Wt,Ve,Ge)}}return Ge.valid},pe=()=>{for(const Re of _.unMount){const Ve=un(o,Re);Ve&&(Ve._f.refs?Ve._f.refs.every(Ge=>!FU(Ge)):!FU(Ve._f.ref))&&Je(Re)}_.unMount=new Set},he=(Re,Ve)=>!e.disabled&&(Re&&Ve&&is(d,Re,Ve),!wg(Te(),l)),ue=(Re,Ve,Ge)=>IWe(Re,_,{...p.mount?d:no(Ve)?l:Zh(Re)?{[Re]:Ve}:Ve},Ge,Ve),xe=Re=>UN(un(p.mount?d:l,Re,e.shouldUnregister?un(l,Re,[]):[])),We=(Re,Ve,Ge={})=>{const ft=un(o,Re);let gt=Ve;if(ft){const St=ft._f;St&&(!St.disabled&&is(d,Re,$oe(Ve,St)),gt=T1(St.ref)&&wc(Ve)?"":Ve,zoe(St.ref)?[...St.ref.options].forEach(Wt=>Wt.selected=gt.includes(Wt.value)):St.refs?kR(St.ref)?St.refs.length>1?St.refs.forEach(Wt=>(!Wt.defaultChecked||!Wt.disabled)&&(Wt.checked=Array.isArray(gt)?!!gt.find(mn=>mn===Wt.value):gt===Wt.value)):St.refs[0]&&(St.refs[0].checked=!!gt):St.refs.forEach(Wt=>Wt.checked=Wt.value===gt):w3(St.ref)?St.ref.value="":(St.ref.value=gt,St.ref.type||I.values.next({name:Re,values:{...d}})))}(Ge.shouldDirty||Ge.shouldTouch)&&de(Re,gt,Ge.shouldTouch,Ge.shouldDirty,!0),Ge.shouldValidate&&ke(Re)},$e=(Re,Ve,Ge)=>{for(const ft in Ve){const gt=Ve[ft],St=`${Re}.${ft}`,Wt=un(o,St);(_.array.has(Re)||qs(gt)||Wt&&!Wt._f)&&!Ay(gt)?$e(St,gt,Ge):We(St,gt,Ge)}},ve=(Re,Ve,Ge={})=>{const ft=un(o,Re),gt=_.array.has(Re),St=Lu(Ve);is(d,Re,St),gt?(I.array.next({name:Re,values:{...d}}),(C.isDirty||C.dirtyFields)&&Ge.shouldDirty&&I.state.next({name:Re,dirtyFields:Iw(l,d),isDirty:he(Re,St)})):ft&&!ft._f&&!wc(St)?$e(Re,St,Ge):We(Re,St,Ge),_Q(Re,_)&&I.state.next({...i}),I.values.next({name:p.mount?Re:void 0,values:{...d}})},_e=async Re=>{p.mount=!0;const Ve=Re.target;let Ge=Ve.name,ft=!0;const gt=un(o,Ge),St=()=>Ve.type?jU(gt._f):vWe(Re),Wt=mn=>{ft=Number.isNaN(mn)||Ay(mn)&&isNaN(mn.getTime())||wg(mn,un(d,Ge,mn))};if(gt){let mn,vn;const tn=St(),vt=Re.type===mQ.BLUR||Re.type===mQ.FOCUS_OUT,nr=!LWe(gt._f)&&!e.resolver&&!un(i.errors,Ge)&&!gt._f.deps||MWe(vt,un(i.touchedFields,Ge),i.isSubmitted,L,O),Dt=_Q(Ge,_,vt);is(d,Ge,tn),vt?(gt._f.onBlur&&gt._f.onBlur(Re),E&&E(0)):gt._f.onChange&&gt._f.onChange(Re);const Ut=de(Ge,tn,vt,!1),gn=!ol(Ut)||Dt;if(!vt&&I.values.next({name:Ge,type:Re.type,values:{...d}}),nr)return C.isValid&&(e.mode==="onBlur"&&vt?W():vt||W()),gn&&I.state.next({name:Ge,...Dt?{}:Ut});if(!vt&&Dt&&I.state.next({...i}),e.resolver){const{errors:Li}=await Z([Ge]);if(Wt(tn),ft){const Es=wQ(i.errors,o,Ge),ci=wQ(Li,o,Es.name||Ge);mn=ci.error,Ge=ci.name,vn=ol(Li)}}else J([Ge],!0),mn=(await bQ(gt,_.disabled,d,U,e.shouldUseNativeValidation))[Ge],J([Ge]),Wt(tn),ft&&(mn?vn=!1:C.isValid&&(vn=await re(o,!0)));ft&&(gt._f.deps&&ke(gt._f.deps),Q(Ge,vn,mn,Ut))}},Ee=(Re,Ve)=>{if(un(i.errors,Ve)&&Re.focus)return Re.focus(),1},ke=async(Re,Ve={})=>{let Ge,ft;const gt=xk(Re);if(e.resolver){const St=await X(no(Re)?Re:gt);Ge=ol(St),ft=Re?!gt.some(Wt=>un(St,Wt)):Ge}else Re?(ft=(await Promise.all(gt.map(async St=>{const Wt=un(o,St);return await re(Wt&&Wt._f?{[St]:Wt}:Wt)}))).every(Boolean),!(!ft&&!i.isValid)&&W()):ft=Ge=await re(o);return I.state.next({...!Zh(Re)||C.isValid&&Ge!==i.isValid?{}:{name:Re},...e.resolver||!Re?{isValid:Ge}:{},errors:i.errors}),Ve.shouldFocus&&!ft&&bC(o,Ee,Re?gt:_.mount),ft},Te=Re=>{const Ve={...p.mount?d:l};return no(Re)?Ve:Zh(Re)?un(Ve,Re):Re.map(Ge=>un(Ve,Ge))},be=(Re,Ve)=>({invalid:!!un((Ve||i).errors,Re),isDirty:!!un((Ve||i).dirtyFields,Re),error:un((Ve||i).errors,Re),isValidating:!!un(i.validatingFields,Re),isTouched:!!un((Ve||i).touchedFields,Re)}),Pe=Re=>{Re&&xk(Re).forEach(Ve=>To(i.errors,Ve)),I.state.next({errors:Re?i.errors:{}})},Le=(Re,Ve,Ge)=>{const ft=(un(o,Re,{_f:{}})._f||{}).ref,gt=un(i.errors,Re)||{},{ref:St,message:Wt,type:mn,...vn}=gt;is(i.errors,Re,{...vn,...Ve,ref:ft}),I.state.next({name:Re,errors:i.errors,isValid:!1}),Ge&&Ge.shouldFocus&&ft&&ft.focus&&ft.focus()},ze=(Re,Ve)=>Yh(Re)?I.values.subscribe({next:Ge=>Re(ue(void 0,Ve),Ge)}):ue(Re,Ve,!0),Je=(Re,Ve={})=>{for(const Ge of Re?xk(Re):_.mount)_.mount.delete(Ge),_.array.delete(Ge),Ve.keepValue||(To(o,Ge),To(d,Ge)),!Ve.keepError&&To(i.errors,Ge),!Ve.keepDirty&&To(i.dirtyFields,Ge),!Ve.keepTouched&&To(i.touchedFields,Ge),!Ve.keepIsValidating&&To(i.validatingFields,Ge),!e.shouldUnregister&&!Ve.keepDefaultValue&&To(l,Ge);I.values.next({values:{...d}}),I.state.next({...i,...Ve.keepDirty?{isDirty:he()}:{}}),!Ve.keepIsValid&&W()},et=({disabled:Re,name:Ve,field:Ge,fields:ft})=>{(zh(Re)&&p.mount||Re||_.disabled.has(Ve))&&(Re?_.disabled.add(Ve):_.disabled.delete(Ve),de(Ve,jU(Ge?Ge._f:un(ft,Ve)._f),!1,!1,!0))},ut=(Re,Ve={})=>{let Ge=un(o,Re);const ft=zh(Ve.disabled)||zh(e.disabled);return is(o,Re,{...Ge||{},_f:{...Ge&&Ge._f?Ge._f:{ref:{name:Re}},name:Re,mount:!0,...Ve}}),_.mount.add(Re),Ge?et({field:Ge,disabled:zh(Ve.disabled)?Ve.disabled:e.disabled,name:Re}):ne(Re,!0,Ve.value),{...ft?{disabled:Ve.disabled||e.disabled}:{},...e.progressive?{required:!!Ve.required,min:Aw(Ve.min),max:Aw(Ve.max),minLength:Aw(Ve.minLength),maxLength:Aw(Ve.maxLength),pattern:Aw(Ve.pattern)}:{},name:Re,onChange:_e,onBlur:_e,ref:gt=>{if(gt){ut(Re,Ve),Ge=un(o,Re);const St=no(gt.value)&&gt.querySelectorAll&&gt.querySelectorAll("input,select,textarea")[0]||gt,Wt=NWe(St),mn=Ge._f.refs||[];if(Wt?mn.find(vn=>vn===St):St===Ge._f.ref)return;is(o,Re,{_f:{...Ge._f,...Wt?{refs:[...mn.filter(FU),St,...Array.isArray(un(l,Re))?[{}]:[]],ref:{type:St.type,name:Re}}:{ref:St}}}),ne(Re,!1,void 0,St)}else Ge=un(o,Re,{}),Ge._f&&(Ge._f.mount=!1),(e.shouldUnregister||Ve.shouldUnregister)&&!(bWe(_.array,Re)&&p.action)&&_.unMount.add(Re)}}},rt=()=>e.shouldFocusError&&bC(o,Ee,_.mount),It=Re=>{zh(Re)&&(I.state.next({disabled:Re}),bC(o,(Ve,Ge)=>{const ft=un(o,Ge);ft&&(Ve.disabled=ft._f.disabled||Re,Array.isArray(ft._f.refs)&&ft._f.refs.forEach(gt=>{gt.disabled=ft._f.disabled||Re}))},0,!1))},pn=(Re,Ve)=>async Ge=>{let ft;Ge&&(Ge.preventDefault&&Ge.preventDefault(),Ge.persist&&Ge.persist());let gt=Lu(d);if(_.disabled.size)for(const St of _.disabled)is(gt,St,void 0);if(I.state.next({isSubmitting:!0}),e.resolver){const{errors:St,values:Wt}=await Z();i.errors=St,gt=Wt}else await re(o);if(To(i.errors,"root"),ol(i.errors)){I.state.next({errors:{}});try{await Re(gt,Ge)}catch(St){ft=St}}else Ve&&await Ve({...i.errors},Ge),rt(),setTimeout(rt);if(I.state.next({isSubmitted:!0,isSubmitting:!1,isSubmitSuccessful:ol(i.errors)&&!ft,submitCount:i.submitCount+1,errors:i.errors}),ft)throw ft},Ft=(Re,Ve={})=>{un(o,Re)&&(no(Ve.defaultValue)?ve(Re,Lu(un(l,Re))):(ve(Re,Ve.defaultValue),is(l,Re,Lu(Ve.defaultValue))),Ve.keepTouched||To(i.touchedFields,Re),Ve.keepDirty||(To(i.dirtyFields,Re),i.isDirty=Ve.defaultValue?he(Re,Lu(un(l,Re))):he()),Ve.keepError||(To(i.errors,Re),C.isValid&&W()),I.state.next({...i}))},an=(Re,Ve={})=>{const Ge=Re?Lu(Re):l,ft=Lu(Ge),gt=ol(Re),St=gt?l:ft;if(Ve.keepDefaultValues||(l=Ge),!Ve.keepValues){if(Ve.keepDirtyValues){const Wt=new Set([..._.mount,...Object.keys(Iw(l,d))]);for(const mn of Array.from(Wt))un(i.dirtyFields,mn)?is(St,mn,un(d,mn)):ve(mn,un(St,mn))}else{if(b3&&no(Re))for(const Wt of _.mount){const mn=un(o,Wt);if(mn&&mn._f){const vn=Array.isArray(mn._f.refs)?mn._f.refs[0]:mn._f.ref;if(T1(vn)){const tn=vn.closest("form");if(tn){tn.reset();break}}}}o={}}d=e.shouldUnregister?Ve.keepDefaultValues?Lu(l):{}:Lu(St),I.array.next({values:{...St}}),I.values.next({values:{...St}})}_={mount:Ve.keepDirtyValues?_.mount:new Set,unMount:new Set,array:new Set,disabled:new Set,watch:new Set,watchAll:!1,focus:""},p.mount=!C.isValid||!!Ve.keepIsValid||!!Ve.keepDirtyValues,p.watch=!!e.shouldUnregister,I.state.next({submitCount:Ve.keepSubmitCount?i.submitCount:0,isDirty:gt?!1:Ve.keepDirty?i.isDirty:!!(Ve.keepDefaultValues&&!wg(Re,l)),isSubmitted:Ve.keepIsSubmitted?i.isSubmitted:!1,dirtyFields:gt?{}:Ve.keepDirtyValues?Ve.keepDefaultValues&&d?Iw(l,d):i.dirtyFields:Ve.keepDefaultValues&&Re?Iw(l,Re):Ve.keepDirty?i.dirtyFields:{},touchedFields:Ve.keepTouched?i.touchedFields:{},errors:Ve.keepErrors?i.errors:{},isSubmitSuccessful:Ve.keepIsSubmitSuccessful?i.isSubmitSuccessful:!1,isSubmitting:!1})},en=(Re,Ve)=>an(Yh(Re)?Re(d):Re,Ve);return{control:{register:ut,unregister:Je,getFieldState:be,handleSubmit:pn,setError:Le,_executeSchema:Z,_getWatch:ue,_getDirty:he,_updateValid:W,_removeUnmounted:pe,_updateFieldArray:$,_updateDisabledField:et,_getFieldArray:xe,_reset:an,_resetDefaultValues:()=>Yh(e.defaultValues)&&e.defaultValues().then(Re=>{en(Re,e.resetOptions),I.state.next({isLoading:!1})}),_updateFormState:Re=>{i={...i,...Re}},_disableForm:It,_subjects:I,_proxyFormState:C,_setErrors:ce,get _fields(){return o},get _formValues(){return d},get _state(){return p},set _state(Re){p=Re},get _defaultValues(){return l},get _names(){return _},set _names(Re){_=Re},get _formState(){return i},set _formState(Re){i=Re},get _options(){return e},set _options(Re){e={...e,...Re}}},trigger:ke,register:ut,handleSubmit:pn,watch:ze,setValue:ve,getValues:Te,reset:en,resetField:Ft,clearErrors:Pe,unregister:Je,setError:Le,setFocus:(Re,Ve={})=>{const Ge=un(o,Re),ft=Ge&&Ge._f;if(ft){const gt=ft.refs?ft.refs[0]:ft.ref;gt.focus&&(gt.focus(),Ve.shouldSelect&&Yh(gt.select)&&gt.select())}},getFieldState:be}}function Koe(n={}){const e=mi.useRef(void 0),i=mi.useRef(void 0),[o,l]=mi.useState({isDirty:!1,isValidating:!1,isLoading:Yh(n.defaultValues),isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,submitCount:0,dirtyFields:{},touchedFields:{},validatingFields:{},errors:n.errors||{},disabled:n.disabled||!1,defaultValues:Yh(n.defaultValues)?void 0:n.defaultValues});e.current||(e.current={...FWe(n),formState:o});const d=e.current.control;return d._options=n,RWe({subject:d._subjects.state,next:p=>{CWe(p,d._proxyFormState,d._updateFormState)&&l({...d._formState})}}),mi.useEffect(()=>d._disableForm(n.disabled),[d,n.disabled]),mi.useEffect(()=>{if(d._proxyFormState.isDirty){const p=d._getDirty();p!==o.isDirty&&d._subjects.state.next({isDirty:p})}},[d,o.isDirty]),mi.useEffect(()=>{n.values&&!wg(n.values,i.current)?(d._reset(n.values,d._options.resetOptions),i.current=n.values,l(p=>({...p}))):d._resetDefaultValues()},[n.values,d]),mi.useEffect(()=>{n.errors&&d._setErrors(n.errors)},[n.errors,d]),mi.useEffect(()=>{d._state.mount||(d._updateValid(),d._state.mount=!0),d._state.watch&&(d._state.watch=!1,d._subjects.state.next({...d._formState})),d._removeUnmounted()}),mi.useEffect(()=>{n.shouldUnregister&&d._subjects.values.next({values:d._getWatch()})},[n.shouldUnregister,d]),e.current.formState=wWe(o,d),e.current}var jWe=["sitekey","onChange","theme","type","tabindex","onExpired","onErrored","size","stoken","grecaptcha","badge","hl","isolated"];function bF(){return bF=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])}return n},bF.apply(this,arguments)}function BWe(n,e){if(n==null)return{};var i={},o=Object.keys(n),l,d;for(d=0;d<o.length;d++)l=o[d],!(e.indexOf(l)>=0)&&(i[l]=n[l]);return i}function $O(n){if(n===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}function WWe(n,e){n.prototype=Object.create(e.prototype),n.prototype.constructor=n,TF(n,e)}function TF(n,e){return TF=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(o,l){return o.__proto__=l,o},TF(n,e)}var VN=function(n){WWe(e,n);function e(){var o;return o=n.call(this)||this,o.handleExpired=o.handleExpired.bind($O(o)),o.handleErrored=o.handleErrored.bind($O(o)),o.handleChange=o.handleChange.bind($O(o)),o.handleRecaptchaRef=o.handleRecaptchaRef.bind($O(o)),o}var i=e.prototype;return i.getCaptchaFunction=function(l){return this.props.grecaptcha?this.props.grecaptcha.enterprise?this.props.grecaptcha.enterprise[l]:this.props.grecaptcha[l]:null},i.getValue=function(){var l=this.getCaptchaFunction("getResponse");return l&&this._widgetId!==void 0?l(this._widgetId):null},i.getWidgetId=function(){return this.props.grecaptcha&&this._widgetId!==void 0?this._widgetId:null},i.execute=function(){var l=this.getCaptchaFunction("execute");if(l&&this._widgetId!==void 0)return l(this._widgetId);this._executeRequested=!0},i.executeAsync=function(){var l=this;return new Promise(function(d,p){l.executionResolve=d,l.executionReject=p,l.execute()})},i.reset=function(){var l=this.getCaptchaFunction("reset");l&&this._widgetId!==void 0&&l(this._widgetId)},i.forceReset=function(){var l=this.getCaptchaFunction("reset");l&&l()},i.handleExpired=function(){this.props.onExpired?this.props.onExpired():this.handleChange(null)},i.handleErrored=function(){this.props.onErrored&&this.props.onErrored(),this.executionReject&&(this.executionReject(),delete this.executionResolve,delete this.executionReject)},i.handleChange=function(l){this.props.onChange&&this.props.onChange(l),this.executionResolve&&(this.executionResolve(l),delete this.executionReject,delete this.executionResolve)},i.explicitRender=function(){var l=this.getCaptchaFunction("render");if(l&&this._widgetId===void 0){var d=document.createElement("div");this._widgetId=l(d,{sitekey:this.props.sitekey,callback:this.handleChange,theme:this.props.theme,type:this.props.type,tabindex:this.props.tabindex,"expired-callback":this.handleExpired,"error-callback":this.handleErrored,size:this.props.size,stoken:this.props.stoken,hl:this.props.hl,badge:this.props.badge,isolated:this.props.isolated}),this.captcha.appendChild(d)}this._executeRequested&&this.props.grecaptcha&&this._widgetId!==void 0&&(this._executeRequested=!1,this.execute())},i.componentDidMount=function(){this.explicitRender()},i.componentDidUpdate=function(){this.explicitRender()},i.handleRecaptchaRef=function(l){this.captcha=l},i.render=function(){var l=this.props;l.sitekey,l.onChange,l.theme,l.type,l.tabindex,l.onExpired,l.onErrored,l.size,l.stoken,l.grecaptcha,l.badge,l.hl,l.isolated;var d=BWe(l,jWe);return N.createElement("div",bF({},d,{ref:this.handleRecaptchaRef}))},e}(N.Component);VN.displayName="ReCAPTCHA";VN.propTypes={sitekey:_n.string.isRequired,onChange:_n.func,grecaptcha:_n.object,theme:_n.oneOf(["dark","light"]),type:_n.oneOf(["image","audio"]),tabindex:_n.number,onExpired:_n.func,onErrored:_n.func,size:_n.oneOf(["compact","normal","invisible"]),stoken:_n.string,hl:_n.string,badge:_n.oneOf(["bottomright","bottomleft","inline"]),isolated:_n.bool};VN.defaultProps={onChange:function(){},theme:"light",type:"image",tabindex:0,size:"normal",badge:"bottomright"};function wF(){return wF=Object.assign||function(n){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])}return n},wF.apply(this,arguments)}function zWe(n,e){if(n==null)return{};var i={},o=Object.keys(n),l,d;for(d=0;d<o.length;d++)l=o[d],!(e.indexOf(l)>=0)&&(i[l]=n[l]);return i}function GWe(n,e){n.prototype=Object.create(e.prototype),n.prototype.constructor=n,n.__proto__=e}var Nd={},HWe=0;function $We(n,e){return e=e||{},function(o){var l=o.displayName||o.name||"Component",d=function(_){GWe(E,_);function E(C,I){var O;return O=_.call(this,C,I)||this,O.state={},O.__scriptURL="",O}var b=E.prototype;return b.asyncScriptLoaderGetScriptLoaderID=function(){return this.__scriptLoaderID||(this.__scriptLoaderID="async-script-loader-"+HWe++),this.__scriptLoaderID},b.setupScriptURL=function(){return this.__scriptURL=typeof n=="function"?n():n,this.__scriptURL},b.asyncScriptLoaderHandleLoad=function(I){var O=this;this.setState(I,function(){return O.props.asyncScriptOnLoad&&O.props.asyncScriptOnLoad(O.state)})},b.asyncScriptLoaderTriggerOnScriptLoaded=function(){var I=Nd[this.__scriptURL];if(!I||!I.loaded)throw new Error("Script is not loaded.");for(var O in I.observers)I.observers[O](I);delete window[e.callbackName]},b.componentDidMount=function(){var I=this,O=this.setupScriptURL(),L=this.asyncScriptLoaderGetScriptLoaderID(),U=e,B=U.globalName,W=U.callbackName,J=U.scriptId;if(B&&typeof window[B]<"u"&&(Nd[O]={loaded:!0,observers:{}}),Nd[O]){var $=Nd[O];if($&&($.loaded||$.errored)){this.asyncScriptLoaderHandleLoad($);return}$.observers[L]=function(Q){return I.asyncScriptLoaderHandleLoad(Q)};return}var ie={};ie[L]=function(Q){return I.asyncScriptLoaderHandleLoad(Q)},Nd[O]={loaded:!1,observers:ie};var ce=document.createElement("script");ce.src=O,ce.async=!0;for(var ne in e.attributes)ce.setAttribute(ne,e.attributes[ne]);J&&(ce.id=J);var de=function(Z){if(Nd[O]){var X=Nd[O],re=X.observers;for(var pe in re)Z(re[pe])&&delete re[pe]}};W&&typeof window<"u"&&(window[W]=function(){return I.asyncScriptLoaderTriggerOnScriptLoaded()}),ce.onload=function(){var Q=Nd[O];Q&&(Q.loaded=!0,de(function(Z){return W?!1:(Z(Q),!0)}))},ce.onerror=function(){var Q=Nd[O];Q&&(Q.errored=!0,de(function(Z){return Z(Q),!0}))},document.body.appendChild(ce)},b.componentWillUnmount=function(){var I=this.__scriptURL;if(e.removeOnUnmount===!0)for(var O=document.getElementsByTagName("script"),L=0;L<O.length;L+=1)O[L].src.indexOf(I)>-1&&O[L].parentNode&&O[L].parentNode.removeChild(O[L]);var U=Nd[I];U&&(delete U.observers[this.asyncScriptLoaderGetScriptLoaderID()],e.removeOnUnmount===!0&&delete Nd[I])},b.render=function(){var I=e.globalName,O=this.props;O.asyncScriptOnLoad;var L=O.forwardedRef,U=zWe(O,["asyncScriptOnLoad","forwardedRef"]);return I&&typeof window<"u"&&(U[I]=typeof window[I]<"u"?window[I]:void 0),U.ref=L,N.createElement(o,U)},E}(N.Component),p=N.forwardRef(function(_,E){return N.createElement(d,wF({},_,{forwardedRef:E}))});return p.displayName="AsyncScriptLoader("+l+")",p.propTypes={asyncScriptOnLoad:_n.func},kIe(p,o)}}var CF="onloadcallback",KWe="grecaptcha";function RF(){return typeof window<"u"&&window.recaptchaOptions||{}}function qWe(){var n=RF(),e=n.useRecaptchaNet?"recaptcha.net":"www.google.com";return n.enterprise?"https://"+e+"/recaptcha/enterprise.js?onload="+CF+"&render=explicit":"https://"+e+"/recaptcha/api.js?onload="+CF+"&render=explicit"}const qoe=$We(qWe,{callbackName:CF,globalName:KWe,attributes:RF().nonce?{nonce:RF().nonce}:{}})(VN),FN=(n,e="generic-modal")=>{N.useEffect(()=>{if(!window.unityInstance)return;const i=()=>{try{window.unityInstance.SendMessage("WebGLInputManager","Disable"),q.log(`Unity input disabled for ${e}`),document.body.classList.add("unity-input-disabled"),window.unityInputDisabled=!0,window.unityInputDisabledBy=e}catch(l){q.error(`Failed to disable Unity input for ${e}:`,l)}},o=()=>{try{window.unityInputDisabledBy===e?(window.unityInstance.SendMessage("WebGLInputManager","Enable"),q.log(`Unity input re-enabled (was disabled by ${e})`),document.body.classList.remove("unity-input-disabled"),window.unityInputDisabled=!1,window.unityInputDisabledBy=null):q.log(`Not re-enabling Unity input for ${e} because it was disabled by ${window.unityInputDisabledBy}`)}catch(l){q.error(`Failed to enable Unity input for ${e}:`,l)}};return n?i():o(),()=>{n&&o()}},[n,e])},Yoe=({isOpen:n,onClose:e,userData:i,onConfirm:o,fullscreenRef:l})=>{const[d,p]=N.useState((i==null?void 0:i.username)||""),[_,E]=N.useState((i==null?void 0:i.Nickname)||""),[b,C]=N.useState(!1),[I,O]=N.useState(null),[L,U]=N.useState(!1),B=Ic(),W=ce=>!(!ce||ce.trim()===""||!/^[a-z0-9]{1,15}$/.test(ce)),J=async ce=>{var ne,de;if(!W(ce))return!ce||ce.trim()===""?O("Username cannot be empty"):O("Username must be 1-15 characters, lowercase letters and numbers only"),!1;C(!0),O(null);try{let Q=!1,Z=0;const X=3;for(;Z<X;)try{Q=await QC(ce);break}catch(re){if(q.error(`Attempt ${Z+1}: Error checking username:`,re),Z++,Z>=X)throw re;await new Promise(pe=>setTimeout(pe,1e3))}return Q?(O("Username is already taken"),!1):!0}catch(Q){return q.error("Error checking username after retries:",Q),Q.code==="permission-denied"||(ne=Q.message)!=null&&ne.includes("permissions")?O("Username check unavailable. Please try again or pick a unique name."):O("Error checking username availability. Please try again."),Q.code==="permission-denied"||((de=Q.message)==null?void 0:de.includes("permissions"))}finally{C(!1)}};N.useEffect(()=>{if(!d){O("Username cannot be empty");return}if(d!==(i==null?void 0:i.username)){const ce=setTimeout(async()=>{await J(d)},500);return()=>clearTimeout(ce)}},[d]),N.useEffect(()=>{if(i&&i.firstName&&i.lastName){const ce=`${i.firstName}${i.lastName.charAt(0).toUpperCase()}`;E(ce)}},[i]);const $=async()=>{U(!0);try{if(!await J(d)){U(!1);return}if(_.length>15){O("Display Name must be at most 15 characters"),U(!1);return}Vu(_),q.log("UsernameConfirmation: Preparing to confirm user registration");const ne=i.firstName&&i.lastName?`${i.firstName}${i.lastName.charAt(0).toUpperCase()}`:"",de={...i,firstName:i.firstName||"",lastName:i.lastName||"",companyName:i.companyName||"",linkedInProfile:i.linkedInProfile||"",username:d,Nickname:_||ne,email:i.email,password:i.password};q.log("UsernameConfirmation: Processed registration data with fields:",Object.keys(de).join(", ")),await o(de),e()}catch(ce){q.error("Error during username confirmation:",ce),B({title:"Error",description:"An error occurred. Please try again.",status:"error",duration:3e3,isClosable:!0})}finally{U(!1)}},ie=()=>{L||e()};return w.jsxs(oo,{isOpen:n,onClose:ie,size:"md",portalProps:{containerRef:l},isCentered:!0,motionPreset:"slideInBottom",closeOnOverlayClick:!L,closeOnEsc:!L,children:[w.jsx(co,{bg:"blackAlpha.800",backdropFilter:"blur(5px)"}),w.jsxs(ao,{bg:"gray.800",borderRadius:"xl",boxShadow:"xl",color:"white",maxW:"md",mx:4,position:"relative",children:[w.jsxs(tc,{children:[w.jsx(WC,{size:"lg",mb:2,children:"Customize Your Profile"}),w.jsx(Ze,{fontSize:"sm",color:"gray.400",children:"Set your username and nickname"})]}),w.jsx(Ko,{color:"gray.400",isDisabled:L}),w.jsx(Ro,{children:w.jsxs(Qr,{spacing:6,align:"stretch",children:[w.jsxs(kr,{isInvalid:!!I,children:[w.jsx($i,{children:"Username"}),w.jsxs(Rg,{children:[w.jsx(q1,{bg:"gray.700",color:"gray.400",border:"none",children:"@"}),w.jsx(oi,{placeholder:"username",value:d,onChange:ce=>p(ce.target.value.toLowerCase()),bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},maxLength:15})]}),I?w.jsx($h,{children:I}):w.jsx(Uy,{color:"gray.400",children:"Lowercase letters and numbers only, max 15 characters"})]}),w.jsxs(kr,{children:[w.jsx($i,{children:"Nickname"}),w.jsx(oi,{placeholder:"Nickname",value:_,onChange:ce=>E(ce.target.value),bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},maxLength:15}),w.jsx(Uy,{color:"gray.400",children:"This is the name shown to others, max 15 characters"})]})]})}),w.jsx($p,{children:w.jsxs(wr,{gap:3,width:"100%",children:[w.jsx(ur,{variant:"outline",onClick:ie,flex:"1",isDisabled:L,children:"Back"}),w.jsx(ur,{colorScheme:"blue",onClick:$,isLoading:L||b,isDisabled:!!I||!d||L,flex:"2",children:"Finish"})]})})]})]})};Yoe.propTypes={isOpen:_n.bool.isRequired,onClose:_n.func.isRequired,userData:_n.object.isRequired,onConfirm:_n.func.isRequired,fullscreenRef:_n.object};const YWe="6Le4oQUrAAAAAHe0GMH5Z0tpuqTV2qqDzK9Yk4Uv";function jN({mode:n,label:e,buttonProps:i={},isOpen:o,onClose:l}){const{register:d,handleSubmit:p,formState:{errors:_}}=Koe(),{register:E}=N.useContext(Ao),b=Ic(),{fullscreenRef:C}=Gd(),[I,O]=N.useState(!1),[L,U]=N.useState(!1),[B,W]=N.useState(null),J=N.useRef(null),[$,ie]=N.useState(!1),[ce,ne]=N.useState(null),[de,Q]=N.useState(!1),Z=o!==void 0?o:I,X=l||(()=>O(!1));FN(Z||$),N.useEffect(()=>{!Z&&J.current&&(J.current.reset(),W(null))},[Z]);const re=We=>{W(We)},pe=async We=>{q.log("Register.jsx: Processing registration form submission");const{email:$e,password:ve,confirmPassword:_e,...Ee}=We;if(q.log("Register.jsx: Registration data fields:",Object.keys(Ee).join(", ")),!B){b({title:"Verification Required",description:"Please complete the reCAPTCHA verification.",status:"error",duration:3e3,isClosable:!0,position:"top"});return}if(ve!==_e){b({title:"Error",description:"Passwords do not match.",status:"error",duration:3e3,isClosable:!0,position:"top"});return}Vu(Ee.firstName),Vu(Ee.lastName),Vu(Ee.companyName),U(!0);try{const ke=await MBe(Ee.firstName||"",Ee.lastName||""),Te=Ee.firstName&&Ee.lastName?`${Ee.firstName}${Ee.lastName.charAt(0).toUpperCase()}`:"";Te&&Vu(Te),q.log("Register.jsx: Generated username and nickname for new user");const be={...Ee,firstName:Ee.firstName||"",lastName:Ee.lastName||"",companyName:Ee.companyName||"",linkedInProfile:Ee.linkedInProfile||"",email:$e,password:ve,username:ke,Nickname:Te,captchaToken:B};q.log("Register.jsx: Prepared registration data with fields:",Object.keys(be).join(", ")),ne(be),ie(!0)}catch(ke){q.error("User: Registration Error:",ke);let Te="An error occurred during registration. Please try again.",be=!1;ke.code==="auth/email-already-in-use"?(Te="This email address is already registered. Please sign in instead.",be=!0):ke.code==="auth/invalid-email"?Te="The email address is not valid. Please check and try again.":ke.code==="auth/weak-password"?Te="The password is too weak. Please choose a stronger password.":ke.message&&(Te=ke.message),b({title:"Registration Failed",description:w.jsxs(w.Fragment,{children:[Te,be&&w.jsx(Ze,{mt:2,children:w.jsx(Fl,{color:"blue.400",onClick:()=>{X(),window.dispatchEvent(new CustomEvent("openSignInModal"))},children:"Go to Sign In"})})]}),status:"error",duration:5e3,isClosable:!0,position:"top"})}finally{U(!1),J.current&&J.current.reset()}},he=async We=>{U(!0);try{q.log("Register.jsx: Completing registration with confirmed username");const{email:$e,password:ve,..._e}=We,Ee={..._e,firstName:_e.firstName||"",lastName:_e.lastName||"",companyName:_e.companyName||"",linkedInProfile:_e.linkedInProfile||"",username:_e.username||"",Nickname:_e.Nickname||""};q.log("Register.jsx: Final registration data includes fields:",Object.keys(Ee).join(", "));const ke=await E($e,ve,Ee);X(),ie(!1),q.log("User: Registration process complete."),b({title:"Registration Successful",description:"Please check your email for a verification link. You'll need to verify your email before signing in.",status:"success",duration:8e3,isClosable:!0,position:"top"}),ne(null),Q(!1)}catch($e){q.error("User: Registration Error during final step:",$e);let ve="An error occurred during registration. Please try again.";$e.code==="auth/email-already-in-use"?ve="This email address is already in use. Please try another one.":$e.message&&(ve=$e.message),b({title:"Registration Failed",description:ve,status:"error",duration:5e3,isClosable:!0,position:"top"}),ie(!1),ne(null),Q(!1)}finally{U(!1)}},ue=()=>{l?l():O(!I)},xe=n==="link"?w.jsx(Fl,{variant:"header",onClick:ue,children:e}):w.jsx(ur,{onClick:ue,...i,children:e});return w.jsxs(w.Fragment,{children:[!o&&xe,w.jsxs(oo,{isOpen:Z&&!$,onClose:X,size:"md",portalProps:{containerRef:C},isCentered:!0,motionPreset:"slideInBottom",blockScrollOnMount:!1,children:[w.jsx(co,{bg:"blackAlpha.800",backdropFilter:"blur(5px)"}),w.jsxs(ao,{bg:"gray.800",borderRadius:"xl",boxShadow:"xl",color:"white",maxW:"md",mx:4,position:"relative",zIndex:9999,sx:{isolation:"isolate","& input":{position:"relative",zIndex:1e4,isolation:"isolate"},"& *":{pointerEvents:"auto !important"}},onKeyDown:We=>{We.stopPropagation()},children:[w.jsxs(tc,{p:8,textAlign:"center",children:[w.jsx(WC,{size:"lg",mb:2,children:"Create Account"}),w.jsx(Ze,{fontSize:"sm",color:"gray.400",children:"Fill in your details to get started"})]}),w.jsx(Ko,{color:"gray.400"}),w.jsx(Ro,{px:8,children:w.jsx("form",{onSubmit:p(pe),children:w.jsxs(Qr,{spacing:4,children:[w.jsxs(kr,{isInvalid:_.companyName,isRequired:!0,children:[w.jsx(oi,{placeholder:"Company Name",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...d("companyName",{required:"Company name is required",setValueAs:We=>We===""?"":We})}),w.jsx($h,{children:_.companyName&&_.companyName.message})]}),w.jsxs(wr,{gap:4,w:"100%",children:[w.jsxs(kr,{isInvalid:_.firstName,isRequired:!0,children:[w.jsx(oi,{placeholder:"First Name",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...d("firstName",{required:"First name is required",setValueAs:We=>We===""?"":We})}),w.jsx($h,{children:_.firstName&&_.firstName.message})]}),w.jsxs(kr,{isInvalid:_.lastName,isRequired:!0,children:[w.jsx(oi,{placeholder:"Last Name",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...d("lastName",{required:"Last name is required",setValueAs:We=>We===""?"":We})}),w.jsx($h,{children:_.lastName&&_.lastName.message})]})]}),w.jsxs(kr,{isInvalid:_.email,isRequired:!0,children:[w.jsx(oi,{type:"email",placeholder:"Work Email Address",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...d("email",{required:"Email is required",pattern:{value:/^[^@ \t\r\n]+@[^@ \t\r\n]+\.[^@ \t\r\n]+$/,message:"Invalid email address"}})}),w.jsx($h,{children:_.email&&_.email.message})]}),w.jsxs(wr,{gap:4,w:"100%",children:[w.jsxs(kr,{isInvalid:_.password,isRequired:!0,children:[w.jsx(oi,{type:"password",placeholder:"Password",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...d("password",{required:"Password is required",minLength:{value:8,message:"Password must be at least 8 characters long"}})}),w.jsx($h,{children:_.password&&_.password.message})]}),w.jsxs(kr,{isInvalid:_.confirmPassword,isRequired:!0,children:[w.jsx(oi,{type:"password",placeholder:"Confirm Password",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...d("confirmPassword",{required:"Confirm password is required"})}),w.jsx($h,{children:_.confirmPassword&&_.confirmPassword.message})]})]}),w.jsx(kr,{children:w.jsx(oi,{placeholder:"LinkedIn Profile (optional)",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...d("linkedInProfile",{setValueAs:We=>We===""?"":We})})}),w.jsx(lt,{width:"100%",display:"flex",justifyContent:"center",my:4,children:w.jsx(qoe,{ref:J,sitekey:YWe,onChange:re,theme:"dark"})})]})})}),w.jsxs($p,{px:8,pb:8,flexDirection:"column",gap:4,children:[w.jsx(ur,{type:"submit",colorScheme:"blue",size:"lg",width:"100%",onClick:p(pe),isLoading:L,loadingText:"Processing",isDisabled:!B,children:"Next: Set Your Username"}),w.jsxs(Ze,{fontSize:"sm",color:"gray.400",textAlign:"center",children:["Already have an account?"," ",w.jsx(Fl,{color:"blue.400",onClick:()=>{X(),window.dispatchEvent(new CustomEvent("openSignInModal"))},children:"Sign In"})]})]})]})]}),$&&w.jsx(Yoe,{isOpen:$,onClose:()=>ie(!1),userData:ce,onConfirm:he,fullscreenRef:C,isRegistering:de})]})}jN.propTypes={mode:_n.oneOf(["button","link"]),label:_n.string,buttonProps:_n.object,isOpen:_n.bool,onClose:_n.func};const XWe="6Le4oQUrAAAAAHe0GMH5Z0tpuqTV2qqDzK9Yk4Uv";function BN({mode:n="button",label:e="Sign In",buttonProps:i={},initialIsOpen:o=!1}){const{signIn:l}=N.useContext(Ao),{fullscreenRef:d}=Gd(),p=Ic(),{register:_,handleSubmit:E,formState:{errors:b}}=Koe(),[C,I]=N.useState(!1),[O,L]=N.useState(o),[U,B]=N.useState(!1),[W,J]=N.useState(!1),[$,ie]=N.useState(""),[ce,ne]=N.useState(!1),[de,Q]=N.useState(null),Z=N.useRef(null);FN(O||W),N.useEffect(()=>{const $e=()=>{L(!0)};return window.addEventListener("openSignInModal",$e),()=>{window.removeEventListener("openSignInModal",$e)}},[]);const X=$e=>{Q($e)},re=async $e=>{if(!de){p({title:"Verification Required",description:"Please complete the reCAPTCHA verification.",status:"error",duration:3e3,isClosable:!0,position:"top"});return}I(!0);try{await l($e.email,$e.password,de),q.log("User: Sign-in process complete."),L(!1),window.location.reload()}catch(ve){q.error("User: SignIn Error:",ve);const _e=ve.message||"An error occurred while logging in. Please check your credentials.",Ee=_e.includes("verify your email");p({title:Ee?"Email Verification Required":"Error",description:_e,status:Ee?"warning":"error",duration:1e4,isClosable:!0,position:"top",container:d.current})}finally{I(!1),Z.current&&Z.current.reset()}},pe=async()=>{if(!$){p({title:"Email Required",description:"Please enter your email address to reset your password.",status:"warning",duration:3e3,isClosable:!0,position:"top",container:d.current});return}try{ne(!0),await tje(h3,$),p({title:"Password Reset Email Sent",description:"Check your email for instructions to reset your password.",status:"success",duration:5e3,isClosable:!0,position:"top",container:d.current}),J(!1)}catch($e){q.error("User: Reset Password Error:",$e),p({title:"Error",description:$e.message||"Failed to send password reset email. Please try again.",status:"error",duration:5e3,isClosable:!0,position:"top",container:d.current})}finally{ne(!1)}},he=()=>L($e=>!$e),ue=()=>{L(!1),B(!0)},xe=()=>{J(!0)},We=n==="link"?w.jsx(Fl,{variant:"header",onClick:he,children:e}):w.jsx(ur,{onClick:he,...i,children:e});return w.jsxs(w.Fragment,{children:[We,w.jsxs(oo,{isOpen:O,onClose:he,size:"md",portalProps:{containerRef:d},isCentered:!0,motionPreset:"slideInBottom",blockScrollOnMount:!1,children:[w.jsx(co,{bg:"blackAlpha.800",backdropFilter:"blur(5px)"}),w.jsx("form",{onSubmit:E(re),children:w.jsxs(ao,{bg:"gray.800",borderRadius:"xl",boxShadow:"xl",color:"white",maxW:"md",mx:4,position:"relative",zIndex:9999,sx:{isolation:"isolate","& input":{position:"relative",zIndex:1e4,isolation:"isolate"},"& *":{pointerEvents:"auto !important"}},onKeyDown:$e=>{$e.stopPropagation()},children:[w.jsxs(tc,{p:8,textAlign:"center",children:[w.jsx(WC,{size:"lg",mb:2,children:"Welcome Back"}),w.jsx(Ze,{fontSize:"sm",color:"gray.400",children:"Enter your credentials to access your account"})]}),w.jsx(Ko,{color:"gray.400"}),w.jsx(Ro,{px:8,pb:8,children:w.jsxs(Qr,{spacing:4,children:[w.jsxs(kr,{isInvalid:b.email,children:[w.jsxs(Rg,{children:[w.jsx(pC,{pointerEvents:"none",children:w.jsx(pQ,{color:"gray.500"})}),w.jsx(oi,{type:"email",placeholder:"Email",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},..._("email",{required:"Email is required."})})]}),w.jsx($h,{children:b.email&&b.email.message})]}),w.jsxs(kr,{isInvalid:b.password,children:[w.jsxs(Rg,{children:[w.jsx(pC,{pointerEvents:"none",children:w.jsx(gWe,{color:"gray.500"})}),w.jsx(oi,{type:"password",placeholder:"Password",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},..._("password",{required:"Password is required."})})]}),w.jsx($h,{children:b.password&&b.password.message})]}),w.jsx(lt,{alignSelf:"flex-end",children:w.jsx(Fl,{color:"blue.400",fontSize:"sm",onClick:xe,children:"Forgot Password?"})}),w.jsx(wr,{width:"100%",justifyContent:"center",my:4,children:w.jsx(qoe,{ref:Z,sitekey:XWe,onChange:X,theme:"dark"})})]})}),w.jsxs($p,{px:8,pb:8,flexDirection:"column",gap:4,children:[w.jsx(ur,{type:"submit",colorScheme:"blue",size:"lg",width:"100%",isLoading:C,loadingText:"Signing In",isDisabled:!de,children:"Sign In"}),w.jsxs(Ze,{fontSize:"sm",color:"gray.400",textAlign:"center",children:["Don't have an account?"," ",w.jsx(Fl,{color:"blue.400",onClick:ue,children:"Sign Up"})]})]})]})})]}),w.jsxs(oo,{isOpen:W,onClose:()=>J(!1),size:"md",portalProps:{containerRef:d},isCentered:!0,motionPreset:"slideInBottom",blockScrollOnMount:!1,children:[w.jsx(co,{bg:"blackAlpha.800",backdropFilter:"blur(5px)"}),w.jsxs(ao,{bg:"gray.800",borderRadius:"xl",boxShadow:"xl",color:"white",maxW:"md",mx:4,position:"relative",zIndex:9999,sx:{isolation:"isolate","& input":{position:"relative",zIndex:1e4,isolation:"isolate"},"& *":{pointerEvents:"auto !important"}},onKeyDown:$e=>{$e.stopPropagation()},children:[w.jsxs(tc,{p:8,textAlign:"center",children:[w.jsx(WC,{size:"lg",mb:2,children:"Reset Password"}),w.jsx(Ze,{fontSize:"sm",color:"gray.400",children:"Enter your email to receive password reset instructions"})]}),w.jsx(Ko,{color:"gray.400"}),w.jsx(Ro,{px:8,pb:4,children:w.jsx(kr,{children:w.jsxs(Rg,{children:[w.jsx(pC,{pointerEvents:"none",children:w.jsx(pQ,{color:"gray.500"})}),w.jsx(oi,{type:"email",placeholder:"Email",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},value:$,onChange:$e=>ie($e.target.value)})]})})}),w.jsxs($p,{px:8,pb:8,flexDirection:"column",gap:4,children:[w.jsx(ur,{colorScheme:"blue",size:"lg",width:"100%",onClick:pe,isLoading:ce,loadingText:"Sending",children:"Send Reset Link"}),w.jsxs(Ze,{fontSize:"sm",color:"gray.400",textAlign:"center",children:["Remember your password?"," ",w.jsx(Fl,{color:"blue.400",onClick:()=>J(!1),children:"Back to Sign In"})]})]})]})]}),w.jsx(jN,{mode:"link",isOpen:U,onClose:()=>B(!1)})]})}BN.propTypes={mode:_n.oneOf(["button","link"]),label:_n.string,buttonProps:_n.object,initialIsOpen:_n.bool};function R3({mode:n="button",label:e="Sign Out"}){const i=Ic(),{signOut:o}=N.useContext(Ao),{fullscreenRef:l}=Gd(),d=async()=>{try{await o(),i({title:"Logged Out",description:"You have been successfully logged out.",status:"success",duration:3e3,isClosable:!0,position:"top",container:l.current}),window.location.href="/"}catch(_){console.error("SignOut Error:",_),i({title:"Error",description:"An error occurred while logging out.",status:"error",duration:3e3,isClosable:!0,position:"top",container:l.current})}},p=n==="link"?w.jsx(Fl,{variant:"header",onClick:d,style:{cursor:"pointer"},children:e}):null;return w.jsx(w.Fragment,{children:p})}R3.propTypes={mode:_n.oneOf(["button","link"]),label:_n.string};const B0=()=>window.unityInstance||window.gameInstance||window.reactUnityInstance,I3=()=>{document.body.classList.add("unity-focused");const n=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight","Space","PageUp","PageDown","Home","End"],e=o=>{if(n.includes(o.key)){const l=o.target.tagName==="INPUT"||o.target.tagName==="TEXTAREA"||o.target.isContentEditable,d=document.querySelector("canvas")||document.getElementById("unity-canvas"),p=o.target.closest("canvas")||o.target.closest("#webgl-root"),_=document.activeElement===d;!l&&(p||_)&&o.preventDefault()}},i=o=>{document.querySelector("canvas")||document.getElementById("unity-canvas"),document.getElementById("unity-container")||document.getElementById("webgl-root"),o.target.closest("canvas")||o.target.closest("#webgl-root")?document.body.classList.add("unity-focused"):document.body.classList.remove("unity-focused")};return document.addEventListener("keydown",e),document.addEventListener("click",i),()=>{document.body.classList.remove("unity-focused"),document.removeEventListener("keydown",e),document.removeEventListener("click",i)}},Xoe=()=>{document.body.classList.remove("unity-focused")};function R1(n){return console.log(`Setting Unity keyboard capture: ${n}`),n?(document.body.classList.add("unity-focused"),window.unityKeyboardEnabled=!0):(document.body.classList.remove("unity-focused"),window.unityKeyboardEnabled=!1),n?I3():Xoe(),new Promise(e=>{try{const i=B0();if(i){try{n?i.SendMessage("WebGLInput","EnableKeyboardCapture"):i.SendMessage("WebGLInput","DisableKeyboardCapture"),console.log(`Unity keyboard capture ${n?"enabled":"disabled"} (using Unity preferred method)`),e(!0);return}catch(o){console.warn("Failed to use Unity preferred keyboard method, falling back to SetCaptureAllKeyboardInput",o)}try{i.SendMessage("WebGLInput","SetCaptureAllKeyboardInput",n),console.log(`Unity keyboard capture ${n?"enabled":"disabled"} (using fallback method)`),e(!0);return}catch(o){console.warn("Failed to use SetCaptureAllKeyboardInput, trying module method",o)}if(i.Module){!n&&i.Module.WebGLInputHandler&&!window._originalWebGLInputHandler&&(window._originalWebGLInputHandler=i.Module.WebGLInputHandler),n&&window._originalWebGLInputHandler?(i.Module.WebGLInputHandler=window._originalWebGLInputHandler,window._originalWebGLInputHandler=null):n||(i.Module.WebGLInputHandler=null),console.log(`Unity keyboard capture ${n?"enabled":"disabled"} (using Module method)`),e(!0);return}}else console.warn("Unity instance not available, cannot set keyboard capture"),window.__pendingKeyboardCaptureState=n,document.getElementById("webgl-root")&&(console.log("webgl-root detected, will poll for Unity instance"),IF(n)),e(!1)}catch(i){console.error("Error setting Unity keyboard capture:",i),e(!1)}})}function IF(n){window.__unityInstancePoller&&clearTimeout(window.__unityInstancePoller);const e=20;let i=0;const o=()=>{i++;const l=B0();if(l){console.log(`Unity instance found after ${i} attempts`);try{n?l.SendMessage("WebGLInput","EnableKeyboardCapture"):l.SendMessage("WebGLInput","DisableKeyboardCapture"),console.log(`Applied pending keyboard state: ${n}`),window.__pendingKeyboardCaptureState=null}catch(d){console.warn("Failed to apply pending keyboard state with preferred method, trying fallback",d);try{l.SendMessage("WebGLInput","SetCaptureAllKeyboardInput",n),console.log(`Applied pending keyboard state: ${n} (fallback method)`),window.__pendingKeyboardCaptureState=null}catch(p){console.error("Failed to apply pending keyboard state with fallback method",p)}}}else if(i<e){const d=Math.min(500*Math.pow(1.2,i),5e3);console.log(`Unity instance not found (attempt ${i}/${e}), retrying in ${d}ms`),window.__unityInstancePoller=setTimeout(o,d)}else console.warn(`Unity instance still not found after ${e} attempts, giving up`)};window.__unityInstancePoller=setTimeout(o,500)}function JWe(){const n=B0();if(!n)return!1;const e=document.querySelector("canvas")||document.getElementById("unity-canvas");return!!(e&&document.activeElement===e||n.Module&&n.Module.WebGLInputHandler)}function Ty(n=!0){return console.log("Focusing Unity canvas"),n?I3():Xoe(),new Promise(e=>{try{const i=document.querySelector("canvas")||document.getElementById("unity-canvas");if(i){try{i.focus({preventScroll:!0})}catch{i.focus()}if(i.style.pointerEvents="auto",n){R1(!0).then(e);return}e(!0)}else console.warn("Unity canvas not found"),e(!1)}catch(i){console.error("Error focusing Unity canvas:",i),e(!1)}})}function Vd(n=!0){return console.log(`${n?"Blocking":"Unblocking"} Unity keyboard input`),I3(),new Promise(e=>{try{if(n)R1(!1).then(i=>{var d;i&&console.log("Successfully disabled Unity keyboard capture");const o=document.querySelector("canvas")||document.getElementById("unity-canvas");o&&(o.blur(),o.style.pointerEvents="none"),window.__keyEventHandler||(window.__keyEventHandler=p=>{window.__blockKeyboardInput&&!["INPUT","TEXTAREA","SELECT"].includes(p.target.tagName)&&p.stopPropagation()},document.addEventListener("keydown",window.__keyEventHandler,!0),document.addEventListener("keyup",window.__keyEventHandler,!0),document.addEventListener("keypress",window.__keyEventHandler,!0)),window.__blockKeyboardInput=!0;const l=B0();(d=l==null?void 0:l.Module)!=null&&d.WebGLInputHandler&&(window._savedWebGLInputHandler=l.Module.WebGLInputHandler,l.Module.WebGLInputHandler=null),e(!0)});else{window.__blockKeyboardInput=!1,window.__keyEventHandler&&(document.removeEventListener("keydown",window.__keyEventHandler,!0),document.removeEventListener("keyup",window.__keyEventHandler,!0),document.removeEventListener("keypress",window.__keyEventHandler,!0),window.__keyEventHandler=null);const i=B0();i!=null&&i.Module&&window._savedWebGLInputHandler&&(i.Module.WebGLInputHandler=window._savedWebGLInputHandler,window._savedWebGLInputHandler=null);const o=document.querySelector("canvas")||document.getElementById("unity-canvas");o&&(o.style.pointerEvents="auto"),R1(!0).then(l=>{l&&console.log("Successfully re-enabled Unity keyboard capture"),e(!0)})}}catch(i){console.error("Error in blockUnityKeyboardInput:",i),e(!1)}})}function QWe(n){if(n){if(console.log("Registering Unity instance"),window.unityInstance=n,typeof window.__pendingKeyboardCaptureState=="boolean")try{const e=window.__pendingKeyboardCaptureState;console.log(`Applying pending keyboard state: ${e}`);try{e?n.SendMessage("WebGLInput","EnableKeyboardCapture"):n.SendMessage("WebGLInput","DisableKeyboardCapture"),console.log(`Applied pending keyboard state: ${e} (Unity preferred method)`),window.__pendingKeyboardCaptureState=null}catch(i){console.warn("Failed to apply pending keyboard state with preferred method, trying fallback",i);try{n.SendMessage("WebGLInput","SetCaptureAllKeyboardInput",e),console.log(`Applied pending keyboard state: ${e} (fallback method)`),window.__pendingKeyboardCaptureState=null}catch(o){console.error("Failed to apply pending keyboard state with fallback method",o)}}}catch(e){console.error("Error applying pending keyboard state:",e)}window.__unityInstancePoller&&(clearTimeout(window.__unityInstancePoller),window.__unityInstancePoller=null)}}function ZWe(){if(console.log("Initializing Unity keyboard helpers"),window.setUnityKeyboardCapture=R1,window.focusUnity=Ty,window.blockUnityKeyboardInput=Vd,window.hasUnityKeyboardFocus=JWe,window.getUnityInstance=B0,window.registerUnityInstance=QWe,document.getElementById("webgl-root")){const n=new MutationObserver(e=>{for(const i of e)if(i.addedNodes.length)for(let o=0;o<i.addedNodes.length;o++){const l=i.addedNodes[o];if(l.nodeName==="CANVAS"||l.querySelector&&l.querySelector("canvas")){console.log("Canvas detected, Unity might be loading. Setting up instance detection."),IF(!0),n.disconnect();break}}});n.observe(document.body,{childList:!0,subtree:!0}),document.querySelector("canvas")&&(console.log("Canvas already exists, Unity might be loaded. Starting instance detection."),IF(!0))}if(typeof window<"u"&&typeof require=="function")try{const n=require("react");window.useUnityKeyboardFocus=function(){const[i,o]=n.useState(!1);return n.useEffect(()=>(i?(console.log("useUnityKeyboardFocus: Blocking Unity keyboard input"),Vd(!0),window.dispatchEvent(new CustomEvent("modal-opened"))):(console.log("useUnityKeyboardFocus: Unblocking Unity keyboard input"),Vd(!1),window.dispatchEvent(new CustomEvent("modal-closed"))),()=>{i&&(console.log("useUnityKeyboardFocus: Cleanup - unblocking Unity keyboard input"),Vd(!1),window.dispatchEvent(new CustomEvent("modal-closed")))}),[i]),[i,o]},console.log("Created useUnityKeyboardFocus hook globally")}catch(n){console.warn("Could not create React hook, React might not be available yet:",n)}}typeof window<"u"&&setTimeout(ZWe,0);const e8e=({isOpen:n,onClose:e,user:i,profileImageUrl:o})=>{const[l,d]=N.useState(!1),[p,_]=N.useState({Nickname:(i==null?void 0:i.Nickname)||"",username:(i==null?void 0:i.username)||"",companyName:(i==null?void 0:i.companyName)||"",firstName:(i==null?void 0:i.firstName)||"",lastName:(i==null?void 0:i.lastName)||"",linkedInProfile:(i==null?void 0:i.linkedInProfile)||""}),[E,b]=N.useState(!1),[C,I]=N.useState(!1),[O,L]=N.useState(""),[U,B]=N.useState(!1),W=Ic(),{sendUserToUnity:J,updateUser:$}=N.useContext(Ao),ie=N.useRef(null);N.useEffect(()=>{_({Nickname:(i==null?void 0:i.Nickname)||"",username:(i==null?void 0:i.username)||"",companyName:(i==null?void 0:i.companyName)||"",firstName:(i==null?void 0:i.firstName)||"",lastName:(i==null?void 0:i.lastName)||"",linkedInProfile:(i==null?void 0:i.linkedInProfile)||""})},[i]),N.useEffect(()=>(n?(console.log("ProfileModal: Modal opened, blocking Unity keyboard input"),Vd(!0),window.dispatchEvent(new CustomEvent("modal-opened"))):(console.log("ProfileModal: Modal closed, unblocking Unity keyboard input"),Vd(!1).then(()=>{setTimeout(()=>{Ty(!0)},100)}),window.dispatchEvent(new CustomEvent("modal-closed"))),()=>{n&&(console.log("ProfileModal: Cleanup on unmount, unblocking Unity keyboard input"),Vd(!1),window.dispatchEvent(new CustomEvent("modal-closed")))}),[n]),N.useEffect(()=>{if(l&&ie.current){const X=()=>{ie.current.focus(),I(!0),Vd(!0)};X();const re=setTimeout(X,100),pe=setTimeout(X,300);return()=>{clearTimeout(re),clearTimeout(pe)}}else I(!1)},[l]),N.useEffect(()=>{const re=setTimeout(async()=>{if(p.username&&p.username!==(i==null?void 0:i.username)){B(!0),L("");try{if(!/^[a-z0-9]{1,15}$/.test(p.username)){L("Username must be 1-15 characters, lowercase letters and numbers only"),B(!1);return}Vu(p.username),await QC(p.username)&&L("Username is already taken")}catch(pe){q.error("Error checking username:",pe),L("Error checking username availability")}finally{B(!1)}}},500);return()=>clearTimeout(re)},[p.username,i==null?void 0:i.username]);const ce=()=>{d(!1),I(!1),e()},ne=X=>{const{name:re,value:pe}=X.target;if(re==="username"){const he=pe.toLowerCase().replace(/[^a-z0-9]/g,"");_(ue=>({...ue,[re]:he}))}else _(he=>({...he,[re]:pe}))},de=async()=>{if(p.Nickname.trim()===""){W({title:"Error",description:"Display Name cannot be empty",status:"error",duration:3e3,isClosable:!0});return}if(Vu(p.Nickname),p.firstName&&Vu(p.firstName),p.lastName&&Vu(p.lastName),p.companyName&&Vu(p.companyName),O){W({title:"Error",description:O,status:"error",duration:3e3,isClosable:!0});return}b(!0);try{if(p.username!==i.username&&(Vu(p.username),await QC(p.username))){L("Username is already taken"),W({title:"Error",description:"Username is already taken",status:"error",duration:3e3,isClosable:!0}),b(!1);return}const X=Vr(dr,"users",i.uid);if(p.username!==i.username)try{if(q.log("ProfileModal: Updating username from",i.username,"to",p.username),!await FBe(i.uid,p.username))throw new Error("Failed to update username");q.log("ProfileModal: Username updated successfully")}catch(re){q.error("Error updating username:",re),W({title:"Error",description:"Failed to update username: "+(re.message||"Please try again"),status:"error",duration:3e3,isClosable:!0}),b(!1);return}q.log("ProfileModal: Updating user profile");try{const re={Nickname:p.Nickname,companyName:p.companyName,firstName:p.firstName,lastName:p.lastName,linkedInProfile:p.linkedInProfile,username:p.username,lastUpdated:new Date().toISOString()};await Ys(X,re),q.log("ProfileModal: Profile updated successfully");const pe=moe(X,he=>{if(he.exists()&&he.data().Nickname===p.Nickname){try{J()}catch(xe){q.error("Error sending user to Unity:",xe)}pe()}},he=>{q.error("Error in profile update listener:",he)});try{await $()}catch(he){q.error("Error updating user context:",he)}_({Nickname:p.Nickname,username:p.username,companyName:p.companyName,firstName:p.firstName,lastName:p.lastName,linkedInProfile:p.linkedInProfile}),W({title:"Success",description:"Profile updated successfully",status:"success",duration:3e3,isClosable:!0}),d(!1)}catch(re){q.error("Error updating profile data:",re),W({title:"Error",description:"Failed to update profile: "+(re.message||"Please try again"),status:"error",duration:3e3,isClosable:!0})}}catch(X){q.error("Error in handleSave:",X),W({title:"Error",description:"An unexpected error occurred: "+(X.message||"Please try again"),status:"error",duration:3e3,isClosable:!0})}finally{b(!1)}},Q=()=>w.jsxs(Qr,{spacing:4,align:"stretch",w:"100%",children:[w.jsxs(wr,{direction:"column",align:"center",gap:2,children:[w.jsx(Ze,{fontSize:"2xl",fontWeight:"bold",children:i.Nickname}),w.jsxs(Ze,{fontSize:"md",color:"gray.400",children:["@",i.username]})]}),w.jsxs(Qr,{spacing:3,align:"stretch",bg:"gray.700",p:4,borderRadius:"md",children:[w.jsxs(wr,{direction:"column",children:[w.jsx(Ze,{color:"gray.400",fontSize:"sm",children:"Company"}),w.jsx(Ze,{children:i.companyName||"Not specified"})]}),w.jsxs(wr,{direction:"column",children:[w.jsx(Ze,{color:"gray.400",fontSize:"sm",children:"Full Name"}),w.jsx(Ze,{children:`${i.firstName||""} ${i.lastName||""}`.trim()||"Not specified"})]}),w.jsxs(wr,{direction:"column",children:[w.jsx(Ze,{color:"gray.400",fontSize:"sm",children:"LinkedIn"}),w.jsx(Ze,{children:i.linkedInProfile||"Not specified"})]})]}),w.jsx(ur,{onClick:()=>d(!0),size:"sm",variant:"outline",_hover:{bg:"gray.700"},color:"white",borderColor:"gray.600",children:"Edit Profile"})]}),Z=()=>w.jsxs(Qr,{spacing:4,align:"stretch",w:"100%",children:[w.jsxs(kr,{children:[w.jsx($i,{color:"gray.400",fontSize:"sm",children:"Display Name"}),w.jsx(oi,{ref:ie,name:"Nickname",value:p.Nickname,onChange:ne,onFocus:()=>{I(!0),Vd(!0)},placeholder:"Enter display name",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},maxLength:15})]}),w.jsxs(kr,{isInvalid:!!O,children:[w.jsx($i,{color:"gray.400",fontSize:"sm",children:"Username"}),w.jsxs(Rg,{children:[w.jsx(q1,{bg:"gray.700",color:"gray.400",border:"none",children:"@"}),w.jsx(oi,{name:"username",value:p.username,onChange:ne,placeholder:"username",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},maxLength:15,isDisabled:U})]}),O&&w.jsx(Ze,{color:"red.400",fontSize:"sm",mt:1,children:O}),w.jsx(Uy,{color:"gray.400",children:"Lowercase letters and numbers only, max 15 characters"})]}),w.jsxs(kr,{children:[w.jsx($i,{color:"gray.400",fontSize:"sm",children:"Company Name"}),w.jsx(oi,{name:"companyName",value:p.companyName,onChange:ne,placeholder:"Enter company name",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"}})]}),w.jsxs(wr,{gap:4,children:[w.jsxs(kr,{children:[w.jsx($i,{color:"gray.400",fontSize:"sm",children:"First Name"}),w.jsx(oi,{name:"firstName",value:p.firstName,onChange:ne,placeholder:"Enter first name",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"}})]}),w.jsxs(kr,{children:[w.jsx($i,{color:"gray.400",fontSize:"sm",children:"Last Name"}),w.jsx(oi,{name:"lastName",value:p.lastName,onChange:ne,placeholder:"Enter last name",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"}})]})]}),w.jsxs(kr,{children:[w.jsx($i,{color:"gray.400",fontSize:"sm",children:"LinkedIn Profile"}),w.jsx(oi,{name:"linkedInProfile",value:p.linkedInProfile,onChange:ne,placeholder:"Enter LinkedIn profile URL",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"}})]}),w.jsxs(wr,{gap:2,justify:"flex-end",mt:2,children:[w.jsx(ur,{onClick:()=>{_({Nickname:(i==null?void 0:i.Nickname)||"",username:(i==null?void 0:i.username)||"",companyName:(i==null?void 0:i.companyName)||"",firstName:(i==null?void 0:i.firstName)||"",lastName:(i==null?void 0:i.lastName)||"",linkedInProfile:(i==null?void 0:i.linkedInProfile)||""}),d(!1),L("")},variant:"outline",size:"sm",isDisabled:E,color:"white",borderColor:"gray.600",_hover:{bg:"gray.700"},children:"Cancel"}),w.jsx(ur,{onClick:de,colorScheme:"blue",size:"sm",isLoading:E||U,isDisabled:!!O||U,children:"Save Changes"})]})]});return w.jsxs(oo,{isOpen:n,onClose:ce,isCentered:!0,closeOnOverlayClick:!l,trapFocus:!0,blockScrollOnMount:!1,size:"md",children:[w.jsx(co,{backdropFilter:"blur(10px)"}),w.jsxs(ao,{bg:"gray.800",color:"white",children:[w.jsx(tc,{children:"Profile"}),w.jsx(Ko,{}),w.jsx(Ro,{pb:6,children:w.jsxs(Qr,{spacing:6,children:[w.jsx($l,{src:o,size:"2xl",borderRadius:"full"}),l?Z():Q(),!l&&w.jsx(ur,{variant:"ghost",size:"sm",colorScheme:"blue",width:"100%",onClick:()=>window.open("https://support.spacesmetaverse.com/","_blank"),children:"Visit Support Site"})]})})]})]})},KO={bg:"white",color:"black",borderRadius:"full",px:"6",py:"2",height:"auto",fontSize:"md",fontWeight:"medium",_hover:{bg:"gray.100"},display:"flex",alignItems:"center",gap:2},Joe=()=>{var C;const{user:n,updateUser:e}=N.useContext(Ao),[i,o]=N.useState(!0),{isOpen:l,onOpen:d,onClose:p}=pf();N.useEffect(()=>{const I=setTimeout(()=>{o(!1)},500);return()=>clearTimeout(I)},[]);const _=()=>{p(),e()},E=n!=null&&n.rpmURL?n.rpmURL.replace(".glb",".png?scene=fullbody-portrait-closeupfront&w=640&q=75"):null,b=(C=n==null?void 0:n.groups)==null?void 0:C.includes("disruptiveAdmin");return i?null:w.jsx(wr,{align:"center",gap:"4",children:n?w.jsxs(w.Fragment,{children:[w.jsx(e8e,{isOpen:l,onClose:_,user:n,profileImageUrl:E}),w.jsxs(mR,{children:[w.jsx(gR,{as:lt,cursor:"pointer",children:w.jsx(wr,{align:"center",height:"40px",px:4,borderRadius:"full",border:"1px solid rgba(255, 255, 255, 0.3)",transition:"all 0.2s",sx:{"&:hover":{border:"2px solid white"}},children:w.jsxs(wr,{align:"center",gap:"3",children:[w.jsx(lt,{width:"28px",height:"28px",borderRadius:"full",overflow:"hidden",bg:"white",display:"flex",alignItems:"center",justifyContent:"center",children:w.jsx($l,{src:E,width:"100%",height:"100%",borderRadius:"full"})}),w.jsx(Ze,{color:"white",fontWeight:"medium",children:n.Nickname}),w.jsx(lt,{display:"flex",alignItems:"center",height:"28px",children:w.jsx(Voe,{color:"white",w:4,h:4})})]})})}),w.jsx(Yl,{children:w.jsxs(_R,{bg:"gray.800",borderColor:"gray.700",zIndex:9999,children:[w.jsxs(lt,{p:4,display:"flex",alignItems:"center",gap:3,children:[w.jsx($l,{src:E,size:"md",borderRadius:"full"}),w.jsx(Ze,{fontSize:"xl",fontWeight:"bold",color:"white",children:n.Nickname})]}),w.jsx(of,{borderColor:"gray.700"}),b&&w.jsx(Md,{as:"a",href:"/myadmin",_hover:{bg:"gray.700"},color:"white",bg:"gray.800",children:"My Admin"}),w.jsx(Md,{_hover:{bg:"gray.700"},color:"white",bg:"gray.800",children:"My Spaces"}),w.jsx(Md,{onClick:d,_hover:{bg:"gray.700"},color:"white",bg:"gray.800",children:"View Profile"}),w.jsx(of,{borderColor:"gray.700"}),w.jsx(Md,{_hover:{bg:"gray.700"},color:"white",bg:"gray.800",children:"Support"}),w.jsx(Md,{_hover:{bg:"gray.700"},color:"white",bg:"gray.800",children:w.jsx(R3,{mode:"link",label:"Log out",linkProps:{color:"white",_hover:{textDecoration:"none"}}})})]})})]})]}):w.jsxs(w.Fragment,{children:[w.jsx(jN,{mode:"button",label:"Register",buttonProps:{...KO,width:["100%","auto"]},customButton:w.jsxs(ur,{...KO,children:[w.jsx(lt,{as:"span",fontSize:"xl",children:""}),"Register"]})}),w.jsx(BN,{mode:"button",label:"Sign In",buttonProps:{...KO,width:["100%","auto"]},customButton:w.jsxs(ur,{...KO,children:[w.jsx(lt,{as:"span",fontSize:"xl",children:""}),"Sign In"]})})]})})},t8e=()=>{const{registrationInProgress:n}=fWe();return n?w.jsxs(oo,{isOpen:!0,onClose:()=>{},closeOnEsc:!1,closeOnOverlayClick:!1,isCentered:!0,motionPreset:"none",size:"full",children:[w.jsx(co,{bg:"rgba(0,0,0,0.8)",backdropFilter:"blur(8px)"}),w.jsx(ao,{bg:"transparent",boxShadow:"none",maxW:"100%",maxH:"100%",display:"flex",alignItems:"center",justifyContent:"center",children:w.jsxs(wr,{direction:"column",align:"center",justify:"center",p:8,maxW:"md",textAlign:"center",children:[w.jsx(zd,{size:"xl",thickness:"4px",speed:"0.8s",color:"blue.400",mb:6}),w.jsx(Ze,{fontSize:"2xl",fontWeight:"bold",color:"white",mb:4,children:"Creating Your Account"}),w.jsx(Ze,{fontSize:"md",color:"gray.300",mb:3,children:"Please wait while we set up your profile with Spaces Metaverse"}),w.jsx(Ze,{fontSize:"sm",color:"gray.400",mb:1,children:"This typically takes 5-10 seconds to complete"}),w.jsx(Ze,{fontSize:"sm",color:"gray.400",children:"Please do not refresh or close this page"})]})})]}):null},BU=document.getElementById("header-auth-root");if(BU){const n=BU.getAttribute("data-theme")||"default",e=()=>{const[i,o]=N.useState(null);return N.useEffect(()=>{zC(n).then(o)},[]),i?w.jsx(K1,{theme:i,children:w.jsx(MN,{children:w.jsxs(S3,{children:[w.jsx(Joe,{}),w.jsx(t8e,{})]})})}):w.jsx("div",{children:"Loading theme..."})};A1.createRoot(BU).render(w.jsx(e,{}))}else console.error("Root element 'header-auth-root' not found.");var WU={},Pw={},Ow={},CQ;function n8e(){if(CQ)return Ow;CQ=1,Object.defineProperty(Ow,"__esModule",{value:!0}),Ow.useUnityCanvasId=void 0;var n=Wu(),e=0,i="react-unity-webgl-canvas",o=function(l){if(l.id!==void 0)return l.id;var d=(0,n.useMemo)(function(){return[i,++e].join("-")},[]);return d};return Ow.useUnityCanvasId=o,Ow}var Sp={},kw={},RQ;function Qoe(){if(RQ)return kw;RQ=1,Object.defineProperty(kw,"__esModule",{value:!0}),kw.UnityLoaderStatus=void 0;var n;return function(e){e.Idle="Idle",e.Loading="Loading",e.Loaded="Loaded",e.Error="Error"}(n||(kw.UnityLoaderStatus=n={})),kw}var Nw={},IQ;function A3(){return IQ||(IQ=1,Object.defineProperty(Nw,"__esModule",{value:!0}),Nw.isBrowserEnvironment=void 0,Nw.isBrowserEnvironment=typeof window<"u"&&typeof document<"u"),Nw}var AQ;function r8e(){if(AQ)return Sp;AQ=1;var n=Sp&&Sp.__awaiter||function(p,_,E,b){function C(I){return I instanceof E?I:new E(function(O){O(I)})}return new(E||(E=Promise))(function(I,O){function L(W){try{B(b.next(W))}catch(J){O(J)}}function U(W){try{B(b.throw(W))}catch(J){O(J)}}function B(W){W.done?I(W.value):C(W.value).then(L,U)}B((b=b.apply(p,_||[])).next())})},e=Sp&&Sp.__generator||function(p,_){var E={label:0,sent:function(){if(I[0]&1)throw I[1];return I[1]},trys:[],ops:[]},b,C,I,O=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return O.next=L(0),O.throw=L(1),O.return=L(2),typeof Symbol=="function"&&(O[Symbol.iterator]=function(){return this}),O;function L(B){return function(W){return U([B,W])}}function U(B){if(b)throw new TypeError("Generator is already executing.");for(;O&&(O=0,B[0]&&(E=0)),E;)try{if(b=1,C&&(I=B[0]&2?C.return:B[0]?C.throw||((I=C.return)&&I.call(C),0):C.next)&&!(I=I.call(C,B[1])).done)return I;switch(C=0,I&&(B=[B[0]&2,I.value]),B[0]){case 0:case 1:I=B;break;case 4:return E.label++,{value:B[1],done:!1};case 5:E.label++,C=B[1],B=[0];continue;case 7:B=E.ops.pop(),E.trys.pop();continue;default:if(I=E.trys,!(I=I.length>0&&I[I.length-1])&&(B[0]===6||B[0]===2)){E=0;continue}if(B[0]===3&&(!I||B[1]>I[0]&&B[1]<I[3])){E.label=B[1];break}if(B[0]===6&&E.label<I[1]){E.label=I[1],I=B;break}if(I&&E.label<I[2]){E.label=I[2],E.ops.push(B);break}I[2]&&E.ops.pop(),E.trys.pop();continue}B=_.call(p,E)}catch(W){B=[6,W],C=0}finally{b=I=0}if(B[0]&5)throw B[1];return{value:B[0]?B[1]:void 0,done:!0}}};Object.defineProperty(Sp,"__esModule",{value:!0}),Sp.useUnityInstance=void 0;var i=Wu(),o=Qoe(),l=A3(),d=function(p,_,E,b){(0,i.useEffect)(function(){(function(){return n(void 0,void 0,void 0,function(){var C,I;return e(this,function(O){switch(O.label){case 0:if(l.isBrowserEnvironment===!1)return[2];if(p!==o.UnityLoaderStatus.Loaded||_===null)return b.setUnityInstance(null),b.setInitialisationError(null),[2];O.label=1;case 1:return O.trys.push([1,3,,4]),[4,window.createUnityInstance(_,E,b.setLoadingProgression)];case 2:return C=O.sent(),b.setUnityInstance(C),b.setInitialisationError(null),[3,4];case 3:return I=O.sent(),b.setUnityInstance(null),b.setInitialisationError(I),[3,4];case 4:return[2]}})})})()},[p,_,E,b])};return Sp.useUnityInstance=d,Sp}var Dw={},PQ;function i8e(){if(PQ)return Dw;PQ=1,Object.defineProperty(Dw,"__esModule",{value:!0}),Dw.useUnityArguments=void 0;var n=Wu(),e=function(i){return(0,n.useMemo)(function(){return{dataUrl:i.unityProvider.unityConfig.dataUrl,frameworkUrl:i.unityProvider.unityConfig.frameworkUrl,codeUrl:i.unityProvider.unityConfig.codeUrl,streamingAssetsUrl:i.unityProvider.unityConfig.streamingAssetsUrl,memoryUrl:i.unityProvider.unityConfig.memoryUrl,symbolsUrl:i.unityProvider.unityConfig.symbolsUrl,workerUrl:i.unityProvider.unityConfig.workerUrl,companyName:i.unityProvider.unityConfig.companyName,productName:i.unityProvider.unityConfig.productName,productVersion:i.unityProvider.unityConfig.productVersion,webglContextAttributes:i.unityProvider.unityConfig.webglContextAttributes||{},cacheControl:i.unityProvider.unityConfig.cacheControl||function(){return"must-revalidate"},devicePixelRatio:i.devicePixelRatio||1,autoSyncPersistentDataPath:i.autoSyncPersistentDataPath,matchWebGLToCanvasSize:typeof i.matchWebGLToCanvasSize=="boolean"?i.matchWebGLToCanvasSize:!0,disabledCanvasEvents:i.disabledCanvasEvents||["contextmenu","dragstart"],print:function(o){},printErr:function(o){}}},[])};return Dw.useUnityArguments=e,Dw}var xw={},OQ;function s8e(){if(OQ)return xw;OQ=1,Object.defineProperty(xw,"__esModule",{value:!0}),xw.useUnityLoader=void 0;var n=Wu(),e=A3(),i=Qoe(),o=function(l){var d=(0,n.useState)(i.UnityLoaderStatus.Loading),p=d[0],_=d[1];return(0,n.useEffect)(function(){if(e.isBrowserEnvironment!==!1){if(l.loaderUrl===null){_(i.UnityLoaderStatus.Idle);return}var E=window.document.querySelector('script[src="'.concat(l.loaderUrl,'"]'));E===null?(E=window.document.createElement("script"),E.type="text/javascript",E.src=l.loaderUrl,E.async=!0,E.setAttribute("data-status","loading"),window.document.body.appendChild(E),E.addEventListener("load",function(){return E==null?void 0:E.setAttribute("data-status","loaded")}),E.addEventListener("error",function(){return E==null?void 0:E.setAttribute("data-status","error")})):_(E.getAttribute("data-status")==="loaded"?i.UnityLoaderStatus.Loaded:i.UnityLoaderStatus.Error);var b=function(C){return _(C.type==="load"?i.UnityLoaderStatus.Loaded:i.UnityLoaderStatus.Error)};return E.addEventListener("load",b),E.addEventListener("error",b),function(){E!==null&&(E.removeEventListener("load",b),E.removeEventListener("error",b),window.document.body.removeChild(E))}}},[l.loaderUrl]),p};return xw.useUnityLoader=o,xw}var kQ;function o8e(){if(kQ)return Pw;kQ=1,Object.defineProperty(Pw,"__esModule",{value:!0}),Pw.Unity=void 0;var n=Wu(),e=Wu(),i=n8e(),o=r8e(),l=i8e(),d=s8e(),p=(0,e.forwardRef)(function(_,E){var b=(0,e.useRef)(null),C=(0,i.useUnityCanvasId)(_),I=(0,l.useUnityArguments)(_),O=(0,d.useUnityLoader)(_.unityProvider.unityConfig);return(0,o.useUnityInstance)(O,b.current,I,_.unityProvider),(0,n.useImperativeHandle)(E,function(){return b.current}),(0,n.createElement)("canvas",{ref:b,id:C,style:_.style,className:_.className,tabIndex:_.tabIndex})});return Pw.Unity=p,Pw}var bp={},Lw={},NQ;function Zoe(){if(NQ)return Lw;NQ=1,Object.defineProperty(Lw,"__esModule",{value:!0}),Lw.errorMessages=void 0;var n={genericNoUnityInstance:"No Unity Instance found.",requestFullscreenNoUnityInstance:"Unable to Set Fullscreen while Unity is not Instantiated.",requestPointerLockNoUnityInstanceOrCanvas:"Unable to Request Pointer Lock while Unity is not Instantiated or the Canvas is not found.",sendMessageNoUnityInstance:"Unable to Send Message while Unity is not Instantiated.",quitNoUnityInstance:"Unable to Quit Unity while Unity is not Instantiated.",screenshotNoUnityInstanceOrCanvas:"Unable to Take Screenshot while Unity is not Instantiated or Canvas is not available.",noEventListener:"Unable to find Event Listener in Event System for Event"};return Lw.errorMessages=n,Lw}var gy={},DQ;function a8e(){if(DQ)return gy;DQ=1;var n=gy&&gy.__spreadArray||function(_,E,b){if(b||arguments.length===2)for(var C=0,I=E.length,O;C<I;C++)(O||!(C in E))&&(O||(O=Array.prototype.slice.call(E,0,C)),O[C]=E[C]);return _.concat(O||Array.prototype.slice.call(E))};Object.defineProperty(gy,"__esModule",{value:!0}),gy.useEventSystem=void 0;var e=Wu(),i=Zoe(),o=A3(),l=[],d=function(_){for(var E=[],b=1;b<arguments.length;b++)E[b-1]=arguments[b];var C=void 0;return l.forEach(function(I){C=I.apply(void 0,n([_],E,!1))}),C};o.isBrowserEnvironment===!0&&(window.dispatchReactUnityEvent=d);var p=function(){var _=(0,e.useRef)([]),E=(0,e.useCallback)(function(I,O){_.current=n(n([],_.current,!0),[{eventName:I,callback:O}],!1)},[_]),b=(0,e.useCallback)(function(I,O){_.current=_.current.filter(function(L){return L.eventName!==I&&L.callback!==O})},[_]),C=(0,e.useCallback)(function(I){for(var O=[],L=1;L<arguments.length;L++)O[L-1]=arguments[L];var U=_.current.find(function(B){return B.eventName===I});if(typeof U>"u"){console.warn(i.errorMessages.noEventListener,{eventName:I});return}return U.callback.apply(U,O)},[_]);return(0,e.useEffect)(function(){return l.push(C),function(){l.splice(l.indexOf(C),1)}},[C]),{addEventListener:E,removeEventListener:b}};return gy.useEventSystem=p,gy}var Mw={},xQ;function c8e(){if(xQ)return Mw;xQ=1,Object.defineProperty(Mw,"__esModule",{value:!0}),Mw.useNullableState=void 0;var n=Wu(),e=function(i){return(0,n.useState)(i||null)};return Mw.useNullableState=e,Mw}var LQ;function l8e(){if(LQ)return bp;LQ=1;var n=bp&&bp.__awaiter||function(_,E,b,C){function I(O){return O instanceof b?O:new b(function(L){L(O)})}return new(b||(b=Promise))(function(O,L){function U(J){try{W(C.next(J))}catch($){L($)}}function B(J){try{W(C.throw(J))}catch($){L($)}}function W(J){J.done?O(J.value):I(J.value).then(U,B)}W((C=C.apply(_,E||[])).next())})},e=bp&&bp.__generator||function(_,E){var b={label:0,sent:function(){if(O[0]&1)throw O[1];return O[1]},trys:[],ops:[]},C,I,O,L=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return L.next=U(0),L.throw=U(1),L.return=U(2),typeof Symbol=="function"&&(L[Symbol.iterator]=function(){return this}),L;function U(W){return function(J){return B([W,J])}}function B(W){if(C)throw new TypeError("Generator is already executing.");for(;L&&(L=0,W[0]&&(b=0)),b;)try{if(C=1,I&&(O=W[0]&2?I.return:W[0]?I.throw||((O=I.return)&&O.call(I),0):I.next)&&!(O=O.call(I,W[1])).done)return O;switch(I=0,O&&(W=[W[0]&2,O.value]),W[0]){case 0:case 1:O=W;break;case 4:return b.label++,{value:W[1],done:!1};case 5:b.label++,I=W[1],W=[0];continue;case 7:W=b.ops.pop(),b.trys.pop();continue;default:if(O=b.trys,!(O=O.length>0&&O[O.length-1])&&(W[0]===6||W[0]===2)){b=0;continue}if(W[0]===3&&(!O||W[1]>O[0]&&W[1]<O[3])){b.label=W[1];break}if(W[0]===6&&b.label<O[1]){b.label=O[1],O=W;break}if(O&&b.label<O[2]){b.label=O[2],b.ops.push(W);break}O[2]&&b.ops.pop(),b.trys.pop();continue}W=E.call(_,b)}catch(J){W=[6,J],I=0}finally{C=O=0}if(W[0]&5)throw W[1];return{value:W[0]?W[1]:void 0,done:!0}}};Object.defineProperty(bp,"__esModule",{value:!0}),bp.useUnityContext=void 0;var i=Wu(),o=Zoe(),l=a8e(),d=c8e(),p=function(_){var E=(0,d.useNullableState)(),b=E[0],C=E[1],I=(0,i.useState)(0),O=I[0],L=I[1],U=(0,i.useState)(!1),B=U[0],W=U[1],J=(0,d.useNullableState)(),$=J[0],ie=J[1],ce=(0,l.useEventSystem)(),ne=(0,i.useRef)({setLoadingProgression:L,setInitialisationError:ie,setUnityInstance:C,setIsLoaded:W,unityConfig:_}),de=(0,i.useCallback)(function(he){if(b===null){console.warn(o.errorMessages.requestFullscreenNoUnityInstance);return}b.SetFullscreen(he===!0?1:0)},[b]),Q=(0,i.useCallback)(function(){if(b===null||typeof b.Module.canvas>"u"){console.warn(o.errorMessages.requestPointerLockNoUnityInstanceOrCanvas);return}return b.Module.canvas.requestPointerLock()},[b]),Z=(0,i.useCallback)(function(he,ue,xe){if(b===null){console.warn(o.errorMessages.sendMessageNoUnityInstance);return}b.SendMessage(he,ue,xe)},[b]),X=(0,i.useCallback)(function(he,ue){if(b===null||typeof b.Module.canvas>"u"){console.warn(o.errorMessages.screenshotNoUnityInstanceOrCanvas);return}return b.Module.canvas.toDataURL(he,ue)},[b]),re=(0,i.useCallback)(function(){return b===null?(console.warn(o.errorMessages.quitNoUnityInstance),Promise.reject()):b.Quit()},[b]),pe=(0,i.useCallback)(function(){return n(void 0,void 0,void 0,function(){var he;return e(this,function(ue){switch(ue.label){case 0:return b===null||typeof b.Module.canvas>"u"?(console.warn(o.errorMessages.genericNoUnityInstance),[2,Promise.reject()]):(he=b.Module.canvas,document.body.appendChild(he),he.style.display="none",[4,re()]);case 1:return ue.sent(),he.remove(),[2]}})})},[b]);return(0,i.useEffect)(function(){W(O===1)},[O]),{unityProvider:ne.current,loadingProgression:O,initialisationError:$,isLoaded:B,UNSAFE__unityInstance:b,requestFullscreen:de,requestPointerLock:Q,sendMessage:Z,takeScreenshot:X,unload:re,UNSAFE__detachAndUnloadImmediate:pe,addEventListener:ce.addEventListener,removeEventListener:ce.removeEventListener}};return bp.useUnityContext=p,bp}var MQ;function u8e(){return MQ||(MQ=1,function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.useUnityContext=n.Unity=void 0;var e=o8e();Object.defineProperty(n,"Unity",{enumerable:!0,get:function(){return e.Unity}});var i=l8e();Object.defineProperty(n,"useUnityContext",{enumerable:!0,get:function(){return i.useUnityContext}})}(WU)),WU}var eae=u8e();const Dd="[UnityProvider]",AF=N.createContext(),d8e=({spaceID:n,children:e,loaderUrl:i,dataUrl:o,frameworkUrl:l,codeUrl:d,loadingBackground:p,showLoginButton:_,showDisruptiveLogo:E})=>{q.log(`${Dd} Initializing with spaceID:`,n),q.log(`${Dd} Unity URLs:`,{loaderUrl:i,dataUrl:o,frameworkUrl:l,codeUrl:d});const{unityProvider:b,loadingProgression:C,isLoaded:I,sendMessage:O,addEventListener:L,removeEventListener:U,error:B}=eae.useUnityContext({loaderUrl:i,dataUrl:o,frameworkUrl:l,codeUrl:d}),W={unityProvider:b,loadingProgression:C,isLoaded:I,sendMessage:O,addEventListener:L,removeEventListener:U,error:B,spaceID:n},J=N.useRef(null),$=N.useRef(Date.now());N.useEffect(()=>{const de=()=>{document.hidden?(q.log(`${Dd} Page hidden, starting keep-alive`),ie()):(q.log(`${Dd} Page visible, stopping keep-alive`),ce())};return document.addEventListener("visibilitychange",de),()=>{document.removeEventListener("visibilitychange",de),ce()}},[]),N.useEffect(()=>{const de=()=>{$.current=Date.now(),document.hidden&&O("WebGLInputManager","KeepAlive")};return window.addEventListener("mousemove",de),window.addEventListener("keydown",de),window.addEventListener("touchstart",de),()=>{window.removeEventListener("mousemove",de),window.removeEventListener("keydown",de),window.removeEventListener("touchstart",de)}},[O]);const ie=()=>{J.current||(J.current=setInterval(()=>{I&&document.hidden&&(O("WebGLInputManager","KeepAlive"),q.debug(`${Dd} Sent keep-alive message`))},1e4))},ce=()=>{J.current&&(clearInterval(J.current),J.current=null)};N.useEffect(()=>(q.log(`${Dd} Component mounted`),()=>{q.log(`${Dd} Component unmounting`),ce()}),[]),N.useEffect(()=>{q.log(`${Dd} Loading progress:`,C)},[C]),N.useEffect(()=>{I&&(q.log(`${Dd} Unity instance loaded for:`,n),document.hidden&&ie())},[I,n]),N.useEffect(()=>{B&&q.error(`${Dd} Unity error:`,B)},[B]),q.log(`${Dd} Rendering provider with instance:`,W),N.useEffect(()=>{q.log("UnityProvider: Unity build URLs:",{loaderUrl:i,dataUrl:o,frameworkUrl:l,codeUrl:d})},[i,o,l,d]);const ne=[];if(i||ne.push("loaderUrl"),o||ne.push("dataUrl"),l||ne.push("frameworkUrl"),d||ne.push("codeUrl"),ne.length>0)return q.error(`UnityProvider: Missing required Unity build URLs: ${ne.join(", ")}`),w.jsx(AF.Provider,{value:{unityProvider:null,loadingProgression:0,isLoaded:!1,sendMessage:()=>{},addEventListener:()=>{},removeEventListener:()=>{},error:new Error(`Missing required Unity build URLs: ${ne.join(", ")}`),spaceID:n},children:e});try{return N.useEffect(()=>{q.log("UnityProvider: Unity context created:",b),b?q.log("UnityProvider: Unity provider is available"):q.error("UnityProvider: Unity provider is not available"),I?q.log("UnityProvider: Unity is loaded"):q.log("UnityProvider: Unity is not loaded yet")},[b,I]),w.jsx(AF.Provider,{value:W,children:e})}catch(de){return q.error("UnityProvider: Error creating Unity context:",de),w.jsxs("div",{style:{padding:"20px",color:"red",backgroundColor:"#ffeeee",border:"1px solid red",borderRadius:"5px"},children:[w.jsx("h3",{children:"Unity Error"}),w.jsxs("p",{children:["Error creating Unity context: ",de.message]}),w.jsx("p",{children:"Please check the console for more details."})]})}},Ra=()=>N.useContext(AF),Sf=()=>{const{sendMessage:n,isLoaded:e}=Ra(),i=N.useRef([]),o=N.useCallback(()=>{if(e)for(;i.current.length>0;){const{eventName:d,data:p}=i.current.shift();q.log("useSendUnityEvent: Processing queued event to Unity:",d,p);try{n("ReactIncomingEvent","HandleEvent",JSON.stringify({eventName:d,data:JSON.stringify(p)}))}catch(_){q.error("useSendUnityEvent: Error sending event to Unity:",_),i.current.unshift({eventName:d,data:p});break}}},[n,e]);return N.useEffect(()=>{const d=setInterval(()=>{o()},1e3);return()=>clearInterval(d)},[o]),N.useCallback((d,p)=>{q.log("useSendUnityEvent: Queuing event for Unity:",d),i.current.push({eventName:d,data:p}),o()},[o])},bf=()=>{const{addEventListener:n,removeEventListener:e}=Ra();return N.useCallback((i,o)=>{const l=d=>{q.log(i+" unity message received.");let p=null;if(d)try{p=JSON.parse(d)}catch(_){q.warn("Failed to parse JSON data from Unity message:",_)}o(p)};return n(i,l),()=>{e(i,l)}},[n,e])},tae=()=>{const[n,e]=N.useState({}),[i,o]=N.useState(!1),[l,d]=N.useState(null),[p,_]=N.useState(0),E=Sf(),b=bf(),{spaceID:C,sendMessage:I,isLoaded:O}=Ra(),L=N.useCallback((J,$)=>{if(!J)return;q.log(`useHLSStream: Sending stream URL to Unity: ${J} for player ${$}`);const ie={identifier:"LiveProjector",playerIndex:$.toString(),streamUrl:J};if(E("SetHLSStream",ie),O&&I)try{q.log("useHLSStream: Sending with ReactIncomingEvent approach"),I("ReactIncomingEvent","HandleEvent",JSON.stringify({eventName:"SetHLSStream",data:JSON.stringify(ie)})),q.log("useHLSStream: Sending with direct HLSStream approach"),I("HLSStream","SetHLSStream",JSON.stringify({identifier:"LiveProjector",playerIndex:$.toString(),streamUrl:J})),q.log("useHLSStream: Sending with most direct approach possible"),I("LiveProjector","SetStreamUrl",J),I("HLSStreamClient","SetStreamUrl",JSON.stringify({Index:$.toString(),Url:J}))}catch(ce){q.error("useHLSStream: Error with direct message:",ce)}else q.warn("useHLSStream: Unity not loaded, could not send direct message")},[E,I,O]);N.useEffect(()=>{C&&U(C)},[C]);const U=async J=>{try{if(!J){q.warn("useHLSStream: Cannot load stream from Firebase - no spaceID");return}o(!0),q.log(`useHLSStream: Loading stream from Firebase for space ${J}`);const $=await Loe(J);if($&&$.streamUrl)if(q.log(`useHLSStream: Loaded stream data from Firebase for space ${J}`,$),d($),O)q.log("useHLSStream: Unity is loaded, sending stream URL to Unity after delay"),setTimeout(()=>{L($.streamUrl,$.playerIndex||"0")},500),setTimeout(()=>{q.log("useHLSStream: Sending backup stream URL to Unity after longer delay"),L($.streamUrl,$.playerIndex||"0")},2e3);else{q.warn("useHLSStream: Unity is not loaded yet, will try again later");const ie=setInterval(()=>{O&&(q.log("useHLSStream: Unity is now loaded, sending stream URL to Unity"),L($.streamUrl,$.playerIndex||"0"),clearInterval(ie))},1e3);setTimeout(()=>{clearInterval(ie)},3e4)}else q.log(`useHLSStream: No saved stream found for space ${J}`),d(null)}catch($){q.error(`useHLSStream: Error loading stream from Firebase for space ${J}`,$)}finally{o(!1)}},B=N.useCallback(async()=>{C&&(q.log(`useHLSStream: Forcing reload of stream data for space ${C}`),_(J=>J+1),await U(C))},[C]),W=N.useCallback(async(J,$=0,ie={})=>{try{if(!J||!J.trim()){q.error("useHLSStream: Invalid stream URL");return}o(!0),q.log(`useHLSStream: Setting HLS stream URL for LiveProjector[${$}]`,J);const{enabled:ce=!0,rtmpUrl:ne="",streamKey:de="",skipSendToUnity:Q=!1}=ie;if(Q||L(J,$),C)try{const Z={streamUrl:J,playerIndex:$.toString(),enabled:ce,rtmpUrl:ne,streamKey:de,updatedAt:new Date().toISOString()};q.log(`useHLSStream: Saving stream URL to Firebase for space ${C}`,Z),await vF(C,Z),d(Z)}catch(Z){throw q.error(`useHLSStream: Error saving stream URL to Firebase for space ${C}`,Z),Z}else q.warn("useHLSStream: No spaceID available, stream URL not saved to Firebase")}finally{o(!1)}},[L,C]);return N.useEffect(()=>{const $=b("SetHLSStream",ie=>{if(ie)try{q.log("useHLSStream: Received player status update",ie);const{identifier:ce,playerIndex:ne,isReady:de,isPlaying:Q}=ie,Z=`${ce}_${ne}`;e(X=>({...X,[Z]:{identifier:ce,playerIndex:ne,isReady:de,isPlaying:Q}}))}catch(ce){q.error("useHLSStream: Error handling player status update",ce)}});return()=>{$()}},[b]),N.useEffect(()=>{if(l&&l.streamUrl){q.log("useHLSStream: Resending saved stream URL to Unity");const J=setTimeout(()=>{L(l.streamUrl,l.playerIndex||"0")},1e3);return()=>clearTimeout(J)}},[l,n,L,p]),N.useEffect(()=>{const J=$=>{if($.detail){if(q.log("useHLSStream: Received stream update event",$.detail),C===$.detail.spaceId)q.log(`useHLSStream: Stream update is for our space ${C}, loading stream data`),U(C);else if($.detail.streamUrl){q.log(`useHLSStream: Using stream URL directly from event: ${$.detail.streamUrl}`);const ie=$.detail.playerIndex||"0";L($.detail.streamUrl,ie),d($.detail)}}};return window.addEventListener("SpaceHLSStreamUpdated",J),window.addEventListener("SpaceStreamUpdated",J),()=>{window.removeEventListener("SpaceHLSStreamUpdated",J),window.removeEventListener("SpaceStreamUpdated",J)}},[C,L]),{setHLSStreamUrl:W,playerStatus:n,isLoading:i,savedStreamData:l,reloadStreamData:B}},h8e=()=>{const[n,e]=N.useState(!1),i=bf();return N.useEffect(()=>{const l=i("FirstSceneLoaded",()=>{q.log("FirstSceneLoaded unity message received."),e(!0)});return()=>{l()}},[i]),n},f8e=()=>{const[n,e]=N.useState(null),i=bf();return console.log(" Nameplate click hook initialized"),N.useEffect(()=>{console.log(" Setting up nameplate click listener...");const d=i("OpenNameplateModal",p=>{if(console.log(" Nameplate click detected!",p),!p){console.warn(" Received empty data in nameplate click handler");return}try{const _=typeof p=="string"?JSON.parse(p):p;e({playerName:_.playerName,playerId:_.playerId,uid:_.uid,isLocalPlayer:_.isLocalPlayer}),console.log(" Processed nameplate data:",_)}catch(_){console.error(" Error processing nameplate data:",_)}});return()=>{console.log(" Cleaning up nameplate click listener"),typeof d=="function"&&d()}},[i]),[n,()=>{console.log(" Resetting nameplate data"),e(null)}]},p8e=()=>{const n=bf(),{sendUserToUnity:e}=N.useContext(Ao);return N.useEffect(()=>{const o=n("RequestUserForUnity",()=>{q.log("React: Request from Unity to send user data"),e()});return()=>{o()}},[n,e]),!0},UQ=async(n,e,i,o={})=>{try{const{mediaType:l="image",displayAsVideo:d=!1,directUrl:p=null}=o;if(!n||!e)throw new Error("Missing required parameters: spaceId and mediaScreenId");let _=null;if(i){if(!i.type.startsWith("image/"))throw new Error("File must be an image");const E=rm(),b=Date.now(),C=i.name.split(".").pop(),I=`${e}_${b}.${C}`,O=nm(E,`spaces/${n}/mediaScreens/${I}`);q.log(`Uploading image for media screen ${e} in space ${n}`);const L=await xN(O,i);_=await OR(L.ref);const U=Vr(dr,`spaces/${n}/mediaScreens`,e);await j0(U,{imageUrl:_,gsUrl:`gs://${L.ref.bucket}/${L.ref.fullPath}`,fileName:I,mediaType:l,displayAsVideo:d,uploadedAt:new Date().toISOString(),updatedAt:new Date().toISOString()},{merge:!0})}else if(p){_=p;const E=Vr(dr,`spaces/${n}/mediaScreens`,e);await j0(E,{videoUrl:p,mediaType:l,displayAsVideo:d,uploadedAt:new Date().toISOString(),updatedAt:new Date().toISOString()},{merge:!0})}else throw new Error("Either imageFile or directUrl must be provided");return q.log(`Successfully uploaded ${l} for media screen ${e} (display as video: ${d})`),_}catch(l){throw q.error(`Error uploading media screen ${(o==null?void 0:o.mediaType)||"image"}:`,l),l}},P3=async n=>{q.log(`Getting media screen images for space: ${n}`);try{const e=Qp(dr,`spaces/${n}/mediaScreens`),i=await Zy(e),o=[];return i.forEach(l=>{o.push({id:l.id,...l.data()})}),o}catch(e){throw q.error("Error fetching media screen images from Firestore:",e),e}},Dp=async(n,e)=>{try{const i=Vr(dr,`spaces/${n}/mediaScreens`,e),o=await $o(i);return o.exists()?{id:o.id,...o.data()}:(q.warn(`No media screen found with ID: ${e}`),null)}catch(i){throw q.error("Error fetching media screen image:",i),i}},m8e=async(n,e)=>{try{const i=await Dp(n,e);if(!i)return q.warn(`No media screen found with ID: ${e} to delete`),!1;if(i.gsUrl){const l=rm(),d=nm(l,i.gsUrl);try{await LN(d),q.log(`Deleted file from storage: ${i.gsUrl}`)}catch(p){q.warn(`Could not delete file from storage: ${p.message}`)}}const o=Vr(dr,`spaces/${n}/mediaScreens`,e);return i.mediaType==="video"?(await Ys(o,{videoUrl:null,mediaType:null,displayAsVideo:!1,deletedAt:new Date().toISOString(),updatedAt:new Date().toISOString()}),q.log(`Successfully removed video for media screen ${e}`)):(await Ys(o,{imageUrl:null,gsUrl:null,fileName:null,mediaType:null,displayAsVideo:!1,deletedAt:new Date().toISOString(),updatedAt:new Date().toISOString()}),q.log(`Successfully removed image for media screen ${e}`)),!0}catch(i){throw q.error("Error deleting media screen image:",i),i}},g8e=async(n,e,i)=>{try{if(!n||!e||typeof i!="boolean")throw new Error("Missing or invalid required parameters");const o=await Dp(n,e);if(!o||!o.imageUrl&&!o.videoUrl)return q.warn(`No media screen content found with ID: ${e} to update`),!1;const l=Vr(dr,`spaces/${n}/mediaScreens`,e);return await Ys(l,{displayAsVideo:i,updatedAt:new Date().toISOString()}),q.log(`Successfully updated display mode for media screen ${e} to ${i?"video":"image"}`),!0}catch(o){throw q.error("Error updating media screen display mode:",o),o}},_8e=n=>{if(!n)return null;try{if(n.includes("firebasestorage.googleapis.com")){const e=new URL(n),i=e.searchParams.get("alt"),o=e.searchParams.get("token");return e.search="",i&&e.searchParams.set("alt",i),o&&e.searchParams.set("token",o),console.log(`Cleaned Firebase URL from ${n} to ${e.toString()}`),e.toString()}return n}catch(e){return console.error("Error cleaning Firebase URL:",e),n}},nae=()=>{const{spaceID:n}=Ra(),e=Sf(),[i,o]=N.useState(!1);N.useEffect(()=>{if(window.isPlayerInstantiated){q.log("useUnityMediaScreenImages: Unity already ready (via window flag)"),o(!0);return}const l=()=>{q.log("useUnityMediaScreenImages: Unity is now ready (PlayerInstantiated event)"),o(!0)};return window.addEventListener("PlayerInstantiated",l),()=>{window.removeEventListener("PlayerInstantiated",l)}},[]),N.useEffect(()=>{if(!i){q.log("useUnityMediaScreenImages: Waiting for Unity to be ready before loading media screens");return}q.log("useUnityMediaScreenImages: Unity is ready, now loading media screens"),(async()=>{try{if(!n)throw new Error("spaceID is not defined.");const d=await P3(n);q.log("Fetched Media Screen Images",d),d.forEach(p=>{const{id:_,imageUrl:E,displayAsVideo:b,videoUrl:C}=p;let I=null;(!b||!C)&&(I=E?_8e(E):null),e("SetMediaScreenImage",{mediaScreenId:_,imageUrl:I,videoUrl:C||null,displayAsVideo:b||!1,timestamp:Date.now()}),q.log(`Sent media screen data for ${_} to Unity (displayAsVideo: ${b})`),b&&C&&(e("SetMediaScreenDisplayMode",{mediaScreenId:_,displayAsVideo:!0,videoUrl:C,timestamp:Date.now()}),q.log(`Set display mode to video for screen ${_}`))})}catch(d){q.error("Error fetching media screen images:",d)}})()},[e,n,i])},y8e=()=>{const{spaceID:n}=Ra(),e=Sf(),[i,o]=N.useState(!1);N.useEffect(()=>{if(window.isPlayerInstantiated){q.log("useUnityThumbnails: Unity already ready (via window flag)"),o(!0);return}const l=()=>{q.log("useUnityThumbnails: Unity is now ready (PlayerInstantiated event)"),o(!0)};return window.addEventListener("PlayerInstantiated",l),()=>{window.removeEventListener("PlayerInstantiated",l)}},[]),N.useEffect(()=>{if(!i){q.log("useUnityThumbnails: Waiting for Unity to be ready before loading thumbnails");return}q.log("useUnityThumbnails: Unity is ready, now loading thumbnails"),(async()=>{try{if(!n)throw new Error("spaceID is not defined.");const d=await xoe(n),p=async b=>{const C=`https://vimeo.com/api/oembed.json?url=${b}`,I=await fetch(C);if(!I.ok)throw new Error(`Failed to fetch thumbnail: ${I.statusText}`);const O=await I.json(),L=O.thumbnail_url.replace(/_\d+x\d+/,""),U=["640x360","295x166"];let B=null;for(let W of U){const J=`https://i.vimeocdn.com/filter/overlay?src0=${encodeURIComponent(`${L}_${W}`)}&src1=http://f.vimeocdn.com/p/images/crawler_play.png`;try{if((await fetch(J,{method:"HEAD"})).ok){B=J;break}}catch($){console.warn(`Failed to validate thumbnail URL: ${J}`,$)}}return B||O.thumbnail_url},_=d.map(async b=>{const C=await p(b.url);return{gameObjectName:b.id,thumbnailUrl:C}}),E=await Promise.all(_);q.log("Fetched Thumbnails",E),E.forEach(({gameObjectName:b,thumbnailUrl:C})=>{e("SetThumbnail",{gameObjectName:b,thumbnailUrl:C})})}catch(d){q.error("Error fetching thumbnails:",d)}})()},[e,n,i])},rae=()=>{const[n,e]=N.useState([]),i=bf();return N.useEffect(()=>{let o=!0,l=null;const d=()=>{window.unityInstance&&(q.log("Requesting fresh player list"),window.unityInstance.SendMessage("NetworkManager","RequestPlayerList"))},p=L=>{if(o){q.log("UpdatePlayerList unity message received.");try{let U=[];if(typeof L=="object"&&L!==null?U=L.players||[]:U=JSON.parse(L).players||[],Array.isArray(U)){const B=Array.from(new Map(U.map(W=>[W.playerId,W])).values());e(B),l&&(clearTimeout(l),l=null)}}catch(U){q.error("Error handling player list data:",U),l||(l=setTimeout(d,1e3))}}},_=()=>{q.log("Player disconnected, requesting fresh player list"),d()},E=()=>{q.log("Player left, requesting fresh player list"),d()};d();const b=i("UpdatePlayerList",p),C=i("PlayerDisconnected",_),I=i("PlayerLeft",E),O=setInterval(d,5e3);return()=>{o=!1,l&&clearTimeout(l),typeof b=="function"&&b(),typeof C=="function"&&C(),typeof I=="function"&&I(),clearInterval(O)}},[i]),n},iae=()=>{const n=Sf(),{isLoaded:e}=Ra(),[i,o]=N.useState(!1);N.useEffect(()=>{if(window.isPlayerInstantiated){q.log("usePlacePrefab: Unity already ready (via window flag)"),o(!0);return}const p=()=>{q.log("usePlacePrefab: Unity is now ready (PlayerInstantiated event)"),o(!0)};return window.addEventListener("PlayerInstantiated",p),()=>{window.removeEventListener("PlayerInstantiated",p)}},[]);const l=N.useCallback((p,_,E,b)=>{const C=_||{x:0,y:1,z:0},I=E||{x:0,y:0,z:0},O=b||{x:1,y:1,z:1};try{const L={prefabName:p||"TestPrefab",position:C,rotation:I,scale:O};return q.log("Sending prefab placement to Unity:",L),n("PlacePrefab",L),!0}catch(L){return q.error("Error placing prefab:",L),!1}},[n]),d=N.useCallback((p,_,E,b)=>{const C=_||{x:0,y:1,z:0},I=E||{x:0,y:0,z:0},O=b||{x:1,y:1,z:1};if(!window.unityInstance)return q.error("Unity not loaded, cannot place prefab directly"),!1;try{const L={prefabName:p||"TestPrefab",position:C,rotation:I,scale:O},U={eventName:"PlacePrefab",data:JSON.stringify(L)};return q.log("Directly sending prefab placement to Unity:",L),window.unityInstance.SendMessage("ReactIncomingEvent","HandleEvent",JSON.stringify(U)),!0}catch(L){return q.error("Error directly placing prefab:",L),!1}},[]);return{placePrefab:l,directPlacePrefab:d,isUnityLoaded:i&&e}},E8e=n=>{const[e,i]=N.useState(null),o=bf(),{spaceID:l}=Ra();return N.useEffect(()=>{let p=!0;const E=o("PlayVideo",async b=>{try{const{gameObjectName:C}=b;if(!C){q.error("Game object name is missing in Unity event data.");return}const I=await xoe(l);q.log("SPACES VIDEOS",I);const O=I.find(L=>L.id===C);O&&p?(i(O.url),q.log("Video URL set to:",O.url)):console.error("Video not found for game object:",C)}catch(C){console.error("Error fetching space videos:",C)}});return()=>{p=!1,E()}},[o,l,n]),[e,()=>{i(null)}]};let qO;const v8e=new Uint8Array(16);function S8e(){if(!qO&&(qO=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!qO))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return qO(v8e)}const Ea=[];for(let n=0;n<256;++n)Ea.push((n+256).toString(16).slice(1));function b8e(n,e=0){return Ea[n[e+0]]+Ea[n[e+1]]+Ea[n[e+2]]+Ea[n[e+3]]+"-"+Ea[n[e+4]]+Ea[n[e+5]]+"-"+Ea[n[e+6]]+Ea[n[e+7]]+"-"+Ea[n[e+8]]+Ea[n[e+9]]+"-"+Ea[n[e+10]]+Ea[n[e+11]]+Ea[n[e+12]]+Ea[n[e+13]]+Ea[n[e+14]]+Ea[n[e+15]]}const T8e=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),VQ={randomUUID:T8e};function w8e(n,e,i){if(VQ.randomUUID&&!n)return VQ.randomUUID();n=n||{};const o=n.random||(n.rng||S8e)();return o[6]=o[6]&15|64,o[8]=o[8]&63|128,b8e(o)}const WN="spaces",zN="objects",C8e=async(n,e,i)=>{try{const o=Vr(dr,WN,n,zN,e),l={...i,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),spaceId:n,objectId:e};return await j0(o,l),q.log(`Saved object ${e} to space ${n}`),!0}catch(o){return q.error("Error saving object to space:",o),!1}},FQ=async n=>{try{const e=Qp(dr,WN,n,zN),i=await Zy(e),o=[];return i.forEach(l=>{o.push({id:l.id,...l.data()})}),q.log(`Retrieved ${o.length} objects for space ${n}`),o}catch(e){return q.error("Error getting space objects:",e),[]}},R8e=async(n,e)=>{try{const i=Vr(dr,WN,n,zN,e);return await IBe(i),q.log(`Deleted object ${e} from space ${n}`),!0}catch(i){return q.error("Error deleting space object:",i),!1}},I8e=async(n,e,i)=>{try{const o=Vr(dr,WN,n,zN,e),l={...i,updatedAt:new Date().toISOString()};return await Ys(o,l),q.log(`Updated object ${e} in space ${n}`),!0}catch(o){return q.error("Error updating space object:",o),!1}},A8e=n=>{const[e,i]=N.useState([]),[o,l]=N.useState(!0),{placePrefab:d,isUnityLoaded:p}=iae();N.useEffect(()=>{(async()=>{if(n){l(!0);try{const O=await FQ(n);i(O),O.forEach(L=>{d(L.prefabName,L.position,L.rotation,L.scale)})}catch(O){q.error("Error loading space objects:",O)}finally{l(!1)}}})()},[n,d]);const _=N.useCallback(async(I,O,L,U)=>{if(!n)return!1;const B=w8e(),W={prefabName:I,position:O,rotation:L,scale:U,objectId:B},J=await C8e(n,B,W);return J&&(i($=>[...$,{id:B,...W}]),d(I,O,L,U)),J},[n,d]),E=N.useCallback(async I=>{if(!n)return!1;const O=await R8e(n,I);return O&&i(L=>L.filter(U=>U.id!==I)),O},[n]),b=N.useCallback(async(I,O)=>{if(!n)return!1;const L=await I8e(n,I,O);return L&&i(U=>U.map(B=>B.id===I?{...B,...O}:B)),L},[n]),C=N.useCallback(async()=>{if(n){l(!0);try{const I=await FQ(n);i(I),I.forEach(O=>{d(O.prefabName,O.position,O.rotation,O.scale)})}catch(I){q.error("Error reloading space objects:",I)}finally{l(!1)}}},[n,d]);return{objects:e,isLoading:o,saveObject:_,deleteObject:E,updateObject:b,reloadObjects:C,isUnityLoaded:p}},P8e=n=>({opacity:1});function O8e(){const{loadingProgression:n,isLoaded:e,error:i}=Ra(),{user:o}=N.useContext(Ao),[l,d]=N.useState(!1),[p,_]=N.useState(!1),[E,b]=N.useState(!1),[C,I]=N.useState(!1),O=N.useRef(!1),L=N.useRef(!1),U=N.useRef(null),B=N.useRef(null),W=N.useRef(null),J=bf(),$=N.useRef(null),ie=N.useRef(null),ce=N.useRef(null);N.useRef(null),N.useEffect(()=>{d(!o&&n===0)},[o,n]),N.useEffect(()=>{const Q=document.createElement("style");return Q.textContent=`
      /* Set initial Unity canvas styles */
      #unity-canvas, #unity-container {
        opacity: 0 !important;
        transition: opacity 1s ease-in-out;
        z-index: 1 !important; /* Ensure Unity is below our loader */
      }
      
      /* Loader overlay styles */
      .loader-overlay {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        z-index: 99999 !important; /* Extremely high z-index */
        display: flex;
        align-items: center;
        justify-content: center;
        transition: opacity 1.5s ease-in-out;
        pointer-events: auto !important;
        transform: translateZ(0); /* Create stacking context */
      }
      
      /* Loader content styles */
      .loader-content {
        background-color: rgba(0, 0, 0, 0.8);
        padding: 1rem;
        border-radius: 0.5rem;
        color: white;
        text-align: center;
        z-index: 100000 !important; /* Even higher z-index */
      }
    `,document.head.appendChild(Q),$.current=Q,()=>{$.current&&document.head.removeChild($.current)}},[]),N.useEffect(()=>{const Q=()=>{const Z=document.getElementById("unity-canvas"),X=document.getElementById("unity-container");Z&&(U.current=Z,Z.style.zIndex="1"),X&&(B.current=X,X.style.zIndex="1"),Z&&X&&ce.current&&(clearInterval(ce.current),ce.current=null)};return Q(),ce.current=setInterval(Q,100),()=>{ce.current&&(clearInterval(ce.current),ce.current=null)}},[]),N.useEffect(()=>{window.isFirstSceneLoaded&&(L.current=!0,I(!0));const Z=J("FirstSceneLoaded",()=>{L.current=!0,I(!0),window.isFirstSceneLoaded=!0}),X=setTimeout(()=>{L.current||(L.current=!0,I(!0),window.isFirstSceneLoaded=!0)},1e4);return()=>{Z(),clearTimeout(X)}},[J]),N.useEffect(()=>{window.isPlayerInstantiated&&(O.current=!0,b(!0),L.current||(L.current=!0,I(!0),window.isFirstSceneLoaded=!0));const Q=()=>{O.current=!0,b(!0),L.current||(L.current=!0,I(!0),window.isFirstSceneLoaded=!0)};window.addEventListener("PlayerInstantiated",Q);const Z=J("PlayerInstantiated",Q),X=setTimeout(()=>{O.current||(O.current=!0,b(!0),L.current||(L.current=!0,I(!0),window.isFirstSceneLoaded=!0))},2e4);return()=>{window.removeEventListener("PlayerInstantiated",Q),Z(),clearTimeout(X)}},[J]),N.useEffect(()=>(C&&E&&(console.log("LoaderProgress: Both conditions met, showing Unity canvas"),ie.current&&clearTimeout(ie.current),ie.current=setTimeout(()=>{U.current&&(U.current.style.opacity="1",U.current.style.removeProperty("opacity")),B.current&&(B.current.style.opacity="1",B.current.style.removeProperty("opacity")),W.current&&(W.current.style.opacity="0",W.current.style.pointerEvents="none",setTimeout(()=>{W.current&&(W.current.style.display="none")},1500))},2e3)),()=>{ie.current&&clearTimeout(ie.current)}),[C,E]);const ne=()=>e?e&&!C&&!E?"Scene initializing":C&&!E?"Player initializing":"Ready":"World loading",de=()=>e?e&&!C&&!E?85:C&&!E?95:100:n*80;return w.jsx(w.Fragment,{children:l?w.jsx(lt,{position:"absolute",zIndex:"99999",width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",style:{transform:"translateZ(0)"},children:w.jsxs(Qr,{spacing:4,padding:6,borderRadius:"md",backgroundColor:"rgba(0, 0, 0, 0.8)",color:"white",children:[w.jsx(Ze,{fontSize:"xl",fontWeight:"bold",children:"Sign In Required"}),w.jsx(Ze,{textAlign:"center",children:"Please sign in to enter The Disruptive Spaces"}),w.jsx(ur,{colorScheme:"blue",size:"lg",width:"200px",onClick:()=>_(!0),children:"Sign In"})]})}):w.jsx(lt,{ref:W,className:"loader-overlay",style:{transform:"translateZ(0)",zIndex:99999},children:w.jsxs(wr,{className:"loader-content",flexDirection:"column",alignItems:"center",width:"300px",style:{zIndex:1e5},children:[w.jsx(Ze,{fontWeight:"bold",children:"Entering The Spaces Metaverse"}),w.jsx(Ze,{fontSize:"sm",children:ne()}),w.jsx(jy,{value:de(),size:"lg",width:"100%",marginY:2})]})})})}function k8e(){const{user:n}=N.useContext(Ao);return w.jsx("div",{children:n!==null?w.jsx("div",{children:w.jsx(R3,{})}):w.jsxs("div",{children:[w.jsx(jN,{}),w.jsx(BN,{})]})})}function N8e(){const{fullscreenRef:n}=Gd(),[e,i]=N.useState(!1),o=()=>{i(!e)};return w.jsxs(w.Fragment,{children:[w.jsx(Vp,{label:"Help",hasArrow:!0,placement:"top",closeOnClick:!0,portalProps:{containerRef:n},children:w.jsx(Ho,{"aria-label":"Controller Help",icon:w.jsx(yWe,{}),onClick:o,variant:"iconButton"})}),w.jsxs(oo,{isOpen:e,onClose:o,size:"md",portalProps:{containerRef:n},children:[w.jsx(co,{}),w.jsxs(ao,{children:[w.jsx(tc,{children:"Notes"}),w.jsx(Ko,{}),w.jsx(Ro,{children:w.jsx(Ze,{variant:"formIntro",children:"The help button is showing so we can see the blur and transparency styles on the button."})}),w.jsx($p,{children:w.jsx(ur,{variant:"primary",onClick:o,children:"Close"})})]})]})]})}var sae={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},jQ=mi.createContext&&mi.createContext(sae),kg=function(){return kg=Object.assign||function(n){for(var e,i=1,o=arguments.length;i<o;i++){e=arguments[i];for(var l in e)Object.prototype.hasOwnProperty.call(e,l)&&(n[l]=e[l])}return n},kg.apply(this,arguments)},D8e=function(n,e){var i={};for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&e.indexOf(o)<0&&(i[o]=n[o]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var l=0,o=Object.getOwnPropertySymbols(n);l<o.length;l++)e.indexOf(o[l])<0&&Object.prototype.propertyIsEnumerable.call(n,o[l])&&(i[o[l]]=n[o[l]]);return i};function oae(n){return n&&n.map(function(e,i){return mi.createElement(e.tag,kg({key:i},e.attr),oae(e.child))})}function Cr(n){return function(e){return mi.createElement(x8e,kg({attr:kg({},n.attr)},e),oae(n.child))}}function x8e(n){var e=function(i){var o=n.attr,l=n.size,d=n.title,p=D8e(n,["attr","size","title"]),_=l||i.size||"1em",E;return i.className&&(E=i.className),n.className&&(E=(E?E+" ":"")+n.className),mi.createElement("svg",kg({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},i.attr,o,p,{className:E,style:kg(kg({color:n.color||i.color},i.style),n.style),height:_,width:_,xmlns:"http://www.w3.org/2000/svg"}),d&&mi.createElement("title",null,d),n.children)};return jQ!==void 0?mi.createElement(jQ.Consumer,null,function(i){return e(i)}):e(sae)}function aae(n){return Cr({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"}}]})(n)}function L8e(n){return Cr({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M256 8C119.034 8 8 119.033 8 256s111.034 248 248 248 248-111.034 248-248S392.967 8 256 8zm130.108 117.892c65.448 65.448 70 165.481 20.677 235.637L150.47 105.216c70.204-49.356 170.226-44.735 235.638 20.676zM125.892 386.108c-65.448-65.448-70-165.481-20.677-235.637L361.53 406.784c-70.203 49.356-170.226 44.736-235.638-20.676z"}}]})(n)}function BQ(n){return Cr({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M173.898 439.404l-166.4-166.4c-9.997-9.997-9.997-26.206 0-36.204l36.203-36.204c9.997-9.998 26.207-9.998 36.204 0L192 312.69 432.095 72.596c9.997-9.997 26.207-9.997 36.204 0l36.203 36.204c9.997 9.997 9.997 26.206 0 36.204l-294.4 294.401c-9.998 9.997-26.207 9.997-36.204-.001z"}}]})(n)}function WQ(n){return Cr({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M320 448v40c0 13.255-10.745 24-24 24H24c-13.255 0-24-10.745-24-24V120c0-13.255 10.745-24 24-24h72v296c0 30.879 25.121 56 56 56h168zm0-344V0H152c-13.255 0-24 10.745-24 24v368c0 13.255 10.745 24 24 24h272c13.255 0 24-10.745 24-24V128H344c-13.2 0-24-10.8-24-24zm120.971-31.029L375.029 7.029A24 24 0 0 0 358.059 0H352v96h96v-6.059a24 24 0 0 0-7.029-16.97z"}}]})(n)}function PF(n){return Cr({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M528 448H112c-8.8 0-16 7.2-16 16v32c0 8.8 7.2 16 16 16h416c8.8 0 16-7.2 16-16v-32c0-8.8-7.2-16-16-16zm64-320c-26.5 0-48 21.5-48 48 0 7.1 1.6 13.7 4.4 19.8L476 239.2c-15.4 9.2-35.3 4-44.2-11.6L350.3 85C361 76.2 368 63 368 48c0-26.5-21.5-48-48-48s-48 21.5-48 48c0 15 7 28.2 17.7 37l-81.5 142.6c-8.9 15.6-28.9 20.8-44.2 11.6l-72.3-43.4c2.7-6 4.4-12.7 4.4-19.8 0-26.5-21.5-48-48-48S0 149.5 0 176s21.5 48 48 48c2.6 0 5.2-.4 7.7-.8L128 416h384l72.3-192.8c2.5.4 5.1.8 7.7.8 26.5 0 48-21.5 48-48s-21.5-48-48-48z"}}]})(n)}function M8e(n){return Cr({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M402.6 83.2l90.2 90.2c3.8 3.8 3.8 10 0 13.8L274.4 405.6l-92.8 10.3c-12.4 1.4-22.9-9.1-21.5-21.5l10.3-92.8L388.8 83.2c3.8-3.8 10-3.8 13.8 0zm162-22.9l-48.8-48.8c-15.2-15.2-39.9-15.2-55.2 0l-35.4 35.4c-3.8 3.8-3.8 10 0 13.8l90.2 90.2c3.8 3.8 10 3.8 13.8 0l35.4-35.4c15.2-15.3 15.2-40 0-55.2zM384 346.2V448H64V128h229.8c3.2 0 6.2-1.3 8.5-3.5l40-40c7.6-7.6 2.2-20.5-8.5-20.5H48C21.5 64 0 85.5 0 112v352c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V306.2c0-10.7-12.9-16-20.5-8.5l-40 40c-2.2 2.3-3.5 5.3-3.5 8.5z"}}]})(n)}function U8e(n){return Cr({attr:{viewBox:"0 0 192 512"},child:[{tag:"path",attr:{d:"M96 184c39.8 0 72 32.2 72 72s-32.2 72-72 72-72-32.2-72-72 32.2-72 72-72zM24 80c0 39.8 32.2 72 72 72s72-32.2 72-72S135.8 8 96 8 24 40.2 24 80zm0 352c0 39.8 32.2 72 72 72s72-32.2 72-72-32.2-72-72-72-72 32.2-72 72z"}}]})(n)}function V8e(n){return Cr({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M480.07 96H160a160 160 0 1 0 114.24 272h91.52A160 160 0 1 0 480.07 96zM248 268a12 12 0 0 1-12 12h-52v52a12 12 0 0 1-12 12h-24a12 12 0 0 1-12-12v-52H84a12 12 0 0 1-12-12v-24a12 12 0 0 1 12-12h52v-52a12 12 0 0 1 12-12h24a12 12 0 0 1 12 12v52h52a12 12 0 0 1 12 12zm216 76a40 40 0 1 1 40-40 40 40 0 0 1-40 40zm64-96a40 40 0 1 1 40-40 40 40 0 0 1-40 40z"}}]})(n)}function cae(n){return Cr({attr:{viewBox:"0 0 496 512"},child:[{tag:"path",attr:{d:"M336.5 160C322 70.7 287.8 8 248 8s-74 62.7-88.5 152h177zM152 256c0 22.2 1.2 43.5 3.3 64h185.3c2.1-20.5 3.3-41.8 3.3-64s-1.2-43.5-3.3-64H155.3c-2.1 20.5-3.3 41.8-3.3 64zm324.7-96c-28.6-67.9-86.5-120.4-158-141.6 24.4 33.8 41.2 84.7 50 141.6h108zM177.2 18.4C105.8 39.6 47.8 92.1 19.3 160h108c8.7-56.9 25.5-107.8 49.9-141.6zM487.4 192H372.7c2.1 21 3.3 42.5 3.3 64s-1.2 43-3.3 64h114.6c5.5-20.5 8.6-41.8 8.6-64s-3.1-43.5-8.5-64zM120 256c0-21.5 1.2-43 3.3-64H8.6C3.2 212.5 0 233.8 0 256s3.2 43.5 8.6 64h114.6c-2-21-3.2-42.5-3.2-64zm39.5 96c14.5 89.3 48.7 152 88.5 152s74-62.7 88.5-152h-177zm159.3 141.6c71.4-21.2 129.4-73.7 158-141.6h-108c-8.8 56.9-25.6 107.8-50 141.6zM19.3 352c28.6 67.9 86.5 120.4 158 141.6-24.4-33.8-41.2-84.7-50-141.6h-108z"}}]})(n)}function F8e(n){return Cr({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M256 8C119.043 8 8 119.083 8 256c0 136.997 111.043 248 248 248s248-111.003 248-248C504 119.083 392.957 8 256 8zm0 110c23.196 0 42 18.804 42 42s-18.804 42-42 42-42-18.804-42-42 18.804-42 42-42zm56 254c0 6.627-5.373 12-12 12h-88c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h12v-64h-12c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h64c6.627 0 12 5.373 12 12v100h12c6.627 0 12 5.373 12 12v24z"}}]})(n)}function j8e(n){return Cr({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M528 448H48c-26.51 0-48-21.49-48-48V112c0-26.51 21.49-48 48-48h480c26.51 0 48 21.49 48 48v288c0 26.51-21.49 48-48 48zM128 180v-40c0-6.627-5.373-12-12-12H76c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm-336 96v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm-336 96v-40c0-6.627-5.373-12-12-12H76c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm288 0v-40c0-6.627-5.373-12-12-12H172c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h232c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12z"}}]})(n)}function OF(n){return Cr({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M633.82 458.1l-157.8-121.96C488.61 312.13 496 285.01 496 256v-48c0-8.84-7.16-16-16-16h-16c-8.84 0-16 7.16-16 16v48c0 17.92-3.96 34.8-10.72 50.2l-26.55-20.52c3.1-9.4 5.28-19.22 5.28-29.67V96c0-53.02-42.98-96-96-96s-96 42.98-96 96v45.36L45.47 3.37C38.49-2.05 28.43-.8 23.01 6.18L3.37 31.45C-2.05 38.42-.8 48.47 6.18 53.9l588.36 454.73c6.98 5.43 17.03 4.17 22.46-2.81l19.64-25.27c5.41-6.97 4.16-17.02-2.82-22.45zM400 464h-56v-33.77c11.66-1.6 22.85-4.54 33.67-8.31l-50.11-38.73c-6.71.4-13.41.87-20.35.2-55.85-5.45-98.74-48.63-111.18-101.85L144 241.31v6.85c0 89.64 63.97 169.55 152 181.69V464h-56c-8.84 0-16 7.16-16 16v16c0 8.84 7.16 16 16 16h160c8.84 0 16-7.16 16-16v-16c0-8.84-7.16-16-16-16z"}}]})(n)}function kF(n){return Cr({attr:{viewBox:"0 0 352 512"},child:[{tag:"path",attr:{d:"M176 352c53.02 0 96-42.98 96-96V96c0-53.02-42.98-96-96-96S80 42.98 80 96v160c0 53.02 42.98 96 96 96zm160-160h-16c-8.84 0-16 7.16-16 16v48c0 74.8-64.49 134.82-140.79 127.38C96.71 376.89 48 317.11 48 250.3V208c0-8.84-7.16-16-16-16H16c-8.84 0-16 7.16-16 16v40.16c0 89.64 63.97 169.55 152 181.69V464H96c-8.84 0-16 7.16-16 16v16c0 8.84 7.16 16 16 16h160c8.84 0 16-7.16 16-16v-16c0-8.84-7.16-16-16-16h-56v-33.77C285.71 418.47 352 344.9 352 256v-48c0-8.84-7.16-16-16-16z"}}]})(n)}function B8e(n){return Cr({attr:{viewBox:"0 0 384 512"},child:[{tag:"path",attr:{d:"M0 352a160 160 0 0 0 160 160h64a160 160 0 0 0 160-160V224H0zM176 0h-16A160 160 0 0 0 0 160v32h176zm48 0h-16v192h176v-32A160 160 0 0 0 224 0z"}}]})(n)}function W8e(n){return Cr({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M416 208H272V64c0-17.67-14.33-32-32-32h-32c-17.67 0-32 14.33-32 32v144H32c-17.67 0-32 14.33-32 32v32c0 17.67 14.33 32 32 32h144v144c0 17.67 14.33 32 32 32h32c17.67 0 32-14.33 32-32V304h144c17.67 0 32-14.33 32-32v-32c0-17.67-14.33-32-32-32z"}}]})(n)}function z8e(n){return Cr({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M466.5 83.7l-192-80a48.15 48.15 0 0 0-36.9 0l-192 80C27.7 91.1 16 108.6 16 128c0 198.5 114.5 335.7 221.5 380.3 11.8 4.9 25.1 4.9 36.9 0C360.1 472.6 496 349.3 496 128c0-19.4-11.7-36.9-29.5-44.3zM256.1 446.3l-.1-381 175.9 73.3c-3.3 151.4-82.1 261.1-175.8 307.7z"}}]})(n)}function NF(n){return Cr({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M259.3 17.8L194 150.2 47.9 171.5c-26.2 3.8-36.7 36.1-17.7 54.6l105.7 103-25 145.5c-4.5 26.3 23.2 46 46.4 33.7L288 439.6l130.7 68.7c23.2 12.2 50.9-7.4 46.4-33.7l-25-145.5 105.7-103c19-18.5 8.5-50.8-17.7-54.6L382 150.2 316.7 17.8c-11.7-23.6-45.6-23.9-57.4 0z"}}]})(n)}function G8e(n){return Cr({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M624 208h-64v-64c0-8.8-7.2-16-16-16h-32c-8.8 0-16 7.2-16 16v64h-64c-8.8 0-16 7.2-16 16v32c0 8.8 7.2 16 16 16h64v64c0 8.8 7.2 16 16 16h32c8.8 0 16-7.2 16-16v-64h64c8.8 0 16-7.2 16-16v-32c0-8.8-7.2-16-16-16zm-400 48c70.7 0 128-57.3 128-128S294.7 0 224 0 96 57.3 96 128s57.3 128 128 128zm89.6 32h-16.7c-22.2 10.2-46.9 16-72.9 16s-50.6-5.8-72.9-16h-16.7C60.2 288 0 348.2 0 422.4V464c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48v-41.6c0-74.2-60.2-134.4-134.4-134.4z"}}]})(n)}function H8e(n){return Cr({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M96 224c35.3 0 64-28.7 64-64s-28.7-64-64-64-64 28.7-64 64 28.7 64 64 64zm448 0c35.3 0 64-28.7 64-64s-28.7-64-64-64-64 28.7-64 64 28.7 64 64 64zm32 32h-64c-17.6 0-33.5 7.1-45.1 18.6 40.3 22.1 68.9 62 75.1 109.4h66c17.7 0 32-14.3 32-32v-32c0-35.3-28.7-64-64-64zm-256 0c61.9 0 112-50.1 112-112S381.9 32 320 32 208 82.1 208 144s50.1 112 112 112zm76.8 32h-8.3c-20.8 10-43.9 16-68.5 16s-47.6-6-68.5-16h-8.3C179.6 288 128 339.6 128 403.2V432c0 26.5 21.5 48 48 48h288c26.5 0 48-21.5 48-48v-28.8c0-63.6-51.6-115.2-115.2-115.2zm-223.7-13.4C161.5 263.1 145.6 256 128 256H64c-35.3 0-64 28.7-64 64v32c0 17.7 14.3 32 32 32h65.9c6.3-47.4 34.9-87.3 75.2-109.4z"}}]})(n)}function $8e(n){return Cr({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M215.03 71.05L126.06 160H24c-13.26 0-24 10.74-24 24v144c0 13.25 10.74 24 24 24h102.06l88.97 88.95c15.03 15.03 40.97 4.47 40.97-16.97V88.02c0-21.46-25.96-31.98-40.97-16.97zM461.64 256l45.64-45.64c6.3-6.3 6.3-16.52 0-22.82l-22.82-22.82c-6.3-6.3-16.52-6.3-22.82 0L416 210.36l-45.64-45.64c-6.3-6.3-16.52-6.3-22.82 0l-22.82 22.82c-6.3 6.3-6.3 16.52 0 22.82L370.36 256l-45.63 45.63c-6.3 6.3-6.3 16.52 0 22.82l22.82 22.82c6.3 6.3 16.52 6.3 22.82 0L416 301.64l45.64 45.64c6.3 6.3 16.52 6.3 22.82 0l22.82-22.82c6.3-6.3 6.3-16.52 0-22.82L461.64 256z"}}]})(n)}function K8e(n){return Cr({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M215.03 71.05L126.06 160H24c-13.26 0-24 10.74-24 24v144c0 13.25 10.74 24 24 24h102.06l88.97 88.95c15.03 15.03 40.97 4.47 40.97-16.97V88.02c0-21.46-25.96-31.98-40.97-16.97zm233.32-51.08c-11.17-7.33-26.18-4.24-33.51 6.95-7.34 11.17-4.22 26.18 6.95 33.51 66.27 43.49 105.82 116.6 105.82 195.58 0 78.98-39.55 152.09-105.82 195.58-11.17 7.32-14.29 22.34-6.95 33.5 7.04 10.71 21.93 14.56 33.51 6.95C528.27 439.58 576 351.33 576 256S528.27 72.43 448.35 19.97zM480 256c0-63.53-32.06-121.94-85.77-156.24-11.19-7.14-26.03-3.82-33.12 7.46s-3.78 26.21 7.41 33.36C408.27 165.97 432 209.11 432 256s-23.73 90.03-63.48 115.42c-11.19 7.14-14.5 22.07-7.41 33.36 6.51 10.36 21.12 15.14 33.12 7.46C447.94 377.94 480 319.54 480 256zm-141.77-76.87c-11.58-6.33-26.19-2.16-32.61 9.45-6.39 11.61-2.16 26.2 9.45 32.61C327.98 228.28 336 241.63 336 256c0 14.38-8.02 27.72-20.92 34.81-11.61 6.41-15.84 21-9.45 32.61 6.43 11.66 21.05 15.8 32.61 9.45 28.23-15.55 45.77-45 45.77-76.88s-17.54-61.32-45.78-76.86z"}}]})(n)}function q8e(n){return Cr({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M634.91 154.88C457.74-8.99 182.19-8.93 5.09 154.88c-6.66 6.16-6.79 16.59-.35 22.98l34.24 33.97c6.14 6.1 16.02 6.23 22.4.38 145.92-133.68 371.3-133.71 517.25 0 6.38 5.85 16.26 5.71 22.4-.38l34.24-33.97c6.43-6.39 6.3-16.82-.36-22.98zM320 352c-35.35 0-64 28.65-64 64s28.65 64 64 64 64-28.65 64-64-28.65-64-64-64zm202.67-83.59c-115.26-101.93-290.21-101.82-405.34 0-6.9 6.1-7.12 16.69-.57 23.15l34.44 33.99c6 5.92 15.66 6.32 22.05.8 83.95-72.57 209.74-72.41 293.49 0 6.39 5.52 16.05 5.13 22.05-.8l34.44-33.99c6.56-6.46 6.33-17.06-.56-23.15z"}}]})(n)}function lae({open:n,onClose:e}){const i=N.useRef(null),o=Sf(),{user:l}=N.useContext(Ao),d=E=>{i.current&&!i.current.contains(E.target)&&e()},p=async E=>{const b=_(E);if((b==null?void 0:b.source)==="readyplayerme"&&(b.eventName==="v1.frame.ready"&&i.current.contentWindow.postMessage(JSON.stringify({target:"readyplayerme",type:"subscribe",eventName:"v1.**"}),"*"),b.eventName==="v1.avatar.exported")){const C=b.data.url;if(console.log(`Avatar URL: ${C}`),o("AvatarUrlFromReact",{url:C}),l&&l.uid)try{await _oe(l.uid,C),e()}catch(I){console.error("Error updating RPM URL:",I)}else console.error("No authenticated user found to update rpmURL.")}},_=E=>{try{return JSON.parse(E.data)}catch{return null}};return N.useEffect(()=>(n&&(document.addEventListener("mousedown",d),window.addEventListener("message",p)),()=>{document.removeEventListener("mousedown",d),window.removeEventListener("message",p)}),[n]),n&&w.jsx(Yl,{children:w.jsx(lt,{position:"fixed",top:"0",left:"0",width:"100%",height:"100%",bg:"rgba(0, 0, 0, 0.8)",zIndex:1e4,display:"flex",justifyContent:"center",alignItems:"center",onClick:E=>E.stopPropagation(),children:w.jsx(lt,{position:"relative",maxWidth:"1080px",maxHeight:"800px",width:"90%",height:"90%",children:w.jsx("iframe",{ref:i,src:"https://spacesmetaverse.readyplayer.me/avatar?frameApi",title:"Ready Player Me",width:"100%",height:"100%",style:{border:"none",borderRadius:"8px"},allow:"camera *; microphone *; clipboard-write"})})})})}function Y8e({isOpen:n,onClose:e}){const[i,o]=N.useState(!1),[l,d]=N.useState(null),{user:p}=N.useContext(Ao),_=Sf(),E=U=>{U.stopPropagation(),o(!0)},b=()=>{o(!1),e()},C=async U=>{if(d(U),p&&p.uid)try{await _oe(p.uid,U.url),_("AvatarUrlFromReact",{url:U.url}),e()}catch(B){console.error("Error updating RPM URL:",B)}else console.error("No authenticated user found to update rpmURL.")},I=qIe("gray.200","whiteAlpha.300"),O="rgba(0, 0, 0, 0.3)",L=[{id:1,url:"https://models.readyplayer.me/67c8408d38f7924e15a8bd0a.glb",name:"Default Avatar 1"},{id:2,url:"https://models.readyplayer.me/67c8576838e3cf57cc697c15.glb",name:"Default Avatar 2"},{id:3,url:"https://models.readyplayer.me/67c884144c4878c55e515ff5.glb",name:"Default Avatar 3"},{id:4,url:"https://models.readyplayer.me/67c885af25f4d62e75c0ff1e.glb",name:"Default Avatar 4"},{id:5,url:"https://models.readyplayer.me/67c8860f4c4878c55e5189b6.glb",name:"Default Avatar 5"},{id:6,url:"https://models.readyplayer.me/67c8869db6d0b438b7abd822.glb",name:"Default Avatar 6"},{id:7,url:"https://models.readyplayer.me/67c886ed28ee0e0bfac89688.glb",name:"Default Avatar 7"},{id:8,url:"https://models.readyplayer.me/67c88731795ea3e2e6ea84db.glb",name:"Default Avatar 8"},{id:9,url:"https://models.readyplayer.me/67c8878b0cdc0f22383f0f8f.glb",name:"Default Avatar 9"}];return w.jsxs(w.Fragment,{children:[w.jsx(Yl,{children:w.jsxs(oo,{isOpen:n,onClose:e,isCentered:!0,size:"xl",zIndex:9999,children:[w.jsx(co,{bg:"rgba(0, 0, 0, 0.7)"}),w.jsxs(ao,{bg:"gray.800",color:"white",maxW:"900px",children:[w.jsx(tc,{fontSize:"lg",children:"Customise Your Avatar"}),w.jsx(Ko,{color:"white",_hover:{bg:"transparent",color:"whiteAlpha.800"},_focus:{boxShadow:"none"},size:"lg",position:"absolute",right:2,top:2}),w.jsx(Ro,{pb:4,children:w.jsxs(Qr,{spacing:4,align:"stretch",children:[w.jsx(Ze,{fontSize:"sm",children:"Choose from our collection or create your own unique avatar"}),w.jsxs(Kne,{columns:5,spacing:2,children:[w.jsx(lt,{position:"relative",cursor:"pointer",borderWidth:"2px",borderStyle:"dashed",borderColor:I,borderRadius:"lg",overflow:"hidden",onClick:E,_hover:{bg:O},transition:"all 0.2s",display:"flex",alignItems:"center",justifyContent:"center",aspectRatio:"1",children:w.jsxs(Qr,{spacing:1,children:[w.jsx(En,{as:W8e,boxSize:4}),w.jsx(Ze,{fontSize:"xs",children:"Create Custom Avatar"})]})}),L.map(U=>w.jsxs(lt,{position:"relative",cursor:"pointer",borderWidth:"2px",borderColor:(l==null?void 0:l.id)===U.id?"blue.400":I,borderRadius:"lg",overflow:"hidden",onClick:()=>C(U),_hover:{bg:O},transition:"all 0.2s",aspectRatio:"1",children:[w.jsx(Jh,{src:U.url.replace(".glb",".png?scene=fullbody-portrait-closeupfront&w=640&q=75"),alt:U.name,width:"100%",height:"100%",objectFit:"cover"}),w.jsx(lt,{position:"absolute",bottom:"0",left:"0",right:"0",p:1,bg:"rgba(0, 0, 0, 0.7)",children:w.jsx(Ze,{fontSize:"xs",children:U.name})})]},U.id))]})]})})]})]})}),i&&w.jsx(lae,{open:i,onClose:b})]})}function X8e(){const{fullscreenRef:n}=Gd(),[e,i]=N.useState(!1),[o,l]=N.useState(!1),[d,p]=N.useState(!1),[_,E]=N.useState(!1),{user:b}=N.useContext(Ao),[C,I]=N.useState(null),[O,L]=N.useState(!0),U=($,ie)=>!$||!ie?"?":`${$.charAt(0)}${ie.charAt(0)}`.toUpperCase(),B=async()=>{if(b!=null&&b.uid){L(!0);try{const $=await Hu(b.uid);I({rpmURL:$.rpmURL?$.rpmURL.replace(".glb",".png?scene=fullbody-portrait-closeupfront&w=640&q=75"):null,firstName:$.firstName,lastName:$.lastName})}catch($){console.error("Error fetching profile data:",$)}finally{L(!1)}}};N.useEffect(()=>{B()},[b==null?void 0:b.uid]),N.useEffect(()=>{const $=()=>{i(!0)};return window.addEventListener("PlayerInstantiated",$),()=>{window.removeEventListener("PlayerInstantiated",$)}},[]);const W=()=>l(!o),J=()=>{l(!1),B()};return e?w.jsxs(w.Fragment,{children:[w.jsx(Vp,{label:"Edit Avatar",hasArrow:!0,placement:"top",closeOnClick:!0,isOpen:_,portalProps:{containerRef:n},children:w.jsxs(lt,{position:"relative",onMouseEnter:()=>{p(!0),E(!0)},onMouseLeave:()=>{p(!1),E(!1)},cursor:"pointer",onClick:W,children:[w.jsx($l,{src:O||C==null?void 0:C.rpmURL,size:"md",borderRadius:"full",bg:"white",name:O?U(C==null?void 0:C.firstName,C==null?void 0:C.lastName):" ",borderWidth:"1px",borderColor:"whiteAlpha.300"}),d&&w.jsx(lt,{position:"absolute",top:"0",left:"0",right:"0",bottom:"0",display:"flex",alignItems:"center",justifyContent:"center",bg:"rgba(0, 0, 0, 0.4)",borderRadius:"full",children:w.jsx(Ze,{fontSize:"xs",fontWeight:"bold",color:"white",children:"Edit"})})]})}),w.jsx(Y8e,{isOpen:o,onClose:J})]}):null}function J8e(n){return Cr({attr:{viewBox:"0 0 1024 1024"},child:[{tag:"path",attr:{d:"M391 240.9c-.8-6.6-8.9-9.4-13.6-4.7l-43.7 43.7L200 146.3a8.03 8.03 0 0 0-11.3 0l-42.4 42.3a8.03 8.03 0 0 0 0 11.3L280 333.6l-43.9 43.9a8.01 8.01 0 0 0 4.7 13.6L401 410c5.1.6 9.5-3.7 8.9-8.9L391 240.9zm10.1 373.2L240.8 633c-6.6.8-9.4 8.9-4.7 13.6l43.9 43.9L146.3 824a8.03 8.03 0 0 0 0 11.3l42.4 42.3c3.1 3.1 8.2 3.1 11.3 0L333.7 744l43.7 43.7A8.01 8.01 0 0 0 391 783l18.9-160.1c.6-5.1-3.7-9.4-8.8-8.8zm221.8-204.2L783.2 391c6.6-.8 9.4-8.9 4.7-13.6L744 333.6 877.7 200c3.1-3.1 3.1-8.2 0-11.3l-42.4-42.3a8.03 8.03 0 0 0-11.3 0L690.3 279.9l-43.7-43.7a8.01 8.01 0 0 0-13.6 4.7L614.1 401c-.6 5.2 3.7 9.5 8.8 8.9zM744 690.4l43.9-43.9a8.01 8.01 0 0 0-4.7-13.6L623 614c-5.1-.6-9.5 3.7-8.9 8.9L633 783.1c.8 6.6 8.9 9.4 13.6 4.7l43.7-43.7L824 877.7c3.1 3.1 8.2 3.1 11.3 0l42.4-42.3c3.1-3.1 3.1-8.2 0-11.3L744 690.4z"}}]})(n)}function Q8e(n){return Cr({attr:{viewBox:"0 0 1024 1024"},child:[{tag:"path",attr:{d:"M290 236.4l43.9-43.9a8.01 8.01 0 0 0-4.7-13.6L169 160c-5.1-.6-9.5 3.7-8.9 8.9L179 329.1c.8 6.6 8.9 9.4 13.6 4.7l43.7-43.7L370 423.7c3.1 3.1 8.2 3.1 11.3 0l42.4-42.3c3.1-3.1 3.1-8.2 0-11.3L290 236.4zm352.7 187.3c3.1 3.1 8.2 3.1 11.3 0l133.7-133.6 43.7 43.7a8.01 8.01 0 0 0 13.6-4.7L863.9 169c.6-5.1-3.7-9.5-8.9-8.9L694.8 179c-6.6.8-9.4 8.9-4.7 13.6l43.9 43.9L600.3 370a8.03 8.03 0 0 0 0 11.3l42.4 42.4zM845 694.9c-.8-6.6-8.9-9.4-13.6-4.7l-43.7 43.7L654 600.3a8.03 8.03 0 0 0-11.3 0l-42.4 42.3a8.03 8.03 0 0 0 0 11.3L734 787.6l-43.9 43.9a8.01 8.01 0 0 0 4.7 13.6L855 864c5.1.6 9.5-3.7 8.9-8.9L845 694.9zm-463.7-94.6a8.03 8.03 0 0 0-11.3 0L236.3 733.9l-43.7-43.7a8.01 8.01 0 0 0-13.6 4.7L160.1 855c-.6 5.1 3.7 9.5 8.9 8.9L329.2 845c6.6-.8 9.4-8.9 4.7-13.6L290 787.6 423.7 654c3.1-3.1 3.1-8.2 0-11.3l-42.4-42.4z"}}]})(n)}function Z8e(){const{isFullscreen:n,toggleFullscreen:e,fullscreenRef:i,isMobile:o}=Gd(),l=Ic();N.useEffect(()=>{const p=_=>{console.error("Fullscreen error:",_),l({title:"Fullscreen Error",description:"Could not enter fullscreen mode. Try tapping the button again or use the browser's fullscreen option.",status:"error",duration:5e3,isClosable:!0,position:"top"})};return document.addEventListener("fullscreenerror",p),document.addEventListener("webkitfullscreenerror",p),document.addEventListener("mozfullscreenerror",p),document.addEventListener("MSFullscreenError",p),()=>{document.removeEventListener("fullscreenerror",p),document.removeEventListener("webkitfullscreenerror",p),document.removeEventListener("mozfullscreenerror",p),document.removeEventListener("MSFullscreenError",p)}},[l]);const d=()=>{i.current?(o&&/iPhone|iPad|iPod/i.test(navigator.userAgent)&&!n&&l({title:"Mobile Fullscreen",description:"Tap the button again if fullscreen doesn't activate. For iOS, you may need to use the browser's share button and 'Add to Home Screen' for the best experience.",status:"info",duration:5e3,isClosable:!0,position:"top"}),e()):(console.error("Fullscreen target not set"),l({title:"Fullscreen Error",description:"Could not find fullscreen target element.",status:"error",duration:3e3,isClosable:!0,position:"top"}))};return w.jsx(Vp,{label:n?"Exit Fullscreen":"Enter Fullscreen",hasArrow:!0,placement:"bottom",closeOnClick:!0,portalProps:{containerRef:i},children:w.jsx(Ho,{"aria-label":n?"Exit Fullscreen":"Enter Fullscreen",icon:n?w.jsx(J8e,{}):w.jsx(Q8e,{}),onClick:d,variant:"iconButton",size:o?"lg":"md"})})}const zQ={iframeContainer:{position:"relative",paddingBottom:"56.25%",height:0,overflow:"hidden",width:"100%"},iframe:{position:"absolute",top:0,left:0,width:"100%",height:"100%",border:"none"}};function eze(){const{isOpen:n,onOpen:e,onClose:i}=pf(),{fullscreenRef:o}=Gd(),[l,d]=E8e(!1);N.useEffect(()=>{q.log("VideoPlayer: Current video URL:",l),l&&(q.log("VideoPlayer: Opening modal for video URL:",l),e())},[l,e]);const p=()=>{q.log("VideoPlayer: Closing modal"),d(),i()};return w.jsx(Yl,{containerRef:o,children:w.jsxs(oo,{isOpen:n,onClose:p,size:"lg",isCentered:!0,portalProps:{containerRef:o},children:[w.jsx(co,{bg:"rgba(0, 0, 0, 0.8)"}),w.jsxs(ao,{bg:"gray.900",color:"white",borderRadius:"lg",overflow:"hidden",maxWidth:"80vw",maxHeight:"80vh",display:"flex",justifyContent:"center",alignItems:"center",position:"relative",zIndex:"modal",children:[w.jsx(Ko,{size:"lg",bg:"gray.700",color:"white",borderRadius:"full",zIndex:"modal",_hover:{bg:"gray.600"},_focus:{boxShadow:"none"},position:"absolute",top:"10px",right:"10px"}),w.jsx(Ro,{p:0,width:"100%",children:l&&w.jsx(lt,{style:zQ.iframeContainer,children:w.jsx("iframe",{src:l,style:zQ.iframe,allow:"autoplay; fullscreen",allowFullScreen:!0,title:"Video Player"})})})]})]})})}function tze({isOpen:n,onClose:e,playerName:i,playerId:o,uid:l}){const[d,p]=N.useState(null),[_,E]=N.useState(!0),[b,C]=N.useState(null);return N.useEffect(()=>{n&&(async()=>{if(E(!0),C(null),!l){q.warn("NameplateModal: No UID provided for player:",i),C("No user ID available for this player"),E(!1);return}try{q.log("NameplateModal: Fetching profile for UID:",l);const O=await Hu(l);O?p({firstName:O.firstName,lastName:O.lastName,linkedinUrl:O.linkedinUrl,websiteUrl:O.websiteUrl,rpmURL:O.rpmURL?O.rpmURL.replace(".glb",".png?scene=fullbody-portrait-closeupfront&w=640&q=75"):null}):C("Could not find profile data for this player")}catch(O){q.error("Error fetching profile data:",O),C("Error loading profile data")}finally{E(!1)}})()},[l,n,i]),w.jsxs(oo,{isOpen:n,onClose:e,isCentered:!0,size:"md",children:[w.jsx(co,{backdropFilter:"blur(10px)"}),w.jsxs(ao,{bg:"gray.900",color:"white",borderRadius:"xl",children:[w.jsx(tc,{children:"Player Info"}),w.jsx(Ko,{}),w.jsx(Ro,{pb:6,children:_?w.jsx(dne,{py:8,children:w.jsx(zd,{size:"xl",color:"blue.400"})}):b?w.jsxs(Ip,{status:"warning",variant:"solid",borderRadius:"md",children:[w.jsx(Ap,{}),b]}):w.jsxs(Qr,{spacing:4,align:"center",children:[w.jsx($l,{size:"2xl",src:d==null?void 0:d.rpmURL,bg:"whiteAlpha.300",name:i,borderWidth:"2px",borderColor:"whiteAlpha.300"}),w.jsxs(Qr,{spacing:1,children:[w.jsx(Ze,{fontSize:"2xl",fontWeight:"bold",children:i}),(d==null?void 0:d.firstName)&&w.jsxs(Ze,{fontSize:"md",color:"gray.400",children:[d.firstName," ",d.lastName]}),w.jsxs(Ze,{fontSize:"xs",color:"gray.500",mt:1,children:["ID: ",o]})]}),((d==null?void 0:d.linkedinUrl)||(d==null?void 0:d.websiteUrl))&&w.jsxs(w.Fragment,{children:[w.jsx(of,{borderColor:"whiteAlpha.300"}),w.jsxs(pi,{spacing:4,pt:2,children:[(d==null?void 0:d.linkedinUrl)&&w.jsx(Fl,{href:d.linkedinUrl,isExternal:!0,children:w.jsx(Ho,{icon:w.jsx(aae,{}),variant:"ghost",colorScheme:"linkedin",size:"lg","aria-label":"LinkedIn profile",_hover:{bg:"whiteAlpha.200"}})}),(d==null?void 0:d.websiteUrl)&&w.jsx(Fl,{href:d.websiteUrl,isExternal:!0,children:w.jsx(Ho,{icon:w.jsx(cae,{}),variant:"ghost",colorScheme:"blue",size:"lg","aria-label":"Personal website",_hover:{bg:"whiteAlpha.200"}})})]})]})]})})]})]})}const nze=({isVisible:n,onToggleVisibility:e,spaceID:i})=>{const[o]=Oxe("(max-width: 768px)"),[l,d]=N.useState(!1);N.useEffect(()=>{(()=>{const _e=navigator.userAgent||navigator.vendor||window.opera,ke=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(_e);d(ke),ke&&q.log("UnityPlayerList: Mobile browser detected, component will not render")})()},[]);const p=o||l,_=rae(),[E,b]=N.useState(!1),[C,I]=N.useState([]),[O,L]=N.useState(!1),[U,B]=N.useState({}),[W,J]=N.useState({}),[$,ie]=N.useState(null),[ce,ne]=N.useState(!1),de=Ic(),Q=window.currentUser||{},X=(()=>{if(i)return i;if(window.spaceID)return window.spaceID;const _e=(window.location.pathname||"").split("/"),Ee=_e[_e.length-1];if(Ee&&Ee.length>5)return Ee;const ke=document.body.getAttribute("data-space-id");if(ke)return ke;const Te=localStorage.getItem("currentSpaceId");return Te||"fallback-space-id"})();N.useEffect(()=>{(async()=>{try{const Ee=await Bp(X);Ee&&Ee.voiceDisabled?(console.log("UnityPlayerList: Voice is disabled for this space"),ne(!0)):ne(!1)}catch(Ee){console.error("UnityPlayerList: Error checking if voice is disabled:",Ee)}})();const _e=Ee=>{Ee.detail&&typeof Ee.detail.voiceDisabled=="boolean"&&(console.log("UnityPlayerList: Voice setting changed:",Ee.detail.voiceDisabled),ne(Ee.detail.voiceDisabled))};return window.addEventListener("SpaceVoiceSettingChanged",_e),()=>{window.removeEventListener("SpaceVoiceSettingChanged",_e)}},[X]),N.useEffect(()=>{const ve={};_.forEach(_e=>{if(_e.uid){if(_e.isLocalPlayer&&window.agoraClient&&window.agoraClient.client)ve[_e.uid]=window.agoraClient.client.uid;else if(window.agoraClient&&window.agoraClient.client&&window.agoraClient.client.remoteUsers){const Ee=window.agoraClient.client.remoteUsers,ke=Ee.find(Te=>String(Te.uid)===String(_e.uid));if(ke)ve[_e.uid]=ke.uid;else{const Te=Ee.find(be=>typeof be.uid=="string"&&be.uid.includes(_e.uid));if(Te)ve[_e.uid]=Te.uid;else{const be=Ee.find(Pe=>typeof _e.uid=="string"&&_e.uid.includes(String(Pe.uid)));if(be)ve[_e.uid]=be.uid;else{const Pe=Ee.filter(Le=>!(typeof Le.uid=="string"&&Le.uid.startsWith("screen-")));Pe.length===1&&!_e.isLocalPlayer&&(ve[_e.uid]=Pe[0].uid)}}}}}}),J(ve)},[_]);const re=()=>{if(window.agoraClient&&typeof window.agoraClient.isVoiceEnabled=="boolean"){const ve=window.agoraClient.isVoiceEnabled;ve!==O&&L(ve)}if(window.agoraClient&&window.agoraClient.client&&window.agoraClient.client.remoteUsers){const ve=window.agoraClient.client.remoteUsers,_e={};ve.forEach(Ee=>{typeof Ee.uid=="string"&&Ee.uid.startsWith("screen-")||(_e[Ee.uid]=!!Ee.audioTrack&&!Ee.audioTrack.muted)}),JSON.stringify(_e)!==JSON.stringify(U)&&B(_e)}};N.useEffect(()=>{const ve=setInterval(re,500),_e=Ee=>{Ee.detail&&typeof Ee.detail.enabled=="boolean"&&L(Ee.detail.enabled)};return window.addEventListener("VoiceToggled",_e),re(),()=>{clearInterval(ve),window.removeEventListener("VoiceToggled",_e)}},[]),N.useEffect(()=>{const ve=()=>{q.log("UnityPlayerList: Player instantiated, showing list"),b(!0)};return window.addEventListener("PlayerInstantiated",ve),window.isPlayerInstantiated&&(q.log("UnityPlayerList: Player was already instantiated"),b(!0)),()=>{window.removeEventListener("PlayerInstantiated",ve)}},[]),N.useEffect(()=>{(async()=>{const _e=await Promise.all(_.map(async Ee=>{if(Ee.uid)try{const ke=await Hu(Ee.uid);let Te=null;if(ke.groups){const be=`space_${X}_owners`,Pe=`space_${X}_hosts`;ke.groups.includes(be)?Te="owner":ke.groups.includes(Pe)&&(Te="host")}return ue({uid:Ee.uid})&&ie(Te),{...Ee,firstName:ke.firstName,lastName:ke.lastName,linkedInProfile:ke.linkedInProfile,websiteUrl:ke.websiteUrl,rpmURL:ke.rpmURL?ke.rpmURL.replace(".glb",".png?scene=fullbody-portrait-closeupfront&w=640&q=75"):null,role:Te}}catch(ke){return q.error(`Error fetching data for player ${Ee.playerName}:`,ke),Ee}return Ee}));I(_e)})()},[_,X]);const pe=[...C].sort((ve,_e)=>ve.isLocalPlayer?-1:_e.isLocalPlayer?1:0),he=()=>{q.log("UnityPlayerList: Toggling visibility"),e&&e()},ue=ve=>!!(ve.isLocalPlayer||Q&&Q.uid&&ve.uid===Q.uid),xe=ve=>{try{if(ue(ve))return window.agoraClient&&typeof window.agoraClient.isVoiceEnabled=="boolean"?window.agoraClient.isVoiceEnabled:O;if(ve.uid){if(U[ve.uid])return!0;const _e=W[ve.uid];if(_e&&U[_e])return!0;const Ee=parseInt(ve.uid);if(!isNaN(Ee)&&U[Ee])return!0}return!1}catch(_e){return console.error("Error in hasActiveMic:",_e),!1}},We=({player:ve})=>{const _e=ve.role;return _e==="owner"?w.jsxs(pi,{spacing:1,bg:"green.900",p:2,borderRadius:"md",px:3,boxShadow:"0 0 10px rgba(72, 187, 120, 0.5)",border:"1px solid",borderColor:"green.400",children:[w.jsx(En,{as:PF,color:"green.400",boxSize:5}),w.jsx(Pp,{colorScheme:"green",variant:"solid",fontSize:"md",px:2,children:"Owner"})]}):_e==="host"?w.jsxs(pi,{spacing:1,bg:"purple.900",p:2,borderRadius:"md",px:3,boxShadow:"0 0 10px rgba(159, 122, 234, 0.5)",border:"1px solid",borderColor:"purple.400",children:[w.jsx(En,{as:NF,color:"purple.400",boxSize:5}),w.jsx(Pp,{colorScheme:"purple",variant:"solid",fontSize:"md",px:2,children:"Host"})]}):null},$e=(ve,_e)=>{switch(console.log(`Action "${ve}" performed on player: ${_e.playerName}`),ve){case"mute":de({title:"Player Muted",description:`${_e.playerName} has been muted.`,status:"info",duration:3e3,isClosable:!0});break;case"kick":de({title:"Player Kicked",description:`${_e.playerName} has been kicked from the space.`,status:"warning",duration:3e3,isClosable:!0});break;case"promote":de({title:"Player Promoted",description:`${_e.playerName} has been promoted to host.`,status:"success",duration:3e3,isClosable:!0});break}};return w.jsxs(lt,{position:"absolute",top:"100px",right:"20px",zIndex:"1",bg:"rgba(0,0,0,0.4)",p:4,borderRadius:"md",color:"white",minWidth:"200px",maxHeight:"300px",visibility:E&&n&&!p?"visible":"hidden",role:"group",children:[w.jsx(lt,{position:"absolute",top:2,right:2,opacity:0,_groupHover:{opacity:1},transition:"opacity 0.2s",children:w.jsx(Ho,{icon:w.jsx(_We,{boxSize:3}),size:"xs","aria-label":"Close list",variant:"unstyled",color:"white",onClick:he,_hover:{opacity:.8}})}),w.jsxs(Ze,{fontWeight:"bold",mb:2,fontSize:"sm",children:["People Online: ",_.length]}),w.jsx(lt,{maxHeight:"200px",overflowY:"auto",css:{"&::-webkit-scrollbar":{width:"4px"},"&::-webkit-scrollbar-track":{background:"rgba(0,0,0,0.1)"},"&::-webkit-scrollbar-thumb":{background:"rgba(255,255,255,0.3)",borderRadius:"2px"}},children:w.jsx(Qr,{align:"stretch",spacing:1,width:"100%",children:pe.map((ve,_e)=>{const Ee=ue(ve),ke=!ce&&xe(ve);return w.jsx(lt,{children:w.jsxs(Tre,{placement:"left",trigger:"hover",children:[w.jsx(Are,{children:w.jsxs(pi,{width:"100%",spacing:2,p:1,borderRadius:"md",_hover:{bg:"whiteAlpha.200"},transition:"background 0.2s",children:[w.jsx($l,{size:"xs",src:ve.rpmURL,bg:"whiteAlpha.400",name:" ",borderWidth:"1px",borderColor:"whiteAlpha.300"}),w.jsx(Ze,{fontSize:"xs",children:ve.playerName}),ve.role==="owner"&&w.jsx(En,{as:PF,color:"green.400",boxSize:2.5}),ve.role==="host"&&w.jsx(En,{as:NF,color:"purple.400",boxSize:2.5}),w.jsx(Zk,{}),$==="owner"&&w.jsxs(mR,{closeOnSelect:!0,placement:"bottom-end",children:[w.jsx(gR,{as:Ho,"aria-label":"Options",icon:w.jsx(U8e,{}),variant:"ghost",size:"xs",color:"whiteAlpha.700",_hover:{color:"white",bg:"whiteAlpha.300"},onClick:Te=>Te.stopPropagation()}),w.jsxs(_R,{bg:"rgba(0,0,0,0.8)",borderColor:"whiteAlpha.300",minW:"120px",zIndex:10001,children:[w.jsx(Md,{icon:w.jsx(K8e,{}),onClick:()=>$e("mute",ve),_hover:{bg:"whiteAlpha.200"},fontSize:"sm",isDisabled:ce,children:"Mute Player"}),w.jsx(Md,{icon:w.jsx(G8e,{}),onClick:()=>$e("promote",ve),_hover:{bg:"whiteAlpha.200"},fontSize:"sm",children:"Promote to Host"}),w.jsx(cre,{borderColor:"whiteAlpha.300"}),w.jsx(Md,{icon:w.jsx(L8e,{}),onClick:()=>$e("kick",ve),_hover:{bg:"red.800"},color:"red.300",fontSize:"sm",children:"Kick from Space"})]})]}),!ce&&(ke?w.jsx(lt,{color:"green.400",children:w.jsx(kF,{})}):w.jsx(lt,{color:"red.400",children:w.jsx(OF,{})})),Ee&&w.jsx(Ze,{fontSize:"xs",color:"gray.300",ml:1,children:"(you)"})]})}),w.jsx(Ire,{bg:"rgba(0,0,0,0.8)",border:"none",boxShadow:"dark-lg",color:"white",p:4,width:"auto",minWidth:"250px",ml:"-20px",position:"absolute",left:"-250px",top:"-100px",transform:"none !important",zIndex:1e4,children:w.jsx(Cre,{children:w.jsxs(Qr,{align:"center",spacing:3,children:[w.jsx($l,{size:"xl",src:ve.rpmURL,bg:"whiteAlpha.400",name:" ",borderWidth:"2px",borderColor:"whiteAlpha.300"}),w.jsx(Ze,{fontSize:"xl",fontWeight:"bold",children:ve.playerName}),w.jsx(We,{player:ve}),ve.firstName&&w.jsxs(Ze,{fontSize:"sm",color:"gray.300",children:[ve.firstName," ",ve.lastName]}),w.jsxs(pi,{spacing:4,pt:2,children:[ve.linkedInProfile&&w.jsx(Fl,{href:ve.linkedInProfile,isExternal:!0,children:w.jsx(Ho,{icon:w.jsx(aae,{}),variant:"ghost",colorScheme:"whiteAlpha",size:"md","aria-label":"LinkedIn profile",_hover:{bg:"whiteAlpha.200"}})}),ve.websiteUrl&&w.jsx(Fl,{href:ve.websiteUrl,isExternal:!0,children:w.jsx(Ho,{icon:w.jsx(cae,{}),variant:"ghost",colorScheme:"whiteAlpha",size:"md","aria-label":"Personal website",_hover:{bg:"whiteAlpha.200"}})}),!ce&&w.jsx(Ho,{icon:ke?w.jsx(kF,{}):w.jsx(OF,{}),variant:"ghost",colorScheme:ke?"green":"red",size:"md","aria-label":"Microphone status",isDisabled:!0}),ce&&w.jsx(Ho,{icon:w.jsx($8e,{}),variant:"ghost",colorScheme:"red",size:"md","aria-label":"Voice chat disabled",isDisabled:!0,title:"Voice chat is disabled for this space"})]})]})})})]})},_e)})})})]})};var Mk={exports:{}},rze=Mk.exports,GQ;function ize(){return GQ||(GQ=1,function(n,e){(function(i,o){n.exports=o()})(rze,function(){function i(t,r){return r.forEach(function(s){s&&typeof s!="string"&&!Array.isArray(s)&&Object.keys(s).forEach(function(a){if(a!=="default"&&!(a in t)){var c=Object.getOwnPropertyDescriptor(s,a);Object.defineProperty(t,a,c.get?c:{enumerable:!0,get:function(){return s[a]}})}})}),Object.freeze(t)}var o=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof wy<"u"?wy:typeof self<"u"?self:{};function l(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var d=function(t){try{return!!t()}catch{return!0}},p=!d(function(){var t=(function(){}).bind();return typeof t!="function"||t.hasOwnProperty("prototype")}),_=p,E=Function.prototype,b=E.call,C=_&&E.bind.bind(b,b),I=_?C:function(t){return function(){return b.apply(t,arguments)}},O=I({}.isPrototypeOf),L=function(t){return t&&t.Math==Math&&t},U=L(typeof globalThis=="object"&&globalThis)||L(typeof window=="object"&&window)||L(typeof self=="object"&&self)||L(typeof o=="object"&&o)||function(){return this}()||o||Function("return this")(),B=p,W=Function.prototype,J=W.apply,$=W.call,ie=typeof Reflect=="object"&&Reflect.apply||(B?$.bind(J):function(){return $.apply(J,arguments)}),ce=I,ne=ce({}.toString),de=ce("".slice),Q=function(t){return de(ne(t),8,-1)},Z=Q,X=I,re=function(t){if(Z(t)==="Function")return X(t)},pe=typeof document=="object"&&document.all,he={all:pe,IS_HTMLDDA:pe===void 0&&pe!==void 0},ue=he.all,xe=he.IS_HTMLDDA?function(t){return typeof t=="function"||t===ue}:function(t){return typeof t=="function"},We={},$e=!d(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!=7}),ve=p,_e=Function.prototype.call,Ee=ve?_e.bind(_e):function(){return _e.apply(_e,arguments)},ke={},Te={}.propertyIsEnumerable,be=Object.getOwnPropertyDescriptor,Pe=be&&!Te.call({1:2},1);ke.f=Pe?function(t){var r=be(this,t);return!!r&&r.enumerable}:Te;var Le,ze,Je=function(t,r){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:r}},et=d,ut=Q,rt=Object,It=I("".split),pn=et(function(){return!rt("z").propertyIsEnumerable(0)})?function(t){return ut(t)=="String"?It(t,""):rt(t)}:rt,Ft=function(t){return t==null},an=Ft,en=TypeError,Xt=function(t){if(an(t))throw en("Can't call method on "+t);return t},Vn=pn,Kt=Xt,Re=function(t){return Vn(Kt(t))},Ve=xe,Ge=he.all,ft=he.IS_HTMLDDA?function(t){return typeof t=="object"?t!==null:Ve(t)||t===Ge}:function(t){return typeof t=="object"?t!==null:Ve(t)},gt={},St=gt,Wt=U,mn=xe,vn=function(t){return mn(t)?t:void 0},tn=function(t,r){return arguments.length<2?vn(St[t])||vn(Wt[t]):St[t]&&St[t][r]||Wt[t]&&Wt[t][r]},vt=typeof navigator<"u"&&String(navigator.userAgent)||"",nr=U,Dt=vt,Ut=nr.process,gn=nr.Deno,Li=Ut&&Ut.versions||gn&&gn.version,Es=Li&&Li.v8;Es&&(ze=(Le=Es.split("."))[0]>0&&Le[0]<4?1:+(Le[0]+Le[1])),!ze&&Dt&&(!(Le=Dt.match(/Edge\/(\d+)/))||Le[1]>=74)&&(Le=Dt.match(/Chrome\/(\d+)/))&&(ze=+Le[1]);var ci=ze,qo=ci,ic=d,Xs=U.String,Js=!!Object.getOwnPropertySymbols&&!ic(function(){var t=Symbol();return!Xs(t)||!(Object(t)instanceof Symbol)||!Symbol.sham&&qo&&qo<41}),Ac=Js&&!Symbol.sham&&typeof Symbol.iterator=="symbol",vs=tn,Ia=xe,Po=O,Aa=Object,sc=Ac?function(t){return typeof t=="symbol"}:function(t){var r=vs("Symbol");return Ia(r)&&Po(r.prototype,Aa(t))},ml=String,Pa=function(t){try{return ml(t)}catch{return"Object"}},oc=xe,lo=Pa,Mi=TypeError,_t=function(t){if(oc(t))return t;throw Mi(lo(t)+" is not a function")},hn=_t,yr=Ft,_i=function(t,r){var s=t[r];return yr(s)?void 0:hn(s)},Oo=Ee,uo=xe,Xl=ft,Tf=TypeError,gl={exports:{}},Jl=U,Ri=Object.defineProperty,ho=function(t,r){try{Ri(Jl,t,{value:r,configurable:!0,writable:!0})}catch{Jl[t]=r}return r},zi="__core-js_shared__",$d=U[zi]||ho(zi,{}),Kd=$d;(gl.exports=function(t,r){return Kd[t]||(Kd[t]=r!==void 0?r:{})})("versions",[]).push({version:"3.31.1",mode:"pure",copyright:" 2014-2023 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.31.1/LICENSE",source:"https://github.com/zloirock/core-js"});var ac=gl.exports,qd=Xt,$u=Object,Yo=function(t){return $u(qd(t))},Yd=Yo,qr=I({}.hasOwnProperty),Ii=Object.hasOwn||function(t,r){return qr(Yd(t),r)},Pc=I,_l=0,Oa=Math.random(),wf=Pc(1 .toString),Xd=function(t){return"Symbol("+(t===void 0?"":t)+")_"+wf(++_l+Oa,36)},Ql=ac,ko=Ii,im=Xd,fo=Js,Cf=Ac,yl=U.Symbol,Jd=Ql("wks"),Qd=Cf?yl.for||yl:yl&&yl.withoutSetter||im,Er=function(t){return ko(Jd,t)||(Jd[t]=fo&&ko(yl,t)?yl[t]:Qd("Symbol."+t)),Jd[t]},Zl=Ee,eu=ft,Ku=sc,cc=_i,Xo=function(t,r){var s,a;if(uo(s=t.toString)&&!Xl(a=Oo(s,t))||uo(s=t.valueOf)&&!Xl(a=Oo(s,t)))return a;throw Tf("Can't convert object to primitive value")},qu=TypeError,El=Er("toPrimitive"),tu=function(t,r){if(!eu(t)||Ku(t))return t;var s,a=cc(t,El);if(a){if(s=Zl(a,t,r),!eu(s)||Ku(s))return s;throw qu("Can't convert object to primitive value")}return Xo(t)},Zr=sc,lc=function(t){var r=tu(t,"string");return Zr(r)?r:r+""},cr=ft,Oc=U.document,sm=cr(Oc)&&cr(Oc.createElement),nu=function(t){return sm?Oc.createElement(t):{}},Zd=nu,Rf=!$e&&!d(function(){return Object.defineProperty(Zd("div"),"a",{get:function(){return 7}}).a!=7}),om=$e,If=Ee,Jo=ke,hs=Je,Qo=Re,Zo=lc,ru=Ii,ea=Rf,ta=Object.getOwnPropertyDescriptor;We.f=om?ta:function(t,r){if(t=Qo(t),r=Zo(r),ea)try{return ta(t,r)}catch{}if(ru(t,r))return hs(!If(Jo.f,t,r),t[r])};var am=d,kc=xe,Ss=/#|\.prototype\./,Yu=function(t,r){var s=vl[Af(t)];return s==cm||s!=iu&&(kc(r)?am(r):!!r)},Af=Yu.normalize=function(t){return String(t).replace(Ss,".").toLowerCase()},vl=Yu.data={},iu=Yu.NATIVE="N",cm=Yu.POLYFILL="P",ka=Yu,Na=_t,Sl=p,Ce=re(re.bind),De=function(t,r){return Na(t),r===void 0?t:Sl?Ce(t,r):function(){return t.apply(r,arguments)}},nt={},Qt=$e&&d(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!=42}),Qn=ft,Rr=String,Yr=TypeError,fn=function(t){if(Qn(t))return t;throw Yr(Rr(t)+" is not an object")},Wr=$e,Ai=Rf,Vs=Qt,na=fn,ra=lc,Xu=TypeError,os=Object.defineProperty,bl=Object.getOwnPropertyDescriptor,eh="enumerable",Nc="configurable",qg="writable";nt.f=Wr?Vs?function(t,r,s){if(na(t),r=ra(r),na(s),typeof t=="function"&&r==="prototype"&&"value"in s&&qg in s&&!s[qg]){var a=bl(t,r);a&&a[qg]&&(t[r]=s.value,s={configurable:Nc in s?s[Nc]:a[Nc],enumerable:eh in s?s[eh]:a[eh],writable:!1})}return os(t,r,s)}:os:function(t,r,s){if(na(t),r=ra(r),na(s),Ai)try{return os(t,r,s)}catch{}if("get"in s||"set"in s)throw Xu("Accessors not supported");return"value"in s&&(t[r]=s.value),t};var lm=nt,Ju=Je,ia=$e?function(t,r,s){return lm.f(t,r,Ju(1,s))}:function(t,r,s){return t[r]=s,t},su=U,um=ie,Yg=re,lE=xe,dm=We.f,hm=ka,Qu=gt,Zu=De,ed=ia,Xg=Ii,uE=function(t){var r=function(s,a,c){if(this instanceof r){switch(arguments.length){case 0:return new t;case 1:return new t(s);case 2:return new t(s,a)}return new t(s,a,c)}return um(t,this,arguments)};return r.prototype=t.prototype,r},zn=function(t,r){var s,a,c,u,h,m,y,v,S,R=t.target,P=t.global,D=t.stat,G=t.proto,F=P?su:D?su[R]:(su[R]||{}).prototype,j=P?Qu:Qu[R]||ed(Qu,R,{})[R],Y=j.prototype;for(u in r)a=!(s=hm(P?u:R+(D?".":"#")+u,t.forced))&&F&&Xg(F,u),m=j[u],a&&(y=t.dontCallGetSet?(S=dm(F,u))&&S.value:F[u]),h=a&&y?y:r[u],a&&typeof m==typeof h||(v=t.bind&&a?Zu(h,su):t.wrap&&a?uE(h):G&&lE(h)?Yg(h):h,(t.sham||h&&h.sham||m&&m.sham)&&ed(v,"sham",!0),ed(j,u,v),G&&(Xg(Qu,c=R+"Prototype")||ed(Qu,c,{}),ed(Qu[c],u,h),t.real&&Y&&(s||!Y[u])&&ed(Y,u,h)))},fm=Math.ceil,sa=Math.floor,dE=Math.trunc||function(t){var r=+t;return(r>0?sa:fm)(r)},hE=dE,Dc=function(t){var r=+t;return r!=r||r===0?0:hE(r)},A=Dc,z=Math.max,se=Math.min,ge=function(t,r){var s=A(t);return s<0?z(s+r,0):se(s,r)},qe=Dc,at=Math.min,Vt=function(t){return t>0?at(qe(t),9007199254740991):0},ei=Vt,yi=function(t){return ei(t.length)},Ir=Re,Qs=ge,bs=yi,uc=function(t){return function(r,s,a){var c,u=Ir(r),h=bs(u),m=Qs(a,h);if(t&&s!=s){for(;h>m;)if((c=u[m++])!=c)return!0}else for(;h>m;m++)if((t||m in u)&&u[m]===s)return t||m||0;return!t&&-1}},oa={includes:uc(!0),indexOf:uc(!1)},Pf=oa.includes;zn({target:"Array",proto:!0,forced:d(function(){return!Array(1).includes()})},{includes:function(t){return Pf(this,t,arguments.length>1?arguments[1]:void 0)}});var pm=gt,dc=function(t){return pm[t+"Prototype"]},NR=dc("Array").includes,DR=ft,mm=Q,HN=Er("match"),xR=function(t){var r;return DR(t)&&((r=t[HN])!==void 0?!!r:mm(t)=="RegExp")},$N=xR,LR=TypeError,nb={};nb[Er("toStringTag")]="z";var Of=String(nb)==="[object z]",Jg=Of,KN=xe,kf=Q,qN=Er("toStringTag"),MR=Object,rb=kf(function(){return arguments}())=="Arguments",xc=Jg?kf:function(t){var r,s,a;return t===void 0?"Undefined":t===null?"Null":typeof(s=function(c,u){try{return c[u]}catch{}}(r=MR(t),qN))=="string"?s:rb?kf(r):(a=kf(r))=="Object"&&KN(r.callee)?"Arguments":a},UR=xc,VR=String,Da=function(t){if(UR(t)==="Symbol")throw TypeError("Cannot convert a Symbol value to a string");return VR(t)},YN=Er("match"),XN=zn,JN=function(t){if($N(t))throw LR("The method doesn't accept regular expressions");return t},QN=Xt,FR=Da,Tl=function(t){var r=/./;try{"/./"[t](r)}catch{try{return r[YN]=!1,"/./"[t](r)}catch{}}return!1},Qg=I("".indexOf);XN({target:"String",proto:!0,forced:!Tl("includes")},{includes:function(t){return!!~Qg(FR(QN(this)),FR(JN(t)),arguments.length>1?arguments[1]:void 0)}});var jR=dc("String").includes,ib=O,BR=NR,WR=jR,Zg=Array.prototype,sb=String.prototype,ZN=function(t){var r=t.includes;return t===Zg||ib(Zg,t)&&r===Zg.includes?BR:typeof t=="string"||t===sb||ib(sb,t)&&r===sb.includes?WR:r},ot=l(ZN),ob=_t,e_=Yo,ab=pn,zR=yi,fE=TypeError,gm=function(t){return function(r,s,a,c){ob(s);var u=e_(r),h=ab(u),m=zR(u),y=t?m-1:0,v=t?-1:1;if(a<2)for(;;){if(y in h){c=h[y],y+=v;break}if(y+=v,t?y<0:m<=y)throw fE("Reduce of empty array with no initial value")}for(;t?y>=0:m>y;y+=v)y in h&&(c=s(c,h[y],y,u));return c}},cb={left:gm(!1)},GR=d,Nf=function(t,r){var s=[][t];return!!s&&GR(function(){s.call(null,r||function(){return 1},1)})},Df=typeof process<"u"&&Q(process)=="process",HR=cb.left;zn({target:"Array",proto:!0,forced:!Df&&ci>79&&ci<83||!Nf("reduce")},{reduce:function(t){var r=arguments.length;return HR(this,t,r,r>1?arguments[1]:void 0)}});var $R=dc("Array").reduce,KR=O,qR=$R,pE=Array.prototype,th=function(t){var r=t.reduce;return t===pE||KR(pE,t)&&r===pE.reduce?qR:r},mE=th,hc=l(mE),eD=Q,t_=Array.isArray||function(t){return eD(t)=="Array"},n_=zn,tD=t_,YR=I([].reverse),lb=[1,2];n_({target:"Array",proto:!0,forced:String(lb)===String(lb.reverse())},{reverse:function(){return tD(this)&&(this.length=this.length),YR(this)}});var Ui=dc("Array").reverse,ub=O,gE=Ui,xf=Array.prototype,XR=function(t){var r=t.reverse;return t===xf||ub(xf,t)&&r===xf.reverse?gE:r},_E=XR,_m=l(_E),yE=Xd,Lf=ac("keys"),r_=function(t){return Lf[t]||(Lf[t]=yE(t))},nD=!d(function(){function t(){}return t.prototype.constructor=null,Object.getPrototypeOf(new t)!==t.prototype}),rD=Ii,JR=xe,EE=Yo,vE=nD,SE=r_("IE_PROTO"),i_=Object,db=i_.prototype,s_=vE?i_.getPrototypeOf:function(t){var r=EE(t);if(rD(r,SE))return r[SE];var s=r.constructor;return JR(s)&&r instanceof s?s.prototype:r instanceof i_?db:null},iD=I,QR=_t,sD=xe,oD=String,hb=TypeError,nh=function(t,r,s){try{return iD(QR(Object.getOwnPropertyDescriptor(t,r)[s]))}catch{}},ZR=fn,ym=function(t){if(typeof t=="object"||sD(t))return t;throw hb("Can't set "+oD(t)+" as a prototype")},ou=Object.setPrototypeOf||("__proto__"in{}?function(){var t,r=!1,s={};try{(t=nh(Object.prototype,"__proto__","set"))(s,[]),r=s instanceof Array}catch{}return function(a,c){return ZR(a),ym(c),r?t(a,c):a.__proto__=c,a}}():void 0),rh={},Lc={},o_=Ii,aD=Re,cD=oa.indexOf,Mf=Lc,Em=I([].push),Uf=function(t,r){var s,a=aD(t),c=0,u=[];for(s in a)!o_(Mf,s)&&o_(a,s)&&Em(u,s);for(;r.length>c;)o_(a,s=r[c++])&&(~cD(u,s)||Em(u,s));return u},vm=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],fb=Uf,Sm=vm.concat("length","prototype");rh.f=Object.getOwnPropertyNames||function(t){return fb(t,Sm)};var Mc={};Mc.f=Object.getOwnPropertySymbols;var Vi=tn,Pi=rh,ih=Mc,No=fn,xa=I([].concat),Vf=Vi("Reflect","ownKeys")||function(t){var r=Pi.f(No(t)),s=ih.f;return s?xa(r,s(t)):r},Ff=Ii,La=Vf,bE=We,eI=nt,TE={},wE=Uf,tI=vm,Uc=Object.keys||function(t){return wE(t,tI)},CE=$e,pb=Qt,nI=nt,lD=fn,sh=Re,bm=Uc;TE.f=CE&&!pb?Object.defineProperties:function(t,r){lD(t);for(var s,a=sh(r),c=bm(r),u=c.length,h=0;u>h;)nI.f(t,s=c[h++],a[s]);return t};var td,a_=tn("document","documentElement"),RE=fn,Vc=TE,fc=vm,jf=Lc,nd=a_,rd=nu,id="prototype",IE="script",AE=r_("IE_PROTO"),c_=function(){},Ma=function(t){return"<"+IE+">"+t+"</"+IE+">"},Ua=function(t){t.write(Ma("")),t.close();var r=t.parentWindow.Object;return t=null,r},Ei=function(){try{td=new ActiveXObject("htmlfile")}catch{}var t,r,s;Ei=typeof document<"u"?document.domain&&td?Ua(td):(r=rd("iframe"),s="java"+IE+":",r.style.display="none",nd.appendChild(r),r.src=String(s),(t=r.contentWindow.document).open(),t.write(Ma("document.F=Object")),t.close(),t.F):Ua(td);for(var a=fc.length;a--;)delete Ei[id][fc[a]];return Ei()};jf[AE]=!0;var aa=Object.create||function(t,r){var s;return t!==null?(c_[id]=RE(t),s=new c_,c_[id]=null,s[AE]=t):s=Ei(),r===void 0?s:Vc.f(s,r)},rI=ft,iI=ia,PE=Error,mb=I("".replace),sI=String(PE("zxcasd").stack),l_=/\n\s*at [^:]*:[^\n]*/,oI=l_.test(sI),Tm=Je,gb=!d(function(){var t=Error("a");return!("stack"in t)||(Object.defineProperty(t,"stack",Tm(1,7)),t.stack!==7)}),uD=ia,u_=function(t,r){if(oI&&typeof t=="string"&&!PE.prepareStackTrace)for(;r--;)t=mb(t,l_,"");return t},OE=gb,_b=Error.captureStackTrace,oh={},wm=oh,aI=Er("iterator"),kE=Array.prototype,d_=function(t){return t!==void 0&&(wm.Array===t||kE[aI]===t)},Cm=xc,NE=_i,yb=Ft,Eb=oh,vb=Er("iterator"),sd=function(t){if(!yb(t))return NE(t,vb)||NE(t,"@@iterator")||Eb[Cm(t)]},Fc=Ee,Bf=_t,Sb=fn,cI=Pa,od=sd,ah=TypeError,h_=function(t,r){var s=arguments.length<2?od(t):r;if(Bf(s))return Sb(Fc(s,t));throw ah(cI(t)+" is not iterable")},lI=Ee,au=fn,ch=_i,f_=function(t,r,s){var a,c;au(t);try{if(!(a=ch(t,"return"))){if(r==="throw")throw s;return s}a=lI(a,t)}catch(u){c=!0,a=u}if(r==="throw")throw s;if(c)throw a;return au(a),s},uI=De,DE=Ee,dI=fn,p_=Pa,cu=d_,m_=yi,Rm=O,Wf=h_,bb=sd,zf=f_,hI=TypeError,Im=function(t,r){this.stopped=t,this.result=r},Gi=Im.prototype,lh=function(t,r,s){var a,c,u,h,m,y,v,S=s&&s.that,R=!(!s||!s.AS_ENTRIES),P=!(!s||!s.IS_RECORD),D=!(!s||!s.IS_ITERATOR),G=!(!s||!s.INTERRUPTED),F=uI(r,S),j=function(ee){return a&&zf(a,"normal",ee),new Im(!0,ee)},Y=function(ee){return R?(dI(ee),G?F(ee[0],ee[1],j):F(ee[0],ee[1])):G?F(ee,j):F(ee)};if(P)a=t.iterator;else if(D)a=t;else{if(!(c=bb(t)))throw hI(p_(t)+" is not iterable");if(cu(c)){for(u=0,h=m_(t);h>u;u++)if((m=Y(t[u]))&&Rm(Gi,m))return m;return new Im(!1)}a=Wf(t,c)}for(y=P?t.next:a.next;!(v=DE(y,a)).done;){try{m=Y(v.value)}catch(ee){zf(a,"throw",ee)}if(typeof m=="object"&&m&&Rm(Gi,m))return m}return new Im(!1)},Tb=Da,wb=zn,xE=O,Cb=s_,lu=ou,Xi=function(t,r,s){for(var a=La(r),c=eI.f,u=bE.f,h=0;h<a.length;h++){var m=a[h];Ff(t,m)||s&&Ff(s,m)||c(t,m,u(r,m))}},Ts=aa,ws=ia,Am=Je,g_=function(t,r){rI(r)&&"cause"in r&&iI(t,"cause",r.cause)},__=function(t,r,s,a){OE&&(_b?_b(t,r):uD(t,"stack",u_(s,a)))},dD=lh,Do=function(t,r){return t===void 0?arguments.length<2?"":r:Tb(t)},Rb=Er("toStringTag"),Pm=Error,Ib=[].push,ca=function(t,r){var s,a=xE(Va,this);lu?s=lu(Pm(),a?Cb(this):Va):(s=a?this:Ts(Va),ws(s,Rb,"Error")),r!==void 0&&ws(s,"message",Do(r)),__(s,ca,s.stack,1),arguments.length>2&&g_(s,arguments[2]);var c=[];return dD(t,Ib,{that:c}),ws(s,"errors",c),s};lu?lu(ca,Pm):Xi(ca,Pm,{name:!0});var Va=ca.prototype=Ts(Pm.prototype,{constructor:Am(1,ca),message:Am(1,""),name:Am(1,"AggregateError")});wb({global:!0},{AggregateError:ca});var uh,Gf,Om,fI=xe,Ab=U.WeakMap,pI=fI(Ab)&&/native code/.test(String(Ab)),Pb=U,mI=ft,gI=ia,LE=Ii,ME=$d,y_=r_,_I=Lc,E_="Object already initialized",km=Pb.TypeError,yI=Pb.WeakMap;if(pI||ME.state){var jc=ME.state||(ME.state=new yI);jc.get=jc.get,jc.has=jc.has,jc.set=jc.set,uh=function(t,r){if(jc.has(t))throw km(E_);return r.facade=t,jc.set(t,r),r},Gf=function(t){return jc.get(t)||{}},Om=function(t){return jc.has(t)}}else{var Hf=y_("state");_I[Hf]=!0,uh=function(t,r){if(LE(t,Hf))throw km(E_);return r.facade=t,gI(t,Hf,r),r},Gf=function(t){return LE(t,Hf)?t[Hf]:{}},Om=function(t){return LE(t,Hf)}}var dh,Ob,kb,ad={set:uh,get:Gf,has:Om,enforce:function(t){return Om(t)?Gf(t):uh(t,{})},getterFor:function(t){return function(r){var s;if(!mI(r)||(s=Gf(r)).type!==t)throw km("Incompatible receiver, "+t+" required");return s}}},UE=$e,EI=Ii,Nb=Function.prototype,hD=UE&&Object.getOwnPropertyDescriptor,Db=EI(Nb,"name"),vI={PROPER:Db&&(function(){}).name==="something",CONFIGURABLE:Db&&(!UE||UE&&hD(Nb,"name").configurable)},fD=ia,cd=function(t,r,s,a){return a&&a.enumerable?t[r]=s:fD(t,r,s),t},SI=d,bI=xe,VE=ft,pD=aa,TI=s_,mD=cd,pc=Er("iterator"),FE=!1;[].keys&&("next"in(kb=[].keys())?(Ob=TI(TI(kb)))!==Object.prototype&&(dh=Ob):FE=!0);var jE=!VE(dh)||SI(function(){var t={};return dh[pc].call(t)!==t});bI((dh=jE?{}:pD(dh))[pc])||mD(dh,pc,function(){return this});var xb={IteratorPrototype:dh,BUGGY_SAFARI_ITERATORS:FE},wI=xc,CI=Of?{}.toString:function(){return"[object "+wI(this)+"]"},Lb=Of,Nm=nt.f,Mb=ia,Ub=Ii,gD=CI,Vb=Er("toStringTag"),ld=function(t,r,s,a){if(t){var c=s?t:t.prototype;Ub(c,Vb)||Nm(c,Vb,{configurable:!0,value:r}),a&&!Lb&&Mb(c,"toString",gD)}},RI=xb.IteratorPrototype,II=aa,AI=Je,_D=ld,Fa=oh,la=function(){return this},BE=function(t,r,s,a){var c=r+" Iterator";return t.prototype=II(RI,{next:AI(+!a,s)}),_D(t,c,!1,!0),Fa[c]=la,t},PI=zn,OI=Ee,kI=vI,NI=BE,Fb=s_,DI=ld,WE=cd,jb=oh,xI=xb,Bb=kI.PROPER,Dm=xI.BUGGY_SAFARI_ITERATORS,zE=Er("iterator"),GE="keys",$f="values",LI="entries",MI=function(){return this},HE=function(t,r,s,a,c,u,h){NI(s,r,a);var m,y,v,S=function(Y){if(Y===c&&F)return F;if(!Dm&&Y in D)return D[Y];switch(Y){case GE:case $f:case LI:return function(){return new s(this,Y)}}return function(){return new s(this)}},R=r+" Iterator",P=!1,D=t.prototype,G=D[zE]||D["@@iterator"]||c&&D[c],F=!Dm&&G||S(c),j=r=="Array"&&D.entries||G;if(j&&(m=Fb(j.call(new t)))!==Object.prototype&&m.next&&(DI(m,R,!0,!0),jb[R]=MI),Bb&&c==$f&&G&&G.name!==$f&&(P=!0,F=function(){return OI(G,this)}),c)if(y={values:S($f),keys:u?F:S(GE),entries:S(LI)},h)for(v in y)(Dm||P||!(v in D))&&WE(D,v,y[v]);else PI({target:r,proto:!0,forced:Dm||P},y);return h&&D[zE]!==F&&WE(D,zE,F,{}),jb[r]=F,y},$E=function(t,r){return{value:t,done:r}},KE=Re,uu=oh,UI=ad;nt.f;var VI=HE,qE=$E,Wb="Array Iterator",FI=UI.set,v_=UI.getterFor(Wb);VI(Array,"Array",function(t,r){FI(this,{type:Wb,target:KE(t),index:0,kind:r})},function(){var t=v_(this),r=t.target,s=t.kind,a=t.index++;return!r||a>=r.length?(t.target=void 0,qE(void 0,!0)):qE(s=="keys"?a:s=="values"?r[a]:[a,r[a]],!1)},"values"),uu.Arguments=uu.Array;var xo=nt,YE=function(t,r,s){return xo.f(t,r,s)},yD=tn,XE=YE,Lo=$e,jI=Er("species"),nn=O,xm=TypeError,S_=function(t,r){if(nn(r,t))return t;throw xm("Incorrect invocation")},BI=xe,zb=$d,b_=I(Function.toString);BI(zb.inspectSource)||(zb.inspectSource=function(t){return b_(t)});var T_=zb.inspectSource,Gb=I,WI=d,Hb=xe,zI=xc,$b=T_,JE=function(){},po=[],Bc=tn("Reflect","construct"),du=/^\s*(?:class|function)\b/,GI=Gb(du.exec),HI=!du.exec(JE),ua=function(t){if(!Hb(t))return!1;try{return Bc(JE,po,t),!0}catch{return!1}},Kb=function(t){if(!Hb(t))return!1;switch(zI(t)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return HI||!!GI(du,$b(t))}catch{return!0}};Kb.sham=!0;var ja,Lm,qb,QE,w_=!Bc||WI(function(){var t;return ua(ua.call)||!ua(Object)||!ua(function(){t=!0})||t})?Kb:ua,$I=w_,ED=Pa,ZE=TypeError,ev=fn,Wc=function(t){if($I(t))return t;throw ZE(ED(t)+" is not a constructor")},Dr=Ft,Zs=Er("species"),as=function(t,r){var s,a=ev(t).constructor;return a===void 0||Dr(s=ev(a)[Zs])?r:Wc(s)},Cs=I([].slice),mc=TypeError,wl=function(t,r){if(t<r)throw mc("Not enough arguments");return t},Rs=/(?:ipad|iphone|ipod).*applewebkit/i.test(vt),mo=U,Kf=ie,tv=De,nv=xe,C_=Ii,da=d,rv=a_,Mm=Cs,hu=nu,iv=wl,Yb=Rs,hh=Df,Um=mo.setImmediate,fu=mo.clearImmediate,sv=mo.process,qf=mo.Dispatch,Xb=mo.Function,R_=mo.MessageChannel,ov=mo.String,go=0,zc={},Gc="onreadystatechange";da(function(){ja=mo.location});var Mo=function(t){if(C_(zc,t)){var r=zc[t];delete zc[t],r()}},av=function(t){return function(){Mo(t)}},cv=function(t){Mo(t.data)},lv=function(t){mo.postMessage(ov(t),ja.protocol+"//"+ja.host)};Um&&fu||(Um=function(t){iv(arguments.length,1);var r=nv(t)?t:Xb(t),s=Mm(arguments,1);return zc[++go]=function(){Kf(r,void 0,s)},Lm(go),go},fu=function(t){delete zc[t]},hh?Lm=function(t){sv.nextTick(av(t))}:qf&&qf.now?Lm=function(t){qf.now(av(t))}:R_&&!Yb?(QE=(qb=new R_).port2,qb.port1.onmessage=cv,Lm=tv(QE.postMessage,QE)):mo.addEventListener&&nv(mo.postMessage)&&!mo.importScripts&&ja&&ja.protocol!=="file:"&&!da(lv)?(Lm=lv,mo.addEventListener("message",cv,!1)):Lm=Gc in hu("script")?function(t){rv.appendChild(hu("script"))[Gc]=function(){rv.removeChild(this),Mo(t)}}:function(t){setTimeout(av(t),0)});var uv={set:Um,clear:fu},ud=function(){this.head=null,this.tail=null};ud.prototype={add:function(t){var r={item:t,next:null},s=this.tail;s?s.next=r:this.head=r,this.tail=r},get:function(){var t=this.head;if(t)return(this.head=t.next)===null&&(this.tail=null),t.item}};var Yf,I_,dd,A_,fh,Jb=ud,KI=/ipad|iphone|ipod/i.test(vt)&&typeof Pebble<"u",Qb=/web0s(?!.*chrome)/i.test(vt),pu=U,qI=De,vD=We.f,dv=uv.set,YI=Jb,Xf=Rs,SD=KI,Vm=Qb,hv=Df,Ji=pu.MutationObserver||pu.WebKitMutationObserver,XI=pu.document,Zb=pu.process,fv=pu.Promise,JI=vD(pu,"queueMicrotask"),pv=JI&&JI.value;if(!pv){var P_=new YI,mv=function(){var t,r;for(hv&&(t=Zb.domain)&&t.exit();r=P_.get();)try{r()}catch(s){throw P_.head&&Yf(),s}t&&t.enter()};Xf||hv||Vm||!Ji||!XI?!SD&&fv&&fv.resolve?((A_=fv.resolve(void 0)).constructor=fv,fh=qI(A_.then,A_),Yf=function(){fh(mv)}):hv?Yf=function(){Zb.nextTick(mv)}:(dv=qI(dv,pu),Yf=function(){dv(mv)}):(I_=!0,dd=XI.createTextNode(""),new Ji(mv).observe(dd,{characterData:!0}),Yf=function(){dd.data=I_=!I_}),pv=function(t){P_.head||Yf(),P_.add(t)}}var gc=pv,ph=function(t){try{return{error:!1,value:t()}}catch(r){return{error:!0,value:r}}},Jf=U.Promise,hd=typeof Deno=="object"&&Deno&&typeof Deno.version=="object",gv=!hd&&!Df&&typeof window=="object"&&typeof document=="object",Qf=U,mh=Jf,eT=xe,tT=ka,bD=T_,nT=Er,TD=gv,QI=hd,_v=ci,O_=mh&&mh.prototype,yv=nT("species"),rT=eT(Qf.PromiseRejectionEvent),iT=tT("Promise",function(){var t=bD(mh),r=t!==String(mh);if(!r&&_v===66||!O_.catch||!O_.finally)return!0;if(!_v||_v<51||!/native code/.test(t)){var s=new mh(function(c){c(1)}),a=function(c){c(function(){},function(){})};if((s.constructor={})[yv]=a,!(s.then(function(){})instanceof a))return!0}return!r&&(TD||QI)&&!rT}),k_={CONSTRUCTOR:iT,REJECTION_EVENT:rT},Cl={},Ev=_t,vv=TypeError,sT=function(t){var r,s;this.promise=new t(function(a,c){if(r!==void 0||s!==void 0)throw vv("Bad Promise constructor");r=a,s=c}),this.resolve=Ev(r),this.reject=Ev(s)};Cl.f=function(t){return new sT(t)};var Fm,oT,wD=zn,Zf=Df,gh=U,fd=Ee,CD=cd,Sv=ld,f=function(t){var r=yD(t);Lo&&r&&!r[jI]&&XE(r,jI,{configurable:!0,get:function(){return this}})},g=_t,T=xe,k=ft,V=S_,H=as,le=uv.set,Ie=gc,Ue=function(t,r){try{arguments.length==1?console.error(t):console.error(t,r)}catch{}},it=ph,Ot=Jb,kt=ad,Pt=Jf,Yt=k_,sn=Cl,on="Promise",cs=Yt.CONSTRUCTOR,Xe=Yt.REJECTION_EVENT,Fe=kt.getterFor(on),tt=kt.set,Lt=Pt&&Pt.prototype,cn=Pt,Sn=Lt,Rn=gh.TypeError,Fn=gh.document,Is=gh.process,Ar=sn.f,_h=Ar,RD=!!(Fn&&Fn.createEvent&&gh.dispatchEvent),N3="unhandledrejection",D3=function(t){var r;return!(!k(t)||!T(r=t.then))&&r},x3=function(t,r){var s,a,c,u=r.value,h=r.state==1,m=h?t.ok:t.fail,y=t.resolve,v=t.reject,S=t.domain;try{m?(h||(r.rejection===2&&Iae(r),r.rejection=1),m===!0?s=u:(S&&S.enter(),s=m(u),S&&(S.exit(),c=!0)),s===t.promise?v(Rn("Promise-chain cycle")):(a=D3(s))?fd(a,s,y,v):y(s)):v(u)}catch(R){S&&!c&&S.exit(),v(R)}},L3=function(t,r){t.notified||(t.notified=!0,Ie(function(){for(var s,a=t.reactions;s=a.get();)x3(s,t);t.notified=!1,r&&!t.rejection&&Rae(t)}))},M3=function(t,r,s){var a,c;RD?((a=Fn.createEvent("Event")).promise=r,a.reason=s,a.initEvent(t,!1,!0),gh.dispatchEvent(a)):a={promise:r,reason:s},!Xe&&(c=gh["on"+t])?c(a):t===N3&&Ue("Unhandled promise rejection",s)},Rae=function(t){fd(le,gh,function(){var r,s=t.facade,a=t.value;if(U3(t)&&(r=it(function(){Zf?Is.emit("unhandledRejection",a,s):M3(N3,s,a)}),t.rejection=Zf||U3(t)?2:1,r.error))throw r.value})},U3=function(t){return t.rejection!==1&&!t.parent},Iae=function(t){fd(le,gh,function(){var r=t.facade;Zf?Is.emit("rejectionHandled",r):M3("rejectionhandled",r,t.value)})},bv=function(t,r,s){return function(a){t(r,a,s)}},Tv=function(t,r,s){t.done||(t.done=!0,s&&(t=s),t.value=r,t.state=2,L3(t,!0))},ID=function(t,r,s){if(!t.done){t.done=!0,s&&(t=s);try{if(t.facade===r)throw Rn("Promise can't be resolved itself");var a=D3(r);a?Ie(function(){var c={done:!1};try{fd(a,r,bv(ID,c,t),bv(Tv,c,t))}catch(u){Tv(c,u,t)}}):(t.value=r,t.state=1,L3(t,!1))}catch(c){Tv({done:!1},c,t)}}};cs&&(Sn=(cn=function(t){V(this,Sn),g(t),fd(Fm,this);var r=Fe(this);try{t(bv(ID,r),bv(Tv,r))}catch(s){Tv(r,s)}}).prototype,(Fm=function(t){tt(this,{type:on,done:!1,notified:!1,parent:!1,reactions:new Ot,rejection:!1,state:0,value:void 0})}).prototype=CD(Sn,"then",function(t,r){var s=Fe(this),a=Ar(H(this,cn));return s.parent=!0,a.ok=!T(t)||t,a.fail=T(r)&&r,a.domain=Zf?Is.domain:void 0,s.state==0?s.reactions.add(a):Ie(function(){x3(a,s)}),a.promise}),oT=function(){var t=new Fm,r=Fe(t);this.promise=t,this.resolve=bv(ID,r),this.reject=bv(Tv,r)},sn.f=Ar=function(t){return t===cn||t===void 0?new oT(t):_h(t)}),wD({global:!0,wrap:!0,forced:cs},{Promise:cn}),Sv(cn,on,!1,!0),f(on);var V3=Er("iterator"),F3=!1;try{var Aae=0,j3={next:function(){return{done:!!Aae++}},return:function(){F3=!0}};j3[V3]=function(){return this},Array.from(j3,function(){throw 2})}catch{}var Pae=Jf,Oae=function(t,r){if(!F3)return!1;var s=!1;try{var a={};a[V3]=function(){return{next:function(){return{done:s=!0}}}},t(a)}catch{}return s},ZI=k_.CONSTRUCTOR||!Oae(function(t){Pae.all(t).then(void 0,function(){})}),kae=Ee,Nae=_t,Dae=Cl,xae=ph,Lae=lh;zn({target:"Promise",stat:!0,forced:ZI},{all:function(t){var r=this,s=Dae.f(r),a=s.resolve,c=s.reject,u=xae(function(){var h=Nae(r.resolve),m=[],y=0,v=1;Lae(t,function(S){var R=y++,P=!1;v++,kae(h,r,S).then(function(D){P||(P=!0,m[R]=D,--v||a(m))},c)}),--v||a(m)});return u.error&&c(u.value),s.promise}});var Mae=zn,Uae=k_.CONSTRUCTOR;Jf&&Jf.prototype,Mae({target:"Promise",proto:!0,forced:Uae,real:!0},{catch:function(t){return this.then(void 0,t)}});var Vae=Ee,Fae=_t,jae=Cl,Bae=ph,Wae=lh;zn({target:"Promise",stat:!0,forced:ZI},{race:function(t){var r=this,s=jae.f(r),a=s.reject,c=Bae(function(){var u=Fae(r.resolve);Wae(t,function(h){Vae(u,r,h).then(s.resolve,a)})});return c.error&&a(c.value),s.promise}});var zae=Ee,Gae=Cl;zn({target:"Promise",stat:!0,forced:k_.CONSTRUCTOR},{reject:function(t){var r=Gae.f(this);return zae(r.reject,void 0,t),r.promise}});var Hae=fn,$ae=ft,Kae=Cl,B3=function(t,r){if(Hae(t),$ae(r)&&r.constructor===t)return r;var s=Kae.f(t);return(0,s.resolve)(r),s.promise},qae=zn,Yae=Jf,Xae=k_.CONSTRUCTOR,Jae=B3,Qae=tn("Promise"),Zae=!Xae;qae({target:"Promise",stat:!0,forced:!0},{resolve:function(t){return Jae(Zae&&this===Qae?Yae:this,t)}});var ece=Ee,tce=_t,nce=Cl,rce=ph,ice=lh;zn({target:"Promise",stat:!0,forced:ZI},{allSettled:function(t){var r=this,s=nce.f(r),a=s.resolve,c=s.reject,u=rce(function(){var h=tce(r.resolve),m=[],y=0,v=1;ice(t,function(S){var R=y++,P=!1;v++,ece(h,r,S).then(function(D){P||(P=!0,m[R]={status:"fulfilled",value:D},--v||a(m))},function(D){P||(P=!0,m[R]={status:"rejected",reason:D},--v||a(m))})}),--v||a(m)});return u.error&&c(u.value),s.promise}});var sce=Ee,oce=_t,ace=tn,cce=Cl,lce=ph,uce=lh,W3="No one promise resolved";zn({target:"Promise",stat:!0,forced:ZI},{any:function(t){var r=this,s=ace("AggregateError"),a=cce.f(r),c=a.resolve,u=a.reject,h=lce(function(){var m=oce(r.resolve),y=[],v=0,S=1,R=!1;uce(t,function(P){var D=v++,G=!1;S++,sce(m,r,P).then(function(F){G||R||(R=!0,c(F))},function(F){G||R||(G=!0,y[D]=F,--S||u(new s(y,W3)))})}),--S||u(new s(y,W3))});return h.error&&u(h.value),a.promise}});var dce=zn,AD=Jf,hce=d,fce=tn,pce=xe,mce=as,z3=B3,gce=AD&&AD.prototype;dce({target:"Promise",proto:!0,real:!0,forced:!!AD&&hce(function(){gce.finally.call({then:function(){}},function(){})})},{finally:function(t){var r=mce(this,fce("Promise")),s=pce(t);return this.then(s?function(a){return z3(r,t()).then(function(){return a})}:t,s?function(a){return z3(r,t()).then(function(){throw a})}:t)}});var PD=I,_ce=Dc,yce=Da,Ece=Xt,vce=PD("".charAt),G3=PD("".charCodeAt),Sce=PD("".slice),H3=function(t){return function(r,s){var a,c,u=yce(Ece(r)),h=_ce(s),m=u.length;return h<0||h>=m?t?"":void 0:(a=G3(u,h))<55296||a>56319||h+1===m||(c=G3(u,h+1))<56320||c>57343?t?vce(u,h):a:t?Sce(u,h,h+2):c-56320+(a-55296<<10)+65536}},OD={codeAt:H3(!1),charAt:H3(!0)},bce=OD.charAt,Tce=Da,$3=ad,wce=HE,K3=$E,q3="String Iterator",Cce=$3.set,Rce=$3.getterFor(q3);wce(String,"String",function(t){Cce(this,{type:q3,string:Tce(t),index:0})},function(){var t,r=Rce(this),s=r.string,a=r.index;return a>=s.length?K3(void 0,!0):(t=bce(s,a),r.index+=t.length,K3(t,!1))});var Ice=gt.Promise,Ace={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},Pce=U,Oce=xc,kce=ia,Y3=oh,X3=Er("toStringTag");for(var kD in Ace){var J3=Pce[kD],ND=J3&&J3.prototype;ND&&Oce(ND)!==X3&&kce(ND,X3,kD),Y3[kD]=Y3.Array}var Q3=Ice,dt=l(Q3),Nce=dc("Array").values,Dce=xc,xce=Ii,Lce=O,Mce=Nce,DD=Array.prototype,Uce={DOMTokenList:!0,NodeList:!0},Vce=function(t){var r=t.values;return t===DD||Lce(DD,t)&&r===DD.values||xce(Uce,Dce(t))?Mce:r},Hc=l(Vce),Fce=d,jce=Er("iterator"),xD=!Fce(function(){var t=new URL("b?a=1&b=2&c=3","http://a"),r=t.searchParams,s=new URLSearchParams("a=1&a=2"),a="";return t.pathname="c%20d",r.forEach(function(c,u){r.delete("b"),a+=u+c}),s.delete("a",2),!t.toJSON||!s.has("a",1)||s.has("a",2)||!r.size&&!0||!r.sort||t.href!=="http://a/c%20d?a=1&c=3"||r.get("c")!=="3"||String(new URLSearchParams("?a=1"))!=="a=1"||!r[jce]||new URL("https://a@b").username!=="a"||new URLSearchParams(new URLSearchParams("a=b")).get("a")!=="b"||new URL("http://").host!=="xn--e1aybc"||new URL("http://a#").hash!=="#%D0%B1"||a!=="a1c3"||new URL("http://x",void 0).host!=="x"}),Bce=cd,Wce=lc,zce=nt,Gce=Je,eA=function(t,r,s){var a=Wce(r);a in t?zce.f(t,a,Gce(0,s)):t[a]=s},Z3=ge,Hce=yi,$ce=eA,Kce=Array,qce=Math.max,LD=function(t,r,s){for(var a=Hce(t),c=Z3(r,a),u=Z3(s===void 0?a:s,a),h=Kce(qce(u-c,0)),m=0;c<u;c++,m++)$ce(h,m,t[c]);return h.length=m,h},e5=LD,Yce=Math.floor,MD=function(t,r){var s=t.length,a=Yce(s/2);return s<8?Xce(t,r):Jce(t,MD(e5(t,0,a),r),MD(e5(t,a),r),r)},Xce=function(t,r){for(var s,a,c=t.length,u=1;u<c;){for(a=u,s=t[u];a&&r(t[a-1],s)>0;)t[a]=t[--a];a!==u++&&(t[a]=s)}return t},Jce=function(t,r,s,a){for(var c=r.length,u=s.length,h=0,m=0;h<c||m<u;)t[h+m]=h<c&&m<u?a(r[h],s[m])<=0?r[h++]:s[m++]:h<c?r[h++]:s[m++];return t},t5=MD,UD=zn,wv=U,tA=Ee,yh=I,Cv=$e,n5=xD,r5=cd,Qce=YE,Zce=function(t,r,s){for(var a in r)s&&s.unsafe&&t[a]?t[a]=r[a]:Bce(t,a,r[a],s);return t},ele=ld,tle=BE,VD=ad,i5=S_,FD=xe,nle=Ii,rle=De,ile=xc,sle=fn,s5=ft,_c=Da,ole=aa,o5=Je,jD=h_,ale=sd,Rv=wl,cle=t5,lle=Er("iterator"),aT="URLSearchParams",a5=aT+"Iterator",c5=VD.set,mu=VD.getterFor(aT),ule=VD.getterFor(a5),dle=Object.getOwnPropertyDescriptor,BD=function(t){if(!Cv)return wv[t];var r=dle(wv,t);return r&&r.value},l5=BD("fetch"),nA=BD("Request"),cT=BD("Headers"),WD=nA&&nA.prototype,u5=cT&&cT.prototype,hle=wv.RegExp,fle=wv.TypeError,d5=wv.decodeURIComponent,ple=wv.encodeURIComponent,mle=yh("".charAt),h5=yh([].join),N_=yh([].push),zD=yh("".replace),gle=yh([].shift),f5=yh([].splice),p5=yh("".split),_le=yh("".slice),yle=/\+/g,m5=Array(4),Ele=function(t){return m5[t-1]||(m5[t-1]=hle("((?:%[\\da-f]{2}){"+t+"})","gi"))},vle=function(t){try{return d5(t)}catch{return t}},g5=function(t){var r=zD(t,yle," "),s=4;try{return d5(r)}catch{for(;s;)r=zD(r,Ele(s--),vle);return r}},Sle=/[!'()~]|%20/g,ble={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},Tle=function(t){return ble[t]},_5=function(t){return zD(ple(t),Sle,Tle)},GD=tle(function(t,r){c5(this,{type:a5,iterator:jD(mu(t).entries),kind:r})},"Iterator",function(){var t=ule(this),r=t.kind,s=t.iterator.next(),a=s.value;return s.done||(s.value=r==="keys"?a.key:r==="values"?a.value:[a.key,a.value]),s},!0),y5=function(t){this.entries=[],this.url=null,t!==void 0&&(s5(t)?this.parseObject(t):this.parseQuery(typeof t=="string"?mle(t,0)==="?"?_le(t,1):t:_c(t)))};y5.prototype={type:aT,bindURL:function(t){this.url=t,this.update()},parseObject:function(t){var r,s,a,c,u,h,m,y=ale(t);if(y)for(s=(r=jD(t,y)).next;!(a=tA(s,r)).done;){if(u=(c=jD(sle(a.value))).next,(h=tA(u,c)).done||(m=tA(u,c)).done||!tA(u,c).done)throw fle("Expected sequence with length 2");N_(this.entries,{key:_c(h.value),value:_c(m.value)})}else for(var v in t)nle(t,v)&&N_(this.entries,{key:v,value:_c(t[v])})},parseQuery:function(t){if(t)for(var r,s,a=p5(t,"&"),c=0;c<a.length;)(r=a[c++]).length&&(s=p5(r,"="),N_(this.entries,{key:g5(gle(s)),value:g5(h5(s,"="))}))},serialize:function(){for(var t,r=this.entries,s=[],a=0;a<r.length;)t=r[a++],N_(s,_5(t.key)+"="+_5(t.value));return h5(s,"&")},update:function(){this.entries.length=0,this.parseQuery(this.url.query)},updateURL:function(){this.url&&this.url.update()}};var rA=function(){i5(this,Iv);var t=c5(this,new y5(arguments.length>0?arguments[0]:void 0));Cv||(this.size=t.entries.length)},Iv=rA.prototype;if(Zce(Iv,{append:function(t,r){var s=mu(this);Rv(arguments.length,2),N_(s.entries,{key:_c(t),value:_c(r)}),Cv||this.length++,s.updateURL()},delete:function(t){for(var r=mu(this),s=Rv(arguments.length,1),a=r.entries,c=_c(t),u=s<2?void 0:arguments[1],h=u===void 0?u:_c(u),m=0;m<a.length;){var y=a[m];if(y.key!==c||h!==void 0&&y.value!==h)m++;else if(f5(a,m,1),h!==void 0)break}Cv||(this.size=a.length),r.updateURL()},get:function(t){var r=mu(this).entries;Rv(arguments.length,1);for(var s=_c(t),a=0;a<r.length;a++)if(r[a].key===s)return r[a].value;return null},getAll:function(t){var r=mu(this).entries;Rv(arguments.length,1);for(var s=_c(t),a=[],c=0;c<r.length;c++)r[c].key===s&&N_(a,r[c].value);return a},has:function(t){for(var r=mu(this).entries,s=Rv(arguments.length,1),a=_c(t),c=s<2?void 0:arguments[1],u=c===void 0?c:_c(c),h=0;h<r.length;){var m=r[h++];if(m.key===a&&(u===void 0||m.value===u))return!0}return!1},set:function(t,r){var s=mu(this);Rv(arguments.length,1);for(var a,c=s.entries,u=!1,h=_c(t),m=_c(r),y=0;y<c.length;y++)(a=c[y]).key===h&&(u?f5(c,y--,1):(u=!0,a.value=m));u||N_(c,{key:h,value:m}),Cv||(this.size=c.length),s.updateURL()},sort:function(){var t=mu(this);cle(t.entries,function(r,s){return r.key>s.key?1:-1}),t.updateURL()},forEach:function(t){for(var r,s=mu(this).entries,a=rle(t,arguments.length>1?arguments[1]:void 0),c=0;c<s.length;)a((r=s[c++]).value,r.key,this)},keys:function(){return new GD(this,"keys")},values:function(){return new GD(this,"values")},entries:function(){return new GD(this,"entries")}},{enumerable:!0}),r5(Iv,lle,Iv.entries,{}),r5(Iv,"toString",function(){return mu(this).serialize()},{enumerable:!0}),Cv&&Qce(Iv,"size",{get:function(){return mu(this).entries.length},configurable:!0,enumerable:!0}),ele(rA,aT),UD({global:!0,forced:!n5},{URLSearchParams:rA}),!n5&&FD(cT)){var wle=yh(u5.has),Cle=yh(u5.set),E5=function(t){if(s5(t)){var r,s=t.body;if(ile(s)===aT)return r=t.headers?new cT(t.headers):new cT,wle(r,"content-type")||Cle(r,"content-type","application/x-www-form-urlencoded;charset=UTF-8"),ole(t,{body:o5(0,_c(s)),headers:o5(0,r)})}return t};if(FD(l5)&&UD({global:!0,dontCallGetSet:!0,forced:!0},{fetch:function(t){return l5(t,arguments.length>1?E5(arguments[1]):{})}}),FD(nA)){var HD=function(t){return i5(this,WD),new nA(t,arguments.length>1?E5(arguments[1]):{})};WD.constructor=HD,HD.prototype=WD,UD({global:!0,dontCallGetSet:!0,forced:!0},{Request:HD})}}var gu,Rle={URLSearchParams:rA,getState:mu},Ile=gt.URLSearchParams,v5=$e,Ale=I,Ple=Ee,Ole=d,$D=Uc,kle=Mc,Nle=ke,Dle=Yo,xle=pn,Av=Object.assign,S5=Object.defineProperty,Lle=Ale([].concat),Mle=!Av||Ole(function(){if(v5&&Av({b:1},Av(S5({},"a",{enumerable:!0,get:function(){S5(this,"b",{value:3,enumerable:!1})}}),{b:2})).b!==1)return!0;var t={},r={},s=Symbol(),a="abcdefghijklmnopqrst";return t[s]=7,a.split("").forEach(function(c){r[c]=c}),Av({},t)[s]!=7||$D(Av({},r)).join("")!=a})?function(t,r){for(var s=Dle(t),a=arguments.length,c=1,u=kle.f,h=Nle.f;a>c;)for(var m,y=xle(arguments[c++]),v=u?Lle($D(y),u(y)):$D(y),S=v.length,R=0;S>R;)m=v[R++],v5&&!Ple(h,y,m)||(s[m]=y[m]);return s}:Av,Ule=fn,Vle=f_,Fle=De,jle=Ee,Ble=Yo,Wle=function(t,r,s,a){try{return a?r(Ule(s)[0],s[1]):r(s)}catch(c){Vle(t,"throw",c)}},zle=d_,Gle=w_,Hle=yi,b5=eA,$le=h_,Kle=sd,T5=Array,D_=I,KD=2147483647,qle=/[^\0-\u007E]/,w5=/[.\u3002\uFF0E\uFF61]/g,C5="Overflow: input needs wider integers to process",R5=RangeError,Yle=D_(w5.exec),Pv=Math.floor,qD=String.fromCharCode,I5=D_("".charCodeAt),A5=D_([].join),jm=D_([].push),Xle=D_("".replace),Jle=D_("".split),Qle=D_("".toLowerCase),P5=function(t){return t+22+75*(t<26)},Zle=function(t,r,s){var a=0;for(t=s?Pv(t/700):t>>1,t+=Pv(t/r);t>455;)t=Pv(t/35),a+=36;return Pv(a+36*t/(t+38))},eue=function(t){var r=[];t=function(Y){for(var ee=[],fe=0,Se=Y.length;fe<Se;){var we=I5(Y,fe++);if(we>=55296&&we<=56319&&fe<Se){var ye=I5(Y,fe++);(64512&ye)==56320?jm(ee,((1023&we)<<10)+(1023&ye)+65536):(jm(ee,we),fe--)}else jm(ee,we)}return ee}(t);var s,a,c=t.length,u=128,h=0,m=72;for(s=0;s<t.length;s++)(a=t[s])<128&&jm(r,qD(a));var y=r.length,v=y;for(y&&jm(r,"-");v<c;){var S=KD;for(s=0;s<t.length;s++)(a=t[s])>=u&&a<S&&(S=a);var R=v+1;if(S-u>Pv((KD-h)/R))throw R5(C5);for(h+=(S-u)*R,u=S,s=0;s<t.length;s++){if((a=t[s])<u&&++h>KD)throw R5(C5);if(a==u){for(var P=h,D=36;;){var G=D<=m?1:D>=m+26?26:D-m;if(P<G)break;var F=P-G,j=36-G;jm(r,qD(P5(G+F%j))),P=Pv(F/j),D+=36}jm(r,qD(P5(P))),m=Zle(h,R,v==y),h=0,v++}}h++,u++}return A5(r,"")},tue=zn,YD=$e,nue=xD,XD=U,O5=De,_u=I,iA=cd,yu=YE,rue=S_,JD=Ii,QD=Mle,Ov=function(t){var r=Ble(t),s=Gle(this),a=arguments.length,c=a>1?arguments[1]:void 0,u=c!==void 0;u&&(c=Fle(c,a>2?arguments[2]:void 0));var h,m,y,v,S,R,P=Kle(r),D=0;if(!P||this===T5&&zle(P))for(h=Hle(r),m=s?new this(h):T5(h);h>D;D++)R=u?c(r[D],D):r[D],b5(m,D,R);else for(S=(v=$le(r,P)).next,m=s?new this:[];!(y=jle(S,v)).done;D++)R=u?Wle(v,c,[y.value,D],!0):y.value,b5(m,D,R);return m.length=D,m},pd=LD,iue=OD.codeAt,sue=function(t){var r,s,a=[],c=Jle(Xle(Qle(t),w5,"."),".");for(r=0;r<c.length;r++)s=c[r],jm(a,Yle(qle,s)?"xn--"+eue(s):s);return A5(a,".")},ep=Da,oue=ld,aue=wl,k5=Rle,N5=ad,cue=N5.set,sA=N5.getterFor("URL"),lue=k5.URLSearchParams,uue=k5.getState,lT=XD.URL,ZD=XD.TypeError,oA=XD.parseInt,due=Math.floor,D5=Math.pow,Eu=_u("".charAt),md=_u(/./.exec),uT=_u([].join),hue=_u(1 .toString),fue=_u([].pop),kv=_u([].push),ex=_u("".replace),pue=_u([].shift),mue=_u("".split),dT=_u("".slice),aA=_u("".toLowerCase),gue=_u([].unshift),tx="Invalid scheme",x_="Invalid host",x5="Invalid port",L5=/[a-z]/i,_ue=/[\d+-.a-z]/i,nx=/\d/,yue=/^0x/i,Eue=/^[0-7]+$/,vue=/^\d+$/,M5=/^[\da-f]+$/i,Sue=/[\0\t\n\r #%/:<>?@[\\\]^|]/,bue=/[\0\t\n\r #/:<>?@[\\\]^|]/,Tue=/^[\u0000-\u0020]+/,wue=/(^|[^\u0000-\u0020])[\u0000-\u0020]+$/,Cue=/[\t\n\r]/g,hT=function(t){var r,s,a,c;if(typeof t=="number"){for(r=[],s=0;s<4;s++)gue(r,t%256),t=due(t/256);return uT(r,".")}if(typeof t=="object"){for(r="",a=function(u){for(var h=null,m=1,y=null,v=0,S=0;S<8;S++)u[S]!==0?(v>m&&(h=y,m=v),y=null,v=0):(y===null&&(y=S),++v);return v>m&&(h=y,m=v),h}(t),s=0;s<8;s++)c&&t[s]===0||(c&&(c=!1),a===s?(r+=s?":":"::",c=!0):(r+=hue(t[s],16),s<7&&(r+=":")));return"["+r+"]"}return t},cA={},U5=QD({},cA,{" ":1,'"':1,"<":1,">":1,"`":1}),V5=QD({},U5,{"#":1,"?":1,"{":1,"}":1}),rx=QD({},V5,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),Bm=function(t,r){var s=iue(t,0);return s>32&&s<127&&!JD(r,t)?t:encodeURIComponent(t)},lA={ftp:21,file:null,http:80,https:443,ws:80,wss:443},fT=function(t,r){var s;return t.length==2&&md(L5,Eu(t,0))&&((s=Eu(t,1))==":"||!r&&s=="|")},F5=function(t){var r;return t.length>1&&fT(dT(t,0,2))&&(t.length==2||(r=Eu(t,2))==="/"||r==="\\"||r==="?"||r==="#")},Rue=function(t){return t==="."||aA(t)==="%2e"},ix={},j5={},sx={},B5={},W5={},ox={},z5={},G5={},uA={},dA={},ax={},cx={},lx={},ux={},H5={},dx={},Nv={},Eh={},$5={},L_={},tp={},hx=function(t,r,s){var a,c,u,h=ep(t);if(r){if(c=this.parse(h))throw ZD(c);this.searchParams=null}else{if(s!==void 0&&(a=new hx(s,!0)),c=this.parse(h,null,a))throw ZD(c);(u=uue(new lue)).bindURL(this),this.searchParams=u}};hx.prototype={type:"URL",parse:function(t,r,s){var a,c,u,h,m,y=this,v=r||ix,S=0,R="",P=!1,D=!1,G=!1;for(t=ep(t),r||(y.scheme="",y.username="",y.password="",y.host=null,y.port=null,y.path=[],y.query=null,y.fragment=null,y.cannotBeABaseURL=!1,t=ex(t,Tue,""),t=ex(t,wue,"$1")),t=ex(t,Cue,""),a=Ov(t);S<=a.length;){switch(c=a[S],v){case ix:if(!c||!md(L5,c)){if(r)return tx;v=sx;continue}R+=aA(c),v=j5;break;case j5:if(c&&(md(_ue,c)||c=="+"||c=="-"||c=="."))R+=aA(c);else{if(c!=":"){if(r)return tx;R="",v=sx,S=0;continue}if(r&&(y.isSpecial()!=JD(lA,R)||R=="file"&&(y.includesCredentials()||y.port!==null)||y.scheme=="file"&&!y.host))return;if(y.scheme=R,r)return void(y.isSpecial()&&lA[y.scheme]==y.port&&(y.port=null));R="",y.scheme=="file"?v=ux:y.isSpecial()&&s&&s.scheme==y.scheme?v=B5:y.isSpecial()?v=G5:a[S+1]=="/"?(v=W5,S++):(y.cannotBeABaseURL=!0,kv(y.path,""),v=$5)}break;case sx:if(!s||s.cannotBeABaseURL&&c!="#")return tx;if(s.cannotBeABaseURL&&c=="#"){y.scheme=s.scheme,y.path=pd(s.path),y.query=s.query,y.fragment="",y.cannotBeABaseURL=!0,v=tp;break}v=s.scheme=="file"?ux:ox;continue;case B5:if(c!="/"||a[S+1]!="/"){v=ox;continue}v=uA,S++;break;case W5:if(c=="/"){v=dA;break}v=Eh;continue;case ox:if(y.scheme=s.scheme,c==gu)y.username=s.username,y.password=s.password,y.host=s.host,y.port=s.port,y.path=pd(s.path),y.query=s.query;else if(c=="/"||c=="\\"&&y.isSpecial())v=z5;else if(c=="?")y.username=s.username,y.password=s.password,y.host=s.host,y.port=s.port,y.path=pd(s.path),y.query="",v=L_;else{if(c!="#"){y.username=s.username,y.password=s.password,y.host=s.host,y.port=s.port,y.path=pd(s.path),y.path.length--,v=Eh;continue}y.username=s.username,y.password=s.password,y.host=s.host,y.port=s.port,y.path=pd(s.path),y.query=s.query,y.fragment="",v=tp}break;case z5:if(!y.isSpecial()||c!="/"&&c!="\\"){if(c!="/"){y.username=s.username,y.password=s.password,y.host=s.host,y.port=s.port,v=Eh;continue}v=dA}else v=uA;break;case G5:if(v=uA,c!="/"||Eu(R,S+1)!="/")continue;S++;break;case uA:if(c!="/"&&c!="\\"){v=dA;continue}break;case dA:if(c=="@"){P&&(R="%40"+R),P=!0,u=Ov(R);for(var F=0;F<u.length;F++){var j=u[F];if(j!=":"||G){var Y=Bm(j,rx);G?y.password+=Y:y.username+=Y}else G=!0}R=""}else if(c==gu||c=="/"||c=="?"||c=="#"||c=="\\"&&y.isSpecial()){if(P&&R=="")return"Invalid authority";S-=Ov(R).length+1,R="",v=ax}else R+=c;break;case ax:case cx:if(r&&y.scheme=="file"){v=dx;continue}if(c!=":"||D){if(c==gu||c=="/"||c=="?"||c=="#"||c=="\\"&&y.isSpecial()){if(y.isSpecial()&&R=="")return x_;if(r&&R==""&&(y.includesCredentials()||y.port!==null))return;if(h=y.parseHost(R))return h;if(R="",v=Nv,r)return;continue}c=="["?D=!0:c=="]"&&(D=!1),R+=c}else{if(R=="")return x_;if(h=y.parseHost(R))return h;if(R="",v=lx,r==cx)return}break;case lx:if(!md(nx,c)){if(c==gu||c=="/"||c=="?"||c=="#"||c=="\\"&&y.isSpecial()||r){if(R!=""){var ee=oA(R,10);if(ee>65535)return x5;y.port=y.isSpecial()&&ee===lA[y.scheme]?null:ee,R=""}if(r)return;v=Nv;continue}return x5}R+=c;break;case ux:if(y.scheme="file",c=="/"||c=="\\")v=H5;else{if(!s||s.scheme!="file"){v=Eh;continue}if(c==gu)y.host=s.host,y.path=pd(s.path),y.query=s.query;else if(c=="?")y.host=s.host,y.path=pd(s.path),y.query="",v=L_;else{if(c!="#"){F5(uT(pd(a,S),""))||(y.host=s.host,y.path=pd(s.path),y.shortenPath()),v=Eh;continue}y.host=s.host,y.path=pd(s.path),y.query=s.query,y.fragment="",v=tp}}break;case H5:if(c=="/"||c=="\\"){v=dx;break}s&&s.scheme=="file"&&!F5(uT(pd(a,S),""))&&(fT(s.path[0],!0)?kv(y.path,s.path[0]):y.host=s.host),v=Eh;continue;case dx:if(c==gu||c=="/"||c=="\\"||c=="?"||c=="#"){if(!r&&fT(R))v=Eh;else if(R==""){if(y.host="",r)return;v=Nv}else{if(h=y.parseHost(R))return h;if(y.host=="localhost"&&(y.host=""),r)return;R="",v=Nv}continue}R+=c;break;case Nv:if(y.isSpecial()){if(v=Eh,c!="/"&&c!="\\")continue}else if(r||c!="?")if(r||c!="#"){if(c!=gu&&(v=Eh,c!="/"))continue}else y.fragment="",v=tp;else y.query="",v=L_;break;case Eh:if(c==gu||c=="/"||c=="\\"&&y.isSpecial()||!r&&(c=="?"||c=="#")){if((m=aA(m=R))===".."||m==="%2e."||m===".%2e"||m==="%2e%2e"?(y.shortenPath(),c=="/"||c=="\\"&&y.isSpecial()||kv(y.path,"")):Rue(R)?c=="/"||c=="\\"&&y.isSpecial()||kv(y.path,""):(y.scheme=="file"&&!y.path.length&&fT(R)&&(y.host&&(y.host=""),R=Eu(R,0)+":"),kv(y.path,R)),R="",y.scheme=="file"&&(c==gu||c=="?"||c=="#"))for(;y.path.length>1&&y.path[0]==="";)pue(y.path);c=="?"?(y.query="",v=L_):c=="#"&&(y.fragment="",v=tp)}else R+=Bm(c,V5);break;case $5:c=="?"?(y.query="",v=L_):c=="#"?(y.fragment="",v=tp):c!=gu&&(y.path[0]+=Bm(c,cA));break;case L_:r||c!="#"?c!=gu&&(c=="'"&&y.isSpecial()?y.query+="%27":y.query+=c=="#"?"%23":Bm(c,cA)):(y.fragment="",v=tp);break;case tp:c!=gu&&(y.fragment+=Bm(c,U5))}S++}},parseHost:function(t){var r,s,a;if(Eu(t,0)=="["){if(Eu(t,t.length-1)!="]"||(r=function(c){var u,h,m,y,v,S,R,P=[0,0,0,0,0,0,0,0],D=0,G=null,F=0,j=function(){return Eu(c,F)};if(j()==":"){if(Eu(c,1)!=":")return;F+=2,G=++D}for(;j();){if(D==8)return;if(j()!=":"){for(u=h=0;h<4&&md(M5,j());)u=16*u+oA(j(),16),F++,h++;if(j()=="."){if(h==0||(F-=h,D>6))return;for(m=0;j();){if(y=null,m>0){if(!(j()=="."&&m<4))return;F++}if(!md(nx,j()))return;for(;md(nx,j());){if(v=oA(j(),10),y===null)y=v;else{if(y==0)return;y=10*y+v}if(y>255)return;F++}P[D]=256*P[D]+y,++m!=2&&m!=4||D++}if(m!=4)return;break}if(j()==":"){if(F++,!j())return}else if(j())return;P[D++]=u}else{if(G!==null)return;F++,G=++D}}if(G!==null)for(S=D-G,D=7;D!=0&&S>0;)R=P[D],P[D--]=P[G+S-1],P[G+--S]=R;else if(D!=8)return;return P}(dT(t,1,-1)),!r))return x_;this.host=r}else if(this.isSpecial()){if(t=sue(t),md(Sue,t)||(r=function(c){var u,h,m,y,v,S,R,P=mue(c,".");if(P.length&&P[P.length-1]==""&&P.length--,(u=P.length)>4)return c;for(h=[],m=0;m<u;m++){if((y=P[m])=="")return c;if(v=10,y.length>1&&Eu(y,0)=="0"&&(v=md(yue,y)?16:8,y=dT(y,v==8?1:2)),y==="")S=0;else{if(!md(v==10?vue:v==8?Eue:M5,y))return c;S=oA(y,v)}kv(h,S)}for(m=0;m<u;m++)if(S=h[m],m==u-1){if(S>=D5(256,5-u))return null}else if(S>255)return null;for(R=fue(h),m=0;m<h.length;m++)R+=h[m]*D5(256,3-m);return R}(t),r===null))return x_;this.host=r}else{if(md(bue,t))return x_;for(r="",s=Ov(t),a=0;a<s.length;a++)r+=Bm(s[a],cA);this.host=r}},cannotHaveUsernamePasswordPort:function(){return!this.host||this.cannotBeABaseURL||this.scheme=="file"},includesCredentials:function(){return this.username!=""||this.password!=""},isSpecial:function(){return JD(lA,this.scheme)},shortenPath:function(){var t=this.path,r=t.length;!r||this.scheme=="file"&&r==1&&fT(t[0],!0)||t.length--},serialize:function(){var t=this,r=t.scheme,s=t.username,a=t.password,c=t.host,u=t.port,h=t.path,m=t.query,y=t.fragment,v=r+":";return c!==null?(v+="//",t.includesCredentials()&&(v+=s+(a?":"+a:"")+"@"),v+=hT(c),u!==null&&(v+=":"+u)):r=="file"&&(v+="//"),v+=t.cannotBeABaseURL?h[0]:h.length?"/"+uT(h,"/"):"",m!==null&&(v+="?"+m),y!==null&&(v+="#"+y),v},setHref:function(t){var r=this.parse(t);if(r)throw ZD(r);this.searchParams.update()},getOrigin:function(){var t=this.scheme,r=this.port;if(t=="blob")try{return new Dv(t.path[0]).origin}catch{return"null"}return t!="file"&&this.isSpecial()?t+"://"+hT(this.host)+(r!==null?":"+r:""):"null"},getProtocol:function(){return this.scheme+":"},setProtocol:function(t){this.parse(ep(t)+":",ix)},getUsername:function(){return this.username},setUsername:function(t){var r=Ov(ep(t));if(!this.cannotHaveUsernamePasswordPort()){this.username="";for(var s=0;s<r.length;s++)this.username+=Bm(r[s],rx)}},getPassword:function(){return this.password},setPassword:function(t){var r=Ov(ep(t));if(!this.cannotHaveUsernamePasswordPort()){this.password="";for(var s=0;s<r.length;s++)this.password+=Bm(r[s],rx)}},getHost:function(){var t=this.host,r=this.port;return t===null?"":r===null?hT(t):hT(t)+":"+r},setHost:function(t){this.cannotBeABaseURL||this.parse(t,ax)},getHostname:function(){var t=this.host;return t===null?"":hT(t)},setHostname:function(t){this.cannotBeABaseURL||this.parse(t,cx)},getPort:function(){var t=this.port;return t===null?"":ep(t)},setPort:function(t){this.cannotHaveUsernamePasswordPort()||((t=ep(t))==""?this.port=null:this.parse(t,lx))},getPathname:function(){var t=this.path;return this.cannotBeABaseURL?t[0]:t.length?"/"+uT(t,"/"):""},setPathname:function(t){this.cannotBeABaseURL||(this.path=[],this.parse(t,Nv))},getSearch:function(){var t=this.query;return t?"?"+t:""},setSearch:function(t){(t=ep(t))==""?this.query=null:(Eu(t,0)=="?"&&(t=dT(t,1)),this.query="",this.parse(t,L_)),this.searchParams.update()},getSearchParams:function(){return this.searchParams.facade},getHash:function(){var t=this.fragment;return t?"#"+t:""},setHash:function(t){(t=ep(t))!=""?(Eu(t,0)=="#"&&(t=dT(t,1)),this.fragment="",this.parse(t,tp)):this.fragment=null},update:function(){this.query=this.searchParams.serialize()||null}};var Dv=function(t){var r=rue(this,yc),s=aue(arguments.length,1)>1?arguments[1]:void 0,a=cue(r,new hx(t,!1,s));YD||(r.href=a.serialize(),r.origin=a.getOrigin(),r.protocol=a.getProtocol(),r.username=a.getUsername(),r.password=a.getPassword(),r.host=a.getHost(),r.hostname=a.getHostname(),r.port=a.getPort(),r.pathname=a.getPathname(),r.search=a.getSearch(),r.searchParams=a.getSearchParams(),r.hash=a.getHash())},yc=Dv.prototype,vu=function(t,r){return{get:function(){return sA(this)[t]()},set:r&&function(s){return sA(this)[r](s)},configurable:!0,enumerable:!0}};if(YD&&(yu(yc,"href",vu("serialize","setHref")),yu(yc,"origin",vu("getOrigin")),yu(yc,"protocol",vu("getProtocol","setProtocol")),yu(yc,"username",vu("getUsername","setUsername")),yu(yc,"password",vu("getPassword","setPassword")),yu(yc,"host",vu("getHost","setHost")),yu(yc,"hostname",vu("getHostname","setHostname")),yu(yc,"port",vu("getPort","setPort")),yu(yc,"pathname",vu("getPathname","setPathname")),yu(yc,"search",vu("getSearch","setSearch")),yu(yc,"searchParams",vu("getSearchParams")),yu(yc,"hash",vu("getHash","setHash"))),iA(yc,"toJSON",function(){return sA(this).serialize()},{enumerable:!0}),iA(yc,"toString",function(){return sA(this).serialize()},{enumerable:!0}),lT){var K5=lT.createObjectURL,q5=lT.revokeObjectURL;K5&&iA(Dv,"createObjectURL",O5(K5,lT)),q5&&iA(Dv,"revokeObjectURL",O5(q5,lT))}oue(Dv,"URL"),tue({global:!0,forced:!nue,sham:!YD},{URL:Dv});var Iue=zn,Aue=d,Pue=wl,Y5=Da,Oue=xD,X5=tn("URL");Iue({target:"URL",stat:!0,forced:!(Oue&&Aue(function(){X5.canParse()}))},{canParse:function(t){var r=Pue(arguments.length,1),s=Y5(t),a=r<2||arguments[1]===void 0?void 0:Y5(arguments[1]);try{return!!new X5(s,a)}catch{return!1}}});var hA=l(gt.URL);let J5=!0,Q5=!0;function fA(t,r,s){const a=t.match(r);return a&&a.length>=s&&parseInt(a[s],10)}function M_(t,r,s){if(!t.RTCPeerConnection)return;const a=t.RTCPeerConnection.prototype,c=a.addEventListener;a.addEventListener=function(h,m){if(h!==r)return c.apply(this,arguments);const y=v=>{const S=s(v);S&&(m.handleEvent?m.handleEvent(S):m(S))};return this._eventMap=this._eventMap||{},this._eventMap[r]||(this._eventMap[r]=new Map),this._eventMap[r].set(m,y),c.apply(this,[h,y])};const u=a.removeEventListener;a.removeEventListener=function(h,m){if(h!==r||!this._eventMap||!this._eventMap[r])return u.apply(this,arguments);if(!this._eventMap[r].has(m))return u.apply(this,arguments);const y=this._eventMap[r].get(m);return this._eventMap[r].delete(m),this._eventMap[r].size===0&&delete this._eventMap[r],Object.keys(this._eventMap).length===0&&delete this._eventMap,u.apply(this,[h,y])},Object.defineProperty(a,"on"+r,{get(){return this["_on"+r]},set(h){this["_on"+r]&&(this.removeEventListener(r,this["_on"+r]),delete this["_on"+r]),h&&this.addEventListener(r,this["_on"+r]=h)},enumerable:!0,configurable:!0})}function kue(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):(J5=t,t?"adapter.js logging disabled":"adapter.js logging enabled")}function Nue(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):(Q5=!t,"adapter.js deprecation warnings "+(t?"disabled":"enabled"))}function Z5(){if(typeof window=="object"){if(J5)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function fx(t,r){Q5&&console.warn(t+" is deprecated, please use "+r+" instead.")}function eB(t){return Object.prototype.toString.call(t)==="[object Object]"}function tB(t){var r;return eB(t)?hc(r=Object.keys(t)).call(r,function(s,a){const c=eB(t[a]),u=c?tB(t[a]):t[a],h=c&&!Object.keys(u).length;return u===void 0||h?s:Object.assign(s,{[a]:u})},{}):t}function px(t,r,s){r&&!s.has(r.id)&&(s.set(r.id,r),Object.keys(r).forEach(a=>{a.endsWith("Id")?px(t,t.get(r[a]),s):a.endsWith("Ids")&&r[a].forEach(c=>{px(t,t.get(c),s)})}))}function nB(t,r,s){const a=s?"outbound-rtp":"inbound-rtp",c=new Map;if(r===null)return c;const u=[];return t.forEach(h=>{h.type==="track"&&h.trackIdentifier===r.id&&u.push(h)}),u.forEach(h=>{t.forEach(m=>{m.type===a&&m.trackId===h.id&&px(t,m,c)})}),c}const rB=Z5;function iB(t,r){const s=t&&t.navigator;if(!s.mediaDevices)return;const a=function(h){if(typeof h!="object"||h.mandatory||h.optional)return h;const m={};return Object.keys(h).forEach(y=>{if(y==="require"||y==="advanced"||y==="mediaSource")return;const v=typeof h[y]=="object"?h[y]:{ideal:h[y]};v.exact!==void 0&&typeof v.exact=="number"&&(v.min=v.max=v.exact);const S=function(R,P){return R?R+P.charAt(0).toUpperCase()+P.slice(1):P==="deviceId"?"sourceId":P};if(v.ideal!==void 0){m.optional=m.optional||[];let R={};typeof v.ideal=="number"?(R[S("min",y)]=v.ideal,m.optional.push(R),R={},R[S("max",y)]=v.ideal,m.optional.push(R)):(R[S("",y)]=v.ideal,m.optional.push(R))}v.exact!==void 0&&typeof v.exact!="number"?(m.mandatory=m.mandatory||{},m.mandatory[S("",y)]=v.exact):["min","max"].forEach(R=>{v[R]!==void 0&&(m.mandatory=m.mandatory||{},m.mandatory[S(R,y)]=v[R])})}),h.advanced&&(m.optional=(m.optional||[]).concat(h.advanced)),m},c=function(h,m){if(r.version>=61)return m(h);if((h=JSON.parse(JSON.stringify(h)))&&typeof h.audio=="object"){const y=function(v,S,R){S in v&&!(R in v)&&(v[R]=v[S],delete v[S])};y((h=JSON.parse(JSON.stringify(h))).audio,"autoGainControl","googAutoGainControl"),y(h.audio,"noiseSuppression","googNoiseSuppression"),h.audio=a(h.audio)}if(h&&typeof h.video=="object"){let y=h.video.facingMode;y=y&&(typeof y=="object"?y:{ideal:y});const v=r.version<66;if(y&&(y.exact==="user"||y.exact==="environment"||y.ideal==="user"||y.ideal==="environment")&&(!s.mediaDevices.getSupportedConstraints||!s.mediaDevices.getSupportedConstraints().facingMode||v)){let S;if(delete h.video.facingMode,y.exact==="environment"||y.ideal==="environment"?S=["back","rear"]:y.exact!=="user"&&y.ideal!=="user"||(S=["front"]),S)return s.mediaDevices.enumerateDevices().then(R=>{let P=(R=R.filter(D=>D.kind==="videoinput")).find(D=>S.some(G=>{var F;return ot(F=D.label.toLowerCase()).call(F,G)}));return!P&&R.length&&ot(S).call(S,"back")&&(P=R[R.length-1]),P&&(h.video.deviceId=y.exact?{exact:P.deviceId}:{ideal:P.deviceId}),h.video=a(h.video),rB("chrome: "+JSON.stringify(h)),m(h)})}h.video=a(h.video)}return rB("chrome: "+JSON.stringify(h)),m(h)},u=function(h){return r.version>=64?h:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[h.name]||h.name,message:h.message,constraint:h.constraint||h.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(s.getUserMedia=(function(h,m,y){c(h,v=>{s.webkitGetUserMedia(v,m,S=>{y&&y(u(S))})})}).bind(s),s.mediaDevices.getUserMedia){const h=s.mediaDevices.getUserMedia.bind(s.mediaDevices);s.mediaDevices.getUserMedia=function(m){return c(m,y=>h(y).then(v=>{if(y.audio&&!v.getAudioTracks().length||y.video&&!v.getVideoTracks().length)throw v.getTracks().forEach(S=>{S.stop()}),new DOMException("","NotFoundError");return v},v=>dt.reject(u(v))))}}}function sB(t){t.MediaStream=t.MediaStream||t.webkitMediaStream}function oB(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("ontrack"in t.RTCPeerConnection.prototype)){Object.defineProperty(t.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(s){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=s)},enumerable:!0,configurable:!0});const r=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=s=>{s.stream.addEventListener("addtrack",a=>{let c;c=t.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(h=>h.track&&h.track.id===a.track.id):{track:a.track};const u=new Event("track");u.track=a.track,u.receiver=c,u.transceiver={receiver:c},u.streams=[s.stream],this.dispatchEvent(u)}),s.stream.getTracks().forEach(a=>{let c;c=t.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(h=>h.track&&h.track.id===a.id):{track:a};const u=new Event("track");u.track=a,u.receiver=c,u.transceiver={receiver:c},u.streams=[s.stream],this.dispatchEvent(u)})},this.addEventListener("addstream",this._ontrackpoly)),r.apply(this,arguments)}}else M_(t,"track",r=>(r.transceiver||Object.defineProperty(r,"transceiver",{value:{receiver:r.receiver}}),r))}function aB(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("getSenders"in t.RTCPeerConnection.prototype)&&"createDTMFSender"in t.RTCPeerConnection.prototype){const r=function(c,u){return{track:u,get dtmf(){return this._dtmf===void 0&&(u.kind==="audio"?this._dtmf=c.createDTMFSender(u):this._dtmf=null),this._dtmf},_pc:c}};if(!t.RTCPeerConnection.prototype.getSenders){t.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const c=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(h,m){let y=c.apply(this,arguments);return y||(y=r(this,h),this._senders.push(y)),y};const u=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(h){u.apply(this,arguments);const m=this._senders.indexOf(h);m!==-1&&this._senders.splice(m,1)}}const s=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(c){this._senders=this._senders||[],s.apply(this,[c]),c.getTracks().forEach(u=>{this._senders.push(r(this,u))})};const a=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(c){this._senders=this._senders||[],a.apply(this,[c]),c.getTracks().forEach(u=>{const h=this._senders.find(m=>m.track===u);h&&this._senders.splice(this._senders.indexOf(h),1)})}}else if(typeof t=="object"&&t.RTCPeerConnection&&"getSenders"in t.RTCPeerConnection.prototype&&"createDTMFSender"in t.RTCPeerConnection.prototype&&t.RTCRtpSender&&!("dtmf"in t.RTCRtpSender.prototype)){const r=t.RTCPeerConnection.prototype.getSenders;t.RTCPeerConnection.prototype.getSenders=function(){const s=r.apply(this,[]);return s.forEach(a=>a._pc=this),s},Object.defineProperty(t.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function cB(t){if(!t.RTCPeerConnection)return;const r=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){const[s,a,c]=arguments;if(arguments.length>0&&typeof s=="function")return r.apply(this,arguments);if(r.length===0&&(arguments.length===0||typeof s!="function"))return r.apply(this,[]);const u=function(m){const y={};return m.result().forEach(v=>{const S={id:v.id,timestamp:v.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[v.type]||v.type};v.names().forEach(R=>{S[R]=v.stat(R)}),y[S.id]=S}),y},h=function(m){return new Map(Object.keys(m).map(y=>[y,m[y]]))};if(arguments.length>=2){const m=function(y){a(h(u(y)))};return r.apply(this,[m,s])}return new dt((m,y)=>{r.apply(this,[function(v){m(h(u(v)))},y])}).then(a,c)}}function lB(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender&&t.RTCRtpReceiver))return;if(!("getStats"in t.RTCRtpSender.prototype)){const s=t.RTCPeerConnection.prototype.getSenders;s&&(t.RTCPeerConnection.prototype.getSenders=function(){const c=s.apply(this,[]);return c.forEach(u=>u._pc=this),c});const a=t.RTCPeerConnection.prototype.addTrack;a&&(t.RTCPeerConnection.prototype.addTrack=function(){const c=a.apply(this,arguments);return c._pc=this,c}),t.RTCRtpSender.prototype.getStats=function(){const c=this;return this._pc.getStats().then(u=>nB(u,c.track,!0))}}if(!("getStats"in t.RTCRtpReceiver.prototype)){const s=t.RTCPeerConnection.prototype.getReceivers;s&&(t.RTCPeerConnection.prototype.getReceivers=function(){const a=s.apply(this,[]);return a.forEach(c=>c._pc=this),a}),M_(t,"track",a=>(a.receiver._pc=a.srcElement,a)),t.RTCRtpReceiver.prototype.getStats=function(){const a=this;return this._pc.getStats().then(c=>nB(c,a.track,!1))}}if(!("getStats"in t.RTCRtpSender.prototype)||!("getStats"in t.RTCRtpReceiver.prototype))return;const r=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof t.MediaStreamTrack){const s=arguments[0];let a,c,u;return this.getSenders().forEach(h=>{h.track===s&&(a?u=!0:a=h)}),this.getReceivers().forEach(h=>(h.track===s&&(c?u=!0:c=h),h.track===s)),u||a&&c?dt.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):a?a.getStats():c?c.getStats():dt.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return r.apply(this,arguments)}}function uB(t){t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(u=>this._shimmedLocalStreams[u][0])};const r=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(u,h){if(!h)return r.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const m=r.apply(this,arguments);return this._shimmedLocalStreams[h.id]?this._shimmedLocalStreams[h.id].indexOf(m)===-1&&this._shimmedLocalStreams[h.id].push(m):this._shimmedLocalStreams[h.id]=[h,m],m};const s=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(u){this._shimmedLocalStreams=this._shimmedLocalStreams||{},u.getTracks().forEach(y=>{if(this.getSenders().find(S=>S.track===y))throw new DOMException("Track already exists.","InvalidAccessError")});const h=this.getSenders();s.apply(this,arguments);const m=this.getSenders().filter(y=>h.indexOf(y)===-1);this._shimmedLocalStreams[u.id]=[u].concat(m)};const a=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(u){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[u.id],a.apply(this,arguments)};const c=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(u){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},u&&Object.keys(this._shimmedLocalStreams).forEach(h=>{const m=this._shimmedLocalStreams[h].indexOf(u);m!==-1&&this._shimmedLocalStreams[h].splice(m,1),this._shimmedLocalStreams[h].length===1&&delete this._shimmedLocalStreams[h]}),c.apply(this,arguments)}}function dB(t,r){if(!t.RTCPeerConnection)return;if(t.RTCPeerConnection.prototype.addTrack&&r.version>=65)return uB(t);const s=t.RTCPeerConnection.prototype.getLocalStreams;t.RTCPeerConnection.prototype.getLocalStreams=function(){const y=s.apply(this);return this._reverseStreams=this._reverseStreams||{},y.map(v=>this._reverseStreams[v.id])};const a=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(y){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},y.getTracks().forEach(v=>{if(this.getSenders().find(R=>R.track===v))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[y.id]){const v=new t.MediaStream(y.getTracks());this._streams[y.id]=v,this._reverseStreams[v.id]=y,y=v}a.apply(this,[y])};const c=t.RTCPeerConnection.prototype.removeStream;function u(y,v){let S=v.sdp;return Object.keys(y._reverseStreams||[]).forEach(R=>{const P=y._reverseStreams[R],D=y._streams[P.id];S=S.replace(new RegExp(D.id,"g"),P.id)}),new RTCSessionDescription({type:v.type,sdp:S})}t.RTCPeerConnection.prototype.removeStream=function(y){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},c.apply(this,[this._streams[y.id]||y]),delete this._reverseStreams[this._streams[y.id]?this._streams[y.id].id:y.id],delete this._streams[y.id]},t.RTCPeerConnection.prototype.addTrack=function(y,v){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const S=[].slice.call(arguments,1);if(S.length!==1||!S[0].getTracks().find(D=>D===y))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(D=>D.track===y))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const P=this._streams[v.id];if(P)P.addTrack(y),dt.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const D=new t.MediaStream([y]);this._streams[v.id]=D,this._reverseStreams[D.id]=v,this.addStream(D)}return this.getSenders().find(D=>D.track===y)},["createOffer","createAnswer"].forEach(function(y){const v=t.RTCPeerConnection.prototype[y],S={[y](){const R=arguments;return arguments.length&&typeof arguments[0]=="function"?v.apply(this,[P=>{const D=u(this,P);R[0].apply(null,[D])},P=>{R[1]&&R[1].apply(null,P)},arguments[2]]):v.apply(this,arguments).then(P=>u(this,P))}};t.RTCPeerConnection.prototype[y]=S[y]});const h=t.RTCPeerConnection.prototype.setLocalDescription;t.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=function(y,v){let S=v.sdp;return Object.keys(y._reverseStreams||[]).forEach(R=>{const P=y._reverseStreams[R],D=y._streams[P.id];S=S.replace(new RegExp(P.id,"g"),D.id)}),new RTCSessionDescription({type:v.type,sdp:S})}(this,arguments[0]),h.apply(this,arguments)):h.apply(this,arguments)};const m=Object.getOwnPropertyDescriptor(t.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(t.RTCPeerConnection.prototype,"localDescription",{get(){const y=m.get.apply(this);return y.type===""?y:u(this,y)}}),t.RTCPeerConnection.prototype.removeTrack=function(y){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!y._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(y._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let v;this._streams=this._streams||{},Object.keys(this._streams).forEach(S=>{this._streams[S].getTracks().find(R=>y.track===R)&&(v=this._streams[S])}),v&&(v.getTracks().length===1?this.removeStream(this._reverseStreams[v.id]):v.removeTrack(y.track),this.dispatchEvent(new Event("negotiationneeded")))}}function mx(t,r){!t.RTCPeerConnection&&t.webkitRTCPeerConnection&&(t.RTCPeerConnection=t.webkitRTCPeerConnection),t.RTCPeerConnection&&r.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(s){const a=t.RTCPeerConnection.prototype[s],c={[s](){return arguments[0]=new(s==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),a.apply(this,arguments)}};t.RTCPeerConnection.prototype[s]=c[s]})}function hB(t,r){M_(t,"negotiationneeded",s=>{const a=s.target;if(!(r.version<72||a.getConfiguration&&a.getConfiguration().sdpSemantics==="plan-b")||a.signalingState==="stable")return s})}var fB=Object.freeze({__proto__:null,fixNegotiationNeeded:hB,shimAddTrackRemoveTrack:dB,shimAddTrackRemoveTrackWithNative:uB,shimGetDisplayMedia:function(t,r){t.navigator.mediaDevices&&"getDisplayMedia"in t.navigator.mediaDevices||t.navigator.mediaDevices&&(typeof r=="function"?t.navigator.mediaDevices.getDisplayMedia=function(s){return r(s).then(a=>{const c=s.video&&s.video.width,u=s.video&&s.video.height,h=s.video&&s.video.frameRate;return s.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:a,maxFrameRate:h||3}},c&&(s.video.mandatory.maxWidth=c),u&&(s.video.mandatory.maxHeight=u),t.navigator.mediaDevices.getUserMedia(s)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))},shimGetSendersWithDtmf:aB,shimGetStats:cB,shimGetUserMedia:iB,shimMediaStream:sB,shimOnTrack:oB,shimPeerConnection:mx,shimSenderReceiverGetStats:lB});function pB(t,r){const s=t&&t.navigator,a=t&&t.MediaStreamTrack;if(s.getUserMedia=function(c,u,h){fx("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),s.mediaDevices.getUserMedia(c).then(u,h)},!(r.version>55&&"autoGainControl"in s.mediaDevices.getSupportedConstraints())){const c=function(h,m,y){m in h&&!(y in h)&&(h[y]=h[m],delete h[m])},u=s.mediaDevices.getUserMedia.bind(s.mediaDevices);if(s.mediaDevices.getUserMedia=function(h){return typeof h=="object"&&typeof h.audio=="object"&&(h=JSON.parse(JSON.stringify(h)),c(h.audio,"autoGainControl","mozAutoGainControl"),c(h.audio,"noiseSuppression","mozNoiseSuppression")),u(h)},a&&a.prototype.getSettings){const h=a.prototype.getSettings;a.prototype.getSettings=function(){const m=h.apply(this,arguments);return c(m,"mozAutoGainControl","autoGainControl"),c(m,"mozNoiseSuppression","noiseSuppression"),m}}if(a&&a.prototype.applyConstraints){const h=a.prototype.applyConstraints;a.prototype.applyConstraints=function(m){return this.kind==="audio"&&typeof m=="object"&&(m=JSON.parse(JSON.stringify(m)),c(m,"autoGainControl","mozAutoGainControl"),c(m,"noiseSuppression","mozNoiseSuppression")),h.apply(this,[m])}}}}function mB(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function gx(t,r){if(typeof t!="object"||!t.RTCPeerConnection&&!t.mozRTCPeerConnection)return;!t.RTCPeerConnection&&t.mozRTCPeerConnection&&(t.RTCPeerConnection=t.mozRTCPeerConnection),r.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(c){const u=t.RTCPeerConnection.prototype[c],h={[c](){return arguments[0]=new(c==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),u.apply(this,arguments)}};t.RTCPeerConnection.prototype[c]=h[c]});const s={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},a=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){const[c,u,h]=arguments;return a.apply(this,[c||null]).then(m=>{if(r.version<53&&!u)try{m.forEach(y=>{y.type=s[y.type]||y.type})}catch(y){if(y.name!=="TypeError")throw y;m.forEach((v,S)=>{m.set(S,Object.assign({},v,{type:s[v.type]||v.type}))})}return m}).then(u,h)}}function gB(t){if(typeof t!="object"||!t.RTCPeerConnection||!t.RTCRtpSender||t.RTCRtpSender&&"getStats"in t.RTCRtpSender.prototype)return;const r=t.RTCPeerConnection.prototype.getSenders;r&&(t.RTCPeerConnection.prototype.getSenders=function(){const a=r.apply(this,[]);return a.forEach(c=>c._pc=this),a});const s=t.RTCPeerConnection.prototype.addTrack;s&&(t.RTCPeerConnection.prototype.addTrack=function(){const a=s.apply(this,arguments);return a._pc=this,a}),t.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):dt.resolve(new Map)}}function _B(t){if(typeof t!="object"||!t.RTCPeerConnection||!t.RTCRtpSender||t.RTCRtpSender&&"getStats"in t.RTCRtpReceiver.prototype)return;const r=t.RTCPeerConnection.prototype.getReceivers;r&&(t.RTCPeerConnection.prototype.getReceivers=function(){const s=r.apply(this,[]);return s.forEach(a=>a._pc=this),s}),M_(t,"track",s=>(s.receiver._pc=s.srcElement,s)),t.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function yB(t){t.RTCPeerConnection&&!("removeStream"in t.RTCPeerConnection.prototype)&&(t.RTCPeerConnection.prototype.removeStream=function(r){fx("removeStream","removeTrack"),this.getSenders().forEach(s=>{var a;s.track&&ot(a=r.getTracks()).call(a,s.track)&&this.removeTrack(s)})})}function EB(t){t.DataChannel&&!t.RTCDataChannel&&(t.RTCDataChannel=t.DataChannel)}function vB(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const r=t.RTCPeerConnection.prototype.addTransceiver;r&&(t.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let s=arguments[1]&&arguments[1].sendEncodings;s===void 0&&(s=[]),s=[...s];const a=s.length>0;a&&s.forEach(u=>{if("rid"in u&&!/^[a-z0-9]{0,16}$/i.test(u.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in u&&!(parseFloat(u.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in u&&!(parseFloat(u.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const c=r.apply(this,arguments);if(a){const{sender:u}=c,h=u.getParameters();(!("encodings"in h)||h.encodings.length===1&&Object.keys(h.encodings[0]).length===0)&&(h.encodings=s,u.sendEncodings=s,this.setParametersPromises.push(u.setParameters(h).then(()=>{delete u.sendEncodings}).catch(()=>{delete u.sendEncodings})))}return c})}function SB(t){if(typeof t!="object"||!t.RTCRtpSender)return;const r=t.RTCRtpSender.prototype.getParameters;r&&(t.RTCRtpSender.prototype.getParameters=function(){const s=r.apply(this,arguments);return"encodings"in s||(s.encodings=[].concat(this.sendEncodings||[{}])),s})}function bB(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const r=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?dt.all(this.setParametersPromises).then(()=>r.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):r.apply(this,arguments)}}function TB(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const r=t.RTCPeerConnection.prototype.createAnswer;t.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?dt.all(this.setParametersPromises).then(()=>r.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):r.apply(this,arguments)}}var wB=Object.freeze({__proto__:null,shimAddTransceiver:vB,shimCreateAnswer:TB,shimCreateOffer:bB,shimGetDisplayMedia:function(t,r){t.navigator.mediaDevices&&"getDisplayMedia"in t.navigator.mediaDevices||t.navigator.mediaDevices&&(t.navigator.mediaDevices.getDisplayMedia=function(s){if(!s||!s.video){const a=new DOMException("getDisplayMedia without video constraints is undefined");return a.name="NotFoundError",a.code=8,dt.reject(a)}return s.video===!0?s.video={mediaSource:r}:s.video.mediaSource=r,t.navigator.mediaDevices.getUserMedia(s)})},shimGetParameters:SB,shimGetUserMedia:pB,shimOnTrack:mB,shimPeerConnection:gx,shimRTCDataChannel:EB,shimReceiverGetStats:_B,shimRemoveStream:yB,shimSenderGetStats:gB});function CB(t){if(typeof t=="object"&&t.RTCPeerConnection){if("getLocalStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in t.RTCPeerConnection.prototype)){const r=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addStream=function(s){var a;this._localStreams||(this._localStreams=[]),ot(a=this._localStreams).call(a,s)||this._localStreams.push(s),s.getAudioTracks().forEach(c=>r.call(this,c,s)),s.getVideoTracks().forEach(c=>r.call(this,c,s))},t.RTCPeerConnection.prototype.addTrack=function(s){for(var a=arguments.length,c=new Array(a>1?a-1:0),u=1;u<a;u++)c[u-1]=arguments[u];return c&&c.forEach(h=>{var m;this._localStreams?ot(m=this._localStreams).call(m,h)||this._localStreams.push(h):this._localStreams=[h]}),r.apply(this,arguments)}}"removeStream"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.removeStream=function(r){this._localStreams||(this._localStreams=[]);const s=this._localStreams.indexOf(r);if(s===-1)return;this._localStreams.splice(s,1);const a=r.getTracks();this.getSenders().forEach(c=>{ot(a).call(a,c.track)&&this.removeTrack(c)})})}}function RB(t){if(typeof t=="object"&&t.RTCPeerConnection&&("getRemoteStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in t.RTCPeerConnection.prototype))){Object.defineProperty(t.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(s){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=s),this.addEventListener("track",this._onaddstreampoly=a=>{a.streams.forEach(c=>{var u;if(this._remoteStreams||(this._remoteStreams=[]),ot(u=this._remoteStreams).call(u,c))return;this._remoteStreams.push(c);const h=new Event("addstream");h.stream=c,this.dispatchEvent(h)})})}});const r=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){const s=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(a){a.streams.forEach(c=>{if(s._remoteStreams||(s._remoteStreams=[]),s._remoteStreams.indexOf(c)>=0)return;s._remoteStreams.push(c);const u=new Event("addstream");u.stream=c,s.dispatchEvent(u)})}),r.apply(s,arguments)}}}function IB(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const r=t.RTCPeerConnection.prototype,s=r.createOffer,a=r.createAnswer,c=r.setLocalDescription,u=r.setRemoteDescription,h=r.addIceCandidate;r.createOffer=function(y,v){const S=arguments.length>=2?arguments[2]:arguments[0],R=s.apply(this,[S]);return v?(R.then(y,v),dt.resolve()):R},r.createAnswer=function(y,v){const S=arguments.length>=2?arguments[2]:arguments[0],R=a.apply(this,[S]);return v?(R.then(y,v),dt.resolve()):R};let m=function(y,v,S){const R=c.apply(this,[y]);return S?(R.then(v,S),dt.resolve()):R};r.setLocalDescription=m,m=function(y,v,S){const R=u.apply(this,[y]);return S?(R.then(v,S),dt.resolve()):R},r.setRemoteDescription=m,m=function(y,v,S){const R=h.apply(this,[y]);return S?(R.then(v,S),dt.resolve()):R},r.addIceCandidate=m}function AB(t){const r=t&&t.navigator;if(r.mediaDevices&&r.mediaDevices.getUserMedia){const s=r.mediaDevices,a=s.getUserMedia.bind(s);r.mediaDevices.getUserMedia=c=>a(PB(c))}!r.getUserMedia&&r.mediaDevices&&r.mediaDevices.getUserMedia&&(r.getUserMedia=(function(s,a,c){r.mediaDevices.getUserMedia(s).then(a,c)}).bind(r))}function PB(t){return t&&t.video!==void 0?Object.assign({},t,{video:tB(t.video)}):t}function OB(t){if(!t.RTCPeerConnection)return;const r=t.RTCPeerConnection;t.RTCPeerConnection=function(s,a){if(s&&s.iceServers){const c=[];for(let u=0;u<s.iceServers.length;u++){let h=s.iceServers[u];!h.hasOwnProperty("urls")&&h.hasOwnProperty("url")?(fx("RTCIceServer.url","RTCIceServer.urls"),h=JSON.parse(JSON.stringify(h)),h.urls=h.url,delete h.url,c.push(h)):c.push(s.iceServers[u])}s.iceServers=c}return new r(s,a)},t.RTCPeerConnection.prototype=r.prototype,"generateCertificate"in r&&Object.defineProperty(t.RTCPeerConnection,"generateCertificate",{get:()=>r.generateCertificate})}function kB(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function NB(t){const r=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(s){if(s){s.offerToReceiveAudio!==void 0&&(s.offerToReceiveAudio=!!s.offerToReceiveAudio);const a=this.getTransceivers().find(u=>u.receiver.track.kind==="audio");s.offerToReceiveAudio===!1&&a?a.direction==="sendrecv"?a.setDirection?a.setDirection("sendonly"):a.direction="sendonly":a.direction==="recvonly"&&(a.setDirection?a.setDirection("inactive"):a.direction="inactive"):s.offerToReceiveAudio!==!0||a||this.addTransceiver("audio",{direction:"recvonly"}),s.offerToReceiveVideo!==void 0&&(s.offerToReceiveVideo=!!s.offerToReceiveVideo);const c=this.getTransceivers().find(u=>u.receiver.track.kind==="video");s.offerToReceiveVideo===!1&&c?c.direction==="sendrecv"?c.setDirection?c.setDirection("sendonly"):c.direction="sendonly":c.direction==="recvonly"&&(c.setDirection?c.setDirection("inactive"):c.direction="inactive"):s.offerToReceiveVideo!==!0||c||this.addTransceiver("video",{direction:"recvonly"})}return r.apply(this,arguments)}}function DB(t){typeof t!="object"||t.AudioContext||(t.AudioContext=t.webkitAudioContext)}var xB=Object.freeze({__proto__:null,shimAudioContext:DB,shimCallbacksAPI:IB,shimConstraints:PB,shimCreateOfferLegacy:NB,shimGetUserMedia:AB,shimLocalStreamsAPI:CB,shimRTCIceServerUrls:OB,shimRemoteStreamsAPI:RB,shimTrackEventTransceiver:kB}),LB=`	
\v\f\r \u2028\u2029\uFEFF`,Due=Xt,xue=Da,_x=LB,MB=I("".replace),Lue=RegExp("^["+_x+"]+"),Mue=RegExp("(^|[^"+_x+"])["+_x+"]+$"),Uue=function(t){return function(r){var s=xue(Due(r));return 1&t&&(s=MB(s,Lue,"")),2&t&&(s=MB(s,Mue,"$1")),s}},Vue={trim:Uue(3)},Fue=vI.PROPER,jue=d,UB=LB,Bue=Vue.trim;zn({target:"String",proto:!0,forced:function(t){return jue(function(){return!!UB[t]()||""[t]()!==""||Fue&&UB[t].name!==t})}("trim")},{trim:function(){return Bue(this)}});var Wue=dc("String").trim,zue=O,Gue=Wue,yx=String.prototype,Hue=function(t){var r=t.trim;return typeof t=="string"||t===yx||zue(yx,t)&&r===yx.trim?Gue:r},_o=l(Hue),VB={exports:{}};(function(t){const r={generateIdentifier:function(){return Math.random().toString(36).substring(2,12)}};r.localCName=r.generateIdentifier(),r.splitLines=function(s){return s.trim().split(`
`).map(a=>a.trim())},r.splitSections=function(s){return s.split(`
m=`).map((a,c)=>(c>0?"m="+a:a).trim()+`\r
`)},r.getDescription=function(s){const a=r.splitSections(s);return a&&a[0]},r.getMediaSections=function(s){const a=r.splitSections(s);return a.shift(),a},r.matchPrefix=function(s,a){return r.splitLines(s).filter(c=>c.indexOf(a)===0)},r.parseCandidate=function(s){let a;a=s.indexOf("a=candidate:")===0?s.substring(12).split(" "):s.substring(10).split(" ");const c={foundation:a[0],component:{1:"rtp",2:"rtcp"}[a[1]]||a[1],protocol:a[2].toLowerCase(),priority:parseInt(a[3],10),ip:a[4],address:a[4],port:parseInt(a[5],10),type:a[7]};for(let u=8;u<a.length;u+=2)switch(a[u]){case"raddr":c.relatedAddress=a[u+1];break;case"rport":c.relatedPort=parseInt(a[u+1],10);break;case"tcptype":c.tcpType=a[u+1];break;case"ufrag":c.ufrag=a[u+1],c.usernameFragment=a[u+1];break;default:c[a[u]]===void 0&&(c[a[u]]=a[u+1])}return c},r.writeCandidate=function(s){const a=[];a.push(s.foundation);const c=s.component;c==="rtp"?a.push(1):c==="rtcp"?a.push(2):a.push(c),a.push(s.protocol.toUpperCase()),a.push(s.priority),a.push(s.address||s.ip),a.push(s.port);const u=s.type;return a.push("typ"),a.push(u),u!=="host"&&s.relatedAddress&&s.relatedPort&&(a.push("raddr"),a.push(s.relatedAddress),a.push("rport"),a.push(s.relatedPort)),s.tcpType&&s.protocol.toLowerCase()==="tcp"&&(a.push("tcptype"),a.push(s.tcpType)),(s.usernameFragment||s.ufrag)&&(a.push("ufrag"),a.push(s.usernameFragment||s.ufrag)),"candidate:"+a.join(" ")},r.parseIceOptions=function(s){return s.substring(14).split(" ")},r.parseRtpMap=function(s){let a=s.substring(9).split(" ");const c={payloadType:parseInt(a.shift(),10)};return a=a[0].split("/"),c.name=a[0],c.clockRate=parseInt(a[1],10),c.channels=a.length===3?parseInt(a[2],10):1,c.numChannels=c.channels,c},r.writeRtpMap=function(s){let a=s.payloadType;s.preferredPayloadType!==void 0&&(a=s.preferredPayloadType);const c=s.channels||s.numChannels||1;return"a=rtpmap:"+a+" "+s.name+"/"+s.clockRate+(c!==1?"/"+c:"")+`\r
`},r.parseExtmap=function(s){const a=s.substring(9).split(" ");return{id:parseInt(a[0],10),direction:a[0].indexOf("/")>0?a[0].split("/")[1]:"sendrecv",uri:a[1],attributes:a.slice(2).join(" ")}},r.writeExtmap=function(s){return"a=extmap:"+(s.id||s.preferredId)+(s.direction&&s.direction!=="sendrecv"?"/"+s.direction:"")+" "+s.uri+(s.attributes?" "+s.attributes:"")+`\r
`},r.parseFmtp=function(s){const a={};let c;const u=s.substring(s.indexOf(" ")+1).split(";");for(let h=0;h<u.length;h++)c=u[h].trim().split("="),a[c[0].trim()]=c[1];return a},r.writeFmtp=function(s){let a="",c=s.payloadType;if(s.preferredPayloadType!==void 0&&(c=s.preferredPayloadType),s.parameters&&Object.keys(s.parameters).length){const u=[];Object.keys(s.parameters).forEach(h=>{s.parameters[h]!==void 0?u.push(h+"="+s.parameters[h]):u.push(h)}),a+="a=fmtp:"+c+" "+u.join(";")+`\r
`}return a},r.parseRtcpFb=function(s){const a=s.substring(s.indexOf(" ")+1).split(" ");return{type:a.shift(),parameter:a.join(" ")}},r.writeRtcpFb=function(s){let a="",c=s.payloadType;return s.preferredPayloadType!==void 0&&(c=s.preferredPayloadType),s.rtcpFeedback&&s.rtcpFeedback.length&&s.rtcpFeedback.forEach(u=>{a+="a=rtcp-fb:"+c+" "+u.type+(u.parameter&&u.parameter.length?" "+u.parameter:"")+`\r
`}),a},r.parseSsrcMedia=function(s){const a=s.indexOf(" "),c={ssrc:parseInt(s.substring(7,a),10)},u=s.indexOf(":",a);return u>-1?(c.attribute=s.substring(a+1,u),c.value=s.substring(u+1)):c.attribute=s.substring(a+1),c},r.parseSsrcGroup=function(s){const a=s.substring(13).split(" ");return{semantics:a.shift(),ssrcs:a.map(c=>parseInt(c,10))}},r.getMid=function(s){const a=r.matchPrefix(s,"a=mid:")[0];if(a)return a.substring(6)},r.parseFingerprint=function(s){const a=s.substring(14).split(" ");return{algorithm:a[0].toLowerCase(),value:a[1].toUpperCase()}},r.getDtlsParameters=function(s,a){return{role:"auto",fingerprints:r.matchPrefix(s+a,"a=fingerprint:").map(r.parseFingerprint)}},r.writeDtlsParameters=function(s,a){let c="a=setup:"+a+`\r
`;return s.fingerprints.forEach(u=>{c+="a=fingerprint:"+u.algorithm+" "+u.value+`\r
`}),c},r.parseCryptoLine=function(s){const a=s.substring(9).split(" ");return{tag:parseInt(a[0],10),cryptoSuite:a[1],keyParams:a[2],sessionParams:a.slice(3)}},r.writeCryptoLine=function(s){return"a=crypto:"+s.tag+" "+s.cryptoSuite+" "+(typeof s.keyParams=="object"?r.writeCryptoKeyParams(s.keyParams):s.keyParams)+(s.sessionParams?" "+s.sessionParams.join(" "):"")+`\r
`},r.parseCryptoKeyParams=function(s){if(s.indexOf("inline:")!==0)return null;const a=s.substring(7).split("|");return{keyMethod:"inline",keySalt:a[0],lifeTime:a[1],mkiValue:a[2]?a[2].split(":")[0]:void 0,mkiLength:a[2]?a[2].split(":")[1]:void 0}},r.writeCryptoKeyParams=function(s){return s.keyMethod+":"+s.keySalt+(s.lifeTime?"|"+s.lifeTime:"")+(s.mkiValue&&s.mkiLength?"|"+s.mkiValue+":"+s.mkiLength:"")},r.getCryptoParameters=function(s,a){return r.matchPrefix(s+a,"a=crypto:").map(r.parseCryptoLine)},r.getIceParameters=function(s,a){const c=r.matchPrefix(s+a,"a=ice-ufrag:")[0],u=r.matchPrefix(s+a,"a=ice-pwd:")[0];return c&&u?{usernameFragment:c.substring(12),password:u.substring(10)}:null},r.writeIceParameters=function(s){let a="a=ice-ufrag:"+s.usernameFragment+`\r
a=ice-pwd:`+s.password+`\r
`;return s.iceLite&&(a+=`a=ice-lite\r
`),a},r.parseRtpParameters=function(s){const a={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},c=r.splitLines(s)[0].split(" ");a.profile=c[2];for(let h=3;h<c.length;h++){const m=c[h],y=r.matchPrefix(s,"a=rtpmap:"+m+" ")[0];if(y){const v=r.parseRtpMap(y),S=r.matchPrefix(s,"a=fmtp:"+m+" ");switch(v.parameters=S.length?r.parseFmtp(S[0]):{},v.rtcpFeedback=r.matchPrefix(s,"a=rtcp-fb:"+m+" ").map(r.parseRtcpFb),a.codecs.push(v),v.name.toUpperCase()){case"RED":case"ULPFEC":a.fecMechanisms.push(v.name.toUpperCase())}}}r.matchPrefix(s,"a=extmap:").forEach(h=>{a.headerExtensions.push(r.parseExtmap(h))});const u=r.matchPrefix(s,"a=rtcp-fb:* ").map(r.parseRtcpFb);return a.codecs.forEach(h=>{u.forEach(m=>{h.rtcpFeedback.find(y=>y.type===m.type&&y.parameter===m.parameter)||h.rtcpFeedback.push(m)})}),a},r.writeRtpDescription=function(s,a){let c="";c+="m="+s+" ",c+=a.codecs.length>0?"9":"0",c+=" "+(a.profile||"UDP/TLS/RTP/SAVPF")+" ",c+=a.codecs.map(h=>h.preferredPayloadType!==void 0?h.preferredPayloadType:h.payloadType).join(" ")+`\r
`,c+=`c=IN IP4 0.0.0.0\r
`,c+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,a.codecs.forEach(h=>{c+=r.writeRtpMap(h),c+=r.writeFmtp(h),c+=r.writeRtcpFb(h)});let u=0;return a.codecs.forEach(h=>{h.maxptime>u&&(u=h.maxptime)}),u>0&&(c+="a=maxptime:"+u+`\r
`),a.headerExtensions&&a.headerExtensions.forEach(h=>{c+=r.writeExtmap(h)}),c},r.parseRtpEncodingParameters=function(s){const a=[],c=r.parseRtpParameters(s),u=c.fecMechanisms.indexOf("RED")!==-1,h=c.fecMechanisms.indexOf("ULPFEC")!==-1,m=r.matchPrefix(s,"a=ssrc:").map(P=>r.parseSsrcMedia(P)).filter(P=>P.attribute==="cname"),y=m.length>0&&m[0].ssrc;let v;const S=r.matchPrefix(s,"a=ssrc-group:FID").map(P=>P.substring(17).split(" ").map(D=>parseInt(D,10)));S.length>0&&S[0].length>1&&S[0][0]===y&&(v=S[0][1]),c.codecs.forEach(P=>{if(P.name.toUpperCase()==="RTX"&&P.parameters.apt){let D={ssrc:y,codecPayloadType:parseInt(P.parameters.apt,10)};y&&v&&(D.rtx={ssrc:v}),a.push(D),u&&(D=JSON.parse(JSON.stringify(D)),D.fec={ssrc:y,mechanism:h?"red+ulpfec":"red"},a.push(D))}}),a.length===0&&y&&a.push({ssrc:y});let R=r.matchPrefix(s,"b=");return R.length&&(R=R[0].indexOf("b=TIAS:")===0?parseInt(R[0].substring(7),10):R[0].indexOf("b=AS:")===0?1e3*parseInt(R[0].substring(5),10)*.95-16e3:void 0,a.forEach(P=>{P.maxBitrate=R})),a},r.parseRtcpParameters=function(s){const a={},c=r.matchPrefix(s,"a=ssrc:").map(m=>r.parseSsrcMedia(m)).filter(m=>m.attribute==="cname")[0];c&&(a.cname=c.value,a.ssrc=c.ssrc);const u=r.matchPrefix(s,"a=rtcp-rsize");a.reducedSize=u.length>0,a.compound=u.length===0;const h=r.matchPrefix(s,"a=rtcp-mux");return a.mux=h.length>0,a},r.writeRtcpParameters=function(s){let a="";return s.reducedSize&&(a+=`a=rtcp-rsize\r
`),s.mux&&(a+=`a=rtcp-mux\r
`),s.ssrc!==void 0&&s.cname&&(a+="a=ssrc:"+s.ssrc+" cname:"+s.cname+`\r
`),a},r.parseMsid=function(s){let a;const c=r.matchPrefix(s,"a=msid:");if(c.length===1)return a=c[0].substring(7).split(" "),{stream:a[0],track:a[1]};const u=r.matchPrefix(s,"a=ssrc:").map(h=>r.parseSsrcMedia(h)).filter(h=>h.attribute==="msid");return u.length>0?(a=u[0].value.split(" "),{stream:a[0],track:a[1]}):void 0},r.parseSctpDescription=function(s){const a=r.parseMLine(s),c=r.matchPrefix(s,"a=max-message-size:");let u;c.length>0&&(u=parseInt(c[0].substring(19),10)),isNaN(u)&&(u=65536);const h=r.matchPrefix(s,"a=sctp-port:");if(h.length>0)return{port:parseInt(h[0].substring(12),10),protocol:a.fmt,maxMessageSize:u};const m=r.matchPrefix(s,"a=sctpmap:");if(m.length>0){const y=m[0].substring(10).split(" ");return{port:parseInt(y[0],10),protocol:y[1],maxMessageSize:u}}},r.writeSctpDescription=function(s,a){let c=[];return c=s.protocol!=="DTLS/SCTP"?["m="+s.kind+" 9 "+s.protocol+" "+a.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+a.port+`\r
`]:["m="+s.kind+" 9 "+s.protocol+" "+a.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+a.port+" "+a.protocol+` 65535\r
`],a.maxMessageSize!==void 0&&c.push("a=max-message-size:"+a.maxMessageSize+`\r
`),c.join("")},r.generateSessionId=function(){return Math.random().toString().substr(2,22)},r.writeSessionBoilerplate=function(s,a,c){let u;const h=a!==void 0?a:2;return u=s||r.generateSessionId(),`v=0\r
o=`+(c||"thisisadapterortc")+" "+u+" "+h+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},r.getDirection=function(s,a){const c=r.splitLines(s);for(let u=0;u<c.length;u++)switch(c[u]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return c[u].substring(2)}return a?r.getDirection(a):"sendrecv"},r.getKind=function(s){return r.splitLines(s)[0].split(" ")[0].substring(2)},r.isRejected=function(s){return s.split(" ",2)[1]==="0"},r.parseMLine=function(s){const a=r.splitLines(s)[0].substring(2).split(" ");return{kind:a[0],port:parseInt(a[1],10),protocol:a[2],fmt:a.slice(3).join(" ")}},r.parseOLine=function(s){const a=r.matchPrefix(s,"o=")[0].substring(2).split(" ");return{username:a[0],sessionId:a[1],sessionVersion:parseInt(a[2],10),netType:a[3],addressType:a[4],address:a[5]}},r.isValidSDP=function(s){if(typeof s!="string"||s.length===0)return!1;const a=r.splitLines(s);for(let c=0;c<a.length;c++)if(a[c].length<2||a[c].charAt(1)!=="=")return!1;return!0},t.exports=r})(VB);var FB=VB.exports,xv=l(FB),$ue=i({__proto__:null,default:xv},[FB]);function pA(t){if(!t.RTCIceCandidate||t.RTCIceCandidate&&"foundation"in t.RTCIceCandidate.prototype)return;const r=t.RTCIceCandidate;t.RTCIceCandidate=function(s){if(typeof s=="object"&&s.candidate&&s.candidate.indexOf("a=")===0&&((s=JSON.parse(JSON.stringify(s))).candidate=s.candidate.substr(2)),s.candidate&&s.candidate.length){const a=new r(s),c=xv.parseCandidate(s.candidate),u=Object.assign(a,c);return u.toJSON=function(){return{candidate:u.candidate,sdpMid:u.sdpMid,sdpMLineIndex:u.sdpMLineIndex,usernameFragment:u.usernameFragment}},u}return new r(s)},t.RTCIceCandidate.prototype=r.prototype,M_(t,"icecandidate",s=>(s.candidate&&Object.defineProperty(s,"candidate",{value:new t.RTCIceCandidate(s.candidate),writable:"false"}),s))}function Ex(t){!t.RTCIceCandidate||t.RTCIceCandidate&&"relayProtocol"in t.RTCIceCandidate.prototype||M_(t,"icecandidate",r=>{if(r.candidate){const s=xv.parseCandidate(r.candidate.candidate);s.type==="relay"&&(r.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[s.priority>>24])}return r})}function mA(t,r){if(!t.RTCPeerConnection)return;"sctp"in t.RTCPeerConnection.prototype||Object.defineProperty(t.RTCPeerConnection.prototype,"sctp",{get(){return this._sctp===void 0?null:this._sctp}});const s=function(m){if(!m||!m.sdp)return!1;const y=xv.splitSections(m.sdp);return y.shift(),y.some(v=>{const S=xv.parseMLine(v);return S&&S.kind==="application"&&S.protocol.indexOf("SCTP")!==-1})},a=function(m){const y=m.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(y===null||y.length<2)return-1;const v=parseInt(y[1],10);return v!=v?-1:v},c=function(m){let y=65536;return r.browser==="firefox"&&(y=r.version<57?m===-1?16384:2147483637:r.version<60?r.version===57?65535:65536:2147483637),y},u=function(m,y){let v=65536;r.browser==="firefox"&&r.version===57&&(v=65535);const S=xv.matchPrefix(m.sdp,"a=max-message-size:");return S.length>0?v=parseInt(S[0].substr(19),10):r.browser==="firefox"&&y!==-1&&(v=2147483637),v},h=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,r.browser==="chrome"&&r.version>=76){const{sdpSemantics:m}=this.getConfiguration();m==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return this._sctp===void 0?null:this._sctp},enumerable:!0,configurable:!0})}if(s(arguments[0])){const m=a(arguments[0]),y=c(m),v=u(arguments[0],m);let S;S=y===0&&v===0?Number.POSITIVE_INFINITY:y===0||v===0?Math.max(y,v):Math.min(y,v);const R={};Object.defineProperty(R,"maxMessageSize",{get:()=>S}),this._sctp=R}return h.apply(this,arguments)}}function gA(t){if(!t.RTCPeerConnection||!("createDataChannel"in t.RTCPeerConnection.prototype))return;function r(a,c){const u=a.send;a.send=function(){const h=arguments[0],m=h.length||h.size||h.byteLength;if(a.readyState==="open"&&c.sctp&&m>c.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+c.sctp.maxMessageSize+" bytes)");return u.apply(a,arguments)}}const s=t.RTCPeerConnection.prototype.createDataChannel;t.RTCPeerConnection.prototype.createDataChannel=function(){const a=s.apply(this,arguments);return r(a,this),a},M_(t,"datachannel",a=>(r(a.channel,a.target),a))}function vx(t){if(!t.RTCPeerConnection||"connectionState"in t.RTCPeerConnection.prototype)return;const r=t.RTCPeerConnection.prototype;Object.defineProperty(r,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(r,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(s){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),s&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=s)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(s=>{const a=r[s];r[s]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=c=>{const u=c.target;if(u._lastConnectionState!==u.connectionState){u._lastConnectionState=u.connectionState;const h=new Event("connectionstatechange",c);u.dispatchEvent(h)}return c},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),a.apply(this,arguments)}})}function Sx(t,r){if(!t.RTCPeerConnection||r.browser==="chrome"&&r.version>=71||r.browser==="safari"&&r.version>=605)return;const s=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(a){if(a&&a.sdp&&a.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const c=a.sdp.split(`
`).filter(u=>_o(u).call(u)!=="a=extmap-allow-mixed").join(`
`);t.RTCSessionDescription&&a instanceof t.RTCSessionDescription?arguments[0]=new t.RTCSessionDescription({type:a.type,sdp:c}):a.sdp=c}return s.apply(this,arguments)}}function _A(t,r){if(!t.RTCPeerConnection||!t.RTCPeerConnection.prototype)return;const s=t.RTCPeerConnection.prototype.addIceCandidate;s&&s.length!==0&&(t.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(r.browser==="chrome"&&r.version<78||r.browser==="firefox"&&r.version<68||r.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?dt.resolve():s.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),dt.resolve())})}function yA(t,r){if(!t.RTCPeerConnection||!t.RTCPeerConnection.prototype)return;const s=t.RTCPeerConnection.prototype.setLocalDescription;s&&s.length!==0&&(t.RTCPeerConnection.prototype.setLocalDescription=function(){let a=arguments[0]||{};if(typeof a!="object"||a.type&&a.sdp)return s.apply(this,arguments);if(a={type:a.type,sdp:a.sdp},!a.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":a.type="offer";break;default:a.type="answer"}return a.sdp||a.type!=="offer"&&a.type!=="answer"?s.apply(this,[a]):(a.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(c=>s.apply(this,[c]))})}var Kue=Object.freeze({__proto__:null,removeExtmapAllowMixed:Sx,shimAddIceCandidateNullOrEmpty:_A,shimConnectionState:vx,shimMaxMessageSize:mA,shimParameterlessSetLocalDescription:yA,shimRTCIceCandidate:pA,shimRTCIceCandidateRelayProtocol:Ex,shimSendThrowTypeError:gA});(function(){let{window:t}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0};const s=Z5,a=function(u){const h={browser:null,version:null};if(u===void 0||!u.navigator)return h.browser="Not a browser.",h;const{navigator:m}=u;if(m.mozGetUserMedia)h.browser="firefox",h.version=fA(m.userAgent,/Firefox\/(\d+)\./,1);else if(m.webkitGetUserMedia||u.isSecureContext===!1&&u.webkitRTCPeerConnection)h.browser="chrome",h.version=fA(m.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!u.RTCPeerConnection||!m.userAgent.match(/AppleWebKit\/(\d+)\./))return h.browser="Not a supported browser.",h;h.browser="safari",h.version=fA(m.userAgent,/AppleWebKit\/(\d+)\./,1),h.supportsUnifiedPlan=u.RTCRtpTransceiver&&"currentDirection"in u.RTCRtpTransceiver.prototype}return h}(t),c={browserDetails:a,commonShim:Kue,extractVersion:fA,disableLog:kue,disableWarnings:Nue,sdp:$ue};switch(a.browser){case"chrome":if(!fB||!mx||!r.shimChrome)return s("Chrome shim is not included in this adapter release."),c;if(a.version===null)return s("Chrome shim can not determine version, not shimming."),c;s("adapter.js shimming chrome."),c.browserShim=fB,_A(t,a),yA(t),iB(t,a),sB(t),mx(t,a),oB(t),dB(t,a),aB(t),cB(t),lB(t),hB(t,a),pA(t),Ex(t),vx(t),mA(t,a),gA(t),Sx(t,a);break;case"firefox":if(!wB||!gx||!r.shimFirefox)return s("Firefox shim is not included in this adapter release."),c;s("adapter.js shimming firefox."),c.browserShim=wB,_A(t,a),yA(t),pB(t,a),gx(t,a),mB(t),yB(t),gB(t),_B(t),EB(t),vB(t),SB(t),bB(t),TB(t),pA(t),vx(t),mA(t,a),gA(t);break;case"safari":if(!xB||!r.shimSafari)return s("Safari shim is not included in this adapter release."),c;s("adapter.js shimming safari."),c.browserShim=xB,_A(t,a),yA(t),OB(t),NB(t),IB(t),CB(t),RB(t),kB(t),AB(t),DB(t),pA(t),Ex(t),mA(t,a),gA(t),Sx(t,a);break;default:s("Unsupported browser!")}})({window:typeof window>"u"?void 0:window});var jB=Pa,que=TypeError,BB=vt.match(/firefox\/(\d+)/i),Yue=!!BB&&+BB[1],Xue=/MSIE|Trident/.test(vt),WB=vt.match(/AppleWebKit\/(\d+)\./),Jue=!!WB&&+WB[1],Que=zn,zB=I,Zue=_t,ede=Yo,GB=yi,tde=function(t,r){if(!delete t[r])throw que("Cannot delete property "+jB(r)+" of "+jB(t))},HB=Da,bx=d,nde=t5,rde=Nf,$B=Yue,ide=Xue,KB=ci,qB=Jue,Wm=[],YB=zB(Wm.sort),sde=zB(Wm.push),ode=bx(function(){Wm.sort(void 0)}),ade=bx(function(){Wm.sort(null)}),cde=rde("sort"),XB=!bx(function(){if(KB)return KB<70;if(!($B&&$B>3)){if(ide)return!0;if(qB)return qB<603;var t,r,s,a,c="";for(t=65;t<76;t++){switch(r=String.fromCharCode(t),t){case 66:case 69:case 70:case 72:s=3;break;case 68:case 71:s=4;break;default:s=2}for(a=0;a<47;a++)Wm.push({k:r+a,v:s})}for(Wm.sort(function(u,h){return h.v-u.v}),a=0;a<Wm.length;a++)r=Wm[a].k.charAt(0),c.charAt(c.length-1)!==r&&(c+=r);return c!=="DGBEFHACIJK"}});Que({target:"Array",proto:!0,forced:ode||!ade||!cde||!XB},{sort:function(t){t!==void 0&&Zue(t);var r=ede(this);if(XB)return t===void 0?YB(r):YB(r,t);var s,a,c=[],u=GB(r);for(a=0;a<u;a++)a in r&&sde(c,r[a]);for(nde(c,function(h){return function(m,y){return y===void 0?-1:m===void 0?1:h!==void 0?+h(m,y)||0:HB(m)>HB(y)?1:-1}}(t)),s=GB(c),a=0;a<s;)r[a]=c[a++];for(;a<u;)tde(r,a++);return r}});var lde=dc("Array").sort,ude=O,dde=lde,Tx=Array.prototype,hde=function(t){var r=t.sort;return t===Tx||ude(Tx,t)&&r===Tx.sort?dde:r},pT=l(hde),wx=U;zn({global:!0,forced:wx.globalThis!==wx},{globalThis:wx});var JB=l(U),Cx={exports:{}};(function(t,r){(function(s,a){var c="function",u="undefined",h="object",m="string",y="major",v="model",S="name",R="type",P="vendor",D="version",G="architecture",F="console",j="mobile",Y="tablet",ee="smarttv",fe="wearable",Se="embedded",we="Amazon",ye="Apple",Ne="ASUS",Ye="BlackBerry",ht="Browser",mt="Chrome",In="Firefox",An="Google",mr="Huawei",di="LG",Jr="Microsoft",ya="Motorola",je="Opera",st="Samsung",Ct="Sharp",He="Sony",M="Xiaomi",ae="Zebra",me="Facebook",Qe="Chromium OS",Jt="Mac OS",ar=function(Di){for(var ns={},Pr=0;Pr<Di.length;Pr++)ns[Di[Pr].toUpperCase()]=Di[Pr];return ns},ts=function(Di,ns){return typeof Di===m&&$a(ns).indexOf($a(Di))!==-1},$a=function(Di){return Di.toLowerCase()},yp=function(Di,ns){if(typeof Di===m)return Di=Di.replace(/^\s\s*/,""),typeof ns===u?Di:Di.substring(0,350)},fy=function(Di,ns){for(var Pr,Sc,Vh,hi,$n,Ka,ug=0;ug<ns.length&&!$n;){var Pd=ns[ug],wK=ns[ug+1];for(Pr=Sc=0;Pr<Pd.length&&!$n&&Pd[Pr];)if($n=Pd[Pr++].exec(Di))for(Vh=0;Vh<wK.length;Vh++)Ka=$n[++Sc],typeof(hi=wK[Vh])===h&&hi.length>0?hi.length===2?typeof hi[1]==c?this[hi[0]]=hi[1].call(this,Ka):this[hi[0]]=hi[1]:hi.length===3?typeof hi[1]!==c||hi[1].exec&&hi[1].test?this[hi[0]]=Ka?Ka.replace(hi[1],hi[2]):a:this[hi[0]]=Ka?hi[1].call(this,Ka,hi[2]):a:hi.length===4&&(this[hi[0]]=Ka?hi[3].call(this,Ka.replace(hi[1],hi[2])):a):this[hi]=Ka||a;ug+=2}},_w=function(Di,ns){for(var Pr in ns)if(typeof ns[Pr]===h&&ns[Pr].length>0){for(var Sc=0;Sc<ns[Pr].length;Sc++)if(ts(ns[Pr][Sc],Di))return Pr==="?"?a:Pr}else if(ts(ns[Pr],Di))return Pr==="?"?a:Pr;return Di},mO={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},gO={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[D,[S,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[D,[S,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[S,D],[/opios[\/ ]+([\w\.]+)/i],[D,[S,je+" Mini"]],[/\bopr\/([\w\.]+)/i],[D,[S,je]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/ ]?([\w\.]*)/i,/(avant |iemobile|slim)(?:browser)?[\/ ]?([\w\.]*)/i,/(ba?idubrowser)[\/ ]?([\w\.]+)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|qq|duckduckgo)\/([-\w\.]+)/i,/(weibo)__([\d\.]+)/i],[S,D],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[D,[S,"UC"+ht]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i],[D,[S,"WeChat(Win) Desktop"]],[/micromessenger\/([\w\.]+)/i],[D,[S,"WeChat"]],[/konqueror\/([\w\.]+)/i],[D,[S,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[D,[S,"IE"]],[/yabrowser\/([\w\.]+)/i],[D,[S,"Yandex"]],[/(avast|avg)\/([\w\.]+)/i],[[S,/(.+)/,"$1 Secure "+ht],D],[/\bfocus\/([\w\.]+)/i],[D,[S,In+" Focus"]],[/\bopt\/([\w\.]+)/i],[D,[S,je+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[D,[S,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[D,[S,"Dolphin"]],[/coast\/([\w\.]+)/i],[D,[S,je+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[D,[S,"MIUI "+ht]],[/fxios\/([-\w\.]+)/i],[D,[S,In]],[/\bqihu|(qi?ho?o?|360)browser/i],[[S,"360 "+ht]],[/(oculus|samsung|sailfish|huawei)browser\/([\w\.]+)/i],[[S,/(.+)/,"$1 "+ht],D],[/(comodo_dragon)\/([\w\.]+)/i],[[S,/_/g," "],D],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|baiduboxapp|2345Explorer)[\/ ]?([\w\.]+)/i],[S,D],[/(metasr)[\/ ]?([\w\.]+)/i,/(lbbrowser)/i,/\[(linkedin)app\]/i],[S],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[S,me],D],[/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(chromium|instagram)[\/ ]([-\w\.]+)/i],[S,D],[/\bgsa\/([\w\.]+) .*safari\//i],[D,[S,"GSA"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[D,[S,mt+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[S,mt+" WebView"],D],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[D,[S,"Android "+ht]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[S,D],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[D,[S,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[D,S],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[S,[D,_w,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[S,D],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[S,"Netscape"],D],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[D,[S,In+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror|klar)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i,/panasonic;(viera)/i],[S,D],[/(cobalt)\/([\w\.]+)/i],[S,[D,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[G,"amd64"]],[/(ia32(?=;))/i],[[G,$a]],[/((?:i[346]|x)86)[;\)]/i],[[G,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[G,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[G,"armhf"]],[/windows (ce|mobile); ppc;/i],[[G,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[G,/ower/,"",$a]],[/(sun4\w)[;\)]/i],[[G,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[G,$a]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[v,[P,st],[R,Y]],[/\b((?:s[cgp]h|gt|sm)-\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]([-\w]+)/i,/sec-(sgh\w+)/i],[v,[P,st],[R,j]],[/\((ip(?:hone|od)[\w ]*);/i],[v,[P,ye],[R,j]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[v,[P,ye],[R,Y]],[/(macintosh);/i],[v,[P,ye]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[v,[P,Ct],[R,j]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[v,[P,mr],[R,Y]],[/(?:huawei|honor)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[v,[P,mr],[R,j]],[/\b(poco[\w ]+)(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite)?)(?: bui|\))/i],[[v,/_/g," "],[P,M],[R,j]],[/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[v,/_/g," "],[P,M],[R,Y]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[v,[P,"OPPO"],[R,j]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[v,[P,"Vivo"],[R,j]],[/\b(rmx[12]\d{3})(?: bui|;|\))/i],[v,[P,"Realme"],[R,j]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[v,[P,ya],[R,j]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[v,[P,ya],[R,Y]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[v,[P,di],[R,Y]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[v,[P,di],[R,j]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[v,[P,"Lenovo"],[R,Y]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[v,/_/g," "],[P,"Nokia"],[R,j]],[/(pixel c)\b/i],[v,[P,An],[R,Y]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[v,[P,An],[R,j]],[/droid.+ (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[v,[P,He],[R,j]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[v,"Xperia Tablet"],[P,He],[R,Y]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[v,[P,"OnePlus"],[R,j]],[/(alexa)webm/i,/(kf[a-z]{2}wi)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[v,[P,we],[R,Y]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[v,/(.+)/g,"Fire Phone $1"],[P,we],[R,j]],[/(playbook);[-\w\),; ]+(rim)/i],[v,P,[R,Y]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[v,[P,Ye],[R,j]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[v,[P,Ne],[R,Y]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[v,[P,Ne],[R,j]],[/(nexus 9)/i],[v,[P,"HTC"],[R,Y]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[P,[v,/_/g," "],[R,j]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[v,[P,"Acer"],[R,Y]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[v,[P,"Meizu"],[R,j]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[-_ ]?([-\w]*)/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[P,v,[R,j]],[/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[P,v,[R,Y]],[/(surface duo)/i],[v,[P,Jr],[R,Y]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[v,[P,"Fairphone"],[R,j]],[/(u304aa)/i],[v,[P,"AT&T"],[R,j]],[/\bsie-(\w*)/i],[v,[P,"Siemens"],[R,j]],[/\b(rct\w+) b/i],[v,[P,"RCA"],[R,Y]],[/\b(venue[\d ]{2,7}) b/i],[v,[P,"Dell"],[R,Y]],[/\b(q(?:mv|ta)\w+) b/i],[v,[P,"Verizon"],[R,Y]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[v,[P,"Barnes & Noble"],[R,Y]],[/\b(tm\d{3}\w+) b/i],[v,[P,"NuVision"],[R,Y]],[/\b(k88) b/i],[v,[P,"ZTE"],[R,Y]],[/\b(nx\d{3}j) b/i],[v,[P,"ZTE"],[R,j]],[/\b(gen\d{3}) b.+49h/i],[v,[P,"Swiss"],[R,j]],[/\b(zur\d{3}) b/i],[v,[P,"Swiss"],[R,Y]],[/\b((zeki)?tb.*\b) b/i],[v,[P,"Zeki"],[R,Y]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[P,"Dragon Touch"],v,[R,Y]],[/\b(ns-?\w{0,9}) b/i],[v,[P,"Insignia"],[R,Y]],[/\b((nxa|next)-?\w{0,9}) b/i],[v,[P,"NextBook"],[R,Y]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[P,"Voice"],v,[R,j]],[/\b(lvtel\-)?(v1[12]) b/i],[[P,"LvTel"],v,[R,j]],[/\b(ph-1) /i],[v,[P,"Essential"],[R,j]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[v,[P,"Envizen"],[R,Y]],[/\b(trio[-\w\. ]+) b/i],[v,[P,"MachSpeed"],[R,Y]],[/\btu_(1491) b/i],[v,[P,"Rotor"],[R,Y]],[/(shield[\w ]+) b/i],[v,[P,"Nvidia"],[R,Y]],[/(sprint) (\w+)/i],[P,v,[R,j]],[/(kin\.[onetw]{3})/i],[[v,/\./g," "],[P,Jr],[R,j]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[v,[P,ae],[R,Y]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[v,[P,ae],[R,j]],[/smart-tv.+(samsung)/i],[P,[R,ee]],[/hbbtv.+maple;(\d+)/i],[[v,/^/,"SmartTV"],[P,st],[R,ee]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[P,di],[R,ee]],[/(apple) ?tv/i],[P,[v,ye+" TV"],[R,ee]],[/crkey/i],[[v,mt+"cast"],[P,An],[R,ee]],[/droid.+aft(\w)( bui|\))/i],[v,[P,we],[R,ee]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[v,[P,Ct],[R,ee]],[/(bravia[\w ]+)( bui|\))/i],[v,[P,He],[R,ee]],[/(mitv-\w{5}) bui/i],[v,[P,M],[R,ee]],[/Hbbtv.*(technisat) (.*);/i],[P,v,[R,ee]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[P,yp],[v,yp],[R,ee]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[R,ee]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[P,v,[R,F]],[/droid.+; (shield) bui/i],[v,[P,"Nvidia"],[R,F]],[/(playstation [345portablevi]+)/i],[v,[P,He],[R,F]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[v,[P,Jr],[R,F]],[/((pebble))app/i],[P,v,[R,fe]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[v,[P,ye],[R,fe]],[/droid.+; (glass) \d/i],[v,[P,An],[R,fe]],[/droid.+; (wt63?0{2,3})\)/i],[v,[P,ae],[R,fe]],[/(quest( 2| pro)?)/i],[v,[P,me],[R,fe]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[P,[R,Se]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+? mobile safari/i],[v,[R,j]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[v,[R,Y]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[R,Y]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[R,j]],[/(android[-\w\. ]{0,9});.+buil/i],[v,[P,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[D,[S,"EdgeHTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[D,[S,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i],[S,D],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[D,S]],os:[[/microsoft (windows) (vista|xp)/i],[S,D],[/(windows) nt 6\.2; (arm)/i,/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i,/(windows)[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i],[S,[D,_w,mO]],[/(win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[S,"Windows"],[D,_w,mO]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/cfnetwork\/.+darwin/i],[[D,/_/g,"."],[S,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[S,Jt],[D,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[D,S],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[S,D],[/\(bb(10);/i],[D,[S,Ye]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[D,[S,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[D,[S,In+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[D,[S,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[D,[S,"watchOS"]],[/crkey\/([\d\.]+)/i],[D,[S,mt+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[S,Qe],D],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[S,D],[/(sunos) ?([\w\.\d]*)/i],[[S,"Solaris"],D],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux)/i,/(unix) ?([\w\.]*)/i],[S,D]]},Ml=function(Di,ns){if(typeof Di===h&&(ns=Di,Di=a),!(this instanceof Ml))return new Ml(Di,ns).getResult();var Pr=typeof s!==u&&s.navigator?s.navigator:a,Sc=Di||(Pr&&Pr.userAgent?Pr.userAgent:""),Vh=Pr&&Pr.userAgentData?Pr.userAgentData:a,hi=ns?function($n,Ka){var ug={};for(var Pd in $n)Ka[Pd]&&Ka[Pd].length%2==0?ug[Pd]=Ka[Pd].concat($n[Pd]):ug[Pd]=$n[Pd];return ug}(gO,ns):gO;return this.getBrowser=function(){var $n={};return $n[S]=a,$n[D]=a,fy.call($n,Sc,hi.browser),$n[y]=function(Ka){return typeof Ka===m?Ka.replace(/[^\d\.]/g,"").split(".")[0]:a}($n[D]),Pr&&Pr.brave&&typeof Pr.brave.isBrave==c&&($n[S]="Brave"),$n},this.getCPU=function(){var $n={};return $n[G]=a,fy.call($n,Sc,hi.cpu),$n},this.getDevice=function(){var $n={};return $n[P]=a,$n[v]=a,$n[R]=a,fy.call($n,Sc,hi.device),!$n[R]&&Vh&&Vh.mobile&&($n[R]=j),$n[v]=="Macintosh"&&Pr&&typeof Pr.standalone!==u&&Pr.maxTouchPoints&&Pr.maxTouchPoints>2&&($n[v]="iPad",$n[R]=Y),$n},this.getEngine=function(){var $n={};return $n[S]=a,$n[D]=a,fy.call($n,Sc,hi.engine),$n},this.getOS=function(){var $n={};return $n[S]=a,$n[D]=a,fy.call($n,Sc,hi.os),!$n[S]&&Vh&&Vh.platform!="Unknown"&&($n[S]=Vh.platform.replace(/chrome os/i,Qe).replace(/macos/i,Jt)),$n},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return Sc},this.setUA=function($n){return Sc=typeof $n===m&&$n.length>350?yp($n,350):$n,this},this.setUA(Sc),this};Ml.VERSION="0.7.34",Ml.BROWSER=ar([S,D,y]),Ml.CPU=ar([G]),Ml.DEVICE=ar([v,P,R,F,j,ee,Y,fe,Se]),Ml.ENGINE=Ml.OS=ar([S,D]),t.exports&&(r=t.exports=Ml),r.UAParser=Ml;var lg=typeof s!==u&&(s.jQuery||s.Zepto);if(lg&&!lg.ua){var py=new Ml;lg.ua=py.getResult(),lg.ua.get=function(){return py.getUA()},lg.ua.set=function(Di){py.setUA(Di);var ns=py.getResult();for(var Pr in ns)lg.ua[Pr]=ns[Pr]}}})(typeof window=="object"?window:o)})(Cx,Cx.exports);var fde=l(Cx.exports),pde=xc,mde=Ii,gde=Ft,_de=oh,yde=Er("iterator"),Ede=Object,vde=function(t){if(gde(t))return!1;var r=Ede(t);return r[yde]!==void 0||"@@iterator"in r||mde(_de,pde(r))},Sde=l(vde),QB=uv.clear;zn({global:!0,bind:!0,forced:U.clearImmediate!==QB},{clearImmediate:QB});var bde=typeof Bun=="function"&&Bun&&typeof Bun.version=="string",ZB=U,Tde=ie,wde=xe,Cde=bde,Rde=vt,Ide=Cs,Ade=wl,Pde=ZB.Function,Ode=/MSIE .\./.test(Rde)||Cde&&function(){var t=ZB.Bun.version.split(".");return t.length<3||t[0]==0&&(t[1]<3||t[1]==3&&t[2]==0)}(),kde=zn,e6=U,t6=uv.set,Nde=function(t,r){var s=1;return Ode?function(a,c){var u=Ade(arguments.length,1)>s,h=wde(a)?a:Pde(a),m=u?Ide(arguments,s):[],y=u?function(){Tde(h,this,m)}:h;return t(y)}:t},n6=e6.setImmediate?Nde(t6):t6;kde({global:!0,bind:!0,forced:e6.setImmediate!==n6},{setImmediate:n6});var r6=l(gt.setImmediate),Dde=zn,xde=gc,Lde=_t,Mde=wl,Ude=Df,Vde=U.process;Dde({global:!0,dontCallGetSet:!0},{queueMicrotask:function(t){Mde(arguments.length,1),Lde(t);var r=Ude&&Vde.domain;xde(r?r.bind(t):t)}});var i6=l(gt.queueMicrotask);function s6(t,r){return function(){return t.apply(r,arguments)}}const{toString:Fde}=Object.prototype,{getPrototypeOf:Rx}=Object,EA=(Ix=Object.create(null),t=>{const r=Fde.call(t);return Ix[r]||(Ix[r]=r.slice(8,-1).toLowerCase())});var Ix;const gd=t=>(t=t.toLowerCase(),r=>EA(r)===t),vA=t=>r=>typeof r===t,{isArray:Lv}=Array,mT=vA("undefined"),o6=gd("ArrayBuffer"),jde=vA("string"),Rl=vA("function"),a6=vA("number"),SA=t=>t!==null&&typeof t=="object",bA=t=>{if(EA(t)!=="object")return!1;const r=Rx(t);return!(r!==null&&r!==Object.prototype&&Object.getPrototypeOf(r)!==null||Symbol.toStringTag in t||Sde(t))},Bde=gd("Date"),Wde=gd("File"),zde=gd("Blob"),Gde=gd("FileList"),Hde=gd("URLSearchParams"),[$de,Kde,qde,Yde]=["ReadableStream","Request","Response","Headers"].map(gd);function gT(t,r){let s,a,{allOwnKeys:c=!1}=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(t!=null)if(typeof t!="object"&&(t=[t]),Lv(t))for(s=0,a=t.length;s<a;s++)r.call(null,t[s],s,t);else{const u=c?Object.getOwnPropertyNames(t):Object.keys(t),h=u.length;let m;for(s=0;s<h;s++)m=u[s],r.call(null,t[m],m,t)}}function c6(t,r){r=r.toLowerCase();const s=Object.keys(t);let a,c=s.length;for(;c-- >0;)if(a=s[c],r===a.toLowerCase())return a;return null}const U_=JB!==void 0?JB:typeof self<"u"?self:typeof window<"u"?window:wy,l6=t=>!mT(t)&&t!==U_,Xde=(Ax=typeof Uint8Array<"u"&&Rx(Uint8Array),t=>Ax&&t instanceof Ax);var Ax;const Jde=gd("HTMLFormElement"),u6=(t=>{let{hasOwnProperty:r}=t;return(s,a)=>r.call(s,a)})(Object.prototype),Qde=gd("RegExp"),d6=(t,r)=>{const s=Object.getOwnPropertyDescriptors(t),a={};gT(s,(c,u)=>{let h;(h=r(c,u,t))!==!1&&(a[u]=h||c)}),Object.defineProperties(t,a)},Px="abcdefghijklmnopqrstuvwxyz",h6="0123456789",f6={DIGIT:h6,ALPHA:Px,ALPHA_DIGIT:Px+Px.toUpperCase()+h6},Zde=gd("AsyncFunction"),p6=(m6=typeof r6=="function",g6=Rl(U_.postMessage),m6?r6:g6?(Ox="axios@".concat(Math.random()),TA=[],U_.addEventListener("message",t=>{let{source:r,data:s}=t;r===U_&&s===Ox&&TA.length&&TA.shift()()},!1),t=>{TA.push(t),U_.postMessage(Ox,"*")}):t=>setTimeout(t));var m6,g6,Ox,TA;const ehe=i6!==void 0?i6.bind(U_):typeof process<"u"&&process.nextTick||p6;var ct={isArray:Lv,isArrayBuffer:o6,isBuffer:function(t){return t!==null&&!mT(t)&&t.constructor!==null&&!mT(t.constructor)&&Rl(t.constructor.isBuffer)&&t.constructor.isBuffer(t)},isFormData:t=>{let r;return t&&(typeof FormData=="function"&&t instanceof FormData||Rl(t.append)&&((r=EA(t))==="formdata"||r==="object"&&Rl(t.toString)&&t.toString()==="[object FormData]"))},isArrayBufferView:function(t){let r;return r=typeof ArrayBuffer<"u"&&ArrayBuffer.isView?ArrayBuffer.isView(t):t&&t.buffer&&o6(t.buffer),r},isString:jde,isNumber:a6,isBoolean:t=>t===!0||t===!1,isObject:SA,isPlainObject:bA,isReadableStream:$de,isRequest:Kde,isResponse:qde,isHeaders:Yde,isUndefined:mT,isDate:Bde,isFile:Wde,isBlob:zde,isRegExp:Qde,isFunction:Rl,isStream:t=>SA(t)&&Rl(t.pipe),isURLSearchParams:Hde,isTypedArray:Xde,isFileList:Gde,forEach:gT,merge:function t(){const{caseless:r}=l6(this)&&this||{},s={},a=(c,u)=>{const h=r&&c6(s,u)||u;bA(s[h])&&bA(c)?s[h]=t(s[h],c):bA(c)?s[h]=t({},c):Lv(c)?s[h]=c.slice():s[h]=c};for(let c=0,u=arguments.length;c<u;c++)arguments[c]&&gT(arguments[c],a);return s},extend:function(t,r,s){let{allOwnKeys:a}=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return gT(r,(c,u)=>{s&&Rl(c)?t[u]=s6(c,s):t[u]=c},{allOwnKeys:a}),t},trim:t=>_o(t)?_o(t).call(t):t.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:t=>(t.charCodeAt(0)===65279&&(t=t.slice(1)),t),inherits:(t,r,s,a)=>{t.prototype=Object.create(r.prototype,a),t.prototype.constructor=t,Object.defineProperty(t,"super",{value:r.prototype}),s&&Object.assign(t.prototype,s)},toFlatObject:(t,r,s,a)=>{let c,u,h;const m={};if(r=r||{},t==null)return r;do{for(c=Object.getOwnPropertyNames(t),u=c.length;u-- >0;)h=c[u],a&&!a(h,t,r)||m[h]||(r[h]=t[h],m[h]=!0);t=s!==!1&&Rx(t)}while(t&&(!s||s(t,r))&&t!==Object.prototype);return r},kindOf:EA,kindOfTest:gd,endsWith:(t,r,s)=>{t=String(t),(s===void 0||s>t.length)&&(s=t.length),s-=r.length;const a=t.indexOf(r,s);return a!==-1&&a===s},toArray:t=>{if(!t)return null;if(Lv(t))return t;let r=t.length;if(!a6(r))return null;const s=new Array(r);for(;r-- >0;)s[r]=t[r];return s},forEachEntry:(t,r)=>{const s=(t&&t[Symbol.iterator]).call(t);let a;for(;(a=s.next())&&!a.done;){const c=a.value;r.call(t,c[0],c[1])}},matchAll:(t,r)=>{let s;const a=[];for(;(s=t.exec(r))!==null;)a.push(s);return a},isHTMLForm:Jde,hasOwnProperty:u6,hasOwnProp:u6,reduceDescriptors:d6,freezeMethods:t=>{d6(t,(r,s)=>{if(Rl(t)&&["arguments","caller","callee"].indexOf(s)!==-1)return!1;const a=t[s];Rl(a)&&(r.enumerable=!1,"writable"in r?r.writable=!1:r.set||(r.set=()=>{throw Error("Can not rewrite read-only method '"+s+"'")}))})},toObjectSet:(t,r)=>{const s={},a=c=>{c.forEach(u=>{s[u]=!0})};return Lv(t)?a(t):a(String(t).split(r)),s},toCamelCase:t=>t.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(r,s,a){return s.toUpperCase()+a}),noop:()=>{},toFiniteNumber:(t,r)=>t!=null&&Number.isFinite(t=+t)?t:r,findKey:c6,global:U_,isContextDefined:l6,ALPHABET:f6,generateString:function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:16,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:f6.ALPHA_DIGIT,s="";const{length:a}=r;for(;t--;)s+=r[Math.random()*a|0];return s},isSpecCompliantForm:function(t){return!!(t&&Rl(t.append)&&t[Symbol.toStringTag]==="FormData"&&t[Symbol.iterator])},toJSONObject:t=>{const r=new Array(10),s=(a,c)=>{if(SA(a)){if(r.indexOf(a)>=0)return;if(!("toJSON"in a)){r[c]=a;const u=Lv(a)?[]:{};return gT(a,(h,m)=>{const y=s(h,c+1);!mT(y)&&(u[m]=y)}),r[c]=void 0,u}}return a};return s(t,0)},isAsyncFn:Zde,isThenable:t=>t&&(SA(t)||Rl(t))&&Rl(t.then)&&Rl(t.catch),setImmediate:p6,asap:ehe};function sr(t,r,s,a,c){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=t,this.name="AxiosError",r&&(this.code=r),s&&(this.config=s),a&&(this.request=a),c&&(this.response=c,this.status=c.status?c.status:null)}ct.inherits(sr,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:ct.toJSONObject(this.config),code:this.code,status:this.status}}});const _6=sr.prototype,y6={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(t=>{y6[t]={value:t}}),Object.defineProperties(sr,y6),Object.defineProperty(_6,"isAxiosError",{value:!0}),sr.from=(t,r,s,a,c,u)=>{const h=Object.create(_6);return ct.toFlatObject(t,h,function(m){return m!==Error.prototype},m=>m!=="isAxiosError"),sr.call(h,t.message,r,s,a,c),h.cause=t,h.name=t.name,u&&Object.assign(h,u),h};function kx(t){return ct.isPlainObject(t)||ct.isArray(t)}function E6(t){return ct.endsWith(t,"[]")?t.slice(0,-2):t}function v6(t,r,s){return t?t.concat(r).map(function(a,c){return a=E6(a),!s&&c?"["+a+"]":a}).join(s?".":""):r}const the=ct.toFlatObject(ct,{},null,function(t){return/^is[A-Z]/.test(t)});function wA(t,r,s){if(!ct.isObject(t))throw new TypeError("target must be an object");r=r||new FormData;const a=(s=ct.toFlatObject(s,{metaTokens:!0,dots:!1,indexes:!1},!1,function(P,D){return!ct.isUndefined(D[P])})).metaTokens,c=s.visitor||v,u=s.dots,h=s.indexes,m=(s.Blob||typeof Blob<"u"&&Blob)&&ct.isSpecCompliantForm(r);if(!ct.isFunction(c))throw new TypeError("visitor must be a function");function y(P){if(P===null)return"";if(ct.isDate(P))return P.toISOString();if(!m&&ct.isBlob(P))throw new sr("Blob is not supported. Use a Buffer instead.");return ct.isArrayBuffer(P)||ct.isTypedArray(P)?m&&typeof Blob=="function"?new Blob([P]):Buffer.from(P):P}function v(P,D,G){let F=P;if(P&&!G&&typeof P=="object"){if(ct.endsWith(D,"{}"))D=a?D:D.slice(0,-2),P=JSON.stringify(P);else if(ct.isArray(P)&&function(j){return ct.isArray(j)&&!j.some(kx)}(P)||(ct.isFileList(P)||ct.endsWith(D,"[]"))&&(F=ct.toArray(P)))return D=E6(D),F.forEach(function(j,Y){!ct.isUndefined(j)&&j!==null&&r.append(h===!0?v6([D],Y,u):h===null?D:D+"[]",y(j))}),!1}return!!kx(P)||(r.append(v6(G,D,u),y(P)),!1)}const S=[],R=Object.assign(the,{defaultVisitor:v,convertValue:y,isVisitable:kx});if(!ct.isObject(t))throw new TypeError("data must be an object");return function P(D,G){if(!ct.isUndefined(D)){if(S.indexOf(D)!==-1)throw Error("Circular reference detected in "+G.join("."));S.push(D),ct.forEach(D,function(F,j){(!(ct.isUndefined(F)||F===null)&&c.call(r,F,ct.isString(j)?_o(j).call(j):j,G,R))===!0&&P(F,G?G.concat(j):[j])}),S.pop()}}(t),r}function S6(t){const r={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(t).replace(/[!'()~]|%20|%00/g,function(s){return r[s]})}function Nx(t,r){this._pairs=[],t&&wA(t,this,r)}const b6=Nx.prototype;function nhe(t){return encodeURIComponent(t).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function T6(t,r,s){if(!r)return t;const a=s&&s.encode||nhe;ct.isFunction(s)&&(s={serialize:s});const c=s&&s.serialize;let u;if(u=c?c(r,s):ct.isURLSearchParams(r)?r.toString():new Nx(r,s).toString(a),u){const h=t.indexOf("#");h!==-1&&(t=t.slice(0,h)),t+=(t.indexOf("?")===-1?"?":"&")+u}return t}b6.append=function(t,r){this._pairs.push([t,r])},b6.toString=function(t){const r=t?function(s){return t.call(this,s,S6)}:S6;return this._pairs.map(function(s){return r(s[0])+"="+r(s[1])},"").join("&")};var w6=class{constructor(){this.handlers=[]}use(t,r,s){return this.handlers.push({fulfilled:t,rejected:r,synchronous:!!s&&s.synchronous,runWhen:s?s.runWhen:null}),this.handlers.length-1}eject(t){this.handlers[t]&&(this.handlers[t]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(t){ct.forEach(this.handlers,function(r){r!==null&&t(r)})}},C6={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},R6={exports:{}},rhe=zn,ihe=$e,I6=nt.f;rhe({target:"Object",stat:!0,forced:Object.defineProperty!==I6,sham:!ihe},{defineProperty:I6});var A6=gt.Object,she=R6.exports=function(t,r,s){return A6.defineProperty(t,r,s)};A6.defineProperty.sham&&(she.sham=!0);var P6=l(R6.exports),ohe=TypeError,O6=t_,ahe=w_,che=ft,lhe=Er("species"),k6=Array,uhe=function(t){var r;return O6(t)&&(r=t.constructor,(ahe(r)&&(r===k6||O6(r.prototype))||che(r)&&(r=r[lhe])===null)&&(r=void 0)),r===void 0?k6:r},N6=function(t,r){return new(uhe(t))(r===0?0:r)},dhe=d,hhe=ci,fhe=Er("species"),D6=function(t){return hhe>=51||!dhe(function(){var r=[];return(r.constructor={})[fhe]=function(){return{foo:1}},r[t](Boolean).foo!==1})},phe=zn,mhe=d,ghe=t_,_he=ft,yhe=Yo,Ehe=yi,x6=function(t){if(t>9007199254740991)throw ohe("Maximum allowed index exceeded");return t},L6=eA,vhe=N6,She=D6,bhe=ci,M6=Er("isConcatSpreadable"),The=bhe>=51||!mhe(function(){var t=[];return t[M6]=!1,t.concat()[0]!==t}),whe=function(t){if(!_he(t))return!1;var r=t[M6];return r!==void 0?!!r:ghe(t)};phe({target:"Array",proto:!0,forced:!The||!She("concat")},{concat:function(t){var r,s,a,c,u,h=yhe(this),m=vhe(h,0),y=0;for(r=-1,a=arguments.length;r<a;r++)if(whe(u=r===-1?h:arguments[r]))for(c=Ehe(u),x6(y+c),s=0;s<c;s++,y++)s in u&&L6(m,y,u[s]);else x6(y+1),L6(m,y++,u);return m.length=y,m}});var U6={},Che=Q,Rhe=Re,V6=rh.f,Ihe=LD,F6=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];U6.f=function(t){return F6&&Che(t)=="Window"?function(r){try{return V6(r)}catch{return Ihe(F6)}}(t):V6(Rhe(t))};var Mv={},Ahe=Er;Mv.f=Ahe;var j6=gt,Phe=Ii,Ohe=Mv,khe=nt.f,As=function(t){var r=j6.Symbol||(j6.Symbol={});Phe(r,t)||khe(r,t,{value:Ohe.f(t)})},Nhe=Ee,Dhe=tn,xhe=Er,Lhe=cd,B6=function(){var t=Dhe("Symbol"),r=t&&t.prototype,s=r&&r.valueOf,a=xhe("toPrimitive");r&&!r[a]&&Lhe(r,a,function(c){return Nhe(s,this)},{})},Mhe=De,Uhe=pn,Vhe=Yo,Fhe=yi,jhe=N6,W6=I([].push),Bhe=function(t){var r=t==1,s=t==2,a=t==3,c=t==4,u=t==6,h=t==7,m=t==5||u;return function(y,v,S,R){for(var P,D,G=Vhe(y),F=Uhe(G),j=Mhe(v,S),Y=Fhe(F),ee=0,fe=R||jhe,Se=r?fe(y,Y):s||h?fe(y,0):void 0;Y>ee;ee++)if((m||ee in F)&&(D=j(P=F[ee],ee,G),t))if(r)Se[ee]=D;else if(D)switch(t){case 3:return!0;case 5:return P;case 6:return ee;case 2:W6(Se,P)}else switch(t){case 4:return!1;case 7:W6(Se,P)}return u?-1:a||c?c:Se}},z6={forEach:Bhe(0)},CA=zn,Dx=U,xx=Ee,Whe=I,Uv=$e,Vv=Js,zhe=d,Uo=Ii,Ghe=O,Lx=fn,RA=Re,Mx=lc,Hhe=Da,Ux=Je,_T=aa,G6=Uc,$he=rh,H6=U6,Khe=Mc,$6=We,K6=nt,qhe=TE,q6=ke,Y6=cd,Yhe=YE,Vx=ac,X6=Lc,J6=Xd,Xhe=Er,Jhe=Mv,Qhe=As,Zhe=B6,efe=ld,Q6=ad,IA=z6.forEach,$c=r_("hidden"),AA="Symbol",yT="prototype",tfe=Q6.set,Z6=Q6.getterFor(AA),_d=Object[yT],V_=Dx.Symbol,PA=V_&&V_[yT],nfe=Dx.TypeError,Fx=Dx.QObject,eW=$6.f,F_=K6.f,tW=H6.f,rfe=q6.f,nW=Whe([].push),np=Vx("symbols"),ET=Vx("op-symbols"),ife=Vx("wks"),jx=!Fx||!Fx[yT]||!Fx[yT].findChild,Bx=Uv&&zhe(function(){return _T(F_({},"a",{get:function(){return F_(this,"a",{value:7}).a}})).a!=7})?function(t,r,s){var a=eW(_d,r);a&&delete _d[r],F_(t,r,s),a&&t!==_d&&F_(_d,r,a)}:F_,Wx=function(t,r){var s=np[t]=_T(PA);return tfe(s,{type:AA,tag:t,description:r}),Uv||(s.description=r),s},OA=function(t,r,s){t===_d&&OA(ET,r,s),Lx(t);var a=Mx(r);return Lx(s),Uo(np,a)?(s.enumerable?(Uo(t,$c)&&t[$c][a]&&(t[$c][a]=!1),s=_T(s,{enumerable:Ux(0,!1)})):(Uo(t,$c)||F_(t,$c,Ux(1,{})),t[$c][a]=!0),Bx(t,a,s)):F_(t,a,s)},zx=function(t,r){Lx(t);var s=RA(r),a=G6(s).concat(oW(s));return IA(a,function(c){Uv&&!xx(rW,s,c)||OA(t,c,s[c])}),t},rW=function(t){var r=Mx(t),s=xx(rfe,this,r);return!(this===_d&&Uo(np,r)&&!Uo(ET,r))&&(!(s||!Uo(this,r)||!Uo(np,r)||Uo(this,$c)&&this[$c][r])||s)},iW=function(t,r){var s=RA(t),a=Mx(r);if(s!==_d||!Uo(np,a)||Uo(ET,a)){var c=eW(s,a);return!c||!Uo(np,a)||Uo(s,$c)&&s[$c][a]||(c.enumerable=!0),c}},sW=function(t){var r=tW(RA(t)),s=[];return IA(r,function(a){Uo(np,a)||Uo(X6,a)||nW(s,a)}),s},oW=function(t){var r=t===_d,s=tW(r?ET:RA(t)),a=[];return IA(s,function(c){!Uo(np,c)||r&&!Uo(_d,c)||nW(a,np[c])}),a};Vv||(V_=function(){if(Ghe(PA,this))throw nfe("Symbol is not a constructor");var t=arguments.length&&arguments[0]!==void 0?Hhe(arguments[0]):void 0,r=J6(t),s=function(a){this===_d&&xx(s,ET,a),Uo(this,$c)&&Uo(this[$c],r)&&(this[$c][r]=!1),Bx(this,r,Ux(1,a))};return Uv&&jx&&Bx(_d,r,{configurable:!0,set:s}),Wx(r,t)},Y6(PA=V_[yT],"toString",function(){return Z6(this).tag}),Y6(V_,"withoutSetter",function(t){return Wx(J6(t),t)}),q6.f=rW,K6.f=OA,qhe.f=zx,$6.f=iW,$he.f=H6.f=sW,Khe.f=oW,Jhe.f=function(t){return Wx(Xhe(t),t)},Uv&&Yhe(PA,"description",{configurable:!0,get:function(){return Z6(this).description}})),CA({global:!0,wrap:!0,forced:!Vv,sham:!Vv},{Symbol:V_}),IA(G6(ife),function(t){Qhe(t)}),CA({target:AA,stat:!0,forced:!Vv},{useSetter:function(){jx=!0},useSimple:function(){jx=!1}}),CA({target:"Object",stat:!0,forced:!Vv,sham:!Uv},{create:function(t,r){return r===void 0?_T(t):zx(_T(t),r)},defineProperty:OA,defineProperties:zx,getOwnPropertyDescriptor:iW}),CA({target:"Object",stat:!0,forced:!Vv},{getOwnPropertyNames:sW}),Zhe(),efe(V_,AA),X6[$c]=!0;var aW=Js&&!!Symbol.for&&!!Symbol.keyFor,sfe=zn,ofe=tn,afe=Ii,cfe=Da,cW=ac,lfe=aW,Gx=cW("string-to-symbol-registry"),ufe=cW("symbol-to-string-registry");sfe({target:"Symbol",stat:!0,forced:!lfe},{for:function(t){var r=cfe(t);if(afe(Gx,r))return Gx[r];var s=ofe("Symbol")(r);return Gx[r]=s,ufe[s]=r,s}});var dfe=zn,hfe=Ii,ffe=sc,pfe=Pa,mfe=aW,lW=ac("symbol-to-string-registry");dfe({target:"Symbol",stat:!0,forced:!mfe},{keyFor:function(t){if(!ffe(t))throw TypeError(pfe(t)+" is not a symbol");if(hfe(lW,t))return lW[t]}});var uW=t_,gfe=xe,dW=Q,_fe=Da,hW=I([].push),yfe=zn,fW=tn,pW=ie,Efe=Ee,vT=I,mW=d,gW=xe,_W=sc,yW=Cs,vfe=function(t){if(gfe(t))return t;if(uW(t)){for(var r=t.length,s=[],a=0;a<r;a++){var c=t[a];typeof c=="string"?hW(s,c):typeof c!="number"&&dW(c)!="Number"&&dW(c)!="String"||hW(s,_fe(c))}var u=s.length,h=!0;return function(m,y){if(h)return h=!1,y;if(uW(this))return y;for(var v=0;v<u;v++)if(s[v]===m)return y}}},Sfe=Js,bfe=String,zm=fW("JSON","stringify"),kA=vT(/./.exec),EW=vT("".charAt),Tfe=vT("".charCodeAt),wfe=vT("".replace),Cfe=vT(1 .toString),Rfe=/[\uD800-\uDFFF]/g,vW=/^[\uD800-\uDBFF]$/,SW=/^[\uDC00-\uDFFF]$/,bW=!Sfe||mW(function(){var t=fW("Symbol")();return zm([t])!="[null]"||zm({a:t})!="{}"||zm(Object(t))!="{}"}),TW=mW(function(){return zm("\uDF06\uD834")!=='"\\udf06\\ud834"'||zm("\uDEAD")!=='"\\udead"'}),Ife=function(t,r){var s=yW(arguments),a=vfe(r);if(gW(a)||t!==void 0&&!_W(t))return s[1]=function(c,u){if(gW(a)&&(u=Efe(a,this,bfe(c),u)),!_W(u))return u},pW(zm,null,s)},Afe=function(t,r,s){var a=EW(s,r-1),c=EW(s,r+1);return kA(vW,t)&&!kA(SW,c)||kA(SW,t)&&!kA(vW,a)?"\\u"+Cfe(Tfe(t,0),16):t};zm&&yfe({target:"JSON",stat:!0,forced:bW||TW},{stringify:function(t,r,s){var a=yW(arguments),c=pW(bW?Ife:zm,null,a);return TW&&typeof c=="string"?wfe(c,Rfe,Afe):c}});var wW=Mc,Pfe=Yo;zn({target:"Object",stat:!0,forced:!Js||d(function(){wW.f(1)})},{getOwnPropertySymbols:function(t){var r=wW.f;return r?r(Pfe(t)):[]}}),As("asyncIterator"),As("hasInstance"),As("isConcatSpreadable"),As("iterator"),As("match"),As("matchAll"),As("replace"),As("search"),As("species"),As("split");var Ofe=B6;As("toPrimitive"),Ofe();var kfe=tn,Nfe=ld;As("toStringTag"),Nfe(kfe("Symbol"),"Symbol"),As("unscopables"),ld(U.JSON,"JSON",!0);var Dfe=gt.Symbol,xfe=Er,Lfe=nt.f,CW=xfe("metadata"),RW=Function.prototype;RW[CW]===void 0&&Lfe(RW,CW,{value:null}),As("dispose"),As("metadata");var Mfe=Dfe;As("asyncDispose");var Ufe=I,Hx=tn("Symbol"),Vfe=Hx.keyFor,Ffe=Ufe(Hx.prototype.valueOf),IW=Hx.isRegisteredSymbol||function(t){try{return Vfe(Ffe(t))!==void 0}catch{return!1}};zn({target:"Symbol",stat:!0},{isRegisteredSymbol:IW});for(var jfe=ac,AW=tn,Bfe=I,Wfe=sc,zfe=Er,NA=AW("Symbol"),PW=NA.isWellKnownSymbol,OW=AW("Object","getOwnPropertyNames"),Gfe=Bfe(NA.prototype.valueOf),kW=jfe("wks"),$x=0,NW=OW(NA),Hfe=NW.length;$x<Hfe;$x++)try{var DW=NW[$x];Wfe(NA[DW])&&zfe(DW)}catch{}var xW=function(t){if(PW&&PW(t))return!0;try{for(var r=Gfe(t),s=0,a=OW(kW),c=a.length;s<c;s++)if(kW[a[s]]==r)return!0}catch{}return!1};zn({target:"Symbol",stat:!0,forced:!0},{isWellKnownSymbol:xW}),As("matcher"),As("observable"),zn({target:"Symbol",stat:!0},{isRegistered:IW}),zn({target:"Symbol",stat:!0,forced:!0},{isWellKnown:xW}),As("metadataKey"),As("patternMatch"),As("replaceAll");var Fv=l(Mfe),LW=l(Mv.f("iterator"));function ST(t){return ST=typeof Fv=="function"&&typeof LW=="symbol"?function(r){return typeof r}:function(r){return r&&typeof Fv=="function"&&r.constructor===Fv&&r!==Fv.prototype?"symbol":typeof r},ST(t)}var $fe=l(Mv.f("toPrimitive"));function Kfe(t){var r=function(s,a){if(ST(s)!=="object"||s===null)return s;var c=s[$fe];if(c!==void 0){var u=c.call(s,a);if(ST(u)!=="object")return u;throw new TypeError("@@toPrimitive must return a primitive value.")}return(a==="string"?String:Number)(s)}(t,"string");return ST(r)==="symbol"?r:String(r)}function K(t,r,s){return(r=Kfe(r))in t?P6(t,r,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[r]=s,t}var MW=l(Ile),qfe={isBrowser:!0,classes:{URLSearchParams:MW!==void 0?MW:Nx,FormData:typeof FormData<"u"?FormData:null,Blob:typeof Blob<"u"?Blob:null},protocols:["http","https","file","blob","url","data"]};const Kx=typeof window<"u"&&typeof document<"u",qx=typeof navigator=="object"&&navigator||void 0,Yfe=Kx&&(!qx||["ReactNative","NativeScript","NS"].indexOf(qx.product)<0),Xfe=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",Jfe=Kx&&window.location.href||"http://localhost";function UW(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}function VW(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?UW(Object(s),!0).forEach(function(a){K(t,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):UW(Object(s)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))})}return t}var Ba=VW(VW({},Object.freeze({__proto__:null,hasBrowserEnv:Kx,hasStandardBrowserEnv:Yfe,hasStandardBrowserWebWorkerEnv:Xfe,navigator:qx,origin:Jfe})),qfe),Qfe=fn,Zfe=Ee,epe=Ii,tpe=O,npe=function(){var t=Qfe(this),r="";return t.hasIndices&&(r+="d"),t.global&&(r+="g"),t.ignoreCase&&(r+="i"),t.multiline&&(r+="m"),t.dotAll&&(r+="s"),t.unicode&&(r+="u"),t.unicodeSets&&(r+="v"),t.sticky&&(r+="y"),r},FW=RegExp.prototype,jW=function(t){var r=t.flags;return r!==void 0||"flags"in FW||epe(t,"flags")||!tpe(FW,t)?r:Zfe(npe,t)},rpe=OD.charAt,BW=Ee,ipe=fn,spe=xe,ope=Q,ape=/./.exec,cpe=TypeError,lpe=zn,WW=Ee,zW=re,upe=BE,DA=$E,GW=Xt,HW=Vt,bT=Da,dpe=fn,hpe=Ft,fpe=Q,ppe=xR,$W=jW,mpe=_i,gpe=d,_pe=as,ype=function(t,r,s){return r+(s?rpe(t,r).length:1)},Epe=function(t,r){var s=t.exec;if(spe(s)){var a=BW(s,t,r);return a!==null&&ipe(a),a}if(ope(t)==="RegExp")return BW(ape,t,r);throw cpe("RegExp#exec called on incompatible receiver")},KW=ad,vpe=Er("matchAll"),qW="RegExp String",YW=qW+" Iterator",Spe=KW.set,bpe=KW.getterFor(YW),Tpe=TypeError,Yx=zW("".indexOf),xA=zW("".matchAll),Xx=!!xA&&!gpe(function(){xA("a",/./)}),wpe=upe(function(t,r,s,a){Spe(this,{type:YW,regexp:t,string:r,global:s,unicode:a,done:!1})},qW,function(){var t=bpe(this);if(t.done)return DA(void 0,!0);var r=t.regexp,s=t.string,a=Epe(r,s);return a===null?(t.done=!0,DA(void 0,!0)):t.global?(bT(a[0])===""&&(r.lastIndex=ype(s,HW(r.lastIndex),t.unicode)),DA(a,!1)):(t.done=!0,DA(a,!1))}),XW=function(t){var r,s,a,c=dpe(this),u=bT(t),h=_pe(c,RegExp),m=bT($W(c));return r=new h(h===RegExp?c.source:c,m),s=!!~Yx(m,"g"),a=!!~Yx(m,"u"),r.lastIndex=HW(c.lastIndex),new wpe(r,u,s,a)};lpe({target:"String",proto:!0,forced:Xx},{matchAll:function(t){var r,s,a,c,u=GW(this);if(hpe(t)){if(Xx)return xA(u,t)}else{if(ppe(t)&&(r=bT(GW($W(t))),!~Yx(r,"g")))throw Tpe("`.matchAll` does not allow non-global regexes");if(Xx)return xA(u,t);if((a=mpe(t,vpe))===void 0&&fpe(t)=="RegExp"&&(a=XW),a)return WW(a,t,u)}return s=bT(u),c=new RegExp(t,"g"),WW(XW,c,s)}});var Cpe=dc("String").matchAll,Rpe=O,Ipe=Cpe,Jx=String.prototype,Ape=function(t){var r=t.matchAll;return typeof t=="string"||t===Jx||Rpe(Jx,t)&&r===Jx.matchAll?Ipe:r},Ppe=l(Ape);function JW(t){function r(s,a,c,u){let h=s[u++];if(h==="__proto__")return!0;const m=Number.isFinite(+h),y=u>=s.length;return h=!h&&ct.isArray(c)?c.length:h,y?(ct.hasOwnProp(c,h)?c[h]=[c[h],a]:c[h]=a,!m):(c[h]&&ct.isObject(c[h])||(c[h]=[]),r(s,a,c[h],u)&&ct.isArray(c[h])&&(c[h]=function(v){const S={},R=Object.keys(v);let P;const D=R.length;let G;for(P=0;P<D;P++)G=R[P],S[G]=v[G];return S}(c[h])),!m)}if(ct.isFormData(t)&&ct.isFunction(t.entries)){const s={};return ct.forEachEntry(t,(a,c)=>{r(function(u){return Ppe(ct).call(ct,/\w+|\[(\w*)]/g,u).map(h=>h[0]==="[]"?"":h[1]||h[0])}(a),c,s,0)}),s}return null}const Qx={transitional:C6,adapter:["xhr","http","fetch"],transformRequest:[function(t,r){const s=r.getContentType()||"",a=s.indexOf("application/json")>-1,c=ct.isObject(t);if(c&&ct.isHTMLForm(t)&&(t=new FormData(t)),ct.isFormData(t))return a?JSON.stringify(JW(t)):t;if(ct.isArrayBuffer(t)||ct.isBuffer(t)||ct.isStream(t)||ct.isFile(t)||ct.isBlob(t)||ct.isReadableStream(t))return t;if(ct.isArrayBufferView(t))return t.buffer;if(ct.isURLSearchParams(t))return r.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),t.toString();let u;if(c){if(s.indexOf("application/x-www-form-urlencoded")>-1)return function(h,m){return wA(h,new Ba.classes.URLSearchParams,Object.assign({visitor:function(y,v,S,R){return Ba.isNode&&ct.isBuffer(y)?(this.append(v,y.toString("base64")),!1):R.defaultVisitor.apply(this,arguments)}},m))}(t,this.formSerializer).toString();if((u=ct.isFileList(t))||s.indexOf("multipart/form-data")>-1){const h=this.env&&this.env.FormData;return wA(u?{"files[]":t}:t,h&&new h,this.formSerializer)}}return c||a?(r.setContentType("application/json",!1),function(h,m,y){if(ct.isString(h))try{return(m||JSON.parse)(h),_o(ct).call(ct,h)}catch(v){if(v.name!=="SyntaxError")throw v}return(y||JSON.stringify)(h)}(t)):t}],transformResponse:[function(t){const r=this.transitional||Qx.transitional,s=r&&r.forcedJSONParsing,a=this.responseType==="json";if(ct.isResponse(t)||ct.isReadableStream(t))return t;if(t&&ct.isString(t)&&(s&&!this.responseType||a)){const c=!(r&&r.silentJSONParsing)&&a;try{return JSON.parse(t)}catch(u){if(c)throw u.name==="SyntaxError"?sr.from(u,sr.ERR_BAD_RESPONSE,this,null,this.response):u}}return t}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Ba.classes.FormData,Blob:Ba.classes.Blob},validateStatus:function(t){return t>=200&&t<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};ct.forEach(["delete","get","head","post","put","patch"],t=>{Qx.headers[t]={}});var Zx=Qx;const Ope=ct.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),QW=Symbol("internals");function TT(t){var r;return t&&_o(r=String(t)).call(r).toLowerCase()}function LA(t){return t===!1||t==null?t:ct.isArray(t)?t.map(LA):String(t)}function eL(t,r,s,a,c){return ct.isFunction(a)?a.call(this,r,s):(c&&(r=s),ct.isString(r)?ct.isString(a)?r.indexOf(a)!==-1:ct.isRegExp(a)?a.test(r):void 0:void 0)}class MA{constructor(r){r&&this.set(r)}set(r,s,a){const c=this;function u(y,v,S){const R=TT(v);if(!R)throw new Error("header name must be a non-empty string");const P=ct.findKey(c,R);(!P||c[P]===void 0||S===!0||S===void 0&&c[P]!==!1)&&(c[P||v]=LA(y))}const h=(y,v)=>ct.forEach(y,(S,R)=>u(S,R,v));if(ct.isPlainObject(r)||r instanceof this.constructor)h(r,s);else if(ct.isString(r)&&(r=_o(r).call(r))&&!/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(_o(m=r).call(m)))h((y=>{const v={};let S,R,P;return y&&y.split(`
`).forEach(function(D){var G,F;P=D.indexOf(":"),S=_o(G=D.substring(0,P)).call(G).toLowerCase(),R=_o(F=D.substring(P+1)).call(F),!S||v[S]&&Ope[S]||(S==="set-cookie"?v[S]?v[S].push(R):v[S]=[R]:v[S]=v[S]?v[S]+", "+R:R)}),v})(r),s);else if(ct.isHeaders(r))for(const[y,v]of r.entries())u(v,y,a);else r!=null&&u(s,r,a);var m;return this}get(r,s){if(r=TT(r)){const a=ct.findKey(this,r);if(a){const c=this[a];if(!s)return c;if(s===!0)return function(u){const h=Object.create(null),m=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let y;for(;y=m.exec(u);)h[y[1]]=y[2];return h}(c);if(ct.isFunction(s))return s.call(this,c,a);if(ct.isRegExp(s))return s.exec(c);throw new TypeError("parser must be boolean|regexp|function")}}}has(r,s){if(r=TT(r)){const a=ct.findKey(this,r);return!(!a||this[a]===void 0||s&&!eL(0,this[a],a,s))}return!1}delete(r,s){const a=this;let c=!1;function u(h){if(h=TT(h)){const m=ct.findKey(a,h);!m||s&&!eL(0,a[m],m,s)||(delete a[m],c=!0)}}return ct.isArray(r)?r.forEach(u):u(r),c}clear(r){const s=Object.keys(this);let a=s.length,c=!1;for(;a--;){const u=s[a];r&&!eL(0,this[u],u,r,!0)||(delete this[u],c=!0)}return c}normalize(r){const s=this,a={};return ct.forEach(this,(c,u)=>{var h;const m=ct.findKey(a,u);if(m)return s[m]=LA(c),void delete s[u];const y=r?function(v){return _o(v).call(v).toLowerCase().replace(/([a-z\d])(\w*)/g,(S,R,P)=>R.toUpperCase()+P)}(u):_o(h=String(u)).call(h);y!==u&&delete s[u],s[y]=LA(c),a[y]=!0}),this}concat(){for(var r=arguments.length,s=new Array(r),a=0;a<r;a++)s[a]=arguments[a];return this.constructor.concat(this,...s)}toJSON(r){const s=Object.create(null);return ct.forEach(this,(a,c)=>{a!=null&&a!==!1&&(s[c]=r&&ct.isArray(a)?a.join(", "):a)}),s}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(r=>{let[s,a]=r;return s+": "+a}).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(r){return r instanceof this?r:new this(r)}static concat(r){const s=new this(r);for(var a=arguments.length,c=new Array(a>1?a-1:0),u=1;u<a;u++)c[u-1]=arguments[u];return c.forEach(h=>s.set(h)),s}static accessor(r){const s=(this[QW]=this[QW]={accessors:{}}).accessors,a=this.prototype;function c(u){const h=TT(u);s[h]||(function(m,y){const v=ct.toCamelCase(" "+y);["get","set","has"].forEach(S=>{Object.defineProperty(m,S+v,{value:function(R,P,D){return this[S].call(this,y,R,P,D)},configurable:!0})})}(a,u),s[h]=!0)}return ct.isArray(r)?r.forEach(c):c(r),this}}MA.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),ct.reduceDescriptors(MA.prototype,(t,r)=>{let{value:s}=t,a=r[0].toUpperCase()+r.slice(1);return{get:()=>s,set(c){this[a]=c}}}),ct.freezeMethods(MA);var yd=MA;function tL(t,r){const s=this||Zx,a=r||s,c=yd.from(a.headers);let u=a.data;return ct.forEach(t,function(h){u=h.call(s,u,c.normalize(),r?r.status:void 0)}),c.normalize(),u}function ZW(t){return!(!t||!t.__CANCEL__)}function jv(t,r,s){sr.call(this,t??"canceled",sr.ERR_CANCELED,r,s),this.name="CanceledError"}function e8(t,r,s){const a=s.config.validateStatus;s.status&&a&&!a(s.status)?r(new sr("Request failed with status code "+s.status,[sr.ERR_BAD_REQUEST,sr.ERR_BAD_RESPONSE][Math.floor(s.status/100)-4],s.config,s.request,s)):t(s)}ct.inherits(jv,sr,{__CANCEL__:!0});const UA=function(t,r){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:3,a=0;const c=function(u,h){u=u||10;const m=new Array(u),y=new Array(u);let v,S=0,R=0;return h=h!==void 0?h:1e3,function(P){const D=Date.now(),G=y[R];v||(v=D),m[S]=P,y[S]=D;let F=R,j=0;for(;F!==S;)j+=m[F++],F%=u;if(S=(S+1)%u,S===R&&(R=(R+1)%u),D-v<h)return;const Y=G&&D-G;return Y?Math.round(1e3*j/Y):void 0}}(50,250);return function(u,h){let m,y,v=0,S=1e3/h;const R=function(P){v=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Date.now(),m=null,y&&(clearTimeout(y),y=null),u.apply(null,P)};return[function(){const P=Date.now(),D=P-v;for(var G=arguments.length,F=new Array(G),j=0;j<G;j++)F[j]=arguments[j];D>=S?R(F,P):(m=F,y||(y=setTimeout(()=>{y=null,R(m)},S-D)))},()=>m&&R(m)]}(u=>{const h=u.loaded,m=u.lengthComputable?u.total:void 0,y=h-a,v=c(y);a=h,t({loaded:h,total:m,progress:m?h/m:void 0,bytes:y,rate:v||void 0,estimated:v&&m&&h<=m?(m-h)/v:void 0,event:u,lengthComputable:m!=null,[r?"download":"upload"]:!0})},s)},t8=(t,r)=>{const s=t!=null;return[a=>r[0]({lengthComputable:s,total:t,loaded:a}),r[1]]},n8=t=>function(){for(var r=arguments.length,s=new Array(r),a=0;a<r;a++)s[a]=arguments[a];return ct.asap(()=>t(...s))};var kpe=Ba.hasStandardBrowserEnv?((t,r)=>s=>(s=new hA(s,Ba.origin),t.protocol===s.protocol&&t.host===s.host&&(r||t.port===s.port)))(new hA(Ba.origin),Ba.navigator&&/(msie|trident)/i.test(Ba.navigator.userAgent)):()=>!0,Npe=Ba.hasStandardBrowserEnv?{write(t,r,s,a,c,u){const h=[t+"="+encodeURIComponent(r)];ct.isNumber(s)&&h.push("expires="+new Date(s).toGMTString()),ct.isString(a)&&h.push("path="+a),ct.isString(c)&&h.push("domain="+c),u===!0&&h.push("secure"),document.cookie=h.join("; ")},read(t){const r=document.cookie.match(new RegExp("(^|;\\s*)("+t+")=([^;]*)"));return r?decodeURIComponent(r[3]):null},remove(t){this.write(t,"",Date.now()-864e5)}}:{write(){},read:()=>null,remove(){}};function r8(t,r){return t&&!function(s){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(s)}(r)?function(s,a){return a?s.replace(/\/?\/$/,"")+"/"+a.replace(/^\/+/,""):s}(t,r):r}function i8(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}const s8=t=>t instanceof yd?function(r){for(var s=1;s<arguments.length;s++){var a=arguments[s]!=null?arguments[s]:{};s%2?i8(Object(a),!0).forEach(function(c){K(r,c,a[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(a)):i8(Object(a)).forEach(function(c){Object.defineProperty(r,c,Object.getOwnPropertyDescriptor(a,c))})}return r}({},t):t;function j_(t,r){r=r||{};const s={};function a(v,S,R,P){return ct.isPlainObject(v)&&ct.isPlainObject(S)?ct.merge.call({caseless:P},v,S):ct.isPlainObject(S)?ct.merge({},S):ct.isArray(S)?S.slice():S}function c(v,S,R,P){return ct.isUndefined(S)?ct.isUndefined(v)?void 0:a(void 0,v,0,P):a(v,S,0,P)}function u(v,S){if(!ct.isUndefined(S))return a(void 0,S)}function h(v,S){return ct.isUndefined(S)?ct.isUndefined(v)?void 0:a(void 0,v):a(void 0,S)}function m(v,S,R){return R in r?a(v,S):R in t?a(void 0,v):void 0}const y={url:u,method:u,data:u,baseURL:h,transformRequest:h,transformResponse:h,paramsSerializer:h,timeout:h,timeoutMessage:h,withCredentials:h,withXSRFToken:h,adapter:h,responseType:h,xsrfCookieName:h,xsrfHeaderName:h,onUploadProgress:h,onDownloadProgress:h,decompress:h,maxContentLength:h,maxBodyLength:h,beforeRedirect:h,transport:h,httpAgent:h,httpsAgent:h,cancelToken:h,socketPath:h,responseEncoding:h,validateStatus:m,headers:(v,S,R)=>c(s8(v),s8(S),0,!0)};return ct.forEach(Object.keys(Object.assign({},t,r)),function(v){const S=y[v]||c,R=S(t[v],r[v],v);ct.isUndefined(R)&&S!==m||(s[v]=R)}),s}var o8=t=>{const r=j_({},t);let s,{data:a,withXSRFToken:c,xsrfHeaderName:u,xsrfCookieName:h,headers:m,auth:y}=r;if(r.headers=m=yd.from(m),r.url=T6(r8(r.baseURL,r.url),t.params,t.paramsSerializer),y&&m.set("Authorization","Basic "+btoa((y.username||"")+":"+(y.password?unescape(encodeURIComponent(y.password)):""))),ct.isFormData(a)){if(Ba.hasStandardBrowserEnv||Ba.hasStandardBrowserWebWorkerEnv)m.setContentType(void 0);else if((s=m.getContentType())!==!1){const[v,...S]=s?s.split(";").map(R=>_o(R).call(R)).filter(Boolean):[];m.setContentType([v||"multipart/form-data",...S].join("; "))}}if(Ba.hasStandardBrowserEnv&&(c&&ct.isFunction(c)&&(c=c(r)),c||c!==!1&&kpe(r.url))){const v=u&&h&&Npe.read(h);v&&m.set(u,v)}return r},Dpe=typeof XMLHttpRequest<"u"&&function(t){return new dt(function(r,s){const a=o8(t);let c=a.data;const u=yd.from(a.headers).normalize();let h,m,y,v,S,{responseType:R,onUploadProgress:P,onDownloadProgress:D}=a;function G(){v&&v(),S&&S(),a.cancelToken&&a.cancelToken.unsubscribe(h),a.signal&&a.signal.removeEventListener("abort",h)}let F=new XMLHttpRequest;function j(){if(!F)return;const ee=yd.from("getAllResponseHeaders"in F&&F.getAllResponseHeaders());e8(function(fe){r(fe),G()},function(fe){s(fe),G()},{data:R&&R!=="text"&&R!=="json"?F.response:F.responseText,status:F.status,statusText:F.statusText,headers:ee,config:t,request:F}),F=null}F.open(a.method.toUpperCase(),a.url,!0),F.timeout=a.timeout,"onloadend"in F?F.onloadend=j:F.onreadystatechange=function(){F&&F.readyState===4&&(F.status!==0||F.responseURL&&F.responseURL.indexOf("file:")===0)&&setTimeout(j)},F.onabort=function(){F&&(s(new sr("Request aborted",sr.ECONNABORTED,t,F)),F=null)},F.onerror=function(){s(new sr("Network Error",sr.ERR_NETWORK,t,F)),F=null},F.ontimeout=function(){let ee=a.timeout?"timeout of "+a.timeout+"ms exceeded":"timeout exceeded";const fe=a.transitional||C6;a.timeoutErrorMessage&&(ee=a.timeoutErrorMessage),s(new sr(ee,fe.clarifyTimeoutError?sr.ETIMEDOUT:sr.ECONNABORTED,t,F)),F=null},c===void 0&&u.setContentType(null),"setRequestHeader"in F&&ct.forEach(u.toJSON(),function(ee,fe){F.setRequestHeader(fe,ee)}),ct.isUndefined(a.withCredentials)||(F.withCredentials=!!a.withCredentials),R&&R!=="json"&&(F.responseType=a.responseType),D&&([y,S]=UA(D,!0),F.addEventListener("progress",y)),P&&F.upload&&([m,v]=UA(P),F.upload.addEventListener("progress",m),F.upload.addEventListener("loadend",v)),(a.cancelToken||a.signal)&&(h=ee=>{F&&(s(!ee||ee.type?new jv(null,t,F):ee),F.abort(),F=null)},a.cancelToken&&a.cancelToken.subscribe(h),a.signal&&(a.signal.aborted?h():a.signal.addEventListener("abort",h)));const Y=function(ee){const fe=/^([-+\w]{1,25})(:?\/\/|:)/.exec(ee);return fe&&fe[1]||""}(a.url);Y&&Ba.protocols.indexOf(Y)===-1?s(new sr("Unsupported protocol "+Y+":",sr.ERR_BAD_REQUEST,t)):F.send(c||null)})},xpe=(t,r)=>{const{length:s}=t=t?t.filter(Boolean):[];if(r||s){let a,c=new AbortController;const u=function(v){if(!a){a=!0,m();const S=v instanceof Error?v:this.reason;c.abort(S instanceof sr?S:new jv(S instanceof Error?S.message:S))}};let h=r&&setTimeout(()=>{h=null,u(new sr("timeout ".concat(r," of ms exceeded"),sr.ETIMEDOUT))},r);const m=()=>{t&&(h&&clearTimeout(h),h=null,t.forEach(v=>{v.unsubscribe?v.unsubscribe(u):v.removeEventListener("abort",u)}),t=null)};t.forEach(v=>v.addEventListener("abort",u));const{signal:y}=c;return y.unsubscribe=()=>ct.asap(m),y}},Lpe=Q3,Mpe=Cl;zn({target:"Promise",stat:!0,forced:!0},{withResolvers:function(){var t=Mpe.f(this);return{promise:t.promise,resolve:t.resolve,reject:t.reject}}});var Upe=Cl,Vpe=ph;zn({target:"Promise",stat:!0,forced:!0},{try:function(t){var r=Upe.f(this),s=Vpe(t);return(s.error?r.reject:r.resolve)(s.value),r.promise}});var nL=l(Lpe),a8=Mv.f("asyncIterator"),Fpe=l(a8);function rL(t,r){this.v=t,this.k=r}function wT(t){var r,s;function a(u,h){try{var m=t[u](h),y=m.value,v=y instanceof rL;nL.resolve(v?y.v:y).then(function(S){if(v){var R=u==="return"?"return":"next";if(!y.k||S.done)return a(R,S);S=t[R](S).value}c(m.done?"return":"normal",S)},function(S){a("throw",S)})}catch(S){c("throw",S)}}function c(u,h){switch(u){case"return":r.resolve({value:h,done:!0});break;case"throw":r.reject(h);break;default:r.resolve({value:h,done:!1})}(r=r.next)?a(r.key,r.arg):s=null}this._invoke=function(u,h){return new nL(function(m,y){var v={key:u,arg:h,resolve:m,reject:y,next:null};s?s=s.next=v:(r=s=v,a(u,h))})},typeof t.return!="function"&&(this.return=void 0)}function Il(t){return function(){return new wT(t.apply(this,arguments))}}function Nn(t){return new rL(t,0)}function VA(t){var r={},s=!1;function a(c,u){return s=!0,{done:!1,value:new rL(u=new nL(function(h){h(t[c](u))}),1)}}return r[Fv!==void 0&&LW||"@@iterator"]=function(){return this},r.next=function(c){return s?(s=!1,c):a("next",c)},typeof t.throw=="function"&&(r.throw=function(c){if(s)throw s=!1,c;return a("throw",c)}),typeof t.return=="function"&&(r.return=function(c){return s?(s=!1,c):a("return",c)}),r}wT.prototype[typeof Fv=="function"&&Fpe||"@@asyncIterator"]=function(){return this},wT.prototype.next=function(t){return this._invoke("next",t)},wT.prototype.throw=function(t){return this._invoke("throw",t)},wT.prototype.return=function(t){return this._invoke("return",t)};var iL=l(a8);function sL(t){var r,s,a,c=2;for(typeof Symbol<"u"&&(s=iL,a=Symbol.iterator);c--;){if(s&&(r=t[s])!=null)return r.call(t);if(a&&(r=t[a])!=null)return new FA(r.call(t));s="@@asyncIterator",a="@@iterator"}throw new TypeError("Object is not async iterable")}function FA(t){function r(s){if(Object(s)!==s)return dt.reject(new TypeError(s+" is not an object."));var a=s.done;return dt.resolve(s.value).then(function(c){return{value:c,done:a}})}return FA=function(s){this.s=s,this.n=s.next},FA.prototype={s:null,n:null,next:function(){return r(this.n.apply(this.s,arguments))},return:function(s){var a=this.s.return;return a===void 0?dt.resolve({value:s,done:!0}):r(a.apply(this.s,arguments))},throw:function(s){var a=this.s.return;return a===void 0?dt.reject(s):r(a.apply(this.s,arguments))}},new FA(t)}const jpe=function*(t,r){let s=t.byteLength;if(!r||s<r)return void(yield t);let a,c=0;for(;c<s;)a=c+r,yield t.slice(c,a),c=a},Bpe=function(){var t=Il(function*(r,s){var a,c=!1,u=!1;try{for(var h,m=sL(Wpe(r));c=!(h=yield Nn(m.next())).done;c=!1){const y=h.value;yield*VA(sL(jpe(y,s)))}}catch(y){u=!0,a=y}finally{try{c&&m.return!=null&&(yield Nn(m.return()))}finally{if(u)throw a}}});return function(r,s){return t.apply(this,arguments)}}(),Wpe=function(){var t=Il(function*(r){if(r[iL])return void(yield*VA(sL(r)));const s=r.getReader();try{for(;;){const{done:a,value:c}=yield Nn(s.read());if(a)break;yield c}}finally{yield Nn(s.cancel())}});return function(r){return t.apply(this,arguments)}}(),c8=(t,r,s,a)=>{const c=Bpe(t,r);let u,h=0,m=y=>{u||(u=!0,a&&a(y))};return new ReadableStream({async pull(y){try{const{done:v,value:S}=await c.next();if(v)return m(),void y.close();let R=S.byteLength;if(s){let P=h+=R;s(P)}y.enqueue(new Uint8Array(S))}catch(v){throw m(v),v}},cancel:y=>(m(y),c.return())},{highWaterMark:2})};function l8(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}function u8(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?l8(Object(s),!0).forEach(function(a){K(t,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):l8(Object(s)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))})}return t}const jA=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",d8=jA&&typeof ReadableStream=="function",zpe=jA&&(typeof TextEncoder=="function"?(h8=new TextEncoder,t=>h8.encode(t)):async t=>new Uint8Array(await new Response(t).arrayBuffer()));var h8;const f8=function(t){try{for(var r=arguments.length,s=new Array(r>1?r-1:0),a=1;a<r;a++)s[a-1]=arguments[a];return!!t(...s)}catch{return!1}},Gpe=d8&&f8(()=>{let t=!1;const r=new Request(Ba.origin,{body:new ReadableStream,method:"POST",get duplex(){return t=!0,"half"}}).headers.has("Content-Type");return t&&!r}),oL=d8&&f8(()=>ct.isReadableStream(new Response("").body)),BA={stream:oL&&(t=>t.body)};var p8;jA&&(p8=new Response,["text","arrayBuffer","blob","formData","stream"].forEach(t=>{!BA[t]&&(BA[t]=ct.isFunction(p8[t])?r=>r[t]():(r,s)=>{throw new sr("Response type '".concat(t,"' is not supported"),sr.ERR_NOT_SUPPORT,s)})}));const Hpe=async(t,r)=>{const s=ct.toFiniteNumber(t.getContentLength());return s??(async a=>a==null?0:ct.isBlob(a)?a.size:ct.isSpecCompliantForm(a)?(await new Request(Ba.origin,{method:"POST",body:a}).arrayBuffer()).byteLength:ct.isArrayBufferView(a)||ct.isArrayBuffer(a)?a.byteLength:(ct.isURLSearchParams(a)&&(a+=""),ct.isString(a)?(await zpe(a)).byteLength:void 0))(r)};var $pe=jA&&(async t=>{let{url:r,method:s,data:a,signal:c,cancelToken:u,timeout:h,onDownloadProgress:m,onUploadProgress:y,responseType:v,headers:S,withCredentials:R="same-origin",fetchOptions:P}=o8(t);v=v?(v+"").toLowerCase():"text";let D,G=xpe([c,u&&u.toAbortSignal()],h);const F=G&&G.unsubscribe&&(()=>{G.unsubscribe()});let j;try{if(y&&Gpe&&s!=="get"&&s!=="head"&&(j=await Hpe(S,a))!==0){let we,ye=new Request(r,{method:"POST",body:a,duplex:"half"});if(ct.isFormData(a)&&(we=ye.headers.get("content-type"))&&S.setContentType(we),ye.body){const[Ne,Ye]=t8(j,UA(n8(y)));a=c8(ye.body,65536,Ne,Ye)}}ct.isString(R)||(R=R?"include":"omit");const Y="credentials"in Request.prototype;D=new Request(r,u8(u8({},P),{},{signal:G,method:s.toUpperCase(),headers:S.normalize().toJSON(),body:a,duplex:"half",credentials:Y?R:void 0}));let ee=await fetch(D);const fe=oL&&(v==="stream"||v==="response");if(oL&&(m||fe&&F)){const we={};["status","statusText","headers"].forEach(ht=>{we[ht]=ee[ht]});const ye=ct.toFiniteNumber(ee.headers.get("content-length")),[Ne,Ye]=m&&t8(ye,UA(n8(m),!0))||[];ee=new Response(c8(ee.body,65536,Ne,()=>{Ye&&Ye(),F&&F()}),we)}v=v||"text";let Se=await BA[ct.findKey(BA,v)||"text"](ee,t);return!fe&&F&&F(),await new dt((we,ye)=>{e8(we,ye,{data:Se,headers:yd.from(ee.headers),status:ee.status,statusText:ee.statusText,config:t,request:D})})}catch(Y){throw F&&F(),Y&&Y.name==="TypeError"&&/fetch/i.test(Y.message)?Object.assign(new sr("Network Error",sr.ERR_NETWORK,t,D),{cause:Y.cause||Y}):sr.from(Y,Y&&Y.code,t,D)}});const aL={http:null,xhr:Dpe,fetch:$pe};ct.forEach(aL,(t,r)=>{if(t){try{Object.defineProperty(t,"name",{value:r})}catch{}Object.defineProperty(t,"adapterName",{value:r})}});const m8=t=>"- ".concat(t),Kpe=t=>ct.isFunction(t)||t===null||t===!1;var g8={getAdapter:t=>{t=ct.isArray(t)?t:[t];const{length:r}=t;let s,a;const c={};for(let u=0;u<r;u++){let h;if(s=t[u],a=s,!Kpe(s)&&(a=aL[(h=String(s)).toLowerCase()],a===void 0))throw new sr("Unknown adapter '".concat(h,"'"));if(a)break;c[h||"#"+u]=a}if(!a){const u=Object.entries(c).map(h=>{let[m,y]=h;return"adapter ".concat(m," ")+(y===!1?"is not supported by the environment":"is not available in the build")});throw new sr("There is no suitable adapter to dispatch the request "+(r?u.length>1?`since :
`+u.map(m8).join(`
`):" "+m8(u[0]):"as no adapter specified"),"ERR_NOT_SUPPORT")}return a},adapters:aL};function cL(t){if(t.cancelToken&&t.cancelToken.throwIfRequested(),t.signal&&t.signal.aborted)throw new jv(null,t)}function _8(t){return cL(t),t.headers=yd.from(t.headers),t.data=tL.call(t,t.transformRequest),["post","put","patch"].indexOf(t.method)!==-1&&t.headers.setContentType("application/x-www-form-urlencoded",!1),g8.getAdapter(t.adapter||Zx.adapter)(t).then(function(r){return cL(t),r.data=tL.call(t,t.transformResponse,r),r.headers=yd.from(r.headers),r},function(r){return ZW(r)||(cL(t),r&&r.response&&(r.response.data=tL.call(t,t.transformResponse,r.response),r.response.headers=yd.from(r.response.headers))),dt.reject(r)})}const y8="1.7.9",WA={};["object","boolean","number","function","string","symbol"].forEach((t,r)=>{WA[t]=function(s){return typeof s===t||"a"+(r<1?"n ":" ")+t}});const E8={};WA.transitional=function(t,r,s){function a(c,u){return"[Axios v"+y8+"] Transitional option '"+c+"'"+u+(s?". "+s:"")}return(c,u,h)=>{if(t===!1)throw new sr(a(u," has been removed"+(r?" in "+r:"")),sr.ERR_DEPRECATED);return r&&!E8[u]&&(E8[u]=!0,console.warn(a(u," has been deprecated since v"+r+" and will be removed in the near future"))),!t||t(c,u,h)}},WA.spelling=function(t){return(r,s)=>(console.warn("".concat(s," is likely a misspelling of ").concat(t)),!0)};var zA={assertOptions:function(t,r,s){if(typeof t!="object")throw new sr("options must be an object",sr.ERR_BAD_OPTION_VALUE);const a=Object.keys(t);let c=a.length;for(;c-- >0;){const u=a[c],h=r[u];if(h){const m=t[u],y=m===void 0||h(m,u,t);if(y!==!0)throw new sr("option "+u+" must be "+y,sr.ERR_BAD_OPTION_VALUE)}else if(s!==!0)throw new sr("Unknown option "+u,sr.ERR_BAD_OPTION)}},validators:WA};const vh=zA.validators;let GA=class{constructor(t){this.defaults=t,this.interceptors={request:new w6,response:new w6}}async request(t,r){try{return await this._request(t,r)}catch(s){if(s instanceof Error){let a={};Error.captureStackTrace?Error.captureStackTrace(a):a=new Error;const c=a.stack?a.stack.replace(/^.+\n/,""):"";try{s.stack?c&&!String(s.stack).endsWith(c.replace(/^.+\n.+\n/,""))&&(s.stack+=`
`+c):s.stack=c}catch{}}throw s}}_request(t,r){typeof t=="string"?(r=r||{}).url=t:r=t||{},r=j_(this.defaults,r);const{transitional:s,paramsSerializer:a,headers:c}=r;s!==void 0&&zA.assertOptions(s,{silentJSONParsing:vh.transitional(vh.boolean),forcedJSONParsing:vh.transitional(vh.boolean),clarifyTimeoutError:vh.transitional(vh.boolean)},!1),a!=null&&(ct.isFunction(a)?r.paramsSerializer={serialize:a}:zA.assertOptions(a,{encode:vh.function,serialize:vh.function},!0)),zA.assertOptions(r,{baseUrl:vh.spelling("baseURL"),withXsrfToken:vh.spelling("withXSRFToken")},!0),r.method=(r.method||this.defaults.method||"get").toLowerCase();let u=c&&ct.merge(c.common,c[r.method]);c&&ct.forEach(["delete","get","head","post","put","patch","common"],D=>{delete c[D]}),r.headers=yd.concat(u,c);const h=[];let m=!0;this.interceptors.request.forEach(function(D){typeof D.runWhen=="function"&&D.runWhen(r)===!1||(m=m&&D.synchronous,h.unshift(D.fulfilled,D.rejected))});const y=[];let v;this.interceptors.response.forEach(function(D){y.push(D.fulfilled,D.rejected)});let S,R=0;if(!m){const D=[_8.bind(this),void 0];for(D.unshift.apply(D,h),D.push.apply(D,y),S=D.length,v=dt.resolve(r);R<S;)v=v.then(D[R++],D[R++]);return v}S=h.length;let P=r;for(R=0;R<S;){const D=h[R++],G=h[R++];try{P=D(P)}catch(F){G.call(this,F);break}}try{v=_8.call(this,P)}catch(D){return dt.reject(D)}for(R=0,S=y.length;R<S;)v=v.then(y[R++],y[R++]);return v}getUri(t){return T6(r8((t=j_(this.defaults,t)).baseURL,t.url),t.params,t.paramsSerializer)}};ct.forEach(["delete","get","head","options"],function(t){GA.prototype[t]=function(r,s){return this.request(j_(s||{},{method:t,url:r,data:(s||{}).data}))}}),ct.forEach(["post","put","patch"],function(t){function r(s){return function(a,c,u){return this.request(j_(u||{},{method:t,headers:s?{"Content-Type":"multipart/form-data"}:{},url:a,data:c}))}}GA.prototype[t]=r(),GA.prototype[t+"Form"]=r(!0)});var HA=GA;class lL{constructor(r){if(typeof r!="function")throw new TypeError("executor must be a function.");let s;this.promise=new dt(function(c){s=c});const a=this;this.promise.then(c=>{if(!a._listeners)return;let u=a._listeners.length;for(;u-- >0;)a._listeners[u](c);a._listeners=null}),this.promise.then=c=>{let u;const h=new dt(m=>{a.subscribe(m),u=m}).then(c);return h.cancel=function(){a.unsubscribe(u)},h},r(function(c,u,h){a.reason||(a.reason=new jv(c,u,h),s(a.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(r){this.reason?r(this.reason):this._listeners?this._listeners.push(r):this._listeners=[r]}unsubscribe(r){if(!this._listeners)return;const s=this._listeners.indexOf(r);s!==-1&&this._listeners.splice(s,1)}toAbortSignal(){const r=new AbortController,s=a=>{r.abort(a)};return this.subscribe(s),r.signal.unsubscribe=()=>this.unsubscribe(s),r.signal}static source(){let r;return{token:new lL(function(a){r=a}),cancel:r}}}var qpe=lL;const uL={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(uL).forEach(t=>{let[r,s]=t;uL[s]=r});var Ype=uL;const eo=function t(r){const s=new HA(r),a=s6(HA.prototype.request,s);return ct.extend(a,HA.prototype,s,{allOwnKeys:!0}),ct.extend(a,s,null,{allOwnKeys:!0}),a.create=function(c){return t(j_(r,c))},a}(Zx);eo.Axios=HA,eo.CanceledError=jv,eo.CancelToken=qpe,eo.isCancel=ZW,eo.VERSION=y8,eo.toFormData=wA,eo.AxiosError=sr,eo.Cancel=eo.CanceledError,eo.all=function(t){return dt.all(t)},eo.spread=function(t){return function(r){return t.apply(null,r)}},eo.isAxiosError=function(t){return ct.isObject(t)&&t.isAxiosError===!0},eo.mergeConfig=j_,eo.AxiosHeaders=yd,eo.formToJSON=t=>JW(ct.isHTMLForm(t)?new FormData(t):t),eo.getAdapter=g8.getAdapter,eo.HttpStatusCode=Ype,eo.default=eo;var ha=eo;const Xpe=()=>{};function CT(){const t={promise:void 0,isResolved:!1,isRejected:!1,isFinished:!1,resolve:void 0,reject:void 0,cancel:Xpe};return t.promise=new dt((r,s)=>{t.resolve=a=>{t.isFinished||(t.isResolved=!0,t.isFinished=!0,r(a),t.value=a)},t.reject=a=>{t.isFinished||(t.isRejected=!0,t.isFinished=!0,s(a))}}),t}const $A=new Map,KA=new Map,Sh=new Map;let Qi=function(t){return t.WIN_10="Windows 10",t.WIN_81="Windows 8.1",t.WIN_8="Windows 8",t.WIN_7="Windows 7",t.WIN_VISTA="Windows Vista",t.WIN_SERVER_2003="Windows Server 2003",t.WIN_XP="Windows XP",t.WIN_2000="Windows 2000",t.ANDROID="Android",t.HARMONY_OS="HarmonyOS",t.OPEN_BSD="Open BSD",t.SUN_OS="Sun OS",t.LINUX="Linux",t.IOS="iOS",t.MAC_OS="Mac OS",t.CHROMIUM_OS="Chromium OS",t.QNX="QNX",t.UNIX="UNIX",t.BEOS="BeOS",t.OS_2="OS/2",t.SEARCH_BOT="Search Bot",t}({}),Gn=function(t){return t.CHROME="Chrome",t.SAFARI="Safari",t.EDGE="Edge",t.FIREFOX="Firefox",t.OPERA="OPR",t.QQ="QQBrowser",t.WECHAT="MicroMessenger",t}({});const v8=new fde;let Ed=v8.getResult(),dL=null;function Dn(t){if(!dL){Ed=v8.getResult();const r=function(m){if(m.engine.name==="Blink"&&m.browser.name!=="WeChat")return Gn.CHROME;switch(m.browser.name){case"Chrome Headless":case"Chrome":case"Chromium":return Gn.CHROME;case"Safari":case"Mobile Safari":return Gn.SAFARI;case"Edge":return Gn.EDGE;case"Firefox":return Gn.FIREFOX;case"QQ":case"QQBrowser":return Gn.QQ;case"Opera":return Gn.OPERA;case"WeChat":return Gn.WECHAT;default:return m.browser.name||""}}(Ed),s=S8(Ed),a=function(m){return m.os.name==="Windows"?m.os.version?m.os.name+" "+m.os.version:m.os.name:m.os.name||""}(Ed),c=Ed.os.version,u=S8(Ed,!1),h=Ed.device.type;if(!(r&&s&&a&&c))return{name:r,version:s,os:a,osVersion:c,browserVersion:u,deviceType:h};dL={name:r,version:s,os:a,osVersion:c,browserVersion:u,deviceType:h}}return dL}function S8(t){let r,s=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];return r=t.engine.name==="Blink"?t.engine.version||"":t.browser.version||"",s?r.split(".")[0]:r}function qA(){return Dn().os}function b8(){const t=Dn();return"".concat(t.os," ").concat(t.osVersion)}function YA(){const t=Dn();return!!(Ed.engine.name==="WebKit"&&t.os===Qi.MAC_OS&&navigator.maxTouchPoints&&navigator.maxTouchPoints>0&&t.name!==Gn.SAFARI||Vo()&&t.name!==Gn.SAFARI)}function rp(){return Dn().name===Gn.CHROME}function Ps(){return Dn().name===Gn.SAFARI}function T8(){return Dn().name===Gn.EDGE}function zr(){return Dn().name===Gn.FIREFOX}function Vo(){return Dn().os===Qi.IOS}function RT(t){const r=Dn();return!(r.name!==Gn.CHROME||!r.osVersion)&&Number(r.version)>=t}function w8(t){const r=Dn();return!(r.name!==Gn.CHROME||!r.osVersion)&&Number(r.version)<t}function hL(t,r,s){const a=Dn();return!(a.name!==t||!a.osVersion)&&(s?Number(a.version)>=r&&Number(a.version)<=s:Number(a.version)===r)}function fL(t){const r=Dn();return!(r.name!==Gn.EDGE||!r.osVersion)&&Number(r.version)>=t}function C8(t){const r=Dn();return!(r.name!==Gn.SAFARI||!r.osVersion)&&Number(r.version)>=t}function R8(t,r,s){const a=Dn();if(a.os!==Qi.IOS||!a.osVersion)return!1;const c=a.osVersion.split(".");return r&&Number(c[0])===t&&Number(c[1])<r||Number(c[0])<t}function I8(t,r,s){const a=Dn();if(a.name!==Gn.SAFARI||!a.osVersion||!a.browserVersion)return!1;const c=a.browserVersion.split(".");return s?r&&Number(c[0])===t&&Number(c[1])<r||Number(c[0])<t:r?Number(c[0])===t&&Number(c[1])<=r||Number(c[0])<t:Number(c[0])<=t}function pL(t){const r=Dn();return!(r.name!==Gn.OPERA||!r.osVersion)&&Number(r.version)>=t}function A8(){const t=Dn();if(t.os!==Qi.IOS||!t.osVersion)return!1;const r=t.osVersion.split(".");return Number(r[0])<14||Number(r[0])===14&&Number(r[1])<=6}function Bv(){const t=Dn();if(t.os!==Qi.IOS||!t.osVersion)return!1;const r=t.osVersion.split(".");return Number(r[0])===15}function mL(){const t=Dn();if(t.os!==Qi.IOS||!t.osVersion)return!1;const r=t.osVersion.split(".");return Number(r[0])===16}function P8(){const t=Dn();if(t.os!==Qi.IOS||!t.osVersion)return!1;const r=t.osVersion.split(".");return Number(r[0])===15&&Number(r[1])>=1}function Su(){return Ps()&&navigator.maxTouchPoints>0}function O8(){return Dn().name===Gn.WECHAT}function k8(){return window.navigator.appVersion&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)!==null&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]<=35}function gL(){const t=qA();return function(){const{deviceType:r}=Dn();return r==="mobile"||r==="tablet"}()||t===Qi.ANDROID||t===Qi.IOS||t===Qi.HARMONY_OS}function ip(){const t=Dn();return t.name!==Gn.EDGE&&t.name!==Gn.SAFARI&&!!navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]./i)}function XA(){return qA()===Qi.ANDROID}function IT(){const t=Dn();return XA()&&(t.name===Gn.CHROME||t.name===Gn.WECHAT||/chrome|chromium/i.test(navigator.userAgent))}function N8(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}function yt(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?N8(Object(s),!0).forEach(function(a){qt(t,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):N8(Object(s)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))})}return t}function qt(t,r,s){return(r=function(a){var c=function(u,h){if(typeof u!="object"||u===null)return u;var m=u[Symbol.toPrimitive];if(m!==void 0){var y=m.call(u,"string");if(typeof y!="object")return y;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(u)}(a);return typeof c=="symbol"?c:String(c)}(r))in t?Object.defineProperty(t,r,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[r]=s,t}let te=function(t){return t.UNEXPECTED_ERROR="UNEXPECTED_ERROR",t.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",t.TIMEOUT="TIMEOUT",t.INVALID_PARAMS="INVALID_PARAMS",t.NOT_READABLE="NOT_READABLE",t.NOT_SUPPORTED="NOT_SUPPORTED",t.INVALID_OPERATION="INVALID_OPERATION",t.OPERATION_ABORTED="OPERATION_ABORTED",t.WEB_SECURITY_RESTRICT="WEB_SECURITY_RESTRICT",t.EXCHANGE_SDP_FAILED="EXCHANGE_SDP_FAILED",t.ADD_CANDIDATE_FAILED="ADD_CANDIDATE_FAILED",t.DATACHANNEL_FAILED="DATACHANNEL_FAILED",t.NETWORK_ERROR="NETWORK_ERROR",t.NETWORK_TIMEOUT="NETWORK_TIMEOUT",t.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",t.API_INVOKE_TIMEOUT="API_INVOKE_TIMEOUT",t.ENUMERATE_DEVICES_FAILED="ENUMERATE_DEVICES_FAILED",t.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",t.ELECTRON_IS_NULL="ELECTRON_IS_NULL",t.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",t.CHROME_PLUGIN_NO_RESPONSE="CHROME_PLUGIN_NO_RESPONSE",t.CHROME_PLUGIN_NOT_INSTALL="CHROME_PLUGIN_NOT_INSTALL",t.MEDIA_OPTION_INVALID="MEDIA_OPTION_INVALID",t.PERMISSION_DENIED="PERMISSION_DENIED",t.CONSTRAINT_NOT_SATISFIED="CONSTRAINT_NOT_SATISFIED",t.TRACK_IS_DISABLED="TRACK_IS_DISABLED",t.GET_VIDEO_ELEMENT_VISIBLE_ERROR="GET_VIDEO_ELEMENT_VISIBLE_ERROR",t.SHARE_AUDIO_NOT_ALLOWED="SHARE_AUDIO_NOT_ALLOWED",t.LOW_STREAM_ENCODING_ERROR="LOW_STREAM_ENCODING_ERROR",t.SET_ENCODING_PARAMETER_ERROR="SET_ENCODING_PARAMETER_ERROR",t.TRACK_STATE_UNREACHABLE="TRACK_STATE_UNREACHABLE",t.INVALID_UINT_UID_FROM_STRING_UID="INVALID_UINT_UID_FROM_STRING_UID",t.CAN_NOT_GET_PROXY_SERVER="CAN_NOT_GET_PROXY_SERVER",t.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER",t.VOID_GATEWAY_ADDRESS="VOID_GATEWAY_ADDRESS",t.UID_CONFLICT="UID_CONFLICT",t.MULTI_UNILBS_RESPONSE_ERROR="MULTI_UNILBS_RESPONSE_ERROR",t.UPDATE_TICKET_FAILED="UPDATE_TICKET_FAILED",t.TOKEN_EXPIRE="TOKEN_EXPIRE",t.INVALID_LOCAL_TRACK="INVALID_LOCAL_TRACK",t.INVALID_TRACK="INVALID_TRACK",t.SENDER_NOT_FOUND="SENDER_NOT_FOUND",t.CREATE_OFFER_FAILED="CREATE_OFFER_FAILED",t.SET_ANSWER_FAILED="SET_ANSWER_FAILED",t.ICE_FAILED="ICE_FAILED",t.PC_CLOSED="PC_CLOSED",t.SENDER_REPLACE_FAILED="SENDER_REPLACE_FAILED",t.GET_LOCAL_CAPABILITIES_FAILED="GET_LOCAL_CAPABILITIES_FAILED",t.GET_LOCAL_CONNECTION_PARAMS_FAILED="GET_LOCAL_CONNECTION_PARAMS_FAILED",t.SUBSCRIBE_FAILED="SUBSCRIBE_FAILED",t.UNSUBSCRIBE_FAILED="UNSUBSCRIBE_FAILED",t.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",t.NO_ICE_CANDIDATE="NO_ICE_CANDIDATE",t.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS",t.EXIST_DISABLED_VIDEO_TRACK="EXIST_DISABLED_VIDEO_TRACK",t.INVALID_REMOTE_USER="INVALID_REMOTE_USER",t.REMOTE_USER_IS_NOT_PUBLISHED="REMOTE_USER_IS_NOT_PUBLISHED",t.CUSTOM_REPORT_SEND_FAILED="CUSTOM_REPORT_SEND_FAILED",t.CUSTOM_REPORT_FREQUENCY_TOO_HIGH="CUSTOM_REPORT_FREQUENCY_TOO_HIGH",t.FETCH_AUDIO_FILE_FAILED="FETCH_AUDIO_FILE_FAILED",t.READ_LOCAL_AUDIO_FILE_ERROR="READ_LOCAL_AUDIO_FILE_ERROR",t.DECODE_AUDIO_FILE_FAILED="DECODE_AUDIO_FILE_FAILED",t.WS_ABORT="WS_ABORT",t.WS_DISCONNECT="WS_DISCONNECT",t.WS_ERR="WS_ERR",t.EXTERNAL_SIGNAL_ABORT="EXTERNAL_SIGNAL_ABORT",t.LIVE_STREAMING_TASK_CONFLICT="LIVE_STREAMING_TASK_CONFLICT",t.LIVE_STREAMING_INVALID_ARGUMENT="LIVE_STREAMING_INVALID_ARGUMENT",t.LIVE_STREAMING_INTERNAL_SERVER_ERROR="LIVE_STREAMING_INTERNAL_SERVER_ERROR",t.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED="LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED",t.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED="LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED",t.LIVE_STREAMING_CDN_ERROR="LIVE_STREAMING_CDN_ERROR",t.LIVE_STREAMING_INVALID_RAW_STREAM="LIVE_STREAMING_INVALID_RAW_STREAM",t.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT="LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT",t.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE="LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE",t.LIVE_STREAMING_WARN_FREQUENT_REQUEST="LIVE_STREAMING_WARN_FREQUENT_REQUEST",t.WEBGL_INTERNAL_ERROR="WEBGL_INTERNAL_ERROR",t.BEAUTY_PROCESSOR_INTERNAL_ERROR="BEAUTY_PROCESSOR_INTERNAL_ERROR",t.CROSS_CHANNEL_WAIT_STATUS_ERROR="CROSS_CHANNEL_WAIT_STATUS_ERROR",t.CROSS_CHANNEL_FAILED_JOIN_SRC="CROSS_CHANNEL_FAILED_JOIN_SEC",t.CROSS_CHANNEL_FAILED_JOIN_DEST="CROSS_CHANNEL_FAILED_JOIN_DEST",t.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST="CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST",t.CROSS_CHANNEL_SERVER_ERROR_RESPONSE="CROSS_CHANNEL_SERVER_ERROR_RESPONSE",t.METADATA_OUT_OF_RANGE="METADATA_OUT_OF_RANGE",t.LOCAL_AEC_ERROR="LOCAL_AEC_ERROR",t.INVALID_PLUGIN="INVALID_PLUGIN",t.DISCONNECT_P2P="DISCONNECT_P2P",t.CONVERTING_IMAGEDATA_TO_BLOB_FAILED="CONVERTING_IMAGEDATA_TO_BLOB_FAILED",t.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED="CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED",t.INIT_DATACHANNEL_TIMEOUT="INIT_DATACHANNEL_TIMEOUT",t.CREATE_DATACHANNEL_ERROR="CREATE_DATACHANNEL_ERROR",t.DATACHANNEL_CONNECTION_TIMEOUT="DATACHANNEL_CONNECTION_TIMEOUT",t.PROHIBITED_OPERATION="PROHIBITED_OPERATION",t.IMAGE_MODERATION_UPLOAD_FAILED="IMAGE_MODERATION_UPLOAD_FAILED",t.P2P_MESSAGE_FAILED="P2P_MESSAGE_FAILED",t}({}),Me=class extends Error{constructor(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",s=arguments.length>2?arguments[2]:void 0;super(r),qt(this,"code",void 0),qt(this,"message",void 0),qt(this,"data",void 0),qt(this,"name","AgoraRTCException"),this.code=t,this.message="AgoraRTCError ".concat(this.code,": ").concat(r),this.data=s}toString(){return this.data?"".concat(this.message,`
data: `).concat(JSON.stringify(this.data)):this.message}print(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error",r=arguments.length>1?arguments[1]:void 0;return t==="error"&&(r||console).error(this.toString()),t==="warning"&&(r||console).warn(this.toString()),this}throw(t){throw this.print("error",t),this}};function sp(t,r){if(typeof t!="boolean")throw new Me(te.INVALID_PARAMS,"Invalid ".concat(r,": The value is of the boolean type."))}function Hi(t,r,s){if(!ot(s).call(s,t))throw new Me(te.INVALID_PARAMS,"".concat(r," can only be set as ").concat(JSON.stringify(s)))}function or(t,r){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1e4;if(t<s||t>a||(!(arguments.length>4&&arguments[4]!==void 0)||arguments[4])&&!function(c){return typeof c=="number"&&c%1==0}(t))throw new Me(te.INVALID_PARAMS,"invalid ".concat(r,": the value range is [").concat(s,", ").concat(a,"]. integer only"))}function _L(t,r){if(typeof t!="number"){if(!(t.min||t.max||t.ideal||t.exact))throw new Me(te.INVALID_PARAMS,"".concat(r," is not a valid ConstrainLong"));t.min!==void 0&&or(t.min,"".concat(r,".min"),0,1/0),t.max!==void 0&&or(t.max,"".concat(r,".max"),1,1/0),t.exact!==void 0&&or(t.exact,"".concat(r,".exact"),1,1/0),t.ideal!==void 0&&or(t.ideal,"".concat(r,".ideal"),1,1/0)}else or(t,r,1,1/0)}function fs(t,r){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:255,c=!(arguments.length>4&&arguments[4]!==void 0)||arguments[4];if(t==null)throw new Me(te.INVALID_PARAMS,"".concat(r||"param"," cannot be empty"));if(!D8(t,s,a,c))throw new Me(te.INVALID_PARAMS,"Invalid ".concat(r||"string param",": Length of the string: [").concat(s,",").concat(a,"].").concat(c?" ASCII characters only.":""))}function op(t,r){if(!Array.isArray(t))throw new Me(te.INVALID_PARAMS,"".concat(r," should be an array"))}function Gr(t){return t==null}function D8(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:255,a=!(arguments.length>3&&arguments[3]!==void 0)||arguments[3];return typeof t=="string"&&t.length<=s&&t.length>=r&&(!a||function(c){if(typeof c!="string")return!1;for(let u=0;u<c.length;u+=1){const h=c.charCodeAt(u);if(h<0||h>255)return!1}return!0}(t))}var AT=function(t){return t.COVERED="COVERED",t.POSITION="POSITION",t.SIZE="SIZE",t.STYLE="STYLE",t}(AT||{}),yL=function(t){return t.UNMOUNTED="UNMOUNTED",t.INVALID_HTML_ELEMENT="INVALID_HTML_ELEMENT",t}(yL||{});const x8=new class{constructor(){qt(this,"_clientSize",null),qt(this,"getClientWidth",()=>document.documentElement?document.documentElement.clientWidth:document.body.clientWidth),qt(this,"getClientHeight",()=>document.documentElement?document.documentElement.clientHeight:document.body.clientHeight),qt(this,"getStyle",t=>window.getComputedStyle(t,null)),qt(this,"checkCssVisibleProperty",t=>{var r;let s=!0;const a=this.getStyle(t),{display:c,visibility:u,opacity:h,filter:m}=a;return(c==="none"||ot(r=["hidden","collapse"]).call(r,u)||Number(h)<.1)&&(s=!1),!!s&&(m&&m.split(" ").filter(y=>{var v;const S=y.split("(")[0];return ot(v=["brightness","blur","opacity"]).call(v,S)}).map(y=>{const[v,S]=y.split(/\(|\)/);return[v,Number(S.match(/^[0-9\.]+/))]}).forEach(y=>{const[v,S]=y;switch(v){case"brightness":(S<.1||S>3)&&(s=!1);break;case"blur":S>3&&(s=!1);break;case"opacity":S<.1&&(s=!1)}}),s)}),qt(this,"checkPropertyUpToAllParentNodes",(t,r)=>{let s=!0,a=!0;const c=h=>r(h);let u=t;for(;u&&a;)c(u)||(s=!1,a=!1),u=u.parentElement,u||(a=!1);return s}),qt(this,"checkActualCssVisibleIncludeInherit",t=>this.checkPropertyUpToAllParentNodes(t,this.checkCssVisibleProperty)),qt(this,"getSizeAboutClient",t=>{const{width:r,height:s,left:a,right:c,top:u,bottom:h}=t.getBoundingClientRect(),m=this.getClientWidth(),y=this.getClientHeight();return{width:r,height:s,left:a,right:c,top:u,bottom:h,clientWidth:m,clientHeight:y,clientMin:Math.min(m,y)}}),qt(this,"checkActualSize",()=>{const{width:t,height:r,clientMin:s}=this._clientSize;return this.checkSizeIsVisible(t,r,s)}),qt(this,"elementFromPoint",(t,r)=>document.elementFromPoint?document.elementFromPoint(t,r):null),qt(this,"checkCoverForAPoint",(t,r,s)=>{const a=this.elementFromPoint(t,r);return a!==null&&a!==s}),qt(this,"getPointPositionList",()=>{const{width:t,height:r,left:s,top:a}=this._clientSize,c=t/6,u=r/6,h=[],m=10**6;for(let y=0;y<5;y++)for(let v=0;v<5;v++){const S=(s*m+(y===0?.1:y===4?(c*y*m-1e5)/m:c*y)*m)/m,R=(a*m+(v===0?.1:v===4?(u*v*m-1e5)/m:u*v)*m)/m;h.push({x:S,y:R})}return[...h]}),qt(this,"checkElementCover",t=>this.getPointPositionList().map(r=>this.checkCoverForAPoint(r.x,r.y,t)).filter(r=>!!r).length>6),qt(this,"checkSizeIsVisible",(t,r,s)=>(t>50||s/t<=10)&&(r>50||s/r<=10)),qt(this,"checkSizeOfPartInClient",()=>{const{left:t,right:r,top:s,bottom:a,clientHeight:c,clientWidth:u,clientMin:h}=this._clientSize;let m,y,v,S;if(t<0)m=0;else{if(!(t<u))return!1;m=t}if(r<0)return!1;if(y=r<u?r:u,s<0)v=0;else{if(!(s<c))return!1;v=s}if(a<0)return!1;S=a<c?a:c;const R=y-m,P=S-v;return this.checkSizeIsVisible(R,P,h)}),qt(this,"returnHiddenResult",t=>(this._clientSize=null,{visible:!1,reason:t})),qt(this,"checkOneElementVisible",t=>{if(t instanceof HTMLElement){if(this.checkElementIsMountedOnDom(t)){if(this.checkActualCssVisibleIncludeInherit(t)){if(this._clientSize=this.getSizeAboutClient(t),this.checkElementCover(t))return this.returnHiddenResult(AT.COVERED);{const r=this.checkActualSize(),s=this.checkSizeOfPartInClient();return r&&!s?this.returnHiddenResult(AT.POSITION):r?(this._clientSize=null,{visible:!0}):this.returnHiddenResult(AT.SIZE)}}return this.returnHiddenResult(AT.STYLE)}return this.returnHiddenResult(yL.UNMOUNTED)}return this.returnHiddenResult(yL.INVALID_HTML_ELEMENT)}),qt(this,"checkElementIsMountedOnDom",t=>this.checkPropertyUpToAllParentNodes(t,r=>r.nodeName.toUpperCase()!=="HTML"?r.parentElement!==null:!!document.documentElement))}};function EL(t){return new TextEncoder().encode(t)}const L8=function(t,r){const s=new Uint8Array(t.byteLength+r.byteLength);return s.set(new Uint8Array(t),0),s.set(new Uint8Array(r),t.byteLength),s},vL=async t=>function(r,s){let a="";return new Uint8Array(r).forEach(c=>{a+=c.toString(s).padStart(2,"0")}),a}(await crypto.subtle.digest("SHA-256",EL(t)),16);let Fr=class{constructor(){qt(this,"_events",{}),qt(this,"addListener",this.on)}getListeners(t){return this._events[t]?this._events[t].map(r=>r.listener):[]}on(t,r){this._events[t]||(this._events[t]=[]);const s=this._events[t];this._indexOfListener(s,r)===-1&&s.push({listener:r,once:!1})}once(t,r){this._events[t]||(this._events[t]=[]);const s=this._events[t];this._indexOfListener(s,r)===-1&&s.push({listener:r,once:!0})}off(t,r){if(!this._events[t])return;const s=this._events[t],a=this._indexOfListener(s,r);a!==-1&&s.splice(a,1),this._events[t].length===0&&delete this._events[t]}removeAllListeners(t){t?delete this._events[t]:this._events={}}emit(t){this._events[t]||(this._events[t]=[]);const r=this._events[t].map(u=>u);for(var s=arguments.length,a=new Array(s>1?s-1:0),c=1;c<s;c++)a[c-1]=arguments[c];for(let u=0;u<r.length;u+=1){const h=r[u];h.once&&this.off(t,h.listener),h.listener.apply(this,a||[])}}safeEmit(t){for(var r=arguments.length,s=new Array(r>1?r-1:0),a=1;a<r;a++)s[a-1]=arguments[a];[...this._events[t]||[]].forEach(c=>{c.once&&this.off(t,c.listener);try{c.listener.apply(this,s)}catch(u){console.error("safeEmit event:".concat(t," error ").concat(u==null?void 0:u.toString()))}})}_indexOfListener(t,r){let s=t.length;for(;s--;)if(t[s].listener===r)return s;return-1}},PT=null;function M8(){if(PT)return PT;if(window.electron)return PT=window.electron;if(!window.require)return null;try{return PT=window.require("electron"),PT}catch{return null}}let Oi=function(t){return t.CREATE_CLIENT="createClient",t.CHECK_SYSTEM_REQUIREMENTS="checkSystemRequirements",t.SET_AREA="setArea",t.PRELOAD="PRELOAD",t.CHECK_VIDEO_TRACK_IS_ACTIVE="checkVideoTrackIsActive",t.CHECK_AUDIO_TRACK_IS_ACTIVE="checkAudioTrackIsActive",t.CREATE_MIC_AUDIO_TRACK="createMicrophoneAudioTrack",t.CREATE_CUSTOM_AUDIO_TRACK="createCustomAudioTrack",t.CREATE_BUFFER_AUDIO_TRACK="createBufferSourceAudioTrack",t.CREATE_CAM_VIDEO_TRACK="createCameraVideoTrack",t.CREATE_CUSTOM_VIDEO_TRACK="createCustomVideoTrack",t.CREATE_MIC_AND_CAM_TRACKS="createMicrophoneAndCameraTracks",t.CREATE_SCREEN_VIDEO_TRACK="createScreenVideoTrack",t.SET_ENCRYPTION_CONFIG="Client.setEncryptionConfig",t.START_PROXY_SERVER="Client.startProxyServer",t.STOP_PROXY_SERVER="Client.stopProxyServer",t.SET_PROXY_SERVER="Client.setProxyServer",t.SET_TURN_SERVER="Client.setTurnServer",t.SET_CLIENT_ROLE="Client.setClientRole",t.SET_LOW_STREAM_PARAMETER="Client.setLowStreamParameter",t.ENABLE_DUAL_STREAM="Client.enableDualStream",t.DISABLE_DUAL_STREAM="Client.disableDualStream",t.JOIN="Client.join",t.LEAVE="Client.leave",t.PUBLISH="Client.publish",t.UNPUBLISH="Client.unpublish",t.SUBSCRIBE="Client.subscribe",t.MASS_SUBSCRIBE="Client.massSubscribe",t.MASS_UNSUBSCRIBE="Client.massUnsubscribe",t.UNSUBSCRIBE="Client.unsubscribe",t.RENEW_TOKEN="Client.renewToken",t.SET_REMOTE_VIDEO_STREAM_TYPE="Client.setRemoteVideoStreamType",t.SET_STREAM_FALLBACK_OPTION="Client.setStreamFallbackOption",t.ENABLE_AUDIO_VOLUME_INDICATOR="Client.enableAudioVolumeIndicator",t.SEND_CUSTOM_REPORT_MESSAGE="Client.sendCustomReportMessage",t.INSPECT_VIDEO_CONTENT="Client.inspectVideoContent",t.STOP_INSPECT_VIDEO_CONTENT="Client.stopInspectVideoContent",t.JOIN_FALLBACK_TO_PROXY="Client._joinFallbackToProxy",t.ON_LIVE_STREAM_WARNING="Client.onLiveStreamWarning",t.ON_LIVE_STREAM_ERROR="Client.onLiveStreamingError",t.START_LIVE_STREAMING="Client.startLiveStreaming",t.SET_LIVE_TRANSCODING="Client.setLiveTranscoding",t.STOP_LIVE_STREAMING="Client.stopLiveStreaming",t.START_CHANNEL_MEDIA_RELAY="Client.startChannelMediaRelay",t.UPDATE_CHANNEL_MEDIA_RELAY="Client.updateChannelMediaRelay",t.STOP_CHANNEL_MEDIA_RELAY="Client.stopChannelMediaRelay",t.REQUEST_CONFIG_DISTRIBUTE="_config-distribute-request",t.SET_CONFIG_DISTRIBUTE="_configDistribute",t.LOCAL_TRACK_SET_MUTED="LocalTrack.setMute",t.LOCAL_AUDIO_TRACK_PLAY="LocalAudioTrack.play",t.LOCAL_AUDIO_TRACK_PLAY_IN_ELEMENT="LocalAudioTrack.playInElement",t.LOCAL_AUDIO_TRACK_STOP="LocalAudioTrack.stop",t.LOCAL_AUDIO_TRACK_SET_VOLUME="LocalAudioTrack.setVolume",t.MIC_AUDIO_TRACK_SET_DEVICE="MicrophoneAudioTrack.setDevice",t.BUFFER_AUDIO_TRACK_START="BufferSourceAudioTrack.startProcessAudioBuffer",t.BUFFER_AUDIO_TRACK_STOP="BufferSourceAudioTrack.stopProcessAudioBuffer",t.BUFFER_AUDIO_TRACK_PAUSE="BufferSourceAudioTrack.pauseProcessAudioBuffer",t.BUFFER_AUDIO_TRACK_RESUME="BufferSourceAudioTrack.resumeProcessAudioBuffer",t.BUFFER_AUDIO_TRACK_SEEK="BufferSourceAudioTrack.seekAudioBuffer",t.LOCAL_VIDEO_TRACK_PLAY="LocalVideoTrack.play",t.LOCAL_VIDEO_TRACK_STOP="LocalVideoTrack.stop",t.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE="LocalVideoTrack.getVideoElementVisibleStatus",t.LOCAL_VIDEO_TRACK_BEAUTY="LocalVideoTrack.setBeautyEffect",t.LOCAL_VIDEO_SEND_SEI_DATA="LocalVideoTrack.sendSeiData",t.CAM_VIDEO_TRACK_SET_DEVICE="CameraVideoTrack.setDevice",t.CAM_VIDEO_TRACK_SET_ENCODER_CONFIG="CameraVideoTrack.setEncoderConfiguration",t.REMOTE_VIDEO_TRACK_PLAY="RemoteVideoTrack.play",t.REMOTE_VIDEO_TRACK_STOP="RemoteVideoTrack.stop",t.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE="RemoteVideoTrack.getVideoElementVisibleStatus",t.REMOTE_AUDIO_TRACK_PLAY="RemoteAudioTrack.play",t.REMOTE_AUDIO_TRACK_STOP="RemoteAudioTrack.stop",t.REMOTE_AUDIO_SET_VOLUME="RemoteAudioTrack.setVolume",t.REMOTE_AUDIO_SET_OUTPUT_DEVICE="RemoteAudioTrack.setOutputDevice",t.GET_MEDIA_STREAM_TRACK="Track.getMediaStreamTrack",t.STREAM_TYPE_CHANGE="streamTypeChange",t.CONNECTION_STATE_CHANGE="connectionStateChange",t.LOAD_CONFIG_FROM_LOCALSTORAGE="loadConfigFromLocalStorage",t.IMAGE_MODERATION_UPLOAD="imageModerationUpload",t.REPUB_AFTER_PC_CONNECTED="repubAfterPCConnected",t}({}),Hr=function(t){return t.TRACER="tracer",t}({});function U8(t){return or(t.timeout,"config.timeout",0,1e5),or(t.timeoutFactor,"config.timeoutFactor",0,100,!1),or(t.maxRetryCount,"config.maxRetryConfig",0,1/0),or(t.maxRetryTimeout,"config.maxRetryTimeout",0,1/0),!0}let Jpe=function(t){return t[t.AUDIENCE_LEVEL_LOW_LATENCY=1]="AUDIENCE_LEVEL_LOW_LATENCY",t[t.AUDIENCE_LEVEL_ULTRA_LOW_LATENCY=2]="AUDIENCE_LEVEL_ULTRA_LOW_LATENCY",t[t.AUDIENCE_LEVEL_SYNC_LATENCY=3]="AUDIENCE_LEVEL_SYNC_LATENCY",t}({}),qn=function(t){return t.LEAVE="LEAVE",t.NETWORK_ERROR="NETWORK_ERROR",t.SERVER_ERROR="SERVER_ERROR",t.UID_BANNED="UID_BANNED",t.FALLBACK="FALLBACK",t.IP_BANNED="IP_BANNED",t.CHANNEL_BANNED="CHANNEL_BANNED",t.LICENSE_MISSING="LICENSE_MISSING",t.LICENSE_EXPIRED="LICENSE_EXPIRED",t.LICENSE_MINUTES_EXCEEDED="LICENSE_MINUTES_EXCEEDED",t.LICENSE_PERIOD_INVALID="LICENSE_PERIOD_INVALID",t.LICENSE_MULTIPLE_SDK_SERVICE="LICENSE_MULTIPLE_SDK_SERVICE",t.LICENSE_ILLEGAL="LICENSE_ILLEGAL",t.TOKEN_EXPIRE="TOKEN_EXPIRE",t}({});function OT(t){if(!Array.isArray(t)||t.length<1)return!1;try{t.forEach(r=>{if(!r.urls)throw Error()})}catch{return!1}return!0}function V8(t){return fs(t.turnServerURL,"turnServerURL"),fs(t.username,"username"),fs(t.password,"password"),t.udpport&&or(t.udpport,"udpport",1,99999,!0),t.forceturn&&sp(t.forceturn,"forceturn"),t.security&&sp(t.security,"security"),t.tcpport&&or(t.tcpport,"tcpport",1,99999,!0),!0}function SL(t){return t.level!==void 0&&Hi(t.level,"level",[1,2,3]),t.delay!==void 0&&or(t.delay,"delay",0,3e3,!0),!0}let bn=function(t){return t.PEERCONNECTION_STATE_CHANGE="peerconnection-state-change",t.AUDIO_METADATA="audio-metadata",t.CONNECTION_STATE_CHANGE="connection-state-change",t.MEDIA_RECONNECT_START="media-reconnect-start",t.MEDIA_RECONNECT_END="media-reconnect-end",t.IS_USING_CLOUD_PROXY="is-using-cloud-proxy",t.USER_JOINED="user-joined",t.USER_LEAVED="user-left",t.USER_PUBLISHED="user-published",t.USER_UNPUBLISHED="user-unpublished",t.USER_INFO_UPDATED="user-info-updated",t.CLIENT_BANNED="client-banned",t.CHANNEL_MEDIA_RELAY_STATE="channel-media-relay-state",t.CHANNEL_MEDIA_RELAY_EVENT="channel-media-relay-event",t.VOLUME_INDICATOR="volume-indicator",t.CRYPT_ERROR="crypt-error",t.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="token-privilege-will-expire",t.ON_TOKEN_PRIVILEGE_DID_EXPIRE="token-privilege-did-expire",t.NETWORK_QUALITY="network-quality",t.STREAM_TYPE_CHANGED="stream-type-changed",t.STREAM_FALLBACK="stream-fallback",t.RECEIVE_METADATA="receive-metadata",t.STREAM_MESSAGE="stream-message",t.LIVE_STREAMING_ERROR="live-streaming-error",t.LIVE_STREAMING_WARNING="live-streaming-warning",t.EXCEPTION="exception",t.ERROR="error",t.P2P_LOST="p2p_lost",t.JOIN_FALLBACK_TO_PROXY="join-fallback-to-proxy",t.CHANNEL_FALLBACK_TO_WEBSOCKET="channel-fallback-to-websocket",t.MEDIA_CONNECTION_TYPE_CHANGE="media-connection-type-change",t.PUBLISHED_USER_LIST="published-user-list",t.CONTENT_INSPECT_CONNECTION_STATE_CHANGE="content-inspect-connection-state-change",t.CONTENT_INSPECT_ERROR="content-inspect-error",t.CONTENT_INSPECT_RESULT="content-inspect-result",t.IMAGE_MODERATION_CONNECTION_STATE_CHANGE="image-moderation-connection-state-change",t}({}),Os=function(t){return t.NETWORK_ERROR="NETWORK_ERROR",t.SERVER_ERROR="SERVER_ERROR",t.MULTI_IP="MULTI_IP",t.TIMEOUT="TIMEOUT",t.OFFLINE="OFFLINE",t.LEAVE="LEAVE",t.P2P_FAILED="P2P_FAILED",t.FALLBACK="FALLBACK",t.REGIONAL_DISTRIBUTION="REGIONAL_DISTRIBUTION",t}({}),Ec=function(t){return t.ONLINE="ONLINE",t.OFFLINE="OFFLINE",t}({}),Wv=function(t){return t.NETWORK_STATE_CHANGE="NETWORK_STATE_CHANGE",t.ONLINE="ONLINE",t.OFFLINE="OFFLINE",t}({});function ks(t,r){for(var s=arguments.length,a=new Array(s>2?s-2:0),c=2;c<s;c++)a[c-2]=arguments[c];return t.getListeners(r).length===0?dt.reject(new Me(te.UNEXPECTED_ERROR,"can not emit promise")):new dt((u,h)=>{t.emit(r,...a,u,h)})}function hr(t,r){if(t.getListeners(r).length===0)return dt.resolve();for(var s=arguments.length,a=new Array(s>2?s-2:0),c=2;c<s;c++)a[c-2]=arguments[c];return ks(t,r,...a)}function Kc(t,r){if(t.getListeners(r).length===0)return null;for(var s=arguments.length,a=new Array(s>2?s-2:0),c=2;c<s;c++)a[c-2]=arguments[c];return kT(t,r,...a)}function kT(t,r){let s=null,a=null;for(var c=arguments.length,u=new Array(c>2?c-2:0),h=2;h<c;h++)u[h-2]=arguments[h];if(t.emit(r,...u,m=>{s=m},m=>{a=m}),a!==null)throw a;if(s===null)throw new Me(te.UNEXPECTED_ERROR,"handler is not sync");return s}const vi=new class extends Fr{set networkState(t){this.emit(Wv.NETWORK_STATE_CHANGE,t,this._networkState),t===Ec.ONLINE?this.emit(Wv.ONLINE):t===Ec.OFFLINE&&(this.onlineWaiter=new dt(r=>{this.once(Wv.ONLINE,()=>{this.onlineWaiter=void 0,r(Ec.ONLINE)})}),this.emit(Wv.OFFLINE)),this._networkState=t}get networkState(){return this._networkState}get isOnline(){return this._networkState===Ec.ONLINE}constructor(){super(),qt(this,"_moduleName","network-indicator"),qt(this,"_networkState",Ec.ONLINE),qt(this,"onlineWaiter",void 0),window.addEventListener("online",()=>{this.networkState=Ec.ONLINE}),window.addEventListener("offline",()=>{this.networkState=Ec.OFFLINE})}};function JA(t,r){const s=t.indexOf(r);s!==-1&&t.splice(s,1)}function zv(t){const r=[];return t.forEach(s=>{r.indexOf(s)===-1&&r.push(s)}),r}function QA(t){dt!==void 0?dt.resolve().then(t):setTimeout(t,0)}function $r(t){return JSON.parse(JSON.stringify(t))}function B_(t){try{return $r(t)}catch{return t}}const F8={};function Gm(t,r){F8[r]||(F8[r]=!0,t())}function W_(t){const r=window.atob(t),s=new Uint8Array(new ArrayBuffer(r.length));for(let a=0;a<r.length;a+=1)s[a]=r.charCodeAt(a);return s}function Hm(t){let r="";for(let s=0;s<t.length;s+=1)r+=String.fromCharCode(t[s]);return window.btoa(r)}function j8(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:16,s=new TextEncoder().encode(t);if(s.length>r)s=s.slice(0,r);else if(s.length<r){const a=new Uint8Array(r);a.set(s),s=a}return s}function B8(){for(var t=arguments.length,r=new Array(t),s=0;s<t;s++)r[s]=arguments[s];const a=hc(r).call(r,(h,m)=>h+m.length,0),c=new Uint8Array(new ArrayBuffer(a));let u=0;return r.forEach(h=>{c.set(h,u),u+=h.length}),c}function bh(t){return window.TextEncoder?new TextEncoder().encode(t).length:t.length}function W8(t){let r=0;return(/DingTalk/i.test(navigator.userAgent)||/AliApp/i.test(navigator.userAgent))&&t.realFormData&&(t=t.realFormData),t.forEach(s=>{r+=typeof s=="string"?bh(s):s.size}),r+138}function Qpe(t){const r=new Me(te.TIMEOUT,"timeout");return new dt((s,a)=>{window.setTimeout(()=>a(r),t)})}function ps(t){return new dt(r=>{window.setTimeout(r,t)})}function fr(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:7,r=arguments.length>1?arguments[1]:void 0;const s=Math.random().toString(16).substr(2,t).toLowerCase();return s.length===t?"".concat(r).concat(s):"".concat(r).concat(s)+fr(t-s.length,"")}function z_(){return fr(32,"").toUpperCase()}const ZA=()=>{},z8=new class{constructor(){qt(this,"fnMap",new Map)}throttleByKey(t,r,s,a){for(var c=arguments.length,u=new Array(c>4?c-4:0),h=4;h<c;h++)u[h-4]=arguments[h];if(this.fnMap.has(r)){const m=this.fnMap.get(r);if(m.threshold!==s){m.fn(...m.args),clearTimeout(m.timer);const y=window.setTimeout(()=>{const v=this.fnMap.get(r);v&&v.fn(...v.args),this.fnMap.delete(r)},s);this.fnMap.set(r,{fn:t,threshold:s,timer:y,args:u,skipFn:a})}else m.skipFn&&m.skipFn(...m.args),this.fnMap.set(r,yt(yt({},m),{},{fn:t,args:u,skipFn:a}))}else{const m=window.setTimeout(()=>{const y=this.fnMap.get(r);y&&y.fn(...y.args),this.fnMap.delete(r)},s);this.fnMap.set(r,{fn:t,threshold:s,timer:m,args:u,skipFn:a})}}},G8=z8.throttleByKey.bind(z8);function H8(t){return typeof t=="object"&&t!==null&&!(t instanceof RegExp)}function bL(t,r){if(!H8(t)||!H8(r)||Array.isArray(t)&&!Array.isArray(r)||!Array.isArray(t)&&Array.isArray(r))return r;if(Array.isArray(r)&&Array.isArray(t)){const s=[...t];for(let a=0;a<r.length;a++)s[a]=bL(t[a],r[a]);return s}{const s=yt({},t);for(const a in r)Object.prototype.hasOwnProperty.call(r,a)&&(Object.prototype.hasOwnProperty.call(t,a)?s[a]=bL(t[a],r[a]):s[a]=r[a]);return s}}function $8(t,r){let s=[0];if(s=new Array(r).fill(0),t===0)return s;let a=0;for(;t>0&&(s[a]=255&t,t>>=8,a++,a!==r););return s}function TL(t){return typeof t=="number"?t:t.exact||t.ideal||t.max||t.min||0}function K8(t){const r="0123456789abcdef";function s(fe){let Se,we="";for(Se=0;Se<=3;Se++)we+=r.charAt(fe>>8*Se+4&15)+r.charAt(fe>>8*Se&15);return we}function a(fe,Se){const we=(65535&fe)+(65535&Se);return(fe>>16)+(Se>>16)+(we>>16)<<16|65535&we}function c(fe,Se,we,ye,Ne,Ye){return a(function(ht,mt){return ht<<mt|ht>>>32-mt}(a(a(Se,fe),a(ye,Ye)),Ne),we)}function u(fe,Se,we,ye,Ne,Ye,ht){return c(Se&we|~Se&ye,fe,Se,Ne,Ye,ht)}function h(fe,Se,we,ye,Ne,Ye,ht){return c(Se&ye|we&~ye,fe,Se,Ne,Ye,ht)}function m(fe,Se,we,ye,Ne,Ye,ht){return c(Se^we^ye,fe,Se,Ne,Ye,ht)}function y(fe,Se,we,ye,Ne,Ye,ht){return c(we^(Se|~ye),fe,Se,Ne,Ye,ht)}const v=function(fe){let Se;const we=1+(fe.length+8>>6),ye=new Array(16*we);for(Se=0;Se<16*we;Se++)ye[Se]=0;for(Se=0;Se<fe.length;Se++)ye[Se>>2]|=fe.charCodeAt(Se)<<Se%4*8;return ye[Se>>2]|=128<<Se%4*8,ye[16*we-2]=8*fe.length,ye}(t);let S,R,P,D,G,F=1732584193,j=-271733879,Y=-1732584194,ee=271733878;for(S=0;S<v.length;S+=16)R=F,P=j,D=Y,G=ee,F=u(F,j,Y,ee,v[S+0],7,-680876936),ee=u(ee,F,j,Y,v[S+1],12,-389564586),Y=u(Y,ee,F,j,v[S+2],17,606105819),j=u(j,Y,ee,F,v[S+3],22,-1044525330),F=u(F,j,Y,ee,v[S+4],7,-176418897),ee=u(ee,F,j,Y,v[S+5],12,1200080426),Y=u(Y,ee,F,j,v[S+6],17,-1473231341),j=u(j,Y,ee,F,v[S+7],22,-45705983),F=u(F,j,Y,ee,v[S+8],7,1770035416),ee=u(ee,F,j,Y,v[S+9],12,-1958414417),Y=u(Y,ee,F,j,v[S+10],17,-42063),j=u(j,Y,ee,F,v[S+11],22,-1990404162),F=u(F,j,Y,ee,v[S+12],7,1804603682),ee=u(ee,F,j,Y,v[S+13],12,-40341101),Y=u(Y,ee,F,j,v[S+14],17,-1502002290),j=u(j,Y,ee,F,v[S+15],22,1236535329),F=h(F,j,Y,ee,v[S+1],5,-165796510),ee=h(ee,F,j,Y,v[S+6],9,-1069501632),Y=h(Y,ee,F,j,v[S+11],14,643717713),j=h(j,Y,ee,F,v[S+0],20,-373897302),F=h(F,j,Y,ee,v[S+5],5,-701558691),ee=h(ee,F,j,Y,v[S+10],9,38016083),Y=h(Y,ee,F,j,v[S+15],14,-660478335),j=h(j,Y,ee,F,v[S+4],20,-405537848),F=h(F,j,Y,ee,v[S+9],5,568446438),ee=h(ee,F,j,Y,v[S+14],9,-1019803690),Y=h(Y,ee,F,j,v[S+3],14,-187363961),j=h(j,Y,ee,F,v[S+8],20,1163531501),F=h(F,j,Y,ee,v[S+13],5,-1444681467),ee=h(ee,F,j,Y,v[S+2],9,-51403784),Y=h(Y,ee,F,j,v[S+7],14,1735328473),j=h(j,Y,ee,F,v[S+12],20,-1926607734),F=m(F,j,Y,ee,v[S+5],4,-378558),ee=m(ee,F,j,Y,v[S+8],11,-2022574463),Y=m(Y,ee,F,j,v[S+11],16,1839030562),j=m(j,Y,ee,F,v[S+14],23,-35309556),F=m(F,j,Y,ee,v[S+1],4,-1530992060),ee=m(ee,F,j,Y,v[S+4],11,1272893353),Y=m(Y,ee,F,j,v[S+7],16,-155497632),j=m(j,Y,ee,F,v[S+10],23,-1094730640),F=m(F,j,Y,ee,v[S+13],4,681279174),ee=m(ee,F,j,Y,v[S+0],11,-358537222),Y=m(Y,ee,F,j,v[S+3],16,-722521979),j=m(j,Y,ee,F,v[S+6],23,76029189),F=m(F,j,Y,ee,v[S+9],4,-640364487),ee=m(ee,F,j,Y,v[S+12],11,-421815835),Y=m(Y,ee,F,j,v[S+15],16,530742520),j=m(j,Y,ee,F,v[S+2],23,-995338651),F=y(F,j,Y,ee,v[S+0],6,-198630844),ee=y(ee,F,j,Y,v[S+7],10,1126891415),Y=y(Y,ee,F,j,v[S+14],15,-1416354905),j=y(j,Y,ee,F,v[S+5],21,-57434055),F=y(F,j,Y,ee,v[S+12],6,1700485571),ee=y(ee,F,j,Y,v[S+3],10,-1894986606),Y=y(Y,ee,F,j,v[S+10],15,-1051523),j=y(j,Y,ee,F,v[S+1],21,-2054922799),F=y(F,j,Y,ee,v[S+8],6,1873313359),ee=y(ee,F,j,Y,v[S+15],10,-30611744),Y=y(Y,ee,F,j,v[S+6],15,-1560198380),j=y(j,Y,ee,F,v[S+13],21,1309151649),F=y(F,j,Y,ee,v[S+4],6,-145523070),ee=y(ee,F,j,Y,v[S+11],10,-1120210379),Y=y(Y,ee,F,j,v[S+2],15,718787259),j=y(j,Y,ee,F,v[S+9],21,-343485551),F=a(F,R),j=a(j,P),Y=a(Y,D),ee=a(ee,G);return s(F)+s(j)+s(Y)+s(ee)}let Zpe=1,q8=console,Fs=class{static setLogger(t){q8=t}constructor(t,r){qt(this,"id",void 0),qt(this,"lockingPromise",dt.resolve()),qt(this,"locks",0),qt(this,"name",""),qt(this,"lockId",void 0),this.lockId=Zpe++,t&&(this.name=t),r&&(this.id=r),this.logger("created")}logger(t,r){const s=(this.id?"[".concat(this.id,"]"):"")+"[lock-".concat(this.name,"-").concat(this.lockId,"]"),a=t==="created"?"is ".concat(t,"."):"is ".concat(t,", current queue ").concat(this.locks,". ").concat(r??"");q8.debug("".concat(s," ").concat(a))}setId(t){this.id=t}get isLocked(){return this.locks>0}lock(t){let r;this.locks+=1,this.logger("locked",t);const s=new dt(c=>{r=()=>{this.locks-=1,this.logger("unlocked",t),c()}}),a=this.lockingPromise.then(()=>r);return this.lockingPromise=this.lockingPromise.then(()=>s),a}};function Gv(t,r){return function(s,a,c){const u=c.value;if(typeof u!="function")throw new Error("Cannot use mutex on object property.");return c.value=async function(){const h=this[r];if(!h)throw new Error("mutex property key ".concat(r," doesn't exist on ").concat(t));const m=await h.lock("From ".concat(t,".").concat(a));try{for(var y=arguments.length,v=new Array(y),S=0;S<y;S++)v[S]=arguments[S];return await u.apply(this,v)}finally{m()}},c}}const ki={timeout:500,timeoutFactor:1.5,maxRetryCount:1/0,maxRetryTimeout:1e4};function wL(t,r){const s=Math.floor(r.timeout*Math.pow(r.timeoutFactor,t));return Math.min(r.maxRetryTimeout,s)}function vd(t,r,s,a){const c=Object.assign({},ki,a);let u=c.timeout;const h=async()=>{await function(v){return new dt(S=>{window.setTimeout(S,v)})}(u),u*=c.timeoutFactor,u=Math.min(c.maxRetryTimeout,u)};let m=!1;const y=new dt(async(v,S)=>{r=r||(()=>!1),s=s||(()=>!0);for(let R=0;R<c.maxRetryCount;R+=1){if(m)return S(new Me(te.OPERATION_ABORTED));try{const P=await t();if(!r(P,R)||R+1===c.maxRetryCount)return v(P);await h()}catch(P){if(!s(P,R)||R+1===c.maxRetryCount)return S(P);await h()}}});return y.cancel=()=>m=!0,y}let eP,Y8=class{constructor(t){qt(this,"input",[]),qt(this,"size",void 0),this.size=t}add(t){this.input.push(t),this.input.length>this.size&&this.input.splice(0,1)}mean(){var t;return this.input.length===0?0:hc(t=this.input).call(t,(r,s)=>r+s)/this.input.length}},tP=0,CL=0;function RL(t,r,s,a){return new dt((c,u)=>{r.responseType=r.responseType||"json",r.data&&!s?(r.data=JSON.stringify(r.data),tP+=bh(r.data)):s&&(r.data.size?tP+=r.data.size:r.data instanceof FormData?tP+=W8(r.data):tP+=bh(JSON.stringify(r.data))),r.headers=r.headers||{},r.headers["Content-Type"]=r.headers["Content-Type"]||"application/json",r.method="POST",r.url=t,ha.request(r).then(h=>{typeof h.data=="string"?CL+=bh(h.data):h.data instanceof ArrayBuffer||h.data instanceof Uint8Array?CL+=h.data.byteLength:CL+=bh(JSON.stringify(h.data)),c(h.data)}).catch(h=>{ha.isCancel(h)?u(new Me(te.OPERATION_ABORTED,"cancel token canceled")):h.code==="ECONNABORTED"?u(new Me(te.NETWORK_TIMEOUT,h.message)):h.response?u(new Me(te.NETWORK_RESPONSE_ERROR,h.response.status)):u(new Me(te.NETWORK_ERROR,h.message))})})}async function eme(t,r){const s=new Blob([r.data],{type:"buffer"});return await RL(t,yt(yt({},r),{},{data:s,headers:{"Content-Type":"application/octet-stream"}}),!0)}const X8=()=>window.isSecureContext!==void 0;function bu(t){if(Array.isArray(t))return t.map(s=>s);if(!J8(t))return t;const r={};for(const s in t){const a=t[s];J8(a)||Array.isArray(a)?r[s]=bu(a):r[s]=a}return r}function J8(t){return!(typeof t!="object"||Array.isArray(t)||!t)}let IL=class{constructor(t){qt(this,"input",[]),qt(this,"size",void 0),this.size=t}add(t){this.input.push(t),this.input.length>this.size&&this.input.splice(0,1)}diffMean(){return this.input.length===0?0:(this.input[this.input.length-1]-this.input[0])/this.input.length}};const Th={address:"unknown",candidateType:"unknown",id:"unknown",port:0,priority:0,protocol:"unknown",type:"unknown"},NT={timestamp:0,bitrate:{actualEncoded:0,transmit:0},sendPacketLossRate:0,recvPacketLossRate:0,videoRecv:[],videoSend:[],audioRecv:[],audioSend:[],selectedCandidatePair:{id:"unknown",localCandidate:Th,remoteCandidate:Th},updateInterval:0},Q8={firsCount:0,nacksCount:0,plisCount:0,framesDecodeCount:0,framesDecodeInterval:0,framesDecodeFreezeTime:0,decodeFrameRate:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,qpSumPerFrame:0,framesDroppedCount:0,outputFrameRate:0,packetsDiscarded:0,framesAssembledFromMultiplePackets:0,totalProcessingDelay:0,avgDecodeMs:0,avgFramesAssembledFromMultiplePacketsMs:0,avgProcessingDelayMs:0,avgInterFrameDelayMs:0,totalAssemblyTime:0},Z8={firsCount:0,nacksCount:0,plisCount:0,frameCount:0,bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0,qpSumPerFrame:0},ez={bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0},tz={jitterBufferMs:0,jitterMs:0,bytes:0,packetsLost:0,packetLostRate:0,packetsDiscarded:0,packets:0,ssrc:0,receivedFrames:0,droppedFrames:0,concealedSamples:0,totalSamplesReceived:0};let AL=class{constructor(t,r){qt(this,"onFirstVideoReceived",void 0),qt(this,"onFirstVideoDecoded",void 0),qt(this,"onFirstAudioReceived",void 0),qt(this,"onFirstVideoDecodedTimeout",void 0),qt(this,"onFirstAudioDecoded",void 0),qt(this,"onSelectedLocalCandidateChanged",void 0),qt(this,"onSelectedRemoteCandidateChanged",void 0),qt(this,"videoIsReady",!1),qt(this,"videoIsReady2",{}),qt(this,"pc",void 0),qt(this,"options",void 0),qt(this,"intervalTimer",void 0),qt(this,"stats",bu(NT)),qt(this,"isFirstVideoReceived",{}),qt(this,"isFirstVideoDecoded",{}),qt(this,"isFirstAudioReceived",{}),qt(this,"isFirstAudioDecoded",{}),qt(this,"isFirstVideoDecodedTimeout",{}),qt(this,"lossRateWindowStats",[]),this.pc=t,this.options=r,this.intervalTimer=window.setInterval(async()=>{this.updateStats()},this.options.updateInterval)}getStats(){return this.stats}getSelectedCandidatePair(){return new dt(t=>{t({local:yt({},Th),remote:yt({},Th)})})}setVideoIsReady(t){this.videoIsReady=t}setVideoIsReady2(t,r){this.videoIsReady2[t]=r}getVideoIsReady(t){return this.videoIsReady2[t]||!1}setIsFirstAudioDecoded(t){}destroy(){window.clearInterval(this.intervalTimer),this.pc=void 0}calcLossRate(t){this.lossRateWindowStats.push(t),this.lossRateWindowStats.length>this.options.lossRateInterval&&this.lossRateWindowStats.splice(0,1);const r=this.lossRateWindowStats.length,s=["videoSend","audioSend","videoRecv","audioRecv"];let a=0,c=0,u=0,h=0;for(const m of s)t[m].forEach((y,v)=>{if(!this.lossRateWindowStats[r-1][m][v]||!this.lossRateWindowStats[0][m][v])return;const S=this.lossRateWindowStats[r-1][m][v].packets-this.lossRateWindowStats[0][m][v].packets,R=this.lossRateWindowStats[r-1][m][v].packetsLost-this.lossRateWindowStats[0][m][v].packetsLost;m==="videoSend"||m==="audioSend"?(a+=S,u+=R):(c+=S,h+=R),Number.isNaN(S)||Number.isNaN(S)?y.packetLostRate=0:y.packetLostRate=S<=0||R<=0?0:R/(S+R)});t.sendPacketLossRate=a<=0||u<=0?0:u/(a+u),t.recvPacketLossRate=c<=0||h<=0?0:h/(c+h)}},tme=class extends AL{constructor(){super(...arguments),qt(this,"_stats",NT),qt(this,"lastDecodeVideoReceiverStats",new Map)}async updateStats(){const t=await this._getStats(),r=this.statsResponsesToObjects(t);this._stats=bu(NT);const s=r.filter(c=>c.type==="ssrc");this.processSSRCStats(s);const a=r.find(c=>c.type==="VideoBwe");a&&this.processBandwidthStats(a),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}processBandwidthStats(t){this._stats.bitrate={actualEncoded:Number(t.googActualEncBitrate),targetEncoded:Number(t.googTargetEncBitrate),retransmit:Number(t.googRetransmitBitrate),transmit:Number(t.googTransmitBitrate)},this._stats.sendBandwidth=Number(t.googAvailableSendBandwidth)}processSSRCStats(t){t.forEach(r=>{var s;const a=ot(s=r.id).call(s,"send");switch("".concat(r.mediaType,"_").concat(a?"send":"recv")){case"video_send":{const c=bu(Z8);c.codec=r.googCodecName,c.adaptionChangeReason="none",r.googCpuLimitedResolution&&(c.adaptionChangeReason="cpu"),r.googBandwidthLimitedResolution&&(c.adaptionChangeReason="bandwidth"),c.avgEncodeMs=Number(r.googAvgEncodeMs),c.inputFrame={width:Number(r.googFrameWidthInput)||Number(r.googFrameWidthSent),height:Number(r.googFrameHeightInput)||Number(r.googFrameHeightSent),frameRate:Number(r.googFrameRateInput)},c.sentFrame={width:Number(r.googFrameWidthSent),height:Number(r.googFrameHeightSent),frameRate:Number(r.googFrameRateInput)},c.firsCount=Number(r.googFirReceived),c.nacksCount=Number(r.googNacksReceived),c.plisCount=Number(r.googPlisReceived),c.frameCount=Number(r.framesEncoded),c.bytes=Number(r.bytesSent),c.packets=Number(r.packetsSent),c.packetsLost=Number(r.packetsLost),c.ssrc=Number(r.ssrc),c.rttMs=Number(r.googRtt||0),this._stats.videoSend.push(c),this._stats.rtt=c.rttMs;break}case"video_recv":{const c=bu(Q8),u=this.lastDecodeVideoReceiverStats.get(Number(r.ssrc));if(c.codec=r.googCodecName,c.targetDelayMs=Number(r.googTargetDelayMs),c.renderDelayMs=Number(r.googRenderDelayMs),c.currentDelayMs=Number(r.googCurrentDelayMs),c.minPlayoutDelayMs=Number(r.googMinPlayoutDelayMs),c.decodeMs=Number(r.googDecodeMs),c.maxDecodeMs=Number(r.googMaxDecodeMs),c.receivedFrame={width:Number(r.googFrameWidthReceived),height:Number(r.googFrameHeightReceived),frameRate:Number(r.googFrameRateReceived)},c.decodedFrame={width:Number(r.googFrameWidthReceived),height:Number(r.googFrameHeightReceived),frameRate:Number(r.googFrameRateDecoded)},c.decodeFrameRate=Number(r.googFrameRateDecoded),c.outputFrame={width:Number(r.googFrameWidthReceived),height:Number(r.googFrameHeightReceived),frameRate:Number(r.googFrameRateOutput)},c.jitterBufferMs=Number(r.googJitterBufferMs),c.firsCount=Number(r.googFirsSent),c.nacksCount=Number(r.googNacksSent),c.plisCount=Number(r.googPlisSent),c.framesDecodeCount=Number(r.framesDecoded),c.bytes=Number(r.bytesReceived),c.packets=Number(r.packetsReceived),c.packetsLost=Number(r.packetsLost),c.ssrc=Number(r.ssrc),c.packets>0&&!this.isFirstVideoReceived[c.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(c.ssrc),this.isFirstVideoReceived[c.ssrc]=!0),c.framesDecodeCount>0&&!this.isFirstVideoDecoded[c.ssrc]&&(this.onFirstVideoDecoded&&this.onFirstVideoDecoded(c.ssrc,c.decodedFrame.width,c.decodedFrame.height),this.isFirstVideoDecoded[c.ssrc]=!0),u){const h=u.stats,m=Date.now()-u.lts;c.framesDecodeFreezeTime=h.framesDecodeFreezeTime,c.framesDecodeInterval=h.framesDecodeInterval,c.framesDecodeCount>h.framesDecodeCount&&this.isFirstVideoDecoded[c.ssrc]?(u.lts=Date.now(),c.framesDecodeInterval=m,c.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(r.ssrc,10))?c.framesDecodeFreezeTime+=c.framesDecodeInterval:this.setVideoIsReady2(parseInt(r.ssrc,10),!0))):c.framesDecodeCount<u.stats.framesDecodeCount&&(c.framesDecodeInterval=0)}this.lastDecodeVideoReceiverStats.set(c.ssrc,{stats:yt({},c),lts:Date.now()}),this._stats.videoRecv.push(c);break}case"audio_recv":{const c=bu(tz);c.codec=r.googCodecName,c.outputLevel=Math.abs(Number(r.audioOutputLevel))/32767,c.decodingCNG=Number(r.googDecodingCNG),c.decodingCTN=Number(r.googDecodingCTN),c.decodingCTSG=Number(r.googDecodingCTSG),c.decodingNormal=Number(r.googDecodingNormal),c.decodingPLC=Number(r.googDecodingPLC),c.decodingPLCCNG=Number(r.googDecodingPLCCNG),c.expandRate=Number(r.googExpandRate),c.accelerateRate=Number(r.googAccelerateRate),c.preemptiveExpandRate=Number(r.googPreemptiveExpandRate),c.secondaryDecodedRate=Number(r.googSecondaryDecodedRate),c.speechExpandRate=Number(r.googSpeechExpandRate),c.preferredJitterBufferMs=Number(r.googPreferredJitterBufferMs),c.jitterBufferMs=Number(r.googJitterBufferMs),c.jitterMs=Number(r.googJitterReceived),c.bytes=Number(r.bytesReceived),c.packets=Number(r.packetsReceived),c.packetsLost=Number(r.packetsLost),c.ssrc=Number(r.ssrc),c.receivedFrames=Number(r.googDecodingCTN)||Number(r.packetsReceived),c.droppedFrames=Number(r.googDecodingPLC)+Number(r.googDecodingPLCCNG)||Number(r.packetsLost),c.receivedFrames>0&&!this.isFirstAudioReceived[c.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(c.ssrc),this.isFirstAudioReceived[c.ssrc]=!0),c.decodingNormal>0&&!this.isFirstAudioDecoded[c.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(c.ssrc),this.isFirstAudioDecoded[c.ssrc]=!0),this._stats.audioRecv.push(c);break}case"audio_send":{const c=bu(ez);c.codec=r.googCodecName,c.inputLevel=Math.abs(Number(r.audioInputLevel))/32767,c.aecReturnLoss=Number(r.googEchoCancellationReturnLoss||0),c.aecReturnLossEnhancement=Number(r.googEchoCancellationReturnLossEnhancement||0),c.residualEchoLikelihood=Number(r.googResidualEchoLikelihood||0),c.residualEchoLikelihoodRecentMax=Number(r.googResidualEchoLikelihoodRecentMax||0),c.bytes=Number(r.bytesSent),c.packets=Number(r.packetsSent),c.packetsLost=Number(r.packetsLost),c.ssrc=Number(r.ssrc),c.rttMs=Number(r.googRtt||0),this._stats.rtt=c.rttMs,this._stats.audioSend.push(c);break}}})}_getStats(){return new dt((t,r)=>{this.pc.getStats(t,r)})}statsResponsesToObjects(t){const r=[];return t.result().forEach(s=>{const a={id:s.id,timestamp:s.timestamp.valueOf().toString(),type:s.type};s.names().forEach(c=>{a[c]=s.stat(c)}),r.push(a)}),r}},DT=function(t){return t.BANDWIDTH="bandwidth",t.CPU="cpu",t.NONE="none",t.OTHER="other",t}({}),nP=function(t){return t.L1T1="L1T1",t.L1T2="L1T2",t.L1T3="L1T3",t.L1T3_KEY="L1T3_KEY",t.L2T1_KEY="L2T1_KEY",t.L2T2_KEY="L2T2_KEY",t.L2T3_KEY="L2T3_KEY",t.L3T1_KEY="L3T1_KEY",t.L3T2_KEY="L3T2_KEY",t.L3T3_KEY="L3T3_KEY",t}({}),PL=function(t){return t[t.new=0]="new",t[t.connecting=1]="connecting",t[t.connected=2]="connected",t[t.disconnected=3]="disconnected",t[t.failed=4]="failed",t[t.closed=5]="closed",t}({}),qc=function(t){return t.CERTIFICATE="certificate",t.CODEC="codec",t.CANDIDATE_PAIR="candidate-pair",t.LOCAL_CANDIDATE="local-candidate",t.REMOTE_CANDIDATE="remote-candidate",t.INBOUND="inbound-rtp",t.TRACK="track",t.OUTBOUND="outbound-rtp",t.PC="peer-connection",t.REMOTE_INBOUND="remote-inbound-rtp",t.REMOTE_OUTBOUND="remote-outbound-rtp",t.TRANSPORT="transport",t.CSRC="csrc",t.DATA_CHANNEL="data-channel",t.STREAM="stream",t.SENDER="sender",t.RECEIVER="receiver",t}({});var Hv=function(t){return t[t.kNone=1]="kNone",t[t.kMillisecondsFromSeconds=1e3]="kMillisecondsFromSeconds",t[t.kBytesToBits=8]="kBytesToBits",t}(Hv||{});function xT(t,r,s,a){let c=arguments.length>4&&arguments[4]!==void 0?arguments[4]:Hv.kNone;if(!r)return;const u=Number(r[s]);if(typeof u!="number")return;const h=Number(r[a]);if(typeof h!="number")return;if(!t)return h?u/h*c:void 0;const m=Number(t[s]);if(typeof m!="number")return;const y=Number(t[a]);if(typeof y!="number")return;const v=h-y;return v?(u-m)/v*c:void 0}let nz=class extends AL{constructor(){super(...arguments),qt(this,"_stats",NT),qt(this,"report",void 0),qt(this,"lastDecodeVideoReceiverStats",new Map),qt(this,"lastVideoFramesRecv",new Map),qt(this,"lastVideoFramesSent",new Map),qt(this,"lastVideoFramesDecode",new Map),qt(this,"lastVideoFramesOutput",new Map),qt(this,"lastVideoJBDelay",new Map),qt(this,"lastAudioJBDelay",new Map),qt(this,"mediaBytesSent",new Map),qt(this,"mediaBytesRetransmit",new Map),qt(this,"mediaBytesTargetEncode",new Map),qt(this,"lastDecodeAudioReceiverStats",new Map),qt(this,"lastEncoderMs",new Map)}async updateStats(){this.report=await this.pc.getStats(),this._stats=bu(NT),this.report.forEach(t=>{switch(t.type){case qc.OUTBOUND:case qc.INBOUND:{const r=t.mediaType||t.kind,s=!r&&"frameWidth"in t,a=!r&&!("frameWidth"in t);t.type===qc.OUTBOUND?r==="audio"||a?this.processAudioOutboundStats(t):(r==="video"||s)&&this.processVideoOutboundStats(t):t.type===qc.INBOUND&&(r==="audio"||a?this.processAudioInboundStats(t):(r==="video"||s)&&this.processVideoInboundStats(t));break}case qc.TRANSPORT:{const r=this.report.get(t.selectedCandidatePairId);r&&this.processCandidatePairStats(r);break}case qc.CANDIDATE_PAIR:t.selected&&this.processCandidatePairStats(t)}}),this.updateSendBitrate(),this._stats.updateInterval=Date.now()-this.stats.timestamp,this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}async getSelectedCandidatePair(){const t=await this.pc.getStats(),r={local:yt({},Th),remote:yt({},Th)};return t.forEach(s=>{let a;if(s.type===qc.TRANSPORT&&(a=t.get(s.selectedCandidatePairId)),s.type===qc.CANDIDATE_PAIR&&s.selected&&(a=s),a){const c=(u,h)=>{u.type=h.type,u.id=h.id,h.address&&(u.address=h.address),h.candidateType&&(u.candidateType=h.candidateType),h.port&&(u.port=h.port),h.priority&&(u.priority=h.priority),h.protocol&&(u.protocol=h.protocol),h.relayProtocol&&(u.relayProtocol=h.relayProtocol)};if(a.localCandidateId){const u=t.get(a.localCandidateId);u&&c(r.local,u)}if(a.remoteCandidateId){const u=t.get(a.remoteCandidateId);u&&c(r.remote,u)}}}),r}processCandidatePairStats(t){if(this._stats.sendBandwidth=t.availableOutgoingBitrate||0,t.currentRoundTripTime&&(this._stats.rtt=1e3*t.currentRoundTripTime),this._stats.videoSend.forEach(r=>{t.currentRoundTripTime&&(r.rttMs=1e3*t.currentRoundTripTime)}),this._stats.audioSend.forEach(r=>{t.currentRoundTripTime&&(r.rttMs=1e3*t.currentRoundTripTime)}),this._stats.selectedCandidatePair.id=t.id,t.localCandidateId){const r=this.report.get(t.localCandidateId);r&&this.processCandidateStats(r)}if(t.remoteCandidateId){const r=this.report.get(t.remoteCandidateId);r&&this.processCandidateStats(r)}}processCandidateStats(t){let r;t.type===qc.LOCAL_CANDIDATE&&(r=this._stats.selectedCandidatePair.localCandidate),t.type===qc.REMOTE_CANDIDATE&&(r=this._stats.selectedCandidatePair.remoteCandidate),r&&(r.type=t.type,r.id=t.id,t.address&&(r.address=t.address),t.candidateType&&(r.candidateType=t.candidateType),t.port&&(r.port=t.port),t.priority&&(r.priority=t.priority),t.protocol&&(r.protocol=t.protocol),t.relayProtocol&&(r.relayProtocol=t.relayProtocol),t.type===qc.LOCAL_CANDIDATE&&this.stats.selectedCandidatePair.localCandidate.id!==r.id&&this.onSelectedLocalCandidateChanged&&this.onSelectedLocalCandidateChanged(yt({},r),yt({},this.stats.selectedCandidatePair.localCandidate)),t.type===qc.REMOTE_CANDIDATE&&this.stats.selectedCandidatePair.remoteCandidate.id!==r.id&&this.onSelectedRemoteCandidateChanged&&this.onSelectedRemoteCandidateChanged(yt({},r),yt({},this.stats.selectedCandidatePair.remoteCandidate)))}processAudioInboundStats(t){let r=this._stats.audioRecv.find(a=>a.ssrc===t.ssrc);r||(r=bu(tz),this._stats.audioRecv.push(r)),r.ssrc=t.ssrc,r.packets=t.packetsReceived,r.packetsLost=t.packetsLost,r.packetsDiscarded=t.packetsDiscarded,r.bytes=t.bytesReceived,r.jitterMs=1e3*t.jitter,r.retransmittedBytesReceived=t.retransmittedBytesReceived,r.retransmittedPacketsReceived=t.retransmittedPacketsReceived,r.totalProcessingDelay=t.totalProcessingDelay,r.jitterBufferEmittedCount=t.jitterBufferEmittedCount;const s=this.lastDecodeAudioReceiverStats.get(r.ssrc);r.avgProcessingDelayMs=xT(s,r,"totalProcessingDelay","jitterBufferEmittedCount",Hv.kMillisecondsFromSeconds),this.processAudioTrackReceiverStats(t,t.trackId,r),t.codecId&&(r.codec=this.getCodecFromCodecStats(t.codecId)),r.receivedFrames||(r.receivedFrames=t.packetsReceived),r.droppedFrames||(r.droppedFrames=t.packetsLost),r.receivedFrames>0&&!this.isFirstAudioReceived[r.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(r.ssrc),this.isFirstAudioReceived[r.ssrc]=!0),r.outputLevel&&r.outputLevel>0&&!this.isFirstAudioDecoded[r.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(r.ssrc),this.isFirstAudioDecoded[r.ssrc]=!0),typeof t.concealedSamples=="number"&&(r.concealedSamples=t.concealedSamples),this.lastDecodeAudioReceiverStats.set(r.ssrc,yt({},r))}processVideoInboundStats(t){let r=this._stats.videoRecv.find(h=>h.ssrc===t.ssrc);r||(r=bu(Q8),this._stats.videoRecv.push(r)),r.ssrc=t.ssrc,r.packets=t.packetsReceived,r.packetsLost=t.packetsLost,r.bytes=t.bytesReceived,r.firsCount=t.firCount,r.nacksCount=t.nackCount,r.plisCount=t.pliCount,r.framesDecodeCount=t.framesDecoded,r.framesDroppedCount=t.framesDropped,r.totalInterFrameDelay=t.totalInterFrameDelay,r.totalSquaredInterFrameDelay=t.totalSquaredInterFrameDelay,r.totalFreezesDuration=t.totalFreezesDuration,r.totalProcessingDelay=t.totalProcessingDelay,r.packetsDiscarded=t.packetsDiscarded,r.framesAssembledFromMultiplePackets=t.framesAssembledFromMultiplePackets,r.totalAssemblyTime=t.totalAssemblyTime,r.keyFramesDecoded=t.keyFramesDecoded,r.retransmittedBytesReceived=t.retransmittedBytesReceived,r.retransmittedPacketsReceived=t.retransmittedPacketsReceived;const s=this.lastDecodeVideoReceiverStats.get(r.ssrc),a=this.lastVideoFramesDecode.get(r.ssrc),c=this.lastVideoFramesOutput.get(r.ssrc),u=Date.now();if(r.framesDecodeCount>0&&!this.isFirstVideoDecoded[r.ssrc]){const h=r.decodedFrame?r.decodedFrame.width:0,m=r.decodedFrame?r.decodedFrame.height:0;this.onFirstVideoDecoded&&this.onFirstVideoDecoded(r.ssrc,h,m),this.isFirstVideoDecoded[r.ssrc]=!0}if(s){const h=s.stats,m=u-s.lts;r.framesDecodeFreezeTime=h.framesDecodeFreezeTime,r.framesDecodeInterval=h.framesDecodeInterval,!this.isFirstVideoDecoded[r.ssrc]&&m>this.options.firstVideoDecodedTimeout&&!this.isFirstVideoDecodedTimeout[r.ssrc]&&(this.onFirstVideoDecodedTimeout&&this.onFirstVideoDecodedTimeout(r.ssrc),this.isFirstVideoDecodedTimeout[r.ssrc]=!0),r.framesDecodeCount>h.framesDecodeCount&&this.isFirstVideoDecoded[r.ssrc]?(s.lts=Date.now(),r.framesDecodeInterval=m,r.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(t.ssrc))?r.framesDecodeFreezeTime+=r.framesDecodeInterval:this.setVideoIsReady2(parseInt(t.ssrc,10),!0))):r.framesDecodeCount<h.framesDecodeCount&&(r.framesDecodeInterval=0),t.framesDecoded&&t.qpSum&&(s.stats.framesDecodeCount>t.framesDecoded?r.qpSumPerFrame=t.qpSum/t.framesDecoded:r.qpSumPerFrame=(t.qpSum-s.qpSum)/(t.framesDecoded-s.stats.framesDecodeCount))}t.totalDecodeTime&&(r.decodeMs=1e3*t.totalDecodeTime,r.avgDecodeMs=xT(s==null?void 0:s.stats,r,"decodeMs","framesDecodeCount")),r.avgProcessingDelayMs=xT(s==null?void 0:s.stats,r,"totalProcessingDelay","framesDecodeCount",Hv.kMillisecondsFromSeconds),r.avgFramesAssembledFromMultiplePacketsMs=xT(s==null?void 0:s.stats,r,"totalAssemblyTime","framesAssembledFromMultiplePackets",Hv.kMillisecondsFromSeconds),r.avgInterFrameDelayMs=xT(s==null?void 0:s.stats,r,"totalInterFrameDelay","framesDecodeCount",Hv.kMillisecondsFromSeconds),a&&u-a.lts>=800?(r.decodeFrameRate=Math.round((r.framesDecodeCount-a.count)/((u-a.lts)/1e3)),this.lastVideoFramesDecode.set(r.ssrc,{count:r.framesDecodeCount,lts:u,rate:r.decodeFrameRate})):a?r.decodeFrameRate=a.rate:this.lastVideoFramesDecode.set(r.ssrc,{count:r.framesDecodeCount,lts:u,rate:0}),r.framesDroppedCount&&t.framesReceived&&(c&&u-c.lts>=800?(r.outputFrameRate=Math.round((t.framesReceived-r.framesDroppedCount-c.count)/((u-c.lts)/1e3)),this.lastVideoFramesOutput.set(r.ssrc,{count:t.framesReceived-r.framesDroppedCount,lts:u,rate:Math.max(r.outputFrameRate,0)})):c?r.outputFrameRate=c.rate:this.lastVideoFramesOutput.set(r.ssrc,{count:t.framesReceived-r.framesDroppedCount,lts:u,rate:0})),this.processVideoTrackReceiverStats(t,t.trackId,r),t.codecId&&(r.codec=this.getCodecFromCodecStats(t.codecId)),t.framerateMean&&(r.framesRateFirefox=t.framerateMean),r.packets>0&&!this.isFirstVideoReceived[r.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(r.ssrc),this.isFirstVideoReceived[r.ssrc]=!0),this.lastDecodeVideoReceiverStats.set(r.ssrc,{stats:yt({},r),lts:s?s.lts:Date.now(),qpSum:t.qpSum})}processVideoOutboundStats(t){let r=this._stats.videoSend.find(a=>a.ssrc===t.ssrc);r||(r=bu(Z8),this._stats.videoSend.push(r));const s=this.mediaBytesSent.get(t.ssrc);if(s)s.add(t.bytesSent);else{const a=new IL(10);a.add(t.bytesSent),this.mediaBytesSent.set(t.ssrc,a)}if(t.retransmittedBytesSent!==void 0){const a=this.mediaBytesRetransmit.get(t.ssrc);if(a)a.add(t.retransmittedBytesSent);else{const c=new IL(10);c.add(t.retransmittedBytesSent),this.mediaBytesRetransmit.set(t.ssrc,c)}}if(t.totalEncodedBytesTarget){const a=this.mediaBytesTargetEncode.get(t.ssrc);if(a)a.add(t.totalEncodedBytesTarget);else{const c=new IL(10);c.add(t.totalEncodedBytesTarget),this.mediaBytesTargetEncode.set(t.ssrc,c)}}if(r.ssrc=t.ssrc,r.bytes=t.bytesSent,r.packets=t.packetsSent,r.firsCount=t.firCount,r.nacksCount=t.nackCount,r.plisCount=t.pliCount,r.frameCount=t.framesEncoded,r.adaptionChangeReason=t.qualityLimitationReason,r.scalabilityMode=t.scalabilityMode,r.retransmittedBytesSent=t.retransmittedBytesSent,r.retransmittedPacketsSent=t.retransmittedPacketsSent,r.hugeFramesSent=t.hugeFramesSent,r.keyFramesEncoded=t.keyFramesEncoded,t.totalEncodeTime&&t.framesEncoded){const a=this.lastEncoderMs.get(t.ssrc);if(!a||a.lastFrameCount>t.framesEncoded)r.avgEncodeMs=1e3*t.totalEncodeTime/t.framesEncoded;else{const c=t.framesEncoded-a.lastFrameCount,u=t.totalEncodeTime-a.lastEncoderTime;r.avgEncodeMs=1e3*u/c}}if(t.framesEncoded&&t.qpSum){const a=this.lastEncoderMs.get(t.ssrc);!a||a.lastFrameCount>t.framesEncoded?r.qpSumPerFrame=t.qpSum/t.framesEncoded:r.qpSumPerFrame=(t.qpSum-a.lastQpSum)/(t.framesEncoded-a.lastFrameCount)}if(this.lastEncoderMs.set(t.ssrc,{lastFrameCount:t.framesEncoded,lastEncoderTime:t.totalEncodeTime,lastQpSum:t.qpSum,lts:Date.now()}),t.codecId&&(r.codec=this.getCodecFromCodecStats(t.codecId)),t.mediaSourceId&&this.processVideoMediaSource(t.mediaSourceId,r),this.processVideoTrackSenderStats(t,t.trackId,r),t.remoteId)this.processRemoteInboundStats(t.remoteId,r);else{const a=this.findRemoteStatsId(t.ssrc,qc.REMOTE_INBOUND);a&&this.processRemoteInboundStats(a,r)}}processAudioOutboundStats(t){let r=this._stats.audioSend.find(s=>s.ssrc===t.ssrc);if(r||(r=bu(ez),this._stats.audioSend.push(r)),r.ssrc=t.ssrc,r.packets=t.packetsSent,r.bytes=t.bytesSent,r.retransmittedBytesSent=t.retransmittedBytesSent,r.retransmittedPacketsSent=t.retransmittedPacketsSent,t.mediaSourceId&&this.processAudioMediaSource(t.mediaSourceId,r),t.codecId&&(r.codec=this.getCodecFromCodecStats(t.codecId)),this.processAudioTrackSenderStats(t,t.trackId,r),t.remoteId)this.processRemoteInboundStats(t.remoteId,r);else{const s=this.findRemoteStatsId(t.ssrc,qc.REMOTE_INBOUND);s&&this.processRemoteInboundStats(s,r)}}findRemoteStatsId(t,r){var s;const a=Array.from(Hc(s=this.report).call(s)).find(c=>c.type===r&&c.ssrc===t);return a?a.id:null}processVideoMediaSource(t,r){const s=this.report.get(t);s&&s.width&&s.height&&s.framesPerSecond&&(r.inputFrame={width:s.width,height:s.height,frameRate:s.framesPerSecond})}processAudioMediaSource(t,r){const s=this.report.get(t);s&&(r.inputLevel=s.audioLevel)}processVideoTrackSenderStats(t,r,s){var a,c,u,h;const m=r?this.report.get(r):void 0,y=(a=m==null?void 0:m.framesSent)!==null&&a!==void 0?a:t.framesSent;if(typeof y!="number")return;let v=(c=m==null?void 0:m.frameWidth)!==null&&c!==void 0?c:t.frameWidth,S=(u=m==null?void 0:m.frameHeight)!==null&&u!==void 0?u:t.frameHeight,R=(h=m==null?void 0:m.framesPerSecond)!==null&&h!==void 0?h:t.framesPerSecond;if(typeof v=="number"&&typeof S=="number"||(v=0,S=0),R==null){const P=Date.now(),D=this.lastVideoFramesSent.get(s.ssrc);D&&P-D.lts>=800?(R=Math.round((y-D.count)/((P-D.lts)/1e3)),this.lastVideoFramesSent.set(s.ssrc,{count:y,lts:P,rate:R})):D?R=D.rate:this.lastVideoFramesSent.set(s.ssrc,{count:y,lts:P,rate:0})}s.sentFrame={width:v,height:S,frameRate:Math.max(0,R)}}processVideoTrackReceiverStats(t,r,s){var a,c,u,h,m;const y=r?this.report.get(r):void 0,v=(a=y==null?void 0:y.framesReceived)!==null&&a!==void 0?a:t.framesReceived,S=(c=y==null?void 0:y.frameWidth)!==null&&c!==void 0?c:t.frameWidth,R=(u=y==null?void 0:y.frameHeight)!==null&&u!==void 0?u:t.frameHeight,P=(h=y==null?void 0:y.jitterBufferDelay)!==null&&h!==void 0?h:t.jitterBufferDelay,D=(m=y==null?void 0:y.jitterBufferEmittedCount)!==null&&m!==void 0?m:t.jitterBufferEmittedCount;if(typeof v=="number"){const G=this.lastVideoFramesRecv.get(s.ssrc),F=Date.now();s.framesReceivedCount=v;let j=0;G&&F-G.lts>=800?(j=Math.round((v-G.count)/((F-G.lts)/1e3)),this.lastVideoFramesRecv.set(s.ssrc,{count:v,lts:F,rate:j})):G?j=G.rate:this.lastVideoFramesRecv.set(s.ssrc,{count:v,lts:F,rate:0}),s.receivedFrame={width:S||0,height:R||0,frameRate:j||0},s.decodedFrame={width:S||0,height:R||0,frameRate:s.decodeFrameRate||0},s.outputFrame={width:S||0,height:R||0,frameRate:s.outputFrameRate||s.decodeFrameRate||0}}if(P&&D){const G=this.lastVideoJBDelay.get(s.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let F=G.jitterBufferMs;const j=D-G.jitterBufferEmittedCount;j>0&&(F=1e3*(P-G.jitterBufferDelay)/j),s.jitterBufferMs=F,s.currentDelayMs=Math.round(F),this.lastVideoJBDelay.set(s.ssrc,{jitterBufferDelay:P,jitterBufferEmittedCount:D,jitterBufferMs:s.currentDelayMs})}}processAudioTrackSenderStats(t,r,s){var a,c,u,h;const m=r?this.report.get(r):void 0,y=(a=(c=m==null?void 0:m.echoReturnLoss)!==null&&c!==void 0?c:t.echoReturnLoss)!==null&&a!==void 0?a:0,v=(u=(h=m==null?void 0:m.echoReturnLossEnhancement)!==null&&h!==void 0?h:t.echoReturnLossEnhancement)!==null&&u!==void 0?u:0;s.aecReturnLoss=y,s.aecReturnLossEnhancement=v}processAudioTrackReceiverStats(t,r,s){var a,c,u,h,m,y,v;const S=r?this.report.get(r):void 0,R=(a=S==null?void 0:S.removedSamplesForAcceleration)!==null&&a!==void 0?a:t.removedSamplesForAcceleration,P=(c=S==null?void 0:S.totalSamplesReceived)!==null&&c!==void 0?c:t.totalSamplesReceived,D=(u=S==null?void 0:S.jitterBufferDelay)!==null&&u!==void 0?u:t.jitterBufferDelay,G=(h=S==null?void 0:S.jitterBufferEmittedCount)!==null&&h!==void 0?h:t.jitterBufferEmittedCount,F=(m=S==null?void 0:S.audioLevel)!==null&&m!==void 0?m:t==null?void 0:t.audioLevel,j=(y=S==null?void 0:S.totalSamplesDuration)!==null&&y!==void 0?y:t==null?void 0:t.totalSamplesDuration,Y=(v=S==null?void 0:S.concealedSamples)!==null&&v!==void 0?v:t.concealedSamples;if(typeof P=="number"&&(s.totalSamplesReceived=P),R&&P&&(s.accelerateRate=R/P),D&&G){const fe=this.lastAudioJBDelay.get(s.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let Se=fe.jitterBufferMs;const we=G-fe.jitterBufferEmittedCount;we>0&&(Se=1e3*(D-fe.jitterBufferDelay)/we),s.jitterBufferMs=Math.round(Se),this.lastAudioJBDelay.set(s.ssrc,{jitterBufferDelay:D,jitterBufferEmittedCount:G,jitterBufferMs:s.jitterBufferMs})}s.outputLevel=F;let ee=1920;j&&P&&(ee=P/j/50,s.receivedFrames=Math.round(P/ee)),Y&&(s.droppedFrames=Math.round(Y/ee))}processRemoteInboundStats(t,r){const s=this.report.get(t);s&&(r.packetsLost=s.packetsLost,s.roundTripTime&&(r.rttMs=1e3*s.roundTripTime),s.jitter&&(r.jitterMs=1e3*s.jitter),s.timestamp&&(r.timestamp=s.timestamp))}getCodecFromCodecStats(t){const r=this.report.get(t);if(!r)return"";const s=r.mimeType.match(/\/(.*)$/);return s&&s[1]?s[1]:""}updateSendBitrate(){let t=0,r=null,s=null;this.mediaBytesSent.forEach(c=>{t+=c.diffMean()}),this.mediaBytesRetransmit.forEach(c=>{r=r===null?c.diffMean():r+c.diffMean()}),this.mediaBytesTargetEncode.forEach(c=>{s=s===null?c.diffMean():s+c.diffMean()});const a=r!==null?t-r:t;this._stats.bitrate={actualEncoded:8*a/(this.options.updateInterval/1e3),transmit:8*t/(this.options.updateInterval/1e3)},r!==null&&(this._stats.bitrate.retransmit=8*r/(this.options.updateInterval/1e3)),s!==null&&(this._stats.bitrate.targetEncoded=8*s/(this.options.updateInterval/1e3))}},nme=class extends AL{updateStats(){return dt.resolve()}};function OL(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:250,s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:8,a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:500,c=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1e4;const u=function(){const h=navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]*/i);return h&&h[0]?Number(h[0].split("/")[1]):null}();return u?u<76?new tme(t,{updateInterval:r,lossRateInterval:s,freezeRateLimit:a,firstVideoDecodedTimeout:c}):new nz(t,{updateInterval:r,lossRateInterval:s,freezeRateLimit:a,firstVideoDecodedTimeout:c}):function(h){if(!window.RTCStatsReport)return!1;const m=h.getStats();return!!(m instanceof dt||function(y){return!!y&&(typeof y=="object"||typeof y=="function")&&typeof y.then=="function"}(m))}(t)?new nz(t,{updateInterval:r,lossRateInterval:s,freezeRateLimit:a,firstVideoDecodedTimeout:c}):new nme(t,{updateInterval:r,lossRateInterval:s,freezeRateLimit:a,firstVideoDecodedTimeout:c})}const rz="websdk_ng_install_id";function kL(){try{if(oe("INSTALL_ID"))return oe("INSTALL_ID");let t=window.localStorage.getItem(rz);return t||(t=z_(),window.localStorage.setItem(rz,t)),rr("INSTALL_ID",t),t}catch{return}}const Al=function(t){if(t.match(/[0-9]+\.[0-9]+\.[0-9]+$/))return t;const r=t.match(/([0-9]+\.[0-9]+\.[0-9]+)\-([0-9]+)/);if(r&&r[1]&&r[2]){const s=r[1],a=r[2];return"".concat(s,".").concat(a)}return"4.0.0.999"}("4.23.2"),NL=function(){try{return JSON.parse("true")===!0}catch{return!0}}();let G_=function(t){return t.Default="default",t.Auto="auto",t.Relay="relay",t.SdRtn="sd-rtn",t}({});const Ns=function(){const t="us".concat("erna","me"),r="pa".concat("sswo","rd"),s=["t","s","t"];s.splice(1,0,"e");const a=s.join(""),c=[];for(let m=0;m<6;m++)c.push("1");const u=c.join(""),h={};return h[t]=a,h[r]=u,Object.assign(h,{turnServerURL:"",tcpport:3433,udpport:3478,forceturn:!1})}();window.DEFAULT_TURN_CONFIG=Ns;const rP={ENABLE_PUBLISHED_USER_LIST:!0,MAX_SUBSCRIPTION:50,SUBSCRIBE_AUDIO_FILTER_TOPN:void 0,ENABLE_PUBLISH_AUDIO_FILTER:void 0,ENABLE_USER_LICENSE_CHECK:!0,DISABLE_FEC:void 0,ENABLE_NTP_REPORT:!1,ENABLE_INSTANT_VIDEO:!1,ENABLE_USER_AUTO_REBALANCE_CHECK:!0,ENABLE_LOSSBASED_BWE:!0,ENABLE_AUT_CC:!1,ENABLE_CC_FALLBACK:void 0,SUBSCRIBE_TWCC:!0,PUBLISH_TWCC:!1,ENABLE_SVC_DEFAULT_CODECS:["H264","VP8","VP9","AV1"],SVC:[],ENABLE_FULL_LINK_AV_SYNC:!1,SVC_MODE:null,PRE_SUB_NUM:2,ENABLE_AUT_FEEDBACK:!1,SVC_EXTENDED:["VP9"]},DL={MIN_FRAME_RATE:1,MAX_FRAME_RATE:30,MAX_THRESHOLD_FRAMERATE:30,BITRATE_MIN_THRESHOLD:100,BITRATE_MAX_THRESHOLD:100,MAX_SCALE:5,BWE_SCALE_UP_THRESHOLD:.6,BWE_SCALE_DOWN_THRESHOLD:.6,PERF_SCALE_UP_THRESHOLD:.7,PERF_SCALE_DOWN_THRESHOLD:.6,MOTION_RESOLUTION_FACTOR:.8,MOTION_BITRATE_FACTOR:.6,DETAIL_FRAMERATE_FACTOR:.8,DETAIL_BITRATE_FACTOR:.6,BALANCE_RESOLUTION_FACTOR:.9,BALANCE_FRAMERATE_FACTOR:.9,BALANCE_BITRATE_FACTOR:.6,OVERUSE_TIMES_THRESHOLD:10,UNDERUSE_TIMES_THRESHOLD:40},xL="v4.23.2-0-g1599fdac-dirty(3/4/2025, 5:13:36 PM)",LL={ENABLE_EVENT_REPORT:!0,UPLOAD_LOG:!1,ENABLE_AG_ADAPTATION:!0,FORCE_AG_HIGH_FRAMERATE:!1,FORCE_SUPPORT_AG_ADAPTATION:!1,ENCODER_CONFIG_LIMIT:{},CAMERA_CAPTURE_CONFIG:void 0,ENABLE_PRELOAD:!0,NEW_ICE_RESTART:!1,ICE_RESTART_INTERVAL:1e4,RESTART_SEQUENCE:["udp_tcp_relay","relay"],FIRST_TCP_CANDIDATE:!1,FIRST_TCP_CANDIDATE_INTERVAL:1e3,TURN_DOMAIN:"edge.agora.io",USE_TURN_IP:!1,NEW_TURN_MODE:void 0,NEW_FORCE_TURN:!1},br=yt(yt(yt({},LL),{},{PROCESS_ID:"",ENCRYPT_AES:!0,AREAS:["CHINA","GLOBAL"],WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io","webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io","webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-web-2.ap.sd-rtn.com","cds-ap-web-3.agora.io","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-web-2.ap.sd-rtn.com","sua-ap-web-3.agora.io","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-ap-web-1.agora.io","uap-web-2.ap.sd-rtn.com","uap-ap-web-3.agora.io","uap-web-4.ap.sd-rtn.com"],LOG_UPLOAD_SERVER:"logservice.agora.io",EVENT_REPORT_DOMAIN:"statscollector-1.agora.io",EVENT_REPORT_BACKUP_DOMAIN:"web-2.statscollector.sd-rtn.com",GATEWAY_ADDRESS:[],GATEWAY_WSS_ADDRESS:"",LIVE_STREAMING_ADDRESS:"",HTTP_CONNECT_TIMEOUT:5e3,SIGNAL_REQUEST_TIMEOUT:1e4,REPORT_STATS:!0,NOT_REPORT_EVENT:[],PING_PONG_TIME_OUT:10,WEBSOCKET_TIMEOUT_MIN:1e4,EVENT_REPORT_SEND_INTERVAL:3e3,CONFIG_DISTRIBUTE_INTERVAL:3e5,ENABLE_CONFIG_DISTRIBUTE:!0,CANDIDATE_TIMEOUT:5e3,SHOW_REPORT_INVOKER_LOG:!1,SHOW_REPORT_USER_INVOKER_LOG:!0,JOIN_EXTEND:"",PUB_EXTEND:"",SUB_EXTEND:"",FORCE_TURN:!1,TURN_ENABLE_TCP:!0,TURN_ENABLE_UDP:!0,MAX_UPLOAD_CACHE:50,UPLOAD_CACHE_INTERVAL:2e3,AJAX_REQUEST_CONCURRENT:3,REPORT_APP_SCENARIO:void 0,GATEWAY_DOMAINS:["edge.agora.io","edge.sd-rtn.com"],CONNECT_GATEWAY_WITHOUT_DOMAIN:!1,WORKER_DOMAIN:"edge.agora.io",EVENT_REPORT_RETRY:!0,CHROME_FORCE_PLAN_B:!1,AUDIO_SOURCE_VOLUME_UPDATE_INTERVAL:400,AUDIO_SOURCE_AVG_VOLUME_DURATION:3e3,AUDIO_VOLUME_INDICATION_INTERVAL:2e3,VOLUME_VOICE_WEIGHT:10,GET_VOLUME_OF_MUTED_AUDIO_TRACK:!1,STATS_UPDATE_INTERVAL:250,NORMAL_EVENT_QUEUE_CAPACITY:100,CUSTOM_REPORT:!0,CUSTOM_REPORT_LIMIT:20,PROXY_SERVER_TYPE2:"webnginx-proxy.agora.io",PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com","webrtc-cloud-proxy.agora.io"],CUSTOM_PUB_ANSWER_MODIFIER:null,CUSTOM_SUB_ANSWER_MODIFIER:null,CUSTOM_PUB_OFFER_MODIFIER:null,CUSTOM_SUB_OFFER_MODIFIER:null,DSCP_TYPE:"high",REMOVE_NEW_CODECS:!0,FRAGEMENT_LENGTH:3,WEBSOCKET_COMPRESS:!1,SIMULCAST:!1,PRELOAD_MEDIA_COUNT:0,CHECK_VIDEO_VISIBLE_INTERVAL:3e4,CHECK_LOCAL_STATS_INTERVAL:250,PROFILE_SWITCH_INTERVAL:2e3,UNSUPPORTED_VIDEO_CODEC:[],ENUMERATE_DEVICES_INTERVAL:!1,ENUMERATE_DEVICES_INTERVAL_TIME:1e4,USE_NEW_TOKEN:!1,CLOSE_AFB_FOR_LOCAL_AP:!0,JOIN_MAX_CONCURRENCY:6,JOIN_WITH_FALLBACK_SIGNAL_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE:!1,JOIN_GATEWAY_TRY_443PORT_DURATION:2e3,JOIN_GATEWAY_USE_443PORT_ONLY:!1,JOIN_GATEWAY_USE_DUAL_DOMAIN:!0,JOIN_GATEWAY_FALLBACK_PORT:443,USE_TURN_SERVER_OF_GATEWAY:!1,H264_PROFILE_LEVEL_ID:"",USE_NEW_LOG:!1,LOG_VERSION:3,MEDIA_DEVICE_CONSTRAINTS:null,ENCRYPT_PROXY_USERNAME_AND_PSW:!0,SDP_LOGGING:!1,CSP_DETECTED_HOSTNAME_LIST:["agora.io","sd-rtn.com"],REMOTE_AUDIO_TRACK_USES_WEB_AUDIO:!1,LOCAL_AUDIO_TRACK_USES_WEB_AUDIO:!1,BITRATE_ADAPTER_TYPE:"STANDARD_BITRATE",AI_DENOISER_PARAMETERS:{excludedLinks:[]},ADJUST_3A_FROM_PLUGINS:!0,RAISE_H264_BASELINE_PRIORITY:!0,FILTER_SEND_H264_BASELINE:!1,FIRST_H264_PROFILE_LEVEL_ID:"42001f",FIRST_PACKETIZATION_MODE:"",X_GOOGLE_START_BITRATE:void 0,NEW_REPORT_SERVER:!1,NEW_REPORT_SERVER_DOMAINS:["data-reporting.agora.io","data-reporting.agora.io"],VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT:3e5,VIDEO_INSPECT_INTERVAL_MINIMUM:1e3,VIDEO_INSPECT_QUALITY_RATIO:.9,VIDEO_INSPECT_WORKER_MANAGER_HOST:"edge.agora.io",VIDEO_INSPECT_WORKER_MANAGER_PORT:"",VIDEO_INSPECT_WORKER_PORT:"",SHOW_VIDEO_INSPECT_WORKER_MESSAGE:!1,STATS_COLLECTOR_PORT:443,FORCE_TURN_TCP:!1,WEBAUDIO_INIT_OPTIONS:void 0,FILTER_VIDEO_FEC:!0,FILTER_AUDIO_FEC:!1,CHROME_DUAL_STREAM_USE_ENCODING:!0,DISABLE_DUAL_STREAM_USE_ENCODING:!1,EXTENSION_USAGE_UPLOAD_INTERVAL:1e4,ICE_RESTART:!0,FINGERPRINT:null,ENABLE_VIDEO_FRAME_CALLBACK:!0,VIDEO_FREEZE_DURATION:500,SPATIALIZER_PARAMETERS:{},UPLOAD_LOG_INTERVAL:3e3,UPLOAD_LOG_REQUEST_RETRY_INTERVAL:2e3,UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL:2e4,UPLOAD_LOG_TRY_INTERVAL_WHILE_OFF:5e3,UPLOAD_LOG_RETRY_INTERVAL_V1:1e4,UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1:200,UPLOAD_LOG_LENGTH_EACH_TIME:10,APP_TYPE:0,DISABLE_WEBAUDIO:!1,CHANNEL_MEDIA_RELAY_SERVERS:void 0,KEEP_LAST_FRAME:!0,FORWARD_P2P_CREATION:!0,SYNC_GROUP:!0,BLOCK_LOCAL_CLIENT:!1,ENABLE_AUDIO_TOPN:!1,ENABLE_AUDIO_METADATA:!1,ENABLE_AUDIO_PTS_METADATA:!1,TOPN_SMOOTH_LEVEL:void 0,TOPN_NEW_SPEAKER_DELAY:void 0,TOPN_SWITCH_HOLD_MS:void 0,TOPN_AUDIO_GAIN:void 0,TOPN_SILENCE_THRESHOLD:250,AP_AREA:!0,ENABLE_ENCODED_TRANSFORM:!1,ENABLE_VIDEO_SEI:!1,IMAGE_MODERATION_WORKER_HOST:"edge.agora.io",IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT:3e5,IMAGE_MODERATION_INTERVAL_MINIMUM:1e3,SHOW_IMAGE_MODERATION_WORKER_MESSAGE:!1,IMAGE_MODERATION_QUALITY_RATIO:.9,IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL:5e3,SHOW_GLOBAL_CLIENT_LIST:!1,DATASTREAM_MAX_RETRANSMITS:10,TCP_CANDIDATE_ONLY:!1,EXTERNAL_SIGNAL_REQUEST_TIMEOUT:3e3,SHOW_P2P_LOG:!1,MAX_P2P_TIMEOUT:3e4,P2P_TOKEN_INTERVAL:1e3,SHOW_DATASTREAM2_LOG:!1,RESTRICTION_SET_PLAYBACK_DEVICE:!0,USE_PURE_ENCRYPTION_MASTER_KEY:!1,ACCOUNT_REGISTER_RETRY_TIMEOUT:1,ACCOUNT_REGISTER_RETRY_RATIO:2,ACCOUNT_REGISTER_RETRY_TIMEOUT_MAX:6e4,ACCOUNT_REGISTER_RETRY_COUNT_MAX:1e5,AUDIO_CONTEXT:null,WEBCS_BACKUP_CONNECT_TIMEOUT:6e3,PLAYER_STATE_DEFER:2e3,SIGNAL_REQUEST_WATCH_INTERVAL:1e3,FILEPATH_LENMAX:255,DUALSTREAM_OPERATION_CHECK:!0,MEDIA_ELEMENT_EXISTS_DEPTH:3,SHIM_CANDIDATE:!1,LEAVE_MSG_TIMEOUT:2e3,STATS_FILTER:{transportId:!0,googTrackId:!0},FILTER_VIDEO_CODEC:[],USE_NEW_NETWORK_CONFIG:!1,AUTO_RESET_AUDIO_ROUTE:!1,PLUGIN_INFO:[],OVERUSE_DETECTOR_PARAMS:DL,CUSTOM_ADAPTATION_DEFAULT_MODE:"",HIDE_NO_POSTER:!1,AP_CACHE_NUM:10,AP_UPDATE_INTERVAL:12e4,AP_CACHE_LIFETIME:12e4,MAX_PRELOAD_ASYNC_LENGTH:3,DISABLE_SCREEN_SHARE_REMB:!1},rP),{},{USE_CANDIDATE_FROM_AP_DETAIL:!1,AP_REQUEST_DETAIL:void 0,ENABLE_ROLE_SELECT_EDGE:!1,CLIENT_ROLE_OPTIONS:void 0,COMPATIBLE_SDP_EXTENSION:["gdpr_forbidden"],LIMIT_BITRATE:void 0,EXPERIMENTS:{},USE_PUB_RTX:!0,USE_SUB_RTX:!0,ENABLE_DATASTREAM_2:!1,USE_XR:!0,ENABLE_PREALLOC_PC:!1,ENABLE_PRE_SUB:!1,ENABLE_SVC:!1},{INSTALL_ID:""});function rr(t,r,s){var a,c,u;ot(a=Object.keys(br)).call(a,t)&&(!s&&ot(c=Object.keys(Sd)).call(c,t)||(br[t]=r,t!=="ENABLE_VIDEO_SEI"&&t!=="ENABLE_AUDIO_TOPN"&&t!=="ENABLE_AUDIO_METADATA"&&t!=="ENABLE_AUDIO_PTS_METADATA"||r!==!0||(br.ENABLE_ENCODED_TRANSFORM=!0,t==="ENABLE_AUDIO_PTS_METADATA"&&(br.ENABLE_AUDIO_METADATA=!0)),t==="USE_NEW_NETWORK_CONFIG"&&r&&(u=!!r,br.USE_NEW_NETWORK_CONFIG=u,u&&(br.WEBCS_DOMAIN=["webrtc2-2.ap.sd-rtn.com"],br.WEBCS_DOMAIN_BACKUP_LIST=["webrtc2-4.ap.sd-rtn.com"],br.CDS_AP=["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],br.ACCOUNT_REGISTER=["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],br.EVENT_REPORT_DOMAIN="web-2.statscollector.sd-rtn.com",br.EVENT_REPORT_BACKUP_DOMAIN="statscollector-1.agora.io",br.GATEWAY_DOMAINS=["edge.sd-rtn.com"])),t==="ENABLE_PRE_SUB"&&r&&(br.ENABLE_INSTANT_VIDEO=!0,br.ENABLE_PREALLOC_PC=!0),t==="ENABLE_SVC"&&r&&(br.ENABLE_AUT_CC=!0),t==="NEW_FORCE_TURN"&&r&&(br.NEW_TURN_MODE||(br.NEW_TURN_MODE=4))))}function oe(t){return br[t]}NL||(br.WEBCS_DOMAIN=["ap-web-1-oversea.agora.io","ap-web-1-north-america.agora.io"],br.WEBCS_DOMAIN_BACKUP_LIST=["ap-web-2-oversea.agora.io","ap-web-2-north-america.agora.io"],br.PROXY_CS=["proxy-ap-web-oversea.agora.io","proxy-ap-web-america.agora.io"],br.CDS_AP=["cds-ap-web-oversea.agora.io","cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],br.ACCOUNT_REGISTER=["sua-ap-web-oversea.agora.io","sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],br.UAP_AP=["uap-ap-web-oversea.agora.io","uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],br.LOG_UPLOAD_SERVER="logservice-oversea.agora.io",br.EVENT_REPORT_DOMAIN="statscollector-1-oversea.agora.io",br.EVENT_REPORT_BACKUP_DOMAIN="statscollector-2-oversea.agora.io",br.PROXY_SERVER_TYPE3="webrtc-cloud-proxy.agora.io",br.AREAS=["NORTH_AMERICA","OVERSEA"]);let iz=function(t){return t[t.REALTIME=1]="REALTIME",t}({});const Sd={};var Tn=function(t){return t.SET_SESSION_ID="SET_SESSION_ID",t.SET_P2P_ID="SET_P2P_id",t.SET_DC_ID="SET_DC_id",t.SET_UID="SET_UID",t.SET_INT_UID="SET_INT_UID",t.SET_PUB_ID="SET_PUB_ID",t.SET_CLOUD_PROXY_SERVER_MODE="SET_CLOUD_PROXY_SERVER_MODE",t.KEY_METRIC_CLIENT_CREATED="KEY_METRIC_CLIENT_CREATED",t.KEY_METRIC_JOIN_START="KEY_METRIC_JOIN_START",t.AVOID_JOIN_START="AVOID_JOIN_START",t.KEY_METRIC_JOIN_END="KEY_METRIC_JOIN_END",t.KEY_METRIC_REQUEST_AP_START="KEY_METRIC_REQUEST_AP_START",t.KEY_METRIC_REQUEST_AP_END="KEY_METRIC_REQUEST_AP_END",t.KEY_METRIC_JOIN_GATEWAY_START="KEY_METRIC_JOIN_GATEWAY_START",t.KEY_METRIC_JOIN_GATEWAY_END="KEY_METRIC_JOIN_GATEWAY_END",t.KEY_METRIC_PEER_CONNECTION_START="KEY_METRIC_PEER_CONNECTION_START",t.KEY_METRIC_PEER_CONNECTION_END="KEY_METRIC_PEER_CONNECTION_END",t.KEY_METRIC_DESCRIPTION_START="KEY_METRIC_DESCRIPTION_START",t.KEY_METRIC_ICE_CONNECTION_END="KEY_METRIC_ICE_CONNECTION_END",t.KEY_METRIC_SIGNAL_CHANNEL_OPEN="KEY_METRIC_SIGNAL_CHANNEL_OPEN",t.KEY_METRIC_PUBLISH="KEY_METRIC_PUBLISH",t.KEY_METRIC_SUBSCRIBE="KEY_METRIC_SUBSCRIBE",t.RECORD_JOIN_CHANNEL_SERVICE="RECORD_JOIN_CHANNEL_SERVICE",t.RESET_JOIN_CHANNEL_SERVICE_RECORDS="RESET_JOIN_CHANNEL_SERVICE_RECORDS",t.RESET_KEY_METRICS="RESET_KEY_METRICS",t.SET_USE_P2P="SET_USE_P2P",t.SET_TRANSPORT_TYPE="SET_TRANSPORT_TYPE",t}(Tn||{});let iP=function(t){return t.h264="h264",t.h265="h265",t.vp8="vp8",t.vp9="vp9",t.av1="av1",t}({});(function(t){t.opus="opus",t.pcma="pcma",t.pcmu="pcmu",t.g722="g722"})({});const sz=128,rme=96,oz=1e3,$v=10;let ime=0;var az=(()=>{var t={8:(a,c,u)=>{u.r(c),u.d(c,{Parser:()=>ht,Printer:()=>di,parse:()=>st,print:()=>Ct});const h=`
`,m="".concat("\r").concat(h),y=" ";let v;function S(He){return He>="0"&&He<="9"}function R(He){return He>="!"&&He<="~"}function P(He){return R(He)||He>=""&&He<=""}function D(He){return He==="!"||He>="#"&&He<="'"||He>="*"&&He<="+"||He>="-"&&He<="."||He>="0"&&He<="9"||He>="A"&&He<="Z"||He>="^"&&He<="~"}function G(He){return He>="1"&&He<="9"}function F(He){return He>="A"&&He<="Z"||He>="a"&&He<="z"}function j(He){return He==="d"||He==="h"||He==="m"||He==="s"}function Y(He){return He>""&&He<"	"||He>"\v"&&He<"\f"||He>""&&He<""}function ee(He){return F(He)||S(He)||He==="+"||He==="/"}function fe(He){return S(He)||F(He)||He==="+"||He==="/"||He==="-"||He==="_"}function Se(He){return F(He)||S(He)||He==="+"||He==="/"}function we(He,M){var ae=Object.keys(He);if(Object.getOwnPropertySymbols){var me=Object.getOwnPropertySymbols(He);M&&(me=me.filter(function(Qe){return Object.getOwnPropertyDescriptor(He,Qe).enumerable})),ae.push.apply(ae,me)}return ae}function ye(He){for(var M=1;M<arguments.length;M++){var ae=arguments[M]!=null?arguments[M]:{};M%2?we(Object(ae),!0).forEach(function(me){Ne(He,me,ae[me])}):Object.getOwnPropertyDescriptors?Object.defineProperties(He,Object.getOwnPropertyDescriptors(ae)):we(Object(ae)).forEach(function(me){Object.defineProperty(He,me,Object.getOwnPropertyDescriptor(ae,me))})}return He}function Ne(He,M,ae){return M in He?Object.defineProperty(He,M,{value:ae,enumerable:!0,configurable:!0,writable:!0}):He[M]=ae,He}(function(He){He.VERSION="v",He.ORIGIN="o",He.SESSION_NAME="s",He.INFORMATION="i",He.URI="u",He.EMAIL="e",He.PHONE="p",He.CONNECTION="c",He.BANDWIDTH="b",He.TIME="t",He.REPEAT="r",He.ZONE_ADJUSTMENTS="z",He.KEY="k",He.ATTRIBUTE="a",He.MEDIA="m"})(v||(v={}));class Ye{consumeText(M,ae){let me=ae;for(;me<M.length;){const Qe=M[me];if(Qe==="\0"||Qe==="\r"||Qe===h)break;me+=1}if(me-ae==0)throw new Error("Invalid text, at ".concat(M));return me}consumeUnicastAddress(M,ae,me){return this.consumeTill(M,ae,y)}consumeOneOrMore(M,ae,me){let Qe=ae;for(;me(M[Qe]);)Qe++;if(Qe-ae==0)throw new Error("Invalid rule at ".concat(ae,"."));return Qe}consumeSpace(M,ae){if(M[ae]===y)return ae+1;throw new Error("Invalid space at ".concat(ae,"."))}consumeIP4Address(M,ae){let me=ae;for(let Qe=0;Qe<4;Qe++)if(me=this.consumeDecimalUChar(M,me),Qe!==3){if(M[me]!==".")throw new Error("Invalid IP4 address.");me++}return me}consumeDecimalUChar(M,ae){let me=ae;for(let Jt=0;Jt<3&&S(M[me]);Jt++,me++);if(me-ae==0)throw new Error("Invalid decimal uchar.");const Qe=parseInt(M.slice(ae,me));if(Qe>=0&&Qe<=255)return me;throw new Error("Invalid decimal uchar")}consumeIP6Address(M,ae){let me=this.consumeHexpart(M,ae);return M[me]===":"&&(me+=1,me=this.consumeIP4Address(M,me)),me}consumeHexpart(M,ae){let me=ae;if(M[me]===":"&&M[me+1]===":"){me+=2;try{me=this.consumeHexseq(M,me)}catch{}return me}if(me=this.consumeHexseq(M,me),M[me]===":"&&M[me+1]===":"){me+=2;try{me=this.consumeHexseq(M,me)}catch{}return me}return me}consumeHexseq(M,ae){let me=ae;for(;me=this.consumeHex4(M,me),M[me]===":"&&M[me+1]!==":";)me+=1;return me}consumeHex4(M,ae){let me=0;for(;me<4;me++)if(!((Qe=M[ae+me])>="0"&&Qe<="9"||Qe>="a"&&Qe<="f"||Qe>="A"&&Qe<="F")){if(me===0)throw new Error("Invalid hex 4");break}var Qe;return ae+me}consumeFQDN(M,ae){let me=ae;for(;S(M[me])||F(M[me])||M[me]==="-"||M[me]===".";)me+=1;if(me-ae<4)throw new Error("Invalid FQDN");return me}consumeExtnAddr(M,ae){return this.consumeOneOrMore(M,ae,P)}consumeMulticastAddress(M,ae,me){switch(me){case"IP4":case"ip4":return this.consumeIP4MulticastAddress(M,ae);case"IP6":case"ip6":return this.consumeIP6MulticastAddress(M,ae);default:try{return this.consumeFQDN(M,ae)}catch{return this.consumeExtnAddr(M,ae)}}}consumeIP6MulticastAddress(M,ae){const me=this.consumeHexpart(M,ae);return M[me]==="/"?this.consumeInteger(M,me+1):me}consumeIP4MulticastAddress(M,ae){let me=ae+3;const Qe=M.slice(ae,me),Jt=parseInt(Qe);if(Jt<224||Jt>239)throw new Error("Invalid IP4 multicast address, IPv4 multicast addresses may be in the range 224.0.0.0 to 239.255.255.255.");for(let ar=0;ar<3;ar++){if(M[me]!==".")throw new Error("Invalid IP4 multicast address.");me+=1,me=this.consumeDecimalUChar(M,me)}return M[me]==="/"&&(me+=1),me=this.consumeTTL(M,me),M[me]==="/"&&(me=this.consumeInteger(M,me)),me}consumeInteger(M,ae){if(!G(M[ae]))throw new Error("Invalid integer.");for(ae+=1;S(M[ae]);)ae+=1;return ae}consumeTTL(M,ae){if(M[ae]==="0")return ae+1;if(!G(M[ae]))throw new Error("Invalid TTL.");ae+=1;for(let me=0;me<2&&S(M[ae]);me++)ae+=1;return ae}consumeToken(M,ae){return this.consumeOneOrMore(M,ae,D)}consumeTime(M,ae){let me=ae;if(M[me]==="0")return me+1;for(G(M[me])&&(me+=1);S(M[me]);)me++;if(me-ae<10)throw new Error("Invalid time");return me}consumeAddress(M,ae){return this.consumeTill(M,ae,y)}consumeTypedTime(M,ae){let me=ae;return me=this.consumeOneOrMore(M,me,S),j(M[me])?me+1:me}consumeRepeatInterval(M,ae){if(!G(M[ae]))throw new Error("Invalid repeat interval");for(ae+=1;S(M[ae]);)ae+=1;return j(M[ae])&&(ae+=1),ae}consumePort(M,ae){return this.consumeOneOrMore(M,ae,S)}consume(M,ae,me){for(let Qe=0;Qe<me.length;Qe++){if(ae+Qe>=M.length)throw new Error("consume exceeding value length");if(M[ae+Qe]!==me[Qe])throw new Error("consume ".concat(me," failed at ").concat(Qe))}return ae+me.length}consumeTill(M,ae,me){let Qe=ae;for(;Qe<M.length&&(typeof me!="string"||M[Qe]!==me)&&(typeof me!="function"||!me(M[Qe]));)Qe++;return Qe}}class ht extends Ye{constructor(){super(),Ne(this,"records",[]),Ne(this,"currentLine",0)}parse(M){const ae=this.probeEOL(M);this.records=M.split(ae).filter(py=>!!_o(py).call(py)).map(this.parseLine),this.currentLine=0;const me=this.parseVersion(),Qe=this.parseOrigin(),Jt=this.parseSessionName(),ar=this.parseInformation(),ts=this.parseUri(),$a=this.parseEmail(),yp=this.parsePhone(),fy=this.parseConnection(),_w=this.parseBandWidth(),mO=this.parseTimeFields(),gO=this.parseKey(),Ml=this.parseSessionAttribute(),lg=this.parseMediaDescription();if(this.currentLine!==this.records.length)throw new Error("parsing failed, non exhaustive sdp lines.");return{version:me,origin:Qe,sessionName:Jt,information:ar,uri:ts,emails:$a,phones:yp,connection:fy,bandwidths:_w,timeFields:mO,key:gO,attributes:Ml,mediaDescriptions:lg}}getCurrentRecord(){const M=this.records[this.currentLine];if(!M)throw new Error("Record doesn't exit.");return M}probeEOL(M){for(let ae=0;ae<M.length;ae++)if(M[ae]===h)return M[ae-1]==="\r"?m:h;throw new Error("Invalid newline character.")}parseLine(M,ae){if(M.length<2)throw new Error("Invalid sdp line, sdp line should be of form <type>=<value>.");const me=M[0];if(M[1]!=="=")throw new Error('Invalid sdp line, <type> should be a single character followed by an "=" sign.');return{type:me,value:M.slice(2),line:ae,cur:0}}parseSessionAttribute(){const M=new In;for(;this.currentLine<this.records.length;){const ae=this.getCurrentRecord();if(ae.type!==v.ATTRIBUTE)break;const me={attField:this.extractOneOrMore(ae,Qe=>D(Qe)&&Qe!==":"),_cur:0};ae.value[ae.cur]===":"&&(ae.cur+=1,me.attValue=this.extractOneOrMore(ae,Y)),M.parse(me),this.currentLine++}return M.digest()}parseMediaAttributes(M){const ae=new An(M);for(;this.currentLine<this.records.length;){const me=this.getCurrentRecord();if(me.type!==v.ATTRIBUTE)break;const Qe={attField:this.extractOneOrMore(me,Jt=>D(Jt)&&Jt!==":"),_cur:0};me.value[me.cur]===":"&&(me.cur+=1,Qe.attValue=this.extractOneOrMore(me,Y)),ae.parse(Qe),this.currentLine++}return ae.digest()}parseKey(){const M=this.getCurrentRecord();if(M.type===v.KEY){if(M.value==="prompt"||M.value==="clear:"||M.value==="base64:"||M.value==="uri:")return M.value;throw this.currentLine++,new Error("Invalid key.")}}parseZone(){const M=this.getCurrentRecord();if(M.type===v.ZONE_ADJUSTMENTS){const ae=[];for(;;)try{const me=this.extract(M,this.consumeTime);this.consumeSpaceForRecord(M);let Qe=!1;M.value[M.cur]==="-"&&(Qe=!0,M.cur+=1);const Jt=this.extract(M,this.consumeTypedTime);ae.push({time:me,typedTime:Jt,back:Qe})}catch{break}if(ae.length===0)throw new Error("Invalid zone adjustments");return this.currentLine++,ae}return[]}parseRepeat(){const M=[];for(;;){const ae=this.getCurrentRecord();if(ae.type!==v.REPEAT)break;{const me=this.extract(ae,this.consumeRepeatInterval),Qe=this.parseTypedTime(ae);M.push({repeatInterval:me,typedTimes:Qe}),this.currentLine++}}return M}parseTypedTime(M){const ae=[];for(;;)try{this.consumeSpaceForRecord(M),ae.push(this.extract(M,this.consumeTypedTime))}catch{break}if(ae.length===0)throw new Error("Invalid typed time.");return ae}parseTime(){const M=this.getCurrentRecord(),ae=this.extract(M,this.consumeTime);this.consumeSpaceForRecord(M);const me=this.extract(M,this.consumeTime);return this.currentLine++,{startTime:ae,stopTime:me}}parseBandWidth(){const M=[];for(;this.currentLine<this.records.length;){const ae=this.getCurrentRecord();if(ae.type!==v.BANDWIDTH)break;{const me=this.extractOneOrMore(ae,D);if(ae.value[ae.cur]!==":")throw new Error("Invalid bandwidth field.");ae.cur++;const Qe=this.extractOneOrMore(ae,S);M.push({bwtype:me,bandwidth:Qe}),this.currentLine++}}return M}parseVersion(){const M=this.getCurrentRecord();if(M.type!==v.VERSION)throw new Error("first sdp record must be version");const ae=M.value.slice(0,this.consumeOneOrMore(M.value,0,S));if(ae.length!==M.value.length)throw new Error('invalid proto version, "v='.concat(M.value,'"'));return this.currentLine++,ae}parseOrigin(){const M=this.getCurrentRecord();if(M.type!==v.ORIGIN)throw new Error("second line of sdp must be origin");const ae=this.extractOneOrMore(M,P);this.consumeSpaceForRecord(M);const me=this.extractOneOrMore(M,S);this.consumeSpaceForRecord(M);const Qe=this.extractOneOrMore(M,S);this.consumeSpaceForRecord(M);const Jt=this.extractOneOrMore(M,D);this.consumeSpaceForRecord(M);const ar=this.extractOneOrMore(M,D);this.consumeSpaceForRecord(M);const ts=this.extract(M,this.consumeUnicastAddress);return this.currentLine++,{username:ae,sessId:me,sessVersion:Qe,nettype:Jt,addrtype:ar,unicastAddress:ts}}parseSessionName(){const M=this.getCurrentRecord();if(M.type===v.SESSION_NAME){const ae=this.extract(M,this.consumeText);return this.currentLine++,ae}}parseInformation(){const M=this.getCurrentRecord();if(M.type!==v.INFORMATION)return;const ae=this.extract(M,this.consumeText);return this.currentLine++,ae}parseUri(){const M=this.getCurrentRecord();if(M.type===v.URI)return this.currentLine++,M.value}parseEmail(){const M=[];for(;;){const ae=this.getCurrentRecord();if(ae.type!==v.EMAIL)break;M.push(ae.value),this.currentLine++}return M}parsePhone(){const M=[];for(;;){const ae=this.getCurrentRecord();if(ae.type!==v.PHONE)break;M.push(ae.value),this.currentLine++}return M}parseConnection(){const M=this.getCurrentRecord();if(M.type===v.CONNECTION){const ae=this.extractOneOrMore(M,D);this.consumeSpaceForRecord(M);const me=this.extractOneOrMore(M,D);this.consumeSpaceForRecord(M);const Qe=this.extract(M,this.consumeAddress);return this.currentLine++,{nettype:ae,addrtype:me,address:Qe}}}parseMedia(){const M=this.getCurrentRecord(),ae=this.extract(M,this.consumeToken);this.consumeSpaceForRecord(M);let me=this.extract(M,this.consumePort);M.value[M.cur]==="/"&&(M.cur+=1,me+=this.extract(M,this.consumeInteger)),this.consumeSpaceForRecord(M);const Qe=[];for(Qe.push(this.extract(M,this.consumeToken));M.value[M.cur]==="/";)M.cur+=1,Qe.push(this.extract(M,this.consumeToken));if(Qe.length===0)throw new Error("Invalid proto");const Jt=this.parseFmt(M);return this.currentLine++,{mediaType:ae,port:me,protos:Qe,fmts:Jt}}parseTimeFields(){const M=[];for(;this.getCurrentRecord().type===v.TIME;){const ae=this.parseTime(),me=this.parseRepeat(),Qe=this.parseZone();M.push({time:ae,repeats:me,zones:Qe})}return M}parseMediaDescription(){const M=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===v.MEDIA;){const ae=this.parseMedia(),me=this.parseInformation(),Qe=this.parseConnections(),Jt=this.parseBandWidth(),ar=this.parseKey(),ts=this.parseMediaAttributes(ae);M.push({media:ae,information:me,connections:Qe,bandwidths:Jt,key:ar,attributes:ts})}return M}parseConnections(){const M=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===v.CONNECTION;)M.push(this.parseConnection());return M}parseFmt(M){const ae=[];for(;;)try{this.consumeSpaceForRecord(M),ae.push(this.extract(M,this.consumeToken))}catch{break}if(ae.length===0)throw new Error("Invalid fmts");return ae}extract(M,ae){for(var me=arguments.length,Qe=new Array(me>2?me-2:0),Jt=2;Jt<me;Jt++)Qe[Jt-2]=arguments[Jt];const ar=ae.call(this,M.value,M.cur,...Qe),ts=M.value.slice(M.cur,ar);return M.cur=ar,ts}extractOneOrMore(M,ae){const me=this.consumeOneOrMore(M.value,M.cur,ae),Qe=M.value.slice(M.cur,me);return M.cur=me,Qe}consumeSpaceForRecord(M){if(M.value[M.cur]!==y)throw new Error("Invalid space at ".concat(M.cur,"."));M.cur+=1}}class mt extends Ye{constructor(){super(...arguments),Ne(this,"attributes",void 0),Ne(this,"digested",!1)}extractOneOrMore(M,ae,me){const Qe=this.consumeOneOrMore(M.attValue,M._cur,ae),Jt=M.attValue.slice(M._cur,Qe),[ar,ts]=me||[];if(typeof ar=="number"&&Jt.length<ar)throw new Error("error in length, should be more or equal than ".concat(ar," characters."));if(typeof ts=="number"&&Jt.length>ts)throw new Error("error in length, should be less or equal than ".concat(ts," characters."));return M._cur=Qe,Jt}consumeAttributeSpace(M){if(M.attValue[M._cur]!==y)throw new Error("Invalid space at ".concat(M._cur,"."));M._cur+=1}extract(M,ae){if(!M.attValue)throw new Error("Nothing to extract from attValue.");for(var me=arguments.length,Qe=new Array(me>2?me-2:0),Jt=2;Jt<me;Jt++)Qe[Jt-2]=arguments[Jt];const ar=ae.call(this,M.attValue,M._cur,...Qe),ts=M.attValue.slice(M._cur,ar);return M._cur=ar,ts}atEnd(M){if(!M.attValue)throw new Error;return M._cur>=M.attValue.length}peekChar(M){if(!M.attValue)throw new Error;return M.attValue[M._cur]}peek(M,ae){if(!M.attValue)throw new Error;for(let me=0;me<ae.length;me++)if(ae[me]!==M.attValue[M._cur+me])return!1;return!0}parseIceUfrag(M){if(this.attributes.iceUfrag)throw new Error("Invalid ice-ufrag, should be only a single line if 'a=ice-ufrag'");this.attributes.iceUfrag=this.extractOneOrMore(M,ee,[4,256])}parseIcePwd(M){if(this.attributes.icePwd)throw new Error("Invalid ice-pwd, should be only a single line if 'a=ice-pwd'");this.attributes.icePwd=this.extractOneOrMore(M,ee,[22,256])}parseIceOptions(M){if(this.attributes.iceOptions)throw new Error("Invalid ice-options, should be only one 'ice-options' line");const ae=[];for(;!this.atEnd(M);){ae.push(this.extractOneOrMore(M,ee));try{this.consumeAttributeSpace(M)}catch(me){if(this.atEnd(M))break;throw me}}this.attributes.iceOptions=ae}parseFingerprint(M){const ae=this.extract(M,this.consumeToken);this.consumeAttributeSpace(M);const me=this.extract(M,this.consumeTill);this.attributes.fingerprints.push({hashFunction:ae,fingerprint:me})}parseExtmap(M){const ae=this.extractOneOrMore(M,S);let me;this.peekChar(M)==="/"&&(this.extract(M,this.consume,"/"),me=this.extract(M,this.consumeToken)),this.consumeAttributeSpace(M);const Qe=this.extract(M,this.consumeTill,y),Jt=ye(ye({entry:parseInt(ae,10)},me&&{direction:me}),{},{extensionName:Qe});this.peekChar(M)===y&&(this.consumeAttributeSpace(M),Jt.extensionAttributes=this.extract(M,this.consumeTill)),this.attributes.extmaps.push(Jt)}parseSetup(M){if(this.attributes.setup)throw new Error("must only be one single 'a=setup' line.");const ae=this.extract(M,this.consumeTill);if(ae!=="active"&&ae!=="passive"&&ae!=="actpass"&&ae!=="holdconn")throw new Error("role must be one of 'active', 'passive', 'actpass', 'holdconn'.");this.attributes.setup=ae}}class In extends mt{constructor(){super(...arguments),Ne(this,"attributes",{unrecognized:[],groups:[],extmaps:[],fingerprints:[],identities:[]})}parse(M){if(this.digested)throw new Error("already digested");try{switch(M.attField){case"group":this.parseGroup(M);break;case"ice-lite":this.parseIceLite();break;case"ice-ufrag":this.parseIceUfrag(M);break;case"ice-pwd":this.parseIcePwd(M);break;case"ice-options":this.parseIceOptions(M);break;case"fingerprint":this.parseFingerprint(M);break;case"setup":this.parseSetup(M);break;case"tls-id":this.parseTlsId(M);break;case"identity":this.parseIdentity(M);break;case"extmap":this.parseExtmap(M);break;case"msid-semantic":this.parseMsidSemantic(M);break;default:M.ignored=!0,this.attributes.unrecognized.push(M)}}catch(ae){throw console.error("parsing session attribute ".concat(M.attField,' error, "a=').concat(M.attField,":").concat(M.attValue,'"')),ae}if(!M.ignored&&M.attValue&&!this.atEnd(M))throw new Error("attribute parsing error")}digest(){return this.digested=!0,this.attributes}parseGroup(M){const ae=this.extract(M,this.consumeToken),me=[];for(;!this.atEnd(M)&&this.peekChar(M)===y;)this.consumeAttributeSpace(M),me.push(this.extract(M,this.consumeToken));this.attributes.groups.push({semantic:ae,identificationTag:me})}parseIceLite(){if(this.attributes.iceLite)throw new Error("Invalid ice-lite, should be only a single line of 'a=ice-lite'");this.attributes.iceLite=!0}parseTlsId(M){if(this.attributes.tlsId)throw new Error("must be only one tld-id line");this.attributes.tlsId=this.extractOneOrMore(M,fe)}parseIdentity(M){const ae=this.extractOneOrMore(M,Se),me=[];for(;!this.atEnd(M)&&this.peekChar(M)===y;){this.consumeAttributeSpace(M);const Qe=this.extract(M,this.consumeToken);this.extract(M,this.consume,"=");const Jt=this.extractOneOrMore(M,ar=>ar!==y&&Y(ar));me.push({name:Qe,value:Jt})}this.attributes.identities.push({assertionValue:ae,extensions:me})}parseMsidSemantic(M){this.peekChar(M)===y&&this.consumeAttributeSpace(M);const ae={semantic:this.extract(M,this.consumeToken),identifierList:[]};for(;;){try{this.consumeAttributeSpace(M)}catch{break}if(this.peekChar(M)==="*"){this.extract(M,this.consume,"*"),ae.applyForAll=!0;break}{const me=this.extract(M,this.consumeTill,y);ae.identifierList.push(me)}}this.attributes.msidSemantic=ae}}class An extends mt{constructor(M){super(),Ne(this,"attributes",void 0),M.protos.indexOf("RTP")!==-1||M.protos.indexOf("rtp"),this.attributes={unrecognized:[],candidates:[],extmaps:[],fingerprints:[],imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[]}}parse(M){if(this.digested)throw new Error("already digested");try{switch(M.attField){case"extmap":this.parseExtmap(M);break;case"setup":this.parseSetup(M);break;case"ice-ufrag":this.parseIceUfrag(M);break;case"ice-pwd":this.parseIcePwd(M);break;case"ice-options":this.parseIceOptions(M);break;case"candidate":this.parseCandidate(M);break;case"remote-candidate":this.parseRemoteCandidate(M);break;case"end-of-candidates":this.parseEndOfCandidates();break;case"fingerprint":this.parseFingerprint(M);break;case"rtpmap":this.parseRtpmap(M);break;case"ptime":this.parsePtime(M);break;case"maxptime":this.parseMaxPtime(M);break;case"sendrecv":case"recvonly":case"sendonly":case"inactive":this.parseDirection(M);break;case"ssrc":this.parseSSRC(M);break;case"fmtp":this.parseFmtp(M);break;case"rtcp-fb":this.parseRtcpFb(M);break;case"rtcp-mux":this.parseRTCPMux();break;case"rtcp-mux-only":this.parseRTCPMuxOnly();break;case"rtcp-rsize":this.parseRTCPRsize();break;case"rtcp":this.parseRTCP(M);break;case"mid":this.parseMid(M);break;case"msid":this.parseMsid(M);break;case"imageattr":this.parseImageAttr(M);break;case"rid":this.parseRid(M);break;case"simulcast":this.parseSimulcast(M);break;case"sctp-port":this.parseSctpPort(M);break;case"max-message-size":this.parseMaxMessageSize(M);break;case"ssrc-group":this.parseSSRCGroup(M);break;default:M.ignored=!0,this.attributes.unrecognized.push(M)}}catch(ae){throw console.error("parsing media attribute ".concat(M.attField,' error, "a=').concat(M.attField,":").concat(M.attValue,'"')),ae}if(!M.ignored&&M.attValue&&!this.atEnd(M))throw new Error("attribute parsing error")}parseCandidate(M){const ae=this.extractOneOrMore(M,ee,[1,32]);this.consumeAttributeSpace(M);const me=this.extractOneOrMore(M,S,[1,5]);this.consumeAttributeSpace(M);const Qe=this.extract(M,this.consumeToken);this.consumeAttributeSpace(M);const Jt=this.extractOneOrMore(M,S,[1,10]);this.consumeAttributeSpace(M);const ar=this.extract(M,this.consumeAddress);this.consumeAttributeSpace(M);const ts=this.extract(M,this.consumePort);this.consumeAttributeSpace(M),this.extract(M,this.consume,"typ"),this.consumeAttributeSpace(M);const $a={foundation:ae,componentId:me,transport:Qe,priority:Jt,connectionAddress:ar,port:ts,type:this.extract(M,this.consumeToken),extension:{}};for(this.peek(M," raddr")&&(this.extract(M,this.consume," raddr"),this.consumeAttributeSpace(M),$a.relAddr=this.extract(M,this.consumeAddress)),this.peek(M," rport")&&(this.extract(M,this.consume," rport"),this.consumeAttributeSpace(M),$a.relPort=this.extract(M,this.consumePort));this.peekChar(M)===y;){this.consumeAttributeSpace(M);const yp=this.extract(M,this.consumeToken);this.consumeAttributeSpace(M),$a.extension[yp]=this.extractOneOrMore(M,R)}this.attributes.candidates.push($a)}parseRemoteCandidate(M){const ae=[];for(;;){const me=this.extractOneOrMore(M,S,[1,5]);this.consumeAttributeSpace(M);const Qe=this.extract(M,this.consumeAddress);this.consumeAttributeSpace(M);const Jt=this.extract(M,this.consumePort);ae.push({componentId:me,connectionAddress:Qe,port:Jt});try{this.consumeAttributeSpace(M)}catch{break}}this.attributes.remoteCandidatesList.push(ae)}parseEndOfCandidates(){if(this.attributes.endOfCandidates)throw new Error("must be only one line of end-of-candidates");this.attributes.endOfCandidates=!0}parseRtpmap(M){const ae=this.extract(M,this.consumeToken);this.consumeAttributeSpace(M);const me=this.extract(M,this.consumeTill,"/");this.extract(M,this.consume,"/");const Qe={encodingName:me,clockRate:this.extractOneOrMore(M,S)};this.atEnd(M)||this.peekChar(M)!=="/"||(this.extract(M,this.consume,"/"),Qe.encodingParameters=parseInt(this.extract(M,this.consumeTill),10));const Jt=this.attributes.payloads.find(ar=>ar.payloadType===parseInt(ae,10));Jt?Jt.rtpMap=Qe:this.attributes.payloads.push({payloadType:parseInt(ae,10),rtpMap:Qe,rtcpFeedbacks:[]})}parsePtime(M){if(this.attributes.ptime)throw new Error("must be only one line of ptime");this.attributes.ptime=this.extract(M,this.consumeTill)}parseMaxPtime(M){if(this.attributes.maxPtime)throw new Error("must be only one line of ptime");this.attributes.maxPtime=this.extract(M,this.consumeTill)}parseDirection(M){if(this.attributes.direction)throw new Error("must be only one line of direction info");this.attributes.direction=M.attField}parseSSRC(M){const ae=this.extractOneOrMore(M,S);this.consumeAttributeSpace(M);const me=this.extract(M,this.consumeTill,":");let Qe;this.peekChar(M)===":"&&(this.extract(M,this.consume,":"),Qe=this.extract(M,this.consumeTill));const Jt=this.attributes.ssrcs.find(ar=>ar.ssrcId===parseInt(ae,10));Jt?Jt.attributes[me]=Qe:this.attributes.ssrcs.push({ssrcId:parseInt(ae,10),attributes:{[me]:Qe}})}parseFmtp(M){const ae=this.extract(M,this.consumeTill,y);this.consumeAttributeSpace(M);const me=this.extract(M,this.consumeTill),Qe={};me.split(";").forEach(ar=>{let[ts,$a]=ar.split("=");ts=_o(ts).call(ts);const yp=typeof $a=="string"?_o($a).call($a):null;typeof ts=="string"&&ts.length>0&&(Qe[ts]=yp)});const Jt=this.attributes.payloads.find(ar=>ar.payloadType===parseInt(ae,10));Jt?Jt.fmtp={parameters:Qe}:this.attributes.payloads.push({payloadType:parseInt(ae,10),rtcpFeedbacks:[],fmtp:{parameters:Qe}})}parseFmtParameters(M){const ae={},me=this.extract(M,this.consumeTill,"=");M._cur++;const Qe=this.extract(M,this.consumeTill,";");for(ae[me]=Qe;M.attValue[M._cur]===";";){const Jt=this.extract(M,this.consumeTill,"=");M._cur++;const ar=this.extract(M,this.consumeTill,";");ae[Jt]=ar}return ae}parseRtcpFb(M){let ae="";ae=this.peekChar(M)==="*"?this.extract(M,this.consume,"*"):this.extract(M,this.consumeTill,y),this.consumeAttributeSpace(M);const me=this.extract(M,this.consumeTill,y);let Qe;if(me==="trr-int")Qe={type:me,interval:this.extract(M,this.consumeTill)};else{const Jt={type:me};this.peekChar(M)===y&&(this.consumeAttributeSpace(M),Jt.parameter=this.extract(M,this.consumeToken),this.peekChar(M)===y&&(Jt.additional=this.extract(M,this.consumeTill))),Qe=Jt}if(ae==="*")this.attributes.rtcpFeedbackWildcards.push(Qe);else{const Jt=this.attributes.payloads.find(ar=>ar.payloadType===parseInt(ae,10));Jt?Jt.rtcpFeedbacks.push(Qe):this.attributes.payloads.push({payloadType:parseInt(ae,10),rtcpFeedbacks:[Qe]})}}parseRTCPMux(){if(this.attributes.rtcpMux)throw new Error("must be single line of rtcp-mux");this.attributes.rtcpMux=!0}parseRTCPMuxOnly(){if(this.attributes.rtcpMuxOnly)throw new Error("must be single line of rtcp-only");this.attributes.rtcpMuxOnly=!0}parseRTCPRsize(){if(this.attributes.rtcpRsize)throw new Error("must be single line of rtcp-rsize");this.attributes.rtcpRsize=!0}parseRTCP(M){if(this.attributes.rtcp)throw new Error("must be single line of rtcp");const ae={port:this.extract(M,this.consumePort)};this.peekChar(M)===y&&(this.consumeAttributeSpace(M),ae.netType=this.extractOneOrMore(M,D),this.consumeAttributeSpace(M),ae.addressType=this.extractOneOrMore(M,D),this.consumeAttributeSpace(M),ae.address=this.extract(M,this.consumeAddress)),this.attributes.rtcp=ae}parseMsid(M){const ae={id:this.extractOneOrMore(M,D,[1,64])};this.peekChar(M)===y&&(this.consumeAttributeSpace(M),ae.appdata=this.extractOneOrMore(M,D,[1,64])),this.attributes.msids.push(ae)}parseImageAttr(M){this.attributes.imageattr.push(M.attValue)}parseRid(M){const ae=this.extractOneOrMore(M,Qe=>F(Qe)||S(Qe)||Qe==="_"||Qe==="-");this.consumeAttributeSpace(M);const me={id:ae,direction:this.extract(M,this.consumeToken),params:[]};if(this.peekChar(M)===y){if(this.consumeAttributeSpace(M),this.peek(M,"pt=")){this.extract(M,this.consume,"pt=");const Qe=[];for(;;){const Jt=this.extract(M,this.consumeToken);Qe.push(Jt);try{this.extract(M,this.consume,",")}catch{break}}me.payloads=Qe,this.peekChar(M)===y&&this.extract(M,this.consume,y)}for(;;){const Qe=this.extract(M,this.consumeToken);switch(Qe){case"depend":{const Jt={type:Qe,rids:this.extract(M,this.consume,"=").split(",")};me.params.push(Jt);break}default:{const Jt={type:Qe};this.peekChar(M)==="="&&(this.extract(M,this.consume,"="),Jt.val=this.extract(M,this.consumeTill,";")),me.params.push(Jt)}}try{this.extract(M,this.consume,";")}catch{break}}}this.attributes.rids.push(me)}parseSimulcast(M){if(this.attributes.simulcast)throw new Error("must be single line of simulcast");this.attributes.simulcast=M.attValue,this.extract(M,this.consumeTill)}parseSctpPort(M){this.attributes.sctpPort=this.extractOneOrMore(M,S,[1,5])}parseMaxMessageSize(M){this.attributes.maxMessageSize=this.extractOneOrMore(M,S,[1,void 0])}digest(){return this.digested=!0,this.attributes}parseMid(M){this.attributes.mid=this.extract(M,this.consumeToken)}parseSSRCGroup(M){const ae=this.extract(M,this.consumeToken),me=[];for(;;)try{this.consumeAttributeSpace(M);const Qe=this.extract(M,this.consumeInteger);me.push(parseInt(Qe,10))}catch{break}this.attributes.ssrcGroups.push({semantic:ae,ssrcIds:me})}}function mr(He,M,ae){return M in He?Object.defineProperty(He,M,{value:ae,enumerable:!0,configurable:!0,writable:!0}):He[M]=ae,He}class di{constructor(){mr(this,"eol",m)}print(M,ae){let me="";return ae&&(this.eol=ae),me+=this.printVersion(M.version),me+=this.printOrigin(M.origin),me+=this.printSessionName(M.sessionName),me+=this.printInformation(M.information),me+=this.printUri(M.uri),me+=this.printEmail(M.emails),me+=this.printPhone(M.phones),me+=this.printConnection(M.connection),me+=this.printBandwidth(M.bandwidths),me+=this.printTimeFields(M.timeFields),me+=this.printKey(M.key),me+=this.printSessionAttributes(M.attributes),me+=this.printMediaDescription(M.mediaDescriptions),me}printVersion(M){return"v=".concat(M).concat(this.eol)}printOrigin(M){return"o=".concat(M.username," ").concat(M.sessId," ").concat(M.sessVersion," ").concat(M.nettype," ").concat(M.addrtype," ").concat(M.unicastAddress).concat(this.eol)}printSessionName(M){return M?"s=".concat(M).concat(this.eol):""}printInformation(M){return M?"i=".concat(M).concat(this.eol):""}printUri(M){return M?"u=".concat(M).concat(this.eol):""}printEmail(M){let ae="";for(const me of M)ae+="e=".concat(me).concat(this.eol);return ae}printPhone(M){let ae="";for(const me of M)ae+="e=".concat(me).concat(this.eol);return ae}printConnection(M){return M?"c=".concat(M.nettype," ").concat(M.addrtype," ").concat(M.address).concat(this.eol):""}printBandwidth(M){let ae="";for(const me of M)ae+="b=".concat(me.bwtype,":").concat(me.bandwidth).concat(this.eol);return ae}printTimeFields(M){let ae="";for(const me of M){ae+="t=".concat(me.time.startTime," ").concat(me.time.startTime).concat(this.eol);for(const Qe of me.repeats)ae+="r=".concat(Qe.repeatInterval," ").concat(Qe.typedTimes.join(" ")).concat(this.eol);me.zoneAdjustments&&(ae+="z=",ae+="z=".concat(me.zoneAdjustments.map(Qe=>"".concat(Qe.time," ").concat(Qe.back?"-":""," ").concat(Qe.typedTime)).join(" ")).concat(this.eol),ae+=this.eol)}return ae}printKey(M){return M?"k=".concat(M).concat(this.eol):""}printAttributes(M){let ae="";for(const me of M)ae+="a=".concat(me.attField).concat(me.attValue?":".concat(me.attValue):"").concat(this.eol);return ae}printMediaDescription(M){let ae="";for(const me of M)ae+=this.printMedia(me.media),ae+=this.printInformation(me.information),ae+=this.printConnections(me.connections),ae+=this.printBandwidth(me.bandwidths),ae+=this.printKey(me.key),ae+=this.printMediaAttributes(me);return ae}printConnections(M){let ae="";for(const me of M)ae+=this.printConnection(me);return ae}printMedia(M){return"m=".concat(M.mediaType," ").concat(M.port," ").concat(M.protos.join("/")," ").concat(M.fmts.join(" ")).concat(this.eol)}printSessionAttributes(M){return new ya(this.eol).print(M)}printMediaAttributes(M){return new je(this.eol).print(M)}}class Jr{constructor(M){mr(this,"eol",void 0),this.eol=M}printIceUfrag(M){return M===void 0?"":"a=ice-ufrag:".concat(M).concat(this.eol)}printIcePwd(M){return M===void 0?"":"a=ice-pwd:".concat(M).concat(this.eol)}printIceOptions(M){return M===void 0?"":"a=ice-options:".concat(M.join(y)).concat(this.eol)}printFingerprints(M){return M.length>0?M.map(ae=>"a=fingerprint:".concat(ae.hashFunction).concat(y).concat(ae.fingerprint)).join(this.eol)+this.eol:""}printExtmap(M){return M.map(ae=>"a=extmap:".concat(ae.entry).concat(ae.direction?"/".concat(ae.direction):"").concat(y).concat(ae.extensionName).concat(ae.extensionAttributes?"".concat(y).concat(ae.extensionAttributes):"").concat(this.eol)).join("")}printSetup(M){return M===void 0?"":"a=setup:".concat(M).concat(this.eol)}printUnrecognized(M){return M.map(ae=>"a=".concat(ae.attField).concat(ae.attValue?":".concat(ae.attValue):"").concat(this.eol)).join("")}}class ya extends Jr{print(M){let ae="";return ae+=this.printGroups(M.groups),ae+=this.printMsidSemantic(M.msidSemantic),ae+=this.printIceLite(M.iceLite),ae+=this.printIceUfrag(M.iceUfrag),ae+=this.printIcePwd(M.icePwd),ae+=this.printIceOptions(M.iceOptions),ae+=this.printFingerprints(M.fingerprints),ae+=this.printSetup(M.setup),ae+=this.printTlsId(M.tlsId),ae+=this.printIdentity(M.identities),ae+=this.printExtmap(M.extmaps),ae+=this.printUnrecognized(M.unrecognized),ae}printGroups(M){let ae="";return M.length>0&&(ae+=M.map(me=>"a=group:".concat(me.semantic).concat(me.identificationTag.map(Qe=>"".concat(y).concat(Qe)).join("")).concat(this.eol)).join("")),ae}printIceLite(M){return M===void 0?"":"a=ice-lite"+this.eol}printTlsId(M){return M?"a=tls-id:".concat(M).concat(this.eol):""}printIdentity(M){return M.length===0?"":M.map(ae=>"a=identity:".concat(ae.assertionValue).concat(ae.extensions.map(me=>"".concat(y).concat(me.name).concat(me.value?"=".concat(me.value):"")))).join(this.eol)+this.eol}printMsidSemantic(M){if(!M)return"";let ae="a=msid-semantic:".concat(M.semantic);return M.applyForAll?ae+="".concat(y,"*"):M.identifierList.length>0&&(ae+=M.identifierList.map(me=>"".concat(y).concat(me))),ae+this.eol}}class je extends Jr{print(M){const ae=M.attributes;let me="";return me+=this.printRTCP(ae.rtcp),me+=this.printIceUfrag(ae.iceUfrag),me+=this.printIcePwd(ae.icePwd),me+=this.printIceOptions(ae.iceOptions),me+=this.printCandidates(ae.candidates),me+=this.printRemoteCandidatesList(ae.remoteCandidatesList),me+=this.printEndOfCandidates(ae.endOfCandidates),me+=this.printFingerprints(ae.fingerprints),me+=this.printSetup(ae.setup),me+=this.printMid(ae.mid),me+=this.printExtmap(ae.extmaps),me+=this.printRTPRelated(ae),me+=this.printPtime(ae.ptime),me+=this.printMaxPtime(ae.maxPtime),me+=this.printDirection(ae.direction),me+=this.printSSRCGroups(ae.ssrcGroups),me+=this.printSSRC(ae.ssrcs),me+=this.printRTCPMux(ae.rtcpMux),me+=this.printRTCPMuxOnly(ae.rtcpMuxOnly),me+=this.printRTCPRsize(ae.rtcpRsize),me+=this.printMSId(ae.msids),me+=this.printImageattr(ae.imageattr),me+=this.printRid(ae.rids),me+=this.printSimulcast(ae.simulcast),me+=this.printSCTPPort(ae.sctpPort),me+=this.printMaxMessageSize(ae.maxMessageSize),me+=this.printUnrecognized(ae.unrecognized),me}printCandidates(M){return M.map(ae=>"a=candidate:".concat(ae.foundation).concat(y).concat(ae.componentId).concat(y).concat(ae.transport).concat(y).concat(ae.priority).concat(y).concat(ae.connectionAddress).concat(y).concat(ae.port).concat(y,"typ").concat(y).concat(ae.type).concat(ae.relAddr?"".concat(y,"raddr").concat(y).concat(ae.relAddr):"").concat(ae.relPort?"".concat(y,"rport").concat(y).concat(ae.relPort):"").concat(Object.keys(ae.extension).map(me=>"".concat(y).concat(me).concat(y).concat(ae.extension[me])).join("")).concat(this.eol)).join("")}printRemoteCandidatesList(M){return M.map(ae=>"a=remote-candidates:".concat(ae.join(y)).concat(this.eol)).join("")}printEndOfCandidates(M){return M===void 0?"":"a=end-of-candidates"+this.eol}printRTPRelated(M){if(!M.payloads)return"";const ae=M.payloads;let me="";me+=M.rtcpFeedbackWildcards.map(Qe=>this.printRTCPFeedback("*",Qe)).join("");for(const Qe of ae)me+=this.printRtpMap(Qe.payloadType,Qe.rtpMap),me+=this.printFmtp(Qe.payloadType,Qe.fmtp),me+=Qe.rtcpFeedbacks.map(Jt=>this.printRTCPFeedback(Qe.payloadType,Jt)).join("");return me}printFmtp(M,ae){if(!ae)return"";const me=Object.keys(ae.parameters);return me.length===1&&ae.parameters[me[0]]===null?"a=fmtp:".concat(M).concat(y).concat(me[0]).concat(this.eol):"a=fmtp:".concat(M).concat(y).concat(Object.keys(ae.parameters).map(Qe=>"".concat(Qe,"=").concat(ae.parameters[Qe])).join(";")).concat(this.eol)}printRtpMap(M,ae){return ae?"a=rtpmap:".concat(M).concat(y).concat(ae.encodingName,"/").concat(ae.clockRate).concat(ae.encodingParameters?"/".concat(ae.encodingParameters):"").concat(this.eol):""}printRTCPFeedback(M,ae){let me="a=rtcp-fb:".concat(M).concat(y),Qe=ae;return Qe.type==="trr-int"?me+="ttr-int".concat(y).concat(Qe.interval):(me+="".concat(Qe.type),Qe.parameter&&(me+="".concat(y).concat(Qe.parameter),Qe.additional&&(me+="".concat(y).concat(Qe.additional)))),me+this.eol}printPtime(M){return M===void 0?"":"a=ptime:".concat(M).concat(this.eol)}printMaxPtime(M){return M===void 0?"":"a=maxptime:".concat(M).concat(this.eol)}printDirection(M){return M===void 0?"":"a=".concat(M).concat(this.eol)}printSSRC(M){return M.map(ae=>Object.keys(ae.attributes).map(me=>"a=ssrc:".concat(ae.ssrcId.toString(10)).concat(y).concat(me).concat(ae.attributes[me]?":".concat(ae.attributes[me]):"").concat(this.eol)).join("")).join("")}printRTCPMux(M){return M===void 0?"":"a=rtcp-mux".concat(this.eol)}printRTCPMuxOnly(M){return M===void 0?"":"a=rtcp-mux-only".concat(this.eol)}printRTCPRsize(M){return M===void 0?"":"a=rtcp-rsize".concat(this.eol)}printRTCP(M){if(M===void 0)return"";let ae="a=rtcp:".concat(M.port);return M.netType&&(ae+="".concat(y).concat(M.netType)),M.addressType&&(ae+="".concat(y).concat(M.addressType)),M.address&&(ae+="".concat(y).concat(M.address)),ae+this.eol}printMSId(M){return M.map(ae=>"a=msid:".concat(ae.id).concat(ae.appdata?"".concat(y).concat(ae.appdata):"").concat(this.eol)).join("")}printImageattr(M){return M.map(ae=>"a=imageattr:".concat(ae).concat(this.eol)).join("")}printRid(M){return M.map(ae=>{let me="a=rid:".concat(ae.id).concat(y).concat(ae.direction);return ae.payloads&&(me+="".concat(y,"pt=").concat(ae.payloads.join(","))),ae.params.length>0&&(me+="".concat(y).concat(ae.params.map(Qe=>Qe.type==="depend"?"depend=".concat(Qe.rids.join(",")):"".concat(Qe.type,"=").concat(Qe.val)).join(";"))),me+this.eol}).join("")}printSimulcast(M){return M===void 0?"":"a=simulcast:".concat(M).concat(this.eol)}printSCTPPort(M){return M===void 0?"":"a=sctp-port:".concat(M).concat(this.eol)}printMaxMessageSize(M){return M===void 0?"":"a=max-message-size:".concat(M).concat(this.eol)}printMid(M){return M===void 0?"":"a=mid:".concat(M).concat(this.eol)}printSSRCGroups(M){return M.map(ae=>"a=ssrc-group:".concat(ae.semantic).concat(ae.ssrcIds.map(me=>"".concat(y).concat(me.toString(10))).join("")).concat(this.eol)).join("")}}function st(He){return new ht().parse(He)}function Ct(He,M){return new di().print(He,M)}}},r={};function s(a){if(r[a])return r[a].exports;var c=r[a]={exports:{}};return t[a](c,c.exports,s),c.exports}return s.d=(a,c)=>{for(var u in c)s.o(c,u)&&!s.o(a,u)&&Object.defineProperty(a,u,{enumerable:!0,get:c[u]})},s.o=(a,c)=>Object.prototype.hasOwnProperty.call(a,c),s.r=a=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(a,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(a,"__esModule",{value:!0})},s(8)})();function Wa(t){return az.parse(t)}function $m(t,r){return az.print(t,r)}var sme=dc("Array").keys,ome=xc,ame=Ii,cme=O,lme=sme,ML=Array.prototype,ume={DOMTokenList:!0,NodeList:!0},dme=function(t){var r=t.keys;return t===ML||cme(ML,t)&&r===ML.keys||ame(ume,ome(t))?lme:r},Yc=l(dme);function cz(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}function ln(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?cz(Object(s),!0).forEach(function(a){Kr(t,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):cz(Object(s)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))})}return t}function Kr(t,r,s){return(r=function(a){var c=function(u,h){if(typeof u!="object"||u===null)return u;var m=u[Symbol.toPrimitive];if(m!==void 0){var y=m.call(u,"string");if(typeof y!="object")return y;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(u)}(a);return typeof c=="symbol"?c:String(c)}(r))in t?Object.defineProperty(t,r,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[r]=s,t}const lz=new class extends Fr{constructor(){super(...arguments),Kr(this,"currentUploadLogID",0)}reportLogUploadError(t){const{errorRange:r}=t;r[r.length-1]&&r[r.length-1]>this.currentUploadLogID&&(this.currentUploadLogID=r[r.length-1],this.emit("REPORT_LOG_UPLOAD",t))}};class hme{constructor(r){Kr(this,"logger",void 0),Kr(this,"prefixLists",[]),this.logger=r}debug(){for(var r=arguments.length,s=new Array(r),a=0;a<r;a++)s[a]=arguments[a];this.logger.debug(...this.prefixLists,...s)}info(){for(var r=arguments.length,s=new Array(r),a=0;a<r;a++)s[a]=arguments[a];this.logger.info(...this.prefixLists,...s)}warning(){for(var r=arguments.length,s=new Array(r),a=0;a<r;a++)s[a]=arguments[a];this.logger.warning(...this.prefixLists,...s)}error(){for(var r=arguments.length,s=new Array(r),a=0;a<r;a++)s[a]=arguments[a];this.logger.error(...this.prefixLists,...s)}prefix(r){return this.prefixLists.push(r),this}popPrefix(){return this.prefixLists.pop(),this}}function UL(){const t=new Date;return t.toTimeString().split(" ")[0]+":"+t.getMilliseconds()}function uz(){const t=new Date,r=/((\d+:){2}\d+)/.exec(new Date().toUTCString());return r?(r==null?void 0:r[0])+":"+t.getUTCMilliseconds():t.toTimeString().split(" ")[0]+":"+t.getMilliseconds()}const Pl={DEBUG:0,INFO:1,WARNING:2,ERROR:3,NONE:4},sP=Date.now(),LT=t=>{for(const r in Pl)if(Object.prototype.hasOwnProperty.call(Pl,r)&&Pl[r]===t)return r;return"DEFAULT"},x=new class{constructor(){Kr(this,"proxyServerURL",void 0),Kr(this,"logLevel",Pl.DEBUG),Kr(this,"uploadState","collecting"),Kr(this,"uploadLogWaitingList",[]),Kr(this,"uploadLogUploadingList",[]),Kr(this,"uploadErrorCount",0),Kr(this,"currentLogID",0),Kr(this,"url",void 0),Kr(this,"extLog",(t,r)=>{this.appendLogToWaitingList(t,...r)})}debug(){for(var t=arguments.length,r=new Array(t),s=0;s<t;s++)r[s]=arguments[s];const a=[Pl.DEBUG].concat(r);this.log.apply(this,a)}info(){for(var t=arguments.length,r=new Array(t),s=0;s<t;s++)r[s]=arguments[s];const a=[Pl.INFO].concat(r);this.log.apply(this,a)}warning(){for(var t=arguments.length,r=new Array(t),s=0;s<t;s++)r[s]=arguments[s];const a=[Pl.WARNING].concat(r);this.log.apply(this,a)}warn(){this.warning(...arguments)}error(){for(var t=arguments.length,r=new Array(t),s=0;s<t;s++)r[s]=arguments[s];const a=[Pl.ERROR].concat(r);this.log.apply(this,a)}upload(){for(var t=arguments.length,r=new Array(t),s=0;s<t;s++)r[s]=arguments[s];const a=[Pl.DEBUG].concat(r);this.uploadLog.apply(this,a)}setLogLevel(t){t=Math.min(Math.max(0,t),4),this.logLevel=t}enableLogUpload(){rr("UPLOAD_LOG",!0)}disableLogUpload(){rr("UPLOAD_LOG",!1),this.uploadLogUploadingList=[],this.uploadLogWaitingList=[]}setProxyServer(t){this.proxyServerURL=t}prefix(t){return new hme(this).prefix(t)}log(){for(var t=arguments.length,r=new Array(t),s=0;s<t;s++)r[s]=arguments[s];if(Date.now()-sP<100)return void setTimeout(()=>{this.log(...r)},Date.now()-sP);const a=Math.max(0,Math.min(4,r[0]));if(r[0]=UL()+" Agora-SDK [".concat(LT(a),"]:"),this.appendLogToWaitingList(a,...r),a<this.logLevel)return;const c=UL()+" %cAgora-SDK [".concat(LT(a),"]:");let u=[];if(!oe("USE_NEW_LOG"))switch(a){case Pl.DEBUG:u=[c,"color: #64B5F6;"].concat(r.slice(1)),console.log.apply(console,u);break;case Pl.INFO:u=[c,"color: #1E88E5; font-weight: bold;"].concat(r.slice(1)),console.log.apply(console,u);break;case Pl.WARNING:u=[c,"color: #FB8C00; font-weight: bold;"].concat(r.slice(1)),console.warn.apply(console,u);break;case Pl.ERROR:u=[c,"color: #B00020; font-weight: bold;"].concat(r.slice(1)),console.error.apply(console,u)}}uploadLog(){for(var t=arguments.length,r=new Array(t),s=0;s<t;s++)r[s]=arguments[s];if(Date.now()-sP<100)return void setTimeout(()=>{this.uploadLog(...r)},Date.now()-sP);const a=Math.max(0,Math.min(4,r[0]));r[0]=UL()+" Agora-SDK [".concat(LT(a),"]:"),this.appendLogToWaitingList(a,...r)}appendLogToWaitingList(t){if(!oe("UPLOAD_LOG"))return;for(var r=arguments.length,s=new Array(r>1?r-1:0),a=1;a<r;a++)s[a-1]=arguments[a];Array.isArray(s[0])?s[0][0]=uz()+" Agora-SDK [".concat(LT(t),"]:"):s[0]=uz()+" Agora-SDK [".concat(LT(t),"]:");let c="";s.forEach(u=>{typeof u=="object"&&(u=JSON.stringify(u)),c+="".concat(u," ")}),this.uploadLogWaitingList.push({payload_str:c,log_level:t,log_item_id:this.currentLogID++}),this.uploadState==="uploading"&&this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}startUpload(){this.uploadState="uploading",this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}async uploadLogs(){const t=this.uploadLogUploadingList,r={sdk_version:Al,process_id:oe("PROCESS_ID"),payload:JSON.stringify(t)};return vd(async()=>{const s=await ha.post(this.url||(this.proxyServerURL?"https://".concat(this.proxyServerURL,"/ls/?h=").concat(oe("LOG_UPLOAD_SERVER"),"&p=443&d=upload/v1"):"https://".concat(oe("LOG_UPLOAD_SERVER"),"/upload/v1")),r,{responseType:"text"});if(s.data!=="OK"){const a=new Error("unexpected upload log response");throw a.response=s,a}},()=>(this.uploadLogUploadingList=[],!1),s=>{const a={status:-1,message:s.message,errorRange:t.map(c=>c.log_item_id)};return s.response?(a.status=s.response.status,a.data=s.response.data,a.headers=s.response.headers):s.request&&(a.status=s.request.status),lz.reportLogUploadError(a),!0},{timeout:oe("UPLOAD_LOG_REQUEST_RETRY_INTERVAL"),maxRetryTimeout:oe("UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL")})}uploadLogInterval(){this.uploadLogUploadingList.length===0&&this.uploadLogWaitingList.length===0||(this.uploadLogUploadingList.length===0&&(this.uploadLogUploadingList=this.uploadLogWaitingList.splice(0,oe("UPLOAD_LOG_LENGTH_EACH_TIME"))),this.uploadLogs().then(()=>{this.uploadErrorCount=0,this.uploadLogWaitingList.length>0&&window.setTimeout(()=>this.uploadLogInterval(),oe("UPLOAD_LOG_INTERVAL"))}).catch(t=>{this.uploadErrorCount+=1,this.uploadErrorCount<2?window.setTimeout(()=>this.uploadLogInterval(),oe("UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1")):window.setTimeout(()=>this.uploadLogInterval(),oe("UPLOAD_LOG_RETRY_INTERVAL_V1"))}))}};var dz;function fme(t){return fs(t.reportId,"params.reportId",0,100,!1),fs(t.category,"params.category",0,100,!1),fs(t.event,"params.event",0,100,!1),fs(t.label,"params.label",0,100,!1),or(t.value,"params.value",Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,!1),!0}(dz={}).FREE="free",dz.UPLOADING="uploading",function(t){t[t.MISC=0]="MISC",t[t.INTERNAL_EVENT=1]="INTERNAL_EVENT",t[t.PUBLIC_EVENT=2]="PUBLIC_EVENT",t[t.WEB_EVENT=3]="WEB_EVENT",t[t.INTERNAL_API=4]="INTERNAL_API",t[t.WEB_API=5]="WEB_API",t[t.PUBLIC_API=6]="PUBLIC_API"}({});const pme={sid:"",lts:0,success:null,cname:null,uid:null,peer:null,cid:null,elapse:null,extend:null,vid:0};let Zi=function(t){return t.PUBLISH="publish",t.SUBSCRIBE="subscribe",t.WS_COMPRESSOR_INIT="ws_compressor_init",t.SESSION_INIT="session_init",t.JOIN_CHOOSE_SERVER="join_choose_server",t.REQ_USER_ACCOUNT="req_user_account",t.JOIN_GATEWAY="join_gateway",t.REJOIN_GATEWAY="rejoin_gateway",t.STREAM_SWITCH="stream_switch",t.REQUEST_PROXY_WORKER_MANAGER="request_proxy_worker_manager",t.REQUEST_PROXY_APPCENTER="request_proxy_appcenter",t.FIRST_VIDEO_RECEIVED="first_video_received",t.FIRST_AUDIO_RECEIVED="first_audio_received",t.FIRST_VIDEO_DECODE="first_video_decode",t.FIRST_AUDIO_DECODE="first_audio_decode",t.ON_ADD_AUDIO_STREAM="on_add_audio_stream",t.ON_ADD_VIDEO_STREAM="on_add_video_stream",t.ON_UPDATE_STREAM="on_update_stream",t.ON_REMOVE_STREAM="on_remove_stream",t.USER_ANALYTICS="req_user_analytics",t.PC_STATS="pc_stats",t.UPDATE_REMOTE_RTPCAPABILITIES="update_remote_rtpCapabilities",t.AB_TEST="ab_test",t}({}),xr=function(t){return t.SESSION="io.agora.pb.Wrtc.Session",t.JOIN_CHOOSE_SERVER="io.agora.pb.Wrtc.JoinChooseServer",t.REQ_USER_ACCOUNT="io.agora.pb.Wrtc.ReqUserAccount",t.JOIN_GATEWAY="io.agora.pb.Wrtc.JoinGateway",t.RE_JOIN_GATEWAY="io.agora.pb.Wrtc.ReJoinGateway",t.PUBLISH="io.agora.pb.Wrtc.Publish",t.SUBSCRIBE="io.agora.pb.Wrtc.Subscribe",t.WS_COMPRESSOR_INIT="io.agora.pb.Wrtc.WsCompressorInit",t.STREAM_SWITCH="io.agora.pb.Wrtc.StreamSwitch",t.AUDIO_SENDING_STOPPED="io.agora.pb.Wrtc.AudioSendingStopped",t.VIDEO_SENDING_STOPPED="io.agora.pb.Wrtc.VideoSendingStopped",t.REQUEST_PROXY_APPCENTER="io.agora.pb.Wrtc.RequestProxyAppCenter",t.REQUEST_PROXY_WORKER_MANAGER="io.agora.pb.Wrtc.RequestProxyWorkerManager",t.API_INVOKE="io.agora.pb.Wrtc.ApiInvoke",t.FIRST_VIDEO_RECEIVED="io.agora.pb.Wrtc.FirstVideoReceived",t.FIRST_AUDIO_RECEIVED="io.agora.pb.Wrtc.FirstAudioReceived",t.FIRST_VIDEO_DECODE="io.agora.pb.Wrtc.FirstVideoDecode",t.FIRST_AUDIO_DECODE="io.agora.pb.Wrtc.FirstAudioDecode",t.ON_ADD_AUDIO_STREAM="io.agora.pb.Wrtc.OnAddAudioStream",t.ON_ADD_VIDEO_STREAM="io.agora.pb.Wrtc.OnAddVideoStream",t.ON_UPDATE_STREAM="io.agora.pb.Wrtc.OnUpdateStream",t.ON_REMOVE_STREAM="io.agora.pb.Wrtc.OnRemoveStream",t.JOIN_CHANNEL_TIMEOUT="io.agora.pb.Wrtc.JoinChannelTimeout",t.PEER_PUBLISH_STATUS="io.agora.pb.Wrtc.PeerPublishStatus",t.WORKER_EVENT="io.agora.pb.Wrtc.WorkerEvent",t.AP_WORKER_EVENT="io.agora.pb.Wrtc.APWorkerEvent",t.JOIN_WEB_PROXY_AP="io.agora.pb.Wrtc.JoinWebProxyAP",t.WEBSOCKET_QUIT="io.agora.pb.Wrtc.WebSocketQuit",t.USER_ANALYTICS="io.agora.pb.Wrtc.UserAnalytics",t.AUTOPLAY_FAILED="io.agora.pb.Wrtc.AutoplayFailed",t.PC_STATS="io.agora.pb.Wrtc.PCStats",t.UPDATE_REMOTE_RTPCAPABILITIES="io.agora.pb.Wrtc.UpdateRemoteRTPCapabilities",t.AB_TEST="io.agora.pb.Wrtc.ABTest",t}({});(function(t){t[t.WORKER_EVENT=156]="WORKER_EVENT",t[t.AP_WORKER_EVENT=160]="AP_WORKER_EVENT"})({});let mme=function(t){return t[t.SESSION=26]="SESSION",t[t.JOIN_CHOOSE_SERVER=27]="JOIN_CHOOSE_SERVER",t[t.REQ_USER_ACCOUNT=196]="REQ_USER_ACCOUNT",t[t.JOIN_GATEWAY=28]="JOIN_GATEWAY",t[t.PUBLISH=30]="PUBLISH",t[t.SUBSCRIBE=29]="SUBSCRIBE",t[t.WS_COMPRESSOR_INIT=9430]="WS_COMPRESSOR_INIT",t[t.STREAM_SWITCH=32]="STREAM_SWITCH",t[t.AUDIO_SENDING_STOPPED=33]="AUDIO_SENDING_STOPPED",t[t.VIDEO_SENDING_STOPPED=34]="VIDEO_SENDING_STOPPED",t[t.REQUEST_PROXY_APPCENTER=35]="REQUEST_PROXY_APPCENTER",t[t.REQUEST_PROXY_WORKER_MANAGER=36]="REQUEST_PROXY_WORKER_MANAGER",t[t.API_INVOKE=41]="API_INVOKE",t[t.FIRST_VIDEO_RECEIVED=348]="FIRST_VIDEO_RECEIVED",t[t.FIRST_AUDIO_RECEIVED=349]="FIRST_AUDIO_RECEIVED",t[t.FIRST_VIDEO_DECODE=350]="FIRST_VIDEO_DECODE",t[t.FIRST_AUDIO_DECODE=351]="FIRST_AUDIO_DECODE",t[t.ON_ADD_AUDIO_STREAM=352]="ON_ADD_AUDIO_STREAM",t[t.ON_ADD_VIDEO_STREAM=353]="ON_ADD_VIDEO_STREAM",t[t.ON_UPDATE_STREAM=356]="ON_UPDATE_STREAM",t[t.ON_REMOVE_STREAM=355]="ON_REMOVE_STREAM",t[t.JOIN_CHANNEL_TIMEOUT=407]="JOIN_CHANNEL_TIMEOUT",t[t.PEER_PUBLISH_STATUS=408]="PEER_PUBLISH_STATUS",t[t.WORKER_EVENT=156]="WORKER_EVENT",t[t.AP_WORKER_EVENT=160]="AP_WORKER_EVENT",t[t.JOIN_WEB_PROXY_AP=700]="JOIN_WEB_PROXY_AP",t[t.WEBSOCKET_QUIT=671]="WEBSOCKET_QUIT",t[t.USER_ANALYTICS=1e4]="USER_ANALYTICS",t[t.AUTOPLAY_FAILED=9178]="AUTOPLAY_FAILED",t}({});function jt(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return function(r,s,a){const c=a.value;if(typeof c=="function"){const u=t.className||r.__className__||(r.constructor.name==="AgoraRTCClient"?"Client":r.constructor.name);a.value=function(){for(var h,m=arguments.length,y=new Array(m),v=0;v<m;v++)y[v]=arguments[v];let S=y;if(t.argsMap)try{S=t.argsMap(this,...y)}catch(P){x.warning(P),S=[]}try{JSON.stringify(S)}catch{x.warning("arguments for method ".concat(u,".").concat(String(s)," not serializable for apiInvoke.")),S=[]}const R=(t.report||At).reportApiInvoke(this._sessionId||null,{id:this._clientId||((h=this.store)===null||h===void 0?void 0:h.clientId)||this._ID,name:"".concat(u,".").concat(String(s)),options:S,tag:Hr.TRACER,reportResult:t.reportResult},t.throttleTime);try{const P=c.apply(this,y);return P instanceof dt?P.then(D=>(R.onSuccess(t.reportResult&&D),D)).catch(D=>{throw R.onError(D),D}):(R.onSuccess(t.reportResult&&P),P)}catch(P){throw R.onError(P),P}}}return a}}const At=new class{constructor(){Kr(this,"baseInfoMap",new Map),Kr(this,"proxyServer",void 0),Kr(this,"eventUploadTimer",void 0),Kr(this,"setSessionIdTimer",void 0),Kr(this,"url",void 0),Kr(this,"sids",new Set),Kr(this,"backupUrl",void 0),Kr(this,"_appId",void 0),Kr(this,"_aid",0),Kr(this,"keyEventUploadPendingItems",[]),Kr(this,"normalEventUploadPendingItems",[]),Kr(this,"apiInvokeUploadPendingItems",[]),Kr(this,"apiInvokeCount",0),Kr(this,"apiInvokeLoggedCount",0),Kr(this,"ltsList",[]),Kr(this,"lastSendNormalEventTime",Date.now()),Kr(this,"customReportCounterTimer",void 0),Kr(this,"customReportCount",0),Kr(this,"extApiInvoke",async t=>{for(const r of t){const s=ln(ln({},r),{},{sid:null,invokeId:++this.apiInvokeCount,tag:Hr.TRACER});this.sendApiInvoke(s)}}),this.eventUploadTimer=window.setInterval(this.doSend.bind(this),oe("EVENT_REPORT_SEND_INTERVAL")),this.setSessionIdTimer=window.setInterval(this.appendSessionId.bind(this),oe("EVENT_REPORT_SEND_INTERVAL"))}getBaseInfoBySessionId(t){return this.baseInfoMap.get(t)}setAppId(t){this._appId=t,this._aid=parseInt(t.replace(/[a-fA-F0-9]{8}/g,r=>{let[s,a]=r;return s+a}),16)||0}reportApiInvoke(t,r,s){r.timeout=r.timeout||6e4,r.reportResult=r.reportResult===void 0||r.reportResult;const a=Date.now();this.apiInvokeCount+=1;const c=this.apiInvokeCount,u=!!oe("SHOW_REPORT_INVOKER_LOG"),h=!!oe("SHOW_REPORT_USER_INVOKER_LOG"),m=u||h&&r.id;m&&(this.apiInvokeLoggedCount+=1);const y=this.apiInvokeLoggedCount;function v(D,G){if(m){let F="[apiInvoke-".concat(y,"]");r.id&&(F+="[".concat(r.id,"]")),r.name&&(F+="[".concat(r.name,"]")),x.info("".concat(F," ").concat(D),D==="start"?r.options:G||"")}}const S=()=>({tag:r.tag,invokeId:c,sid:t,name:r.name,apiInvokeTime:a,options:r.options,states:r.states||null});v("start");let R=!1;ps(r.timeout).then(()=>{R||(this.sendApiInvoke(ln(ln({},S()),{},{error:te.API_INVOKE_TIMEOUT,success:!1})),v("timeout"))});const P=new Me(te.UNEXPECTED_ERROR,"".concat(r.name,": this api invoke is end"));return{onSuccess:D=>{const G=()=>{if(R)throw P;return R=!0,this.sendApiInvoke(ln(ln({},S()),{},{success:!0},r.reportResult&&{result:D})),v("onSuccess"),D};return s?G8(G,r.name+"Success",s,()=>R=!0):G()},onError:D=>{const G=()=>{if(R)throw D;R=!0,this.sendApiInvoke(ln(ln({},S()),{},{success:!1,error:D})),v("onFailure",D.toString())};return s?G8(G,r.name+"Error",s,()=>R=!0):G()}}}sessionInit(t,r){if(this.baseInfoMap.has(t))return;const s=Date.now(),a=this.createBaseInfo(t,s);a.cname=r.cname;const c=Object.assign({},{willUploadConsoleLog:oe("UPLOAD_LOG"),maxTouchPoints:navigator.maxTouchPoints,areaVersion:NL?"global":"oversea",areas:oe("AREAS")&&oe("AREAS").join(",")},r.extend),{stringUid:u,channelProfile:h,channelMode:m,isABTestSuccess:y,lsid:v,clientRole:S}=r,R=Date.now(),P=ln(ln({},a),{},{eventType:Zi.SESSION_INIT,appid:r.appid,browser:navigator.userAgent,buildFormat:r.buildFormat,build:xL,lts:R,elapse:R-s,extend:JSON.stringify(c),mode:r.mode,process:oe("PROCESS_ID"),appType:oe("APP_TYPE"),success:!0,version:Al,stringUid:u,channelProfile:h,channelMode:m,isABTestSuccess:y,lsid:v,clientType:ot(D=window.navigator.userAgent).call(D,"AgoraWebView")?42:20,clientRole:S,serviceId:oe("PROCESS_ID"),extensionID:oe("PLUGIN_INFO").join(",")||""});var D;this.send({type:xr.SESSION,data:P},!0)}joinChooseServer(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const a=s.info,c=Date.now(),u=ln(ln({},a),{},{role:r.role,eventType:Zi.JOIN_CHOOSE_SERVER,lts:c,eventElapse:r.elapse||c-r.lts,chooseServerAddr:r.csAddr,errorCode:r.ec,elapse:c-s.startTime,success:r.succ,chooseServerAddrList:JSON.stringify(r.serverList),uid:r.uid?parseInt(r.uid):null,cid:r.cid?parseInt(r.cid):null,chooseServerIp:r.csIp||"",opid:r.opid,unilbsServerIds:r.unilbsServerIds,extend:r.extend||void 0,isHttp3:r.isHttp3,corssRegionTagReq:r.corssRegionTagReq||void 0,corssRegionTagRes:r.corssRegionTagRes||void 0});this.send({type:xr.JOIN_CHOOSE_SERVER,data:u},!0)}reqUserAccount(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const a=s.info,c=Date.now(),u=ln(ln({},a),{},{eventType:Zi.REQ_USER_ACCOUNT,lts:c,success:r.success,serverAddress:r.serverAddr,stringUid:r.stringUid,uid:r.uid,errorCode:r.errorCode,elapse:r.elapse||c-s.startTime,eventElapse:c-r.lts,extend:JSON.stringify(r.extend)});this.send({type:xr.REQ_USER_ACCOUNT,data:u},!0)}joinGateway(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const a=s.info;r.vid&&(a.vid=r.vid),a.uid=r.uid,a.cid=r.cid;const c=Date.now(),{firstSuccess:u,avoidJoinStartTime:h,addr:m,isProxy:y}=r,v=c-(u&&h?h:s.startTime),S=ln(ln({},a),{},{eventType:Zi.JOIN_GATEWAY,lts:c,gatewayAddr:r.addr,success:r.succ,errorCode:r.ec,errorMsg:r.errorMsg||"",elapse:v,eventElapse:c-r.lts,firstSuccess:u,signalChannel:r.signalChannel,preload:r.preload?1:0,installId:kL(),isABTestSuccess:r.isABTestSuccess?1:0}),R=S.success?1:0;if(r.succ&&(s.lastJoinSuccessTime=c),u)this.send({type:xr.JOIN_GATEWAY,data:S},!0);else{let P;if(m)if(y){const G=m.match(/h=(\d{1,3}-){3}\d{1,3}/g),F=m.match(/p=[0-9]{1,6}/g);P={isSuccess:R,gatewayIp:G&&G.length?G[0].split("=")[1].replace(/-/g,"."):"",port:F&&F.length?F[0].split("=")[1]:"",isProxy:y?1:0}}else{const G=m.match(/wss:\/\/(\d{1,3}-){3}\d{1,3}/g),F=m.match(/(:|p=)[0-9]{1,6}/g);P={isSuccess:R,gatewayIp:G&&G.length?G[0].split("//")[1].replace(/-/g,"."):"",port:F&&F.length?F[0].split(/:|p=/g)[1]:"",isProxy:y?1:0}}else P={isSuccess:R,gatewayIp:"",port:"",isProxy:y?1:0};delete S.success,delete S.eventType,delete S.firstSuccess,S.vid=Number(S.vid);const D=Object.assign({},S,P,{eventType:Zi.REJOIN_GATEWAY});this.send({type:xr.RE_JOIN_GATEWAY,data:D},!0)}}joinChannelTimeout(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const a=Date.now(),c=ln(ln({},s.info),{},{lts:a,timeout:r,elapse:a-s.startTime});this.send({type:xr.JOIN_CHANNEL_TIMEOUT,data:c},!0)}publish(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const a=s.info,c=Date.now(),u=ln(ln({},a),{},{eventType:Zi.PUBLISH,lts:c,eventElapse:r.eventElapse,elapse:c-s.startTime,success:r.succ,errorCode:r.ec,videoName:r.videoName,audioName:r.audioName,screenName:r.screenName,screenshare:r.screenshare,audio:r.audio,video:r.video,p2pid:r.p2pid,publishRequestid:r.publishRequestid});this.send({type:xr.PUBLISH,data:u},!0)}subscribe(t,r,s){const a=this.baseInfoMap.get(t);if(!a)return;const c=a.info,u=Date.now(),h=ln(ln({},c),{},{eventType:Zi.SUBSCRIBE,lts:u,eventElapse:r.eventElapse,elapse:u-a.startTime,success:r.succ,errorCode:r.ec,video:r.video,audio:r.audio,subscribeRequestid:r.subscribeRequestid,p2pid:r.p2pid,preSsrc:r.preSsrc?1:0},s&&{extend:JSON.stringify({isMassSubscribe:!0})});typeof r.peerid=="string"?h.peerSuid=r.peerid:h.peer=r.peerid,this.send({type:xr.SUBSCRIBE,data:h},!0)}wsCompressorInit(t){var r;const s=[...Yc(r=this.baseInfoMap).call(r)],a=s.length?s[0]:"UnableToGetSid",c=this.baseInfoMap.get(a);if(!c)return;const u=c.info,h=Date.now(),m=ln(ln({},u),{},{eventType:Zi.WS_COMPRESSOR_INIT,lts:h,eventElapse:t.eventElapse,elapse:h-c.startTime,status:t.status?1:2});this.send({type:xr.WS_COMPRESSOR_INIT,data:m},!0)}firstRemoteVideoDecode(t,r,s,a){const c=this.baseInfoMap.get(t);if(!c)return;const u=c.info,h=Date.now(),m=ln(ln(ln({},u),a),{},{elapse:h-c.startTime,eventType:r,lts:h,firstDecodeFrame:Math.max((a.firstFrame||h)-c.startTime,0),apEnd:Math.max(a.apEnd-c.startTime,0),apStart:Math.max(a.apStart-c.startTime,0),joinGwEnd:Math.max(a.joinGwEnd-c.startTime,0),joinGwStart:Math.max(a.joinGwStart-c.startTime,0),pcEnd:Math.max(a.pcEnd-c.startTime,0),pcStart:Math.max(a.pcStart-c.startTime,0),subscriberEnd:Math.max(a.subscriberEnd-c.startTime,0),subscriberStart:Math.max(a.subscriberStart-c.startTime,0),videoAddNotify:Math.max(a.videoAddNotify-c.startTime,0)});this.send({type:s,data:m},!0)}firstRemoteFrame(t,r,s,a){const c=this.baseInfoMap.get(t);if(!c)return;const u=c.info,h=Date.now(),m=ln(ln(ln({},u),a),{},{elapse:h-c.startTime,eventType:r,lts:h});this.send({type:s,data:m},!0)}abTest(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const a=s.info,c=Date.now(),u=ln(ln(ln({},a),r),{},{vid:a.vid===void 0?0:Number(a.vid),elapse:c-s.startTime,eventType:Zi.AB_TEST,lts:c});this.send({type:xr.AB_TEST,data:u},!0)}pcStats(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const a=s.info,c=Date.now(),u=ln(ln(ln({},a),r),{},{vid:a.vid===void 0?0:Number(a.vid),elapse:c-s.startTime,eventType:Zi.PC_STATS,lts:c,preallocation:r.preallocation?1:0});this.send({type:xr.PC_STATS,data:u},!0)}updateRemoteRTPCapabilities(t,r){if(t){const s=this.baseInfoMap.get(t);if(!s)return;const a=s.info,c=Date.now(),u=ln(ln(ln({},a),r),{},{vid:a.vid===void 0?0:Number(a.vid),eventType:Zi.UPDATE_REMOTE_RTPCAPABILITIES,lts:c});this.send({type:xr.UPDATE_REMOTE_RTPCAPABILITIES,data:u},!0)}}onGatewayStream(t,r,s,a){const c=this.baseInfoMap.get(t);if(!c)return;const u=c.info,h=Date.now(),m=ln(ln(ln({},u),a),{},{eventType:r,lts:h});this.send({type:s,data:m},!0)}streamSwitch(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const a=s.info,c=Date.now(),u=ln(ln({},a),{},{eventType:Zi.STREAM_SWITCH,lts:c,isDual:r.isdual,elapse:c-s.startTime,success:r.succ});this.send({type:xr.STREAM_SWITCH,data:u},!0)}requestProxyAppCenter(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const a=s.info,c=Date.now(),u=ln(ln({},a),{},{eventType:Zi.REQUEST_PROXY_APPCENTER,lts:c,eventElapse:c-r.lts,elapse:c-s.startTime,APAddr:r.APAddr,workerManagerList:r.workerManagerList,response:r.response,errorCode:r.ec,success:r.succ});this.send({type:xr.REQUEST_PROXY_APPCENTER,data:u},!0)}requestProxyWorkerManager(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const a=s.info,c=Date.now(),u=ln(ln({},a),{},{eventType:Zi.REQUEST_PROXY_WORKER_MANAGER,lts:c,eventElapse:c-r.lts,elapse:c-s.startTime,workerManagerAddr:r.workerManagerAddr,response:r.response,errorCode:r.ec,success:r.succ});this.send({type:xr.REQUEST_PROXY_WORKER_MANAGER,data:u},!0)}setProxyServer(t){this.proxyServer=t,t?x.debug("reportProxyServerurl: ".concat(t)):x.debug("disable reportProxyServerurl: ".concat(t))}peerPublishStatus(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const a=s.info,c=Date.now(),u=ln(ln({},a),{},{subscribeElapse:r.subscribeElapse,peer:r.peer,peerPublishDuration:Math.max(r.audioPublishDuration,r.videoPublishDuration),audiotag:r.audioPublishDuration>0?1:-1,videotag:r.videoPublishDuration>0?1:-1,lts:c,elapse:c-s.startTime,joinChannelSuccessElapse:c-(s.lastJoinSuccessTime||c),peerPublishDurationVideo:r.videoPublishDuration,peerPublishDurationAudio:r.audioPublishDuration});this.send({type:xr.PEER_PUBLISH_STATUS,data:u},!0)}workerEvent(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const a=s.info,c=Date.now();(function(u,h,m){const y=u[h];if(!y||typeof y!="string")return[u];u[h]="";const v=bh(JSON.stringify(u));let S=0;const R=[];let P=0;for(let D=0;D<y.length;D++)P+=y.charCodeAt(D)<=127?1:3,P<=m-v||(R[R.length]=yt(yt({},u),{},{[h]:y.substring(S,D)}),S=D,P=y.charCodeAt(D)<=127?1:3);return S!==y.length-1&&(R[R.length]=yt(yt({},u),{},{[h]:y.substring(S)})),R})(ln(ln(ln({},a),r),{},{elapse:c-s.startTime,lts:c,productType:"WebRTC"}),"payload",1300).forEach(u=>this.send({type:xr.WORKER_EVENT,data:u},!0))}apworkerEvent(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const a=s.info,c=Date.now(),u=ln(ln(ln({},a),r),{},{elapse:c-s.startTime,lts:c});this.send({type:xr.AP_WORKER_EVENT,data:u},!0)}joinWebProxyAP(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const a=s.info,c=Date.now(),u=ln(ln(ln({},a),r),{},{elapse:c-s.startTime,lts:c,extend:r.extend||void 0});this.send({type:xr.JOIN_WEB_PROXY_AP,data:u},!0)}WebSocketQuit(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const a=s.info,c=Date.now(),u=ln(ln(ln({},a),r),{},{elapse:c-s.startTime,lts:c});this.send({type:xr.WEBSOCKET_QUIT,data:u},!0)}async sendCustomReportMessage(t,r){if(this.customReportCount+=r.length,this.customReportCount>oe("CUSTOM_REPORT_LIMIT"))throw new Me(te.CUSTOM_REPORT_FREQUENCY_TOO_HIGH);this.customReportCounterTimer||(this.customReportCounterTimer=window.setInterval(()=>{this.customReportCount=0},5e3));const s=Date.now(),a=r.map(c=>({type:xr.USER_ANALYTICS,data:ln(ln({sid:t},c),{},{lts:s})}));try{oe("NEW_REPORT_SERVER")?await this.postDataToStatsCollector2(a):await this.postDataToStatsCollector(a)}catch(c){throw x.error("send custom report message failed",c.toString()),new Me(te.CUSTOM_REPORT_SEND_FAILED,c.message)}}sendApiInvoke(t){const r=oe("NOT_REPORT_EVENT");if(t.tag&&ot(r)&&ot(r).call(r,t.tag))return!1;if(t.sid===null)return this.apiInvokeUploadPendingItems.push(t),!1;const s=this.baseInfoMap.get(t.sid);if(!s)return this.apiInvokeUploadPendingItems.push(t),!1;const{cname:a,uid:c,cid:u}=s.info;let h;if(t.lts=t.lts||Date.now(),t.error)if(t.error instanceof Me){const{code:y,message:v}=t.error;h=y||v||t.error.toString()}else h=t.error.toString();const m={invokeId:t.invokeId,sid:t.sid,cname:a,cid:u,uid:c,lts:t.lts,success:t.success,elapse:t.lts-s.startTime,execElapse:t.lts-t.apiInvokeTime,apiName:t.name,options:t.options?JSON.stringify(t.options):void 0,execStates:t.states?JSON.stringify(t.states):void 0,execResult:t.result?JSON.stringify(t.result):void 0,errorCode:t.error?h:void 0,errorMsg:t.error?JSON.stringify(t.error):void 0};return this.send({type:xr.API_INVOKE,data:m},!1),!0}addSid(t){this.sids.add(t)}removeSid(t){this.sids.delete(t)}appendSessionId(){const t=this.apiInvokeUploadPendingItems;if(t.length===0)return;const r=Array.from(this.sids).find(s=>s!==null);r&&t.forEach(s=>{s&&(s.sid=r,this.sendApiInvoke(Object.assign({},s)))}),t.length=0}send(t,r){if(r)return this.keyEventUploadPendingItems.push(t),void this.sendItems(this.keyEventUploadPendingItems,!0);this.normalEventUploadPendingItems.push(t),this.normalEventUploadPendingItems.length>oe("NORMAL_EVENT_QUEUE_CAPACITY")&&this.normalEventUploadPendingItems.splice(0,1),this.normalEventUploadPendingItems.length>=10&&this.sendItems(this.normalEventUploadPendingItems,!1)}doSend(){this.keyEventUploadPendingItems.length>0&&this.sendItems(this.keyEventUploadPendingItems,!0),this.normalEventUploadPendingItems.length>0&&Date.now()-this.lastSendNormalEventTime>=5e3&&this.sendItems(this.normalEventUploadPendingItems,!1)}sendItems(t,r){const s=[],a=[];for(;t.length;){const u=t.shift();s.length<20?s.push(u):a.push(u)}t.push(...a);for(const u of[...s]){var c;this.ltsList.indexOf(u.data.lts)!==-1?(u.data.lts=this.ltsList[this.ltsList.length-1]+1,this.ltsList.push(u.data.lts)):(this.ltsList.push(u.data.lts),pT(c=this.ltsList).call(c,(h,m)=>h-m))}return r||(this.lastSendNormalEventTime=Date.now()),oe("ENABLE_EVENT_REPORT")&&s.length&&(oe("NEW_REPORT_SERVER")?this.postDataToStatsCollector2(s):this.postDataToStatsCollector(s)).catch((u=>h=>{oe("EVENT_REPORT_RETRY")&&(r?this.keyEventUploadPendingItems=this.keyEventUploadPendingItems.concat(u):(this.normalEventUploadPendingItems=this.normalEventUploadPendingItems.concat(u),this.normalEventUploadPendingItems.length>oe("NORMAL_EVENT_QUEUE_CAPACITY")&&(this.normalEventUploadPendingItems.splice(0,this.normalEventUploadPendingItems.length-oe("NORMAL_EVENT_QUEUE_CAPACITY")),x.warning("report: drop normal events"))))})(s)),t}async postDataToStatsCollector2(t){vi.networkState===Ec.OFFLINE&&await dt.race([vi.onlineWaiter,ps(2*ki.maxRetryTimeout)]);const r=c=>{let u=new Uint8Array;return c.forEach(h=>{const m=EL(JSON.stringify(h.data)),y=new ArrayBuffer(5),v=(R=>{let P=0;return Object.entries(xr).forEach(D=>{let[G,F]=D;F===R.type&&(P=mme[G])}),P})(h),S=new DataView(y);S.setUint16(0,m.byteLength,!0),S.setUint8(2,255&v),S.setUint8(3,v>>>8&255),S.setUint8(4,v>>>16&255),u=L8(u,new Uint8Array(y)),u=L8(u,m)}),u},s="event";let a=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(oe("NEW_REPORT_SERVER_DOMAINS")[0],"&p=443&d=").concat(s):"https://".concat(oe("NEW_REPORT_SERVER_DOMAINS")[0],"/").concat(s);for(let c=0;c<2;c+=1){c===1&&(a=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(oe("NEW_REPORT_SERVER_DOMAINS")[1],"&p=443&d=").concat(s):"https://".concat(oe("NEW_REPORT_SERVER_DOMAINS")[1],"/").concat(s));try{await RL(a,{timeout:1e4,data:r(t),headers:ln(ln({biz:"webrtc",sendts:Math.round(Date.now()/1e3),debug:"false"},this._appId&&{appid:this._appId}),{},{"Content-Type":"application/octet-stream"})},!0)}catch(u){if(c===1)throw u;continue}return}}async postDataToStatsCollector(t){let r=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const s=(m=>{const y=m&&m.data.sid&&this.baseInfoMap.get(m.data.sid);return y&&y.info.vid&&+y.info.vid||0})(t[0]),a=s?void 0:this._aid,c={msgType:"EventMessages",sentTs:Math.round(Date.now()/1e3),payloads:t.map(m=>JSON.stringify(m)),vid:s,aid:a};vi.networkState===Ec.OFFLINE&&await dt.race([vi.onlineWaiter,ps(2*ki.maxRetryTimeout)]);const u=r?"/events/proto-raws":"/events/messages";let h=this.url||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(oe("EVENT_REPORT_DOMAIN"),"&p=").concat(oe("STATS_COLLECTOR_PORT"),"&d=").concat(u):"https://".concat(oe("EVENT_REPORT_DOMAIN"),":").concat(oe("STATS_COLLECTOR_PORT")).concat(u));for(let m=0;m<2;m+=1){m===1&&(h=this.backupUrl||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(oe("EVENT_REPORT_BACKUP_DOMAIN"),"&p=").concat(oe("STATS_COLLECTOR_PORT"),"&d=").concat(u):"https://".concat(oe("EVENT_REPORT_BACKUP_DOMAIN"),":").concat(oe("STATS_COLLECTOR_PORT")).concat(u)));try{r?await eme(h,{timeout:1e4,data:c}):await RL(h,{timeout:1e4,data:c})}catch(y){if(m===1)throw y;continue}return}}createBaseInfo(t,r){const s=Object.assign({},pme);return s.sid=t,this.baseInfoMap.set(t,{info:s,startTime:r}),s}reportResourceTiming(t,r){const s=performance.getEntriesByName(t),a=s[s.length-1];a&&this.reportApiInvoke(r,{name:"Client.resourceTiming",options:a,tag:Hr.TRACER}).onSuccess()}};lz.on("REPORT_LOG_UPLOAD",t=>{t.networkState=vi.networkState,At.reportApiInvoke(null,{name:"logUploadError",options:t,tag:Hr.TRACER}).onSuccess("logUploadError")});class Oe extends Me{constructor(r){super(r,arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",arguments.length>2?arguments[2]:void 0),Kr(this,"name","AgoraRTCException")}print(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error";return super.print(r,x)}throw(){super.throw(x)}}const ms={getDisplayMedia:!1,getStreamFromExtension:!1,supportUnifiedPlan:!1,supportMinBitrate:!1,supportSetRtpSenderParameters:!1,supportDualStream:!0,webAudioMediaStreamDest:!1,supportReplaceTrack:!1,supportWebGL:!1,webAudioWithAEC:!1,supportRequestFrame:!1,supportShareAudio:!1,supportDualStreamEncoding:!1,supportDataChannel:!1,supportPCSetConfiguration:!1,supportWebRTCEncodedTransform:!1,supportWebRTCInsertableStream:!1,supportRequestVideoFrameCallback:!1,supportWebCrypto:!1};function jn(){return ms}function hz(){return"setSinkId"in HTMLAudioElement.prototype&&(!oe("RESTRICTION_SET_PLAYBACK_DEVICE")||(rp()||T8())&&!gL())}function fz(){return!ms.supportUnifiedPlan||oe("CHROME_FORCE_PLAN_B")&&ip()}let gs=function(t){return t.IOS_15_16_INTERRUPTION_START="ios15_16-interruption-start",t.IOS_15_16_INTERRUPTION_END="ios15_16-interruption-end",t.IOS_INTERRUPTION_START="ios-interruption-start",t.IOS_INTERRUPTION_END="ios-interruption-end",t.STATE_CHANGE="state-change",t}({});function Kv(t,r,s){return{sampleRate:t,stereo:r,bitrate:s}}function xn(t,r,s,a,c){return{width:t,height:r,frameRate:s,bitrateMin:a,bitrateMax:c}}function Tu(t,r,s,a,c){return{width:{max:t},height:{max:r},frameRate:s,bitrateMin:a,bitrateMax:c}}function VL(t,r){return{numSpatialLayers:t,numTemporalLayers:r}}const gme={"90p":xn(160,90),"90p_1":xn(160,90),"120p":xn(160,120,15,30,65),"120p_1":xn(160,120,15,30,65),"120p_3":xn(120,120,15,30,50),"120p_4":xn(212,120),"180p":xn(320,180,15,30,140),"180p_1":xn(320,180,15,30,140),"180p_3":xn(180,180,15,30,100),"180p_4":xn(240,180,15,30,120),"240p":xn(320,240,15,40,200),"240p_1":xn(320,240,15,40,200),"240p_3":xn(240,240,15,40,140),"240p_4":xn(424,240,15,40,220),"360p":xn(640,360,15,80,400),"360p_1":xn(640,360,15,80,400),"360p_3":xn(360,360,15,80,260),"360p_4":xn(640,360,30,80,600),"360p_6":xn(360,360,30,80,400),"360p_7":xn(480,360,15,80,320),"360p_8":xn(480,360,30,80,490),"360p_9":xn(640,360,15,80,800),"360p_10":xn(640,360,24,80,800),"360p_11":xn(640,360,24,80,1e3),"480p":xn(640,480,15,100,500),"480p_1":xn(640,480,15,100,500),"480p_2":xn(640,480,30,100,1e3),"480p_3":xn(480,480,15,100,400),"480p_4":xn(640,480,30,100,750),"480p_6":xn(480,480,30,100,600),"480p_8":xn(848,480,15,100,610),"480p_9":xn(848,480,30,100,930),"480p_10":xn(640,480,10,100,400),"720p":xn(1280,720,15,120,1130),"720p_auto":xn(1280,720,30,900,3e3),"720p_1":xn(1280,720,15,120,1130),"720p_2":xn(1280,720,30,120,2e3),"720p_3":xn(1280,720,30,120,1710),"720p_5":xn(960,720,15,120,910),"720p_6":xn(960,720,30,120,1380),"1080p":xn(1920,1080,15,120,2080),"1080p_1":xn(1920,1080,15,120,2080),"1080p_2":xn(1920,1080,30,120,3e3),"1080p_3":xn(1920,1080,30,120,3150),"1080p_5":xn(1920,1080,60,120,4780),"1440p":xn(2560,1440,30,120,4850),"1440p_1":xn(2560,1440,30,120,4850),"1440p_2":xn(2560,1440,60,120,7350),"4k":xn(3840,2160,30,120,8910),"4k_1":xn(3840,2160,30,120,8910),"4k_3":xn(3840,2160,60,120,13500)},_me={"480p":Tu(640,480,5),"480p_1":Tu(640,480,5),"480p_2":Tu(640,480,30),"480p_3":Tu(640,480,15),"720p":Tu(1280,720,5),"720p_auto":xn(1280,720,30,900,3e3),"720p_1":Tu(1280,720,5),"720p_2":Tu(1280,720,30),"720p_3":Tu(1280,720,15),"1080p":Tu(1920,1080,5),"1080p_1":Tu(1920,1080,5),"1080p_2":Tu(1920,1080,30),"1080p_3":Tu(1920,1080,15)},yme={"1SL1TL":VL(1,1),"3SL3TL":VL(3,3),"2SL3TL":VL(2,3)};function wh(t){return t||(t="480p_1"),typeof t=="string"?Object.assign({},gme[t]):t}function FL(t){return typeof t=="string"?Object.assign({},_me[t]):t}function oP(t){return typeof t=="string"?Object.assign({},yme[t]):t}const Eme={speech_low_quality:Kv(16e3,!1),speech_standard:Kv(32e3,!1,18),music_standard:Kv(48e3,!1),standard_stereo:Kv(48e3,!0,56),high_quality:Kv(48e3,!1,128),high_quality_stereo:Kv(48e3,!0,192)};function aP(t){return typeof t=="string"?Object.assign({},Eme[t]):t}const qv=[];function pz(t){return Hi(t,"mediaSource",["screen","window","application"]),!0}let Tt=function(t){return t.NEED_RENEGOTIATE="@need_renegotiate",t.NEED_REPLACE_TRACK="@need_replace_track",t.NEED_REPLACE_MIXING_TRACK="@need_replace_mixing_track",t.NEED_CLOSE="@need_close",t.NEED_ENABLE_TRACK="@need_enable_track",t.NEED_DISABLE_TRACK="@need_disable_track",t.NEED_SESSION_ID="@need_sid",t.SET_OPTIMIZATION_MODE="@set_optimization_mode",t.GET_STATS="@get_stats",t.GET_RTC_STATS="@get_rtc_stats",t.GET_LOW_VIDEO_TRACK="@get_low_video_track",t.NEED_RESET_REMOTE_SDP="@need_reset_remote_sdp",t.NEED_UPDATE_VIDEO_ENCODER="@need_update_video_encoder",t.NEED_UPDATE_VIDEO_SEND_PARAMETERS="@need_update_video_send_parameters",t.NEED_MUTE_TRACK="@need_mute_track",t.NEED_UNMUTE_TRACK="@need_unmute_track",t}({}),pr=function(t){return t.SCREEN_TRACK="screen_track",t.CUSTOM_TRACK="custome_track",t.LOW_STREAM="low_stream",t.SCREEN_LOW_TRACK="screen_low_track",t}({}),Yv=function(t){return t[t.HIGH_STREAM=0]="HIGH_STREAM",t[t.LOW_STREAM=1]="LOW_STREAM",t}({}),vme=function(t){return t[t.HIGH_STREAM=0]="HIGH_STREAM",t[t.LOW_STREAM=1]="LOW_STREAM",t[t.HIGH_STREAM_LAYER1=4]="HIGH_STREAM_LAYER1",t[t.HIGH_STREAM_LAYER2=5]="HIGH_STREAM_LAYER2",t[t.HIGH_STREAM_LAYER3=6]="HIGH_STREAM_LAYER3",t[t.HIGH_STREAM_LAYER4=7]="HIGH_STREAM_LAYER4",t[t.HIGH_STREAM_LAYER5=8]="HIGH_STREAM_LAYER5",t[t.HIGH_STREAM_LAYER6=9]="HIGH_STREAM_LAYER6",t}({}),Sme=function(t){return t[t.DISABLE=0]="DISABLE",t[t.LOW_STREAM=1]="LOW_STREAM",t[t.AUDIO_ONLY=2]="AUDIO_ONLY",t[t.HIGH_STREAM_LAYER1=3]="HIGH_STREAM_LAYER1",t[t.HIGH_STREAM_LAYER2=4]="HIGH_STREAM_LAYER2",t[t.HIGH_STREAM_LAYER3=5]="HIGH_STREAM_LAYER3",t[t.HIGH_STREAM_LAYER4=6]="HIGH_STREAM_LAYER4",t[t.HIGH_STREAM_LAYER5=7]="HIGH_STREAM_LAYER5",t[t.HIGH_STREAM_LAYER6=8]="HIGH_STREAM_LAYER6",t}({}),H_=function(t){return t.TRANSCEIVER_UPDATED="transceiver-updated",t.SEI_TO_SEND="sei-to-send",t.SEI_RECEIVED="sei-received",t.TRACK_UPDATED="track-updated",t}({}),Xv=function(t){return t.SOURCE_STATE_CHANGE="source-state-change",t.TRACK_ENDED="track-ended",t.BEAUTY_EFFECT_OVERLOAD="beauty-effect-overload",t.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",t.CLOSED="closed",t}({}),Jv=function(t){return t.FIRST_FRAME_DECODED="first-frame-decoded",t.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",t.VIDEO_STATE_CHANGED="video-state-changed",t}({}),Qv=function(t){return t.AUDIO="audio",t.VIDEO="video",t.DATA="data",t}({}),Xc=function(t){return t.AUDIO_SOURCE_STATE_CHANGE="audio_source_state_change",t.RECEIVE_TRACK_BUFFER="receive_track_buffer",t.ON_AUDIO_BUFFER="on_audio_buffer",t.UPDATE_SOURCE="update_source",t}({});(function(t){t.UPDATE_TRACK_SOURCE="update-track-source"})({});const jL={sendVolumeLevel:0,sendBitrate:0,sendBytes:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,currentPacketLossRate:0},BL={sendBytes:0,sendBitrate:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,sendResolutionHeight:0,sendResolutionWidth:0,captureResolutionHeight:0,captureResolutionWidth:0,targetSendBitrate:0,totalDuration:0,totalFreezeTime:0,currentPacketLossRate:0},mz={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveLevel:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receivePacketsDiscarded:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1},bme={uplinkNetworkQuality:0,downlinkNetworkQuality:0},gz={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receiveResolutionHeight:0,receiveResolutionWidth:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1};let Fo=function(t){return t.ON_TRACK="on_track",t.ON_NODE="on_node",t}({}),Jc=function(t){return t.REQUEST_UPDATE_CONSTRAINTS="request_update_constraints",t.REQUEST_CONSTRAINTS="request_constraints",t}({}),MT=function(t){return t.IDLE="IDLE",t.INITING="INITING",t.INITEND="INITEND",t}({}),$_=function(t){return t.STATE_CHANGE="state_change",t.RECORDING_DEVICE_CHANGED="recordingDeviceChanged",t.PLAYOUT_DEVICE_CHANGED="playoutDeviceChanged",t.CAMERA_DEVICE_CHANGED="cameraDeviceChanged",t}({}),yo=function(t){return t.NONE="none",t.INIT="init",t.CANPLAY="canplay",t.PLAYING="playing",t.PAUSED="paused",t.SUSPEND="suspend",t.STALLED="stalled",t.WAITING="waiting",t.ERROR="error",t.DESTROYED="destroyed",t.ABORT="abort",t.ENDED="ended",t.EMPTIED="emptied",t.LOADEDDATA="loadeddata",t}({}),Ch=function(t){return t[t.VideoStateStopped=0]="VideoStateStopped",t[t.VideoStateStarting=1]="VideoStateStarting",t[t.VideoStateDecoding=2]="VideoStateDecoding",t[t.VideoStateFrozen=3]="VideoStateFrozen",t}({});const WL={uninit:100,none:110,init:120,loadeddata:130,canplay:200,playing:210,paused:220,suspend:300,stalled:310,waiting:320,error:330,destroyed:340,abort:350,ended:360,emptied:370};let cP=function(t){return t.OPEN="open",t.MESSAGE="message",t.CLOSE="close",t.CLOSING="closing",t.ERROR="error",t}({});function _z(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}function Lr(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?_z(Object(s),!0).forEach(function(a){Ae(t,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):_z(Object(s)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))})}return t}function Ae(t,r,s){return(r=function(a){var c=function(u,h){if(typeof u!="object"||u===null)return u;var m=u[Symbol.toPrimitive];if(m!==void 0){var y=m.call(u,"string");if(typeof y!="object")return y;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(u)}(a);return typeof c=="symbol"?c:String(c)}(r))in t?Object.defineProperty(t,r,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[r]=s,t}function Ln(t,r,s,a,c){var u,h,m={};return Object.keys(a).forEach(function(y){m[y]=a[y]}),m.enumerable=!!m.enumerable,m.configurable=!!m.configurable,("value"in m||m.initializer)&&(m.writable=!0),m=hc(u=_m(h=s.slice()).call(h)).call(u,function(y,v){return v(t,r,y)||y},m),c&&m.initializer!==void 0&&(m.value=m.initializer?m.initializer.call(c):void 0,m.initializer=void 0),m.initializer===void 0&&(Object.defineProperty(t,r,m),m=null),m}class yz extends Fr{set _mediaStreamTrack(r){r!==this.mediaStreamTrack&&(this.safeEmit(H_.TRACK_UPDATED,r),this.mediaStreamTrack=r)}get _mediaStreamTrack(){return this.mediaStreamTrack}constructor(r,s){super(),Ae(this,"trackMediaType",void 0),Ae(this,"_ID",void 0),Ae(this,"_rtpTransceiver",void 0),Ae(this,"_lowRtpTransceiver",void 0),Ae(this,"_hints",[]),Ae(this,"_isClosed",!1),Ae(this,"_originMediaStreamTrack",void 0),Ae(this,"mediaStreamTrack",void 0),Ae(this,"_external",{}),this._ID=s||fr(8,"track-"),this._originMediaStreamTrack=r,this.mediaStreamTrack=r,function(a){ot(qv).call(qv,a)||qv.push(a)}(this)}toString(){return this._ID}getTrackId(){return this._ID}getMediaStreamTrack(r){return r||Gm(()=>{var s;At.reportApiInvoke(null,{name:Oi.GET_MEDIA_STREAM_TRACK,options:[],tag:Hr.TRACER}).onSuccess(((s=this._mediaStreamTrack)===null||s===void 0?void 0:s.label)||"")},this.mediaStreamTrack.id||this.getTrackId()),this._mediaStreamTrack}getRTCRtpTransceiver(r){return r===Yv.LOW_STREAM?this._lowRtpTransceiver:this._rtpTransceiver}getMediaStreamTrackSettings(){return this.getMediaStreamTrack(!0).getSettings()}close(){this._isClosed=!0,this._lowRtpTransceiver=void 0,this._rtpTransceiver=void 0,function(r){const s=qv.indexOf(r);s!==-1&&qv.splice(s,1)}(this),this.emit(Xv.CLOSED),this.removeAllListeners(H_.SEI_RECEIVED)}_updateRtpTransceiver(r,s){if(s===Yv.LOW_STREAM){if(this._lowRtpTransceiver===r)return;this._lowRtpTransceiver=r}else{if(this._rtpTransceiver===r)return;this._rtpTransceiver=r}this.emit(H_.TRANSCEIVER_UPDATED,r,s)}}class Zv extends yz{get isExternalTrack(){return this._isExternalTrack}get muted(){return this._muted}get enabled(){return this._enabled}get processorContext(){return this._processorContext}constructor(r,s){super(r,s),Ae(this,"_enabled",!0),Ae(this,"_muted",!1),Ae(this,"_isExternalTrack",!1),Ae(this,"_isClosed",!1),Ae(this,"_enabledMutex",void 0),Ae(this,"processor",void 0),Ae(this,"_processorContext",void 0),Ae(this,"_handleTrackEnded",()=>{this.onTrackEnded()}),this._enabledMutex=new Fs("".concat(this.getTrackId())),r.addEventListener("ended",this._handleTrackEnded)}getTrackLabel(){var r,s;return(r=(s=this._originMediaStreamTrack)===null||s===void 0?void 0:s.label)!==null&&r!==void 0?r:""}close(){this._isClosed||(this.stop(),this._originMediaStreamTrack.stop(),this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack.stop(),this._mediaStreamTrack=null),this._originMediaStreamTrack=null,this._enabledMutex=null,x.debug("[".concat(this.getTrackId(),"] close")),this.emit(Tt.NEED_CLOSE),super.close())}async _updateOriginMediaStreamTrack(r,s){let a=arguments.length>2&&arguments[2]!==void 0&&arguments[2];this._isExternalTrack=a,r!==this._originMediaStreamTrack&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),s&&this._originMediaStreamTrack.stop()),r.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=r,this._muted&&(this._originMediaStreamTrack.enabled=!1),this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await hr(this,Tt.NEED_REPLACE_TRACK,this),this.processor&&this._processorContext&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this._processorContext}))}_getDefaultPlayerConfig(){return{}}onTrackEnded(){x.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(Xv.TRACK_ENDED)}stateCheck(r,s){if(x.debug("check track state, [muted: ".concat(this._muted,", enabled: ").concat(this._enabled,"] to [").concat(r,": ").concat(s,"]")),sp(s,r),this._enabled&&this._muted&&r==="enabled"&&s===!1)throw new Me(te.TRACK_STATE_UNREACHABLE,"cannot set enabled while the track is muted").print("error",x);if(!this._enabled&&!this._muted&&r==="muted"&&s===!0)throw new Me(te.TRACK_STATE_UNREACHABLE,"cannot set muted while the track is disabled").print("error",x)}getProcessorStats(){return this._processorContext&&this._processorContext.gatherStats()||[]}getProcessorUsage(){return this._processorContext?this._processorContext.gatherUsage():dt.resolve([])}}const Ez=window.AudioContext||window.webkitAudioContext;let Qc=null;const ir=new class extends Fr{constructor(){super(...arguments),Ae(this,"prevState",void 0),Ae(this,"curState",void 0),Ae(this,"currentTime",void 0),Ae(this,"currentTimeStuckAt",void 0),Ae(this,"interruptDetectorTrack",void 0),Ae(this,"onLocalAudioTrackMute",()=>{x.info("ios15-interruption-start"),this.emit(gs.IOS_15_16_INTERRUPTION_START)}),Ae(this,"onLocalAudioTrackUnmute",async()=>{x.info("ios15-interruption-end"),this.curState!=="running"||this.duringInterruption?x.info("ios15-interruption-end-canceled"):(Qc&&await Qc.suspend(),this.emit(gs.IOS_15_16_INTERRUPTION_END))})}get duringInterruption(){return this.prevState==="running"&&this.curState==="interrupted"}bindInterruptDetectorTrack(t){x.debug("webaudio bindInterruptDetectorTrack ".concat(t.getTrackId())),this.interruptDetectorTrack||(this.interruptDetectorTrack=t,this.interruptDetectorTrack._mediaStreamTrack.onmute=this.onLocalAudioTrackMute,this.interruptDetectorTrack._mediaStreamTrack.onunmute=this.onLocalAudioTrackUnmute)}unbindInterruptDetectorTrack(t){x.debug("webaudio unbindInterruptDetectorTrack ".concat(t.getTrackId())),this.interruptDetectorTrack&&this.interruptDetectorTrack===t&&(this.interruptDetectorTrack._mediaStreamTrack&&(this.interruptDetectorTrack._mediaStreamTrack.onmute=null,this.interruptDetectorTrack._mediaStreamTrack.onunmute=null),this.interruptDetectorTrack=void 0)}};function eS(){if(!Qc){if(function(){if(!Ez)return void x.error("your browser is not support web audio");x.info("create audio context");const t=Lr({},oe("WEBAUDIO_INIT_OPTIONS"));x.debug("audio context init option:",JSON.stringify(t)),Qc=new Ez(t),ir.curState=Qc.state,Qc.onstatechange=()=>{ir.prevState=ir.curState,ir.curState=Qc?Qc.state:void 0;const{prevState:r,curState:s}=ir,a=s==="running",c=s==="interrupted",u=r==="running",h=r==="suspended",m=r==="interrupted",y=Dn().osVersion;(Vo()||Su())&&u&&c&&(x.info("ios".concat(y,"-interruption-start")),ir.emit(gs.IOS_INTERRUPTION_START)),(Vo()||Su())&&(h||m)&&a&&(x.info("ios".concat(y,"-interruption-end")),ir.emit(gs.IOS_INTERRUPTION_END)),r!==s&&ir.emit(gs.STATE_CHANGE,s,r)},setInterval(()=>{var r;const s=(r=Qc)===null||r===void 0?void 0:r.currentTime;ir.currentTime!==s?(ir.currentTimeStuckAt&&(x.debug("AudioContext current time resume at ".concat(s)),ir.currentTimeStuckAt=void 0),ir.currentTime=s):(s!==ir.currentTimeStuckAt&&(At.reportApiInvoke(null,{name:"WEB_AUDIO_CURRENT_TIME_STUCK",options:{currentTime:s},tag:Hr.TRACER}).onSuccess(),x.warning("AudioContext current time stuck at ".concat(s))),ir.currentTimeStuckAt=s)},5e3),async function(r){const s=["click","contextmenu","auxclick","dblclick","mousedown","mouseup","touchend","keydown","keyup"];let a,c=!1,u=!1,h=!1;function m(F){r.state==="running"?y(!1):Vo()||Su()?r.state==="suspended"&&(y(!0),F&&r.resume().then(v,v)):r.state!=="closed"&&(y(!0),F&&r.resume().then(v,v))}function y(F){if(c!==F){c=F;for(let j=0,Y=s;j<Y.length;j+=1){const ee=Y[j];F?window.addEventListener(ee,S,{capture:!0,passive:!0}):window.removeEventListener(ee,S,{capture:!0,passive:!0})}}}function v(){m(!1)}function S(){m(!0)}function R(F){if(!h)if(a.paused)if(F){let j;P(!1),h=!0;try{j=a.play(),j?j.then(D,D):(a.addEventListener("playing",D),a.addEventListener("abort",D),a.addEventListener("error",D))}catch{D()}}else P(!0);else P(!1)}function P(F){if(u!==F){u=F;for(let j=0,Y=s;j<Y.length;j++){const ee=Y[j];F?window.addEventListener(ee,G,{capture:!0,passive:!0}):window.removeEventListener(ee,G,{capture:!0,passive:!0})}}}function D(){a.removeEventListener("playing",D),a.removeEventListener("abort",D),a.removeEventListener("error",D),h=!1,R(!1)}function G(){R(!0)}if(Vo()){const F=r.createMediaStreamDestination(),j=document.createElement("div");j.innerHTML="<audio x-webkit-airplay='deny'></audio>",a=j.children.item(0),a.controls=!1,a.disableRemotePlayback=!0,a.preload="auto",a.srcObject=F.stream,R(!0)}ir.on(gs.STATE_CHANGE,function(){m(!0)}),m(!1)}(Qc)}(),!Qc)throw new Me(te.NOT_SUPPORTED,"can not create audio context");return Qc}return Qc}function K_(t){if(function(){if(zL!==null)return zL;const a=eS(),c=a.createBufferSource(),u=a.createGain(),h=a.createGain();c.connect(u),c.connect(h),c.disconnect(u);let m=!1;try{c.disconnect(u)}catch{m=!0}return c.disconnect(),zL=m,m}())return;const r=t.connect,s=t.disconnect;t.connect=(a,c,u)=>{var h;return t._inputNodes||(t._inputNodes=[]),ot(h=t._inputNodes).call(h,a)||(a instanceof AudioNode?(t._inputNodes.push(a),r.call(t,a,c,u)):r.call(t,a,c)),t},t.disconnect=(a,c,u)=>{s.call(t),a?JA(t._inputNodes,a):t._inputNodes=[];for(const h of t._inputNodes)r.call(t,h)}}let zL=null;function GL(t,r){let s=!1;const a=1/r;if(oe("DISABLE_WEBAUDIO")){const c=window.setInterval(()=>{s?window.clearInterval(c):t(performance.now()/1e3)},1e3*a)}else{const c=eS();let u=c.createGain();u.gain.value=0,u.connect(c.destination);const h=()=>{if(s)return void(u=null);const m=c.createOscillator();m.onended=h,m.connect(u),m.start(0),m.stop(c.currentTime+a),t(c.currentTime)};h()}return()=>{s=!0}}class vz{constructor(){Ae(this,"context",void 0),Ae(this,"analyserNode",void 0),Ae(this,"sourceNode",void 0),this.context=eS(),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4}updateSource(r){if(r!==this.sourceNode){if(this.sourceNode)try{this.sourceNode.disconnect(this.analyserNode)}catch{}this.sourceNode=r,r==null||r.connect(this.analyserNode)}}getVolumeLevel(){if(!this.sourceNode||(!this.context||Vo()||Su()||this.context.state!=="running"&&this.context.resume(),!this.analyserNode))return 0;const r=new Float32Array(this.analyserNode.fftSize);if(this.analyserNode.getFloatTimeDomainData)this.analyserNode.getFloatTimeDomainData(r);else{const a=new Uint8Array(this.analyserNode.fftSize);this.analyserNode.getByteTimeDomainData(a);for(let c=0;c<r.length;++c)r[c]=a[c]/128-1}const s=hc(r).call(r,(a,c)=>a+c*c,0)/r.length;return Math.max(10*Math.log10(s)+100,0)/100}getAnalyserNode(){return this.analyserNode}rebuildAnalyser(){try{var r,s;(r=this.sourceNode)===null||r===void 0||r.disconnect(this.analyserNode),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4,(s=this.sourceNode)===null||s===void 0||s.connect(this.analyserNode)}catch{x.warning("rebuild analyser node failed.")}}destroy(){this.updateSource(void 0)}}class Sz extends Fr{get processSourceNode(){return this.sourceNode}set processedNode(r){var s;if(!this.isDestroyed&&this._processedNode!==r){try{var a;(a=this.sourceNode)===null||a===void 0||a.disconnect(this.outputNode)}catch{}(s=this._processedNode)===null||s===void 0||s.disconnect(),this._processedNode=r,this.connect()}}get processedNode(){return this._processedNode}constructor(){super(),Ae(this,"outputNode",void 0),Ae(this,"outputTrack",void 0),Ae(this,"isPlayed",!1),Ae(this,"sourceNode",void 0),Ae(this,"context",void 0),Ae(this,"audioBufferNode",void 0),Ae(this,"destNode",void 0),Ae(this,"audioOutputLevel",0),Ae(this,"volumeLevelAnalyser",void 0),Ae(this,"_processedNode",void 0),Ae(this,"playNode",void 0),Ae(this,"isDestroyed",!1),Ae(this,"onNoAudioInput",void 0),Ae(this,"isNoAudioInput",!1),Ae(this,"_noAudioInputCount",0),this.context=eS(),this.playNode=this.context.destination,this.outputNode=this.context.createGain(),K_(this.outputNode),this.volumeLevelAnalyser=new vz}startGetAudioBuffer(r){this.audioBufferNode||(this.audioBufferNode=this.context.createScriptProcessor(r),this.outputNode.connect(this.audioBufferNode),this.audioBufferNode.connect(this.context.destination),this.audioBufferNode.onaudioprocess=s=>{this.emit(Xc.ON_AUDIO_BUFFER,function(a){for(let c=0;c<a.outputBuffer.numberOfChannels;c+=1){const u=a.outputBuffer.getChannelData(c);for(let h=0;h<u.length;h+=1)u[h]=0}return a.inputBuffer}(s))})}stopGetAudioBuffer(){this.audioBufferNode&&(this.audioBufferNode.onaudioprocess=null,this.outputNode.disconnect(this.audioBufferNode),this.audioBufferNode=void 0)}createOutputTrack(){if(!jn().webAudioMediaStreamDest)throw new Me(te.NOT_SUPPORTED,"your browser is not support audio processor");return this.destNode&&this.outputTrack||(this.destNode=this.context.createMediaStreamDestination(),this.outputNode.connect(this.destNode),this.outputTrack=this.destNode.stream.getAudioTracks()[0]),this.outputTrack}play(r){this.context.state!=="running"&&QA(()=>{ir.emit("autoplay-failed")}),this.isPlayed=!0,this.playNode=r||this.context.destination,this.outputNode.connect(this.playNode)}stop(){if(this.isPlayed)try{this.outputNode.disconnect(this.playNode)}catch{}this.isPlayed=!1}getAccurateVolumeLevel(){return this.volumeLevelAnalyser.getVolumeLevel()}async checkHasAudioInput(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;if(r>5)return this.isNoAudioInput=!0,this.onNoAudioInput&&this.onNoAudioInput(),!1;Vo()||Su()?this.context.state==="suspended"&&this.context.resume():this.context.state!=="running"&&this.context.resume();const s=this.volumeLevelAnalyser.getAnalyserNode();let a;s.getFloatTimeDomainData?(a=new Float32Array(s.fftSize),s.getFloatTimeDomainData(a)):(a=new Uint8Array(s.fftSize),s.getByteTimeDomainData(a));let c=!1;for(let u=0;u<a.length;u++)a[u]!==0&&(c=!0);return c?(this.isNoAudioInput=!1,!0):(await ps(200),await this.checkHasAudioInput(r?r+1:1)&&c)}getAudioVolume(){return this.outputNode.gain.value}setVolume(r){this.outputNode.gain.setValueAtTime(r,this.context.currentTime)}destroy(){this.disconnect(),this.stop(),this.isDestroyed=!0,this.onNoAudioInput=void 0}disconnect(){var r,s;(r=this.processedNode)===null||r===void 0||r.disconnect(),(s=this.sourceNode)===null||s===void 0||s.disconnect(),this.outputNode&&this.outputNode.disconnect()}connect(){var r;this.processedNode?(r=this.processedNode)===null||r===void 0||r.connect(this.outputNode):this.sourceNode&&this.sourceNode.connect(this.outputNode),this.volumeLevelAnalyser.updateSource(this.outputNode)}}class bz extends Sz{get isFreeze(){return!1}constructor(r,s,a){var c;if(super(),Ae(this,"sourceNode",void 0),Ae(this,"track",void 0),Ae(this,"clonedTrack",void 0),Ae(this,"audioElement",void 0),Ae(this,"isCurrentTrackCloned",!1),Ae(this,"isRemoteTrack",!1),Ae(this,"originVolumeLevelAnalyser",void 0),Ae(this,"rebuildWebAudio",async()=>{if(x.debug("ready to rebuild web audio, state:",this.context.state),this.isNoAudioInput&&await this.checkHasAudioInput(),!this.isNoAudioInput||this.isDestroyed)return document.body.removeEventListener("click",this.rebuildWebAudio,!0),void x.debug("rebuild web audio success, current volume status",this.getAccurateVolumeLevel());this.context.resume().then(()=>x.info("resume success")),x.debug("rebuild web audio because of ios 12 bugs"),this.disconnect();const m=this.track;this.track=this.track.clone(),this.isCurrentTrackCloned?m.stop():this.isCurrentTrackCloned=!0;const y=new MediaStream([this.track]);this.sourceNode=this.context.createMediaStreamSource(y),K_(this.sourceNode),this.volumeLevelAnalyser.rebuildAnalyser();const v=this.outputNode.gain.value;this.outputNode=this.context.createGain(),this.outputNode.gain.setValueAtTime(v,this.context.currentTime),K_(this.outputNode),this.emit(Xc.UPDATE_SOURCE),this.connect(),this.audioElement.srcObject=y,this.isPlayed&&this.play(this.playNode),this.checkHasAudioInput()}),r.kind!=="audio")throw new Me(te.UNEXPECTED_ERROR);this.track=r;const u=new MediaStream([this.track]);if(this.isRemoteTrack=!!s,this.sourceNode=this.context.createMediaStreamSource(u),K_(this.sourceNode),a){const m=a.clone();m.enabled=!0,this.clonedTrack=m,x.debug("create an unmuted track ".concat(m.id," from the original track ").concat(a.id," to get the volume"));const y=this.context.createMediaStreamSource(new MediaStream([m]));K_(y),this.originVolumeLevelAnalyser=new vz,this.originVolumeLevelAnalyser.updateSource(y)}this.connect(),this.audioElement=document.createElement("audio"),this.audioElement.srcObject=u;const h=Dn();s&&h.os===Qi.IOS&&Number((c=h.osVersion)===null||c===void 0?void 0:c.split(".")[0])<15&&(ir.on(gs.STATE_CHANGE,()=>{this.context.state==="suspended"?document.body.addEventListener("click",this.rebuildWebAudio,!0):this.context.state==="running"&&this.rebuildWebAudio()}),this.checkHasAudioInput().then(m=>{m||document.body.addEventListener("click",this.rebuildWebAudio,!0)}))}updateTrack(r){this.sourceNode.disconnect(),this.track=r,this.isCurrentTrackCloned=!1;const s=new MediaStream([r]);this.sourceNode=this.context.createMediaStreamSource(s),K_(this.sourceNode),this.processedNode||this.sourceNode.connect(this.outputNode),this.emit(Xc.UPDATE_SOURCE),this.audioElement.srcObject=s}destroy(){var r;this.audioElement.srcObject=null,this.audioElement.remove(),ir.off("state-change",this.rebuildWebAudio),(r=this.originVolumeLevelAnalyser)===null||r===void 0||r.destroy(),this.clonedTrack=void 0,super.destroy()}createMediaStreamSourceNode(r){return this.context.createMediaStreamSource(new MediaStream([r]))}updateOriginTrack(r){const s=r.clone();s.enabled=!0,this.clonedTrack&&(this.clonedTrack.stop(),this.clonedTrack=s),x.debug("create an unmuted track ".concat(s.id," from the original track ").concat(r.id," to get the volume"));const a=this.context.createMediaStreamSource(new MediaStream([s]));K_(a),this.originVolumeLevelAnalyser&&this.originVolumeLevelAnalyser.updateSource(a)}getOriginVolumeLevel(){return this.originVolumeLevelAnalyser?this.originVolumeLevelAnalyser.getVolumeLevel():this.getAccurateVolumeLevel()}}async function Tz(t,r,s){const a=(u,h)=>u?typeof u!="number"?u.max||u.exact||u.ideal||u.min||h:u:h,c={audio:!!s&&{mandatory:{chromeMediaSource:"desktop"}},video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:t,maxHeight:a(r.height,1080),maxWidth:a(r.width,1920)}}};return r.frameRate&&typeof r.frameRate!="number"?(c.video.mandatory.maxFrameRate=r.frameRate.max,c.video.mandatory.minFrameRate=r.frameRate.min):typeof r.frameRate=="number"&&(c.video.mandatory.maxFrameRate=r.frameRate),await navigator.mediaDevices.getUserMedia(c)}async function Tme(t,r){const s=await wz(t.mediaSource),{sourceId:a,audio:c}=await function(u){let h=arguments.length>1&&arguments[1]!==void 0&&arguments[1];return new dt((m,y)=>{const v=document.createElement("div");v.innerText="share screen",v.setAttribute("style","text-align: center; height: 25px; line-height: 25px; border-radius: 4px 4px 0 0; background: #D4D2D4; border-bottom:  solid 1px #B9B8B9;");const S=document.createElement("div");S.setAttribute("style","width: 100%; height: 500px; padding: 15px 25px ; box-sizing: border-box;");const R=document.createElement("div");R.innerText="Agora Web Screensharing wants to share the contents of your screen with webdemo.agorabeckon.com. Choose what you'd like to share.",R.setAttribute("style","height: 12%;");const P=document.createElement("div");P.setAttribute("style","width: 100%; height: 80%; background: #FFF; border:  solid 1px #CBCBCB; display: flex; flex-wrap: wrap; justify-content: space-around; overflow-y: scroll; padding: 0 15px; box-sizing: border-box;");const D=document.createElement("div");D.setAttribute("style","display: flex; justify-content: space-between; padding: 16px 0;");const G=document.createElement("button");G.innerHTML="cancel",G.setAttribute("style","width: 85px;"),G.onclick=()=>{document.body.removeChild(Y);const ee=new Error("NotAllowedError");ee.name="NotAllowedError",y(ee)};let F=h;const j=document.createElement("div");if(h){const ee=document.createElement("input");ee.setAttribute("type","checkbox");const fe=document.createElement("span");ee.setAttribute("style","margin-right: 6px;"),fe.innerText="Share audio",ee.checked=F,ee.onchange=()=>{F=ee.checked},j.appendChild(ee),j.appendChild(fe)}D.appendChild(j),D.appendChild(G),S.appendChild(R),S.appendChild(P),S.appendChild(D);const Y=document.createElement("div");Y.setAttribute("style","position: fixed; z-index: 99999999; top: 50%; left: 50%; width: 620px; height: 525px; background: #ECECEC; border-radius: 4px; -webkit-transform: translate(-50%,-50%); transform: translate(-50%,-50%);"),Y.appendChild(v),Y.appendChild(S),document.body.appendChild(Y),u.map(ee=>{if(ee.id){const fe=document.createElement("div");fe.setAttribute("style","width: 30%; height: 160px; padding: 20px 0; text-align: center;box-sizing: content-box;");let Se=ee.thumbnail;try{const{width:we}=Se.getSize();we>1920&&(Se=Se.resize({width:1920}))}catch(we){throw we&&we.message.startsWith("Illegal invocation")&&console.error("Operate thumbnail error, please try to set contextIsolation: false. (https://github.com/electron/electron/issues/34953)"),we}fe.innerHTML='<div style="height: 120px; display: table-cell; vertical-align: middle;"><img style="width: 100%; background: #333333; box-shadow: 1px 1px 1px 1px rgba(0, 0, 0, 0.2);" src='+Se.toDataURL()+' /></div><span style="	height: 40px; line-height: 40px; display: inline-block; width: 70%; word-break: keep-all; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+ee.name.replace(/[\u00A0-\u9999<>\&]/g,function(we){return"&#"+we.charCodeAt(0)+";"})+"</span>",fe.onclick=()=>{document.body.removeChild(Y),m({sourceId:ee.id,audio:F})},P.appendChild(fe)}})})}(s,r);return await Tz(a,t,c)}async function wz(t){let r=["window","screen"];t!=="application"&&t!=="window"||(r=["window"]),t==="screen"&&(r=["screen"]);const s=M8();if(!s)throw console.error("failed to fetch electron, please mount it to window"),new Me(te.ELECTRON_IS_NULL);let a=null;try{var c;a=((c=s.desktopCapturer)===null||c===void 0?void 0:c.getSources({types:r}))||s.ipcRenderer.invoke("DESKTOP_CAPTURER_GET_SOURCES",{types:r})}catch{a=null}a&&a.then||(a=new dt((u,h)=>{s.desktopCapturer.getSources({types:r},(m,y)=>{m?h(m):u(y)})}));try{return await a}catch(u){throw new Me(te.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR,u.toString())}}const HL=new Fs("safari");let Cz=!1,Rz=!1;async function Zc(t,r){let s=0,a=null;for(;s<2;)try{a=await wme(t,r,s>0);break}catch(c){if(c instanceof Me)throw x.error("[".concat(r,"] ").concat(c.toString())),c;const u=lP(c.name||c.code||c,c.message);if(u.code===te.MEDIA_OPTION_INVALID){x.debug("[".concat(r,"] detect media option invalid, retry")),s+=1,await ps(500);continue}throw x.error("[".concat(r,"] ").concat(u.toString())),u}if(!a)throw new Me(te.UNEXPECTED_ERROR,"can not find stream after getUserMedia");return a}async function wme(t,r,s){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new Me(te.NOT_SUPPORTED,"can not find getUserMedia");s&&(t.video&&(delete t.video.width,delete t.video.height),t.screen&&(delete t.screen.width,delete t.screen.height));const a=jn(),c=new MediaStream;if(t.audioSource&&c.addTrack(t.audioSource),t.videoSource&&c.addTrack(t.videoSource),!t.audio&&!t.video&&!t.screen)return x.debug("Using Video Source/ Audio Source"),c;if(t.screen)if(M8())t.screen.sourceId?tS(c,await Tz(t.screen.sourceId,t.screen,!!t.screenAudio)):tS(c,await Tme(t.screen,!!t.screenAudio));else if(rp()&&t.screen.extensionId&&t.screen.mandatory){if(!a.getStreamFromExtension)throw new Me(te.NOT_SUPPORTED,"This browser does not support screen sharing");x.debug("[".concat(r,'] Screen access on chrome stable, looking for extension"'));const P=await(h=t.screen.extensionId,m=r,new dt((D,G)=>{try{chrome.runtime.sendMessage(h,{getStream:!0},F=>{if(!F||!F.streamId)return x.error("[".concat(m,"] No response from Chrome Plugin. Plugin not installed properly"),F),void G(new Me(te.CHROME_PLUGIN_NO_RESPONSE,"No response from Chrome Plugin. Plugin not installed properly"));D(F.streamId)})}catch(F){x.error("[".concat(m,"] AgoraRTC screensharing plugin is not accessible(").concat(h,")"),F.toString()),G(new Me(te.CHROME_PLUGIN_NOT_INSTALL))}}));t.screen.mandatory.chromeMediaSourceId=P,tS(c,await navigator.mediaDevices.getUserMedia({video:{mandatory:t.screen.mandatory}}))}else if(a.getDisplayMedia){var u;t.screen.mediaSource&&pz(t.screen.mediaSource);const P={width:t.screen.width,height:t.screen.height,frameRate:t.screen.frameRate,displaySurface:(u=t.screen.displaySurface)!==null&&u!==void 0?u:t.screen.mediaSource==="screen"?"monitor":t.screen.mediaSource},{selfBrowserSurface:D,surfaceSwitching:G,systemAudio:F,preferCurrentTab:j}=t.screen,Y={selfBrowserSurface:D,surfaceSwitching:G,systemAudio:F,preferCurrentTab:j};!D&&delete Y.selfBrowserSurface,!G&&delete Y.surfaceSwitching,!F&&delete Y.systemAudio,!j&&delete Y.preferCurrentTab,x.debug("[".concat(r,"] getDisplayMedia:"),JSON.stringify({video:P,audio:t.screenAudio,controls:Y})),tS(c,await navigator.mediaDevices.getDisplayMedia(Lr({video:P,audio:t.screenAudio},Y)))}else{if(!zr())throw x.error("[".concat(r,"] This browser does not support screenSharing")),new Me(te.NOT_SUPPORTED,"This browser does not support screen sharing");{t.screen.mediaSource&&pz(t.screen.mediaSource);const P={video:{mediaSource:t.screen.mediaSource,width:t.screen.width,height:t.screen.height,frameRate:t.screen.frameRate}};x.debug("[".concat(r,"] getUserMedia: ").concat(JSON.stringify(P))),tS(c,await navigator.mediaDevices.getUserMedia(P))}}var h,m;if(!t.video&&!t.audio)return c;let y={video:t.video,audio:t.audio},v=oe("MEDIA_DEVICE_CONSTRAINTS");if(v)try{typeof v=="string"&&(v=JSON.parse(v)),y=bL(y,v)}catch{}x.debug("[".concat(r,"] GetUserMedia"),JSON.stringify(y)),Dn();let S,R=null;(Ps()||Vo()||YA())&&(R=await HL.lock());try{S=await navigator.mediaDevices.getUserMedia(y)}catch(P){throw R&&R(),P}return y.audio&&(Cz=!0),y.video&&(Rz=!0),tS(c,S),R&&R(),c}function lP(t,r){switch(t){case"Starting video failed":case"OverconstrainedError":case"TrackStartError":return new Me(te.MEDIA_OPTION_INVALID,"".concat(t,": ").concat(r));case"NotFoundError":case"DevicesNotFoundError":return new Me(te.DEVICE_NOT_FOUND,"".concat(t,": ").concat(r));case"NotSupportedError":return new Me(te.NOT_SUPPORTED,"".concat(t,": ").concat(r));case"NotReadableError":return new Me(te.NOT_READABLE,"".concat(t,": ").concat(r));case"InvalidStateError":case"NotAllowedError":case"PERMISSION_DENIED":case"PermissionDeniedError":return new Me(te.PERMISSION_DENIED,"".concat(t,": ").concat(r));case"ConstraintNotSatisfiedError":return new Me(te.CONSTRAINT_NOT_SATISFIED,"".concat(t,": ").concat(r));default:return x.error("getUserMedia unexpected error",t),new Me(te.UNEXPECTED_ERROR,"".concat(t,": ").concat(r))}}function tS(t,r){const s=t.getVideoTracks()[0],a=t.getAudioTracks()[0],c=r.getVideoTracks()[0],u=r.getAudioTracks()[0];u&&(a&&t.removeTrack(a),t.addTrack(u)),c&&(s&&t.removeTrack(s),t.addTrack(c))}const el=new class extends Fr{get state(){return this._state}set state(t){t!==this._state&&(this.emit($_.STATE_CHANGE,t),this._state=t)}constructor(){super(),Ae(this,"_state",MT.IDLE),Ae(this,"isAccessMicrophonePermission",!1),Ae(this,"isAccessCameraPermission",!1),Ae(this,"lastAccessMicrophonePermission",!1),Ae(this,"lastAccessCameraPermission",!1),Ae(this,"checkdeviceMatched",!1),Ae(this,"deviceInfoMap",new Map),this.init().then(()=>{navigator.mediaDevices.addEventListener&&navigator.mediaDevices.addEventListener("devicechange",this.updateDevicesInfo.bind(this)),window.setInterval(()=>{(oe("ENUMERATE_DEVICES_INTERVAL")||(XA()||qA()===Qi.HARMONY_OS)&&ip())&&this.updateDevicesInfo()},oe("ENUMERATE_DEVICES_INTERVAL_TIME"))}).catch(t=>x.error(t.toString()))}async enumerateDevices(t,r){let s=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)return new Me(te.NOT_SUPPORTED,"enumerateDevices() not supported.").throw();const a=await navigator.mediaDevices.enumerateDevices(),c=this.checkMediaDeviceInfoIsOk(a);let u=!this.isAccessMicrophonePermission&&t,h=!this.isAccessCameraPermission&&r;c.audio&&(u=!1),c.video&&(h=!1);let m=null,y=null,v=null;if(!s&&(u||h)){if(HL.isLocked&&(x.debug("[device manager] wait GUM lock"),(await HL.lock())(),x.debug("[device manager] GUM unlock")),Cz&&(u=!1,this.isAccessMicrophonePermission=!0),Rz&&(h=!1,this.isAccessCameraPermission=!0),x.debug("[device manager] check media device permissions",t,r,u,h),u&&h){try{v=await navigator.mediaDevices.getUserMedia({audio:!0,video:!0})}catch(S){const R=lP(S.name||S.code||S,S.message);if(R.code===te.PERMISSION_DENIED)throw R;x.warning("getUserMedia failed in getDevices",R)}this.isAccessCameraPermission=!0,this.isAccessMicrophonePermission=!0}else if(u){try{m=await navigator.mediaDevices.getUserMedia({audio:t})}catch(S){const R=lP(S.name||S.code||S,S.message);if(R.code===te.PERMISSION_DENIED)throw R;x.warning("getUserMedia failed in getDevices",R)}this.isAccessMicrophonePermission=!0}else if(h){try{y=await navigator.mediaDevices.getUserMedia({video:r})}catch(S){const R=lP(S.name||S.code||S,S.message);if(R.code===te.PERMISSION_DENIED)throw R;x.warning("getUserMedia failed in getDevices",R)}this.isAccessCameraPermission=!0}x.debug("[device manager] mic permission",t,"cam permission",r)}try{const S=await navigator.mediaDevices.enumerateDevices();return m&&m.getTracks().forEach(R=>R.stop()),y&&y.getTracks().forEach(R=>R.stop()),v&&v.getTracks().forEach(R=>R.stop()),m=null,y=null,v=null,S}catch(S){return m&&m.getTracks().forEach(R=>R.stop()),y&&y.getTracks().forEach(R=>R.stop()),v&&v.getTracks().forEach(R=>R.stop()),m=null,y=null,v=null,new Me(te.ENUMERATE_DEVICES_FAILED,S.toString()).throw()}}async getRecordingDevices(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,t)).filter(r=>r.kind==="audioinput")}async getCamerasDevices(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!1,!0,t)).filter(r=>r.kind==="videoinput")}async getSpeakers(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,t)).filter(r=>r.kind==="audiooutput")}searchDeviceIdByName(t){let r=null;return this.deviceInfoMap.forEach(s=>{s.device.label===t&&(r=s.device.deviceId)}),r}async getDeviceById(t){const r=(await this.enumerateDevices(!0,!0,!0)).find(s=>s.deviceId===t);if(!r)throw new Me(te.DEVICE_NOT_FOUND,"deviceId: ".concat(t));return r}async init(){this.state=MT.INITING;try{await this.updateDevicesInfo(),this.state=MT.INITEND}catch(t){throw x.warning("Device Detection functionality cannot start properly.",t.toString()),this.state=MT.IDLE,(typeof isSecureContext=="boolean"?isSecureContext:location.protocol==="https:"||location.protocol==="file:"||location.hostname==="localhost"||location.hostname==="127.0.0.1"||location.hostname==="::1")||new Me(te.WEB_SECURITY_RESTRICT,"Your context is limited by web security, please try using https protocol or localhost.").throw(),t}}async updateDevicesInfo(){const t=await this.enumerateDevices(!0,!0,!0),r=Date.now(),s=[];if(t[0]&&t[0].label&&this.checkdeviceMatched===!1){this.checkdeviceMatched=!0;const c=t.find(h=>h.kind==="audioinput"&&h.deviceId==="default"),u=t.find(h=>h.kind==="audiooutput"&&h.deviceId==="default");c&&u?u.groupId===c.groupId?x.debug("[device-check] default input ".concat(c.label," and output ").concat(u.label," is the same group")):x.debug("[device-check] default input ".concat(c.label," and output ").concat(u.label," is not the same group")):x.debug("[device-check] default input or output not found")}const a=this.checkMediaDeviceInfoIsOk(t);if(t.forEach(c=>{if(!c.deviceId)return;const u=this.deviceInfoMap.get("".concat(c.kind,"_").concat(c.deviceId));if((u?u.state:"INACTIVE")!=="ACTIVE"){const h={initAt:r,updateAt:r,device:c,state:"ACTIVE"};this.deviceInfoMap.set("".concat(c.kind,"_").concat(c.deviceId),h),s.push(h)}u&&(u.updateAt=r)}),this.deviceInfoMap.forEach((c,u)=>{c.state==="ACTIVE"&&c.updateAt!==r&&(c.state="INACTIVE",s.push(c))}),this.state!==MT.INITEND)return a.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),void(a.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0));s.forEach(c=>{switch(c.device.kind){case"audioinput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit($_.RECORDING_DEVICE_CHANGED,c);break;case"videoinput":this.lastAccessCameraPermission&&this.isAccessCameraPermission&&this.emit($_.CAMERA_DEVICE_CHANGED,c);break;case"audiooutput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit($_.PLAYOUT_DEVICE_CHANGED,c)}}),a.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),a.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0)}checkMediaDeviceInfoIsOk(t){const r=t.filter(c=>c.kind==="audioinput"),s=t.filter(c=>c.kind==="videoinput"),a={audio:!1,video:!1};for(const c of r)if(c.label&&c.deviceId){a.audio=!0;break}for(const c of s)if(c.label&&c.deviceId){a.video=!0;break}return a}};let $L=!1;const tl=new class extends Fr{constructor(){super(...arguments),Ae(this,"onAutoplayFailed",void 0),Ae(this,"onAudioAutoplayFailed",void 0)}};function Iz(){if(Dn(),!$L){const t=r=>{r.preventDefault(),$L=!1,IT()?document.body.removeEventListener("click",t,!0):(document.body.removeEventListener("touchstart",t,!0),document.body.removeEventListener("mousedown",t,!0))};$L=!0,IT()?document.body.addEventListener("click",t,!0):(document.body.addEventListener("touchstart",t,!0),document.body.addEventListener("mousedown",t,!0)),x.info("detect media autoplay failed, document: https://docs.agora.io/cn/Voice/autoplay_policy_web_ng?platform=Web"),tl.onAutoplayFailed?tl.onAutoplayFailed():tl.onAudioAutoplayFailed?x.warning(`AgoraRTC.onAudioAutoplayFailed has been deprecated in favor of AgoraRTC.onAutoplayFailed.

  Please refer to the Agora document to migrate the newer API, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`):x.warning(`We have detected a media autoplay failed event, and found out that you haven't implemented AgoraRTC.onAutoplayFailed callback yet.

  It will cause audio/video element not playing automatically on some browsers without user interaction, possibly hurting user experiences.

  Please refer to the Agora document to properly handle autoplay failed event, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`),tl.emit("autoplay-failed")}}function Az(t,r,s,a){if(!t)return;const c=At.getBaseInfoBySessionId(t);if(!c)return;const u=c.info,h=Date.now(),m=Lr(Lr({},u),{},{vid:u.vid===void 0?0:Number(u.vid),lts:h,elapse:h-c.startTime,cbRegistered:tl.onAutoplayFailed||tl.onAudioAutoplayFailed?1:-1,errorMsg:s,mediaType:r,trackId:a,extend:void 0});At.send({type:xr.AUTOPLAY_FAILED,data:m},!0)}const Cme=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","error"],fa=new class{constructor(){Ae(this,"onAutoplayFailed",void 0),Ae(this,"elementMap",new Map),Ae(this,"elementStateMap",new Map),Ae(this,"elementsNeedToResume",[]),Ae(this,"sinkIdMap",new Map),Ae(this,"autoResumeAfterInterruption",t=>{Array.from(this.elementMap.entries()).forEach(r=>{let[s,a]=r;const c=this.elementStateMap.get(s),u=a.srcObject.getAudioTracks()[0],h=u&&u.readyState;if(x.debug("resume after interrupted, ele: ".concat(c," audio: ").concat(h," ").concat(t)),h==="live"){if(t)return a.pause(),void a.play();if(ir.curState==="running")return Bv()?(a.pause(),void a.play()):void(c&&c==="paused"&&a.play())}})}),Ae(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{Array.from(this.elementMap.entries()).forEach(t=>{let[r,s]=t;const a=s.srcObject.getAudioTracks()[0];a&&a.readyState==="live"&&(x.debug("auto resume after interruption inside autoResumeAfterInterruptionOnIOS15"),s.pause(),s.play())})}),this.autoResumeAudioElement(),ir.on(gs.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),ir.on(gs.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),ir.on(gs.STATE_CHANGE,()=>{Vo()&&ir.prevState==="suspended"&&ir.curState==="running"&&this.autoResumeAfterInterruption()})}async setSinkID(t,r){const s=this.elementMap.get(t);if(this.sinkIdMap.set(t,r),s)try{await s.setSinkId(r)}catch(a){throw new Me(te.PERMISSION_DENIED,"can not set sink id: "+a.toString())}}play(t,r,s,a){if(this.elementMap.has(r))return;const c=document.createElement("audio");c.autoplay=!0,c.srcObject=new MediaStream([t]),this.bindAudioElementEvents(r,c),this.elementMap.set(r,c),this.elementStateMap.set(r,yo.INIT),this.setVolume(r,s);const u=this.sinkIdMap.get(r);if(u)try{c.setSinkId(u).catch(m=>{x.warning("[".concat(r,"] set sink id failed"),m.toString())})}catch(m){x.warning("[".concat(r,"] set sink id failed"),m.toString())}const h=c.play();h&&h.then&&h.catch(m=>{a&&Az(a,"audio",m.message,r),x.warning("audio element play warning",m.toString()),this.elementMap.has(r)&&m.name==="NotAllowedError"&&(x.warning("detected audio element autoplay failed"),this.elementsNeedToResume.push(c),QA(()=>{this.onAutoplayFailed&&this.onAutoplayFailed(),Iz()}))})}updateTrack(t,r){const s=this.elementMap.get(t);s&&(s.srcObject=new MediaStream([r]))}isPlaying(t){return this.elementMap.has(t)&&this.elementStateMap.get(t)==="playing"}setVolume(t,r){const s=this.elementMap.get(t);s&&(r=Math.max(0,Math.min(100,r)),s.volume=r/100)}stop(t){const r=this.elementMap.get(t);if(this.sinkIdMap.delete(t),!r)return;const s=this.elementsNeedToResume.indexOf(r);this.elementsNeedToResume.splice(s,1),r.srcObject=null,r.remove(),this.elementMap.delete(t),this.elementStateMap.delete(t)}bindAudioElementEvents(t,r){Cme.forEach(s=>{r.addEventListener(s,a=>{const c=this.elementStateMap.get(t),u=a.type==="pause"?"paused":a.type;if(x.debug("[".concat(t,"] audio-element-status change ").concat(c," => ").concat(u)),a.type==="error"){const h=r==null?void 0:r.error;h&&x.error("[".concat(t,"] media error, code: ").concat(h.code,", message: ").concat(h.message))}this.elementStateMap.set(t,u)})})}getPlayerState(t){return this.elementStateMap.get(t)||"uninit"}autoResumeAudioElement(){const t=()=>{this.elementsNeedToResume.forEach(r=>{r.play().then(s=>{x.debug("Auto resume audio element success")}).catch(s=>{x.warning("Auto resume audio element failed!",s)})}),this.elementsNeedToResume=[]};new dt(r=>{document.body?r():window.addEventListener("load",()=>r())}).then(()=>{IT()?document.body.addEventListener("click",t,!0):(document.body.addEventListener("touchstart",t,!0),document.body.addEventListener("mousedown",t,!0))})}};function li(){return function(t,r,s){const a=s.value;return typeof a=="function"&&(s.value=function(){this._isClosed&&new Me(te.INVALID_OPERATION,"[".concat(this.getTrackId(),"] cannot operate a closed track")).print("warning",x);for(var c=arguments.length,u=new Array(c),h=0;h<c;h++)u[h]=arguments[h];const m=a.apply(this,u);return m instanceof dt?new dt((y,v)=>{m.then(y).catch(v)}):m}),s}}class Pz extends Fr{constructor(r){super(),Ae(this,"name","VideoProcessorDestination"),Ae(this,"ID","0"),Ae(this,"_source",void 0),Ae(this,"videoContext",void 0),Ae(this,"inputTrack",void 0),this.videoContext=r}get kind(){return"video"}get enabled(){return!0}pipe(){throw new Me(te.NOT_SUPPORTED,"VideoProcessor cannot pipe to any other Processor")}unpipe(){throw new Me(te.NOT_SUPPORTED,"VideoProcessor cannot unpipe to any other Processor")}enable(){}disable(){}updateInput(r){if(r.context!==this.videoContext)throw new Error(`ProcessorContext passed to VideoTrack.processorDestination doesn't match it's belonging VideoTrack's context.
Probably you are making pipeline like this:
videoTrack1.pipe(processor).pipe(videoTrack2.processorDestination).`);r.track&&r.track!==this.inputTrack&&(this.videoContext.chained=!0,this.inputTrack=r.track,this.emit(Fo.ON_TRACK,r.track))}reset(){this.inputTrack=void 0,this.videoContext.chained=!1,this.emit(Fo.ON_TRACK,void 0)}}class Oz extends Fr{set chained(r){this._chained=r}get chained(){return this._chained}constructor(r,s){super(),Ae(this,"constraintsMap",new Map),Ae(this,"statsRegistry",[]),Ae(this,"usageRegistry",[]),Ae(this,"trackId",void 0),Ae(this,"direction",void 0),Ae(this,"_chained",!1),this.trackId=r,this.direction=s}async getConstraints(){return await ks(this,Jc.REQUEST_CONSTRAINTS)}async requestApplyConstraints(r,s){var a;return x.info("processor ".concat(s.name," requestApplyConstraints for ").concat(this.trackId)),r&&this.constraintsMap.set(s,r),hr(this,Jc.REQUEST_UPDATE_CONSTRAINTS,Array.from(Hc(a=this.constraintsMap).call(a)))}async requestRevertConstraints(r){var s;if(this.constraintsMap.has(r))return x.info("processor ".concat(r.name," requestRevertConstraints for ").concat(this.trackId)),this.constraintsMap.delete(r),hr(this,Jc.REQUEST_UPDATE_CONSTRAINTS,Array.from(Hc(s=this.constraintsMap).call(s)))}registerStats(r,s,a){this.statsRegistry.find(c=>c.processorID===r.ID&&c.processorName===r.name&&c.type===s)||this.statsRegistry.push({processorName:r.name,processorID:r.ID,type:s,cb:a})}unregisterStats(r,s){const a=this.statsRegistry.findIndex(c=>c.processorID===r.ID&&c.processorName===r.name&&c.type===s);a!==-1&&this.statsRegistry.splice(a,1)}gatherStats(){const r=[];for(const{processorID:s,processorName:a,type:c,cb:u}of this.statsRegistry)try{const h=u();r.push({processorID:s,processorName:a,type:c,stats:h})}catch(h){x.error(new Me(te.UNEXPECTED_ERROR,h.message))}return r}registerUsage(r,s){this.usageRegistry.find(a=>a.processorID===r.ID&&a.processorName===r.name)||this.usageRegistry.push({processorID:r.ID,processorName:r.name,cb:s})}unregisterUsage(r){const s=this.usageRegistry.findIndex(a=>a.processorID===r.ID&&a.processorName===r.name);s!==-1&&this.usageRegistry.splice(s,1)}async gatherUsage(){const r=[];if(!this.chained)return[];for(const{cb:s}of this.usageRegistry)try{let a=s();a instanceof dt&&(a=await a),r.push(Lr(Lr({},a),{},{direction:this.direction}))}catch(a){x.error("gather extension usage error",a)}return r}getDirection(){return this.direction}}class kz extends Fr{constructor(r){super(),Ae(this,"name","AudioProcessorDestination"),Ae(this,"ID","0"),Ae(this,"inputTrack",void 0),Ae(this,"inputNode",void 0),Ae(this,"audioProcessorContext",void 0),Ae(this,"_source",void 0),this.audioProcessorContext=r}get kind(){return"audio"}get enabled(){return!0}pipe(){throw new Me(te.NOT_SUPPORTED,"AudioProcessorDestination cannot pipe to any other Processor")}unpipe(){throw new Me(te.NOT_SUPPORTED,"AudioProcessor cannot unpipe to any other Processor")}enable(){}disable(){}reset(){this.inputTrack=void 0,this.inputNode=void 0,this.audioProcessorContext.chained=!1,this.emit(Fo.ON_TRACK,void 0),this.emit(Fo.ON_NODE,void 0)}updateInput(r){if(r.context!==this.audioProcessorContext)throw new Error(`ProcessorContext passed to AudioTrack.processorDestination doesn't match it's belonging AudioTrack's context.
        Probably you are making pipeline like this: audioTrack1.pipe(processor).pipe(audioTrack2.processorDestination).`);r.track&&this.inputTrack!==r.track&&(this.audioProcessorContext.chained=!0,this.inputTrack=r.track,this.emit(Fo.ON_TRACK,this.inputTrack)),r.node&&this.inputNode!==r.node&&(this.audioProcessorContext.chained=!0,this.inputNode=r.node,this.emit(Fo.ON_NODE,this.inputNode))}}class Nz extends Fr{set chained(r){this._chained=r}get chained(){return this._chained}constructor(r,s,a){super(),Ae(this,"constraintsMap",new Map),Ae(this,"statsRegistry",[]),Ae(this,"audioContext",void 0),Ae(this,"trackId",void 0),Ae(this,"direction",void 0),Ae(this,"usageRegistry",[]),Ae(this,"_chained",!1),this.audioContext=r,this.trackId=s,this.direction=a}async getConstraints(){return ks(this,Jc.REQUEST_CONSTRAINTS)}getAudioContext(){return this.audioContext}async requestApplyConstraints(r,s){var a;return x.info("processor ".concat(s.name," requestApplyConstraints for ").concat(this.trackId)),r&&this.constraintsMap.set(s,r),hr(this,Jc.REQUEST_UPDATE_CONSTRAINTS,Array.from(Hc(a=this.constraintsMap).call(a)))}async requestRevertConstraints(r){var s;if(this.constraintsMap.has(r))return this.constraintsMap.delete(r),hr(this,Jc.REQUEST_UPDATE_CONSTRAINTS,Array.from(Hc(s=this.constraintsMap).call(s)))}registerStats(r,s,a){this.statsRegistry.find(c=>c.processorID===r.ID&&c.processorName===r.name&&c.type===s)||this.statsRegistry.push({processorName:r.name,processorID:r.ID,type:s,cb:a})}unregisterStats(r,s){const a=this.statsRegistry.findIndex(c=>c.processorID===r.ID&&c.processorName===r.name&&c.type===s);a!==-1&&this.statsRegistry.splice(a,1)}gatherStats(){const r=[];for(const{processorID:s,processorName:a,type:c,cb:u}of this.statsRegistry)try{const h=u();r.push({processorID:s,processorName:a,type:c,stats:h})}catch(h){x.error(new Me(te.UNEXPECTED_ERROR,h.message))}return r}registerUsage(r,s){this.usageRegistry.find(a=>a.processorID===r.ID&&a.processorName===r.name)||this.usageRegistry.push({processorID:r.ID,processorName:r.name,cb:s})}unregisterUsage(r){const s=this.usageRegistry.findIndex(a=>a.processorID===r.ID&&a.processorName===r.name);s!==-1&&this.usageRegistry.splice(s,1)}async gatherUsage(){const r=[];if(!this.chained)return[];for(const{cb:s}of this.usageRegistry)try{let a=s();a instanceof dt&&(a=await a),r.push(Lr(Lr({},a),{},{direction:this.direction}))}catch(a){x.error("gather extension usage error",a)}return r}getDirection(){return this.direction}}class KL extends Fr{get isPlayed(){return!0}get isFreeze(){return!1}constructor(){super(),Ae(this,"context",void 0),Ae(this,"processSourceNode",void 0),Ae(this,"outputTrack",void 0),Ae(this,"processedNode",void 0),Ae(this,"clonedTrack",void 0),Ae(this,"outputNode",void 0),this.outputNode=new Rme}setVolume(){}createOutputTrack(){throw new Me(te.NOT_SUPPORTED,"can not create output MediaStreamTrack when WebAudio disabled")}getOriginVolumeLevel(){return 0}getAccurateVolumeLevel(){return 0}stopGetAudioBuffer(){}startGetAudioBuffer(){}play(){}stop(){}destroy(){}updateTrack(){}updateOriginTrack(){}createMediaStreamSourceNode(){}}class Rme{disconnect(){}connect(){}}function Dz(t){return new dt((r,s)=>{let a=!1;const c=document.createElement("video");c.setAttribute("autoplay",""),c.setAttribute("muted",""),c.muted=!0,c.autoplay=!0,c.setAttribute("playsinline",""),c.setAttribute("style","position: fixed; top: 0; left: 0; width: 1px; height: 1px"),document.body.appendChild(c);const u=Vo()?"canplay":"playing";c.addEventListener(u,()=>{const h=c.videoWidth,m=c.videoHeight;!h&&zr()||(a=!0,c.srcObject=null,c.remove(),r([h,m]))}),c.srcObject=new MediaStream([t]),c.play().catch(ZA),setTimeout(()=>{a||(c.srcObject=null,c.remove(),r([c.videoWidth,c.videoHeight]))},4e3)})}function uP(t){const r={};t.facingMode&&(r.facingMode=t.facingMode),t.cameraId&&(r.deviceId={exact:t.cameraId});const s=wh(t.encoderConfig);return s.width!=null&&(r.width=s.width),s.height!=null&&(r.height=s.height),!k8()&&s.frameRate&&(r.frameRate=s.frameRate),T8()&&typeof r.frameRate=="object"&&(r.frameRate.max=60),zr()&&(r.frameRate={ideal:30,max:30}),r}function xz(t){const r={};return k8()||(t.AGC!==void 0&&(r.autoGainControl=t.AGC),t.AEC!==void 0&&(r.echoCancellation=t.AEC),t.ANS!==void 0&&(r.noiseSuppression=t.ANS,rp()&&t.ANS&&(r.googHighpassFilter=t.ANS))),r}function Lz(t){const r=xz(t);if(t.encoderConfig){const s=aP(t.encoderConfig);r.channelCount=s.stereo?2:1,r.sampleRate=s.sampleRate,r.sampleSize=s.sampleSize}return t.microphoneId&&(r.deviceId={exact:t.microphoneId}),XA()&&(r.sampleRate=void 0),r}const Ime=t=>{const r=t._encoderConfig;if(!r)return;const{frameRate:s,width:a,height:c}=t.getMediaStreamTrackSettings();let{frameRate:u=s,width:h=a,height:m=c}=r;if(!u||!h||!m)return;h=TL(h),m=TL(m),u=TL(u);const{max:y,min:v}=function(D,G,F){const j=200*Math.pow(F/15,.6)*Math.pow(D*G/640/360,.75);return{min:Math.floor(j),max:Math.floor(4*j)}}(h,m,u),{bitrateMax:S,bitrateMin:R}=r||{};S||x.debug("calculate bitrate: [w: ".concat(h,", h: ").concat(m,", fps: ").concat(u,"] => [brMax: ").concat(S,", brMin: ").concat(R,"]"));const{maxFramerate:P}=oe("ENCODER_CONFIG_LIMIT");return P&&typeof P=="number"&&(u=Math.min(u,P)),{frameRate:u,bitrateMax:S||y,bitrateMin:R||v,scaleResolutionDownBy:1,scale:0}},Mz=async(t,r,s)=>await(async(a,c,u)=>{const h=function(v){const S=[];for(let R=0;R<v.length;R+=2)S.push(parseInt(v.slice(R,R+2),16));return Uint8Array.from(S)}(K8(""+c+u)).slice(0,16),m=h.slice(0,12),y=await window.crypto.subtle.importKey("raw",h,"AES-GCM",!0,["encrypt"]);return new Uint8Array(await window.crypto.subtle.encrypt({name:"AES-GCM",iv:m},y,a))})(t.buffer,r,s),qL=t=>{const r=document.createElement("canvas");return r.width=2,r.height=2,new dt((s,a)=>{r.toBlob(async c=>{if(r.remove(),c){const u=await Uz(c);s({buffer:u,width:r.width,height:r.height})}else a(new Me(te.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},t,1)})},Uz=async t=>{const r=await t.arrayBuffer();return new Uint8Array(r)};var Vz,Fz,jz,Bz,Wz,zz,Gz,Hz,$z,Kz,qz,Yz,Xz,Jz,Qz,Zz,eG,tG,jr,nG,rG,iG,sG,oG,aG,Rh,cG,lG,uG,dG,hG,fG,pG,mG,gG,_G,yG,EG,vG,Ds;let Xr=(Vz=jt({argsMap:(t,r)=>[t.getTrackId(),r],throttleTime:300}),Fz=jt({argsMap:(t,r)=>[t.getTrackId(),r]}),jz=li(),Bz=Gv("LocalAudioTrack","_enabledMutex"),Wz=jt({argsMap:(t,r)=>[t.getTrackId(),r]}),zz=li(),Gz=Gv("LocalAudioTrack","_enabledMutex"),Hz=jt({argsMap:(t,r)=>[t.getTrackId(),r]}),$z=li(),Kz=li(),qz=li(),Yz=jt({argsMap:t=>[t.getTrackId()]}),Xz=li(),Jz=jt({argsMap:t=>[t.getTrackId()]}),Qz=li(),Zz=jt({argsMap:t=>[t.getTrackId()]}),eG=jt({argsMap:(t,r)=>[t.getTrackId(),r.name]}),tG=jt({argsMap:t=>[t.getTrackId()]}),Ln((jr=class extends Zv{get _source(){return this.initWebAudio()}set _source(t){this._trackSource=t}get processorContext(){return this._processorContext||(this._processorContext=this.initProcessor().processorContext),this._processorContext}get processorDestination(){return this._processorDestination||(this._processorDestination=this.initProcessor().processorDestination),this._processorDestination}get isPlaying(){return this._useAudioElement?fa.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"LocalAudioTrack"}constructor(t,r,s,a){super(t,s),Ae(this,"trackMediaType",Qv.AUDIO),Ae(this,"_encoderConfig",void 0),Ae(this,"_trackSource",void 0),Ae(this,"metadata",[]),Ae(this,"_enabled",!0),Ae(this,"_volume",100),Ae(this,"_useAudioElement",!0),Ae(this,"_bypassWebAudio",!1),Ae(this,"processor",void 0),Ae(this,"_processorContext",void 0),Ae(this,"_processorDestination",void 0),Ae(this,"_getOriginVolumeLevel",void 0),this._encoderConfig=r,this._getOriginVolumeLevel=!!a,this._trackSource=new KL,oe("DISABLE_WEBAUDIO")&&(this._bypassWebAudio=!0),oe("LOCAL_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1),Ps()&&!Qc?setTimeout(()=>this.initWebAudio()):this.initWebAudio()}setVolume(t){or(t,"volume",0,1e3),this._volume=t,this._source.setVolume(t/100),this._useAudioElement&&fa.setVolume(this.getTrackId(),t);try{if(this._bypassWebAudio)return void x.debug("[".concat(this.getTrackId(),"] setVolume returned because no pass through WebAudio."));const r=this._source.createOutputTrack();this._mediaStreamTrack!==r&&(this._mediaStreamTrack=r,hr(this,Tt.NEED_REPLACE_TRACK,this).then(()=>{x.debug("[".concat(this.getTrackId(),"] replace web audio track success"))}).catch(s=>{x.warning("[".concat(this.getTrackId(),"] replace web audio track failed"),s)}))}catch{}}getVolumeLevel(){return this._muted&&this.enabled&&this._getOriginVolumeLevel?this._source.getOriginVolumeLevel():this._source.getAccurateVolumeLevel()}async setPlaybackDevice(t){if(!this._useAudioElement||!hz())throw new Me(te.NOT_SUPPORTED,"your browser does not support setting the audio output device");await fa.setSinkID(this.getTrackId(),t)}async setEnabled(t,r,s){return this._setEnabled(t,r,s)}async _setEnabled(t,r,s){if(!s){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(x.info("[".concat(this.getTrackId(),"] start setEnabled"),t),t){this._originMediaStreamTrack.enabled=!0;try{s||(this._enabled=!0),await hr(this,Tt.NEED_ENABLE_TRACK,this),x.info("[".concat(this.getTrackId(),"] setEnabled to ").concat(t," success"))}catch(a){throw s||(this._enabled=!1),x.error("[".concat(this.getTrackId(),"] setEnabled to true error"),a.toString()),a}}else{this._originMediaStreamTrack.enabled=!1,s||(this._enabled=!1);try{await hr(this,Tt.NEED_DISABLE_TRACK,this)}catch(a){throw s||(this._enabled=!0),x.error("[".concat(this.getTrackId(),"] setEnabled to false error"),a.toString()),a}}}async setMuted(t){t!==this._muted&&(this.stateCheck("muted",t),this._muted=t,this._originMediaStreamTrack.enabled=!t,x.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(t)),t?await hr(this,Tt.NEED_MUTE_TRACK,this):await hr(this,Tt.NEED_UNMUTE_TRACK,this))}getStats(){return Gm(()=>{x.warning("[deprecated] LocalAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalAudioStats instead")},"localAudioTrackGetStatsWarning"),Kc(this,Tt.GET_STATS)||Lr({},jL)}setAudioFrameCallback(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!t)return this._source.removeAllListeners(Xc.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(r),this._source.removeAllListeners(Xc.ON_AUDIO_BUFFER),this._source.on(Xc.ON_AUDIO_BUFFER,s=>t(s))}play(){x.debug("[".concat(this.getTrackId(),"] start audio playback")),this._useAudioElement?(x.debug("[".concat(this.getTrackId(),"] start audio playback in element")),fa.play(this._mediaStreamTrack,this.getTrackId(),this._volume)):this._source.play()}stop(){x.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._useAudioElement?fa.stop(this.getTrackId()):this._source.stop()}close(){super.close(),this._processorDestination&&this.unbindProcessorDestinationEvents(this._processorDestination),this._processorContext&&this.unbindProcessorContextEvents(this._processorContext),this.unpipe(),this._processorDestination&&this._processorDestination._source&&this._processorDestination._source.unpipe(),this._source.destroy()}_updatePlayerSource(){let t=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];x.debug("[".concat(this.getTrackId(),"] update player source track")),t&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&fa.updateTrack(this.getTrackId(),this._mediaStreamTrack)}async _updateOriginMediaStreamTrack(t,r){this._originMediaStreamTrack!==t&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),r&&this._originMediaStreamTrack.stop()),t.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=t,this._muted&&(this._originMediaStreamTrack.enabled=!1),this.processor&&this._processorContext&&this.processor.updateInput({track:t,context:this._processorContext}),this._mediaStreamTrack!==this._source.outputTrack?(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await hr(this,Tt.NEED_REPLACE_TRACK,this)):this._source.updateTrack(this._originMediaStreamTrack),this._getOriginVolumeLevel&&this._source.updateOriginTrack(t))}renewMediaStreamTrack(t){return dt.resolve(void 0)}pipe(t){if(this._bypassWebAudio)throw new Me(te.INVALID_OPERATION,"Can not process AudioTrack when bypassWebAudio set to true.");if(this.processor===t)return t;if(t._source)throw new Me(te.INVALID_OPERATION,"Processor ".concat(t.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=t,this.processor._source=this,t.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),t}unpipe(){var t;if(!this.processor)return;const r=this.processor;(t=this._source.processSourceNode)===null||t===void 0||t.disconnect(),this.processor._source=!1,this.processor=void 0,r.reset()}bindProcessorDestinationEvents(t){t.on(Fo.ON_TRACK,async r=>{r?r!==this._mediaStreamTrack&&(this._mediaStreamTrack=r,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(r),await hr(this,Tt.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await hr(this,Tt.NEED_REPLACE_TRACK,this))}),t.on(Fo.ON_NODE,r=>{this._source.processedNode=r})}unbindProcessorDestinationEvents(t){t.removeAllListeners(Fo.ON_TRACK),t.removeAllListeners(Fo.ON_NODE)}bindProcessorContextEvents(t){t.on(Jc.REQUEST_CONSTRAINTS,async r=>{r(this._originMediaStreamTrack.getSettings())})}unbindProcessorContextEvents(t){t.removeAllListeners(Jc.REQUEST_CONSTRAINTS)}initWebAudio(){return this._trackSource instanceof KL&&(this._trackSource=new bz(this._mediaStreamTrack,!1,this._getOriginVolumeLevel?this._mediaStreamTrack:void 0)),this._trackSource}initProcessor(){const t=new Nz(this._source.context,this.getTrackId(),"local"),r=new kz(t);return this._processorContext=t,this._processorDestination=r,this.bindProcessorContextEvents(t),this.bindProcessorDestinationEvents(r),this._source.on(Xc.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:t})}),this._useAudioElement&&(this._useAudioElement=!1,this.isPlaying&&(fa.stop(this.getTrackId()),this._source.play()),hr(this,Tt.NEED_REPLACE_MIXING_TRACK,this).then(()=>{x.debug("[".concat(this.getTrackId(),"] replace from origin track to web audio track success"))}).catch(s=>{x.warning("[".concat(this.getTrackId(),"] replace from origin track to web audio track failed"),s)})),{processorContext:t,processorDestination:r}}}).prototype,"setVolume",[Vz],Object.getOwnPropertyDescriptor(jr.prototype,"setVolume"),jr.prototype),Ln(jr.prototype,"setPlaybackDevice",[Fz,jz],Object.getOwnPropertyDescriptor(jr.prototype,"setPlaybackDevice"),jr.prototype),Ln(jr.prototype,"setEnabled",[Bz,Wz,zz],Object.getOwnPropertyDescriptor(jr.prototype,"setEnabled"),jr.prototype),Ln(jr.prototype,"setMuted",[Gz,Hz,$z],Object.getOwnPropertyDescriptor(jr.prototype,"setMuted"),jr.prototype),Ln(jr.prototype,"getStats",[Kz],Object.getOwnPropertyDescriptor(jr.prototype,"getStats"),jr.prototype),Ln(jr.prototype,"setAudioFrameCallback",[qz],Object.getOwnPropertyDescriptor(jr.prototype,"setAudioFrameCallback"),jr.prototype),Ln(jr.prototype,"play",[Yz,Xz],Object.getOwnPropertyDescriptor(jr.prototype,"play"),jr.prototype),Ln(jr.prototype,"stop",[Jz,Qz],Object.getOwnPropertyDescriptor(jr.prototype,"stop"),jr.prototype),Ln(jr.prototype,"close",[Zz],Object.getOwnPropertyDescriptor(jr.prototype,"close"),jr.prototype),Ln(jr.prototype,"pipe",[eG],Object.getOwnPropertyDescriptor(jr.prototype,"pipe"),jr.prototype),Ln(jr.prototype,"unpipe",[tG],Object.getOwnPropertyDescriptor(jr.prototype,"unpipe"),jr.prototype),jr),dP=(nG=jt({argsMap:(t,r)=>[t.getTrackId(),r]}),rG=li(),iG=Gv("MicrophoneAudioTrack","_enabledMutex"),sG=jt({argsMap:(t,r,s)=>[t.getTrackId(),r,s]}),oG=li(),aG=jt({argsMap:t=>[t.getTrackId()]}),Ln((Rh=class extends Xr{get __className__(){return"MicrophoneAudioTrack"}constructor(t,r,s,a){super(t,r.encoderConfig?aP(r.encoderConfig):{},a,oe("GET_VOLUME_OF_MUTED_AUDIO_TRACK")),Ae(this,"_config",void 0),Ae(this,"_deviceName","default"),Ae(this,"_constraints",void 0),Ae(this,"_originalConstraints",void 0),Ae(this,"_enabled",!0),this._config=r,this._constraints=s,this._originalConstraints=s,this._deviceName=t.label,typeof r.bypassWebAudio=="boolean"&&(this._bypassWebAudio=r.bypassWebAudio),(Bv()||mL())&&ir.bindInterruptDetectorTrack(this)}async setDevice(t){if(x.info("[".concat(this.getTrackId(),"] start set device to ").concat(t)),this._enabled)try{const r=await el.getDeviceById(t),s={};s.audio=Lr({},this._constraints),s.audio.deviceId={exact:t},this._originMediaStreamTrack.stop();let a=null;try{a=await Zc(s,this.getTrackId())}catch(c){throw x.error("[".concat(this.getTrackId(),"] setDevice failed"),c.toString()),a=await Zc({audio:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(a.getAudioTracks()[0],!1),c}await this._updateOriginMediaStreamTrack(a.getAudioTracks()[0],!1),this._deviceName=r.label,this._config.microphoneId=t,this._constraints.deviceId={exact:t}}catch(r){throw x.error("[".concat(this.getTrackId(),"] setDevice error"),r.toString()),r}else try{const r=await el.getDeviceById(t);this._deviceName=r.label,this._config.microphoneId=t,this._constraints.deviceId={exact:t}}catch(r){throw x.error("[".concat(this.getTrackId(),"] setDevice error"),r.toString()),r}x.info("[".concat(this.getTrackId(),"] set device to ").concat(t," success"))}async setEnabled(t,r,s){if(r)return x.debug("[".concat(this.getTrackId(),"] setEnabled false (do not close microphone)")),await super._setEnabled(t);if(!s){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(x.info("[".concat(this.getTrackId(),"] start setEnabled"),t),oe("AUTO_RESET_AUDIO_ROUTE")&&(Vo()||Su())){const h=navigator.audioSession;h&&(t||(h.type="playback"),h.type="auto")}if(!t){var a;this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop(),(a=this._source.clonedTrack)===null||a===void 0||a.stop(),s||(this._enabled=!1);try{await hr(this,Tt.NEED_DISABLE_TRACK,this)}catch(h){throw x.error("[".concat(this.getTrackId(),"] setEnabled false failed"),h.toString()),h}return}const c=Lr({},this._constraints),u=el.searchDeviceIdByName(this._deviceName);u&&!c.deviceId&&(c.deviceId=u);try{s||(this._enabled=!0);const h=await Zc({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(h.getAudioTracks()[0],!1),await hr(this,Tt.NEED_ENABLE_TRACK,this)}catch(h){throw s||(this._enabled=!1),x.error("[".concat(this.getTrackId(),"] setEnabled true failed"),h.toString()),h}x.info("[".concat(this.getTrackId(),"] setEnabled success"))}close(){super.close(),(Bv()||mL())&&ir.unbindInterruptDetectorTrack(this)}onTrackEnded(){if((Vo()||Su())&&this._enabled&&!this._isClosed&&ir.duringInterruption){const t=async()=>{ir.off(gs.IOS_INTERRUPTION_END,t),this._enabled&&!this._isClosed&&(x.debug("[".concat(this.getTrackId(),"] try capture microphone media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};ir.on(gs.IOS_INTERRUPTION_END,t)}else x.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(Xv.TRACK_ENDED)}async renewMediaStreamTrack(t){const r=t||this._constraints,s=el.searchDeviceIdByName(this._deviceName);if(s&&!r.deviceId&&(r.deviceId=s),this._constraints=r,this._enabled){this._originMediaStreamTrack.stop();const a=await Zc({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(a.getAudioTracks()[0],!0)}}bindProcessorContextEvents(t){super.bindProcessorContextEvents(t),t.on(Jc.REQUEST_UPDATE_CONSTRAINTS,async(r,s,a)=>{try{const c=Object.assign({},this._originalConstraints,...r);await this.renewMediaStreamTrack(c),s()}catch(c){a(c)}})}unbindProcessorContextEvents(t){super.unbindProcessorContextEvents(t),t.removeAllListeners(Jc.REQUEST_UPDATE_CONSTRAINTS)}}).prototype,"setDevice",[nG,rG],Object.getOwnPropertyDescriptor(Rh.prototype,"setDevice"),Rh.prototype),Ln(Rh.prototype,"setEnabled",[iG,sG,oG],Object.getOwnPropertyDescriptor(Rh.prototype,"setEnabled"),Rh.prototype),Ln(Rh.prototype,"close",[aG],Object.getOwnPropertyDescriptor(Rh.prototype,"close"),Rh.prototype),Rh),Ame=(cG=jt({argsMap:(t,r)=>[t.getTrackId(),r,t.duration]}),lG=li(),uG=jt({argsMap:t=>[t.getTrackId()]}),dG=li(),hG=jt({argsMap:t=>[t.getTrackId()]}),fG=li(),pG=jt({argsMap:t=>[t.getTrackId()]}),mG=li(),gG=jt({argsMap:t=>[t.getTrackId()]}),_G=li(),yG=jt({argsMap:t=>[t.getTrackId()]}),EG=jt({argsMap:t=>[t.getTrackId()]}),vG=li(),Ln((Ds=class extends Xr{get __className__(){return"BufferSourceAudioTrack"}constructor(t,r,s,a){super(r.createOutputTrack(),s,a),Ae(this,"source",void 0),Ae(this,"_bufferSource",void 0),this._useAudioElement=!1,this.source=t,this._bufferSource=r,this._bufferSource.on(Xc.AUDIO_SOURCE_STATE_CHANGE,c=>{this.safeEmit(Xv.SOURCE_STATE_CHANGE,c)});try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}}get currentState(){return this._bufferSource.currentState}get duration(){return this._bufferSource.duration}get playbackSpeed(){return this._bufferSource.playbackSpeed}getCurrentTime(){return this._bufferSource.currentTime}startProcessAudioBuffer(t){t&&this._bufferSource.updateOptions(t),this._bufferSource.startProcessAudioBuffer()}pauseProcessAudioBuffer(){this._bufferSource.pauseProcessAudioBuffer()}seekAudioBuffer(t){this._bufferSource.seekAudioBuffer(t)}resumeProcessAudioBuffer(){this._bufferSource.resumeProcessAudioBuffer()}stopProcessAudioBuffer(){this._bufferSource.stopProcessAudioBuffer()}close(){this.source=null,this._bufferSource.destroy(),super.close()}setAudioBufferPlaybackSpeed(t){or(t,"speed",0),this._bufferSource.setAudioBufferPlaybackSpeed(t)}}).prototype,"startProcessAudioBuffer",[cG,lG],Object.getOwnPropertyDescriptor(Ds.prototype,"startProcessAudioBuffer"),Ds.prototype),Ln(Ds.prototype,"pauseProcessAudioBuffer",[uG,dG],Object.getOwnPropertyDescriptor(Ds.prototype,"pauseProcessAudioBuffer"),Ds.prototype),Ln(Ds.prototype,"seekAudioBuffer",[hG,fG],Object.getOwnPropertyDescriptor(Ds.prototype,"seekAudioBuffer"),Ds.prototype),Ln(Ds.prototype,"resumeProcessAudioBuffer",[pG,mG],Object.getOwnPropertyDescriptor(Ds.prototype,"resumeProcessAudioBuffer"),Ds.prototype),Ln(Ds.prototype,"stopProcessAudioBuffer",[gG,_G],Object.getOwnPropertyDescriptor(Ds.prototype,"stopProcessAudioBuffer"),Ds.prototype),Ln(Ds.prototype,"close",[yG],Object.getOwnPropertyDescriptor(Ds.prototype,"close"),Ds.prototype),Ln(Ds.prototype,"setAudioBufferPlaybackSpeed",[EG,vG],Object.getOwnPropertyDescriptor(Ds.prototype,"setAudioBufferPlaybackSpeed"),Ds.prototype),Ds);class Fi extends Xr{get __className__(){return"MixingAudioTrack"}get isActive(){for(const r of this.trackList)if(r._enabled&&!r._isClosed&&!r.muted)return!0;return!1}constructor(){const r=eS().createMediaStreamDestination();super(r.stream.getAudioTracks()[0],void 0,fr(8,"track-mix-")),Ae(this,"trackList",void 0),Ae(this,"destNode",void 0),this._useAudioElement=!1;try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}this.destNode=r,this.trackList=[]}hasAudioTrack(r){return this.trackList.indexOf(r)!==-1}addAudioTrack(r){this.trackList.indexOf(r)===-1?(x.debug("add ".concat(r.getTrackId()," to mixing track")),r._source.outputNode.connect(this.destNode),this.trackList.push(r),this.updateEncoderConfig()):x.debug("track ".concat(r.getTrackId()," is already added"))}removeAudioTrack(r){if(this.trackList.indexOf(r)!==-1){x.debug("remove ".concat(r.getTrackId()," from mixing track"));try{r._source.outputNode.disconnect(this.destNode)}catch{}JA(this.trackList,r),this.updateEncoderConfig()}}updateEncoderConfig(){const r={};this.trackList.forEach(s=>{s._encoderConfig&&((s._encoderConfig.bitrate||0)>(r.bitrate||0)&&(r.bitrate=s._encoderConfig.bitrate),(s._encoderConfig.sampleRate||0)>(r.sampleRate||0)&&(r.sampleRate=s._encoderConfig.sampleRate),(s._encoderConfig.sampleSize||0)>(r.sampleSize||0)&&(r.sampleSize=s._encoderConfig.sampleSize),s._encoderConfig.stereo&&(r.stereo=!0))}),this._encoderConfig=r}_updateRtpTransceiver(r){this._rtpTransceiver!==r&&(this._rtpTransceiver=r,this.trackList.forEach(s=>{s instanceof Fi?s.emit(H_.TRANSCEIVER_UPDATED,r):s._updateRtpTransceiver(r)}))}}class Pme extends Sz{set currentState(r){r!==this._currentState&&(this._currentState=r,this.safeEmit(Xc.AUDIO_SOURCE_STATE_CHANGE,this._currentState))}get currentState(){return this._currentState}constructor(r){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),Ae(this,"audioBuffer",void 0),Ae(this,"sourceNode",void 0),Ae(this,"startPlayTime",0),Ae(this,"startPlayOffset",0),Ae(this,"pausePlayTime",0),Ae(this,"options",void 0),Ae(this,"currentLoopCount",0),Ae(this,"currentPlaybackSpeed",100),Ae(this,"_currentState","stopped"),this.audioBuffer=r,this.options=s,this.startPlayOffset=this.options.startPlayTime||0}createWebAudioDiagram(){return this.context.createGain()}get duration(){return this.audioBuffer?this.audioBuffer.duration:0}get playbackSpeed(){return this.currentPlaybackSpeed}get currentTime(){return this.audioBuffer?this.currentState==="stopped"?0:this.currentState==="paused"?this.pausePlayTime:((this.context.currentTime-this.startPlayTime)*(this.playbackSpeed/100)+this.startPlayOffset)%this.audioBuffer.duration:0}updateOptions(r){this.currentState==="stopped"?(this.options=r,this.startPlayOffset=this.options.startPlayTime||0):x.warning("can not set audio source options")}startProcessAudioBuffer(){this.sourceNode&&this.stopProcessAudioBuffer(),this.sourceNode=this.createSourceNode(),this.startSourceNode(),this.currentState="playing"}pauseProcessAudioBuffer(){this.sourceNode&&this.currentState==="playing"&&(this.pausePlayTime=this.currentTime,this.sourceNode.onended=null,this.sourceNode.stop(),this.sourceNode.buffer=null,this.sourceNode=this.createSourceNode(),this.currentState="paused")}seekAudioBuffer(r){this.sourceNode&&(this.sourceNode.onended=null,this.currentState==="playing"&&this.sourceNode.stop(),this.sourceNode=this.createSourceNode(),this.currentState==="playing"?(this.startPlayOffset=r,this.startSourceNode()):this.currentState==="paused"&&(this.pausePlayTime=r))}resumeProcessAudioBuffer(){this.currentState==="paused"&&this.sourceNode&&(this.startPlayOffset=this.pausePlayTime,this.pausePlayTime=0,this.startSourceNode(),this.currentState="playing")}stopProcessAudioBuffer(){if(this.sourceNode){this.sourceNode.onended=null;try{this.sourceNode.stop()}catch{}this.reset()}}destroy(){this.audioBuffer=null,super.destroy()}setAudioBufferPlaybackSpeed(r){this.sourceNode&&(this.currentState==="playing"&&(this.startPlayOffset=this.currentTime,this.startPlayTime=this.context.currentTime),this.sourceNode.playbackRate.value=r/100),this.currentPlaybackSpeed=r}startSourceNode(){this.sourceNode&&this.sourceNode.buffer&&(this.sourceNode.start(0,this.startPlayOffset),this.startPlayTime=this.context.currentTime,this.sourceNode.onended=this.handleSourceNodeEnded.bind(this))}createSourceNode(){const r=this.context.createBufferSource();return r.buffer=this.audioBuffer,r.loop=!!this.options.loop,r.connect(this.outputNode),r.playbackRate.value=this.currentPlaybackSpeed/100,r}handleSourceNodeEnded(){if(this.currentLoopCount+=1,this.options.cycle&&this.options.cycle>this.currentLoopCount)return this.startPlayOffset=0,this.sourceNode=void 0,void this.startProcessAudioBuffer();this.reset()}reset(){this.startPlayOffset=this.options.startPlayTime||0,this.currentState="stopped",this.sourceNode&&(this.sourceNode.disconnect(),this.sourceNode=void 0),this.currentLoopCount=0}}const SG=new Map;class YL{get rendFrameRate(){if(this.renderStats&&this.renderStats.curTs!==this.renderStats.lastTs){const r=this.renderStats.curTs-this.renderStats.lastTs,s=(this.renderStats.renderNum-this.renderStats.lastRenderNum)/r;return this.renderStats.lastRenderNum=this.renderStats.renderNum,this.renderStats.lastTs=this.renderStats.curTs,s}return 0}get videoElementStatus(){return this._videoElementStatus}set videoElementStatus(r){r!==this._videoElementStatus&&(x.debug("[".concat(this.trackId,"] video-element-status change ").concat(this._videoElementStatus," => ").concat(r)),this._videoElementStatus=r)}get videoState(){return this._videoState}set videoState(r){var s;r!==this._videoState&&(this._videoState=r,(s=this.onVideoStateChanged)===null||s===void 0||s.call(this,this.videoState))}constructor(r){Ae(this,"trackId",void 0),Ae(this,"config",void 0),Ae(this,"onFirstVideoFrameDecoded",void 0),Ae(this,"onVideoStateChanged",void 0),Ae(this,"freezeTimeCounterList",[]),Ae(this,"renderFreezeAccTime",0),Ae(this,"isKeepLastFrame",!1),Ae(this,"timeUpdatedCount",0),Ae(this,"freezeTime",0),Ae(this,"playbackTime",0),Ae(this,"lastTimeUpdatedTime",0),Ae(this,"autoplayFailed",!1),Ae(this,"videoTrack",void 0),Ae(this,"videoElement",void 0),Ae(this,"cacheVideoElement",void 0),Ae(this,"renderStats",void 0),Ae(this,"_videoState",Ch.VideoStateStopped),Ae(this,"videoElementCheckInterval",void 0),Ae(this,"videoElementFreezeTimeout",void 0),Ae(this,"_videoElementStatus",yo.NONE),Ae(this,"isGettingVideoDimensions",!1),Ae(this,"startGetVideoDimensions",()=>{const s=()=>{if(this.isGettingVideoDimensions=!0,this.videoElement.videoWidth*this.videoElement.videoHeight>4)return x.debug("[".concat(this.trackId,"] current video dimensions:"),this.videoElement.videoWidth,this.videoElement.videoHeight),void(this.isGettingVideoDimensions=!1);setTimeout(s,500)};!this.isGettingVideoDimensions&&s()}),Ae(this,"autoResumeAfterInterruption",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&ir.curState==="running"&&(x.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(b8())),P8()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),Ae(this,"handleVideoEvents",s=>{switch(s.type){case"play":case"playing":this.startGetVideoDimensions(),this.videoElementStatus=yo.PLAYING;break;case"loadeddata":if(this.videoState=Ch.VideoStateStarting,this.onFirstVideoFrameDecoded&&this.onFirstVideoFrameDecoded(),this.cacheVideoElement){try{this.cacheVideoElement.srcObject=null,this.cacheVideoElement.remove()}catch{}this.cacheVideoElement=void 0}break;case"canplay":this.videoElementStatus=yo.CANPLAY;break;case"stalled":this.videoElementStatus=yo.STALLED;break;case"suspend":this.videoElementStatus=yo.SUSPEND;break;case"pause":this.videoElementStatus=yo.PAUSED,Vo()||Su()||Ps()&&this.autoplayFailed||!this.videoTrack||this.videoTrack.readyState!=="live"||(x.debug("[track-".concat(this.trackId,"] video element paused, auto resume")),this.videoElement.play());break;case"waiting":this.videoElementStatus=yo.WAITING;break;case"abort":this.videoElementStatus=yo.ABORT;break;case"ended":this.videoElementStatus=yo.ENDED;break;case"emptied":this.videoElementStatus=yo.EMPTIED;break;case"error":{const a=this.videoElement.error;a&&(this.videoElementStatus=yo.ERROR,x.error("[".concat(this.trackId,"] media error: ").concat(a.message," (").concat(a.code,")")));break}case"timeupdate":{const a=performance.now();if(this.timeUpdatedCount+=1,this.timeUpdatedCount<10)return void(this.lastTimeUpdatedTime=a);const c=a-this.lastTimeUpdatedTime,u=this.lastTimeUpdatedTime;if(this.lastTimeUpdatedTime=a,ap.lastVisibleTime<ap.lastHiddenTime||u<ap.lastHiddenTime||u<ap.lastVisibleTime)return;for(c>oe("VIDEO_FREEZE_DURATION")&&(this.freezeTime+=c),this.playbackTime+=c;this.playbackTime>=6e3;){this.playbackTime-=6e3;const h=Math.min(6e3,this.freezeTime);this.freezeTimeCounterList.push(h),this.freezeTime=Math.max(0,this.freezeTime-6e3)}break}}}),Ae(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&(x.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(b8())),P8()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),this.trackId=r.trackId,this.config=r,r.element instanceof HTMLVideoElement?this.videoElement=r.element:this.videoElement=document.createElement("video"),ir.on(gs.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),ir.on(gs.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16)}getVideoElement(){return this.videoElement}getContainerElement(){var r;return(r=this.videoElement.parentElement)!==null&&r!==void 0?r:void 0}updateConfig(r){this.config=r,this.trackId=r.trackId,r.element!==this.videoElement&&(this.destroy(),this.videoElement=r.element),this.videoTrack&&this.initVideoElement()}updateVideoTrack(r){this.videoTrack!==r&&(this.videoTrack=r,this.initVideoElement())}play(r){const s=this.videoElement.play();s&&s.catch&&s.catch(c=>{r&&Az(r,"video",c.message,this.trackId),c.name==="NotAllowedError"?(x.warning("detected video element autoplay failed",c),this.autoplayFailed=!0,this.handleAutoPlayFailed()):x.warning("[".concat(this.trackId,"] play warning: "),c)});const a=Dn();if((a.name==="Safari"&&Number(a.version)===15||Bv())&&s&&s.then){const c=()=>{this.config.mirror&&(this.videoElement.style.transform="rotateY(180deg)")};s.then(c).catch(c)}}getCurrentFrame(){const r=document.createElement("canvas");r.width=this.videoElement.videoWidth,r.height=this.videoElement.videoHeight;const s=r.getContext("2d");if(!s)return x.error("create canvas context failed!"),new ImageData(2,2);s.drawImage(this.videoElement,0,0,r.width,r.height);const a=s.getImageData(0,0,r.width,r.height);return r.remove(),a}async getCurrentFrameToUint8Array(r){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;const a=document.createElement("canvas");a.width=this.videoElement.videoWidth,a.height=this.videoElement.videoHeight;const c=a.getContext("2d");return c?(c.drawImage(this.videoElement,0,0,a.width,a.height),new dt((u,h)=>{a.toBlob(async m=>{if(a.remove(),m){const y=await Uz(m);u({buffer:y,width:a.width,height:a.height})}else h(new Me(te.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},r,s<0?.1:s>1?1:s)})):await qL(r)}destroy(){this.renderStats=void 0,ir.off(gs.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),ir.off(gs.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),this.videoElement.srcObject=null,this.resetVideoElement(),this.freezeTimeCounterList=[],this.videoState=Ch.VideoStateStopped}initVideoElement(){if(this.videoElementStatus=yo.INIT,!this.videoElementCheckInterval&&(bG.forEach(u=>{this.videoElement.addEventListener(u,this.handleVideoEvents)}),this.videoElementCheckInterval=window.setInterval(()=>{(function(u){return u!==document.body&&document.body.contains(u)})(this.videoElement)||(this.videoElementStatus=yo.DESTROYED)},1e3),oe("ENABLE_VIDEO_FRAME_CALLBACK"))){var r,s;let u;const h=()=>{document.visibilityState==="visible"&&(document.removeEventListener("visibilitychange",h),this.videoElementFreezeTimeout=window.setTimeout(m,oe("VIDEO_FREEZE_DURATION")))},m=()=>{this.videoElementFreezeTimeout=void 0,this.videoState===Ch.VideoStateDecoding&&(document.visibilityState==="visible"?this.videoState=Ch.VideoStateFrozen:document.addEventListener("visibilitychange",h))},y=(v,S)=>{if(this.videoElementStatus===yo.PLAYING){if(this.renderStats?(this.renderStats.renderNum++,this.renderStats.curTs=S.mediaTime):this.renderStats={lastTs:S.mediaTime,curTs:S.mediaTime,lastRenderNum:0,renderNum:0},u){const D=S.presentationTime-u.presentationTime;this.videoState===Ch.VideoStateStarting&&(this.videoState=Ch.VideoStateDecoding),this.videoState===Ch.VideoStateDecoding&&this.onVideoStateChanged&&(this.videoElementFreezeTimeout&&window.clearTimeout(this.videoElementFreezeTimeout),this.videoElementFreezeTimeout=window.setTimeout(m,oe("VIDEO_FREEZE_DURATION"))),D<oe("VIDEO_FREEZE_DURATION")&&this.videoState===Ch.VideoStateFrozen&&(this.videoState=Ch.VideoStateDecoding),D>oe("VIDEO_FREEZE_DURATION")&&ap.lastVisibleTime>=ap.lastHiddenTime&&u.timestamp>ap.lastVisibleTime&&u.timestamp>ap.lastHiddenTime&&(this.renderFreezeAccTime+=D)}u=Lr(Lr({},S),{},{timestamp:v})}var R,P;oe("ENABLE_VIDEO_FRAME_CALLBACK")&&((R=(P=this.videoElement).requestVideoFrameCallback)===null||R===void 0||R.call(P,y))};(r=(s=this.videoElement).requestVideoFrameCallback)===null||r===void 0||r.call(s,y)}this.videoElement.controls=!1,this.videoElement.setAttribute("playsinline",""),XA()&&!oe("HIDE_NO_POSTER")&&(this.videoElement.poster="noposter");const a=Dn();a.name==="Safari"&&Number(a.version)===15||Bv()||!this.config.mirror||(this.videoElement.style.transform="rotateY(180deg)"),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover",this.videoElement.setAttribute("muted",""),this.videoElement.muted=!0,this.videoElement.srcObject&&this.videoElement.srcObject instanceof MediaStream?this.videoElement.srcObject.getVideoTracks()[0]!==this.videoTrack&&(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,zr()&&this.videoElement.load()):(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,zr()&&this.videoElement.load());const c=this.videoElement.play();c!==void 0&&c.catch(u=>{x.debug("[".concat(this.trackId,"] playback interrupted"),u.toString())})}resetVideoElement(){bG.forEach(r=>{this.videoElement&&this.videoElement.removeEventListener(r,this.handleVideoEvents)}),this.videoElementCheckInterval&&(window.clearInterval(this.videoElementCheckInterval),this.videoElementCheckInterval=void 0),this.videoElementStatus=yo.NONE}handleAutoPlayFailed(){const r=s=>{s.preventDefault(),this.videoElement.play().then(()=>{x.debug("[".concat(this.trackId,"] Video element for trackId:").concat(this.trackId," autoplay resumed."))}).catch(a=>{x.error(a)}),this.autoplayFailed=!1,IT()?document.body.removeEventListener("click",r,!0):(document.body.removeEventListener("touchstart",r,!0),document.body.removeEventListener("mousedown",r,!0))};IT()?document.body.addEventListener("click",r,!0):(document.body.addEventListener("touchstart",r,!0),document.body.addEventListener("mousedown",r,!0)),Iz()}}const bG=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","timeupdate","error"];class TG extends YL{constructor(r){super(r),Ae(this,"container",void 0),Ae(this,"slot",void 0),this.slot=r.element,this.updateConfig(r)}updateConfig(r){this.config=r,this.trackId=r.trackId;const s=r.element;s!==this.slot&&(this.destroy(),this.slot=s),this.createElements()}updateVideoTrack(r){this.videoTrack!==r&&(this.videoTrack=r,this.createElements())}play(r){var s;(s=this.container)!==null&&s!==void 0&&s.contains(this.videoElement)&&super.play(r)}getCurrentFrame(){var r;return(r=this.container)!==null&&r!==void 0&&r.contains(this.videoElement)?super.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameToUint8Array(r){var s;let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return(s=this.container)!==null&&s!==void 0&&s.contains(this.videoElement)?await super.getCurrentFrameToUint8Array(r,a):await qL(r)}destroy(){if(super.destroy(),this.videoElement.remove(),this.videoElement=document.createElement("video"),this.container){try{this.container.remove(),this.slot.removeChild(this.container)}catch{}this.container=void 0}}createElements(){this.container||(this.container=document.createElement("div")),this.container.id="agora-video-player-".concat(this.trackId),this.container.style.width="100%",this.container.style.height="100%",this.container.style.position="relative",this.container.style.overflow="hidden",this.videoTrack?(this.container.style.backgroundColor="black",oe("KEEP_LAST_FRAME")&&this.isKeepLastFrame&&this.videoElement.paused&&this.resetVideoElement(),this.mountedVideoElement()):this.unmountedVideoElement(),this.slot.appendChild(this.container)}mountedVideoElement(){var r;!this.container||(r=this.container)!==null&&r!==void 0&&r.contains(this.videoElement)||this.container.appendChild(this.videoElement),super.initVideoElement(),this.videoElement.id="video_".concat(this.trackId),this.videoElement.className="agora_video_player",this.videoElement.style.width="100%",this.videoElement.style.height="100%",this.videoElement.style.position="absolute",this.videoElement.style.left="0",this.videoElement.style.top="0"}unmountedVideoElement(){var r;if((r=this.container)!==null&&r!==void 0&&r.contains(this.videoElement)){super.resetVideoElement();try{this.container&&this.container.removeChild(this.videoElement)}catch{}this.videoElement=document.createElement("video")}}resetVideoElement(){var r;(r=this.container)!==null&&r!==void 0&&r.contains(this.videoElement)&&(super.resetVideoElement(),this.cacheVideoElement=this.videoElement,this.videoElement=document.createElement("video"))}getContainerElement(){return this.container}}var wG,CG,RG,IG,AG,PG,OG,kG,NG,DG,xG,LG,MG,UG,VG,FG,jG,BG,WG,zG,GG,HG,$G,KG,Pn,qG,YG,XG,JG,QG,ZG,eH,tH,nl;let Tr=(wG=jt({argsMap:(t,r,s)=>[t.getTrackId(),typeof r=="string"?r:r instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",s]}),CG=li(),RG=jt({argsMap:t=>[t.getTrackId()]}),IG=Gv("LocalVideoTrack","_enabledMutex"),AG=jt({argsMap:(t,r)=>[t.getTrackId(),r]}),PG=li(),OG=Gv("LocalVideoTrack","_enabledMutex"),kG=jt({argsMap:(t,r)=>[t.getTrackId(),r]}),NG=li(),DG=jt({argsMap:(t,r)=>[t.getTrackId(),r]}),xG=li(),LG=li(),MG=jt({argsMap:(t,r,s)=>[t.getTrackId(),r,s]}),UG=li(),VG=li(),FG=li(),jG=li(),BG=li(),WG=li(),zG=li(),GG=jt({argsMap:(t,r)=>[t.getTrackId(),r.name]}),HG=jt({argsMap:t=>[t.getTrackId()]}),$G=jt({argsMap:t=>[t.getTrackId()]}),KG=jt({argsMap:(t,r,s)=>[t.getTrackId(),r.label,s]}),Pn=class uae extends Zv{get videoHeight(){if(Ps()){const{height:r}=this._mediaStreamTrack.getSettings();return this._videoHeight=r,this._videoHeight}return this._videoHeight}get videoWidth(){if(Ps()){const{width:r}=this._mediaStreamTrack.getSettings();return this._videoWidth=r,this._videoWidth}return this._videoWidth}get isPlaying(){return!(!this._player||this._player.videoElementStatus!==yo.PLAYING)}get processorDestination(){return this._processorDestination}get processorContext(){return this._processorContext}set processorContext(r){this._processorContext=r}get __className__(){return"LocalVideoTrack"}constructor(r,s,a,c,u,h){if(super(r,u),Ae(this,"trackMediaType",Qv.VIDEO),Ae(this,"_player",void 0),Ae(this,"isUseScaleResolutionDownBy",!1),Ae(this,"_videoVisibleTimer",null),Ae(this,"_previousVideoVisibleStatus",void 0),Ae(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),Ae(this,"_encoderConfig",void 0),Ae(this,"_scalabilityMode",{numSpatialLayers:1,numTemporalLayers:1}),Ae(this,"_optimizationMode",void 0),Ae(this,"_videoHeight",void 0),Ae(this,"_videoWidth",void 0),Ae(this,"_forceBitrateLimit",void 0),Ae(this,"_enabled",!0),Ae(this,"_processorDestination",void 0),Ae(this,"_processorContext",void 0),Ps()){const{width:m,height:y}=r.getSettings();this._videoWidth=m,this._videoHeight=y}else this.updateMediaStreamTrackResolution();if(this._encoderConfig=s,this._scalabilityMode=a,this._optimizationMode=c,this._hints=h||[],this._hints.indexOf(pr.SCREEN_TRACK)===-1)this.updateBitrateFromProfile();else if(hL(Gn.CHROME,115)&&qA().indexOf("Windows")!==-1){const m=function(y,v){if("VideoFrame"in window&&"TransformStream"in window&&jn().supportWebRTCInsertableStream){const S=new MediaStreamTrackProcessor(y),R=new MediaStreamTrackGenerator({kind:"video"});let P,D,G=Date.now();const F=()=>{j&&(clearInterval(j),j=void 0),P&&(P.close(),P=void 0),y.stop(),D=void 0,R.removeEventListener("ended",F)};let j=window.setInterval(()=>{if(D&&P&&Date.now()-G>1e3)try{R.readyState==="live"?D.enqueue(P.clone()):F()}catch{F()}},1e3);const Y=new TransformStream({transform:(ee,fe)=>{R.readyState==="live"?(D=fe,G=Date.now(),P===void 0?(P=ee,fe.enqueue(ee.clone())):(fe.enqueue(P),P=ee)):ee.close()}});return R.addEventListener("ended",F),S.readable.pipeThrough(Y).pipeTo(R.writable),R}}(r);m&&(x.info("local screen video track begin to inject frame"),this._mediaStreamTrack=m)}s&&this._hints.indexOf(pr.CUSTOM_TRACK)!==-1&&this.setEncoderConfiguration(s),this._processorContext=new Oz(this.getTrackId(),"local"),this._processorDestination=new Pz(this.processorContext),this.bindProcessorDestinationEvents()}play(r){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof r=="string"){const c=document.getElementById(r);c?r=c:(x.warning("[".concat(this.getTrackId(),'] can not find "#').concat(r,'" element, use document.body')),r=document.body)}x.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(r instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(s));const a=Lr(Lr(Lr({},this._getDefaultPlayerConfig()),s),{},{trackId:this.getTrackId(),element:r});this._player?this._player.updateConfig(a):(r instanceof HTMLVideoElement?this._player=new YL(a):this._player=new TG(a),this._player.updateVideoTrack(this._mediaStreamTrack)),this._player.play(),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const c=this.getVideoElementVisibleStatus();this.safeEmit(Xv.VIDEO_ELEMENT_VISIBLE_STATUS,c)}catch{}},oe("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,x.debug("[".concat(this.getTrackId(),"] stop video playback")))}async setEnabled(r,s){if(!s){if(r===this._enabled)return;this.stateCheck("enabled",r)}if(x.info("[".concat(this.getTrackId(),"] start setEnabled"),r),!r){this._originMediaStreamTrack.enabled=!1;try{await hr(this,Tt.NEED_DISABLE_TRACK,this)}catch(a){throw x.error("[".concat(this.getTrackId(),"] setEnabled to false error"),a.toString()),a}return s||(this._enabled=!1),void x.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}this._originMediaStreamTrack.enabled=!0;try{await hr(this,Tt.NEED_ENABLE_TRACK,this)}catch(a){throw x.error("[".concat(this.getTrackId(),"] setEnabled to true error"),a.toString()),a}x.info("[".concat(this.getTrackId(),"] setEnabled to true success")),s||(this._enabled=!0)}async setMuted(r){r!==this._muted&&(this.stateCheck("muted",r),this._muted=r,this._originMediaStreamTrack.enabled=!r,x.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(r)),r?await hr(this,Tt.NEED_MUTE_TRACK,this):await hr(this,Tt.NEED_UNMUTE_TRACK,this))}async setEncoderConfiguration(r,s){if(!this._enabled)throw new Me(te.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");if(r=wh(r),this._forceBitrateLimit&&(r.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:r.bitrateMax,r.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:r.bitrateMin),r.width||r.height||r.frameRate){const a=uP({encoderConfig:r});(Ps()||Vo()||Su())&&(a.deviceId=void 0),x.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(r),JSON.stringify(a));try{await this._originMediaStreamTrack.applyConstraints(a),this.updateMediaStreamTrackResolution()}catch(c){const u=new Me(te.UNEXPECTED_ERROR,c.toString());throw x.error("[".concat(this.getTrackId(),"] applyConstraints error"),u.toString()),u}}this._encoderConfig=r,this._hints.indexOf(pr.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await hr(this,Tt.NEED_UPDATE_VIDEO_ENCODER,this)}catch(a){return a.throw(x)}}getStats(){return Gm(()=>{x.warning("[deprecated] LocalVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalVideoStats instead")},"localVideoTrackGetStatsWarning"),Kc(this,Tt.GET_STATS)||Lr({},BL)}async setBeautyEffect(r){x.error("LocalVideoTrack.setBeautyEffect was deprecated, please migrate to agora-extension-beauty-effect")}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameImage(r){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return this._player?this._player.getCurrentFrameToUint8Array(r,s):await qL(r)}async setBitrateLimit(r){x.debug("[".concat(this.getTrackId(),"] set bitrate limit, ").concat(JSON.stringify(r))),r&&(this._forceBitrateLimit=r,this._encoderConfig&&(this._encoderConfig.bitrateMax?this._encoderConfig.bitrateMax=this._encoderConfig.bitrateMax<r.max_bitrate?this._encoderConfig.bitrateMax:r.max_bitrate:this._encoderConfig.bitrateMax=r.max_bitrate,this._encoderConfig.bitrateMin,this._encoderConfig.bitrateMin=r.min_bitrate))}async setOptimizationMode(r){if(r!=="motion"&&r!=="detail"&&r!=="balanced")return void x.error(te.INVALID_PARAMS,"optimization mode must be motion, detail or balanced");const s=this._optimizationMode;try{this._optimizationMode=r,await hr(this,Tt.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this)}catch(a){throw this._optimizationMode=s,x.error("[".concat(this.getTrackId(),"] set optimization mode failed"),a.toString()),a}x.info("[".concat(this.getTrackId(),"] set optimization mode success (").concat(r,")"))}setScalabiltyMode(r){if(r.numSpatialLayers===1&&r.numTemporalLayers!==1)return x.error(te.INVALID_PARAMS,"scalability mode currently not supported, no SVC."),void(this._scalabilityMode={numSpatialLayers:1,numTemporalLayers:1});this._scalabilityMode=r,x.info("[".concat(this.getTrackId(),"] set scalability mode success (").concat(r,")"))}updateMediaStreamTrackResolution(){Dz(this._originMediaStreamTrack).then(r=>{let[s,a]=r;this._videoHeight=a,this._videoWidth=s}).catch(ZA)}_updatePlayerSource(){this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}_getDefaultPlayerConfig(){return{fit:"contain"}}async setSenderConfiguration(r){if(!this._enabled)throw new Me(te.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");x.debug("[".concat(this.getTrackId(),"] setSenderConfiguration applyConstraints"),JSON.stringify(r)),r=wh(r),this._forceBitrateLimit&&(r.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:r.bitrateMax,r.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:r.bitrateMin),this._encoderConfig=r,this._hints.indexOf(pr.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await hr(this,Tt.NEED_UPDATE_VIDEO_ENCODER,this)}catch(s){return s.throw(x)}}updateBitrateFromProfile(){if(!this._encoderConfig)return;const{width:r,height:s,frameRate:a}=this.getMediaStreamTrackSettings();if(!r||!s||!a)return;const{bitrateMax:c,bitrateMin:u}=this._encoderConfig;if(u==null||c==null){const{max:h,min:m}=function(y,v,S,R,P){const D=oe("BITRATE_ADAPTER_TYPE");if(D==="DEFAULT_BITRATE")return{min:R,max:P};if(P===void 0){var G;const j=Math.floor(200*Math.pow(S/15,.6)*Math.pow(y*v/640/360,.75));P=D==="STANDARD_BITRATE"?4*j:2*j,R=(G=R)!==null&&G!==void 0?G:j}else{var F;R=(F=R)!==null&&F!==void 0?F:Math.floor(P/10)}return{min:R,max:P}}(r,s,a,u,c);this._encoderConfig.bitrateMin=m,this._encoderConfig.bitrateMax=h,x.debug("[".concat(this.getTrackId(),"] update bitrate from profile, [w: ").concat(r,", h: ").concat(s,", fps: ").concat(a,"] => [brMax: ").concat(h,", brMin: ").concat(m,"]"))}}getVideoElementVisibleStatus(){try{var r,s;const a=this==null||(r=this._player)===null||r===void 0?void 0:r.getContainerElement(),c={track:this,element:this==null||(s=this._player)===null||s===void 0?void 0:s.getVideoElement(),slot:a==null?void 0:a.parentElement},{element:u,slot:h}=c;if(this.isPlaying&&u instanceof HTMLVideoElement&&h instanceof HTMLElement){const m=x8.checkOneElementVisible(u),y=Object.assign({},m);if(y.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=y.visible;const v=At.reportApiInvoke(null,{tag:Hr.TRACER,name:Oi.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});y.visible?v.onSuccess("Video is visible"):v.onSuccess("Invisible because of ".concat(y.reason))}return y}return}catch(a){throw new Me(te.GET_VIDEO_ELEMENT_VISIBLE_ERROR,a.message)}}async renewMediaStreamTrack(r){}pipe(r){if(this.processor===r)return r;if(r._source)throw new Me(te.INVALID_OPERATION,"Processor ".concat(r.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=r,this.processor._source=this,r.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),r}unpipe(){if(!this.processor)return;const r=this.processor;this.processor._source=void 0,this.processor=void 0,r.reset()}close(){super.close(),this.unbindProcessorDestinationEvents(),this.unbindProcessorContextEvents(),this.unpipe(),this.processorDestination._source&&this.processorDestination._source.unpipe()}clone(r){let s=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],a=this._encoderConfig;r&&(a=Lr(Lr({},a),wh(r))),a=B_(a);const c=fr(8,"track-video-cloned-"),u=new uae(s?this._mediaStreamTrack.clone():this._mediaStreamTrack,a,B_(this._scalabilityMode),this._optimizationMode,c,B_(this._hints));return r&&a&&u.setEncoderConfiguration(a),x.debug("clone video track from ".concat(this.getTrackId()," to ").concat(c,", clone ").concat(s)),u}async replaceTrack(r,s){if(!(r instanceof MediaStreamTrack))throw new Me(te.INVALID_PARAMS,"track should be an instance of MediaStreamTrack");if(r.kind!=="video")throw new Me(te.INVALID_PARAMS,"track should be a video MediaStreamTrack");await this._updateOriginMediaStreamTrack(r,s,!0),this.updateMediaStreamTrackResolution()}sendSeiData(r){if(Gm(()=>{At.reportApiInvoke(null,{name:Oi.LOCAL_VIDEO_SEND_SEI_DATA,options:[],tag:Hr.TRACER}).onSuccess("")},this._mediaStreamTrack.id||this.getTrackId()),!oe("ENABLE_VIDEO_SEI")||!oe("ENABLE_ENCODED_TRANSFORM"))return void x.warning('To send/receive SEI, please call AgoraRTC.setParameter("ENABLE_VIDEO_SEI", true) before instantiate IAgoraRtcClient');if(r instanceof Uint8Array==0)return new Me(te.INVALID_PARAMS,"Invalid argument type, ILocalVideoTrack.sendSeiData() only accept Uint8Array argument.").throw();const s=this.getRTCRtpTransceiver();if(!s)return void x.warning("Video track is not published, SEI can not be send");const a=s.sender.getParameters();if(a.codecs.length===0)return;const c=a.codecs[0].mimeType.toLocaleLowerCase();c==="video/h264"?this.safeEmit("sei-to-send",r):x.warning("SEI is not supported by ".concat(c))}bindProcessorDestinationEvents(){this.processorDestination.on(Fo.ON_TRACK,async r=>{r?r!==this._mediaStreamTrack&&(this._mediaStreamTrack=r,this._updatePlayerSource(),await hr(this,Tt.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await hr(this,Tt.NEED_REPLACE_TRACK,this))})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(Fo.ON_TRACK)}unbindProcessorContextEvents(){this.processorContext.removeAllListeners(Jc.REQUEST_UPDATE_CONSTRAINTS),this.processorContext.removeAllListeners(Jc.REQUEST_CONSTRAINTS)}},Ln(Pn.prototype,"play",[wG,CG],Object.getOwnPropertyDescriptor(Pn.prototype,"play"),Pn.prototype),Ln(Pn.prototype,"stop",[RG],Object.getOwnPropertyDescriptor(Pn.prototype,"stop"),Pn.prototype),Ln(Pn.prototype,"setEnabled",[IG,AG,PG],Object.getOwnPropertyDescriptor(Pn.prototype,"setEnabled"),Pn.prototype),Ln(Pn.prototype,"setMuted",[OG,kG,NG],Object.getOwnPropertyDescriptor(Pn.prototype,"setMuted"),Pn.prototype),Ln(Pn.prototype,"setEncoderConfiguration",[DG,xG],Object.getOwnPropertyDescriptor(Pn.prototype,"setEncoderConfiguration"),Pn.prototype),Ln(Pn.prototype,"getStats",[LG],Object.getOwnPropertyDescriptor(Pn.prototype,"getStats"),Pn.prototype),Ln(Pn.prototype,"setBeautyEffect",[MG,UG],Object.getOwnPropertyDescriptor(Pn.prototype,"setBeautyEffect"),Pn.prototype),Ln(Pn.prototype,"getCurrentFrameData",[VG],Object.getOwnPropertyDescriptor(Pn.prototype,"getCurrentFrameData"),Pn.prototype),Ln(Pn.prototype,"getCurrentFrameImage",[FG],Object.getOwnPropertyDescriptor(Pn.prototype,"getCurrentFrameImage"),Pn.prototype),Ln(Pn.prototype,"setBitrateLimit",[jG],Object.getOwnPropertyDescriptor(Pn.prototype,"setBitrateLimit"),Pn.prototype),Ln(Pn.prototype,"setOptimizationMode",[BG],Object.getOwnPropertyDescriptor(Pn.prototype,"setOptimizationMode"),Pn.prototype),Ln(Pn.prototype,"setScalabiltyMode",[WG],Object.getOwnPropertyDescriptor(Pn.prototype,"setScalabiltyMode"),Pn.prototype),Ln(Pn.prototype,"updateMediaStreamTrackResolution",[zG],Object.getOwnPropertyDescriptor(Pn.prototype,"updateMediaStreamTrackResolution"),Pn.prototype),Ln(Pn.prototype,"pipe",[GG],Object.getOwnPropertyDescriptor(Pn.prototype,"pipe"),Pn.prototype),Ln(Pn.prototype,"unpipe",[HG],Object.getOwnPropertyDescriptor(Pn.prototype,"unpipe"),Pn.prototype),Ln(Pn.prototype,"close",[$G],Object.getOwnPropertyDescriptor(Pn.prototype,"close"),Pn.prototype),Ln(Pn.prototype,"replaceTrack",[KG],Object.getOwnPropertyDescriptor(Pn.prototype,"replaceTrack"),Pn.prototype),Pn),XL=(qG=jt({argsMap:(t,r)=>[t.getTrackId(),r]}),YG=li(),XG=Gv("CameraVideoTrack","_enabledMutex"),JG=jt({argsMap:(t,r)=>[t.getTrackId(),r]}),QG=li(),ZG=jt({argsMap:(t,r)=>[t.getTrackId(),r]}),eH=li(),tH=jt({argsMap:t=>[t.getTrackId()]}),nl=class dae extends Tr{get __className__(){return"CameraVideoTrack"}constructor(r,s,a,c,u,h){super(r,wh(s.encoderConfig),c,u,h),Ae(this,"_config",void 0),Ae(this,"_originalConstraints",void 0),Ae(this,"_constraints",void 0),Ae(this,"_enabled",!0),Ae(this,"_deviceName","default"),Ae(this,"tryResumeVideoForIOS15_16WeChat",async()=>{(Bv()||mL())&&!function(){const m=Dn();if(m.os!==Qi.IOS||!m.osVersion)return!1;const y=m.osVersion.split(".");return Number(y[0])===15&&Number(y[1])>=2}()&&O8()&&this._enabled&&!this._isClosed&&(x.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS 15 device on WeChat.")),await this.renewMediaStreamTrack())}),this._config=s,this._originalConstraints=a,this._constraints=a,this._deviceName=r.label,this._encoderConfig=wh(this._config.encoderConfig),ir.on(gs.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),ir.on(gs.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),this.bindProcessorContextEvents()}async setDevice(r){return typeof r=="string"?this._setDeviceById(r):r.deviceId?this._setDeviceById(r.deviceId):r.facingMode?this._setDeviceByFacingModel(r.facingMode):void 0}async _setDeviceById(r){if(x.info("[".concat(this.getTrackId(),"] set device to ").concat(r)),this._enabled)try{const s=await el.getDeviceById(r),a={};a.video=Lr({},this._constraints),a.video.deviceId={exact:r},a.video.facingMode=void 0,this._originMediaStreamTrack.stop();let c=null;try{c=await Zc(a,this.getTrackId())}catch(u){throw x.error("[".concat(this.getTrackId(),"] setDevice failed"),u.toString()),c=await Zc({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(c.getVideoTracks()[0],!1),u}await this._updateOriginMediaStreamTrack(c.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution(),this._deviceName=s.label,this._config.cameraId=r,this._constraints.deviceId={exact:r}}catch(s){throw x.error("[".concat(this.getTrackId(),"] setDevice error"),s.toString()),s}else try{const s=await el.getDeviceById(r);this._deviceName=s.label,this._config.cameraId=r,this._constraints.deviceId={exact:r}}catch(s){throw x.error("[".concat(this.getTrackId(),"] setDevice error"),s.toString()),s}x.info("[".concat(this.getTrackId(),"] setDevice success"))}async _setDeviceByFacingModel(r){x.info("[".concat(this.getTrackId(),"] set facingMode ").concat(r));const s={video:Lr(Lr({},this._constraints),{},{deviceId:void 0,facingMode:{exact:r}})};if(this._enabled){this._originMediaStreamTrack.stop();let a=null;try{a=await Zc(s,this.getTrackId())}catch(c){throw x.error("[".concat(this.getTrackId(),"] setDeviceByFacingModel failed"),c.toString()),a=await Zc({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(a.getVideoTracks()[0],!1),c}await this._updateOriginMediaStreamTrack(a.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution()}this._deviceName="",this._config.facingMode=r,this._config.cameraId=void 0,this._constraints=Lr({},s.video),x.info("[".concat(this.getTrackId(),"] setDeviceByFacingModel success"))}async setEnabled(r,s){if(!s){if(r===this._enabled)return;this.stateCheck("enabled",r)}if(x.info("[".concat(this.getTrackId(),"] start setEnabled"),r),r){try{if(this.isExternalTrack)this._originMediaStreamTrack.enabled=!0;else{const a=await Zc({video:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(a.getVideoTracks()[0],!1)}await hr(this,Tt.NEED_ENABLE_TRACK,this)}catch(a){throw x.error("[".concat(this.getTrackId(),"] setEnabled true error"),a.toString()),a}this.updateMediaStreamTrackResolution(),x.info("[".concat(this.getTrackId(),"] setEnabled to true success")),s||(this._enabled=!0)}else{this.isExternalTrack?this._originMediaStreamTrack.enabled=!1:(this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop()),s||(this._enabled=!1);try{await hr(this,Tt.NEED_DISABLE_TRACK,this)}catch(a){throw x.error("[".concat(this.getTrackId(),"] setEnabled to false error"),a.toString()),a}x.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}}async setEncoderConfiguration(r,s){if(!this._enabled)throw new Me(te.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");r=wh(r),this._forceBitrateLimit&&(r.bitrateMax=this._forceBitrateLimit.max_bitrate||r.bitrateMax,r.bitrateMin=this._forceBitrateLimit.min_bitrate||r.bitrateMin);const a=$r(this._config);a.encoderConfig=r;const c=uP(a);(Ps()||Vo()||Su())&&(c.deviceId=void 0),x.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(r),JSON.stringify(c));try{await this._originMediaStreamTrack.applyConstraints(c),this.updateMediaStreamTrackResolution()}catch(u){const h=new Me(te.UNEXPECTED_ERROR,u.toString());throw x.error("[".concat(this.getTrackId(),"] applyConstraints error"),h.toString()),h}this._config=a,this._constraints=c,this._originalConstraints=c,this._encoderConfig=r,this._hints.indexOf(pr.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await hr(this,Tt.NEED_UPDATE_VIDEO_ENCODER,this)}catch(u){return u.throw(x)}}_getDefaultPlayerConfig(){return{mirror:!0,fit:"cover"}}onTrackEnded(){if((Vo()||Su())&&this._enabled&&!this._isClosed&&ir.duringInterruption){const r=async()=>{ir.off(gs.IOS_INTERRUPTION_END,r),this._enabled&&!this._isClosed&&(x.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};ir.on(gs.IOS_INTERRUPTION_END,r)}else x.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(Xv.TRACK_ENDED)}async renewMediaStreamTrack(r){const s=r||this._constraints,a=el.searchDeviceIdByName(this._deviceName);if(a&&!s.deviceId&&(s.deviceId={exact:a}),this._enabled){const c=await Zc({video:s},this.getTrackId());this._constraints=s,await this._updateOriginMediaStreamTrack(c.getVideoTracks()[0],!0),this.updateMediaStreamTrackResolution()}}close(){super.close(),ir.off(gs.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),ir.off(gs.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat)}clone(r){let s=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],a=this._encoderConfig;r&&(a=Lr(Lr({},a),wh(r))),a=B_(a);const c=fr(8,"track-cam-cloned-"),u=new dae(s?this._mediaStreamTrack.clone():this._mediaStreamTrack,B_(Lr(Lr({},this._config),{},{encoderConfig:a})),B_(this._constraints),B_(this._scalabilityMode),this._optimizationMode,c);return r&&a&&u.setEncoderConfiguration(a),x.debug("clone track from ".concat(this.getTrackId()," to ").concat(c,", clone ").concat(s)),u}bindProcessorContextEvents(){this.processorContext.on(Jc.REQUEST_UPDATE_CONSTRAINTS,async(r,s,a)=>{try{const c=Object.assign({},this._originalConstraints,...r);await this.renewMediaStreamTrack(c),s()}catch(c){a(c)}}),this.processorContext.on(Jc.REQUEST_CONSTRAINTS,async r=>{r(this._originMediaStreamTrack.getSettings())})}},Ln(nl.prototype,"setDevice",[qG,YG],Object.getOwnPropertyDescriptor(nl.prototype,"setDevice"),nl.prototype),Ln(nl.prototype,"setEnabled",[XG,JG,QG],Object.getOwnPropertyDescriptor(nl.prototype,"setEnabled"),nl.prototype),Ln(nl.prototype,"setEncoderConfiguration",[ZG,eH],Object.getOwnPropertyDescriptor(nl.prototype,"setEncoderConfiguration"),nl.prototype),Ln(nl.prototype,"close",[tH],Object.getOwnPropertyDescriptor(nl.prototype,"close"),nl.prototype),nl);function JL(t,r,s,a){s.optimizationMode&&(a&&a.width&&a.height?(s.encoderConfig=Lr(Lr({},a),{},{bitrateMin:a.bitrateMin,bitrateMax:a.bitrateMax}),s.optimizationMode!=="motion"&&s.optimizationMode!=="detail"||(r.contentHint=s.optimizationMode,r.contentHint===s.optimizationMode?x.debug("[".concat(t,"] set content hint to"),s.optimizationMode):x.debug("[".concat(t,"] set content hint failed")))):x.warning("[".concat(t,"] can not apply optimization mode bitrate config, no encoderConfig")))}var nH,rH,iH,sH,Ol,oH,aH,cH,lH,uH,dH,Eo;class hH extends yz{getUserId(){return this._userId}constructor(r,s,a,c){super(r,"track-".concat(r.kind,"-").concat(s,"-").concat(c.clientId,"_").concat(fr(5,""))),Ae(this,"_userId",void 0),Ae(this,"_uintId",void 0),Ae(this,"_isDestroyed",!1),Ae(this,"store",void 0),Ae(this,"processor",void 0),Ae(this,"processorContext",void 0),this._userId=s,this._uintId=a,this.store=c}_updateOriginMediaStreamTrack(r){this._originMediaStreamTrack=r,this._mediaStreamTrack=r,this._updatePlayerSource(),this.processor&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this.processorContext})}_destroy(){this._isDestroyed=!0,x.info("[".concat(this.getTrackId(),"] is destroyed")),this.stop(),super.close()}getProcessorStats(){return this.processorContext.gatherStats()}getProcessorUsage(){return this.processorContext.gatherUsage()}}let nS=(nH=jt({argsMap:(t,r,s)=>[t.getTrackId(),typeof r=="string"?r:r instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",s]}),rH=jt({argsMap:t=>[t.getTrackId()]}),iH=jt({argsMap:(t,r)=>[t.getTrackId(),r.name]}),sH=jt({argsMap:t=>[t.getTrackId()]}),Ln((Ol=class extends hH{get isPlaying(){return!(!this._player||this._player.videoElementStatus!==yo.PLAYING)}get __className__(){return"RemoteVideoTrack"}constructor(t,r,s,a){super(t,r,s,a),Ae(this,"_videoVisibleTimer",null),Ae(this,"_previousVideoVisibleStatus",void 0),Ae(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),Ae(this,"trackMediaType",Qv.VIDEO),Ae(this,"_videoWidth",void 0),Ae(this,"_videoHeight",void 0),Ae(this,"_player",void 0),Ae(this,"processorDestination",void 0),Ae(this,"processorContext",void 0),this.updateMediaStreamTrackResolution(),this.processorContext=new Oz(this.getTrackId(),"remote"),this.processorDestination=new Pz(this.processorContext),this.bindProcessorDestinationEvents()}getStats(){return Gm(()=>{x.warning("[deprecated] RemoteVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteVideoStats instead")},"remoteVideoTrackGetStatsWarning"),Kc(this,Tt.GET_STATS)||Lr({},gz)}play(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof t=="string"){const a=document.getElementById(t);a?t=a:(x.warning("[".concat(this.getTrackId(),'] can not find "#').concat(t,'" element, use document.body')),t=document.body)}x.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(r));const s=Lr(Lr({fit:"cover"},r),{},{trackId:this.getTrackId(),element:t});this._player?this._player.updateConfig(s):(t instanceof HTMLVideoElement?this._player=new YL(s):this._player=new TG(s),this._player.updateVideoTrack(this._mediaStreamTrack),this._player.onFirstVideoFrameDecoded=()=>{this.store.subscribe(this.getUserId(),"video",void 0,void 0,Date.now()),this.safeEmit(Jv.FIRST_FRAME_DECODED)},this._player.onVideoStateChanged=a=>{this.safeEmit(Jv.VIDEO_STATE_CHANGED,a)}),this._player.play(this.store.sessionId||void 0),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const a=this.getVideoElementVisibleStatus();this.safeEmit(Jv.VIDEO_ELEMENT_VISIBLE_STATUS,a)}catch{}},oe("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,x.debug("[".concat(this.getTrackId(),"] stop video playback")))}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}updateMediaStreamTrackResolution(){Dz(this._originMediaStreamTrack).then(t=>{let[r,s]=t;this._videoHeight=s,this._videoWidth=r}).catch(ZA)}_updatePlayerSource(){x.debug("[".concat(this.getTrackId(),"] update player source track")),this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}getVideoElementVisibleStatus(){try{var t,r;const s=this==null||(t=this._player)===null||t===void 0?void 0:t.getContainerElement(),a={track:this,element:this==null||(r=this._player)===null||r===void 0?void 0:r.getVideoElement(),slot:s==null?void 0:s.parentElement},{element:c,slot:u}=a;if(this.isPlaying&&c instanceof HTMLVideoElement&&u instanceof HTMLElement){const h=x8.checkOneElementVisible(c),m=Object.assign({},h);if(m.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=m.visible;const y=At.reportApiInvoke(null,{tag:Hr.TRACER,name:Oi.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});m.visible?y.onSuccess("Video is visible"):y.onSuccess("Invisible because of ".concat(m.reason))}return m}return}catch(s){throw new Me(te.GET_VIDEO_ELEMENT_VISIBLE_ERROR,s.message)}}pipe(t){if(this.processor===t)return t;if(t._source)throw new Me(te.INVALID_OPERATION,"Processor ".concat(t.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=t,this.processor._source=this,t.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),t}unpipe(){if(!this.processor)return;const t=this.processor;this.processor._source=void 0,this.processor=void 0,t.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(Fo.ON_TRACK,async t=>{t?t!==this._mediaStreamTrack&&(this._mediaStreamTrack=t,this._updatePlayerSource()):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(Fo.ON_TRACK)}_destroy(){super._destroy(),this.unbindProcessorDestinationEvents()}_onSei(t){this.emit(H_.SEI_RECEIVED,t)}}).prototype,"play",[nH],Object.getOwnPropertyDescriptor(Ol.prototype,"play"),Ol.prototype),Ln(Ol.prototype,"stop",[rH],Object.getOwnPropertyDescriptor(Ol.prototype,"stop"),Ol.prototype),Ln(Ol.prototype,"pipe",[iH],Object.getOwnPropertyDescriptor(Ol.prototype,"pipe"),Ol.prototype),Ln(Ol.prototype,"unpipe",[sH],Object.getOwnPropertyDescriptor(Ol.prototype,"unpipe"),Ol.prototype),Ol),rS=(oH=jt({argsMap:(t,r)=>[t.getTrackId(),r],throttleTime:300}),aH=jt({argsMap:(t,r)=>[t.getTrackId(),r]}),cH=jt({argsMap:t=>[t.getTrackId()]}),lH=jt({argsMap:t=>[t.getTrackId()]}),uH=jt({argsMap:(t,r)=>[t.getTrackId(),r.name]}),dH=jt({argsMap:t=>[t.getTrackId()]}),Ln((Eo=class extends hH{get isPlaying(){return this._useAudioElement?fa.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"RemoteAudioTrack"}constructor(t,r,s,a){super(t,r,s,a),Ae(this,"trackMediaType",Qv.AUDIO),Ae(this,"_source",void 0),Ae(this,"_useAudioElement",!0),Ae(this,"_volume",100),Ae(this,"processorContext",void 0),Ae(this,"processorDestination",void 0),Ae(this,"_played",!1),Ae(this,"_bypassWebAudio",!1),oe("DISABLE_WEBAUDIO")?(this._source=new KL,this._bypassWebAudio=!0,this._useAudioElement=!0):(this._source=new bz(t,!0),oe("REMOTE_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1)),this._source.once(Xc.RECEIVE_TRACK_BUFFER,()=>{this.safeEmit(Jv.FIRST_FRAME_DECODED)}),this.processorContext=new Nz(this._source.context,this.getTrackId(),"remote"),this.processorDestination=new kz(this.processorContext),this.bindProcessorDestinationEvents(),this._source.on(Xc.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:this.processorContext})})}setAudioFrameCallback(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!t)return this._source.removeAllListeners(Xc.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(r),this._source.removeAllListeners(Xc.ON_AUDIO_BUFFER),this._source.on(Xc.ON_AUDIO_BUFFER,s=>t(s))}setVolume(t){this._volume=t,this._useAudioElement?fa.setVolume(this.getTrackId(),t):this._source.setVolume(t/100)}async setPlaybackDevice(t){if(!this._useAudioElement||!hz())throw new Me(te.NOT_SUPPORTED,"your browser does not support setting the audio output device");await fa.setSinkID(this.getTrackId(),t)}getVolumeLevel(){return this._source.getAccurateVolumeLevel()}getStats(){return Gm(()=>{x.warning("[deprecated] RemoteAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteAudioStats instead")},"remoteAudioTrackGetStatsWarning"),Kc(this,Tt.GET_STATS)||Lr({},mz)}play(){x.debug("[".concat(this.getTrackId(),"] start audio playback")),this._played=!0,this._useAudioElement?(x.debug("[".concat(this.getTrackId(),"] use audio element to play")),fa.play(this._mediaStreamTrack,this.getTrackId(),this._volume,this.store.sessionId||void 0)):this._source.play()}stop(){x.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._played=!1,this._useAudioElement?fa.stop(this.getTrackId()):this._source.stop()}_destroy(){super._destroy(),this._played=!1,this.unbindProcessorDestinationEvents(),this._source.destroy()}_isFreeze(){return this._source.isFreeze}_updatePlayerSource(){let t=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];x.debug("[".concat(this.getTrackId(),"] update player source track")),t&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&fa.updateTrack(this.getTrackId(),this._mediaStreamTrack)}pipe(t){if(this._bypassWebAudio)throw new Me(te.NOT_SUPPORTED,"can not pipe extension when WebAudio disabled");if(this.processor===t)return t;if(t._source)throw new Me(te.INVALID_OPERATION,"Processor ".concat(t.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=t,this.processor._source=this,t.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),t}unpipe(){var t;if(this._bypassWebAudio)throw new Me(te.NOT_SUPPORTED,"can not unpipe extension when WebAudio disabled");if(!this.processor)return;const r=this.processor;(t=this._source.processSourceNode)===null||t===void 0||t.disconnect(),this.processor._source=!1,this.processor=void 0,r.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(Fo.ON_TRACK,async t=>{t?t!==this._mediaStreamTrack&&(this._mediaStreamTrack=t,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(t)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())}),this.processorDestination.on(Fo.ON_NODE,t=>{this._source.processedNode=t;const r=!t;this._useAudioElement!==r&&(this._played?(this.stop(),this._useAudioElement=r,this.play()):this._useAudioElement=r)})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(Fo.ON_TRACK),this.processorDestination.removeAllListeners(Fo.ON_NODE)}}).prototype,"setVolume",[oH],Object.getOwnPropertyDescriptor(Eo.prototype,"setVolume"),Eo.prototype),Ln(Eo.prototype,"setPlaybackDevice",[aH],Object.getOwnPropertyDescriptor(Eo.prototype,"setPlaybackDevice"),Eo.prototype),Ln(Eo.prototype,"play",[cH],Object.getOwnPropertyDescriptor(Eo.prototype,"play"),Eo.prototype),Ln(Eo.prototype,"stop",[lH],Object.getOwnPropertyDescriptor(Eo.prototype,"stop"),Eo.prototype),Ln(Eo.prototype,"pipe",[uH],Object.getOwnPropertyDescriptor(Eo.prototype,"pipe"),Eo.prototype),Ln(Eo.prototype,"unpipe",[dH],Object.getOwnPropertyDescriptor(Eo.prototype,"unpipe"),Eo.prototype),Eo);const ap=new class extends Fr{get visibility(){return document.visibilityState}get lastHiddenTime(){return this._lastHiddenTime}get lastVisibleTime(){return this._lastVisibleTime}constructor(){super(),Ae(this,"_lastHiddenTime",0),Ae(this,"_lastVisibleTime",0),document.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"?this._lastHiddenTime=performance.now():this._lastVisibleTime=performance.now(),x.debug("current web page is ".concat(document.visibilityState)),this.emit("VISIBILITY_CHANGE",document.visibilityState)})}};class fH extends Fr{constructor(r,s){super(),Ae(this,"trackMediaType",Qv.DATA),Ae(this,"_version",1),Ae(this,"_type",3),Ae(this,"_config",void 0),Ae(this,"_originDataChannel",void 0),Ae(this,"_dataStreamPacketHeader",new ArrayBuffer(4)),Ae(this,"_dataStreamPacketHandler",{serialize:a=>a,deserialize:a=>a}),Ae(this,"_datachannelEventMap",new Map),this._config=r,s&&(this._originDataChannel=s,this._bandDataChannelEvents(s)),this._initPacketHeader()}useDataStream(r){this._dataStreamPacketHandler=r}get id(){return this._config.id}get ordered(){return this._config.ordered}get maxRetransmits(){return oe("DATASTREAM_MAX_RETRANSMITS")}get metadata(){return this._config.metadata}get readyState(){var r,s;return(r=(s=this._originDataChannel)===null||s===void 0?void 0:s.readyState)!==null&&r!==void 0?r:"connecting"}get _originDataChannelId(){var r,s;return(r=(s=this._originDataChannel)===null||s===void 0?void 0:s.id)!==null&&r!==void 0?r:null}getChannelId(){return this.id}getConfig(){return this._config}_close(){this._originDataChannel&&(this._unbindDataChannelEvents(this._originDataChannel),this._originDataChannel=void 0)}async _waitTillOpen(){return new dt((r,s)=>{if(this._originDataChannel){this._originDataChannel.readyState==="open"&&r();const a=setTimeout(()=>{var c;s(new Me(te.DATACHANNEL_CONNECTION_TIMEOUT,"Cannot create datachannel, id: ".concat((c=this._originDataChannel)===null||c===void 0?void 0:c.id)))},1e4);this._originDataChannel.onopen=()=>{clearTimeout(a),this._originDataChannel&&this._bandDataChannelEvents(this._originDataChannel),r()},this._originDataChannel.onerror=()=>{throw clearTimeout(a),new Me(te.DATACHANNEL_CONNECTION_TIMEOUT)}}else s(new Me(te.DATACHANNEL_CONNECTION_TIMEOUT,"cannot find dataChannel"))})}_updateOriginDataChannel(r){this._originDataChannel=r,this._bandDataChannelEvents(r)}_initPacketHeader(){const r=new DataView(this._dataStreamPacketHeader);r.setUint16(0,this._version),r.setUint8(2,this._type),r.setUint8(3,this._config.id)}_bandDataChannelEvents(r){this._unbindDataChannelEvents(r),[cP.OPEN,cP.CLOSE,cP.ERROR].forEach(s=>{const a=()=>{this.emit(s)};this._datachannelEventMap.set(s,a),r.addEventListener(s,a)})}_unbindDataChannelEvents(r){Array.from(this._datachannelEventMap.entries()).forEach(s=>{let[a,c]=s;r.removeEventListener(a,c)}),this._datachannelEventMap.clear()}}class Ome extends fH{constructor(r){super(r),Ae(this,"_messageListener",void 0),this._messageListener=s=>{if(s.data.byteLength<this._dataStreamPacketHeader.byteLength)throw Error("invalid byteLength: the byte length must exceed "+this._dataStreamPacketHeader.byteLength);const a=s.data.slice(0,this._dataStreamPacketHeader.byteLength),c=new DataView(a).getUint8(3);if(c!==this.id)return void(oe("SHOW_DATASTREAM2_LOG")&&x.debug("invalid datachannel id: ".concat(c," !== ").concat(this.id)));let u=s.data.slice(this._dataStreamPacketHeader.byteLength);u=this._dataStreamPacketHandler.deserialize(u),this.emit(cP.MESSAGE,u)}}_updateOriginDataChannel(r){super._updateOriginDataChannel(r),this._bandRemoteDataChannelEvents()}_close(){this._originDataChannel&&(this._originDataChannel.removeEventListener("message",this._messageListener),super._close())}_bandRemoteDataChannelEvents(){this._originDataChannel&&this._originDataChannel.addEventListener("message",this._messageListener)}}class kme extends fH{send(r){if(this._originDataChannel){let s=r;s=this._dataStreamPacketHandler.serialize(r);const a=new Uint8Array(this._dataStreamPacketHeader.byteLength+s.byteLength);a.set(new Uint8Array(this._dataStreamPacketHeader),0),a.set(new Uint8Array(s),this._dataStreamPacketHeader.byteLength),this._originDataChannel.send(a.buffer)}}}function hP(){const t=new Blob([atob("ZnVuY3Rpb24gdCh0LGUsbil7bGV0IGE9bmV3IFVpbnQ4QXJyYXkodCxlLG4pLG89W10scj0wO2Zvcig7by5sZW5ndGg8bjspciszPG4mJjA9PT1hW3JdJiYwPT09YVtyKzFdJiYzPT09YVtyKzJdJiYoMD09PWFbciszXXx8MT09PWFbciszXXx8Mj09PWFbciszXXx8Mz09PWFbciszXSk/KG8ucHVzaChhW3JdLGFbcisxXSxhW3IrM10pLHIrPTQpOihvLnB1c2goYVtyXSkscisrKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkobyl9ZnVuY3Rpb24gZSh0LGUpe2NvbnN0IG49ZnVuY3Rpb24odCl7Y29uc3QgZT10Lmxlbmd0aDtsZXQgbj1bXSxhPTA7Zm9yKDthPGU7KWErMjxlJiYwPT09dFthXSYmMD09PXRbYSsxXSYmKDA9PT10W2ErMl18fDE9PT10W2ErMl18fDI9PT10W2ErMl18fDM9PT10W2ErMl0pPyhuLnB1c2godFthXSx0W2ErMV0sMyx0W2ErMl0pLGErPTMpOihuLnB1c2godFthXSksYSsrKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkobil9KGUpLGE9bi5sZW5ndGgsbz1NYXRoLmZsb29yKGEvMjU1KSxyPWElMjU1LHM9bmV3IFVpbnQ4QXJyYXkoNitvKzErYSt0LmJ5dGVMZW5ndGgpO3NbMF09MCxzWzFdPTAsc1syXT0wLHNbM109MSxzWzRdPTYsc1s1XT0xMDE7bGV0IGk9MDtmb3IoO2k8bzspc1s2K2ldPTI1NSxpKys7cmV0dXJuIHNbNitpXT1yLGkrKyxzLnNldChuLDYraSkscy5zZXQobmV3IFVpbnQ4QXJyYXkodCksNitpK2EpLHMuYnVmZmVyfWNvbnN0IG49NzEsYT0xLG89MixyPTEscz0yO3ZhciBpOyFmdW5jdGlvbih0KXt0W3QuQVVESU9fTEVWRUw9MV09IkFVRElPX0xFVkVMIix0W3QuTUVUQURBVEE9Ml09Ik1FVEFEQVRBIix0W3QuQVVESU9fNjRfQklUX1BUUz0zXT0iQVVESU9fNjRfQklUX1BUUyJ9KGl8fChpPXt9KSk7bmF2aWdhdG9yLnVzZXJBZ2VudC5pbmRleE9mKCJTYWZhcmkiKT4tMSYmLTE9PT1uYXZpZ2F0b3IudXNlckFnZW50LmluZGV4T2YoIkNocm9tZSIpJiYoc2VsZi5vbnJ0Y3RyYW5zZm9ybT1mPT57Y29uc3QgdT1mLnRyYW5zZm9ybWVyO2xldCBkPVtdLGw9W107dS5vcHRpb25zLnBvcnQub25tZXNzYWdlPXQ9Pnt0LmRhdGEuc2VpJiZkLnB1c2godC5kYXRhLnNlaSksdC5kYXRhLm1ldGFkYXRhJiZsLnB1c2godC5kYXRhLm1ldGFkYXRhKX0sc2VsZi5wb3N0TWVzc2FnZSgic3RhcnRlZCIpO2NvbnN0IGc9dS5yZWFkYWJsZS5nZXRSZWFkZXIoKSxjPXUud3JpdGFibGUuZ2V0V3JpdGVyKCk7InNlaS1yeCI9PT11Lm9wdGlvbnMubmFtZT9mdW5jdGlvbiBlKG4pe2cucmVhZCgpLnRoZW4oKGE9PntpZighYS5kb25lKXtpZihhLnZhbHVlIGluc3RhbmNlb2YgUlRDRW5jb2RlZFZpZGVvRnJhbWUpe2NvbnN0IGU9ZnVuY3Rpb24oZSl7Y29uc3Qgbj1uZXcgRGF0YVZpZXcoZS5kYXRhKTtsZXQgYT0wO2Zvcig7YSs0PGUuZGF0YS5ieXRlTGVuZ3RoOyl7aWYoMD09PW4uZ2V0VWludDgoYSswKSYmMD09PW4uZ2V0VWludDgoYSsxKSYmMD09PW4uZ2V0VWludDgoYSsyKSYmMT09PW4uZ2V0VWludDgoYSszKSYmNj09PW4uZ2V0VWludDgoYSs0KSl7bGV0IG89YSs2LHI9MCxzPTA7Zm9yKDsyNTU9PT0ocz1uLmdldFVpbnQ4KG8rKykpOylyKz0yNTU7cis9cztjb25zdCBpPXQoZS5kYXRhLG8scik7cmV0dXJuIG5ldyBVaW50OEFycmF5KGkpfWErK31yZXR1cm4gbnVsbH0oYS52YWx1ZSk7ZSYmbi5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3NlaTplfSl9Yy53cml0ZShhLnZhbHVlKSxuLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSxlKG4pfX0pKX0odSk6InNlaS10eCI9PT11Lm9wdGlvbnMubmFtZT9mdW5jdGlvbiB0KG4pe2cucmVhZCgpLnRoZW4oKGE9PntpZighYS5kb25lKXtpZihhLnZhbHVlIGluc3RhbmNlb2YgUlRDRW5jb2RlZFZpZGVvRnJhbWUpe2NvbnN0IHQ9ZC5zaGlmdCgpO3QmJihhLnZhbHVlLmRhdGE9ZShhLnZhbHVlLmRhdGEsdCkpfWMud3JpdGUoYS52YWx1ZSksbi5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3RyYW5zZm9ybWVkOiEwfSksdChuKX19KSl9KHUpOiJhdWRpby1tZXRhZGF0YS1yeCI9PT11Lm9wdGlvbnMubmFtZT9mdW5jdGlvbiB0KGUpe2cucmVhZCgpLnRoZW4oKGY9PntpZighZi5kb25lKXtpZihmLnZhbHVlIGluc3RhbmNlb2YgUlRDRW5jb2RlZEF1ZGlvRnJhbWUpe2NvbnN0IHQ9ZnVuY3Rpb24odCxlPSExKXtjb25zdCBmPXQuZ2V0VWludDgoMCk7aWYoZiE9PW4pcmV0dXJuO2NvbnN0IHU9dC5nZXRVaW50MTYoMSksZD1hK28rdSxsPW5ldyBVaW50OEFycmF5KHQuYnl0ZUxlbmd0aC1kKTtsLnNldChuZXcgVWludDhBcnJheSh0LmJ1ZmZlcixkLHQuYnl0ZUxlbmd0aC1kKSk7Y29uc3QgZz17bTpmLHRsdkxlbjp1LHRsdjpbXSxmcmFtZTpsfTtsZXQgYz1hK287Zm9yKDtjPGQ7KXtjb25zdCBuPXQuZ2V0VWludDgoYyksYT10LmdldFVpbnQxNihjK3IpLG89citzO2lmKG49PT1pLkFVRElPX0xFVkVMKXtsZXQgcj10LmdldFVpbnQ4KGMrbyk7Zm9yKGxldCBlPTE7ZTxhO2UrKylyPXI8PDh8dC5nZXRVaW50OChjK28rZSk7Zy50bHYucHVzaCh7dGFnOm4sbGVuZ3RoOmEsdmFsdWU6ZT8xMjdecj4+MToxMjcmcn0pfWVsc2UgaWYobj09PWkuTUVUQURBVEF8fG49PT1pLkFVRElPXzY0X0JJVF9QVFMpe2NvbnN0IGU9bmV3IFVpbnQ4QXJyYXkoYSk7Zm9yKGxldCBuPTA7bjxhO24rKyllW25dPXQuZ2V0VWludDgoYytvK24pO2cudGx2LnB1c2goe3RhZzpuLGxlbmd0aDphLHZhbHVlOmV9KX1jKz1vK2F9cmV0dXJuIGd9KG5ldyBEYXRhVmlldyhmLnZhbHVlLmRhdGEpKTtpZih0KXtjb25zdCBuPXQudGx2LmZpbmQoKHQ9PnQudGFnPT09aS5NRVRBREFUQXx8dC50YWc9PT1pLkFVRElPXzY0X0JJVF9QVFMpKTtuJiZuLnZhbHVlIGluc3RhbmNlb2YgVWludDhBcnJheSYmZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe21ldGFkYXRhOm4udmFsdWV9KSxmLnZhbHVlLmRhdGE9dC5mcmFtZS5idWZmZXJ9fWMud3JpdGUoZi52YWx1ZSksZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3RyYW5zZm9ybWVkOiEwfSksdChlKX19KSl9KHUpOiJhdWRpby1tZXRhZGF0YS10eCI9PT11Lm9wdGlvbnMubmFtZSYmZnVuY3Rpb24gdChlKXtnLnJlYWQoKS50aGVuKChmPT57aWYoIWYuZG9uZSl7aWYoZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe2dldE1ldGFkYXRhOiEwfSksZi52YWx1ZSBpbnN0YW5jZW9mIFJUQ0VuY29kZWRBdWRpb0ZyYW1lKXtjb25zdCB0PWwuc2hpZnQoKTt0JiYoZi52YWx1ZS5kYXRhPWZ1bmN0aW9uKHQsZSxpKXtjb25zdCBmPWkuYnl0ZUxlbmd0aCx1PWYrcitzLGQ9YStvK3UsbD1uZXcgQXJyYXlCdWZmZXIodC5ieXRlTGVuZ3RoK2QpLGc9bmV3IERhdGFWaWV3KGwpO2cuc2V0VWludDgoMCxuKSxnLnNldFVpbnQxNigxLHUpLGcuc2V0VWludDgoMyxlKSxnLnNldFVpbnQxNig0LGYpO2ZvcihsZXQgdD0wO3Q8Zjt0KyspZy5zZXRVaW50OCg2K3QsaVt0XSk7Y29uc3QgYz1uZXcgVWludDhBcnJheShnLmJ1ZmZlcik7cmV0dXJuIGMuc2V0KG5ldyBVaW50OEFycmF5KHQpLGQpLGMuYnVmZmVyfShmLnZhbHVlLmRhdGEsaS5BVURJT182NF9CSVRfUFRTLHQpKX1jLndyaXRlKGYudmFsdWUpLGUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHt0cmFuc2Zvcm1lZDohMH0pLHQoZSl9fSkpfSh1KX0sc2VsZi5wb3N0TWVzc2FnZSgicmVnaXN0ZXJlZCIpKTsK")],{type:"text/javascript"});return setTimeout(()=>hA.revokeObjectURL(t),0),new Worker(hA.createObjectURL(t))}const pH=71,QL=1,ZL=2,e2=1,mH=2;var cp=function(t){return t[t.AUDIO_LEVEL=1]="AUDIO_LEVEL",t[t.METADATA=2]="METADATA",t[t.AUDIO_64_BIT_PTS=3]="AUDIO_64_BIT_PTS",t}(cp||{});function gH(t){let r=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const s=t.getUint8(0);if(s!==pH)return;const a=t.getUint16(1),c=QL+ZL+a,u=new Uint8Array(t.byteLength-c);u.set(new Uint8Array(t.buffer,c,t.byteLength-c));const h={m:s,tlvLen:a,tlv:[],frame:u};let m=QL+ZL;for(;m<c;){const y=t.getUint8(m),v=t.getUint16(m+e2),S=e2+mH;if(y===cp.AUDIO_LEVEL){let R=t.getUint8(m+S);for(let P=1;P<v;P++)R=R<<8|t.getUint8(m+S+P);h.tlv.push({tag:y,length:v,value:r?127^R>>1:127&R})}else if(y===cp.METADATA||y===cp.AUDIO_64_BIT_PTS){const R=new Uint8Array(v);for(let P=0;P<v;P++)R[P]=t.getUint8(m+S+P);h.tlv.push({tag:y,length:v,value:R})}m+=S+v}return h}const fP=new Map,pP=127,q_=1e-10,t2=139/13,mP=new Map;function n2(t,r,s){const a="".concat(t,"-").concat(r,"-").concat(s);let c=0;return mP.has(a)?c=mP.get(a):(c=Math.log(function(h,m){const y=h-m;m<y&&(m=y);let v=1;for(let S=h,R=1;S>m;S--,R++)v=v*S/R;return v}(r,t))+t*Math.log(.5)+(r-t)*Math.log(1-.5)-Math.log(s)+s*t,mP.set(a,c)),c<q_&&(c=q_),c}function _H(t,r,s){const a=r.length,c=t.length/a;let u=!1;for(let h=0,m=0;h<a;h++){let y=0;for(let v=m+c;m<v;m++)t[m]>s&&y++;r[h]!==y&&(r[h]=y,u=!0)}return u}window.cache=mP;let Nme=0;class yH{constructor(r){Ae(this,"id",void 0),Ae(this,"immediates",[]),Ae(this,"lastNonSilence",-1),Ae(this,"immediateSpeechActivityScore",q_),Ae(this,"lastLevelChangedTime",Date.now()),Ae(this,"levels",[]),Ae(this,"longs",[]),Ae(this,"longSpeechActivityScore",q_),Ae(this,"mediums",[]),Ae(this,"mediumSpeechActivityScore",q_),Ae(this,"minLevel",0),Ae(this,"nextMinLevel",0),Ae(this,"nextMinLevelWindowLength",0),Ae(this,"energyScore",0),this.id=r||"".concat(Nme++),this.immediates.length=50,this.mediums.length=10,this.longs.length=1,this.levels.length=this.immediates.length}computeImmediates(){const r=this.immediates,s=this.levels,a=this.minLevel+t2;let c=!1;for(let u=0;u<r.length;++u){let h=s[u];h<a&&(h=0);const m=Math.floor(h/t2);r[u]!==m&&(r[u]=m,c=!0)}return c}computeLongs(){return _H(this.mediums,this.longs,4)}computeMediums(){return _H(this.immediates,this.mediums,7)}evaluateImmediateSpeechActivityScore(){this.immediateSpeechActivityScore=n2(this.immediates[0],13,.78)}evaluateLongSpeechActivityScore(r){this.longSpeechActivityScore=n2(this.longs[0],10,47),this.longSpeechActivityScore>q_&&(this.lastNonSilence=r)}evaluateMediumSpeechActivityScore(){this.mediumSpeechActivityScore=n2(this.mediums[0],5,24)}evaluateSpeechActivityScores(r){this.computeImmediates()&&(this.evaluateImmediateSpeechActivityScore(),this.computeMediums()&&(this.evaluateMediumSpeechActivityScore(),this.computeLongs()&&this.evaluateLongSpeechActivityScore(r)))}getLastLevelChangedTime(){return this.lastLevelChangedTime}getLevels(){var r;return"[".concat(_m(r=[...this.levels]).call(r).join(),"]")}getSpeechActivityScore(r){switch(r){case 0:return this.immediateSpeechActivityScore;case 1:return this.mediumSpeechActivityScore;case 2:return this.longSpeechActivityScore;default:throw new Error("interval "+r)}}levelChanged(r,s){if(this.lastLevelChangedTime<=s){this.lastLevelChangedTime=s;let a=r;return r<0&&(a=0),r>pP&&(a=pP),this.levels.unshift(a),this.levels.length>this.immediates.length&&this.levels.pop(),this.updateMinLevel(a),a>=this.minLevel+t2?a:a/2}return-1}levelTimedOut(){this.levelChanged(0,this.lastLevelChangedTime)}updateMinLevel(r){if(r!==0){if(this.minLevel===0||this.minLevel>r)return this.minLevel=r,this.nextMinLevel=0,void(this.nextMinLevelWindowLength=0);if(this.nextMinLevel===0)return this.nextMinLevel=r,void(this.nextMinLevelWindowLength=1);if(this.nextMinLevel>r&&(this.nextMinLevel=r),this.nextMinLevelWindowLength++,this.nextMinLevelWindowLength>=750){let s=Math.sqrt(this.minLevel*this.nextMinLevel);s<0?s=0:s>pP&&(s=pP),this.minLevel=s,this.nextMinLevel=0,this.nextMinLevelWindowLength=0}}}}class Dme{constructor(r){Ae(this,"algorithm",void 0),this.algorithm=r}execute(){let r=!this.algorithm;if(!r)try{const s=this.algorithm.runInDecisionMaker(this);s<=0?r=!0:setTimeout(this.execute.bind(this),s)}catch{r=!0}r&&this.algorithm&&this.algorithm.decisionMakerExited(this)}}class r2{constructor(r,s,a){Ae(this,"isDominant",void 0),Ae(this,"energyRanking",void 0),Ae(this,"energyScore",void 0),this.isDominant=r,this.energyRanking=s,this.energyScore=a}}class xme extends Fr{constructor(r){super(),Ae(this,"dominantId",null),Ae(this,"lastDecisionTime",0),Ae(this,"lastLevelChangedTime",0),Ae(this,"lastLevelIdleTime",0),Ae(this,"relativeSpeechActivities",[]),Ae(this,"speakers",new Map),Ae(this,"enableSilence",!1),Ae(this,"timeoutToSilenceInterval",0),Ae(this,"decisionMaker",null),Ae(this,"loudest",[]),Ae(this,"numLoudestToTrack",3),Ae(this,"energyExpireTimeMs",250),Ae(this,"energyAlphaPct",50),this.timeoutToSilenceInterval=r,this.enableSilence=r>0,this.relativeSpeechActivities.length=3}setLoudestConfig(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:3,s=arguments.length>1?arguments[1]:void 0,a=arguments.length>2?arguments[2]:void 0;this.numLoudestToTrack=r,s!=null&&(this.energyExpireTimeMs=s),a!=null&&(this.energyAlphaPct=a),this.loudest.length>r&&this.loudest.splice(r)}getDominantSpeaker(){return this.dominantId}isAmongLoudest(r){return this.loudest.some(s=>s.id===r)}levelChanged(r,s){const a=Date.now(),c=this.getOrCreateSpeaker(r);this.lastLevelChangedTime<a&&(this.lastLevelChangedTime=a,this.maybeStartDecisionMaker());const u=c.levelChanged(s,a);return this.updateLoudestList(c,u,a)}runInDecisionMaker(r){return this.decisionMaker!==r||this.lastDecisionTime>0&&this.lastDecisionTime-this.lastLevelChangedTime>=15e3?-1:this._runInDecisionMaker()}decisionMakerExited(r){this.decisionMaker===r&&(this.decisionMaker=null)}destroy(){this.decisionMaker=null,this.loudest.length=0,this.speakers.clear(),this.removeAllListeners()}addSpeakers(r){r.forEach(s=>{this.speakers.has(s.id)||this.speakers.set(s.id,s)})}removeSpeakers(r){r.forEach(s=>{this.speakers.delete(s.id)})}getOrCreateSpeaker(r){let s=this.speakers.get(r);return s||(s=new yH(r),this.speakers.set(r,s),this.maybeStartDecisionMaker()),s}updateLoudestList(r,s,a){const c=r.id===this.dominantId;if(s<0){let y=0;for(;y<this.loudest.length&&this.loudest[y]!==r;)++y;return new r2(c,y,r.energyScore)}if(r.energyScore=Math.floor((this.energyAlphaPct*s+(100-this.energyAlphaPct)*r.energyScore+50)/100),this.numLoudestToTrack===0)return new r2(c,0,r.energyScore);const u=a-this.energyExpireTimeMs;let h=0;for(;h<this.loudest.length;){const y=this.loudest[h];if(y.getLastLevelChangedTime()<u&&this.loudest.length>=this.numLoudestToTrack)this.loudest.splice(h,1);else if(y.id!==r.id)++h;else if(this.loudest.splice(h,1),this.loudest.length<this.numLoudestToTrack)break}let m=0;for(;m<this.loudest.length&&!(this.loudest[m].energyScore<r.energyScore);)++m;return m<this.numLoudestToTrack&&(this.loudest.splice(m,0,r),this.loudest.length>this.numLoudestToTrack&&this.loudest.splice(this.numLoudestToTrack,1)),new r2(c,m,r.energyScore)}maybeStartDecisionMaker(){!this.decisionMaker&&this.speakers.size>0&&(this.decisionMaker=new Dme(this),this.decisionMaker.execute())}makeDecision(r){let s=null,a=null;const c=this.speakers.size;let u=null;if(c===0)u=null;else if(c===1){var h;const m=Hc(h=this.speakers).call(h).next().value;this.enableSilence&&m&&(u=m.id,m.evaluateSpeechActivityScores(r),r-m.lastNonSilence>this.timeoutToSilenceInterval&&(u=null))}else{let m=this.dominantId==null?null:this.speakers.get(this.dominantId);if(m==null){const S=this.speakers.entries().next();S.value&&(u=S.value[0],m=S.value[1])}else u=m.id;m!=null&&m.evaluateSpeechActivityScores(r);const y=this.relativeSpeechActivities;let v=2;for(const S of this.speakers.entries()){const[R,P]=S;if(P===m)continue;P.evaluateSpeechActivityScores(r);for(let j=0;j<y.length;++j){const Y=m==null?q_:m.getSpeechActivityScore(j);y[j]=Math.log(P.getSpeechActivityScore(j)/Y)}const D=y[0],G=y[1],F=y[2];D>3&&G>2&&F>0&&G>v&&(v=G,u=R)}this.enableSilence&&m!=null&&u===m.id&&r-m.lastNonSilence>this.timeoutToSilenceInterval&&(u=null)}u==null&&!this.enableSilence||u===this.dominantId||(s=this.dominantId,this.dominantId=u,a=this.dominantId),a==null&&!this.enableSilence||a===s||this.emit("ActiveSpeakerChanged",a)}_runInDecisionMaker(){const r=Date.now(),s=300-(r-this.lastLevelIdleTime);let a=0;s<=0?(this.lastLevelIdleTime!==0&&this.timeoutIdleLevels(r),this.lastLevelIdleTime=r):a=s;let c=300-(r-this.lastDecisionTime);return c<=0&&(this.lastDecisionTime=r,this.makeDecision(r),c=300-(Date.now()-r)),c>0&&a>c&&(a=c),a}timeoutIdleLevels(r){const s=[];for(const c of Hc(a=this.speakers).call(a)){var a;const u=r-c.getLastLevelChangedTime();36e5<u&&(this.dominantId==null||c.id!==this.dominantId)?s.push(c.id):300<u&&c.levelTimedOut()}s.forEach(c=>this.speakers.delete(c))}}const iS=new Map;let bd=null,gP=null;const EH=3;let Y_=[];const Td=new Map,_P=new Map;class Lme{get samples(){return this.actives+this.inactives}get activeRate(){return this.actives/this.samples}constructor(r,s){Ae(this,"id",void 0),Ae(this,"track",void 0),Ae(this,"score",0),Ae(this,"active",!0),Ae(this,"muted",!1),Ae(this,"timer",0),Ae(this,"actives",0),Ae(this,"inactives",0),this.id=r,this.track=s,this.setActive(Td.size<3)}autoCheckActive(){this.autoSetActive(),this.autoAdjustActive(),this.resetTimer(),this.actives=0,this.inactives=0}autoSetActive(){const r=this.active;this.active=this.activeRate>=.8;const{actives:s,inactives:a}=function(){const c=[],u=[];return Array.from(Hc(Td).call(Td)).forEach(h=>{h.active?c.push(h):u.push(h)}),{actives:c,inactives:u}}();if(s.length>3){let c;s.forEach(u=>{(!c||c.score>u.score)&&(c=u)}),c&&c.setActive(!1)}if(s.length<3&&a.length>0){let c;a.forEach(u=>{(!c||c.score<u.score)&&u.id!==this.id&&(c=u)}),c&&r&&!this.active&&(c.samples>40&&c.activeRate-this.activeRate>.4?c.setActive(!0):this.active=!0)}this.setMuted(!this.active)}setActive(r){this.active=r,this.resetTimer(),this.setMuted(!r)}autoAdjustActive(){this.active?this.autoSwitchToInactive():this.autoSwitchToActive()}autoSwitchToActive(){const r=function(s){let a;return Array.from(Hc(Td).call(Td)).forEach(c=>{!c.active||c.id===s||c.samples<40||(!a||c.score<a.score)&&(a=c)}),a}(this.id);r&&this.activeRate-r.activeRate>.4&&(r.setActive(!1),this.setActive(!0))}autoSwitchToInactive(){const r=function(s){let a;return Array.from(Hc(Td).call(Td)).forEach(c=>{c.active||c.id===s||c.samples<40||(!a||c.score>a.score)&&(a=c)}),a}(this.id);r&&r.activeRate-this.activeRate>.4&&(r.setActive(!0),this.setActive(!1))}addSample(r){r?this.actives+=1:this.inactives+=1,this.samples>66.66666666666667&&this.autoCheckActive()}setMuted(r){this.track&&(this.track.enabled=!r,this.muted=r)}resetTimer(){this.clearTimer(),this.timer=window.setTimeout(()=>{if(this.samples!==0)return this.samples<50?this.resetTimer():void this.autoCheckActive()},1e3)}clearTimer(){this.timer&&(clearTimeout(this.timer),this.timer=0)}}let yP;function vH(t){const r=Td.get(t);r&&(Td.delete(t),r.clearTimer())}const EP=new Map,Mme=new Map;function Ume(t,r,s){let a=new Uint8Array(t,r,s),c=[],u=0;for(;c.length<s;)u+3<s&&a[u]===0&&a[u+1]===0&&a[u+2]===3&&(a[u+3]===0||a[u+3]===1||a[u+3]===2||a[u+3]===3)?(c.push(a[u],a[u+1],a[u+3]),u+=4):(c.push(a[u]),u++);return new Uint8Array(c)}const vP=new Map,UT=new Map;(function(){const t=Dn();ms.getDisplayMedia=!(!navigator.mediaDevices||!navigator.mediaDevices.getDisplayMedia),ms.getStreamFromExtension=t.name===Gn.CHROME&&Number(t.version)>34,ms.supportUnifiedPlan=function(){if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;const r=new RTCPeerConnection;let s=!1;try{r.addTransceiver("audio"),s=!0}catch{}return r.close(),s}(),ms.supportMinBitrate=t.name===Gn.CHROME||t.name===Gn.EDGE,ms.supportSetRtpSenderParameters=function(){const r=Dn();return!!(window.RTCRtpSender&&window.RTCRtpSender.prototype.setParameters&&window.RTCRtpSender.prototype.getParameters)&&(!!ip()||!(!Ps()&&!YA())||r.name===Gn.FIREFOX&&Number(r.version)>=64)}(),t.name===Gn.SAFARI&&(Number(t.version)>=14?ms.supportDualStream=!0:ms.supportDualStream=!1),ms.webAudioMediaStreamDest=function(){const r=Dn();return!(r.name===Gn.SAFARI&&Number(r.version)<12)}(),ms.supportReplaceTrack=!!window.RTCRtpSender&&typeof RTCRtpSender.prototype.replaceTrack=="function",ms.supportWebGL=typeof WebGLRenderingContext<"u",ms.supportRequestFrame=!!window.CanvasCaptureMediaStreamTrack,ip()||(ms.webAudioWithAEC=!0),ms.supportShareAudio=function(){const r=Dn();return(r.os===Qi.WIN_10||r.os===Qi.WIN_81||r.os===Qi.WIN_7||r.os===Qi.LINUX||r.os===Qi.MAC_OS||r.os===Qi.CHROMIUM_OS)&&r.name===Gn.CHROME&&Number(r.version)>=74}(),ms.supportDataChannel=!!(RT(76)||function(r){const s=Dn();return!(s.name!==Gn.FIREFOX||!s.osVersion)&&Number(s.version)>=r}(68)||C8(14)),ms.supportPCSetConfiguration=function(){const r=window.RTCPeerConnection;return!zr()&&!!r&&r.prototype.setConfiguration instanceof Function}(),ms.supportWebRTCEncodedTransform=function(){const r=Dn();return r.name==="Chrome"&&Number(r.version)>=87||r.name==="Safari"&&Number(r.version)>=15}(),ms.supportWebRTCInsertableStream=function(){const r=Dn();return(r.name===Gn.CHROME||r.name===Gn.EDGE)&&Number(r.version)>=94&&"MediaStreamTrackGenerator"in window&&"MediaStreamTrackProcessor"in window}(),ms.supportRequestVideoFrameCallback="requestVideoFrameCallback"in HTMLVideoElement.prototype,ms.supportWebCrypto=typeof window<"u"&&window.crypto!==void 0&&window.crypto.subtle!==void 0,QA(()=>{ms.supportDualStreamEncoding=function(){const r=Dn();return!!oe("DISABLE_WEBAUDIO")||r.name==="Safari"&&Number(r.version)>=14||!!(r.name==="Chrome"&&/Windows/i.test(r.os||"")&&Number(r.version)>=100&&oe("CHROME_DUAL_STREAM_USE_ENCODING"))}(),x.debug("browser ua: ",navigator.userAgent),x.info("browser info: ",t),x.info("browser compatibility: ",ms)})})();const Vme=["CHINA","GLOBAL"],SH=[[0,1,2,3,4,5,5],[0,2,2,3,4,5,5],[0,3,3,3,4,5,5],[0,4,4,4,4,5,5],[0,5,5,5,5,5,5]],X_=[],sS=[];function J_(t,r){return!!r&&X_.some(s=>s.uid===t&&s.channelName===r)}function i2(){return sS.length>0}var Fme=z6.forEach,bH=Nf("forEach")?[].forEach:function(t){return Fme(this,t,arguments.length>1?arguments[1]:void 0)};zn({target:"Array",proto:!0,forced:[].forEach!=bH},{forEach:bH});var jme=dc("Array").forEach,Bme=xc,Wme=Ii,zme=O,Gme=jme,s2=Array.prototype,Hme={DOMTokenList:!0,NodeList:!0},$me=function(t){var r=t.forEach;return t===s2||zme(s2,t)&&r===s2.forEach||Wme(Hme,Bme(t))?Gme:r},Kme=l($me),qme=Yo,TH=Uc;zn({target:"Object",stat:!0,forced:d(function(){TH(1)})},{keys:function(t){return TH(qme(t))}});var wH=l(gt.Object.keys),Yme=l(mE),Xme=l(_E),Jme=zn,CH=t_,Qme=w_,Zme=ft,RH=ge,ege=yi,tge=Re,nge=eA,rge=Er,ige=Cs,sge=D6("slice"),oge=rge("species"),o2=Array,age=Math.max;Jme({target:"Array",proto:!0,forced:!sge},{slice:function(t,r){var s,a,c,u=tge(this),h=ege(u),m=RH(t,h),y=RH(r===void 0?h:r,h);if(CH(u)&&(s=u.constructor,(Qme(s)&&(s===o2||CH(s.prototype))||Zme(s)&&(s=s[oge])===null)&&(s=void 0),s===o2||s===void 0))return ige(u,m,y);for(a=new(s===void 0?o2:s)(age(y-m,0)),c=0;m<y;m++,c++)m in u&&nge(a,c,u[m]);return a.length=c,a}});var cge=dc("Array").slice,lge=O,uge=cge,a2=Array.prototype,dge=function(t){var r=t.slice;return t===a2||lge(a2,t)&&r===a2.slice?uge:r},hge=l(dge);function wt(t,r,s,a,c){var u,h,m,y={};return Kme(u=wH(a)).call(u,function(v){y[v]=a[v]}),y.enumerable=!!y.enumerable,y.configurable=!!y.configurable,("value"in y||y.initializer)&&(y.writable=!0),y=Yme(h=Xme(m=hge(s).call(s)).call(m)).call(h,function(v,S){return S(t,r,v)||v},y),c&&y.initializer!==void 0&&(y.value=y.initializer?y.initializer.call(c):void 0,y.initializer=void 0),y.initializer===void 0&&(P6(t,r,y),y=null),y}let SP=function(t){return t[t.ACCESS_POINT=101]="ACCESS_POINT",t[t.UNILBS=201]="UNILBS",t[t.STRING_UID_ALLOCATOR=901]="STRING_UID_ALLOCATOR",t}({}),c2=function(t){return t[t.IIIEGAL_APPID=1]="IIIEGAL_APPID",t[t.IIIEGAL_UID=2]="IIIEGAL_UID",t[t.INTERNAL_ERROR=3]="INTERNAL_ERROR",t}({}),wu=function(t){return t[t.INVALID_VENDOR_KEY=5]="INVALID_VENDOR_KEY",t[t.INVALID_CHANNEL_NAME=7]="INVALID_CHANNEL_NAME",t[t.INTERNAL_ERROR=8]="INTERNAL_ERROR",t[t.NO_AUTHORIZED=9]="NO_AUTHORIZED",t[t.DYNAMIC_KEY_TIMEOUT=10]="DYNAMIC_KEY_TIMEOUT",t[t.NO_ACTIVE_STATUS=11]="NO_ACTIVE_STATUS",t[t.DYNAMIC_KEY_EXPIRED=13]="DYNAMIC_KEY_EXPIRED",t[t.STATIC_USE_DYNAMIC_KEY=14]="STATIC_USE_DYNAMIC_KEY",t[t.DYNAMIC_USE_STATIC_KEY=15]="DYNAMIC_USE_STATIC_KEY",t[t.USER_OVERLOAD=16]="USER_OVERLOAD",t[t.FORBIDDEN_REGION=18]="FORBIDDEN_REGION",t[t.CANNOT_MEET_AREA_DEMAND=19]="CANNOT_MEET_AREA_DEMAND",t}({}),jo=function(t){return t[t.NO_FLAG_SET=100]="NO_FLAG_SET",t[t.FLAG_SET_BUT_EMPTY=101]="FLAG_SET_BUT_EMPTY",t[t.INVALID_FALG_SET=102]="INVALID_FALG_SET",t[t.FLAG_SET_BUT_NO_RE=103]="FLAG_SET_BUT_NO_RE",t[t.INVALID_SERVICE_ID=104]="INVALID_SERVICE_ID",t[t.NO_SERVICE_AVAILABLE=200]="NO_SERVICE_AVAILABLE",t[t.NO_SERVICE_AVAILABLE_P2P=201]="NO_SERVICE_AVAILABLE_P2P",t[t.NO_SERVICE_AVAILABLE_VOICE=202]="NO_SERVICE_AVAILABLE_VOICE",t[t.NO_SERVICE_AVAILABLE_WEBRTC=203]="NO_SERVICE_AVAILABLE_WEBRTC",t[t.NO_SERVICE_AVAILABLE_CDS=204]="NO_SERVICE_AVAILABLE_CDS",t[t.NO_SERVICE_AVAILABLE_CDN=205]="NO_SERVICE_AVAILABLE_CDN",t[t.NO_SERVICE_AVAILABLE_TDS=206]="NO_SERVICE_AVAILABLE_TDS",t[t.NO_SERVICE_AVAILABLE_REPORT=207]="NO_SERVICE_AVAILABLE_REPORT",t[t.NO_SERVICE_AVAILABLE_APP_CENTER=208]="NO_SERVICE_AVAILABLE_APP_CENTER",t[t.NO_SERVICE_AVAILABLE_ENV0=209]="NO_SERVICE_AVAILABLE_ENV0",t[t.NO_SERVICE_AVAILABLE_VOET=210]="NO_SERVICE_AVAILABLE_VOET",t[t.NO_SERVICE_AVAILABLE_STRING_UID=211]="NO_SERVICE_AVAILABLE_STRING_UID",t[t.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS=212]="NO_SERVICE_AVAILABLE_WEBRTC_UNILBS",t[t.NO_SERVICE_AVAILABLE_UNILBS_FLV=213]="NO_SERVICE_AVAILABLE_UNILBS_FLV",t}({}),Mt=function(t){return t[t.K_TIMESTAMP_EXPIRED=2]="K_TIMESTAMP_EXPIRED",t[t.K_CHANNEL_PERMISSION_INVALID=3]="K_CHANNEL_PERMISSION_INVALID",t[t.K_CERTIFICATE_INVALID=4]="K_CERTIFICATE_INVALID",t[t.K_CHANNEL_NAME_EMPTY=5]="K_CHANNEL_NAME_EMPTY",t[t.K_CHANNEL_NOT_FOUND=6]="K_CHANNEL_NOT_FOUND",t[t.K_TICKET_INVALID=7]="K_TICKET_INVALID",t[t.K_CHANNEL_CONFLICTED=8]="K_CHANNEL_CONFLICTED",t[t.K_SERVICE_NOT_READY=9]="K_SERVICE_NOT_READY",t[t.K_SERVICE_TOO_HEAVY=10]="K_SERVICE_TOO_HEAVY",t[t.K_UID_BANNED=14]="K_UID_BANNED",t[t.K_IP_BANNED=15]="K_IP_BANNED",t[t.K_CHANNEL_BANNED=16]="K_CHANNEL_BANNED",t[t.DATASTREAM2_NOT_AVAILABLE=27]="DATASTREAM2_NOT_AVAILABLE",t[t.K_AUTO_REBALANCE=28]="K_AUTO_REBALANCE",t[t.WARN_NO_AVAILABLE_CHANNEL=103]="WARN_NO_AVAILABLE_CHANNEL",t[t.WARN_LOOKUP_CHANNEL_TIMEOUT=104]="WARN_LOOKUP_CHANNEL_TIMEOUT",t[t.WARN_LOOKUP_CHANNEL_REJECTED=105]="WARN_LOOKUP_CHANNEL_REJECTED",t[t.WARN_OPEN_CHANNEL_TIMEOUT=106]="WARN_OPEN_CHANNEL_TIMEOUT",t[t.WARN_OPEN_CHANNEL_REJECTED=107]="WARN_OPEN_CHANNEL_REJECTED",t[t.WARN_REQUEST_DEFERRED=108]="WARN_REQUEST_DEFERRED",t[t.ERR_DYNAMIC_KEY_TIMEOUT=109]="ERR_DYNAMIC_KEY_TIMEOUT",t[t.ERR_NO_AUTHORIZED=110]="ERR_NO_AUTHORIZED",t[t.ERR_VOM_SERVICE_UNAVAILABLE=111]="ERR_VOM_SERVICE_UNAVAILABLE",t[t.ERR_NO_CHANNEL_AVAILABLE_CODE=112]="ERR_NO_CHANNEL_AVAILABLE_CODE",t[t.ERR_MASTER_VOCS_UNAVAILABLE=114]="ERR_MASTER_VOCS_UNAVAILABLE",t[t.ERR_INTERNAL_ERROR=115]="ERR_INTERNAL_ERROR",t[t.ERR_NO_ACTIVE_STATUS=116]="ERR_NO_ACTIVE_STATUS",t[t.ERR_INVALID_UID=117]="ERR_INVALID_UID",t[t.ERR_DYNAMIC_KEY_EXPIRED=118]="ERR_DYNAMIC_KEY_EXPIRED",t[t.ERR_STATIC_USE_DYANMIC_KE=119]="ERR_STATIC_USE_DYANMIC_KE",t[t.ERR_DYNAMIC_USE_STATIC_KE=120]="ERR_DYNAMIC_USE_STATIC_KE",t[t.ERR_NO_VOCS_AVAILABLE=2e3]="ERR_NO_VOCS_AVAILABLE",t[t.ERR_NO_VOS_AVAILABLE=2001]="ERR_NO_VOS_AVAILABLE",t[t.ERR_JOIN_CHANNEL_TIMEOUT=2002]="ERR_JOIN_CHANNEL_TIMEOUT",t[t.ERR_REPEAT_JOIN_CHANNEL=2003]="ERR_REPEAT_JOIN_CHANNEL",t[t.ERR_JOIN_BY_MULTI_IP=2004]="ERR_JOIN_BY_MULTI_IP",t[t.ERR_NOT_JOINED=2011]="ERR_NOT_JOINED",t[t.ERR_REPEAT_JOIN_REQUEST=2012]="ERR_REPEAT_JOIN_REQUEST",t[t.ERR_INVALID_VENDOR_KEY=2013]="ERR_INVALID_VENDOR_KEY",t[t.ERR_INVALID_CHANNEL_NAME=2014]="ERR_INVALID_CHANNEL_NAME",t[t.ERR_INVALID_STRINGUID=2015]="ERR_INVALID_STRINGUID",t[t.ERR_TOO_MANY_USERS=2016]="ERR_TOO_MANY_USERS",t[t.ERR_SET_CLIENT_ROLE_TIMEOUT=2017]="ERR_SET_CLIENT_ROLE_TIMEOUT",t[t.ERR_SET_CLIENT_ROLE_NO_PERMISSION=2018]="ERR_SET_CLIENT_ROLE_NO_PERMISSION",t[t.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE=2019]="ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",t[t.ERR_PUBLISH_REQUEST_INVALID=2020]="ERR_PUBLISH_REQUEST_INVALID",t[t.ERR_SUBSCRIBE_REQUEST_INVALID=2021]="ERR_SUBSCRIBE_REQUEST_INVALID",t[t.ERR_NOT_SUPPORTED_MESSAGE=2022]="ERR_NOT_SUPPORTED_MESSAGE",t[t.ERR_ILLEAGAL_PLUGIN=2023]="ERR_ILLEAGAL_PLUGIN",t[t.ERR_REJOIN_TOKEN_INVALID=2024]="ERR_REJOIN_TOKEN_INVALID",t[t.ERR_REJOIN_USER_NOT_JOINED=2025]="ERR_REJOIN_USER_NOT_JOINED",t[t.ERR_INVALID_OPTIONAL_INFO=2027]="ERR_INVALID_OPTIONAL_INFO",t[t.ILLEGAL_AES_PASSWORD=2028]="ILLEGAL_AES_PASSWORD",t[t.ILLEGAL_CLIENT_ROLE_LEVEL=2029]="ILLEGAL_CLIENT_ROLE_LEVEL",t[t.ERR_TOO_MANY_BROADCASTERS=2031]="ERR_TOO_MANY_BROADCASTERS",t[t.ERR_TOO_MANY_SUBSCRIBERS=2032]="ERR_TOO_MANY_SUBSCRIBERS",t[t.ERR_LICENSE_MISSING=32769]="ERR_LICENSE_MISSING",t[t.ERR_LICENSE_EXPIRED=32771]="ERR_LICENSE_EXPIRED",t[t.ERR_LICENSE_MINUTES_EXCEEDED=32773]="ERR_LICENSE_MINUTES_EXCEEDED",t[t.ERR_LICENSE_PERIOD_INVALID=32774]="ERR_LICENSE_PERIOD_INVALID",t[t.ERR_LICENSE_MULTIPLE_SDK_SERVICE=32778]="ERR_LICENSE_MULTIPLE_SDK_SERVICE",t[t.ERR_LICENSE_ILLEGAL=32783]="ERR_LICENSE_ILLEGAL",t[t.ERR_TEST_RECOVER=9e3]="ERR_TEST_RECOVER",t[t.ERR_TEST_TRYNEXT=9001]="ERR_TEST_TRYNEXT",t[t.ERR_TEST_RETRY=9002]="ERR_TEST_RETRY",t}({}),gr=function(t){return t.CONNECTING="connecting",t.CONNECTED="connected",t.RECONNECTING="reconnecting",t.CLOSED="closed",t}({}),Ht=function(t){return t.WS_CONNECTED="ws_connected",t.WS_RECONNECTING="ws_reconnecting",t.WS_CLOSED="ws_closed",t.WS_RECONNECT_CREATE_CONNECTION="ws_reconnect_create_connection",t.ON_BINARY_DATA="on_binary_data",t.REQUEST_RECOVER="request_recover",t.REQUEST_JOIN_INFO="request_join_info",t.REQUEST_REJOIN_INFO="req_rejoin_info",t.IS_P2P_DISCONNECTED="is_p2p_dis",t.DISCONNECT_P2P="dis_p2p",t.ABORT_P2P_EXECUTION="abort_p2p_execution",t.NEED_RENEW_SESSION="need-sid",t.REPORT_JOIN_GATEWAY="report_join_gateway",t.REQUEST_TIMEOUT="request_timeout",t.REQUEST_SUCCESS="request_success",t.JOIN_RESPONSE="join_response",t.PRE_CONNECT_PC="pre_connect_pc",t.P2P_CONNECTION="p2p_connection",t.P2P_REMOTE_CANDIDATE_UPDATE="p2p_remote_candidate_update",t.P2P_SUBSCRIBE="p2p_subscribe",t.P2P_UNSUBSCRIBE="p2p_unsubscribe",t.P2P_EXCHANGE_SDP="p2p_exchange_sdp",t.P2P_ON_ADD_VIDEO_STREAM="p2p_on_add_video_stream",t.P2P_ON_ADD_AUDIO_STREAM="p2p_on_add_audio_stream",t.RECOVER_NOTIFICATION="recover_notification",t}({}),Gt=function(t){return t.PING="ping",t.PING_BACK="ping_back",t.JOIN="join_v3",t.REJOIN="rejoin_v3",t.LEAVE="leave",t.SET_CLIENT_ROLE="set_client_role",t.PUBLISH="publish",t.PUBLISH_DATASTREAM="publish_datastream",t.UNPUBLISH="unpublish",t.UNPUBLISH_DATASTREAM="unpublish_datastream",t.SUBSCRIBE="subscribe",t.PRE_SUBSCRIBE="pre_subscribe",t.SUBSCRIBE_DATASTREAM="subscribe_datastream",t.SUBSCRIBE_STREAMS="subscribe_streams",t.UNSUBSCRIBE="unsubscribe",t.UNSUBSCRIBE_DATASTREAM="unsubscribe_datastream",t.UNSUBSCRIBE_STREAMS="unsubscribe_streams",t.SUBSCRIBE_CHANGE="subscribe_change",t.TRAFFIC_STATS="traffic_stats",t.RENEW_TOKEN="renew_token",t.SWITCH_VIDEO_STREAM="switch_video_stream",t.DEFAULT_VIDEO_STREAM="default_video_stream",t.SET_FALLBACK_OPTION="set_fallback_option",t.GATEWAY_INFO="gateway_info",t.CONTROL="control",t.SEND_METADATA="send_metadata",t.DATA_STREAM="data_stream",t.PICK_SVC_LAYER="pick_svc_layer",t.RESTART_ICE="restart_ice",t.CONNECT_PC="connect_pc",t.SET_VIDEO_PROFILE="set_video_profile",t.SET_PARAMETER="set_parameter",t.SET_RTM2_FLAG="set_rtm2_flag",t}({}),VT=function(t){return t.WRTC_STATS="wrtc_stats",t.WS_INFLATE_DATA_LENGTH="ws_inflate_data_length",t.DENOISER_STATS="denoiser_stats",t.EXTENSION_USAGE_STATS="extension_usage_stats",t}({}),wn=function(t){return t.ON_USER_ONLINE="on_user_online",t.ON_USER_OFFLINE="on_user_offline",t.ON_STREAM_FALLBACK_UPDATE="on_stream_fallback_update",t.ON_PUBLISH_STREAM="on_publish_stream",t.ON_UPLINK_STATS="on_uplink_stats",t.ON_P2P_LOST="on_p2p_lost",t.ON_REMOVE_STREAM="on_remove_stream",t.ON_ADD_AUDIO_STREAM="on_add_audio_stream",t.ON_ADD_VIDEO_STREAM="on_add_video_stream",t.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="on_token_privilege_will_expire",t.ON_TOKEN_PRIVILEGE_DID_EXPIRE="on_token_privilege_did_expire",t.ON_USER_BANNED="on_user_banned",t.ON_USER_LICENSE_BANNED="on_user_license_banned",t.ON_NOTIFICATION="on_notification",t.ON_CRYPT_ERROR="on_crypt_error",t.MUTE_AUDIO="mute_audio",t.MUTE_VIDEO="mute_video",t.UNMUTE_AUDIO="unmute_audio",t.UNMUTE_VIDEO="unmute_video",t.ON_P2P_OK="on_p2p_ok",t.RECEIVE_METADATA="receive_metadata",t.ON_DATA_STREAM="on_data_stream",t.ON_RTP_CAPABILITY_CHANGE="on_rtp_capability_change",t.ON_REMOTE_DATASTREAM_UPDATE="on_remote_datastream_update",t.ON_REMOTE_FULL_DATASTREAM_INFO="on_remote_full_datastream_info",t.ENABLE_LOCAL_VIDEO="enable_local_video",t.DISABLE_LOCAL_VIDEO="disable_local_video",t.ENABLE_LOCAL_AUDIO="enable_local_audio",t.DISABLE_LOCAL_AUDIO="disable_local_audio",t.ON_PUBLISHED_USER_LIST="on_published_user_list",t}({}),Bo=function(t){return t.SEND_ONLY="SEND_ONLY",t.RECEIVE_ONLY="RECEIVE_ONLY",t}({}),Zt=function(t){return t.CONNECTED="websocket:connected",t.RECONNECTING="websocket:reconnecting",t.WILL_RECONNECT="websocket:will_reconnect",t.CLOSED="websocket:closed",t.FAILED="websocket:failed",t.ON_MESSAGE="websocket:on_message",t.REQUEST_NEW_URLS="websocket:request_new_urls",t.RECONNECT_CREATE_CONNECTION="websocket:reconnect_create_connection",t.ON_TOKEN_PRIVILEGE_DID_EXPIRE="websocket:on_token_privilege_did_expire",t}({});function bP(t){if(typeof t!="string"||!/^[a-zA-Z0-9 \!\#\$\%\&\(\)\+\-\:\;\<\=\.\>\?\@\[\]\^\_\{\}\|\~\,]{1,64}$/.test(t))throw x.error("Invalid Channel Name ".concat(t)),new Oe(te.INVALID_PARAMS,"The length must be within 64 bytes. The supported characters: a-z,A-Z,0-9,space,!, #, $, %, &, (, ), +, -, :, ;, <, =, ., >, ?, @, [, ], ^, _,  {, }, |, ~, ,")}function TP(t){if(r=t,!(typeof r=="number"&&Math.floor(r)===r&&0<=r&&r<=4294967295||D8(t,1,255)))throw new Oe(te.INVALID_PARAMS,"[String uid] Length of the string: [1,255]. ASCII characters only. [Number uid] The value range is [0,10000]");var r;typeof t=="string"&&x.warn("You input a string as the user ID, to ensure better end-user experience, Agora highly suggests not using a string as the user ID.")}let lp=function(t){return t.TRANSCODE="mix_streaming",t.RAW="raw_streaming",t}({});const fge={alpha:1,height:640,width:360,x:0,y:0,zOrder:0,audioChannel:0},l2={x:0,y:0,width:160,height:160,zOrder:255,alpha:1};function u2(t,r){fs(t.url,"".concat(r,".url"),1,1e3,!1),Gr(t.x)||or(t.x,"".concat(r,".x"),0,1e4),Gr(t.y)||or(t.y,"".concat(r,".y"),0,1e4),Gr(t.width)||or(t.width,"".concat(r,".width"),0,1e4),Gr(t.height)||or(t.height,"".concat(r,".height"),0,1e4),Gr(t.zOrder)||or(t.zOrder,"".concat(r,".zOrder"),0,255),Gr(t.alpha)||or(t.alpha,"".concat(r,".alpha"),0,1,!1)}const pge={audioBitrate:48,audioChannels:1,audioSampleRate:48e3,backgroundColor:0,height:360,lowLatency:!1,videoBitrate:400,videoCodecProfile:100,videoCodecType:1,videoFrameRate:15,videoGop:30,width:640,images:[],userConfigs:[],userConfigExtraInfo:""};let Km=function(t){return t.WARNING="@live_uap-warning",t.ERROR="@line_uap-error",t.PUBLISH_STREAM_STATUS="@live_uap-publish-status",t.WORKER_STATUS="@live_uap-worker-status",t.REQUEST_NEW_ADDRESS="@live_uap-request-address",t}({}),d2=function(t){return t.REQUEST_WORKER_MANAGER_LIST="@live_req_worker_manager",t}({}),ji=function(t){return t[t.LIVE_STREAM_RESPONSE_SUCCEED=200]="LIVE_STREAM_RESPONSE_SUCCEED",t[t.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM=454]="LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM",t[t.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR=450]="LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR",t[t.LIVE_STREAM_RESPONSE_BAD_STREAM=451]="LIVE_STREAM_RESPONSE_BAD_STREAM",t[t.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR=400]="LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR",t[t.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST=404]="LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST",t[t.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED=456]="LIVE_STREAM_RESPONSE_NOT_AUTHORIZED",t[t.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE=457]="LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE",t[t.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN=429]="LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN",t[t.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH=452]="LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH",t[t.LIVE_STREAM_RESPONSE_NOT_SUPPORTED=453]="LIVE_STREAM_RESPONSE_NOT_SUPPORTED",t[t.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM=455]="LIVE_STREAM_RESPONSE_MAX_STREAM_NUM",t[t.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR=500]="LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR",t[t.LIVE_STREAM_RESPONSE_WORKER_LOST=501]="LIVE_STREAM_RESPONSE_WORKER_LOST",t[t.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT=502]="LIVE_STREAM_RESPONSE_RESOURCE_LIMIT",t[t.LIVE_STREAM_RESPONSE_WORKER_QUIT=503]="LIVE_STREAM_RESPONSE_WORKER_QUIT",t[t.ERROR_FAIL_SEND_MESSAGE=504]="ERROR_FAIL_SEND_MESSAGE",t[t.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE=30]="PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE",t[t.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT=31]="PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT",t[t.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH=32]="PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH",t[t.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN=33]="PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN",t}({});function IH(t){if(!t.channelName)throw new Oe(te.INVALID_PARAMS,"invalid channelName in info");if(typeof t.uid!="number")throw new Oe(te.INVALID_PARAMS,"invalid uid in info, uid must be a number");return t.token&&fs(t.token,"info.token",1,2047),TP(t.uid),bP(t.channelName),!0}let Wo=function(t){return t[t.SetSdkProfile=0]="SetSdkProfile",t[t.SetSourceChannel=1]="SetSourceChannel",t[t.SetSourceUserId=2]="SetSourceUserId",t[t.SetDestChannel=3]="SetDestChannel",t[t.StartPacketTransfer=4]="StartPacketTransfer",t[t.StopPacketTransfer=5]="StopPacketTransfer",t[t.UpdateDestChannel=6]="UpdateDestChannel",t[t.Reconnect=7]="Reconnect",t[t.SetVideoProfile=8]="SetVideoProfile",t}({}),up=function(t){return t.NETWORK_DISCONNECTED="NETWORK_DISCONNECTED",t.NETWORK_CONNECTED="NETWORK_CONNECTED",t.PACKET_JOINED_SRC_CHANNEL="PACKET_JOINED_SRC_CHANNEL",t.PACKET_JOINED_DEST_CHANNEL="PACKET_JOINED_DEST_CHANNEL",t.PACKET_SENT_TO_DEST_CHANNEL="PACKET_SENT_TO_DEST_CHANNEL",t.PACKET_RECEIVED_VIDEO_FROM_SRC="PACKET_RECEIVED_VIDEO_FROM_SRC",t.PACKET_RECEIVED_AUDIO_FROM_SRC="PACKET_RECEIVED_AUDIO_FROM_SRC",t.PACKET_UPDATE_DEST_CHANNEL="PACKET_UPDATE_DEST_CHANNEL",t.PACKET_UPDATE_DEST_CHANNEL_REFUSED="PACKET_UPDATE_DEST_CHANNEL_REFUSED",t.PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE="PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE",t}({}),za=function(t){return t.RELAY_STATE_IDLE="RELAY_STATE_IDLE",t.RELAY_STATE_CONNECTING="RELAY_STATE_CONNECTING",t.RELAY_STATE_RUNNING="RELAY_STATE_RUNNING",t.RELAY_STATE_FAILURE="RELAY_STATE_FAILURE",t}({}),oS=function(t){return t.RELAY_OK="RELAY_OK",t.SERVER_CONNECTION_LOST="SERVER_CONNECTION_LOST",t.SRC_TOKEN_EXPIRED="SRC_TOKEN_EXPIRED",t.DEST_TOKEN_EXPIRED="DEST_TOKEN_EXPIRED",t}({}),Xn=function(t){return t.High="high",t.Low="low",t.Audio="audio",t.Screen="screen",t.ScreenLow="screen_low",t}({}),ls=function(t){return t.DISCONNECT="disconnect",t.CONNECTION_STATE_CHANGE="connection-state-change",t.NETWORK_QUALITY="network-quality",t.STREAM_TYPE_CHANGE="stream-type-change",t.IS_P2P_DISCONNECTED="is-p2p-dis",t.DISCONNECT_P2P="dis-p2p",t.REQUEST_NEW_GATEWAY_LIST="req-gate-url",t.NEED_RENEW_SESSION="need-sid",t.REQUEST_P2P_CONNECTION_PARAMS="request-p2p-connection-params",t.JOIN_RESPONSE="join-response",t.RESET_CONNECTION_EVENTS="reset-connection-events",t.PRE_CONNECT_PC="pre-connect_pc",t.UPDATE_GATEWAY_CONFIG="update-gateway-config",t}({}),wP=function(t){return t.P2P_DISCONNECTED="P2P_DISCONNECTED",t.A_ROUND_WS_FAILED="A_ROUND_WS_FAILED",t.TIMEOUT="TIMEOUT",t.UNKNOWN_REASON="UNKNOWN_REASON",t}({}),es=function(t){return t[t.Nothing=0]="Nothing",t[t.Audio=1]="Audio",t[t.LwoVideo=2]="LwoVideo",t[t.Video=4]="Video",t[t.Data=8]="Data",t[t.DataStream0=256]="DataStream0",t[t.DataStream1=512]="DataStream1",t[t.DataStream2=1024]="DataStream2",t[t.DataStream3=2048]="DataStream3",t[t.DataStream4=4096]="DataStream4",t[t.DataStream5=8192]="DataStream5",t[t.DataStream6=16384]="DataStream6",t[t.DataStream7=32768]="DataStream7",t}({}),Hn=function(t){return t.CHINA="CHINA",t.ASIA="ASIA",t.NORTH_AMERICA="NORTH_AMERICA",t.EUROPE="EUROPE",t.JAPAN="JAPAN",t.INDIA="INDIA",t.KOREA="KOREA",t.HKMC="HKMC",t.US="US",t.OCEANIA="OCEANIA",t.SOUTH_AMERICA="SOUTH_AMERICA",t.AFRICA="AFRICA",t.OVERSEA="OVERSEA",t.GLOBAL="GLOBAL",t.EXTENSIONS="EXTENSIONS",t}({});const AH=[Hn.AFRICA,Hn.ASIA,Hn.CHINA,Hn.EUROPE,Hn.GLOBAL,Hn.INDIA,Hn.JAPAN,Hn.NORTH_AMERICA,Hn.OCEANIA,Hn.OVERSEA,Hn.SOUTH_AMERICA];let js=function(t){return t.CHINA="CN",t.ASIA="AS",t.NORTH_AMERICA="NA",t.EUROPE="EU",t.JAPAN="JP",t.INDIA="IN",t.KOREA="KR",t.HKMC="HK",t.US="US",t.OCEANIA="OC",t.SOUTH_AMERICA="SA",t.AFRICA="AF",t.OVERSEA="OVERSEA",t.GLOBAL="GLOBAL",t.EXTENSIONS="GLOBAL",t}({});const CP={CHINA:{},ASIA:{CODE:js.ASIA,WEBCS_DOMAIN:["ap-web-1-asia.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-asia.agora.io"],PROXY_CS:["proxy-ap-web-asia.agora.io"],CDS_AP:["cds-ap-web-asia.agora.io","cds-ap-web-asia2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-asia.agora.io","sua-ap-web-asia2.agora.io"],UAP_AP:["uap-ap-web-asia.agora.io","uap-ap-web-asia2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"],PROXY_SERVER_TYPE3:["southeast-asia.webrtc-cloud-proxy.sd-rtn.com"]},NORTH_AMERICA:{CODE:js.NORTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-north-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-north-america.agora.io"],PROXY_CS:["proxy-ap-web-america.agora.io"],CDS_AP:["cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],UAP_AP:["uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"],PROXY_SERVER_TYPE3:["east-usa.webrtc-cloud-proxy.sd-rtn.com"]},EUROPE:{CODE:js.EUROPE,WEBCS_DOMAIN:["ap-web-1-europe.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-europe.agora.io"],PROXY_CS:["proxy-ap-web-europe.agora.io"],CDS_AP:["cds-ap-web-europe.agora.io","cds-ap-web-europe2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-europe.agora.io","sua-ap-web-europe.agora.io"],UAP_AP:["uap-ap-web-europe.agora.io","uap-ap-web-europe2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"],PROXY_SERVER_TYPE3:["europe.webrtc-cloud-proxy.sd-rtn.com"]},JAPAN:{CODE:js.JAPAN,WEBCS_DOMAIN:["ap-web-1-japan.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-japan.agora.io"],PROXY_CS:["proxy-ap-web-japan.agora.io"],CDS_AP:["cds-ap-web-japan.agora.io","cds-ap-web-japan2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-japan.agora.io","sua-ap-web-japan2.agora.io"],UAP_AP:["uap-ap-web-japan.agora.io","uap-ap-web-japan2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"],PROXY_SERVER_TYPE3:["japan.webrtc-cloud-proxy.sd-rtn.com"]},INDIA:{CODE:js.INDIA,WEBCS_DOMAIN:["ap-web-1-india.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-india.agora.io"],PROXY_CS:["proxy-ap-web-india.agora.io"],CDS_AP:["cds-ap-web-india.agora.io","cds-ap-web-india2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-india.agora.io","sua-ap-web-india2.agora.io"],UAP_AP:["uap-ap-web-india.agora.io","uap-ap-web-india2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"],PROXY_SERVER_TYPE3:["india.webrtc-cloud-proxy.sd-rtn.com"]},KOREA:{CODE:js.KOREA,WEBCS_DOMAIN:["ap-web-1-korea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-korea.agora.io"],PROXY_CS:["proxy-ap-web-korea.agora.io"],CDS_AP:["cds-ap-web-korea.agora.io","cds-ap-web-korea2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-korea.agora.io","sua-ap-web-korea2.agora.io"],UAP_AP:["uap-ap-web-korea.agora.io","uap-ap-web-korea2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-korea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-korea.agora.io"],LOG_UPLOAD_SERVER:["logservice-korea.agora.io"],PROXY_SERVER_TYPE3:["korea.webrtc-cloud-proxy.sd-rtn.com"]},HKMC:{CODE:js.HKMC,WEBCS_DOMAIN:["ap-web-1-hkmc.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-hkmc.agora.io"],PROXY_CS:["proxy-ap-web-hkmc.agora.io"],CDS_AP:["cds-ap-web-hkmc.agora.io","cds-ap-web-hkmc2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-hkmc.agora.io","sua-ap-web-hkmc2.agora.io"],UAP_AP:["uap-ap-web-hkmc.agora.io","uap-ap-web-hkmc2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-hkmc.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-hkmc.agora.io"],LOG_UPLOAD_SERVER:["logservice-hkmc.agora.io"],PROXY_SERVER_TYPE3:["hkmc.webrtc-cloud-proxy.sd-rtn.com"]},US:{CODE:js.US,WEBCS_DOMAIN:["ap-web-1-us.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-us.agora.io"],PROXY_CS:["proxy-ap-web-us.agora.io"],CDS_AP:["cds-ap-web-us.agora.io","cds-ap-web-us2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-us.agora.io","sua-ap-web-us2.agora.io"],UAP_AP:["uap-ap-web-us.agora.io","uap-ap-web-us2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-us.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-us.agora.io"],LOG_UPLOAD_SERVER:["logservice-us.agora.io"],PROXY_SERVER_TYPE3:["us.webrtc-cloud-proxy.sd-rtn.com"]},OVERSEA:{CODE:js.OVERSEA,WEBCS_DOMAIN:["ap-web-1-oversea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oversea.agora.io"],PROXY_CS:["proxy-ap-web-oversea.agora.io"],CDS_AP:["cds-ap-web-oversea.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oversea.agora.io"],UAP_AP:["uap-ap-web-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.agora.io"]},GLOBAL:{CODE:js.GLOBAL,WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-ap-web-3.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-ap-web-3.agora.io"],UAP_AP:["uap-ap-web-1.agora.io","uap-ap-web-3.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2.agora.io"],LOG_UPLOAD_SERVER:["logservice.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com"]},OCEANIA:{CODE:js.OCEANIA,WEBCS_DOMAIN:["ap-web-1-oceania.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oceania.agora.io"],PROXY_CS:["proxy-ap-web-oceania.agora.io"],CDS_AP:["cds-ap-web-oceania.agora.io","cds-ap-web-oceania2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oceania.agora.io","sua-ap-web-oceania2.agora.io"],UAP_AP:["uap-ap-web-oceania.agora.io","uap-ap-web-oceania2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"],PROXY_SERVER_TYPE3:["oceania.webrtc-cloud-proxy.sd-rtn.com"]},SOUTH_AMERICA:{CODE:js.SOUTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-south-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-south-america.agora.io"],PROXY_CS:["proxy-ap-web-south-america.agora.io"],CDS_AP:["cds-ap-web-south-america.agora.io","cds-ap-web-south-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-south-america.agora.io","sua-ap-web-south-america2.agora.io"],UAP_AP:["uap-ap-web-south-america.agora.io","uap-ap-web-south-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"],PROXY_SERVER_TYPE3:["south-america.webrtc-cloud-proxy.sd-rtn.com"]},AFRICA:{CODE:js.AFRICA,WEBCS_DOMAIN:["ap-web-1-africa.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-africa.agora.io"],PROXY_CS:["proxy-ap-web-africa.agora.io"],CDS_AP:["cds-ap-web-africa.agora.io","cds-ap-web-africa2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-africa.agora.io","sua-ap-web-africa2.agora.io"],UAP_AP:["uap-ap-web-africa.agora.io","uap-ap-web-africa2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"],PROXY_SERVER_TYPE3:["africa.webrtc-cloud-proxy.sd-rtn.com"]},EXTENSIONS:{}};NL&&(CP.CHINA={CODE:js.CHINA,WEBCS_DOMAIN:["webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["proxy-web.ap.sd-rtn.com"],CDS_AP:["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-web-2.ap.sd-rtn.com","uap-web-4.ap.sd-rtn.com"],EVENT_REPORT_DOMAIN:["web-3.statscollector.sd-rtn.com"],EVENT_REPORT_BACKUP_DOMAIN:["web-4.statscollector.sd-rtn.com"],LOG_UPLOAD_SERVER:["logservice-china.agora.io"],PROXY_SERVER_TYPE3:["east-cn.webrtc-cloud-proxy.sd-rtn.com"]});let FT=function(t){return t.UPDATE_BITRATE_LIMIT="update_bitrate_limit",t.UPDATE_CLIENT_ROLE_OPTIONS="update_client_role_options",t}({});function PH(t){return!!t&&!(!t.uplink||!t.id)&&t.uplink.max_bitrate!==void 0&&t.uplink.min_bitrate!==void 0}class OH extends Fr{constructor(r,s){super(),K(this,"onICEConnectionStateChange",void 0),K(this,"onConnectionStateChange",void 0),K(this,"onDTLSTransportStateChange",void 0),K(this,"onDTLSTransportError",void 0),K(this,"onICETransportStateChange",void 0),K(this,"onFirstAudioReceived",void 0),K(this,"onFirstVideoReceived",void 0),K(this,"onFirstAudioDecoded",void 0),K(this,"onFirstVideoDecoded",void 0),K(this,"onFirstVideoDecodedTimeout",void 0),K(this,"onSelectedLocalCandidateChanged",void 0),K(this,"onSelectedRemoteCandidateChanged",void 0),K(this,"onICECandidateError",void 0),K(this,"getLocalVideoStats",void 0)}}class kH extends OH{constructor(r,s){super(r,s),K(this,"establishPromise",void 0)}}let Et=function(t){return t.VIDEO="video",t.AUDIO="audio",t}({}),Bs=function(t){return t.UDP_RELAY="udp_relay",t.UDP_TCP_RELAY="udp_tcp_relay",t.TCP_RELAY="tcp_relay",t.RELAY="relay",t}({}),dp=function(t){return t[t.FIRST_CONNECTION=0]="FIRST_CONNECTION",t[t.UDP_TCP_RESTART=1]="UDP_TCP_RESTART",t[t.RELAY_RESTART=2]="RELAY_RESTART",t[t.TCP_RESTART=3]="TCP_RESTART",t[t.OLD_FIRST_CONNECTION=10]="OLD_FIRST_CONNECTION",t[t.OLD_RESTART=11]="OLD_RESTART",t[t.DISCONNECTED_OR_FAILED=20]="DISCONNECTED_OR_FAILED",t}({});const NH=["disconnected","failed"];let Ke=function(t){return t.LocalVideoTrack="videoTrack",t.LocalAudioTrack="audioTrack",t.LocalVideoLowTrack="videoLowTrack",t}({}),Yn=function(t){return t.New="new",t.Connected="connected",t.Reconnecting="reconnecting",t.Disconnected="disconnected",t}({}),xt=function(t){return t.AudioMetadata="audioMetadata",t.StateChange="stateChange",t.IceConnectionStateChange="iceConnectionStateChange",t.RequestMuteLocal="requestMuteLocal",t.RequestUnmuteLocal="requestUnmuteLocal",t.RequestRePublish="requestRePublish",t.RequestRePublishDataChannel="requestRePublishDataChannel",t.RequestReSubscribe="requestReSubscribe",t.RequestUploadStats="requestUploadStats",t.RequestUpload="requestUpload",t.MediaReconnectStart="MediaReconnectStart",t.MediaReconnectEnd="MediaReconnectEnd",t.NeedSignalRTT="NeedSignalRTT",t.RequestRestartICE="RequestRestartIce",t.PeerConnectionStateChange="PeerConnectionStateChange",t.RequestReconnect="RequestReconnect",t.RequestReconnectPC="RequestReconnectPC",t.RequestUnpublishForReconnectPC="RequestUnpublishForReconnectPC",t.P2PLost="P2PLost",t.UpdateVideoEncoder="UpdateVideoEncoder",t.ConnectionTypeChange="ConnectionTypeChange",t.RequestLowStreamParameter="RequestLowStreamParameter",t.QueryClientConnectionState="QueryClientConnectionState",t.LocalCandidate="LocalCandidate",t.RequestP2PMuteLocal="requestP2PMuteLocal",t.RequestP2PUnPublish="RequestP2PUnPublish",t.RequestP2PUnmuteRemote="RequestP2PUnmuteRemote",t.RequestP2PMuteRemote="RequestP2PMuteRemote",t.RequestP2PRestartICE="RequestP2PRestartICE",t}({}),Cu=function(t){return t.CONNECTING="CONNECTING",t.RECONNECTING="RECONNECTING",t.CONNECTED="CONNECTED",t.CLOSED="CLOSED",t}({}),Ru=function(t){return t[t.CONNECT_AP=0]="CONNECT_AP",t[t.AP_CONNECTED=1]="AP_CONNECTED",t[t.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",t[t.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",t[t.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",t[t.CONNECT_WORKER=5]="CONNECT_WORKER",t[t.WORKER_CONNECTED=6]="WORKER_CONNECTED",t[t.CLOSED=7]="CLOSED",t}({}),us=function(t){return t.CONNECTION_STATE_CHANGE="connection-state-change",t.STATE_CHANGE="state-change",t.INSPECT_RESULT="inspect-result",t.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",t.REQUEST_NEW_WORKER_URL="request-new-worker-url",t}({}),DH=function(t){return t.CONNECTED="transmitter:connected",t.RECONNECTING="transmitter:reconnecting",t.WILL_RECONNECT="transmitter:will_reconnect",t.CLOSED="transmitter:closed",t.FAILED="transmitter:failed",t.ON_MESSAGE="transmitter:on_message",t.REQUEST_NEW_URLS="transmitter:request_new_urls",t.RECONNECT_CREATE_CONNECTION="transmitter:reconnect_create_connection",t.ON_TOKEN_PRIVILEGE_DID_EXPIRE="transmitter:on_token_privilege_did_expire",t.TO_CONNECT_DATACHANNEL="transmitter:to_connect_datachannel",t.FAILBACK="transmitter:failback",t.PRE_CONNECT_PC="transmitter:pre_connect_pc",t}({}),Ih=function(t){return t.CAMERA_CHANGED="camera-changed",t.MICROPHONE_CHANGED="microphone-changed",t.PLAYBACK_DEVICE_CHANGED="playback-device-changed",t.AUDIO_AUTOPLAY_FAILED="audio-autoplay-failed",t.AUTOPLAY_FAILED="autoplay-failed",t.AUDIO_CONTEXT_STATE_CHANGED="audio-context-state-changed",t.SECURITY_POLICY_VIOLATION="security-policy-violation",t}({}),kl=function(t){return t.CONNECTING="CONNECTING",t.RECONNECTING="RECONNECTING",t.CONNECTED="CONNECTED",t.CLOSED="CLOSED",t}({}),wd=function(t){return t.CONNECTION_STATE_CHANGE="connection-state-change",t.STATE_CHANGE="state-change",t.INSPECT_RESULT="inspect-result",t.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",t.REQUEST_NEW_WORKER_URL="request-new-worker-url",t}({}),aS=function(t){return t[t.CONNECT_AP=0]="CONNECT_AP",t[t.AP_CONNECTED=1]="AP_CONNECTED",t[t.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",t[t.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",t[t.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",t[t.CONNECT_WORKER=5]="CONNECT_WORKER",t[t.WORKER_CONNECTED=6]="WORKER_CONNECTED",t[t.CLOSED=7]="CLOSED",t}({}),ui=function(t){return t.CALL="call",t.CANDIDATE="candidate",t.PUBLISH="publish",t.UNPUBLISH="unpublish",t.CONTROL="control",t.RESTART_ICE="restart_ice",t.ACK="ack",t.RESPONSE="response",t.JOIN="join",t.CHECK="check",t}({}),cS=function(t){return t.ABORT="abort",t}({}),qm=function(t){return t.MUTE_LOCAL_AUDIO="mute_local_audio",t.MUTE_LOCAL_VIDEO="mute_local_video",t.UNMUTE_LOCAL_AUDIO="unmute_local_audio",t.UNMUTE_LOCAL_VIDEO="unmute_local_video",t}({}),mge=function(t){return t.P2P_TOKEN_TIMEOUT="p2p_token_timeout",t.P2P_TOKEN_CHANGED="p2p_token_changed",t}({});const gge={[SP.ACCESS_POINT]:{[jo.NO_FLAG_SET]:{desc:"flag is zero",retry:!1},[jo.FLAG_SET_BUT_EMPTY]:{desc:"flag is empty",retry:!1},[jo.INVALID_FALG_SET]:{desc:"invalid flag",retry:!1},[jo.FLAG_SET_BUT_NO_RE]:{desc:"flag set unilbs but no request",retry:!1},[jo.INVALID_SERVICE_ID]:{desc:"invalid service id",retry:!1},[jo.NO_SERVICE_AVAILABLE]:{desc:"no service available",retry:!0},[jo.NO_SERVICE_AVAILABLE_P2P]:{desc:"no unilbs p2p service available",retry:!0},[jo.NO_SERVICE_AVAILABLE_VOICE]:{desc:"no unilbs voice service available",retry:!0},[jo.NO_SERVICE_AVAILABLE_WEBRTC]:{desc:"no unilbs webrtc service available",retry:!0},[jo.NO_SERVICE_AVAILABLE_CDS]:{desc:"no cds service available",retry:!0},[jo.NO_SERVICE_AVAILABLE_CDN]:{desc:"no cdn dispatcher service available",retry:!0},[jo.NO_SERVICE_AVAILABLE_TDS]:{desc:"no tds service available",retry:!0},[jo.NO_SERVICE_AVAILABLE_REPORT]:{desc:"no unilbs report service available",retry:!0},[jo.NO_SERVICE_AVAILABLE_APP_CENTER]:{desc:"no app center service available",retry:!0},[jo.NO_SERVICE_AVAILABLE_ENV0]:{desc:"no unilbs sig env0 service available",retry:!0},[jo.NO_SERVICE_AVAILABLE_VOET]:{desc:"no unilbs voet service available",retry:!0},[jo.NO_SERVICE_AVAILABLE_STRING_UID]:{desc:"no string uid service available",retry:!0},[jo.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS]:{desc:"no webrtc unilbs service available",retry:!0}},[SP.UNILBS]:{[wu.INVALID_VENDOR_KEY]:{desc:"invalid vendor key, can not find appid",retry:!1},[wu.INVALID_CHANNEL_NAME]:{desc:"invalid channel name",retry:!1},[wu.INTERNAL_ERROR]:{desc:"unilbs internal error",retry:!1},[wu.NO_AUTHORIZED]:{desc:"invalid token, authorized failed",retry:!1},[wu.DYNAMIC_KEY_TIMEOUT]:{desc:"dynamic key or token timeout",retry:!1},[wu.NO_ACTIVE_STATUS]:{desc:"no active status",retry:!1},[wu.DYNAMIC_KEY_EXPIRED]:{desc:"dynamic key expired",retry:!1},[wu.STATIC_USE_DYNAMIC_KEY]:{desc:"static use dynamic key",retry:!1},[wu.DYNAMIC_USE_STATIC_KEY]:{desc:"dynamic use static key",retry:!1},[wu.USER_OVERLOAD]:{desc:"amount of users over load",retry:!1},[wu.FORBIDDEN_REGION]:{desc:"the request is forbidden in this area",retry:!1},[wu.CANNOT_MEET_AREA_DEMAND]:{desc:"unable to allocate services in this area",retry:!1}},[SP.STRING_UID_ALLOCATOR]:{[c2.IIIEGAL_APPID]:{desc:"invalid appid",retry:!1},[c2.IIIEGAL_UID]:{desc:"invalid string uid",retry:!1},[c2.INTERNAL_ERROR]:{desc:"string uid allocator internal error",retry:!0}}};function lS(t){const r=gge[Math.floor(t/1e4)];if(!r)return{desc:"unknown error",retry:!1};const s=r[t%1e4];if(!s){if(Math.floor(t/1e4)===SP.ACCESS_POINT){const a=t%1e4;if(a.toString()[0]==="1")return{desc:t.toString(),retry:!1};if(a.toString()[0]==="2")return{desc:t.toString(),retry:!0}}return{desc:"unknown error",retry:!1}}return s}const _ge={[Mt.K_TIMESTAMP_EXPIRED]:{desc:"K_TIMESTAMP_EXPIRED",action:"failed"},[Mt.K_CHANNEL_PERMISSION_INVALID]:{desc:"K_CHANNEL_PERMISSION_INVALID",action:"failed"},[Mt.K_CERTIFICATE_INVALID]:{desc:"K_CERTIFICATE_INVALID",action:"failed"},[Mt.K_CHANNEL_NAME_EMPTY]:{desc:"K_CHANNEL_NAME_EMPTY",action:"failed"},[Mt.K_CHANNEL_NOT_FOUND]:{desc:"K_CHANNEL_NOT_FOUND",action:"failed"},[Mt.K_TICKET_INVALID]:{desc:"K_TICKET_INVALID",action:"failed"},[Mt.K_CHANNEL_CONFLICTED]:{desc:"K_CHANNEL_CONFLICTED",action:"failed"},[Mt.K_SERVICE_NOT_READY]:{desc:"K_SERVICE_NOT_READY",action:"tryNext"},[Mt.K_SERVICE_TOO_HEAVY]:{desc:"K_SERVICE_TOO_HEAVY",action:"tryNext"},[Mt.K_UID_BANNED]:{desc:"K_UID_BANNED",action:"failed"},[Mt.K_IP_BANNED]:{desc:"K_IP_BANNED",action:"failed"},[Mt.DATASTREAM2_NOT_AVAILABLE]:{desc:"DATASTREAM2_NOT_AVAILABLE",action:"quit"},[Mt.K_AUTO_REBALANCE]:{desc:"k_AUTO_REBALANCE",action:"recover"},[Mt.ERR_INVALID_VENDOR_KEY]:{desc:"ERR_INVALID_VENDOR_KEY",action:"failed"},[Mt.ERR_INVALID_CHANNEL_NAME]:{desc:"ERR_INVALID_CHANNEL_NAME",action:"failed"},[Mt.WARN_NO_AVAILABLE_CHANNEL]:{desc:"WARN_NO_AVAILABLE_CHANNEL",action:"failed"},[Mt.WARN_LOOKUP_CHANNEL_TIMEOUT]:{desc:"WARN_LOOKUP_CHANNEL_TIMEOUT",action:"tryNext"},[Mt.WARN_LOOKUP_CHANNEL_REJECTED]:{desc:"WARN_LOOKUP_CHANNEL_REJECTED",action:"failed"},[Mt.WARN_OPEN_CHANNEL_TIMEOUT]:{desc:"WARN_OPEN_CHANNEL_TIMEOUT",action:"tryNext"},[Mt.WARN_OPEN_CHANNEL_REJECTED]:{desc:"WARN_OPEN_CHANNEL_REJECTED",action:"failed"},[Mt.WARN_REQUEST_DEFERRED]:{desc:"WARN_REQUEST_DEFERRED",action:"failed"},[Mt.ERR_DYNAMIC_KEY_TIMEOUT]:{desc:"ERR_DYNAMIC_KEY_TIMEOUT",action:"failed"},[Mt.ERR_NO_AUTHORIZED]:{desc:"ERR_NO_AUTHORIZED",action:"failed"},[Mt.ERR_VOM_SERVICE_UNAVAILABLE]:{desc:"ERR_VOM_SERVICE_UNAVAILABLE",action:"tryNext"},[Mt.ERR_NO_CHANNEL_AVAILABLE_CODE]:{desc:"ERR_NO_CHANNEL_AVAILABLE_CODE",action:"failed"},[Mt.ERR_MASTER_VOCS_UNAVAILABLE]:{desc:"ERR_MASTER_VOCS_UNAVAILABLE",action:"tryNext"},[Mt.ERR_INTERNAL_ERROR]:{desc:"ERR_INTERNAL_ERROR",action:"tryNext"},[Mt.ERR_NO_ACTIVE_STATUS]:{desc:"ERR_NO_ACTIVE_STATUS",action:"failed"},[Mt.ERR_INVALID_UID]:{desc:"ERR_INVALID_UID",action:"failed"},[Mt.ERR_DYNAMIC_KEY_EXPIRED]:{desc:"ERR_DYNAMIC_KEY_EXPIRED",action:"failed"},[Mt.ERR_STATIC_USE_DYANMIC_KE]:{desc:"ERR_STATIC_USE_DYANMIC_KE",action:"failed"},[Mt.ERR_DYNAMIC_USE_STATIC_KE]:{desc:"ERR_DYNAMIC_USE_STATIC_KE",action:"failed"},[Mt.ERR_NO_VOCS_AVAILABLE]:{desc:"ERR_NO_VOCS_AVAILABLE",action:"tryNext"},[Mt.ERR_NO_VOS_AVAILABLE]:{desc:"ERR_NO_VOS_AVAILABLE",action:"tryNext"},[Mt.ERR_JOIN_CHANNEL_TIMEOUT]:{desc:"ERR_JOIN_CHANNEL_TIMEOUT",action:"tryNext"},[Mt.ERR_JOIN_BY_MULTI_IP]:{desc:"ERR_JOIN_BY_MULTI_IP",action:"recover"},[Mt.ERR_NOT_JOINED]:{desc:"ERR_NOT_JOINED",action:"failed"},[Mt.ERR_REPEAT_JOIN_REQUEST]:{desc:"ERR_REPEAT_JOIN_REQUEST",action:"quit"},[Mt.ERR_REPEAT_JOIN_CHANNEL]:{desc:"ERR_REPEAT_JOIN_CHANNEL",action:"quit"},[Mt.ERR_INVALID_STRINGUID]:{desc:"ERR_INVALID_STRINGUID",action:"failed"},[Mt.ERR_TOO_MANY_USERS]:{desc:"ERR_TOO_MANY_USERS",action:"tryNext"},[Mt.ERR_SET_CLIENT_ROLE_TIMEOUT]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[Mt.ERR_SET_CLIENT_ROLE_NO_PERMISSION]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[Mt.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE]:{desc:"ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",action:"success"},[Mt.ERR_PUBLISH_REQUEST_INVALID]:{desc:"ERR_PUBLISH_REQUEST_INVALID",action:"failed"},[Mt.ERR_SUBSCRIBE_REQUEST_INVALID]:{desc:"ERR_SUBSCRIBE_REQUEST_INVALID",action:"failed"},[Mt.ERR_NOT_SUPPORTED_MESSAGE]:{desc:"ERR_NOT_SUPPORTED_MESSAGE",action:"failed"},[Mt.ERR_ILLEAGAL_PLUGIN]:{desc:"ERR_ILLEAGAL_PLUGIN",action:"failed"},[Mt.ILLEGAL_CLIENT_ROLE_LEVEL]:{desc:"ILLEGAL_CLIENT_ROLE_LEVEL",action:"failed"},[Mt.ERR_REJOIN_TOKEN_INVALID]:{desc:"ERR_REJOIN_TOKEN_INVALID",action:"failed"},[Mt.ERR_REJOIN_USER_NOT_JOINED]:{desc:"ERR_REJOIN_NOT_JOINED",action:"failed"},[Mt.ERR_INVALID_OPTIONAL_INFO]:{desc:"ERR_INVALID_OPTIONAL_INFO",action:"quit"},[Mt.ERR_TEST_RECOVER]:{desc:"ERR_TEST_RECOVER",action:"recover"},[Mt.ERR_TEST_TRYNEXT]:{desc:"ERR_TEST_TRYNEXT",action:"recover"},[Mt.ERR_TEST_RETRY]:{desc:"ERR_TEST_RETRY",action:"recover"},[Mt.ILLEGAL_AES_PASSWORD]:{desc:"ERR_TEST_RETRY",action:"failed"},[Mt.ERR_TOO_MANY_BROADCASTERS]:{desc:"ERR_TOO_MANY_BROADCASTERS",action:"failed"},[Mt.ERR_TOO_MANY_SUBSCRIBERS]:{desc:"ERR_TOO_MANY_SUBSCRIBERS",action:"failed"},[Mt.ERR_LICENSE_ILLEGAL]:{desc:"ERR_LICENSE_ILLEGAL",action:"quit"},[Mt.ERR_LICENSE_MISSING]:{desc:"ERR_LICENSE_MISSING",action:"quit"},[Mt.ERR_LICENSE_EXPIRED]:{desc:"ERR_LICENSE_EXPIRED",action:"quit"},[Mt.ERR_LICENSE_MINUTES_EXCEEDED]:{desc:"ERR_LICENSE_MINUTES_EXCEEDED",action:"quit"},[Mt.ERR_LICENSE_PERIOD_INVALID]:{desc:"ERR_LICENSE_PERIOD_INVALID",action:"quit"},[Mt.ERR_LICENSE_MULTIPLE_SDK_SERVICE]:{desc:"ERR_LICENSE_MULTIPLE_SDK_SERVICE",action:"quit"}};function jT(t){return _ge[t]||{desc:"UNKNOWN_ERROR_".concat(t),action:"failed"}}function xH(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}function h2(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?xH(Object(s),!0).forEach(function(a){K(t,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):xH(Object(s)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))})}return t}function LH(t,r){if(typeof t=="string")return t;const{proxy:s,host:a,port:c}=t;if(r){const u=oe("JOIN_GATEWAY_FALLBACK_PORT")||443;return u===443?"wss://".concat(a,"/ws/?p=").concat(Number(c)+150):"wss://".concat(a,":").concat(u,"/ws/?p=").concat(Number(c)+150)}return s?"wss://".concat(s,"/ws/?h=").concat(a,"&p=").concat(c):"wss://".concat(a,":").concat(c)}const yge=/wss:\/\/(.+)\/ws\/\?h=(.+)&p=([0-9]+)\/?/,Ege=/wss:\/\/(.+)\/ws\/\?p=([0-9]+)\/?/,vge=/wss:\/\/(.+):([0-9]+)\/?/,Sge=/wss:\/\/(.[^\/]+)\/?/;let bge=0;class Tge{constructor(r,s){K(this,"id",0),K(this,"store",void 0),K(this,"recordIndex",void 0),K(this,"websockets",[]),K(this,"try443PortDuration",2e3),K(this,"forceCloseWSDuration",5e3),K(this,"try443PortTimeout",null),K(this,"forceCloseTimeout",null),K(this,"isTry443PortFailed",!1),K(this,"isNormalPortFailed",!1),K(this,"useDoubleDomain",!1),K(this,"useProxy",!1),K(this,"startTime",Date.now()),this.id=++bge,this.try443PortDuration=oe("JOIN_GATEWAY_TRY_443PORT_DURATION")||2e3,this.forceCloseWSDuration=r||5e3,this.store=s}closeAllWebsockets(){this.websockets.forEach(r=>{r.onopen=null,r.onclose=null,r.onmessage=null,r.close()}),this.websockets.length=0}clearTimeout(){this.forceCloseTimeout&&clearTimeout(this.forceCloseTimeout),this.try443PortTimeout&&clearTimeout(this.try443PortTimeout),this.forceCloseTimeout=null,this.try443PortTimeout=null}logger(){var r;const s=Date.now()-this.startTime;for(var a=arguments.length,c=new Array(a),u=0;u<a;u++)c[u]=arguments[u];x.debug("[choose-best-ws ".concat((r=this.store)===null||r===void 0?void 0:r.clientId," ").concat(this.id,"] ").concat(s,"ms:"),...c)}createWebSocket(r,s,a){this.logger("createWebSocket:",r,{isTry443Port:s,hasTimeoutDetection:a});const c=oe("GATEWAY_DOMAINS"),u=Date.now(),h=[],m=c.find(P=>{var D;return ot(D=r.host).call(D,P)});m||(this.useDoubleDomain=!1);const y=[];if(this.useDoubleDomain)c.forEach(P=>{y.push(LH(h2(h2({},r),{},{host:r.host.replace(m,P)}),s))});else{const P=h2({},r);if(s&&m){const D=c.find(G=>G!==m);D&&(P.host=P.host.replace(m,D))}y.push(LH(P,s))}try{y.forEach(P=>{const D=new WebSocket(P);D.binaryType="arraybuffer",h.push(D),this.logger("ws is connecting:",D.url)})}catch(P){if(this.logger("ws create failed"),h.forEach(D=>D.close()),h.length=0,this.useDoubleDomain)return this.useDoubleDomain=!1,this.createWebSocket(r,s,a);if(!s&&Number(r.port)!==443)return this.createWebSocket(r,!0,a);throw new Oe(te.WS_ERR,"init websocket failed! Error: ".concat(P.toString()))}const v=CT();this.store&&this.store.recordJoinChannelService({urls:h.map(P=>P.url),service:"gateway"},this.recordIndex),h.forEach(P=>{P.onopen=()=>{this.logger("onopen: ws ".concat(P.url," open cost ").concat(Date.now()-u,"ms")),this.websockets.forEach(D=>{D!==P&&(D.onopen=null,D.onclose=null,D.onmessage=null,D.close(),this.logger("close backup websocket: ".concat(D.url)))}),this.websockets.length=0,v.resolve(P)},P.onclose=D=>{this.logger("onclose: ws ".concat(P.url," closed cost ").concat(Date.now()-u,"ms state: ").concat(P.readyState));const G=h.every(F=>F.readyState===WebSocket.CLOSED||F.readyState===WebSocket.CLOSING);this.logger("".concat(s?"443":"47xx"," websocket closed, all failed: ").concat(G)),G&&(s||this.isTry443PortFailed||this.useProxy)?(this.logger("onclose: all websocket is closed, ".concat(D.reason)),v.reject({code:D.code,reason:wP.A_ROUND_WS_FAILED})):!s&&G&&!this.isNormalPortFailed&&this.try443PortTimeout&&(this.logger("all 47xx websocket is closed, try 443 port"),this.clearTimeout(),R()),s?this.isTry443PortFailed=G:this.isNormalPortFailed=G},P.onmessage=D=>this.logger("".concat(P.url," onmessage: ").concat(D.data))}),this.websockets.push(...h);const S=()=>{this.websockets.forEach(P=>P.readyState!==WebSocket.OPEN&&P.close())},R=()=>{if(v.isResolved)return S();Dn().os===Qi.MAC_OS&&zr()&&S(),this.createWebSocket(r,!0,!0).then(P=>{v.resolve(P)}).catch(P=>{this.isNormalPortFailed&&v.reject(P),this.logger("try 443 port to create ws failed")}),this.forceCloseTimeout=window.setTimeout(()=>{this.logger("5s timeout close un-opens, isWebsocket created: ",v.isResolved),this.forceCloseTimeout=null,S()},this.forceCloseWSDuration)};return a||(()=>{if(s||this.useProxy)return this.logger("add 5s timeout at ".concat(s?"try-443":"proxy"," condition")),this.forceCloseTimeout=window.setTimeout(()=>{this.forceCloseTimeout=null,S()},this.forceCloseWSDuration);this.try443PortTimeout=window.setTimeout(()=>{this.logger("2s timeout, isWebsocket created: ",v.isResolved),this.try443PortTimeout=null,R()},this.try443PortDuration)})(),v.promise}chooseBestWebsocket(r,s,a,c){return this.useDoubleDomain=!!s,typeof r=="string"&&(r=function(u){let h,m,y;return[,h,m,y]=u.match(yge)||[],h||([,m,y]=u.match(Ege)||[]),m&&y||([,m,y]=u.match(vge)||[]),m&&y||([,m]=u.match(Sge)||[]),m||x.warning("un-destructible url: ",u),{proxy:h,host:m,port:y||"443"}}(r)),this.recordIndex=c,this.useProxy=!!r.proxy,a&&this.useProxy&&(x.warn("cannot use 443 only when use proxy"),a=!1),this.createWebSocket(r,!!a,!1).finally(()=>this.clearTimeout())}}function MH(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}class UH extends Fr{get url(){return this.websocket&&this.websocket.url||null}get reconnectMode(){return this._reconnectMode}set reconnectMode(r){var s;ot(s=["tryNext","recover"]).call(s,r)&&this.resetReconnectCount(r),this._reconnectMode=r}get state(){return this._state}set state(r){r!==this._state&&(this._state=r,this._state==="reconnecting"?this.emit(Zt.RECONNECTING,this.reconnectReason):this._state==="connected"?this.emit(Zt.CONNECTED):this._state==="closed"?this.emit(Zt.CLOSED):this._state==="failed"&&this.emit(Zt.FAILED))}resetReconnectCount(r){x.debug("websocket reset reconnect count, reason: "+r),this.reconnectCount=0}constructor(r,s){let a=arguments.length>2&&arguments[2]!==void 0&&arguments[2],c=arguments.length>3&&arguments[3]!==void 0&&arguments[3],u=arguments.length>4&&arguments[4]!==void 0&&arguments[4],h=arguments.length>5?arguments[5]:void 0;super(),K(this,"connectionID",0),K(this,"currentURLIndex",0),K(this,"urls",[]),K(this,"_reconnectMode","tryNext"),K(this,"reconnectReason",void 0),K(this,"_initMutex",void 0),K(this,"name",void 0),K(this,"_state","closed"),K(this,"reconnectInterrupter",void 0),K(this,"websocket",void 0),K(this,"retryConfig",void 0),K(this,"reconnectCount",0),K(this,"forceCloseTimeout",5e3),K(this,"onlineReconnectListener",void 0),K(this,"useCompress",void 0),K(this,"tryDoubleDomain",!1),K(this,"use443PortOnly",!1),K(this,"wsInflateLength",0),K(this,"wsDeflateLength",0),K(this,"closeEstablishingWs",()=>{}),K(this,"store",void 0),K(this,"joinGatewayRecordIndex",void 0),this.store=h,this.name=r,this.retryConfig=function(R){for(var P=1;P<arguments.length;P++){var D=arguments[P]!=null?arguments[P]:{};P%2?MH(Object(D),!0).forEach(function(G){K(R,G,D[G])}):Object.getOwnPropertyDescriptors?Object.defineProperties(R,Object.getOwnPropertyDescriptors(D)):MH(Object(D)).forEach(function(G){Object.defineProperty(R,G,Object.getOwnPropertyDescriptor(D,G))})}return R}({},s),this.useCompress=a,this.tryDoubleDomain=c,this.use443PortOnly=u,this._initMutex=new Fs("websocket",h?h.clientId:void 0);const{timeout:m,timeoutFactor:y}=s,v=Math.max(300,Math.floor(3*m/5)),S=Math.max(1.2,Math.floor(8*y)/10);Ec.ONLINE&&(this.retryConfig.timeout=v,this.retryConfig.timeoutFactor=S),vi.on(Wv.NETWORK_STATE_CHANGE,(R,P)=>{R!==P&&(this.resetReconnectCount("network state change: ".concat(P," -> ").concat(R)),R===Ec.ONLINE?(this.retryConfig.timeout=v,this.retryConfig.timeoutFactor=S):(this.retryConfig.timeout=m,this.retryConfig.timeoutFactor=y))})}getConnection(){return this.websocket||void 0}async init(r){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const a=await this._initMutex.lock();this._reconnectMode="tryNext",this.forceCloseTimeout=s,this.urls=r,this.state="connecting";try{const c=CT(),u=this.urls[this.currentURLIndex];oe("ENABLE_PREALLOC_PC")&&this.emit(DH.PRE_CONNECT_PC),this.createWebSocketConnection(u).then(c.resolve).catch(c.reject),this.once(Zt.CLOSED,()=>{c.reject(new Me(te.WS_DISCONNECT))}),this.once(Zt.CONNECTED,c.resolve),await c.promise}catch{}finally{a()}}close(r,s){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this.reconnectInterrupter&&this.reconnectInterrupter(),this.websocket){this.websocket.onclose=null,this.websocket.onopen=null,this.websocket.onmessage=null;const a=this.websocket;s?setTimeout(()=>a.close(),500):a.close(),this.websocket=void 0}this.state=r?"failed":"closed",this.closeEstablishingWs&&this.closeEstablishingWs()}reconnect(r,s){if(!this.websocket)return void x.warning("[".concat(this.name,"] can not reconnect, no websocket"));r!==void 0&&(this.reconnectMode=r),x.debug("[".concat(this.name,"] reconnect is triggered initiative")),typeof this.joinGatewayRecordIndex=="number"&&this.store&&this.store.recordJoinChannelService({status:"error",errors:[new Error(s)]},this.joinGatewayRecordIndex);const a=this.websocket.onclose;this.websocket.onclose=null,this.websocket.close(),a&&a.bind(this.websocket)({code:9999,reason:s})}sendMessage(r){let s=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!this.websocket||this.websocket.readyState!==WebSocket.OPEN)throw new Me(te.WS_ABORT,"websocket is not ready");try{s||(r=JSON.stringify(r)),this.websocket.send(r)}catch(a){throw new Me(te.WS_ERR,"send websocket message error"+a.toString())}}setWsInflateData(r){this.wsDeflateLength=this.wsDeflateLength+r.originLength,this.wsInflateLength=this.wsInflateLength+r.compressedLength}getWsInflateData(){const r=this.wsInflateLength,s=this.wsDeflateLength;return this.clearWsInflateData(),{wsInflateLength:r,wsDeflateLength:s}}clearWsInflateData(){this.wsInflateLength=0,this.wsDeflateLength=0}async createWebSocketConnection(r){var s;const a=CT();this.connectionID+=1,this.joinGatewayRecordIndex=void 0;const c=S=>{var R;(R=this.store)===null||R===void 0||R.signalChannelOpen(),x.debug("[".concat(this.name,"] websocket opened:"),S),this.reconnectMode="retry",this.state="connected",this.resetReconnectCount("opened"),a.resolve()},u=async S=>{var R;if(x.debug("[".concat(this.name,"] websocket close ").concat((R=this.websocket)===null||R===void 0?void 0:R.url,", code: ").concat(S.code,", reason: ").concat(S.reason,", current mode: ").concat(this.reconnectMode)),this.reconnectCount>=this.retryConfig.maxRetryCount)a.reject(new Me(te.WS_DISCONNECT,"websocket close: ".concat(S.code))),this.close();else{this.state==="connected"&&(this.reconnectReason=S.reason,this.state="reconnecting");const P=Kc(this,Zt.WILL_RECONNECT,this.reconnectMode,S.reason)||this.reconnectMode,D=await this.reconnectWithAction(P);if(this.state==="closed")return void x.debug("[".concat(this.connectionID,"] ws is closed, no need to reconnect"));if(!D)return a.reject(new Me(te.WS_DISCONNECT,"websocket reconnect failed: ".concat(S.code))),this.close(!0);a.resolve()}},h=S=>{this.emit(Zt.ON_MESSAGE,S)},m=S=>{x.warn("[".concat(this.connectionID,"] ws open error ").concat(S))};this.websocket&&(this.websocket.onclose=null,this.websocket.close()),oe("GATEWAY_WSS_ADDRESS")&&this.name.startsWith("gateway")&&(r=oe("GATEWAY_WSS_ADDRESS")),x.debug("[".concat(this.name,"] start connect, url:"),r);const y=(s=this.store)===null||s===void 0?void 0:s.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"});try{var v;const S=await this.chooseBestWebsocketConnection(r);this.websocket=S,c&&c(this.websocket.url),this.websocket.onclose=u,this.websocket.onmessage=h,this.websocket.onerror=m,(v=this.store)===null||v===void 0||v.recordJoinChannelService({endTs:Date.now(),status:"success"},y),this.joinGatewayRecordIndex=y}catch(S){const R=this.state==="closed",P=S instanceof Me,D=P&&S.code===te.WS_ABORT,G=P&&S.code===te.WS_ERR,F=P?S.message:S&&(S.reason||S.toString());x.warning("[choose-best-ws] chooseBestWebsocket error: ".concat(F)),this.store&&this.store.recordJoinChannelService({endTs:Date.now(),status:D?"aborted":"error",errors:[S]},y),R||G?(a.reject(R?new Me(te.WS_DISCONNECT,"websocket is closed: ".concat(F)):new Me(te.WS_ERR,"init websocket failed: ".concat(F))),G&&x.error("[".concat(this.name,"] init websocket failed: ").concat(F))):u&&u(S)}return a.promise}async reconnectWithAction(r){let s=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(this.reconnectCount>=this.retryConfig.maxRetryCount||this.urls.length===0||this.state==="closed")return!1;x.warning("[choose-best-ws] action: =>",r),this.onlineReconnectListener||vi.isOnline||!vi.onlineWaiter||(this.onlineReconnectListener=vi.onlineWaiter.then(()=>{this.onlineReconnectListener=void 0}));let a=!0;if(this.reconnectInterrupter=()=>a=!1,s){const h=wL(this.reconnectCount,this.retryConfig);x.debug("[".concat(this.name,"] wait ").concat(h,"ms to reconnect websocket, mode: ").concat(r)),await dt.race([ps(h),this.onlineReconnectListener||new dt(()=>{})])}if(this._state==="closed"||!a)return!1;this.reconnectCount+=1;const c=async(h,m)=>{this.emit(Zt.RECONNECT_CREATE_CONNECTION,m),await this.createWebSocketConnection(h)};try{if(r==="retry")await c(this.urls[this.currentURLIndex],r);else if(r==="tryNext"){if(this.currentURLIndex+=1,this.currentURLIndex>=this.urls.length)return this.reconnectWithAction("recover",!1);x.debug("[".concat(this.name,"] websocket url length: ").concat(this.urls.length," current index: ").concat(this.currentURLIndex)),await c(this.urls[this.currentURLIndex],r)}else r==="recover"&&(x.debug("[".concat(this.name,"] request new urls")),this.resetReconnectCount("recover mode"),this.urls=await ks(this,Zt.REQUEST_NEW_URLS),this.currentURLIndex=0,await c(this.urls[this.currentURLIndex],r))}catch(h){var u;x.error("[".concat(this.name,"] reconnect failed ").concat(h&&h.toString()));const m=h==null||(u=h.data)===null||u===void 0?void 0:u.desc;return Array.isArray(m)&&ot(m).call(m,"dynamic key expired")?(this.emit(Zt.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):this.reconnectWithAction(r,s)}return!0}}class f2 extends UH{constructor(r,s){super(r,s,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(r,s){const a=CT(),c=function(h,m){return new Tge(h,m)}(this.forceCloseTimeout,this.store);this.closeEstablishingWs=()=>{x.debug("[choose-best-ws] close establishing websockets"),c.closeAllWebsockets(),a.reject(new Me(te.WS_ABORT,"choose best websocket aborted"))};const u=oe("GATEWAY_DOMAINS");return x.debug("[choose-best-ws] currentDomain: ",r,", domains: ",u,"total: ".concat(this.urls.length),"current: ".concat(this.currentURLIndex+1)),c.chooseBestWebsocket(r,this.tryDoubleDomain,this.use443PortOnly,s).then(a.resolve).catch(a.reject),a.promise.finally(()=>{this.closeEstablishingWs=void 0})}}class BT extends UH{constructor(r,s){super(r,s,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(r,s){return new dt((a,c)=>{let u=!1;const h=[];this.closeEstablishingWs=()=>{x.debug("[choose-best-ws] close establishing websockets"),h.forEach(G=>{G.onclose=null,G.onopen=null,G.onmessage=null,G.close()}),c(new Me(te.WS_ABORT,"choose best websocket aborted"))};const m=oe("GATEWAY_DOMAINS");let y;const v=r.indexOf("?h="),S=m.find(G=>v!==-1?ot(r).call(r,G,v):ot(r).call(r,G));x.debug("[choose-best-ws] currentDomain: ",S,", domains: ",m);let R=!this.tryDoubleDomain||!S;if(!R&&S){var P;const G=Date.now();try{m.forEach(F=>{const j=v===-1?r.replace(S,F):r.substr(0,v)+r.substr(v).replace(S,F),Y=new WebSocket(j);Y.binaryType="arraybuffer",h.push(Y),x.debug("[choose-best-ws] ws is connecting:",Y.url)})}catch{for(x.debug("[choose-best-ws] ws create failed, fallback to single url"),h.forEach(j=>j.close());h.length;)h.pop();R=!0}(P=this.store)===null||P===void 0||P.recordJoinChannelService({urls:h.map(F=>F.url),service:"gateway"},s),h.forEach(F=>{F.onopen=()=>{if(u)return;const j=Date.now()-G;x.debug("[choose-best-ws] ws open cost ".concat(j,"ms")),h.filter(Y=>Y!==F).forEach(Y=>{x.debug("[choose-best-ws]close backup websocket: ".concat(Y.url)),Y.close()}),u=!0,a(F)},F.onclose=j=>{y=j,!u&&(h.find(Y=>!(Y.readyState===WebSocket.CLOSED||Y.readyState===WebSocket.CLOSING))||(x.debug("[choose-best-ws] all websocket is closed"),u=!0,c(y)))},F.onmessage=j=>{x.debug("[choose-best-ws]".concat(F.url," onmessage: ").concat(j.data))}}),ps(this.forceCloseTimeout).then(()=>{h.forEach(F=>{F.readyState!==WebSocket.OPEN&&F.close()})})}if(R){var D;let G;x.debug("[choose-best-ws] use single url: ",r),(D=this.store)===null||D===void 0||D.recordJoinChannelService({urls:[r],service:"gateway"},s);try{G=new WebSocket(r),h.push(G),G.binaryType="arraybuffer"}catch(F){const j=new Me(te.WS_ERR,"init websocket failed! Error: ".concat(F.toString()));return x.error("[".concat(this.name,"]").concat(j)),void c(j)}G.onopen=()=>{a(G)},G.onclose=F=>{c(F)},G.onmessage=F=>{x.debug("[choose-best-ws]".concat(G.url," onmessage: ").concat(F.data))},ps(this.forceCloseTimeout).then(()=>{G&&G.readyState!==WebSocket.OPEN&&G.close()})}}).then(a=>(this.closeEstablishingWs=void 0,a)).catch(a=>{throw this.closeEstablishingWs=void 0,a})}}class wge extends Fr{get connectionState(){return this._connectionState}set connectionState(r){r!==this._connectionState&&(this._connectionState=r,r===gr.CONNECTED?this.emit(Ht.WS_CONNECTED):r===gr.RECONNECTING?this.emit(Ht.WS_RECONNECTING,this._websocketReconnectReason):r===gr.CLOSED&&this.emit(Ht.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(r,s){super(),K(this,"_disconnectedReason",void 0),K(this,"_websocketReconnectReason",void 0),K(this,"_connectionState",gr.CLOSED),K(this,"reconnectToken",void 0),K(this,"websocket",void 0),K(this,"openConnectionTime",void 0),K(this,"clientId",void 0),K(this,"lastMsgTime",Date.now()),K(this,"uploadCache",[]),K(this,"uploadCacheInterval",void 0),K(this,"rttRolling",new Y8(5)),K(this,"pingpongTimer",void 0),K(this,"wsInflateDataTimer",void 0),K(this,"pingpongTimeoutCount",0),K(this,"joinResponse",void 0),K(this,"multiIpOption",void 0),K(this,"initError",void 0),K(this,"spec",void 0),K(this,"store",void 0),K(this,"onWebsocketMessage",a=>{if(a.data instanceof ArrayBuffer)return void this.emit(Ht.ON_BINARY_DATA,a.data);const c=JSON.parse(a.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(c,"_id")){const u="res-@".concat(c._id);this.emit(u,c._result,c._message)}else if(Object.prototype.hasOwnProperty.call(c,"_type")){if(this.emit(c._type,c._message),c._type===wn.ON_NOTIFICATION&&this.handleNotification(c._message),c._type===wn.ON_USER_BANNED)switch(c._message.error_code){case 14:this.close(qn.UID_BANNED);break;case 15:this.close(qn.IP_BANNED);break;case 16:this.close(qn.CHANNEL_BANNED)}if(c._type===wn.ON_USER_LICENSE_BANNED)switch(c._message.error_code){case Mt.ERR_LICENSE_MISSING:this.close(qn.LICENSE_MISSING);break;case Mt.ERR_LICENSE_EXPIRED:this.close(qn.LICENSE_EXPIRED);break;case Mt.ERR_LICENSE_MINUTES_EXCEEDED:this.close(qn.LICENSE_MINUTES_EXCEEDED);break;case Mt.ERR_LICENSE_PERIOD_INVALID:this.close(qn.LICENSE_PERIOD_INVALID);break;case Mt.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(qn.LICENSE_MULTIPLE_SDK_SERVICE);break;case Mt.ERR_LICENSE_ILLEGAL:this.close(qn.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=r.clientId,this.spec=r,this.store=s,this.websocket=new f2("gateway-".concat(this.clientId),this.spec.retryConfig,!0,oe("JOIN_GATEWAY_USE_DUAL_DOMAIN"),oe("JOIN_GATEWAY_USE_443PORT_ONLY"),s),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===gr.CONNECTED&&this.reconnect("retry",Os.OFFLINE)})}async request(r,s,a,c){const u=fr(6,""),h={_id:u,_type:r,_message:s},m=this.websocket.connectionID,y=()=>new dt((G,F)=>{if(this.connectionState===gr.CONNECTED)return G();const j=()=>{this.off(Ht.WS_CLOSED,Y),G()},Y=()=>{this.off(Ht.WS_CONNECTED,j),F(new Oe(te.WS_ABORT))};this.once(Ht.WS_CONNECTED,j),this.once(Ht.WS_CLOSED,Y),r!==Gt.PUBLISH&&r!==Gt.PUBLISH_DATASTREAM&&r!==Gt.SUBSCRIBE&&r!==Gt.SUBSCRIBE_DATASTREAM&&r!==Gt.UNSUBSCRIBE&&r!==Gt.UNSUBSCRIBE_DATASTREAM&&r!==Gt.UNPUBLISH&&r!==Gt.UNPUBLISH_DATASTREAM&&r!==Gt.CONTROL&&r!==Gt.RESTART_ICE||this.once(Ht.DISCONNECT_P2P,()=>{F(new Oe(te.DISCONNECT_P2P))}),r!==Gt.PUBLISH&&r!==Gt.RESTART_ICE||this.once(Ht.ABORT_P2P_EXECUTION,()=>{F(new Oe(te.DISCONNECT_P2P))})});if(this.connectionState!==gr.CONNECTING&&this.connectionState!==gr.RECONNECTING||r===Gt.JOIN||r===Gt.REJOIN||await y(),this.websocket.sendMessage(h,!0),c)return;const v=new dt((G,F)=>{let j=!1;const Y=(fe,Se)=>{j=!0,G({isSuccess:fe==="success",message:Se||{}}),this.off(Ht.WS_CLOSED,ee),this.off(Ht.WS_RECONNECTING,ee),this.emit(Ht.REQUEST_SUCCESS,r,s)};this.once("res-@".concat(u),Y);const ee=()=>{F(new Oe(te.WS_ABORT,"type: ".concat(r))),this.off(Ht.WS_CLOSED,ee),this.off(Ht.WS_RECONNECTING,ee),this.off("res-@".concat(u),Y)};this.once(Ht.WS_CLOSED,ee),this.once(Ht.WS_RECONNECTING,ee),ps(oe("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==m||j||(x.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(r)),this.emit(Ht.REQUEST_TIMEOUT,r,s))})});let S=null;try{S=await v}catch(G){if(this.connectionState===gr.CLOSED||r===Gt.LEAVE)throw new Oe(te.WS_ABORT);return!this.spec.forceWaitGatewayResponse||a?G.throw():r===Gt.JOIN||r===Gt.REJOIN?null:(await y(),await this.request(r,s))}if(S.isSuccess)return S.message;const R=Number(S.message.error_code||S.message.code),P=jT(R),D=new Oe(te.UNEXPECTED_RESPONSE,"".concat(P.desc,": ").concat(S.message.error_str),{code:R,data:S.message,desc:P.desc});return P.action==="success"?S.message:(x.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(r,", error_code: ").concat(R,", message: ").concat(P.desc,", action: ").concat(P.action)),R===Mt.ERR_TOO_MANY_BROADCASTERS?((r===Gt.JOIN||r===Gt.REJOIN)&&(this.initError=D,this.close()),D.throw()):P.action==="failed"?D.throw():P.action==="quit"?(this.initError=D,this.close(),D.throw()):(R===Mt.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=S.message.option,x.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",Os.MULTI_IP)):this.reconnect(P.action,Os.SERVER_ERROR),r===Gt.JOIN||r===Gt.REJOIN?null:await this.request(r,s)))}waitMessage(r,s){return new dt(a=>{const c=u=>{(!s||s(u))&&(this.off(r,c),a(u))};this.on(r,c)})}uploadWRTCStats(r){if(!this.store.sessionId)return void x.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const s={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:r};this.upload(VT.WRTC_STATS,s)}upload(r,s){const a={_type:r,_message:s};try{this.websocket.sendMessage(a)}catch{const u=oe("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(a),this.uploadCache.length>u&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==gr.CONNECTED)return;const h=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(h._type,h._message)},oe("UPLOAD_CACHE_INTERVAL")||2e3))}}send(r,s){const a={_type:r,_message:s};this.websocket.sendMessage(a)}init(r){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new dt((s,a)=>{this.once(Ht.WS_CONNECTED,()=>s(this.joinResponse)),this.once(Ht.WS_CLOSED,c=>a(this.initError||new Oe(te.WS_ABORT,c))),this.connectionState=gr.CONNECTING,this.websocket.init(r).catch(a),this.wsInflateDataTimer&&window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=window.setInterval(()=>{this.handleWsInflateData()},2e4)})}close(r){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.wsInflateDataTimer&&(this.handleWsInflateData(),window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=r||qn.LEAVE,this.connectionState=gr.CLOSED,x.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close()}async join(){if(!this.joinResponse){this.emit(Ht.ABORT_P2P_EXECUTION);const r=await ks(this,Ht.REQUEST_JOIN_INFO),s=await this.request(Gt.JOIN,r);if(!s)return this.emit(Ht.REPORT_JOIN_GATEWAY,wP.TIMEOUT,this.url||""),!1;this.joinResponse=s,this.emit(Ht.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=gr.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}async rejoin(){if(!this.reconnectToken)throw new Oe(te.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const r=kT(this,Ht.REQUEST_REJOIN_INFO);r.token=this.reconnectToken;const s=await this.request(Gt.REJOIN,r);return!!s&&(this.connectionState=gr.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),s.peers&&s.peers.forEach(a=>{this.emit(wn.ON_USER_ONLINE,{uid:a.uid}),a.audio&&this.emit(wn.ON_ADD_AUDIO_STREAM,{uid:a.uid,uint_id:a.uint_id,audio:!0,ssrcId:a.audio_ssrc}),a.video&&this.emit(wn.ON_ADD_VIDEO_STREAM,{uid:a.uid,uint_id:a.uint_id,video:!0,ssrcId:a.video_ssrc}),a.audio_mute?this.emit(wn.MUTE_AUDIO,{uid:a.uid}):this.emit(wn.UNMUTE_AUDIO,{uid:a.uid}),a.video_mute?this.emit(wn.MUTE_VIDEO,{uid:a.uid}):this.emit(wn.UNMUTE_VIDEO,{uid:a.uid}),a.audio_enable_local?this.emit(wn.ENABLE_LOCAL_AUDIO,{uid:a.uid}):this.emit(wn.DISABLE_LOCAL_AUDIO,{uid:a.uid}),a.video_enable_local?this.emit(wn.ENABLE_LOCAL_VIDEO,{uid:a.uid}):this.emit(wn.DISABLE_LOCAL_VIDEO,{uid:a.uid}),a.audio||a.video||this.emit(wn.ON_REMOVE_STREAM,{uid:a.uid,uint_id:a.uint_id})}),!0)}reconnect(r,s){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(r,s)}handleNotification(r){x.debug("[".concat(this.clientId,"] receive notification: "),r);const s=jT(r.code);if(r.code===28&&"detail"in r&&(x.info("[".concat(this.clientId,"] receive recover notification: "),r.detail),this.emit(Ht.RECOVER_NOTIFICATION,r.detail)),s.action!=="success"){if(s.action!=="failed")return s.action==="quit"?(s.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(qn.UID_BANNED),void this.close()):void this.reconnect(s.action,Os.SERVER_ERROR);x.error("[".concat(this.clientId,"] ignore error: "),s.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const r=oe("PING_PONG_TIME_OUT"),s=Date.now();this.pingpongTimeoutCount>=r&&(x.warning("[".concat(this.clientId,"] PING-PONG Timeout. Last Socket Message: ").concat(s-this.lastMsgTime,"ms")),s-this.lastMsgTime>oe("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",Os.TIMEOUT):this.request(Gt.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const a=Date.now()-s;this.rttRolling.add(a),oe("REPORT_STATS")&&this.send(Gt.PING_BACK,{pingpongElapse:a})}).catch(a=>{})}handleWsInflateData(){const{wsInflateLength:r,wsDeflateLength:s}=this.websocket.getWsInflateData();r!==0&&s!==0&&this.upload(VT.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:s,ws_inflate_length:r})}handleWebsocketEvents(){this.websocket.on(Zt.RECONNECT_CREATE_CONNECTION,r=>{this.emit(Ht.WS_RECONNECT_CREATE_CONNECTION,r)}),this.websocket.on(Zt.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(Zt.CLOSED,()=>{this.connectionState=gr.CLOSED}),this.websocket.on(Zt.FAILED,()=>{this._disconnectedReason=qn.NETWORK_ERROR,this.connectionState=gr.CLOSED}),this.websocket.on(Zt.RECONNECTING,r=>{this._websocketReconnectReason=r,this.joinResponse=void 0,this.connectionState===gr.CONNECTED?this.connectionState=gr.RECONNECTING:this.connectionState=gr.CONNECTING}),this.websocket.on(Zt.WILL_RECONNECT,(r,s,a)=>{const c=kT(this,Ht.IS_P2P_DISCONNECTED),u=c||r!=="retry";c&&r==="retry"&&(x.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),r="tryNext",s=wP.P2P_DISCONNECTED),u&&(x.debug("".concat(this.clientId," will renewSession, reconnect mode: ").concat(r)),this.emit(Ht.REPORT_JOIN_GATEWAY,s||wP.UNKNOWN_REASON,this.url||""),this.reconnectToken=void 0,this.emit(Ht.DISCONNECT_P2P)),a(r)}),this.websocket.on(Zt.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(r=>{x.warning("[".concat(this.clientId,"] rejoin failed ").concat(r)),this.reconnect("tryNext",Os.SERVER_ERROR)}):this.join().catch(r=>{if(this.emit(Ht.REPORT_JOIN_GATEWAY,r,this.url||""),r instanceof Oe){if(r.code===te.UNEXPECTED_RESPONSE&&r.data.code===Mt.ERR_NO_AUTHORIZED)return this.initError=new Oe(te.TOKEN_EXPIRE,"dynamic key expired"),void this.close(qn.TOKEN_EXPIRE);x.error("[".concat(this.clientId,"] join gateway request failed"),r.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",Os.SERVER_ERROR):(this.initError=r,this.close())}})}),this.websocket.on(Zt.REQUEST_NEW_URLS,(r,s)=>{ks(this,Ht.REQUEST_RECOVER,this.multiIpOption).then(r).catch(s)}),this.websocket.on(Zt.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(wn.ON_TOKEN_PRIVILEGE_DID_EXPIRE)}),this.websocket.on(DH.PRE_CONNECT_PC,()=>{this.emit(Ht.PRE_CONNECT_PC)})}}let Cge=function(t){return t.NATIVE_RTC="native_rtc",t.NATIVE_RTM="native_rtm",t.WEB_RTC="web_rtc",t.WEB_RTM="web_rtm",t}({}),Si=function(t){return t[t.CHOOSE_SERVER=11]="CHOOSE_SERVER",t[t.CLOUD_PROXY=18]="CLOUD_PROXY",t[t.CLOUD_PROXY_5=20]="CLOUD_PROXY_5",t[t.CLOUD_PROXY_FALLBACK=26]="CLOUD_PROXY_FALLBACK",t}({});function VH(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}function RP(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?VH(Object(s),!0).forEach(function(a){K(t,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):VH(Object(s)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))})}return t}function Ym(t){return t.match(/^[\.\:\d]+$/)?"".concat(t.replace(/[^\d]/g,"-"),".").concat(oe("TURN_DOMAIN")):(x.debug("Cannot recognized as ip address: ".concat(t,", use as host")),t)}function p2(t,r){t.addresses||(t.addresses=[]);const s=function(m,y){if(oe("CONNECT_GATEWAY_WITHOUT_DOMAIN"))return m.map(R=>{let{ip:P,port:D}=R;return{address:"".concat(P,":").concat(D)}});const v=oe("GATEWAY_DOMAINS");let S=v[1]&&ot(y).call(y,v[1])?1:0;return m.map(R=>{let{domain_prefix:P,port:D,ip:G}=R;if(P)return{address:"".concat(P,".").concat(v[S++%v.length],":").concat(D)};const F=/^[\.\:\d]+$/.test(G),j=F?"".concat(G.replace(/[^\d]/g,"-"),".").concat(v[S++%v.length],":").concat(D):"".concat(G,":").concat(D);return F||x.debug("Cannot recognized as ip address: ".concat(G,", use as host")),{ip:G,port:D,address:j}})}(t.addresses,r),a=Array.isArray(t.detail)&&t.detail[18];if(a&&typeof a=="string"){const m=a.split(";");for(let y=0;y<m.length;y++){var c;const v=_o(c=m[y]).call(c);s[y]&&v&&(s[y].ip6=v)}}const u=t.detail&&t.detail.candidate;let h;if(u){const[m,y]=u.split(":");m&&y&&(h={port:Number(y),ip:m,address:"".concat(m,":").concat(y)})}return{gatewayAddrs:s,apGatewayAddress:h,uid:t.uid,cid:t.cid,cert:t.cert,vid:t.detail&&t.detail[8],uni_lbs_ip:t.detail&&t.detail[1],res:t,csIp:t.detail&&t.detail[502]}}function vc(t){return typeof t=="number"?t:t.exact||t.ideal||t.max||t.min||0}function FH(t){const r=t._encoderConfig;if(!r)return{};const s={resolution:r.width&&r.height?"".concat(vc(r.width),"x").concat(vc(r.height)):void 0,maxVideoBW:r.bitrateMax,minVideoBW:r.bitrateMin};return typeof r.frameRate=="number"?(s.maxFrameRate=r.frameRate,s.minFrameRate=r.frameRate):r.frameRate&&(s.maxFrameRate=r.frameRate.max||r.frameRate.ideal||r.frameRate.exact||r.frameRate.min,s.minFrameRate=r.frameRate.min||r.frameRate.ideal||r.frameRate.exact||r.frameRate.max),s}function jH(t){return t>=0&&t<.17?1:t>=.17&&t<.36?2:t>=.36&&t<.59?3:t>=.59&&t<=1?4:t>1?5:0}function WT(t,r){let s,a,c;switch(r){case Si.CHOOSE_SERVER:a=4096,c="choose server";break;case Si.CLOUD_PROXY:a=1048576,c="proxy";break;case Si.CLOUD_PROXY_5:a=4194304,c="proxy5";break;case Si.CLOUD_PROXY_FALLBACK:a=4194310,c="proxy fallback";break;default:throw new Oe(te.UNEXPECTED_ERROR,"multi unlibs response transformer get unknown service id",{csIp:t.detail&&t.detail[502],retry:!1})}if(t.response_body.forEach(u=>{u.buffer&&u.buffer.flag===a&&(s={code:u.buffer.code,addresses:(u.buffer.edges_services||[]).map(h=>RP(RP({},h),{},{ticket:u.buffer.cert})),server_ts:t.enter_ts,uid:u.buffer.uid,cid:u.buffer.cid,cname:u.buffer.cname,detail:RP(RP({},u.buffer.detail),t.detail),flag:u.buffer.flag,opid:t.opid,cert:u.buffer.cert})}),!s)throw new Oe(te.MULTI_UNILBS_RESPONSE_ERROR,"cannot parse response ".concat(c," from multi unilbs response"),{csIp:t.detail&&t.detail[502]});return s}async function BH(t,r){return await dt.all(t.addresses.map(async s=>({address:oe("USE_TURN_IP")?s.ip:Ym(s.ip),tcpport:s.port,udpport:s.port,username:r&&oe("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?r.toString():Ns.username,password:r&&oe("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?await vL(r.toString()):Ns.password})))}function m2(t,r){const s=r.getMediaStreamTrack(!0).getSettings(),a=r.videoHeight||s.height,c=r.videoWidth||s.width;return a&&c?Math.max(Math.min(a,c)/Math.min(vc(t.height),vc(t.width)),1):(x.warning("can't get ori-track's height, default scale down 4 times for low stream"),4)}function Xm(t){let{candidateType:r,relayProtocol:s,type:a,address:c,port:u,protocol:h}=t;const m={candidateType:r,relayProtocol:s,protocol:h};if(a!=="local-candidate"){const y=c.split(".");y.length>=4&&(y[1]="*",y[2]="*"),m.address=y.join("."),m.port=u}return m}function IP(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:oe("SVC_MODE");if(oe("ENABLE_SVC"))return function(r){return r in nP}(t)?t:nP.L1T3}const WH={[Et.VIDEO]:[{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"},{key:"video-orientation",extensionName:"urn:3gpp:video-orientation"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"playout-delay",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/playout-delay"},{key:"video-content-type",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-content-type"},{key:"color-space",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/color-space"},{key:"video-timing",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-timing"}],[Et.AUDIO]:[{key:"ssrc-audio-level",extensionName:"urn:ietf:params:rtp-hdrext:ssrc-audio-level"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"}]};function AP(t,r,s){r.forEach(a=>{var c;const u=WH[t].find(m=>{var y;let{key:v}=m;return ot(y=a.extensionName).call(y,v)});if(!u)return;const h=s.find(m=>{let{extensionName:y}=m;return ot(y).call(y,u.key)});h&&ot(c=h.extensionName).call(c,"gdpr_forbidden")&&(a.extensionName=h.extensionName)})}function uS(t,r){r.forEach(s=>{var a;const c=WH[t].find(u=>{var h;let{key:m}=u;return ot(h=s.extensionName).call(h,m)});ot(a=s.extensionName).call(a,"gdpr_forbidden")&&c&&(s.extensionName=c.extensionName)})}function zH(t){return t==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"||ot(t).call(t,"abs-send-time")}function PP(t){return t==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"||ot(t).call(t,"draft-holmer-rmcat-transport-wide-cc-extensions-01")}function GH(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}function HH(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?GH(Object(s),!0).forEach(function(a){K(t,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):GH(Object(s)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))})}return t}function zT(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},a=arguments.length>3?arguments[3]:void 0;const{filterRTX:c,filterVideoFec:u,filterAudioFec:h,filterAudioCodec:m,filterVideoCodec:y}=r,{useXR:v}=s;let S=[],R=[],P=[],D=[],G=!1,F=!1;if(Wa(t).mediaDescriptions.forEach(Y=>{a&&a!==Y.attributes.direction||(Y.media.mediaType!=="video"||G||(R=Y.attributes.payloads,D=Y.attributes.extmaps,G=!0),Y.media.mediaType!=="audio"||F||(S=Y.attributes.payloads,P=Y.attributes.extmaps,F=!0))}),!D||R.length===0)throw new Error("Cannot get video capabilities from SDP.");if(!P||S.length===0)throw new Error("Cannot get audio capabilities from SDP.");if(R.forEach(Y=>{var ee;(ee=Y.rtpMap)!==null&&ee!==void 0&&ee.clockRate&&(Y.rtpMap.clockRate=parseInt(Y.rtpMap.clockRate)),v&&Y.rtcpFeedbacks.push({type:"rrtr"})}),S.forEach(Y=>{var ee;(ee=Y.rtpMap)!==null&&ee!==void 0&&ee.clockRate&&(Y.rtpMap.clockRate=parseInt(Y.rtpMap.clockRate)),v&&Y.rtcpFeedbacks.push({type:"rrtr"})}),c&&(S=S.filter(Y=>{var ee;return((ee=Y.rtpMap)===null||ee===void 0?void 0:ee.encodingName.toLowerCase())!=="rtx"}),R=R.filter(Y=>{var ee;return((ee=Y.rtpMap)===null||ee===void 0?void 0:ee.encodingName.toLowerCase())!=="rtx"})),u&&(R=R.filter(Y=>{var ee;return!/(red)|(ulpfec)|(flexfec)/i.test(((ee=Y.rtpMap)===null||ee===void 0?void 0:ee.encodingName)||"")})),h&&(S=S.filter(Y=>{var ee;return!/(red)|(ulpfec)|(flexfec)/i.test(((ee=Y.rtpMap)===null||ee===void 0?void 0:ee.encodingName)||"")})),m&&(m==null?void 0:m.length)>0&&(S=S.filter(Y=>{var ee;return ot(m).call(m,((ee=Y.rtpMap)===null||ee===void 0?void 0:ee.encodingName.toLowerCase())||"")})),y&&(y==null?void 0:y.length)>0){const Y=R.filter(ee=>{var fe;return ot(y).call(y,((fe=ee.rtpMap)===null||fe===void 0?void 0:fe.encodingName.toLowerCase())||"")});R=Y.concat(c?[]:y2(Y,R))}const j=oe("UNSUPPORTED_VIDEO_CODEC");return j&&j.length>0&&(R=R.filter(Y=>!(Y.rtpMap&&ot(j).call(j,Y.rtpMap.encodingName.toLowerCase())))),{audioCodecs:S,videoCodecs:R,audioExtensions:P,videoExtensions:D}}function Jm(t){const r=Wa(t);let s,a;for(const c of r.mediaDescriptions){if(!s){const u=c.attributes.iceUfrag,h=c.attributes.icePwd;if(!u||!h)throw new Error("Cannot get iceUfrag or icePwd from SDP.");s={iceUfrag:u,icePwd:h}}if(!a){const u=c.attributes.fingerprints;u.length>0&&(a={fingerprints:u})}}if(!a&&r.attributes.fingerprints.length>0&&(a={fingerprints:r.attributes.fingerprints}),!a||!s)throw new Error("Cannot get iceParameters or dtlsParameters from SDP.");return{iceParameters:s,dtlsParameters:a}}function $H(t,r){const s=[],a=t.attributes.ssrcGroups.filter(h=>h.semantic==="FID"),c=t.attributes.ssrcGroups.find(h=>h.semantic==="SIM"),u=t.attributes.ssrcs;if(c)c.ssrcIds.forEach(h=>{var m;const y=(m=a.find(v=>v.ssrcIds[0]===h))===null||m===void 0?void 0:m.ssrcIds[1];s.push({ssrcId:h,rtx:r?y:void 0})});else if(a.length>0){const h=a[0].ssrcIds[0],m=a[0].ssrcIds[1];s.push({ssrcId:h,rtx:r?m:void 0})}else{if(u.length===0)throw new Error("No ssrcs found on local media description.");s.push({ssrcId:u[0].ssrcId})}return s}function KH(t,r,s){const{cname:a}=t;let c=[];r&&(c=qH(r)),c.length===0&&(c=t.iceParameters.candidates.map(S=>({foundation:S.foundation,componentId:"1",transport:S.protocol,priority:S.priority.toString(),connectionAddress:S.ip,port:S.port.toString(),type:S.type,extension:{}})),x.debug("Using candidates from gateway."));const u={fingerprints:t.dtlsParameters.fingerprints.map(S=>({hashFunction:S.algorithm,fingerprint:S.fingerprint}))},h={iceUfrag:t.iceParameters.iceUfrag,icePwd:t.iceParameters.icePwd};let m;switch(t.dtlsParameters.role){case"server":m="passive";break;case"client":m="active";break;case"auto":m="actpass"}const y=kP(t.rtpCapabilities),v=[];return Array.isArray(s)&&s.length>0&&s.forEach(S=>{v.push({kind:Et.VIDEO,ssrcId:S.v,rtx:S.v_rtx,mslabel:"".concat(S.v,"_").concat(S.a)},{kind:Et.AUDIO,ssrcId:S.a,mslabel:"".concat(S.v,"_").concat(S.a)})}),{dtlsParameters:u,iceParameters:h,candidates:c,rtpCapabilities:y,setup:m,cname:a,preSSRCs:v}}function qH(t){let r=[];return t.ip&&typeof t.port=="number"&&(r=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:t.ip,port:t.port.toString(),type:"host",extension:{}}],x.debug("Using remote candidate from AP ".concat(t.ip,":").concat(t.port)),t.ip6&&(r.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:t.ip6,port:t.port.toString(),type:"host",extension:{}}),x.debug("Using IPV6 remote candidate from AP ".concat(t.ip6,":").concat(t.port)))),r}function Q_(t,r,s){const a=[],c=[];return t.forEach(u=>{let{ssrcId:h,rtx:m}=u;const y=fr(8,"track-"),v={ssrcId:h,attributes:HH({label:y,mslabel:s=s||fr(10,""),msid:"".concat(s," ").concat(y)},r&&{cname:r})};if(a.push(v),m!==void 0){const S={ssrcId:m,attributes:HH({label:y,mslabel:s,msid:"".concat(s," ").concat(y)},r&&{cname:r})};a.push(S),c.push({semantic:"FID",ssrcIds:[h,m]})}}),t.length>1&&c.push({semantic:"SIM",ssrcIds:t.map(u=>{let{ssrcId:h}=u;return h})}),{ssrcs:a,ssrcGroups:c}}function dS(t,r){r instanceof Xr&&t.attributes.payloads.forEach(s=>{var a;const c=(a=s.rtpMap)===null||a===void 0?void 0:a.encodingName.toLowerCase();if(!c||["opus","pcmu","pcma","g722"].indexOf(c)===-1)return;s.fmtp||(s.fmtp={parameters:{}}),s.fmtp.parameters.minptime="10",s.fmtp.parameters.useinbandfec="1";const u=r._encoderConfig;u&&c!=="pcmu"&&c!=="pcma"&&c!=="g722"&&(u.bitrate&&!zr()&&(s.fmtp.parameters.maxaveragebitrate="".concat(Math.floor(1e3*u.bitrate))),u.sampleRate&&(s.fmtp.parameters.maxplaybackrate="".concat(u.sampleRate),s.fmtp.parameters["sprop-maxcapturerate"]="".concat(u.sampleRate)),u.stereo&&(s.fmtp.parameters.stereo="1",s.fmtp.parameters["sprop-stereo"]="1"))})}function g2(t){const r=t.attributes.unrecognized.findIndex(s=>s.attField==="x-google-flag"&&s.attValue==="conference");r!==-1&&t.attributes.unrecognized.splice(r,1)}function _2(t,r){var s;if(!(r instanceof Tr&&r._encoderConfig&&r._hints.indexOf(pr.SCREEN_TRACK)===-1))return;const a=r._encoderConfig;jn().supportMinBitrate&&a.bitrateMin&&t.attributes.payloads.forEach(c=>{var u,h;ot(u=["h264","h265","vp8","vp9","av1"]).call(u,((h=c.rtpMap)===null||h===void 0?void 0:h.encodingName.toLowerCase())||"")&&(c.fmtp||(c.fmtp={parameters:{}}),c.fmtp.parameters["x-google-min-bitrate"]="".concat(a.bitrateMin))}),jn().supportMinBitrate&&!ot(s=r._hints).call(s,pr.LOW_STREAM)&&a.bitrateMax&&t.attributes.payloads.forEach(c=>{var u,h;ot(u=["h264","h265","vp8","vp9","av1"]).call(u,((h=c.rtpMap)===null||h===void 0?void 0:h.encodingName.toLowerCase())||"")&&(c.fmtp||(c.fmtp={parameters:{}}),c.fmtp.parameters["x-google-start-bitrate"]="".concat(oe("X_GOOGLE_START_BITRATE")||Math.floor(a.bitrateMax)))})}function YH(t){if(t.media.mediaType!=="video")return;const r=Dn();if(r.name!==Gn.SAFARI&&r.os!==Qi.IOS)return;const s=t.attributes.extmaps.findIndex(a=>/video-orientation/g.test(a.extensionName));s!==-1&&t.attributes.extmaps.splice(s,1)}function OP(t,r,s){if(!r)return;let a,c;if(t.media.mediaType==="video"?(a=s.videoExtensions,c=s.videoCodecs):(a=s.audioExtensions,c=s.audioCodecs),r.twcc===!0){const u=a.find(h=>PP(h.extensionName));if(u){const h=u.extensionName;t.attributes.extmaps.find(y=>PP(y.extensionName))||t.attributes.extmaps.push({entry:u.entry,extensionName:h}),function(y,v){return v.filter(S=>!!y.find(R=>R.payloadType===S.payloadType&&!!R.rtcpFeedbacks.find(P=>P.type==="transport-cc")))}(c,t.attributes.payloads).forEach(y=>{y.rtcpFeedbacks.find(v=>v.type==="transport-cc")||y.rtcpFeedbacks.push({type:"transport-cc"})})}}else if(r.twcc===!1){const u=t.attributes.extmaps.findIndex(h=>PP(h.extensionName));u!==-1&&t.attributes.extmaps.splice(u,1),t.attributes.payloads.forEach(h=>{const m=h.rtcpFeedbacks.findIndex(y=>y.type==="transport-cc");m!==-1&&h.rtcpFeedbacks.splice(m,1)})}if(r.remb===!0){const u=a.find(h=>zH(h.extensionName));if(u){const h=u.extensionName;t.attributes.extmaps.find(y=>y.extensionName===h)||t.attributes.extmaps.push({entry:u.entry,extensionName:h}),function(y,v){return v.filter(S=>!!y.find(R=>R.payloadType===S.payloadType&&!!R.rtcpFeedbacks.find(P=>P.type==="goog-remb")))}(c,t.attributes.payloads).forEach(y=>{y.rtcpFeedbacks.find(v=>v.type==="goog-remb")||y.rtcpFeedbacks.push({type:"goog-remb"})})}}else if(r.remb===!1){const u=t.attributes.extmaps.findIndex(h=>zH(h.extensionName));u!==-1&&t.attributes.extmaps.splice(u,1),t.attributes.payloads.forEach(h=>{const m=h.rtcpFeedbacks.findIndex(y=>y.type==="goog-remb");m!==-1&&h.rtcpFeedbacks.splice(m,1)})}}function XH(t,r,s){if(zr()||t.media.mediaType!=="video"||!(r instanceof Tr)||s!=="vp9"&&s!=="vp8"||s==="vp8"&&!oe("SIMULCAST")||s==="vp9"&&oe("ENABLE_SVC")||r._scalabilityMode===void 0||r._scalabilityMode.numSpatialLayers<=1)return;const a=s==="vp8"?2:r._scalabilityMode.numSpatialLayers,c=t.attributes.ssrcs[0],u=t.attributes.ssrcGroups.find(m=>m.semantic==="FID"&&m.ssrcIds[0]===c.ssrcId),h={semantic:"SIM",ssrcIds:[c.ssrcId]};for(let m=1;m<a;m++)t.attributes.ssrcs.push({ssrcId:c.ssrcId+m,attributes:$r(c.attributes)}),h.ssrcIds.push(c.ssrcId+m),u&&(t.attributes.ssrcs.push({ssrcId:u.ssrcIds[1]+m,attributes:$r(c.attributes)}),t.attributes.ssrcGroups.push({semantic:"FID",ssrcIds:[c.ssrcId+m,u.ssrcIds[1]+m]}));t.attributes.ssrcGroups.unshift(h)}async function JH(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const s=new RTCPeerConnection;s.addTransceiver("video",{direction:"sendonly"}),s.addTransceiver("audio",{direction:"sendonly"}),s.addTransceiver("video",{direction:"recvonly"}),s.addTransceiver("audio",{direction:"recvonly"});const a=(await s.createOffer()).sdp,{send:c,recv:u,sendrecv:h}=function(){let m=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},y=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},v=arguments.length>2?arguments[2]:void 0;const S=zT(v,m,y,"sendonly"),R=zT(v,m,y,"recvonly"),P={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},D={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},G={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(Iu(S,R,"videoExtensions",P,D,G),Iu(S,R,"videoCodecs",P,D,G),Iu(S,R,"audioExtensions",P,D,G),Iu(S,R,"audioCodecs",P,D,G),oe("RAISE_H264_BASELINE_PRIORITY")){const F=[],j=[];G.videoCodecs.forEach((Y,ee)=>{var fe;if(((fe=Y.rtpMap)===null||fe===void 0?void 0:fe.encodingName.toLocaleLowerCase())==="h264"){var Se,we;const ye=G.videoCodecs[ee+1],Ne=ye&&n9(Y,ye),Ye=(Se=Y.fmtp)===null||Se===void 0?void 0:Se.parameters["profile-level-id"],ht=(we=Y.fmtp)===null||we===void 0?void 0:we.parameters["packetization-mode"];!Ye||Ye!==oe("FIRST_H264_PROFILE_LEVEL_ID")||oe("FIRST_PACKETIZATION_MODE")&&ht!==oe("FIRST_PACKETIZATION_MODE")?Ne?j.push([Y,ye]):j.push([Y]):Ne?F.push([Y,ye]):F.push([Y])}}),F.length>0&&j.length>0&&(x.debug("raising H264 baseline profile priority"),G.videoCodecs.forEach((Y,ee)=>{var fe;if(((fe=Y.rtpMap)===null||fe===void 0?void 0:fe.encodingName.toLocaleLowerCase())==="h264"){const Se=n9(Y,G.videoCodecs[ee+1]),we=F.shift()||j.shift()||[];we.length>0&&(Se?G.videoCodecs.splice(ee,2,...we):G.videoCodecs.splice(ee,1,...we))}}),D.videoCodecs=D.videoCodecs.filter(Y=>{var ee,fe;return!(((ee=Y.rtpMap)===null||ee===void 0?void 0:ee.encodingName.toLocaleLowerCase())==="h264"&&((fe=Y.fmtp)===null||fe===void 0?void 0:fe.parameters["profile-level-id"])!==oe("FIRST_H264_PROFILE_LEVEL_ID"))}),oe("FILTER_SEND_H264_BASELINE")&&(P.videoCodecs=P.videoCodecs.filter(Y=>{var ee,fe;return!(((ee=Y.rtpMap)===null||ee===void 0?void 0:ee.encodingName.toLocaleLowerCase())==="h264"&&((fe=Y.fmtp)===null||fe===void 0?void 0:fe.parameters["profile-level-id"])!==oe("FIRST_H264_PROFILE_LEVEL_ID"))})))}return{send:P,recv:D,sendrecv:G}}(t,r,a);try{s.close()}catch{}return{send:c,recv:u,sendrecv:h}}function QH(){const t={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},r=zT(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"recvonly"),s={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},a={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},c={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(Iu(t,r,"videoExtensions",s,a,c),Iu(t,r,"videoCodecs",s,a,c),Iu(t,r,"audioExtensions",s,a,c),Iu(t,r,"audioCodecs",s,a,c),oe("RAISE_H264_BASELINE_PRIORITY")){const u=c.videoCodecs.findIndex(h=>h.rtpMap&&h.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&h.fmtp&&h.fmtp.parameters["profile-level-id"]==="42001f");if(u!==-1){const h=c.videoCodecs.findIndex(m=>m.rtpMap&&m.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(h<u){x.debug("raising H264 baseline profile priority");const m=c.videoCodecs[u];c.videoCodecs.splice(u,1),c.videoCodecs.splice(h,0,m)}h!==-1&&(a.videoCodecs=a.videoCodecs.filter(m=>!(m.rtpMap&&m.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&m.fmtp&&m.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:s,recv:a,sendrecv:c}}function Iu(t,r,s,a,c,u){if(s==="videoExtensions"||s==="audioExtensions"){const h=[];return t[s].forEach(m=>{r[s].some((y,v)=>{if(m.entry===y.entry&&m.extensionName===y.extensionName)return h.push(v),!0})?u[s].push(m):a[s].push(m)}),void r[s].forEach((m,y)=>{h.indexOf(y)===-1&&c[s].push(m)})}if(s==="videoCodecs"||s==="audioCodecs"){const h=[];return t[s].forEach(m=>{r[s].some((y,v)=>{if(m.payloadType===y.payloadType&&JSON.stringify(m)===JSON.stringify(y))return h.push(v),!0})?u[s].push(m):a[s].push(m)}),void r[s].forEach((m,y)=>{h.indexOf(y)===-1&&c[s].push(m)})}}function kP(t){const{send:r,recv:s,sendrecv:a}=t;if(!a){if(!r||!s)throw new Error("cannot merge rtp capabilities because one of send or recv is empty!");return{send:r,recv:s}}let c,u;return r?(c={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},c.audioCodecs=[...r.audioCodecs,...a.audioCodecs],c.videoCodecs=[...r.videoCodecs,...a.videoCodecs],c.audioExtensions=[...r.audioExtensions,...a.audioExtensions],c.videoExtensions=[...r.videoExtensions,...a.videoExtensions]):c=a,s?(u={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},u.audioCodecs=[...s.audioCodecs,...a.audioCodecs],u.videoCodecs=[...s.videoCodecs,...a.videoCodecs],u.audioExtensions=[...s.audioExtensions,...a.audioExtensions],u.videoExtensions=[...s.videoExtensions,...a.videoExtensions]):u=a,{send:c,recv:u}}function hS(t){t.media.mediaType==="audio"&&t.attributes.payloads.filter(r=>{var s;return((s=r.rtpMap)===null||s===void 0?void 0:s.encodingName.toLowerCase())==="opus"}).forEach(r=>{r.fmtp||(r.fmtp={parameters:{}}),r.fmtp.parameters.stereo="1",r.fmtp.parameters["sprop-stereo"]="1"})}function GT(t,r,s,a){let c=[];if(t===Et.VIDEO){if(oe("H264_PROFILE_LEVEL_ID")&&a==="h264"&&(c=r.videoCodecs.filter(u=>{var h;return ot(h=u.rtpMap&&u.rtpMap.encodingName.toLowerCase()||"").call(h,a)&&u&&u.fmtp&&u.fmtp.parameters["profile-level-id"]===oe("H264_PROFILE_LEVEL_ID")})),!Array.isArray(c)||c.length===0){let u=[];const h=[],m=[],y=[];if(s.videoCodecs.forEach(v=>{const S=v.rtpMap&&v.rtpMap.encodingName.toLowerCase()||"";ot(S).call(S,a)?u.push(v):ot(S).call(S,"vp9")?h.push(v):ot(S).call(S,"vp8")?m.push(v):ot(S).call(S,"h264")&&y.push(v)}),u.length===0){let v="";h.length!==0?(u=h,v="vp9"):m.length!==0?(u=m,v="vp8"):y.length!==0&&(u=y,v="h264"),x.warning("codec ".concat(a," not included in rtpCapabilities, fallback to default payloads: ").concat(v))}u.length!==0&&(c=r.videoCodecs.filter(v=>u.some(S=>S.payloadType===v.payloadType)))}if(c.length===0&&(x.warning("codec ".concat(a," not included in rtpCapabilities, fallback to default payloads: ").concat(r.videoCodecs[0].rtpMap&&r.videoCodecs[0].rtpMap.encodingName)),c=r.videoCodecs),oe("USE_PUB_RTX")||oe("USE_SUB_RTX")){const u=y2(c,r.videoCodecs);c=[...c,...u]}}else c=r.audioCodecs.filter(u=>{var h;return ot(h=u.rtpMap&&u.rtpMap.encodingName.toLowerCase()||"").call(h,a)}),c.length===0&&(x.warning("codec ".concat(a," not included in rtpCapabilities, fallback to opus")),c=r.audioCodecs.filter(u=>{var h;return ot(h=u.rtpMap&&u.rtpMap.encodingName.toLowerCase()||"").call(h,"opus")}));return c}function y2(t,r){const s=t.map(a=>a.payloadType.toString());return r.filter(a=>a.rtpMap&&a.rtpMap.encodingName==="rtx"&&a.fmtp&&a.fmtp.parameters.apt&&ot(s).call(s,a.fmtp&&a.fmtp.parameters.apt))}async function HT(t,r,s){const a=r.toString(),c=e9(a,"offer","remote","exchangeSDP");await t.setRemoteDescription({type:"offer",sdp:a});const u=await t.createAnswer();if(!u.sdp)throw new Error("cannot get answer sdp");let h=u.sdp;h=ZH(h,s||{}),c==null||c(h||""),await t.setLocalDescription({type:"answer",sdp:h})}function ZH(t,r,s){const a=Wa(t),{useXR:c}=r;return a.mediaDescriptions.forEach(u=>{var h;u.attributes.mid&&(Array.isArray(s)&&!ot(s).call(s,u.attributes.mid)||(u.media.mediaType==="audio"&&hS(u),c&&ot(h=["audio","video"]).call(h,u.media.mediaType)&&u.attributes.payloads.forEach(m=>{m.rtcpFeedbacks.findIndex(y=>y.type==="rrtr")===-1&&m.rtcpFeedbacks.push({type:"rrtr"})})))}),$m(a)}function e9(t,r,s,a){if(oe("SDP_LOGGING"))return x.upload("exchanging ".concat(s," ").concat(r," SDP during P2PConnection.").concat(a,`
`),t),r==="offer"?c=>{e9(c,"answer",s==="local"?"remote":"local",a)}:void 0}function t9(t){const r=oe("COMPATIBLE_SDP_EXTENSION");return!!(Array.isArray(r)&&r.length>0)&&r.some(s=>ot(t).call(t,s))}function n9(t,r){try{var s;return((s=t.fmtp)===null||s===void 0?void 0:s.parameters.apt)===r.payloadType.toString()}catch{return!1}}function r9(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}function Nl(t,r){return typeof oe(t)===r?oe(t):void 0}function Rge(){try{const t=oe("EXPERIMENTS")||{};return typeof t=="string"||Array.isArray(t)?{}:function(r){for(var s=1;s<arguments.length;s++){var a=arguments[s]!=null?arguments[s]:{};s%2?r9(Object(a),!0).forEach(function(c){K(r,c,a[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(a)):r9(Object(a)).forEach(function(c){Object.defineProperty(r,c,Object.getOwnPropertyDescriptor(a,c))})}return r}({},t)}catch(t){return x.debug("handle gateway attributes failed: ",t),{}}}const i9={};function Qm(t){(!(arguments.length>1&&arguments[1]!==void 0)||arguments[1])&&x.debug("install service ".concat(t.name)),i9[t.name]=t}function hp(t){const r=i9[t];if(!r)throw new Me(te.INVALID_OPERATION,"".concat(t," not found, please use AgoraRTC.use(").concat(t,"Service) to load it first"));return r}function s9(t,r){return hp("DataStream").create(t,r)}function NP(){return hp("InterceptFrame").create()}function o9(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}function fp(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?o9(Object(s),!0).forEach(function(a){K(t,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):o9(Object(s)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))})}return t}const E2=new Map;class Ige extends Fr{get state(){return this._state}set state(r){if(r===this._state)return;const s=this._state;this._state=r,r==="DISCONNECTED"&&this._disconnectedReason?this.emit(ls.CONNECTION_STATE_CHANGE,r,s,this._disconnectedReason):this.emit(ls.CONNECTION_STATE_CHANGE,r,s)}get joinGatewayStartTime(){return this._joinGatewayStartTime}set joinGatewayStartTime(r){x.debug("[".concat(this.store.clientId,"] set joinGatewayStartTime at ").concat(r)),this._joinGatewayStartTime=r}constructor(r,s){var a,c,u;super(),K(this,"store",void 0),K(this,"joinInfo",void 0),K(this,"key",void 0),K(this,"ntpOffset",0),K(this,"signal",void 0),K(this,"role",void 0),K(this,"inChannelInfo",{joinAt:null,duration:0}),K(this,"spec",void 0),K(this,"_state","DISCONNECTED"),K(this,"_statsCollector",void 0),K(this,"_disconnectedReason",void 0),K(this,"isSignalRecover",!1),K(this,"hasChangeBGPAddress",!1),K(this,"trafficStatsInterval",void 0),K(this,"networkQualityInterval",void 0),K(this,"_joinGatewayStartTime",0),K(this,"_signalTimeout",!1),K(this,"_clientRoleOptions",void 0),K(this,"_isProactiveJoin",!1),this.store=r,this.spec=s,this.signal=this.store.useP2P?(a={spec:fp(fp({},s),{},{retryConfig:s.websocketRetryConfig}),store:r},(c=(u=hp("P2PChannel")).createSubmodule)===null||c===void 0?void 0:c.call(u,a)):new wge(fp(fp({},s),{},{retryConfig:s.websocketRetryConfig}),r),this._statsCollector=s.statsCollector,this.role=s.role||"audience",this._clientRoleOptions=s.clientRoleOptions,this.handleSignalEvents()}async join(r,s,a){this.store.joinGatewayStart(),r.cloudProxyServer!=="disabled"&&(this.hasChangeBGPAddress=!0);const c=Date.now();let u=E2.get(r.cname);if(u||(u=new Map,E2.set(r.cname,u)),this._isProactiveJoin=!0,u.has(r.uid)){const v=new Oe(te.UID_CONFLICT);throw At.joinGateway(r.sid,{lts:c,succ:!1,ec:v.code,addr:null,uid:r.uid,cid:r.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!r.proxyServer,signalChannel:"0",preload:r.preload}),v}u.set(r.uid,!0),this.joinInfo=r,this.key=s;let h=0;this.joinGatewayStartTime=c;const m=r.proxyServer;try{x.debug("[".concat(this.store.clientId,"] use websocket join uid ").concat(h));const v=r.gatewayAddrs.map(S=>{let{address:R}=S;const[P,D]=R.split(":"),G={host:P,port:D};return r.proxyServer&&(G.proxy=r.proxyServer),G});h=(await this.signal.init(v)).uid,x.debug("[".concat(this.store.clientId,"] websocket join uid ").concat(h," cost ").concat(Date.now()-this.joinGatewayStartTime))}catch(v){var y;throw x.error("[".concat(this.store.clientId,"] User join failed"),v.toString()),At.joinGateway(r.sid,{lts:c,succ:!1,ec:((y=v.data)===null||y===void 0?void 0:y.desc)||v.code,errorMsg:v.message,addr:this.signal.url,uid:r.uid,cid:r.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!m,signalChannel:"0",preload:r.preload}),u.delete(r.uid),this.signal.close(),v}return this.state="CONNECTED",this.inChannelInfo.joinAt=Date.now(),x.debug("[".concat(this.store.clientId,"] Connected to gateway server")),this.trafficStatsInterval=window.setInterval(()=>{this.updateTrafficStats().catch(v=>{x.warning("[".concat(this.store.clientId,"] get traffic stats error"),v.toString())})},3e3),this.networkQualityInterval=window.setInterval(()=>{navigator&&navigator.onLine!==void 0&&!navigator.onLine?this.emit(ls.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6}):this._signalTimeout?this.emit(ls.NETWORK_QUALITY,{downlinkNetworkQuality:5,uplinkNetworkQuality:5}):this.state==="CONNECTED"&&this._statsCollector.trafficStats?this.emit(ls.NETWORK_QUALITY,{uplinkNetworkQuality:jH(this._statsCollector.trafficStats.B_unq),downlinkNetworkQuality:jH(this._statsCollector.trafficStats.B_dnq)}):this.emit(ls.NETWORK_QUALITY,{uplinkNetworkQuality:0,downlinkNetworkQuality:0})},2e3),this.store.joinGatewayEnd(),h}async leave(){let r=arguments.length>0&&arguments[0]!==void 0&&arguments[0],s=arguments.length>1?arguments[1]:void 0;if(this.state!=="DISCONNECTED"){s!==qn.FALLBACK&&(this.state="DISCONNECTING");try{r||this.signal.connectionState!==gr.CONNECTED||await function(a,c){return c===1/0?a:dt.race([a,Qpe(c)])}(this.signal.request(Gt.LEAVE,void 0,!0),3e3)}catch(a){x.warning("[".concat(this.store.clientId,"] leave request failed, ignore"),a)}this.signal.close(s),s!==qn.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}}async publish(r,s,a){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Oe(te.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const c={state:"offer",p2p_id:this.store.p2pId,ortc:s,mode:this.spec.mode,extend:oe("PUB_EXTEND"),twcc:!!oe("PUBLISH_TWCC"),rtx:!!oe("USE_PUB_RTX")};try{return(await this.signal.request(Gt.PUBLISH,c,!0))._message}catch(u){if(a&&u.data&&u.data.code===Mt.ERR_PUBLISH_REQUEST_INVALID)return x.warning("[".concat(this.store.clientId,"] receive publish error code, retry"),u.toString()),await this.tryUnpubBeforeRepub(r,s),this.publish(r,s,!1);throw u}}async publishDataChannel(r,s,a){var c;if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Oe(te.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const u={stream_id:s.streamId,ordered:s.ordered?1:0,max_retrans_times:(c=s.maxRetransmits)!==null&&c!==void 0?c:10,channel_id:s.channelId,metadata:s.metadata};try{await this.signal.request(Gt.PUBLISH_DATASTREAM,u,!0)}catch(h){if(a&&h.data&&h.data.code===Mt.ERR_PUBLISH_REQUEST_INVALID)return x.warning("[".concat(this.store.clientId,"] receive publish datachannels error code, retry"),h.toString()),await this.tryUnpubDataChannelBeforeRepub(r,s),this.publishDataChannel(r,s,!1);throw h}}async unpublish(r,s){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Oe(te.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await this.signal.request(Gt.UNPUBLISH,{stream_id:s,ortc:r},!0)}catch(a){x.warning("[".concat(this.store.clientId,"] unpublish warning: "),a)}}async unpublishDataChannel(r){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Oe(te.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await dt.all(r.map(s=>this.signal.request(Gt.UNPUBLISH_DATASTREAM,{channel_id:s},!0)))}catch(s){x.warning("unpublish datachannels warning: ",s)}}async presubscribe(r,s,a){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Oe(te.INVALID_OPERATION,"can not presubscribe when connection state is ".concat(this.state));const c={stream_id:r,stream_type:s,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!oe("SUBSCRIBE_TWCC"),rtx:!!oe("USE_SUB_RTX")||void 0,extend:oe("SUB_EXTEND"),svc:Array.isArray(oe("SVC"))&&oe("SVC").length!==0?oe("SVC"):void 0};try{return await this.signal.request(Gt.PRE_SUBSCRIBE,c,!0)}catch(u){if(a&&u.data&&u.data.code===Mt.ERR_SUBSCRIBE_REQUEST_INVALID)return x.warning("[".concat(this.store.clientId,"] pre-subscribe error, retry"),u.toString()),this.presubscribe(r,s,!1);throw u}}async subscribe(r,s,a){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Oe(te.INVALID_OPERATION,"can not subscribe when connection state is ".concat(this.state));const c={stream_id:r,stream_type:s.stream_type,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!oe("SUBSCRIBE_TWCC"),rtx:!!oe("USE_SUB_RTX"),extend:oe("SUB_EXTEND"),ssrcId:s.ssrcId,svc:Array.isArray(oe("SVC"))&&oe("SVC").length!==0?oe("SVC"):void 0};try{return(await this.signal.request(Gt.SUBSCRIBE,c,!0))._message}catch(u){if(a&&u.data&&u.data.code===Mt.ERR_SUBSCRIBE_REQUEST_INVALID)return x.warning("[".concat(this.store.clientId,"] receiver subscribe error code, retry"),u.toString()),await this.tryUnsubBeforeResub(r,s),await this.subscribe(r,s,!1);throw u}}async subscribeDataChannel(r,s,a){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Oe(te.INVALID_OPERATION,"can not subscribe datachannel when connection state is ".concat(this.state));const c={uid:r,stream_id:s.id,channel_id:s.datachannelId};try{return void await this.signal.request(Gt.SUBSCRIBE_DATASTREAM,c,!0)}catch(u){if(a&&u.data&&u.data.code===Mt.ERR_SUBSCRIBE_REQUEST_INVALID)return x.warning("[".concat(this.store.clientId,"] receiver subscribe datachannel error code, retry"),u.toString()),await this.tryUnsubDataChannelBeforeResub(r,s),await this.subscribeDataChannel(r,s,!1);throw u}}async subscribeAll(r,s){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Oe(te.INVALID_OPERATION,"can not massSubscribe when connection state is ".concat(this.state));const a={p2p_id:this.store.p2pId,users:r,dtx:!1,rtx:!!oe("USE_SUB_RTX"),twcc:!!oe("SUBSCRIBE_TWCC"),svc:Array.isArray(oe("SVC"))&&oe("SVC").length!==0?oe("SVC"):void 0};try{return await this.signal.request(Gt.SUBSCRIBE_STREAMS,a,!0)}catch(c){if(s&&c.data&&c.data.code===Mt.ERR_SUBSCRIBE_REQUEST_INVALID)return x.warning("[".concat(this.store.clientId,"] receiver massSubscribe error code, retry"),c.toString()),await this.tryMassUnsubBeforeResub(r),await this.subscribeAll(r,!1);throw c}}async setVideoProfile(r){const s=function(a){if(!(a.bitrateMax&&a.bitrateMin&&a.frameRate&&a.height&&a.width))return;let c=a.frameRate,u=a.width,h=a.height,m=!0;return typeof c!="number"&&(c=c.exact||c.ideal||c.max||c.min||0,c||(m=!1)),typeof u!="number"&&(u=u.exact||u.ideal||u.max||u.min||0,u||(m=!1)),typeof h!="number"&&(h=h.exact||h.ideal||h.max||h.min||0,c||(m=!1)),m?{stream_type:0,width:u,height:h,fps:c,start_bps:1e3*a.bitrateMax,min_bps:1e3*a.bitrateMin,target_bps:1e3*a.bitrateMax}:void 0}(r);if(s)return this.signal.request(Gt.SET_VIDEO_PROFILE,s);x.debug("[".concat(this.store.clientId,"] encoder config is not complete, do not report to gateway"))}async unsubscribe(r,s){try{await this.signal.request(Gt.UNSUBSCRIBE,{p2p_id:this.store.p2pId,ortc:r,stream_id:s},!0)}catch(a){x.warning("[".concat(this.store.clientId,"] unsubscribe warning: "),a)}}async unsubscribeDataChannel(r,s){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Oe(te.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await dt.all(r.map(a=>this.signal.request(Gt.UNSUBSCRIBE_DATASTREAM,{stream_id:a,uid:s},!0)))}catch(a){x.warning("unsubscribeDataChannel warning: ",a)}}async massUnsubscribe(r){try{await this.signal.request(Gt.UNSUBSCRIBE_STREAMS,r,!0)}catch(s){x.warning("[".concat(this.store.clientId,"] massUnsubscribeAll warning: "),s)}}async reconnectPC(r){const{iceParameters:s,dtlsParameters:a,rtpCapabilities:c}=r;return{gatewayEstablishParams:await this.signal.request(Gt.CONNECT_PC,{p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:{iceParameters:s,dtlsParameters:a,rtpCapabilities:c}},!0),gatewayAddress:this.getCurrentGatewayAddress()}}getGatewayInfo(){return this.signal.request(Gt.GATEWAY_INFO)}async renewToken(r){await this.signal.request(Gt.RENEW_TOKEN,r),this.key=r.token}updateClientRole(r,s){s&&(this._clientRoleOptions=Object.assign({},s)),oe("CLIENT_ROLE_OPTIONS")&&(x.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify(oe("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," ")),this._clientRoleOptions=Object.assign({},oe("CLIENT_ROLE_OPTIONS"))),this.role=r}async setClientRole(r,s){if(s&&(this._clientRoleOptions=Object.assign({},s)),oe("CLIENT_ROLE_OPTIONS")&&(this._clientRoleOptions=Object.assign({},oe("CLIENT_ROLE_OPTIONS")),x.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify(oe("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," "))),this.state!=="CONNECTED")return void(this.role=r);let a,c=0;r==="audience"?this._clientRoleOptions&&this._clientRoleOptions.delay?(a=this._clientRoleOptions.delay,c=1):c=this._clientRoleOptions&&this._clientRoleOptions.level?this._clientRoleOptions.level:2:c=0,await this.signal.request(Gt.SET_CLIENT_ROLE,{role:r,level:c,delay:a,client_ts:Date.now()}),this.role=r}async setRemoteVideoStreamType(r,s){await this.signal.request(Gt.SWITCH_VIDEO_STREAM,{stream_id:r,stream_type:s})}async setDefaultRemoteVideoStreamType(r){await this.signal.request(Gt.DEFAULT_VIDEO_STREAM,{stream_type:r})}async setStreamFallbackOption(r,s){await this.signal.request(Gt.SET_FALLBACK_OPTION,{stream_id:r,fallback_type:s})}async pickSVCLayer(r,s){await this.signal.request(Gt.PICK_SVC_LAYER,{stream_id:r,spatial_layer:s.spatialLayer,temporal_layer:s.temporalLayer})}async setRTM2Flag(r){await this.signal.request(Gt.SET_RTM2_FLAG,{rtm2_flag:r})}async sendExtensionMessage(r,s,a){if(this.store.useP2P)return this.signal.sendExtensionMessage(r,s,a)}getInChannelInfo(){return this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt),fp({},this.inChannelInfo)}async getGatewayVersion(){return(await this.signal.request(Gt.GATEWAY_INFO)).version}reset(){if(this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt,this.inChannelInfo.joinAt=null),this.trafficStatsInterval&&(window.clearInterval(this.trafficStatsInterval),this.trafficStatsInterval=void 0),this.joinInfo){const r=E2.get(this.joinInfo.cname);r&&r.delete(this.joinInfo.uid)}this.joinInfo=void 0,this.key=void 0,this.networkQualityInterval&&(window.clearInterval(this.networkQualityInterval),this.networkQualityInterval=void 0)}updateTurnConfigFromSignal(){if(!this.joinInfo)return;const r=function(s){let a;return a=s.startsWith("dc")?s.match(/(dc\:\/\/)?([^:]+):(\d+)/):s.match(/(wss\:\/\/)?([^:]+):(\d+)/),a?{username:Ns.username,password:Ns.password,turnServerURL:a[2],tcpport:parseInt(a[3])+30,udpport:parseInt(a[3])+30,forceturn:!1}:null}((this.joinInfo.cloudProxyServer==="disabled"?this.signal.url:this.joinInfo.gatewayAddrs[this.signal.currentURLIndex].address)||"");this.joinInfo.turnServer.serversFromGateway=[],r&&this.joinInfo.turnServer.mode!=="off"&&this.joinInfo.cloudProxyServer==="disabled"&&this.joinInfo.turnServer.serversFromGateway.push(fp(fp({},Ns),{},{turnServerURL:r.turnServerURL,tcpport:r.tcpport,udpport:r.udpport,username:this.joinInfo.uid.toString(),password:this.joinInfo.token}))}async updateTrafficStats(){if(this.state!=="CONNECTED")return;const r=await this.signal.request(Gt.TRAFFIC_STATS,void 0,!0);r.timestamp=Date.now(),r.ntp_offset!=null&&(this.ntpOffset=r.ntp_offset),r.peer_delay.forEach(s=>{const a=this._statsCollector.trafficStats&&this._statsCollector.trafficStats.peer_delay.find(c=>c.peer_uid===s.peer_uid);a&&a.B_st!==s.B_st&&QA(()=>{this.emit(ls.STREAM_TYPE_CHANGE,s.peer_uid,s.B_st)})}),this._statsCollector.updateTrafficStats(r)}getJoinMessage(r){if(!this.joinInfo||!this.key)throw new Oe(te.UNEXPECTED_ERROR,"can not generate join message, no join info");const s=Object.assign({},this.joinInfo.apResponse);let a=oe("REPORT_APP_SCENARIO");if(typeof a!="string")try{a=JSON.stringify(a)}catch{a=void 0}var c;a&&a.length>128&&(a=void 0),this.store.hasStartJoinChannel=!0,this.store.isABTestSuccess||this.emit(ls.UPDATE_GATEWAY_CONFIG),c=this.store.clientId,ot(sS).call(sS,c)||sS.push(c);const u=!(zr()||w8(87)||fz())&&typeof oe("ENABLE_PRE_SUB")=="boolean"&&oe("ENABLE_PRE_SUB"),h=!fz()&&Nl("ENABLE_PREALLOC_PC","boolean"),m=Rge(),y=RT(87)||function(){const S=Dn();if(S.name!==Gn.SAFARI||!S.browserVersion)return!1;const R=S.browserVersion.split(".");return Number(R[0])>15||Number(R[0])===15&&Number(R[1])>=4}(),v=fp({license:this.joinInfo.license,p2p_id:this.store.p2pId,session_id:this.joinInfo.sid,app_id:this.joinInfo.appId,channel_key:this.key,channel_name:this.joinInfo.cname,sdk_version:Al,browser:navigator.userAgent,process_id:oe("PROCESS_ID"),mode:this.store.useP2P?"p2p":this.spec.mode,codec:this.spec.codec,role:this.role,has_changed_gateway:this.hasChangeBGPAddress,ap_response:s,extend:oe("JOIN_EXTEND"),details:{6:this.joinInfo.stringUid,cservice_map:this.joinInfo.cloudProxyServer==="proxy3"?"1":this.joinInfo.cloudProxyServer==="proxy5"?"2":void 0},features:{rejoin:!0},optionalInfo:this.joinInfo.optionalInfo,appScenario:a,attributes:{userAttributes:fp({enableEncodedTransform:!!oe("ENABLE_AUDIO_METADATA")&&y||!!oe("ENABLE_AUDIO_TOPN")&&hL(Gn.CHROME,87,116)||void 0,enableAudioMetadata:!!oe("ENABLE_AUDIO_METADATA")&&y,enableAudioPts:!!oe("ENABLE_AUDIO_PTS_METADATA")&&y,topnSmoothLevel:oe("TOPN_SMOOTH_LEVEL"),topnNewSpeakerDelay:oe("TOPN_NEW_SPEAKER_DELAY"),topnSwitchHoldMs:oe("TOPN_SWITCH_HOLD_MS"),topnAudioGain:oe("TOPN_AUDIO_GAIN"),enablePublishedUserList:oe("ENABLE_PUBLISHED_USER_LIST"),maxSubscription:oe("MAX_SUBSCRIPTION"),subscribeAudioFilterTopN:Nl("SUBSCRIBE_AUDIO_FILTER_TOPN","number"),enablePublishAudioFilter:Nl("ENABLE_PUBLISH_AUDIO_FILTER","boolean"),enableUserLicenseCheck:Nl("ENABLE_USER_LICENSE_CHECK","boolean"),enableRTX:oe("USE_PUB_RTX")===!0||oe("USE_SUB_RTX")===!0||void 0,disableFEC:oe("DISABLE_FEC"),enableNTPReport:!!oe("ENABLE_NTP_REPORT")||void 0,enableInstantVideo:!!oe("ENABLE_INSTANT_VIDEO")||void 0,enableFulllinkAvSync:!!oe("ENABLE_FULL_LINK_AV_SYNC")||void 0,enableDataStream2:Nl("ENABLE_DATASTREAM_2","boolean"),enableAutFeedback:!!oe("ENABLE_AUT_FEEDBACK")||void 0,rtm2Flag:typeof this.joinInfo.rtmFlag=="number"?this.joinInfo.rtmFlag:void 0,enableUserAutoRebalanceCheck:!!oe("ENABLE_USER_AUTO_REBALANCE_CHECK"),enableXR:Nl("USE_XR","boolean"),enableLossbasedBwe:Nl("ENABLE_LOSSBASED_BWE","boolean"),enableAutCC:!!oe("ENABLE_AUT_CC")||void 0,enableCCFallback:Nl("ENABLE_CC_FALLBACK","boolean"),enablePreallocPC:h,preSubNum:u?Nl("PRE_SUB_NUM","number"):void 0,enablePubTWCC:Nl("PUBLISH_TWCC","boolean"),enableSubTWCC:Nl("SUBSCRIBE_TWCC","boolean"),enablePubRTX:Nl("USE_PUB_RTX","boolean"),enableSubRTX:Nl("USE_SUB_RTX","boolean"),enableSubSVC:oe("ENABLE_SVC")?oe("ENABLE_SVC_DEFAULT_CODECS"):Array.isArray(oe("SVC"))&&oe("SVC").length!==0?oe("SVC"):void 0,enableSvcExtended:oe("ENABLE_SVC")&&Array.isArray(oe("SVC_EXTENDED"))&&oe("SVC_EXTENDED").length!==0?oe("SVC_EXTENDED"):void 0},m)},join_ts:this.joinGatewayStartTime},r);return this.joinInfo.stringUid&&(v.string_uid=this.joinInfo.stringUid),this.joinInfo.aesmode&&this.joinInfo.aespassword&&(v.aes_mode=this.joinInfo.aesmode,oe("ENCRYPT_AES")?(v.aes_secret=this.joinInfo.aespassword,v.aes_encrypt=!0):v.aes_secret=this.joinInfo.aespassword,this.joinInfo.aessalt&&(v.aes_salt=this.joinInfo.aessalt)),s.addresses[this.signal.websocket.currentURLIndex]&&(v.ap_response.ticket=s.addresses[this.signal.websocket.currentURLIndex].ticket,delete s.addresses),this.joinInfo.defaultVideoStream!==void 0&&(v.default_video_stream=this.joinInfo.defaultVideoStream),v}getRejoinMessage(){if(!this.joinInfo)throw new Oe(te.UNEXPECTED_ERROR,"can not generate rejoin message, no join info");return{session_id:this.joinInfo.sid,channel_name:this.joinInfo.cname,cid:this.joinInfo.cid,uid:this.joinInfo.uid,vid:Number(this.joinInfo.vid)}}handleSignalEvents(){this.signal.on(Ht.WS_RECONNECT_CREATE_CONNECTION,r=>{this.joinGatewayStartTime=Date.now()}),this.signal.on(Ht.WS_RECONNECTING,r=>{this.joinInfo&&At.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:r||Os.NETWORK_ERROR}),this.joinInfo&&(this.state="RECONNECTING",At.sessionInit(this.joinInfo.sid,{lts:new Date().getTime(),extend:this.isSignalRecover?{recover:!0}:{rejoin:!0},cname:this.joinInfo.cname,appid:this.joinInfo.appId,mode:this.spec.mode,stringUid:this.joinInfo.stringUid,channelProfile:this.spec.mode==="live"?1:0,channelMode:0,lsid:this.joinInfo.sid,clientRole:this.role==="audience"?2:1,buildFormat:1}),this.isSignalRecover=!1,this.joinGatewayStartTime=Date.now())}),this.signal.on(Ht.WS_CLOSED,r=>{let s;switch(r){case qn.LEAVE:s=Os.LEAVE;break;case qn.UID_BANNED:case qn.IP_BANNED:case qn.CHANNEL_BANNED:case qn.SERVER_ERROR:s=Os.SERVER_ERROR;break;case qn.FALLBACK:s=Os.FALLBACK;break;case qn.LICENSE_MISSING:case qn.LICENSE_EXPIRED:case qn.LICENSE_MINUTES_EXCEEDED:case qn.LICENSE_PERIOD_INVALID:case qn.LICENSE_MULTIPLE_SDK_SERVICE:case qn.LICENSE_ILLEGAL:case qn.TOKEN_EXPIRE:s=r;break;default:s=Os.NETWORK_ERROR}x.debug("[".concat(this.store.clientId,"] [signal] websocket closed, reason: ").concat(s||"undefined -> "+Os.NETWORK_ERROR)),this.joinInfo&&At.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:r===qn.LEAVE?1:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:s}),this._disconnectedReason=r,r!==qn.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}),this.signal.on(Ht.WS_CONNECTED,()=>{if(this.updateTurnConfigFromSignal(),this.state="CONNECTED",this.joinInfo){if(this.role==="audience"){const r=oe("CLIENT_ROLE_OPTIONS")||this._clientRoleOptions;r&&(r.level||r.delay)&&(x.debug("[".concat(this.store.clientId,"] patch to send set client role, role: ").concat(this.role,", mode: ").concat(this.spec.mode,", level: ").concat(r.level,", delay: ").concat(r.delay)),this.setClientRole(this.role,r))}if(At.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!0,ec:null,vid:this.joinInfo.vid,addr:this.signal.url,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload,isABTestSuccess:this.store.isABTestSuccess}),this._isProactiveJoin=!1,this.joinInfo.useLocalAccessPoint&&this.joinInfo.setLocalAPVersion===1){const r=this.signal.url&&this.signal.url.match(/wss\:\/\/([^:]+):(\d+)/);if(!r)return void x.error("[".concat(this.store.clientId,"] set local access point after joined failed: ").concat(r));rr("EVENT_REPORT_DOMAIN",r[1]),rr("EVENT_REPORT_BACKUP_DOMAIN",r[1]),rr("LOG_UPLOAD_SERVER","".concat(r[1],":6444"))}}}),this.signal.on(wn.ON_UPLINK_STATS,r=>{this._statsCollector.updateUplinkStats(r)}),this.signal.on(Ht.REQUEST_RECOVER,(r,s,a)=>{if(!this.joinInfo)return a(new Oe(te.UNEXPECTED_ERROR,"gateway: can not recover, no join info"));r&&(this.joinInfo.multiIP=r,this.hasChangeBGPAddress=!0),this.isSignalRecover=!0,ks(this,ls.REQUEST_NEW_GATEWAY_LIST).then(s).catch(a)}),this.signal.on(Ht.REQUEST_JOIN_INFO,async(r,s,a)=>{var c;if(this.updateTurnConfigFromSignal(),this.store.useP2P)return void r(this.getJoinMessage({ortc:{}}));const u=$r((c=this.joinInfo)===null||c===void 0?void 0:c.turnServer);if(oe("NEW_TURN_MODE")&&u){let v=u.servers,S=u.serversFromGateway;const R=this.signal.currentURLIndex;v.length>0&&(v=[v[R%v.length]],u.servers=v),Array.isArray(S)&&S.length>0&&(S=[S[0]],u.serversFromGateway=S),x.debug("[".concat(this.store.clientId,"] use single turn, use turn server index: ").concat(R))}const{iceParameters:h,dtlsParameters:m,rtpCapabilities:y}=await ks(this,ls.REQUEST_P2P_CONNECTION_PARAMS,{turnServer:u});try{r(this.getJoinMessage({ortc:{iceParameters:h,dtlsParameters:m,rtpCapabilities:y,version:"2"}}))}catch(v){s(v)}}),this.signal.on(Ht.REQUEST_REJOIN_INFO,r=>{r(this.getRejoinMessage())}),this.signal.on(Ht.REPORT_JOIN_GATEWAY,(r,s)=>{if(!this.joinInfo)return;let a,c="";var u;r instanceof Oe?(a=((u=r.data)===null||u===void 0?void 0:u.desc)||r.code,c=r.message):a=r,At.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!1,ec:a,errorMsg:c,addr:s,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload})}),this.signal.on(Ht.IS_P2P_DISCONNECTED,r=>{r(kT(this,ls.IS_P2P_DISCONNECTED))}),this.signal.on(Ht.DISCONNECT_P2P,()=>{this.emit(ls.DISCONNECT_P2P)}),this.signal.on(Ht.REQUEST_SUCCESS,()=>{this._signalTimeout=!1}),this.signal.on(Ht.REQUEST_TIMEOUT,()=>{this._signalTimeout=!0}),this.signal.on(Ht.JOIN_RESPONSE,r=>{const s=this.getCurrentGatewayAddress();this.emit(ls.JOIN_RESPONSE,r,s)}),this.signal.on(Ht.PRE_CONNECT_PC,async()=>{if(this.joinInfo){this.updateTurnConfigFromSignal();const r=this.getCurrentGatewayAddress(),s=oe("FINGERPRINT")||this.joinInfo.apResponse.addresses[this.signal.currentURLIndex].fingerprint;if(r&&s){const a=qH(r);this.emit(ls.PRE_CONNECT_PC,{candidates:a,fingerprint:s})}}}),this.signal.on(Ht.RECOVER_NOTIFICATION,r=>{this.joinInfo&&typeof oe("AP_REQUEST_DETAIL")=="string"&&(this.joinInfo.apRequestDetail="".concat(oe("AP_REQUEST_DETAIL"),";").concat(r))})}async tryUnsubBeforeResub(r,s){try{await this.signal.request(Gt.UNSUBSCRIBE,{p2p_id:this.store.p2pId,stream_id:r,ortc:[s]},!0)}catch(a){throw x.warning("[".concat(this.store.clientId,"] tryUnsubBeforeResub warning"),a),a}}async tryUnsubDataChannelBeforeResub(r,s){try{await this.signal.request(Gt.UNSUBSCRIBE,{stream_id:s.id},!0)}catch(a){throw x.warning("unsubscribe datachannel warning",a),a}}async tryUnpubBeforeRepub(r,s){try{await this.signal.request(Gt.UNPUBLISH,{stream_id:r,ortc:s},!0)}catch(a){throw x.warning("[".concat(this.store.clientId,"] tryUnpubBeforeRepub warning: "),a),a}}async tryUnpubDataChannelBeforeRepub(r,s){try{await this.signal.request(Gt.UNPUBLISH_DATASTREAM,{channnel_id:s.channelId},!0)}catch(a){throw x.warning("unpublish datastream warning: ",a),a}}async tryMassUnsubBeforeResub(r){const s={users:r.map(a=>({stream_id:a.stream_id,stream_type:a.stream_type}))};try{await this.signal.request(Gt.UNSUBSCRIBE_STREAMS,s,!0)}catch(a){throw x.warning("[".concat(this.store.clientId,"] tryMassUnsubBeforeResub warning"),a),a}}async muteLocal(r,s){const a={action:r.find(c=>c.stream_type===Xn.Audio)?"mute_local_audio":"mute_local_video",p2p_id:this.store.p2pId,ortc:r,stream_id:s};try{await this.signal.request(Gt.CONTROL,a,!0,!0)}catch(c){throw x.warning("[".concat(this.store.clientId,"] gateway muteLocal warning: "),c),c}}async unmuteLocal(r,s){const a={action:r.find(c=>c.stream_type===Xn.Audio)?"unmute_local_audio":"unmute_local_video",p2p_id:this.store.p2pId,ortc:r,stream_id:s};try{await this.signal.request(Gt.CONTROL,a,!0,!0)}catch(c){throw x.warning("[".concat(this.store.clientId,"] gateway unmuteLocal warning: "),c),c}}async muteRemote(r,s){const a={action:r===Et.AUDIO?"mute_remote_audio":"mute_remote_video",p2p_id:this.store.p2pId,stream_id:s};try{await this.signal.request(Gt.CONTROL,a,!0,!0)}catch(c){throw x.warning("[".concat(this.store.clientId,"] gateway muteRemote warning: "),c),c}}async unmuteRemote(r,s){const a={action:r===Et.AUDIO?"unmute_remote_audio":"unmute_remote_video",p2p_id:this.store.p2pId,stream_id:s};try{await this.signal.request(Gt.CONTROL,a,!0,!0)}catch(c){throw x.warning("[".concat(this.store.clientId,"] gateway unmuteRemote warning: "),c),c}}uploadWRTCStats(r){this.signal.uploadWRTCStats(r)}upload(r,s){this.signal.upload(r,s)}getSignalRTT(){return this.signal.rtt}async restartICE(r){const s={p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:r};try{return await this.signal.request(Gt.RESTART_ICE,s,!0)}catch(a){throw x.warning("[".concat(this.store.clientId,"] P2PChannel.restartICE warning: "),a),a}}reconnect(r,s){this.state==="CONNECTED"&&this.signal.reconnect(r||void 0,s||Os.P2P_FAILED)}getCurrentGatewayAddress(){var r,s;if(!oe("GATEWAY_WSS_ADDRESS"))return oe("USE_CANDIDATE_FROM_AP_DETAIL")&&(r=this.joinInfo)!==null&&r!==void 0&&r.apGatewayAddress?(x.debug("[".concat(this.store.clientId,"] use candidate from ap detail, ").concat(JSON.stringify(this.joinInfo.apGatewayAddress))),this.joinInfo.apGatewayAddress):(s=this.joinInfo)!==null&&s!==void 0&&s.gatewayAddrs?this.joinInfo.gatewayAddrs[this.signal.currentURLIndex]:void 0}async setPublishAudioFilterEnabled(r){await this.signal.request(Gt.SET_PARAMETER,{enablePublishAudioFilter:r})}}let DP=0,v2=0;function Cd(t,r,s,a){return new dt((c,u)=>{r.timeout=r.timeout||oe("HTTP_CONNECT_TIMEOUT"),r.responseType=r.responseType||"json",r.data&&!s?(r.data=JSON.stringify(r.data),DP+=bh(r.data)):s&&(r.data.size?DP+=r.data.size:r.data instanceof FormData?DP+=W8(r.data):DP+=bh(JSON.stringify(r.data))),r.headers=r.headers||{},r.headers["Content-Type"]=r.headers["Content-Type"]||"application/json",r.method="POST",r.url=t,ha.request(r).then(h=>{typeof h.data=="string"?v2+=bh(h.data):h.data instanceof ArrayBuffer||h.data instanceof Uint8Array?v2+=h.data.byteLength:v2+=bh(JSON.stringify(h.data)),a&&c({data:h.data,headers:h.headers}),c(h.data)}).catch(h=>{ha.isCancel(h)?u(new Oe(te.OPERATION_ABORTED,"cancel token canceled")):h.code==="ECONNABORTED"?u(new Oe(te.NETWORK_TIMEOUT,h.message)):h.response?u(new Oe(te.NETWORK_RESPONSE_ERROR,h.response.status)):u(new Oe(te.NETWORK_ERROR,h.message))})})}/*! formdata-polyfill. MIT License. Jimmy W?rting <https://jimmy.warting.se/opensource> */(function(){var t;function r(je){var st=0;return function(){return st<je.length?{done:!1,value:je[st++]}:{done:!0}}}var s=typeof Object.defineProperties=="function"?Object.defineProperty:function(je,st,Ct){return je==Array.prototype||je==Object.prototype||(je[st]=Ct.value),je},a,c=function(je){je=[typeof globalThis=="object"&&globalThis,je,typeof window=="object"&&window,typeof self=="object"&&self,typeof o=="object"&&o];for(var st=0;st<je.length;++st){var Ct=je[st];if(Ct&&Ct.Math==Math)return Ct}throw Error("Cannot find global object")}(this);function u(je,st){if(st)e:{var Ct=c;je=je.split(".");for(var He=0;He<je.length-1;He++){var M=je[He];if(!(M in Ct))break e;Ct=Ct[M]}(st=st(He=Ct[je=je[je.length-1]]))!=He&&st!=null&&s(Ct,je,{configurable:!0,writable:!0,value:st})}}function h(je){return(je={next:je})[Symbol.iterator]=function(){return this},je}function m(je){var st=typeof Symbol<"u"&&Symbol.iterator&&je[Symbol.iterator];return st?st.call(je):{next:r(je)}}if(u("Symbol",function(je){function st(M,ae){this.A=M,s(this,"description",{configurable:!0,writable:!0,value:ae})}if(je)return je;st.prototype.toString=function(){return this.A};var Ct="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",He=0;return function M(ae){if(this instanceof M)throw new TypeError("Symbol is not a constructor");return new st(Ct+(ae||"")+"_"+He++,ae)}}),u("Symbol.iterator",function(je){if(je)return je;je=Symbol("Symbol.iterator");for(var st="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),Ct=0;Ct<st.length;Ct++){var He=c[st[Ct]];typeof He=="function"&&typeof He.prototype[je]!="function"&&s(He.prototype,je,{configurable:!0,writable:!0,value:function(){return h(r(this))}})}return je}),typeof Object.setPrototypeOf=="function")a=Object.setPrototypeOf;else{var y;e:{var v={};try{v.__proto__={a:!0},y=v.a;break e}catch{}y=!1}a=y?function(je,st){if(je.__proto__=st,je.__proto__!==st)throw new TypeError(je+" is not extensible");return je}:null}var S=a;function R(){this.m=!1,this.j=null,this.v=void 0,this.h=1,this.u=this.C=0,this.l=null}function P(je){if(je.m)throw new TypeError("Generator is already running");je.m=!0}function D(je,st){return je.h=3,{value:st}}function G(je){this.g=new R,this.G=je}function F(je,st,Ct,He){try{var M=st.call(je.g.j,Ct);if(!(M instanceof Object))throw new TypeError("Iterator result "+M+" is not an object");if(!M.done)return je.g.m=!1,M;var ae=M.value}catch(me){return je.g.j=null,je.g.s(me),j(je)}return je.g.j=null,He.call(je.g,ae),j(je)}function j(je){for(;je.g.h;)try{var st=je.G(je.g);if(st)return je.g.m=!1,{value:st.value,done:!1}}catch(Ct){je.g.v=void 0,je.g.s(Ct)}if(je.g.m=!1,je.g.l){if(st=je.g.l,je.g.l=null,st.F)throw st.D;return{value:st.return,done:!0}}return{value:void 0,done:!0}}function Y(je){this.next=function(st){return je.o(st)},this.throw=function(st){return je.s(st)},this.return=function(st){return function(Ct,He){P(Ct.g);var M=Ct.g.j;return M?F(Ct,"return"in M?M.return:function(ae){return{value:ae,done:!0}},He,Ct.g.return):(Ct.g.return(He),j(Ct))}(je,st)},this[Symbol.iterator]=function(){return this}}function ee(je,st){return st=new Y(new G(st)),S&&je.prototype&&S(st,je.prototype),st}if(R.prototype.o=function(je){this.v=je},R.prototype.s=function(je){this.l={D:je,F:!0},this.h=this.C||this.u},R.prototype.return=function(je){this.l={return:je},this.h=this.u},G.prototype.o=function(je){return P(this.g),this.g.j?F(this,this.g.j.next,je,this.g.o):(this.g.o(je),j(this))},G.prototype.s=function(je){return P(this.g),this.g.j?F(this,this.g.j.throw,je,this.g.o):(this.g.s(je),j(this))},u("Array.prototype.entries",function(je){return je||function(){return function(st,Ct){st instanceof String&&(st+="");var He=0,M=!1,ae={next:function(){if(!M&&He<st.length){var me=He++;return{value:Ct(me,st[me]),done:!1}}return M=!0,{done:!0,value:void 0}}};return ae[Symbol.iterator]=function(){return ae},ae}(this,function(st,Ct){return[st,Ct]})}}),typeof Blob<"u"&&(typeof FormData>"u"||!FormData.prototype.keys)){var fe=function(je,st){for(var Ct=0;Ct<je.length;Ct++)st(je[Ct])},Se=function(je){return je.replace(/\r?\n|\r/g,`\r
`)},we=function(je,st,Ct){return st instanceof Blob?(Ct=Ct!==void 0?Ct+"":typeof st.name=="string"?st.name:"blob",st.name===Ct&&Object.prototype.toString.call(st)!=="[object Blob]"||(st=new File([st],Ct)),[String(je),st]):[String(je),String(st)]},ye=function(je,st){if(je.length<st)throw new TypeError(st+" argument required, but only "+je.length+" present.")},Ne=typeof globalThis=="object"?globalThis:typeof window=="object"?window:typeof self=="object"?self:this,Ye=Ne.FormData,ht=Ne.XMLHttpRequest&&Ne.XMLHttpRequest.prototype.send,mt=Ne.Request&&Ne.fetch,In=Ne.navigator&&Ne.navigator.sendBeacon,An=Ne.Element&&Ne.Element.prototype,mr=Ne.Symbol&&Symbol.toStringTag;mr&&(Blob.prototype[mr]||(Blob.prototype[mr]="Blob"),"File"in Ne&&!File.prototype[mr]&&(File.prototype[mr]="File"));try{new File([],"")}catch{Ne.File=function(st,Ct,He){return st=new Blob(st,He||{}),Object.defineProperties(st,{name:{value:Ct},lastModified:{value:+(He&&He.lastModified!==void 0?new Date(He.lastModified):new Date)},toString:{value:function(){return"[object File]"}}}),mr&&Object.defineProperty(st,mr,{value:"File"}),st}}var di=function(je){return je.replace(/\n/g,"%0A").replace(/\r/g,"%0D").replace(/"/g,"%22")},Jr=function(je){this.i=[];var st=this;je&&fe(je.elements,function(Ct){if(Ct.name&&!Ct.disabled&&Ct.type!=="submit"&&Ct.type!=="button"&&!Ct.matches("form fieldset[disabled] *"))if(Ct.type==="file"){var He=Ct.files&&Ct.files.length?Ct.files:[new File([],"",{type:"application/octet-stream"})];fe(He,function(M){st.append(Ct.name,M)})}else Ct.type==="select-multiple"||Ct.type==="select-one"?fe(Ct.options,function(M){!M.disabled&&M.selected&&st.append(Ct.name,M.value)}):Ct.type==="checkbox"||Ct.type==="radio"?Ct.checked&&st.append(Ct.name,Ct.value):(He=Ct.type==="textarea"?Se(Ct.value):Ct.value,st.append(Ct.name,He))})};if((t=Jr.prototype).append=function(je,st,Ct){ye(arguments,2),this.i.push(we(je,st,Ct))},t.delete=function(je){ye(arguments,1);var st=[];je=String(je),fe(this.i,function(Ct){Ct[0]!==je&&st.push(Ct)}),this.i=st},t.entries=function je(){var st,Ct=this;return ee(je,function(He){if(He.h==1&&(st=0),He.h!=3)return st<Ct.i.length?He=D(He,Ct.i[st]):(He.h=0,He=void 0),He;st++,He.h=2})},t.forEach=function(je,st){ye(arguments,1);for(var Ct=m(this),He=Ct.next();!He.done;He=Ct.next()){var M=m(He.value);He=M.next().value,M=M.next().value,je.call(st,M,He,this)}},t.get=function(je){ye(arguments,1);var st=this.i;je=String(je);for(var Ct=0;Ct<st.length;Ct++)if(st[Ct][0]===je)return st[Ct][1];return null},t.getAll=function(je){ye(arguments,1);var st=[];return je=String(je),fe(this.i,function(Ct){Ct[0]===je&&st.push(Ct[1])}),st},t.has=function(je){ye(arguments,1),je=String(je);for(var st=0;st<this.i.length;st++)if(this.i[st][0]===je)return!0;return!1},t.keys=function je(){var st,Ct,He,M,ae=this;return ee(je,function(me){if(me.h==1&&(st=m(ae),Ct=st.next()),me.h!=3)return Ct.done?void(me.h=0):(He=Ct.value,M=m(He),D(me,M.next().value));Ct=st.next(),me.h=2})},t.set=function(je,st,Ct){ye(arguments,2),je=String(je);var He=[],M=we(je,st,Ct),ae=!0;fe(this.i,function(me){me[0]===je?ae&&(ae=!He.push(M)):He.push(me)}),ae&&He.push(M),this.i=He},t.values=function je(){var st,Ct,He,M,ae=this;return ee(je,function(me){if(me.h==1&&(st=m(ae),Ct=st.next()),me.h!=3)return Ct.done?void(me.h=0):(He=Ct.value,(M=m(He)).next(),D(me,M.next().value));Ct=st.next(),me.h=2})},Jr.prototype._asNative=function(){for(var je=new Ye,st=m(this),Ct=st.next();!Ct.done;Ct=st.next()){var He=m(Ct.value);Ct=He.next().value,He=He.next().value,je.append(Ct,He)}return je},Jr.prototype._blob=function(){var je="----formdata-polyfill-"+Math.random(),st=[],Ct="--"+je+`\r
Content-Disposition: form-data; name="`;return this.forEach(function(He,M){return typeof He=="string"?st.push(Ct+di(Se(M))+`"\r
\r
`+Se(He)+`\r
`):st.push(Ct+di(Se(M))+'"; filename="'+di(He.name)+`"\r
Content-Type: `+(He.type||"application/octet-stream")+`\r
\r
`,He,`\r
`)}),st.push("--"+je+"--"),new Blob(st,{type:"multipart/form-data; boundary="+je})},Jr.prototype[Symbol.iterator]=function(){return this.entries()},Jr.prototype.toString=function(){return"[object FormData]"},An&&!An.matches&&(An.matches=An.matchesSelector||An.mozMatchesSelector||An.msMatchesSelector||An.oMatchesSelector||An.webkitMatchesSelector||function(je){for(var st=(je=(this.document||this.ownerDocument).querySelectorAll(je)).length;0<=--st&&je.item(st)!==this;);return-1<st}),mr&&(Jr.prototype[mr]="FormData"),ht){var ya=Ne.XMLHttpRequest.prototype.setRequestHeader;Ne.XMLHttpRequest.prototype.setRequestHeader=function(je,st){ya.call(this,je,st),je.toLowerCase()==="content-type"&&(this.B=!0)},Ne.XMLHttpRequest.prototype.send=function(je){je instanceof Jr?(je=je._blob(),this.B||this.setRequestHeader("Content-Type",je.type),ht.call(this,je)):ht.call(this,je)}}mt&&(Ne.fetch=function(je,st){return st&&st.body&&st.body instanceof Jr&&(st.body=st.body._blob()),mt.call(this,je,st)}),In&&(Ne.navigator.sendBeacon=function(je,st){return st instanceof Jr&&(st=st._asNative()),In.call(this,je,st)}),Ne.FormData=Jr}})();const $T=()=>{const t=oe("AREAS");return t.length===0&&t.push(Hn.GLOBAL),hc(t).call(t,(r,s,a)=>{const c=a9(s);return c?a===0?c:"".concat(r,",").concat(c):r},"")},a9=t=>t===Hn.OVERSEA?"".concat(js.ASIA,",").concat(js.EUROPE,",").concat(js.AFRICA,",").concat(js.NORTH_AMERICA,",").concat(js.SOUTH_AMERICA,",").concat(js.OCEANIA):js[t],Age=t=>{const r={CODE:"",WEBCS_DOMAIN:[],WEBCS_DOMAIN_BACKUP_LIST:[],PROXY_CS:[],CDS_AP:[],ACCOUNT_REGISTER:[],UAP_AP:[],EVENT_REPORT_DOMAIN:[],EVENT_REPORT_BACKUP_DOMAIN:[],LOG_UPLOAD_SERVER:[],PROXY_SERVER_TYPE3:[]};return t.map(s=>{const a=CP[s],c=Object.keys(a);c&&c.map(u=>{u!=="CODE"&&(r[u]=r[u].concat(a[u]))})}),r},xP={GLOBAL:{ASIA:[Hn.CHINA,Hn.JAPAN,Hn.INDIA,Hn.KOREA,Hn.HKMC],EUROPE:[],NORTH_AMERICA:[Hn.US],SOUTH_AMERICA:[],OCEANIA:[],AFRICA:[]}},LP=Object.keys(xP[Hn.GLOBAL]),S2=[Hn.CHINA,Hn.NORTH_AMERICA,Hn.EUROPE,Hn.ASIA,Hn.JAPAN,Hn.INDIA,Hn.OCEANIA,Hn.SOUTH_AMERICA,Hn.AFRICA,Hn.KOREA,Hn.HKMC,Hn.US],Pge=function(t,r){let s=[];if(ot(t).call(t,Hn.GLOBAL)){const u=[Hn.GLOBAL,Hn.OVERSEA],h=Object.keys(CP);if(r===Hn.GLOBAL)throw new Oe(te.INVALID_PARAMS,"GLOBAL is an invalid excludedArea value");if(r===Hn.CHINA)s=[Hn.OVERSEA];else if(c=r,ot(LP).call(LP,c)){const m=(a=r,xP[Hn.GLOBAL][a]||[]),y=[...u,r,...m];s=h.filter(v=>!ot(y).call(y,v))}else if(function(m){let y=!1;return LP.forEach(v=>{var S;ot(S=xP[Hn.GLOBAL][v]).call(S,m)&&(y=!0)}),y}(r)){const m=function(v){let S;return LP.forEach(R=>{var P;ot(P=xP[Hn.GLOBAL][R]).call(P,v)&&(S=R)}),S}(r),y=[...u,m,r];s=h.filter(v=>!ot(y).call(y,v))}else s=t;s=function(m){const y=[];return S2.forEach(v=>{ot(m).call(m,v)&&y.push(v)}),y.concat(m.filter(v=>!ot(S2).call(S2,v)))}(s)}else s=t;var a,c;return s};function c9(t){var r,s;if(!t&&ot(r=oe("AREAS")).call(r,Hn.EXTENSIONS))return x.debug("update area from ap : reset"),void b2(Vme,!0);if(!ot(s=oe("AREAS")).call(s,Hn.GLOBAL)||!t)return;let a=CP.EXTENSIONS;a&&(a={CODE:a9(Hn.EXTENSIONS),WEBCS_DOMAIN:["ap-web-1-".concat(t,".agora.io")],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-".concat(t,".ap.sd-rtn.com")],PROXY_CS:["proxy-ap-web-".concat(t,".agora.io")],CDS_AP:["cds-ap-web-1-".concat(t,".agora.io"),"cds-ap-web-2-".concat(t,".ap.sd-rtn.com")],ACCOUNT_REGISTER:["sua-ap-web-1-".concat(t,".agora.io"),"sua-ap-web-2-".concat(t,".ap.sd-rtn.com")],UAP_AP:["uap-ap-web-1-".concat(t,".agora.io"),"uap-ap-web-2-".concat(t,".ap.sd-rtn.com")],EVENT_REPORT_DOMAIN:["statscollector-1-".concat(t,".agora.io")],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-".concat(t,".agora.io")],LOG_UPLOAD_SERVER:["logservice-".concat(t,".agora.io")],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy-".concat(t,".agora.io")]},x.debug("update area from ap success: ".concat(t,",config is "),a),rr("AREAS",[Hn.EXTENSIONS],!0),Object.keys(a).map(c=>{c==="LOG_UPLOAD_SERVER"||c==="EVENT_REPORT_DOMAIN"||c==="EVENT_REPORT_BACKUP_DOMAIN"||c==="PROXY_SERVER_TYPE3"?rr(c,a[c][0]):rr(c,a[c])}))}function b2(t){let r=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const s=At.reportApiInvoke(null,{name:Oi.SET_AREA,options:t,tag:Hr.TRACER});try{let a=[];if(typeof t=="string"&&(a=[t]),Array.isArray(t)&&(t.forEach(u=>{if(!ot(AH).call(AH,u))throw new Oe(te.INVALID_PARAMS,"invalid area code")}),a=t),Object.prototype.toString.call(t)==="[object Object]"){const{areaCode:u,excludedArea:h}=t;if(!u)throw new Oe(te.INVALID_PARAMS,"area code is needed");let m=u;typeof u=="string"&&(m=[u]),a=h?Pge(m,h):m}if(!r){if(Sd.AREAS){const u=new Oe(te.PROHIBITED_OPERATION,"setArea is prohibited because of config-distribute");return s.onError(u),void x.warning("setArea is prohibited because of config-distribute")}if(ot(a).call(a,Hn.GLOBAL)&&oe("AREAS")===Hn.EXTENSIONS){const u=new Oe(te.PROHIBITED_OPERATION,"setArea is prohibited because of ap extensions");return s.onError(u),void x.warning("setArea is prohibited because of ap extensions")}}rr("AREAS",a,r);const c=Age(a);Object.keys(c).map(u=>{u==="LOG_UPLOAD_SERVER"||u==="EVENT_REPORT_DOMAIN"||u==="EVENT_REPORT_BACKUP_DOMAIN"||u==="PROXY_SERVER_TYPE3"?rr(u,c[u][0]):rr(u,c[u])}),x.debug("set area success:",a.join(","))}catch(a){throw s.onError(a),a}s.onSuccess()}function l9(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}function Ah(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?l9(Object(s),!0).forEach(function(a){K(t,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):l9(Object(s)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))})}return t}let T2=1;function Oge(t,r,s,a,c){T2+=1;const u={sid:s.sid,command:"convergeAllocateEdge",uid:"666",appId:s.appId,ts:Math.floor(Date.now()/1e3),seq:T2,requestId:T2,version:Al,cname:s.cname},h={service_name:r,json_body:JSON.stringify(u)};let m,y,v=t[0];return vd(async()=>{m=Date.now();const S=await Cd(v,{data:h,cancelToken:a,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"}});if(y=Date.now()-m,S.code!==0){const D=new Oe(te.UNEXPECTED_RESPONSE,"live streaming ap error, code"+S.code,{retry:!0,responseTime:y});throw x.error(D.toString()),D}const R=JSON.parse(S.json_body);if(R.code!==200){const D=new Oe(te.UNEXPECTED_RESPONSE,"live streaming app center error, code: ".concat(R.code,", reason: ").concat(R.reason),{code:R.code,responseTime:y});throw x.error(D.toString()),D}if(!R.servers||R.servers.length===0){const D=new Oe(te.UNEXPECTED_RESPONSE,"live streaming app center empty server",{code:R.code,responseTime:y});throw x.error(D.toString()),D}const P=function(D,G){return{addressList:D.servers.map(F=>"wss://".concat(F.address.replace(/\./g,"-"),".").concat(oe("WORKER_DOMAIN"),":").concat(F.wss,"?serviceName=").concat(encodeURIComponent(G))),workerToken:D.workerToken,vid:D.vid}}(R,r);return oe("LIVE_STREAMING_ADDRESS")&&(P.addressList=oe("LIVE_STREAMING_ADDRESS")instanceof Array?oe("LIVE_STREAMING_ADDRESS"):[oe("LIVE_STREAMING_ADDRESS")]),Ah(Ah({},P),{},{responseTime:y})},(S,R)=>(At.apworkerEvent(s.sid,{success:!0,sc:200,serviceName:r,responseDetail:JSON.stringify(S.addressList),firstSuccess:R===0,responseTime:y,serverIp:t[R%t.length]}),!1),(S,R)=>(At.apworkerEvent(s.sid,{success:!1,sc:S.data&&S.data.code||200,serviceName:r,responseTime:y,serverIp:t[R%t.length]}),!!(S.code!==te.OPERATION_ABORTED&&S.code!==te.UNEXPECTED_RESPONSE||S.data&&S.data.retry)&&(v=t[(R+1)%t.length],!0)),c)}let w2=1;function u9(t,r,s,a){let{url:c,areaCode:u}=t;const{clientId:h,sid:m}=r,y=Date.now();let v;const S=r.role,[R,P]=R2(r,u,[Si.CHOOSE_SERVER]);let D=vi.networkState;return vd(async()=>{D&&vi.networkState===Ec.OFFLINE&&vi.onlineWaiter&&await dt.race([vi.onlineWaiter,ps(a&&a.maxRetryTimeout||ki.maxRetryTimeout)]),D=vi.networkState;const{data:G,headers:F}=await Cd(c,{data:R,cancelToken:s,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);v=F.http3==="1"?1:-1,At.reportResourceTiming(c,m),h9(G,c,r,y,[Si.CHOOSE_SERVER],v);const j=WT(G,Si.CHOOSE_SERVER);return C2(j),p2(j,c)},G=>(G&&At.joinChooseServer(m,{role:S,lts:y,succ:!0,csAddr:c,opid:P,serverList:G.gatewayAddrs.map(F=>F.address),ec:null,cid:G.cid.toString(),uid:G.uid.toString(),csIp:G.csIp,unilbsServerIds:[Si.CHOOSE_SERVER].toString(),isHttp3:v,corssRegionTagReq:r.apRequestDetail,corssRegionTagRes:G.res.detail&&G.res.detail[38]}),!1),G=>G.code!==te.OPERATION_ABORTED&&(G.code===te.CAN_NOT_GET_GATEWAY_SERVER?G.data.retry:(At.joinChooseServer(m,{role:S,lts:y,succ:!1,csAddr:c,serverList:null,opid:P,ec:G.code,csIp:G.data&&G.data.csIp,unilbsServerIds:[Si.CHOOSE_SERVER].toString(),extend:JSON.stringify({networkState:D}),isHttp3:v,corssRegionTagReq:r.apRequestDetail}),x.warning("[".concat(h||"sid-".concat(m.slice(0,6)),"] Choose server network error, retry"),G),!0)),a)}function d9(t,r,s,a){let c,{url:u,areaCode:h,serviceIds:m}=t;const y=Date.now(),v=r.role,[S,R]=R2(r,h,m);let P;return vd(async()=>{P&&vi.networkState===Ec.OFFLINE&&vi.onlineWaiter&&await dt.race([vi.onlineWaiter,ps(a&&a.maxRetryTimeout||ki.maxRetryTimeout)]),P=vi.networkState;const{data:D,headers:G}=await Cd(u,{data:S,cancelToken:s,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);c=G.http3==="1"?1:-1,At.reportResourceTiming(u,r.sid),h9(D,u,r,y,m,c);const F=WT(D,Si.CHOOSE_SERVER),j=WT(D,r.cloudProxyServer==="proxy5"?Si.CLOUD_PROXY_5:r.cloudProxyServer==="proxy3"||r.cloudProxyServer==="proxy4"?Si.CLOUD_PROXY:Si.CLOUD_PROXY_FALLBACK);return C2(F),{gatewayInfo:p2(F,u),proxyInfo:j,url:u}},D=>(D.gatewayInfo&&At.joinChooseServer(r.sid,{role:v,lts:y,succ:!0,csAddr:u,serverList:D.gatewayInfo.gatewayAddrs.map(G=>G.address),ec:null,opid:R,cid:D.gatewayInfo.cid.toString(),uid:D.gatewayInfo.uid.toString(),csIp:D.gatewayInfo.csIp,unilbsServerIds:m.toString(),isHttp3:c,corssRegionTagReq:r.apRequestDetail,corssRegionTagRes:D.gatewayInfo.res.detail&&D.gatewayInfo.res.detail[38]}),D.proxyInfo&&At.joinWebProxyAP(r.sid,{lts:y,sucess:1,apServerAddr:u,turnServerAddrList:D.proxyInfo.addresses.map(G=>G.ip).join(","),errorCode:null,eventType:r.cloudProxyServer,unilbsServerIds:m.toString()}),!1),D=>D.code!==te.OPERATION_ABORTED&&(D.code===te.CAN_NOT_GET_GATEWAY_SERVER?D.data.retry:(At.joinWebProxyAP(r.sid,{lts:y,sucess:0,apServerAddr:u,turnServerAddrList:null,errorCode:D.code,eventType:r.cloudProxyServer,unilbsServerIds:m.toString(),extend:JSON.stringify({networkState:P})}),x.warning("[".concat(r.clientId,"] multi unilbs network error, retry"),D),!0)),a)}const h9=(t,r,s,a,c,u)=>{const{sid:h,clientId:m,cloudProxyServer:y}=s,v=[],S=R=>{R.flag===4096?At.joinChooseServer(h,{role:s.role,lts:a,succ:!1,csAddr:r,opid:t.opid,serverList:null,ec:R.error.message,csIp:R.error.data&&R.error.data.csIp,unilbsServerIds:c.toString(),isHttp3:u,corssRegionTagReq:s.apRequestDetail}):R.flag!==1048576&&R.flag!==4194304&&R.flag!==4194310||At.joinWebProxyAP(h,{lts:a,sucess:0,apServerAddr:r,turnServerAddrList:null,errorCode:R.error.code,eventType:y,unilbsServerIds:c.toString()})};if(t.response_body.forEach(R=>{const P=R.buffer.code;if(R.uri===23&&P===0&&!R.buffer.edges_services)if(R.buffer.flag===4194310)x.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers"),R.buffer.edges_services=[];else{const D={error:new Oe(te.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:t.detail[502]}),flag:R.buffer.flag};v.push(D),S(D)}if(P!==0){const D=lS(P),G={error:new Oe(te.CAN_NOT_GET_GATEWAY_SERVER,D.desc,{desc:D.desc,retry:D.retry,csIp:t.detail[502]}),flag:R.buffer.flag};R.buffer.flag===4194310?x.warning(G.error.toString()):v.push(G),S(G)}}),v.length)throw x.warning("[".concat(m||"sid-".concat(h.slice(0,6)),"] multi unilbs ").concat(r," failed, ").concat(v.map(R=>"flag: ".concat(R.flag,", message: ").concat(R.error.message,", retry: ").concat(R.error.data.retry)).join(" | "))),new Oe(te.CAN_NOT_GET_GATEWAY_SERVER,v.map(R=>"flag: ".concat(R.flag,", message: ").concat(R.error.message)).join(" | "),{retry:!!v.find(R=>R.error.data.retry),csIp:t.detail[502],desc:[...new Set(v.map(R=>{var P;return R==null||(P=R.error)===null||P===void 0||(P=P.data)===null||P===void 0?void 0:P.desc}).filter(R=>!!R))]})},C2=t=>{var r,s,a,c;if(t.addresses&&t.addresses.length===0&&t.code===0)throw new Oe(te.CAN_NOT_GET_GATEWAY_SERVER,"void gateway address",{retry:!0,csIp:t.detail&&t.detail[502]});if(oe("AP_AREA")&&((a=t.detail)!==null&&a!==void 0&&a[23]&&typeof((c=t.detail)===null||c===void 0?void 0:c[23])=="string"?c9(t.detail[23].toLowerCase()):c9()),(r=t.detail)!==null&&r!==void 0&&r[19]&&typeof((s=t.detail)===null||s===void 0?void 0:s[19])=="string"){const h=t.detail[19],m=h==null?void 0:h.split(";");for(let y=0;y<m.length;y++){var u;const v=_o(u=m[y]).call(u);t.addresses[y]&&m&&(t.addresses[y].fingerprint=v)}}if(oe("GATEWAY_ADDRESS")&&oe("GATEWAY_ADDRESS").length>0){x.debug("assign gateway address to",oe("GATEWAY_ADDRESS"));const h=oe("GATEWAY_ADDRESS").map(m=>{var y,v;const S=(y=(v=t.addresses.find(R=>R.ip===m.ip&&R.port===m.port))===null||v===void 0?void 0:v.fingerprint)!==null&&y!==void 0?y:"";return{ip:m.ip,port:m.port,ticket:t.addresses[0]&&t.addresses[0].ticket,fingerprint:S}});t.addresses=h}},kge=(t,r)=>{if(t.response_body&&t.response_body.length){const s=t.response_body[0];if(s.buffer.code!==0){const a=lS(s.buffer.code);throw new Oe(te.UPDATE_TICKET_FAILED,"[".concat(s.buffer.code,"]: ").concat(a.desc),{retry:a.retry})}return s.buffer.ticket}throw x.debug("update ticket request received ap response without response body:",r),new Oe(te.UPDATE_TICKET_FAILED,"cannot find response body from ap response",{retry:!1})},R2=(t,r,s)=>{const a=Math.floor(Math.random()*1e12),c=t.role==="host"?"1":t.role==="audience"?"2":void 0,u={appid:t.appId,client_ts:Date.now(),opid:a,sid:t.sid,request_bodies:[{uri:22,buffer:{cname:t.cname,detail:Ah(Ah(Ah({6:t.stringUid,11:r,12:oe("USE_NEW_TOKEN")?"1":void 0},c?{17:c}:{}),{},{22:r},t.apRequestDetail?{33:t.apRequestDetail}:{}),t.apRTM?{26:"RTM2"}:{}),key:t.token,service_ids:s,uid:t.uid||0}}]};u.request_bodies.forEach(m=>{t.multiIP&&t.multiIP.gateway_ip&&(m.buffer.detail[5]=JSON.stringify({vocs_ip:[t.multiIP.uni_lbs_ip],vos_ip:[t.multiIP.gateway_ip]}))});const h=new FormData;return h.append("request",JSON.stringify(u)),[h,a]},Nge=(t,r)=>{const s=Math.floor(Math.random()*1e12),a={appid:t.appId,client_ts:Date.now(),opid:s,sid:t.sid,request_bodies:[{uri:28,buffer:{cname:t.cname,detail:{1:"",6:t.stringUid,12:"1"},token:t.token,service_ids:r,uid:t.uid||0,edges_services:t.apResponse.addresses.map(u=>({ip:u.ip,port:u.port}))}}]},c=new FormData;return c.append("request",JSON.stringify(a)),[c,s]};let fS=0;function pS(t){return dt.all(t.map(r=>r.then(s=>{throw s},s=>s))).then(r=>{throw r},r=>r)}const KT=async t=>{let{fragementLength:r,referenceList:s,asyncMapHandler:a,allFailedhandler:c,promisesCollector:u}=t,h=0;const m=r;let y,v=0;const S=async()=>{const R=(()=>{const P=h*m,D=P+m;return s.slice(P,D).map(a)})();u&&u.push(...R);try{y=await pS(R)}catch(P){if(v+=m,h++,!(v>=s.length))return void await S();c(P)}R.forEach(P=>P.cancel())};return await S(),y},f9=async t=>{let{referenceList:r,asyncMapHandler:s,closeFn:a}=t;const c=r.length;let u=0;const h=async()=>{const m=s(r.shift());try{return await m}catch(y){if(u++,u>=c||a!=null&&a(y))throw y;return h()}};return h()};async function I2(t,r,s,a){return{gatewayInfo:await async function(u,h,m,y){let v=null;const S=[],R=async()=>{const D=oe("WEBCS_DOMAIN").slice(0,oe("AJAX_REQUEST_CONCURRENT")).map(j=>({url:u.proxyServer?"https://".concat(u.proxyServer,"/ap/?url=").concat(j+"/api/v2/transpond/webrtc?v=2"):"https://".concat(j,"/api/v2/transpond/webrtc?v=2"),areaCode:$T()})),G=y.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:D.map(j=>j.url)}),F=await KT({fragementLength:oe("FRAGEMENT_LENGTH"),referenceList:D,asyncMapHandler:j=>(x.debug("[".concat(u.clientId,"] Connect to choose_server:"),j.url),u9(j,u,h,m)),allFailedhandler:j=>{throw y.recordJoinChannelService({endTs:Date.now(),status:"error",errors:j},G),j[0]},promisesCollector:S});return y.recordJoinChannelService({endTs:Date.now(),status:"success"},G),F},P=async()=>{if(await ps(1e3),v!==null)return v;const D=oe("WEBCS_DOMAIN_BACKUP_LIST").map(j=>({url:u.proxyServer?"https://".concat(u.proxyServer,"/ap/?url=").concat(j+"/api/v2/transpond/webrtc?v=2"):"https://".concat(j,"/api/v2/transpond/webrtc?v=2"),areaCode:$T()})),G=y.recordJoinChannelService({endTs:void 0,startTs:Date.now(),status:"pending",service:"chooseServer",urls:D.map(j=>j.url)}),F=await KT({fragementLength:oe("FRAGEMENT_LENGTH"),referenceList:D,asyncMapHandler:j=>(x.debug("[".concat(u.clientId,"] Connect to backup choose_server:"),j.url),u9(j,u,h,m)),allFailedhandler:j=>{throw y.recordJoinChannelService({endTs:Date.now(),status:"error",errors:j},G),j[0]},promisesCollector:S});return y.recordJoinChannelService({endTs:Date.now(),status:"success"},G),F};try{return v=await pS([R(),P()]),S.length&&S.forEach(D=>D.cancel&&typeof D.cancel=="function"&&D.cancel()),v}catch(D){throw D[0]}}(t,r,s,a)}}async function p9(t,r,s,a,c){const u=t.cloudProxyServer;if(u==="disabled"){if(t.useLocalAccessPoint)return await I2(t,r,s,c);if(oe("JOIN_WITH_FALLBACK_MEDIA_PROXY")){const{gatewayInfo:P,proxyInfo:D}=await _9(t,r,s,c);if(t.turnServer&&t.turnServer.mode!=="auto")return{gatewayInfo:P};const G=D.map(F=>({turnServerURL:F.address,tcpport:F.tcpport||Ns.tcpport,udpport:F.udpport||Ns.udpport,username:F.username||Ns.username,password:F.password||Ns.password,forceturn:!1,security:!0}));if(c.useP2P){var h;const F=(h=t.uid)!==null&&h!==void 0?h:P.uid,j="glb:".concat(F.toString()),Y=await vL(j),ee=D.map(fe=>({turnServerURL:fe.address,tcpport:fe.tcpport||Ns.tcpport,udpport:fe.udpport||Ns.udpport,username:j,password:Y,forceturn:!1,security:!0}));G.push(...ee)}return t.turnServer={mode:"manual",servers:G},{gatewayInfo:P}}return await I2(t,r,s,c)}const{proxyInfo:m,gatewayInfo:y}=await _9(t,r,s,c),v={gatewayInfo:y},S=m.map(P=>({turnServerURL:P.address,tcpport:u==="proxy3"?void 0:P.tcpport?P.tcpport:Ns.tcpport,udpport:u==="proxy4"?void 0:P.udpport?P.udpport:Ns.udpport,username:P.username||Ns.username,password:P.password||Ns.password,forceturn:u!=="proxy4",security:u==="proxy5"}));if(c.useP2P){var R;const P=(R=t.uid)!==null&&R!==void 0?R:y.uid,D="glb:".concat(P.toString()),G=await vL(D),F=m.map(j=>({turnServerURL:j.address,tcpport:u==="proxy3"?void 0:j.tcpport||Ns.tcpport,udpport:u==="proxy4"?void 0:j.udpport||Ns.udpport,username:D,password:G,forceturn:u!=="proxy4",security:u==="proxy5"}));S.push(...F)}return t.turnServer={mode:"manual",servers:S},x.debug("[".concat(t.clientId,"] set proxy server: ").concat(t.proxyServer,", mode: ").concat(u)),v}async function m9(t,r,s,a,c){const u=oe("ACCOUNT_REGISTER").slice(0,oe("AJAX_REQUEST_CONCURRENT"));let h=[];h=r.proxyServer?u.map(y=>"https://".concat(r.proxyServer,"/ap/?url=").concat(y+"/api/v1")):u.map(y=>"https://".concat(y,"/api/v1"));const m=c==null?void 0:c.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"stringUID",urls:h});try{const y=await async function(v,S,R,P,D){const G=Date.now(),F={sid:R.sid,opid:10,appid:R.appId,string_uid:S};let j=v[0];const Y=await vd(()=>Cd(j+"".concat(j.indexOf("?")===-1?"?":"&","action=stringuid"),{data:F,cancelToken:P,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}}),(ee,fe)=>{if(ee.code===0){if(ee.uid<=0||ee.uid>=Math.pow(2,32))throw x.error("Invalid Uint Uid ".concat(S," => ").concat(ee.uid),ee),At.reqUserAccount(F.sid,{lts:G,success:!1,serverAddr:j,stringUid:F.string_uid,uid:ee.uid,errorCode:te.INVALID_UINT_UID_FROM_STRING_UID,extend:F}),new Oe(te.INVALID_UINT_UID_FROM_STRING_UID);return At.reqUserAccount(F.sid,{lts:G,success:!0,serverAddr:j,stringUid:F.string_uid,uid:ee.uid,errorCode:null,extend:F}),!1}const Se=lS(ee.code);return Se.retry&&(j=v[(fe+1)%v.length]),At.reqUserAccount(F.sid,{lts:G,success:!1,serverAddr:j,stringUid:F.string_uid,uid:ee.uid,errorCode:Se.desc,extend:F}),Se.retry},(ee,fe)=>ee.code!==te.OPERATION_ABORTED&&(At.reqUserAccount(F.sid,{lts:G,success:!1,serverAddr:j,stringUid:F.string_uid,uid:null,errorCode:ee.code,extend:F}),j=v[(fe+1)%v.length],!0),D);if(Y.code!==0){const ee=lS(Y.code);throw new Oe(te.UNEXPECTED_RESPONSE,ee.desc)}return Y}(h,t,r,s,a);return c==null||c.recordJoinChannelService({status:"success",endTs:Date.now()},m),y.uid}catch(y){throw c==null||c.recordJoinChannelService({status:"error",endTs:Date.now(),errors:[y]},m),y}}async function Dge(t,r,s){const a=oe("ACCOUNT_REGISTER");let c=[];c=r.proxyServer?a.map(u=>"https://".concat(r.proxyServer,"/ap/?url=").concat(u+"/api/v1")):a.map(u=>"https://".concat(u,"/api/v1"));try{return await f9({referenceList:c,asyncMapHandler:h=>async function(m,y,v,S){const R=Date.now(),P={sid:v.sid,opid:10,appid:v.appId,string_uid:y};try{const D=await Cd(m+"".concat(m.indexOf("?")===-1?"?":"&","action=stringuid"),{data:P,cancelToken:S,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}});if(D.code!==0){const G=lS(D.code);throw new Oe(te.UNEXPECTED_RESPONSE,"preload sua error:".concat(G.desc),G)}if(D.uid<=0||D.uid>=Math.pow(2,32))throw new Oe(te.INVALID_UINT_UID_FROM_STRING_UID);return{requestTime:R,url:m,req:P,uid:D.uid,elapse:Date.now()-R}}catch(D){throw D}}(h,t,r,s),closeFn:h=>h.code===te.OPERATION_ABORTED||h.code===te.UNEXPECTED_RESPONSE&&!h.data.retry})}catch(u){throw u}}async function xge(t,r,s){const a=oe("CDS_AP").slice(0,oe("AJAX_REQUEST_CONCURRENT")).map(y=>t.proxyServer?"https://".concat(t.proxyServer,"/ap/?url=").concat(y+"/api/v1"):"https://".concat(y,"/api/v1?action=config")),c=a.map(y=>function(v,S,R,P){const D=Dn(),G={flag:64,cipher_method:0,features:Ah(Ah(Ah(Ah(Ah({install_id:kL(),device:D.name,system:D.os,system_general:navigator.userAgent,vendor:S.appId,version:Al,cname:S.cname,session_id:S.sid,proxyServer:S.proxyServer,sdk_type:Cge.WEB_RTC,browser_name:D.name,browser_version:D.version,user_agent:navigator.userAgent,channel_name:S.cname},S.stringUid&&{string_uid:S.stringUid}),S.uid&&{uid:S.uid+""}),D.os&&{os_name:D.os}),D.osVersion&&{os_version:D.osVersion}),{},{detail:""})};return vd(()=>Cd(v,{data:G,timeout:1e3,cancelToken:R,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":54}}),void 0,F=>F.code!==te.OPERATION_ABORTED,P)}(y,t,r,s));let u=null,h=null,m={};try{u=await pS(c)}catch(y){if(y.code===te.OPERATION_ABORTED)throw y;h=y}if(c.forEach(y=>y.cancel()),At.reportApiInvoke(t.sid,{name:Oi.REQUEST_CONFIG_DISTRIBUTE,options:{error:h,res:u}}).onSuccess(),u&&u.test_tags)try{m=function(y){if(!y.test_tags)return{};const v=y.test_tags,S=Object.keys(v),R={};return S.forEach(P=>{var D;const G=_o(D=P.slice(4)).call(D),F=JSON.parse(v[P]),j=F[1];R[G]={tag:F[0]||"",value:j}}),R}(u)}catch{}return m}async function g9(t,r){const s=oe("WEBCS_DOMAIN").concat(oe("WEBCS_DOMAIN_BACKUP_LIST")).map(a=>({url:"https://".concat(a,"/api/v2/transpond/webrtc?v=2"),areaCode:$T(),serviceIds:[Si.CHOOSE_SERVER,Si.CLOUD_PROXY_FALLBACK]}));try{return await f9({referenceList:s,asyncMapHandler:c=>async function(u,h,m){let y,{url:v,areaCode:S,serviceIds:R}=u;const P=Date.now(),[D,G]=R2(h,S,R);let F=vi.networkState;try{F&&vi.networkState===Ec.OFFLINE&&vi.onlineWaiter&&await dt.race([vi.onlineWaiter,ps(ki.maxRetryTimeout)]),F=vi.networkState;const{data:j,headers:Y}=await Cd(v,{data:D,cancelToken:m,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);y=Y.http3==="1"?1:-1,(we=>{const ye=[];if(we.response_body.forEach(Ne=>{const Ye=Ne.buffer.code;if(Ne.uri===23&&Ye===0&&!Ne.buffer.edges_services)if(Ne.buffer.flag===4194310)Ne.buffer.edges_services=[];else{const ht={error:new Oe(te.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:we.detail[502]}),flag:Ne.buffer.flag};ye.push(ht)}if(Ye!==0){const ht=lS(Ye),mt={error:new Oe(te.CAN_NOT_GET_GATEWAY_SERVER,ht.desc,{desc:ht.desc,retry:ht.retry,csIp:we.detail[502]}),flag:Ne.buffer.flag};Ne.buffer.flag===4194310?x.warning(mt.error.toString()):ye.push(mt)}}),ye.length)throw new Oe(te.CAN_NOT_GET_GATEWAY_SERVER,ye.map(Ne=>"flag: ".concat(Ne.flag,", message: ").concat(Ne.error.message)).join(" | "),{retry:!!ye.find(Ne=>Ne.error.data.retry),csIp:we.detail[502],desc:[...new Set(ye.map(Ne=>{var Ye;return Ne==null||(Ye=Ne.error)===null||Ye===void 0||(Ye=Ye.data)===null||Ye===void 0?void 0:Ye.desc}).filter(Ne=>!!Ne))]})})(j);const fe=WT(j,Si.CHOOSE_SERVER),Se=WT(j,Si.CLOUD_PROXY_FALLBACK);return C2(fe),{gatewayInfo:p2(fe,v),proxyInfo:Se,opid:G,requestTime:P,url:v,isHttp3:y,elapse:Date.now()-P}}catch(j){throw j}}(c,t,r),closeFn:c=>c.code===te.OPERATION_ABORTED||c.code===te.CAN_NOT_GET_GATEWAY_SERVER&&!c.data.retry})}catch(a){throw a}}async function _9(t,r,s,a){const c=oe("PROXY_SERVER_TYPE3"),u=(D,G,F)=>{let j=F||c;return Array.isArray(j)&&(j=G%2==0?c[1]:c[0]),"https://".concat(j,"/ap/?url=").concat(D)};let h=null;const m=[],y=async()=>{const D=oe("WEBCS_DOMAIN").slice(0,oe("AJAX_REQUEST_CONCURRENT")).map((j,Y)=>{let ee;return ee=t.cloudProxyServer==="disabled"&&t.proxyServer?u("".concat(j,"/api/v2/transpond/webrtc?v=2"),Y,t.proxyServer):t.cloudProxyServer==="disabled"||t.cloudProxyServer==="fallback"?"https://".concat(j,"/api/v2/transpond/webrtc?v=2"):u("".concat(j,"/api/v2/transpond/webrtc?v=2"),Y),{url:ee,areaCode:$T(),serviceIds:[Si.CHOOSE_SERVER,t.cloudProxyServer==="proxy5"?Si.CLOUD_PROXY_5:t.cloudProxyServer==="proxy3"||t.cloudProxyServer==="proxy4"?Si.CLOUD_PROXY:Si.CLOUD_PROXY_FALLBACK]}}),G=a.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:D.map(j=>j.url)}),F=await KT({fragementLength:oe("FRAGEMENT_LENGTH"),referenceList:D,asyncMapHandler:j=>(x.debug("[".concat(t.clientId,"] Connect to choose_server:"),j.url),d9(j,t,r,s)),allFailedhandler:j=>{throw a.recordJoinChannelService({endTs:Date.now(),status:"error",errors:j},G),j[0]},promisesCollector:m});return a.recordJoinChannelService({endTs:Date.now(),status:"success"},G),F},v=async()=>{if(await ps(1e3),h!==null)return h;const D=oe("WEBCS_DOMAIN_BACKUP_LIST").map((j,Y)=>{let ee;return ee=t.cloudProxyServer==="disabled"&&t.proxyServer?u("".concat(j,"/api/v2/transpond/webrtc?v=2"),Y,t.proxyServer):t.cloudProxyServer==="disabled"||t.cloudProxyServer==="fallback"?"https://".concat(j,"/api/v2/transpond/webrtc?v=2"):u("".concat(j,"/api/v2/transpond/webrtc?v=2"),Y),{url:ee,areaCode:$T(),serviceIds:[Si.CHOOSE_SERVER,t.cloudProxyServer==="proxy5"?Si.CLOUD_PROXY_5:t.cloudProxyServer==="proxy3"||t.cloudProxyServer==="proxy4"?Si.CLOUD_PROXY:Si.CLOUD_PROXY_FALLBACK]}}),G=a.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:D.map(j=>j.url)}),F=await KT({fragementLength:oe("FRAGEMENT_LENGTH"),referenceList:D,asyncMapHandler:j=>(x.debug("[".concat(t.clientId,"] Connect to backup choose_server:"),j.url),d9(j,t,r,s)),allFailedhandler:j=>{throw a.recordJoinChannelService({endTs:Date.now(),status:"error",errors:j},G),j[0]},promisesCollector:m});return a.recordJoinChannelService({endTs:Date.now(),status:"success"},G),F};let S,R,P;try{({gatewayInfo:S,proxyInfo:R,url:P}=await pS([y(),v()]))}catch(D){throw D[0]}if(m.length&&m.forEach(D=>D.cancel&&typeof D.cancel=="function"&&D.cancel()),!S||!R)throw new Oe(te.UNEXPECTED_ERROR,"missing gateway or proxy response").print();if(t.apUrl=P,t.cloudProxyServer!=="disabled"&&Array.isArray(c)&&P){const D=/^https?:\/\/(.+?)(\/.*)?$/.exec(P)[1];ot(c).call(c,D)&&(t.proxyServer=D,x.setProxyServer(D),At.setProxyServer(D))}return h={gatewayInfo:S,proxyInfo:await BH(R,S.uid)},h}async function Lge(t,r,s){const a=oe("UAP_AP").slice(0,oe("AJAX_REQUEST_CONCURRENT")).map(u=>t.proxyServer?"https://".concat(t.proxyServer,"/ap/?url=").concat(u+"/api/v1?action=uap"):"https://".concat(u,"/api/v1?action=uap")),c=a.map(u=>function(h,m,y,v){const S={command:"convergeAllocateEdge",sid:m.sid,appId:m.appId,token:m.token,ts:Date.now(),version:Al,cname:m.cname,uid:m.uid.toString(),requestId:w2,seq:w2};w2+=1;const R={service_name:"tele_channel",json_body:JSON.stringify(S)};return vd(async()=>{const P=await Cd(h,{data:R,cancelToken:y,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":61}});if(P.code!==0){const G=new Oe(te.UNEXPECTED_RESPONSE,"cross channel ap error, code"+P.code,{retry:!0});throw x.error(G.toString()),G}const D=JSON.parse(P.json_body);if(D.code!==200){const G=new Oe(te.UNEXPECTED_RESPONSE,"cross channel app center error, code: ".concat(D.code,", reason: ").concat(D.reason));throw x.error(G.toString()),G}if(!D.servers||D.servers.length===0){const G=new Oe(te.UNEXPECTED_RESPONSE,"cross channel app center empty server");throw x.error(G.toString()),G}return{vid:D.vid,workerToken:D.workerToken,addressList:(oe("CHANNEL_MEDIA_RELAY_SERVERS")||D.servers).map(G=>"wss://".concat(G.address.replace(/\./g,"-"),".").concat(oe("WORKER_DOMAIN"),":").concat(G.wss))}},void 0,P=>!!(P.code!==te.OPERATION_ABORTED&&P.code!==te.UNEXPECTED_RESPONSE||P.data&&P.data.retry),v)}(u,t,r,s));try{const u=await pS(c);return c.forEach(h=>h.cancel()),u}catch(u){throw u[0]}}async function Mge(t,r,s){let a=null;const c=[],u=async h=>{const m=oe(h?"WEBCS_DOMAIN_BACKUP_LIST":"WEBCS_DOMAIN").map(y=>t.proxyServer?"https://".concat(t.proxyServer,"/ap/?url=").concat(y+"/api/v2/transpond/webrtc?v=2"):"https://".concat(y,"/api/v2/transpond/webrtc?v=2"));return h&&(await ps(1e3),a!==null)?a:await KT({fragementLength:oe("FRAGEMENT_LENGTH"),referenceList:m,asyncMapHandler:y=>(x.debug("[".concat(t.clientId,"] update ticket, Connect to ").concat(h?"backup":""," choose_server:"),y),function(v,S,R,P){const[D]=Nge(S,[Si.CHOOSE_SERVER]);let G=vi.networkState;return vd(async()=>{G&&vi.networkState===Ec.OFFLINE&&vi.onlineWaiter&&await dt.race([vi.onlineWaiter,ps(P&&P.maxRetryTimeout||ki.maxRetryTimeout)]),G=vi.networkState;const F=await Cd(v,{data:D,cancelToken:R,headers:{"Content-Type":"multipart/form-data;"}},!0);return kge(F,v)},()=>!1,F=>F.code!==te.OPERATION_ABORTED&&(F.code===te.UPDATE_TICKET_FAILED?F.data.retry:(x.warning("[".concat(S.clientId,"] update ticket network error, retry"),F),!0)),P)}(y,t,r,s)),allFailedhandler:y=>{throw y[0]},promisesCollector:c})};try{return a=await pS([u(!1),u(!0)]),c.length&&c.forEach(h=>h.cancel&&typeof h.cancel=="function"&&h.cancel()),a}catch(h){throw h[0]}}function y9(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}function A2(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?y9(Object(s),!0).forEach(function(a){K(t,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):y9(Object(s)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))})}return t}class Uge extends Fr{get isSuccess(){return!!this.configs}constructor(r,s){super(),K(this,"configs",void 0),K(this,"store",void 0),K(this,"joinInfo",void 0),K(this,"cancelToken",void 0),K(this,"retryConfig",{timeout:3e3,timeoutFactor:1.5,maxRetryCount:1,maxRetryTimeout:1e4}),K(this,"interval",void 0),K(this,"mutex",void 0),K(this,"mutableParamsRead",!1),K(this,"configCache",{}),K(this,"limit_bitrate",void 0),this.mutex=new Fs("config-distribute",r),this.store=s}startGetConfigDistribute(r,s){this.joinInfo=r,this.cancelToken=s,this.interval&&this.stopGetConfigDistribute(),oe("ENABLE_CONFIG_DISTRIBUTE")&&(this.updateConfigDistribute(),this.interval=window.setInterval(()=>{this.updateConfigDistribute()},oe("CONFIG_DISTRIBUTE_INTERVAL")))}stopGetConfigDistribute(){this.interval&&clearInterval(this.interval),this.interval=void 0,this.joinInfo=void 0,this.cancelToken=void 0,this.configs=void 0,this.limit_bitrate=void 0}async awaitConfigDistributeComplete(){this.mutex.isLocked&&(await this.mutex.lock())()}async updateConfigDistribute(){if(this.mutableParamsRead||(this.mutableParamsRead=!0,At.reportApiInvoke(null,{options:void 0,name:Oi.LOAD_CONFIG_FROM_LOCALSTORAGE,tag:Hr.TRACER}).onSuccess(JSON.stringify(Sd))),!this.joinInfo||!this.cancelToken||!this.retryConfig)return void x.debug("[config-distribute] get config distribute interrupted have no joininfo");let r;const s=await this.mutex.lock();try{r=await xge(this.joinInfo,this.cancelToken,this.retryConfig),x.debug("[config-distribute] get config distribute",JSON.stringify(r));const a=function(c){var u;const h=pT(u=Object.keys(c).filter(v=>/^webrtc_ng_global_parameter/.test(v))).call(u);for(let v=0;v<h.length;v++)for(let S=h.length-1;S>v;S--){const R=h[S],P=c[R].value;if(typeof P.__priority=="number"){const D=P.__priority,G=h[S-1],F=c[G].value;if(typeof F.__priority=="number"){if(!(D>F.__priority))continue;{const j=R;h[S]=h[S-1],h[S-1]=j}}else{const j=R;h[S]=h[S-1],h[S-1]=j}}}const m=Date.now();let y={};return h.forEach(v=>{const S=c[v].value.__expires;S&&S<=m||(y[v]=c[v])}),y}(r);this.cacheGlobalParameterConfig(a),this.store.hasStartJoinChannel||(this.store.isABTestSuccess=!0),this.configs=a}catch(a){const c=new Oe(te.NETWORK_RESPONSE_ERROR,a);x.warning("[config-distribute] ".concat(c.toString()))}finally{s()}}getBitrateLimit(){return this.limit_bitrate||void 0}handleBitrateLimit(r){PH(r)&&(this.limit_bitrate?this.limit_bitrate&&this.limit_bitrate.id!==r.id&&this.emit(FT.UPDATE_BITRATE_LIMIT,r):this.emit(FT.UPDATE_BITRATE_LIMIT,r))}getLowStreamConfigDistribute(){return this.limit_bitrate&&A2({},this.limit_bitrate.low_stream_uplink)}handleABTestConfigDistribute(r){try{const s={},a=Object.keys(r),c=[];a.forEach(u=>{const h=r[u].value;s[u]=h;const m=h.__id;if(m&&this.configCache[u]&&this.configCache[u].__id===m)return;const y=h.__type,v=r[u].value,S=r[u].tag;let R=0;y?y===iz.REALTIME&&(R=1):Object.keys(v).some(P=>Object.prototype.hasOwnProperty.call(LL,P)||!i2()&&Object.prototype.hasOwnProperty.call(rP,P)?(R=1,!0):void 0),c.push({tag:S,isApplied:R,feature:u,params:JSON.stringify(h)})}),c.forEach(u=>{let{tag:h,feature:m,params:y,isApplied:v}=u;this.store.sessionId&&At.abTest(this.store.sessionId,{intSucc:1,isApplied:v,tag:h,feature:m,params:y,cid:this.store.cid,uid:this.store.intUid})}),this.configCache=s}catch(s){x.debug("handleABTestConfigDistribute error",s)}}cacheGlobalParameterConfig(r){const s=function(c){const u={};return Object.keys(c).forEach(h=>{const m=c[h].value,y=m.__expires,v=m.__type;Object.keys(m).forEach(S=>{S==="__id"||S==="__type"||S==="__priority"||S==="__expires"||Object.prototype.hasOwnProperty.call(u,S)||(u[S]=A2(A2({value:m[S]},y&&{expires:y}),v&&{type:v}))})}),u}(r);try{var a;const c=(a=s.LIMIT_BITRATE)===null||a===void 0?void 0:a.value;delete s.LIMIT_BITRATE,c&&PH(c)&&this.handleBitrateLimit(c),this.limit_bitrate=c,this.handleGlobalParameterConfig(s),this.handleABTestConfigDistribute(r),function(m){try{const y=Date.now();Object.keys(m).forEach(v=>{const{value:S,type:R,expires:P}=m[v];P&&P<=y||((R===iz.REALTIME||Object.prototype.hasOwnProperty.call(LL,v))&&(Sd[v]=S,br[v]=S,x.debug("Update realtime parameters from config distribute",v,S)),R||i2()||!Object.prototype.hasOwnProperty.call(rP,v)||(Sd[v]=S,br[v]=S,x.debug("Update gateway parameters from config distribute",v,S)))})}catch(y){x.error("Error update config immediately: ".concat(m),y.message)}}(s);const u=JSON.stringify(s),h=window.btoa(u);window.localStorage.setItem("websdk_ng_global_parameter",h),x.debug("Caching global parameters ".concat(u))}catch(c){x.error("Error caching global parameters:",c.message)}}handleGlobalParameterConfig(r){try{const s=Date.now();Object.keys(r).forEach(a=>{if(a==="CLIENT_ROLE_OPTIONS"&&Object.prototype.hasOwnProperty.call(br,a)){const{value:c,expires:u}=r[a];if(u&&u<=s)return;(function(h,m){try{return typeof h=="object"&&typeof m=="object"&&JSON.stringify(h)===JSON.stringify(m)}catch{return!1}})(br[a],c)||(Sd[a]=c,br[a]=c,this.emit(FT.UPDATE_CLIENT_ROLE_OPTIONS,c),x.debug("Updating client role options: ".concat(JSON.stringify(c))))}})}catch(s){x.error("Error handling global parameter config:",s.message)}}}class Vge extends Fr{constructor(){super(...arguments),K(this,"resultStorage",new Map)}setLocalAudioStats(r,s,a){this.record("AUDIO_INPUT_LEVEL_TOO_LOW",r,this.checkAudioInputLevel(a,s)),this.record("SEND_AUDIO_BITRATE_TOO_LOW",r,this.checkSendAudioBitrate(a,s))}setLocalVideoStats(r,s,a){this.record("SEND_VIDEO_BITRATE_TOO_LOW",r,this.checkSendVideoBitrate(a,s)),this.record("FRAMERATE_INPUT_TOO_LOW",r,this.checkFramerateInput(a,s)),this.record("FRAMERATE_SENT_TOO_LOW",r,this.checkFramerateSent(a))}setRemoteAudioStats(r,s){const a=r.getUserId();this.record("AUDIO_OUTPUT_LEVEL_TOO_LOW",a,this.checkAudioOutputLevel(s))}setRemoteVideoStats(r,s){const a=r.getUserId();this.record("RECV_VIDEO_DECODE_FAILED",a,this.checkVideoDecode(s))}record(r,s,a){if(oe("STATS_UPDATE_INTERVAL")>500)return;this.resultStorage.has(r)||this.resultStorage.set(r,{result:[],isPrevNormal:!0});const c=this.resultStorage.get(r);if(c&&(c.result.push(a),c.result.length>=5)){var u;const h=ot(u=c.result).call(u,!0);c.isPrevNormal&&!h&&this.emit("exception",E9[r],r,s),!c.isPrevNormal&&h&&this.emit("exception",E9[r]+2e3,r+"_RECOVER",s),c.isPrevNormal=h,c.result=[]}}checkAudioOutputLevel(r){return!(r.receiveBitrate>0&&r.receiveLevel===0)}checkAudioInputLevel(r,s){return s instanceof Fi&&!s.isActive||!!s.muted||r.sendVolumeLevel!==0}checkFramerateInput(r,s){let a=null;s._encoderConfig&&s._encoderConfig.frameRate&&(a=vc(s._encoderConfig.frameRate));const c=r.captureFrameRate;return!a||!c||!(a>10&&c<5||a<10&&a>=5&&c<=1)}checkFramerateSent(r){return!(r.captureFrameRate&&r.sendFrameRate&&r.captureFrameRate>5&&r.sendFrameRate<=1)}checkSendVideoBitrate(r,s){return!!s.muted||r.sendBitrate!==0}checkSendAudioBitrate(r,s){return s instanceof Fi&&!s.isActive||!!s.muted||r.sendBitrate!==0}checkVideoDecode(r){return r.receiveBitrate===0||r.decodeFrameRate!==0}}const E9={FRAMERATE_INPUT_TOO_LOW:1001,FRAMERATE_SENT_TOO_LOW:1002,SEND_VIDEO_BITRATE_TOO_LOW:1003,RECV_VIDEO_DECODE_FAILED:1005,AUDIO_INPUT_LEVEL_TOO_LOW:2001,AUDIO_OUTPUT_LEVEL_TOO_LOW:2002,SEND_AUDIO_BITRATE_TOO_LOW:2003},Ws=new class{markSubscribeStart(t,r){performance.mark("agora-web-sdk/".concat(t,"/subscribe-").concat(r))}markPublishStart(t,r){performance.mark("agora-web-sdk/".concat(t,"/publish-").concat(r))}measureFromSubscribeStart(t,r){const s=performance.getEntriesByName("agora-web-sdk/".concat(t,"/subscribe-").concat(r));if(s.length>0){const a=s[s.length-1];return Math.round(performance.now()-a.startTime)}return 0}measureFromPublishStart(t,r){const s=performance.getEntriesByName("agora-web-sdk/".concat(t,"/publish-").concat(r));if(s.length>0){const a=s[s.length-1];return Math.round(performance.now()-a.startTime)}return 0}};function v9(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}function Z_(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?v9(Object(s),!0).forEach(function(a){K(t,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):v9(Object(s)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))})}return t}class qT{constructor(r){K(this,"store",void 0),K(this,"onStatsException",void 0),K(this,"onUploadPublishDuration",void 0),K(this,"onStatsChanged",void 0),K(this,"localStats",new Map),K(this,"remoteStats",new Map),K(this,"updateStatsInterval",void 0),K(this,"trafficStats",void 0),K(this,"trafficStatsPeerList",[]),K(this,"uplinkStats",void 0),K(this,"exceptionMonitor",void 0),K(this,"p2pChannel",void 0),K(this,"scalabilityMode",nP.L1T1),K(this,"updateStats",()=>{this.p2pChannel&&(this.updateRemoteStats(this.p2pChannel),this.updateLocalStats(this.p2pChannel))}),this.store=r,this.exceptionMonitor=new Vge,this.exceptionMonitor.on("exception",(s,a,c)=>{this.onStatsException&&this.onStatsException(s,a,c)})}startUpdateStats(){this.updateStatsInterval||(this.updateStatsInterval=window.setInterval(this.updateStats,1e3))}stopUpdateStats(){this.updateStatsInterval&&(window.clearInterval(this.updateStatsInterval),this.updateStatsInterval=void 0)}reset(){this.localStats=new Map,this.remoteStats=new Map,this.trafficStats=void 0,this.trafficStatsPeerList=[],this.uplinkStats=void 0}getLocalAudioTrackStats(){return this.localStats.get(Ke.LocalAudioTrack)||Z_({},jL)}getLocalVideoTrackStats(){return this.localStats.get(Ke.LocalVideoTrack)||Z_({},BL)}getRemoteAudioTrackStats(r){const s=(u,h)=>{if(!this.trafficStats)return h;const m=this.trafficStats.peer_delay.find(y=>y.peer_uid===u);return m&&(h.publishDuration=m.B_ppad+(Date.now()-this.trafficStats.timestamp)),h},a={};if(r){var c;const u=(c=this.remoteStats.get(r))===null||c===void 0?void 0:c.audioStats;u&&(a[r]=s(r,u))}else Array.from(this.remoteStats.entries()).forEach(u=>{let[h,{audioStats:m}]=u;m&&(a[h]=s(h,m))});return a}getRemoteNetworkQualityStats(r){const s={};if(r){var a;const c=(a=this.remoteStats.get(r))===null||a===void 0?void 0:a.networkStats;c&&(s[r]=c)}else Array.from(this.remoteStats.entries()).forEach(c=>{let[u,{networkStats:h}]=c;h&&(s[u]=h)});return s}getRemoteVideoTrackStats(r){const s=(u,h)=>{if(!this.trafficStats)return h;const m=this.trafficStats.peer_delay.find(y=>y.peer_uid===u);return m&&(h.publishDuration=m.B_ppvd+(Date.now()-this.trafficStats.timestamp)),h},a={};if(r){var c;const u=(c=this.remoteStats.get(r))===null||c===void 0?void 0:c.videoStats;u&&(a[r]=s(r,u))}else Array.from(this.remoteStats.entries()).forEach(u=>{let[h,{videoStats:m}]=u;m&&(a[h]=s(h,m))});return a}getRTCStats(){let r=0,s=0,a=0,c=0;const u=this.localStats.get(Ke.LocalAudioTrack);u&&(r+=u.sendBytes,s+=u.sendBitrate);const h=this.localStats.get(Ke.LocalVideoTrack);h&&(r+=h.sendBytes,s+=h.sendBitrate);const m=this.localStats.get(Ke.LocalVideoLowTrack);m&&(r+=m.sendBytes,s+=m.sendBitrate),this.remoteStats.forEach(v=>{let{audioStats:S,videoStats:R}=v;S&&(a+=S.receiveBytes,c+=S.receiveBitrate),R&&(a+=R.receiveBytes,c+=R.receiveBitrate)});let y=1;return this.trafficStats&&(y+=this.trafficStats.peer_delay.length),{Duration:0,UserCount:y,SendBitrate:s,SendBytes:r,RecvBytes:a,RecvBitrate:c,OutgoingAvailableBandwidth:this.uplinkStats?this.uplinkStats.B_uab/1e3:0,RTT:this.trafficStats?2*this.trafficStats.B_acd:0}}addLocalStats(r){this.localStats.set(r,void 0)}removeLocalStats(r){r?this.localStats.delete(r):this.localStats.clear()}addRemoteStats(r){this.remoteStats.set(r,{})}removeRemoteStats(r){r?this.remoteStats.delete(r):this.remoteStats.clear()}addP2PChannel(r){this.p2pChannel=r}updateTrafficStats(r){r.peer_delay=r.peer_delay.filter(s=>s.B_ppad!==void 0||s.B_ppvd!==void 0),r.peer_delay.filter(s=>this.trafficStatsPeerList.indexOf(s.peer_uid)===-1).forEach(s=>{var a;const c=(a=this.p2pChannel)===null||a===void 0?void 0:a.getRemoteMedia(s.peer_uid),u=c!=null&&c.videoSSRC?Ws.measureFromSubscribeStart(this.store.clientId,c.videoSSRC):0,h=c!=null&&c.audioSSRC?Ws.measureFromSubscribeStart(this.store.clientId,c.audioSSRC):0;s.B_ppad!==void 0&&s.B_ppvd!==void 0&&(this.onUploadPublishDuration&&this.onUploadPublishDuration(s.peer_uid,s.B_ppad,s.B_ppvd,u>h?u:h),this.trafficStatsPeerList.push(s.peer_uid))}),this.trafficStats=r}updateUplinkStats(r){this.uplinkStats&&this.uplinkStats.B_fir!==r.B_fir&&x.debug("[".concat(this.store.clientId,"]: Period fir changes to ").concat(r.B_fir)),this.uplinkStats=r}static isRemoteVideoFreeze(r,s,a){if(!r)return!1;const c=!!a&&s.framesDecodeFreezeTime>a.framesDecodeFreezeTime,u=!a||s.framesDecodeCount>a.framesDecodeCount;return c||!u}static isRemoteAudioFreeze(r){return!!r&&r._isFreeze()}isLocalVideoFreeze(r){return!(!r.inputFrame||!r.sentFrame)&&r.inputFrame.frameRate>5&&r.sentFrame.frameRate<3}updateLocalStats(r){Array.from(this.localStats.entries()).forEach(s=>{let[a,c]=s;switch(a){case Ke.LocalVideoTrack:case Ke.LocalVideoLowTrack:{const h=c,m=Z_({},BL),y=r.getStats(),v=r.getLocalMedia(a);if(y){const S=y.videoSend.find(R=>R.ssrc===(v==null?void 0:v.ssrcs[0].ssrcId));if(S){const R=r.getLocalVideoSize(),P=r.getEncoderConfig(Ke.LocalVideoTrack);S.codec!=="H264"&&S.codec!=="H265"&&S.codec!=="VP8"&&S.codec!=="VP9"&&S.codec!=="AV1X"&&S.codec!=="AV1"||(m.codecType=S.codec),m.sendBytes=S.bytes,m.sendBitrate=h?8*Math.max(0,m.sendBytes-h.sendBytes):0,S.inputFrame?(m.captureFrameRate=S.inputFrame.frameRate,m.captureResolutionHeight=S.inputFrame.height,m.captureResolutionWidth=S.inputFrame.width):R&&(m.captureResolutionWidth=R.width,m.captureResolutionHeight=R.height),S.sentFrame?(m.sendFrameRate=S.sentFrame.frameRate,m.sendResolutionHeight=S.sentFrame.height,m.sendResolutionWidth=S.sentFrame.width):R&&(m.sendResolutionWidth=R.width,m.sendResolutionHeight=R.height),S.avgEncodeMs&&(m.encodeDelay=S.avgEncodeMs),P&&P.bitrateMax&&(m.targetSendBitrate=1e3*P.bitrateMax),m.sendPackets=S.packets,m.sendPacketsLost=S.packetsLost,m.sendJitterMs=S.jitterMs,m.sendRttMs=S.rttMs,m.totalDuration=h?h.totalDuration+1:1,m.totalFreezeTime=h?h.totalFreezeTime:0,this.isLocalVideoFreeze(S)&&(m.totalFreezeTime+=1),S.scalabilityMode&&this.scalabilityMode!==S.scalabilityMode&&(x.debug("[".concat(this.store.clientId,"]: The scalabilityMode of the video sending stream is ").concat(S.scalabilityMode)),this.scalabilityMode=S.scalabilityMode)}this.trafficStats&&(m.currentPacketLossRate=(this.trafficStats.B_pvlr4||0)/100)}var u;this.localStats.set(a,m),((h==null?void 0:h.sendResolutionWidth)!==m.sendResolutionWidth||(h==null?void 0:h.sendResolutionHeight)!==m.sendResolutionHeight)&&((u=this.onStatsChanged)===null||u===void 0||u.call(this,"resolution",{width:m.sendResolutionWidth,height:m.sendResolutionHeight})),m&&v&&this.exceptionMonitor.setLocalVideoStats(this.store.uid,v.track,m);break}case Ke.LocalAudioTrack:{const h=c,m=Z_({},jL),y=r.getStats(),v=r.getLocalMedia(a);if(y){const S=y.audioSend.find(R=>R.ssrc===(v==null?void 0:v.ssrcs[0].ssrcId));if(S){if(S.codec!=="opus"&&S.codec!=="aac"&&S.codec!=="PCMU"&&S.codec!=="PCMA"&&S.codec!=="G722"||(m.codecType=S.codec),S.inputLevel)m.sendVolumeLevel=Math.round(32767*S.inputLevel);else{const R=r.getLocalAudioVolume();R&&(m.sendVolumeLevel=Math.round(32767*R))}m.sendBytes=S.bytes,m.sendPackets=S.packets,m.sendPacketsLost=S.packetsLost,m.sendJitterMs=S.jitterMs,m.sendRttMs=S.rttMs,m.sendBitrate=h?8*Math.max(0,m.sendBytes-h.sendBytes):0}}this.trafficStats&&(m.currentPacketLossRate=(this.trafficStats.B_palr4||0)/100),this.localStats.set(Ke.LocalAudioTrack,m),m&&v&&this.exceptionMonitor.setLocalAudioStats(this.store.uid,v.track,m);break}}})}updateRemoteStats(r){Array.from(this.remoteStats.entries()).forEach(s=>{var a,c;let[u,{videoStats:h,audioStats:m,videoPcStats:y}]=s;const v=m,S=h,R=y,P=Z_({},mz),D=Z_({},gz),G=Z_({},bme),{audioTrack:F,videoTrack:j,audioSSRC:Y,videoSSRC:ee}=r.getRemoteMedia(u);let fe;fe=this.store.useP2P?r.getStats(!0):r.getStats();const Se=(a=fe)===null||a===void 0?void 0:a.audioRecv.find(Ye=>Ye.ssrc===Y),we=(c=fe)===null||c===void 0?void 0:c.videoRecv.find(Ye=>Ye.ssrc===ee),ye=this.trafficStats&&this.trafficStats.peer_delay.find(Ye=>Ye.peer_uid===u);if(Se&&(Se.codec!=="opus"&&Se.codec!=="aac"&&Se.codec!=="PCMU"&&Se.codec!=="PCMA"&&Se.codec!=="G722"||(P.codecType=Se.codec),Se.outputLevel?P.receiveLevel=Math.round(32767*Se.outputLevel):F&&(P.receiveLevel=Math.round(32767*F.getVolumeLevel())),P.receiveBytes=Se.bytes,P.receivePackets=Se.packets,P.receivePacketsLost=Se.packetsLost,P.receivePacketsDiscarded=Se.packetsDiscarded,P.packetLossRate=P.receivePacketsLost/(P.receivePackets+P.receivePacketsLost),P.receiveBitrate=v?8*Math.max(0,P.receiveBytes-v.receiveBytes):0,P.totalDuration=v?v.totalDuration+1:1,P.totalFreezeTime=v?v.totalFreezeTime:0,P.freezeRate=P.totalFreezeTime/P.totalDuration,P.receiveDelay=Se.jitterBufferMs,P.totalDuration>10&&qT.isRemoteAudioFreeze(F)&&(P.totalFreezeTime+=1)),we){var Ne;we.codec!=="H264"&&we.codec!=="H265"&&we.codec!=="VP8"&&we.codec!=="VP9"&&we.codec!=="AV1X"&&we.codec!=="AV1"||(D.codecType=we.codec),D.receiveBytes=we.bytes,D.receiveBitrate=S?8*Math.max(0,D.receiveBytes-S.receiveBytes):0,D.decodeFrameRate=we.decodeFrameRate<0?0:we.decodeFrameRate,D.renderFrameRate=we.decodeFrameRate<0?0:we.decodeFrameRate,we.outputFrame&&(D.renderFrameRate=we.outputFrame.frameRate),we.receivedFrame?(D.receiveFrameRate=we.receivedFrame.frameRate,D.receiveResolutionHeight=we.receivedFrame.height,D.receiveResolutionWidth=we.receivedFrame.width):j&&(D.receiveResolutionHeight=j._videoHeight||0,D.receiveResolutionWidth=j._videoWidth||0),we.framesRateFirefox!==void 0&&(D.receiveFrameRate=Math.round(we.framesRateFirefox)),D.receivePackets=we.packets,D.receivePacketsLost=we.packetsLost,D.packetLossRate=D.receivePacketsLost/(D.receivePackets+D.receivePacketsLost);const Ye=S?S.totalFreezeTime:0,ht=S?S.totalDuration:0;D.totalDuration=S?S.totalDuration+1:1,D.totalFreezeTime=(Ne=we.totalFreezesDuration)!==null&&Ne!==void 0?Ne:Ye||0,D.receiveDelay=we.jitterBufferMs||0;const mt=!!ee&&r.getRemoteVideoIsReady(ee);we.totalFreezesDuration===void 0&&j&&mt&&qT.isRemoteVideoFreeze(j,we,R)&&(D.totalFreezeTime+=1),D.freezeRate=Math.max(0,Math.min((D.totalFreezeTime-Ye)/(D.totalDuration-ht),1))}ye&&(P.end2EndDelay=ye.B_ad,D.end2EndDelay=ye.B_vd,P.transportDelay=ye.B_ed,D.transportDelay=ye.B_ed,P.currentPacketLossRate=ye.B_ealr4/100,D.currentPacketLossRate=ye.B_evlr4/100,G.uplinkNetworkQuality=ye.B_punq?ye.B_punq:0,G.downlinkNetworkQuality=ye.B_pdnq?ye.B_pdnq:0),this.remoteStats.set(u,{audioStats:P,videoStats:D,videoPcStats:we,networkStats:G}),F&&this.exceptionMonitor.setRemoteAudioStats(F,P),j&&this.exceptionMonitor.setRemoteVideoStats(j,D)})}}class S9{constructor(){K(this,"destChannelMediaInfos",new Map),K(this,"srcChannelMediaInfo",void 0)}setSrcChannelInfo(r){IH(r),this.srcChannelMediaInfo=r}addDestChannelInfo(r){IH(r),this.destChannelMediaInfos.set(r.channelName,r)}removeDestChannelInfo(r){bP(r),this.destChannelMediaInfos.delete(r)}getSrcChannelMediaInfo(){return this.srcChannelMediaInfo}getDestChannelMediaInfo(){return this.destChannelMediaInfos}}function b9(t){if(!(t instanceof S9))return new Oe(te.INVALID_PARAMS,"Config should be instance of [ChannelMediaRelayConfiguration]").throw();const r=t.getSrcChannelMediaInfo(),s=t.getDestChannelMediaInfo();if(!r)return new Oe(te.INVALID_PARAMS,"srcChannelMediaInfo should not be empty").throw();if(s.size===0)return new Oe(te.INVALID_PARAMS,"destChannelMediaInfo should not be empty").throw()}class Zm{get hasVideo(){return this._video_enabled_&&!this._video_muted_&&this._video_added_}get hasAudio(){return this._audio_enabled_&&!this._audio_muted_&&this._audio_added_}get audioTrack(){if(this.hasAudio||this._audio_pre_subscribed)return this._audioTrack}get videoTrack(){if(this.hasVideo||this._video_pre_subscribed)return this._videoTrack}get dataChannels(){return this._dataChannels}constructor(r,s){K(this,"uid",void 0),K(this,"_uintid",void 0),K(this,"_trust_in_room_",!0),K(this,"_trust_audio_enabled_state_",!0),K(this,"_trust_video_enabled_state_",!0),K(this,"_trust_audio_mute_state_",!0),K(this,"_trust_video_mute_state_",!0),K(this,"_audio_muted_",!1),K(this,"_video_muted_",!1),K(this,"_audio_enabled_",!0),K(this,"_video_enabled_",!0),K(this,"_audio_added_",!1),K(this,"_video_added_",!1),K(this,"_is_pre_created",!1),K(this,"_video_pre_subscribed",!1),K(this,"_audio_pre_subscribed",!1),K(this,"_trust_video_stream_added_state_",!0),K(this,"_trust_audio_stream_added_state_",!0),K(this,"_audioTrack",void 0),K(this,"_videoTrack",void 0),K(this,"_dataChannels",[]),K(this,"_audioSSRC",void 0),K(this,"_videoSSRC",void 0),K(this,"_audioOrtc",void 0),K(this,"_videoOrtc",void 0),K(this,"_cname",void 0),K(this,"_rtxSsrcId",void 0),K(this,"_videoMid",void 0),K(this,"_audioMid",void 0),this.uid=r,this._uintid=s}}function T9(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}function w9(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?T9(Object(s),!0).forEach(function(a){K(t,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):T9(Object(s)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))})}return t}const YT="9",C9=4e4;function R9(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}function pp(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?R9(Object(s),!0).forEach(function(a){K(t,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):R9(Object(s)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))})}return t}var mS=function(t){return t[t.DOWN=0]="DOWN",t[t.UP=1]="UP",t}(mS||{});const MP=new Map;function I9(t,r,s,a){let{scale:c}=t;if(c===0&&a===mS.UP||c>=r.length-1&&a===mS.DOWN)return t;let u=pp(pp({},t),{},{scale:a===mS.DOWN?++c:--c});switch(s){case"maintain-framerate":u=pp(pp({},u),r[c].motion);break;case"maintain-resolution":u=pp(pp({},u),r[c].detail);break;case"balanced":u=pp(pp({},u),r[c].balanced)}return u}function A9(t,r){if(r){const s={overUse:0,underUse:0,adaptationList:P9(r)};MP.set(t,s)}else MP.delete(t)}function P9(t){const r=pp({},t),{bitrateMax:s,frameRate:a,scaleResolutionDownBy:c,bitrateMin:u}=r,{MIN_FRAME_RATE:h,MAX_THRESHOLD_FRAMERATE:m,MAX_SCALE:y,BITRATE_MIN_THRESHOLD:v,BITRATE_MAX_THRESHOLD:S,BWE_SCALE_UP_THRESHOLD:R,BWE_SCALE_DOWN_THRESHOLD:P,PERF_SCALE_DOWN_THRESHOLD:D,PERF_SCALE_UP_THRESHOLD:G,BALANCE_BITRATE_FACTOR:F,BALANCE_FRAMERATE_FACTOR:j,BALANCE_RESOLUTION_FACTOR:Y,MOTION_RESOLUTION_FACTOR:ee,MOTION_BITRATE_FACTOR:fe,DETAIL_FRAMERATE_FACTOR:Se,DETAIL_BITRATE_FACTOR:we}=DL,ye=Math.min(r.frameRate,m),Ne=[{scale:0,threshold:{bwe_down:Math.round(Math.pow(P,1)*s),bwe_up:s,fps_down:Math.round(Math.pow(D,1)*ye),fps_up:a},balanced:{scaleResolutionDownBy:1,frameRate:a,bitrateMax:s,bitrateMin:u},motion:{scaleResolutionDownBy:1,frameRate:a,bitrateMax:s,bitrateMin:u},detail:{scaleResolutionDownBy:1,frameRate:a,bitrateMax:s,bitrateMin:u}}];for(let Ye=1;Ye<=y;Ye++){const ht={bwe_up:Math.round(Math.pow(R,Ye)*s),bwe_down:Math.round(Math.pow(P,Ye+1)*s),fps_up:Math.round(Math.pow(G,Ye)*ye),fps_down:Math.round(Math.pow(D,Ye+1)*ye)},mt={scaleResolutionDownBy:c/Math.pow(Y,Ye),frameRate:Math.max(Math.round(Math.pow(j,Ye)*a),h),bitrateMax:Math.max(Math.round(Math.pow(F,Ye)*s),S),bitrateMin:Math.max(Math.round(Math.pow(F,Ye)*u),v)},In={scaleResolutionDownBy:c/Math.pow(ee,Ye),frameRate:a,bitrateMax:Math.max(Math.round(Math.pow(fe,Ye)*s),S),bitrateMin:Math.max(Math.round(Math.pow(fe,Ye)*u),v)},An={scaleResolutionDownBy:1,frameRate:Math.max(Math.round(Math.pow(Se,Ye)*a),h),bitrateMax:Math.max(Math.round(Math.pow(we,Ye)*s),S),bitrateMin:Math.max(Math.round(Math.pow(we,Ye)*u),v)};Ne.push({scale:Ye,threshold:ht,balanced:mt,motion:In,detail:An})}return Ne}function Fge(t,r,s,a,c,u){const h=MP.get(t)||{overUse:0,underUse:0,adaptationList:P9(c)},{adaptationList:m}=h;MP.set(t,h);const{OVERUSE_TIMES_THRESHOLD:y,UNDERUSE_TIMES_THRESHOLD:v}=DL,{scale:S}=a;let R,P;return typeof r=="number"&&r>0&&function(D,G,F,j){if(G>=F.length)return!1;let{threshold:{fps_down:Y}}=F[G];return oe("FORCE_AG_HIGH_FRAMERATE")&&j==="maintain-framerate"&&(Y=F[0].threshold.fps_down),D<Y}(r,S,m,u)&&(h.overUse++,P=DT.CPU,h.overUse>y)||typeof s=="number"&&s>0&&function(D,G,F){if(G>=F.length)return!1;const{threshold:{bwe_down:j}}=F[G];return D<j}(s,S,m)&&(h.overUse++,P=DT.BANDWIDTH,h.overUse>y)?(h.overUse=0,h.underUse=0,R=I9(a,m,u,mS.DOWN),[R,P]):(typeof r=="number"&&r>0&&typeof s=="number"&&s>0&&function(D,G,F,j){if(G===0)return;let{threshold:{fps_up:Y}}=F[G];return oe("FORCE_AG_HIGH_FRAMERATE")&&j==="maintain-framerate"&&(Y=F[1].threshold.fps_up),D>Y}(r,S,m,u)&&function(D,G,F){if(G===0)return;const{threshold:{bwe_up:j}}=F[G];return D>j}(s,S,m)&&(h.underUse++,h.underUse>v&&(h.overUse=0,h.underUse=0,R=I9(a,m,u,mS.UP),R.scale===0&&(P=DT.NONE))),[R,P])}function O9(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}function P2(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?O9(Object(s),!0).forEach(function(a){K(t,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):O9(Object(s)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))})}return t}function jge(t){var r;return!!oe("ENABLE_AG_ADAPTATION")&&!!(t instanceof XL||ot(r=t._hints).call(r,pr.CUSTOM_TRACK))&&(!!oe("FORCE_SUPPORT_AG_ADAPTATION")||!!(function(s){const a=Dn();if(a.os!==Qi.IOS||!a.osVersion)return!1;const c=a.osVersion.split(".");return Number(c[0])>=s}(14)&&R8(17,4)||C8(14)&&I8(17,4,!0)))}const UP=new Map;function VP(t,r){const s=UP.get(t);if(s){const{timer:a}=s;window.clearTimeout(a),UP.delete(t)}r.qualityLimitationReason=DT.NONE,A9(t)}function Bge(t,r){var s;let a;switch(r){case Ke.LocalAudioTrack:a=Xn.Audio;break;case Ke.LocalVideoTrack:a=ot(s=t._hints).call(s,pr.SCREEN_TRACK)?Xn.Screen:Xn.High;break;case Ke.LocalVideoLowTrack:a=Xn.Low}return a}function O2(t){const r=jn();if(t.some(s=>s._bypassWebAudio))throw new Me(te.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");if(!r.webAudioMediaStreamDest)throw new Me(te.NOT_SUPPORTED,"cannot publish multiple tracks because your browser does not support audio mixing")}function k2(t,r){O2(t);const s=new Fi;return t.forEach(a=>s.addAudioTrack(a)),s}const Wge=!jn().supportUnifiedPlan||oe("CHROME_FORCE_PLAN_B")&&ip();function FP(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var s;return Wge?(s={spec:r,store:t},hp("PlanBConnection").create(s)):new Ph(r,t)}function N2(t){return t&&(t.iceConnectionState==="disconnected"||t.iceConnectionState==="checking"||t.iceConnectionState==="failed")}function k9(t){try{if(t.iceServers)return!1;if(t.turnServer&&t.turnServer.mode!=="off"){if(OT(t.turnServer.servers))return!1;if(oe("FORCE_TURN_TCP")||t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).some(r=>r.forceturn))return!0}return!1}catch{return!1}}var On;function N9(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}function Rd(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?N9(Object(s),!0).forEach(function(a){K(t,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):N9(Object(s)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))})}return t}let Ph=(On=class vy extends kH{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var r,s;return(r=(s=this.peerConnection.getReceivers()[0])===null||s===void 0||(s=s.transport)===null||s===void 0?void 0:s.state)!==null&&r!==void 0?r:null}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.send.videoCodecs.map(r=>r.rtpMap&&r.rtpMap.encodingName.toLowerCase()||"").filter(r=>{var s;return ot(s=Object.keys(iP)).call(s,r)}))]}constructor(r,s){super(r,s),K(this,"id",fr(5,"connection-")),K(this,"store",void 0),K(this,"peerConnection",void 0),K(this,"forceTurn",!1),K(this,"remoteSDP",void 0),K(this,"initialOffer",void 0),K(this,"transportEventReceiver",void 0),K(this,"statsFilter",void 0),K(this,"extension",{useXR:oe("USE_XR")}),K(this,"localCapabilities",void 0),K(this,"remoteCodecs",void 0),K(this,"localCandidateCount",0),K(this,"allCandidatesReceived",!1),K(this,"isPreallocation",!1),K(this,"preSSRCMap",new Map),K(this,"dataStreamChannelMap",new Map),K(this,"establishPromise",void 0),K(this,"recoveredDataChannelIds",[]),K(this,"currentDataChannelId",1),K(this,"supportAV1RtpSpec",!1),K(this,"mutex",void 0),K(this,"qualityLimitationReason",DT.NONE),K(this,"isFirstConnected",!1),this.store=s,this.forceTurn=k9(r),this.mutex=new Fs("P2PConnection-mutex",s.clientId),this.peerConnection=new RTCPeerConnection(vy.resolvePCConfiguration(r),{optional:[{googDscp:!0}]}),this.isFirstConnected=!1,this.statsFilter=OL(this.peerConnection,oe("STATS_UPDATE_INTERVAL"),void 0,zr()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}getPreMedia(r){const s=this.preSSRCMap.get(r);if(s!==void 0){const a=this.peerConnection.getTransceivers().find(c=>c.mid===s);if(a)return{transceiver:a,track:a.receiver.track,id:s}}}async updateRemoteRTPCapabilities(r,s){if(this.remoteCodecs=s,!this.remoteSDP)return void x.debug("[P2PConnection] cannot updateRemoteRTPCapabilities before remote SDP created, local codecs: ".concat(this.localCodecs,", codecs: ").concat(s));if(this.remoteSDP.updateRemoteCodec(r,s,this.store.codec)){const a=await this.peerConnection.createOffer(),c=this.logSDPExchange(a.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(a);const u=this.remoteSDP.toString();c==null||c(u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}else x.debug("[P2PConnection] updateRemoteRTPCapabilities no need to exchange SDP.")}async establish(){try{this.peerConnection.addTransceiver("video",{direction:"recvonly"}),this.peerConnection.addTransceiver("audio",{direction:"recvonly"});const a=await this.peerConnection.createOffer();if(!a.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const c=Jm(a.sdp),u=await JH({filterRTX:!oe("USE_PUB_RTX")&&!oe("USE_SUB_RTX"),filterVideoFec:oe("FILTER_VIDEO_FEC"),filterAudioFec:oe("FILTER_AUDIO_FEC"),filterVideoCodec:oe("FILTER_VIDEO_CODEC")},this.extension);if(this.localCapabilities=kP(u),this.initialOffer=a,oe("ENABLE_SVC")&&this.store.codec=="av1"){const m=await async function(){try{const y=new RTCPeerConnection;y.addTransceiver("video",{direction:"sendonly",sendEncodings:[{scalabilityMode:nP.L1T3}]});const v=await y.createOffer();if(!v.sdp)return void y.close();const S=Wa(v.sdp).mediaDescriptions[0];if(!S)return;const R=S.attributes.extmaps.find(P=>P.extensionName==="https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension");return y.close(),R}catch{return}}();var r;m&&(this.supportAV1RtpSpec=!0,(r=u.send)===null||r===void 0||r.videoExtensions.push(m))}let h;return a.sdp&&t9(a.sdp)&&(h=$r(u),(s=h).send&&(uS(Et.VIDEO,s.send.videoExtensions),uS(Et.AUDIO,s.send.audioExtensions)),s.recv&&(uS(Et.VIDEO,s.recv.videoExtensions),uS(Et.AUDIO,s.recv.audioExtensions)),s.sendrecv&&(uS(Et.VIDEO,s.sendrecv.videoExtensions),uS(Et.AUDIO,s.sendrecv.audioExtensions))),Rd(Rd({},c),{},{rtpCapabilities:h||u,offerSDP:a.sdp})}catch(a){throw new Me(te.GET_LOCAL_CONNECTION_PARAMS_FAILED,a.toString())}var s}async connect(r){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.initialOffer.sdp&&t9(this.initialOffer.sdp)&&(s=r.rtpCapabilities,a=this.localCapabilities,s.send&&(AP(Et.VIDEO,s.send.videoExtensions,a.send.videoExtensions),AP(Et.AUDIO,s.send.audioExtensions,a.send.audioExtensions)),s.recv&&(AP(Et.VIDEO,s.recv.videoExtensions,a.recv.videoExtensions),AP(Et.AUDIO,s.recv.audioExtensions,a.recv.audioExtensions))),this.remoteSDP=new class{get localCapabilities(){return $r(this._localCapabilities)}get rtpCapabilities(){return $r(this._rtpCapabilities)}get candidates(){return $r(this._candidates)}get iceParameters(){return $r(this._iceParameters)}get dtlsParameters(){return $r(this._dtlsParameters)}constructor(v){let S=arguments.length>1&&arguments[1]!==void 0&&arguments[1];K(this,"sessionDesc",void 0),K(this,"_localCapabilities",void 0),K(this,"_rtpCapabilities",void 0),K(this,"_candidates",void 0),K(this,"_originCandidates",void 0),K(this,"_iceParameters",void 0),K(this,"_isUseExtmapAllowMixed",void 0),K(this,"_dtlsParameters",void 0),K(this,"setup",void 0),K(this,"currentMidIndex",void 0),K(this,"cname",void 0),K(this,"firefoxSsrcMidMap",new Map),this._isUseExtmapAllowMixed=S,v=$r(v);const{iceParameters:R,dtlsParameters:P,candidates:D,rtpCapabilities:G,setup:F,localCapabilities:j,cname:Y}=v;this._rtpCapabilities=G,this._candidates=D,this._originCandidates=$r(D),this._iceParameters=R,this._dtlsParameters=P,this._localCapabilities=j,this.setup=F,this.cname=Y,this.sessionDesc=this.updateRemoteRTPCapabilities(G),this.currentMidIndex=this.sessionDesc.mediaDescriptions.length-1}preloadRemoteMedia(v){const S=this.candidates,R=this.dtlsParameters,P=this.iceParameters,D=this.rtpCapabilities.send;let G=this.sessionDesc.mediaDescriptions.length-1;for(let F=1;F<v;F++){const j=2*F+2e4,Y=2*F+C9,{ssrcs:ee,ssrcGroups:fe}=Q_([{ssrcId:j}],this.cname),{ssrcs:Se,ssrcGroups:we}=Q_([{ssrcId:Y,rtx:oe("USE_SUB_RTX")?Y+1:void 0}],this.cname);this.sessionDesc.mediaDescriptions.push({media:{mediaType:"video",port:YT,protos:["UDP","TLS","RTP","SAVPF"],fmts:D.videoCodecs.map(ye=>ye.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:P.iceUfrag,icePwd:P.icePwd,unrecognized:[],candidates:S,extmaps:D.videoExtensions,fingerprints:R.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:Se,ssrcGroups:we,rtcpFeedbackWildcards:[],payloads:D.videoCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(++G)}}),this.sessionDesc.mediaDescriptions.push({media:{mediaType:"audio",port:YT,protos:["UDP","TLS","RTP","SAVPF"],fmts:D.audioCodecs.map(ye=>ye.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:P.iceUfrag,icePwd:P.icePwd,unrecognized:[],candidates:S,extmaps:D.audioExtensions,fingerprints:R.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:ee,ssrcGroups:fe,rtcpFeedbackWildcards:[],payloads:D.audioCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(++G)}}),this.currentMidIndex+=2}this.updateBundleMids()}toString(){return $m(this.sessionDesc)}send(v,S,R,P){const{ssrcs:D,ssrcGroups:G}=Q_(S,this.cname,oe("SYNC_GROUP")?R:void 0),F=this.findPreloadMediaDesc(D);if(F){if(zr()&&this.firefoxSsrcMidMap.set(D[0].ssrcId,F.attributes.mid),P&&(P.twcc||P.remb)){const j=this.sessionDesc.mediaDescriptions.indexOf(F);return this.sessionDesc.mediaDescriptions[j]=this.mungSendMediaDesc(F,P),{mid:F.attributes.mid,needExchangeSDP:!0}}return{mid:F.attributes.mid,needExchangeSDP:!1}}{const j=this.findAvailableMediaIndex(v,D);let Y;return j===-1||j===1&&(Ps()||function(){const ee=Dn();return!(ee.name!==Gn.CHROME||!ee.osVersion)&&Number(ee.version)<=90}()||oe("ENABLE_ENCODED_TRANSFORM")&&rp())||j===0&&oe("USE_SUB_RTX")||A8()?(Y=this.createOrRecycleSendMedia(v,D,G,"sendonly",P),this.updateBundleMids()):(Y=$r(this.sessionDesc.mediaDescriptions[j]),Y.attributes.direction="sendonly",Y.attributes.ssrcs=D,Y.attributes.ssrcGroups=G,this.sessionDesc.mediaDescriptions[j]=this.mungSendMediaDesc(Y,P)),zr()&&this.firefoxSsrcMidMap.set(D[0].ssrcId,Y.attributes.mid),{mid:Y.attributes.mid,needExchangeSDP:!0}}}sendDataChannel(){const{mediaDesc:v,needExchangeSDP:S}=this.createOrRecycleDataChannel();return this.updateBundleMids(),{mid:v.attributes.mid,needExchangeSDP:S}}batchSend(v){const S=v.map(D=>{let{kind:G,ssrcMsg:F,mslabel:j}=D;return this.send(G,F,j)}),R=[];let P=!1;return S.forEach(D=>{let{mid:G,needExchangeSDP:F}=D;F&&(P=!0),R.push(G)}),{mids:R,needExchangeSDP:P}}stopSending(v){const S=this.sessionDesc.mediaDescriptions.filter(R=>R.attributes.mid&&v.indexOf(R.attributes.mid)!==-1);if(S.length!==v.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");S.forEach(R=>{R.attributes.mid==="0"||zr()||A8()?R.attributes.ssrcs=[]:(R.attributes.ssrcs=[],R.attributes.direction="inactive",R.media.port="0")}),this.updateBundleMids()}mute(v){const S=this.sessionDesc.mediaDescriptions.find(R=>R.attributes.mid===v);if(!S)throw new Error("mediaDescription not found with ".concat(v," in remote SDP when calling RemoteSDP.mute."));S.attributes.direction="inactive"}unmute(v){const S=this.sessionDesc.mediaDescriptions.find(R=>R.attributes.mid===v);if(!S)throw new Error("mediaDescription not found with ".concat(v," in remote SDP when calling RemoteSDP.unmute."));S.attributes.direction="sendonly"}muteRemote(v){const S=this.sessionDesc.mediaDescriptions.filter(R=>ot(v).call(v,R.attributes.mid||""));if(S.length!==v.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");S.forEach(R=>{R.attributes.direction="inactive"})}unmuteRemote(v){const S=this.sessionDesc.mediaDescriptions.filter(R=>ot(v).call(v,R.attributes.mid||""));if(S.length!==v.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");S.forEach(R=>{R.attributes.direction="recvonly"})}receive(v,S,R,P){v.forEach((D,G)=>{this.createOrRecycleRecvMedia(D,[],"recvonly",S,R,P[G])}),this.updateBundleMids()}stopReceiving(v){const S=this.sessionDesc.mediaDescriptions.filter(R=>v.indexOf(R.attributes.mid)!==-1);if(S.length!==v.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");S.forEach(R=>{R.media.port="0",R.attributes.direction="inactive"}),this.updateBundleMids()}updateRemoteRTPCapabilities(v){const S=this.sessionDesc||Wa((R=this._isUseExtmapAllowMixed,`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=ice-lite`.concat(R?`
a=extmap-allow-mixed`:"",`
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`)));var R;this._rtpCapabilities=v;const P=this.rtpCapabilities.send,D=this.localCapabilities.send;for(const G of S.mediaDescriptions){if(G.attributes.iceUfrag=this._iceParameters.iceUfrag,G.attributes.icePwd=this._iceParameters.icePwd,G.attributes.fingerprints=this._dtlsParameters.fingerprints,G.attributes.candidates=this._candidates,G.attributes.setup=this.setup,G.media.mediaType==="application"&&(G.attributes.sctpPort="5000"),G.media.mediaType==="video"){if(P.videoCodecs.length===0){const F=D.videoCodecs.filter(j=>{var Y,ee;return(Y=j.rtpMap)===null||Y===void 0?void 0:ot(ee=Y.encodingName.toLowerCase()).call(ee,"vp8")})||[D.videoCodecs[0]];G.media.fmts=F.map(j=>j.payloadType.toString(10)),G.attributes.payloads=F,G.attributes.extmaps=[]}else if(G.media.fmts=P.videoCodecs.map(F=>F.payloadType.toString(10)),G.attributes.payloads=P.videoCodecs,G.attributes.extmaps=P.videoExtensions,oe("PRELOAD_MEDIA_COUNT")>0){const{ssrcs:F,ssrcGroups:j}=Q_([{ssrcId:C9,rtx:oe("USE_SUB_RTX")?40001:void 0}],this.cname);G.attributes.ssrcs=F,G.attributes.ssrcGroups=j}}if(G.media.mediaType==="audio"){if(P.audioCodecs.length===0){const F=D.audioCodecs.filter(j=>{var Y,ee;return(Y=j.rtpMap)===null||Y===void 0?void 0:ot(ee=Y.encodingName.toLowerCase()).call(ee,"opus")})||[D.audioCodecs[0]];G.media.fmts=F.map(j=>j.payloadType.toString(10)),G.attributes.payloads=F,G.attributes.extmaps=[]}else if(G.media.fmts=P.audioCodecs.map(F=>F.payloadType.toString(10)),G.attributes.payloads=P.audioCodecs,G.attributes.extmaps=P.audioExtensions,hS(G),oe("PRELOAD_MEDIA_COUNT")>0){const{ssrcs:F,ssrcGroups:j}=Q_([{ssrcId:2e4}],this.cname);G.attributes.ssrcs=F,G.attributes.ssrcGroups=j}}}return this.sessionDesc=S,this.currentMidIndex=S.mediaDescriptions.length-1,this.sessionDesc}updateCandidates(v){const S=this._originCandidates.filter(P=>P.transport==="udp"),R=[];if(S.forEach(P=>{R.push(w9(w9({},P),{},{foundation:"tcpcandidate",priority:Number(P.priority)-1+"",transport:"tcp",port:Number(P.port)+90+""}))}),S.length!==0){switch(v){case Bs.TCP_RELAY:this._candidates=R;break;case Bs.UDP_TCP_RELAY:case Bs.RELAY:this._candidates=[...S,...R];break;default:this._candidates=S}for(const P of this.sessionDesc.mediaDescriptions)P.attributes.candidates=this.candidates}}restartICE(v){v=$r(v),this._iceParameters=v,this.sessionDesc.mediaDescriptions.forEach(S=>{S.attributes.iceUfrag=v.iceUfrag,S.attributes.icePwd=v.icePwd})}predictReceivingMids(v){const S=[];for(let R=0;R<v;R++)S.push((this.currentMidIndex+R+1).toString(10));return S}findAvailableMediaIndex(v,S){return this.sessionDesc.mediaDescriptions.findIndex(R=>{const P=R.media.mediaType===v&&R.media.port!=="0"&&(R.attributes.direction==="sendonly"||R.attributes.direction==="sendrecv")&&R.attributes.ssrcs.length===0;if(zr()){if(P){const D=this.firefoxSsrcMidMap.get(S[0].ssrcId);return!(D||R.attributes.mid!=="0"&&R.attributes.mid!=="1")||!(!D||D!==R.attributes.mid)}return!1}return P})}createOrRecycleDataChannel(){for(const R of this.sessionDesc.mediaDescriptions)if(R.media.mediaType==="application")return{mediaDesc:R,needExchangeSDP:!1};this.currentMidIndex+=1;const v="".concat(this.currentMidIndex),S={media:{mediaType:"application",port:YT,protos:["UDP","DTLS","SCTP"],fmts:["webrtc-datachannel"]},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:[],fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[],rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,mid:"".concat(v),sctpPort:"5000"}};return this.sessionDesc.mediaDescriptions.push(S),{mediaDesc:S,needExchangeSDP:!0}}createOrRecycleRecvMedia(v,S,R,P,D,G){const F=v._mediaStreamTrack.kind,j=this.rtpCapabilities.recv,Y=GT(F,j,this.localCapabilities.send,F===Et.VIDEO?P:D),ee=F===Et.VIDEO?j.videoExtensions:j.audioExtensions;this.currentMidIndex+=1;const fe="".concat(this.currentMidIndex);let Se={media:{mediaType:F,port:YT,protos:["UDP","TLS","RTP","SAVPF"],fmts:Y.map(ye=>ye.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:ee,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:S,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:Y,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:R,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(fe)}};Se=this.mungRecvMediaDsec(Se,v,G);const we=this.findFirstClosedMedia(F);if(we){const ye=this.sessionDesc.mediaDescriptions.indexOf(we);this.sessionDesc.mediaDescriptions[ye]=Se}else this.sessionDesc.mediaDescriptions.push(Se);return Se}updateRemoteCodec(v,S,R){const P=[...new Set(this._rtpCapabilities.recv.videoCodecs.map(Se=>Se.rtpMap&&Se.rtpMap.encodingName.toLowerCase()||"").filter(Se=>{var we;return ot(we=Object.keys(iP)).call(we,Se)}))],D=new Set(S);if(P.every(Se=>D.has(Se)))return x.debug("codecs has not changed, no need to updateRemoteCodec, codecs: ".concat(S)),!1;const G=this._rtpCapabilities.recv.videoCodecs.filter(Se=>S.some(we=>{var ye;return ot(ye=Se.rtpMap&&Se.rtpMap.encodingName.toLowerCase()||"").call(ye,we)}));if(G.length===0)return x.debug("updateRemoteCodec failed, because cannot find matched codec, remoteCapabilities codecs: ".concat(P," codecs: ").concat(S)),!1;const F=[...new Set(G.map(Se=>Se.rtpMap&&Se.rtpMap.encodingName.toLowerCase()||""))];let j;if(x.debug("updateRemoteCodec, from ".concat(P," to ").concat(F)),v.length===0)j=this.sessionDesc.mediaDescriptions.filter(Se=>Se.media.mediaType==="video"&&Se.attributes.direction==="recvonly");else if(j=this.sessionDesc.mediaDescriptions.filter(Se=>Se.attributes.mid&&ot(v).call(v,Se.attributes.mid)&&Se.attributes.direction==="recvonly"),j.length!==v.length)return x.debug("updateRemoteCodec failed, because cannot find mids, mids: ".concat(v,", codecs: ").concat(S)),!1;if(oe("USE_PUB_RTX")||oe("USE_SUB_RTX")){const Se=y2(G,this.rtpCapabilities.recv.videoCodecs);G.push(...Se)}this._rtpCapabilities.recv.videoCodecs=G;const Y=this.localCapabilities.send,ee=this.rtpCapabilities.recv,fe=GT(Et.VIDEO,ee,Y,R);return j.forEach(Se=>{const we=fe.map(ye=>ye.payloadType.toString(10));x.debug("updateRemoteCodec mid: ".concat(Se.attributes.mid,", from"),Se.attributes.payloads,"to",fe),Se.attributes.payloads=fe,Se.media.fmts=we}),!0}createOrRecycleSendMedia(v,S,R,P,D){const G=this.rtpCapabilities.send,F=v===Et.VIDEO?G.videoCodecs:G.audioCodecs,j=v===Et.VIDEO?G.videoExtensions:G.audioExtensions;this.currentMidIndex+=1;const Y="".concat(this.currentMidIndex);let ee={media:{mediaType:v,port:YT,protos:["UDP","TLS","RTP","SAVPF"],fmts:F.map(Se=>Se.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:j,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:S,ssrcGroups:R,rtcpFeedbackWildcards:[],payloads:F,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:P,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(Y)}};ee=this.mungSendMediaDesc(ee,D);const fe=this.findFirstClosedMedia(v);if(fe){const Se=this.sessionDesc.mediaDescriptions.indexOf(fe);this.sessionDesc.mediaDescriptions[Se]=ee}else this.sessionDesc.mediaDescriptions.push(ee);return ee}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(v=>v.media.port!=="0").map(v=>v.attributes.mid)}mungRecvMediaDsec(v,S,R){const P=$r(v);return g2(P),dS(P,S),_2(P,S),YH(P),OP(P,R,this.localCapabilities.send),P}mungSendMediaDesc(v,S){const R=$r(v);return OP(R,S,this.localCapabilities.recv),hS(R),R}updateRecvMedia(v,S){const R=this.sessionDesc.mediaDescriptions.findIndex(P=>P.attributes.mid===v);if(R!==-1){const P=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[R],S);this.sessionDesc.mediaDescriptions[R]=P}}bumpMid(v){this.currentMidIndex+=v}findFirstClosedMedia(v){return this.sessionDesc.mediaDescriptions.find(S=>zr()?S.media.port==="0"&&S.media.mediaType===v:S.media.port==="0")}findPreloadMediaDesc(v){return this.sessionDesc.mediaDescriptions.find(S=>{var R;return((R=S.attributes)===null||R===void 0||(R=R.ssrcs[0])===null||R===void 0?void 0:R.ssrcId)===v[0].ssrcId})}getSSRC(v){var S;return(S=this.sessionDesc.mediaDescriptions.find(R=>R.attributes.mid===v))===null||S===void 0?void 0:S.attributes.ssrcs}}(Rd(Rd({},r),{},{localCapabilities:this.localCapabilities}),this.supportAV1RtpSpec),r.preallocation&&(this.isPreallocation=!0),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);const c=this.remoteSDP.toString(),u=ZH(this.initialOffer.sdp,this.extension),h=this.logSDPExchange(u||"","offer","local","connect");this.store.descriptionStart(),await this.peerConnection.setLocalDescription({type:"offer",sdp:u}),h==null||h(c),await this.peerConnection.setRemoteDescription({type:"answer",sdp:c});const m=this.peerConnection.getTransceivers()[0];if(m!=null&&m.receiver&&this.tryBindTransportEvents(m.receiver),oe("PRELOAD_MEDIA_COUNT")>0){this.remoteSDP.preloadRemoteMedia(oe("PRELOAD_MEDIA_COUNT"));const v=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:v});const S=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(S)}const{preSSRCs:y}=r;if(Array.isArray(y)&&y.length>0){const{mids:v}=this.remoteSDP.batchSend(y.map(S=>({kind:S.kind,ssrcMsg:[{ssrcId:S.ssrcId,rtx:S.rtx}],mslabel:S.mslabel})));v.forEach((S,R)=>{this.preSSRCMap.set(y[R].ssrcId,S)}),await HT(this.peerConnection,this.remoteSDP,this.extension),x.debug("[".concat(this.store.clientId,"] [P2PConnection] pre-batchReceive exchange SDP."))}}catch(c){throw new Me(te.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(c.toString()))}var s,a}async updateRemoteConnect(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateRemoteConnect before remote SDP created");const{rtpCapabilities:s}=r;this.remoteSDP.updateRemoteRTPCapabilities(s),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);const{preSSRCs:a}=r;if(Array.isArray(a)&&a.length>0){const{mids:c}=this.remoteSDP.batchSend(a.map(u=>Object.assign({},{kind:u.kind,ssrcMsg:[{ssrcId:u.ssrcId,rtx:u.rtx}],mslabel:u.mslabel})));c.forEach((u,h)=>{this.preSSRCMap.set(a[h].ssrcId,u)})}await HT(this.peerConnection,this.remoteSDP,this.extension),x.debug("[P2PConnection] updateRemoteRTPCapabilities by exchanging SDP.")}catch(s){throw new Me(te.EXCHANGE_SDP_FAILED,"P2PConnection.updateRemoteConnect failed; ".concat(s.toString()))}}send(r,s,a){var c=this;return Il(function*(){const u=yield Nn(c.mutex.lock("From P2PConnection.send"));try{if(!c.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const h=[],m=IP();r.forEach(j=>{const Y=c.peerConnection.addTransceiver(j._mediaStreamTrack,Rd({direction:"sendonly"},j.trackMediaType==="video"&&c.supportAV1RtpSpec&&m?{sendEncodings:[{scalabilityMode:m}]}:{}));h.push(Y),j._updateRtpTransceiver(Y)}),zr()&&oe("SIMULCAST")===!0&&(yield Nn(c.applySimulcastForFirefox(h,r)));const y=yield Nn(c.peerConnection.createOffer()),v=c.remoteSDP.predictReceivingMids(r.length),S=c.mungSendOfferSDP(y.sdp,r,v),R=Wa(S),P=v.map(j=>{const Y=R.mediaDescriptions.find(ee=>ee.attributes.mid===j);if(!Y)throw new Error("Cannot extract ssrc from mediaDescription.");return $H(Y,oe("USE_PUB_RTX"))});let D;try{D=yield P}catch(j){D=[],c.remoteSDP.receive(r,s,a,D);const Y=c.remoteSDP.toString();throw yield Nn(c.peerConnection.setLocalDescription({type:"offer",sdp:S})),yield Nn(c.peerConnection.setRemoteDescription({type:"answer",sdp:Y})),yield Nn(c.stopSending(v,!0)),j}c.remoteSDP.receive(r,s,a,D);const G=c.remoteSDP.toString(),F=c.logSDPExchange(S,"offer","local","send");return yield Nn(c.peerConnection.setLocalDescription({type:"offer",sdp:S})),yield Nn(c.applySimulcastEncodings(h,r)),yield Nn(c.applySendEncodings(h,r)),F==null||F(G),yield Nn(c.peerConnection.setRemoteDescription({type:"answer",sdp:G})),h.map((j,Y)=>{const ee=v[Y];return{localSSRC:P[Y],id:ee,transceiver:j}})}catch(h){throw h instanceof Me?h:new Me(te.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(h.toString()))}finally{u()}})()}async createDataChannels(r,s){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.createDataChannels before remote SDP created");let a=this.dataStreamChannelMap.get(r);if(a&&a.readyState==="open")x.debug("[P2PConnection] Channels are already available and can be reused directly.");else{const u=this.currentDataChannelId<1023?this.currentDataChannelId++:this.recoveredDataChannelIds.shift();if(typeof u!="number")throw new Error("create DataChannel error, because cannot get dc id");a=this.peerConnection.createDataChannel("datastream-channel",{id:u,negotiated:!0,ordered:!1,maxRetransmits:oe("DATASTREAM_MAX_RETRANSMITS")}),a.binaryType="arraybuffer",this.dataStreamChannelMap.set(r,a)}s.forEach(u=>{u._updateOriginDataChannel(a)});const{needExchangeSDP:c}=this.remoteSDP.sendDataChannel();if(c){const u=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:u});const h=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(h),x.debug("[P2PConnection] createDataChannels by exchanging SDP.")}else x.debug("[P2PConnection] createDataChannels no need to exchange SDP.");return}catch(a){throw a instanceof Me?a:new Me(te.EXCHANGE_SDP_FAILED,"P2PConnection.createDataChannels failed; ".concat(a.toString()))}}async stopDataChannels(r){try{const s=this.dataStreamChannelMap.get(r);return s&&(s.id&&this.recoveredDataChannelIds.push(s.id),s.close()),void this.dataStreamChannelMap.delete(r)}catch(s){throw s instanceof Me?s:new Me(te.DATACHANNEL_FAILED,"P2PConnection.stopDataChannels failed; ".concat(s.toString()))}}async stopSending(r,s){const a=s?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const c=this.peerConnection.getTransceivers().filter(y=>r.indexOf(y.mid)!==-1);if(c.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");c.map(y=>{var v;VP(this.id+y.mid,this),y.direction="inactive",(v=y.stop)===null||v===void 0||v.call(y)});const u=await this.peerConnection.createOffer(),h=this.logSDPExchange(u.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(u),this.remoteSDP.stopReceiving(r);const m=this.remoteSDP.toString();h==null||h(m),await this.peerConnection.setRemoteDescription({type:"answer",sdp:m})}catch(c){throw new Me(te.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(c.toString()))}finally{a&&a()}}async receive(r,s,a,c){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(r," before remoteSDP created."));const{mid:u,needExchangeSDP:h}=this.remoteSDP.send(r,s,a,c);h&&(await HT(this.peerConnection,this.remoteSDP,this.extension),x.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(r," by exchanging SDP.")));const m=this.peerConnection.getTransceivers().find(y=>y.mid===u);if(!m)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:m.receiver.track,id:u,transceiver:m}}catch(u){throw new Me(te.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(u.toString()))}}async batchReceive(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const{mids:s,needExchangeSDP:a}=this.remoteSDP.batchSend(r);return a&&(await HT(this.peerConnection,this.remoteSDP,this.extension),x.debug("[".concat(this.store.clientId,"] [P2PConnection] batchReceive by exchanging SDP."))),s.map(c=>{const u=this.peerConnection.getTransceivers().find(h=>h.mid===c);if(!u)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:u.receiver.track,id:c,transceiver:u}})}catch(s){throw new Me(te.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(s.toString()))}}async stopReceiving(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");r.forEach(u=>{Array.from(this.preSSRCMap.entries()).some(h=>{let[m,y]=h;if(y===u)return this.preSSRCMap.delete(m),!0})}),this.remoteSDP.stopSending(r);const s=this.remoteSDP.toString(),a=this.logSDPExchange(s,"offer","remote","stopReceiving");await this.peerConnection.setRemoteDescription({type:"offer",sdp:s});const c=await this.peerConnection.createAnswer();a==null||a(c.sdp||""),await this.peerConnection.setLocalDescription(c)}catch(s){throw new Me(te.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(s.toString()))}}async muteRemote(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteRemote mid=".concat(r," before remote SDP created."));this.remoteSDP.mute(r);const s=this.remoteSDP.toString(),a=this.logSDPExchange(s,"offer","remote","muteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:s});const c=await this.peerConnection.createAnswer();a==null||a(c.sdp||""),await this.peerConnection.setLocalDescription(c)}catch(s){throw new Me(te.EXCHANGE_SDP_FAILED,"P2PConnection.muteRemote failed; ".concat(s.toString()))}}async unmuteRemote(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteRemote mid=".concat(r," before remote SDP created."));this.remoteSDP.unmute(r);const s=this.remoteSDP.toString(),a=this.logSDPExchange(s,"offer","remote","unmuteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:s});const c=await this.peerConnection.createAnswer();a==null||a(c.sdp||""),await this.peerConnection.setLocalDescription(c)}catch(s){throw new Me(te.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteRemote failed; ".concat(s.toString()))}}async muteLocal(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const s=this.peerConnection.getTransceivers().filter(h=>h.mid&&r.indexOf(h.mid)!==-1);if(s.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length.");s.map(h=>{h.direction="inactive"});const a=await this.peerConnection.createOffer(),c=this.logSDPExchange(a.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(a),this.remoteSDP.muteRemote(r);const u=this.remoteSDP.toString();c==null||c(u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(s){throw new Me(te.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(s.toString()))}}async unmuteLocal(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const s=this.peerConnection.getTransceivers().filter(h=>h.mid&&r.indexOf(h.mid)!==-1);if(s.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length.");s.map(async(h,m)=>{h.direction="sendonly"});const a=await this.peerConnection.createOffer(),c=this.logSDPExchange(a.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(a),this.remoteSDP.unmuteRemote(r),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec(r,this.remoteCodecs,this.store.codec);const u=this.remoteSDP.toString();c==null||c(u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(s){throw new Me(te.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(s.toString()))}}restartICE(r){var s=this;return Il(function*(){const a=yield Nn(s.mutex.lock("From P2PConnection.restartICE"));try{if(!s.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");const c=jn().supportPCSetConfiguration,u=oe("FORCE_TURN_TCP")||s.forceTurn;if(r===Bs.RELAY&&!c)return;if(c&&!u){const R=r===Bs.RELAY?"relay":"all",P=s.peerConnection.getConfiguration();P.iceTransportPolicy!==R&&(x.debug("[".concat(s.store.clientId,"] restartICE change iceTransportPolicy from [").concat(P.iceTransportPolicy,"] to [").concat(R,"]")),P.iceTransportPolicy=R,s.peerConnection.setConfiguration(P))}s.remoteSDP.updateCandidates(r);const h=yield Nn(s.peerConnection.createOffer({iceRestart:!0}));if(!h.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const m=Jm(h.sdp),{remoteIceParameters:y}=yield m.iceParameters;s.remoteSDP.restartICE(y);const v=s.remoteSDP.toString(),S=s.logSDPExchange(h.sdp||"","offer","local","restartICE");s.store.descriptionStart(),yield Nn(s.peerConnection.setLocalDescription(h)),S==null||S(v),yield Nn(s.peerConnection.setRemoteDescription({type:"answer",sdp:v}))}catch(c){x.warning("[".concat(s.store.clientId,"] restart ICE failed, abort operation"),c)}finally{a()}})()}async extendCandidate(){if(!this.remoteSDP||this.isFirstConnected)return;const r=await this.mutex.lock("From P2PConnection.extendCandidate");try{this.remoteSDP.updateCandidates(Bs.TCP_RELAY),await HT(this.peerConnection,this.remoteSDP,this.extension)}catch(s){x.warning("[".concat(this.store.clientId,"] extend candidate failed, abort operation"),s)}finally{r()}}close(){var r;this.peerConnection.getTransceivers().forEach(s=>{VP(this.id+s.mid,this)}),this.preSSRCMap.clear(),this.peerConnection.close(),(r=this.onConnectionStateChange)===null||r===void 0||r.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy(),this.dataStreamChannelMap.clear(),this.recoveredDataChannelIds=[],this.currentDataChannelId=1}getStats(){return Rd(Rd({},this.statsFilter.getStats()),{},{qualityLimitationReason:this.qualityLimitationReason})}getRemoteVideoIsReady(r){return this.statsFilter.getVideoIsReady(r)}async updateEncoderConfig(r,s){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const a=await this.peerConnection.createOffer(),c=this.mungSendOfferSDP(a.sdp,[s],[r]);this.remoteSDP.updateRecvMedia(r,s);const u=this.remoteSDP.toString(),h=this.logSDPExchange(c,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:c}),h==null||h(u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(a){throw new Me(te.EXCHANGE_SDP_FAILED,a.toString())}}async updateSendParameters(r,s){const a=this.peerConnection.getTransceivers().filter(c=>c.mid===r);a.length===1&&(this.isVP8Simulcast(s)?zr()||await this.applySimulcastEncodings(a,[s]):await this.applySendEncodings(a,[s]))}setStatsRemoteVideoIsReady(r,s){this.statsFilter.setVideoIsReady2(r,s)}async replaceTrack(r,s){const a=this.peerConnection.getTransceivers().find(c=>c.mid===s);a&&await a.sender.replaceTrack(r._mediaStreamTrack)}async getSelectedCandidatePair(){const r=this.peerConnection.getReceivers();if(r.length>0&&r[0].transport&&r[0].transport.iceTransport&&r[0].transport.iceTransport.getSelectedCandidatePair&&r[0].transport.iceTransport.getSelectedCandidatePair()){const s=r[0].transport.iceTransport,{local:a,remote:c}=s.getSelectedCandidatePair();return{local:Rd(Rd({},Th),{},{candidateType:a.type,protocol:a.protocol,address:a.address,port:a.port}),remote:Rd(Rd({},Th),{},{candidateType:c.type,protocol:c.protocol,address:c.address,port:c.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var r;(r=this.onICEConnectionStateChange)===null||r===void 0||r.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var r;this.peerConnection.connectionState==="connected"&&(this.isFirstConnected=!0),(r=this.onConnectionStateChange)===null||r===void 0||r.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidateerror=r=>{if(r&&(r.errorCode||r.errorText)){var s;const a="code: ".concat(r.errorCode,", message: ").concat(r.errorText),c=r.port?"local: ".concat(r.port):"";x.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICECandidateError(").concat(a,"), url: ").concat(r.url||"",", host_candidate:").concat(c)),(s=this.onICECandidateError)===null||s===void 0||s.call(this,a)}},this.peerConnection.onicegatheringstatechange=r=>{r&&r.target&&"iceGatheringState"in r.target&&x.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] RTCPeerConnection.onicegatheringstatechange(").concat(r.target.iceGatheringState,")"))},this.peerConnection.onicecandidate=r=>{r.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,x.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,x.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},oe("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(r){const s={iceServers:[]};return r.iceServers?s.iceServers=r.iceServers:r.turnServer&&(OT(r.turnServer.servers)?s.iceServers=r.turnServer.servers:oe("NEW_TURN_MODE")&&s.iceServers?(oe("USE_TURN_SERVER_OF_GATEWAY")?r.turnServer.serversFromGateway&&s.iceServers.push(...vy.newTurnServerConfigToIceServers(r.turnServer.serversFromGateway)):s.iceServers.push(...vy.newTurnServerConfigToIceServers(r.turnServer.servers)),oe("NEW_FORCE_TURN")&&(s.iceTransportPolicy="relay")):r.turnServer.mode!=="off"&&(s.iceServers&&s.iceServers.push(...vy.turnServerConfigToIceServers(r.turnServer.servers)),oe("USE_TURN_SERVER_OF_GATEWAY")&&s.iceServers&&r.turnServer.serversFromGateway&&s.iceServers.push(...vy.turnServerConfigToIceServers(r.turnServer.serversFromGateway)),oe("FORCE_TURN_TCP")?s.iceTransportPolicy="relay":r.turnServer.servers.concat(r.turnServer.serversFromGateway||[]).forEach(a=>{a.forceturn&&(s.iceTransportPolicy="relay")}))),oe("ENABLE_ENCODED_TRANSFORM")&&jn().supportWebRTCEncodedTransform&&(s.encodedInsertableStreams=!0),s}static turnServerConfigToIceServers(r){const s=[];return r.forEach(a=>{a.security?a.tcpport&&s.push({username:a.username,credential:a.password,credentialType:"password",urls:"turns:".concat(Ym(a.turnServerURL),":").concat(a.tcpport,"?transport=tcp")}):(a.udpport&&!oe("FORCE_TURN_TCP")&&s.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":").concat(a.udpport,"?transport=udp")}),a.tcpport&&s.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":").concat(a.tcpport,"?transport=tcp")}))}),s}static newTurnServerConfigToIceServers(r){const s=[];return r.forEach(a=>{const c=oe("NEW_TURN_MODE");c===1?s.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":3478?transport=udp")}):c===2?s.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":3478?transport=tcp")}):c===3?s.push({username:a.username,credential:a.password,credentialType:"password",urls:"turns:".concat(Ym(a.turnServerURL),":443?transport=tcp")}):c===4&&(s.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":3478?transport=udp")}),s.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":3478?transport=tcp")}),s.push({username:a.username,credential:a.password,credentialType:"password",urls:"turns:".concat(Ym(a.turnServerURL),":443?transport=tcp")}))}),s}tryBindTransportEvents(r){const s=r.transport;if(s){this.transportEventReceiver=r,s.onstatechange=()=>{var c;s!=null&&s.state&&((c=this.onDTLSTransportStateChange)===null||c===void 0||c.call(this,s.state))},s.onerror=c=>{var u;(u=this.onDTLSTransportError)===null||u===void 0||u.call(this,"error"in c?c.error:c)};const a=s.iceTransport;a&&(a.onstatechange=()=>{const c=s==null?void 0:s.iceTransport.state;var u;c&&((u=this.onICETransportStateChange)===null||u===void 0||u.call(this,c))},a.getSelectedCandidatePair&&(a.onselectedcandidatepairchange=()=>{if(a.getSelectedCandidatePair()){const{local:c,remote:u}=a.getSelectedCandidatePair();x.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:c.type,protocol:c.protocol}),", remote ").concat(JSON.stringify({candidateType:u.type,protocol:u.protocol,address:u.address,port:u.port})," )"))}}))}}tryUnbindTransportEvents(){this.transportEventReceiver&&this.transportEventReceiver.transport&&(this.transportEventReceiver.transport.onstatechange=null,this.transportEventReceiver.transport.onerror=null,this.transportEventReceiver.transport.iceTransport&&(this.transportEventReceiver.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(r,s){var a,c;if(s||(s=this.peerConnection.getSenders().find(j=>j.track===r._mediaStreamTrack)),!s)return x.warn("[".concat(r.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(r))return x.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!jn().supportSetRtpSenderParameters)return x.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const u={},h={};switch(r._optimizationMode){case"motion":u.degradationPreference="maintain-framerate";break;case"detail":u.degradationPreference="maintain-resolution";break;case"balanced":u.degradationPreference="balanced"}const m=function(F,j){return F.getTransceivers().find(Y=>Y.sender.track===j||Y.receiver.track===j)}(this.peerConnection,r._mediaStreamTrack),y=Ime(r);if(jge(r)&&m&&s&&y&&this.getLocalVideoStats&&ot(a=["vp8","vp9"]).call(a,this.store.codec)){var v;const F=u.degradationPreference||(ot(v=r._hints).call(v,pr.CUSTOM_TRACK)?oe("CUSTOM_ADAPTATION_DEFAULT_MODE"):"maintain-framerate");(function(j,Y,ee,fe,Se,we){if(VP(j,ee),Se(Y),fe!=="balanced"&&fe!=="maintain-framerate"&&fe!=="maintain-resolution")return;let ye=-1;A9(j,Y);const Ne=window.setInterval(()=>{const ht=UP.get(j);if(!oe("ENABLE_AG_ADAPTATION")||!ht)return VP(j,ee),void Se(Y);const mt=we();if(mt.sendPackets>0&&mt.OutgoingAvailableBandwidth>0){if(ye===-1)return void(ye=Date.now());if(Date.now()-ye<1e3)return;const In=mt.sendFrameRate,An=mt.OutgoingAvailableBandwidth,[mr,di]=Fge(j,In,An,ht.adaptationConfig,Y,fe);di&&(ee.qualityLimitationReason=di),mr&&ht.adaptationConfig.scale!==mr.scale&&(x.debug("[".concat(j,"] applyAdaptation: ").concat(ee.qualityLimitationReason,`
           sendFps `).concat(In,", bwe ").concat(An,", switch from ").concat(ht.adaptationConfig.scale," to ").concat(mr.scale," ")),ht.adaptationConfig=P2(P2({},ht.adaptationConfig),mr),Se(mr))}},oe("CHECK_LOCAL_STATS_INTERVAL")),Ye=P2({},Y);UP.set(j,{timer:Ne,adaptationConfig:Ye,originConfig:Y,adaptationFunc:Se}),x.debug("[".concat(j,"] start adaptation, originConfig: ").concat(JSON.stringify(Y),", degradationPreference: ").concat(fe))})(this.id+m.mid,y,this,F,j=>{s&&this.updateAdaptation(s,j)},this.getLocalVideoStats.bind(this))}if(r._encoderConfig){var S;const{bitrateMax:F,frameRate:j,scaleResolutionDownBy:Y}=r._encoderConfig;F&&(h.maxBitrate=1e3*F),(ot(S=r._hints).call(S,pr.LOW_STREAM)||r.isUseScaleResolutionDownBy)&&(j&&(h.maxFramerate=vc(j)),Y&&Y>=1&&(h.scaleResolutionDownBy=Y))}const{maxFramerate:R}=oe("ENCODER_CONFIG_LIMIT");if(R&&typeof R=="number"&&(h.maxFramerate=h.maxFramerate?Math.min(h.maxFramerate,R):R),oe("DSCP_TYPE")&&ip()){var P;const F=oe("DSCP_TYPE");ot(P=["very-low","low","medium","high"]).call(P,F)&&(h.networkPriority=F)}const D=s.getParameters(),G=(c=D.encodings)===null||c===void 0?void 0:c[0];zr()&&!G&&(u.encodings=[h]),G&&Object.assign(G,h),Object.assign(D,u),x.debug("[".concat(r.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(D.encodings))),await s.setParameters(D),await async function(F,j,Y){try{var ee;if(!jn().supportSetRtpSenderParameters||!function(Ne){return Ne==="vp9"||Ne==="av1"}(F)||!oe("ENABLE_SVC"))return;const fe={},Se={},we=j.getParameters(),ye=(ee=we.encodings)===null||ee===void 0?void 0:ee[0];Se.scalabilityMode=IP(Y),ye&&Object.assign(ye,Se),Object.assign(we,fe),await j.setParameters(we),x.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode success: ".concat(JSON.stringify(we.encodings)))}catch(fe){x.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode failed",fe)}}(this.store.codec,s,oe("SVC_MODE"))}async updateAdaptation(r,s){var a,c;if(!r)return x.debug("[updateAdaptation] no rtpSender found");if(!jn().supportSetRtpSenderParameters)return x.debug("[updateAdaptation] Browser not support set rtp-sender parameters");const u={},{bitrateMax:h,frameRate:m,scaleResolutionDownBy:y}=s;h&&(u.maxBitrate=1e3*h),m&&(u.maxFramerate=vc(m)),y&&y>=1&&ot(a=["vp8","vp9"]).call(a,this.store.codec)&&(u.scaleResolutionDownBy=y);const v=r.getParameters(),S=(c=v.encodings)===null||c===void 0?void 0:c[0];S&&Object.assign(S,u),Object.assign(v,{});try{await r.setParameters(v),x.debug("[updateAdaptation] updateRtpSenderEncodings: ".concat(JSON.stringify(v.encodings)))}catch(R){!("transport"in r)||r.transport&&r.transport.state==="connected"?this.peerConnectionState!=="connected"?x.debug("[updateAdaptation] peerConnection not connected}"):x.debug("[updateAdaptation] updateRtpSenderEncodings failed",R):x.debug("[updateAdaptation] rtpSender transport not connected}")}}async applySendEncodings(r,s){try{if(!jn().supportSetRtpSenderParameters||r.length!==s.length)return;for(let a=0;a<r.length;a++){const c=r[a],u=s[a];u instanceof Tr&&!this.isVP8Simulcast(u)&&await this.updateRtpSenderEncodings(u,c.sender)}}catch{x.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(r,s,a){const c=Wa(r);return s.forEach((u,h)=>{const m=a[h],y=c.mediaDescriptions.find(v=>v.attributes.mid===m);y&&(dS(y,u),XH(y,u,this.store.codec))}),$m(c)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=r=>{var s;(s=this.onFirstAudioReceived)===null||s===void 0||s.call(this,r)},this.statsFilter.onFirstVideoReceived=r=>{var s;(s=this.onFirstVideoReceived)===null||s===void 0||s.call(this,r)},this.statsFilter.onFirstAudioDecoded=r=>{var s;(s=this.onFirstAudioDecoded)===null||s===void 0||s.call(this,r)},this.statsFilter.onFirstVideoDecoded=(r,s,a)=>{var c;(c=this.onFirstVideoDecoded)===null||c===void 0||c.call(this,r,s,a)},this.statsFilter.onSelectedLocalCandidateChanged=(r,s)=>{var a;(a=this.onSelectedLocalCandidateChanged)===null||a===void 0||a.call(this,r,s)},this.statsFilter.onSelectedRemoteCandidateChanged=(r,s)=>{var a;(a=this.onSelectedRemoteCandidateChanged)===null||a===void 0||a.call(this,r,s)},this.statsFilter.onFirstVideoDecodedTimeout=r=>{var s;(s=this.onFirstVideoDecodedTimeout)===null||s===void 0||s.call(this,r)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(r,s){if(r.length===s.length)for(let y=0;y<r.length;y++){var a,c,u,h,m;const v=r[y],S=s[y];if(S instanceof Tr&&!ot(a=S._hints).call(a,pr.LOW_STREAM)&&(c=S._encoderConfig)!==null&&c!==void 0&&c.bitrateMax&&((u=S._encoderConfig)===null||u===void 0?void 0:u.bitrateMax)>200&&(h=S._scalabilityMode)!==null&&h!==void 0&&h.numSpatialLayers&&((m=S._scalabilityMode)===null||m===void 0?void 0:m.numSpatialLayers)>1&&this.store.codec==="vp8"){const R={},P={high:1e3*(S._encoderConfig.bitrateMax-50),medium:5e4};R.encodings=[{rid:"m",active:!0,maxBitrate:P.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:P.high}];const D=v.sender.getParameters();await v.sender.setParameters(Object.assign(D,R))}}}async applySimulcastEncodings(r,s){if(!zr()&&r.length===s.length)for(let a=0;a<r.length;a++){const c=s[a];if(c instanceof Tr&&this.isVP8Simulcast(c)){const u=r[a],h={},m={high:1e3*(c._encoderConfig.bitrateMax-50),medium:5e4};h.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:m.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:m.medium,scaleResolutionDownBy:4}];const y=u.sender.getParameters();await u.sender.setParameters(Object.assign(y,h))}}}isVP8Simulcast(r){var s,a,c,u,h;return!!(r instanceof Tr&&oe("SIMULCAST")&&this.store.codec==="vp8"&&!ot(s=r._hints).call(s,pr.LOW_STREAM)&&(a=r._encoderConfig)!==null&&a!==void 0&&a.bitrateMax&&((c=r._encoderConfig)===null||c===void 0?void 0:c.bitrateMax)>200&&(u=r._scalabilityMode)!==null&&u!==void 0&&u.numSpatialLayers&&((h=r._scalabilityMode)===null||h===void 0?void 0:h.numSpatialLayers)>1)}logSDPExchange(r,s,a,c){if(oe("SDP_LOGGING"))return x.upload("[".concat(this.store.clientId,"] exchanging ").concat(a," ").concat(s," SDP during P2PConnection.").concat(c,`
`),r),s==="offer"?u=>{this.logSDPExchange(u,"answer",a==="local"?"remote":"local",c)}:void 0}async getRemoteSSRC(r){if(!this.remoteSDP)return;const s=this.remoteSDP.getSSRC(r);return s&&s.length!==0?s[0].ssrcId:void 0}setConfiguration(r){if(jn().supportPCSetConfiguration){const s=vy.resolvePCConfiguration(r);this.peerConnection.setConfiguration(s)}}},wt(On.prototype,"updateRemoteRTPCapabilities",[pa],Object.getOwnPropertyDescriptor(On.prototype,"updateRemoteRTPCapabilities"),On.prototype),wt(On.prototype,"connect",[pa],Object.getOwnPropertyDescriptor(On.prototype,"connect"),On.prototype),wt(On.prototype,"updateRemoteConnect",[pa],Object.getOwnPropertyDescriptor(On.prototype,"updateRemoteConnect"),On.prototype),wt(On.prototype,"createDataChannels",[pa],Object.getOwnPropertyDescriptor(On.prototype,"createDataChannels"),On.prototype),wt(On.prototype,"receive",[pa],Object.getOwnPropertyDescriptor(On.prototype,"receive"),On.prototype),wt(On.prototype,"batchReceive",[pa],Object.getOwnPropertyDescriptor(On.prototype,"batchReceive"),On.prototype),wt(On.prototype,"stopReceiving",[pa],Object.getOwnPropertyDescriptor(On.prototype,"stopReceiving"),On.prototype),wt(On.prototype,"muteRemote",[pa],Object.getOwnPropertyDescriptor(On.prototype,"muteRemote"),On.prototype),wt(On.prototype,"unmuteRemote",[pa],Object.getOwnPropertyDescriptor(On.prototype,"unmuteRemote"),On.prototype),wt(On.prototype,"muteLocal",[pa],Object.getOwnPropertyDescriptor(On.prototype,"muteLocal"),On.prototype),wt(On.prototype,"unmuteLocal",[pa],Object.getOwnPropertyDescriptor(On.prototype,"unmuteLocal"),On.prototype),wt(On.prototype,"close",[pa],Object.getOwnPropertyDescriptor(On.prototype,"close"),On.prototype),wt(On.prototype,"updateEncoderConfig",[pa],Object.getOwnPropertyDescriptor(On.prototype,"updateEncoderConfig"),On.prototype),wt(On.prototype,"updateSendParameters",[pa],Object.getOwnPropertyDescriptor(On.prototype,"updateSendParameters"),On.prototype),wt(On.prototype,"replaceTrack",[pa],Object.getOwnPropertyDescriptor(On.prototype,"replaceTrack"),On.prototype),wt(On.prototype,"updateAdaptation",[pa],Object.getOwnPropertyDescriptor(On.prototype,"updateAdaptation"),On.prototype),wt(On.prototype,"getRemoteSSRC",[pa],Object.getOwnPropertyDescriptor(On.prototype,"getRemoteSSRC"),On.prototype),On);function pa(t,r,s){const a=t[r];if(typeof a!="function")throw new Error("Cannot use mutex on object property.");return s.value=async function(){const c=this.mutex,u=await c.lock("From P2PConnection.".concat(r));try{for(var h=arguments.length,m=new Array(h),y=0;y<h;y++)m[y]=arguments[y];return await a.apply(this,m)}finally{u()}},s}function D2(t,r){let s=document.createElement("video"),a=document.createElement("canvas");s.setAttribute("style","display:none"),a.setAttribute("style","display:none"),s.setAttribute("muted",""),s.muted=!0,s.setAttribute("autoplay",""),s.autoplay=!0,s.setAttribute("playsinline",""),a.width=vc(r.width),a.height=vc(r.height);const c=vc(r.framerate||15);document.body.append(s),document.body.append(a);let u=t._mediaStreamTrack;s.srcObject=new MediaStream([u]),s.play();const h=a.getContext("2d");if(!h)throw new Oe(te.UNEXPECTED_ERROR,"can not get canvas context");const m=jn(),y=a.captureStream(m.supportRequestFrame?0:c).getVideoTracks()[0];y.canvas||(y.canvas=a),a.startCapture=()=>{if(!s)return a.stopCapture&&a.stopCapture();if(s.paused&&s.play(),s.videoHeight>2&&s.videoWidth>2){const S=s.videoWidth,R=s.videoHeight/S,P=a.width*R;Math.abs(P-a.height)>=2&&(x.debug("adjust low stream resolution","".concat(a.width,"x").concat(a.height," -> ").concat(a.width,"x").concat(P)),a.height=P)}h.drawImage(s,0,0,a.width,a.height),y.requestFrame&&y.requestFrame(),u!==t._mediaStreamTrack&&(u=t._mediaStreamTrack,s.srcObject=new MediaStream([u]))},a.stopCapture=GL(()=>a.startCapture&&a.startCapture(),c);const v=y.stop;return y.stop=()=>{v.call(y),s&&(s.remove(),s.srcObject=null,s=null),a&&(a.width=0,a.remove(),a.stopCapture&&a.stopCapture(),a.startCapture=void 0,a.stopCapture=void 0,a=null),x.debug("clean low stream renderer")},y}var jP=function(t){return t[t.HEIGHT=2033]="HEIGHT",t[t.FRAME_RATE=2034]="FRAME_RATE",t[t.WIDTH=2035]="WIDTH",t}(jP||{}),bi=function(t){return t[t.FRAME_RATE=2002]="FRAME_RATE",t[t.WIDTH=2003]="WIDTH",t[t.HEIGHT=2004]="HEIGHT",t[t.PACKAGE_LOST=2005]="PACKAGE_LOST",t[t.AVG_ENCODE=2007]="AVG_ENCODE",t[t.NACKS=2009]="NACKS",t[t.PLIS=2010]="PLIS",t[t.FIRS=2011]="FIRS",t[t.BITRATE=2012]="BITRATE",t[t.PACKAGE_RATE=2031]="PACKAGE_RATE",t[t.ADAPTATION=2032]="ADAPTATION",t[t.ACTUAL_ENCODED=2060]="ACTUAL_ENCODED",t[t.BANDWIDTH=2061]="BANDWIDTH",t[t.RETRANSMIT=2062]="RETRANSMIT",t[t.TARGET_ENCODED=2064]="TARGET_ENCODED",t[t.TRANSMIT=2066]="TRANSMIT",t[t.FREEZE=2082]="FREEZE",t[t.DISABLED=2095]="DISABLED",t[t.PLAYER_STATUS=2128]="PLAYER_STATUS",t[t.QP_SUM=2143]="QP_SUM",t[t.BYTES_RETRANSMIT=2173]="BYTES_RETRANSMIT",t[t.PACKAGES_RETRANSMIT=2172]="PACKAGES_RETRANSMIT",t[t.HUGE_FRAME_SENT=2174]="HUGE_FRAME_SENT",t[t.KEY_FRAMES_ENCODED=2207]="KEY_FRAMES_ENCODED",t}(bi||{}),ey=function(t){return t[t.BITRATE=2069]="BITRATE",t[t.PACKAGE_LOST=2070]="PACKAGE_LOST",t[t.PACKAGE_RATE=2071]="PACKAGE_RATE",t[t.HEIGHT=2073]="HEIGHT",t[t.FRAME_RATE=2075]="FRAME_RATE",t[t.WIDTH=2077]="WIDTH",t}(ey||{}),Ti=function(t){return t[t.JITTER=-1]="JITTER",t[t.PACKAGE_LOST=2014]="PACKAGE_LOST",t[t.WIDTH=2018]="WIDTH",t[t.HEIGHT=2019]="HEIGHT",t[t.FRAME_RATE=2020]="FRAME_RATE",t[t.JITTER_BUFFER=2023]="JITTER_BUFFER",t[t.CURRENT_DELAY=2024]="CURRENT_DELAY",t[t.NACKS=2026]="NACKS",t[t.PLIS=2027]="PLIS",t[t.FIRS=2028]="FIRS",t[t.BITRATE=2029]="BITRATE",t[t.PACKAGE_RATE=2078]="PACKAGE_RATE",t[t.FREEZE=2084]="FREEZE",t[t.DISABLED=2101]="DISABLED",t[t.PLAYER_STATUS=2129]="PLAYER_STATUS",t[t.QP_SUM=2144]="QP_SUM",t[t.I_FRAME_DELAY=2149]="I_FRAME_DELAY",t[t.FRAMES_DROPPED=2181]="FRAMES_DROPPED",t[t.BYTES_RETRANSMIT=2175]="BYTES_RETRANSMIT",t[t.PACKAGES_RETRANSMIT=2176]="PACKAGES_RETRANSMIT",t[t.PACKAGES_DISCARDED=2198]="PACKAGES_DISCARDED",t[t.AVG_DECODE=2200]="AVG_DECODE",t[t.AVG_PROCESSING_DELAY=2202]="AVG_PROCESSING_DELAY",t[t.AVG_ASSEMBLY_TIME=2203]="AVG_ASSEMBLY_TIME",t[t.AVG_INTER_FRAME_DELAY=2204]="AVG_INTER_FRAME_DELAY",t[t.KEY_FRAMES_DECODED=2206]="KEY_FRAMES_DECODED",t}(Ti||{}),ty=function(t){return t[t.FRAME_RATE_DECODE=2021]="FRAME_RATE_DECODE",t[t.FRAME_RATE_RENDER=2022]="FRAME_RATE_RENDER",t[t.FRAME_RATE_OUTPUT=2155]="FRAME_RATE_OUTPUT",t[t.FREEZE_TIME=2109]="FREEZE_TIME",t[t.FREEZE_TIME_RENDER=2147]="FREEZE_TIME_RENDER",t[t.FREEZE_DURATION=2156]="FREEZE_DURATION",t}(ty||{}),D9=function(t){return t[t.PCM_LEVEL=2104]="PCM_LEVEL",t}(D9||{}),Oh=function(t){return t[t.PACKAGE_LOST=-1]="PACKAGE_LOST",t[t.LEVEL=2038]="LEVEL",t[t.BITRATE=2039]="BITRATE",t[t.PACKAGE_RATE=2040]="PACKAGE_RATE",t[t.AEC_RETURN_LOSS=2041]="AEC_RETURN_LOSS",t[t.AEC_RETURN_LOSS_ENH=2042]="AEC_RETURN_LOSS_ENH",t[t.FREEZE=2081]="FREEZE",t[t.DISABLED=2096]="DISABLED",t[t.BYTES_RETRANSMIT=2179]="BYTES_RETRANSMIT",t[t.PACKAGES_RETRANSMIT=2180]="PACKAGES_RETRANSMIT",t}(Oh||{}),ma=function(t){return t[t.BITRATE=2044]="BITRATE",t[t.PACKAGE_LOST=2045]="PACKAGE_LOST",t[t.PACKAGE_RATE=2046]="PACKAGE_RATE",t[t.CURRENT_DELAY=2047]="CURRENT_DELAY",t[t.JITTER_BUFFER=2054]="JITTER_BUFFER",t[t.JITTER=2055]="JITTER",t[t.FREEZE=2083]="FREEZE",t[t.DISABLED=2102]="DISABLED",t[t.PCM_LEVEL=2105]="PCM_LEVEL",t[t.PLAYER_STATUS=2130]="PLAYER_STATUS",t[t.CONCEALED_SAMPLES=2148]="CONCEALED_SAMPLES",t[t.BYTES_RETRANSMIT=2178]="BYTES_RETRANSMIT",t[t.PACKAGES_RETRANSMIT=2177]="PACKAGES_RETRANSMIT",t[t.PACKAGES_DISCARDED=2199]="PACKAGES_DISCARDED",t[t.AVG_PROCESSING_DELAY=2201]="AVG_PROCESSING_DELAY",t[t.TOTAL_SAMPLES_RECEIVED=2224]="TOTAL_SAMPLES_RECEIVED",t}(ma||{}),x9=function(t){return t[t.FREEZE_TIME=-1]="FREEZE_TIME",t[t.LEVEL=2043]="LEVEL",t}(x9||{}),ga=function(t){return t[t.RTT=2006]="RTT",t[t.CONN_TYPE=801]="CONN_TYPE",t[t.STATS_UPDATE_INTERVAL=2205]="STATS_UPDATE_INTERVAL",t}(ga||{}),BP=function(t){return t[t.RTC_PEER_CONNECTION_STATE=2219]="RTC_PEER_CONNECTION_STATE",t}(BP||{});const ny=1e3,ry=6,WP=3,zge=Math.max(ry,WP);function zt(t,r,s){s!=null&&Number.isFinite(s)&&(t[r]=Math.round(Math.max(0,s)))}function L9(t){const r={[ga.CONN_TYPE]:0,[ga.RTT]:t.rtt,[ga.STATS_UPDATE_INTERVAL]:t.updateInterval?Math.round(Math.max(0,t.updateInterval)):void 0};switch(t.selectedCandidatePair.localCandidate.candidateType){case"relay":{const s=t.selectedCandidatePair.localCandidate.relayProtocol;s==="udp"&&(r[ga.CONN_TYPE]=1),s==="tcp"&&(r[ga.CONN_TYPE]=3),s==="tls"&&(r[ga.CONN_TYPE]=4);break}case"srflx":r[ga.CONN_TYPE]=2;break;case"unknown":r[ga.CONN_TYPE]=5;break;default:r[ga.CONN_TYPE]=0}return r}function M9(t){let r=0;switch(t){case"none":r=0;break;case"cpu":r=1;break;case"bandwidth":r=2;break;case"other":r=3}return r}class U9 extends Fr{constructor(r){super(),K(this,"store",void 0),K(this,"uploadWRTCStatsTimer",void 0),K(this,"uploadOutboundDenoiserStatsTimer",void 0),K(this,"uploadExtStatsTimer",void 0),K(this,"uploadExtUsageStatsTimer",void 0),K(this,"uploadInboundExtStatsTimer",void 0),K(this,"requestStats",void 0),K(this,"requestTransportStats",void 0),K(this,"requestLocalMedia",void 0),K(this,"requestRemoteMedia",void 0),K(this,"requestAllTracks",void 0),K(this,"requestVideoIsReady",void 0),K(this,"requestUploadStats",void 0),K(this,"requestUpload",void 0),K(this,"uploadOutboundStarted",!1),K(this,"uploadInboundStarted",!1),K(this,"uploadTransportStarted",!1),K(this,"uploadBaseStatsStarted",!1),K(this,"uploadExtensionUsageStarted",!1),K(this,"lastRecvStats",void 0),K(this,"lastSendStats",void 0),K(this,"lastRefRecvStats",void 0),K(this,"lastRefSendStats",void 0),K(this,"lastFullRecvStats",void 0),K(this,"lastFullSendStats",void 0),K(this,"needUploadRenderFreezeTime",!0),this.store=r}uploadWRTCStats(r){if(!this.requestStats||!this.requestUploadStats)return;const s=r%WP==0,a=r%ry==0;let c,u;if(this.uploadTransportStarted&&(c=this.requestStats(),this.store.useP2P&&(u=this.requestStats(!0))),!c&&this.uploadOutboundStarted&&(c=this.requestStats()),!u&&this.uploadInboundStarted&&(u=this.requestStats(!0)),c||u){var h;const m={};if(this.uploadTransportStarted&&c){const v=this.getTransportStats(c,u,s);v&&(m.misc=[v])}if(this.uploadOutboundStarted&&c){const v=this.getOutboundStats(c,a?this.lastFullSendStats:s?this.lastRefSendStats:this.lastSendStats,s,a);v&&(m.outbound=[v])}if(this.uploadInboundStarted&&u){const v=this.getInboundStats(u,a?this.lastFullRecvStats:s?this.lastRefRecvStats:this.lastRecvStats,s,a);v&&(m.inbound=v)}const y=(h=this.requestTransportStats)===null||h===void 0?void 0:h.call(this).connectState;y&&(Array.isArray(m.misc)?m.misc[0]&&m.misc[0].addition&&(m.misc[0].addition[BP.RTC_PEER_CONNECTION_STATE]=PL[y]):m.misc=[{addition:{[BP.RTC_PEER_CONNECTION_STATE]:PL[y]}}]),this.requestUploadStats(m)}this.lastRecvStats=u,this.lastSendStats=c,a&&(this.lastFullRecvStats=u,this.lastFullSendStats=c),s&&(this.lastRefRecvStats=u,this.lastRefSendStats=c)}startUploadWRTCStats(){if(this.uploadWRTCStatsTimer)return;this.uploadBaseStatsStarted=!0;let r=1;this.uploadWRTCStatsTimer=window.setInterval(()=>{if(!this.uploadTransportStarted&&!this.uploadInboundStarted&&!this.uploadOutboundStarted){if(this.uploadBaseStatsStarted){var s,a;const c=(s=this.requestTransportStats)===null||s===void 0?void 0:s.call(this);return void(c&&((a=this.requestUploadStats)===null||a===void 0||a.call(this,{misc:[{addition:{[BP.RTC_PEER_CONNECTION_STATE]:PL[c.connectState]}}]})))}return this.stopUploadWRTCStats()}this.uploadWRTCStats(r),++r===zge+1&&(r=1)},ny)}stopUploadWRTCStats(){window.clearInterval(this.uploadWRTCStatsTimer),this.uploadWRTCStatsTimer=void 0,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0)}getTransportStats(r,s,a){if(!this.requestStats)return;if(!a)return r.rtt==null?void 0:{addition:{[ga.RTT]:r.rtt,[ga.CONN_TYPE]:void 0,[ga.STATS_UPDATE_INTERVAL]:r.updateInterval||void 0}};const c=L9(r);if(this.store.useP2P){if(s){const u=L9(s);c[ga.CONN_TYPE]+=u[ga.CONN_TYPE]<<3}c[ga.CONN_TYPE]+=110}else c[ga.CONN_TYPE]+=100;return{addition:c}}getOutboundStats(r,s,a,c){if(!this.requestUploadStats||!this.requestLocalMedia)return;const u=this.requestLocalMedia();if(!u||u.length===0)return;let h,m,y;return u.forEach(v=>{let[S,{track:R,ssrcs:P}]=v;switch(S){case Ke.LocalVideoLowTrack:case Ke.LocalVideoTrack:if(S===Ke.LocalVideoTrack){const D=function(j,Y,ee,fe,Se,we){const ye=Y.videoSend.find(mt=>mt.ssrc===j);if(!ye)return;const Ne={},{sentFrame:Ye,inputFrame:ht}=ye;if(we&&(zt(Ne,bi.QP_SUM,ye.qpSumPerFrame),ht&&Ye)){const mt=ht.frameRate,In=Ye.frameRate;Ne[bi.FREEZE]=function(An,mr){let di=!0;return di=!(An<=5)&&(An<=10?mr<3:An<=20?mr<4:mr<5),di}(mt,In)?1:0}if(Se){switch(Ye&&(zt(Ne,bi.HEIGHT,Ye.height),zt(Ne,bi.WIDTH,Ye.width),zt(Ne,bi.FRAME_RATE,Ye.frameRate)),Ne[bi.DISABLED]=fe._originMediaStreamTrack&&!fe._originMediaStreamTrack.enabled||fe._mediaStreamTrack&&!fe._mediaStreamTrack.enabled?1:0,ye.adaptionChangeReason){case"none":Ne[bi.ADAPTATION]=0;break;case"cpu":Ne[bi.ADAPTATION]=1;break;case"bandwidth":Ne[bi.ADAPTATION]=2;break;case"other":Ne[bi.ADAPTATION]=3}let mt=0;ye.adaptionChangeReason&&(mt+=M9(ye.adaptionChangeReason)),Y.qualityLimitationReason&&(mt+=M9(Y.qualityLimitationReason)<<3),Ne[bi.ADAPTATION]=mt,Ne[bi.PLAYER_STATUS]=WL[fe._player?fe._player.videoElementStatus:"uninit"],zt(Ne,bi.NACKS,ye.nacksCount),zt(Ne,bi.PLIS,ye.plisCount),zt(Ne,bi.FIRS,ye.firsCount),zt(Ne,bi.AVG_ENCODE,ye.avgEncodeMs),zt(Ne,bi.HUGE_FRAME_SENT,ye.hugeFramesSent),zt(Ne,bi.BYTES_RETRANSMIT,ye.retransmittedBytesSent),zt(Ne,bi.PACKAGES_RETRANSMIT,ye.retransmittedPacketsSent),zt(Ne,bi.KEY_FRAMES_ENCODED,ye.keyFramesEncoded);const In=ee&&ee.videoSend.find(An=>An.ssrc===j);if(In){let An=Se?ny:ny*ry;In.timestamp&&ye.timestamp&&(An=ye.timestamp-In.timestamp),In.packets!=null&&ye.packets!=null&&zt(Ne,bi.PACKAGE_RATE,1e3*(ye.packets-In.packets)/An),ye.packetsLost!=null&&In.packetsLost!=null&&zt(Ne,bi.PACKAGE_LOST,ye.packetsLost-In.packetsLost),In.bytes!=null&&ye.bytes!=null&&zt(Ne,bi.BITRATE,8*(ye.bytes-In.bytes)/An)}}return Ne}(P[0].ssrcId,r,s,R,a,c),G=R&&function(j,Y,ee,fe){const Se=Y.videoSend.find(ye=>ye.ssrc===j);if(!Se)return null;const we={};if(fe){const ye=Se.inputFrame,Ne=ye&&ye.height||ee.videoHeight||0,Ye=ye&&ye.width||ee.videoWidth||0,ht=ye&&ye.frameRate||0;zt(we,jP.HEIGHT,Ne),zt(we,jP.WIDTH,Ye),zt(we,jP.FRAME_RATE,ht)}return we}(P[0].ssrcId,r,R,a),F=function(j,Y){const ee={};return Y&&(zt(ee,bi.RETRANSMIT,j.bitrate.retransmit),zt(ee,bi.TARGET_ENCODED,j.bitrate.targetEncoded),zt(ee,bi.ACTUAL_ENCODED,j.bitrate.actualEncoded),zt(ee,bi.TRANSMIT,j.bitrate.transmit),zt(ee,bi.BANDWIDTH,j.sendBandwidth)),ee}(r,a);m=Object.assign({},D,G,F)}else y=function(D,G,F,j){const Y=G.videoSend.find(fe=>fe.ssrc===D);if(!Y)return;const ee={};if(j){const fe=Y.sentFrame;if(fe&&(zt(ee,ey.HEIGHT,fe.height),zt(ee,ey.WIDTH,fe.width),zt(ee,ey.FRAME_RATE,fe.frameRate)),F){const Se=F.videoSend.find(we=>we.ssrc===D);if(Se){let we=ny*ry;Se.timestamp&&Y.timestamp&&(we=Y.timestamp-Se.timestamp),Se.packets!=null&&Y.packets!=null&&zt(ee,ey.PACKAGE_RATE,1e3*(Y.packets-Se.packets)/we),Y.packetsLost!=null&&Se.packetsLost!=null&&zt(ee,ey.PACKAGE_LOST,Y.packetsLost-Se.packetsLost),Se.bytes!=null&&Y.bytes!=null&&zt(ee,ey.BITRATE,8*(Y.bytes-Se.bytes)/we)}}}return ee}(P[0].ssrcId,r,s,a);break;case Ke.LocalAudioTrack:h=R&&function(D,G,F,j,Y){const ee=G.audioSend.find(Se=>Se.ssrc===D);if(!ee)return;const fe={};if(Y){fe[Oh.DISABLED]=j._originMediaStreamTrack&&!j._originMediaStreamTrack.enabled||j._mediaStreamTrack&&!j._mediaStreamTrack.enabled?1:0;const Se=100*j._source.getAccurateVolumeLevel(),we=ee.inputLevel;if(we!=null){const Ne=Math.ceil(50*Math.log10(100*we+1));zt(fe,Oh.LEVEL,Ne)}zt(fe,D9.PCM_LEVEL,Se),zt(fe,Oh.AEC_RETURN_LOSS,ee.aecReturnLoss),zt(fe,Oh.AEC_RETURN_LOSS_ENH,ee.aecReturnLossEnhancement),zt(fe,Oh.BYTES_RETRANSMIT,ee.retransmittedBytesSent),zt(fe,Oh.PACKAGES_RETRANSMIT,ee.retransmittedPacketsSent),fe[Oh.FREEZE]=0;const ye=F&&F.audioSend.find(Ne=>Ne.ssrc===D);if(ye){let Ne=ny*ry;ye.timestamp&&ee.timestamp&&(Ne=ee.timestamp-ye.timestamp),ye.bytes!=null&&ee.bytes!=null&&zt(fe,Oh.BITRATE,8*(ee.bytes-ye.bytes)/Ne),ye.packets!=null&&ee.packets!=null&&zt(fe,Oh.PACKAGE_RATE,1e3*(ee.packets-ye.packets)/Ne)}}return fe}(P[0].ssrcId,r,s,R,a)}}),{high:m,low:y,audio:h}}getInboundStats(r,s,a,c){if(!this.requestRemoteMedia)return;const u=this.requestRemoteMedia()||[],h=[];return u.forEach(m=>{let[y,v]=m;const S={peer:y.uid};if(v.has(Et.VIDEO)&&y.videoTrack){const R=y._videoSSRC&&this.requestVideoIsReady&&this.requestVideoIsReady(y._videoSSRC)||!1,P=y.videoTrack?function(D,G,F,j,Y,ee,fe,Se){const we=G.videoRecv.find(An=>An.ssrc===D);if(!we)return;const ye={},{receivedFrame:Ne,outputFrame:Ye,decodeFrameRate:ht}=we,mt=F&&F.videoRecv.find(An=>An.ssrc===D);if(zt(ye,ty.FRAME_RATE_DECODE,ht),we.framesRateFirefox&&zt(ye,Ti.FRAME_RATE,we.framesRateFirefox),Ne&&zt(ye,Ti.FRAME_RATE,Ne.frameRate),zt(ye,Ti.FRAMES_DROPPED,we.framesDroppedCount),zt(ye,Ti.BYTES_RETRANSMIT,we.retransmittedBytesReceived),zt(ye,Ti.PACKAGES_RETRANSMIT,we.retransmittedPacketsReceived),zt(ye,Ti.PACKAGES_DISCARDED,we.packetsDiscarded),zt(ye,Ti.AVG_DECODE,we.avgDecodeMs),zt(ye,Ti.AVG_PROCESSING_DELAY,we.avgProcessingDelayMs),zt(ye,Ti.AVG_ASSEMBLY_TIME,we.avgFramesAssembledFromMultiplePacketsMs),zt(ye,Ti.AVG_INTER_FRAME_DELAY,we.avgInterFrameDelayMs),zt(ye,Ti.KEY_FRAMES_DECODED,we.keyFramesDecoded),mt){const An=G.timestamp-F.timestamp||ny*(Se?ry:fe?WP:1);we.packetsLost!=null&&mt.packetsLost!=null&&zt(ye,Ti.PACKAGE_LOST,we.packetsLost-mt.packetsLost),mt.bytes!=null&&we.bytes!=null&&zt(ye,Ti.BITRATE,8*(we.bytes-mt.bytes)/An),mt.packets!=null&&we.packets!=null&&zt(ye,Ti.PACKAGE_RATE,1e3*(we.packets-mt.packets)/An)}if(Se&&(zt(ye,Ti.QP_SUM,we.qpSumPerFrame),ye[Ti.FREEZE]=Y&&qT.isRemoteVideoFreeze(j,we,mt)?1:0),fe){var In;Ne?(zt(ye,Ti.HEIGHT,Ne.height),zt(ye,Ti.WIDTH,Ne.width)):j&&(zt(ye,Ti.HEIGHT,j._videoHeight||0),zt(ye,Ti.WIDTH,j._videoWidth||0)),Ye&&zt(ye,ty.FRAME_RATE_OUTPUT,Ye.frameRate);const An=(In=j._player)===null||In===void 0?void 0:In.rendFrameRate.toFixed(0);if(An&&zt(ye,ty.FRAME_RATE_RENDER,+An),zt(ye,Ti.JITTER_BUFFER,we.jitterBufferMs),zt(ye,Ti.CURRENT_DELAY,we.currentDelayMs),zt(ye,Ti.FIRS,we.firsCount),zt(ye,Ti.NACKS,we.nacksCount),zt(ye,Ti.PLIS,we.plisCount),j){ye[Ti.DISABLED]=j._originMediaStreamTrack.enabled&&j._mediaStreamTrack.enabled?0:1;const mr=j._player;if(mr){const{freezeTimeCounterList:di,renderFreezeAccTime:Jr,videoElementStatus:ya}=mr;if(di&&di.length>0&&zt(ye,ty.FREEZE_TIME,di.splice(0,1)[0]),ee&&ap.visibility==="visible"&&ya===yo.PLAYING&&jn().supportRequestVideoFrameCallback){const je=Math.min(6e3,Jr);mr.renderFreezeAccTime=Math.max(0,Jr-je),zt(ye,ty.FREEZE_TIME_RENDER,je)}if(typeof we.totalFreezesDuration=="number"){const je=mt&&mt.totalFreezesDuration?we.totalFreezesDuration-mt.totalFreezesDuration:we.totalFreezesDuration;zt(ye,ty.FREEZE_DURATION,1e3*je)}}}if(ye[Ti.PLAYER_STATUS]=WL[j._player?j._player.videoElementStatus:"uninit"],mt&&we.totalInterFrameDelay!==void 0&&we.totalSquaredInterFrameDelay!==void 0&&mt.totalInterFrameDelay!==void 0&&mt.totalSquaredInterFrameDelay!==void 0){const mr=we.totalInterFrameDelay-mt.totalInterFrameDelay,di=we.totalSquaredInterFrameDelay-mt.totalSquaredInterFrameDelay,Jr=we.framesDecodeCount-mt.framesDecodeCount,ya=mr/Jr*1e3,je=Math.round(1e3*Math.sqrt((di-Math.pow(mr,2)/Jr)/Jr));!isNaN(je)&&ya+je>Math.max(3*ya,ya+150)&&(ye[Ti.I_FRAME_DELAY]=je)}}return ye}(y._videoSSRC,r,s,y.videoTrack,R===!0,this.needUploadRenderFreezeTime,a,c):void 0;P&&(S.video=P)}if(v.has(Et.AUDIO)&&y.audioTrack){const R=y.audioTrack?function(P,D,G,F,j,Y){const ee=D.audioRecv.find(ye=>ye.ssrc===P);if(!ee)return;const fe={},Se=G&&G.audioRecv.find(ye=>ye.ssrc===P);if(zt(fe,ma.JITTER,ee.jitterMs),zt(fe,ma.BYTES_RETRANSMIT,ee.retransmittedBytesReceived),zt(fe,ma.PACKAGES_RETRANSMIT,ee.retransmittedPacketsReceived),zt(fe,ma.PACKAGES_DISCARDED,ee.packetsDiscarded),zt(fe,ma.AVG_PROCESSING_DELAY,ee.avgProcessingDelayMs),Se){const ye=D.timestamp-G.timestamp||ny*(Y?ry:j?WP:1);ee.packets!=null&&Se.packets!=null&&zt(fe,ma.PACKAGE_RATE,1e3*(ee.packets-Se.packets)/ye),j&&Se.bytes!=null&&ee.bytes!=null&&zt(fe,ma.BITRATE,8*(ee.bytes-Se.bytes)/ye),ee.packetsLost!=null&&Se.packetsLost!=null&&zt(fe,ma.PACKAGE_LOST,ee.packetsLost-Se.packetsLost)}if(Y){const{receivedFrames:ye,droppedFrames:Ne}=ee;ye!=null&&Ne!=null&&(fe[ma.FREEZE]=(we=ye)===0||100*Ne/we>20?1:0)}var we;if(j){const ye=100*F._source.getAccurateVolumeLevel(),Ne=ee.outputLevel;if(Ne!=null){const Ye=Math.ceil(50*Math.log10(100*Ne+1));zt(fe,x9.LEVEL,Ye)}if(zt(fe,ma.PCM_LEVEL,ye),F&&(fe[ma.DISABLED]=F._originMediaStreamTrack.enabled&&F._mediaStreamTrack.enabled?0:1),zt(fe,ma.JITTER_BUFFER,ee.jitterBufferMs),zt(fe,ma.CURRENT_DELAY,ee.jitterBufferMs),fe[ma.PLAYER_STATUS]=WL[fa.getPlayerState(F.getTrackId())],Se){const Ye=ee.concealedSamples-Se.concealedSamples;Ye>0&&zt(fe,ma.CONCEALED_SAMPLES,Ye);const ht=ee.totalSamplesReceived-Se.totalSamplesReceived;ht>0&&zt(fe,ma.TOTAL_SAMPLES_RECEIVED,ht)}}return fe}(y._audioSSRC,r,s,y.audioTrack,a,c):void 0;R&&(S.audio=R)}(S.video||S.audio)&&h.push(S)}),this.needUploadRenderFreezeTime=!this.needUploadRenderFreezeTime,h}startUploadTransportStats(){this.uploadTransportStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats()}stopUploadTransportStats(){this.uploadTransportStarted=!1}startUploadOutboundStats(){this.uploadOutboundStarted||(this.uploadOutboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=window.setInterval(()=>{if(!this.requestAllTracks||!this.requestUpload)return;const r=(this.requestAllTracks()||[]).find(s=>s instanceof dP);if(r&&r._external.getDenoiserStats){const s=r._external.getDenoiserStats();s&&this.requestUpload(VT.DENOISER_STATS,s)}},2e3),this.uploadExtStatsTimer&&window.clearInterval(this.uploadExtStatsTimer),this.uploadExtStatsTimer=window.setInterval(()=>{!this.requestAllTracks||!this.requestUpload||this.requestAllTracks().forEach(r=>{r.getProcessorStats().forEach(s=>{this.requestUpload&&this.requestUpload(s.type,s.stats)})})},2e3))}stopUploadOutboundStats(){this.uploadOutboundStarted&&(this.uploadOutboundStarted=!1,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=void 0)}startUploadInboundStats(){this.uploadInboundStarted||(this.uploadInboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadInboundExtStatsTimer&&window.clearInterval(this.uploadInboundExtStatsTimer),this.uploadInboundExtStatsTimer=window.setInterval(()=>{!this.requestUpload||!this.requestRemoteMedia||(this.requestRemoteMedia()||[]).forEach(r=>{let[s,a]=r;a.has(Et.VIDEO)&&s.videoTrack&&s.videoTrack.getProcessorStats().forEach(c=>{this.requestUpload&&this.requestUpload(c.type,c.stats)}),a.has(Et.AUDIO)&&s.audioTrack&&s.audioTrack.getProcessorStats().forEach(c=>{this.requestUpload&&this.requestUpload(c.type,c.stats)})})},2e3))}stopUploadInboundStats(){this.uploadInboundStarted&&(this.uploadInboundStarted=!1,this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0))}startUploadExtensionUsageStats(){if(this.uploadExtensionUsageStarted)return;this.uploadExtensionUsageStarted=!0,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer);const r=new Map;this.uploadExtUsageStatsTimer=window.setInterval(async()=>{const s=Date.now(),a={connectionInterval:oe("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3,details:[],lts:s};let c=[];const u=this.requestAllTracks&&this.requestAllTracks()||[];for(const v of u)!v.muted&&v.enabled&&(c=c.concat(await v.getProcessorUsage()));const h=this.requestRemoteMedia&&this.requestRemoteMedia()||[];for(const[v,S]of h)S.has(Et.VIDEO)&&v.videoTrack&&(c=c.concat(await v.videoTrack.getProcessorUsage())),S.has(Et.AUDIO)&&v.audioTrack&&(c=c.concat(await v.audioTrack.getProcessorUsage()));if(c.length===0)return;a.details=function(v,S){const R={};for(const{id:F,value:j,level:Y,direction:ee}of v){var P;const fe=(P=S.get(F))!==null&&P!==void 0?P:0,Se=j===2?fe+oe("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3:fe;var D,G;S.set(F,Se),R[F]?(j===2&&(R[F].value=j),Y>R[F].level&&(R[F].level=Y),ee==="remote"&&(R[F].remoteUidCount+=1),R[F].totalTs=(D=S.get(F))!==null&&D!==void 0?D:0):R[F]={value:j,level:Y,remoteUidCount:ee==="local"?0:1,totalTs:(G=S.get(F))!==null&&G!==void 0?G:0}}return Object.keys(R).map(F=>{const{level:j,value:Y,totalTs:ee}=R[F];return{id:F,level:j,value:Y,totalTs:ee}})}(c,r);const m=Date.now(),y=m>s?m:s+1;this.requestUpload&&this.requestUpload(VT.EXTENSION_USAGE_STATS,{usageStats:a,sendTs:y})},oe("EXTENSION_USAGE_UPLOAD_INTERVAL"))}stopUploadExtensionUsageStats(){this.uploadExtensionUsageStarted&&(this.uploadExtensionUsageStarted=!1,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer),this.uploadExtUsageStatsTimer=void 0)}stopUploadBaseStats(){this.uploadBaseStatsStarted=!1}}const Gge=oe("ICE_RESTART_INTERVAL");let zP=new Map,gS=new Map,eg=[Bs.UDP_TCP_RELAY,Bs.TCP_RELAY,Bs.RELAY],x2=oe("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&jn().supportPCSetConfiguration;function V9(t){let r=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const s=zP.get(t.id);s&&(window.clearTimeout(s),zP.delete(t.id));const a=gS.get(t.id);r&&a&&a.index===eg.length-1&&(x.debug("[".concat(t.id,"] reset ICE restart policy")),gS.delete(t.id))}function F9(t,r,s){if(zP.size===0&&gS.size===0&&(Array.isArray(oe("RESTART_SEQUENCE"))&&oe("RESTART_SEQUENCE").length>0&&!function(m,y){if(m.length!==y.length)return!1;for(let v=0;v<m.length;v+=1){const S=m[v];if(m.filter(R=>R===S).length!==y.filter(R=>R===S).length)return!1}return!0}(eg,oe("RESTART_SEQUENCE"))&&(eg=oe("RESTART_SEQUENCE").filter(m=>{var y;if(ot(y=Object.values(Bs)).call(y,m))return!0}),x.debug("use reconnection policy from config distribution, queues: ".concat(eg.join(" => ")))),x2=oe("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&jn().supportPCSetConfiguration),eg.length===0)return void s();let a,{index:c=0,type:u}=gS.get(t.id)||{};if(x2&&u===Bs.RELAY)return void s();let h=u&&c>=eg.length-1;if(x2)u=Bs.RELAY;else{if(h)return void s();u?(c++,u=eg[c]):(u=eg[0],c=0)}x.debug("[".concat(t.id,"] choose ICE restart policy: ").concat(u,", index: ").concat(c)),r(u),gS.set(t.id,{index:c,type:u}),a=window.setTimeout(()=>F9(t,r,s),Gge),zP.set(t.id,a)}var yn;function j9(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}function kh(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?j9(Object(s),!0).forEach(function(a){K(t,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):j9(Object(s)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))})}return t}function B9(t){var r,s,a,c=2;for(typeof Symbol<"u"&&(s=iL,a=Symbol.iterator);c--;){if(s&&(r=t[s])!=null)return r.call(t);if(a&&(r=t[a])!=null)return new GP(r.call(t));s="@@asyncIterator",a="@@iterator"}throw new TypeError("Object is not async iterable")}function GP(t){function r(s){if(Object(s)!==s)return dt.reject(new TypeError(s+" is not an object."));var a=s.done;return dt.resolve(s.value).then(function(c){return{value:c,done:a}})}return GP=function(s){this.s=s,this.n=s.next},GP.prototype={s:null,n:null,next:function(){return r(this.n.apply(this.s,arguments))},return:function(s){var a=this.s.return;return a===void 0?dt.resolve({value:s,done:!0}):r(a.apply(this.s,arguments))},throw:function(s){var a=this.s.return;return a===void 0?dt.reject(s):r(a.apply(this.s,arguments))}},new GP(t)}let XT=(yn=class extends Fr{get state(){return this._state}set state(t){const r=this._state;this._state=t,this.emit(xt.StateChange,r,this._state)}constructor(t,r){super(),K(this,"isPlanB",void 0),K(this,"store",void 0),K(this,"statsUploader",void 0),K(this,"connection",void 0),K(this,"localTrackMap",new Map),K(this,"remoteUserMap",new Map),K(this,"localDataChannels",[]),K(this,"remoteDataChannelMap",new Map),K(this,"pendingLocalTracks",[]),K(this,"pendingRemoteTracks",[]),K(this,"pendingLocalDataChannels",[]),K(this,"pendingRemoteDataChannels",[]),K(this,"statsCollector",void 0),K(this,"shouldForwardP2PCreation",void 0),K(this,"iceFailedCount",0),K(this,"dtlsFailedCount",0),K(this,"mutex",void 0),K(this,"_state",Yn.Disconnected),K(this,"_pcStatsUploadType",oe("NEW_ICE_RESTART")?dp.FIRST_CONNECTION:dp.OLD_FIRST_CONNECTION),K(this,"_isStartRestartIce",!1),K(this,"_restartTimer",void 0),K(this,"_isTryConnecting",!1),K(this,"_iceError",null),K(this,"_forceTurn",!1),K(this,"_isWaitPcToRePub",!1),K(this,"handleMuteLocalTrack",async(s,a,c)=>{const u=await this.mutex.lock("Locking from P2PChannel.handleMuteLocalTrack");try{if(!this.connection||this.state!==Yn.Connected)return void c(new Me(te.INVALID_OPERATION,"Cannot call P2PChannel.handleMuteLocalTrack before connection established."));const h=this.filterTobeMutedTracks(s);if(h.length===0)return void a();const m=h.find(v=>v[0]==="videoLowTrack");m&&m[1].track._originMediaStreamTrack.stop(),await this.connection.muteLocal(h.map(v=>{let[,{id:S}]=v;return S}));const y=this.createMuteMessage(h);await hr(this,xt.RequestMuteLocal,y),a()}catch(h){c(h)}finally{u()}}),K(this,"handleUnmuteLocalTrack",async(s,a,c)=>{const u=await this.mutex.lock("Locking from P2PChannel.handleUnmuteLocalTrack");try{if(!this.connection||this.state!==Yn.Connected)return void c(new Me(te.INVALID_OPERATION,"Cannot call P2PChannel.handleUnmuteLocalTrack before connection established."));const h=this.filterTobeUnmutedTracks(s);if(h.length===0)return void a();const m=h.find(v=>v[0]==="videoLowTrack");if(m){const v=m[1];if(v.track._originMediaStreamTrack.stop(),!oe("DISABLE_DUAL_STREAM_USE_ENCODING")&&jn().supportDualStreamEncoding){const S=s._mediaStreamTrack.clone();v.track._mediaStreamTrack=S,v.track._originMediaStreamTrack=S}else{const S=D2(s,kT(this,xt.RequestLowStreamParameter));v.track._mediaStreamTrack=S,v.track._originMediaStreamTrack=S}await new dt((S,R)=>{this.handleReplaceTrack(v.track,S,R,!0)})}await this.connection.unmuteLocal(h.map(v=>{let[,{id:S}]=v;return S}));const y=this.createUnmuteMessage(h);await hr(this,xt.RequestUnmuteLocal,y),a()}catch(h){c(h)}finally{u()}}),K(this,"handleUpdateVideoEncoder",async(s,a,c,u)=>{let h;u||(h=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoEncoder"));try{const y=this.localTrackMap.get(Ke.LocalVideoTrack);if(!this.connection||!y||y.track!==s||this.state!==Yn.Connected)return void a();const{id:v,track:S}=y;await this.connection.updateSendParameters(v,S),await this.connection.updateEncoderConfig(v,S),this.emit(xt.UpdateVideoEncoder,S),a()}catch(y){c(y)}finally{var m;(m=h)===null||m===void 0||m()}}),K(this,"handleUpdateVideoSendParameters",async(s,a,c)=>{const u=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoSendParameters");try{const h=this.localTrackMap.get(Ke.LocalVideoTrack);if(!this.connection||!h||h.track!==s||this.state!==Yn.Connected)return void a();const{id:m,track:y}=h;await this.connection.updateSendParameters(m,y),a()}catch(h){c(h)}finally{u()}}),K(this,"handleReplaceMixingTrack",async(s,a,c,u)=>{if(!this.connection||this.state!==Yn.Connected)return void a();const h=k2([s]);let m;x.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(h.getTrackId(),"]")),typeof u=="boolean"&&u||(m=await this.mutex.lock("From P2PChannel.handleReplaceMixingTrack"));try{await this.replaceTrack(s,h),a()}catch(v){c(v)}finally{var y;(y=m)===null||y===void 0||y()}}),K(this,"handleReplaceTrack",async(s,a,c,u)=>{let h;x.debug("[".concat(this.store.clientId,"] P2PChannel handleReplaceTrack for [track-id-").concat(s.getTrackId(),"]")),typeof u=="boolean"&&u||(h=await this.mutex.lock("From P2PChannel.handleReplaceTrack"));try{var m;const v=Array.from(this.localTrackMap.entries()).find(S=>{let[,{track:R}]=S;return s===R});if(!this.connection||!v||this.state!==Yn.Connected)return void a();if(await((m=this.connection)===null||m===void 0?void 0:m.replaceTrack(s,v[1].id)),this.isPlanB){const S=v[1];S.id=s._mediaStreamTrack.id,this.localTrackMap.set(v[0],S)}if(v[0]===Ke.LocalVideoTrack&&!oe("DISABLE_DUAL_STREAM_USE_ENCODING")&&jn().supportDualStreamEncoding){const S=this.localTrackMap.get(Ke.LocalVideoLowTrack);if(S){const R=s._mediaStreamTrack.clone();S.track._originMediaStreamTrack.stop(),S.track._mediaStreamTrack=R,S.track._originMediaStreamTrack=R,await new dt((P,D)=>{this.handleReplaceTrack(S.track,P,D,!0)})}}a()}catch(v){c(v)}finally{var y;(y=h)===null||y===void 0||y()}}),K(this,"handleGetRTCStats",s=>{s(this.statsCollector.getRTCStats())}),K(this,"handleGetLocalVideoStats",s=>{s(this.statsCollector.getLocalVideoTrackStats())}),K(this,"handleGetLocalAudioStats",s=>{s(this.statsCollector.getLocalAudioTrackStats())}),K(this,"handleGetRemoteVideoStats",s=>this.statsCollector.getRemoteVideoTrackStats(s.uid)[s.uid]),K(this,"handleGetRemoteAudioStats",s=>this.statsCollector.getRemoteAudioTrackStats(s.uid)[s.uid]),this.store=t,this.statsCollector=r,this.statsCollector.addP2PChannel(this),this.statsUploader=new U9(this.store),this.bindStatsUploaderEvents(),this.mutex=new Fs("P2PChannel-mutex",this.store.clientId),this.isPlanB=!jn().supportUnifiedPlan||oe("CHROME_FORCE_PLAN_B")&&ip(),this.shouldForwardP2PCreation=oe("FORWARD_P2P_CREATION")&&jn().supportPCSetConfiguration&&gL(),this.shouldForwardP2PCreation&&(this.connection=FP(this.store),this.emit(xt.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection))}async startP2PConnection(t){var r;this.state=Yn.New,this._forceTurn=k9(t),x.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] forceTurn: ").concat(this._forceTurn));const s=this.shouldForwardP2PCreation&&((r=this.connection)===null||r===void 0?void 0:r.peerConnectionState)==="closed";if(this.shouldForwardP2PCreation&&!s||(s&&this.connection&&(x.warning("[".concat(this.store.clientId,"] P2PChannel.startP2PConnection ForwardP2P closed.")),this.resetConnection(this.connection)),this.connection=FP(this.store,t),this.emit(xt.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),!this.connection)throw new Me(te.UNEXPECTED_ERROR,"Cannot P2PChannel.startConnection before P2PConnection initialization .");return this._pcStatsUploadType=oe("NEW_ICE_RESTART")?dp.FIRST_CONNECTION:dp.OLD_FIRST_CONNECTION,this._isTryConnecting=!0,this._isStartRestartIce=!1,this._iceError=null,this.connection.setConfiguration(t),this.connection.establishPromise}async connect(t){if(!this.connection)throw new Me(te.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");oe("ENABLE_PREALLOC_PC")&&this.state===Yn.Connected?await this.connection.updateRemoteConnect(t):(this.store.peerConnectionStart(),await this.connection.connect(t),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=Yn.Connected)}updateRemoteRTPCapabilities(t){const r=Array.from(this.localTrackMap.entries()).filter(c=>{var u;let[h]=c;return ot(u=[Ke.LocalVideoLowTrack,Ke.LocalVideoTrack]).call(u,h)}),s=r.map(c=>{let[,{id:u}]=c;return u}),a=r.map(c=>{let[u]=c;return u});if(this.connection instanceof Ph){if(At.updateRemoteRTPCapabilities(this.store.sessionId,{trackTypes:JSON.stringify(a),localCodecs:JSON.stringify(this.connection.localCodecs),remoteCodecs:JSON.stringify(t)}),!ot(t).call(t,this.store.codec)){const c=["vp9","vp8","h264"].find(u=>ot(t).call(t,u));c&&(this.store.codec=c,x.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId," updateRemoteRTPCapabilities] default codec is not available, hence the fallback to ").concat(c,".")))}this.connection.updateRemoteRTPCapabilities(s,t)}}async getEstablishParams(){var t;if(this.connection instanceof Ph&&this.connection.peerConnectionState!=="closed"&&ot(t=[Yn.New,Yn.Connected]).call(t,this.state))return this.connection.establishPromise}async publishDataChannel(t){if(!this.connection||this.state!==Yn.Connected){if(this.state===Yn.Disconnected)throw new Me(te.UNEXPECTED_ERROR,"PeerConnection already disconnected.");return t.forEach(s=>{var a;ot(a=this.pendingLocalDataChannels).call(a,s)||this.pendingLocalDataChannels.push(s)}),[]}const r=this.filterTobePublishedDataChannels(t);return r.length===0?[]:(r.forEach(s=>{const a=Date.now();this.store.publish(s.id.toString(),"datachannel",a)}),await this.connection.createDataChannels(this.store.uid,r),r.forEach(s=>{this.localDataChannels.push(s);const a=Date.now();this.store.publish(s.id+"","datachannel",void 0,a)}),t.map(s=>({streamId:s.id,ordered:s.ordered,maxRetransmits:s.maxRetransmits,metadata:s.metadata,channelId:s._originDataChannelId})))}publish(t,r,s){var a=this;return Il(function*(){const c=yield Nn(a.mutex.lock("From P2PChannel.publish"));try{var u;const h=a.connection&&ot(u=["disconnected","failed"]).call(u,a.connection.peerConnectionState);if(!a.connection||a.state!==Yn.Connected||h){if(a.state===Yn.Disconnected)throw new Me(te.UNEXPECTED_ERROR,"PeerConnection already disconnected.");a.throwIfTrackTypeNotMatch(t);const y=t.filter(v=>a.pendingLocalTracks.indexOf(v)===-1);return a.pendingLocalTracks=a.pendingLocalTracks.concat(y),void(h&&(a._isWaitPcToRePub=!0))}a.store.pubId=a.store.pubId+1,Ws.markPublishStart(a.store.clientId,a.store.pubId);const m=a.filterTobePublishedTracks(t,r,s);if(m.length===0)return void(yield Nn(a.tryToUnmuteAudio(t)));yield*VA(B9(a.doPublish(a.connection,m)))}finally{c()}})()}doPublish(t,r){var s=this;return Il(function*(){r.forEach(P=>{let{track:D,type:G}=P;const F=Date.now();s.store.publish(D.getTrackId(),G===Ke.LocalAudioTrack?"audio":"video",F)}),s.bindLocalTrackEvents(r);const a=r.map(P=>{let{track:D}=P;return D}),c=yield Nn(t.send(a,s.store.codec,s.store.audioCodec)),u=(yield Nn(c.next())).value,h=s.createGatewayPublishMessage(r,u);let m;try{m=yield h}catch(P){throw c.throw(P),(P==null?void 0:P.code)===te.WS_ABORT&&r.forEach(D=>{let{track:G}=D;s.pendingLocalTracks.indexOf(G)===-1&&s.pendingLocalTracks.push(G)}),s.unbindLocalTrackEvents(r),P}const y=s.mapPubResToRemoteConfig(h,m,a),v=(yield Nn(c.next(y))).value;if(s.state===Yn.Disconnected)throw new Me(te.UNEXPECTED_ERROR,"PeerConnection already disconnected.");oe("ENABLE_VIDEO_SEI");const S=oe("ENABLE_ENCODED_TRANSFORM"),R=oe("ENABLE_AUDIO_METADATA");a.forEach(async P=>{const D=P.getRTCRtpTransceiver();if(!D||!S)return;const{interceptLocalVideoFrame:G,interceptLocalAudioFrame:F}=NP();P.trackMediaType===Et.VIDEO?await G(D.sender,P):P.trackMediaType===Et.AUDIO&&await F(D.sender,{metadata:R?()=>{const j=P.metadata.shift();return j&&j.value}:void 0})}),r.forEach(P=>{let{type:D}=P;s.statsCollector.addLocalStats(D)}),s.assignLocalTracks(r,v),s.statsUploader.startUploadOutboundStats(),r.forEach(P=>{let{track:D,type:G}=P;const F=Date.now();s.store.publish(D.getTrackId(),G===Ke.LocalAudioTrack?"audio":"video",void 0,F)})})()}async updateVideoStreamParameter(t,r){const s=this.localTrackMap.get(r);if(!s||!this.connection)return;if(!(s.track instanceof Tr))return x.warn("[updateVideoStreamParameter]: track is not an instance of LocalVideoTrack");const{track:a}=s,c=function(u,h){const m={};return u.height&&u.width&&(m.scaleResolutionDownBy=m2(u,h)),m.maxFramerate=u.framerate?vc(u.framerate):void 0,m.maxBitrate=u.bitrate?1e3*u.bitrate:void 0,m}(t,a);if(a._encoderConfig||(a._encoderConfig={}),r!==Ke.LocalVideoLowTrack||!oe("DISABLE_DUAL_STREAM_USE_ENCODING")&&jn().supportDualStreamEncoding)c.scaleResolutionDownBy!=null&&(a._encoderConfig.scaleResolutionDownBy=c.scaleResolutionDownBy);else{const u=a._originMediaStreamTrack;if(!u.canvas)return x.warn("[".concat(a.getTrackId(),"] no canvas on track"));(function(h,m){const y=h.canvas;m.width&&(y.width=vc(m.width)),m.height&&(y.height=vc(m.height)),m.framerate&&(y.stopCapture&&y.stopCapture(),y.stopCapture=GL(()=>{!y.startCapture&&y.stopCapture&&y.stopCapture(),y.startCapture&&y.startCapture()},vc(m.framerate)))})(u,t)}c.maxBitrate!=null&&(a._encoderConfig.bitrateMax=c.maxBitrate/1e3),c.maxFramerate!=null&&(a._encoderConfig.frameRate&&typeof a._encoderConfig.frameRate=="object"?a._encoderConfig.frameRate.max=c.maxFramerate:a._encoderConfig.frameRate={max:c.maxFramerate}),x.debug("[".concat(a.getTrackId(),"] LowStreamEncoderConfig: , ").concat(JSON.stringify(a._encoderConfig))),await this.connection.updateRtpSenderEncodings(a)}publishLowStream(t){var r=this;return Il(function*(){if(!r.connection||r.state!==Yn.Connected)return;const s=yield Nn(r.mutex.lock("Locking from P2PChannel.publishLowStream"));try{const c=r.localTrackMap.get(Ke.LocalVideoTrack);if(!c)throw new Me(te.UNEXPECTED_ERROR,"Could not find high stream");if(r.localTrackMap.has(Ke.LocalVideoLowTrack))throw new Me(te.UNEXPECTED_ERROR,"[".concat(r.store.clientId,"] Can't publish low stream when stream already publish"));const u=[{track:r.getLowVideoTrack(c.track,t),type:Ke.LocalVideoLowTrack}];if(yield*VA(B9(r.doPublish(r.connection,u))),c.track.muted||!c.track.enabled){var a;const h=(a=r.localTrackMap.get(Ke.LocalVideoLowTrack))===null||a===void 0?void 0:a.id;h!==void 0&&(yield Nn(r.connection.muteLocal([h])))}}finally{s()}})()}async republish(){this.pendingLocalTracks.length>0&&(x.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await ks(this,xt.RequestRePublish,this.pendingLocalTracks),this.emit(xt.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[]),this.pendingLocalDataChannels.length>0&&(x.debug("Emit P2PChannelEvents.RequestRePublishDataChannel to republish datachannels."),await ks(this,xt.RequestRePublishDataChannel,this.pendingLocalDataChannels),this.pendingLocalDataChannels=[]),this._isWaitPcToRePub=!1}async reSubscribe(t){for(let r=this.pendingRemoteTracks.length-1;r>=0;r--){const{user:s,kind:a}=this.pendingRemoteTracks[r];(a!==Et.AUDIO||s._audio_added_&&s._audioSSRC)&&(a!==Et.VIDEO||s._video_added_&&s._videoSSRC)||this.pendingRemoteTracks.splice(r,1)}if(t)await ks(this,xt.RequestReSubscribe,this.pendingRemoteTracks);else for(const{user:r,kind:s}of this.pendingRemoteTracks)await this.subscribe(r,s,s===Et.VIDEO?r._videoSSRC:r._audioSSRC);this.pendingRemoteTracks.forEach(r=>{let{user:s}=r;this.emit(xt.MediaReconnectEnd,s.uid)}),this.pendingRemoteTracks=[]}async unpublish(t){if(!this.connection||this.state!==Yn.Connected)return void t.forEach(a=>{const c=this.pendingLocalTracks.indexOf(a);c!==-1&&this.pendingLocalTracks.splice(c,1)});const r=this.filterTobeUnpublishedTracks(t);if(r.length===0)return;const s=r.find(a=>a[0]==="videoLowTrack");return s&&s[1].track.close(),this.doUnpublish(this.connection,r)}async unpublishDataChannel(t){if(!this.connection||this.state!==Yn.Connected)return void t.forEach(s=>{const a=this.pendingLocalDataChannels.indexOf(s);a!==-1&&this.pendingLocalDataChannels.splice(a,1)});const r=this.filterTobeUnpublishedDataChannels(t);return r.length!==0?(r.forEach(s=>{const a=this.localDataChannels.indexOf(s);a!==-1&&this.localDataChannels.splice(a,1)}),this.localDataChannels.length===0&&await this.connection.stopDataChannels(this.store.uid),r.map(s=>s.id)):void 0}async unpublishLowStream(){if(!this.connection||this.state!==Yn.Connected)return;const t=this.localTrackMap.get(Ke.LocalVideoLowTrack);if(!t)return;t.track.close();const r=[[Ke.LocalVideoLowTrack,t]];return this.doUnpublish(this.connection,r)}async doUnpublish(t,r){const s=this.createGatewayUnpublishMessage(r);return await t.stopSending(r.map(a=>{let[,{id:c}]=a;return c})),this.withdrawLocalTracks(r),this.unbindLocalTrackEvents(r.map(a=>{let[c,{track:u}]=a;return{type:c,track:u}})),r.forEach(a=>{let[c]=a;this.statsCollector.removeLocalStats(c)}),this.localTrackMap.size===0&&this.statsUploader.stopUploadOutboundStats(),s}async subscribeDataChannel(t,r){if(!this.connection||this.state!==Yn.Connected)throw new Me(te.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");const s=r.filter(a=>{var c;return!((c=this.remoteDataChannelMap.get(t))!==null&&c!==void 0&&c.get(a.id))});if(s.length!==0)return await this.connection.createDataChannels(t.uid,s),s.forEach(a=>{var c;this.remoteDataChannelMap.has(t)?(c=this.remoteDataChannelMap.get(t))===null||c===void 0||c.set(a.id,a):this.remoteDataChannelMap.set(t,new Map([[a.id,a]]));const u=this.pendingRemoteDataChannels.findIndex(h=>{let{user:m,id:y}=h;return m.uid===t.uid&&y===a.id});u!==-1&&this.pendingRemoteDataChannels.splice(u,1)}),s.map(a=>a.id)}async subscribe(t,r,s,a,c){var u;if(!this.connection||this.state!==Yn.Connected)throw new Me(te.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");if((u=this.remoteUserMap.get(t))!==null&&u!==void 0&&u.has(r))return;let h,m,y;const v=this.connection.getPreMedia(s);if(v)x.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] preSSRCMap has ssrcId: ").concat(s,", no need to send sub to gateway.")),y=v.transceiver,h=v.track,m=v.id;else if(c){const P=c.find(G=>{let{stream_type:F}=G;return F===r});if(!P)throw new Me(te.UNEXPECTED_ERROR,"Cannot subscribe to remote ".concat(r," for user: ").concat(t.uid," because subscribe answer from gateway does not contain stream_type: ").concat(r,"."));const D=await this.connection.receive(r,P.ssrcs,String(t._uintid),P.attributes);this.connection instanceof Ph&&(y=D.transceiver),h=D.track,m=D.id}else{const P=await this.connection.receive(r,[{ssrcId:s,rtx:a}],String(t._uintid),void 0);this.connection instanceof Ph&&(y=P.transceiver),h=P.track,m=P.id}if(r===Et.AUDIO?(t._audioTrack?t._audioTrack._updateOriginMediaStreamTrack(h):(t._audioTrack=new rS(h,t.uid,t._uintid,this.store),x.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(t._audioTrack.getTrackId()))),y&&t._audioTrack._updateRtpTransceiver(y),this.bindRemoteTrackEvents(t,t._audioTrack)):(t._videoTrack?t._videoTrack._updateOriginMediaStreamTrack(h):(t._videoTrack=new nS(h,t.uid,t._uintid,this.store),x.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(t._videoTrack.getTrackId()))),y&&t._videoTrack._updateRtpTransceiver(y),this.bindRemoteTrackEvents(t,t._videoTrack)),y&&oe("ENABLE_ENCODED_TRANSFORM")){const{interceptRemoteVideoFrame:P,interceptRemoteAudioFrame:D}=NP();r==Et.VIDEO?await P(y.receiver,{onSei:oe("ENABLE_VIDEO_SEI")&&(G=>{var F;return(F=t._videoTrack)===null||F===void 0?void 0:F._onSei(G)})}):r==Et.AUDIO&&await D(y.receiver,{enableTopn:!!oe("ENABLE_AUDIO_TOPN"),enableMetadata:!!oe("ENABLE_AUDIO_METADATA"),onMetadata:G=>{this.safeEmit(xt.AudioMetadata,G)}})}const S=this.remoteUserMap.get(t);S?S.set(r,m):this.remoteUserMap.set(t,new Map([[r,m]])),this.statsCollector.addRemoteStats(t.uid),this.statsUploader.startUploadInboundStats();const R=this.pendingRemoteTracks.findIndex(P=>{let{user:D,kind:G}=P;return D.uid===t.uid&&r===G});R!==-1&&(this.pendingRemoteTracks.splice(R,1),this.emit(xt.MediaReconnectEnd,t.uid))}async massSubscribe(t){return this.massSubscribeNoLock(t)}async massSubscribeNoLock(t){if(!this.connection||this.state!==Yn.Connected)throw new Me(te.INVALID_OPERATION,"Cannot subscribeAll remote users when peerConnection disconnected.");t=t.filter(c=>{var u;let{user:h,mediaType:m}=c;return!((u=this.remoteUserMap.get(h))!==null&&u!==void 0&&u.has(m))});const r=[],s=new Map;t.forEach(c=>{if(!this.connection)return;const u=this.connection.getPreMedia(c.ssrcId);u?s.set(c.ssrcId,u):r.push(c)});const a=await this.connection.batchReceive(r.map(c=>{let{user:u,mediaType:h,ssrcId:m,rtxSsrcId:y}=c;return{kind:h,ssrcMsg:[{ssrcId:m,rtx:y}],mslabel:String(u._uintid)}}));r.forEach((c,u)=>{s.set(c.ssrcId,a[u])});for(const{user:c,mediaType:u,ssrcId:h}of t){const m=s.get(h);if(!m)return void x.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] cannot find ").concat(c.uid," subscribe data,").concat(u,", ").concat(h));const{track:y,id:v,transceiver:S}=m;if(S&&oe("ENABLE_ENCODED_TRANSFORM")){const{interceptRemoteVideoFrame:D,interceptRemoteAudioFrame:G}=NP();u==Et.VIDEO?await D(S.receiver,{onSei:oe("ENABLE_VIDEO_SEI")&&(F=>{var j;return(j=c._videoTrack)===null||j===void 0?void 0:j._onSei(F)})}):u==Et.AUDIO&&await G(S.receiver,{enableTopn:!!oe("ENABLE_AUDIO_TOPN"),enableMetadata:!!oe("ENABLE_AUDIO_METADATA"),onMetadata:F=>{this.safeEmit(xt.AudioMetadata,F)}})}if(u===Et.AUDIO?(c._audioTrack?c._audioTrack._updateOriginMediaStreamTrack(y):(c._audioTrack=new rS(y,c.uid,c._uintid,this.store),x.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(c._audioTrack.getTrackId()))),S&&c._audioTrack._updateRtpTransceiver(S),this.bindRemoteTrackEvents(c,c._audioTrack)):(c._videoTrack?c._videoTrack._updateOriginMediaStreamTrack(y):(c._videoTrack=new nS(y,c.uid,c._uintid,this.store),x.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(c._videoTrack.getTrackId()))),S&&c._videoTrack._updateRtpTransceiver(S),this.bindRemoteTrackEvents(c,c._videoTrack)),oe("ENABLE_VIDEO_SEI")&&S){const{interceptRemoteVideoFrame:D,interceptRemoteAudioFrame:G}=NP();u==Et.VIDEO?await D(S.receiver,{onSei:F=>{var j;(j=c._videoTrack)===null||j===void 0||j._onSei(F)}}):u==Et.AUDIO&&await G(S.receiver)}const R=this.remoteUserMap.get(c);R?R.set(u,v):this.remoteUserMap.set(c,new Map([[u,v]])),this.statsCollector.addRemoteStats(c.uid),this.statsUploader.startUploadInboundStats();const P=this.pendingRemoteTracks.findIndex(D=>{let{user:G,kind:F}=D;return G.uid===c.uid&&u===F});P!==-1&&(this.pendingRemoteTracks.splice(P,1),this.emit(xt.MediaReconnectEnd,c.uid))}}async unsubscribe(t,r,s){const a=this.pendingRemoteTracks.filter(h=>{let{user:m,kind:y}=h;return r!==void 0?m.uid===t.uid&&r===y:m.uid===t.uid});if(a.forEach(h=>{const m=this.pendingRemoteTracks.indexOf(h);this.pendingRemoteTracks.splice(m,1)}),this.connection&&this.state===Yn.Connected||s||a.forEach(h=>{let{kind:m}=h;var y;if(m===Et.AUDIO)(y=t._audioTrack)===null||y===void 0||y._destroy(),t._audioTrack=void 0;else if(m===Et.VIDEO){var v;(v=t._videoTrack)===null||v===void 0||v._destroy(),t._videoTrack=void 0}}),!this.connection||this.state!==Yn.Connected)return;const c=this.filterTobeUnSubscribedTracks(t,r);if(c.length===0)return;await this.connection.stopReceiving(c.map(h=>{let[,{id:m}]=h;return m}));const u=this.createUnsubscribeMessage(c);return this.withdrawRemoteTracks(c),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),c.forEach(h=>{let[m,{kind:y}]=h;var v,S;if(y===Et.VIDEO&&m._videoSSRC&&((v=this.connection)===null||v===void 0||v.setStatsRemoteVideoIsReady(m._videoSSRC,!1)),y===Et.VIDEO)this.unbindRemoteTrackEvents(m._videoTrack),s||((S=m._videoTrack)===null||S===void 0||S._destroy(),m._videoTrack=void 0);else if(y===Et.AUDIO){var R;this.unbindRemoteTrackEvents(m._audioTrack),!s&&((R=m._audioTrack)===null||R===void 0||R._destroy(),m._audioTrack=void 0)}}),u}async unsubscribeDataChannel(t,r){if(r.forEach(c=>{const u=this.pendingRemoteDataChannels.findIndex(h=>h.id===c.id);u!==-1&&this.pendingRemoteDataChannels.splice(u,1)}),!this.connection)return;const s=this.filterTobeUnSubscribedDataChannels(t,r);if(s.length===0)return;r.forEach(c=>{c._close()});const a=this.remoteDataChannelMap.get(t);return s.forEach(c=>{a&&a.delete(c.id)}),a&&a.size===0&&(this.remoteDataChannelMap.delete(t),await this.connection.stopDataChannels(t.uid)),s.map(c=>c.id)}async massUnsubscribe(t){return this.massUnsubscribeNoLock(t)}async massUnsubscribeNoLock(t){let r=[];for(const{user:c,mediaType:u}of t){const h=this.pendingRemoteTracks.filter(m=>{let{user:y,kind:v}=m;return u!==void 0?y.uid===c.uid&&u===v:y.uid===c.uid});h.forEach(m=>{const y=this.pendingRemoteTracks.indexOf(m);this.pendingRemoteTracks.splice(y,1)}),r=r.concat(h)}if(!this.connection||this.state!==Yn.Connected)return void r.forEach(c=>{let{user:u,kind:h}=c;var m;if(h===Et.AUDIO)(m=u._audioTrack)===null||m===void 0||m._destroy(),u._audioTrack=void 0;else if(h===Et.VIDEO){var y;(y=u._videoTrack)===null||y===void 0||y._destroy(),u._videoTrack=void 0}});const s=hc(t).call(t,(c,u)=>{let{user:h,mediaType:m}=u;const y=this.filterTobeUnSubscribedTracks(h,m);return c.concat(y)},[]);if(s.length===0)return;await this.connection.stopReceiving(s.map(c=>{let[,{id:u}]=c;return u}));const a=this.createUnsubscribeAllMessage(s);return this.withdrawRemoteTracks(s),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),s.forEach(c=>{let[u,{kind:h}]=c;var m,y;if(h===Et.VIDEO&&u._videoSSRC&&((m=this.connection)===null||m===void 0||m.setStatsRemoteVideoIsReady(u._videoSSRC,!1)),h===Et.VIDEO)this.unbindRemoteTrackEvents(u._videoTrack),(y=u._videoTrack)===null||y===void 0||y._destroy(),u._videoTrack=void 0;else if(h===Et.AUDIO){var v;this.unbindRemoteTrackEvents(u._audioTrack),(v=u._audioTrack)===null||v===void 0||v._destroy(),u._audioTrack=void 0}}),a}isPreSubScribe(t){return!this.connection||this.state!==Yn.Connected?!1:!!this.connection.getPreMedia(t)}async muteRemote(t,r){if(!this.connection)return;const s=this.remoteUserMap.get(t);if(!s)return void x.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(t.uid,"."));if(!s.get(r))return void x.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(t.uid," media type ").concat(r,"."));const a=r===Et.VIDEO?t._videoSSRC:t._audioSSRC;a!==void 0&&this.connection.setStatsRemoteVideoIsReady(a,!1)}async unmuteRemote(t,r){return this.unmuteRemoteNoLock(t,r)}async unmuteRemoteNoLock(t,r){if(!this.connection)return;const s=this.remoteUserMap.get(t);if(!s)return void x.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(t.uid,"."));s.get(r)||x.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(t.uid," media type ").concat(r,"."))}addAudioMetadata(t){const r=this.localTrackMap.get(Ke.LocalAudioTrack),s=r&&r.track;s&&s.metadata.push(t)}getAllTracks(t){const r=this.localTrackMap.get(Ke.LocalAudioTrack);if((r==null?void 0:r.track)instanceof Fi){const s=r.track;return Array.from(this.localTrackMap.entries()).filter(a=>{let[c]=a;return c!==Ke.LocalAudioTrack}).filter(a=>{let[c]=a;return!(t&&c===Ke.LocalVideoLowTrack)}).map(a=>{let[,{track:c}]=a;return c}).concat(s.trackList)}return Array.from(this.localTrackMap.entries()).filter(s=>{let[a]=s;return!(t&&a===Ke.LocalVideoLowTrack)}).map(s=>{let[,{track:a}]=s;return a})}getAllDataChannels(){return this.localDataChannels}reportPublishEvent(t,r,s,a,c){if(t){const h=this.localTrackMap.get(Ke.LocalAudioTrack),m=a?this.localTrackMap.get(Ke.LocalVideoLowTrack):this.localTrackMap.get(Ke.LocalVideoTrack);At.publish(this.store.sessionId,{eventElapse:Ws.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:t,ec:r,audioName:h==null?void 0:h.track.getTrackLabel(),videoName:m==null?void 0:m.track.getTrackLabel(),screenshare:(m==null?void 0:m.track._hints.indexOf(pr.SCREEN_TRACK))!==-1,audio:!!h,video:!!m,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:c})}else{var u;s||(s=[]);const h=s.find(y=>y instanceof Xr),m=a?(u=this.localTrackMap.get(Ke.LocalVideoTrack))===null||u===void 0?void 0:u.track:s.find(y=>y instanceof Tr);At.publish(this.store.sessionId,{eventElapse:Ws.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:t,ec:r,audioName:h==null?void 0:h.getTrackLabel(),videoName:m==null?void 0:m.getTrackLabel(),screenshare:(m==null?void 0:m._hints.indexOf(pr.SCREEN_TRACK))!==-1,audio:!!h,video:!!m,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:c})}}reportSubscribeEvent(t,r,s,a){const c=a===Et.VIDEO?s._videoSSRC:s._audioSSRC;c&&At.subscribe(this.store.sessionId,{succ:t,ec:r,video:a===Et.VIDEO,audio:a===Et.AUDIO,peerid:s.uid,subscribeRequestid:c,p2pid:this.store.p2pId,eventElapse:Ws.measureFromSubscribeStart(this.store.clientId,c),preSsrc:this.isPreSubScribe(c)})}reset(){x.debug("[".concat(this.store.clientId,"] P2PChannel.reset")),this.mutex=new Fs("P2PChannel-mutex",this.store.clientId),this.connection&&(this.resetConnection(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=FP(this.store),this.emit(xt.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.statsUploader.stopUploadBaseStats(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const t=this.localTrackMap.get(Ke.LocalAudioTrack);if((t==null?void 0:t.track)instanceof Fi){if(t.track.trackList.length>0){const r=t.track;t.track.trackList.forEach(s=>{r.removeAudioTrack(s)})}t.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.iceFailedCount=0,this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.localDataChannels=[],this.remoteDataChannelMap.clear(),this.pendingLocalDataChannels=[],this.pendingRemoteDataChannels=[],this.state=Yn.Disconnected}getStats(){var t;return(t=this.connection)===null||t===void 0?void 0:t.getStats()}getRemoteVideoIsReady(t){var r;return((r=this.connection)===null||r===void 0?void 0:r.getRemoteVideoIsReady(t))||!1}getLocalAudioVolume(){const t=this.localTrackMap.get(Ke.LocalAudioTrack);if(t)return t.track.getVolumeLevel()}getLocalVideoSize(){const t=this.localTrackMap.get(Ke.LocalVideoTrack);if(t)return{width:t.track.videoWidth||0,height:t.track.videoHeight||0}}getEncoderConfig(t){const r=this.localTrackMap.get(t);return r&&r.track instanceof Tr||r&&r.track instanceof Xr?r.track._encoderConfig:void 0}getLocalMedia(t){return this.localTrackMap.get(t)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(t,r){if(!t)return this.remoteUserMap.size>0;const s=this.remoteUserMap.get(t);return!!s&&(!r||s.has(r))}async hasRemoteMediaWithLock(t,r){if(!t)return this.remoteUserMap.size>0;const s=this.remoteUserMap.get(t);return!!s&&(!r||s.has(r))}getRemoteMedia(t){var r;const s=Array.from(Yc(r=this.remoteUserMap).call(r)).find(a=>a.uid===t);return s?{audioTrack:s.audioTrack,audioSSRC:s._audioSSRC,videoTrack:s.videoTrack,videoSSRC:s._videoSSRC}:{}}getAudioLevels(){let t=Array.from(this.remoteUserMap.entries()).map(s=>{let[a]=s;return{uid:a.uid,level:a.audioTrack?100*a.audioTrack._source.getAccurateVolumeLevel():0}});const r=this.localTrackMap.get(Ke.LocalAudioTrack);return r&&t.push({level:100*r.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),t=pT(t).call(t,(s,a)=>s.level-a.level),t}async disconnectForReconnect(){this.connection&&(x.debug("[".concat(this.store.clientId,"] P2PChannel.disconnectForReconnect closing P2PConnection")),this.state=Yn.Reconnecting,oe("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(t=>{let[r]=t;var s;r._videoTrack&&r._videoTrack._player&&((s=r._videoTrack._player.getVideoElement())===null||s===void 0||s.pause(),r._videoTrack._player.isKeepLastFrame=!0,r._videoTrack._originMediaStreamTrack.stop())}),this.resetConnection(this.connection),this.connection=void 0,this.shouldForwardP2PCreation&&(this.connection=FP(this.store),this.emit(xt.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(t=>{var r;let[s,{track:a}]=t;switch(s){case Ke.LocalVideoTrack:ot(r=a._hints).call(r,pr.LOW_STREAM)?a.close():this.pendingLocalTracks.push(a);break;case Ke.LocalAudioTrack:a instanceof Fi?this.pendingLocalTracks=this.pendingLocalTracks.concat(a.trackList):this.pendingLocalTracks.push(a);case Ke.LocalVideoLowTrack:}}),this.emit(xt.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(t=>{let[r,s]=t;Array.from(Yc(s).call(s)).forEach(a=>{this.setPendingRemoteMedia(r,a)}),this.emit(xt.MediaReconnectStart,r.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.localDataChannels.length!==0&&(this.localDataChannels.forEach(t=>{this.pendingLocalDataChannels.push(t)}),this.localDataChannels.length=0),this.remoteDataChannelMap.size!==0&&(Array.from(this.remoteDataChannelMap.entries()).forEach(t=>{let[r,s]=t;Array.from(Yc(s).call(s)).forEach(a=>{this.setPendingRemoteDataChannel(r,a)})}),this.remoteDataChannelMap.clear()),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),x.debug("[".concat(this.store.clientId,"] P2PChannel disconnected, waiting to reconnect.")))}hasPendingRemoteDataChannel(t,r){for(const s of this.pendingRemoteDataChannels){const{user:a,id:c}=s;if((t instanceof Zm?t.uid:t)===a.uid&&c===r)return!0}return!1}setPendingRemoteDataChannel(t,r){this.hasPendingRemoteDataChannel(t,r)||this.pendingRemoteDataChannels.push({user:t,id:r})}hasPendingRemoteMedia(t,r){for(const s of this.pendingRemoteTracks){const{user:a,kind:c}=s;if((t instanceof Zm?t.uid:t)===a.uid&&r===c)return!0}return!1}setPendingRemoteMedia(t,r){this.hasPendingRemoteMedia(t,r)||this.pendingRemoteTracks.push({user:t,kind:r})}restartICE(t){var r=this;return Il(function*(){if(!r.connection||r.state!==Yn.Connected)return;const s=yield Nn(r.mutex.lock("From P2PChannel.restartICE"));let a;try{a=yield Nn(r.connection.restartICE(t));const u=yield Nn(a.next());if(u.done)return;const h=u.value,m=yield h;switch(N2(r.connection)&&r.reportPCStats(Date.now(),!1,r._pcStatsUploadType),t){case Bs.UDP_TCP_RELAY:r._pcStatsUploadType=dp.UDP_TCP_RESTART;break;case Bs.TCP_RELAY:r._pcStatsUploadType=dp.TCP_RESTART;break;case Bs.RELAY:r._pcStatsUploadType=dp.RELAY_RESTART;break;default:r._pcStatsUploadType=dp.OLD_RESTART}r._isTryConnecting=!0,a.next(m)}catch(u){var c;(c=a)===null||c===void 0||c.throw(u)}finally{s()}})()}getUplinkNetworkQuality(){if(!this.connection)return 0;const t=this.connection.getStats(),r=this.localTrackMap.get(Ke.LocalVideoTrack),s=this.localTrackMap.get(Ke.LocalAudioTrack),a=t.videoSend.find(D=>D.ssrc===(r==null?void 0:r.ssrcs[0].ssrcId)),c=t.audioSend.find(D=>D.ssrc===(s==null?void 0:s.ssrcs[0].ssrcId));if(!a||!c)return 1;const u=Kc(this,xt.NeedSignalRTT),h=a?a.rttMs:void 0,m=c?c.rttMs:void 0,y=h&&m?(h+m)/2:h||m,v=(y&&u?(y+u)/2:y||u)||0,S=100*t.sendPacketLossRate*.7/50+.3*v/1500,R=S<.17?1:S<.36?2:S<.59?3:S<.1?4:5,P=r==null?void 0:r.track;if(P&&P._encoderConfig&&P._hints.indexOf(pr.SCREEN_TRACK)===-1){const D=P._encoderConfig.bitrateMax,G=t.bitrate.actualEncoded;if(D&&G){const F=(1e3*D-G)/(1e3*D);return SH[F<.15?0:F<.3?1:F<.45?2:F<.6?3:4][R]}}return R}getDownlinkNetworkQuality(){if(!this.connection)return 0;const t=this.connection.getStats();let r=0;return Array.from(this.remoteUserMap.entries()).forEach(s=>{let[a]=s;const c=a._audioSSRC,u=a._videoSSRC,h=t.audioRecv.find(G=>G.ssrc===c),m=t.videoRecv.find(G=>G.ssrc===u);if(!h&&!m)return void(r+=1);const y=Kc(this,xt.NeedSignalRTT),v=t.rtt,S=(v&&y?(v+y)/2:v||y)||0,R=h?h.jitterMs:void 0,P=t.recvPacketLossRate;let D=.7*P*100/50+.3*S/1500;R&&(D=.6*P*100/50+.2*S/1500+.2*R/400),r+=D<.1?1:D<.17?2:D<.36?3:D<.59?4:5}),this.remoteUserMap.size>0?Math.round(r/this.remoteUserMap.size):r}async muteLocalTrack(t){return new dt((r,s)=>{this.handleMuteLocalTrack(t,r,s)})}async replaceTrack(t,r){var s;if(x.debug("[".concat(this.store.clientId,"] P2PChannel replaceTrack from [").concat(t.getTrackId(),"] to [").concat(r.getTrackId(),"]")),!this.connection||this.state!==Yn.Connected)return;const a=Array.from(this.localTrackMap.entries()).find(u=>{let[,{track:h}]=u;return t===h});if(!a)return;const c=a[0];if(t!==r&&(this.unbindLocalTrackEvents([{track:t,type:c}]),this.bindLocalTrackEvents([{track:r,type:c}]),a[1].track=r),await((s=this.connection)===null||s===void 0?void 0:s.replaceTrack(r,a[1].id)),this.isPlanB){const u=a[1];u.id=r._mediaStreamTrack.id,this.localTrackMap.set(c,u)}if(c===Ke.LocalVideoTrack&&!oe("DISABLE_DUAL_STREAM_USE_ENCODING")&&jn().supportDualStreamEncoding){const u=this.localTrackMap.get(Ke.LocalVideoLowTrack);if(u){const h=t._mediaStreamTrack.clone();u.track._originMediaStreamTrack.stop(),u.track._mediaStreamTrack=h,u.track._originMediaStreamTrack=h,await new dt((m,y)=>{this.handleReplaceTrack(u.track,m,y,!0)})}}}filterTobePublishedTracks(t,r,s){const a=[],c=this.getAllTracks();t=zv(t=t.filter(y=>c.indexOf(y)===-1));let u,h=!1;const m=this.localTrackMap.get(Ke.LocalAudioTrack);for(const y of t){if(y instanceof Tr&&(this.localTrackMap.has(Ke.LocalVideoTrack)||h?new Me(te.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(a.push({track:y,type:Ke.LocalVideoTrack}),h=!0),r)){const v=this.getLowVideoTrack(y,s);a.push({track:v,type:Ke.LocalVideoLowTrack})}if(y instanceof Xr)if(m){const v=m.track;if(v instanceof Fi)O2([y]),v.addAudioTrack(y),this.bindLocalAudioTrackEvents(y,!0);else{const S=k2([v,y]);x.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(S.getTrackId(),"]")),this.replaceTrack(v,S)}}else u instanceof Fi?(O2([y]),u.addAudioTrack(y)):u||!y._useAudioElement&&jn().webAudioMediaStreamDest&&!y._bypassWebAudio?u=k2(u?[y,u]:[y]):u=y}return u&&(x.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will send audioTrack [").concat(u.getTrackId(),"]")),a.push({track:u,type:Ke.LocalAudioTrack})),a}filterTobeUnpublishedTracks(t){const r=[],s=this.getAllTracks();t=zv(t=t.filter(a=>s.indexOf(a)!==-1));for(const a of t){if(a instanceof Xr){const c=this.localTrackMap.get(Ke.LocalAudioTrack);if(!c)continue;c.track instanceof Fi?(c.track.removeAudioTrack(a),this.unbindLocalAudioTrackEvents(a),c.track.trackList.length===0&&(r.push([Ke.LocalAudioTrack,c]),c.track.close())):r.push([Ke.LocalAudioTrack,c])}if(a instanceof Tr){const c=this.localTrackMap.get(Ke.LocalVideoTrack);if(!c)continue;r.push([Ke.LocalVideoTrack,c]);const u=this.localTrackMap.get(Ke.LocalVideoLowTrack);u&&r.push([Ke.LocalVideoLowTrack,u])}}return r}filterTobePublishedDataChannels(t){return t=(t=zv(t)).filter(r=>this.localDataChannels.findIndex(s=>s.id===r.id)===-1)}filterTobeUnpublishedDataChannels(t){return t=(t=(t=zv(t)).filter(r=>this.localDataChannels.indexOf(r)!==-1)).filter(r=>r._originDataChannel)}bindLocalTrackEvents(t){t.forEach(r=>{let{track:s,type:a}=r;switch(a){case Ke.LocalVideoTrack:s.addListener(Tt.GET_STATS,this.handleGetLocalVideoStats),s.addListener(Tt.GET_RTC_STATS,this.handleGetRTCStats),s.addListener(Tt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),s.addListener(Tt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),s.addListener(Tt.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),s.addListener(Tt.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),s.addListener(Tt.NEED_REPLACE_TRACK,this.handleReplaceTrack),s.addListener(Tt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),s.addListener(Tt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Ke.LocalAudioTrack:this.bindLocalAudioTrackEvents(s);case Ke.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(t,r){t instanceof Fi?t.trackList.forEach(s=>{s.addListener(Tt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),s.addListener(Tt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),s.addListener(Tt.GET_STATS,this.handleGetLocalAudioStats),s.addListener(Tt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),s.addListener(Tt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(t.addListener(Tt.GET_STATS,this.handleGetLocalAudioStats),t.addListener(Tt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.addListener(Tt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.addListener(Tt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.addListener(Tt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),r||(t.addListener(Tt.NEED_REPLACE_TRACK,this.handleReplaceTrack),t.addListener(Tt.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack)))}unbindLocalTrackEvents(t){t||(t=Array.from(this.localTrackMap.entries()).map(r=>{let[s,{track:a}]=r;return{track:a,type:s}})),t.forEach(r=>{let{track:s,type:a}=r;switch(a){case Ke.LocalVideoTrack:s.off(Tt.GET_STATS,this.handleGetLocalVideoStats),s.off(Tt.GET_RTC_STATS,this.handleGetRTCStats),s.off(Tt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),s.off(Tt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),s.off(Tt.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),s.off(Tt.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),s.off(Tt.NEED_REPLACE_TRACK,this.handleReplaceTrack),s.off(Tt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),s.off(Tt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Ke.LocalAudioTrack:this.unbindLocalAudioTrackEvents(s);case Ke.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(t){t instanceof Fi?t.trackList.forEach(r=>{r.off(Tt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),r.off(Tt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),r.off(Tt.GET_STATS,this.handleGetLocalAudioStats),r.off(Tt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),r.off(Tt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(t.off(Tt.GET_STATS,this.handleGetLocalAudioStats),t.off(Tt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(Tt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(Tt.NEED_REPLACE_TRACK,this.handleReplaceTrack),t.off(Tt.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack),t.off(Tt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(Tt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(t,r){r instanceof nS&&r.addListener(Tt.GET_STATS,s=>{s(this.handleGetRemoteVideoStats(t))}),r instanceof rS&&r.addListener(Tt.GET_STATS,s=>{s(this.handleGetRemoteAudioStats(t))})}unbindRemoteTrackEvents(t){t&&t.removeAllListeners(Tt.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(t=>{let[r,s]=t;s.has(Et.AUDIO)&&this.unbindRemoteTrackEvents(r._audioTrack),s.has(Et.VIDEO)&&this.unbindRemoteTrackEvents(r._videoTrack)})}createGatewayPublishMessage(t,r){return t.map((s,a)=>{var c;let u,h,{track:m,type:y}=s;switch(y){case Ke.LocalAudioTrack:u=Xn.Audio,h={dtx:m instanceof dP&&m._config.DTX,hq:!1,lq:!1,stereo:!1,speech:!1};break;case Ke.LocalVideoTrack:u=ot(c=m._hints).call(c,pr.SCREEN_TRACK)?Xn.Screen:Xn.High,h=kh(kh({},FH(m)),{},{codec:this.store.codec,svc_mode:IP()});break;case Ke.LocalVideoLowTrack:u=Xn.Low,h=kh(kh({},FH(m)),{},{codec:this.store.codec,svc_mode:IP()})}return{stream_type:u,attributes:h,ssrcs:r[a]}})}createGatewayUnpublishMessage(t){return t.map(r=>{var s;let a,[c,{track:u,ssrcs:h,id:m}]=r;switch(c){case Ke.LocalVideoTrack:a=ot(s=u._hints).call(s,pr.SCREEN_TRACK)?Xn.Screen:Xn.High;break;case Ke.LocalAudioTrack:a=Xn.Audio;break;case Ke.LocalVideoLowTrack:a=Xn.Low}return{stream_type:a,ssrcs:h,mid:m}})}assignLocalTracks(t,r){t.forEach((s,a)=>{let{track:c,type:u}=s;this.localTrackMap.set(u,{track:c,id:r[a].id,ssrcs:r[a].localSSRC})})}withdrawLocalTracks(t){t.forEach(r=>{let[s]=r;this.localTrackMap.delete(s)})}bindConnectionEvents(t){t.onConnectionStateChange=async r=>{if(x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onConnectionStateChange(").concat(r,")")),this.emit(xt.PeerConnectionStateChange,r),r==="connecting"&&t instanceof Ph&&!zr()&&oe("FIRST_TCP_CANDIDATE")&&window.setTimeout(()=>{r==="connecting"&&t.extendCandidate()},oe("FIRST_TCP_CANDIDATE_INTERVAL")),r!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),r==="connected"&&(this._restartTimer&&(window.clearTimeout(this._restartTimer),this._restartTimer=void 0),t instanceof Ph&&V9(t,!0),this._isTryConnecting&&this.reportPCStats(Date.now(),!0,this._pcStatsUploadType),this._isTryConnecting=!1,this._isStartRestartIce=!1,this._pcStatsUploadType=dp.DISCONNECTED_OR_FAILED,Kc(this,xt.QueryClientConnectionState)==="CONNECTED"&&this._isWaitPcToRePub)){const s=this.pendingLocalTracks.map(c=>c.getTrackId()),a=this.pendingLocalDataChannels.map(c=>"dc_".concat(c.id));At.reportApiInvoke(this.store.sessionId,{name:Oi.REPUB_AFTER_PC_CONNECTED,options:s.concat(a),tag:Hr.TRACER}).onSuccess(),this.republish()}if(oe("NEW_ICE_RESTART")&&t instanceof Ph&&!zr()&&!this._forceTurn){if(ot(NH).call(NH,r)){if(this._isStartRestartIce)return;this._isStartRestartIce=!0;const s=c=>{N2(t)&&(x.debug("[".concat(this.store.clientId,"] [P2PChannel] try to restartICE, type is ").concat(c)),Kc(this,xt.QueryClientConnectionState)==="CONNECTED"&&this.emit(xt.RequestRestartICE,c))},a=()=>{N2(t)&&(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),x.debug("[".concat(this.store.clientId,"] P2PConnection disconnected timeout, force reconnect")),setTimeout(()=>this.emit(xt.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())};return void(this._restartTimer=window.setTimeout(()=>{F9(t,s,a)},800))}}else{if(r==="disconnected"&&t.iceConnectionState==="disconnected")return setTimeout(()=>{t.iceConnectionState==="disconnected"&&oe("ICE_RESTART")&&Kc(this,xt.QueryClientConnectionState)==="CONNECTED"&&this.emit(xt.RequestRestartICE)},800),void setTimeout(()=>{t.peerConnectionState==="disconnected"&&(x.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection disconnected timeout 4000ms, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isTryConnecting=!1,setTimeout(()=>this.emit(xt.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())},4e3);r==="failed"&&(x.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection state failed, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),setTimeout(()=>this.emit(xt.P2PLost),0),this.iceFailedCount+=1,await this.requestReconnect())}},t.onICEConnectionStateChange=r=>{r!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(r,")")),At.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:r,tag:Hr.TRACER}).onSuccess(),this.emit(xt.IceConnectionStateChange,r)},t.onICETransportStateChange=r=>{x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(r,")"))},t.onDTLSTransportStateChange=r=>{x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(r,")"))},t.onDTLSTransportError=r=>{x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(r,")"))},t.onFirstAudioDecoded=r=>{var s;const a=Array.from(Yc(s=this.remoteUserMap).call(s)).find(u=>u._audioSSRC===r);var c;a&&(this.store.subscribe(a.uid,"audio",void 0,void 0,void 0,Date.now()),(c=a.audioTrack)===null||c===void 0||c.emit(Jv.FIRST_FRAME_DECODED),At.firstRemoteFrame(this.store.sessionId,Zi.FIRST_AUDIO_DECODE,xr.FIRST_AUDIO_DECODE,{peer:a._uintid,subscribeElapse:Ws.measureFromSubscribeStart(this.store.clientId,r),subscribeRequestid:r,p2pid:this.store.p2pId}))},t.onFirstAudioReceived=r=>{var s;const a=Array.from(Yc(s=this.remoteUserMap).call(s)).find(c=>c._audioSSRC===r);a&&At.firstRemoteFrame(this.store.sessionId,Zi.FIRST_AUDIO_RECEIVED,xr.FIRST_AUDIO_RECEIVED,{peer:a._uintid,subscribeElapse:Ws.measureFromSubscribeStart(this.store.clientId,r),subscribeRequestid:r,p2pid:this.store.p2pId})},t.onFirstVideoDecoded=(r,s,a)=>{this.reportVideoFirstFrameDecoded(r,s,a)},t.onFirstVideoReceived=r=>{var s;const a=Array.from(Yc(s=this.remoteUserMap).call(s)).find(c=>c._videoSSRC===r);a&&At.firstRemoteFrame(this.store.sessionId,Zi.FIRST_VIDEO_RECEIVED,xr.FIRST_VIDEO_RECEIVED,{peer:a._uintid,subscribeElapse:Ws.measureFromSubscribeStart(this.store.clientId,r),subscribeRequestid:r,p2pid:this.store.p2pId})},t.onSelectedLocalCandidateChanged=(r,s)=>{const a=r.candidateType==="relay",c=s.candidateType==="relay";s.candidateType!=="unknown"&&a===c||this.emit(xt.ConnectionTypeChange,a),x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(Xm(s))," -> ").concat(JSON.stringify(Xm(r)),")"))},t.onSelectedRemoteCandidateChanged=(r,s)=>{x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(Xm(s))," -> ").concat(JSON.stringify(Xm(r)),")"))},t.onFirstVideoDecodedTimeout=r=>{this.reportVideoFirstFrameDecoded(r,void 0,void 0,!0)},t.getLocalVideoStats=()=>{const r=this.statsCollector.getLocalVideoTrackStats(),s=this.statsCollector.getRTCStats();return kh(kh({},r),s)},t.onICECandidateError=r=>{this._iceError=r}}resetConnection(t){t instanceof Ph&&function(r){gS.delete(r.id),V9(r)}(t),t.close(),this.emit(xt.PeerConnectionStateChange,"closed"),function(r){r.onConnectionStateChange=void 0,r.onICEConnectionStateChange=void 0,r.onICETransportStateChange=void 0,r.onDTLSTransportStateChange=void 0,r.onDTLSTransportError=void 0,r.onFirstAudioDecoded=void 0,r.onFirstAudioReceived=void 0,r.onFirstVideoDecoded=void 0,r.onFirstVideoReceived=void 0,r.onSelectedLocalCandidateChanged=void 0,r.onSelectedRemoteCandidateChanged=void 0,r.onFirstVideoDecodedTimeout=void 0,r.getLocalVideoStats=void 0}(t),this._isWaitPcToRePub=!1}filterTobeMutedTracks(t){const r=[];if(this.getAllTracks().indexOf(t)===-1)return r;const s=this.localTrackMap.get(Ke.LocalAudioTrack);if(t instanceof Xr&&(s==null?void 0:s.track)instanceof Fi)return s.track.isActive||r.push([Ke.LocalAudioTrack,s]),r;const a=Array.from(this.localTrackMap.entries()).find(c=>{let[,{track:u}]=c;return t===u});if(a&&(r.push(a),a[0]===Ke.LocalVideoTrack)){const c=this.localTrackMap.get(Ke.LocalVideoLowTrack);c&&r.push([Ke.LocalVideoLowTrack,c])}return r}filterTobeUnmutedTracks(t){const r=[],s=this.localTrackMap.get(Ke.LocalAudioTrack);if(t instanceof Xr&&(s==null?void 0:s.track)instanceof Fi)return s.track.isActive&&r.push([Ke.LocalAudioTrack,s]),r;const a=Array.from(this.localTrackMap.entries()).find(c=>{let[,{track:u}]=c;return t===u});if(a)if(a[0]===Ke.LocalVideoTrack){r.push(a);const c=this.localTrackMap.get(Ke.LocalVideoLowTrack);c&&r.push([Ke.LocalVideoLowTrack,c])}else r.push(a);return r}createMuteMessage(t){return t.map(r=>{var s;let a,[c,{track:u,ssrcs:h,id:m}]=r;switch(c){case Ke.LocalAudioTrack:a=Xn.Audio;break;case Ke.LocalVideoTrack:a=ot(s=u._hints).call(s,pr.SCREEN_TRACK)?Xn.Screen:Xn.High;break;case Ke.LocalVideoLowTrack:a=Xn.Low}return{stream_type:a,ssrcs:h,mid:m}})}createUnmuteMessage(t){return t.map(r=>{var s;let a,[c,{track:u,ssrcs:h,id:m}]=r;switch(c){case Ke.LocalAudioTrack:a=Xn.Audio;break;case Ke.LocalVideoTrack:a=ot(s=u._hints).call(s,pr.SCREEN_TRACK)?Xn.Screen:Xn.High;break;case Ke.LocalVideoLowTrack:a=Xn.Low}return{stream_type:a,ssrcs:h,mid:m}})}filterTobeUnSubscribedTracks(t,r){const s=[],a=this.remoteUserMap.get(t);if(!a)return s;if(r){const c=a.get(r);if(!c)return s;s.push([t,{kind:r,id:c}])}else Array.from(a.entries()).forEach(c=>{let[u,h]=c;s.push([t,{kind:u,id:h}])});return s}filterTobeUnSubscribedDataChannels(t,r){const s=[];return r.forEach(a=>{var c;(c=this.remoteDataChannelMap.get(t))!==null&&c!==void 0&&c.has(a.id)&&s.push(a)}),s}createUnsubscribeMessage(t){const r=[];return t.forEach(s=>{let[a,{kind:c,id:u}]=s;switch(c){case Et.VIDEO:return void(a._videoSSRC&&r.push({stream_type:Et.VIDEO,ssrcId:a._videoSSRC}));case Et.AUDIO:return void(a._audioSSRC&&r.push({stream_type:Et.AUDIO,ssrcId:a._audioSSRC}))}}),r}createUnsubscribeAllMessage(t){const r=new Map;return t.forEach(s=>{let[a,{kind:c}]=s;if(r.has(a)){let u=r.get(a);c===Et.VIDEO?u|=es.Video:u|=es.Audio,r.set(a,u)}else c===Et.VIDEO?r.set(a,es.Video):r.set(a,es.Audio)}),{users:Array.from(r.entries()).map(s=>{let[a,c]=s;return{stream_id:a.uid,stream_type:c}})}}withdrawRemoteTracks(t){t.forEach(r=>{let[s,{kind:a}]=r;const c=this.remoteUserMap.get(s);c&&(c.delete(a),Array.from(c.entries()).length===0&&this.remoteUserMap.delete(s))})}async updateBitrateLimit(t){const r=this.localTrackMap.get(Ke.LocalVideoTrack),s=this.localTrackMap.get(Ke.LocalVideoLowTrack);r&&(await r.track.setBitrateLimit(t.uplink),await new dt((a,c)=>{this.handleUpdateVideoEncoder(r.track,a,c,!0)})),s&&t.low_stream_uplink&&(await s.track.setBitrateLimit({max_bitrate:t.low_stream_uplink.bitrate,min_bitrate:t.low_stream_uplink.bitrate||0}),await new dt((a,c)=>{this.handleUpdateVideoEncoder(s.track,a,c,!0)}))}isP2PDisconnected(){return this.connection?this.connection.peerConnectionState!=="connected":!0}mapPubResToRemoteConfig(t,r,s){return t.map((a,c)=>{var u;let{stream_type:h}=a;const m=(u=r.find(y=>{let{stream_type:v}=y;return h===v}))===null||u===void 0?void 0:u.attributes;if(m&&oe("DISABLE_SCREEN_SHARE_REMB")){const y=s[c]._hints;(ot(y).call(y,pr.SCREEN_TRACK)||ot(y).call(y,pr.SCREEN_LOW_TRACK))&&(m.remb=!1,x.debug("disable remb for screen share, hints:",y))}return m})}async tryToUnmuteAudio(t){for(let s=0;s<t.length;s++)if(t[s]instanceof Xr){var r;const a=this.filterTobeUnmutedTracks(t[s]);if(a.length===0)continue;await((r=this.connection)===null||r===void 0?void 0:r.unmuteLocal(a.map(u=>{let[,{id:h}]=u;return h})));const c=this.createUnmuteMessage(a);return void await hr(this,xt.RequestUnmuteLocal,c)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=()=>this.getStats(),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=t=>{var r;return!((r=this.connection)===null||r===void 0||!r.getRemoteVideoIsReady(t))},this.statsUploader.requestUpload=(t,r)=>this.emit(xt.RequestUpload,t,r),this.statsUploader.requestUploadStats=t=>this.emit(xt.RequestUploadStats,t),this.statsUploader.requestAllTracks=()=>this.getAllTracks(),this.statsUploader.requestTransportStats=()=>{var t;return{connectState:((t=this.connection)===null||t===void 0?void 0:t.peerConnectionState)||"closed"}}}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await ps(wL(this.dtlsFailedCount,ki)),this.emit(xt.RequestReconnect)}async reconnectP2P(){const t=Array.from(this.localTrackMap.entries()),r=this.createGatewayUnpublishMessage(t);Array.from(this.remoteUserMap.entries()),r.length>0&&await ks(this,xt.RequestUnpublishForReconnectPC,r),this.disconnectForReconnect(),this.emit(xt.RequestReconnectPC)}canPublishLowStream(){return this.localTrackMap.has(Ke.LocalVideoTrack)||this.pendingLocalTracks.some(t=>t instanceof Tr)}throwIfTrackTypeNotMatch(t){if(t.filter(r=>r instanceof Tr).length>1)throw new Me(te.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t.filter(r=>r instanceof Xr).length>1&&(t.some(r=>r instanceof Xr&&r._bypassWebAudio)||!jn().webAudioMediaStreamDest))throw new Me(te.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const r of t){if(r instanceof Tr&&this.pendingLocalTracks.some(s=>s instanceof Tr))throw new Me(te.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(r instanceof Xr&&this.pendingLocalTracks.some(s=>s instanceof Xr)&&(!jn().webAudioMediaStreamDest||r._bypassWebAudio||this.pendingLocalTracks.some(s=>s instanceof Xr&&s._bypassWebAudio)))throw new Me(te.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(t,r){var s;const a=!oe("DISABLE_DUAL_STREAM_USE_ENCODING")&&jn().supportDualStreamEncoding,c=kh(kh({},{width:160,height:120,framerate:15,bitrate:50}),r);let u;u=a?t._mediaStreamTrack.clone():D2(t,c);const h=fr(8,"track-low-"),m=new Tr(u,kh(kh({},a&&{scaleResolutionDownBy:m2(c,t)}),{},{frameRate:c.framerate,bitrateMax:c.bitrate,bitrateMin:c.bitrate}),void 0,void 0,h);return m.on(H_.TRANSCEIVER_UPDATED,y=>{t._updateRtpTransceiver(y,Yv.LOW_STREAM)}),m._hints.push(pr.LOW_STREAM),ot(s=t._hints).call(s,pr.SCREEN_TRACK)&&m._hints.push(pr.SCREEN_LOW_TRACK),t.on("sei-to-send",y=>{m.emit("sei-to-send",y)}),t.addListener(Tt.NEED_CLOSE,()=>{m.close()}),m}async globalLock(){return this.mutex.lock("From P2PChannel.globalLock")}async reportPCStats(t,r,s){let a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;if(this.connection&&this.connection instanceof Ph){var c,u,h,m;const y=this.store.keyMetrics.descriptionStart||0,{iceConnectionState:v,dtlsTransportState:S,peerConnectionState:R}=this.connection,{local:P,remote:D}=await this.connection.getSelectedCandidatePair();At.pcStats(this.store.sessionId,{startTime:y,eventElapse:t-y||0,iceconnectionsate:v,dtlsstate:S,connectionstate:R,intSucc:r?1:2,error:this._iceError||a||"",selectedLocalCandidateProtocol:(c=P==null?void 0:P.protocol)!==null&&c!==void 0?c:"",selectedLocalCandidateType:(u=P.candidateType)!==null&&u!==void 0?u:"",selectedLocalCandidateAddress:"".concat(P.address,":").concat(P.port),selectedRemoteCandidateProtocol:(h=D.protocol)!==null&&h!==void 0?h:"",selectedRemoteCandidateType:(m=D.candidateType)!==null&&m!==void 0?m:"",selectedRemoteCandidateAddress:"".concat(D.address,":").concat(D.port),restartCnt:s,preallocation:this.connection.isPreallocation}),this._iceError=null}}reportVideoFirstFrameDecoded(t,r,s,a){var c;const u=Array.from(Yc(c=this.remoteUserMap).call(c)).find(h=>h._videoSSRC===t);if(u){a||this.store.subscribe(u.uid,"video",void 0,void 0,void 0,void 0,Date.now());const h=this.store.keyMetrics,m=h.subscribe.find(y=>y.userId===u.uid&&y.type==="video");At.firstRemoteVideoDecode(this.store.sessionId,Zi.FIRST_VIDEO_DECODE,xr.FIRST_VIDEO_DECODE,{peer:u._uintid,videowidth:r,videoheight:s,subscribeElapse:Ws.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId,apEnd:h.requestAPEnd||0,apStart:h.requestAPStart||0,joinGwEnd:h.joinGatewayEnd||0,joinGwStart:h.joinGatewayStart||0,pcEnd:h.peerConnectionEnd||0,pcStart:h.peerConnectionStart||0,subscriberEnd:(m==null?void 0:m.subscribeEnd)||0,subscriberStart:(m==null?void 0:m.subscribeStart)||0,videoAddNotify:(m==null?void 0:m.streamAdded)||0,state:a?1:0,firstFrame:(m==null?void 0:m.firstFrame)||0})}}async remoteMediaSsrcChanged(t,r,s){if(!this.connection)return!1;const a=this.remoteUserMap.get(t);if(!a)return!1;const c=a.get(r);if(!c)return!1;const u=await this.connection.getRemoteSSRC(c);return u!==void 0&&u!==s}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(t=>{let[r,{track:s}]=t;r===Ke.LocalVideoLowTrack?s._updateRtpTransceiver(void 0,Yv.LOW_STREAM):s._updateRtpTransceiver(void 0)})}},wt(yn.prototype,"startP2PConnection",[vo],Object.getOwnPropertyDescriptor(yn.prototype,"startP2PConnection"),yn.prototype),wt(yn.prototype,"connect",[vo],Object.getOwnPropertyDescriptor(yn.prototype,"connect"),yn.prototype),wt(yn.prototype,"updateRemoteRTPCapabilities",[vo],Object.getOwnPropertyDescriptor(yn.prototype,"updateRemoteRTPCapabilities"),yn.prototype),wt(yn.prototype,"publishDataChannel",[vo],Object.getOwnPropertyDescriptor(yn.prototype,"publishDataChannel"),yn.prototype),wt(yn.prototype,"unpublish",[vo],Object.getOwnPropertyDescriptor(yn.prototype,"unpublish"),yn.prototype),wt(yn.prototype,"unpublishDataChannel",[vo],Object.getOwnPropertyDescriptor(yn.prototype,"unpublishDataChannel"),yn.prototype),wt(yn.prototype,"unpublishLowStream",[vo],Object.getOwnPropertyDescriptor(yn.prototype,"unpublishLowStream"),yn.prototype),wt(yn.prototype,"subscribeDataChannel",[vo],Object.getOwnPropertyDescriptor(yn.prototype,"subscribeDataChannel"),yn.prototype),wt(yn.prototype,"subscribe",[vo],Object.getOwnPropertyDescriptor(yn.prototype,"subscribe"),yn.prototype),wt(yn.prototype,"massSubscribe",[vo],Object.getOwnPropertyDescriptor(yn.prototype,"massSubscribe"),yn.prototype),wt(yn.prototype,"unsubscribe",[vo],Object.getOwnPropertyDescriptor(yn.prototype,"unsubscribe"),yn.prototype),wt(yn.prototype,"unsubscribeDataChannel",[vo],Object.getOwnPropertyDescriptor(yn.prototype,"unsubscribeDataChannel"),yn.prototype),wt(yn.prototype,"massUnsubscribe",[vo],Object.getOwnPropertyDescriptor(yn.prototype,"massUnsubscribe"),yn.prototype),wt(yn.prototype,"muteRemote",[vo],Object.getOwnPropertyDescriptor(yn.prototype,"muteRemote"),yn.prototype),wt(yn.prototype,"unmuteRemote",[vo],Object.getOwnPropertyDescriptor(yn.prototype,"unmuteRemote"),yn.prototype),wt(yn.prototype,"hasRemoteMediaWithLock",[vo],Object.getOwnPropertyDescriptor(yn.prototype,"hasRemoteMediaWithLock"),yn.prototype),wt(yn.prototype,"disconnectForReconnect",[vo],Object.getOwnPropertyDescriptor(yn.prototype,"disconnectForReconnect"),yn.prototype),wt(yn.prototype,"updateBitrateLimit",[vo],Object.getOwnPropertyDescriptor(yn.prototype,"updateBitrateLimit"),yn.prototype),wt(yn.prototype,"remoteMediaSsrcChanged",[vo],Object.getOwnPropertyDescriptor(yn.prototype,"remoteMediaSsrcChanged"),yn.prototype),yn);function vo(t,r,s){const a=t[r];if(typeof a!="function")throw new Error("Cannot use mutex on object property.");return s.value=async function(){const c=this.mutex,u=await c.lock("From P2PChannel.".concat(r));try{for(var h=arguments.length,m=new Array(h),y=0;y<h;y++)m[y]=arguments[y];return await a.apply(this,m)}finally{u()}},s}function W9(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}function z9(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?W9(Object(s),!0).forEach(function(a){K(t,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):W9(Object(s)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))})}return t}const Hge=Date.now(),$ge=20,L2=new Map,HP=new Map;async function G9(t){const r=L2.get(t),s=Array.isArray(r)&&r[r.length-1],a=HP.get(t);if(!s)return void(a.isSyncing=!1);const c={uid:s.uid,payload:s.payload};a.firstRecvTs===0&&(a.firstRecvTs=s.recvTs,a.firstSendTs=s.sendTs);const u=s.sendTs-a.firstSendTs,h=u-(Date.now()-a.firstRecvTs);h>0&&(a.firstRecvTs=Date.now()-u);let m=s.mediaDelay+h;m<=0?(r.pop(),H9(s.context,c),m=0):m=Math.min(m,$ge),setTimeout(()=>r.length&&G9(t),m)}function H9(t,r){t.safeEmit(bn.STREAM_MESSAGE,r.uid,r.payload),t.onStreamMessage&&t.onStreamMessage(r)}function Kge(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,s=arguments.length>2?arguments[2]:void 0;if(!t.syncWithAudio)return H9(s,{uid:t.uid,payload:t.payload});const a="".concat(s.id,"-").concat(t.uid),c=L2.get(a)||[],u=c.findIndex(v=>t.sendTs>=v.sendTs),h=z9(z9({},t),{},{context:s,mediaDelay:r,recvTs:Date.now()});u===-1?c.push(h):c.splice(u,0,h),L2.set(a,c);let m=!1;var y;HP.has(a)?m=!((y=HP.get(a))===null||y===void 0||!y.isSyncing):HP.set(a,{isSyncing:m,firstRecvTs:0,firstSendTs:0}),m||G9(a)}const qge=Dn().name;function $9(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}function K9(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?$9(Object(s),!0).forEach(function(a){K(t,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):$9(Object(s)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))})}return t}const _S="websdk_ng_cache_parameter",Yge=oe("MAX_PRELOAD_ASYNC_LENGTH"),Xge=1e4,iy=new Map,sy=[];let M2=null,U2=0,V2=0;const $P=new Map,Jge=function(t,r){const s=[];let a=0;const c=async()=>{const u=s.shift();u&&await u(),s.length>0&&a<r?c():a--};return async function(){for(var u=arguments.length,h=new Array(u),m=0;m<u;m++)h[m]=arguments[m];return new dt(async(y,v)=>{s.push(async()=>{try{const S=await t(...h);y(S)}catch(S){v(S)}}),a<r&&(a++,c())})}}(q9,Yge),F2=ha.CancelToken.source();async function q9(t,r,s,a,c,u){try{if(!oe("ENABLE_PRELOAD"))return;if(!jn().supportWebCrypto)return void Gm(()=>{x.warn("Your browser does not support preloading, this feature  be run in a secure environment")},"preload_webcrypto_not_supported");if(!s&&s!==null)throw new Me(te.INVALID_PARAMS,"Invalid token: ".concat(s,". If you don not use token, set it to null"));s&&fs(s,"token",1,2047),fs(t,"appid",1,2047),bP(r),a&&TP(a);const h=z_();x.debug("preload channel ".concat(r,", uid is ").concat(a));const m={appId:t,cname:r,token:s||t,uid:typeof a!="string"?a:null,sid:h,proxyServer:c};let y,v;typeof a=="string"?(m.stringUid=a,[v,y]=await dt.all([Dge(a,{sid:h,appId:t},F2.token),g9(K9(K9({},m),{},{token:s||t,uid:0}),F2.token)]),m.uid=v.uid,y.gatewayInfo.uid=m.uid,y.gatewayInfo.res.uid=m.uid):(u&&(m.stringUid=u),y=await g9(m,F2.token));const S={sid:h,appId:t,cname:r,token:s||t,uid:m.stringUid||a,intUid:m.uid||y.gatewayInfo.uid,stringUid:m.stringUid,ts:Date.now(),sua:v,ap:y};await async function(R){let P;try{R.uid&&X9({appId:R.appId,cname:R.cname,token:R.token,uid:R.uid,stringUid:R.stringUid});const D=e7(R),G=await async function(j,Y){try{const ee=await window.crypto.subtle.importKey("raw",j8(Y),"AES-GCM",!1,["encrypt"]),fe=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:new Uint8Array(1)},ee,W_(window.btoa(JSON.stringify(j))));return Hm(new Uint8Array(fe))}catch{return}}(R,R.token||R.appId);if(!G)return;P=Z9(_S);const F=P?JSON.parse(P):[];F.push({[D]:G}),F.length>oe("AP_CACHE_NUM")&&F.shift(),KP(_S,JSON.stringify(F))}catch(D){x.warn("Error caching server parameters:",D.message),KP(_S,"")}}(S),U2++}catch(h){throw V2++,function(m){M2||(M2=window.setTimeout(()=>{let v="";$P.forEach((S,R)=>{v+="".concat(R,": ").concat(S," ;")}),At.reportApiInvoke(null,{name:Oi.PRELOAD,options:{success:U2,failed:V2,err:v}}).onError(m),U2=0,V2=0,$P.clear(),M2=null},Xge));const y=$P.get(m.code)||0;$P.set(m.code,y+1)}(h),h}}async function Y9(t){try{if(oe("AP_REQUEST_DETAIL")||oe("ENABLE_ROLE_SELECT_EDGE"))return;const r=X9(t);if(!r||t.cloudProxyServer!=="disabled")return;const s=await async function(a,c){try{const u=await window.crypto.subtle.importKey("raw",j8(c),"AES-GCM",!1,["decrypt"]),h=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:new Uint8Array(1)},u,W_(a));return JSON.parse(window.atob(Hm(new Uint8Array(h))))}catch{return}}(r,t.token||t.appId);if(!s||!function(a,c){return a.cname===c.cname&&a.appId===c.appId&&a.token===c.token?c.stringUid?a.stringUid===c.stringUid:typeof c.uid=="number"?a.uid===c.uid:a.uid==c.uid:!1}(s,t))return;if(s&&Date.now()-s.ts<oe("AP_CACHE_LIFETIME"))return s}catch(r){x.warn("Error get preloadInfo",r.message)}}function X9(t){let r;try{if(r=Z9(_S),!r)return;const s=JSON.parse(r),a=e7(t),c=function(h,m){for(let y=h.length-1;y>=0;y--)if(m(h[y]))return y;return-1}(s,h=>a in h);if(c===-1)return;const u=s.splice(c,1)[0];return KP(_S,JSON.stringify(s)),u[a]}catch(s){x.warn("Error delete preload info: ".concat(r),s.message),KP(_S,"")}}function j2(t){if(t){let r=iy.get(t);r&&(window.clearTimeout(r),r=null,iy.delete(t)),ot(sy).call(sy,t)||t.cloudProxyServer!=="disabled"||sy.push(t)}if(iy.size<oe("AP_CACHE_NUM")&&sy.length>0){const r=sy.shift();iy.set(r,window.setTimeout(async()=>{const{appId:s,cname:a,token:c,stringUid:u,uid:h,proxyServer:m}=r;try{await Jge(s,a,c,h,m,u),iy.has(r)&&j2(r)}catch(y){x.warn("update preload failed",y.message),J9(r)}},oe("AP_UPDATE_INTERVAL")))}}function J9(t){const r=sy.indexOf(t);r!==-1&&sy.splice(r,1);let s=iy.get(t);s&&(window.clearTimeout(s),s=null,iy.delete(t),j2())}function Q9(t,r){const s=t.sua,a=t.ap;r&&s&&At.reqUserAccount(t.sid,{lts:s.requestTime,elapse:s.elapse,success:!0,serverAddr:s.url,stringUid:r,uid:t.intUid,errorCode:null,extend:s.req}),At.reportResourceTiming(t.ap.url,t.sid),At.joinWebProxyAP(t.sid,{lts:a.requestTime,elapse:a.elapse,sucess:1,apServerAddr:a.url,turnServerAddrList:a.proxyInfo.addresses.map(c=>c.ip).join(","),eventType:"disabled",unilbsServerIds:[Si.CHOOSE_SERVER,Si.CLOUD_PROXY_FALLBACK].toString()}),At.joinChooseServer(t.sid,{lts:a.requestTime,elapse:a.elapse,succ:!0,csAddr:a.url,opid:a.opid,serverList:a.gatewayInfo.gatewayAddrs.map(c=>c.address),ec:null,cid:a.gatewayInfo.cid.toString(),uid:a.gatewayInfo.uid.toString(),csIp:a.gatewayInfo.csIp,unilbsServerIds:[Si.CHOOSE_SERVER].toString(),isHttp3:a.isHttp3})}function Z9(t){return window.atob(window.localStorage.getItem(t)||"")}function KP(t,r){window.localStorage.setItem(t,window.btoa(r))}function e7(t){let r="".concat(t.appId,"_").concat(t.cname);return typeof t.uid=="string"&&(r+="_s_".concat(t.uid)),typeof t.uid=="number"&&(r+="_".concat(t.uid)),t.token&&(r+="_".concat(t.token)),K8(r)}function Qge(t){let r=function(){const s=t_e.pop();return s?(s.offset=s.limit=0,s):{bytes:new Uint8Array(64),offset:0,limit:0}}();return function(s,a){let c=s.appId;c!==void 0&&(wi(a,10),tg(a,c));let u=s.cid;u!==void 0&&(wi(a,16),wi(a,u));let h=s.cname;h!==void 0&&(wi(a,26),tg(a,h));let m=s.deviceId;m!==void 0&&(wi(a,34),tg(a,m));let y=s.elapse;y!==void 0&&(wi(a,40),ng(a,y));let v=s.fileSize;v!==void 0&&(wi(a,48),ng(a,yS(v)));let S=s.height;S!==void 0&&(wi(a,56),ng(a,yS(S)));let R=s.jpg;R!==void 0&&(wi(a,66),wi(a,R.length),n7(a,R));let P=s.networkType;P!==void 0&&(wi(a,72),ng(a,yS(P)));let D=s.osType;D!==void 0&&(wi(a,80),ng(a,yS(D)));let G=s.requestId;G!==void 0&&(wi(a,90),tg(a,G));let F=s.sdkVersion;F!==void 0&&(wi(a,98),tg(a,F));let j=s.sequence;j!==void 0&&(wi(a,104),ng(a,yS(j)));let Y=s.sid;Y!==void 0&&(wi(a,114),tg(a,Y));let ee=s.timestamp;ee!==void 0&&(wi(a,120),ng(a,ee));let fe=s.uid;fe!==void 0&&(wi(a,128),wi(a,fe));let Se=s.vid;Se!==void 0&&(wi(a,136),wi(a,Se));let we=s.width;we!==void 0&&(wi(a,144),ng(a,yS(we)));let ye=s.service;ye!==void 0&&(wi(a,152),wi(a,ye));let Ne=s.callbackData;Ne!==void 0&&(wi(a,162),wi(a,Ne.length),n7(a,Ne));let Ye=s.ticket;Ye!==void 0&&(wi(a,170),tg(a,Ye));let ht=s.vendorConfigs;ht!==void 0&&(wi(a,178),tg(a,ht))}(t,r),function(s){let a=s.bytes,c=s.limit;return a.length===c?a:a.subarray(0,c)}(r)}function Zge(t){return function(s){let a={};e:for(;!n_e(s);){let c=JT(s);switch(c>>>3){case 0:break e;case 1:a.code=JT(s);break;case 2:a.msg=r7(s,JT(s));break;case 3:a.requestId=r7(s,JT(s));break;case 4:a.timestamp=r_e(s,!1);break;default:e_e(s,7&c)}}return a}({bytes:r=t,offset:0,limit:r.length});var r}function e_e(t,r){switch(r){case 0:for(;128&Au(t););break;case 2:B2(t,JT(t));break;case 5:B2(t,4);break;case 1:B2(t,8);break;default:throw new Error("Unimplemented type: "+r)}}function yS(t){return{low:t|=0,high:t>>31,unsigned:t>=0}}let t_e=[];function B2(t,r){if(t.offset+r>t.limit)throw new Error("Skip past limit");t.offset+=r}function n_e(t){return t.offset>=t.limit}function qP(t,r){let s=t.bytes,a=t.offset,c=t.limit,u=a+r;if(u>s.length){let h=new Uint8Array(2*u);h.set(s),t.bytes=h}return t.offset=u,u>c&&(t.limit=u),a}function t7(t,r){let s=t.offset;if(s+r>t.limit)throw new Error("Read past limit");return t.offset+=r,s}function n7(t,r){let s=qP(t,r.length);t.bytes.set(r,s)}function r7(t,r){let s=t7(t,r),a=String.fromCharCode,c=t.bytes,u="",h="";for(let m=0;m<r;m++){let y,v,S,R,P=c[m+s];(128&P)==0?h+=a(P):(224&P)==192?m+1>=r?h+=u:(y=c[m+s+1],(192&y)!=128?h+=u:(R=(31&P)<<6|63&y,R<128?h+=u:(h+=a(R),m++))):(240&P)==224?m+2>=r?h+=u:(y=c[m+s+1],v=c[m+s+2],(49344&(y|v<<8))!=32896?h+=u:(R=(15&P)<<12|(63&y)<<6|63&v,R<2048||R>=55296&&R<=57343?h+=u:(h+=a(R),m+=2))):(248&P)==240?m+3>=r?h+=u:(y=c[m+s+1],v=c[m+s+2],S=c[m+s+3],(12632256&(y|v<<8|S<<16))!=8421504?h+=u:(R=(7&P)<<18|(63&y)<<12|(63&v)<<6|63&S,R<65536||R>1114111?h+=u:(R-=65536,h+=a(55296+(R>>10),56320+(1023&R)),m+=3))):h+=u}return h}function tg(t,r){let s=r.length,a=0;for(let h=0;h<s;h++){let m=r.charCodeAt(h);m>=55296&&m<=56319&&h+1<s&&(m=(m<<10)+r.charCodeAt(++h)-56613888),a+=m<128?1:m<2048?2:m<65536?3:4}wi(t,a);let c=qP(t,a),u=t.bytes;for(let h=0;h<s;h++){let m=r.charCodeAt(h);m>=55296&&m<=56319&&h+1<s&&(m=(m<<10)+r.charCodeAt(++h)-56613888),m<128?u[c++]=m:(m<2048?u[c++]=m>>6&31|192:(m<65536?u[c++]=m>>12&15|224:(u[c++]=m>>18&7|240,u[c++]=m>>12&63|128),u[c++]=m>>6&63|128),u[c++]=63&m|128)}}function Au(t){return t.bytes[t7(t,1)]}function i7(t,r){let s=qP(t,1);t.bytes[s]=r}function JT(t){let r,s=0,a=0;do r=Au(t),s<32&&(a|=(127&r)<<s),s+=7;while(128&r);return a}function wi(t,r){for(r>>>=0;r>=128;)i7(t,127&r|128),r>>>=7;i7(t,r)}function r_e(t,r){let s,a=0,c=0,u=0;return s=Au(t),a=127&s,128&s&&(s=Au(t),a|=(127&s)<<7,128&s&&(s=Au(t),a|=(127&s)<<14,128&s&&(s=Au(t),a|=(127&s)<<21,128&s&&(s=Au(t),c=127&s,128&s&&(s=Au(t),c|=(127&s)<<7,128&s&&(s=Au(t),c|=(127&s)<<14,128&s&&(s=Au(t),c|=(127&s)<<21,128&s&&(s=Au(t),u=127&s,128&s&&(s=Au(t),u|=(127&s)<<7))))))))),{low:a|c<<28,high:c>>>4|u<<24,unsigned:r}}function ng(t,r){let s=r.low>>>0,a=(r.low>>>28|r.high<<4)>>>0,c=r.high>>>24,u=c===0?a===0?s<16384?s<128?1:2:s<1<<21?3:4:a<16384?a<128?5:6:a<1<<21?7:8:c<128?9:10,h=qP(t,u),m=t.bytes;switch(u){case 10:m[h+9]=c>>>7&1;case 9:m[h+8]=u!==9?128|c:127&c;case 8:m[h+7]=u!==8?a>>>21|128:a>>>21&127;case 7:m[h+6]=u!==7?a>>>14|128:a>>>14&127;case 6:m[h+5]=u!==6?a>>>7|128:a>>>7&127;case 5:m[h+4]=u!==5?128|a:127&a;case 4:m[h+3]=u!==4?s>>>21|128:s>>>21&127;case 3:m[h+2]=u!==3?s>>>14|128:s>>>14&127;case 2:m[h+1]=u!==2?s>>>7|128:s>>>7&127;case 1:m[h]=u!==1?128|s:127&s}}const s7={},o7={},YP=4294967296,i_e=YP*YP,s_e=i_e/2;c7(0,!0);const a7=c7(0),o_e=QT(0,-2147483648,!1),a_e=QT(-1,2147483647,!1);function c7(t,r){let s,a,c;return r?(c=0<=(t>>>=0)&&t<256)&&(a=o7[t],a)?a:(s=QT(t,0,!0),c&&(o7[t]=s),s):(c=-128<=(t|=0)&&t<128)&&(a=s7[t],a)?a:(s=QT(t,t<0?-1:0,!1),c&&(s7[t]=s),s)}function QT(t,r,s){return{low:0|t,high:0|r,unsigned:!!s}}function l7(t,r){if(isNaN(t))return a7;{if(t<=-9223372036854776e3)return o_e;if(t+1>=s_e)return a_e}return t<0?a7:QT(t%YP|0,t/YP|0,r)}function u7(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}class W2 extends Fr{get connectionState(){return this._connectionState}set connectionState(r){if(this._connectionState===r)return;const s=this._connectionState;this._connectionState=r,this.emit(wd.CONNECTION_STATE_CHANGE,r,s)}get quality(){return this._quality}set quality(r){this._quality=r>1?1:r<.1?.1:r,this._qualityTimer&&(window.clearTimeout(this._qualityTimer),this._qualityTimer=null),this._quality>=1||(this._qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this._qualityRatio},6e4))}constructor(r){var s;super(),K(this,"name","AgoraRTCImageModeration"),K(this,"_connectionState",kl.CONNECTING),K(this,"_sequence",0),K(this,"_moderationStartTime",void 0),K(this,"_workerConnection",void 0),K(this,"_workerMessageLengthLimit",void 0),K(this,"_qualityRatio",void 0),K(this,"_connectInfo",void 0),K(this,"_cancelTokenSource",ha.CancelToken.source()),K(this,"_retryConfig",void 0),K(this,"_moderationInterval",void 0),K(this,"_moderationTimer",null),K(this,"_moderationMode",1),K(this,"_quality",1),K(this,"_qualityTimer",null),K(this,"_ticket",void 0),K(this,"_moderationIntervalMinimum",void 0),K(this,"_uploadFailedNum",0),K(this,"_uploadNum",0),K(this,"_uploadTimer",null),K(this,"_extraInfo",void 0),K(this,"_vendor",""),K(this,"_encoder",new TextEncoder),K(this,"_moderationId",void 0),K(this,"inspectImage",()=>{if(this.connectionState!==kl.CONNECTED)throw new Oe(te.OPERATION_ABORTED,"image moderation service connection status is ".concat(this.connectionState));this._moderationTimer&&(window.clearInterval(this._moderationTimer),this._moderationTimer=null),this._moderationTimer=window.setInterval(()=>{this.connectionState===kl.CONNECTED?this.requestToInspectImage():x.debug("[".concat(this._moderationId,"] Moderation State is not connected , "),this.connectionState)},this._moderationInterval<this._moderationIntervalMinimum?this._moderationIntervalMinimum:this._moderationInterval),this.requestToInspectImage()}),this._moderationId=fr(5,"image-moderation-"),this._workerMessageLengthLimit=oe("IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT"),this._moderationIntervalMinimum=oe("IMAGE_MODERATION_INTERVAL_MINIMUM"),this._moderationInterval=(s=r.interval)!==null&&s!==void 0?s:1e3,r.extraInfo&&(this._extraInfo=this._encoder.encode(r.extraInfo)),r.vendor&&(this._vendor=r.vendor),this._qualityRatio=oe("IMAGE_MODERATION_QUALITY_RATIO"),this._moderationStartTime=Number(Date.now()),this._workerConnection=new BT("worker-"+this._moderationId,ki),this.on(wd.STATE_CHANGE,(a,c)=>{x.debug("[".concat(this._moderationId,"] Moderation operation :").concat(aS[a]," ").concat(c||""))}),this.handleWorkerEvents()}async init(r,s){this.emit(wd.STATE_CHANGE,aS.CONNECT_AP),this._connectInfo=r;const a=this._cancelTokenSource.token;return this._retryConfig=s,new dt((c,u)=>{this.on(wd.CONNECTION_STATE_CHANGE,(h,m)=>{h===kl.CONNECTED&&c()}),this.requestAP(r,a,s).then(h=>{this.connectWorker(h)}).catch(h=>{u(h)})})}updateConfig(r){var s;this._moderationInterval=(s=r.interval)!==null&&s!==void 0?s:1e3,r.extraInfo&&(this._extraInfo=this._encoder.encode(r.extraInfo)),r.vendor&&(this._vendor=r.vendor),x.debug("[".concat(this._moderationId,"] updateConfig: ").concat(JSON.stringify(r))),this.connectionState===kl.CONNECTED&&this.inspectImage()}async requestAP(r,s,a){const c=oe("WEBCS_DOMAIN").map(y=>"https://".concat(y,"/api/v1")),u=await function(y,v,S,R){let{appId:P,areaCode:D,cname:G,sid:F,token:j,uid:Y}=v;fS++;const ee="moderation_plugin",fe={service_name:ee,json_body:JSON.stringify({appId:P,areaCode:D,cname:G,command:"allocateEdge",requestId:fS,seq:fS,sid:F,appToken:j,ts:Date.now(),uid:Y+""})};let Se,we,ye=y[0];return vd(async()=>{Se=Date.now();const Ne=await Cd(ye,{data:fe,cancelToken:S,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(we=Date.now()-Se,Ne.code!==0){const mt=new Oe(te.UNEXPECTED_RESPONSE,"moderation plugin ap error, code"+Ne.code,{retry:!0,responseTime:we});throw x.error(mt.toString()),mt}const Ye=JSON.parse(Ne.json_body);if(Ye.code!==200){const mt=new Oe(te.UNEXPECTED_RESPONSE,"moderation plugin ap error, code: ".concat(Ye.code,", reason: ").concat(Ye.reason),{code:Ye.code,responseTime:we});throw x.error(mt.toString()),mt}if(!Ye.servers||!Array.isArray(Ye.servers)||Ye.servers.length===0){const mt=new Oe(te.UNEXPECTED_RESPONSE,"moderation plugin ap empty server",{code:Ye.code,responseTime:we});throw x.error(mt.toString()),mt}if(!Ye.servers.some(mt=>!!mt.wss)){const mt=new Oe(te.UNEXPECTED_RESPONSE,"moderation plugin ap empty port",{code:Ye.code,responseTime:we});throw x.error(mt.toString()),mt}const ht=oe("IMAGE_MODERATION_WORKER_HOST");return{addressList:Ye.servers.map(mt=>{let{address:In,wss:An}=mt;if(In&&An)return"wss://".concat(In.replace(/\./g,"-"),".").concat(ht,":").concat(An,"/moderation")}).filter(mt=>!!mt),workerToken:Ye.workerToken,vid:Ye.vid,ticket:Ye.appTicket,responseTime:we}},(Ne,Ye)=>(At.apworkerEvent(F,{success:!0,sc:200,serviceName:ee,responseDetail:JSON.stringify(Ne.addressList),firstSuccess:Ye===0,responseTime:we,serverIp:y[Ye%y.length]}),!1),(Ne,Ye)=>(At.apworkerEvent(F,{success:!1,sc:Ne.data&&Ne.data.code||200,serviceName:ee,responseTime:we,serverIp:y[Ye%y.length]}),!!(Ne.code!==te.OPERATION_ABORTED&&Ne.code!==te.UNEXPECTED_RESPONSE||Ne.data&&Ne.data.retry)&&(ye=y[(Ye+1)%y.length],!0)),R)}(c,r,s,a);this.emit(wd.STATE_CHANGE,aS.AP_CONNECTED);const{addressList:h,ticket:m}=u;return this._ticket=m,h}async connectWorker(r){this.emit(wd.STATE_CHANGE,aS.CONNECT_WORKER),await this._workerConnection.init(r,1e4)}handleWorkerEvents(){this._workerConnection.on(Zt.CONNECTED,async()=>{this.emit(wd.STATE_CHANGE,aS.WORKER_CONNECTED,this._workerConnection.url),this.connectionState=kl.CONNECTED}),this._workerConnection.on(Zt.CLOSED,()=>{this.connectionState=kl.CLOSED}),this._workerConnection.on(Zt.FAILED,()=>{this.connectionState=kl.CLOSED}),this._workerConnection.on(Zt.RECONNECTING,()=>{this.connectionState=this.connectionState===kl.CONNECTED?kl.RECONNECTING:kl.CONNECTING}),this._workerConnection.on(Zt.ON_MESSAGE,async r=>{if(r.data instanceof ArrayBuffer){const s=Zge(new Uint8Array(r.data));oe("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&x.debug("[".concat(this._moderationId,"] Response message for worker of image moderation "),JSON.stringify(s)),this._uploadNum++,s.code===void 0||s.code===0||(this._uploadFailedNum++,x.error("[".concat(this._moderationId,"] Error response from worke, code is ").concat(s.code,", msg is ").concat(s.msg)),this._uploadTimer||(this._uploadTimer=window.setTimeout(()=>{At.reportApiInvoke(this._connectInfo.sid||null,{name:Oi.IMAGE_MODERATION_UPLOAD,options:[this._uploadFailedNum,this._uploadNum,s.code],tag:Hr.TRACER}).onError(new Oe(te.IMAGE_MODERATION_UPLOAD_FAILED,s.msg)),this._uploadTimer=null},oe("IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL"))))}else x.error("[".concat(this._moderationId,"] Unexpected message type from worker"))}),this._workerConnection.on(Zt.WILL_RECONNECT,(r,s,a)=>{r==="recover"&&a(r),a("tryNext")}),this._workerConnection.on(Zt.REQUEST_NEW_URLS,(r,s)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(r).catch(s)})}static intToLong(r){return{low:r|=0,high:r>>31,unsigned:r>=0}}async requestToInspectImage(){const r=Kc(this,wd.CLIENT_LOCAL_VIDEO_TRACK),s={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(r){if(!r.isPlaying)return void(oe("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&x.debug("Only the track being played can be inspected"));this._sequence++;const a=await this.generateRequestData(r,s);this._workerConnection.sendMessage(a,!0,!0)}else oe("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&x.debug("Only the track being published can be inspected")}async generateRequestData(r,s){let{appId:a,cname:c,cid:u,vid:h,sid:m,uid:y}=s;const v=Date.now(),S=await r.getCurrentFrameImage("image/jpeg",this.quality),R=await Mz(S,a,c),P=this._sequence+"-"+u+"-"+y+"-"+v+"-"+fr(12,""),D={appId:a,cid:u,cname:c,deviceId:"",elapse:W2.intToLong(Number(v-this._moderationStartTime)),fileSize:S.buffer.byteLength,height:S.height,width:S.width,jpg:R,networkType:6,osType:7,requestId:P,sdkVersion:"4.23.2",sequence:this._sequence,sid:m,timestamp:l7(v),uid:y,vid:h,service:this._moderationMode,ticket:this._ticket,callbackData:this._extraInfo,vendorConfigs:this._vendor};this._extraInfo===void 0&&delete D.callbackData;const G=Qge(D);if(G.byteLength<this._workerMessageLengthLimit){if(oe("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")){const F=function(j){for(var Y=1;Y<arguments.length;Y++){var ee=arguments[Y]!=null?arguments[Y]:{};Y%2?u7(Object(ee),!0).forEach(function(fe){K(j,fe,ee[fe])}):Object.getOwnPropertyDescriptors?Object.defineProperties(j,Object.getOwnPropertyDescriptors(ee)):u7(Object(ee)).forEach(function(fe){Object.defineProperty(j,fe,Object.getOwnPropertyDescriptor(ee,fe))})}return j}({},D);delete F.jpg,x.debug("[".concat(this._moderationId,"] Request message for worker of image moderation service: "),JSON.stringify(F))}return G}{const F=this.quality*this._qualityRatio;return this.quality=F,await this.generateRequestData(r,{appId:a,cname:c,cid:u,vid:h,sid:m,uid:y})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=ha.CancelToken.source(),this._workerConnection&&this._workerConnection.close(),this._moderationTimer&&window.clearInterval(this._moderationTimer),this._moderationTimer=null,this._uploadTimer&&window.clearTimeout(this._uploadTimer),this._uploadTimer=null,this.connectionState=kl.CLOSED,this.emit(wd.STATE_CHANGE,aS.CLOSED)}}function d7(t){if(or(t.interval,"interval",1e3,1/0),t&&t.extraInfo&&t.extraInfo.length>1024)throw new Oe(te.INVALID_PARAMS,"config.extraInfo length cannot exceed 1024 bytes");if(t&&t.vendor&&t.vendor.length>1024)throw new Oe(te.INVALID_PARAMS,"config.vendor length cannot exceed 1024 bytes")}const c_e={name:"ImageModeration",create:function(t){let{config:r}=t;return d7(r),new W2(r)}};var h7,f7,p7,m7,g7,_7,y7,E7,v7,S7,b7,T7,w7,C7,R7,I7,A7,P7,O7,k7,N7,D7,x7,L7,M7,U7,V7,F7,j7,B7,W7,z7,G7,H7,$7,K7,q7,Y7,X7,J7,Q7,pt;function Z7(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}function Pu(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?Z7(Object(s),!0).forEach(function(a){K(t,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):Z7(Object(s)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))})}return t}Fs.setLogger(x);let l_e=(h7=jt(),f7=jt({argsMap:(t,r)=>{if(!Array.isArray(r)){if(!(r instanceof Zv))return[r];r=[r]}return r.map(s=>s?Object(s).toString():"null")}}),p7=jt({argsMap:(t,r)=>(r||(r=[]),Array.isArray(r)||r.trackMediaType!==Qv.DATA?(Array.isArray(r)||(r=[r]),r.map(s=>s.getTrackId())):[r.getChannelId()])}),m7=jt({argsMap:(t,r,s,a)=>[typeof r=="object"?r.uid:r,s,a]}),g7=jt({argsMap:(t,r,s)=>[r,s]}),_7=jt({argsMap:(t,r)=>r.map(s=>{let{user:a,mediaType:c}=s;return[a==null?void 0:a.uid,c]})}),y7=jt({argsMap:(t,r,s,a)=>[typeof r=="object"?r.uid:r,s,a]}),E7=jt({argsMap:(t,r)=>r.map(s=>{let{user:a,mediaType:c}=s;return{uid:a==null?void 0:a.uid,mediaType:c}})}),v7=jt(),S7=jt(),b7=jt(),T7=jt(),w7=jt(),C7=jt(),R7=jt(),I7=jt(),A7=jt(),P7=jt(),O7=jt(),k7=jt(),N7=jt(),D7=jt(),x7=jt(),L7=jt({argsMap:(t,r)=>[r]}),M7=jt(),U7=jt(),V7=jt(),F7=jt(),j7=jt(),B7=jt(),W7=jt(),z7=jt(),G7=jt({argsMap:(t,r)=>(Array.isArray(r)||(r=[r]),[JSON.stringify(r)])}),H7=jt(),$7=jt(),K7=jt(),q7=jt(),Y7=jt(),X7=jt(),J7=jt({reportResult:!0}),Q7=jt(),pt=class extends Fr{get connectionState(){return this._gateway.state}get remoteUsers(){return this._users}get localTracks(){return this._p2pChannel.getAllTracks(!0)}get uid(){return this._uid}get channelName(){return this._channelName}get localDataChannels(){return this._p2pChannel.getAllDataChannels()}get mode(){return this._config.mode}get role(){var t;return((t=this._config)===null||t===void 0?void 0:t.role)||"audience"}get codec(){return this._config.codec}get audioCodec(){return this._config.audioCodec||"opus"}get isStringUID(){return!!this._joinInfo&&!!this._joinInfo.stringUid}get __className__(){return"Client"}constructor(t,r){let s;if(super(),K(this,"store",void 0),K(this,"_uid",void 0),K(this,"_channelName",void 0),K(this,"_uintUid",void 0),K(this,"_users",[]),K(this,"_config",void 0),K(this,"_clientId",void 0),K(this,"_appId",void 0),K(this,"_sessionId",null),K(this,"_key",void 0),K(this,"_rtmConfig",{}),K(this,"_joinInfo",void 0),K(this,"_gateway",void 0),K(this,"_statsCollector",void 0),K(this,"_configDistribute",void 0),K(this,"_leaveMutex",void 0),K(this,"_publishMutex",void 0),K(this,"_renewTokenMutex",void 0),K(this,"_subscribeMutex",void 0),K(this,"_encryptionMode","none"),K(this,"_encryptionSecret",null),K(this,"_encryptionSalt",null),K(this,"_encryptDataStream",!1),K(this,"_encryptDataStreamKey",null),K(this,"_encryptDataStreamIv",null),K(this,"_proxyServer",void 0),K(this,"_turnServer",{servers:[],mode:"auto"}),K(this,"_cloudProxyServerMode","disabled"),K(this,"_isDualStreamEnabled",!1),K(this,"_defaultStreamFallbackType",void 0),K(this,"_lowStreamParameter",void 0),K(this,"_streamFallbackTypeCacheMap",new Map),K(this,"_remoteStreamTypeCacheMap",new Map),K(this,"_axiosCancelSource",ha.CancelToken.source()),K(this,"_audioVolumeIndicationInterval",void 0),K(this,"_networkQualityInterval",void 0),K(this,"_userOfflineTimeout",void 0),K(this,"_streamRemovedTimeout",void 0),K(this,"_liveTranscodeStreamingClient",void 0),K(this,"_liveRawStreamingClient",void 0),K(this,"_channelMediaRelayClient",void 0),K(this,"_networkQualitySensitivity","normal"),K(this,"_p2pChannel",void 0),K(this,"_useLocalAccessPoint",!1),K(this,"_setLocalAPVersion",void 0),K(this,"_joinAndNotLeaveYet",!1),K(this,"_numberOfJoinCount",0),K(this,"_remoteDefaultVideoStreamType",void 0),K(this,"_inspect",void 0),K(this,"_moderation",void 0),K(this,"_license",void 0),K(this,"_pendingPublishedUsers",[]),K(this,"ntpAlignErrorCount",0),K(this,"remoteInboundOffset",0),K(this,"_peerConnectionState",void 0),K(this,"_handleLocalTrackEnable",(c,u,h)=>{this.publish(c,!1).then(u).catch(h)}),K(this,"_handleLocalTrackDisable",(c,u,h)=>{this.unpublish(c).then(u).catch(h)}),K(this,"_handleUserOnline",c=>{if(oe("BLOCK_LOCAL_CLIENT")&&J_(c.uid,this.channelName))return void x.debug("[".concat(c.uid,"] will be ignored in local"));this.isStringUID&&typeof c.uid!="string"&&x.error("[".concat(this._clientId,"] StringUID is Mixed with UintUID"));const u=this._users.find(h=>h.uid===c.uid);if(u)u._trust_in_room_=!0,u._is_pre_created&&(u._is_pre_created=!1,this.safeEmit(bn.USER_JOINED,u));else{const h=new Zm(c.uid,c.uint_id||c.uid);this._users.push(h),x.debug("[".concat(this._clientId,"] user online"),c.uid),this.safeEmit(bn.USER_JOINED,h)}}),K(this,"_handleUserOffline",c=>{if(oe("BLOCK_LOCAL_CLIENT")&&J_(c.uid,this.channelName))return;const u=this._users.find(h=>h.uid===c.uid);u&&(this._handleRemoveStream(c),this._handleRemoveDataChannels(c),u._audio_pre_subscribed||u._video_pre_subscribed?u._is_pre_created=!0:JA(this._users,u),this._remoteStreamTypeCacheMap.delete(u.uid),this._streamFallbackTypeCacheMap.delete(u.uid),x.debug("[".concat(this._clientId,"] user offline"),c.uid,"reason:",c.reason),this.safeEmit(bn.USER_LEAVED,u,c.reason))}),K(this,"_handleAddAudioOrVideoStream",(c,u,h,m,y,v,S)=>{if(oe("BLOCK_LOCAL_CLIENT")&&J_(u,this.channelName))return;const R=this._users.find(D=>D.uid===u);if(!R)return void x.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));x.debug("[".concat(this._clientId,"] stream added with uid ").concat(u,", type ").concat(c)),this.store.subscribe(R.uid,c,void 0,void 0,void 0,Date.now());const P=c==="audio"?R.hasAudio:R.hasVideo;R._uintid||(R._uintid=y||u),c==="audio"?R._trust_audio_stream_added_state_=!0:R._trust_video_stream_added_state_=!0,c==="audio"?(R._audio_added_=!0,h!==void 0&&(R._audioSSRC=h),m!==void 0&&(R._cname=m),v&&(R._audioOrtc=v)):(R._video_added_=!0,h!==void 0&&(R._videoSSRC=h),m!==void 0&&(R._cname=m),S!==void 0&&(R._rtxSsrcId=S),v&&(R._videoOrtc=v)),(c==="audio"?R.hasAudio:R.hasVideo)&&!P&&(x.info("[".concat(this._clientId,"] remote user ").concat(R.uid," published ").concat(c)),this.safeEmit(bn.USER_PUBLISHED,R,c)),c==="video"?At.onGatewayStream(this._sessionId,Zi.ON_ADD_VIDEO_STREAM,xr.ON_ADD_VIDEO_STREAM,{peer:y||u,ssrc:R._videoSSRC}):At.onGatewayStream(this._sessionId,Zi.ON_ADD_AUDIO_STREAM,xr.ON_ADD_AUDIO_STREAM,{peer:y||u,ssrc:R._audioSSRC}),this._p2pChannel.remoteMediaSsrcChanged(R,c,h).then(D=>{if(D&&(x.debug("[".concat(this._clientId,"] resubscribe ").concat(c," for user ").concat(R.uid," after rejoin because SSRC id changed.")),this._p2pChannel instanceof XT))return this._p2pChannel.unsubscribe(R,c,!0).then(()=>this._subscribe(R,c,!0).catch(G=>{x.error("[".concat(this._clientId,"] resubscribe error"),G.toString())}))}),this._p2pChannel.hasPendingRemoteMedia(R,c)&&(x.debug("[".concat(this._clientId,"] resubscribe ").concat(c," for user ").concat(R.uid," after reconnect.")),this._subscribe(R,c,!0).catch(D=>{x.error("[".concat(this._clientId,"] resubscribe error"),D.toString())}))}),K(this,"_handleRemoveStream",c=>{if(oe("BLOCK_LOCAL_CLIENT")&&J_(c.uid,this.channelName))return;const u=this._users.find(m=>m.uid===c.uid);if(!u)return void x.warning("[".concat(this._clientId,"] can not find target user!(on_remove_stream)"));x.debug("[".concat(this._clientId,"] stream removed with uid ").concat(c.uid));let h=()=>{};u.hasAudio&&u.hasVideo?h=()=>{x.info("[".concat(this._clientId,"] remote user ").concat(u.uid," unpublished audio track")),this.safeEmit(bn.USER_UNPUBLISHED,u,"audio"),x.info("[".concat(this._clientId,"] remote user ").concat(u.uid," unpublished video track")),this.safeEmit(bn.USER_UNPUBLISHED,u,"video")}:u.hasVideo?h=()=>{x.info("[".concat(this._clientId,"] remote user ").concat(u.uid," unpublished video track")),this.safeEmit(bn.USER_UNPUBLISHED,u,"video")}:u.hasAudio&&(h=()=>{x.info("[".concat(this._clientId,"] remote user ").concat(u.uid," unpublished audio track")),this.safeEmit(bn.USER_UNPUBLISHED,u,"audio")}),u._video_pre_subscribed||u._audio_pre_subscribed||(u._trust_audio_stream_added_state_=!0,u._trust_video_stream_added_state_=!0,u._audio_added_=!1,u._video_added_=!1,this._p2pChannel instanceof XT&&this._p2pChannel.unsubscribe(u).then(m=>{if(m)return this._gateway.unsubscribe(m,u.uid)}),u._audioSSRC=void 0,u._videoSSRC=void 0,u._audioOrtc=void 0,u._videoOrtc=void 0,u._rtxSsrcId=void 0),At.onGatewayStream(this._sessionId,Zi.ON_REMOVE_STREAM,xr.ON_REMOVE_STREAM,{peer:c.uint_id||c.uid}),h()}),K(this,"_handleSetStreamLocalEnable",(c,u,h)=>{if(oe("BLOCK_LOCAL_CLIENT")&&J_(u,this.channelName))return;const m=this._users.find(S=>S.uid===u);if(!m)return void x.error("[".concat(this._clientId,"] can not find target user!(disable_local)"));x.debug("[".concat(this._clientId,"] local ").concat(c," ").concat(h?"enabled":"disabled"," with uid ").concat(u));const y=c==="audio"?m.hasAudio:m.hasVideo;if(c==="audio"){m._trust_audio_enabled_state_=!0;const S=m._audio_enabled_;if(m._audio_enabled_=h,m._audio_enabled_===S)return;{const R=m._audio_enabled_?"enable-local-audio":"disable-local-audio";x.debug("[".concat(this._clientId,"] user-info-updated, uid: ").concat(u,", msg: ").concat(R)),this.safeEmit(bn.USER_INFO_UPDATED,u,R)}}else{m._trust_video_enabled_state_=!0;const S=m._video_enabled_;if(m._video_enabled_=h,m._video_enabled_===S)return;{const R=m._video_enabled_?"enable-local-video":"disable-local-video";x.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(u,", msg: ").concat(R)),this.safeEmit(bn.USER_INFO_UPDATED,u,R)}}const v=c==="audio"?m.hasAudio:m.hasVideo;return y!==v?!y&&v?(x.info("[".concat(this._clientId,"] remote user ").concat(u," published ").concat(c)),void this.safeEmit(bn.USER_PUBLISHED,m,c)):(c==="video"&&m._videoTrack&&m._videoTrack._destroy(),c==="audio"&&m._audioTrack,this._p2pChannel.muteRemote(m,c),x.info("[".concat(this._clientId,"] remote user ").concat(u," unpublished ").concat(c)),void this.safeEmit(bn.USER_UNPUBLISHED,m,c)):void 0}),K(this,"_handleMuteStream",(c,u,h)=>{if(oe("BLOCK_LOCAL_CLIENT")&&J_(c,this.channelName))return;x.debug("[".concat(this._clientId,"] receive mute message"),c,u,h);const m=this._users.find(S=>S.uid===c);if(!m)return void x.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(c));const y=u==="audio"?m.hasAudio:m.hasVideo;if(u==="audio"){m._trust_audio_mute_state_=!0;const S=m._audio_muted_;if(m._audio_muted_=h,m._audio_muted_===S)return;{const R=m._audio_muted_?"mute-audio":"unmute-audio";x.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(c,", msg: ").concat(R)),this.safeEmit(bn.USER_INFO_UPDATED,c,R)}}else{m._trust_video_mute_state_=!0;const S=m._video_muted_;if(m._video_muted_=h,m._video_muted_===S)return;{const R=m._video_muted_?"mute-video":"unmute-video";x.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(c,", msg: ").concat(R)),this.safeEmit(bn.USER_INFO_UPDATED,c,R)}}const v=u==="audio"?m.hasAudio:m.hasVideo;if(y!==v){if(!y&&v)return(u==="audio"?m._audioSSRC:m._videoSSRC)?(x.info("[".concat(this._clientId,"] remote user ").concat(c," published ").concat(u)),void this.safeEmit(bn.USER_PUBLISHED,m,u)):void x.warning("[".concat(this._clientId,"] remote user ").concat(c," receive ").concat(u," unmute message  before add stream message, ").concat(u," SSRC doesn't exist yet."));u==="video"&&m._videoTrack&&!m._video_pre_subscribed&&m._videoTrack._destroy(),u==="audio"&&m._audioTrack,this._p2pChannel.muteRemote(m,u),x.info("[".concat(this._clientId,"] remote user ").concat(c," unpublished ").concat(u)),this.safeEmit(bn.USER_UNPUBLISHED,m,u)}}),K(this,"_handleP2PLost",async c=>{x.debug("[".concat(this._clientId,"] receive p2p lost"),c),parseInt(c.p2pid,10)===this.store.p2pId?await this._p2pChannel.requestReconnect():x.warning("[".concat(this._clientId,"] P2PLost stream not found"),c)}),K(this,"_handleTokenWillExpire",()=>{x.debug("[".concat(this._clientId,"] received message onTokenPrivilegeWillExpire")),this.safeEmit(bn.ON_TOKEN_PRIVILEGE_WILL_EXPIRE)}),K(this,"_handleBeforeUnload",c=>{c.type==="beforeunload"&&c.returnValue!==void 0&&c.returnValue!==""||(this.leave(),x.info("[".concat(this._clientId,"] auto leave onbeforeunload or pagehide")))}),K(this,"_handleUpdateNetworkQuality",()=>{if(this._networkQualitySensitivity==="normal")return;if(navigator&&navigator.onLine!==void 0&&!navigator.onLine)return void this.safeEmit(bn.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6});const c={downlinkNetworkQuality:0,uplinkNetworkQuality:0};c.uplinkNetworkQuality=this._p2pChannel.getUplinkNetworkQuality(),c.downlinkNetworkQuality=this._p2pChannel.getDownlinkNetworkQuality(),this.safeEmit(bn.NETWORK_QUALITY,c)}),K(this,"_handleP2PAddAudioOrVideoStream",(c,u,h,m)=>{const y=this._users.find(S=>S.uid===u);if(!y)return void x.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));x.debug("[".concat(this._clientId,"] stream added with uid ").concat(u,", type ").concat(c)),this.store.subscribe(y.uid,c,void 0,void 0,void 0,Date.now());const v=c==="audio"?y.hasAudio:y.hasVideo;c==="audio"?y._trust_audio_stream_added_state_=!0:y._trust_video_stream_added_state_=!0,c==="audio"?(y._audio_added_=!0,h!==void 0&&(y._audioSSRC=h),m!==void 0&&(y._audioMid=m)):(y._video_added_=!0,h!==void 0&&(y._videoSSRC=h),m!==void 0&&(y._videoMid=m)),(c==="audio"?y.hasAudio:y.hasVideo)&&!v&&(x.info("[".concat(this._clientId,"] remote user ").concat(y.uid," published ").concat(c)),this.safeEmit(bn.USER_PUBLISHED,y,c)),this._p2pChannel.hasPendingRemoteMedia(y,c)&&(x.debug("[".concat(this._clientId,"] resubscribe ").concat(c," for user ").concat(y.uid," after reconnect.")),this._subscribe(y,c,!0).catch(S=>{x.error("[".concat(this._clientId,"] resubscribe error"),S.toString())}))}),this._config=t,this._clientId=r||fr(5,"client-"),this.store=new class{constructor(c,u,h,m){qt(this,"state",void 0),this.state={codec:c,audioCodec:u,mode:h,clientId:m,sessionId:null,p2pId:0,dcId:0,pubId:0,subId:0,avoidJoinStart:0,keyMetrics:{publish:[],subscribe:[]},joinChannelServiceRecords:[],cloudProxyServerMode:"disabled",useP2P:!1,p2pTransport:G_.Default,hasStartJoinChannel:!1,isABTestSuccess:!1}}dispatch(c){this.state=function(u,h){switch(h.type){case Tn.SET_SESSION_ID:return yt(yt({},u),{},{sessionId:h.sessionId});case Tn.SET_P2P_ID:return yt(yt({},u),{},{p2pId:h.p2pId});case Tn.SET_UID:return yt(yt({},u),{},{uid:h.uid});case Tn.SET_INT_UID:return yt(yt({},u),{},{intUid:h.intUid});case Tn.SET_PUB_ID:return yt(yt({},u),{},{pubId:h.pubId});case Tn.KEY_METRIC_CLIENT_CREATED:return yt(yt({},u),{},{keyMetrics:yt(yt({},u.keyMetrics),{},{clientCreated:h.metric})});case Tn.KEY_METRIC_JOIN_START:return yt(yt({},u),{},{keyMetrics:yt(yt({},u.keyMetrics),{},{joinStart:h.metric})});case Tn.AVOID_JOIN_START:return yt(yt({},u),{},{avoidJoinStart:h.avoidJoinStart});case Tn.KEY_METRIC_JOIN_END:return yt(yt({},u),{},{keyMetrics:yt(yt({},u.keyMetrics),{},{joinEnd:h.metric})});case Tn.KEY_METRIC_REQUEST_AP_START:return yt(yt({},u),{},{keyMetrics:yt(yt({},u.keyMetrics),{},{requestAPStart:h.metric})});case Tn.KEY_METRIC_REQUEST_AP_END:return yt(yt({},u),{},{keyMetrics:yt(yt({},u.keyMetrics),{},{requestAPEnd:h.metric})});case Tn.KEY_METRIC_JOIN_GATEWAY_START:return yt(yt({},u),{},{keyMetrics:yt(yt({},u.keyMetrics),{},{joinGatewayStart:h.metric})});case Tn.KEY_METRIC_JOIN_GATEWAY_END:return yt(yt({},u),{},{keyMetrics:yt(yt({},u.keyMetrics),{},{joinGatewayEnd:h.metric})});case Tn.KEY_METRIC_PEER_CONNECTION_START:return yt(yt({},u),{},{keyMetrics:yt(yt({},u.keyMetrics),{},{peerConnectionStart:h.metric})});case Tn.KEY_METRIC_PEER_CONNECTION_END:return yt(yt({},u),{},{keyMetrics:yt(yt({},u.keyMetrics),{},{peerConnectionEnd:h.metric})});case Tn.KEY_METRIC_DESCRIPTION_START:return yt(yt({},u),{},{keyMetrics:yt(yt({},u.keyMetrics),{},{descriptionStart:h.metric})});case Tn.KEY_METRIC_SIGNAL_CHANNEL_OPEN:return yt(yt({},u),{},{keyMetrics:yt(yt({},u.keyMetrics),{},{signalChannelOpen:h.metric})});case Tn.KEY_METRIC_ICE_CONNECTION_END:return yt(yt({},u),{},{keyMetrics:yt(yt({},u.keyMetrics),{},{iceConnectionEnd:h.metric})});case Tn.KEY_METRIC_PUBLISH:{const m=u.keyMetrics.publish,y=m.findIndex(v=>v.trackId===h.metric.trackId);return y!==-1?(m[y]=yt(yt({},m[y]),h.metric),yt(yt({},u),{},{keyMetrics:yt(yt({},u.keyMetrics),{},{publish:[...m]})})):yt(yt({},u),{},{keyMetrics:yt(yt({},u.keyMetrics),{},{publish:[...u.keyMetrics.publish,h.metric]})})}case Tn.KEY_METRIC_SUBSCRIBE:{const m=u.keyMetrics.subscribe,y=m.findIndex(v=>v.userId===h.metric.userId&&v.type===h.metric.type);return y!==-1?(m[y]=yt(yt({},m[y]),h.metric),yt(yt({},u),{},{keyMetrics:yt(yt({},u.keyMetrics),{},{subscribe:[...m]})})):yt(yt({},u),{},{keyMetrics:yt(yt({},u.keyMetrics),{},{subscribe:[...u.keyMetrics.subscribe,h.metric]})})}case Tn.SET_CLOUD_PROXY_SERVER_MODE:return u.cloudProxyServerMode=h.mode,u;case Tn.RECORD_JOIN_CHANNEL_SERVICE:return typeof h.index!="number"?u.joinChannelServiceRecords=[...u.joinChannelServiceRecords,h.record]:(u.joinChannelServiceRecords[h.index]=yt(yt({},u.joinChannelServiceRecords[h.index]),h.record),u.joinChannelServiceRecords=[...u.joinChannelServiceRecords]),u;case Tn.RESET_JOIN_CHANNEL_SERVICE_RECORDS:return u.joinChannelServiceRecords=[],u;case Tn.RESET_KEY_METRICS:return u.keyMetrics={publish:[],subscribe:[]},u;case Tn.SET_USE_P2P:return yt(yt({},u),{},{useP2P:h.val});case Tn.SET_TRANSPORT_TYPE:return yt(yt({},u),{},{p2pTransport:h.val});default:return u}}(this.state,c)}set sessionId(c){this.dispatch({type:Tn.SET_SESSION_ID,sessionId:c})}get sessionId(){return this.state.sessionId}set cid(c){this.state.cid=c}get cid(){return this.state.cid}set codec(c){this.state.codec=c}get codec(){return this.state.codec}get mode(){return this.state.mode}get audioCodec(){return this.state.audioCodec}get clientId(){return this.state.clientId}set p2pId(c){this.dispatch({type:Tn.SET_P2P_ID,p2pId:c})}get p2pId(){return this.state.p2pId}set dcId(c){this.dispatch({type:Tn.SET_DC_ID,dcId:c})}get dcId(){return this.state.dcId}set uid(c){this.dispatch({type:Tn.SET_UID,uid:c})}get uid(){return this.state.uid}set intUid(c){this.dispatch({type:Tn.SET_INT_UID,intUid:c})}get intUid(){return this.state.intUid}set pubId(c){this.dispatch({type:Tn.SET_PUB_ID,pubId:c})}get pubId(){return this.state.pubId}set cloudProxyServerMode(c){this.dispatch({type:Tn.SET_CLOUD_PROXY_SERVER_MODE,mode:c})}get cloudProxyServerMode(){return this.state.cloudProxyServerMode}set useP2P(c){this.dispatch({type:Tn.SET_USE_P2P,val:c})}get useP2P(){return this.state.useP2P}set p2pTransport(c){this.dispatch({type:Tn.SET_TRANSPORT_TYPE,val:c})}get p2pTransport(){return this.state.p2pTransport}set hasStartJoinChannel(c){this.state.hasStartJoinChannel=c}get hasStartJoinChannel(){return this.state.hasStartJoinChannel}set isABTestSuccess(c){this.state.isABTestSuccess=c}get isABTestSuccess(){return this.state.isABTestSuccess}clientCreated(){this.dispatch({type:Tn.KEY_METRIC_CLIENT_CREATED,metric:Date.now()})}joinStart(){this.dispatch({type:Tn.KEY_METRIC_JOIN_START,metric:Date.now()})}joinEnd(){this.dispatch({type:Tn.KEY_METRIC_JOIN_END,metric:Date.now()})}requestAPStart(){this.dispatch({type:Tn.KEY_METRIC_REQUEST_AP_START,metric:Date.now()})}requestAPEnd(){this.dispatch({type:Tn.KEY_METRIC_REQUEST_AP_END,metric:Date.now()})}joinGatewayStart(){this.dispatch({type:Tn.KEY_METRIC_JOIN_GATEWAY_START,metric:Date.now()})}joinGatewayEnd(){this.dispatch({type:Tn.KEY_METRIC_JOIN_GATEWAY_END,metric:Date.now()})}peerConnectionStart(){this.dispatch({type:Tn.KEY_METRIC_PEER_CONNECTION_START,metric:Date.now()})}peerConnectionEnd(){this.dispatch({type:Tn.KEY_METRIC_PEER_CONNECTION_END,metric:Date.now()})}descriptionStart(){this.dispatch({type:Tn.KEY_METRIC_DESCRIPTION_START,metric:Date.now()})}signalChannelOpen(){this.dispatch({type:Tn.KEY_METRIC_SIGNAL_CHANNEL_OPEN,metric:Date.now()})}iceConnectionEnd(){this.dispatch({type:Tn.KEY_METRIC_ICE_CONNECTION_END,metric:Date.now()})}publish(c,u,h,m){this.dispatch({type:Tn.KEY_METRIC_PUBLISH,metric:yt(yt({trackId:c,type:u},h&&{publishStart:h}),m&&{publishEnd:m})})}subscribe(c,u,h,m,y,v,S){this.dispatch({type:Tn.KEY_METRIC_SUBSCRIBE,metric:yt(yt(yt(yt(yt({userId:c,type:u},h&&{subscribeStart:h}),m&&{subscribeEnd:m}),y&&{firstFrame:y}),v&&{streamAdded:v}),S&&{firstDecoded:S})})}massSubscribe(c,u,h,m){c.forEach(y=>{this.dispatch({type:Tn.KEY_METRIC_SUBSCRIBE,metric:yt(yt(yt({userId:y.userId,type:y.type},u&&{subscribeStart:u}),h&&{subscribeEnd:h}),m&&{firstFrame:m})})})}get keyMetrics(){return this.state.keyMetrics}recordJoinChannelService(c,u){c.service==="gateway"&&Array.isArray(c.urls)&&(c.urls=c.urls.map(h=>h.replace(/(\d+)-\d+-\d+-(\d+)/,"$1-*-*-$2")));try{return typeof u!="number"?(this.dispatch({type:Tn.RECORD_JOIN_CHANNEL_SERVICE,record:yt(yt({},c),{},{sessionId:this.sessionId,cloudProxyMode:this.cloudProxyServerMode,uid:this.uid})}),this.state.joinChannelServiceRecords.length-1):(u<0||u>=this.state.joinChannelServiceRecords.length||this.dispatch({type:Tn.RECORD_JOIN_CHANNEL_SERVICE,record:c,index:u}),u)}catch{return 0}}resetJoinChannelServiceRecords(){this.dispatch({type:Tn.RESET_JOIN_CHANNEL_SERVICE_RECORDS})}resetKeyMetrics(){this.dispatch({type:Tn.RESET_KEY_METRICS})}get joinChannelServiceRecords(){try{return this.state.joinChannelServiceRecords}catch{return[]}}get avoidJoinStart(){return this.state.avoidJoinStart}set avoidJoinStart(c){this.dispatch({type:Tn.AVOID_JOIN_START,avoidJoinStart:c})}}(t.codec,t.audioCodec,t.mode,this._clientId),this._leaveMutex=new Fs("client-leave",this._clientId),this._publishMutex=new Fs("client-publish",this._clientId),this._renewTokenMutex=new Fs("client-renewtoken",this._clientId),this._subscribeMutex=new Fs("client-subscribe",this._clientId),this.store.clientCreated(),t.proxyServer&&this.setProxyServer(t.proxyServer,!0),t.turnServer&&this.setTurnServer(t.turnServer,!0),x.info("[".concat(this._clientId,"] Initializing AgoraRTC client v").concat(Al," build: ").concat(xL,", mode: ").concat(this.mode,", codec: ").concat(this.codec)),t.clientRoleOptions)try{SL(t.clientRoleOptions),s=Object.assign({},t.clientRoleOptions)}catch(c){x.warning("[".concat(this._clientId,"] ").concat(c.toString()))}var a;this._statsCollector=new qT(this.store),this._statsCollector.onStatsException=(c,u,h)=>{x.warn("[".concat(this._clientId,"] receive exception msg, code: ").concat(c,", msg: ").concat(u,", uid: ").concat(h)),this.safeEmit(bn.EXCEPTION,{code:c,msg:u,uid:h})},this._statsCollector.onUploadPublishDuration=(c,u,h,m)=>{const y=this._users.find(v=>v.uid===c);y&&At.peerPublishStatus(this._sessionId,{subscribeElapse:m,audioPublishDuration:u,videoPublishDuration:h,peer:y._uintid})},this.store.useP2P=t.mode==="p2p",this._gateway=new Ige(this.store,{clientId:this._clientId,mode:this.mode,codec:this.codec,websocketRetryConfig:t.websocketRetryConfig||ki,httpRetryConfig:t.httpRetryConfig||ki,forceWaitGatewayResponse:t.forceWaitGatewayResponse===void 0||t.forceWaitGatewayResponse,statsCollector:this._statsCollector,role:t.role,clientRoleOptions:s}),this._configDistribute=new Uge(this._clientId,this.store),this.store.useP2P?(this._p2pChannel=(a={store:this.store,statsCollector:this._statsCollector},hp("P2PChannel").create(a)),this._handleP2PEvents()):this._p2pChannel=new XT(this.store,this._statsCollector),this._handleP2PChannelEvents(),this._handleGatewayEvents(),this._handleGatewaySignalEvents()}async joinMeta(t,r,s,a,c){let u=!(arguments.length>5&&arguments[5]!==void 0)||arguments[5],h=arguments.length>6&&arguments[6]!==void 0&&arguments[6];rr("JOIN_GATEWAY_USE_443PORT_ONLY",u),rr("JOIN_GATEWAY_USE_DUAL_DOMAIN",h);const m=this._gateway.signal.websocket;return m instanceof f2&&(m.use443PortOnly=u,m.tryDoubleDomain=h),async function(y,v,S){$A.get(y)||$A.set(y,[]),KA.get(y)||KA.set(y,v),Sh.get(y)||Sh.set(y,0);const R=$A.get(y),P=KA.get(y);if(!R||!P)throw new Error("concurrent: deferQueue or maxConcurrency is null");if(Sh.get(y)===P){const Y=CT();R.push(Y),await Y.promise}Sh.set(y,Sh.get(y)+1);for(var D=arguments.length,G=new Array(D>3?D-3:0),F=3;F<D;F++)G[F-3]=arguments[F];const j=await S(...G);return Sh.set(y,Sh.get(y)-1),Sh.get(y)===P-1&&R.length>0&&(R[0].resolve(),R.shift()),Sh.get(y)===0&&($A.set(y,[]),KA.set(y,0),Sh.set(y,0)),j}("client.join",oe("JOIN_MAX_CONCURRENCY"),this.join.bind(this),t,r,s,a,c)}async join(t,r,s,a,c){const u=++this._numberOfJoinCount;this.store.joinStart(),a&&(this.store.uid=a);const h=(eP||eP||(eP=(window.location.protocol.split(":")[0]||"").toUpperCase(),eP))==="HTTPS",m=X8()?window.isSecureContext:"Browser Not Support";(!X8()&&!h||!window.isSecureContext)&&x.warning("The website must be running in a secure context (About secure context: https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts ), otherwise the media collection will be restricted by the browser"),this.connectionState==="DISCONNECTED"&&(this.store.avoidJoinStart=Math.round(Date.now()),x.debug("[".concat(this._clientId,"] set avoidJoinStart to ").concat(this.store.avoidJoinStart))),At.setAppId(t);try{if(!s&&s!==null)throw new Oe(te.INVALID_PARAMS,"Invalid token: ".concat(s,". If you don not use token, set it to null"));s&&fs(s,"token",1,2047),fs(t,"appid",1,2047),bP(r),a&&TP(a),c&&fs(c,"optionalInfo",1,2047)}catch(F){throw At.reportApiInvoke(z_(),{name:Oi.JOIN,options:[t,r,s,a],states:{isHttps:h,isSecureContext:m},tag:Hr.TRACER}).onError(F),F}if(this._leaveMutex.isLocked&&(x.debug("[".concat(this._clientId,"] join: waiting leave operation")),(await this._leaveMutex.lock())(),x.debug("[".concat(this._clientId,"] join: continue"))),this._joinAndNotLeaveYet=!0,this.connectionState!=="DISCONNECTED"){const F=new Oe(te.INVALID_OPERATION,"[".concat(this._clientId,"] Client already in connecting/connected state"));throw At.reportApiInvoke(z_(),{name:Oi.JOIN,options:[t,r,s,a],states:{isHttps:h,isSecureContext:m},tag:Hr.TRACER}).onError(F),F}this._gateway.state="CONNECTING";const y=await Y9({appId:t,cname:r,uid:a,stringUid:typeof a=="string"?a:void 0,token:s||t,cloudProxyServer:this._cloudProxyServerMode});if(!this._joinAndNotLeaveYet)throw new Oe(te.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));const v=(y==null?void 0:y.sid)||z_();x.info("[".concat(this._clientId,"] start join channel ").concat(r,", join number: ").concat(u)),this._sessionId||(this._sessionId=v,this.store.sessionId=this._sessionId);const S=At.reportApiInvoke(v,{id:this._clientId,name:Oi.JOIN,options:[t,r,s,a],states:{isHttps:h,isSecureContext:m},tag:Hr.TRACER}),R=Pu(Pu(Pu({},this._rtmConfig),{},{role:this.role,clientId:this._clientId,appId:t,sid:this._sessionId,cname:r,uid:typeof a!="string"?a:null,turnServer:this._turnServer,proxyServer:this._proxyServer,token:s||t,cloudProxyServer:this._cloudProxyServerMode,optionalInfo:c,license:this._license,useLocalAccessPoint:this._useLocalAccessPoint,preload:!!y},this._remoteDefaultVideoStreamType!==void 0&&{defaultVideoStream:this._remoteDefaultVideoStreamType}),{},{apRequestDetail:oe("AP_REQUEST_DETAIL")||void 0});if(this._useLocalAccessPoint&&(R.setLocalAPVersion=this._setLocalAPVersion),typeof a=="string"&&(R.stringUid=a,this._uintUid?(R.uid=this._uintUid,this._uintUid=void 0):R.uid=0),this._encryptionMode!=="none"&&this._encryptionSecret){if(R.aesmode=this._encryptionMode,R.aespassword=await(async F=>{const j=function(Se){const we=window.atob(`MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDCMnXAHkKIGAM+x4N22gCI+Wyu
STM9ztkT3uYslTT2PuKmZfPzhH6kVdO7PTjGCOZnAsyb3oTtWat0KcxQ4jxvqQV+
HvYl3iI1Yd4vl2c3qRMJPLtRDfNxa2Mcxgq7e9aEUibzdd0st+OJAy3tOj/Y0aVy
xQiYDz3vqa6bP29adwIDAQAB`),ye=new Uint8Array(new ArrayBuffer(we.length));for(let Ne=0;Ne<we.length;Ne+=1)ye[Ne]=we.charCodeAt(Ne);return ye}(),Y=await window.crypto.subtle.importKey("spki",j,{name:"RSA-OAEP",hash:"SHA-256"},!0,["encrypt"]),ee=EL(F),fe=await window.crypto.subtle.encrypt({name:"RSA-OAEP"},Y,ee);return function(Se){let we="";for(let ye=0;ye<Se.length;ye+=1)we+=String.fromCharCode(Se[ye]);return window.btoa(we)}(new Uint8Array(fe))})(this._encryptionSecret),!this._joinAndNotLeaveYet)throw new Oe(te.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));this._encryptionSalt&&(R.aessalt=this._encryptionSalt)}if(this._encryptDataStream&&(this._encryptionMode==="aes-128-gcm2"||this._encryptionMode==="aes-256-gcm2"))if(this._encryptionSalt&&this._encryptionSecret)if(window.crypto.subtle){const F=new TextEncoder,j=oe("USE_PURE_ENCRYPTION_MASTER_KEY")?F.encode(R.appId+this._encryptionSecret+this._encryptionSecret):F.encode(R.appId+R.cname+this._encryptionSecret);this._encryptDataStreamIv=await async function(Y,ee,fe){const Se=await window.crypto.subtle.importKey("raw",ee,"PBKDF2",!1,["deriveBits","deriveKey"]),we=Y==="aes-128-gcm2"?128:256,ye=await window.crypto.subtle.deriveBits({name:"PBKDF2",iterations:oz,hash:"SHA-256",salt:fe},Se,we+rme);return new Uint8Array(ye).subarray(we/8)}(this._encryptionMode,j,W_(this._encryptionSalt)),this._encryptDataStreamKey=await async function(Y,ee,fe){const Se=await window.crypto.subtle.importKey("raw",ee,"PBKDF2",!1,["deriveBits","deriveKey"]),we=Y==="aes-128-gcm2"?128:256;return await window.crypto.subtle.deriveKey({name:"PBKDF2",iterations:oz,hash:"SHA-256",salt:fe},Se,{name:"AES-GCM",length:we},!0,["encrypt","decrypt"])}(this._encryptionMode,j,W_(this._encryptionSalt))}else m?x.warning("[".concat(this._clientId,"] encrypt datastream must be running in a secure context, fallback to plain data stream")):x.warning("[".concat(this._clientId,"] current browser do not support WebCrypto ,fallback to plain data stream")),this._encryptDataStream=!1;else this._encryptDataStream=!1,x.debug("[".concat(this._clientId,"] no salt / secret, cannot support encrypt data stream, fallback to plain data stream"));this._startSession(this._sessionId,{channel:r,appId:t,stringUid:R.stringUid});const P=this._sessionId;setTimeout(()=>{this.connectionState==="CONNECTING"&&P===this._sessionId&&At.joinChannelTimeout(this._sessionId,5)},5e3);try{var D;let F;const j=R.cloudProxyServer;if(ot(D=["proxy3","proxy4","proxy5"]).call(D,j)){const we=oe("PROXY_SERVER_TYPE3");Array.isArray(we)?R.proxyServer=we[0]:R.proxyServer=we}if(At.setProxyServer(R.proxyServer),x.setProxyServer(R.proxyServer),this.store.requestAPStart(),y){if(x.debug("[".concat(this._clientId,"] get serverInfo Success from Preload Cache ").concat(R.stringUid?", ".concat(R.stringUid," => ").concat(y.intUid):""," ")),R.stringUid&&!R.uid&&(R.uid=y.intUid),F={gatewayInfo:y.ap.gatewayInfo},oe("JOIN_WITH_FALLBACK_MEDIA_PROXY")&&R.turnServer.mode==="auto")if(y.ap.proxyInfo.addresses.length===0)x.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers");else{const we=(await BH(y.ap.proxyInfo,y.ap.gatewayInfo.uid)).map(ye=>({turnServerURL:ye.address,tcpport:ye.tcpport||Ns.tcpport,udpport:ye.udpport||Ns.udpport,username:ye.username||Ns.username,password:ye.password||Ns.password,forceturn:!1,security:!0}));R.turnServer={mode:"manual",servers:we}}Q9(y,R.stringUid)}else{if(R.stringUid&&!R.uid){let we;[we,F]=await dt.all([m9(R.stringUid,R,this._axiosCancelSource.token,this._config.httpRetryConfig||ki,this.store),p9(R,this._axiosCancelSource.token,this._config.httpRetryConfig||ki,!0,this.store)]),x.debug("[".concat(this._clientId,"] getUserAccount Success ").concat(R.stringUid," => ").concat(we)),R.uid=we,F.gatewayInfo.uid=we,F.gatewayInfo.res.uid=we}else F=await p9(R,this._axiosCancelSource.token,this._config.httpRetryConfig||ki,!0,this.store);if(!this._joinAndNotLeaveYet)throw new Oe(te.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"))}this.store.requestAPEnd(),setTimeout(()=>{this._configDistribute.startGetConfigDistribute(R,this._axiosCancelSource.token),this._configDistribute.on(FT.UPDATE_BITRATE_LIMIT,we=>{this._p2pChannel.updateBitrateLimit(we)}),this._configDistribute.on(FT.UPDATE_CLIENT_ROLE_OPTIONS,we=>{this._setClientRoleOptions(we)})},0),this._key=s||t;const Y=F.gatewayInfo,ee=R.uid?R.uid:Y.uid;this._joinInfo=Pu(Pu({},R),{},{cid:Y.cid,uid:ee,vid:Y.vid,apResponse:Y.res,apGatewayAddress:Y.apGatewayAddress,uni_lbs_ip:Y.uni_lbs_ip,gatewayAddrs:Y.gatewayAddrs}),this.store.intUid=ee,this.store.cid=Y.cid;const fe=await this._joinGateway();if(!this._joinAndNotLeaveYet)throw new Oe(te.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));S.onSuccess(fe),this._appId=t,this._channelName=R.cname,this._uid=fe,this.store.uid=fe,setTimeout(()=>{this._networkQualityInterval&&window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=window.setInterval(this._handleUpdateNetworkQuality,2e3),window.addEventListener(Ps()?"beforeunload":"pagehide",this._handleBeforeUnload),this._statsCollector.startUpdateStats()},0);const Se=R.stringUid?"string uid: ".concat(R.stringUid,",uid: ").concat(R.uid):"uid: ".concat(this._uid);return x.info("[".concat(this._clientId,"] Joining channel success: channel: ").concat(r,",").concat(Se)),setTimeout(()=>{x.startUpload()},5e3),this.store.joinEnd(),G=this,ot(X_).call(X_,G)||X_.push(G),this._cloudProxyServerMode==="disabled"&&jn().supportWebCrypto&&oe("ENABLE_PRELOAD")&&j2(this._joinInfo),fe}catch(F){const j=Array.isArray(F)?F[0]:F;throw j&&j.code===te.OPERATION_ABORTED?x.warning("[".concat(this._clientId,"] join number: ").concat(u,", Joining channel failed, rollback"),j):x.error("[".concat(this._clientId,"] join number: ").concat(u,", Joining channel failed, rollback"),j),j.code!==te.OPERATION_ABORTED&&this._numberOfJoinCount===u&&(this._gateway.state="DISCONNECTED",this._reset()),S.onError(j),j}var G}_joinGateway(){if(!this._joinInfo||!this._key)throw new Oe(te.INVALID_OPERATION);return this._gateway.join(this._joinInfo,this._key,!(this._joinInfo.cloudProxyServer!=="disabled"||this._joinInfo.proxyServer||!oe("JOIN_WITH_FALLBACK_SIGNAL_PROXY")))}async leave(){x.info("[".concat(this._clientId,"] Leaving channel")),window.removeEventListener(Ps()?"beforeunload":"pagehide",this._handleBeforeUnload),this._reset(),function(r){const s=X_.indexOf(r);s!==-1&&X_.splice(s,1)}(this),this._statsCollector.stopUpdateStats();const t=await this._leaveMutex.lock();if(this.connectionState==="DISCONNECTED")return x.info("[".concat(this._clientId,"] Leaving channel repeated, success")),void t();await this._gateway.leave(this.connectionState!=="CONNECTED",qn.LEAVE),x.info("[".concat(this._clientId,"] Leaving channel success")),this._joinAndNotLeaveYet=!1,this.store.resetJoinChannelServiceRecords(),t()}async publish(t){let r=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!Array.isArray(t)){if(!(t instanceof Zv))return this._publishDataChannel(t);t=[t]}if(t.length===0)throw new Oe(te.INVALID_PARAMS,"param list is empty");const s=t;if(this._gateway.role==="audience")throw new Oe(te.INVALID_OPERATION,"audience can not publish stream");for(const c of s){if(!(c instanceof Zv))throw new Oe(te.INVALID_PARAMS,"parameter is not local track");if(!c._enabled&&r)throw new Oe(te.TRACK_IS_DISABLED,"can not publish a disabled track: ".concat(c.getTrackId()))}x.info("[".concat(this._clientId,"] Publishing tracks, id ").concat(s.map(c=>"".concat(c.getTrackId()," "))));const a=await this._publishMutex.lock();await this._configDistribute.awaitConfigDistributeComplete(),r&&s.forEach(c=>{const u=this._configDistribute.getBitrateLimit();c instanceof Tr&&u&&c.setBitrateLimit(u.uplink)});try{await this._publishHighStream(s),x.info("[".concat(this._clientId,"] Publish success, id ").concat(s.map(c=>"".concat(c.getTrackId()," "))))}catch(c){throw x.error("[".concat(this._clientId,"] publish error"),c.toString()),c}finally{a()}}async _publishDataChannel(t){or(t.id,"id",0,65535,!0),sp(t.ordered,"ordered"),fs(t.metadata,"metadata",0,512),x.info("[".concat(this._clientId,"] Publishing datachannels, id ").concat(t.id));const r=await this._publishMutex.lock();try{if(this._p2pChannel.getAllDataChannels().findIndex(c=>c.id===t.id)!==-1)throw new Oe(te.INVALID_PARAMS,"Invalid id: ".concat(t.id,". If you want to republish the datachannel, unpublish first"));if(!this._joinInfo||this._uid===void 0)throw new Oe(te.INVALID_OPERATION,"Can't publish datachannel, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Oe(te.INVALID_OPERATION,"can not publish datachannel in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&oe("FORCE_TURN")&&!oe("TURN_ENABLE_TCP")&&!oe("TURN_ENABLE_UDP"))throw new Oe(te.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");const s=function(c){return s9(c,!1)}(t),a=await this._p2pChannel.publishDataChannel([s]);if(a.length>0){if(typeof s._originDataChannelId!="number")throw x.error("[".concat(this._clientId,"] can not publish with mediaType datachannel, cannot get RTCDatachannel id")),new Oe(te.CREATE_DATACHANNEL_ERROR);try{await dt.all(a.map(c=>this._uid&&this._gateway.publishDataChannel(this._uid,c,!0))),await s._waitTillOpen()}catch(c){if(c.code!==te.DISCONNECT_P2P)throw c}}return x.info("[".concat(this._clientId,"] Publish dataChannels success, id ").concat(s.id)),s}catch(s){throw x.error("[".concat(this._clientId,"] publish datachannels error"),s.toString()),s}finally{r()}}async unpublish(t){if(!this._joinInfo||this._uid===void 0)throw new Oe(te.INVALID_OPERATION,"Can't unpublish stream, haven't joined yet!");let r=[];if(t)if(Array.isArray(t))r=t;else{if(!(t instanceof Zv))return this._unpublishDataChannel([t]);r=[t]}else this.store.useP2P||await this._unpublishDataChannel(),r=this._p2pChannel.getAllTracks(!0);x.info("[".concat(this._clientId,"] Unpublish tracks, tracks ").concat(r.map(a=>"".concat(a.getTrackId()," "))," "));const s=await this._publishMutex.lock();try{if(this.store.useP2P){const a=await this._p2pChannel.unpublish(r);a&&await this._gateway.sendExtensionMessage(ui.UNPUBLISH,{unpubMsg:a},!0)}else{const a=await this._p2pChannel.unpublish(r);a&&await this._gateway.unpublish(a,this._uid),x.info("[".concat(this._clientId,"] Unpublish success,tracks ").concat(r.map(c=>"".concat(c.getTrackId()))))}}catch(a){throw x.error("[".concat(this._clientId,"] unpublish error"),a.toString()),a}finally{s&&s()}}async _unpublishDataChannel(t){t!==void 0&&t.length!==0||(t=this._p2pChannel.getAllDataChannels()),x.info("[".concat(this._clientId,"] Unpublish datachannels, datachannels ").concat(t.map(s=>"".concat(s.id," "))," "));const r=await this._publishMutex.lock();try{const s=await this._p2pChannel.unpublishDataChannel(t);s&&await this._gateway.unpublishDataChannel(s),x.info("[".concat(this._clientId,"] Unpublish dataChannel success,dataChannel ").concat(t.map(a=>"".concat(a.id))))}catch(s){throw x.error("[".concat(this._clientId,"] unpublish dataChannel error"),s.toString()),s}finally{r&&r()}}async subscribe(t,r,s){if(!(t instanceof Zm)){const a=this.remoteUsers.find(c=>c.uid===t);if(!a)throw new Oe(te.INVALID_REMOTE_USER,"user is not in the channel");t=a}return r==="datachannel"?this._subscribeDataChannel(t,s):this._subscribe(t,r)}async presubscribe(t,r){if(Hi(r,"mediaType",["audio","video"]),this.store.useP2P)throw new Oe(te.INVALID_OPERATION,"can't presub at p2p mode");if(!this._joinInfo)throw new Oe(te.INVALID_OPERATION,"can't presub when not join");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Oe(te.INVALID_OPERATION,"can't presub in ".concat(this.connectionState," state"));const s=r===Et.AUDIO,a=r===Et.VIDEO,c=await this._subscribeMutex.lock();try{const{ssrcId:u,ortc:h,rtxSsrcId:m,cname:y,uint_id:v}=await this._gateway.presubscribe(t,r,!0);if(u==null)throw new Oe(te.UNEXPECTED_RESPONSE,"no ssrc id");let S=this._users.find(P=>P.uid===t);S||(S=new Zm(t,v||t),S._is_pre_created=!0,this._users.push(S)),y&&(S._cname=y),S._uintid||(S._uintid=v||t),s&&(S._audioSSRC=u,S._audio_pre_subscribed=!0,h&&(S._audioOrtc=h)),a&&(S._videoSSRC=u,S._video_pre_subscribed=!0,h&&(S._videoOrtc=h),m!=null&&(S._rtxSsrcId=m)),x.info("[".concat(this._clientId,"] presub succeed ssrc: ").concat(u)),await this._p2pChannel.subscribe(S,r,u,m,h);const R=s?S._audioTrack:S._videoTrack;if(!R)throw new Oe(te.UNEXPECTED_ERROR,"can not find remote track in user");return s&&(S._trust_audio_stream_added_state_=!0,S._audio_added_=!0),a&&(S._trust_video_stream_added_state_=!0,S._video_added_=!0),R}catch(u){throw x.error("[".concat(this._clientId,"] presub user ").concat(t," error"),u),u}finally{c()}}async _subscribeDataChannel(t,r){var s;if(or(r,"channelId",0,65535,!0),!this._joinInfo)throw new Oe(te.INVALID_OPERATION,"Can't subscribe datachannel, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Oe(te.INVALID_OPERATION,"Can't subscribe datachannel in ".concat(this.connectionState," state"));if(!this._users.find(m=>m===t))throw x.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", this user is not in the channel")),new Oe(te.INVALID_REMOTE_USER,"user is not in the channel");if(!t.hasAudio&&!t.hasVideo&&t._dataChannels.length===0)throw x.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", user is not published")),new Oe(te.INVALID_REMOTE_USER,"user is not published");const c=(s=t._dataChannels)===null||s===void 0?void 0:s.find(m=>m.id===r);if(!c)throw x.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid," with mediaType datachannel, remote datachannel is not published")),new Oe(te.REMOTE_USER_IS_NOT_PUBLISHED);const u=await this._subscribeMutex.lock();x.info("[".concat(this._clientId,"] subscribe user ").concat(t.uid,", mediaType: datachannel"));try{const m=await this._p2pChannel.subscribeDataChannel(t,[c]);if(m&&ot(m).call(m,c.id))try{var h;if(typeof c._originDataChannelId!="number")throw x.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid," with mediaType datachannel, cannot get RTCDatachannel")),new Oe(te.CREATE_DATACHANNEL_ERROR);const y={id:c.id,datachannelId:c._originDataChannelId,ordered:c.ordered,maxRetransmits:c.maxRetransmits,metadata:(h=c.metadata)!==null&&h!==void 0?h:""};await this._gateway.subscribeDataChannel(t.uid,y,!0),await c._waitTillOpen()}catch(y){if((y==null?void 0:y.code)!==te.WS_ABORT)throw await this._p2pChannel.unsubscribeDataChannel(t,[c]),y;await this._p2pChannel.unsubscribeDataChannel(t,[c]),this._p2pChannel.setPendingRemoteDataChannel(t,c.id)}return x.info("[".concat(this._clientId,"] subscribe success user ").concat(t.uid,", mediaType: datachannel")),c}finally{u()}}async _p2pSubscribe(t,r,s){if(Hi(r,"mediaType",["audio","video"]),!this._joinInfo)throw new Oe(te.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Oe(te.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(u=>u===t)){const u=new Oe(te.INVALID_REMOTE_USER,"user is not in the channel");throw x.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", this user is not in the channel")),u}if(!t.hasAudio&&!t.hasVideo){const u=new Oe(te.INVALID_REMOTE_USER,"user is not published");throw x.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", user is not published")),u}if(!s&&(r==="audio"&&!t.hasAudio||r==="video"&&!t.hasVideo)){const u=new Oe(te.REMOTE_USER_IS_NOT_PUBLISHED);throw x.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid," with mediaType ").concat(r,", remote track is not published")),u}const c=await this._subscribeMutex.lock();x.info("[".concat(this._clientId,"] subscribe user ").concat(t.uid,", mediaType: ").concat(r));try{if(await this._p2pChannel.hasRemoteMediaWithLock(t,r))await this._p2pChannel.unmuteRemote(t,r);else try{const h=r==="audio"?t._audioSSRC:t._videoSSRC,m=r==="audio"?t._audioMid:t._videoMid;this.store.subscribe(t.uid,r,Date.now()),this.store.useP2P&&await this._p2pChannel.subscribe(t,r,h,m)}catch(h){throw h}x.info("[".concat(this._clientId,"] subscribe success user ").concat(t.uid,", mediaType: ").concat(r)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(t.uid,this._defaultStreamFallbackType).catch(h=>{x.warning("[".concat(this._clientId,"] auto set fallback failed"),h)});const u=r==="audio"?t._audioTrack:t._videoTrack;if(!u)throw new Oe(te.UNEXPECTED_ERROR,"can not find remote track in user object");return u}catch(u){throw x.error("[".concat(this._clientId,"] subscribe user ").concat(t.uid," error"),u),u}finally{c()}}async _subscribe(t,r,s){if(this.store.useP2P)return this._p2pSubscribe(t,r);if(Hi(r,"mediaType",["audio","video"]),!this._joinInfo)throw new Oe(te.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Oe(te.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(v=>v===t)){const v=new Oe(te.INVALID_REMOTE_USER,"user is not in the channel");throw x.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", this user is not in the channel")),v}if(!t.hasAudio&&!t.hasVideo){const v=new Oe(te.INVALID_REMOTE_USER,"user is not published");throw x.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", user is not published")),v}if(!(s||(r!=="audio"||t.hasAudio&&t._audioSSRC!==void 0)&&(r!=="video"||t.hasVideo&&t._videoSSRC!==void 0))){const v=new Oe(te.REMOTE_USER_IS_NOT_PUBLISHED);throw x.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid," with mediaType ").concat(r,", remote track is not published")),v}let c=r==="audio"?t._audioSSRC:t._videoSSRC,u=r==="audio"?t._audioOrtc:t._videoOrtc,h=r==="video"?t._rtxSsrcId:void 0,m={stream_type:r==="audio"?Et.AUDIO:Et.VIDEO,ssrcId:c};const y=await this._subscribeMutex.lock();x.info("[".concat(this._clientId,"] subscribe user ").concat(t.uid,", mediaType: ").concat(r));try{if(await this._p2pChannel.hasRemoteMediaWithLock(t,r))await this._p2pChannel.unmuteRemote(t,r);else try{const S=r==="audio"?t._audioSSRC:t._videoSSRC;S!==void 0&&S!==c&&(c=S,u=r==="audio"?t._audioOrtc:t._videoOrtc,h=r==="video"?t._rtxSsrcId:void 0,m={stream_type:r==="audio"?Et.AUDIO:Et.VIDEO,ssrcId:c}),Ws.markSubscribeStart(this.store.clientId,c),this.store.subscribe(t.uid,r,Date.now()),await this._p2pChannel.subscribe(t,r,c,h,u);try{this._p2pChannel.isPreSubScribe(c)||await this._gateway.subscribe(t.uid,m,!0)}catch(R){if((R==null?void 0:R.code)!==te.WS_ABORT)throw await this._p2pChannel.unsubscribe(t,r),R;await this._p2pChannel.unsubscribe(t,r,!0),this._p2pChannel.setPendingRemoteMedia(t,r)}this.store.subscribe(t.uid,r,void 0,Date.now()),this._p2pChannel.reportSubscribeEvent(!0,null,t,r)}catch(S){throw this._p2pChannel.reportSubscribeEvent(!1,S==null?void 0:S.code,t,r),S}x.info("[".concat(this._clientId,"] subscribe success user ").concat(t.uid,", mediaType: ").concat(r)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(t.uid,this._defaultStreamFallbackType).catch(S=>{x.warning("[".concat(this._clientId,"] auto set fallback failed"),S)});const v=r==="audio"?t._audioTrack:t._videoTrack;if(!v)throw new Oe(te.UNEXPECTED_ERROR,"can not find remote track in user object");return v}catch(v){throw x.error("[".concat(this._clientId,"] subscribe user ").concat(t.uid," error"),v),v}finally{y()}}async massSubscribe(t){if(op(t,"subscribeList"),!this._joinInfo)throw new Oe(te.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Oe(te.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));const r=Date.now(),s=new Map,a=await this._subscribeMutex.lock();x.info("[".concat(this._clientId,"]start massSubscribe user ").concat(t.map(m=>{let{user:y,mediaType:v}=m;return"user: ".concat(y==null?void 0:y.uid,", mediaType: ").concat(v)}).join("; ")));const c=(t=[...t]).map(m=>{let{user:y,mediaType:v}=m;return{user:y,mediaType:v}}),u=await this._p2pChannel.globalLock();try{var h;for(let y=t.length-1;y>=0;y--){const v=t[y],{user:S,mediaType:R}=v;if(Hi(R,"mediaType",["audio","video"]),!S){const F=new Oe(te.INVALID_PARAMS,"user property does not exist in subscribeList item");throw x.error("[".concat(this._clientId,"] user property does not exist in subscribeList item")),F}if(!this._users.find(F=>F===S)){const F=new Oe(te.INVALID_REMOTE_USER,"user is not in the channel");x.error("[".concat(this._clientId,"] can not massSubscribe ").concat(S.uid,", this user is not in the channel")),c[y].error=F,t.splice(y,1);continue}if(R==="audio"&&(!S.hasAudio||S._audioSSRC===void 0)||R==="video"&&(!S.hasVideo||S._videoSSRC===void 0)){const F=new Oe(te.REMOTE_USER_IS_NOT_PUBLISHED);x.error("[".concat(this._clientId,"] can not subscribe ").concat(S.uid," with mediaType ").concat(R,", remote user is not published")),c[y].error=F,t.splice(y,1);continue}const D=es.Video|es.LwoVideo,G=s.get(S);if(G){if(R==="video"?G&D:G&es.Audio){t.splice(y,1),x.warning("[".concat(this._clientId,"] repeat massSubscribe user:").concat(S.uid,", mediaType:").concat(R," twice"));continue}s.set(S,G|(R==="video"?D:es.Audio))}else s.set(S,R==="video"?D:es.Audio)}for(let y=t.length-1;y>=0;y--){const v=t[y],{user:S,mediaType:R}=v,P=es.Video|es.LwoVideo;if(this._p2pChannel.hasRemoteMedia(S,R)){await this._p2pChannel.unmuteRemoteNoLock(S,R);const D=s.get(S);s.set(S,R==="video"?D^P:D^es.Audio),t.splice(y,1)}}this.store.massSubscribe(t.map(y=>({userId:y.user.uid,type:y.mediaType})),r);let m=hc(h=Array.from(s.entries())).call(h,(y,v)=>{let[S,R]=v;if(R===0)return y;const P={stream_id:S.uid,stream_type:R};return R&es.Audio&&(P.audio_ssrc=S._audioSSRC),R&es.Video&&(P.video_ssrc=S._videoSSRC),y.push(P),y},[]);try{t.length>0&&await this._p2pChannel.massSubscribeNoLock(t.map(v=>{let{user:S,mediaType:R}=v;return{user:S,mediaType:R,ssrcId:R===Et.VIDEO?S._videoSSRC:S._audioSSRC,rtxSsrcId:R===Et.VIDEO?S._rtxSsrcId:void 0}}));const y=new Map;if(m=m.filter(v=>v.video_ssrc&&!this._p2pChannel.isPreSubScribe(v.video_ssrc)||v.audio_ssrc&&!this._p2pChannel.isPreSubScribe(v.audio_ssrc)||!v.video_ssrc&&!v.audio_ssrc),m.length>0){const v=await this._gateway.subscribeAll(m,!0);((v==null?void 0:v.users)||[]).forEach(S=>{let{stream_id:R,video_error_code:P,audio_error_code:D,error_code:G}=S;(P||D||G)&&y.set(R,{video_error_code:P,audio_error_code:D,error_code:G})})}if(Array.from(y.entries()).length>0){const v=[];Array.from(y.entries()).forEach(S=>{let[R,P]=S;const D=this.remoteUsers.find(G=>G.uid===R);if(D){let G;P.error_code||P.video_error_code&&P.audio_error_code?G=void 0:P.video_error_code?G=Et.VIDEO:P.audio_error_code&&(G=Et.AUDIO),v.push({user:D,mediaType:G})}}),v.length>0&&await this._p2pChannel.massUnsubscribeNoLock(v)}for(const v of c){const S=y.get(v.user.uid);if(S){const R=S.error_code||v.mediaType==="audio"&&S.audio_error_code||v.mediaType==="video"&&S.video_error_code;if(R){const P=jT(R);x.error("user:".concat(v.user.uid," mediaType:").concat(v.mediaType," has massSubscribe error ").concat(P.desc)),v.error=new Oe(te.SUBSCRIBE_FAILED,"code ".concat(R,": ").concat(P.desc))}}v.error||(v.mediaType==="video"?v.track=v.user.videoTrack:v.track=v.user.audioTrack)}return this.store.massSubscribe(c.filter(v=>!v.error).map(v=>({userId:v.user.uid,type:v.mediaType})),void 0,Date.now()),c.forEach(v=>{var S;At.subscribe(this.store.sessionId,{succ:!!v.error,ec:((S=v.error)===null||S===void 0?void 0:S.code)||null,video:v.mediaType===Et.VIDEO,audio:v.mediaType===Et.AUDIO,peerid:v.user.uid,subscribeRequestid:v.mediaType===Et.VIDEO?v.user._videoSSRC:v.user._audioSSRC,p2pid:this.store.p2pId,eventElapse:Math.floor(performance.now()-r),preSsrc:this._p2pChannel.isPreSubScribe(v.user._videoSSRC)},!0)}),x.info("[".concat(this._clientId,"] massSubscribe success ").concat(t.map(v=>{let{user:S,mediaType:R}=v;return"user: ".concat(S==null?void 0:S.uid,", mediaType: ").concat(R)}).join("; "))),c}catch(y){throw await this._p2pChannel.massUnsubscribeNoLock(t),y}}finally{u(),a()}}async unsubscribe(t,r,s){if(!(t instanceof Zm)){const u=this.remoteUsers.find(h=>h.uid===t);if(!u)throw new Oe(te.INVALID_REMOTE_USER,"user is not in the channel");t=u}if(r||this.store.useP2P){if(r==="datachannel")return this._unsubscribeDataChannel(t,s)}else await this._unsubscribeDataChannel(t,s);if(r&&Hi(r,"mediaType",["audio","video"]),!this._joinInfo)throw new Oe(te.INVALID_OPERATION,"Can't unsubscribe stream, haven't joined yet!");if(!this._users.find(u=>u===t)){const u=new Oe(te.INVALID_REMOTE_USER,"user is not in the channel");throw x.error("[".concat(this._clientId,"] can not unsubscribe ").concat(t.uid,", user is not in the channel")),u}x.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(t.uid,", mediaType: ").concat(r));const c=await this._subscribeMutex.lock();try{if(this.store.useP2P)await this._p2pChannel.unsubscribe(t,r);else{const u=await this._p2pChannel.unsubscribe(t,r);u&&await this._gateway.unsubscribe(u,t.uid),r&&r!=="audio"||(t._audio_pre_subscribed=!1),r&&r!=="video"||(t._video_pre_subscribed=!1),t._is_pre_created&&JA(this._users,t),x.info("[".concat(this._clientId,"] unsubscribe success uid: ").concat(t.uid,", mediaType: ").concat(r))}}catch(u){if(u.code===te.DISCONNECT_P2P)return void x.warning("disconnecting p2p, abort unsubscribe request.");throw x.error("[".concat(this._clientId,"] unsubscribe user ").concat(t.uid," error"),u.toString()),u}finally{c()}}async _unsubscribeDataChannel(t,r){if(r&&or(r,"id",0,65535,!0),!this._joinInfo)throw new Oe(te.INVALID_OPERATION,"Can't unsubscribe datachannel, haven't joined yet!");if(!this._users.find(c=>c===t)){const c=new Oe(te.INVALID_REMOTE_USER,"user is not in the channel");throw x.error("[".concat(this._clientId,"] can not unsubscribe ").concat(t.uid,", user is not in the channel")),c}let a;if(typeof r=="number"){const c=t._dataChannels.find(u=>u.id===r);c&&(a=[c])}else a=t._dataChannels;if(a===void 0){const c=new Oe(te.REMOTE_USER_IS_NOT_PUBLISHED);throw x.error("[".concat(this._clientId,"] can not unsubscribe ").concat(t.uid," with channelId ").concat(r,", remote datachannel is not published")),c}x.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(t.uid,", mediaType: datachannel, ids: ").concat(a.map(c=>c.id)));try{const c=await this._p2pChannel.unsubscribeDataChannel(t,a);c&&await this._gateway.unsubscribeDataChannel(c,t.uid),x.info("[".concat(this._clientId,"] unsubscribe datachannel success uid: ").concat(t.uid,", mediaType: datachannel, ids: ").concat(c))}catch(c){if(c.code===te.DISCONNECT_P2P)return void x.warning("disconnecting p2p, abort unsubscribe request.");throw x.error("[".concat(this._clientId,"] unsubscribe user ").concat(t.uid," error"),c.toString()),c}}async massUnsubscribe(t){if(op(t,"unsubscribeList"),!this._joinInfo)throw new Oe(te.INVALID_OPERATION,"Can't unsubscribeAll stream, haven't joined yet!");x.info("[".concat(this._clientId,"] start massUnsubscribe ").concat(t.map(s=>{let{user:a,mediaType:c}=s;return"user: ".concat(a==null?void 0:a.uid,", mediaType: ").concat(c,";")}).join())),t=[...t];const r=new Map;for(let s=t.length-1;s>=0;s--){const{user:a,mediaType:c}=t[s];if(!a){const m=new Oe(te.INVALID_PARAMS,"user property does not exist in unsubscribeList item");throw x.error("[".concat(this._clientId,"] user property does not exist in unsubscribeList item")),m}if(Hi(c,"mediaType",["video","audio",void 0]),!this._users.find(m=>m===a)){x.warning("[".concat(this._clientId,"] can not unsubscribe ").concat(a.uid,", user is not in the channel")),t.splice(s,1);continue}const h=es.Video|es.LwoVideo;if(r.has(a)){const m=r.get(a);let y;switch(c){case"video":y=m&h;break;case"audio":y=m&es.Audio;break;default:y=m&(es.Audio|h)}if(y){x.warning("[".concat(this._clientId,"] repeat massUnsubscribe user:").concat(a.uid,",mediaType:").concat(c," twice.")),t.splice(s,1);continue}c?c==="audio"?r.set(a,m|es.Audio):c==="video"&&r.set(a,m|h):r.set(a,m|es.Audio|h)}else c?c==="audio"?r.set(a,es.Audio):c==="video"&&r.set(a,h):r.set(a,es.Audio|h)}try{const s=await this._p2pChannel.massUnsubscribe(t);s&&await this._gateway.massUnsubscribe(s),x.info("[".concat(this._clientId,"] massUnsubscribe success ").concat(t.map(a=>{let{user:c,mediaType:u}=a;return"user: ".concat(c==null?void 0:c.uid,", mediaType: ").concat(u,";")}).join()))}catch(s){if(s.code===te.DISCONNECT_P2P)return void x.warning("[".concat(this._clientId,"] disconnecting p2p, abort unsubscribe request."));throw x.error("[".concat(this._clientId,"] massUnsubscribe error"),s.toString()),s}}async setLowStreamParameter(t){(function(s){if(!s)throw new Me(te.INVALID_PARAMS);Gr(s.width)||_L(s.width,"streamParameter.width"),Gr(s.height)||_L(s.height,"streamParameter.height"),Gr(s.framerate)||_L(s.framerate,"streamParameter.framerate"),Gr(s.bitrate)||or(s.bitrate,"streamParameter.bitrate")})(t),(!t.width&&t.height||t.width&&!t.height)&&x.warning("[".concat(this._clientId,"] The width and height parameters take effect only when both are set")),x.info("[".concat(this._clientId,"] set low stream parameter to"),JSON.stringify(t));const r=this._configDistribute.getLowStreamConfigDistribute();if(r&&r.bitrate&&t.bitrate&&r.bitrate<t.bitrate&&(t.bitrate=r.bitrate),this._lowStreamParameter=t,this._isDualStreamEnabled)return this._p2pChannel.updateVideoStreamParameter(t,Ke.LocalVideoLowTrack)}async enableDualStream(){if(!jn().supportDualStream)throw At.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),new Oe(te.NOT_SUPPORTED,"Your browser is not support dual stream");if(this._isDualStreamEnabled)throw new Oe(te.INVALID_OPERATION,"Dual stream is already enabled");if(this._p2pChannel.canPublishLowStream())try{await this._publishLowStream()}catch(t){throw At.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),t}this._isDualStreamEnabled=!0,At.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!0}),x.info("[".concat(this._clientId,"] enable dual stream"))}async disableDualStream(){if(this._isDualStreamEnabled){if(!this._joinInfo)throw new Oe(te.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this._p2pChannel.getLocalMedia(Ke.LocalVideoLowTrack))try{const t=await this._p2pChannel.unpublishLowStream();t&&await this._gateway.unpublish(t,this._joinInfo.stringUid||this._joinInfo.uid)}catch(t){throw At.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!1}),t}this._isDualStreamEnabled=!1,At.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!0}),x.info("[".concat(this._clientId,"] disable dual stream"))}}async setClientRole(t,r){if(function(a){Hi(a,"role",["audience","host"])}(t),r&&SL(r),this.mode==="rtc"||this.mode==="p2p")throw x.warning("[".concat(this._clientId,"]").concat(this.mode," mode can not use setClientRole")),new Oe(te.INVALID_OPERATION,"".concat(this.mode," mode can not use setClientRole"));if(r&&r.level&&t==="host")throw new Oe(te.INVALID_OPERATION,"host mode can not set audience latency level");if(t==="audience"&&this._p2pChannel.hasLocalMedia())throw new Oe(te.INVALID_OPERATION,"can not set client role to audience when publishing stream");const s=this._config.role;this._joinInfo&&(this._joinInfo.role=t),t!==s&&oe("ENABLE_ROLE_SELECT_EDGE")?(this._gateway.updateClientRole(t,r),this._config.role=t,this._gateway.reconnect("recover",Os.REGIONAL_DISTRIBUTION)):(await this._gateway.setClientRole(t,r),this._config.role=t),x.info("[".concat(this._clientId,"] set client role to ").concat(t,", level: ").concat(r&&r.level))}async _setClientRoleOptions(t){if(this.mode==="rtc"||this.mode==="p2p"||this._config.role!=="audience"||this._p2pChannel.hasLocalMedia())return;let r=!1;try{t&&SL(t),await this._gateway.setClientRole(this._config.role,t),r=!0}catch{}finally{x.info("[".concat(this._clientId,"] set client role options ").concat(r?"succeed":"failed",", options is ").concat(t))}}getRemoteInboundOffset(){var t;const r=(t=this._p2pChannel.getStats())===null||t===void 0?void 0:t.audioSend[0];if(!r||!r.timestamp)return 0;const s=r.timestamp-Date.now();return Math.abs(s)>1e3+r.rttMs+100?this.ntpAlignErrorCount+=1:this.ntpAlignErrorCount=0,this.ntpAlignErrorCount>=3?s:0}getNtpWallTimeInMs(){return document.visibilityState==="visible"&&(this.remoteInboundOffset=this.getRemoteInboundOffset()),this.remoteInboundOffset+Date.now()+this._gateway.ntpOffset}setProxyServer(t,r){if(fs(t,"proxyServer"),!r){if(this.connectionState!=="DISCONNECTED")throw new Oe(te.INVALID_OPERATION,"Set proxy server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new Oe(te.INVALID_OPERATION,"You have already set the proxy")}this._proxyServer=t,At.setProxyServer(this._proxyServer),x.setProxyServer(this._proxyServer),x.info("[".concat(this._clientId,"] Set proxy server ").concat(r?"by initialize call":""," success."))}setTurnServer(t,r){if(Array.isArray(t)||(t=[t]),!r){if(this.connectionState!=="DISCONNECTED")throw new Oe(te.INVALID_OPERATION,"Set turn server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new Oe(te.INVALID_OPERATION,"You have already set the proxy")}if(OT(t))return this._turnServer={servers:t,mode:"original-manual"},void x.info("[".concat(this._clientId,"] Set original turnserver ").concat(r?"by initialize call":""," success: ").concat(t.map(s=>s.urls).join(","),"."));t.forEach(s=>V8(s)),this._turnServer={servers:t,mode:"manual"},x.info("[".concat(this._clientId,"] Set turnserver ").concat(r?"by initialize call":""," success."))}setLicense(t){if(this.connectionState!=="DISCONNECTED")throw new Oe(te.INVALID_OPERATION,"you should set license before join channel");if(fs(t,"license",32,32),!/^[A-Za-z\d]+$/.test(t))throw new Oe(te.INVALID_PARAMS,"license should only contains characters from A-Z a-z 0-9");this._license=t,x.info("[".concat(this._clientId,"] set license success"),t)}startProxyServer(t){if(this.connectionState!=="DISCONNECTED")throw new Oe(te.INVALID_OPERATION,"Start proxy server before join channel");if(this._proxyServer||this._turnServer.mode==="manual"||this._useLocalAccessPoint)throw new Oe(te.INVALID_OPERATION,"You have already set the proxy");const r=[3,4,5];let s;switch(t===void 0&&(t=3),t){case 1:case 2:throw new Oe(te.NOT_SUPPORTED,"proxy mode 1/2 has been deprecated and not supported.");case 3:s="proxy3";break;case 4:s="proxy4";break;case 5:s="proxy5";break;default:throw new Oe(te.INVALID_PARAMS,"proxy server mode must be ".concat(r.join("|")))}this._cloudProxyServerMode=s,this.store.cloudProxyServerMode=s,x.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode)}stopProxyServer(){if(this.connectionState!=="DISCONNECTED")throw new Oe(te.INVALID_OPERATION,"Stop proxy server after leave channel");At.setProxyServer(),x.setProxyServer(),this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled",x.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode),this._proxyServer=void 0,this._turnServer={mode:"auto",servers:[]}}setLocalAccessPointsV2(t){if(!t.accessPoints)throw new Oe(te.INVALID_PARAMS,"accessPoints is required.");op(t.accessPoints.serverList,"accessPoints.serverList"),fs(t.accessPoints.domain,"accessPoints.domain");const r=(P,D)=>{or(P,D,0,65535,!0)};let s=443;if(t.accessPoints.port&&(r(t.accessPoints.port,"accessPoints.port"),s=t.accessPoints.port),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new Oe(te.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");oe("CLOSE_AFB_FOR_LOCAL_AP")&&(rr("JOIN_WITH_FALLBACK_SIGNAL_PROXY",!1),rr("JOIN_WITH_FALLBACK_MEDIA_PROXY",!1));const a=/^((\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.){3}(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/,c=t.accessPoints.domain,u=t.accessPoints.serverList.map(P=>a.test(P)?"".concat(P.replace(/\./g,"-"),".").concat(c):P),h=u.map(P=>"".concat(P,":").concat(s));this._useLocalAccessPoint=!0,this._setLocalAPVersion=2,rr("WEBCS_DOMAIN",h),rr("WEBCS_DOMAIN_BACKUP_LIST",h),rr("GATEWAY_DOMAINS",[c]),t.report&&t.report.hostname&&Array.isArray(t.report.hostname)&&t.report.hostname.length?(op(t.report.hostname,"report.hostname"),rr("EVENT_REPORT_DOMAIN",t.report.hostname[0]),rr("EVENT_REPORT_BACKUP_DOMAIN",t.report.hostname[1]||t.report.hostname[0])):(rr("EVENT_REPORT_DOMAIN",u[0]),rr("EVENT_REPORT_BACKUP_DOMAIN",u[1]||u[0]));let m=6443;t.report&&t.report.port&&(r(t.report.port,"report.port"),m=t.report.port),rr("STATS_COLLECTOR_PORT",m),t.report?rr("ENABLE_EVENT_REPORT",!0):rr("ENABLE_EVENT_REPORT",!1);let y="";t.log&&t.log.hostname&&Array.isArray(t.log.hostname)&&t.log.hostname.length?(op(t.log.hostname,"log.hostname"),y=t.log.hostname[0]):y=u[0];let v=6444;t.log&&t.log.port&&(r(t.log.port,"log.port"),v=t.log.port),rr("LOG_UPLOAD_SERVER","".concat(y,":").concat(v));let S=[];t.cds&&t.cds.hostname&&Array.isArray(t.cds.hostname)&&t.cds.hostname.length?(op(t.cds.hostname,"cds.hostname"),S=t.cds.hostname):S=u;let R=443;t.cds&&t.cds.port&&(r(t.cds.port,"cds.port"),R=t.cds.port),rr("CDS_AP",S.map(P=>"".concat(P,":").concat(R))),t.cds?rr("ENABLE_CONFIG_DISTRIBUTE",!0):rr("ENABLE_CONFIG_DISTRIBUTE",!1),x.info("set local access point v2 success")}setLocalAccessPoints(t,r){if(op(t,"serverList"),fs(r,"domain"),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new Oe(te.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");const s=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/;t=t.map(a=>s.test(a)?"".concat(a.replace(/\./g,"-"),".").concat(r):a),this._useLocalAccessPoint=!0,this._setLocalAPVersion=1,rr("WEBCS_DOMAIN",t),rr("WEBCS_DOMAIN_BACKUP_LIST",t),rr("GATEWAY_DOMAINS",[r]),rr("EVENT_REPORT_DOMAIN",t[0]),rr("EVENT_REPORT_BACKUP_DOMAIN",t[1]||t[0]),rr("LOG_UPLOAD_SERVER","".concat(t[0],":6444")),x.info("[".concat(this._clientId,"] set local access point success"))}async setRemoteDefaultVideoStreamType(t){if(Hi(t,"streamType",[0,1,4,5,6,7,8,9]),this._remoteDefaultVideoStreamType=t,this._joinInfo)try{await this._gateway.setDefaultRemoteVideoStreamType(t),this._joinInfo.defaultVideoStream=this._remoteDefaultVideoStreamType}catch(r){throw x.error("[".concat(this._clientId,"] set default remote video stream type error"),r.toString()),r}else x.debug("[".concat(this._clientId,"] haven't joined yet, cache remoteDefaultVideoStreamType ").concat(t))}async setRemoteVideoStreamType(t,r){Hi(r,"streamType",[0,1,4,5,6,7,8,9]);try{await this._gateway.setRemoteVideoStreamType(t,r),setTimeout(()=>{const s=this._users.find(a=>a.uid===t);s&&s.videoTrack&&s.videoTrack.updateMediaStreamTrackResolution()},2e3)}catch(s){throw x.error("[".concat(this._clientId,"] set remote video stream type error"),s.toString()),s}x.info("[".concat(this._clientId,"] set remote ").concat(t," video stream type to ").concat(r)),this._remoteStreamTypeCacheMap.set(t,r)}async setStreamFallbackOption(t,r){Hi(r,"fallbackType",[0,1,2,3,4,5,6,7,8]);try{await this._gateway.setStreamFallbackOption(t,r)}catch(s){throw x.error("[".concat(this._clientId,"] set stream fallback option"),s.toString()),s}x.info("[".concat(this._clientId,"] set remote ").concat(t," stream fallback type to ").concat(r)),this._streamFallbackTypeCacheMap.set(t,r)}setEncryptionConfig(t,r,s,a){(function(u){Hi(u,"encryptionMode",["aes-128-xts","aes-256-xts","aes-128-ecb","sm4-128-ecb","aes-128-gcm","aes-256-gcm","aes-128-gcm2","aes-256-gcm2","none"])})(t),fs(r,"secret");const c=["aes-128-gcm2","aes-256-gcm2"];if(ot(c).call(c,t)){if(!s||!(s instanceof Uint8Array&&s.length===32))throw new Oe(te.INVALID_PARAMS,"salt must be an Uint8Array and exactly equal to 32 bytes")}else if(s)throw new Oe(te.INVALID_PARAMS,"current encrypt mode does not need salt");if(a){if(sp(a,"encryptDataStream"),!ot(c).call(c,t))throw new Oe(te.INVALID_PARAMS,"current encrypt mode does not support data stream");this._encryptDataStream=!0}new RegExp(`^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*,.<>?/:;'"|{}\\[\\]])(?=.{8,})`).test(r)||x.warning(`The secret is not strong:
      The secret must contain at least 1 lowercase alphabetical character,
      The secret must contain at least 1 uppercase alphabetical character,
      The secret must contain at least 1 numeric character,
      The secret must contain at least one special character,
      The secret must be eight characters or longer.
      `),this._encryptionMode=t,this._encryptionSecret=r,s&&(this._encryptionSalt=Hm(s))}async renewToken(t){if(fs(t,"token",1,2047),!this._key||!this._joinInfo)throw new Oe(te.INVALID_OPERATION,"renewToken should not be called before user join");const r=this._key;this._key=t,this._joinInfo&&(this._joinInfo.token=t);const s=await this._renewTokenMutex.lock();try{if(oe("USE_NEW_TOKEN")){x.debug("[".concat(this._clientId,"] start renew token with ticket from unilbs"));const a=await Mge(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||ki);x.debug("[".concat(this._clientId,"] get ticket from unilbs success")),await this._gateway.renewToken({token:t,ticket:a})}else x.debug("[".concat(this._clientId,"] start renew token without ticket")),await this._gateway.renewToken({token:t});x.debug("[".concat(this._clientId,"] renewToken success"))}catch(a){throw this._key=r,this._joinInfo.token=r,x.error("[".concat(this._clientId,"] renewToken failed"),a.toString()),a}finally{s()}}enableAudioVolumeIndicator(){this._audioVolumeIndicationInterval?x.warning("you have already enabled audio volume indicator!"):this._audioVolumeIndicationInterval=window.setInterval(()=>{const t=this._p2pChannel.getAudioLevels();this.safeEmit(bn.VOLUME_INDICATOR,t)},oe("AUDIO_VOLUME_INDICATION_INTERVAL")||2e3)}getRTCStats(){const t=this._statsCollector.getRTCStats(),r=this._gateway.getInChannelInfo();return t.Duration=Math.round(r.duration/1e3),t}async startLiveStreaming(t,r){if(!r){if(this.codec!=="h264")throw new Oe(te.LIVE_STREAMING_INVALID_RAW_STREAM,"raw streaming is only support h264");if(!this._p2pChannel.hasLocalMedia())throw new Oe(te.LIVE_STREAMING_INVALID_RAW_STREAM,"can not find stream to raw streaming")}if(this._liveRawStreamingClient&&this._liveRawStreamingClient.hasUrl(t)||this._liveTranscodeStreamingClient&&this._liveTranscodeStreamingClient.hasUrl(t))throw new Oe(te.LIVE_STREAMING_TASK_CONFLICT);const s=r?lp.TRANSCODE:lp.RAW;return this._createLiveStreamingClient(s).startLiveStreamingTask(t,s)}setLiveTranscoding(t){return this._createLiveStreamingClient(lp.TRANSCODE).setTranscodingConfig(t)}async stopLiveStreaming(t){const r=[this._liveRawStreamingClient,this._liveTranscodeStreamingClient].filter(s=>s&&s.hasUrl(t));if(!r.length)throw new Oe(te.INVALID_PARAMS,"can not find live streaming url to stop");await dt.all(r.map(s=>s&&s.stopLiveStreamingTask(t)))}async startChannelMediaRelay(t){b9(t),await this._createChannelMediaRelayClient().startChannelMediaRelay(t)}async updateChannelMediaRelay(t){b9(t),await this._createChannelMediaRelayClient().updateChannelMediaRelay(t)}async stopChannelMediaRelay(){await this._createChannelMediaRelayClient().stopChannelMediaRelay(),this._statsCollector.onStatsChanged&&(this._statsCollector.onStatsChanged=void 0)}sendAudioMetadata(t){this._p2pChannel instanceof XT&&this._p2pChannel.addAudioMetadata(t)}async sendStreamMessage(t){var r;let s=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!this._joinInfo)throw new Oe(te.INVALID_OPERATION,"can not send data stream, not joined");if((typeof t=="string"||t instanceof Uint8Array)&&(t={payload:t}),typeof t.payload=="string"){const c=new TextEncoder;t.payload=c.encode(t.payload)}let a=!1;if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&ot(r=["aes-128-gcm2","aes-256-gcm2"]).call(r,this._encryptionMode)&&(a=!0,t.payload=await async function(c,u,h){var m;const y=hc(m=Array.from(h)).call(m,(F,j)=>F+j,0),v={serverTs:0,seq:ime++,length:h.length,checkSum:y},S=new Uint8Array($8(y,2)),R=new ArrayBuffer($v),P=new DataView(R);P.setUint32(0,v.serverTs),P.setUint16(4,v.seq),P.setUint16(6,v.length),P.setUint16(8,v.checkSum);const D=16-h.length%16;h=B8(h,new Uint8Array(D));const G=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:c,tagLength:sz,additionalData:S},u,h);return B8(new Uint8Array(R),new Uint8Array(G))}(this._encryptDataStreamIv,this._encryptDataStreamKey,t.payload)),new Blob([t.payload]).size>1024)throw new Oe(te.INVALID_PARAMS,a?"encrypted stream message out of range.":"stream message out of range.");return this._gateway.signal.request(Gt.DATA_STREAM,{payload:Hm(t.payload),syncWithAudio:t.syncWithAudio,sendTs:Date.now()-Hge},!s)}sendMetadata(t){if(!this._joinInfo)throw new Oe(te.INVALID_OPERATION,"can not send metadata, not joined");if(new Blob([t]).size>1024)throw new Oe(te.METADATA_OUT_OF_RANGE);return this._gateway.signal.request(Gt.SEND_METADATA,{session_id:this._joinInfo.sid,metadata:Hm(t)})}async sendCustomReportMessage(t){if(Array.isArray(t)||(t=[t]),t.forEach(fme),!this._joinInfo)throw new Oe(te.INVALID_OPERATION,"can not send custom report, not joined");await At.sendCustomReportMessage(this._joinInfo.sid,t)}getLocalAudioStats(){return this._statsCollector.getLocalAudioTrackStats()}getRemoteAudioStats(){return this._statsCollector.getRemoteAudioTrackStats()}getLocalVideoStats(){return this._statsCollector.getLocalVideoTrackStats()}getRemoteVideoStats(){return this._statsCollector.getRemoteVideoTrackStats()}getRemoteNetworkQuality(){return this._statsCollector.getRemoteNetworkQualityStats()}async pickSVCLayer(t,r){Hi(r.spatialLayer,"spatialLayer",[0,1,2,3]),Hi(r.temporalLayer,"temporalLayer",[0,1,2,3]);try{await this._gateway.pickSVCLayer(t,r)}catch(s){throw x.error("[".concat(this._clientId,"] pick SVC layer failed"),s.toString()),s}}async setRTMConfig(t){const{apRTM:r=!1,rtmFlag:s}=t;if(sp(r,"apRTM"),or(s,"rtmFlag",0),this._rtmConfig.apRTM=r,this._rtmConfig.rtmFlag=s,x.debug("[".concat(this._clientId,"] setRTMconfig ").concat(JSON.stringify(t)," in ").concat(this.connectionState," state")),(this.connectionState==="CONNECTED"||this.connectionState==="RECONNECTING")&&this._joinInfo)return this._joinInfo.apRTM=r,this._joinInfo.rtmFlag=s,this._gateway.setRTM2Flag(s)}_reset(){if(x.debug("[".concat(this._clientId,"] reset client")),function(t){const r=sS.indexOf(t);r!==-1&&sS.splice(r,1)}(this._clientId),this.store.hasStartJoinChannel=!1,this.store.isABTestSuccess=!1,this._axiosCancelSource.cancel(),this._axiosCancelSource=ha.CancelToken.source(),this._streamFallbackTypeCacheMap=new Map,this._remoteStreamTypeCacheMap=new Map,this._configDistribute.stopGetConfigDistribute(),this._joinInfo&&J9(this._joinInfo),this._joinInfo=void 0,this._proxyServer=void 0,this._defaultStreamFallbackType=void 0,this._sessionId&&At.removeSid(this._sessionId),this._sessionId=null,this.store.sessionId=null,this._statsCollector.reset(),this._key=void 0,this._appId=void 0,this._uid=void 0,this.store.uid=void 0,this._channelName=void 0,this._encryptionMode="none",this._encryptionSecret=null,this._encryptionSalt=null,this._encryptDataStreamKey=null,this._encryptDataStreamIv=null,this._pendingPublishedUsers=[],this._users.forEach(t=>{t._audioTrack&&t._audioTrack._destroy(),t._videoTrack&&t._videoTrack._destroy(),t._dataChannels&&(t._dataChannels.forEach(r=>r._close()),t._dataChannels.length=0)}),this._users=[],this._audioVolumeIndicationInterval&&(window.clearInterval(this._audioVolumeIndicationInterval),this._audioVolumeIndicationInterval=void 0),this._cloudProxyServerMode==="fallback"&&(this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled"),this._p2pChannel.reset(),this._publishMutex=new Fs("client-publish",this._clientId),this._subscribeMutex=new Fs("client-subscribe",this._clientId),this._networkQualityInterval&&(window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=void 0),this._liveRawStreamingClient&&(this._liveRawStreamingClient.terminate(),this._liveRawStreamingClient.removeAllListeners(),this._liveRawStreamingClient=void 0),this._liveTranscodeStreamingClient&&(this._liveTranscodeStreamingClient.terminate(),this._liveTranscodeStreamingClient.removeAllListeners(),this._liveTranscodeStreamingClient=void 0),this._channelMediaRelayClient&&(this._channelMediaRelayClient.dispose(),this._channelMediaRelayClient=void 0),this._inspect)try{this._inspect.close(),this._inspect=void 0}catch{}if(this._moderation)try{this.setImageModeration(!1)}catch{}}_startSession(t,r){var s;const a=t||z_();t?x.debug("[".concat(this._clientId,"] new Session ").concat(a)):x.debug("[".concat(this._clientId,"] renewSession ").concat(this._sessionId," => ").concat(a));const c=t?"":this._sessionId||"";this._sessionId=a,this.store.sessionId=a,At.addSid(a);const u={lts:new Date().getTime(),mode:this.mode,buildFormat:1,stringUid:(r==null?void 0:r.stringUid)||((s=this._joinInfo)===null||s===void 0?void 0:s.stringUid),channelProfile:this.mode==="live"?1:0,channelMode:0,isABTestSuccess:Number(this._configDistribute.isSuccess),lsid:c,clientRole:this.role==="audience"?2:1};At.sessionInit(this._sessionId,Pu({cname:r.channel,appid:r.appId},u)),this._joinInfo&&(this._joinInfo.sid=a),this._gateway.joinInfo&&(this._gateway.joinInfo.sid=a)}async _publishHighStream(t){if(!this._joinInfo||this._uid===void 0)throw new Oe(te.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Oe(te.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&oe("FORCE_TURN")&&!oe("TURN_ENABLE_TCP")&&!oe("TURN_ENABLE_UDP"))throw new Oe(te.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");x.debug("[".concat(this._clientId,"] publish high stream"));try{const s=await this._p2pChannel.publish(t,this._isDualStreamEnabled,this._lowStreamParameter);if(this.store.useP2P){const a=(await s.next()).value;if(a){try{await this._gateway.sendExtensionMessage(ui.PUBLISH,a,!0)}catch(c){throw s.throw(c),c}await s.next()}this._p2pChannel.reportPublishEvent(!0,null)}else{const a=(await s.next()).value;if(a){var r;let c;try{c=await this._gateway.publish(this._uid,a,!0)}catch(u){if(u.code!==te.DISCONNECT_P2P)throw s.throw(u),u}await s.next(((r=c)===null||r===void 0?void 0:r.ortc)||[])}this._p2pChannel.reportPublishEvent(!0,null);for(const c of t)c instanceof Tr&&c._encoderConfig&&this._gateway.setVideoProfile(c._encoderConfig).catch(u=>{x.debug("[".concat(this._clientId,"] stop setVideoProfile, because websocket is closed"))}),!c.muted&&c.enabled||await this._p2pChannel.muteLocalTrack(c)}}catch(s){if(this._p2pChannel.reportPublishEvent(!1,s==null?void 0:s.code,t),(s==null?void 0:s.code)===te.WS_ABORT)return;throw s}}async _publishLowStream(){if(!this._joinInfo||this._uid===void 0)throw new Oe(te.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Oe(te.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));x.debug("[".concat(this._clientId,"] publish low stream"));const t=this._configDistribute.getLowStreamConfigDistribute();t&&t.bitrate&&(this._lowStreamParameter||(this._lowStreamParameter={width:160,height:120,framerate:15,bitrate:50}),this._lowStreamParameter&&this._lowStreamParameter.bitrate&&t.bitrate<this._lowStreamParameter.bitrate&&(this._lowStreamParameter.bitrate=t.bitrate));try{const s=await this._p2pChannel.publishLowStream(this._lowStreamParameter),a=(await s.next()).value;if(a){var r;let c;try{c=await this._gateway.publish(this._uid,a,!0)}catch(u){if(u.code!==te.DISCONNECT_P2P)throw s.throw(u),u}s.next(((r=c)===null||r===void 0?void 0:r.ortc)||[]),this._p2pChannel.reportPublishEvent(!0,null,void 0,!0)}}catch(s){if(this._p2pChannel.reportPublishEvent(!1,s==null?void 0:s.code,void 0,!0),(s==null?void 0:s.code)===te.WS_ABORT)return;throw s}}_createLiveStreamingClient(t){const r=()=>{if(!this._joinInfo||!this._appId)return new Oe(te.INVALID_OPERATION,"can not create live streaming client, please join channel first").throw();const s=(a={joinInfo:this._joinInfo,appId:this._appId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig},hp("LiveStreaming").create(a));var a;return s.onLiveStreamError=(c,u)=>{At.reportApiInvoke(this._sessionId,{name:Oi.ON_LIVE_STREAM_ERROR,options:[c,u],tag:Hr.TRACER}).onSuccess(),this.safeEmit(bn.LIVE_STREAMING_ERROR,c,u)},s.onLiveStreamWarning=(c,u)=>{At.reportApiInvoke(this._sessionId,{name:Oi.ON_LIVE_STREAM_WARNING,options:[c,u],tag:Hr.TRACER}).onSuccess(),this.safeEmit(bn.LIVE_STREAMING_WARNING,c,u)},s.on(d2.REQUEST_WORKER_MANAGER_LIST,(c,u,h)=>{if(!this._joinInfo)return h(new Oe(te.INVALID_OPERATION,"can not find join info to get worker manager"));(async function(m,y,v,S){const R=oe("UAP_AP").slice(0,oe("AJAX_REQUEST_CONCURRENT")).map(P=>y.proxyServer?"https://".concat(y.proxyServer,"/ap/?url=").concat(P+"/api/v1?action=uap"):"https://".concat(P,"/api/v1?action=uap"));return await Oge(R,m,y,v,S)})(c,this._joinInfo,this._axiosCancelSource.token,ki).then(u).catch(h)}),s};return t===lp.RAW?(this._liveRawStreamingClient=this._liveRawStreamingClient||r(),this._liveRawStreamingClient):(this._liveTranscodeStreamingClient=this._liveTranscodeStreamingClient||r(),this._liveTranscodeStreamingClient)}_createChannelMediaRelayClient(){if(!this._joinInfo)return new Oe(te.INVALID_OPERATION,"can not create channel media relay client, please join channel first").throw();if(!this._channelMediaRelayClient){const{sendResolutionWidth:r,sendResolutionHeight:s}=this.getLocalVideoStats(),a=(t={joinInfo:this._joinInfo,clientId:this._clientId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig,resolution:{width:r,height:s}},hp("ChannelMediaRelay").create(t));a.on("state",c=>{c===za.RELAY_STATE_FAILURE&&a&&a.dispose(),this.safeEmit(bn.CHANNEL_MEDIA_RELAY_STATE,c)}),a.on("event",c=>{this.safeEmit(bn.CHANNEL_MEDIA_RELAY_EVENT,c)}),this._channelMediaRelayClient=a,this._statsCollector.onStatsChanged=(c,u)=>{var h;c==="resolution"&&((h=this._channelMediaRelayClient)===null||h===void 0||h.setVideoProfile(u))}}var t;return this._channelMediaRelayClient}_handleUpdateDataChannel(t,r){const{added:s,deleted:a}=t,c=[];if(r){const u=[];this._users.forEach(h=>{h._dataChannels.forEach(m=>{s.every(y=>y.uid!==h._uintid||y.stream_id!==m.id)&&u.push({uid:h._uintid,stream_id:m.id,ordered:m.ordered,max_retrans_times:m.maxRetransmits,metadata:m.metadata})})}),u.length>0&&this._handleUpdateDataChannel({added:[],deleted:u})}Array.isArray(s)&&s.length>0&&s.forEach(u=>{const{uid:h,stream_id:m,ordered:y,max_retrans_times:v,metadata:S}=u,R=this._users.find(P=>P._uintid===h);if(!R)return void x.error("[".concat(this._clientId,"] can not find target user!(on_add_data_channel)"));if(x.debug("[".concat(this._clientId,"] data_channel added with uid ").concat(h)),ot(c).call(c,R)||c.push(R),R._uintid||(R._uintid=h),R._dataChannels.findIndex(P=>P.id===u.stream_id)===-1){const P={id:m,ordered:!!y,maxRetransmits:v,metadata:S},D=function(G){return s9(G,!0)}(P);R._dataChannels.push(D),x.info("[".concat(this._clientId,"] remote user ").concat(R.uid," published datachannel")),r||this.safeEmit(bn.USER_PUBLISHED,R,"datachannel",P)}this._p2pChannel.hasPendingRemoteDataChannel(R,u.stream_id)&&(x.debug("[".concat(this._clientId,"] resubscribe datachannel for user ").concat(R.uid," after reconnect.")),this._subscribeDataChannel(R,u.stream_id).catch(P=>{x.error("[".concat(this._clientId,"] resubscribe datachannel error"),P.toString())}))}),r&&(this.safeEmit(bn.PUBLISHED_USER_LIST,this._pendingPublishedUsers),this._pendingPublishedUsers=[]),Array.isArray(a)&&a.length>0&&a.forEach(u=>{const{uid:h,stream_id:m}=u,y=this._users.find(S=>S._uintid===h);if(!y)return void x.error("[".concat(this._clientId,"] can not find target user!(on_delete_data_channel)"));const v=y._dataChannels.find(S=>S.id===u.stream_id);v&&(x.debug("[".concat(this._clientId,"] data_stream delete with uid ").concat(h)),this._p2pChannel.unsubscribeDataChannel(y,[v]).then(S=>{if(y._dataChannels=y._dataChannels.filter(R=>R!==v),S)return this._gateway.unsubscribeDataChannel(S,y.uid)}),x.info("[".concat(this._clientId,"] remote user ").concat(h," unpublished datachannel ,id:").concat(v.id)),this.safeEmit(bn.USER_UNPUBLISHED,y,"datachannel",v._config))})}_handleRemoveDataChannels(t){const r=this._users.find(s=>s.uid===t.uid);if(r){if(r._dataChannels!==void 0&&r._dataChannels.length>0){x.debug("[".concat(this._clientId,"] datachannel removed with uid ").concat(t.uid));const s=()=>{x.info("[".concat(this._clientId,"] remote user ").concat(r.uid," unpublished datachannel")),r._dataChannels.forEach(a=>{this.safeEmit(bn.USER_UNPUBLISHED,r,"datachannel",a._config)})};this._p2pChannel.unsubscribeDataChannel(r,r._dataChannels).then(a=>{if(a)return this._gateway.unsubscribeDataChannel(a,r.uid)}),s()}}else x.warning("[".concat(this._clientId,"] can not find target user!(on_remove_datachannel)"))}_handleGatewayEvents(){this._gateway.on(ls.UPDATE_GATEWAY_CONFIG,()=>{(function(){let t;try{t=window.localStorage.getItem("websdk_ng_global_parameter")}catch(r){return void x.error("Error loading sdk config",r.message)}if(t)try{const r=JSON.parse(window.atob(t)),s=Date.now();Object.keys(r).forEach(a=>{const{value:c,type:u,expires:h}=r[a];h&&h<=s||u||i2()||!Object.prototype.hasOwnProperty.call(rP,a)||(Sd[a]=c,br[a]=c,x.debug("Update gateway parameters from config distribute",a,c))})}catch(r){x.error("Error update config from local cache",r.message)}})()}),this._gateway.on(ls.DISCONNECT_P2P,async()=>{await this._p2pChannel.disconnectForReconnect()}),this._gateway.on(ls.CONNECTION_STATE_CHANGE,(t,r,s)=>{var a;if(s===qn.FALLBACK)return;const c=()=>{this.safeEmit(bn.CONNECTION_STATE_CHANGE,t,r,s)};if(At.reportApiInvoke(this._sessionId||((a=this._gateway.joinInfo)===null||a===void 0?void 0:a.sid)||null,{name:Oi.CONNECTION_STATE_CHANGE,options:[t,r,s],tag:Hr.TRACER}).onSuccess(JSON.stringify({cur:t,prev:r,reason:s})),x.info("[".concat(this._clientId,"] signal connection state change: ").concat(r," -> ").concat(t)),t==="DISCONNECTED")return this._reset(),void c();if(t==="RECONNECTING")this._users.forEach(h=>{h._trust_in_room_=!1,h._trust_audio_enabled_state_=!1,h._trust_video_enabled_state_=!1,h._trust_audio_mute_state_=!1,h._trust_video_mute_state_=!1,h._trust_audio_stream_added_state_=!1,h._trust_video_stream_added_state_=!1,h._is_pre_created||(h._audio_pre_subscribed||(h._audioSSRC=void 0,h._audioOrtc=void 0),h._video_pre_subscribed||(h._videoSSRC=void 0,h._videoOrtc=void 0,h._rtxSsrcId=void 0),h._cname=void 0)}),this._userOfflineTimeout&&window.clearTimeout(this._userOfflineTimeout),this._streamRemovedTimeout&&window.clearTimeout(this._streamRemovedTimeout),this._userOfflineTimeout=void 0,this._streamRemovedTimeout=void 0;else if(t==="CONNECTED"){var u;this._streamFallbackTypeCacheMap.forEach((h,m)=>{this._gateway.setStreamFallbackOption(m,h).catch(y=>{x.warning("[".concat(this._clientId,"] auto set stream fallback option failed"),y)})}),this._remoteStreamTypeCacheMap.forEach((h,m)=>{this._gateway.setRemoteVideoStreamType(m,h).catch(y=>{x.warning("[".concat(this._clientId,"] auto set remote stream type failed"),y)})}),this._remoteDefaultVideoStreamType!==void 0&&((u=this._joinInfo)===null||u===void 0?void 0:u.defaultVideoStream)===void 0&&this.setRemoteDefaultVideoStreamType(this._remoteDefaultVideoStreamType).then(()=>{x.debug("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway connected"))}).catch(h=>{x.error("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway failed, ").concat(h))}),this.store.useP2P||(this._p2pChannel.republish(),this._userOfflineTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._userOfflineTimeout=void 0,this._users.filter(h=>!h._trust_in_room_).forEach(h=>{x.debug("[".concat(this._clientId,"] user offline timeout, emit user offline ").concat(h.uid)),this._handleUserOffline({uid:h.uid})}))},3e3),this._streamRemovedTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._streamRemovedTimeout=void 0,this._users.forEach(h=>{h._trust_audio_mute_state_||(x.debug("[".concat(this._clientId,"] auto dispatch audio unmute event ").concat(h.uid)),this._handleMuteStream(h.uid,Et.AUDIO,!1)),h._trust_video_mute_state_||(x.debug("[".concat(this._clientId,"] auto dispatch video unmute event ").concat(h.uid)),this._handleMuteStream(h.uid,Et.VIDEO,!1)),h._trust_audio_enabled_state_||(x.debug("[".concat(this._clientId,"] auto dispatch enable local audio ").concat(h.uid)),this._handleSetStreamLocalEnable("audio",h.uid,!0)),h._trust_video_enabled_state_||(x.debug("[".concat(this._clientId,"] auto dispatch enable local video ").concat(h.uid)),this._handleSetStreamLocalEnable("video",h.uid,!0)),h._trust_video_stream_added_state_||(x.debug("[".concat(this._clientId,"] auto dispatch reset video stream added ").concat(h.uid)),this._handleResetAddStream(h,"video")),h._trust_audio_stream_added_state_||(x.debug("[".concat(this._clientId,"] auto dispatch reset audio stream added ").concat(h.uid)),this._handleResetAddStream(h,"audio")),h._video_added_||h._audio_added_||(x.debug("[".concat(this._clientId,"] auto dispatch stream remove ").concat(h.uid)),this._handleRemoveStream({uid:h.uid,uint_id:h._uintid}))}))},1e3))}c()}),this._gateway.on(ls.REQUEST_NEW_GATEWAY_LIST,async(t,r)=>{if(!this._joinInfo)return r(new Oe(te.UNEXPECTED_ERROR,"can not recover, no join info"));try{let s;const a=await Y9(Pu(Pu({},this._joinInfo),{},{uid:this._joinInfo.uid,stringUid:void 0}));a?(s=a.ap,Q9(a),this._joinInfo.preload=!0):(s=await I2(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||ki,this.store),this._joinInfo.preload=!1),this._joinInfo&&(this._joinInfo.apResponse=s.gatewayInfo.res,this._joinInfo.gatewayAddrs=s.gatewayInfo.gatewayAddrs,this._joinInfo.uni_lbs_ip=s.gatewayInfo.uni_lbs_ip);const c=[];s.gatewayInfo.gatewayAddrs.forEach(u=>{let{address:h}=u;const[m,y]=h.split(":");this._joinInfo&&this._joinInfo.proxyServer?c.push({proxy:this._joinInfo.proxyServer,host:m,port:y}):c.push({host:m,port:y})}),t(c)}catch(s){r(s)}}),this._gateway.on(ls.NETWORK_QUALITY,t=>{this._networkQualitySensitivity==="normal"&&this.safeEmit(bn.NETWORK_QUALITY,t)}),this._gateway.on(ls.STREAM_TYPE_CHANGE,(t,r)=>{this.safeEmit(bn.STREAM_TYPE_CHANGED,t,r),At.reportApiInvoke(this._sessionId,{name:Oi.STREAM_TYPE_CHANGE,options:[t,r],tag:Hr.TRACER}).onSuccess(JSON.stringify({uid:t,streamType:r}))}),this._gateway.on(ls.IS_P2P_DISCONNECTED,t=>{this._p2pChannel.isP2PDisconnected()?t(!0):this._p2pChannel.hasLocalMedia()||this._p2pChannel.hasRemoteMedia()?t(!1):t(!0)}),this._gateway.on(ls.REQUEST_P2P_CONNECTION_PARAMS,async(t,r,s)=>{try{let a=await this._p2pChannel.getEstablishParams();oe("ENABLE_PREALLOC_PC")&&a||(a=await this._p2pChannel.startP2PConnection(t)),r(a)}catch(a){s(a)}}),this._gateway.on(ls.JOIN_RESPONSE,(t,r)=>{if(this.store.useP2P)return;let s;t.attributes?s=t.attributes.userAttributes.preSubSsrcs:x.debug("no attributes in joinResponse");const a=KH(t.ortc,r,s);this._p2pChannel.connect(a)}),this._gateway.on(ls.PRE_CONNECT_PC,async t=>{const{candidates:r,fingerprint:s}=t;if(this._joinInfo&&r.length>0&&!this._p2pChannel.isPlanB){var a;await this._p2pChannel.startP2PConnection({turnServer:this._joinInfo.turnServer});const{cert:c,cid:u}=this._joinInfo.apResponse;await this._p2pChannel.connect({iceParameters:{iceUfrag:"".concat(u,"_").concat(c),icePwd:"".concat(u,"_").concat(c)},dtlsParameters:{fingerprints:[{hashFunction:"sha-256",fingerprint:(a=oe("FINGERPRINT"))!==null&&a!==void 0?a:s}]},candidates:r,rtpCapabilities:{send:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},recv:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]}},setup:"active",cname:"o/i14u9pJrxRKAsu",preallocation:!0})}})}_handleGatewaySignalEvents(){this._gateway.signal.on(wn.ON_USER_ONLINE,this._handleUserOnline),this._gateway.signal.on(wn.ON_USER_OFFLINE,this._handleUserOffline),this._gateway.signal.on(wn.ON_ADD_AUDIO_STREAM,t=>this._handleAddAudioOrVideoStream("audio",t.uid,t.ssrcId,t.cname,t.uint_id,t.ortc)),this._gateway.signal.on(wn.ON_ADD_VIDEO_STREAM,t=>this._handleAddAudioOrVideoStream("video",t.uid,t.ssrcId,t.cname,t.uint_id,t.ortc,t.rtxSsrcId)),this._gateway.signal.on(wn.ON_REMOTE_DATASTREAM_UPDATE,t=>{this._handleUpdateDataChannel(t)}),this._gateway.signal.on(wn.ON_REMOTE_FULL_DATASTREAM_INFO,t=>{this._handleUpdateDataChannel({added:t.datastreams||[],deleted:[]},!0)}),this._gateway.signal.on(wn.ON_REMOVE_STREAM,this._handleRemoveStream),this._gateway.signal.on(wn.ON_P2P_LOST,this._handleP2PLost),this._gateway.signal.on(wn.MUTE_AUDIO,t=>this._handleMuteStream(t.uid,Et.AUDIO,!0)),this._gateway.signal.on(wn.UNMUTE_AUDIO,t=>this._handleMuteStream(t.uid,Et.AUDIO,!1)),this._gateway.signal.on(wn.MUTE_VIDEO,t=>this._handleMuteStream(t.uid,Et.VIDEO,!0)),this._gateway.signal.on(wn.UNMUTE_VIDEO,t=>this._handleMuteStream(t.uid,Et.VIDEO,!1)),this._gateway.signal.on(wn.RECEIVE_METADATA,t=>{const r=W_(t.metadata);this.safeEmit(bn.RECEIVE_METADATA,t.uid,r)}),this._gateway.signal.on(wn.ON_DATA_STREAM,async t=>{var r;if(!t)return;let s=W_(t.payload);if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&ot(r=["aes-128-gcm2","aes-256-gcm2"]).call(r,this._encryptionMode)){if(t.payload.length<$v)throw new Oe(te.UNEXPECTED_RESPONSE,"payload length ".concat(t.payload.length," is less than header length ").concat($v));s=await async function(u,h,m){const y=m.subarray(0,$v),v=y.slice(8,$v),S=(v[0]<<8)+v[1],R=(y[6]<<8)+y[7],P=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:u,tagLength:sz,additionalData:new Uint8Array($8(S,2))},h,m.subarray($v));return new Uint8Array(P).subarray(0,R)}(this._encryptDataStreamIv,this._encryptDataStreamKey,s)}let a=0;if(t.ordered||t.syncWithAudio){const c=this._p2pChannel.getStats(),u=this.remoteUsers.find(m=>m.uid===t.uid),h=c==null?void 0:c.audioRecv.find(m=>m.ssrc===(u==null?void 0:u._audioSSRC));a=h==null?void 0:h.jitterBufferMs}(a==null||Number.isNaN(a))&&(a=0),Kge(Pu(Pu({},t),{},{payload:s}),a,{id:this._clientId,onStreamMessage:typeof this.onStreamMessage=="function"?this.onStreamMessage.bind(this):void 0,safeEmit:this.safeEmit.bind(this)})}),this._gateway.signal.on(wn.ON_CRYPT_ERROR,()=>{Gm(()=>{x.warning("[".concat(this._clientId,"] on crypt error")),this.safeEmit(bn.CRYPT_ERROR)},this._sessionId)}),this._gateway.signal.on(wn.ON_TOKEN_PRIVILEGE_WILL_EXPIRE,this._handleTokenWillExpire),this._gateway.signal.on(wn.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{x.warning("[".concat(this._clientId,"] received message onTokenPrivilegeDidExpire, please get new token and join again")),this._gateway.leave(!0,qn.TOKEN_EXPIRE),this.safeEmit(bn.ON_TOKEN_PRIVILEGE_DID_EXPIRE),this._reset()}),this._gateway.signal.on(wn.ON_STREAM_FALLBACK_UPDATE,t=>{x.debug("[".concat(this._clientId,"] stream fallback peerId: ").concat(t.stream_id,", attr: ").concat(t.stream_type)),this.safeEmit(bn.STREAM_FALLBACK,t.stream_id,t.stream_type===1?"fallback":"recover")}),this._gateway.signal.on(wn.ON_PUBLISH_STREAM,t=>{this.uid===this._uid&&(this._p2pChannel.reportPublishEvent(!0,null,void 0,!1,JSON.stringify({proxy:t.proxy})),x.info("[".concat(this._clientId,"] on publish stream, ").concat(JSON.stringify(t))))}),this._gateway.signal.on(wn.ENABLE_LOCAL_VIDEO,t=>{this._handleSetStreamLocalEnable("video",t.uid,!0)}),this._gateway.signal.on(wn.DISABLE_LOCAL_VIDEO,t=>{this._handleSetStreamLocalEnable("video",t.uid,!1)}),this._gateway.signal.on(Ht.REQUEST_TIMEOUT,(t,r)=>{if(this._joinInfo)switch(t){case Gt.PUBLISH:{if(!r)return;const c=r.ortc;if(c){var s,a;const u=c.some(y=>{let{stream_type:v}=y;return v===Xn.Audio}),h=c.some(y=>{let{stream_type:v}=y;return v!==Xn.Audio}),m=c.some(y=>{let{stream_type:v}=y;return v===Xn.Screen||v===Xn.ScreenLow});r.state==="offer"&&At.publish(this._joinInfo.sid,{eventElapse:Ws.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:!1,ec:te.TIMEOUT,audio:u,video:h,p2pid:r.p2p_id,publishRequestid:this.store.pubId,screenshare:m,audioName:u?(s=c.find(y=>{let{stream_type:v}=y;return v===Xn.Audio}))===null||s===void 0||(s=s.ssrcs[0])===null||s===void 0?void 0:s.ssrcId.toString():void 0,videoName:h?(a=c.find(y=>{let{stream_type:v}=y;return v!==Xn.Audio}))===null||a===void 0||(a=a.ssrcs[0])===null||a===void 0?void 0:a.ssrcId.toString():void 0})}break}case Gt.SUBSCRIBE:r&&At.subscribe(this._joinInfo.sid,{succ:!1,ec:te.TIMEOUT,audio:r.stream_type===Et.AUDIO,video:r.stream_type===Et.VIDEO,peerid:r.stream_id,subscribeRequestid:r.ssrcId,p2pid:this.store.p2pId,eventElapse:Ws.measureFromSubscribeStart(this.store.clientId,r.ssrcId),preSsrc:this._p2pChannel.isPreSubScribe(r.ssrcId)})}}),this._gateway.signal.on(wn.ON_P2P_OK,t=>{this.uid,this._uid}),this._gateway.signal.on(wn.ON_PUBLISHED_USER_LIST,t=>{if(t==null||!t.users)return;oe("BLOCK_LOCAL_CLIENT")&&(t.users=t.users.filter(a=>!J_(a.string_id||a.stream_id,this.channelName)));const r=[],s=[];for(const a of t.users){let c=this._users.find(S=>S._uintid===a.stream_id);c?c._trust_in_room_=!0:(c=new Zm(a.string_id||a.stream_id,a.stream_id),this._users.push(c),this.getListeners(bn.PUBLISHED_USER_LIST).length===0&&(x.debug("[".concat(this._clientId,"] user online"),a.stream_id),this.safeEmit(bn.USER_JOINED,c)));const u=es.Audio&a.stream_type,h=(es.Video|es.LwoVideo)&a.stream_type,m=(65280&a.stream_type)!=0,y=u&&c.hasAudio,v=h&&c.hasVideo;h&&(c._trust_video_stream_added_state_=!0,c._video_added_=!0,c._videoSSRC=a.video_ssrc,c._rtxSsrcId=a.video_rtx),u&&(c._trust_audio_stream_added_state_=!0,c._audio_added_=!0,c._audioSSRC=a.audio_ssrc),u&&!y&&this.getListeners(bn.PUBLISHED_USER_LIST).length===0&&(x.info("[".concat(this._clientId,"] remote user ").concat(c.uid," published audio")),this.safeEmit(bn.USER_PUBLISHED,c,"audio")),h&&!v&&this.getListeners(bn.PUBLISHED_USER_LIST).length===0&&(x.info("[".concat(this._clientId,"] remote user ").concat(c.uid," published video")),this.safeEmit(bn.USER_PUBLISHED,c,"video")),(u&&!y||h&&!v||m)&&r.push(c),h&&this._p2pChannel.hasPendingRemoteMedia(c,"video")&&s.push({user:c,mediaType:"video"}),u&&this._p2pChannel.hasPendingRemoteMedia(c,"audio")&&s.push({user:c,mediaType:"audio"})}s.length>0&&(x.debug("[".concat(this._clientId,"] RE massSubscribe after reconnect ").concat(s.map(a=>"user: ".concat(a.user.uid,", mediaType: ").concat(a.mediaType)).join("; ")," ")),this.massSubscribe(s).catch(a=>{x.error("[".concat(this._clientId,"] mass resubscribe error"),a.toString())})),this.getListeners(bn.PUBLISHED_USER_LIST).length>0?oe("ENABLE_DATASTREAM_2")?this._pendingPublishedUsers=r:(x.info("[".concat(this._clientId,"] client emit user-list event, users: ").concat(r.map(a=>a.uid).join(", "))),this.safeEmit(bn.PUBLISHED_USER_LIST,r)):x.info("[".concat(this._clientId,"] client not emit user-list event case there is no user-list listener, users: ").concat(r.map(a=>a.uid).join(", ")))}),this._gateway.signal.on(wn.ON_RTP_CAPABILITY_CHANGE,t=>{const{video_codec:r}=t;this._p2pChannel instanceof XT&&this._p2pChannel.updateRemoteRTPCapabilities(r.map(s=>s.toLowerCase()).filter(s=>{var a;return ot(a=Object.keys(iP)).call(a,s)}))})}_handleP2PEvents(){this._gateway.signal.on(wn.ON_USER_OFFLINE,()=>{this._p2pChannel.disconnectForReconnect()}),this._gateway.signal.on(ui.PUBLISH,(t,r,s)=>{const{uid:a}=t;t.forEach(c=>{const{kind:u,ssrcs:h,mid:m,isMuted:y}=c;this._handleP2PAddAudioOrVideoStream(u,a,h[0].ssrcId,m);const v=this._users.find(S=>S.uid===a);return v&&this.store.useP2P?this._p2pChannel.mockSubscribe(v,u,h[0].ssrcId,m).then(()=>{r()}).catch(s):r(),this._handleMuteStream(a,u,!!y)})}),this._gateway.signal.on(ui.CALL,async(t,r,s)=>{if(this.store.useP2P)try{var a;r(await this._p2pChannel.startP2P({turnServer:(a=this._joinInfo)===null||a===void 0?void 0:a.turnServer},t))}catch(c){s(c)}}),this._gateway.signal.on(Ht.P2P_CONNECTION,async t=>{this.store.useP2P&&(await this._p2pChannel).p2pConnect(t)}),this._gateway.signal.on(ui.UNPUBLISH,async(t,r,s)=>{if(this.store.useP2P){const{unpubMsg:a,uid:c}=t,u=this._users.find(h=>h.uid===c);if(!u)return x.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(c)),void r();try{a.forEach(async h=>{let{stream_type:m}=h;const y=m===Xn.Audio?Et.AUDIO:Et.VIDEO;await this._p2pChannel.unsubscribe(u,y),this._handleMuteStream(c,y,!0)}),r()}catch(h){s(h)}}}),this._gateway.signal.on(ui.CONTROL,async(t,r)=>{const{action:s}=t;switch(s){case qm.MUTE_LOCAL_VIDEO:this._handleMuteStream(r,Et.VIDEO,!0);break;case qm.MUTE_LOCAL_AUDIO:this._handleMuteStream(r,Et.AUDIO,!0);break;case qm.UNMUTE_LOCAL_VIDEO:this._handleP2PAddAudioOrVideoStream("video",r),this._handleMuteStream(r,Et.VIDEO,!1);break;case qm.UNMUTE_LOCAL_AUDIO:this._handleP2PAddAudioOrVideoStream("audio",r),this._handleMuteStream(r,Et.AUDIO,!1)}}),this._gateway.signal.on(ui.RESTART_ICE,async(t,r,s)=>{if(this.store.useP2P)try{const{direction:a,iceParameter:c}=t;a!==Bo.SEND_ONLY||c?r(await this._p2pChannel.restartICE(a,c)):(this._p2pChannel.handleDisconnect(a),r())}catch(a){s(a)}}),this._gateway.signal.on(ui.CANDIDATE,t=>{if(this.store.useP2P){const{candidate:r,direction:s}=t;this._p2pChannel.addRemoteCandidate(r,s)}}),this._p2pChannel.on(xt.RequestP2PRestartICE,async(t,r,s)=>{try{const{direction:a}=t;r(await this._gateway.sendExtensionMessage(ui.RESTART_ICE,t,a===Bo.SEND_ONLY))}catch(a){s(a)}}),this._p2pChannel.on(xt.LocalCandidate,t=>{this._gateway.sendExtensionMessage(ui.CANDIDATE,JSON.stringify(t),!0)}),this._p2pChannel.on(xt.RequestP2PMuteLocal,async(t,r,s)=>{try{await this._gateway.sendExtensionMessage(ui.CONTROL,t,!0),r()}catch(a){s(a)}}),this._p2pChannel.on(xt.RequestP2PUnmuteRemote,async(t,r,s)=>{if(this._joinInfo)try{await this._gateway.unmuteRemote(t,this._joinInfo.stringUid||this._joinInfo.uid),r()}catch(a){a.code===te.DISCONNECT_P2P?r():s(a)}else r()}),this._p2pChannel.on(xt.RequestP2PMuteRemote,async(t,r,s)=>{if(this._joinInfo)try{await this._gateway.muteRemote(t,this._joinInfo.stringUid||this._joinInfo.uid),r()}catch(a){a.code===te.DISCONNECT_P2P?r():s(a)}else r()}),this._p2pChannel.on(xt.StateChange,(t,r)=>{r===Yn.Connected&&this._p2pChannel.republish()})}_handleP2PChannelEvents(){this._p2pChannel.on(xt.PeerConnectionStateChange,t=>{const r=this._peerConnectionState;t!==r&&(this.safeEmit(bn.PEERCONNECTION_STATE_CHANGE,t,r),this._peerConnectionState=t)}),this._p2pChannel.on(xt.RequestMuteLocal,async(t,r,s)=>{if(this._joinInfo)try{await this._gateway.muteLocal(t,this._joinInfo.stringUid||this._joinInfo.uid),r()}catch(a){a.code===te.DISCONNECT_P2P?r():s(a)}else r()}),this._p2pChannel.on(xt.RequestUnmuteLocal,async(t,r,s)=>{if(this._joinInfo)try{await this._gateway.unmuteLocal(t,this._joinInfo.stringUid||this._joinInfo.uid),r()}catch(a){a.code===te.DISCONNECT_P2P?r():s(a)}else r()}),this._p2pChannel.on(xt.RequestRePublish,(t,r,s)=>{this.publish(t,!1).then(r).catch(s)}),this._p2pChannel.on(xt.RequestRePublishDataChannel,(t,r,s)=>{dt.all(t.map(async a=>{const c=await this._p2pChannel.publishDataChannel([a]);try{c.forEach(u=>{this._uid&&this._gateway.publishDataChannel(this._uid,u,!0)})}catch(u){if(u.code!==te.DISCONNECT_P2P)throw u}})).then(r).catch(s)}),this._p2pChannel.on(xt.RequestReSubscribe,async(t,r,s)=>{try{for(const{user:a,kind:c}of t)c===Et.VIDEO?await this.subscribe(a,"video"):await this.subscribe(a,"audio");r()}catch(a){s(a)}}),this._p2pChannel.on(xt.RequestUpload,(t,r)=>{this._gateway.upload(t,r)}),this._p2pChannel.on(xt.RequestUploadStats,t=>{this._gateway.uploadWRTCStats(t)}),this._p2pChannel.on(xt.MediaReconnectStart,t=>{this.safeEmit(bn.MEDIA_RECONNECT_START,t)}),this._p2pChannel.on(xt.MediaReconnectEnd,t=>{this.safeEmit(bn.MEDIA_RECONNECT_END,t)}),this._p2pChannel.on(xt.NeedSignalRTT,t=>{t(this._gateway.getSignalRTT())}),this._p2pChannel.on(xt.RequestRestartICE,async t=>{if(this.store.useP2P)return;const r=await this._p2pChannel.restartICE(t),s=await r.next();if(s.done)return;const a=s.value;let c;try{c=await this._gateway.restartICE({iceParameters:a})}catch(h){return void r.throw(h)}const{iceParameters:u}=function(h){const m=h.iceParameters;return{iceParameters:{iceUfrag:m.iceUfrag,icePwd:m.icePwd}}}(c);await r.next({remoteIceParameters:u})}),this._p2pChannel.on(xt.RequestReconnect,async()=>{this._gateway.reconnect()}),this._p2pChannel.on(xt.RequestReconnectPC,async()=>{var t;const{iceParameters:r,dtlsParameters:s,rtpCapabilities:a}=await this._p2pChannel.startP2PConnection({turnServer:(t=this._joinInfo)===null||t===void 0?void 0:t.turnServer}),{gatewayEstablishParams:c,gatewayAddress:u}=await this._gateway.reconnectPC({iceParameters:r,dtlsParameters:s,rtpCapabilities:a}),h=KH(c,u);await this._p2pChannel.connect(h),await this._p2pChannel.republish(),await this._p2pChannel.reSubscribe()}),this._p2pChannel.on(xt.RequestUnpublishForReconnectPC,async(t,r,s)=>{this._joinInfo&&this._uid!==void 0?(await this._gateway.unpublish(t,this._uid),r()):s()}),this._p2pChannel.on(xt.P2PLost,()=>{this.safeEmit(bn.P2P_LOST,this.store.uid)}),this._p2pChannel.on(xt.UpdateVideoEncoder,t=>{t._encoderConfig&&this._gateway.setVideoProfile(t._encoderConfig)}),this._p2pChannel.on(xt.ConnectionTypeChange,t=>{this.safeEmit(bn.IS_USING_CLOUD_PROXY,t)}),this._p2pChannel.on(xt.RequestLowStreamParameter,t=>{t(this._lowStreamParameter||{width:160,height:120,framerate:15,bitrate:50})}),this._p2pChannel.on(xt.QueryClientConnectionState,t=>{t(this.connectionState)}),this._p2pChannel.on(xt.AudioMetadata,t=>{this.safeEmit(bn.AUDIO_METADATA,t)})}getKeyMetrics(){return this.store.keyMetrics}async enableContentInspect(t){if(!this._joinInfo||this.connectionState!=="CONNECTED")throw new Oe(te.INVALID_OPERATION,"[".concat(this._clientId,"] can not create content inspect, please join channel first"));if(this._inspect)throw new Oe(te.INVALID_OPERATION,"[".concat(this._clientId,"] Inspect content service already in connecting/connected state"));try{const s=(r={config:t},hp("ContentInspect").create(r));this._inspect=s,this.handleVideoInspectEvents(s);const{appId:a,cname:c,sid:u,token:h,uid:m,cid:y,vid:v}=this._joinInfo;await s.init({appId:a,areaCode:"",cname:c,sid:u,token:h,uid:m,cid:y,vid:v?Number(v):0},ki)}catch(s){throw Array.isArray(s)?s[0]:s}var r}handleVideoInspectEvents(t){t.on(us.CONNECTION_STATE_CHANGE,(r,s)=>{if(this.safeEmit(bn.CONTENT_INSPECT_CONNECTION_STATE_CHANGE,r,s),s===Cu.CONNECTED){if(this.connectionState!=="CONNECTED")return void this.safeEmit(bn.CONTENT_INSPECT_ERROR,new Oe(te.OPERATION_ABORTED,"Content inspect was cancelled because it left the channel"));t.inspectImage()}}),t.on(us.INSPECT_RESULT,(r,s)=>{var a;if((s==null?void 0:s.code)===te.INVALID_OPERATION&&this.connectionState==="DISCONNECTED")return x.debug("Stop inspect content because that has left channel"),this==null||(a=this._inspect)===null||a===void 0||a.close(),void(this._inspect=void 0);this.safeEmit(bn.CONTENT_INSPECT_RESULT,r,s)}),t.on(us.CLIENT_LOCAL_VIDEO_TRACK,r=>{r(this.localTracks.filter(s=>s.trackMediaType==="video")[0])})}async disableContentInspect(){if(!this._inspect)throw new Oe(te.INVALID_OPERATION,"[".concat(this._clientId,"] inspectVideoContent not started"));try{this._inspect.close(),this._inspect=void 0}catch(t){throw Array.isArray(t)?t[0]:t}}async setImageModeration(t,r){if(sp(t,"enabled"),t){if(!r)throw new Oe(te.INVALID_PARAMS,"config is required");if(d7(r),!this._joinInfo)throw new Oe(te.INVALID_OPERATION,"can not create image moderation, please join channel first");try{if(this._moderation)this._moderation.updateConfig(r);else{const a=(s={config:r},hp("ImageModeration").create(s));this._moderation=a,this.handleImageModerationEvents(a);const{appId:c,cname:u,sid:h,token:m,uid:y,cid:v,vid:S}=this._joinInfo;await a.init({appId:c,areaCode:"",cname:u,sid:h,token:m,uid:y,cid:v,vid:S?Number(S):0},ki)}}catch(a){throw Array.isArray(a)?a[0]:a}}else{var s;if(!this._moderation)throw new Oe(te.INVALID_OPERATION,"[".concat(this._clientId,"] image moderation not started"));try{this._moderation.close(),this._moderation.removeAllListeners(),this._moderation=void 0}catch(a){throw Array.isArray(a)?a[0]:a}}}handleImageModerationEvents(t){t.on(wd.CONNECTION_STATE_CHANGE,(r,s)=>{if(this.safeEmit(bn.IMAGE_MODERATION_CONNECTION_STATE_CHANGE,r,s),r===kl.CONNECTED){if(this.connectionState!=="CONNECTED")throw this.setImageModeration(!1),new Oe(te.OPERATION_ABORTED,"Image moderation was cancelled because it left the channel");t.inspectImage()}}),t.on(wd.CLIENT_LOCAL_VIDEO_TRACK,r=>{r(this.localTracks.filter(s=>s.trackMediaType==="video")[0])})}setP2PTransport(t){if(function(r){Hi(r,"transport",["default","auto","relay","sd-rtn"])}(t),this.mode!=="p2p")throw new Oe(te.INVALID_OPERATION,"only p2p mode can set p2pTransport");this.store.p2pTransport=t,x.info("[".concat(this._clientId,"] set client p2pTransport to ").concat(t))}getJoinChannelServiceRecords(){return x.debug("getJoinChannelServiceRecords"),this.store.joinChannelServiceRecords}async setPublishAudioFilterEnabled(t){sp(t,"enabled"),rr("ENABLE_PUBLISH_AUDIO_FILTER",t),this._joinInfo&&await this._gateway.setPublishAudioFilterEnabled(t)}_handleResetAddStream(t,r){switch(r){case"audio":t._audio_added_=!1,t._trust_audio_stream_added_state_=!0;break;case"video":t._video_added_=!1,t._trust_video_stream_added_state_=!0}}},wt(pt.prototype,"leave",[h7],Object.getOwnPropertyDescriptor(pt.prototype,"leave"),pt.prototype),wt(pt.prototype,"publish",[f7],Object.getOwnPropertyDescriptor(pt.prototype,"publish"),pt.prototype),wt(pt.prototype,"unpublish",[p7],Object.getOwnPropertyDescriptor(pt.prototype,"unpublish"),pt.prototype),wt(pt.prototype,"subscribe",[m7],Object.getOwnPropertyDescriptor(pt.prototype,"subscribe"),pt.prototype),wt(pt.prototype,"presubscribe",[g7],Object.getOwnPropertyDescriptor(pt.prototype,"presubscribe"),pt.prototype),wt(pt.prototype,"massSubscribe",[_7],Object.getOwnPropertyDescriptor(pt.prototype,"massSubscribe"),pt.prototype),wt(pt.prototype,"unsubscribe",[y7],Object.getOwnPropertyDescriptor(pt.prototype,"unsubscribe"),pt.prototype),wt(pt.prototype,"massUnsubscribe",[E7],Object.getOwnPropertyDescriptor(pt.prototype,"massUnsubscribe"),pt.prototype),wt(pt.prototype,"setLowStreamParameter",[v7],Object.getOwnPropertyDescriptor(pt.prototype,"setLowStreamParameter"),pt.prototype),wt(pt.prototype,"enableDualStream",[S7],Object.getOwnPropertyDescriptor(pt.prototype,"enableDualStream"),pt.prototype),wt(pt.prototype,"disableDualStream",[b7],Object.getOwnPropertyDescriptor(pt.prototype,"disableDualStream"),pt.prototype),wt(pt.prototype,"setClientRole",[T7],Object.getOwnPropertyDescriptor(pt.prototype,"setClientRole"),pt.prototype),wt(pt.prototype,"_setClientRoleOptions",[w7],Object.getOwnPropertyDescriptor(pt.prototype,"_setClientRoleOptions"),pt.prototype),wt(pt.prototype,"setProxyServer",[C7],Object.getOwnPropertyDescriptor(pt.prototype,"setProxyServer"),pt.prototype),wt(pt.prototype,"setTurnServer",[R7],Object.getOwnPropertyDescriptor(pt.prototype,"setTurnServer"),pt.prototype),wt(pt.prototype,"setLicense",[I7],Object.getOwnPropertyDescriptor(pt.prototype,"setLicense"),pt.prototype),wt(pt.prototype,"startProxyServer",[A7],Object.getOwnPropertyDescriptor(pt.prototype,"startProxyServer"),pt.prototype),wt(pt.prototype,"stopProxyServer",[P7],Object.getOwnPropertyDescriptor(pt.prototype,"stopProxyServer"),pt.prototype),wt(pt.prototype,"setLocalAccessPointsV2",[O7],Object.getOwnPropertyDescriptor(pt.prototype,"setLocalAccessPointsV2"),pt.prototype),wt(pt.prototype,"setLocalAccessPoints",[k7],Object.getOwnPropertyDescriptor(pt.prototype,"setLocalAccessPoints"),pt.prototype),wt(pt.prototype,"setRemoteDefaultVideoStreamType",[N7],Object.getOwnPropertyDescriptor(pt.prototype,"setRemoteDefaultVideoStreamType"),pt.prototype),wt(pt.prototype,"setRemoteVideoStreamType",[D7],Object.getOwnPropertyDescriptor(pt.prototype,"setRemoteVideoStreamType"),pt.prototype),wt(pt.prototype,"setStreamFallbackOption",[x7],Object.getOwnPropertyDescriptor(pt.prototype,"setStreamFallbackOption"),pt.prototype),wt(pt.prototype,"setEncryptionConfig",[L7],Object.getOwnPropertyDescriptor(pt.prototype,"setEncryptionConfig"),pt.prototype),wt(pt.prototype,"renewToken",[M7],Object.getOwnPropertyDescriptor(pt.prototype,"renewToken"),pt.prototype),wt(pt.prototype,"enableAudioVolumeIndicator",[U7],Object.getOwnPropertyDescriptor(pt.prototype,"enableAudioVolumeIndicator"),pt.prototype),wt(pt.prototype,"startLiveStreaming",[V7],Object.getOwnPropertyDescriptor(pt.prototype,"startLiveStreaming"),pt.prototype),wt(pt.prototype,"setLiveTranscoding",[F7],Object.getOwnPropertyDescriptor(pt.prototype,"setLiveTranscoding"),pt.prototype),wt(pt.prototype,"stopLiveStreaming",[j7],Object.getOwnPropertyDescriptor(pt.prototype,"stopLiveStreaming"),pt.prototype),wt(pt.prototype,"startChannelMediaRelay",[B7],Object.getOwnPropertyDescriptor(pt.prototype,"startChannelMediaRelay"),pt.prototype),wt(pt.prototype,"updateChannelMediaRelay",[W7],Object.getOwnPropertyDescriptor(pt.prototype,"updateChannelMediaRelay"),pt.prototype),wt(pt.prototype,"stopChannelMediaRelay",[z7],Object.getOwnPropertyDescriptor(pt.prototype,"stopChannelMediaRelay"),pt.prototype),wt(pt.prototype,"sendCustomReportMessage",[G7],Object.getOwnPropertyDescriptor(pt.prototype,"sendCustomReportMessage"),pt.prototype),wt(pt.prototype,"pickSVCLayer",[H7],Object.getOwnPropertyDescriptor(pt.prototype,"pickSVCLayer"),pt.prototype),wt(pt.prototype,"setRTMConfig",[$7],Object.getOwnPropertyDescriptor(pt.prototype,"setRTMConfig"),pt.prototype),wt(pt.prototype,"enableContentInspect",[K7],Object.getOwnPropertyDescriptor(pt.prototype,"enableContentInspect"),pt.prototype),wt(pt.prototype,"disableContentInspect",[q7],Object.getOwnPropertyDescriptor(pt.prototype,"disableContentInspect"),pt.prototype),wt(pt.prototype,"setImageModeration",[Y7],Object.getOwnPropertyDescriptor(pt.prototype,"setImageModeration"),pt.prototype),wt(pt.prototype,"setP2PTransport",[X7],Object.getOwnPropertyDescriptor(pt.prototype,"setP2PTransport"),pt.prototype),wt(pt.prototype,"getJoinChannelServiceRecords",[J7],Object.getOwnPropertyDescriptor(pt.prototype,"getJoinChannelServiceRecords"),pt.prototype),wt(pt.prototype,"setPublishAudioFilterEnabled",[Q7],Object.getOwnPropertyDescriptor(pt.prototype,"setPublishAudioFilterEnabled"),pt.prototype),pt);class ZT{constructor(r,s){K(this,"id",0),K(this,"element",void 0),K(this,"peerPair",void 0),K(this,"context",void 0),K(this,"audioPlayerElement",void 0),K(this,"audioTrack",void 0),ZT.count+=1,this.id=ZT.count,this.element=r,this.context=s}initPeers(){this.peerPair=[new RTCPeerConnection,new RTCPeerConnection],this.peerPair[1].ontrack=r=>{const s=document.createElement("audio");s.srcObject=new MediaStream([r.track]),s.play(),this.audioPlayerElement=s}}async switchSdp(){if(!this.peerPair)return;const r=async(a,c)=>{const u=c==="offer"?await a.createOffer():await a.createAnswer();return await a.setLocalDescription(u),a.iceGatheringState==="complete"?a.localDescription:new dt(h=>{a.onicegatheringstatechange=()=>{a.iceGatheringState==="complete"&&h(a.localDescription)}})},s=async(a,c)=>await a.setRemoteDescription(c);try{const a=await r(this.peerPair[0],"offer");await s(this.peerPair[1],a);const c=await r(this.peerPair[1],"answer");await s(this.peerPair[0],c)}catch(a){throw new Oe(te.LOCAL_AEC_ERROR,a.toString()).print()}}async getTracksFromMediaElement(r){if(this.audioTrack)return this.audioTrack;let s;try{r instanceof HTMLVideoElement&&(r.captureStream?r.captureStream():r.mozCaptureStream()),s=this.context.createMediaStreamDestination(),this.context.createMediaElementSource(r).connect(s)}catch(c){throw new Oe(te.LOCAL_AEC_ERROR,c.toString()).print()}if(!s)throw new Oe(te.LOCAL_AEC_ERROR,"no dest node when local aec").print();const a=s.stream.getAudioTracks()[0];return this.audioTrack=a,a}getElement(){return this.element}async startEchoCancellation(){this.context.resume(),this.peerPair&&this.close(),this.initPeers();const r=this.element,s=await this.getTracksFromMediaElement(r);this.peerPair&&this.peerPair[0].addTrack(s),await this.switchSdp()}close(){x.debug("close echo cancellation unit, id is",this.id),this.audioPlayerElement&&this.audioPlayerElement.pause(),this.peerPair&&this.peerPair.forEach(r=>{r.close()}),this.peerPair=void 0,this.audioPlayerElement=void 0}}var e$,XP;K(ZT,"count",0);const u_e=window.AudioContext||window.webkitAudioContext,d_e=new(e$=jt({report:At}),wt((XP=class{constructor(){K(this,"units",[]),K(this,"context",void 0)}processExternalMediaAEC(t){if(!this._doesEnvironmentNeedAEC())return x.debug("the system does not need to process local aec"),-1;this.context||(this.context=new u_e);let r=this.units.find(s=>s&&s.getElement()===t);return r||(r=new ZT(t,this.context),this.units.push(r)),r.startEchoCancellation(),x.debug("start processing local audio echo cancellation, id is",r.id),r.id}_doesEnvironmentNeedAEC(){return Dn().name!==Gn.SAFARI}}).prototype,"processExternalMediaAEC",[e$],Object.getOwnPropertyDescriptor(XP.prototype,"processExternalMediaAEC"),XP.prototype),XP);function t$(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}function n$(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?t$(Object(s),!0).forEach(function(a){K(t,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):t$(Object(s)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))})}return t}const z2=window||document;function r$(t){let r=arguments.length>1&&arguments[1]!==void 0&&arguments[1];if(!z2)return;const s=Ni._cspEventHandlerPointer;if(s&&r)return void console.error(s,r);const a=c=>{if(!(c&&c.blockedURI&&(Ni.onSecurityPolicyViolation||Ni.getListeners(Ih.SECURITY_POLICY_VIOLATION).length>0)))return;const u=c.blockedURI;oe("CSP_DETECTED_HOSTNAME_LIST").some(h=>ot(u).call(u,h))&&(Ni.onSecurityPolicyViolation&&typeof Ni.onSecurityPolicyViolation=="function"&&Ni.onSecurityPolicyViolation(c),Ni.getListeners(Ih.SECURITY_POLICY_VIOLATION).length>0&&Ni.safeEmit(Ih.SECURITY_POLICY_VIOLATION,c))};s&&z2.removeEventListener("securitypolicyviolation",s),(r||t&&typeof t=="function"||Ni.getListeners(Ih.SECURITY_POLICY_VIOLATION).length>0)&&z2.addEventListener("securitypolicyviolation",a),Ni._cspEventHandlerPointer=a}var h_e=O,f_e=jW,i$=RegExp.prototype,p_e=function(t){return t===i$||h_e(i$,t)?f_e(t):t.flags},So=l(p_e);function ES(t){let r=t.length;for(;--r>=0;)t[r]=0}const G2=256,s$=286,ew=30,tw=15,H2=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),JP=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),m_e=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),o$=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),mp=new Array(576);ES(mp);const nw=new Array(60);ES(nw);const rw=new Array(512);ES(rw);const iw=new Array(256);ES(iw);const $2=new Array(29);ES($2);const QP=new Array(ew);function K2(t,r,s,a,c){this.static_tree=t,this.extra_bits=r,this.extra_base=s,this.elems=a,this.max_length=c,this.has_stree=t&&t.length}let a$,c$,l$;function q2(t,r){this.dyn_tree=t,this.max_code=0,this.stat_desc=r}ES(QP);const u$=t=>t<256?rw[t]:rw[256+(t>>>7)],sw=(t,r)=>{t.pending_buf[t.pending++]=255&r,t.pending_buf[t.pending++]=r>>>8&255},rl=(t,r,s)=>{t.bi_valid>16-s?(t.bi_buf|=r<<t.bi_valid&65535,sw(t,t.bi_buf),t.bi_buf=r>>16-t.bi_valid,t.bi_valid+=s-16):(t.bi_buf|=r<<t.bi_valid&65535,t.bi_valid+=s)},Nh=(t,r,s)=>{rl(t,s[2*r],s[2*r+1])},d$=(t,r)=>{let s=0;do s|=1&t,t>>>=1,s<<=1;while(--r>0);return s>>>1},h$=(t,r,s)=>{const a=new Array(16);let c,u,h=0;for(c=1;c<=tw;c++)h=h+s[c-1]<<1,a[c]=h;for(u=0;u<=r;u++){let m=t[2*u+1];m!==0&&(t[2*u]=d$(a[m]++,m))}},f$=t=>{let r;for(r=0;r<s$;r++)t.dyn_ltree[2*r]=0;for(r=0;r<ew;r++)t.dyn_dtree[2*r]=0;for(r=0;r<19;r++)t.bl_tree[2*r]=0;t.dyn_ltree[512]=1,t.opt_len=t.static_len=0,t.sym_next=t.matches=0},p$=t=>{t.bi_valid>8?sw(t,t.bi_buf):t.bi_valid>0&&(t.pending_buf[t.pending++]=t.bi_buf),t.bi_buf=0,t.bi_valid=0},m$=(t,r,s,a)=>{const c=2*r,u=2*s;return t[c]<t[u]||t[c]===t[u]&&a[r]<=a[s]},Y2=(t,r,s)=>{const a=t.heap[s];let c=s<<1;for(;c<=t.heap_len&&(c<t.heap_len&&m$(r,t.heap[c+1],t.heap[c],t.depth)&&c++,!m$(r,a,t.heap[c],t.depth));)t.heap[s]=t.heap[c],s=c,c<<=1;t.heap[s]=a},g$=(t,r,s)=>{let a,c,u,h,m=0;if(t.sym_next!==0)do a=255&t.pending_buf[t.sym_buf+m++],a+=(255&t.pending_buf[t.sym_buf+m++])<<8,c=t.pending_buf[t.sym_buf+m++],a===0?Nh(t,c,r):(u=iw[c],Nh(t,u+G2+1,r),h=H2[u],h!==0&&(c-=$2[u],rl(t,c,h)),a--,u=u$(a),Nh(t,u,s),h=JP[u],h!==0&&(a-=QP[u],rl(t,a,h)));while(m<t.sym_next);Nh(t,256,r)},X2=(t,r)=>{const s=r.dyn_tree,a=r.stat_desc.static_tree,c=r.stat_desc.has_stree,u=r.stat_desc.elems;let h,m,y,v=-1;for(t.heap_len=0,t.heap_max=573,h=0;h<u;h++)s[2*h]!==0?(t.heap[++t.heap_len]=v=h,t.depth[h]=0):s[2*h+1]=0;for(;t.heap_len<2;)y=t.heap[++t.heap_len]=v<2?++v:0,s[2*y]=1,t.depth[y]=0,t.opt_len--,c&&(t.static_len-=a[2*y+1]);for(r.max_code=v,h=t.heap_len>>1;h>=1;h--)Y2(t,s,h);y=u;do h=t.heap[1],t.heap[1]=t.heap[t.heap_len--],Y2(t,s,1),m=t.heap[1],t.heap[--t.heap_max]=h,t.heap[--t.heap_max]=m,s[2*y]=s[2*h]+s[2*m],t.depth[y]=(t.depth[h]>=t.depth[m]?t.depth[h]:t.depth[m])+1,s[2*h+1]=s[2*m+1]=y,t.heap[1]=y++,Y2(t,s,1);while(t.heap_len>=2);t.heap[--t.heap_max]=t.heap[1],((S,R)=>{const P=R.dyn_tree,D=R.max_code,G=R.stat_desc.static_tree,F=R.stat_desc.has_stree,j=R.stat_desc.extra_bits,Y=R.stat_desc.extra_base,ee=R.stat_desc.max_length;let fe,Se,we,ye,Ne,Ye,ht=0;for(ye=0;ye<=tw;ye++)S.bl_count[ye]=0;for(P[2*S.heap[S.heap_max]+1]=0,fe=S.heap_max+1;fe<573;fe++)Se=S.heap[fe],ye=P[2*P[2*Se+1]+1]+1,ye>ee&&(ye=ee,ht++),P[2*Se+1]=ye,Se>D||(S.bl_count[ye]++,Ne=0,Se>=Y&&(Ne=j[Se-Y]),Ye=P[2*Se],S.opt_len+=Ye*(ye+Ne),F&&(S.static_len+=Ye*(G[2*Se+1]+Ne)));if(ht!==0){do{for(ye=ee-1;S.bl_count[ye]===0;)ye--;S.bl_count[ye]--,S.bl_count[ye+1]+=2,S.bl_count[ee]--,ht-=2}while(ht>0);for(ye=ee;ye!==0;ye--)for(Se=S.bl_count[ye];Se!==0;)we=S.heap[--fe],we>D||(P[2*we+1]!==ye&&(S.opt_len+=(ye-P[2*we+1])*P[2*we],P[2*we+1]=ye),Se--)}})(t,r),h$(s,v,t.bl_count)},_$=(t,r,s)=>{let a,c,u=-1,h=r[1],m=0,y=7,v=4;for(h===0&&(y=138,v=3),r[2*(s+1)+1]=65535,a=0;a<=s;a++)c=h,h=r[2*(a+1)+1],++m<y&&c===h||(m<v?t.bl_tree[2*c]+=m:c!==0?(c!==u&&t.bl_tree[2*c]++,t.bl_tree[32]++):m<=10?t.bl_tree[34]++:t.bl_tree[36]++,m=0,u=c,h===0?(y=138,v=3):c===h?(y=6,v=3):(y=7,v=4))},y$=(t,r,s)=>{let a,c,u=-1,h=r[1],m=0,y=7,v=4;for(h===0&&(y=138,v=3),a=0;a<=s;a++)if(c=h,h=r[2*(a+1)+1],!(++m<y&&c===h)){if(m<v)do Nh(t,c,t.bl_tree);while(--m!=0);else c!==0?(c!==u&&(Nh(t,c,t.bl_tree),m--),Nh(t,16,t.bl_tree),rl(t,m-3,2)):m<=10?(Nh(t,17,t.bl_tree),rl(t,m-3,3)):(Nh(t,18,t.bl_tree),rl(t,m-11,7));m=0,u=c,h===0?(y=138,v=3):c===h?(y=6,v=3):(y=7,v=4)}};let E$=!1;const v$=(t,r,s,a)=>{rl(t,0+(a?1:0),3),p$(t),sw(t,s),sw(t,~s),s&&t.pending_buf.set(t.window.subarray(r,r+s),t.pending),t.pending+=s};var g_e=t=>{E$||((()=>{let r,s,a,c,u;const h=new Array(16);for(a=0,c=0;c<28;c++)for($2[c]=a,r=0;r<1<<H2[c];r++)iw[a++]=c;for(iw[a-1]=c,u=0,c=0;c<16;c++)for(QP[c]=u,r=0;r<1<<JP[c];r++)rw[u++]=c;for(u>>=7;c<ew;c++)for(QP[c]=u<<7,r=0;r<1<<JP[c]-7;r++)rw[256+u++]=c;for(s=0;s<=tw;s++)h[s]=0;for(r=0;r<=143;)mp[2*r+1]=8,r++,h[8]++;for(;r<=255;)mp[2*r+1]=9,r++,h[9]++;for(;r<=279;)mp[2*r+1]=7,r++,h[7]++;for(;r<=287;)mp[2*r+1]=8,r++,h[8]++;for(h$(mp,287,h),r=0;r<ew;r++)nw[2*r+1]=5,nw[2*r]=d$(r,5);a$=new K2(mp,H2,257,s$,tw),c$=new K2(nw,JP,0,ew,tw),l$=new K2(new Array(0),m_e,0,19,7)})(),E$=!0),t.l_desc=new q2(t.dyn_ltree,a$),t.d_desc=new q2(t.dyn_dtree,c$),t.bl_desc=new q2(t.bl_tree,l$),t.bi_buf=0,t.bi_valid=0,f$(t)},__e=(t,r,s,a)=>{let c,u,h=0;t.level>0?(t.strm.data_type===2&&(t.strm.data_type=(m=>{let y,v=4093624447;for(y=0;y<=31;y++,v>>>=1)if(1&v&&m.dyn_ltree[2*y]!==0)return 0;if(m.dyn_ltree[18]!==0||m.dyn_ltree[20]!==0||m.dyn_ltree[26]!==0)return 1;for(y=32;y<G2;y++)if(m.dyn_ltree[2*y]!==0)return 1;return 0})(t)),X2(t,t.l_desc),X2(t,t.d_desc),h=(m=>{let y;for(_$(m,m.dyn_ltree,m.l_desc.max_code),_$(m,m.dyn_dtree,m.d_desc.max_code),X2(m,m.bl_desc),y=18;y>=3&&m.bl_tree[2*o$[y]+1]===0;y--);return m.opt_len+=3*(y+1)+5+5+4,y})(t),c=t.opt_len+3+7>>>3,u=t.static_len+3+7>>>3,u<=c&&(c=u)):c=u=s+5,s+4<=c&&r!==-1?v$(t,r,s,a):t.strategy===4||u===c?(rl(t,2+(a?1:0),3),g$(t,mp,nw)):(rl(t,4+(a?1:0),3),((m,y,v,S)=>{let R;for(rl(m,y-257,5),rl(m,v-1,5),rl(m,S-4,4),R=0;R<S;R++)rl(m,m.bl_tree[2*o$[R]+1],3);y$(m,m.dyn_ltree,y-1),y$(m,m.dyn_dtree,v-1)})(t,t.l_desc.max_code+1,t.d_desc.max_code+1,h+1),g$(t,t.dyn_ltree,t.dyn_dtree)),f$(t),a&&p$(t)},y_e=(t,r,s)=>(t.pending_buf[t.sym_buf+t.sym_next++]=r,t.pending_buf[t.sym_buf+t.sym_next++]=r>>8,t.pending_buf[t.sym_buf+t.sym_next++]=s,r===0?t.dyn_ltree[2*s]++:(t.matches++,r--,t.dyn_ltree[2*(iw[s]+G2+1)]++,t.dyn_dtree[2*u$(r)]++),t.sym_next===t.sym_end),E_e=t=>{rl(t,2,3),Nh(t,256,mp),(r=>{r.bi_valid===16?(sw(r,r.bi_buf),r.bi_buf=0,r.bi_valid=0):r.bi_valid>=8&&(r.pending_buf[r.pending++]=255&r.bi_buf,r.bi_buf>>=8,r.bi_valid-=8)})(t)},v_e={_tr_init:g_e,_tr_stored_block:v$,_tr_flush_block:__e,_tr_tally:y_e,_tr_align:E_e},ow=(t,r,s,a)=>{let c=65535&t|0,u=t>>>16&65535|0,h=0;for(;s!==0;){h=s>2e3?2e3:s,s-=h;do c=c+r[a++]|0,u=u+c|0;while(--h);c%=65521,u%=65521}return c|u<<16|0};const S_e=new Uint32Array((()=>{let t,r=[];for(var s=0;s<256;s++){t=s;for(var a=0;a<8;a++)t=1&t?3988292384^t>>>1:t>>>1;r[s]=t}return r})());var zo=(t,r,s,a)=>{const c=S_e,u=a+s;t^=-1;for(let h=a;h<u;h++)t=t>>>8^c[255&(t^r[h])];return-1^t},oy={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},ZP={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:b_e,_tr_stored_block:J2,_tr_flush_block:T_e,_tr_tally:rg,_tr_align:w_e}=v_e,{Z_NO_FLUSH:ig,Z_PARTIAL_FLUSH:C_e,Z_FULL_FLUSH:R_e,Z_FINISH:Ou,Z_BLOCK:S$,Z_OK:_a,Z_STREAM_END:b$,Z_STREAM_ERROR:Dh,Z_DATA_ERROR:I_e,Z_BUF_ERROR:Q2,Z_DEFAULT_COMPRESSION:A_e,Z_FILTERED:P_e,Z_HUFFMAN_ONLY:eO,Z_RLE:O_e,Z_FIXED:k_e,Z_DEFAULT_STRATEGY:N_e,Z_UNKNOWN:D_e,Z_DEFLATED:tO}=ZP,Z2=286,x_e=30,L_e=19,M_e=2*Z2+1,U_e=15,ay=258,xh=262,vS=42,cy=113,aw=666,ly=(t,r)=>(t.msg=oy[r],r),T$=t=>2*t-(t>4?9:0),sg=t=>{let r=t.length;for(;--r>=0;)t[r]=0},V_e=t=>{let r,s,a,c=t.w_size;r=t.hash_size,a=r;do s=t.head[--a],t.head[a]=s>=c?s-c:0;while(--r);r=c,a=r;do s=t.prev[--a],t.prev[a]=s>=c?s-c:0;while(--r)};let og=(t,r,s)=>(r<<t.hash_shift^s)&t.hash_mask;const Dl=t=>{const r=t.state;let s=r.pending;s>t.avail_out&&(s=t.avail_out),s!==0&&(t.output.set(r.pending_buf.subarray(r.pending_out,r.pending_out+s),t.next_out),t.next_out+=s,r.pending_out+=s,t.total_out+=s,t.avail_out-=s,r.pending-=s,r.pending===0&&(r.pending_out=0))},xl=(t,r)=>{T_e(t,t.block_start>=0?t.block_start:-1,t.strstart-t.block_start,r),t.block_start=t.strstart,Dl(t.strm)},ti=(t,r)=>{t.pending_buf[t.pending++]=r},cw=(t,r)=>{t.pending_buf[t.pending++]=r>>>8&255,t.pending_buf[t.pending++]=255&r},eM=(t,r,s,a)=>{let c=t.avail_in;return c>a&&(c=a),c===0?0:(t.avail_in-=c,r.set(t.input.subarray(t.next_in,t.next_in+c),s),t.state.wrap===1?t.adler=ow(t.adler,r,c,s):t.state.wrap===2&&(t.adler=zo(t.adler,r,c,s)),t.next_in+=c,t.total_in+=c,c)},w$=(t,r)=>{let s,a,c=t.max_chain_length,u=t.strstart,h=t.prev_length,m=t.nice_match;const y=t.strstart>t.w_size-xh?t.strstart-(t.w_size-xh):0,v=t.window,S=t.w_mask,R=t.prev,P=t.strstart+ay;let D=v[u+h-1],G=v[u+h];t.prev_length>=t.good_match&&(c>>=2),m>t.lookahead&&(m=t.lookahead);do if(s=r,v[s+h]===G&&v[s+h-1]===D&&v[s]===v[u]&&v[++s]===v[u+1]){u+=2,s++;do;while(v[++u]===v[++s]&&v[++u]===v[++s]&&v[++u]===v[++s]&&v[++u]===v[++s]&&v[++u]===v[++s]&&v[++u]===v[++s]&&v[++u]===v[++s]&&v[++u]===v[++s]&&u<P);if(a=ay-(P-u),u=P-ay,a>h){if(t.match_start=r,h=a,a>=m)break;D=v[u+h-1],G=v[u+h]}}while((r=R[r&S])>y&&--c!=0);return h<=t.lookahead?h:t.lookahead},SS=t=>{const r=t.w_size;let s,a,c;do{if(a=t.window_size-t.lookahead-t.strstart,t.strstart>=r+(r-xh)&&(t.window.set(t.window.subarray(r,r+r-a),0),t.match_start-=r,t.strstart-=r,t.block_start-=r,t.insert>t.strstart&&(t.insert=t.strstart),V_e(t),a+=r),t.strm.avail_in===0)break;if(s=eM(t.strm,t.window,t.strstart+t.lookahead,a),t.lookahead+=s,t.lookahead+t.insert>=3)for(c=t.strstart-t.insert,t.ins_h=t.window[c],t.ins_h=og(t,t.ins_h,t.window[c+1]);t.insert&&(t.ins_h=og(t,t.ins_h,t.window[c+3-1]),t.prev[c&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=c,c++,t.insert--,!(t.lookahead+t.insert<3)););}while(t.lookahead<xh&&t.strm.avail_in!==0)},C$=(t,r)=>{let s,a,c,u=t.pending_buf_size-5>t.w_size?t.w_size:t.pending_buf_size-5,h=0,m=t.strm.avail_in;do{if(s=65535,c=t.bi_valid+42>>3,t.strm.avail_out<c||(c=t.strm.avail_out-c,a=t.strstart-t.block_start,s>a+t.strm.avail_in&&(s=a+t.strm.avail_in),s>c&&(s=c),s<u&&(s===0&&r!==Ou||r===ig||s!==a+t.strm.avail_in)))break;h=r===Ou&&s===a+t.strm.avail_in?1:0,J2(t,0,0,h),t.pending_buf[t.pending-4]=s,t.pending_buf[t.pending-3]=s>>8,t.pending_buf[t.pending-2]=~s,t.pending_buf[t.pending-1]=~s>>8,Dl(t.strm),a&&(a>s&&(a=s),t.strm.output.set(t.window.subarray(t.block_start,t.block_start+a),t.strm.next_out),t.strm.next_out+=a,t.strm.avail_out-=a,t.strm.total_out+=a,t.block_start+=a,s-=a),s&&(eM(t.strm,t.strm.output,t.strm.next_out,s),t.strm.next_out+=s,t.strm.avail_out-=s,t.strm.total_out+=s)}while(h===0);return m-=t.strm.avail_in,m&&(m>=t.w_size?(t.matches=2,t.window.set(t.strm.input.subarray(t.strm.next_in-t.w_size,t.strm.next_in),0),t.strstart=t.w_size,t.insert=t.strstart):(t.window_size-t.strstart<=m&&(t.strstart-=t.w_size,t.window.set(t.window.subarray(t.w_size,t.w_size+t.strstart),0),t.matches<2&&t.matches++,t.insert>t.strstart&&(t.insert=t.strstart)),t.window.set(t.strm.input.subarray(t.strm.next_in-m,t.strm.next_in),t.strstart),t.strstart+=m,t.insert+=m>t.w_size-t.insert?t.w_size-t.insert:m),t.block_start=t.strstart),t.high_water<t.strstart&&(t.high_water=t.strstart),h?4:r!==ig&&r!==Ou&&t.strm.avail_in===0&&t.strstart===t.block_start?2:(c=t.window_size-t.strstart,t.strm.avail_in>c&&t.block_start>=t.w_size&&(t.block_start-=t.w_size,t.strstart-=t.w_size,t.window.set(t.window.subarray(t.w_size,t.w_size+t.strstart),0),t.matches<2&&t.matches++,c+=t.w_size,t.insert>t.strstart&&(t.insert=t.strstart)),c>t.strm.avail_in&&(c=t.strm.avail_in),c&&(eM(t.strm,t.window,t.strstart,c),t.strstart+=c,t.insert+=c>t.w_size-t.insert?t.w_size-t.insert:c),t.high_water<t.strstart&&(t.high_water=t.strstart),c=t.bi_valid+42>>3,c=t.pending_buf_size-c>65535?65535:t.pending_buf_size-c,u=c>t.w_size?t.w_size:c,a=t.strstart-t.block_start,(a>=u||(a||r===Ou)&&r!==ig&&t.strm.avail_in===0&&a<=c)&&(s=a>c?c:a,h=r===Ou&&t.strm.avail_in===0&&s===a?1:0,J2(t,t.block_start,s,h),t.block_start+=s,Dl(t.strm)),h?3:1)},tM=(t,r)=>{let s,a;for(;;){if(t.lookahead<xh){if(SS(t),t.lookahead<xh&&r===ig)return 1;if(t.lookahead===0)break}if(s=0,t.lookahead>=3&&(t.ins_h=og(t,t.ins_h,t.window[t.strstart+3-1]),s=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),s!==0&&t.strstart-s<=t.w_size-xh&&(t.match_length=w$(t,s)),t.match_length>=3)if(a=rg(t,t.strstart-t.match_start,t.match_length-3),t.lookahead-=t.match_length,t.match_length<=t.max_lazy_match&&t.lookahead>=3){t.match_length--;do t.strstart++,t.ins_h=og(t,t.ins_h,t.window[t.strstart+3-1]),s=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart;while(--t.match_length!=0);t.strstart++}else t.strstart+=t.match_length,t.match_length=0,t.ins_h=t.window[t.strstart],t.ins_h=og(t,t.ins_h,t.window[t.strstart+1]);else a=rg(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++;if(a&&(xl(t,!1),t.strm.avail_out===0))return 1}return t.insert=t.strstart<2?t.strstart:2,r===Ou?(xl(t,!0),t.strm.avail_out===0?3:4):t.sym_next&&(xl(t,!1),t.strm.avail_out===0)?1:2},bS=(t,r)=>{let s,a,c;for(;;){if(t.lookahead<xh){if(SS(t),t.lookahead<xh&&r===ig)return 1;if(t.lookahead===0)break}if(s=0,t.lookahead>=3&&(t.ins_h=og(t,t.ins_h,t.window[t.strstart+3-1]),s=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),t.prev_length=t.match_length,t.prev_match=t.match_start,t.match_length=2,s!==0&&t.prev_length<t.max_lazy_match&&t.strstart-s<=t.w_size-xh&&(t.match_length=w$(t,s),t.match_length<=5&&(t.strategy===P_e||t.match_length===3&&t.strstart-t.match_start>4096)&&(t.match_length=2)),t.prev_length>=3&&t.match_length<=t.prev_length){c=t.strstart+t.lookahead-3,a=rg(t,t.strstart-1-t.prev_match,t.prev_length-3),t.lookahead-=t.prev_length-1,t.prev_length-=2;do++t.strstart<=c&&(t.ins_h=og(t,t.ins_h,t.window[t.strstart+3-1]),s=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart);while(--t.prev_length!=0);if(t.match_available=0,t.match_length=2,t.strstart++,a&&(xl(t,!1),t.strm.avail_out===0))return 1}else if(t.match_available){if(a=rg(t,0,t.window[t.strstart-1]),a&&xl(t,!1),t.strstart++,t.lookahead--,t.strm.avail_out===0)return 1}else t.match_available=1,t.strstart++,t.lookahead--}return t.match_available&&(a=rg(t,0,t.window[t.strstart-1]),t.match_available=0),t.insert=t.strstart<2?t.strstart:2,r===Ou?(xl(t,!0),t.strm.avail_out===0?3:4):t.sym_next&&(xl(t,!1),t.strm.avail_out===0)?1:2};function Lh(t,r,s,a,c){this.good_length=t,this.max_lazy=r,this.nice_length=s,this.max_chain=a,this.func=c}const lw=[new Lh(0,0,0,0,C$),new Lh(4,4,8,4,tM),new Lh(4,5,16,8,tM),new Lh(4,6,32,32,tM),new Lh(4,4,16,16,bS),new Lh(8,16,32,32,bS),new Lh(8,16,128,128,bS),new Lh(8,32,128,256,bS),new Lh(32,128,258,1024,bS),new Lh(32,258,258,4096,bS)];function F_e(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=tO,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(2*M_e),this.dyn_dtree=new Uint16Array(2*(2*x_e+1)),this.bl_tree=new Uint16Array(2*(2*L_e+1)),sg(this.dyn_ltree),sg(this.dyn_dtree),sg(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(U_e+1),this.heap=new Uint16Array(2*Z2+1),sg(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*Z2+1),sg(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const uw=t=>{if(!t)return 1;const r=t.state;return!r||r.strm!==t||r.status!==vS&&r.status!==57&&r.status!==69&&r.status!==73&&r.status!==91&&r.status!==103&&r.status!==cy&&r.status!==aw?1:0},R$=t=>{if(uw(t))return ly(t,Dh);t.total_in=t.total_out=0,t.data_type=D_e;const r=t.state;return r.pending=0,r.pending_out=0,r.wrap<0&&(r.wrap=-r.wrap),r.status=r.wrap===2?57:r.wrap?vS:cy,t.adler=r.wrap===2?0:1,r.last_flush=-2,b_e(r),_a},I$=t=>{const r=R$(t);return r===_a&&(s=>{s.window_size=2*s.w_size,sg(s.head),s.max_lazy_match=lw[s.level].max_lazy,s.good_match=lw[s.level].good_length,s.nice_match=lw[s.level].nice_length,s.max_chain_length=lw[s.level].max_chain,s.strstart=0,s.block_start=0,s.lookahead=0,s.insert=0,s.match_length=s.prev_length=2,s.match_available=0,s.ins_h=0})(t.state),r},A$=(t,r,s,a,c,u)=>{if(!t)return Dh;let h=1;if(r===A_e&&(r=6),a<0?(h=0,a=-a):a>15&&(h=2,a-=16),c<1||c>9||s!==tO||a<8||a>15||r<0||r>9||u<0||u>k_e||a===8&&h!==1)return ly(t,Dh);a===8&&(a=9);const m=new F_e;return t.state=m,m.strm=t,m.status=vS,m.wrap=h,m.gzhead=null,m.w_bits=a,m.w_size=1<<m.w_bits,m.w_mask=m.w_size-1,m.hash_bits=c+7,m.hash_size=1<<m.hash_bits,m.hash_mask=m.hash_size-1,m.hash_shift=~~((m.hash_bits+3-1)/3),m.window=new Uint8Array(2*m.w_size),m.head=new Uint16Array(m.hash_size),m.prev=new Uint16Array(m.w_size),m.lit_bufsize=1<<c+6,m.pending_buf_size=4*m.lit_bufsize,m.pending_buf=new Uint8Array(m.pending_buf_size),m.sym_buf=m.lit_bufsize,m.sym_end=3*(m.lit_bufsize-1),m.level=r,m.strategy=u,m.method=s,I$(t)};var j_e=(t,r)=>{if(uw(t)||r>S$||r<0)return t?ly(t,Dh):Dh;const s=t.state;if(!t.output||t.avail_in!==0&&!t.input||s.status===aw&&r!==Ou)return ly(t,t.avail_out===0?Q2:Dh);const a=s.last_flush;if(s.last_flush=r,s.pending!==0){if(Dl(t),t.avail_out===0)return s.last_flush=-1,_a}else if(t.avail_in===0&&T$(r)<=T$(a)&&r!==Ou)return ly(t,Q2);if(s.status===aw&&t.avail_in!==0)return ly(t,Q2);if(s.status===vS&&s.wrap===0&&(s.status=cy),s.status===vS){let c=tO+(s.w_bits-8<<4)<<8,u=-1;if(u=s.strategy>=eO||s.level<2?0:s.level<6?1:s.level===6?2:3,c|=u<<6,s.strstart!==0&&(c|=32),c+=31-c%31,cw(s,c),s.strstart!==0&&(cw(s,t.adler>>>16),cw(s,65535&t.adler)),t.adler=1,s.status=cy,Dl(t),s.pending!==0)return s.last_flush=-1,_a}if(s.status===57){if(t.adler=0,ti(s,31),ti(s,139),ti(s,8),s.gzhead)ti(s,(s.gzhead.text?1:0)+(s.gzhead.hcrc?2:0)+(s.gzhead.extra?4:0)+(s.gzhead.name?8:0)+(s.gzhead.comment?16:0)),ti(s,255&s.gzhead.time),ti(s,s.gzhead.time>>8&255),ti(s,s.gzhead.time>>16&255),ti(s,s.gzhead.time>>24&255),ti(s,s.level===9?2:s.strategy>=eO||s.level<2?4:0),ti(s,255&s.gzhead.os),s.gzhead.extra&&s.gzhead.extra.length&&(ti(s,255&s.gzhead.extra.length),ti(s,s.gzhead.extra.length>>8&255)),s.gzhead.hcrc&&(t.adler=zo(t.adler,s.pending_buf,s.pending,0)),s.gzindex=0,s.status=69;else if(ti(s,0),ti(s,0),ti(s,0),ti(s,0),ti(s,0),ti(s,s.level===9?2:s.strategy>=eO||s.level<2?4:0),ti(s,3),s.status=cy,Dl(t),s.pending!==0)return s.last_flush=-1,_a}if(s.status===69){if(s.gzhead.extra){let c=s.pending,u=(65535&s.gzhead.extra.length)-s.gzindex;for(;s.pending+u>s.pending_buf_size;){let m=s.pending_buf_size-s.pending;if(s.pending_buf.set(s.gzhead.extra.subarray(s.gzindex,s.gzindex+m),s.pending),s.pending=s.pending_buf_size,s.gzhead.hcrc&&s.pending>c&&(t.adler=zo(t.adler,s.pending_buf,s.pending-c,c)),s.gzindex+=m,Dl(t),s.pending!==0)return s.last_flush=-1,_a;c=0,u-=m}let h=new Uint8Array(s.gzhead.extra);s.pending_buf.set(h.subarray(s.gzindex,s.gzindex+u),s.pending),s.pending+=u,s.gzhead.hcrc&&s.pending>c&&(t.adler=zo(t.adler,s.pending_buf,s.pending-c,c)),s.gzindex=0}s.status=73}if(s.status===73){if(s.gzhead.name){let c,u=s.pending;do{if(s.pending===s.pending_buf_size){if(s.gzhead.hcrc&&s.pending>u&&(t.adler=zo(t.adler,s.pending_buf,s.pending-u,u)),Dl(t),s.pending!==0)return s.last_flush=-1,_a;u=0}c=s.gzindex<s.gzhead.name.length?255&s.gzhead.name.charCodeAt(s.gzindex++):0,ti(s,c)}while(c!==0);s.gzhead.hcrc&&s.pending>u&&(t.adler=zo(t.adler,s.pending_buf,s.pending-u,u)),s.gzindex=0}s.status=91}if(s.status===91){if(s.gzhead.comment){let c,u=s.pending;do{if(s.pending===s.pending_buf_size){if(s.gzhead.hcrc&&s.pending>u&&(t.adler=zo(t.adler,s.pending_buf,s.pending-u,u)),Dl(t),s.pending!==0)return s.last_flush=-1,_a;u=0}c=s.gzindex<s.gzhead.comment.length?255&s.gzhead.comment.charCodeAt(s.gzindex++):0,ti(s,c)}while(c!==0);s.gzhead.hcrc&&s.pending>u&&(t.adler=zo(t.adler,s.pending_buf,s.pending-u,u))}s.status=103}if(s.status===103){if(s.gzhead.hcrc){if(s.pending+2>s.pending_buf_size&&(Dl(t),s.pending!==0))return s.last_flush=-1,_a;ti(s,255&t.adler),ti(s,t.adler>>8&255),t.adler=0}if(s.status=cy,Dl(t),s.pending!==0)return s.last_flush=-1,_a}if(t.avail_in!==0||s.lookahead!==0||r!==ig&&s.status!==aw){let c=s.level===0?C$(s,r):s.strategy===eO?((u,h)=>{let m;for(;;){if(u.lookahead===0&&(SS(u),u.lookahead===0)){if(h===ig)return 1;break}if(u.match_length=0,m=rg(u,0,u.window[u.strstart]),u.lookahead--,u.strstart++,m&&(xl(u,!1),u.strm.avail_out===0))return 1}return u.insert=0,h===Ou?(xl(u,!0),u.strm.avail_out===0?3:4):u.sym_next&&(xl(u,!1),u.strm.avail_out===0)?1:2})(s,r):s.strategy===O_e?((u,h)=>{let m,y,v,S;const R=u.window;for(;;){if(u.lookahead<=ay){if(SS(u),u.lookahead<=ay&&h===ig)return 1;if(u.lookahead===0)break}if(u.match_length=0,u.lookahead>=3&&u.strstart>0&&(v=u.strstart-1,y=R[v],y===R[++v]&&y===R[++v]&&y===R[++v])){S=u.strstart+ay;do;while(y===R[++v]&&y===R[++v]&&y===R[++v]&&y===R[++v]&&y===R[++v]&&y===R[++v]&&y===R[++v]&&y===R[++v]&&v<S);u.match_length=ay-(S-v),u.match_length>u.lookahead&&(u.match_length=u.lookahead)}if(u.match_length>=3?(m=rg(u,1,u.match_length-3),u.lookahead-=u.match_length,u.strstart+=u.match_length,u.match_length=0):(m=rg(u,0,u.window[u.strstart]),u.lookahead--,u.strstart++),m&&(xl(u,!1),u.strm.avail_out===0))return 1}return u.insert=0,h===Ou?(xl(u,!0),u.strm.avail_out===0?3:4):u.sym_next&&(xl(u,!1),u.strm.avail_out===0)?1:2})(s,r):lw[s.level].func(s,r);if(c!==3&&c!==4||(s.status=aw),c===1||c===3)return t.avail_out===0&&(s.last_flush=-1),_a;if(c===2&&(r===C_e?w_e(s):r!==S$&&(J2(s,0,0,!1),r===R_e&&(sg(s.head),s.lookahead===0&&(s.strstart=0,s.block_start=0,s.insert=0))),Dl(t),t.avail_out===0))return s.last_flush=-1,_a}return r!==Ou?_a:s.wrap<=0?b$:(s.wrap===2?(ti(s,255&t.adler),ti(s,t.adler>>8&255),ti(s,t.adler>>16&255),ti(s,t.adler>>24&255),ti(s,255&t.total_in),ti(s,t.total_in>>8&255),ti(s,t.total_in>>16&255),ti(s,t.total_in>>24&255)):(cw(s,t.adler>>>16),cw(s,65535&t.adler)),Dl(t),s.wrap>0&&(s.wrap=-s.wrap),s.pending!==0?_a:b$)},B_e=(t,r)=>{let s=r.length;if(uw(t))return Dh;const a=t.state,c=a.wrap;if(c===2||c===1&&a.status!==vS||a.lookahead)return Dh;if(c===1&&(t.adler=ow(t.adler,r,s,0)),a.wrap=0,s>=a.w_size){c===0&&(sg(a.head),a.strstart=0,a.block_start=0,a.insert=0);let y=new Uint8Array(a.w_size);y.set(r.subarray(s-a.w_size,s),0),r=y,s=a.w_size}const u=t.avail_in,h=t.next_in,m=t.input;for(t.avail_in=s,t.next_in=0,t.input=r,SS(a);a.lookahead>=3;){let y=a.strstart,v=a.lookahead-2;do a.ins_h=og(a,a.ins_h,a.window[y+3-1]),a.prev[y&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=y,y++;while(--v);a.strstart=y,a.lookahead=2,SS(a)}return a.strstart+=a.lookahead,a.block_start=a.strstart,a.insert=a.lookahead,a.lookahead=0,a.match_length=a.prev_length=2,a.match_available=0,t.next_in=h,t.input=m,t.avail_in=u,a.wrap=c,_a},dw={deflateInit:(t,r)=>A$(t,r,tO,15,8,N_e),deflateInit2:A$,deflateReset:I$,deflateResetKeep:R$,deflateSetHeader:(t,r)=>uw(t)||t.state.wrap!==2?Dh:(t.state.gzhead=r,_a),deflate:j_e,deflateEnd:t=>{if(uw(t))return Dh;const r=t.state.status;return t.state=null,r===cy?ly(t,I_e):_a},deflateSetDictionary:B_e,deflateInfo:"pako deflate (from Nodeca project)"};const W_e=(t,r)=>Object.prototype.hasOwnProperty.call(t,r);var nO={assign:function(t){const r=Array.prototype.slice.call(arguments,1);for(;r.length;){const s=r.shift();if(s){if(typeof s!="object")throw new TypeError(s+"must be non-object");for(const a in s)W_e(s,a)&&(t[a]=s[a])}}return t},flattenChunks:t=>{let r=0;for(let a=0,c=t.length;a<c;a++)r+=t[a].length;const s=new Uint8Array(r);for(let a=0,c=0,u=t.length;a<u;a++){let h=t[a];s.set(h,c),c+=h.length}return s}};let P$=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{P$=!1}const hw=new Uint8Array(256);for(let t=0;t<256;t++)hw[t]=t>=252?6:t>=248?5:t>=240?4:t>=224?3:t>=192?2:1;hw[254]=hw[254]=1;var fw={string2buf:t=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(t);let r,s,a,c,u,h=t.length,m=0;for(c=0;c<h;c++)s=t.charCodeAt(c),(64512&s)==55296&&c+1<h&&(a=t.charCodeAt(c+1),(64512&a)==56320&&(s=65536+(s-55296<<10)+(a-56320),c++)),m+=s<128?1:s<2048?2:s<65536?3:4;for(r=new Uint8Array(m),u=0,c=0;u<m;c++)s=t.charCodeAt(c),(64512&s)==55296&&c+1<h&&(a=t.charCodeAt(c+1),(64512&a)==56320&&(s=65536+(s-55296<<10)+(a-56320),c++)),s<128?r[u++]=s:s<2048?(r[u++]=192|s>>>6,r[u++]=128|63&s):s<65536?(r[u++]=224|s>>>12,r[u++]=128|s>>>6&63,r[u++]=128|63&s):(r[u++]=240|s>>>18,r[u++]=128|s>>>12&63,r[u++]=128|s>>>6&63,r[u++]=128|63&s);return r},buf2string:(t,r)=>{const s=r||t.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(t.subarray(0,r));let a,c;const u=new Array(2*s);for(c=0,a=0;a<s;){let h=t[a++];if(h<128){u[c++]=h;continue}let m=hw[h];if(m>4)u[c++]=65533,a+=m-1;else{for(h&=m===2?31:m===3?15:7;m>1&&a<s;)h=h<<6|63&t[a++],m--;m>1?u[c++]=65533:h<65536?u[c++]=h:(h-=65536,u[c++]=55296|h>>10&1023,u[c++]=56320|1023&h)}}return((h,m)=>{if(m<65534&&h.subarray&&P$)return String.fromCharCode.apply(null,h.length===m?h:h.subarray(0,m));let y="";for(let v=0;v<m;v++)y+=String.fromCharCode(h[v]);return y})(u,c)},utf8border:(t,r)=>{(r=r||t.length)>t.length&&(r=t.length);let s=r-1;for(;s>=0&&(192&t[s])==128;)s--;return s<0||s===0?r:s+hw[t[s]]>r?s:r}},O$=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const k$=Object.prototype.toString,{Z_NO_FLUSH:z_e,Z_SYNC_FLUSH:G_e,Z_FULL_FLUSH:H_e,Z_FINISH:$_e,Z_OK:rO,Z_STREAM_END:K_e,Z_DEFAULT_COMPRESSION:q_e,Z_DEFAULT_STRATEGY:Y_e,Z_DEFLATED:X_e}=ZP;function iO(t){this.options=nO.assign({level:q_e,method:X_e,chunkSize:16384,windowBits:15,memLevel:8,strategy:Y_e},t||{});let r=this.options;r.raw&&r.windowBits>0?r.windowBits=-r.windowBits:r.gzip&&r.windowBits>0&&r.windowBits<16&&(r.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new O$,this.strm.avail_out=0;let s=dw.deflateInit2(this.strm,r.level,r.method,r.windowBits,r.memLevel,r.strategy);if(s!==rO)throw new Error(oy[s]);if(r.header&&dw.deflateSetHeader(this.strm,r.header),r.dictionary){let a;if(a=typeof r.dictionary=="string"?fw.string2buf(r.dictionary):k$.call(r.dictionary)==="[object ArrayBuffer]"?new Uint8Array(r.dictionary):r.dictionary,s=dw.deflateSetDictionary(this.strm,a),s!==rO)throw new Error(oy[s]);this._dict_set=!0}}function J_e(t,r){const s=new iO(r);if(s.push(t,!0),s.err)throw s.msg||oy[s.err];return s.result}iO.prototype.push=function(t,r){const s=this.strm,a=this.options.chunkSize;let c,u;if(this.ended)return!1;for(u=r===~~r?r:r===!0?$_e:z_e,typeof t=="string"?s.input=fw.string2buf(t):k$.call(t)==="[object ArrayBuffer]"?s.input=new Uint8Array(t):s.input=t,s.next_in=0,s.avail_in=s.input.length;;)if(s.avail_out===0&&(s.output=new Uint8Array(a),s.next_out=0,s.avail_out=a),(u===G_e||u===H_e)&&s.avail_out<=6)this.onData(s.output.subarray(0,s.next_out)),s.avail_out=0;else{if(c=dw.deflate(s,u),c===K_e)return s.next_out>0&&this.onData(s.output.subarray(0,s.next_out)),c=dw.deflateEnd(this.strm),this.onEnd(c),this.ended=!0,c===rO;if(s.avail_out!==0){if(u>0&&s.next_out>0)this.onData(s.output.subarray(0,s.next_out)),s.avail_out=0;else if(s.avail_in===0)break}else this.onData(s.output)}return!0},iO.prototype.onData=function(t){this.chunks.push(t)},iO.prototype.onEnd=function(t){t===rO&&(this.result=nO.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};var Q_e={deflate:J_e};const sO=16209;var Z_e=function(t,r){let s,a,c,u,h,m,y,v,S,R,P,D,G,F,j,Y,ee,fe,Se,we,ye,Ne,Ye,ht;const mt=t.state;s=t.next_in,Ye=t.input,a=s+(t.avail_in-5),c=t.next_out,ht=t.output,u=c-(r-t.avail_out),h=c+(t.avail_out-257),m=mt.dmax,y=mt.wsize,v=mt.whave,S=mt.wnext,R=mt.window,P=mt.hold,D=mt.bits,G=mt.lencode,F=mt.distcode,j=(1<<mt.lenbits)-1,Y=(1<<mt.distbits)-1;e:do{D<15&&(P+=Ye[s++]<<D,D+=8,P+=Ye[s++]<<D,D+=8),ee=G[P&j];t:for(;;){if(fe=ee>>>24,P>>>=fe,D-=fe,fe=ee>>>16&255,fe===0)ht[c++]=65535&ee;else{if(!(16&fe)){if((64&fe)==0){ee=G[(65535&ee)+(P&(1<<fe)-1)];continue t}if(32&fe){mt.mode=16191;break e}t.msg="invalid literal/length code",mt.mode=sO;break e}Se=65535&ee,fe&=15,fe&&(D<fe&&(P+=Ye[s++]<<D,D+=8),Se+=P&(1<<fe)-1,P>>>=fe,D-=fe),D<15&&(P+=Ye[s++]<<D,D+=8,P+=Ye[s++]<<D,D+=8),ee=F[P&Y];n:for(;;){if(fe=ee>>>24,P>>>=fe,D-=fe,fe=ee>>>16&255,!(16&fe)){if((64&fe)==0){ee=F[(65535&ee)+(P&(1<<fe)-1)];continue n}t.msg="invalid distance code",mt.mode=sO;break e}if(we=65535&ee,fe&=15,D<fe&&(P+=Ye[s++]<<D,D+=8,D<fe&&(P+=Ye[s++]<<D,D+=8)),we+=P&(1<<fe)-1,we>m){t.msg="invalid distance too far back",mt.mode=sO;break e}if(P>>>=fe,D-=fe,fe=c-u,we>fe){if(fe=we-fe,fe>v&&mt.sane){t.msg="invalid distance too far back",mt.mode=sO;break e}if(ye=0,Ne=R,S===0){if(ye+=y-fe,fe<Se){Se-=fe;do ht[c++]=R[ye++];while(--fe);ye=c-we,Ne=ht}}else if(S<fe){if(ye+=y+S-fe,fe-=S,fe<Se){Se-=fe;do ht[c++]=R[ye++];while(--fe);if(ye=0,S<Se){fe=S,Se-=fe;do ht[c++]=R[ye++];while(--fe);ye=c-we,Ne=ht}}}else if(ye+=S-fe,fe<Se){Se-=fe;do ht[c++]=R[ye++];while(--fe);ye=c-we,Ne=ht}for(;Se>2;)ht[c++]=Ne[ye++],ht[c++]=Ne[ye++],ht[c++]=Ne[ye++],Se-=3;Se&&(ht[c++]=Ne[ye++],Se>1&&(ht[c++]=Ne[ye++]))}else{ye=c-we;do ht[c++]=ht[ye++],ht[c++]=ht[ye++],ht[c++]=ht[ye++],Se-=3;while(Se>2);Se&&(ht[c++]=ht[ye++],Se>1&&(ht[c++]=ht[ye++]))}break}}break}}while(s<a&&c<h);Se=D>>3,s-=Se,D-=Se<<3,P&=(1<<D)-1,t.next_in=s,t.next_out=c,t.avail_in=s<a?a-s+5:5-(s-a),t.avail_out=c<h?h-c+257:257-(c-h),mt.hold=P,mt.bits=D};const oO=15,eye=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),tye=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),nye=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),rye=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var pw=(t,r,s,a,c,u,h,m)=>{const y=m.bits;let v,S,R,P,D,G,F=0,j=0,Y=0,ee=0,fe=0,Se=0,we=0,ye=0,Ne=0,Ye=0,ht=null;const mt=new Uint16Array(16),In=new Uint16Array(16);let An,mr,di,Jr=null;for(F=0;F<=oO;F++)mt[F]=0;for(j=0;j<a;j++)mt[r[s+j]]++;for(fe=y,ee=oO;ee>=1&&mt[ee]===0;ee--);if(fe>ee&&(fe=ee),ee===0)return c[u++]=20971520,c[u++]=20971520,m.bits=1,0;for(Y=1;Y<ee&&mt[Y]===0;Y++);for(fe<Y&&(fe=Y),ye=1,F=1;F<=oO;F++)if(ye<<=1,ye-=mt[F],ye<0)return-1;if(ye>0&&(t===0||ee!==1))return-1;for(In[1]=0,F=1;F<oO;F++)In[F+1]=In[F]+mt[F];for(j=0;j<a;j++)r[s+j]!==0&&(h[In[r[s+j]]++]=j);if(t===0?(ht=Jr=h,G=20):t===1?(ht=eye,Jr=tye,G=257):(ht=nye,Jr=rye,G=0),Ye=0,j=0,F=Y,D=u,Se=fe,we=0,R=-1,Ne=1<<fe,P=Ne-1,t===1&&Ne>852||t===2&&Ne>592)return 1;for(;;){An=F-we,h[j]+1<G?(mr=0,di=h[j]):h[j]>=G?(mr=Jr[h[j]-G],di=ht[h[j]-G]):(mr=96,di=0),v=1<<F-we,S=1<<Se,Y=S;do S-=v,c[D+(Ye>>we)+S]=An<<24|mr<<16|di|0;while(S!==0);for(v=1<<F-1;Ye&v;)v>>=1;if(v!==0?(Ye&=v-1,Ye+=v):Ye=0,j++,--mt[F]==0){if(F===ee)break;F=r[s+h[j]]}if(F>fe&&(Ye&P)!==R){for(we===0&&(we=fe),D+=Y,Se=F-we,ye=1<<Se;Se+we<ee&&(ye-=mt[Se+we],!(ye<=0));)Se++,ye<<=1;if(Ne+=1<<Se,t===1&&Ne>852||t===2&&Ne>592)return 1;R=Ye&P,c[R]=fe<<24|Se<<16|D-u|0}}return Ye!==0&&(c[D+Ye]=F-we<<24|64<<16|0),m.bits=fe,0};const{Z_FINISH:N$,Z_BLOCK:iye,Z_TREES:aO,Z_OK:uy,Z_STREAM_END:sye,Z_NEED_DICT:oye,Z_STREAM_ERROR:ku,Z_DATA_ERROR:D$,Z_MEM_ERROR:x$,Z_BUF_ERROR:aye,Z_DEFLATED:L$}=ZP,cO=16180,lO=16190,gp=16191,nM=16192,rM=16194,uO=16199,dO=16200,iM=16206,ds=16209,M$=t=>(t>>>24&255)+(t>>>8&65280)+((65280&t)<<8)+((255&t)<<24);function cye(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const dy=t=>{if(!t)return 1;const r=t.state;return!r||r.strm!==t||r.mode<cO||r.mode>16211?1:0},U$=t=>{if(dy(t))return ku;const r=t.state;return t.total_in=t.total_out=r.total=0,t.msg="",r.wrap&&(t.adler=1&r.wrap),r.mode=cO,r.last=0,r.havedict=0,r.flags=-1,r.dmax=32768,r.head=null,r.hold=0,r.bits=0,r.lencode=r.lendyn=new Int32Array(852),r.distcode=r.distdyn=new Int32Array(592),r.sane=1,r.back=-1,uy},V$=t=>{if(dy(t))return ku;const r=t.state;return r.wsize=0,r.whave=0,r.wnext=0,U$(t)},F$=(t,r)=>{let s;if(dy(t))return ku;const a=t.state;return r<0?(s=0,r=-r):(s=5+(r>>4),r<48&&(r&=15)),r&&(r<8||r>15)?ku:(a.window!==null&&a.wbits!==r&&(a.window=null),a.wrap=s,a.wbits=r,V$(t))},j$=(t,r)=>{if(!t)return ku;const s=new cye;t.state=s,s.strm=t,s.window=null,s.mode=cO;const a=F$(t,r);return a!==uy&&(t.state=null),a};let sM,oM,B$=!0;const lye=t=>{if(B$){sM=new Int32Array(512),oM=new Int32Array(32);let r=0;for(;r<144;)t.lens[r++]=8;for(;r<256;)t.lens[r++]=9;for(;r<280;)t.lens[r++]=7;for(;r<288;)t.lens[r++]=8;for(pw(1,t.lens,0,288,sM,0,t.work,{bits:9}),r=0;r<32;)t.lens[r++]=5;pw(2,t.lens,0,32,oM,0,t.work,{bits:5}),B$=!1}t.lencode=sM,t.lenbits=9,t.distcode=oM,t.distbits=5},W$=(t,r,s,a)=>{let c;const u=t.state;return u.window===null&&(u.wsize=1<<u.wbits,u.wnext=0,u.whave=0,u.window=new Uint8Array(u.wsize)),a>=u.wsize?(u.window.set(r.subarray(s-u.wsize,s),0),u.wnext=0,u.whave=u.wsize):(c=u.wsize-u.wnext,c>a&&(c=a),u.window.set(r.subarray(s-a,s-a+c),u.wnext),(a-=c)?(u.window.set(r.subarray(s-a,s),0),u.wnext=a,u.whave=u.wsize):(u.wnext+=c,u.wnext===u.wsize&&(u.wnext=0),u.whave<u.wsize&&(u.whave+=c))),0};var uye=(t,r)=>{let s,a,c,u,h,m,y,v,S,R,P,D,G,F,j,Y,ee,fe,Se,we,ye,Ne,Ye=0;const ht=new Uint8Array(4);let mt,In;const An=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(dy(t)||!t.output||!t.input&&t.avail_in!==0)return ku;s=t.state,s.mode===gp&&(s.mode=nM),h=t.next_out,c=t.output,y=t.avail_out,u=t.next_in,a=t.input,m=t.avail_in,v=s.hold,S=s.bits,R=m,P=y,Ne=uy;e:for(;;)switch(s.mode){case cO:if(s.wrap===0){s.mode=nM;break}for(;S<16;){if(m===0)break e;m--,v+=a[u++]<<S,S+=8}if(2&s.wrap&&v===35615){s.wbits===0&&(s.wbits=15),s.check=0,ht[0]=255&v,ht[1]=v>>>8&255,s.check=zo(s.check,ht,2,0),v=0,S=0,s.mode=16181;break}if(s.head&&(s.head.done=!1),!(1&s.wrap)||(((255&v)<<8)+(v>>8))%31){t.msg="incorrect header check",s.mode=ds;break}if((15&v)!==L$){t.msg="unknown compression method",s.mode=ds;break}if(v>>>=4,S-=4,ye=8+(15&v),s.wbits===0&&(s.wbits=ye),ye>15||ye>s.wbits){t.msg="invalid window size",s.mode=ds;break}s.dmax=1<<s.wbits,s.flags=0,t.adler=s.check=1,s.mode=512&v?16189:gp,v=0,S=0;break;case 16181:for(;S<16;){if(m===0)break e;m--,v+=a[u++]<<S,S+=8}if(s.flags=v,(255&So(s))!==L$){t.msg="unknown compression method",s.mode=ds;break}if(57344&So(s)){t.msg="unknown header flags set",s.mode=ds;break}s.head&&(s.head.text=v>>8&1),512&So(s)&&4&s.wrap&&(ht[0]=255&v,ht[1]=v>>>8&255,s.check=zo(s.check,ht,2,0)),v=0,S=0,s.mode=16182;case 16182:for(;S<32;){if(m===0)break e;m--,v+=a[u++]<<S,S+=8}s.head&&(s.head.time=v),512&So(s)&&4&s.wrap&&(ht[0]=255&v,ht[1]=v>>>8&255,ht[2]=v>>>16&255,ht[3]=v>>>24&255,s.check=zo(s.check,ht,4,0)),v=0,S=0,s.mode=16183;case 16183:for(;S<16;){if(m===0)break e;m--,v+=a[u++]<<S,S+=8}s.head&&(s.head.xflags=255&v,s.head.os=v>>8),512&So(s)&&4&s.wrap&&(ht[0]=255&v,ht[1]=v>>>8&255,s.check=zo(s.check,ht,2,0)),v=0,S=0,s.mode=16184;case 16184:if(1024&So(s)){for(;S<16;){if(m===0)break e;m--,v+=a[u++]<<S,S+=8}s.length=v,s.head&&(s.head.extra_len=v),512&So(s)&&4&s.wrap&&(ht[0]=255&v,ht[1]=v>>>8&255,s.check=zo(s.check,ht,2,0)),v=0,S=0}else s.head&&(s.head.extra=null);s.mode=16185;case 16185:if(1024&So(s)&&(D=s.length,D>m&&(D=m),D&&(s.head&&(ye=s.head.extra_len-s.length,s.head.extra||(s.head.extra=new Uint8Array(s.head.extra_len)),s.head.extra.set(a.subarray(u,u+D),ye)),512&So(s)&&4&s.wrap&&(s.check=zo(s.check,a,D,u)),m-=D,u+=D,s.length-=D),s.length))break e;s.length=0,s.mode=16186;case 16186:if(2048&So(s)){if(m===0)break e;D=0;do ye=a[u+D++],s.head&&ye&&s.length<65536&&(s.head.name+=String.fromCharCode(ye));while(ye&&D<m);if(512&So(s)&&4&s.wrap&&(s.check=zo(s.check,a,D,u)),m-=D,u+=D,ye)break e}else s.head&&(s.head.name=null);s.length=0,s.mode=16187;case 16187:if(4096&So(s)){if(m===0)break e;D=0;do ye=a[u+D++],s.head&&ye&&s.length<65536&&(s.head.comment+=String.fromCharCode(ye));while(ye&&D<m);if(512&So(s)&&4&s.wrap&&(s.check=zo(s.check,a,D,u)),m-=D,u+=D,ye)break e}else s.head&&(s.head.comment=null);s.mode=16188;case 16188:if(512&So(s)){for(;S<16;){if(m===0)break e;m--,v+=a[u++]<<S,S+=8}if(4&s.wrap&&v!==(65535&s.check)){t.msg="header crc mismatch",s.mode=ds;break}v=0,S=0}s.head&&(s.head.hcrc=So(s)>>9&1,s.head.done=!0),t.adler=s.check=0,s.mode=gp;break;case 16189:for(;S<32;){if(m===0)break e;m--,v+=a[u++]<<S,S+=8}t.adler=s.check=M$(v),v=0,S=0,s.mode=lO;case lO:if(s.havedict===0)return t.next_out=h,t.avail_out=y,t.next_in=u,t.avail_in=m,s.hold=v,s.bits=S,oye;t.adler=s.check=1,s.mode=gp;case gp:if(r===iye||r===aO)break e;case nM:if(s.last){v>>>=7&S,S-=7&S,s.mode=iM;break}for(;S<3;){if(m===0)break e;m--,v+=a[u++]<<S,S+=8}switch(s.last=1&v,v>>>=1,S-=1,3&v){case 0:s.mode=16193;break;case 1:if(lye(s),s.mode=uO,r===aO){v>>>=2,S-=2;break e}break;case 2:s.mode=16196;break;case 3:t.msg="invalid block type",s.mode=ds}v>>>=2,S-=2;break;case 16193:for(v>>>=7&S,S-=7&S;S<32;){if(m===0)break e;m--,v+=a[u++]<<S,S+=8}if((65535&v)!=(v>>>16^65535)){t.msg="invalid stored block lengths",s.mode=ds;break}if(s.length=65535&v,v=0,S=0,s.mode=rM,r===aO)break e;case rM:s.mode=16195;case 16195:if(D=s.length,D){if(D>m&&(D=m),D>y&&(D=y),D===0)break e;c.set(a.subarray(u,u+D),h),m-=D,u+=D,y-=D,h+=D,s.length-=D;break}s.mode=gp;break;case 16196:for(;S<14;){if(m===0)break e;m--,v+=a[u++]<<S,S+=8}if(s.nlen=257+(31&v),v>>>=5,S-=5,s.ndist=1+(31&v),v>>>=5,S-=5,s.ncode=4+(15&v),v>>>=4,S-=4,s.nlen>286||s.ndist>30){t.msg="too many length or distance symbols",s.mode=ds;break}s.have=0,s.mode=16197;case 16197:for(;s.have<s.ncode;){for(;S<3;){if(m===0)break e;m--,v+=a[u++]<<S,S+=8}s.lens[An[s.have++]]=7&v,v>>>=3,S-=3}for(;s.have<19;)s.lens[An[s.have++]]=0;if(s.lencode=s.lendyn,s.lenbits=7,mt={bits:s.lenbits},Ne=pw(0,s.lens,0,19,s.lencode,0,s.work,mt),s.lenbits=mt.bits,Ne){t.msg="invalid code lengths set",s.mode=ds;break}s.have=0,s.mode=16198;case 16198:for(;s.have<s.nlen+s.ndist;){for(;Ye=s.lencode[v&(1<<s.lenbits)-1],j=Ye>>>24,Y=Ye>>>16&255,ee=65535&Ye,!(j<=S);){if(m===0)break e;m--,v+=a[u++]<<S,S+=8}if(ee<16)v>>>=j,S-=j,s.lens[s.have++]=ee;else{if(ee===16){for(In=j+2;S<In;){if(m===0)break e;m--,v+=a[u++]<<S,S+=8}if(v>>>=j,S-=j,s.have===0){t.msg="invalid bit length repeat",s.mode=ds;break}ye=s.lens[s.have-1],D=3+(3&v),v>>>=2,S-=2}else if(ee===17){for(In=j+3;S<In;){if(m===0)break e;m--,v+=a[u++]<<S,S+=8}v>>>=j,S-=j,ye=0,D=3+(7&v),v>>>=3,S-=3}else{for(In=j+7;S<In;){if(m===0)break e;m--,v+=a[u++]<<S,S+=8}v>>>=j,S-=j,ye=0,D=11+(127&v),v>>>=7,S-=7}if(s.have+D>s.nlen+s.ndist){t.msg="invalid bit length repeat",s.mode=ds;break}for(;D--;)s.lens[s.have++]=ye}}if(s.mode===ds)break;if(s.lens[256]===0){t.msg="invalid code -- missing end-of-block",s.mode=ds;break}if(s.lenbits=9,mt={bits:s.lenbits},Ne=pw(1,s.lens,0,s.nlen,s.lencode,0,s.work,mt),s.lenbits=mt.bits,Ne){t.msg="invalid literal/lengths set",s.mode=ds;break}if(s.distbits=6,s.distcode=s.distdyn,mt={bits:s.distbits},Ne=pw(2,s.lens,s.nlen,s.ndist,s.distcode,0,s.work,mt),s.distbits=mt.bits,Ne){t.msg="invalid distances set",s.mode=ds;break}if(s.mode=uO,r===aO)break e;case uO:s.mode=dO;case dO:if(m>=6&&y>=258){t.next_out=h,t.avail_out=y,t.next_in=u,t.avail_in=m,s.hold=v,s.bits=S,Z_e(t,P),h=t.next_out,c=t.output,y=t.avail_out,u=t.next_in,a=t.input,m=t.avail_in,v=s.hold,S=s.bits,s.mode===gp&&(s.back=-1);break}for(s.back=0;Ye=s.lencode[v&(1<<s.lenbits)-1],j=Ye>>>24,Y=Ye>>>16&255,ee=65535&Ye,!(j<=S);){if(m===0)break e;m--,v+=a[u++]<<S,S+=8}if(Y&&(240&Y)==0){for(fe=j,Se=Y,we=ee;Ye=s.lencode[we+((v&(1<<fe+Se)-1)>>fe)],j=Ye>>>24,Y=Ye>>>16&255,ee=65535&Ye,!(fe+j<=S);){if(m===0)break e;m--,v+=a[u++]<<S,S+=8}v>>>=fe,S-=fe,s.back+=fe}if(v>>>=j,S-=j,s.back+=j,s.length=ee,Y===0){s.mode=16205;break}if(32&Y){s.back=-1,s.mode=gp;break}if(64&Y){t.msg="invalid literal/length code",s.mode=ds;break}s.extra=15&Y,s.mode=16201;case 16201:if(s.extra){for(In=s.extra;S<In;){if(m===0)break e;m--,v+=a[u++]<<S,S+=8}s.length+=v&(1<<s.extra)-1,v>>>=s.extra,S-=s.extra,s.back+=s.extra}s.was=s.length,s.mode=16202;case 16202:for(;Ye=s.distcode[v&(1<<s.distbits)-1],j=Ye>>>24,Y=Ye>>>16&255,ee=65535&Ye,!(j<=S);){if(m===0)break e;m--,v+=a[u++]<<S,S+=8}if((240&Y)==0){for(fe=j,Se=Y,we=ee;Ye=s.distcode[we+((v&(1<<fe+Se)-1)>>fe)],j=Ye>>>24,Y=Ye>>>16&255,ee=65535&Ye,!(fe+j<=S);){if(m===0)break e;m--,v+=a[u++]<<S,S+=8}v>>>=fe,S-=fe,s.back+=fe}if(v>>>=j,S-=j,s.back+=j,64&Y){t.msg="invalid distance code",s.mode=ds;break}s.offset=ee,s.extra=15&Y,s.mode=16203;case 16203:if(s.extra){for(In=s.extra;S<In;){if(m===0)break e;m--,v+=a[u++]<<S,S+=8}s.offset+=v&(1<<s.extra)-1,v>>>=s.extra,S-=s.extra,s.back+=s.extra}if(s.offset>s.dmax){t.msg="invalid distance too far back",s.mode=ds;break}s.mode=16204;case 16204:if(y===0)break e;if(D=P-y,s.offset>D){if(D=s.offset-D,D>s.whave&&s.sane){t.msg="invalid distance too far back",s.mode=ds;break}D>s.wnext?(D-=s.wnext,G=s.wsize-D):G=s.wnext-D,D>s.length&&(D=s.length),F=s.window}else F=c,G=h-s.offset,D=s.length;D>y&&(D=y),y-=D,s.length-=D;do c[h++]=F[G++];while(--D);s.length===0&&(s.mode=dO);break;case 16205:if(y===0)break e;c[h++]=s.length,y--,s.mode=dO;break;case iM:if(s.wrap){for(;S<32;){if(m===0)break e;m--,v|=a[u++]<<S,S+=8}if(P-=y,t.total_out+=P,s.total+=P,4&s.wrap&&P&&(t.adler=s.check=So(s)?zo(s.check,c,P,h-P):ow(s.check,c,P,h-P)),P=y,4&s.wrap&&(So(s)?v:M$(v))!==s.check){t.msg="incorrect data check",s.mode=ds;break}v=0,S=0}s.mode=16207;case 16207:if(s.wrap&&So(s)){for(;S<32;){if(m===0)break e;m--,v+=a[u++]<<S,S+=8}if(4&s.wrap&&v!==(4294967295&s.total)){t.msg="incorrect length check",s.mode=ds;break}v=0,S=0}s.mode=16208;case 16208:Ne=sye;break e;case ds:Ne=D$;break e;case 16210:return x$;default:return ku}return t.next_out=h,t.avail_out=y,t.next_in=u,t.avail_in=m,s.hold=v,s.bits=S,(s.wsize||P!==t.avail_out&&s.mode<ds&&(s.mode<iM||r!==N$))&&W$(t,t.output,t.next_out,P-t.avail_out),R-=t.avail_in,P-=t.avail_out,t.total_in+=R,t.total_out+=P,s.total+=P,4&s.wrap&&P&&(t.adler=s.check=So(s)?zo(s.check,c,P,t.next_out-P):ow(s.check,c,P,t.next_out-P)),t.data_type=s.bits+(s.last?64:0)+(s.mode===gp?128:0)+(s.mode===uO||s.mode===rM?256:0),(R===0&&P===0||r===N$)&&Ne===uy&&(Ne=aye),Ne},_p={inflateReset:V$,inflateReset2:F$,inflateResetKeep:U$,inflateInit:t=>j$(t,15),inflateInit2:j$,inflate:uye,inflateEnd:t=>{if(dy(t))return ku;let r=t.state;return r.window&&(r.window=null),t.state=null,uy},inflateGetHeader:(t,r)=>{if(dy(t))return ku;const s=t.state;return(2&s.wrap)==0?ku:(s.head=r,r.done=!1,uy)},inflateSetDictionary:(t,r)=>{const s=r.length;let a,c,u;return dy(t)?ku:(a=t.state,a.wrap!==0&&a.mode!==lO?ku:a.mode===lO&&(c=1,c=ow(c,r,s,0),c!==a.check)?D$:(u=W$(t,r,s,s),u?(a.mode=16210,x$):(a.havedict=1,uy)))},inflateInfo:"pako inflate (from Nodeca project)"},dye=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const z$=Object.prototype.toString,{Z_NO_FLUSH:hye,Z_FINISH:fye,Z_OK:mw,Z_STREAM_END:aM,Z_NEED_DICT:cM,Z_STREAM_ERROR:pye,Z_DATA_ERROR:G$,Z_MEM_ERROR:mye}=ZP;function hO(t){this.options=nO.assign({chunkSize:65536,windowBits:15,to:""},t||{});const r=this.options;r.raw&&r.windowBits>=0&&r.windowBits<16&&(r.windowBits=-r.windowBits,r.windowBits===0&&(r.windowBits=-15)),!(r.windowBits>=0&&r.windowBits<16)||t&&t.windowBits||(r.windowBits+=32),r.windowBits>15&&r.windowBits<48&&(15&r.windowBits)==0&&(r.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new O$,this.strm.avail_out=0;let s=_p.inflateInit2(this.strm,r.windowBits);if(s!==mw)throw new Error(oy[s]);if(this.header=new dye,_p.inflateGetHeader(this.strm,this.header),r.dictionary&&(typeof r.dictionary=="string"?r.dictionary=fw.string2buf(r.dictionary):z$.call(r.dictionary)==="[object ArrayBuffer]"&&(r.dictionary=new Uint8Array(r.dictionary)),r.raw&&(s=_p.inflateSetDictionary(this.strm,r.dictionary),s!==mw)))throw new Error(oy[s])}function gye(t,r){const s=new hO(r);if(s.push(t),s.err)throw s.msg||oy[s.err];return s.result}hO.prototype.push=function(t,r){const s=this.strm,a=this.options.chunkSize,c=this.options.dictionary;let u,h,m;if(this.ended)return!1;for(h=r===~~r?r:r===!0?fye:hye,z$.call(t)==="[object ArrayBuffer]"?s.input=new Uint8Array(t):s.input=t,s.next_in=0,s.avail_in=s.input.length;;){for(s.avail_out===0&&(s.output=new Uint8Array(a),s.next_out=0,s.avail_out=a),u=_p.inflate(s,h),u===cM&&c&&(u=_p.inflateSetDictionary(s,c),u===mw?u=_p.inflate(s,h):u===G$&&(u=cM));s.avail_in>0&&u===aM&&s.state.wrap>0&&t[s.next_in]!==0;)_p.inflateReset(s),u=_p.inflate(s,h);switch(u){case pye:case G$:case cM:case mye:return this.onEnd(u),this.ended=!0,!1}if(m=s.avail_out,s.next_out&&(s.avail_out===0||u===aM))if(this.options.to==="string"){let y=fw.utf8border(s.output,s.next_out),v=s.next_out-y,S=fw.buf2string(s.output,y);s.next_out=v,s.avail_out=a-v,v&&s.output.set(s.output.subarray(y,y+v),0),this.onData(S)}else this.onData(s.output.length===s.next_out?s.output:s.output.subarray(0,s.next_out));if(u!==mw||m!==0){if(u===aM)return u=_p.inflateEnd(this.strm),this.onEnd(u),this.ended=!0,!0;if(s.avail_in===0)break}}return!0},hO.prototype.onData=function(t){this.chunks.push(t)},hO.prototype.onEnd=function(t){t===mw&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=nO.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};var _ye={inflate:gye};const{deflate:yye}=Q_e,{inflate:Eye}=_ye;var vye=yye,Sye=Eye,H$=function(t){return t[t.ONE_BYTE=0]="ONE_BYTE",t[t.TWO_BYTE=1]="TWO_BYTE",t}(H$||{});class bye{constructor(){K(this,"_sequence",0),K(this,"_startTime",Date.now()),K(this,"isUseOneByte",!0)}get startTime(){const r=Date.now()-this._startTime;return r<Math.pow(2,16)?r:(this._startTime+=Math.pow(2,16),this.startTime)}get sequence(){return this._sequence<Math.pow(2,32)?this._sequence++:(this._sequence-=Math.pow(2,32),this.sequence)}serialize(r){const s={commonPacketHeader:{length:0,reserved:0,extension:0,sequence:this.sequence},commonStreamHeader:this.startTime,extension:void 0,payload:r};if(r.byteLength>128){const m=new Uint8Array(4);m.set([1,0,0,0]);const y={id:0,length:4,data:m.buffer},v={profile:this.isUseOneByte?0:1,length:this.isUseOneByte?5:6,datas:[y]};s.commonPacketHeader.extension=1,s.extension=v,s.payload=this.compress(r),s.commonPacketHeader.length=8+(s.extension.length+2)+s.payload.byteLength}else s.commonPacketHeader.length=8+s.payload.byteLength;oe("SHOW_DATASTREAM2_LOG")&&x.debug("send data header: ".concat(JSON.stringify(s.commonPacketHeader)));const a=new ArrayBuffer(s.commonPacketHeader.length),c=new Uint8Array(a),u=new DataView(a);let h=0;if(u.setUint16(h,s.commonPacketHeader.extension<<15|s.commonPacketHeader.reserved<<14|s.commonPacketHeader.length,!0),h+=2,u.setUint32(h,s.commonPacketHeader.sequence,!0),h+=4,u.setUint16(h,s.commonStreamHeader,!0),h+=2,s.extension){const m=this.serializeExtension(s.extension);c.set(new Uint8Array(m),h),h+=m.byteLength}if(c.set(new Uint8Array(s.payload),h),h+=s.payload.byteLength,h!==s.commonPacketHeader.length)throw Error("serialize error!");return a}deserialize(r){if(r.byteLength<4)return new ArrayBuffer(0);const s=new DataView(r);let a=0;const c=s.getUint16(a,!0);a+=2;const u={length:16383&c,reserved:(16384&c)>>14,extension:(32768&c)>>15,sequence:s.getUint16(a+2,!0)<<16|s.getUint16(a,!0)};let h,m;if(a+=4,oe("SHOW_DATASTREAM2_LOG")&&x.debug("receive data header: ".concat(JSON.stringify(u))),s.getUint16(a,!0),a+=2,u.extension){m=this.deserializeExtension(r.slice(a)),a+=2+m.length,h=r.slice(a);let y=!1;if(m.datas.length>0){const v=m.datas.find(S=>S.id===0);v&&(y=(1&new DataView(v.data).getUint32(0,!0))==1)}h=y?this.decompress(h):h}else h=r.slice(8);return h}serializeExtension(r){const{profile:s,length:a,datas:c}=r,u=new ArrayBuffer(a+2),h=new Uint8Array(u),m=new DataView(u);let y=0;if(m.setUint8(y++,s),m.setUint8(y++,a),c.forEach(v=>{s?(m.setUint8(y++,v.id),m.setUint8(y++,v.length),h.set(new Uint8Array(v.data),y),y+=v.data.byteLength):(m.setUint8(y++,v.id|v.length<<4),h.set(new Uint8Array(v.data),y),y+=v.data.byteLength)}),y!==a+2)throw Error("serialize extension error, is ".concat(y,"!==").concat(a+2));return u}deserializeExtension(r){const s=new DataView(r);let a=0;const c=s.getUint8(a);a++;const u=s.getUint8(a);a++;const h=c===H$.TWO_BYTE,m=[],y=new DataView(r,2);let v=0;for(;v<u;){let S=0,R=0,P=new ArrayBuffer(0);h?(S=y.getUint8(v),v++,R=y.getUint8(v),v++):(S=15&y.getUint8(v),R=y.getUint8(v)>>4,v++),R>0&&(P=y.buffer.slice(v+2,v+2+R),v+=P.byteLength),m.push({id:S,length:R,data:P})}if(v!==u)throw Error("parse error");return{profile:c,length:u,datas:m}}decompress(r){return Sye(new Uint8Array(r))}compress(r){return vye(new Uint8Array(r))}}const Tye={name:"DataStream",create:(t,r)=>{const s=r?new Ome(t):new kme(t);return s.useDataStream(new bye),s}};class wye extends Fr{constructor(r,s,a){super(),K(this,"ws",void 0),K(this,"requestId",1),K(this,"heartBeatTimer",void 0),K(this,"joinInfo",void 0),K(this,"clientId",void 0),K(this,"onOpen",()=>{this.emit("open"),this.startHeartBeatCheck()}),K(this,"onClose",c=>{this.emit("close"),this.dispose()}),K(this,"onMessage",c=>{const u=JSON.parse(c.data);if(!u||u.command!=="serverResponse"||!u.requestId)return u&&u.command==="serverStatus"&&u.serverStatus&&u.serverStatus.command?(this.emit("status",u.serverStatus),void this.emit(u.serverStatus.command,u.serverStatus)):void 0;this.emit("req_".concat(u.requestId),u)}),this.joinInfo=r,this.clientId=s,this.ws=new BT("cross-channel-".concat(this.clientId),a),this.ws.on(Zt.RECONNECTING,()=>{this.ws.reconnectMode="retry",this.emit("reconnecting")}),this.ws.on(Zt.CONNECTED,this.onOpen),this.ws.on(Zt.ON_MESSAGE,this.onMessage),this.ws.on(Zt.CLOSED,this.onClose)}isConnect(){return this.ws.state==="connected"}sendMessage(r){const s=this.requestId++;return r.requestId=s,r.seq=s,this.ws.sendMessage(r),s}waitStatus(r){return new dt((s,a)=>{const c=window.setTimeout(()=>{a(new Oe(te.TIMEOUT,"wait status timeout, status: ".concat(r)))},5e3);this.once(r,u=>{window.clearTimeout(c),u.state&&u.state!==0?a(new Oe(te.CROSS_CHANNEL_WAIT_STATUS_ERROR,"wait status error, status: ".concat(r))):s(void 0)}),this.once("dispose",()=>{window.clearTimeout(c),a(new Oe(te.WS_ABORT))})})}async request(r){if(this.ws.state==="closed")throw new Oe(te.WS_DISCONNECT);const s=()=>new dt((h,m)=>{this.ws.once(Zt.CLOSED,()=>m(new Oe(te.WS_ABORT))),this.ws.once(Zt.CONNECTED,h)});this.ws.state!=="connected"&&await s();const a=this.sendMessage(r),c=new dt((h,m)=>{const y=()=>{m(new Oe(te.WS_ABORT))};this.ws.once(Zt.RECONNECTING,y),this.ws.once(Zt.CLOSED,y),this.once("req_".concat(a),h),ps(3e3).then(()=>{this.removeAllListeners("req_".concat(a)),this.ws.off(Zt.RECONNECTING,y),this.ws.off(Zt.CLOSED,y),m(new Oe(te.TIMEOUT,"cross channel ws request timeout"))})}),u=await c;if(!u||u.code!==200)throw new Oe(te.CROSS_CHANNEL_SERVER_ERROR_RESPONSE,"response: ".concat(JSON.stringify(u)));return u}async connect(r){this.ws.removeAllListeners(Zt.REQUEST_NEW_URLS),this.ws.on(Zt.REQUEST_NEW_URLS,s=>{s(r)}),await this.ws.init(r)}dispose(){this.clearHeartBeatCheck(),this.emit("dispose"),this.removeAllListeners(),this.ws.close()}sendPing(r){const s=this.requestId++;return r.requestId=s,this.ws.sendMessage(r),s}startHeartBeatCheck(){this.heartBeatTimer&&window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=window.setInterval(()=>{this.sendPing({command:"ping",appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sid:this.joinInfo.sid,ts:+new Date,requestId:0})},3e3)}clearHeartBeatCheck(){window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=void 0}}class Cye extends Fr{set state(r){r!==this._state&&(r!==za.RELAY_STATE_FAILURE&&(this.errorCode=oS.RELAY_OK),this.emit("state",r,this.errorCode),this._state=r)}get state(){return this._state}constructor(r,s,a,c,u){super(),K(this,"joinInfo",void 0),K(this,"sid",void 0),K(this,"clientId",void 0),K(this,"cancelToken",ha.CancelToken.source()),K(this,"workerToken",void 0),K(this,"requestId",0),K(this,"signal",void 0),K(this,"prevChannelMediaConfig",void 0),K(this,"httpRetryConfig",void 0),K(this,"_resolution",void 0),K(this,"_state",za.RELAY_STATE_IDLE),K(this,"errorCode",oS.RELAY_OK),K(this,"onStatus",h=>{x.debug("[".concat(this.clientId,"] ChannelMediaStatus: ").concat(JSON.stringify(h))),h&&h.command&&(h.command==="onAudioPacketReceived"&&this.emit("event",up.PACKET_RECEIVED_AUDIO_FROM_SRC),h.command==="onVideoPacketReceived"&&this.emit("event",up.PACKET_RECEIVED_VIDEO_FROM_SRC),h.command==="onSrcTokenPrivilegeDidExpire"&&(this.errorCode=oS.SRC_TOKEN_EXPIRED,this.state=za.RELAY_STATE_FAILURE),h.command==="onDestTokenPrivilegeDidExpire"&&(this.errorCode=oS.DEST_TOKEN_EXPIRED,this.state=za.RELAY_STATE_FAILURE))}),K(this,"onReconnect",async()=>{x.debug("[".concat(this.clientId,"] ChannelMediaSocket disconnect, reconnecting")),this.emit("event",up.NETWORK_DISCONNECTED),this.state=za.RELAY_STATE_IDLE,this.prevChannelMediaConfig&&this.sendStartRelayMessage(this.prevChannelMediaConfig).catch(h=>{this.state!==za.RELAY_STATE_IDLE&&(x.error("auto restart channel media relay failed",h.toString()),this.errorCode=oS.SERVER_CONNECTION_LOST,this.state=za.RELAY_STATE_FAILURE)})}),this.joinInfo=r,this.clientId=s,this.sid=z_(),this.signal=new wye(this.joinInfo,this.clientId,a),this.httpRetryConfig=c,this._resolution=u}async startChannelMediaRelay(r){if(this.state!==za.RELAY_STATE_IDLE)throw new Oe(te.INVALID_OPERATION);this.state=za.RELAY_STATE_CONNECTING,await this.connect(),x.debug("[".concat(this.clientId,"] startChannelMediaRelay: connect success"));try{await this.sendStartRelayMessage(r)}catch(s){throw s.data&&s.data.serverResponse&&s.data.serverResponse.command==="SetSourceChannel"?new Oe(te.CROSS_CHANNEL_FAILED_JOIN_SRC):s.data&&s.data.serverResponse&&s.serverResponse.command==="SetDestChannelStatus"?new Oe(te.CROSS_CHANNEL_FAILED_JOIN_DEST):s.data&&s.data.serverResponse&&s.serverResponse.command==="StartPacketTransfer"?new Oe(te.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST):s}this.prevChannelMediaConfig=r}async updateChannelMediaRelay(r){if(this.state!==za.RELAY_STATE_RUNNING)throw new Oe(te.INVALID_OPERATION);await this.sendUpdateMessage(r),this.prevChannelMediaConfig=r}async setVideoProfile(r){if(this._resolution=r,this.state!==za.RELAY_STATE_RUNNING)throw new Oe(te.INVALID_OPERATION);const s=this.genMessage(Wo.SetVideoProfile);await this.signal.request(s),x.debug("[".concat(this.clientId,"] startChannelMediaRelay: setVideoProfile success"))}async stopChannelMediaRelay(){await this.sendStopRelayMessage(),x.debug("[".concat(this.clientId,"] stopChannelMediaRelay: send stop message success")),this.state=za.RELAY_STATE_IDLE,this.dispose()}dispose(){x.debug("[".concat(this.clientId,"] disposeChannelMediaRelay")),this.cancelToken.cancel(),this.cancelToken=ha.CancelToken.source(),this.state=za.RELAY_STATE_IDLE,this.emit("dispose"),this.signal.dispose(),this.prevChannelMediaConfig=void 0}async connect(){const r=await Lge(this.joinInfo,this.cancelToken.token,this.httpRetryConfig);this.workerToken=r.workerToken,await this.signal.connect(r.addressList),this.emit("event",up.NETWORK_CONNECTED),this.signal.on("status",this.onStatus),this.signal.on("reconnecting",this.onReconnect)}async sendStartRelayMessage(r){const s=this.genMessage(Wo.StopPacketTransfer);await this.signal.request(s),await this.signal.waitStatus("Normal Quit"),x.debug("[".concat(this.clientId,"] startChannelMediaRelay: StopPacketTransfer success"));const a=this.genMessage(Wo.SetSdkProfile,r);await this.signal.request(a),x.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSdkProfile success"));const c=this.genMessage(Wo.SetSourceChannel,r);await this.signal.request(c),await this.signal.waitStatus("SetSourceChannelStatus"),this.emit("event",up.PACKET_JOINED_SRC_CHANNEL),x.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceChannel success"));const u=this.genMessage(Wo.SetSourceUserId,r);await this.signal.request(u),x.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceUserId success"));const h=this.genMessage(Wo.SetDestChannel,r);await this.signal.request(h),await this.signal.waitStatus("SetDestChannelStatus"),this.emit("event",up.PACKET_JOINED_DEST_CHANNEL),x.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetDestChannel success"));const m=this.genMessage(Wo.StartPacketTransfer,r);await this.signal.request(m),this.emit("event",up.PACKET_SENT_TO_DEST_CHANNEL),this.state=za.RELAY_STATE_RUNNING,x.debug("[".concat(this.clientId,"] startChannelMediaRelay: StartPacketTransfer success")),this.setVideoProfile(this._resolution)}async sendUpdateMessage(r){const s=this.genMessage(Wo.UpdateDestChannel,r);await this.signal.request(s),this.emit("event",up.PACKET_UPDATE_DEST_CHANNEL),x.debug("[".concat(this.clientId,"] sendUpdateMessage: UpdateDestChannel success"))}async sendStopRelayMessage(){const r=this.genMessage(Wo.StopPacketTransfer);await this.signal.request(r),x.debug("[".concat(this.clientId,"] sendStopRelayMessage: StopPacketTransfer success"))}genMessage(r,s){const a=[],c=[],u=[];this.requestId+=1;const h={appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sdkVersion:Al,sid:this.sid,ts:Date.now(),requestId:this.requestId,seq:this.requestId,allocate:!0,clientRequest:{}};h.sdkVersion==="4.23.2"&&(h.sdkVersion="0.0.1");let m=null,y=null;switch(r){case Wo.SetSdkProfile:return h.clientRequest={command:"SetSdkProfile",type:"multi_channel"},h;case Wo.SetSourceChannel:if(y=s&&s.getSrcChannelMediaInfo(),!y)throw new Oe(te.UNEXPECTED_ERROR,"can not find source config");return h.clientRequest={command:"SetSourceChannel",uid:"0",channelName:y.channelName,token:y.token||this.joinInfo.appId},h;case Wo.SetSourceUserId:if(y=s&&s.getSrcChannelMediaInfo(),!y)throw new Oe(te.UNEXPECTED_ERROR,"can not find source config");return h.clientRequest={command:"SetSourceUserId",uid:y.uid+""},h;case Wo.SetDestChannel:if(m=s&&s.getDestChannelMediaInfo(),!m)throw new Oe(te.UNEXPECTED_ERROR,"can not find dest config");return m.forEach(v=>{a.push(v.channelName),c.push(v.uid+""),u.push(v.token||this.joinInfo.appId)}),h.clientRequest={command:"SetDestChannel",channelName:a,uid:c,token:u},h;case Wo.StartPacketTransfer:return h.clientRequest={command:"StartPacketTransfer"},h;case Wo.Reconnect:return h.clientRequest={command:"Reconnect"},h;case Wo.StopPacketTransfer:return h.clientRequest={command:"StopPacketTransfer"},h;case Wo.UpdateDestChannel:if(m=s&&s.getDestChannelMediaInfo(),!m)throw new Oe(te.UNEXPECTED_ERROR,"can not find dest config");return m.forEach(v=>{a.push(v.channelName),c.push(v.uid+""),u.push(v.token||this.joinInfo.appId)}),h.clientRequest={command:"UpdateDestChannel",channelName:a,uid:c,token:u},h;case Wo.SetVideoProfile:h.clientRequest={command:"SetVideoProfile",width:this._resolution.width,height:this._resolution.height}}return h}}const Rye={name:"ChannelMediaRelay",create:function(t){return new Cye(t.joinInfo,t.clientId,t.websocketRetryConfig||ki,t.httpRetryConfig||ki,t.resolution)}};function $$(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}function gw(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?$$(Object(s),!0).forEach(function(a){K(t,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):$$(Object(s)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))})}return t}class Iye extends Fr{constructor(r,s,a,c){super(),K(this,"spec",void 0),K(this,"token",void 0),K(this,"websocket",void 0),K(this,"pingpongTimer",void 0),K(this,"reconnectMode","retry"),K(this,"serviceMode",void 0),K(this,"reqId",0),K(this,"commandReqId",0),K(this,"handleWebSocketOpen",()=>{this.reconnectMode="retry",this.startPingPong()}),K(this,"handleWebSocketMessage",u=>{if(!u.data)return;const h=JSON.parse(u.data);h.requestId?this.emit("@".concat(h.requestId,"-").concat(h.sid),h):(At.workerEvent(this.spec.sid,{actionType:"status",serverCode:h.code,workerType:this.serviceMode===lp.TRANSCODE?1:2}),this.emit(Km.PUBLISH_STREAM_STATUS,h))}),this.spec=s,this.token=r,this.serviceMode=c,this.websocket=new BT("live-streaming",a),this.websocket.on(Zt.CONNECTED,this.handleWebSocketOpen),this.websocket.on(Zt.ON_MESSAGE,this.handleWebSocketMessage),this.websocket.on(Zt.REQUEST_NEW_URLS,(u,h)=>{ks(this,Km.REQUEST_NEW_ADDRESS).then(u).catch(h)}),this.websocket.on(Zt.RECONNECTING,()=>{this.websocket.reconnectMode=this.reconnectMode})}init(r){return this.websocket.init(r)}async request(r,s,a,c){this.reqId+=1,r==="request"&&(this.commandReqId+=1);const u=this.commandReqId,h=this.reqId;if(!h||!this.websocket)throw new Oe(te.UNEXPECTED_ERROR);const m=gw({command:r,sdkVersion:Al==="4.23.2"?"0.0.1":Al,seq:h,requestId:h,allocate:a,cname:this.spec.cname,appId:this.spec.appId,sid:this.spec.sid,uid:this.spec.uid.toString(),ts:Math.floor(Date.now()/1e3)},s);if(this.websocket.state==="closed")throw new Oe(te.WS_DISCONNECT);const y=()=>new dt((P,D)=>{this.websocket.once(Zt.CLOSED,()=>D(new Oe(te.WS_ABORT))),this.websocket.once(Zt.CONNECTED,P)});this.websocket.state!=="connected"&&await y(),m.clientRequest&&(m.clientRequest.workerToken=this.token);const v=new dt((P,D)=>{const G=()=>{D(new Oe(te.WS_ABORT))};this.websocket.once(Zt.RECONNECTING,G),this.websocket.once(Zt.CLOSED,G),this.once("@".concat(h,"-").concat(this.spec.sid),F=>{P(F)})});c&&At.workerEvent(this.spec.sid,gw(gw({},c),{},{requestId:u,actionType:"request",payload:JSON.stringify(s.clientRequest),serverCode:0,code:0}));const S=Date.now();this.websocket.sendMessage(m);let R=null;try{R=await v}catch(P){if(this.websocket.state==="closed")throw P;return await y(),await this.request(r,s,a)}return c&&At.workerEvent(this.spec.sid,gw(gw({},c),{},{requestId:u,actionType:"response",payload:JSON.stringify(R.serverResponse),serverCode:R.code,success:R.code===200,responseTime:Date.now()-S})),R.code!==200&&this.handleResponseError(R),R}tryNextAddress(){this.reconnectMode="tryNext",this.websocket.reconnect("tryNext")}close(){const r=Al==="4.23.2"?"0.0.1":Al;this.reqId+=1,this.websocket.state==="connected"?(this.websocket.sendMessage({command:"request",appId:this.spec.appId,cname:this.spec.cname,uid:this.spec.uid.toString(),sdkVersion:r,sid:this.spec.sid,seq:this.reqId,ts:Math.floor(Date.now()/1e3),requestId:this.reqId,clientRequest:{command:"DestroyWorker"}}),this.websocket.close(!1,!0)):this.websocket.close(!1),this.pingpongTimer&&(window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0)}handleResponseError(r){switch(r.code){case ji.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM:return void x.warning("live stream response already exists stream");case ji.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR:case ji.LIVE_STREAM_RESPONSE_BAD_STREAM:case ji.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR:return new Oe(te.LIVE_STREAMING_INVALID_ARGUMENT,"",{code:r.code}).throw();case ji.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST:if(r.serverResponse.command==="UnpublishStream")return;throw new Oe(te.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case ji.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED:return new Oe(te.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED,"",{code:r.code}).throw();case ji.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const s=new Oe(te.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE);return this.emit(Km.WARNING,s,r.serverResponse.url)}case ji.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN:{const s=new Oe(te.LIVE_STREAMING_WARN_FREQUENT_REQUEST);return this.emit(Km.WARNING,s,r.serverResponse.url)}case ji.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH:throw new Oe(te.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case ji.LIVE_STREAM_RESPONSE_NOT_SUPPORTED:return new Oe(te.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED,"",{code:r.code}).throw();case ji.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM:{const s=new Oe(te.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT);return this.emit(Km.WARNING,s,r.serverResponse.url)}case ji.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR:return new Oe(te.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:r.code}).throw();case ji.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT:throw new Oe(te.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream resource limit",{retry:!0,changeAddress:!0});case ji.LIVE_STREAM_RESPONSE_WORKER_LOST:case ji.LIVE_STREAM_RESPONSE_WORKER_QUIT:if(r.serverResponse.command==="UnpublishStream")return;throw new Oe(te.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case ji.ERROR_FAIL_SEND_MESSAGE:if(r.serverResponse.command==="UnpublishStream")return;if(r.serverResponse.command==="UpdateTranscoding"||r.serverResponse.command==="ControlStream")return new Oe(te.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{code:r.code}).throw();throw new Oe(te.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case ji.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case ji.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case ji.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case ji.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:return new Oe(te.LIVE_STREAMING_CDN_ERROR,"",{code:r.code}).throw()}}startPingPong(){this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(()=>{this.websocket.state==="connected"&&this.request("ping",{}).catch(ZA)},6e3)}}function K$(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}function Ga(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?K$(Object(s),!0).forEach(function(a){K(t,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):K$(Object(s)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))})}return t}class Aye extends Fr{constructor(r){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:ki,a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:ki;super(),K(this,"onLiveStreamWarning",void 0),K(this,"onLiveStreamError",void 0),K(this,"spec",void 0),K(this,"retryTimeout",1e4),K(this,"connection",void 0),K(this,"httpRetryConfig",void 0),K(this,"wsRetryConfig",void 0),K(this,"streamingTasks",new Map),K(this,"isStartingStreamingTask",!1),K(this,"taskMutex",new Fs("live-streaming")),K(this,"cancelToken",ha.CancelToken.source()),K(this,"transcodingConfig",void 0),K(this,"uapResponse",void 0),K(this,"lastTaskId",1),K(this,"statusError",new Map),this.spec=r,this.httpRetryConfig=a,this.wsRetryConfig=s}async setTranscodingConfig(r){const s=Ga(Ga({},pge),r);s.videoCodecProfile!==66&&s.videoCodecProfile!==77&&s.videoCodecProfile!==100&&(x.debug("[".concat(this.spec.clientId,"] set transcoding config, fix video codec profile: ").concat(s.videoCodecProfile," -> 100")),s.videoCodecProfile=100),s.transcodingUsers||(s.transcodingUsers=s.userConfigs),s.transcodingUsers&&(s.transcodingUsers=s.transcodingUsers.map(h=>Ga(Ga(Ga({},fge),h),{},{zOrder:h.zOrder?h.zOrder+1:1}))),function(h){Gr(h.width)||or(h.width,"config.width",0,1e4),Gr(h.height)||or(h.height,"config.height",0,1e4),Gr(h.videoBitrate)||or(h.videoBitrate,"config.videoBitrate",1,1e6),Gr(h.videoFrameRate)||or(h.videoFrameRate,"config.videoFrameRate"),Gr(h.lowLatency)||sp(h.lowLatency,"config.lowLatency"),Gr(h.audioSampleRate)||Hi(h.audioSampleRate,"config.audioSampleRate",[32e3,44100,48e3]),Gr(h.audioBitrate)||or(h.audioBitrate,"config.audioBitrate",1,128),Gr(h.audioChannels)||Hi(h.audioChannels,"config.audioChannels",[1,2,3,4,5]),Gr(h.videoGop)||or(h.videoGop,"config.videoGop"),Gr(h.videoCodecProfile)||Hi(h.videoCodecProfile,"config.videoCodecProfile",[66,77,100]),Gr(h.userCount)||or(h.userCount,"config.userCount",0,17),Gr(h.backgroundColor)||or(h.backgroundColor,"config.backgroundColor",0,16777215),Gr(h.userConfigExtraInfo)||fs(h.userConfigExtraInfo,"config.userConfigExtraInfo",0,4096,!1),h.transcodingUsers&&!Gr(h.transcodingUsers)&&(op(h.transcodingUsers,"config.transcodingUsers"),h.transcodingUsers.forEach((m,y)=>{TP(m.uid),Gr(m.x)||or(m.x,"transcodingUser[".concat(y,"].x"),0,1e4),Gr(m.y)||or(m.y,"transcodingUser[".concat(y,"].y"),0,1e4),Gr(m.width)||or(m.width,"transcodingUser[".concat(y,"].width"),0,1e4),Gr(m.height)||or(m.height,"transcodingUser[".concat(y,"].height"),0,1e4),Gr(m.zOrder)||or(m.zOrder-1,"transcodingUser[".concat(y,"].zOrder"),0,100),Gr(m.alpha)||or(m.alpha,"transcodingUser[".concat(y,"].alpha"),0,1,!1)})),Gr(h.watermark)||u2(h.watermark,"watermark"),Gr(h.backgroundImage)||u2(h.backgroundImage,"backgroundImage"),h.images&&!Gr(h.images)&&(op(h.images,"config.images"),h.images.forEach((m,y)=>{u2(m,"images[".concat(y,"]"))}))}(s);const a=[];s.images&&a.push(...s.images.map(h=>Ga(Ga(Ga({},l2),h),{},{zOrder:255}))),s.backgroundImage&&(a.push(Ga(Ga(Ga({},l2),s.backgroundImage),{},{zOrder:0})),delete s.backgroundImage),s.watermark&&(a.push(Ga(Ga(Ga({},l2),s.watermark),{},{zOrder:255})),delete s.watermark),s.images=a,s.transcodingUsers&&(s.userConfigs=s.transcodingUsers.map(h=>Ga({},h)),s.userCount=s.transcodingUsers.length,delete s.transcodingUsers);const c=(s.userConfigs||[]).map(h=>typeof h.uid=="number"?dt.resolve(h.uid):m9(h.uid,this.spec,this.cancelToken.token,this.httpRetryConfig));if((await dt.all(c)).forEach((h,m)=>{s.userConfigs&&s.userConfigs[m]&&(s.userConfigs[m].uid=h)}),this.transcodingConfig=s,this.connection)try{var u;const h=await this.connection.request("request",{clientRequest:{command:"UpdateTranscoding",transcodingConfig:this.transcodingConfig}},!1,{command:"UpdateTranscoding",workerType:1,requestByUser:!0,tid:Array.from(Hc(u=this.streamingTasks).call(u)).map(m=>m.taskId).join("#")});x.debug("[".concat(this.spec.clientId,"] update live transcoding config success, code: ").concat(h.code,", config:"),JSON.stringify(this.transcodingConfig))}catch(h){if(!h.data||!h.data.retry)throw h;h.data.changeAddress&&this.connection.tryNextAddress(),this.streamingTasks.forEach(m=>{x.warning("[".concat(this.spec.clientId,"] live streaming receive error"),h.toString(),"try to republish",m.url),this.startLiveStreamingTask(m.url,m.mode,h).then(()=>{x.debug("[".concat(this.spec.clientId,"] live streaming republish ").concat(m.url," success"))}).catch(y=>{x.error("[".concat(this.spec.clientId,"] live streaming republish failed"),m.url,y.toString()),this.onLiveStreamError&&this.onLiveStreamError(m.url,y)})})}}async startLiveStreamingTask(r,s,a){if(!this.transcodingConfig&&s===lp.TRANSCODE)throw new Oe(te.INVALID_OPERATION,"[LiveStreaming] no transcoding config found, can not start transcoding streaming task");const c={command:"PublishStream",ts:Date.now(),url:r,uid:this.spec.uid.toString(),autoDestroyTime:100,acceptImageTimeout:!0};x.debug("[".concat(this.spec.clientId,"] start live streaming ").concat(r,", mode: ").concat(s));const u=await this.taskMutex.lock();if(!this.connection&&a)return void u();if(this.streamingTasks.get(r)&&!a)return u(),new Oe(te.LIVE_STREAMING_TASK_CONFLICT).throw();try{this.connection||(this.connection=await this.connect(s))}catch(m){throw u(),m}switch(s){case lp.TRANSCODE:c.transcodingConfig=Ga({},this.transcodingConfig)}this.uapResponse&&this.uapResponse.vid&&(c.vid=this.uapResponse.vid),this.isStartingStreamingTask=!0;const h=this.lastTaskId++;try{const m=new dt((v,S)=>{ps(this.retryTimeout).then(()=>{if(a)return S(a);const R=this.statusError.get(r);return R?(this.statusError.delete(r),S(R)):void 0})}),y=await dt.race([this.connection.request("request",{clientRequest:c},!0,{url:r,command:"PublishStream",workerType:s===lp.TRANSCODE?1:2,requestByUser:!a,tid:h.toString()}),m]);this.isStartingStreamingTask=!1,x.debug("[".concat(this.spec.clientId,"] live streaming started, code: ").concat(y.code)),this.streamingTasks.set(r,{clientRequest:c,mode:s,url:r,taskId:h}),u()}catch(m){if(u(),this.isStartingStreamingTask=!1,!m.data||!m.data.retry||a)throw m;return m.data.changeAddress?(this.connection.tryNextAddress(),await this.startLiveStreamingTask(r,s,m)):await this.startLiveStreamingTask(r,s,m)}}stopLiveStreamingTask(r){return new dt((s,a)=>{const c=this.streamingTasks.get(r);if(!c||!this.connection)return new Oe(te.UNEXPECTED_ERROR,"can not find streaming task to stop").throw();const u=c.mode;c.abortTask=()=>{x.debug("[".concat(this.spec.clientId,"] stop live streaming success(worker exception)")),this.streamingTasks.delete(r),s()},this.connection.request("request",{clientRequest:{command:"UnpublishStream",url:c.url}},!1,{url:r,command:"UnPublishStream",workerType:u===lp.TRANSCODE?1:2,requestByUser:!0,tid:(this.lastTaskId++).toString()}).then(h=>{x.debug("[".concat(this.spec.clientId,"] stop live streaming success, code: ").concat(h.code)),this.streamingTasks.delete(r),this.streamingTasks.size===0&&(this.connection&&this.connection.close(),this.connection=void 0),s()}).catch(a)})}resetAllTask(){var r;const s=Array.from(Hc(r=this.streamingTasks).call(r));this.terminate();for(const a of s)this.startLiveStreamingTask(a.url,a.mode).catch(c=>{this.onLiveStreamError&&this.onLiveStreamError(a.url,c)})}terminate(){this.cancelToken&&this.cancelToken.cancel(),this.streamingTasks=new Map,this.isStartingStreamingTask=!1,this.statusError=new Map,this.cancelToken=ha.CancelToken.source(),this.uapResponse=void 0,this.connection&&this.connection.close(),this.connection=void 0}async connect(r){if(this.connection)throw new Oe(te.UNEXPECTED_ERROR,"live streaming connection has already connected");const s=await ks(this,d2.REQUEST_WORKER_MANAGER_LIST,r);return this.uapResponse=s,this.connection=new Iye(s.workerToken,this.spec,this.wsRetryConfig,r),this.connection.on(Km.WARNING,(a,c)=>this.onLiveStreamWarning&&this.onLiveStreamWarning(c,a)),this.connection.on(Km.PUBLISH_STREAM_STATUS,a=>this.handlePublishStreamServer(a)),this.connection.on(Km.REQUEST_NEW_ADDRESS,(a,c)=>{if(!this.connection)return c(new Oe(te.UNEXPECTED_ERROR,"can not get new live streaming address list"));ks(this,d2.REQUEST_WORKER_MANAGER_LIST,r).then(u=>{this.uapResponse=u,a(u.addressList)}).catch(c)}),await this.connection.init(s.addressList),this.connection}handlePublishStreamServer(r){const s=r.serverStatus&&r.serverStatus.url||"empty_url",a=this.streamingTasks.get(s),c=r.reason;switch(r.code){case ji.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case ji.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case ji.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case ji.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:{const h=new Oe(te.LIVE_STREAMING_CDN_ERROR,"",{code:r.code});if(a)return x.error(h.toString()),this.onLiveStreamError&&this.onLiveStreamError(s,h);if(!this.isStartingStreamingTask)return;this.statusError.set(s,h)}case ji.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const h=new Oe(te.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE,c);return this.onLiveStreamWarning&&this.onLiveStreamWarning(s,h)}case ji.LIVE_STREAM_RESPONSE_WORKER_LOST:case ji.LIVE_STREAM_RESPONSE_WORKER_QUIT:{var u;if(!this.connection)return;this.connection.tryNextAddress();const h=Array.from(Hc(u=this.streamingTasks).call(u));for(const m of h)m.abortTask?m.abortTask():(x.warning("[".concat(this.spec.clientId,"] publish stream status code"),r.code,"try to republish",m.url),this.startLiveStreamingTask(m.url,m.mode,new Oe(te.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:r.code})).then(()=>{x.debug("[".concat(this.spec.clientId,"] republish live stream success"),m.url)}).catch(y=>{x.error(y.toString()),this.onLiveStreamError&&this.onLiveStreamError(m.url,y)}));return}}}hasUrl(r){return this.streamingTasks.has(r)}}const Pye={name:"LiveStreaming",create:function(t){return new Aye(t.joinInfo,t.websocketRetryConfig||ki,t.httpRetryConfig||ki)}};function Oye(t){let r=X$();return function(s,a){let c=s.appId;c!==void 0&&(Zn(a,10),Mh(a,c));let u=s.cid;u!==void 0&&(Zn(a,16),Zn(a,u));let h=s.cname;h!==void 0&&(Zn(a,26),Mh(a,h));let m=s.deviceId;m!==void 0&&(Zn(a,34),Mh(a,m));let y=s.elapse;y!==void 0&&(Zn(a,40),ag(a,y));let v=s.fileSize;v!==void 0&&(Zn(a,48),ag(a,TS(v)));let S=s.height;S!==void 0&&(Zn(a,56),ag(a,TS(S)));let R=s.jpg;R!==void 0&&(Zn(a,66),Zn(a,R.length),function(ya,je){let st=wS(ya,je.length);ya.bytes.set(je,st)}(a,R));let P=s.networkType;P!==void 0&&(Zn(a,72),ag(a,TS(P)));let D=s.osType;D!==void 0&&(Zn(a,80),ag(a,TS(D)));let G=s.requestId;G!==void 0&&(Zn(a,90),Mh(a,G));let F=s.sdkVersion;F!==void 0&&(Zn(a,98),Mh(a,F));let j=s.sequence;j!==void 0&&(Zn(a,104),ag(a,TS(j)));let Y=s.sid;Y!==void 0&&(Zn(a,114),Mh(a,Y));let ee=s.timestamp;ee!==void 0&&(Zn(a,120),ag(a,ee));let fe=s.uid;fe!==void 0&&(Zn(a,128),Zn(a,fe));let Se=s.vid;Se!==void 0&&(Zn(a,136),Zn(a,Se));let we=s.width;we!==void 0&&(Zn(a,144),ag(a,TS(we)));let ye=s.service;ye!==void 0&&(Zn(a,152),Zn(a,ye));let Ne=s.callbackData;Ne!==void 0&&(Zn(a,162),Mh(a,Ne));let Ye=s.jpgEncryption;Ye!==void 0&&(Zn(a,168),Zn(a,Ye));let ht=s.requestType;ht!==void 0&&(Zn(a,176),Zn(a,ht));let mt=s.scorePorn;mt!==void 0&&(Zn(a,185),fM(a,mt));let In=s.scoreSexy;In!==void 0&&(Zn(a,193),fM(a,In));let An=s.scoreNeutral;An!==void 0&&(Zn(a,201),fM(a,An));let mr=s.scene;mr!==void 0&&(Zn(a,208),Zn(a,mr));let di=s.ossFilePrefix;di!==void 0&&(Zn(a,218),Mh(a,di));let Jr=s.serviceVendor;if(Jr!==void 0)for(let ya of Jr){Zn(a,226);let je=X$();Dye(ya,je),Zn(a,je.limit),Uye(a,je),Mye(je)}}(t,r),function(s){let a=s.bytes,c=s.limit;return a.length===c?a:a.subarray(0,c)}(r)}function kye(t){return function(s){let a={};e:for(;!J$(s);){let c=Uh(s);switch(c>>>3){case 0:break e;case 1:a.code=Uh(s);break;case 2:a.msg=Q$(s,Uh(s));break;case 3:{let u=xye(s);a.data=Nye(s),s.limit=u;break}default:q$(s,7&c)}}return a}({bytes:r=t,offset:0,limit:r.length});var r}function Nye(t){let r={};e:for(;!J$(t);){let s=Uh(t);switch(s>>>3){case 0:break e;case 1:r.requestId=Q$(t,Uh(t));break;case 2:r.requestType=Uh(t)>>>0;break;case 3:r.scorePorn=hM(t);break;case 4:r.scoreSexy=hM(t);break;case 5:r.scoreNeutral=hM(t);break;case 6:r.requestScene=Uh(t)>>>0;break;case 7:r.scene=Uh(t)>>>0;break;default:q$(t,7&s)}}return r}function Dye(t,r){let s=t.service;s!==void 0&&(Zn(r,8),Zn(r,s));let a=t.vendor;a!==void 0&&(Zn(r,16),Zn(r,a));let c=t.token;c!==void 0&&(Zn(r,26),Mh(r,c));let u=t.callbackUrl;u!==void 0&&(Zn(r,34),Mh(r,u))}function xye(t){let r=Uh(t),s=t.limit;return t.limit=t.offset+r,s}function q$(t,r){switch(r){case 0:for(;128&Z$(t););break;case 2:uM(t,Uh(t));break;case 5:uM(t,4);break;case 1:uM(t,8);break;default:throw new Error("Unimplemented type: "+r)}}let Lye=new Float32Array(1);new Uint8Array(Lye.buffer);let lM=new Float64Array(1),Ha=new Uint8Array(lM.buffer);function TS(t){return{low:t|=0,high:t>>31,unsigned:t>=0}}let Y$=[];function X$(){const t=Y$.pop();return t?(t.offset=t.limit=0,t):{bytes:new Uint8Array(64),offset:0,limit:0}}function Mye(t){Y$.push(t)}function uM(t,r){if(t.offset+r>t.limit)throw new Error("Skip past limit");t.offset+=r}function J$(t){return t.offset>=t.limit}function wS(t,r){let s=t.bytes,a=t.offset,c=t.limit,u=a+r;if(u>s.length){let h=new Uint8Array(2*u);h.set(s),t.bytes=h}return t.offset=u,u>c&&(t.limit=u),a}function dM(t,r){let s=t.offset;if(s+r>t.limit)throw new Error("Read past limit");return t.offset+=r,s}function Q$(t,r){let s=dM(t,r),a=String.fromCharCode,c=t.bytes,u="",h="";for(let m=0;m<r;m++){let y,v,S,R,P=c[m+s];(128&P)==0?h+=a(P):(224&P)==192?m+1>=r?h+=u:(y=c[m+s+1],(192&y)!=128?h+=u:(R=(31&P)<<6|63&y,R<128?h+=u:(h+=a(R),m++))):(240&P)==224?m+2>=r?h+=u:(y=c[m+s+1],v=c[m+s+2],(49344&(y|v<<8))!=32896?h+=u:(R=(15&P)<<12|(63&y)<<6|63&v,R<2048||R>=55296&&R<=57343?h+=u:(h+=a(R),m+=2))):(248&P)==240?m+3>=r?h+=u:(y=c[m+s+1],v=c[m+s+2],S=c[m+s+3],(12632256&(y|v<<8|S<<16))!=8421504?h+=u:(R=(7&P)<<18|(63&y)<<12|(63&v)<<6|63&S,R<65536||R>1114111?h+=u:(R-=65536,h+=a(55296+(R>>10),56320+(1023&R)),m+=3))):h+=u}return h}function Mh(t,r){let s=r.length,a=0;for(let h=0;h<s;h++){let m=r.charCodeAt(h);m>=55296&&m<=56319&&h+1<s&&(m=(m<<10)+r.charCodeAt(++h)-56613888),a+=m<128?1:m<2048?2:m<65536?3:4}Zn(t,a);let c=wS(t,a),u=t.bytes;for(let h=0;h<s;h++){let m=r.charCodeAt(h);m>=55296&&m<=56319&&h+1<s&&(m=(m<<10)+r.charCodeAt(++h)-56613888),m<128?u[c++]=m:(m<2048?u[c++]=m>>6&31|192:(m<65536?u[c++]=m>>12&15|224:(u[c++]=m>>18&7|240,u[c++]=m>>12&63|128),u[c++]=m>>6&63|128),u[c++]=63&m|128)}}function Uye(t,r){let s=wS(t,r.limit),a=t.bytes,c=r.bytes;for(let u=0,h=r.limit;u<h;u++)a[u+s]=c[u]}function Z$(t){return t.bytes[dM(t,1)]}function eK(t,r){let s=wS(t,1);t.bytes[s]=r}function hM(t){let r=dM(t,8),s=t.bytes;return Ha[0]=s[r++],Ha[1]=s[r++],Ha[2]=s[r++],Ha[3]=s[r++],Ha[4]=s[r++],Ha[5]=s[r++],Ha[6]=s[r++],Ha[7]=s[r++],lM[0]}function fM(t,r){let s=wS(t,8),a=t.bytes;lM[0]=r,a[s++]=Ha[0],a[s++]=Ha[1],a[s++]=Ha[2],a[s++]=Ha[3],a[s++]=Ha[4],a[s++]=Ha[5],a[s++]=Ha[6],a[s++]=Ha[7]}function Uh(t){let r,s=0,a=0;do r=Z$(t),s<32&&(a|=(127&r)<<s),s+=7;while(128&r);return a}function Zn(t,r){for(r>>>=0;r>=128;)eK(t,127&r|128),r>>>=7;eK(t,r)}function ag(t,r){let s=r.low>>>0,a=(r.low>>>28|r.high<<4)>>>0,c=r.high>>>24,u=c===0?a===0?s<16384?s<128?1:2:s<1<<21?3:4:a<16384?a<128?5:6:a<1<<21?7:8:c<128?9:10,h=wS(t,u),m=t.bytes;switch(u){case 10:m[h+9]=c>>>7&1;case 9:m[h+8]=u!==9?128|c:127&c;case 8:m[h+7]=u!==8?a>>>21|128:a>>>21&127;case 7:m[h+6]=u!==7?a>>>14|128:a>>>14&127;case 6:m[h+5]=u!==6?a>>>7|128:a>>>7&127;case 5:m[h+4]=u!==5?128|a:127&a;case 4:m[h+3]=u!==4?s>>>21|128:s>>>21&127;case 3:m[h+2]=u!==3?s>>>14|128:s>>>14&127;case 2:m[h+1]=u!==2?s>>>7|128:s>>>7&127;case 1:m[h]=u!==1?128|s:127&s}}function tK(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}const Vye=new Map([["moderation",1],["supervise",2]]);class Fye extends Fr{get connectionState(){return this._connectionState}set connectionState(r){if(this._connectionState===r)return;const s=this._connectionState;this._connectionState=r,this.emit(us.CONNECTION_STATE_CHANGE,s,r)}get inspectType(){return this._inspectType}set inspectType(r){var s;this._inspectMode=hc(s=r.map(a=>Vye.get(a)||0)).call(s,(a,c)=>a+c),this._inspectType=r}get quality(){return this._quality}set quality(r){this._quality=r>1?1:r<.1?.1:r,this.qualityTimer&&(window.clearTimeout(this.qualityTimer),this.qualityTimer=null),this._quality>=1||(this.qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this.qualityRatio},6e4))}constructor(r){super(),K(this,"name","AgoraRTCVideoContentInspect"),K(this,"_connectionState",Cu.CONNECTING),K(this,"_innerConnectionState",void 0),K(this,"sequence",0),K(this,"inspectStartTime",void 0),K(this,"workerManagerConnection",void 0),K(this,"workerConnection",void 0),K(this,"workerMessageLengthLimit",void 0),K(this,"inspectIntervalMinimum",void 0),K(this,"qualityRatio",void 0),K(this,"_connectInfo",void 0),K(this,"_cancelTokenSource",ha.CancelToken.source()),K(this,"_retryConfig",void 0),K(this,"wmSequence",0),K(this,"inspectInterval",void 0),K(this,"inspectTimer",null),K(this,"ossFilePrefix",void 0),K(this,"extraInfo",void 0),K(this,"_inspectType",void 0),K(this,"_inspectMode",void 0),K(this,"_quality",1),K(this,"qualityTimer",null),K(this,"_inspectId",void 0),K(this,"_needWorkUrlOnly",!1),K(this,"inspectImage",()=>{if(this.connectionState!==Cu.CONNECTED)throw new Oe(te.OPERATION_ABORTED,"content inspect service connection status is ".concat(this.connectionState));this.inspectTimer&&(window.clearInterval(this.inspectTimer),this.inspectTimer=null),this.inspectTimer=window.setInterval(()=>{this.connectionState===Cu.CONNECTED?this.requestToInspectImage():x.debug("[".concat(this._inspectId,"] Inspect State is not connected , "),this.connectionState)},this.inspectInterval<this.inspectIntervalMinimum?this.inspectIntervalMinimum:this.inspectInterval),this.requestToInspectImage()}),this._inspectId=fr(5,"inspect-"),this.workerMessageLengthLimit=oe("VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT"),this.inspectIntervalMinimum=oe("VIDEO_INSPECT_INTERVAL_MINIMUM"),this.qualityRatio=oe("VIDEO_INSPECT_QUALITY_RATIO"),this.inspectInterval=r.interval,this.ossFilePrefix=r.ossFilePrefix,this.extraInfo=r.extraInfo,this.inspectType=r.inspectType,this.inspectStartTime=Number(Date.now()),this.workerManagerConnection=new BT("worker-manager-"+this._inspectId,ki),this.on(us.STATE_CHANGE,(s,a)=>{this._innerConnectionState=s,x.debug("[".concat(this._inspectId,"] Inspect operation :").concat(Ru[s]," ").concat(a||""))}),this.handleWorkerManagerEvents(),this.workerConnection=new BT("worker-"+this._inspectId,ki),this.handleWorkerEvents()}async init(r,s){this.emit(us.STATE_CHANGE,Ru.CONNECT_AP),this._connectInfo=r;const a=this._cancelTokenSource.token;return this._retryConfig=s,new dt((c,u)=>{this.on(us.CONNECTION_STATE_CHANGE,(h,m)=>{m===Cu.CONNECTED&&c()}),this.requestAP(r,a,s).then(h=>{this.connectWorkerManager(h)}).catch(h=>{u(h)})})}async requestAP(r,s,a){const c=oe("WEBCS_DOMAIN").map(m=>"https://".concat(m,"/api/v1")),u=await function(m,y,v,S){let{appId:R,areaCode:P,cname:D,sid:G,token:F,uid:j}=y;fS++;const Y="image_moderation_api",ee={service_name:Y,json_body:JSON.stringify({appId:R,areaCode:P,cname:D,command:"allocateEdge",requestId:fS,seq:fS,sid:G,token:F,ts:Date.now(),uid:j+""})};let fe,Se,we=m[0];return vd(async()=>{fe=Date.now();const ye=await Cd(we,{data:ee,cancelToken:v,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(Se=Date.now()-fe,ye.code!==0){const mt=new Oe(te.UNEXPECTED_RESPONSE,"image inspect ap error, code"+ye.code,{retry:!0,responseTime:Se});throw x.error(mt.toString()),mt}const Ne=JSON.parse(ye.json_body);if(Ne.code!==200){const mt=new Oe(te.UNEXPECTED_RESPONSE,"image inspect ap error, code: ".concat(Ne.code,", reason: ").concat(Ne.reason),{code:Ne.code,responseTime:Se});throw x.error(mt.toString()),mt}if(!Ne.servers||!Array.isArray(Ne.servers)||Ne.servers.length===0){const mt=new Oe(te.UNEXPECTED_RESPONSE,"image inspect ap empty server",{code:Ne.code,responseTime:Se});throw x.error(mt.toString()),mt}const Ye=oe("VIDEO_INSPECT_WORKER_MANAGER_HOST"),ht=oe("VIDEO_INSPECT_WORKER_MANAGER_PORT");return{addressList:Ne.servers.map(mt=>{let{address:In,wss:An}=mt;if(In&&An)return"wss://".concat(In.replace(/\./g,"-"),".").concat(Ye,":").concat(ht||An)}).filter(mt=>!!mt),workerToken:Ne.workerToken,vid:Ne.vid,responseTime:Se}},(ye,Ne)=>(At.apworkerEvent(G,{success:!0,sc:200,serviceName:Y,responseDetail:JSON.stringify(ye.addressList),firstSuccess:Ne===0,responseTime:Se,serverIp:m[Ne%m.length]}),!1),(ye,Ne)=>(At.apworkerEvent(G,{success:!1,sc:ye.data&&ye.data.code||200,serviceName:Y,responseTime:Se,serverIp:m[Ne%m.length]}),!!(ye.code!==te.OPERATION_ABORTED&&ye.code!==te.UNEXPECTED_RESPONSE||ye.data&&ye.data.retry)&&(we=m[(Ne+1)%m.length],!0)),S)}(c,r,s,a);this.emit(us.STATE_CHANGE,Ru.AP_CONNECTED);const{addressList:h}=u;return this.wmSequence++,h}async connectWorkerManager(r){let s=arguments.length>1&&arguments[1]!==void 0&&arguments[1];this._needWorkUrlOnly=s,this.emit(us.STATE_CHANGE,Ru.CONNECT_WORKER_MANAGER),await this.workerManagerConnection.init(r,1e4)}async connectWorker(r){await this.workerConnection.init([r])}handleWorkerManagerEvents(){this.workerManagerConnection.on(Zt.CONNECTED,async()=>{this.emit(us.STATE_CHANGE,Ru.WORKER_MANAGER_CONNECTED,this.workerManagerConnection.url),this.workerManagerConnection.sendMessage({appId:this._connectInfo.appId,cname:this._connectInfo.cname,uid:this._connectInfo.uid+"",sdkVersion:"4.23.2",sid:this._connectInfo.sid,seq:this.wmSequence,ts:Number(Date.now()),requestId:Math.floor(1e12*Math.random()),allocate:!0,clientRequest:{command:"join"}},!0)}),this.workerManagerConnection.on(Zt.CLOSED,()=>{this._innerConnectionState<Ru.GET_WORKER_MANAGER_RESPONSE&&x.debug("[".concat(this._inspectId,"] Inspect worker manager is closed before connecting worker"))}),this.workerManagerConnection.on(Zt.FAILED,()=>{this._innerConnectionState<Ru.GET_WORKER_MANAGER_RESPONSE&&x.debug("[".concat(this._inspectId,"] Connecting inspect worker manager is failed before connecting worker"))}),this.workerManagerConnection.on(Zt.RECONNECTING,()=>{this._innerConnectionState<Ru.GET_WORKER_MANAGER_RESPONSE&&x.debug("[".concat(this._inspectId,"] Inspect worker manager is reconnecting before connecting worker"))}),this.workerManagerConnection.on(Zt.ON_MESSAGE,async r=>{this.emit(us.STATE_CHANGE,Ru.GET_WORKER_MANAGER_RESPONSE);const s=this.workerManagerConnection.url;this.workerManagerConnection.close();const a=JSON.parse(r.data);if(a.code!==200)throw x.error("[".concat(this._inspectId,"] Unexpected code ").concat(a.code," from worker manager")),new Oe(te.UNEXPECTED_RESPONSE,"response code of worker is unexpected",a);if(!(a.serverResponse&&a.serverResponse.portWss&&s))throw x.error("[".concat(this._inspectId,"] Unexpected content from worker manager : ").concat(JSON.stringify(a))),new Oe(te.UNEXPECTED_RESPONSE,"response content of worker is unexpected",a);{const c=oe("VIDEO_INSPECT_WORKER_PORT")||a.serverResponse.portWss,u=s.replace(/:\d+\/?$/,":".concat(c));this.emit(us.STATE_CHANGE,Ru.CONNECT_WORKER,u),this._needWorkUrlOnly?this.emit(us.REQUEST_NEW_WORKER_URL,u):await this.connectWorker(u)}}),this.workerManagerConnection.on(Zt.WILL_RECONNECT,(r,s,a)=>{a(r)}),this.workerManagerConnection.on(Zt.REQUEST_NEW_URLS,(r,s)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(r).catch(s)})}handleWorkerEvents(){this.workerConnection.on(Zt.CONNECTED,async()=>{this.emit(us.STATE_CHANGE,Ru.WORKER_CONNECTED,this.workerConnection.url),this.connectionState=Cu.CONNECTED}),this.workerConnection.on(Zt.ON_MESSAGE,async r=>{if(r.data instanceof ArrayBuffer){const a=kye(new Uint8Array(r.data));if(oe("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")&&x.debug("[".concat(this._inspectId,"] Response message for worker of inspect content "),JSON.stringify(a)),a.code===200){if(Array.isArray(this.inspectType)&&this.inspectType.length===1&&this.inspectType[0]==="supervise")return void this.emit(us.INSPECT_RESULT,void 0,void 0);if(a.data&&a.data.scorePorn&&a.data.scoreSexy&&a.data.scoreNeutral){var s;const c={porn:a.data.scorePorn,sexy:a.data.scoreSexy,neutral:a.data.scoreNeutral},u=hc(s=Object.keys(c)).call(s,(m,y)=>c[m]>c[y]?m:y,"porn"),h=Object.keys(c).find(m=>m===u);this.emit(us.INSPECT_RESULT,h)}else this.emit(us.INSPECT_RESULT,void 0,new Oe(te.UNEXPECTED_RESPONSE,a.code+"","There is an unexpected data on message"))}else this.emit(us.INSPECT_RESULT,void 0,new Oe(te.UNEXPECTED_RESPONSE,a.code+"",a.msg))}else x.error("[".concat(this._inspectId,"] Unexpected message type from worker")),this.emit(us.INSPECT_RESULT,void 0,new Oe(te.UNEXPECTED_RESPONSE,"invalid worker message type"))}),this.workerConnection.on(Zt.CLOSED,()=>{this.connectionState=Cu.CLOSED}),this.workerConnection.on(Zt.FAILED,()=>{this.connectionState=Cu.CLOSED}),this.workerConnection.on(Zt.RECONNECTING,()=>{this.connectionState=this.connectionState===Cu.CONNECTED?Cu.RECONNECTING:Cu.CONNECTING}),this.workerConnection.on(Zt.WILL_RECONNECT,(r,s,a)=>{r==="recover"&&a(r),a("tryNext")}),this.workerConnection.on(Zt.REQUEST_NEW_URLS,(r,s)=>{this.workerManagerConnection.close(),this.once(us.REQUEST_NEW_WORKER_URL,a=>{r([a])}),this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(a=>{this.connectWorkerManager(a,!0)}).catch(a=>{s(a)})})}async requestToInspectImage(){this.sequence++;const r=Kc(this,us.CLIENT_LOCAL_VIDEO_TRACK),s={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(r){if(!r.isPlaying)return void this.emit(us.INSPECT_RESULT,void 0,new Oe(te.INVALID_OPERATION,"Only the track being played can be inspected"));const a=await this.generateRequestData(r,s);this.workerConnection.sendMessage(a,!0,!0)}else this.emit(us.INSPECT_RESULT,void 0,new Oe(te.INVALID_OPERATION,"Only the track being published can be inspected"))}async generateRequestData(r,s){let{appId:a,cname:c,cid:u,vid:h,sid:m,uid:y}=s;const v=Date.now(),S=await r.getCurrentFrameImage("image/jpeg",this.quality),R=await Mz(S,a,c),P=this.sequence+"-"+u+"-"+y+"-"+v+"-"+fr(12,""),D={appId:a,cid:u,cname:c,deviceId:"",elapse:(G=Number(v-this.inspectStartTime),{low:G|=0,high:G>>31,unsigned:G>=0}),fileSize:R.byteLength,jpgEncryption:2,height:S.height,width:S.width,jpg:R,networkType:6,osType:7,requestId:P,sdkVersion:"4.23.2",sequence:this.sequence,sid:m,timestamp:l7(v),uid:y,vid:h,service:this._inspectMode,callbackData:this.extraInfo,ossFilePrefix:this.ossFilePrefix};var G;this.extraInfo===void 0&&delete D.callbackData,this.ossFilePrefix===void 0&&delete D.ossFilePrefix;const F=Oye(D);if(F.byteLength<this.workerMessageLengthLimit){if(oe("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")){const j=function(Y){for(var ee=1;ee<arguments.length;ee++){var fe=arguments[ee]!=null?arguments[ee]:{};ee%2?tK(Object(fe),!0).forEach(function(Se){K(Y,Se,fe[Se])}):Object.getOwnPropertyDescriptors?Object.defineProperties(Y,Object.getOwnPropertyDescriptors(fe)):tK(Object(fe)).forEach(function(Se){Object.defineProperty(Y,Se,Object.getOwnPropertyDescriptor(fe,Se))})}return Y}({},D);delete j.jpg,x.debug("[".concat(this._inspectId,"] Request message for worker of inspect content "),JSON.stringify(j))}return F}{const j=this.quality*this.qualityRatio;return this.quality=j,await this.generateRequestData(r,{appId:a,cname:c,cid:u,vid:h,sid:m,uid:y})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=ha.CancelToken.source(),this.workerManagerConnection&&this.workerManagerConnection.close(),this.workerConnection&&this.workerConnection.close(),this.inspectTimer&&window.clearInterval(this.inspectTimer),this.inspectTimer=null,this.connectionState=Cu.CLOSED,this.emit(us.STATE_CHANGE,Ru.CLOSED)}}const jye={name:"ContentInspect",create:function(t){let{config:r}=t;return function(s){if(!s)throw new Oe(te.INVALID_PARAMS,"inspectConfig is necessary.");if(!s.inspectType||!Array.isArray(s.inspectType))throw new Oe(te.INVALID_PARAMS,"inspectConfig.inspectType is necessary and is an instance of Array.");{const a=[...new Set(s.inspectType)];a.forEach(c=>{var u;if(!ot(u=["supervise","moderation"]).call(u,c))throw new Oe(te.INVALID_PARAMS,"".concat(c," is not a valid inspect type."))}),s.inspectType=a}if(s&&s.extraInfo&&s.extraInfo.length>1024)throw new Oe(te.INVALID_PARAMS,"inspectConfig.extraInfo length cannot exceed 1024 bytes")}(r),new Fye(r)}};var nK=l(gt.Object.getOwnPropertySymbols),Bye=zn,Wye=oa.indexOf,zye=Nf,pM=re([].indexOf),rK=!!pM&&1/pM([1],1,-0)<0;Bye({target:"Array",proto:!0,forced:rK||!zye("indexOf")},{indexOf:function(t){var r=arguments.length>1?arguments[1]:void 0;return rK?pM(this,t,r)||0:Wye(this,t,r)}});var Gye=dc("Array").indexOf,Hye=O,$ye=Gye,mM=Array.prototype,Kye=function(t){var r=t.indexOf;return t===mM||Hye(mM,t)&&r===mM.indexOf?$ye:r},iK=l(Kye);function qye(t,r){if(t==null)return{};var s,a,c=function(h,m){if(h==null)return{};var y,v,S={},R=wH(h);for(v=0;v<R.length;v++)y=R[v],iK(m).call(m,y)>=0||(S[y]=h[y]);return S}(t,r);if(nK){var u=nK(t);for(a=0;a<u.length;a++)s=u[a],iK(r).call(r,s)>=0||Object.prototype.propertyIsEnumerable.call(t,s)&&(c[s]=t[s])}return c}let sK=class{get localCapabilities(){return $r(this._localCapabilities)}get rtpCapabilities(){return $r(this._rtpCapabilities)}get candidates(){return $r(this._candidates)}get iceParameters(){return $r(this._iceParameters)}get dtlsParameters(){return $r(this._dtlsParameters)}constructor(t){K(this,"sessionDesc",void 0),K(this,"_localCapabilities",void 0),K(this,"_rtpCapabilities",void 0),K(this,"_candidates",void 0),K(this,"_iceParameters",void 0),K(this,"_dtlsParameters",void 0),K(this,"setup",void 0),K(this,"currentMidIndex",void 0),K(this,"cname","o/i14u9pJrxRKAsu"),K(this,"firefoxSsrcMidMap",new Map),t=$r(t);const{remoteIceParameters:r,remoteDtlsParameters:s,candidates:a,remoteRTPCapabilities:c,localCapabilities:u,direction:h,setup:m,videoCodec:y,audioCodec:v}=t;let S;this.setup=m,S=h===Bo.RECEIVE_ONLY?Wa(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`):Wa(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`),this._rtpCapabilities=c,this._candidates=a,this._iceParameters=r,this._dtlsParameters=s,this._localCapabilities=u;const R=h===Bo.RECEIVE_ONLY?this.rtpCapabilities.send:this.rtpCapabilities.recv,P=h===Bo.RECEIVE_ONLY?this._localCapabilities.recv:this._localCapabilities.send,D=h===Bo.RECEIVE_ONLY?c.send.videoCodecs:GT(Et.VIDEO,R,P,y),G=h===Bo.RECEIVE_ONLY?c.send.audioCodecs:GT(Et.AUDIO,R,P,v);for(const F of S.mediaDescriptions)F.attributes.iceUfrag=r.iceUfrag,F.attributes.icePwd=r.icePwd,F.attributes.fingerprints=s.fingerprints,F.attributes.candidates=a,F.attributes.setup=this.setup,F.media.mediaType==="application"&&(F.attributes.sctpPort="5000"),F.media.mediaType==="video"&&(F.media.fmts=D.map(j=>j.payloadType.toString(10)),F.attributes.payloads=D,F.attributes.extmaps=R.videoExtensions),F.media.mediaType==="audio"&&(F.media.fmts=G.map(j=>j.payloadType.toString(10)),F.attributes.payloads=G,F.attributes.extmaps=R.audioExtensions,hS(F));this.sessionDesc=S,this.currentMidIndex=S.mediaDescriptions.length-1}toString(){return $m(this.sessionDesc)}hasMid(t){return Array.isArray(t)?t.every(r=>this.hasMid(r)):this.sessionDesc.mediaDescriptions.some(r=>r.attributes.mid===t)}send(t,r,s,a,c){s=s.replace(/ /g,"-");const{ssrcs:u,ssrcGroups:h}=Q_(r,this.cname,oe("SYNC_GROUP")?s:void 0),m=this.findPreloadMediaDesc(u);if(m){if(zr()&&this.firefoxSsrcMidMap.set(u[0].ssrcId,m.attributes.mid),c&&(c.twcc||c.remb)){const y=this.sessionDesc.mediaDescriptions.indexOf(m);return this.sessionDesc.mediaDescriptions[y]=this.mungSendMediaDesc(m,c),{mid:m.attributes.mid,needExchangeSDP:!0}}return{mid:m.attributes.mid,needExchangeSDP:!1}}{const y=this.findAvailableMediaIndex(t,u,a);let v;return y===-1?(v=this.createOrRecycleSendMedia(t,u,h,"sendonly",a,c),this.updateBundleMids()):(v=$r(this.sessionDesc.mediaDescriptions[y]),v.attributes.direction="sendonly",v.attributes.ssrcs=u,v.attributes.ssrcGroups=h,this.sessionDesc.mediaDescriptions[y]=this.mungSendMediaDesc(v,c)),zr()&&this.firefoxSsrcMidMap.set(u[0].ssrcId,v.attributes.mid),{needExchangeSDP:!0,mid:v.attributes.mid}}}stopSending(t){const r=this.sessionDesc.mediaDescriptions.filter(s=>s.attributes.mid&&t.indexOf(s.attributes.mid)!==-1);if(r.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");r.forEach(s=>{s.attributes.ssrcs=[]}),this.updateBundleMids()}receive(t,r,s){const a=[];return t.forEach(c=>{const u=c._mediaStreamTrack.kind,h=this.findAvailableRecvMediaIndex(u);let m,y=!1;h===-1?(y=!0,m=this.createOrRecycleRecvMedia(c,[],"recvonly",r,s),this.updateBundleMids()):(m=$r(this.sessionDesc.mediaDescriptions[h]),m.attributes.direction="recvonly"),a.push({mid:m.attributes.mid,needCreateTransceiver:y})}),a}stopReceiving(t){const r=this.sessionDesc.mediaDescriptions.filter(s=>t.indexOf(s.attributes.mid)!==-1);if(r.length!==t.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");r.forEach(s=>{s.media.port="0",s.attributes.direction="inactive"}),this.updateBundleMids()}addRemoteCandidate(t){const{foundation:r,protocol:s,address:a,port:c,type:u,relatedAddress:h,relatedPort:m,priority:y}=new RTCIceCandidate(t),v={foundation:r??"",componentId:"1",transport:s??"",priority:y?y+"":"",connectionAddress:a??"",port:c?c+"":"",type:u?u+"":"",relAddr:h??"",relPort:m?m+"":"",extension:{}};this.candidates.some(S=>S.priority===v.priority&&S.connectionAddress===v.connectionAddress&&S.port===v.port)||(this._candidates.push(v),this.sessionDesc.mediaDescriptions.forEach(S=>{S.attributes.candidates=this.candidates}))}clearRemoteCandidate(){this._candidates=[],this.sessionDesc.mediaDescriptions[0].attributes.candidates=this._candidates}createOrRecycleRecvMedia(t,r,s,a,c){const u=t._mediaStreamTrack.kind,h=this.rtpCapabilities.recv,m=GT(u,h,this.localCapabilities.send,u===Et.AUDIO?c:a),y=u===Et.VIDEO?h.videoExtensions:h.audioExtensions,v="".concat(++this.currentMidIndex);let S={media:{mediaType:u,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:m.map(P=>P.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:y,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:r,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:m,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:s,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(v)}};S=this.mungRecvMediaDsec(S,t);const R=this.findFirstClosedMedia(u);if(R){const P=this.sessionDesc.mediaDescriptions.indexOf(R);this.sessionDesc.mediaDescriptions[P]=S}else this.sessionDesc.mediaDescriptions.push(S);return S}muteRemote(t){const r=this.sessionDesc.mediaDescriptions.filter(s=>ot(t).call(t,s.attributes.mid||""));if(r.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");r.forEach(s=>{s.attributes.direction="inactive"})}unmuteRemote(t){const r=this.sessionDesc.mediaDescriptions.filter(s=>ot(t).call(t,s.attributes.mid||""));if(r.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");r.forEach(s=>{s.attributes.direction="recvonly"})}findAvailableMediaIndex(t,r,s){return this.sessionDesc.mediaDescriptions.findIndex(a=>{const c=a.media.mediaType===t&&a.media.port!=="0"&&(a.attributes.direction==="sendonly"||a.attributes.direction==="sendrecv")&&a.attributes.ssrcs.length===0;if(zr()){if(c){const u=this.firefoxSsrcMidMap.get(r[0].ssrcId);return!(u||a.attributes.mid!=="0"&&a.attributes.mid!=="1")||!(!u||u!==a.attributes.mid)}return!1}return c&&a.attributes.mid===s})}findAvailableRecvMediaIndex(t){return this.sessionDesc.mediaDescriptions.findIndex(r=>{const s=r.media.mediaType===t&&r.media.port!=="0"&&(r.attributes.direction==="recvonly"||r.attributes.direction==="sendrecv");return r.attributes.mid!=="0"&&r.attributes.mid!=="1"&&s})}predictReceivingMids(t){const r=[];for(let s=0;s<t;s++)r.push((this.currentMidIndex+s+1).toString(10));return r}restartICE(t){t=$r(t),this._iceParameters=t,this.sessionDesc.mediaDescriptions.forEach(r=>{r.attributes.iceUfrag=t.iceUfrag,r.attributes.icePwd=t.icePwd})}createOrRecycleSendMedia(t,r,s,a,c,u){const h=this.rtpCapabilities.send,m=t===Et.VIDEO?h.videoCodecs:h.audioCodecs,y=t===Et.VIDEO?h.videoExtensions:h.audioExtensions;zr()&&(c="".concat(++this.currentMidIndex));let v={media:{mediaType:t,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:m.map(R=>R.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:y,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:r,ssrcGroups:s,rtcpFeedbackWildcards:[],payloads:m,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:a,rtcpMux:!0,rtcpRsize:!0,mid:c}};v=this.mungSendMediaDesc(v,u);const S=this.findFirstClosedMedia(t);if(S){const R=this.sessionDesc.mediaDescriptions.indexOf(S);this.sessionDesc.mediaDescriptions[R]=v}else this.sessionDesc.mediaDescriptions.push(v);return v}mungRecvMediaDsec(t,r,s){const a=$r(t);return g2(a),dS(a,r),_2(a,r),YH(a),OP(a,s,this.localCapabilities.send),a}mungSendMediaDesc(t,r){const s=$r(t);return OP(s,r,this.localCapabilities.recv),hS(s),s}updateRecvMedia(t,r){const s=this.sessionDesc.mediaDescriptions.findIndex(a=>a.attributes.mid===t);if(s!==-1){const a=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[s],r);this.sessionDesc.mediaDescriptions[s]=a}}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(t=>t.media.port!=="0").map(t=>t.attributes.mid)}findPreloadMediaDesc(t){return this.sessionDesc.mediaDescriptions.find(r=>{var s;return((s=r.attributes)===null||s===void 0||(s=s.ssrcs[0])===null||s===void 0?void 0:s.ssrcId)===t[0].ssrcId})}findFirstClosedMedia(t){return this.sessionDesc.mediaDescriptions.find(r=>zr()?r.media.port==="0"&&r.media.mediaType===t:r.media.port==="0")}};const Yye=["sdp"];var vr;function oK(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}function cg(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?oK(Object(s),!0).forEach(function(a){K(t,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):oK(Object(s)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))})}return t}let aK=(vr=class VS extends OH{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var r,s;return(r=(s=this.peerConnection.getReceivers()[0])===null||s===void 0||(s=s.transport)===null||s===void 0?void 0:s.state)!==null&&r!==void 0?r:null}get localCodecs(){return[]}set isInRestartIce(r){this._isInRestartIce=r}get isInRestartIce(){return this._isInRestartIce}constructor(r,s,a){super(r,s),K(this,"direction",void 0),K(this,"name",void 0),K(this,"store",void 0),K(this,"spec",void 0),K(this,"peerConnection",void 0),K(this,"initialOffer",void 0),K(this,"transport",void 0),K(this,"statsFilter",void 0),K(this,"localCandidateCount",0),K(this,"_isInRestartIce",!1),K(this,"mutex",void 0),K(this,"onLocalCandidate",void 0),K(this,"remoteSDP",void 0),K(this,"pendingCandidates",[]),K(this,"localCapabilities",void 0),K(this,"isReady",!1),K(this,"restartCnt",0),K(this,"curTurnServerIndex",0),this.store=s,this.spec=r,this.mutex=new Fs("P2PConnection-mutex",s.clientId),this.peerConnection=new RTCPeerConnection(VS.resolvePCConfiguration(r,s.p2pTransport),{optional:[{googDscp:!0}]}),this.direction=a??Bo.SEND_ONLY,this.name=this.direction===Bo.SEND_ONLY?"sendP2PConnection":"recvP2PConnection",this.statsFilter=OL(this.peerConnection,oe("STATS_UPDATE_INTERVAL"),void 0,zr()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1}async establish(r){try{const s=await JH();if(this.localCapabilities=kP(s),r){const{sdp:a}=r,c=qye(r,Yye),u=function(){const S={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},R=zT(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"sendonly"),P={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},D={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},G={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(Iu(R,S,"videoExtensions",P,D,G),Iu(R,S,"videoCodecs",P,D,G),Iu(R,S,"audioExtensions",P,D,G),Iu(R,S,"audioCodecs",P,D,G),oe("RAISE_H264_BASELINE_PRIORITY")){const F=G.videoCodecs.findIndex(j=>j.rtpMap&&j.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&j.fmtp&&j.fmtp.parameters["profile-level-id"]==="42001f");if(F!==-1){const j=G.videoCodecs.findIndex(Y=>Y.rtpMap&&Y.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(j<F){x.debug("raising H264 baseline profile priority");const Y=G.videoCodecs[F];G.videoCodecs.splice(F,1),G.videoCodecs.splice(j,0,Y)}j!==-1&&oe("FILTER_SEND_H264_BASELINE")&&(P.videoCodecs=P.videoCodecs.filter(Y=>!(Y.rtpMap&&Y.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&Y.fmtp&&Y.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:P,recv:D,sendrecv:G}}({},{},a);this.remoteSDP=new sK({remoteIceParameters:c.iceParameters,remoteDtlsParameters:c.dtlsParameters,candidates:[],remoteRTPCapabilities:u,localCapabilities:this.localCapabilities,direction:this.direction,setup:"actpass",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()}),this.isReady=!0;const h=await this.peerConnection.createAnswer();if(!h.sdp)throw new Error("Cannot get answer sdp when trying to establish PeerConnection.");const m=Jm(h.sdp);await this.peerConnection.setLocalDescription(h);const y=await QH({},{},h.sdp);this.localCapabilities=kP(y);const v=this.peerConnection.getTransceivers()[0];return v!=null&&v.receiver&&v.receiver.transport&&this.tryBindTransportEvents(v.receiver.transport),cg(cg({},m),{},{sdp:h.sdp})}{this.peerConnection.addTransceiver("video",{direction:"sendonly"}),this.peerConnection.addTransceiver("audio",{direction:"sendonly"});const a=await this.peerConnection.createOffer();if(!a.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const c=Jm(a.sdp);return this.initialOffer=a,cg(cg({},c),{},{sdp:a.sdp})}}catch(s){throw new Me(te.GET_LOCAL_CONNECTION_PARAMS_FAILED,s.toString())}}async connect(r){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");await this.peerConnection.setLocalDescription(this.initialOffer);const{sdp:s,iceParameters:a,dtlsParameters:c}=r,u=await QH({},{},s);this.remoteSDP=new sK({remoteIceParameters:a,remoteDtlsParameters:c,candidates:[],remoteRTPCapabilities:u,localCapabilities:this.localCapabilities,direction:this.direction,setup:"active",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()});const h=this.peerConnection.getTransceivers()[0];h!=null&&h.sender&&h.sender.transport&&this.tryBindTransportEvents(h.sender.transport)}catch(s){throw new Me(te.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(s.toString()))}}async addRemoteCandidate(r){try{r&&this.pendingCandidates.push(r),this.peerConnection.remoteDescription&&this.isReady&&(this.pendingCandidates.forEach(s=>{this.peerConnection.addIceCandidate(s)}),this.pendingCandidates=[])}catch(s){throw new Me(te.ADD_CANDIDATE_FAILED,"P2PConnection.addRemoteCandidate failed; ".concat(s.toString()))}}send(r,s,a){var c=this;return Il(function*(){const u=yield Nn(c.mutex.lock("From P2PConnection.send"));try{if(!c.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const h=[],m=c.remoteSDP.receive(r,s,a);r.forEach((j,Y)=>{if(m[Y].needCreateTransceiver){const ee=c.peerConnection.addTransceiver(j._mediaStreamTrack,{direction:"sendonly"});h.push(ee),j._updateRtpTransceiver(ee)}else{const ee=c.peerConnection.getTransceivers().find(fe=>fe.mid===m[Y].mid);if(!ee)throw new Error("cannot find transceiver when sendPeerconnection send, mid is ".concat(m[Y].mid));h.push(ee),j._updateRtpTransceiver(ee)}}),zr()&&oe("SIMULCAST")===!0&&(yield Nn(c.applySimulcastForFirefox(h,r)));const y=m.map(j=>j.mid),v=yield Nn(c.peerConnection.createOffer()),S=c.mungSendOfferSDP(v.sdp,r,y),R=Wa(S),P=y.map(j=>{const Y=R.mediaDescriptions.find(ee=>ee.attributes.mid===j);if(!Y)throw new Error("Cannot extract ssrc from mediaDescription.");return $H(Y,oe("USE_PUB_RTX"))}),D=h.map((j,Y)=>{const ee=y[Y];return{localSSRC:P[Y],id:ee}});yield Nn(c.peerConnection.setLocalDescription({type:"offer",sdp:S}));try{yield D}catch(j){const Y=c.remoteSDP.toString();throw yield Nn(c.peerConnection.setLocalDescription({type:"offer",sdp:S})),yield Nn(c.peerConnection.setRemoteDescription({type:"answer",sdp:Y})),yield Nn(c.stopSending(y,!0)),j}yield Nn(c.applySimulcastEncodings(h,r)),yield Nn(c.applySendEncodings(h,r));const G=c.remoteSDP.toString(),F=c.logSDPExchange(S,"offer","local","send");return F==null||F(G),yield Nn(c.setRemoteDescription({type:"answer",sdp:G})),h.map((j,Y)=>{const ee=y[Y];return{localSSRC:P[Y],id:ee}})}catch(h){throw h instanceof Me?h:new Me(te.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(h.toString()))}finally{u()}})()}async stopSending(r,s){const a=s?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const c=this.peerConnection.getTransceivers().filter(y=>r.indexOf(y.mid)!==-1);if(c.length!==r.length)throw new Error("Transceivers' length (".concat(c.length,") doesn't match mids' length (").concat(r.length,") when trying to call P2PConnection.stopSending."));c.map(y=>{var v;y.direction="inactive",(v=y.stop)===null||v===void 0||v.call(y)});const u=await this.peerConnection.createOffer(),h=this.logSDPExchange(u.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(u),this.remoteSDP.stopReceiving(r);const m=this.remoteSDP.toString();h==null||h(m),await this.setRemoteDescription({type:"answer",sdp:m})}catch(c){throw new Me(te.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(c.toString()))}finally{a&&a()}}async receive(r,s,a,c){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(r," before remoteSDP created."));const{mid:u,needExchangeSDP:h}=this.remoteSDP.send(r,s,a,c);if(h){const y=this.remoteSDP.toString(),v=this.logSDPExchange(y,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:y});const S=await this.peerConnection.createAnswer(),R=this.mungReceiveAnswerSDP(S.sdp,u,r);v==null||v(R||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:R}),x.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(r," by exchanging SDP."))}else x.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(r," no need to exchange SDP."));const m=this.peerConnection.getTransceivers().find(y=>y.mid===u);if(!m||m.mid===null)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:m.receiver.track,mid:m.mid,transceiver:m}}catch(u){throw new Me(te.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(u.toString()))}}async mockReceive(r,s,a,c){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(r," before remoteSDP created."));const{mid:u,needExchangeSDP:h}=this.remoteSDP.send(r,s,a,c);if(h){const m=this.remoteSDP.toString(),y=this.logSDPExchange(m,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:m});const v=await this.peerConnection.createAnswer(),S=this.mungReceiveAnswerSDP(v.sdp,u,r);y==null||y(S||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:S}),x.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(r," by exchanging SDP."))}else x.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(r," no need to exchange SDP."))}catch(u){throw new Me(te.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(u.toString()))}}async stopReceiving(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(r);const s=this.remoteSDP.toString(),a=this.logSDPExchange(s,"offer","remote","stopReceiving");await this.setRemoteDescription({type:"offer",sdp:s});const c=await this.peerConnection.createAnswer();a==null||a(c.sdp||""),await this.peerConnection.setLocalDescription(c)}catch(s){throw new Me(te.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(s.toString()))}}async restartICE(r){try{if(this.store.p2pTransport===G_.Auto&&(this.store.p2pTransport=G_.SdRtn,jn().supportPCSetConfiguration&&this.peerConnection.setConfiguration(VS.resolvePCConfiguration(this.spec,this.store.p2pTransport))),this.restartCnt>3&&(this.restartCnt=0,jn().supportPCSetConfiguration&&this.peerConnection.setConfiguration(VS.resolvePCConfiguration(this.spec,this.store.p2pTransport,++this.curTurnServerIndex))),!r){this.restartCnt++,this.isReady=!1;const s=await this.peerConnection.createOffer({iceRestart:!0});if(!s.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const{iceParameters:a}=Jm(s.sdp);return this.store.descriptionStart(),this.direction===Bo.SEND_ONLY&&await this.peerConnection.setLocalDescription(s),a}if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");if(this.remoteSDP.restartICE(r),this.store.descriptionStart(),this.direction===Bo.RECEIVE_ONLY){this.restartCnt++,await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()});const s=await this.peerConnection.createAnswer();if(!s.sdp)throw new Error("Cannot get answer sdp when trying to iceRestart.");const{iceParameters:a}=Jm(s.sdp);return await this.peerConnection.setLocalDescription(s),a}await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()}),this.isReady=!0}catch(s){throw new Me(te.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(s.toString()))}}close(){var r;this.peerConnection.close(),this.peerConnection.onicecandidate=null,(r=this.onConnectionStateChange)===null||r===void 0||r.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.transport=void 0,this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(r){return this.statsFilter.getVideoIsReady(r)}async updateEncoderConfig(r,s){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const a=await this.peerConnection.createOffer(),c=this.mungSendOfferSDP(a.sdp,[s],[r]);this.remoteSDP.updateRecvMedia(r,s);const u=this.remoteSDP.toString(),h=this.logSDPExchange(c,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:c}),h==null||h(u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(a){throw new Me(te.EXCHANGE_SDP_FAILED,a.toString())}}async updateSendParameters(r,s){const a=this.peerConnection.getTransceivers().filter(c=>c.mid===r);a.length===1&&(this.isVP8Simulcast(s)?zr()||await this.applySimulcastEncodings(a,[s]):await this.applySendEncodings(a,[s]))}setStatsRemoteVideoIsReady(r,s){this.statsFilter.setVideoIsReady2(r,s)}async replaceTrack(r,s){const a=this.peerConnection.getTransceivers().find(c=>c.mid===s);a&&await a.sender.replaceTrack(r._mediaStreamTrack)}async getSelectedCandidatePair(){const r=this.peerConnection.getReceivers();if(r.length>0&&r[0].transport&&r[0].transport.iceTransport&&r[0].transport.iceTransport.getSelectedCandidatePair&&r[0].transport.iceTransport.getSelectedCandidatePair()){const s=r[0].transport.iceTransport,{local:a,remote:c}=s.getSelectedCandidatePair();return{local:cg(cg({},Th),{},{candidateType:a.type,protocol:a.protocol,address:a.address,port:a.port}),remote:cg(cg({},Th),{},{candidateType:c.type,protocol:c.protocol,address:c.address,port:c.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var r,s;ot(r=["connected","completed"]).call(r,this.peerConnection.iceConnectionState)&&(this.isReady=!1),(s=this.onICEConnectionStateChange)===null||s===void 0||s.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var r;this.peerConnection.connectionState==="connected"&&(this.restartCnt=0),(r=this.onConnectionStateChange)===null||r===void 0||r.call(this,this.peerConnection.connectionState)},this.startICECandidate()}startICECandidate(){this.peerConnection.onicecandidate||(this.localCandidateCount=0,this.peerConnection.onicecandidate=r=>{if(r.candidate){var s;r.candidate.candidate&&((s=this.onLocalCandidate)===null||s===void 0||s.call(this,r.candidate.toJSON())),this.localCandidateCount+=1}else x.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount)})}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(r,s){let a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const c={iceServers:[]};var u;return r.iceServers?c.iceServers=r.iceServers:r.turnServer&&r.turnServer.mode!=="off"&&(OT(r.turnServer.servers)?c.iceServers=r.turnServer.servers:(c.iceServers&&c.iceServers.push(...VS.turnServerConfigToIceServers(r.turnServer.servers,s,a)),oe("USE_TURN_SERVER_OF_GATEWAY")&&c.iceServers&&r.turnServer.serversFromGateway&&c.iceServers.push(...VS.turnServerConfigToIceServers(r.turnServer.serversFromGateway,s,a)),ot(u=[G_.Relay,G_.SdRtn]).call(u,s)&&(c.iceTransportPolicy="relay"),oe("FORCE_TURN_TCP")?c.iceTransportPolicy="relay":r.turnServer.servers.concat(r.turnServer.serversFromGateway||[]).forEach(h=>{h.forceturn&&(c.iceTransportPolicy="relay")}))),oe("ENABLE_ENCODED_TRANSFORM")&&jn().supportWebRTCEncodedTransform&&(c.encodedInsertableStreams=!0),x.debug("P2PConnection p2pTransport is ".concat(s)),c}static turnServerConfigToIceServers(r,s){let a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const c=[],u=r.filter(m=>m.tcpport);x.debug("P2PConnection turnServers is ".concat(u,", current index is ").concat(a));const h=u.length>a?u[a]:u[0];switch(s){case G_.SdRtn:const m=r.filter(v=>{var S;return ot(S=v.username).call(S,"glb:")&&v.turnServerURL==v.turnServerURL}),y=m.length>a?m[a]:m[0];y&&(c.push({username:y.username,credential:y.password,credentialType:"password",urls:"turn:".concat(Ym(y.turnServerURL),":").concat(y.tcpport,"?transport=udp")}),c.push({username:y.username,credential:y.password,credentialType:"password",urls:"turns:".concat(Ym(y.turnServerURL),":").concat(y.tcpport,"?transport=tcp")}));break;case G_.Relay:h&&(c.push({username:h.username,credential:h.password,credentialType:"password",urls:"turn:".concat(h.turnServerURL,":").concat(h.tcpport,"?transport=udp")}),c.push({username:h.username,credential:h.password,credentialType:"password",urls:"turns:".concat(Ym(h.turnServerURL),":").concat(h.tcpport,"?transport=tcp")}));break;default:h&&(c.push({username:h.username,credential:h.password,credentialType:"password",urls:"turn:".concat(h.turnServerURL,":").concat(h.tcpport,"?transport=udp")}),c.push({username:h.username,credential:h.password,credentialType:"password",urls:"turns:".concat(Ym(h.turnServerURL),":").concat(h.tcpport,"?transport=tcp")}),c.push({username:h.username,credential:h.password,credentialType:"password",urls:"stun:".concat(h.turnServerURL,":").concat(h.tcpport)}))}return c}tryBindTransportEvents(r){if(r){this.transport=r,r.onstatechange=()=>{var a;r!=null&&r.state&&((a=this.onDTLSTransportStateChange)===null||a===void 0||a.call(this,r.state))},r.onerror=a=>{var c;(c=this.onDTLSTransportError)===null||c===void 0||c.call(this,"error"in a?a.error:a)};const s=r.iceTransport;s&&(s.onstatechange=()=>{const a=r==null?void 0:r.iceTransport.state;var c;a&&((c=this.onICETransportStateChange)===null||c===void 0||c.call(this,a))},s.getSelectedCandidatePair&&(s.onselectedcandidatepairchange=()=>{if(s.getSelectedCandidatePair()){const{local:a,remote:c}=s.getSelectedCandidatePair();x.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:a.type,protocol:a.protocol}),", remote ").concat(JSON.stringify({candidateType:c.type,protocol:c.protocol,address:c.address,port:c.port})," )"))}}))}}tryUnbindTransportEvents(){this.transport&&(this.transport.onstatechange=null,this.transport.onerror=null,this.transport.iceTransport&&(this.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(r,s){var a;if(s||(s=this.peerConnection.getSenders().find(S=>S.track===r._mediaStreamTrack)),!s)return x.warn("[".concat(r.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(r))return x.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!jn().supportSetRtpSenderParameters)return x.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const c={},u={};switch(r._optimizationMode){case"motion":c.degradationPreference="maintain-framerate";break;case"detail":c.degradationPreference="maintain-resolution";break;default:c.degradationPreference="balanced"}if(r._encoderConfig){var h;const{bitrateMax:S,frameRate:R,scaleResolutionDownBy:P}=r._encoderConfig;S&&(u.maxBitrate=1e3*S),ot(h=r._hints).call(h,pr.LOW_STREAM)&&(R&&(u.maxFramerate=vc(R)),P&&P>=1&&(u.scaleResolutionDownBy=P))}if(oe("DSCP_TYPE")&&ip()){var m;const S=oe("DSCP_TYPE");ot(m=["very-low","low","medium","high"]).call(m,S)&&(u.networkPriority=S)}const y=s.getParameters(),v=(a=y.encodings)===null||a===void 0?void 0:a[0];zr()&&!v&&(c.encodings=[u]),v&&Object.assign(v,u),Object.assign(y,c),x.debug("[".concat(r.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(y.encodings))),await s.setParameters(y)}async applySendEncodings(r,s){try{if(!jn().supportSetRtpSenderParameters||r.length!==s.length)return;for(let a=0;a<r.length;a++){const c=r[a],u=s[a];u instanceof Tr&&!this.isVP8Simulcast(u)&&await this.updateRtpSenderEncodings(u,c.sender)}}catch{x.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(r,s,a){const c=Wa(r);return s.forEach((u,h)=>{const m=a[h],y=c.mediaDescriptions.find(v=>v.attributes.mid===m);y&&(dS(y,u),XH(y,u,this.store.codec))}),$m(c)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=r=>{var s;(s=this.onFirstAudioReceived)===null||s===void 0||s.call(this,r)},this.statsFilter.onFirstVideoReceived=r=>{var s;(s=this.onFirstVideoReceived)===null||s===void 0||s.call(this,r)},this.statsFilter.onFirstAudioDecoded=r=>{var s;(s=this.onFirstAudioDecoded)===null||s===void 0||s.call(this,r)},this.statsFilter.onFirstVideoDecoded=(r,s,a)=>{var c;(c=this.onFirstVideoDecoded)===null||c===void 0||c.call(this,r,s,a)},this.statsFilter.onSelectedLocalCandidateChanged=(r,s)=>{var a;(a=this.onSelectedLocalCandidateChanged)===null||a===void 0||a.call(this,r,s)},this.statsFilter.onSelectedRemoteCandidateChanged=(r,s)=>{var a;(a=this.onSelectedRemoteCandidateChanged)===null||a===void 0||a.call(this,r,s)},this.statsFilter.onFirstVideoDecodedTimeout=r=>{var s;(s=this.onFirstVideoDecodedTimeout)===null||s===void 0||s.call(this,r)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(r,s){if(r.length===s.length)for(let y=0;y<r.length;y++){var a,c,u,h,m;const v=r[y],S=s[y];if(S instanceof Tr&&!ot(a=S._hints).call(a,pr.LOW_STREAM)&&(c=S._encoderConfig)!==null&&c!==void 0&&c.bitrateMax&&((u=S._encoderConfig)===null||u===void 0?void 0:u.bitrateMax)>200&&(h=S._scalabilityMode)!==null&&h!==void 0&&h.numSpatialLayers&&((m=S._scalabilityMode)===null||m===void 0?void 0:m.numSpatialLayers)>1&&this.store.codec==="vp8"){const R={},P={high:1e3*(S._encoderConfig.bitrateMax-50),medium:5e4};R.encodings=[{rid:"m",active:!0,maxBitrate:P.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:P.high}];const D=v.sender.getParameters();await v.sender.setParameters(Object.assign(D,R))}}}async applySimulcastEncodings(r,s){if(!zr()&&r.length===s.length)for(let a=0;a<r.length;a++){const c=s[a];if(c instanceof Tr&&this.isVP8Simulcast(c)){const u=r[a],h={},m={high:1e3*(c._encoderConfig.bitrateMax-50),medium:5e4};h.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:m.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:m.medium,scaleResolutionDownBy:4}];const y=u.sender.getParameters();await u.sender.setParameters(Object.assign(y,h))}}}isVP8Simulcast(r){var s,a,c,u,h;return!!(r instanceof Tr&&oe("SIMULCAST")&&this.store.codec==="vp8"&&!ot(s=r._hints).call(s,pr.LOW_STREAM)&&(a=r._encoderConfig)!==null&&a!==void 0&&a.bitrateMax&&((c=r._encoderConfig)===null||c===void 0?void 0:c.bitrateMax)>200&&(u=r._scalabilityMode)!==null&&u!==void 0&&u.numSpatialLayers&&((h=r._scalabilityMode)===null||h===void 0?void 0:h.numSpatialLayers)>1)}logSDPExchange(r,s,a,c){if(oe("SDP_LOGGING"))return x.upload("[".concat(this.store.clientId,"] exchanging ").concat(a," ").concat(s," SDP during P2PConnection.").concat(c,`
`),r),s==="offer"?u=>{this.logSDPExchange(u,"answer",a==="local"?"remote":"local",c)}:void 0}async muteLocal(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const s=this.peerConnection.getTransceivers().filter(h=>h.mid&&r.indexOf(h.mid)!==-1);if(s.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length.");s.map(h=>{h.direction="inactive"});const a=await this.peerConnection.createOffer(),c=this.logSDPExchange(a.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(a),this.remoteSDP.muteRemote(r);const u=this.remoteSDP.toString();c==null||c(u),await this.setRemoteDescription({type:"answer",sdp:u})}catch(s){throw new Me(te.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(s.toString()))}}async unmuteLocal(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const s=this.peerConnection.getTransceivers().filter(h=>h.mid&&r.indexOf(h.mid)!==-1);if(s.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length.");s.map(async h=>{h.direction="sendonly"});const a=await this.peerConnection.createOffer(),c=this.logSDPExchange(a.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(a),this.remoteSDP.unmuteRemote(r);const u=this.remoteSDP.toString();c==null||c(u),await this.setRemoteDescription({type:"answer",sdp:u})}catch(s){throw new Me(te.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(s.toString()))}}async getRemoteSSRC(r,s){var a,c;if(s=(a=s)!==null&&a!==void 0?a:(c=this.currentRemoteDescription)===null||c===void 0?void 0:c.sdp){var u;const h=(u=Wa(s).mediaDescriptions.find(m=>m.attributes.mid===r))===null||u===void 0?void 0:u.attributes.ssrcs;return h==null?void 0:h[0].ssrcId}}async setRemoteDescription(r){var s;await this.peerConnection.setRemoteDescription(r),ot(s=["connected","completed"]).call(s,this.peerConnection.iceConnectionState)||(this.isReady=!0,this.addRemoteCandidate())}mungReceiveAnswerSDP(r,s,a){const c=Wa(r),u=c.mediaDescriptions.find(h=>h.attributes.mid===s);return u&&a===Et.AUDIO&&u.media.mediaType==="audio"&&hS(u),$m(c)}},wt(vr.prototype,"establish",[Nu],Object.getOwnPropertyDescriptor(vr.prototype,"establish"),vr.prototype),wt(vr.prototype,"connect",[Nu],Object.getOwnPropertyDescriptor(vr.prototype,"connect"),vr.prototype),wt(vr.prototype,"receive",[Nu],Object.getOwnPropertyDescriptor(vr.prototype,"receive"),vr.prototype),wt(vr.prototype,"mockReceive",[Nu],Object.getOwnPropertyDescriptor(vr.prototype,"mockReceive"),vr.prototype),wt(vr.prototype,"stopReceiving",[Nu],Object.getOwnPropertyDescriptor(vr.prototype,"stopReceiving"),vr.prototype),wt(vr.prototype,"restartICE",[Nu],Object.getOwnPropertyDescriptor(vr.prototype,"restartICE"),vr.prototype),wt(vr.prototype,"close",[Nu],Object.getOwnPropertyDescriptor(vr.prototype,"close"),vr.prototype),wt(vr.prototype,"updateEncoderConfig",[Nu],Object.getOwnPropertyDescriptor(vr.prototype,"updateEncoderConfig"),vr.prototype),wt(vr.prototype,"updateSendParameters",[Nu],Object.getOwnPropertyDescriptor(vr.prototype,"updateSendParameters"),vr.prototype),wt(vr.prototype,"replaceTrack",[Nu],Object.getOwnPropertyDescriptor(vr.prototype,"replaceTrack"),vr.prototype),wt(vr.prototype,"muteLocal",[Nu],Object.getOwnPropertyDescriptor(vr.prototype,"muteLocal"),vr.prototype),wt(vr.prototype,"unmuteLocal",[Nu],Object.getOwnPropertyDescriptor(vr.prototype,"unmuteLocal"),vr.prototype),vr);function Nu(t,r,s){const a=t[r];if(typeof a!="function")throw new Error("Cannot use mutex on object property.");return s.value=async function(){const c=this.mutex,u=await c.lock("From P2PConnection.".concat(r));try{for(var h=arguments.length,m=new Array(h),y=0;y<h;y++)m[y]=arguments[y];return await a.apply(this,m)}finally{u()}},s}let Id=function(t){return t.SEND_ONLY="SEND_ONLY",t.RECEIVE_ONLY="RECEIVE_ONLY",t}({});var cK,lK,uK,dK,hK,fK,pK,mK,gK,_K,yK,Mr;function EK(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}function fO(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?EK(Object(s),!0).forEach(function(a){K(t,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):EK(Object(s)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))})}return t}let Xye=(cK=Ad(Id.SEND_ONLY),lK=Ad(Id.SEND_ONLY),uK=Ad(),dK=Ad(Id.RECEIVE_ONLY),hK=Ad(Id.RECEIVE_ONLY),fK=Ad(Id.RECEIVE_ONLY),pK=Ad(Id.RECEIVE_ONLY),mK=Ad(Id.RECEIVE_ONLY),gK=Ad(Id.RECEIVE_ONLY),_K=Ad(),yK=Ad(Id.RECEIVE_ONLY),Mr=class extends Fr{get state(){return this._state}set state(t){const r=this._state;this._state=t,this.emit(xt.StateChange,r,this._state)}constructor(t,r){super(),K(this,"isPlanB",!1),K(this,"store",void 0),K(this,"statsUploader",void 0),K(this,"sendConnection",void 0),K(this,"recvConnection",void 0),K(this,"localTrackMap",new Map),K(this,"remoteUserMap",new Map),K(this,"localDataChannels",[]),K(this,"pendingLocalTracks",[]),K(this,"pendingRemoteTracks",[]),K(this,"statsCollector",void 0),K(this,"dtlsFailedCount",0),K(this,"sendMutex",void 0),K(this,"recvMutex",void 0),K(this,"_state",Yn.Disconnected),K(this,"_restartStates",["disconnected","failed"]),K(this,"reconnectInterval",void 0),K(this,"uploadUnplinkStarted",!1),K(this,"uploadDownlinkStarted",!1),K(this,"uplinkStateUploadInterval",void 0),K(this,"downlinkStatsUploadInterval",void 0),K(this,"handleMuteLocalTrack",async(s,a,c)=>{const u=await this.sendMutex.lock("Locking from P2PChannel2.handleMuteLocalTrack");try{if(!this.sendConnection||this.state!==Yn.Connected)return void c(new Me(te.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established."));const y=this.filterTobeMutedTracks(s);if(y.length===0)return void a();const v=y.find(D=>D[0]==="videoLowTrack");v&&v[1].track._originMediaStreamTrack.stop(),await this.sendConnection.muteLocal(y.map(D=>{let[,{id:G}]=D;return G}));let S=!1;var h,m;s.trackMediaType==="video"?S=!((h=this.localTrackMap.get(Ke.LocalAudioTrack))===null||h===void 0||!h.track._muted):S=((m=this.localTrackMap.get(Ke.LocalVideoTrack))===null||m===void 0?void 0:m.id)===void 0;const R=this.createMuteMessage(y);await hr(this,xt.RequestMuteLocal,R);const P=s.trackMediaType==="video"?qm.MUTE_LOCAL_VIDEO:qm.MUTE_LOCAL_AUDIO;await hr(this,xt.RequestP2PMuteLocal,{action:P,message:R,isMuteAll:S}),a()}catch(y){c(y)}finally{u()}}),K(this,"handleUnmuteLocalTrack",async(s,a,c)=>{const u=await this.sendMutex.lock("Locking from P2PChannel2.handleUnmuteLocalTrack");try{if(!this.sendConnection||this.state!==Yn.Connected)return void c(new Me(te.INVALID_OPERATION,"Cannot call P2PChannel2.handleUnmuteLocalTrack before sendConnection established."));const h=this.filterTobeUnmutedTracks(s);if(h.length===0)return void a();await this.sendConnection.unmuteLocal(h.map(v=>{let[,{id:S}]=v;return S}));const m=this.createUnmuteMessage(h),y=s.trackMediaType==="video"?qm.UNMUTE_LOCAL_VIDEO:qm.UNMUTE_LOCAL_AUDIO;await hr(this,xt.RequestP2PMuteLocal,{action:y,message:m}),a()}catch(h){c(h)}finally{u()}}),K(this,"handleUpdateVideoEncoder",async(s,a,c,u)=>{let h;typeof u=="boolean"&&u||(h=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoEncoder"));try{const y=this.localTrackMap.get(Ke.LocalVideoTrack);if(!this.sendConnection||!y||y.track!==s||this.state!==Yn.Connected)return void a();const{id:v,track:S}=y;v&&(await this.sendConnection.updateSendParameters(v,S),await this.sendConnection.updateEncoderConfig(v,S),this.emit(xt.UpdateVideoEncoder,S)),a()}catch(y){c(y)}finally{var m;(m=h)===null||m===void 0||m()}}),K(this,"handleUpdateVideoSendParameters",async(s,a,c)=>{const u=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoSendParameters");try{const h=this.localTrackMap.get(Ke.LocalVideoTrack);if(!this.sendConnection||!h||h.track!==s||this.state!==Yn.Connected)return void a();const{id:m,track:y}=h;m&&await this.sendConnection.updateSendParameters(m,y),a()}catch(h){c(h)}finally{u()}}),K(this,"handleReplaceTrack",async(s,a,c,u)=>{let h;x.debug("[".concat(this.store.clientId,"] P2PChannel2 handleReplaceTrack for [track-id-").concat(s.getTrackId(),"]")),typeof u=="boolean"&&u||(h=await this.sendMutex.lock("From P2PChannel2.handleReplaceTrack"));try{var m;const v=Array.from(this.localTrackMap.entries()).find(S=>{let[,{track:R}]=S;return s===R});if(!this.sendConnection||!v||v[1].id===void 0||this.state!==Yn.Connected)return void a();if(await((m=this.sendConnection)===null||m===void 0?void 0:m.replaceTrack(s,v[1].id)),v[0]===Ke.LocalVideoTrack&&jn().supportDualStreamEncoding){const S=this.localTrackMap.get(Ke.LocalVideoLowTrack);if(S){const R=s._mediaStreamTrack.clone();S.track._originMediaStreamTrack.stop(),S.track._mediaStreamTrack=R,S.track._originMediaStreamTrack=R,await new dt((P,D)=>{this.handleReplaceTrack(S.track,P,D,!0)})}}a()}catch(v){c(v)}finally{var y;(y=h)===null||y===void 0||y()}}),K(this,"handleGetLocalVideoStats",s=>{s(this.statsCollector.getLocalVideoTrackStats())}),K(this,"handleGetLocalAudioStats",s=>{s(this.statsCollector.getLocalAudioTrackStats())}),K(this,"handleGetRemoteVideoStats",s=>this.statsCollector.getRemoteVideoTrackStats(s.uid)[s.uid]),K(this,"handleGetRemoteAudioStats",s=>this.statsCollector.getRemoteAudioTrackStats(s.uid)[s.uid]),this.store=t,this.statsCollector=r,this.statsCollector.addP2PChannel(this),this.statsUploader=new U9(t),this.bindStatsUploaderEvents(),this.sendMutex=new Fs("P2PChannel2-send-mutex",t.clientId),this.recvMutex=new Fs("P2PChannel2-recv-mutex",t.clientId),this.reconnectInterval=window.setInterval(()=>{[this.sendConnection,this.recvConnection].forEach(s=>{s&&(s.iceConnectionState!=="disconnected"&&s.iceConnectionState!=="failed"||this.handleDisconnect(s.direction))})},oe("ICE_RESTART_INTERVAL"))}async startP2PConnection(t,r){throw new Me(te.NOT_SUPPORTED,"p2p mode does not support startP2PConnection.")}async connect(t){throw new Me(te.NOT_SUPPORTED,"p2p mode does not support connect.")}async startP2P(t,r){let s;try{if(r){this.recvConnection&&(x.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset recvConnection.")),this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection)),s=await this.recvMutex.lock("From P2PChannel.startP2P"),this.recvConnection=new aK(t,this.store,Bo.RECEIVE_ONLY),this.bindConnectionEvents(this.recvConnection);const a=await this.recvConnection.establish(r);return{iceParameters:a.iceParameters,dtlsParameters:a.dtlsParameters,sdp:a.sdp}}{this.state=Yn.New,this.sendConnection&&(x.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset sendConnection.")),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection)),s=await this.sendMutex.lock("From P2PChannel.startP2P"),this.sendConnection=new aK(t,this.store),this.store.peerConnectionStart(),this.bindConnectionEvents(this.sendConnection);const a=await this.sendConnection.establish();return{iceParameters:a.iceParameters,dtlsParameters:a.dtlsParameters,sdp:a.sdp}}}finally{s&&s()}}async p2pConnect(t){if(!this.sendConnection)throw new Me(te.UNEXPECTED_ERROR,"Cannot P2PChannel2.p2pConnect before P2PChannel2.startP2PConnection .");this.store.peerConnectionStart(),await this.sendConnection.connect(t),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=Yn.Connected}async addRemoteCandidate(t,r){if(r===Bo.RECEIVE_ONLY){if(!this.sendConnection)throw new Me(te.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.sendConnection.addRemoteCandidate(t)}else{if(!this.recvConnection)throw new Me(te.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.recvConnection.addRemoteCandidate(t)}}publish(t,r,s){var a=this;return Il(function*(){const c=yield Nn(a.sendMutex.lock("From P2PChannel.publish"));try{if(!a.sendConnection||a.state!==Yn.Connected){a.throwIfTrackTypeNotMatch(t);const v=t.filter(S=>a.pendingLocalTracks.indexOf(S)===-1);return void(a.pendingLocalTracks=a.pendingLocalTracks.concat(v))}a.store.pubId=a.store.pubId+1,Ws.markPublishStart(a.store.clientId,a.store.pubId);const u=a.filterTobePublishedTracks(t,r,s);if(u.length===0)return void(yield Nn(a.tryToUnmuteAudio(t)));u.forEach(v=>{let{track:S,type:R}=v;const P=Date.now();a.store.publish(S.getTrackId(),R===Ke.LocalAudioTrack?"audio":"video",P)}),a.bindLocalTrackEvents(u);const h=yield Nn(a.sendConnection.send(u.map(v=>{let{track:S}=v;return S}),a.store.codec,a.store.audioCodec)),m=(yield Nn(h.next())).value,y=a.createGatewayPublishMessage(u,m);try{yield y}catch(v){throw h.throw(v),(v==null?void 0:v.code)===te.WS_ABORT&&u.forEach(S=>{let{track:R}=S;a.pendingLocalTracks.indexOf(R)===-1&&a.pendingLocalTracks.push(R)}),a.unbindLocalTrackEvents(u),v}yield Nn(h.next()),u.forEach(v=>{let{type:S}=v;a.statsCollector.addLocalStats(S)}),a.statsUploader.startUploadOutboundStats(),a.assignLocalTracks(u,m),u.forEach(v=>{let{track:S,type:R}=v;const P=Date.now();a.store.publish(S.getTrackId(),R===Ke.LocalAudioTrack?"audio":"video",void 0,P)}),a.startUploadUplinkState()}finally{c()}})()}async unpublish(t){if(!this.sendConnection||this.state!==Yn.Connected)return void(t.length===0?this.pendingLocalTracks.length=0:this.pendingLocalTracks=this.pendingLocalTracks.filter(c=>!ot(t).call(t,c)));const r=this.filterTobeUnpublishedTracks(t);if(r.length===0)return;const s=r.find(c=>c[0]==="videoLowTrack");s&&s[1].track.close();const a=this.createGatewayUnpublishMessage(r);if(await this.sendConnection.stopSending(r.map(c=>{let[,{id:u}]=c;return u})),this.withdrawLocalTracks(r),this.unbindLocalTrackEvents(r.map(c=>{let[u,{track:h}]=c;return{type:u,track:h}})),r.forEach(c=>{let[u]=c;this.statsCollector.removeLocalStats(u)}),this.localTrackMap.size===0&&(this.statsUploader.stopUploadOutboundStats(),this.stopUploadUplinkState()),this.sendConnection&&this.state===Yn.Connected)return s&&s[1].track.close(),a;t.forEach(c=>{const u=this.pendingLocalTracks.indexOf(c);u!==-1&&this.pendingLocalTracks.splice(u,1)})}startUploadUplinkState(){if(this.uploadUnplinkStarted)return;this.uploadUnplinkStarted=!0,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval);const t=()=>{const r=[],s=[];Array.from(this.localTrackMap.entries()).forEach(a=>{let[c,{track:u,ssrcs:h}]=a;const m={stream_type:Bge(u,c),ssrcs:h};u._muted||!u._enabled?r.push(m):s.push(m)}),r.length>0&&r.forEach(a=>{hr(this,xt.RequestMuteLocal,[a])}),s.length>0&&s.forEach(a=>{hr(this,xt.RequestUnmuteLocal,[a])})};t(),this.uplinkStateUploadInterval=window.setInterval(()=>{t()},3e3)}stopUploadUplinkState(){this.uploadUnplinkStarted&&(this.uploadUnplinkStarted=!1,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval))}publishLowStream(t){return Il(function*(){throw new Me(te.NOT_SUPPORTED,"p2p mode does not support publishLowStream.")})()}async republish(){this.pendingLocalTracks.length>0&&(x.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await ks(this,xt.RequestRePublish,this.pendingLocalTracks),this.emit(xt.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[])}async unpublishLowStream(){throw new Me(te.NOT_SUPPORTED,"p2p mode does not support unpublishLowStream.")}async subscribe(t,r,s,a){var c;if(!this.recvConnection)throw new Me(te.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");if((c=this.remoteUserMap.get(t))!==null&&c!==void 0&&c.has(r))return;const{track:u,mid:h,transceiver:m}=await this.recvConnection.receive(r,[{ssrcId:s}],String(t.uid),a);r===Et.AUDIO?(t._audioTrack?t._audioTrack._updateOriginMediaStreamTrack(u):(t._audioTrack=new rS(u,t.uid,t._uintid,this.store),x.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(t._audioTrack.getTrackId()))),m&&t._audioTrack._updateRtpTransceiver(m),this.bindRemoteTrackEvents(t,t._audioTrack)):(t._videoSSRC=s,t._videoTrack?t._videoTrack._updateOriginMediaStreamTrack(u):(t._videoTrack=new nS(u,t.uid,t._uintid,this.store),x.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(t._videoTrack.getTrackId()))),m&&t._videoTrack._updateRtpTransceiver(m),this.bindRemoteTrackEvents(t,t._videoTrack));const y=this.remoteUserMap.get(t);y?y.set(r,h):this.remoteUserMap.set(t,new Map([[r,h]])),this.statsCollector.addRemoteStats(t.uid),this.statsUploader.startUploadInboundStats(),this.startUploadDownlinkState();const v=this.pendingRemoteTracks.findIndex(S=>{let{user:R,kind:P}=S;return R.uid===t.uid&&r===P});v!==-1&&(this.pendingRemoteTracks.splice(v,1),this.emit(xt.MediaReconnectEnd,t.uid))}async mockSubscribe(t,r,s,a){if(!this.recvConnection)throw new Me(te.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");await this.recvConnection.mockReceive(r,[{ssrcId:s}],String(t.uid),a)}async unsubscribe(t,r,s){const a=this.pendingRemoteTracks.filter(u=>{let{user:h,kind:m}=u;return r!==void 0?h.uid===t.uid&&r===m:h.uid===t.uid});if(a.forEach(u=>{const h=this.pendingRemoteTracks.indexOf(u);this.pendingRemoteTracks.splice(h,1)}),this.recvConnection||s||a.forEach(u=>{let{kind:h}=u;var m;if(h===Et.AUDIO)(m=t._audioTrack)===null||m===void 0||m._destroy(),t._audioTrack=void 0;else if(h===Et.VIDEO){var y;(y=t._videoTrack)===null||y===void 0||y._destroy(),t._videoTrack=void 0}}),!this.recvConnection)return;const c=this.filterTobeUnSubscribedTracks(t,r);c.length!==0&&(await this.recvConnection.stopReceiving(c.map(u=>{let[,{id:h}]=u;return h})),this.withdrawRemoteTracks(c),this.remoteUserMap.size===0&&(this.statsUploader.stopUploadInboundStats(),this.stopUploadDownlinkState()),c.forEach(u=>{let[h,{kind:m}]=u;var y,v;if(m===Et.VIDEO&&h._videoSSRC&&((y=this.recvConnection)===null||y===void 0||y.setStatsRemoteVideoIsReady(h._videoSSRC,!1)),m===Et.VIDEO)this.unbindRemoteTrackEvents(h._videoTrack),s||((v=h._videoTrack)===null||v===void 0||v._destroy(),h._videoTrack=void 0);else if(m===Et.AUDIO){var S;this.unbindRemoteTrackEvents(h._audioTrack),!s&&((S=h._audioTrack)===null||S===void 0||S._destroy(),h._audioTrack=void 0)}}),c.forEach(u=>{let[,{kind:h}]=u;hr(this,xt.RequestP2PMuteRemote,h)}))}startUploadDownlinkState(){if(this.uploadDownlinkStarted)return;this.uploadDownlinkStarted=!0,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval);const t=()=>Array.from(this.remoteUserMap.entries()).forEach(r=>{let[,s]=r;[Et.VIDEO,Et.AUDIO].forEach(a=>{s.has(a)?hr(this,xt.RequestP2PUnmuteRemote,a):hr(this,xt.RequestP2PMuteRemote,a)})});t(),this.downlinkStatsUploadInterval=window.setInterval(()=>{t()},3e3)}stopUploadDownlinkState(){this.uploadDownlinkStarted&&(this.uploadDownlinkStarted=!1,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval))}getAllDataChannels(){return this.localDataChannels}async massSubscribe(t){throw new Me(te.NOT_SUPPORTED,"p2p mode does not support massSubscribe.")}async massSubscribeNoLock(t){throw new Me(te.NOT_SUPPORTED,"p2p mode does not support massSubscribeNoLock.")}async massUnsubscribe(t){throw new Me(te.NOT_SUPPORTED,"p2p mode does not support massUnsubscribe.")}async massUnsubscribeNoLock(t){throw new Me(te.NOT_SUPPORTED,"p2p mode does not support massUnsubscribeNoLock.")}async muteRemote(t,r){if(!this.recvConnection)return;const s=this.remoteUserMap.get(t);if(!s)return void x.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(t.uid,"."));if(!s.get(r))return void x.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(t.uid," media type ").concat(r,"."));const a=r===Et.VIDEO?t._videoSSRC:t._audioSSRC;a!==void 0&&this.recvConnection.setStatsRemoteVideoIsReady(a,!1)}async unmuteRemote(t,r){return this.unmuteRemoteNoLock(t,r)}async unmuteRemoteNoLock(t,r){if(!this.recvConnection)return;const s=this.remoteUserMap.get(t);if(!s)return void x.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(t.uid,"."));s.get(r)||x.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(t.uid," media type ").concat(r,"."))}getAllTracks(t){const r=this.localTrackMap.get(Ke.LocalAudioTrack);if((r==null?void 0:r.track)instanceof Fi){const s=r.track;return Array.from(this.localTrackMap.entries()).filter(a=>{let[c]=a;return c!==Ke.LocalAudioTrack}).filter(a=>{let[c]=a;return!(t&&c===Ke.LocalVideoLowTrack)}).map(a=>{let[,{track:c}]=a;return c}).concat(s.trackList)}return Array.from(this.localTrackMap.entries()).filter(s=>{let[a]=s;return!(t&&a===Ke.LocalVideoLowTrack)}).map(s=>{let[,{track:a}]=s;return a})}reportPublishEvent(t,r,s,a,c){if(t){const h=this.localTrackMap.get(Ke.LocalAudioTrack),m=a?this.localTrackMap.get(Ke.LocalVideoLowTrack):this.localTrackMap.get(Ke.LocalVideoTrack);At.publish(this.store.sessionId,{eventElapse:Ws.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:t,ec:r,audioName:h==null?void 0:h.track.getTrackLabel(),videoName:m==null?void 0:m.track.getTrackLabel(),screenshare:(m==null?void 0:m.track._hints.indexOf(pr.SCREEN_TRACK))!==-1,audio:!!h,video:!!m,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:c})}else{var u;s||(s=[]);const h=s.find(y=>y instanceof Xr),m=a?(u=this.localTrackMap.get(Ke.LocalVideoTrack))===null||u===void 0?void 0:u.track:s.find(y=>y instanceof Tr);At.publish(this.store.sessionId,{eventElapse:Ws.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:t,ec:r,audioName:h==null?void 0:h.getTrackLabel(),videoName:m==null?void 0:m.getTrackLabel(),screenshare:(m==null?void 0:m._hints.indexOf(pr.SCREEN_TRACK))!==-1,audio:!!h,video:!!m,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:c})}}reportSubscribeEvent(t,r,s,a){const c=a===Et.VIDEO?s._videoSSRC:s._audioSSRC;c&&At.subscribe(this.store.sessionId,{succ:t,ec:r,video:a===Et.VIDEO,audio:a===Et.AUDIO,peerid:s.uid,subscribeRequestid:a===Et.VIDEO?s._videoSSRC:s._audioSSRC,p2pid:this.store.p2pId,eventElapse:Ws.measureFromSubscribeStart(this.store.clientId,c)})}reset(){x.debug("[".concat(this.store.clientId,"] P2PChannel2.reset")),this.sendMutex=new Fs("P2PChannel2-send-mutex",this.store.clientId),this.sendMutex=new Fs("P2PChannel2-recv-mutex",this.store.clientId),this.sendConnection&&(this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0),this.recvConnection&&(this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const t=this.localTrackMap.get(Ke.LocalAudioTrack);if((t==null?void 0:t.track)instanceof Fi){if(t.track.trackList.length>0){const r=t.track;t.track.trackList.forEach(s=>{r.removeAudioTrack(s)})}t.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.reconnectInterval&&(window.clearInterval(this.reconnectInterval),this.reconnectInterval=void 0),this.state=Yn.Disconnected}getStats(t){var r,s;return t?(s=this.recvConnection)===null||s===void 0?void 0:s.getStats():(r=this.sendConnection)===null||r===void 0?void 0:r.getStats()}getRemoteVideoIsReady(t){var r;return((r=this.recvConnection)===null||r===void 0?void 0:r.getRemoteVideoIsReady(t))||!1}getLocalAudioVolume(){const t=this.localTrackMap.get(Ke.LocalAudioTrack);if(t)return t.track.getVolumeLevel()}getLocalVideoSize(){const t=this.localTrackMap.get(Ke.LocalVideoTrack);if(t)return{width:t.track.videoWidth||0,height:t.track.videoHeight||0}}getEncoderConfig(t){const r=this.localTrackMap.get(t);return r&&r.track instanceof Tr||r&&r.track instanceof Xr?r.track._encoderConfig:void 0}getLocalMedia(t){return this.localTrackMap.get(t)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(t,r){if(!t)return this.remoteUserMap.size>0;const s=this.remoteUserMap.get(t);return!!s&&(!r||s.has(r))}async hasRemoteMediaWithLock(t,r){if(!t)return this.remoteUserMap.size>0;const s=this.remoteUserMap.get(t);return!!s&&(!r||s.has(r))}getRemoteMedia(t){var r;const s=Array.from(Yc(r=this.remoteUserMap).call(r)).find(a=>a.uid===t);return s?{audioTrack:s.audioTrack,audioSSRC:s._audioSSRC,videoTrack:s.videoTrack,videoSSRC:s._videoSSRC}:{}}getAudioLevels(){let t=Array.from(this.remoteUserMap.entries()).map(s=>{let[a]=s;return{uid:a.uid,level:a.audioTrack?100*a.audioTrack._source.getAccurateVolumeLevel():0}});const r=this.localTrackMap.get(Ke.LocalAudioTrack);return r&&t.push({level:100*r.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),t=pT(t).call(t,(s,a)=>s.level-a.level),t}async disconnectForReconnect(){this.sendConnection&&this.recvConnection&&(x.debug("[".concat(this.store.clientId,"] P2PChannel2.disconnectForReconnect closing P2PConnection")),this.state=Yn.Reconnecting,oe("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(t=>{let[r]=t;var s;r._videoTrack&&r._videoTrack._player&&((s=r._videoTrack._player.getVideoElement())===null||s===void 0||s.pause(),r._videoTrack._player.isKeepLastFrame=!0,r._videoTrack._originMediaStreamTrack.stop())}),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0,this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0,this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(t=>{var r;let[s,{track:a}]=t;switch(s){case Ke.LocalVideoTrack:ot(r=a._hints).call(r,pr.LOW_STREAM)?a.close():this.pendingLocalTracks.push(a);break;case Ke.LocalAudioTrack:a instanceof Fi?this.pendingLocalTracks=this.pendingLocalTracks.concat(a.trackList):this.pendingLocalTracks.push(a);case Ke.LocalVideoLowTrack:}}),this.emit(xt.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(t=>{let[r,s]=t;Array.from(Yc(s).call(s)).forEach(a=>{this.setPendingRemoteMedia(r,a)}),this.emit(xt.MediaReconnectStart,r.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),x.debug("[".concat(this.store.clientId,"] P2PChannel2 disconnected, waiting to reconnect.")))}hasPendingRemoteMedia(t,r){for(const s of this.pendingRemoteTracks){const{user:a,kind:c}=s;if((t instanceof Zm?t.uid:t)===a.uid&&r===c)return!0}return!1}setPendingRemoteMedia(t,r){this.hasPendingRemoteMedia(t,r)||this.pendingRemoteTracks.push({user:t,kind:r})}async restartICE(t,r){let s,a;if(t===Bo.SEND_ONLY){if(!this.sendConnection)throw new Me(te.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established.");s=await this.sendMutex.lock("From P2PChannel.restartICE"),a=this.sendConnection}else{if(!this.recvConnection)throw new Me(te.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before recvConnection established.");s=await this.recvMutex.lock("From P2PChannel.restartICE"),a=this.recvConnection}try{if(r){const c=await a.restartICE(r);return a.isInRestartIce=!1,c}{const c=await a.restartICE();if(c){const u=await ks(this,xt.RequestP2PRestartICE,{direction:Bo.RECEIVE_ONLY,iceParameter:c});await a.restartICE(u),a.isInRestartIce=!1}}}finally{s()}}getUplinkNetworkQuality(){if(!this.sendConnection)return 0;const t=this.sendConnection.getStats(),r=this.localTrackMap.get(Ke.LocalVideoTrack),s=this.localTrackMap.get(Ke.LocalAudioTrack),a=t.videoSend.find(D=>{var G;return D.ssrc===(r==null||(G=r.ssrcs)===null||G===void 0?void 0:G[0].ssrcId)}),c=t.audioSend.find(D=>{var G;return D.ssrc===(s==null||(G=s.ssrcs)===null||G===void 0?void 0:G[0].ssrcId)});if(!a||!c)return 1;const u=Kc(this,xt.NeedSignalRTT),h=a?a.rttMs:void 0,m=c?c.rttMs:void 0,y=h&&m?(h+m)/2:h||m,v=(y&&u?(y+u)/2:y||u)||0,S=100*t.sendPacketLossRate*.7/50+.3*v/1500,R=S<.17?1:S<.36?2:S<.59?3:S<.1?4:5,P=r==null?void 0:r.track;if(P&&P._encoderConfig&&P._hints.indexOf(pr.SCREEN_TRACK)===-1){const D=P._encoderConfig.bitrateMax,G=t.bitrate.actualEncoded;if(D&&G){const F=(1e3*D-G)/(1e3*D);return SH[F<.15?0:F<.3?1:F<.45?2:F<.6?3:4][R]}}return R}getDownlinkNetworkQuality(){if(!this.recvConnection)return 0;const t=this.recvConnection.getStats();let r=0;return Array.from(this.remoteUserMap.entries()).forEach(s=>{let[a]=s;const c=a._audioSSRC,u=a._videoSSRC,h=t.audioRecv.find(G=>G.ssrc===c),m=t.videoRecv.find(G=>G.ssrc===u);if(!h&&!m)return void(r+=1);const y=Kc(this,xt.NeedSignalRTT),v=t.rtt,S=(v&&y?(v+y)/2:v||y)||0,R=h?h.jitterMs:void 0,P=t.recvPacketLossRate;let D=.7*P*100/50+.3*S/1500;R&&(D=.6*P*100/50+.2*S/1500+.2*R/400),r+=D<.1?1:D<.17?2:D<.36?3:D<.59?4:5}),this.remoteUserMap.size>0?Math.round(r/this.remoteUserMap.size):r}async muteLocalTrack(t){return new dt((r,s)=>{this.handleMuteLocalTrack(t,r,s)})}filterTobePublishedTracks(t,r,s){const a=[],c=jn(),u=this.getAllTracks();t=zv(t=t.filter(y=>u.indexOf(y)===-1));let h=!1,m=!1;for(const y of t){if(y instanceof Tr&&(this.localTrackMap.has(Ke.LocalVideoTrack)||h?new Me(te.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(a.push({track:y,type:Ke.LocalVideoTrack}),h=!0),r)){const v=this.getLowVideoTrack(y,s);a.push({track:v,type:Ke.LocalVideoLowTrack})}if(y instanceof Xr){const v=this.localTrackMap.get(Ke.LocalAudioTrack);if(v){if(!(v.track instanceof Fi))throw new Me(te.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(y._bypassWebAudio)throw new Me(te.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");v.track.addAudioTrack(y),this.bindLocalAudioTrackEvents(y,!0)}else if(m){const S=a.find(R=>{let{type:P}=R;return P===Ke.LocalAudioTrack});if(!(S.track instanceof Fi))throw new Me(te.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(y._bypassWebAudio)throw new Me(te.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");S.track.addAudioTrack(y)}else{if(!c.webAudioMediaStreamDest||y instanceof Fi||y._bypassWebAudio)a.push({track:y,type:Ke.LocalAudioTrack});else{const S=new Fi;S.addAudioTrack(y),a.push({track:S,type:Ke.LocalAudioTrack})}m=!0}}}return a}filterTobeUnpublishedTracks(t){const r=[],s=this.getAllTracks();t=zv(t=t.filter(a=>s.indexOf(a)!==-1));for(const a of t){if(a instanceof Xr){const c=this.localTrackMap.get(Ke.LocalAudioTrack);if(!c)continue;c.track instanceof Fi?(c.track.removeAudioTrack(a),this.unbindLocalAudioTrackEvents(a),c.track.trackList.length===0&&(r.push([Ke.LocalAudioTrack,c]),c.track.close())):r.push([Ke.LocalAudioTrack,c])}if(a instanceof Tr){const c=this.localTrackMap.get(Ke.LocalVideoTrack);if(!c)continue;r.push([Ke.LocalVideoTrack,c]);const u=this.localTrackMap.get(Ke.LocalVideoLowTrack);u&&r.push([Ke.LocalVideoLowTrack,u])}}return r}bindLocalTrackEvents(t){t.forEach(r=>{let{track:s,type:a}=r;switch(a){case Ke.LocalVideoTrack:s.addListener(Tt.GET_STATS,this.handleGetLocalVideoStats),s.addListener(Tt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),s.addListener(Tt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),s.addListener(Tt.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),s.addListener(Tt.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),s.addListener(Tt.NEED_REPLACE_TRACK,this.handleReplaceTrack),s.addListener(Tt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),s.addListener(Tt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Ke.LocalAudioTrack:this.bindLocalAudioTrackEvents(s);case Ke.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(t,r){t instanceof Fi?t.trackList.forEach(s=>{s.addListener(Tt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),s.addListener(Tt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),s.addListener(Tt.GET_STATS,this.handleGetLocalAudioStats),s.addListener(Tt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),s.addListener(Tt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(t.addListener(Tt.GET_STATS,this.handleGetLocalAudioStats),t.addListener(Tt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.addListener(Tt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.addListener(Tt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.addListener(Tt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),r||t.addListener(Tt.NEED_REPLACE_TRACK,this.handleReplaceTrack))}unbindLocalTrackEvents(t){t||(t=Array.from(this.localTrackMap.entries()).map(r=>{let[s,{track:a}]=r;return{track:a,type:s}})),t.forEach(r=>{let{track:s,type:a}=r;switch(a){case Ke.LocalVideoTrack:s.off(Tt.GET_STATS,this.handleGetLocalVideoStats),s.off(Tt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),s.off(Tt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),s.off(Tt.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),s.off(Tt.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),s.off(Tt.NEED_REPLACE_TRACK,this.handleReplaceTrack),s.off(Tt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),s.off(Tt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Ke.LocalAudioTrack:this.unbindLocalAudioTrackEvents(s);case Ke.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(t){t instanceof Fi?t.trackList.forEach(r=>{r.off(Tt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),r.off(Tt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),r.off(Tt.GET_STATS,this.handleGetLocalAudioStats),r.off(Tt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),r.off(Tt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(t.off(Tt.GET_STATS,this.handleGetLocalAudioStats),t.off(Tt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(Tt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(Tt.NEED_REPLACE_TRACK,this.handleReplaceTrack),t.off(Tt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(Tt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(t,r){r instanceof nS&&r.addListener(Tt.GET_STATS,s=>{s(this.handleGetRemoteVideoStats(t))}),r instanceof rS&&r.addListener(Tt.GET_STATS,s=>{s(this.handleGetRemoteAudioStats(t))})}unbindRemoteTrackEvents(t){t&&t.removeAllListeners(Tt.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(t=>{let[r,s]=t;s.has(Et.AUDIO)&&this.unbindRemoteTrackEvents(r._audioTrack),s.has(Et.VIDEO)&&this.unbindRemoteTrackEvents(r._videoTrack)})}createGatewayPublishMessage(t,r){return t.map((s,a)=>{var c;let u,{track:h,type:m}=s;switch(m){case Ke.LocalAudioTrack:u=Xn.Audio;break;case Ke.LocalVideoTrack:u=ot(c=h._hints).call(c,pr.SCREEN_TRACK)?Xn.Screen:Xn.High;break;case Ke.LocalVideoLowTrack:u=Xn.Low}return{kind:m===Ke.LocalAudioTrack?Et.AUDIO:Et.VIDEO,stream_type:u,mid:r[a].id,ssrcs:r[a].localSSRC,isMuted:h.muted||!h.enabled}})}createGatewayUnpublishMessage(t){return t.map(r=>{var s;let a,[c,{track:u,ssrcs:h,id:m}]=r;switch(c){case Ke.LocalVideoTrack:a=ot(s=u._hints).call(s,pr.SCREEN_TRACK)?Xn.Screen:Xn.High;break;case Ke.LocalAudioTrack:a=Xn.Audio;break;case Ke.LocalVideoLowTrack:a=Xn.Low}return{stream_type:a,ssrcs:h,mid:m}})}assignLocalTracks(t,r){t.forEach((s,a)=>{let{track:c,type:u}=s;this.localTrackMap.set(u,{track:c,id:r[a].id,ssrcs:r[a].localSSRC})})}withdrawLocalTracks(t){t.forEach(r=>{let[s]=r;this.localTrackMap.delete(s)})}bindConnectionEvents(t){t.onConnectionStateChange=async r=>{var s;x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: ").concat(t.name,".onConnectionStateChange(").concat(r,")")),this.emit(xt.PeerConnectionStateChange,r),r!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),r==="connected"&&(t.isInRestartIce=!1),ot(s=this._restartStates).call(s,r)&&!t.isInRestartIce&&(r==="disconnected"&&await ps(800),t.iceConnectionState!=="disconnected"&&t.iceConnectionState!=="failed"||this.handleDisconnect(t.direction))},t.onICEConnectionStateChange=r=>{r!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(r,")")),At.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:r,tag:Hr.TRACER}).onSuccess(),this.emit(xt.IceConnectionStateChange,r)},t.onICETransportStateChange=r=>{x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(r,")"))},t.onDTLSTransportStateChange=r=>{x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(r,")"))},t.onDTLSTransportError=r=>{x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(r,")"))},t.onFirstAudioDecoded=r=>{var s;const a=Array.from(Yc(s=this.remoteUserMap).call(s)).find(u=>u._audioSSRC===r);var c;a&&(this.store.subscribe(a.uid,"audio",void 0,void 0,void 0,Date.now()),(c=a.audioTrack)===null||c===void 0||c.emit(Jv.FIRST_FRAME_DECODED),At.firstRemoteFrame(this.store.sessionId,Zi.FIRST_AUDIO_DECODE,xr.FIRST_AUDIO_DECODE,{peer:a._uintid,subscribeElapse:Ws.measureFromSubscribeStart(this.store.clientId,r),subscribeRequestid:r,p2pid:this.store.p2pId}))},t.onFirstAudioReceived=r=>{var s;const a=Array.from(Yc(s=this.remoteUserMap).call(s)).find(c=>c._audioSSRC===r);a&&At.firstRemoteFrame(this.store.sessionId,Zi.FIRST_AUDIO_RECEIVED,xr.FIRST_AUDIO_RECEIVED,{peer:a._uintid,subscribeElapse:Ws.measureFromSubscribeStart(this.store.clientId,r),subscribeRequestid:r,p2pid:this.store.p2pId})},t.onFirstVideoDecoded=(r,s,a)=>{this.reportVideoFirstFrameDecoded(r,s,a)},t.onFirstVideoReceived=r=>{var s;const a=Array.from(Yc(s=this.remoteUserMap).call(s)).find(c=>c._videoSSRC===r);a&&At.firstRemoteFrame(this.store.sessionId,Zi.FIRST_VIDEO_RECEIVED,xr.FIRST_VIDEO_RECEIVED,{peer:a._uintid,subscribeElapse:Ws.measureFromSubscribeStart(this.store.clientId,r),subscribeRequestid:r,p2pid:this.store.p2pId})},t.onSelectedLocalCandidateChanged=(r,s)=>{const a=r.candidateType==="relay",c=s.candidateType==="relay";s.candidateType!=="unknown"&&a===c||this.emit(xt.ConnectionTypeChange,a),x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(Xm(s))," -> ").concat(JSON.stringify(Xm(r)),")"))},t.onSelectedRemoteCandidateChanged=(r,s)=>{x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(Xm(s))," -> ").concat(JSON.stringify(Xm(r)),")"))},t.onFirstVideoDecodedTimeout=r=>{this.reportVideoFirstFrameDecoded(r,void 0,void 0,!0)},t.onLocalCandidate=r=>{this.emit(xt.LocalCandidate,{candidate:r,direction:t.direction})}}unbindConnectionEvents(t){t.onConnectionStateChange=void 0,t.onICEConnectionStateChange=void 0,t.onICETransportStateChange=void 0,t.onDTLSTransportStateChange=void 0,t.onDTLSTransportError=void 0,t.onFirstAudioDecoded=void 0,t.onFirstAudioReceived=void 0,t.onFirstVideoDecoded=void 0,t.onFirstVideoReceived=void 0,t.onSelectedLocalCandidateChanged=void 0,t.onSelectedRemoteCandidateChanged=void 0,t.onFirstVideoDecodedTimeout=void 0,t.onLocalCandidate=void 0}async handleDisconnect(t){const r=t===Bo.SEND_ONLY?this.sendConnection:this.recvConnection;r&&!r.isInRestartIce&&(r.isInRestartIce=!0,x.debug("[".concat(this.store.clientId,"] [P2PChannel-").concat(r.name,"] start use restartICE")),t===Bo.SEND_ONLY?this.restartICE(t):ks(this,xt.RequestP2PRestartICE,{direction:Bo.SEND_ONLY}))}filterTobeMutedTracks(t){const r=[];if(this.getAllTracks().indexOf(t)===-1)return r;const s=this.localTrackMap.get(Ke.LocalAudioTrack);if(t instanceof Xr&&(s==null?void 0:s.track)instanceof Fi)return s.track.isActive||r.push([Ke.LocalAudioTrack,s]),r;const a=Array.from(this.localTrackMap.entries()).find(c=>{let[,{track:u}]=c;return t===u});if(a&&(r.push(a),a[0]===Ke.LocalVideoTrack)){const c=this.localTrackMap.get(Ke.LocalVideoLowTrack);c&&r.push([Ke.LocalVideoLowTrack,c])}return r}filterTobeUnmutedTracks(t){const r=[],s=this.localTrackMap.get(Ke.LocalAudioTrack);if(t instanceof Xr&&(s==null?void 0:s.track)instanceof Fi)return s.track.isActive&&r.push([Ke.LocalAudioTrack,s]),r;const a=Array.from(this.localTrackMap.entries()).find(c=>{let[,{track:u}]=c;return t===u});if(a)if(a[0]===Ke.LocalVideoTrack){r.push(a);const c=this.localTrackMap.get(Ke.LocalVideoLowTrack);c&&r.push([Ke.LocalVideoLowTrack,c])}else r.push(a);return r}createMuteMessage(t){return t.map(r=>{var s;let a,[c,{track:u,ssrcs:h,id:m}]=r;switch(c){case Ke.LocalAudioTrack:a=Xn.Audio;break;case Ke.LocalVideoTrack:a=ot(s=u._hints).call(s,pr.SCREEN_TRACK)?Xn.Screen:Xn.High;break;case Ke.LocalVideoLowTrack:a=Xn.Low}return{stream_type:a,ssrcs:h,mid:m}})}createUnmuteMessage(t){return t.map(r=>{var s;let a,[c,{track:u,ssrcs:h,id:m}]=r;switch(c){case Ke.LocalAudioTrack:a=Xn.Audio;break;case Ke.LocalVideoTrack:a=ot(s=u._hints).call(s,pr.SCREEN_TRACK)?Xn.Screen:Xn.High;break;case Ke.LocalVideoLowTrack:a=Xn.Low}return{stream_type:a,ssrcs:h,mid:m}})}filterTobeUnSubscribedTracks(t,r){const s=[],a=this.remoteUserMap.get(t);if(!a)return s;if(r){const c=a.get(r);if(!c)return s;s.push([t,{kind:r,id:c}])}else Array.from(a.entries()).forEach(c=>{let[u,h]=c;s.push([t,{kind:u,id:h}])});return s}createUnsubscribeMessage(t){const r=[];return t.forEach(s=>{let[a,{kind:c,id:u}]=s;switch(c){case Et.VIDEO:return void(a._videoSSRC&&r.push({stream_type:Et.VIDEO,ssrcId:a._videoSSRC}));case Et.AUDIO:return void(a._audioSSRC&&r.push({stream_type:Et.AUDIO,ssrcId:a._audioSSRC}))}}),r}withdrawRemoteTracks(t){t.forEach(r=>{let[s,{kind:a}]=r;const c=this.remoteUserMap.get(s);c&&(c.delete(a),Array.from(c.entries()).length===0&&this.remoteUserMap.delete(s))})}async updateBitrateLimit(t){const r=this.localTrackMap.get(Ke.LocalVideoTrack),s=this.localTrackMap.get(Ke.LocalVideoLowTrack);r&&(await r.track.setBitrateLimit(t.uplink),await new dt((a,c)=>{this.handleUpdateVideoEncoder(r.track,a,c,!0)})),s&&t.low_stream_uplink&&(await s.track.setBitrateLimit({max_bitrate:t.low_stream_uplink.bitrate,min_bitrate:t.low_stream_uplink.bitrate||0}),await new dt((a,c)=>{this.handleUpdateVideoEncoder(s.track,a,c,!0)}))}isP2PDisconnected(){if(this.sendConnection&&this.recvConnection){const t=this.sendConnection.peerConnectionState,r=this.recvConnection.peerConnectionState;return t!=="connected"&&r!=="connected"}return!0}async tryToUnmuteAudio(t){for(let r=0;r<t.length;r++)if(t[r]instanceof Xr){const s=this.filterTobeUnmutedTracks(t[r]);if(s.length===0)continue;const a=this.createUnmuteMessage(s);return void await hr(this,xt.RequestUnmuteLocal,a)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=t=>this.getStats(t),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()).filter(t=>{let[,{ssrcs:r}]=t;return!!r}),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=t=>{var r;return!((r=this.recvConnection)===null||r===void 0||!r.getRemoteVideoIsReady(t))},this.statsUploader.requestUpload=(t,r)=>this.emit(xt.RequestUpload,t,r),this.statsUploader.requestUploadStats=t=>this.emit(xt.RequestUploadStats,t),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await ps(wL(this.dtlsFailedCount,ki)),this.emit(xt.RequestReconnect)}async reconnectP2P(){}canPublishLowStream(){return this.localTrackMap.has(Ke.LocalVideoTrack)||this.pendingLocalTracks.some(t=>t instanceof Tr)}throwIfTrackTypeNotMatch(t){if(t.filter(r=>r instanceof Tr).length>1)throw new Me(te.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t.filter(r=>r instanceof Xr).length>1&&(t.some(r=>r instanceof Xr&&r._bypassWebAudio)||!jn().webAudioMediaStreamDest))throw new Me(te.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const r of t){if(r instanceof Tr&&this.pendingLocalTracks.some(s=>s instanceof Tr))throw new Me(te.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(r instanceof Xr&&this.pendingLocalTracks.some(s=>s instanceof Xr)&&(!jn().webAudioMediaStreamDest||r._bypassWebAudio||this.pendingLocalTracks.some(s=>s instanceof Xr&&s._bypassWebAudio)))throw new Me(te.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(t,r){const s=!oe("DISABLE_DUAL_STREAM_USE_ENCODING")&&jn().supportDualStreamEncoding,a=fO(fO({},{width:160,height:120,framerate:15,bitrate:50}),r);let c;c=s?t._mediaStreamTrack.clone():D2(t,a);const u=fr(8,"track-low-"),h=new Tr(c,fO(fO({},s&&{scaleResolutionDownBy:m2(a,t)}),{},{frameRate:a.framerate,bitrateMax:a.bitrate,bitrateMin:a.bitrate}),void 0,void 0,u);return h.on(H_.TRANSCEIVER_UPDATED,m=>{t._updateRtpTransceiver(m,Yv.LOW_STREAM)}),h._hints.push(pr.LOW_STREAM),t.addListener(Tt.NEED_CLOSE,()=>{h.close()}),h}async globalLock(){return this.recvMutex.lock("From P2PChannel2.globalLock")}reportVideoFirstFrameDecoded(t,r,s,a){var c;const u=Array.from(Yc(c=this.remoteUserMap).call(c)).find(h=>h._videoSSRC===t);if(u){a||this.store.subscribe(u.uid,"video",void 0,void 0,void 0,void 0,Date.now());const h=this.store.keyMetrics,m=h.subscribe.find(y=>y.userId===u.uid&&y.type==="video");At.firstRemoteVideoDecode(this.store.sessionId,Zi.FIRST_VIDEO_DECODE,xr.FIRST_VIDEO_DECODE,{peer:u._uintid,videowidth:r,videoheight:s,subscribeElapse:Ws.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId,apEnd:h.requestAPEnd||0,apStart:h.requestAPStart||0,joinGwEnd:h.joinGatewayEnd||0,joinGwStart:h.joinGatewayStart||0,pcEnd:h.peerConnectionEnd||0,pcStart:h.peerConnectionStart||0,subscriberEnd:(m==null?void 0:m.subscribeEnd)||0,subscriberStart:(m==null?void 0:m.subscribeStart)||0,videoAddNotify:(m==null?void 0:m.streamAdded)||0,state:a?1:0})}}async remoteMediaSsrcChanged(t,r,s){if(!this.recvConnection)return!1;const a=this.remoteUserMap.get(t);if(!a)return!1;const c=a.get(r);if(!c)return!1;const u=await this.recvConnection.getRemoteSSRC(c);return u!==void 0&&u!==s}isPreSubScribe(t){return!1}async publishDataChannel(t){throw new Me(te.NOT_SUPPORTED)}async unpublishDataChannel(t){throw new Me(te.NOT_SUPPORTED)}async subscribeDataChannel(t,r){throw new Me(te.NOT_SUPPORTED)}async unsubscribeDataChannel(t,r){throw new Me(te.NOT_SUPPORTED)}hasPendingRemoteDataChannel(t,r){throw new Me(te.NOT_SUPPORTED)}setPendingRemoteDataChannel(t,r){throw new Me(te.NOT_SUPPORTED)}async preConnect(t){throw new Me(te.NOT_SUPPORTED)}getEstablishParams(){throw new Me(te.NOT_SUPPORTED)}async reSubscribe(t){throw new Me(te.NOT_SUPPORTED)}async updateVideoStreamParameter(t,r){throw new Me(te.NOT_SUPPORTED)}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(t=>{let[r,{track:s}]=t;r===Ke.LocalVideoLowTrack?s._updateRtpTransceiver(void 0,Yv.LOW_STREAM):s._updateRtpTransceiver(void 0)})}},wt(Mr.prototype,"p2pConnect",[cK],Object.getOwnPropertyDescriptor(Mr.prototype,"p2pConnect"),Mr.prototype),wt(Mr.prototype,"unpublish",[lK],Object.getOwnPropertyDescriptor(Mr.prototype,"unpublish"),Mr.prototype),wt(Mr.prototype,"unpublishLowStream",[uK],Object.getOwnPropertyDescriptor(Mr.prototype,"unpublishLowStream"),Mr.prototype),wt(Mr.prototype,"subscribe",[dK],Object.getOwnPropertyDescriptor(Mr.prototype,"subscribe"),Mr.prototype),wt(Mr.prototype,"mockSubscribe",[hK],Object.getOwnPropertyDescriptor(Mr.prototype,"mockSubscribe"),Mr.prototype),wt(Mr.prototype,"unsubscribe",[fK],Object.getOwnPropertyDescriptor(Mr.prototype,"unsubscribe"),Mr.prototype),wt(Mr.prototype,"muteRemote",[pK],Object.getOwnPropertyDescriptor(Mr.prototype,"muteRemote"),Mr.prototype),wt(Mr.prototype,"unmuteRemote",[mK],Object.getOwnPropertyDescriptor(Mr.prototype,"unmuteRemote"),Mr.prototype),wt(Mr.prototype,"hasRemoteMediaWithLock",[gK],Object.getOwnPropertyDescriptor(Mr.prototype,"hasRemoteMediaWithLock"),Mr.prototype),wt(Mr.prototype,"disconnectForReconnect",[_K],Object.getOwnPropertyDescriptor(Mr.prototype,"disconnectForReconnect"),Mr.prototype),wt(Mr.prototype,"remoteMediaSsrcChanged",[yK],Object.getOwnPropertyDescriptor(Mr.prototype,"remoteMediaSsrcChanged"),Mr.prototype),Mr);function Ad(t){return function(r,s,a){const c=r[s];if(typeof c!="function")throw new Error("Cannot use mutex on object property.");return a.value=async function(){for(var u=arguments.length,h=new Array(u),m=0;m<u;m++)h[m]=arguments[m];switch(t){case Id.SEND_ONLY:{const y=await this.sendMutex.lock("From P2PChannel2.".concat(s));try{return await c.apply(this,h)}finally{y()}}case Id.RECEIVE_ONLY:{const y=await this.recvMutex.lock("From P2PChannel2.".concat(s));try{return await c.apply(this,h)}finally{y()}}default:{const y=await this.sendMutex.lock("From P2PChannel2.".concat(s)),v=await this.recvMutex.lock("From P2PChannel2.".concat(s));try{return await c.apply(this,h)}finally{y(),v()}}}},a}}class hy extends Fr{constructor(r,s){super(),K(this,"signal",void 0),K(this,"token",void 0),K(this,"tokenTimeout",void 0),K(this,"tokenInterval",void 0),K(this,"_sequence",0),K(this,"userMap",new Map),K(this,"encoder",new TextEncoder),this.signal=r,this.token=s;const a=()=>{this.signal.connectionState===gr.CONNECTED&&this.check(),this.userMap.size===0?this.tokenInterval=window.setTimeout(a,1e3):this.tokenInterval=window.setTimeout(a,3*oe("P2P_TOKEN_INTERVAL"))};a()}async send(r,s,a,c,u){var h,m,y;if(this.userMap.size===0)return;const v=Array.from(Hc(h=this.userMap).call(h))[0].token;typeof s!="string"&&(s=JSON.stringify(s)),c=(m=c)!==null&&m!==void 0?m:fr(6,""),u=(y=u)!==null&&y!==void 0?y:this._sequence++;const S={_id:c,_type:r,_seq:u,_message:s,token:"".concat(this.token,"_").concat(v)};oe("SHOW_P2P_LOG")&&x.debug("send message",S,"noNeedResponse : ".concat(a)),this.splitMessage(JSON.stringify(S)).forEach(P=>{this.signal.request(Gt.DATA_STREAM,{payload:Hm(this.encoder.encode(P))})});const R=new dt((P,D)=>{const G=window.setTimeout(()=>{this.off("res-@".concat(c,"_ack"),F),this.off("res-@".concat(c),Y),this.off(cS.ABORT,j),x.debug("[external-signal] request timeout, type: ".concat(r,", requestId: ").concat(c)),this.userMap.size===0?D(new Me(te.INVALID_REMOTE_USER)):D(new Me(te.TIMEOUT))},oe("EXTERNAL_SIGNAL_REQUEST_TIMEOUT")),F=()=>{G&&window.clearTimeout(G),this.off(cS.ABORT,j),a&&P()},j=()=>{G&&window.clearTimeout(G),this.off("res-@".concat(c,"_ack"),F),this.off("res-@".concat(c),Y),D(new Me(te.EXTERNAL_SIGNAL_ABORT,"type: ".concat(r,", requestId: ").concat(c)))};this.once(cS.ABORT,j),this.once("res-@".concat(c,"_ack"),F);const Y=(fe,Se)=>{ee=!0,G&&window.clearTimeout(G),this.off("res-@".concat(c,"_ack"),F),this.off(cS.ABORT,j),fe==="success"?P(Se):D(new Me(te.P2P_MESSAGE_FAILED,"request ".concat(r," failed, requestId: ").concat(c)))};let ee=!1;a||(this.once("res-@".concat(c),Y),ps(oe("SIGNAL_REQUEST_TIMEOUT")).then(()=>{ee||x.warning("external_signal request timeout, type: ".concat(r,", requestId: ").concat(c,", ").concat(S))}))});try{return await R}catch(P){if(P.code===te.TIMEOUT)return await this.send(r,s,a,c,u);throw P}}onMessage(r){var s;const{_uid:a}=r;let c,u=this.userMap.get(a);if(u)c=u.splitMessageMap;else{if(this.userMap.size>0||!("_type"in r)||r._type!==ui.CHECK)return;const{token:v}=r;c=new Map,u={uid:a,isStart:!0,token:v,splitMessageMap:c,nextExpectedSequenceNumber:0,receivedMessagesMap:new Map},this.userMap.set(a,u),this.signal.emit(wn.ON_USER_ONLINE,{uid:a}),this.handleUserOnline()}if("id"in r&&"total"in r){var h;const{id:v,total:S}=r,R=(h=c.get(v))!==null&&h!==void 0?h:[];if(R.push(r),c.has(v)||c.set(v,R),R.length!==S)return;{const P=pT(R).call(R,(D,G)=>D.index-G.index).map(D=>D.payload).join("");c.delete(v),(r=JSON.parse(P))._uid=a}}const{_type:m,token:y}=r;if(ot(s=[ui.ACK,ui.CHECK]).call(s,m))return m===ui.CHECK&&this.handleCheckToken(u,y),void this.receiveMessage(r);y==="".concat(u.token,"_").concat(this.token)?this.handleReceivedMessage(r):x.debug('Receive unexpected message", '.concat(y,", cur_token: ").concat(u.token,"_").concat(this.token),r)}check(){const r={_id:fr(6,""),token:this.token,_type:ui.CHECK};oe("SHOW_P2P_LOG")&&x.debug("send message",r),this.signal.request(Gt.DATA_STREAM,{payload:Hm(this.encoder.encode(JSON.stringify(r)))})}ack(r){const s={_id:r,_type:ui.ACK,token:this.token};oe("SHOW_P2P_LOG")&&x.debug("send message",s),this.signal.request(Gt.DATA_STREAM,{payload:Hm(this.encoder.encode(JSON.stringify(s)))})}response(r,s,a){this.send(ui.RESPONSE,JSON.stringify({success:!a,message:s}),!0,r)}handleReceivedMessage(r){const s=()=>{this.userMap.forEach(v=>{const{receivedMessagesMap:S,nextExpectedSequenceNumber:R}=v;for(;S.has(R);){const P=S.get(R);S.delete(R),this.receiveMessage(P),v.nextExpectedSequenceNumber++}})};if(!r)return void s();const{_uid:a,_seq:c}=r,u=this.userMap.get(a),{receivedMessagesMap:h,isStart:m,nextExpectedSequenceNumber:y}=u;if(c<y)return this.ack(r._id),void x.debug("[external-signal] receive old message, seq: ".concat(c,", ").concat(r._message));h.set(c,r),m&&c===y&&(this.receiveMessage(r),h.delete(y),u.nextExpectedSequenceNumber++,s())}receiveMessage(r){const{_id:s,_type:a,_message:c,_uid:u}=r;if(oe("SHOW_P2P_LOG")&&x.debug("receive message",r),s){let h;switch(r._type!==ui.ACK&&(c&&(h=JSON.parse(c)),this.ack(r._id)),r._type){case ui.CANDIDATE:case ui.CONTROL:this.signal.emit(a,h,u);break;case ui.PUBLISH:case ui.UNPUBLISH:case ui.RESTART_ICE:case ui.CALL:h.uid=u,ks(this.signal,a,h).then(m=>{this.response(r._id,m)}).catch(()=>{this.response(r._id,void 0,!0)});break;case ui.ACK:this.getListeners("res-@".concat(s,"_ack")).length>0&&this.emit("res-@".concat(s,"_ack"));break;case ui.RESPONSE:{const{success:m,message:y}=h;this.emit("res-@".concat(s),m?"success":"failed",y);break}}}}splitMessage(r){if(r.length<hy.MAX_MESSAGE_SIZE)return[r];const s=[],{remoteToken:a}=JSON.parse(r),c=fr(6,"");let u=0,h=800;const m=Math.ceil(r.length/h);for(;r.length>0;){u++;const y={id:c,index:u,total:m,payload:r.slice(0,h),token:"".concat(this.token,"_").concat(a)};JSON.stringify(y).length>hy.MAX_MESSAGE_SIZE?h-=50:(s.push(y),r=r.slice(h))}return s.map(y=>JSON.stringify(y))}handleCheckToken(r,s){return r.token!==s?(x.debug("token changed, from ".concat(r.token," to ").concat(s)),this.reset(r.uid,s),!1):(this.tokenTimeout&&(window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0),this.tokenTimeout=window.setTimeout(()=>{x.debug("token timeout, ".concat(s)),this.reset(r.uid)},oe("MAX_P2P_TIMEOUT")),!0)}async handleUserOnline(){const r=await ks(this.signal,ui.CALL,void 0),s=await this.send(ui.CALL,r);this.signal.emit(Ht.P2P_CONNECTION,s,!0)}async reset(r,s){const a=this.userMap.get(r);a&&(this.emit(cS.ABORT),this.signal.emit(wn.ON_USER_OFFLINE,{uid:a.uid,reason:mge.P2P_TOKEN_CHANGED}),this._sequence=0,this.userMap.clear(),s||(x.debug("change local token from ".concat(s," to ").concat(s)),this.token=fr(6,"")))}clear(){this._sequence=0,this.userMap.clear(),this.tokenInterval&&window.clearTimeout(this.tokenInterval),this.tokenInterval=void 0,this.tokenTimeout&&window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0,this.emit(cS.ABORT)}}K(hy,"MAX_SIZE",1),K(hy,"MAX_MESSAGE_SIZE",1024);class Jye extends Fr{get connectionState(){return this._connectionState}set connectionState(r){r!==this._connectionState&&(this._connectionState=r,r===gr.CONNECTED?this.emit(Ht.WS_CONNECTED):r===gr.RECONNECTING?this.emit(Ht.WS_RECONNECTING,this._websocketReconnectReason):r===gr.CLOSED&&this.emit(Ht.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(r,s){super(),K(this,"_disconnectedReason",void 0),K(this,"_websocketReconnectReason",void 0),K(this,"_connectionState",gr.CLOSED),K(this,"reconnectToken",void 0),K(this,"p2pToken",void 0),K(this,"websocket",void 0),K(this,"openConnectionTime",void 0),K(this,"clientId",void 0),K(this,"lastMsgTime",Date.now()),K(this,"uploadCache",[]),K(this,"uploadCacheInterval",void 0),K(this,"rttRolling",new Y8(5)),K(this,"pingpongTimer",void 0),K(this,"pingpongTimeoutCount",0),K(this,"joinResponse",void 0),K(this,"multiIpOption",void 0),K(this,"initError",void 0),K(this,"spec",void 0),K(this,"store",void 0),K(this,"_external_signal",void 0),K(this,"onWebsocketMessage",a=>{if(a.data instanceof ArrayBuffer)return void this.emit(Ht.ON_BINARY_DATA,a.data);const c=JSON.parse(a.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(c,"_id")){const u="res-@".concat(c._id);this.emit(u,c._result,c._message)}else if(Object.prototype.hasOwnProperty.call(c,"_type")){switch(c._type){case wn.ON_DATA_STREAM:return void this.handleDataStream(c._message);case wn.MUTE_AUDIO:case wn.MUTE_VIDEO:case wn.ON_P2P_LOST:case wn.ON_USER_ONLINE:return;case wn.ON_USER_OFFLINE:const{uid:u}=c._message;return x.debug("[".concat(this.clientId,"] user-offline uid: ").concat(u)),void this._external_signal.reset(u)}if(this.emit(c._type,c._message),c._type===wn.ON_NOTIFICATION&&this.handleNotification(c._message),c._type===wn.ON_USER_BANNED)switch(c._message.error_code){case 14:this.close(qn.UID_BANNED);break;case 15:this.close(qn.IP_BANNED);break;case 16:this.close(qn.CHANNEL_BANNED)}if(c._type===wn.ON_USER_LICENSE_BANNED)switch(c._message.error_code){case Mt.ERR_LICENSE_MISSING:this.close(qn.LICENSE_MISSING);break;case Mt.ERR_LICENSE_EXPIRED:this.close(qn.LICENSE_EXPIRED);break;case Mt.ERR_LICENSE_MINUTES_EXCEEDED:this.close(qn.LICENSE_MINUTES_EXCEEDED);break;case Mt.ERR_LICENSE_PERIOD_INVALID:this.close(qn.LICENSE_PERIOD_INVALID);break;case Mt.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(qn.LICENSE_MULTIPLE_SDK_SERVICE);break;case Mt.ERR_LICENSE_ILLEGAL:this.close(qn.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=r.clientId,this.spec=r,this.store=s,this.websocket=new f2("gateway-".concat(this.clientId),this.spec.retryConfig,!0,oe("JOIN_GATEWAY_USE_DUAL_DOMAIN"),oe("JOIN_GATEWAY_USE_443PORT_ONLY"),s),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===gr.CONNECTED&&this.reconnect("retry",Os.OFFLINE)}),this.p2pToken=fr(6,""),this._external_signal=new hy(this,this.p2pToken)}async request(r,s,a,c){const u=fr(6,""),h={_id:u,_type:r,_message:s},m=this.websocket.connectionID,y=()=>new dt((G,F)=>{if(this.connectionState===gr.CONNECTED)return G();const j=()=>{this.off(Ht.WS_CLOSED,Y),G()},Y=()=>{this.off(Ht.WS_CONNECTED,j),F(new Me(te.WS_ABORT))};this.once(Ht.WS_CONNECTED,j),this.once(Ht.WS_CLOSED,Y)});if(this.connectionState!==gr.CONNECTING&&this.connectionState!==gr.RECONNECTING||r===Gt.JOIN||r===Gt.REJOIN||await y(),this.websocket.sendMessage(h,!0),c)return;const v=new dt((G,F)=>{let j=!1;const Y=(fe,Se)=>{j=!0,G({isSuccess:fe==="success",message:Se||{}}),this.off(Ht.WS_CLOSED,ee),this.off(Ht.WS_RECONNECTING,ee),this.emit(Ht.REQUEST_SUCCESS,r,s)};this.once("res-@".concat(u),Y);const ee=()=>{F(new Me(te.WS_ABORT,"type: ".concat(r))),this.off(Ht.WS_CLOSED,ee),this.off(Ht.WS_RECONNECTING,ee),this.off("res-@".concat(u),Y)};this.once(Ht.WS_CLOSED,ee),this.once(Ht.WS_RECONNECTING,ee),ps(oe("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==m||j||(x.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(r)),this.emit(Ht.REQUEST_TIMEOUT,r,s))})});let S=null;try{S=await v}catch(G){if(this.connectionState===gr.CLOSED||r===Gt.LEAVE)throw new Me(te.WS_ABORT);return!this.spec.forceWaitGatewayResponse||a?G.throw():r===Gt.JOIN||r===Gt.REJOIN?null:(await y(),await this.request(r,s))}if(S.isSuccess)return S.message;const R=Number(S.message.error_code||S.message.code),P=jT(R),D=new Me(te.UNEXPECTED_RESPONSE,"".concat(P.desc,": ").concat(S.message.error_str),{code:R,data:S.message,desc:P.desc});return P.action==="success"?S.message:(x.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(r,", error_code: ").concat(R,", message: ").concat(P.desc,", action: ").concat(P.action)),R===Mt.ERR_TOO_MANY_BROADCASTERS?((r===Gt.JOIN||r===Gt.REJOIN)&&(this.initError=D,this.close()),D.throw()):P.action==="failed"?D.throw():P.action==="quit"?(this.initError=D,this.close(),D.throw()):(R===Mt.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=S.message.option,x.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",Os.MULTI_IP)):this.reconnect(P.action,Os.SERVER_ERROR),r===Gt.JOIN||r===Gt.REJOIN?null:await this.request(r,s)))}waitMessage(r,s){return new dt(a=>{const c=u=>{(!s||s(u))&&(this.off(r,c),a(u))};this.on(r,c)})}uploadWRTCStats(r){if(!this.store.sessionId)return void x.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const s={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:r};this.upload(VT.WRTC_STATS,s)}upload(r,s){const a={_type:r,_message:s};try{this.websocket.sendMessage(a)}catch{const u=oe("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(a),this.uploadCache.length>u&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==gr.CONNECTED)return;const h=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(h._type,h._message)},oe("UPLOAD_CACHE_INTERVAL")||2e3))}}send(r,s){const a={_type:r,_message:s};this.websocket.sendMessage(a)}async sendExtensionMessage(r,s,a){return await this._external_signal.send(r,s,a)}init(r){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new dt((s,a)=>{this.once(Ht.WS_CONNECTED,()=>s(this.joinResponse)),this.once(Ht.WS_CLOSED,()=>a(this.initError||new Me(te.WS_ABORT))),this.connectionState=gr.CONNECTING,this.websocket.init(r).catch(a)})}close(r){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._external_signal.clear(),this._disconnectedReason=r||qn.LEAVE,this.connectionState=gr.CLOSED,x.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close(),this.p2pToken=fr(6,""),this._external_signal.clear(),this._external_signal=new hy(this,this.p2pToken)}async join(){if(!this.joinResponse){this.emit(Ht.ABORT_P2P_EXECUTION);const r=await ks(this,Ht.REQUEST_JOIN_INFO),s=await this.request(Gt.JOIN,r);if(!s)return this.emit(Ht.REPORT_JOIN_GATEWAY,te.TIMEOUT,this.url||""),!1;this.joinResponse=s,this.emit(Ht.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=gr.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}reconnect(r,s){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(r,s)}handleDataStream(r){try{var s;const a=W_(r.payload),c=new TextDecoder().decode(a),u=JSON.parse(c);"total"in u&&"id"in u||ot(s=Object.values(ui)).call(s,u._type)?(u._uid=r.uid,this._external_signal.onMessage(u)):this.emit(wn.ON_DATA_STREAM,r)}catch{this.emit(wn.ON_DATA_STREAM,r)}}handleNotification(r){x.debug("[".concat(this.clientId,"] receive notification: "),r);const s=jT(r.code);if(s.action!=="success"){if(s.action!=="failed")return s.action==="quit"?(s.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(qn.UID_BANNED),void this.close()):void this.reconnect(s.action,Os.SERVER_ERROR);x.error("[".concat(this.clientId,"] ignore error: "),s.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const r=oe("PING_PONG_TIME_OUT"),s=Date.now();this.pingpongTimeoutCount>=r&&(x.warning("[".concat(this.clientId,"] PINGPONG Timeout. Last Socket Message: ").concat(s-this.lastMsgTime,"ms")),s-this.lastMsgTime>oe("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",Os.TIMEOUT):this.request(Gt.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const a=Date.now()-s;this.rttRolling.add(a),oe("REPORT_STATS")&&this.send(Gt.PING_BACK,{pingpongElapse:a})}).catch(a=>{})}handleWebsocketEvents(){this.websocket.on(Zt.RECONNECT_CREATE_CONNECTION,r=>{this.emit(Ht.WS_RECONNECT_CREATE_CONNECTION,r)}),this.websocket.on(Zt.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(Zt.CLOSED,()=>{this.connectionState=gr.CLOSED}),this.websocket.on(Zt.FAILED,()=>{this._disconnectedReason=qn.NETWORK_ERROR,this.connectionState=gr.CLOSED}),this.websocket.on(Zt.RECONNECTING,r=>{this._websocketReconnectReason=r,this.joinResponse=void 0,this.connectionState===gr.CONNECTED?this.connectionState=gr.RECONNECTING:this.connectionState=gr.CONNECTING}),this.websocket.on(Zt.WILL_RECONNECT,(r,s,a)=>{r!=="retry"?(x.debug("".concat(this.clientId," websocket will_connect event, renewSession reconnectMode is ").concat(r)),this.reconnectToken=void 0):x.debug("".concat(this.clientId," reconnect mode is retry, no need to renew session")),a(r)}),this.websocket.on(Zt.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.join().catch(r=>{if(this.emit(Ht.REPORT_JOIN_GATEWAY,r,this.url||""),r instanceof Me&&r.code===te.UNEXPECTED_RESPONSE&&r.data.code===Mt.ERR_NO_AUTHORIZED)return x.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",Os.SERVER_ERROR);x.error("[".concat(this.clientId,"] join gateway request failed"),r.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",Os.SERVER_ERROR):(this.initError=r,this.close())})}),this.websocket.on(Zt.REQUEST_NEW_URLS,(r,s)=>{ks(this,Ht.REQUEST_RECOVER,this.multiIpOption).then(r).catch(s)}),this.websocket.on(Zt.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(wn.ON_TOKEN_PRIVILEGE_DID_EXPIRE)})}}const Qye={name:"P2PChannel",create:function(t){let{store:r,statsCollector:s}=t;return new Xye(r,s)},createSubmodule:function(t){let{store:r,spec:s}=t;return new Jye(s,r)}};function vK(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}function SK(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?vK(Object(s),!0).forEach(function(a){K(t,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):vK(Object(s)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))})}return t}class Zye{constructor(r){K(this,"sessionDesc",void 0),K(this,"localCapabilities",void 0),K(this,"rtpCapabilities",void 0),K(this,"candidates",void 0),K(this,"_originCandidates",void 0),K(this,"iceParameters",void 0),K(this,"dtlsParameters",void 0),K(this,"setup",void 0),K(this,"currentMidIndex",void 0),K(this,"cname",void 0),r=$r(r);const{iceParameters:s,dtlsParameters:a,candidates:c,rtpCapabilities:u,setup:h,localCapabilities:m,sdkCodec:y,cname:v}=r,S=Wa(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE audio video
a=msid-semantic: WMS
a=ice-lite
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:audio
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:video
`);this.rtpCapabilities=u,this.candidates=c,this._originCandidates=$r(c),this.iceParameters=s,this.dtlsParameters=a,this.setup=h,this.localCapabilities=m,this.cname=v;for(let R=0;R<S.mediaDescriptions.length;R++){const P=S.mediaDescriptions[R];if(P.attributes.iceUfrag=s.iceUfrag,P.attributes.icePwd=s.icePwd,P.attributes.fingerprints=a.fingerprints,P.attributes.candidates=c,P.attributes.setup=h,P.media.mediaType==="video"){P.media.fmts=u.videoCodecs.map(G=>G.payloadType.toString(10));let D=u.videoCodecs.filter(G=>{var F,j;return(F=G.rtpMap)===null||F===void 0?void 0:ot(j=F.encodingName.toLowerCase()).call(j,y)});D.length===0&&(D=u.videoCodecs),P.attributes.payloads=D,P.attributes.extmaps=u.videoExtensions}P.media.mediaType==="audio"&&(P.media.fmts=u.audioCodecs.map(D=>D.payloadType.toString(10)),P.attributes.payloads=u.audioCodecs,P.attributes.extmaps=u.audioExtensions),S.mediaDescriptions[R]=this.mungMediaDesc(P)}this.sessionDesc=S,this.currentMidIndex=S.mediaDescriptions.length-1}toString(){return $m(this.sessionDesc)}send(r,s,a){const{ssrcs:c,ssrcGroups:u}=Q_(s,this.cname),h=this.sessionDesc.mediaDescriptions.find(v=>r===Et.VIDEO?v.media.mediaType==="video":v.media.mediaType==="audio"),m=c[0].attributes.label,y=c[0].attributes.mslabel;return h.attributes.ssrcs=h.attributes.ssrcs.concat(c),h.attributes.ssrcGroups=h.attributes.ssrcGroups.concat(u),{id:m,mslabel:y}}batchSend(r){return r.map(s=>{let{kind:a,ssrcMsg:c}=s;return this.send(a,c,void 0)})}stopSending(r){this.sessionDesc.mediaDescriptions.forEach(s=>{const a=[],c=[],u=[];s.attributes.ssrcs.forEach(h=>{ot(r).call(r,h.attributes.label||"")?u.push(h):a.push(h)}),s.attributes.ssrcGroups.forEach(h=>{var m;ot(m=u.map(y=>y.ssrcId)).call(m,h.ssrcIds[0])||c.push(h)}),s.attributes.ssrcs=a,s.attributes.ssrcGroups=c})}mute(r){const s=this.sessionDesc.mediaDescriptions.find(a=>a.attributes.mid===r);if(!s)throw new Error("mediaDescription not found with ".concat(r," in remote SDP when calling RemoteSDP.mute."));s.attributes.direction="inactive"}unmute(r){const s=this.sessionDesc.mediaDescriptions.find(a=>a.attributes.mid===r);if(!s)throw new Error("mediaDescription not found with ".concat(r," in remote SDP when calling RemoteSDP.unmute."));s.attributes.direction="sendonly"}receive(r,s,a){r.forEach((c,u)=>{const h=c._mediaStreamTrack,m=this.sessionDesc.mediaDescriptions.findIndex(v=>v.attributes.mid===h.kind),y=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[m],c);this.sessionDesc.mediaDescriptions[m]=y})}stopReceiving(r){}updateCandidates(r){const s=this._originCandidates.filter(c=>c.transport==="udp"),a=[];if(s.forEach(c=>{a.push(SK(SK({},c),{},{foundation:"tcpcandidate",priority:Number(c.priority)-1+"",transport:"tcp",port:Number(c.port)+90+""}))}),s.length!==0){switch(r){case Bs.TCP_RELAY:this.candidates=a;break;case Bs.UDP_TCP_RELAY:case Bs.RELAY:this.candidates=[...s,...a];break;default:this.candidates=s}for(const c of this.sessionDesc.mediaDescriptions)c.attributes.candidates=this.candidates}}restartICE(r){r=$r(r),this.iceParameters=r,this.sessionDesc.mediaDescriptions.forEach(s=>{s.attributes.iceUfrag=r.iceUfrag,s.attributes.icePwd=r.icePwd})}predictReceivingMids(r){const s=[];for(let a=0;a<r;a++)s.push((this.currentMidIndex+a+1).toString(10));return s}mungRecvMediaDsec(r,s){const a=$r(r);return dS(a,s),_2(a,s),a}updateRecvMedia(r,s){const a=this.sessionDesc.mediaDescriptions.findIndex(c=>c.attributes.mid===r);if(a!==-1){const c=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[a],s);this.sessionDesc.mediaDescriptions[a]=c}}bumpMid(r){this.currentMidIndex+=r}updateTrackLabel(r,s,a){const c=this.sessionDesc.mediaDescriptions.find(h=>r===Et.VIDEO?h.attributes.mid==="video":h.attributes.mid==="audio");if(c){const h=c.attributes.ssrcs.find(m=>m.attributes.label===s);var u;h&&(h.attributes.label=a,(u=h.attributes.msid)===null||u===void 0||u.replace(s,a))}}mungMediaDesc(r){const s=$r(r);return g2(s),function(a){const c=a.attributes.extmaps.find(u=>PP(u.extensionName));c&&a.attributes.extmaps.splice(a.attributes.extmaps.indexOf(c),1),a.attributes.payloads.forEach(u=>{const h=u.rtcpFeedbacks.findIndex(m=>m.type==="transport-cc");h!==-1&&u.rtcpFeedbacks.splice(h,1)})}(s),s}getSSRC(r){for(const s of this.sessionDesc.mediaDescriptions)for(const a of s.attributes.ssrcs)if(a.attributes.label===r)return[a]}}var lr;function bK(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,a)}return s}function pO(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?bK(Object(s),!0).forEach(function(a){K(t,a,s[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):bK(Object(s)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))})}return t}let eEe=(lr=class rC extends kH{get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.videoCodecs.map(r=>r.rtpMap&&r.rtpMap.encodingName.toLowerCase()||"").filter(r=>{var s;return ot(s=Object.keys(iP)).call(s,r)}))]}constructor(r,s){super(r,s),K(this,"store",void 0),K(this,"peerConnection",void 0),K(this,"remoteSDP",void 0),K(this,"initialOffer",void 0),K(this,"statsFilter",void 0),K(this,"useRTX",!1),K(this,"localCapabilities",void 0),K(this,"localCandidateCount",0),K(this,"allCandidatesReceived",!1),K(this,"establishPromise",void 0),K(this,"mutex",void 0),this.store=s,this.mutex=new Fs("P2PConnection-mutex",s.clientId),this.peerConnection=new RTCPeerConnection(rC.resolvePCConfiguration(r),{optional:[{googDscp:!0}]}),this.statsFilter=OL(this.peerConnection,oe("STATS_UPDATE_INTERVAL"),void 0,zr()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async establish(){try{const r=await this.peerConnection.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});if(!r.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const s=Jm(r.sdp),a=zT(r.sdp,{filterRTX:!this.useRTX,filterVideoFec:oe("FILTER_VIDEO_FEC"),filterAudioFec:oe("FILTER_AUDIO_FEC"),filterAudioCodec:["opus"]});return this.localCapabilities=a,this.initialOffer=r,pO(pO({},s),{},{rtpCapabilities:{send:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},recv:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},sendrecv:a},offerSDP:r.sdp})}catch(r){throw new Me(te.GET_LOCAL_CONNECTION_PARAMS_FAILED,r.toString())}}async updateRemoteConnect(){}async connect(r){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.remoteSDP=new Zye(pO(pO({},r),{},{rtpCapabilities:r.rtpCapabilities.send,localCapabilities:this.localCapabilities,sdkCodec:this.store.codec}));const s=this.remoteSDP.toString();await this.peerConnection.setLocalDescription(this.initialOffer),await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}catch(s){throw new Me(te.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(s.toString()))}}async updateRemoteRTPCapabilities(r,s){throw new Me(te.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}getPreMedia(r){}send(r,s){var a=this;return Il(function*(){const c=yield Nn(a.mutex.lock());try{if(!a.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const u=r.map(P=>a.peerConnection.addTrack(P._mediaStreamTrack)),h=yield Nn(a.peerConnection.createOffer()),m=Wa(h.sdp),y=r.map(P=>{const D=P._mediaStreamTrack,G=m.mediaDescriptions.find(F=>F.attributes.mid===D.kind);if(!G)throw new Error("Cannot extract ssrc from mediaDescription.");return function(F,j,Y){const ee=F.attributes.ssrcs.filter(Se=>Se.attributes.label===j),fe=F.attributes.ssrcGroups;if(ee.length===0)throw new Error("Cannot extract ssrc from plan-b SDP.");if(fe&&ee.length>1){const Se=fe.find(we=>we.ssrcIds.indexOf(ee[0].ssrcId)!==-1);return Se?[{ssrcId:Se.ssrcIds[0],rtx:Y?Se.ssrcIds[1]:void 0}]:[{ssrcId:ee[0].ssrcId}]}return[{ssrcId:ee[0].ssrcId}]}(G,D.id,a.useRTX)});let v;try{v=yield y}catch(P){throw u.forEach(D=>{Ps()&&D.replaceTrack(null),a.peerConnection.removeTrack(D)}),P}const S=a.mungSendOfferSDP(h.sdp,r);a.remoteSDP.receive(r,s,v);const R=a.remoteSDP.toString();return yield Nn(a.peerConnection.setLocalDescription({type:"offer",sdp:S})),yield Nn(a.applySendEncodings(u,r)),yield Nn(a.peerConnection.setRemoteDescription({type:"answer",sdp:R})),r.map((P,D)=>{const G=P._mediaStreamTrack.id;return{localSSRC:y[D],id:G}})}catch(u){throw new Me(te.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(u.toString()))}finally{c()}})()}async stopSending(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const s=this.peerConnection.getSenders().filter(u=>{var h;return r.indexOf(((h=u.track)===null||h===void 0?void 0:h.id)||"")!==-1});if(s.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");s.map(u=>{Ps()&&u.replaceTrack(null),this.peerConnection.removeTrack(u)});const a=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(a),this.remoteSDP.stopReceiving(r);const c=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:c})}catch(s){throw new Me(te.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(s.toString()))}}async receive(r,s,a,c){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(r," before remoteSDP created."));const{id:u,mslabel:h}=this.remoteSDP.send(r,s,c),m=new dt((S,R)=>{const P=setTimeout(()=>{R(new Error("Cannot receive track, id: ".concat(u)))},1e4),D=G=>{const F=Dn();if((F.name==="Safari"&&Number(F.version)===11||Vo())&&G.track.id!==u&&G.streams[0].id===h){var j;const Y=G.streams[0].getTracks()[0];return(j=this.remoteSDP)===null||j===void 0||j.updateTrackLabel(r,u,G.track.id),this.peerConnection.removeEventListener("track",D),clearTimeout(P),void S(Y)}if(G.track.id===u)return this.peerConnection.removeEventListener("track",D),clearTimeout(P),void S(G.track)};this.peerConnection.addEventListener("track",D)}),y=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:y});const v=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(v),{track:await m,id:u}}catch(u){throw new Me(te.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(u.toString()))}}async stopReceiving(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(r);const s=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:s});const a=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(a)}catch(s){throw new Me(te.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(s.toString()))}}async muteRemote(r){}async unmuteRemote(r){}async muteLocal(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const s=this.peerConnection.getSenders().filter(a=>{var c;return r.indexOf(((c=a.track)===null||c===void 0?void 0:c.id)||"")!==-1});if(s.length!==r.length)throw new Error("sender' length doesn't match mids' length.");s.map(a=>{if(Ps()&&a.track)a.track.enabled=!1;else{const c=a.getParameters();c.encodings.forEach(u=>u.active=!1),a.setParameters(c)}})}catch(s){throw new Me(te.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(s.toString()))}}async unmuteLocal(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const s=this.peerConnection.getSenders().filter(u=>{var h;return r.indexOf(((h=u.track)===null||h===void 0?void 0:h.id)||"")!==-1});if(s.length!==r.length)throw new Error("Senders' length doesn't match mids' length.");s.map(async u=>{if(Ps()&&u.track)u.track.enabled=!0;else{const h=u.getParameters();h.encodings.forEach(m=>m.active=!0),await u.setParameters(h)}});const a=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(a);const c=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:c})}catch(s){throw new Me(te.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(s.toString()))}}restartICE(r){var s=this;return Il(function*(){const a=yield Nn(s.mutex.lock("From P2PConnection.restartICE"));try{if(!s.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");const c=jn().supportPCSetConfiguration;if(r===Bs.RELAY&&!c)return;if(c){const v=s.peerConnection.getConfiguration(),S=r===Bs.RELAY?"relay":"all";v.iceTransportPolicy!==S&&(x.debug("[".concat(s.store.clientId,"] restartICE change iceTransportPolicy from [").concat(v.iceTransportPolicy,"] to [").concat(S,"]")),v.iceTransportPolicy=S,s.peerConnection.setConfiguration(v))}r!==Bs.RELAY&&s.remoteSDP.updateCandidates(r);const u=yield Nn(s.peerConnection.createOffer({iceRestart:!0}));if(!u.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const h=Jm(u.sdp),{remoteIceParameters:m}=yield h.iceParameters;s.remoteSDP.restartICE(m);const y=s.remoteSDP.toString();yield Nn(s.peerConnection.setLocalDescription(u)),yield Nn(s.peerConnection.setRemoteDescription({type:"answer",sdp:y}))}catch(c){x.warning("[".concat(s.store.clientId,"] restart ICE failed, abort operation"),c)}finally{a()}})()}close(){var r;this.peerConnection.close(),(r=this.onConnectionStateChange)===null||r===void 0||r.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(r){return this.statsFilter.getVideoIsReady(r)}async updateEncoderConfig(r,s){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const a=await this.peerConnection.createOffer(),c=this.mungSendOfferSDP(a.sdp,[s]);this.remoteSDP.updateRecvMedia(s._mediaStreamTrack.kind,s);const u=this.remoteSDP.toString();await this.peerConnection.setLocalDescription({type:"offer",sdp:c}),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(a){throw new Me(te.EXCHANGE_SDP_FAILED,a.toString())}}async updateSendParameters(r,s){const a=this.peerConnection.getSenders().filter(c=>{var u;return((u=c.track)===null||u===void 0?void 0:u.id)===r});a.length===1&&await this.applySendEncodings(a,[s])}setStatsRemoteVideoIsReady(r,s){this.statsFilter.setVideoIsReady2(r,s)}async replaceTrack(r,s){const a=this.peerConnection.getSenders().find(c=>{var u;return((u=c.track)===null||u===void 0?void 0:u.id)===s});a&&await a.replaceTrack(r._mediaStreamTrack)}createDataChannels(r,s){throw new Me(te.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}stopDataChannels(r){throw new Me(te.NOT_SUPPORTED,"Planb mode does not support stopDataChannels.")}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var r;(r=this.onICEConnectionStateChange)===null||r===void 0||r.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var r;(r=this.onConnectionStateChange)===null||r===void 0||r.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=r=>{r.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,x.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,x.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},oe("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(r){const s={iceServers:[],sdpSemantics:"plan-b"};return r.iceServers?s.iceServers=r.iceServers:r.turnServer&&r.turnServer.mode!=="off"&&(OT(r.turnServer.servers)?s.iceServers=r.turnServer.servers:(s.iceServers&&s.iceServers.push(...rC.turnServerConfigToIceServers(r.turnServer.servers)),oe("USE_TURN_SERVER_OF_GATEWAY")&&s.iceServers&&r.turnServer.serversFromGateway&&s.iceServers.push(...rC.turnServerConfigToIceServers(r.turnServer.serversFromGateway)),r.turnServer.servers.concat(r.turnServer.serversFromGateway||[]).forEach(a=>{a.forceturn&&(s.iceTransportPolicy="relay")}))),s}static turnServerConfigToIceServers(r){const s=[];return r.forEach(a=>{a.security?a.tcpport&&s.push({username:a.username,credential:a.password,credentialType:"password",urls:"turns:".concat(a.turnServerURL,":").concat(a.tcpport,"?transport=tcp")}):(a.udpport&&s.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":").concat(a.udpport,"?transport=udp")}),a.tcpport&&s.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":").concat(a.tcpport,"?transport=tcp")}))}),s}async updateRtpSenderEncodings(r,s){var a;if(s||(s=this.peerConnection.getSenders().find(v=>{var S;return((S=v.track)===null||S===void 0?void 0:S.id)===r._mediaStreamTrack.id})),!s)return x.warn("[".concat(r.getTrackId(),"] no rtpSender found}"));if(!jn().supportSetRtpSenderParameters)return x.warn("Browser not support set rtp-sender parameters");const c={},u={};if(r instanceof Tr)switch(r._optimizationMode){case"motion":c.degradationPreference="maintain-framerate";break;case"detail":c.degradationPreference="maintain-resolution";break;default:c.degradationPreference="balanced"}if(oe("DSCP_TYPE")&&ip()){var h;const v=oe("DSCP_TYPE");ot(h=["very-low","low","medium","high"]).call(h,v)&&(u.networkPriority=v)}const m=s.getParameters(),y=(a=m.encodings)===null||a===void 0?void 0:a[0];y&&Object.assign(y,u),Object.assign(m,c),x.debug("[".concat(r.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(m.encodings))),await s.setParameters(m)}async applySendEncodings(r,s){try{if(!jn().supportSetRtpSenderParameters||r.length!==s.length)return;for(let a=0;a<r.length;a++){const c=r[a],u=s[a];c&&u&&await this.updateRtpSenderEncodings(u,c)}}catch{x.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(r,s){const a=Wa(r);return s.forEach((c,u)=>{const h=c._mediaStreamTrack,m=a.mediaDescriptions.find(y=>y.attributes.mid===h.kind);m&&dS(m,c)}),$m(a)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=r=>{var s;(s=this.onFirstAudioReceived)===null||s===void 0||s.call(this,r)},this.statsFilter.onFirstVideoReceived=r=>{var s;(s=this.onFirstVideoReceived)===null||s===void 0||s.call(this,r)},this.statsFilter.onFirstAudioDecoded=r=>{var s;(s=this.onFirstAudioDecoded)===null||s===void 0||s.call(this,r)},this.statsFilter.onFirstVideoDecoded=(r,s,a)=>{var c;(c=this.onFirstVideoDecoded)===null||c===void 0||c.call(this,r,s,a)},this.statsFilter.onSelectedLocalCandidateChanged=(r,s)=>{var a;(a=this.onSelectedLocalCandidateChanged)===null||a===void 0||a.call(this,r,s)},this.statsFilter.onSelectedRemoteCandidateChanged=(r,s)=>{var a;(a=this.onSelectedRemoteCandidateChanged)===null||a===void 0||a.call(this,r,s)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0}async batchReceive(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const s=this.remoteSDP.batchSend(r).map((u,h)=>{let{id:m,mslabel:y}=u;const{kind:v}=r[h];return new dt((S,R)=>{const P=setTimeout(()=>{R(new Error("Cannot receive track, id: ".concat(m)))},1e4),D=G=>{const F=Dn();if(F.name==="Safari"&&Number(F.version)===11&&G.track.id!==m&&G.streams[0].id===y){var j;const Y=G.streams[0].getTracks()[0];return(j=this.remoteSDP)===null||j===void 0||j.updateTrackLabel(v,m,G.track.id),this.peerConnection.removeEventListener("track",D),clearTimeout(P),void S({track:Y,id:m})}if(G.track.id===m)return this.peerConnection.removeEventListener("track",D),clearTimeout(P),void S({track:G.track,id:m})};this.peerConnection.addEventListener("track",D)})}),a=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:a});const c=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(c),await dt.all(s)}catch(s){throw new Me(te.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(s.toString()))}}async getRemoteSSRC(r){if(!this.remoteSDP)return;const s=this.remoteSDP.getSSRC(r);return s==null?void 0:s[0].ssrcId}setConfiguration(r){if(jn().supportPCSetConfiguration){const s=rC.resolvePCConfiguration(r);this.peerConnection.setConfiguration(s)}}},wt(lr.prototype,"connect",[Ll],Object.getOwnPropertyDescriptor(lr.prototype,"connect"),lr.prototype),wt(lr.prototype,"stopSending",[Ll],Object.getOwnPropertyDescriptor(lr.prototype,"stopSending"),lr.prototype),wt(lr.prototype,"receive",[Ll],Object.getOwnPropertyDescriptor(lr.prototype,"receive"),lr.prototype),wt(lr.prototype,"stopReceiving",[Ll],Object.getOwnPropertyDescriptor(lr.prototype,"stopReceiving"),lr.prototype),wt(lr.prototype,"muteRemote",[Ll],Object.getOwnPropertyDescriptor(lr.prototype,"muteRemote"),lr.prototype),wt(lr.prototype,"unmuteRemote",[Ll],Object.getOwnPropertyDescriptor(lr.prototype,"unmuteRemote"),lr.prototype),wt(lr.prototype,"muteLocal",[Ll],Object.getOwnPropertyDescriptor(lr.prototype,"muteLocal"),lr.prototype),wt(lr.prototype,"unmuteLocal",[Ll],Object.getOwnPropertyDescriptor(lr.prototype,"unmuteLocal"),lr.prototype),wt(lr.prototype,"close",[Ll],Object.getOwnPropertyDescriptor(lr.prototype,"close"),lr.prototype),wt(lr.prototype,"updateEncoderConfig",[Ll],Object.getOwnPropertyDescriptor(lr.prototype,"updateEncoderConfig"),lr.prototype),wt(lr.prototype,"updateSendParameters",[Ll],Object.getOwnPropertyDescriptor(lr.prototype,"updateSendParameters"),lr.prototype),wt(lr.prototype,"replaceTrack",[Ll],Object.getOwnPropertyDescriptor(lr.prototype,"replaceTrack"),lr.prototype),wt(lr.prototype,"getRemoteSSRC",[Ll],Object.getOwnPropertyDescriptor(lr.prototype,"getRemoteSSRC"),lr.prototype),lr);function Ll(t,r,s){const a=t[r];if(typeof a!="function")throw new Error("Cannot use mutex on object property.");return s.value=async function(){const c=this.mutex,u=await c.lock("Locking from P2PConnection.".concat(r));try{for(var h=arguments.length,m=new Array(h),y=0;y<h;y++)m[y]=arguments[y];return await a.apply(this,m)}finally{u()}},s}const tEe={name:"PlanBConnection",create:function(t){let{store:r,spec:s}=t;return new eEe(s,r)}},nEe={interceptLocalAudioFrame:async function(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!jn().supportWebRTCEncodedTransform)return void x.warning("browser not support audio encoded transform");if(fP.has(t)||!t.track)return;const s={track:t.track};if(rp()){if(!t.createEncodedStreams)return void x.warning("browser not support createEncodedStreams() API");let c=null;try{c=t.createEncodedStreams()}catch(h){return void x.error("create audio-encoded-streams error",h&&h.message)}const u=new TransformStream({transform(h,m){s.controller||(s.controller=m),t.track&&t.track.id!==s.track.id&&(x.debug("audio track changed: ".concat(s.track.id," => ").concat(t.track.id)),s.track.removeEventListener("ended",a),s.track=t.track,s.track.addEventListener("ended",a));const y=r.metadata&&r.metadata();y?function(v,S){const{chunk:R,controller:P}=S,D=oe("ENABLE_AUDIO_PTS_METADATA")?cp.AUDIO_64_BIT_PTS:cp.METADATA;R.data=function(G,F,j){const Y=j.byteLength,ee=Y+e2+mH,fe=QL+ZL+ee,Se=new ArrayBuffer(G.byteLength+fe),we=new DataView(Se);we.setUint8(0,pH),we.setUint16(1,ee),we.setUint8(3,F),we.setUint16(4,Y);for(let Ne=0;Ne<Y;Ne++)we.setUint8(6+Ne,j[Ne]);const ye=new Uint8Array(we.buffer);return ye.set(new Uint8Array(G),fe),ye.buffer}(R.data,D,v),P.enqueue(R)}(y,{chunk:h,controller:m}):m.enqueue(h)}});c.readable.pipeThrough(u).pipeTo(c.writable)}else if(Ps()){if(typeof RTCRtpScriptTransform>"u")return void x.warning("browser not support RTCRtpScriptTransform");const c=hP(),u=new MessageChannel;await new dt(m=>c.onmessage=y=>{y.data==="registered"&&m(void 0)});const h=new RTCRtpScriptTransform(c,{name:"audio-metadata-tx",port:u.port2},[u.port2]);t.transform=h,await new dt(m=>c.onmessage=y=>{y.data==="started"&&m(void 0)}),u.port1.onmessage=m=>{var y;if(m.data.transformed&&t.track&&((y=t.track)===null||y===void 0?void 0:y.id)!==s.track.id)x.debug("audio track changed: ".concat(s.track.id," => ").concat(t.track.id)),s.track.removeEventListener("ended",a),s.track=t.track,s.track.addEventListener("ended",a);else if(m.data.getMetadata){const v=r.metadata&&r.metadata();v&&u.port1.postMessage({metadata:v})}},s.worker=c}function a(){if(t.track){if(this.id!==t.track.id)return;t.track.removeEventListener("ended",a)}const c=fP.get(t);if(c){fP.delete(t);try{var u,h;(u=c.controller)===null||u===void 0||u.terminate(),(h=c.worker)===null||h===void 0||h.terminate()}catch(m){x.warning(m&&m.message)}}}fP.set(t,s),t.track.addEventListener("ended",a)},interceptRemoteAudioFrame:async function(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!jn().supportWebRTCEncodedTransform)return void x.warning("browser not support audio encoded transform");if(EP.has(t))return;const s={track:t.track,onMetadata:r.onMetadata};if(rp()){if(!t.createEncodedStreams)return void x.warning("browser not support createEncodedStreams() API");hL(Gn.CHROME,87,116)||(r.enableTopn=!1);let c=null;try{c=t.createEncodedStreams()}catch(h){return void x.error("create audio-encoded-streams error",h&&h.message)}const u=new TransformStream({transform(h,m){s.controller||(s.controller=m),t.track&&t.track.id!==s.track.id&&(x.debug("audio track changed: ".concat(s.track.id," => ").concat(t.track.id)),s.track.removeEventListener("ended",a),s.track=t.track,s.track.addEventListener("ended",a)),r.enableTopn?function(y,v,S){var R;const P=gH(new DataView(v.data));if(!P)return S.enqueue(v);const D=y.track.id;Mme.set(D,y.track);const G=(R=P.tlv.find(Se=>Se.tag===cp.AUDIO_LEVEL))===null||R===void 0?void 0:R.value;let F=0;typeof G=="number"&&(F=127-G);const j=Math.round(Math.pow(10,F/60)-1),{selected:Y,speaker:ee}=function(Se,we){let ye=iS.get(Se);if(ye||(ye=function(Ne){const Ye=new yH;return iS.set(Ne,Ye),bd||(bd=new xme(oe("TOPN_SILENCE_THRESHOLD")||500),bd.on("ActiveSpeakerChanged",ht=>{ht!=null&&(gP=ht)})),bd.addSpeakers([Ye]),Ye}(Se)),iS.size<=EH)return{selected:!0,speaker:ye};if(!bd)throw new Error("no active speaker detector");return bd.levelChanged(ye.id,we),Y_=bd.loudest.map(Ne=>Ne.id),gP&&!ot(Y_).call(Y_,gP)&&Y_.length>=EH&&Y_.pop(),{selected:ot(Y_).call(Y_,ye.id)||ye.id===gP,speaker:ye}}(y,j),fe=function(Se,we,ye){const Ne=Td.get(Se)||new Lme(Se,we);return Ne.score=ye,Td.set(Se,Ne),function(Ye){if(_P.set(Ye,!0),!yP)return void(yP=Date.now());const ht=Date.now();ht-yP>1e3&&(_P.get(Ye)?_P.set(Ye,!1):(vH(Ye),_P.delete(Ye)),yP=ht)}(Se),Ne}(D,y.track,ee.energyScore);fe.addSample(Y),fe.active&&(v.data=P.frame.buffer,S.enqueue(v))}(t,h,m):r.enableMetadata?function(y,v,S){const R=gH(new DataView(y.data));if(!R)return v.enqueue(y);const P=R.tlv.find(D=>D.tag===cp.METADATA||D.tag===cp.AUDIO_64_BIT_PTS);P&&S&&P.value instanceof Uint8Array&&S(P.value),y.data=R.frame.buffer,v.enqueue(y)}(h,m,r.onMetadata):m.enqueue(h)}});c.readable.pipeThrough(u).pipeTo(c.writable)}else if(Ps()){if(typeof RTCRtpScriptTransform>"u")return void x.warning("browser not support RTCRtpScriptTransform");const c=hP(),u=new MessageChannel;await new dt(m=>c.onmessage=y=>{y.data==="registered"&&m(void 0)});const h=new RTCRtpScriptTransform(c,{name:"audio-metadata-rx",port:u.port2},[u.port2]);t.transform=h,await new dt(m=>c.onmessage=y=>{y.data==="started"&&m(void 0)}),u.port1.onmessage=m=>{var y;m.data.transformed&&t.track&&((y=t.track)===null||y===void 0?void 0:y.id)!==s.track.id?(x.debug("audio track changed: ".concat(s.track.id," => ").concat(t.track.id)),s.track.removeEventListener("ended",a),s.track=t.track,s.track.addEventListener("ended",a)):m.data.metadata&&s.onMetadata&&s.onMetadata(m.data.metadata)},s.worker=c}function a(){t.track.removeEventListener("ended",a),function(c){const u=EP.get(c);if(u){(function(y){const v=iS.get(y);v&&(iS.delete(y),bd&&(bd.removeSpeakers([v]),iS.size===0&&(bd.destroy(),bd=null)))})(c),vH(c.track.id),EP.delete(c);try{var h,m;(h=u.controller)===null||h===void 0||h.terminate(),(m=u.worker)===null||m===void 0||m.terminate()}catch(y){x.warning(y&&y.message)}}}(t)}EP.set(t,s),t.track.addEventListener("ended",a)},interceptLocalVideoFrame:async function(t,r){if(!jn().supportWebRTCEncodedTransform)return void x.warning("browser not support video encoded transform");if(vP.has(t)||!t.track)return;const s={track:t.track};if(rp()){if(!t.createEncodedStreams)return void x.warning("browser not support createEncodedStreams() API");let c=null;try{c=t.createEncodedStreams()}catch(m){return void x.error("create video-encoded-streams error",m&&m.message)}const u=[];r.on("sei-to-send",m=>{u.push(m)});const h=new TransformStream({transform(m,y){s.controller||(s.controller=y),t.track&&t.track.id!==s.track.id&&(x.debug("video track changed: ".concat(s.track.id," => ").concat(t.track.id)),s.track.removeEventListener("ended",a),s.track=t.track,s.track.addEventListener("ended",a));const v=u.shift();v&&(m.data=function(S,R){const P=function(ee){const fe=ee.length;let Se=[],we=0;for(;we<fe;)we+2<fe&&ee[we]===0&&ee[we+1]===0&&(ee[we+2]===0||ee[we+2]===1||ee[we+2]===2||ee[we+2]===3)?(Se.push(ee[we],ee[we+1],3,ee[we+2]),we+=3):(Se.push(ee[we]),we++);return new Uint8Array(Se)}(R),D=P.length,G=Math.floor(D/255),F=D%255,j=new Uint8Array(6+G+1+D+S.byteLength);j[0]=0,j[1]=0,j[2]=0,j[3]=1,j[4]=6,j[5]=101;let Y=0;for(;Y<G;)j[6+Y]=255,Y++;return j[6+Y]=F,Y++,j.set(P,6+Y),j.set(new Uint8Array(S),6+Y+D),j.buffer}(m.data,v)),y.enqueue(m)}});c.readable.pipeThrough(h).pipeTo(c.writable)}else{if(!Ps())return;{if(typeof RTCRtpScriptTransform>"u")return void x.warning("browser not support RTCRtpScriptTransform");const c=hP(),u=new MessageChannel;await new dt(m=>c.onmessage=y=>{y.data==="registered"&&m(void 0)});const h=new RTCRtpScriptTransform(c,{name:"sei-tx",port:u.port2},[u.port2]);t.transform=h,await new dt(m=>c.onmessage=y=>{y.data==="started"&&m(void 0)}),r.on("sei-to-send",m=>{u.port1.postMessage({sei:m})}),u.port1.onmessage=m=>{var y;m.data.transformed&&t.track&&((y=t.track)===null||y===void 0?void 0:y.id)!==s.track.id&&(x.debug("video track changed: ".concat(s.track.id," => ").concat(t.track.id)),s.track.removeEventListener("ended",a),s.track=t.track,s.track.addEventListener("ended",a))},s.worker=c}}function a(){if(t.track){if(this.id!==t.track.id)return;t.track.removeEventListener("ended",a)}const c=vP.get(t);if(c){vP.delete(t);try{var u,h;(u=c.controller)===null||u===void 0||u.terminate(),(h=c.worker)===null||h===void 0||h.terminate()}catch(m){x.warning(m&&m.message)}}}vP.set(t,s),t.track.addEventListener("ended",a)},interceptRemoteVideoFrame:async function(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!jn().supportWebRTCEncodedTransform)return void x.warning("browser not support video encoded transform");if(!t.track)return;if(UT.has(t)){const c=UT.get(t);return void(c&&(c.onSei=r.onSei))}const s={track:t.track,onSei:r.onSei};if(rp()){if(!t.createEncodedStreams)return void x.warning("browser not support createEncodedStreams() API");let c=null;try{c=t.createEncodedStreams()}catch(h){return void x.error("create video-encoded-streams error",h&&h.message)}const u=new TransformStream({transform(h,m){s.controller||(s.controller=m),t.track&&t.track.id!==s.track.id&&(x.debug("video track changed: ".concat(s.track.id," => ").concat(t.track.id)),s.track.removeEventListener("ended",a),s.track=t.track,s.track.addEventListener("ended",a));const y=function(v){const S=new DataView(v.data);let R=0;for(;R+4<v.data.byteLength;){if(S.getUint8(R+0)===0&&S.getUint8(R+1)===0&&S.getUint8(R+2)===0&&S.getUint8(R+3)===1&&S.getUint8(R+4)===6){let P=R+6,D=0,G=0;for(;(G=S.getUint8(P++))===255;)D+=255;D+=G;const F=Ume(v.data,P,D);return new Uint8Array(F)}R++}return null}(h);y&&s.onSei&&s.onSei(y),m.enqueue(h)}});c.readable.pipeThrough(u).pipeTo(c.writable)}else if(Ps()){if(typeof RTCRtpScriptTransform>"u")return void x.warning("browser not support RTCRtpScriptTransform");const c=hP(),u=new MessageChannel;await new dt(m=>c.onmessage=y=>{y.data==="registered"&&m(void 0)});const h=new RTCRtpScriptTransform(c,{name:"sei-rx",port:u.port2},[u.port2]);t.transform=h,await new dt(m=>c.onmessage=y=>{y.data==="started"&&m(void 0)}),u.port1.onmessage=m=>{var y;m.data.transformed&&t.track&&((y=t.track)===null||y===void 0?void 0:y.id)!==s.track.id?(x.debug("video track changed: ".concat(s.track.id," => ").concat(t.track.id)),s.track.removeEventListener("ended",a),s.track=t.track,s.track.addEventListener("ended",a)):m.data.sei&&s.onSei&&s.onSei(m.data.sei)},s.worker=c}function a(){if(t.track){if(this.id!==t.track.id)return;t.track.removeEventListener("ended",a)}(function(c){const u=UT.get(c);if(u){UT.delete(c);try{var h,m;(h=u.controller)===null||h===void 0||h.terminate(),(m=u.worker)===null||m===void 0||m.terminate()}catch(y){x.warning(y&&y.message)}}})(t)}UT.set(t,s),t.track.addEventListener("ended",a)}},rEe={name:"InterceptFrame",create:()=>nEe};kL(),rr("PROCESS_ID","process-".concat(fr(8,""),"-").concat(fr(4,""),"-").concat(fr(4,""),"-").concat(fr(4,""),"-").concat(fr(12,""))),function(){let t;try{t=window.localStorage.getItem("websdk_ng_global_parameter")}catch(r){return void x.error("Error loading sdk config",r.message)}if(t)try{const r=JSON.parse(window.atob(t)),s=Date.now();x.debug("Loading global parameters from cache",r),Object.keys(r).forEach(a=>{if(Object.prototype.hasOwnProperty.call(br,a)){const{value:c,expires:u}=r[a];if(u&&u<=s)return;Sd[a]=c,br[a]=c}})}catch(r){x.error("Error loading mutableParamsCache: ".concat(t),r.message)}}(),Array.isArray(Sd.AREAS)&&Sd.AREAS.length>0&&b2(Sd.AREAS,!0);const TK=(t,r,s)=>{x.debug("setParameter key:".concat(t,", value:").concat(JSON.stringify(r))),rr(t,r,s)};Qm(Rye,!1),Qm(Pye,!1),Qm(c_e,!1),Qm(jye,!1),Qm(Tye,!1),Qm(Qye,!1),Qm(tEe,!1),Qm(rEe,!1);const Ni=function(t){const r=new Fr,s=t,a={getListeners:r.getListeners.bind(r),on:(c,u)=>(function(h,m){h===Ih.SECURITY_POLICY_VIOLATION&&r$(m,!0)}(c,u),r.on.bind(r)(c,u)),addListener:r.addListener.bind(r),once:r.once.bind(r),off:r.off.bind(r),removeAllListeners:r.removeAllListeners.bind(r),emit:r.emit.bind(r),safeEmit:r.safeEmit.bind(r)};return n$(n$({},s),a)}({__TRACK_LIST__:qv,VERSION:Al,BUILD:xL,ESM_BUNDLER:!1,ESM:!1,UMD:!0,DEV:!1,setParameter:TK,getParameter:oe,getSupportedCodec:async function(){let t={audio:[],video:[]};try{let r=new RTCPeerConnection;const s=await async function(a){let c;return jn().supportUnifiedPlan?(a.addTransceiver("video",{direction:"recvonly"}),a.addTransceiver("audio",{direction:"recvonly"}),c=(await a.createOffer()).sdp):c=(await a.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0})).sdp,c}(r);if(!s)return t;r.close(),r=null,t=function(a){const c={video:[],audio:[]};return a.match(/ VP8/i)&&c.video.push("VP8"),a.match(/ VP9/i)&&c.video.push("VP9"),a.match(/ AV1/i)&&c.video.push("AV1"),a.match(/ H264/i)&&c.video.push("H264"),a.match(/ H265/i)&&c.video.push("H265"),a.match(/ opus/i)&&c.audio.push("OPUS"),a.match(/ PCMU/i)&&c.audio.push("PCMU"),a.match(/ PCMA/i)&&c.audio.push("PCMA"),a.match(/ G722/i)&&c.audio.push("G722"),c}(s)}catch(r){throw new Oe(te.CREATE_OFFER_FAILED,r.toString&&r.toString()).print()}return t},checkSystemRequirements:function(){const t=At.reportApiInvoke(null,{name:Oi.CHECK_SYSTEM_REQUIREMENTS,options:[],tag:Hr.TRACER});let r=!1;try{const u=window.RTCPeerConnection,h=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia,m=window.WebSocket;r=!!(u&&h&&m),r&&gL()&&w8(75)&&new u().close()}catch(u){return x.error("check system requirement failed: ",u),!1}let s=!1;const a=Dn();a.name===Gn.CHROME&&Number(a.version)>=58&&(Ed.engine.name!=="WebKit"||function(){const u=Dn();if(YA()){if(u.os===Qi.MAC_OS)return!0;if(u.os===Qi.IOS){const h=Ed.os.version&&Ed.os.version.split(".");if(h&&Number(h[0])===14&&h[1]&&Number(h[1])>=3||h&&Number(h[0])>14)return!0}}return!1}())&&(s=!0),(a.name===Gn.FIREFOX&&Number(a.version)>=56||a.name===Gn.OPERA&&Number(a.version)>=45||a.name===Gn.SAFARI&&Number(a.version)>=11||a.name==="WebKit"&&(Vo()||Su())&&a.osVersion&&Number(a.osVersion.split(".")[0])>=11||O8()||Dn().name===Gn.QQ)&&(s=!0),x.debug("checkSystemRequirements, api:",r,"browser",s);const c=r&&s;return t.onSuccess(c),c},getDevices:function(t){return el.enumerateDevices(!0,!0,t)},getMicrophones:function(t){return el.getRecordingDevices(t)},getCameras:function(t){return el.getCamerasDevices(t)},getElectronScreenSources:wz,getPlaybackDevices:function(t){return el.getSpeakers(t)},createClient:function(){var t;let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{codec:"vp8",audioCodec:"opus",mode:"rtc"};const s=fr(5,"client-"),a=At.reportApiInvoke(null,{id:s,name:Oi.CREATE_CLIENT,options:[r],tag:Hr.TRACER});try{(function(c){Hi(c.codec,"config.codec",["vp8","vp9","av1","h264","h265"]),Hi(c.mode,"config.mode",["rtc","live","p2p"]),c.audioCodec!==void 0&&Hi(c.audioCodec,"config.audioCodec",["opus","pcmu","pcma","g722"]),c.proxyServer!==void 0&&fs(c.proxyServer,"config.proxyServer",1,1e4),c.turnServer!==void 0&&V8(c.turnServer),c.httpRetryConfig!==void 0&&U8(c.httpRetryConfig),c.websocketRetryConfig!==void 0&&U8(c.websocketRetryConfig)})(r)}catch(c){throw a.onError(c),c}return(R8(16,0)||I8(16,0,!0))&&(r.codec==="vp9"&&(r.codec="vp8",x.debug("browser not support vp9, force use vp8")),rr("UNSUPPORTED_VIDEO_CODEC",["vp9"])),r.audioCodec===void 0&&(r.audioCodec="opus"),a.onSuccess(),new l_e(Pu(Pu({forceWaitGatewayResponse:!0},r),{},{role:ot(t=["rtc","p2p"]).call(t,r.mode)?"host":r.role||"audience"}),s)},createCameraVideoTrack:async function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const r=oe("CAMERA_CAPTURE_CONFIG"),s=fr(8,"track-cam-"),a=At.reportApiInvoke(null,{id:s,tag:Hr.TRACER,name:Oi.CREATE_CAM_VIDEO_TRACK,options:[Lr({},t),r]});r&&(t.encoderConfig=r);const c=uP(t);let u=null;x.info("start create camera video track with config",JSON.stringify(t),"trackId",s);try{u=(await Zc({video:c},s)).getVideoTracks()[0]||null}catch(m){throw a.onError(m),m}if(!u){const m=new Me(te.UNEXPECTED_ERROR,"can not find track in media stream");return a.onError(m),m.throw(x)}t.optimizationMode&&JL(s,u,t,wh(t.encoderConfig));const h=new XL(u,t,c,t.scalabiltyMode?oP(t.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t.optimizationMode,s);return a.onSuccess(h.getTrackId()),x.info("create camera video success, trackId:",s),h},createCustomVideoTrack:function(t){const r=fr(8,"track-cus-"),s=At.reportApiInvoke(null,{id:r,tag:Hr.TRACER,name:Oi.CREATE_CUSTOM_VIDEO_TRACK,options:[t]}),a=new Tr(t.mediaStreamTrack,{width:t.width,height:t.height,frameRate:t.frameRate,bitrateMax:t.bitrateMax,bitrateMin:t.bitrateMin},t.scalabiltyMode?oP(t.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t.optimizationMode,r,[pr.CUSTOM_TRACK]);return s.onSuccess(a.getTrackId()),x.info("create custom video track success with config",t,"trackId",a.getTrackId()),a},createScreenVideoTrack:async function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"disable";const s=typeof r=="object"?function(P){return xz(P)}(r):void 0;s&&(r="auto");const a=fr(8,"track-scr-v-"),c=At.reportApiInvoke(null,{id:a,tag:Hr.TRACER,name:Oi.CREATE_SCREEN_VIDEO_TRACK,options:[Lr({},t),r]});t.encoderConfig?typeof t.encoderConfig=="string"||t.encoderConfig.width&&t.encoderConfig.height||(t.encoderConfig.width={max:1920},t.encoderConfig.height={max:1080}):t.encoderConfig="1080p_2";const u=function(P){const D={};P.screenSourceType&&(D.mediaSource=P.screenSourceType),P.extensionId&&rp()&&(D.extensionId=P.extensionId);const{displaySurface:G,selfBrowserSurface:F,surfaceSwitching:j,systemAudio:Y,preferCurrentTab:ee}=P;(RT(107)||fL(107)||pL(93))&&(G&&(Hi(G,"displaySurface",["browser","window","monitor"]),D.displaySurface=G),F?(Hi(F,"selfBrowserSurface",["exclude","include"]),D.selfBrowserSurface=F):D.selfBrowserSurface="include",j&&(Hi(j,"surfaceSwitching",["exclude","include"]),D.surfaceSwitching=j)),(RT(105)||fL(105)||pL(91))&&Y&&(Hi(Y,"systemAudio",["exclude","include"]),D.systemAudio=Y),(RT(94)||fL(94)||pL(80))&&ee&&(D.preferCurrentTab=!0),P.electronScreenSourceId&&(D.sourceId=P.electronScreenSourceId);const fe=P.encoderConfig?FL(P.encoderConfig):null;return D.mandatory={chromeMediaSource:"desktop",maxWidth:fe?fe.width:void 0,maxHeight:fe?fe.height:void 0},fe&&(fe.frameRate&&(typeof fe.frameRate=="number"?(D.mandatory.maxFrameRate=fe.frameRate,D.mandatory.minFrameRate=fe.frameRate):(D.mandatory.maxFrameRate=fe.frameRate.max||fe.frameRate.ideal||fe.frameRate.exact||void 0,D.mandatory.minFrameRate=fe.frameRate.min||fe.frameRate.ideal||fe.frameRate.exact||void 0),D.frameRate=fe.frameRate),fe.width&&(D.width=fe.width),fe.height&&(D.height=fe.height)),D}(t);let h=null,m=null;const y=jn();if(!y.supportShareAudio&&r==="enable"){const P=new Me(te.NOT_SUPPORTED,"your browser or platform is not support share-screen with audio");return c.onError(P),P.throw(x)}x.info("start create screen video track with config",t,"withAudio",r,"trackId",a);const v=y.supportShareAudio&&r!=="disable";try{const P=await Zc({screen:u,screenAudio:v?s||!0:void 0},a);h=P.getVideoTracks()[0]||null,m=P.getAudioTracks()[0]||null}catch(P){throw c.onError(P),P}if(!h){const P=new Me(te.UNEXPECTED_ERROR,"can not find track in media stream");return c.onError(P),P.throw(x)}if(!m&&r==="enable"){h&&h.stop();const P=new Me(te.SHARE_AUDIO_NOT_ALLOWED);return c.onError(P),P.throw(x)}t.optimizationMode||(t.optimizationMode="detail"),t.optimizationMode&&(JL(a,h,t,t.encoderConfig&&FL(t.encoderConfig)||void 0),t.encoderConfig&&typeof t.encoderConfig!="string"&&(t.encoderConfig.bitrateMin=t.encoderConfig.bitrateMax));const S=new Tr(h,t.encoderConfig?FL(t.encoderConfig):{},t.scalabiltyMode?oP(t.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t.optimizationMode,a,[pr.SCREEN_TRACK]);if(!m)return c.onSuccess(S.getTrackId()),x.info("create screen video track success","video:",S.getTrackId()),S;const R=new Xr(m,void 0,fr(8,"track-scr-a-"),!1);return c.onSuccess([S.getTrackId(),R.getTrackId()]),x.info("create screen video track success","video:",S.getTrackId(),"audio:",R.getTrackId()),[S,R]},createMicrophoneAndCameraTracks:async function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const s=oe("CAMERA_CAPTURE_CONFIG"),a=fr(8,"track-mic-"),c=fr(8,"track-cam-"),u=At.reportApiInvoke(null,{id:"".concat(a,"-").concat(c),tag:Hr.TRACER,name:Oi.CREATE_MIC_AND_CAM_TRACKS,options:[t,r,s]});s&&(r.encoderConfig=s);const h=uP(r),m=Lz(t);let y=null,v=null;x.info("start create camera video track(".concat(c,") and microphone audio track(").concat(a,") with config, audio: ").concat(JSON.stringify(t),", video: ").concat(JSON.stringify(r)));try{const P=await Zc({audio:m,video:h},"".concat(a,"-").concat(c));y=P.getAudioTracks()[0],v=P.getVideoTracks()[0]}catch(P){throw u.onError(P),P}if(!y||!v){const P=new Me(te.UNEXPECTED_ERROR,"can not find tracks in media stream");return u.onError(P),P.throw(x)}r.optimizationMode&&JL(c,v,r,wh(r.encoderConfig));const S=new dP(y,t,m,a),R=new XL(v,r,h,r.scalabiltyMode?oP(r.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},r.optimizationMode,c);return u.onSuccess([S.getTrackId(),R.getTrackId()]),x.info("create camera video track(".concat(c,") and microphone audio track(").concat(a,") success")),[S,R]},createMicrophoneAudioTrack:async function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const r=fr(8,"track-mic-"),s=At.reportApiInvoke(null,{id:r,tag:Hr.TRACER,name:Oi.CREATE_MIC_AUDIO_TRACK,options:[t]}),a=Lz(t);let c=null;x.info("start create microphone audio track with config",JSON.stringify(t),"trackId",r);try{c=(await Zc({audio:a},r)).getAudioTracks()[0]||null}catch(h){throw s.onError(h),h}if(!c){const h=new Me(te.UNEXPECTED_ERROR,"can not find track in media stream");return s.onError(h),h.throw(x)}const u=new dP(c,t,a,r);return s.onSuccess(u.getTrackId()),x.info("create microphone audio track success, trackId:",r),u},createCustomAudioTrack:function(t){const r=fr(8,"track-cus-"),s=At.reportApiInvoke(null,{id:r,tag:Hr.TRACER,name:Oi.CREATE_CUSTOM_AUDIO_TRACK,options:[t]}),a=new Xr(t.mediaStreamTrack,t.encoderConfig?aP(t.encoderConfig):{},r,!1);return x.info("create custom audio track success with config",t,"trackId",a.getTrackId()),s.onSuccess(a.getTrackId()),a},createBufferSourceAudioTrack:async function(t){var r;const{cacheOnlineFile:s,encoderConfig:a}=t;let{source:c}=t;const u={source:c instanceof AudioBuffer?"AudioBuffer":c instanceof File?(r=File.name)!==null&&r!==void 0?r:"File":c,cacheOnlineFile:s,encoderConfig:a},h=fr(8,"track-buf-"),m=At.reportApiInvoke(null,{id:h,tag:Hr.TRACER,name:Oi.CREATE_BUFFER_AUDIO_TRACK,options:[u]});if(oe("DISABLE_WEBAUDIO"))throw new Me(te.NOT_SUPPORTED,"can not create BufferSourceAudioTrack when WebAudio disabled");x.info("start create buffer source audio track with config",JSON.stringify(u),"trackId",h);const y=c;if(!(c instanceof AudioBuffer))try{c=await async function(R,P){let D=null;if(typeof R=="string"){const F=SG.get(R);if(F)return x.debug("use cached audio resource: ",R),F;try{D=(await vd(()=>ha.get(R,{responseType:"arraybuffer"}),void 0,void 0,{maxRetryCount:3})).data}catch(j){throw new Me(te.FETCH_AUDIO_FILE_FAILED,j.toString())}}else D=await new dt((j,Y)=>{const ee=new FileReader;ee.onload=fe=>{fe.target?j(fe.target.result):Y(new Me(te.READ_LOCAL_AUDIO_FILE_ERROR))},ee.onerror=()=>{Y(new Me(te.READ_LOCAL_AUDIO_FILE_ERROR))},ee.readAsArrayBuffer(R)});const G=await function(F){const j=eS();return new dt((Y,ee)=>{j.decodeAudioData(F,fe=>{Y(fe)},fe=>{ee(new Me(te.DECODE_AUDIO_FILE_FAILED,fe.toString()))})})}(D);return typeof R=="string"&&P&&SG.set(R,G),G}(c,s)}catch(R){return m.onError(R),R.throw(x)}const v=new Pme(c),S=new Ame(y,v,a?aP(a):{},h);return x.info("create buffer source audio track success, trackId:",h),m.onSuccess(S.getTrackId()),S},setAppType:function(t){if(x.debug("setAppType: ".concat(t)),!(Number.isInteger(t)&&t>=0))throw x.debug("Invalid appType"),new Oe(te.INVALID_PARAMS,"invalid app type",t);rr("APP_TYPE",Math.floor(t))},setLogLevel:function(t){x.setLogLevel(t)},enableLogUpload:function(){oe("USE_NEW_LOG")?rr("UPLOAD_LOG",!0):x.enableLogUpload()},disableLogUpload:function(){oe("USE_NEW_LOG")?rr("UPLOAD_LOG",!1):x.disableLogUpload()},createChannelMediaRelayConfiguration:function(){return new S9},checkAudioTrackIsActive:async function(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const s=At.reportApiInvoke(null,{tag:Hr.TRACER,name:Oi.CHECK_AUDIO_TRACK_IS_ACTIVE,options:[r]});if(!(t instanceof Xr||t instanceof rS)){const y=new Oe(te.INVALID_TRACK,"the parameter is not a audio track");return s.onError(y),y.throw()}r&&r<1e3&&(r=1e3);const a=t instanceof Xr?t.getTrackLabel():"remote_track",c=t.getVolumeLevel();let u=c,h=c;const m=Date.now();return new dt(y=>{const v=setInterval(()=>{const S=t.getVolumeLevel();u=S>u?S:u,h=S<h?S:h;const R=u-h>1e-4,P=Date.now()-m;if(R||P>r){clearInterval(v);const D=R,G={duration:P,deviceLabel:a,maxVolumeLevel:u,result:D};x.info("[track-".concat(t.getTrackId(),"] check audio track active completed. ").concat(JSON.stringify(G))),s.onSuccess(G),y(D)}},200)})},checkVideoTrackIsActive:async function(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const s=At.reportApiInvoke(null,{tag:Hr.TRACER,name:Oi.CHECK_VIDEO_TRACK_IS_ACTIVE,options:[r]});if(!(t instanceof Tr||t instanceof nS)){const R=new Oe(te.INVALID_TRACK,"the parameter is not a video track");return s.onError(R),R.throw()}r&&r<1e3&&(r=1e3);const a=t instanceof Tr?t.getTrackLabel():"remote_track",c=t.getMediaStreamTrack(!0),u=document.createElement("video");u.style.width="1px",u.style.height="1px",u.setAttribute("muted",""),u.muted=!0,u.setAttribute("playsinline",""),u.controls=!1,(Ps()||YA())&&(u.style.opacity="0.01",u.style.position="fixed",u.style.left="0",u.style.top="0",document.body.appendChild(u)),u.srcObject=new MediaStream([c]),u.play();const h=document.createElement("canvas");h.width=160,h.height=120;let m=0,y=0;try{const R=Date.now();m=await function(P,D,G,F){let j,Y=0,ee=null;return new dt((fe,Se)=>{function we(){Y>F&&j&&(j(),fe(Y));const ye=G.getContext("2d");if(!ye){const ht=new Oe(te.UNEXPECTED_ERROR,"can not get canvas 2d context.");return x.error(ht.toString()),void Se(ht)}ye.drawImage(P,0,0,160,120);const Ne=ye.getImageData(0,0,G.width,G.height),Ye=Math.floor(Ne.data.length/3);if(ee){for(let ht=0;ht<Ye;ht+=3)if(Ne.data[ht]!==ee[ht])return Y+=1,void(ee=Ne.data);ee=Ne.data}else ee=Ne.data}setTimeout(()=>{j&&(j(),fe(Y))},D),j=GL(()=>{we()},30)})}(u,r,h,4),y=Date.now()-R}catch(R){throw s.onError(R),R}qge===Gn.SAFARI&&(u.pause(),u.remove()),u.srcObject=null;const v=m>4,S={duration:y,changedPicNum:m,deviceLabel:a,result:v};return x.info("[track-".concat(t.getTrackId(),"] check video track active completed. ").concat(JSON.stringify(S))),s.onSuccess(S),v},setArea:b2,audioElementPlayCenter:fa,resumeAudioContext:function(){fa.autoResumeAfterInterruption(!0)},processExternalMediaAEC:function(t){d_e.processExternalMediaAEC(t)},registerExtensions:function(t){const r=oe("PLUGIN_INFO")||[];t.forEach(s=>{"name"in s&&!ot(r).call(r,s.name)&&r.push(s.name);const a=s;a.__registered__=!0,a.logger.hookLog=x.extLog,a.reporter.hookApiInvoke=At.extApiInvoke,a.parameters&&Object.keys(a.parameters).forEach(c=>{a.parameters[c]=oe(c)})}),TK("PLUGIN_INFO",r)},ChannelMediaRelayError:oS,ChannelMediaRelayEvent:up,ChannelMediaRelayState:za,RemoteStreamFallbackType:Sme,RemoteStreamType:vme,ConnectionDisconnectedReason:qn,AudienceLatencyLevelType:Jpe,AREAS:Hn,preload:async function(t,r,s,a){return q9(t,r,s,a)}});return Object.defineProperties(Ni,{onAudioAutoplayFailed:{get:()=>tl.onAudioAutoplayFailed,set:t=>{tl.onAudioAutoplayFailed=t}},onAutoplayFailed:{get:()=>tl.onAutoplayFailed,set:t=>{tl.onAutoplayFailed=t}},_onSecurityPolicyViolation:{value:void 0,writable:!0},_cspEventHandlerPointer:{value:void 0,writable:!0},onSecurityPolicyViolation:{get:()=>Ni._onSecurityPolicyViolation,set(t){Ni._onSecurityPolicyViolation=t,r$(t)}},__CLIENT_LIST__:{get:()=>oe("SHOW_GLOBAL_CLIENT_LIST")?X_:[]}}),el.on($_.CAMERA_DEVICE_CHANGED,t=>{x.info("camera device changed",JSON.stringify(t)),Ni.onCameraChanged&&Ni.onCameraChanged(t),Ni.safeEmit(Ih.CAMERA_CHANGED,t)}),el.on($_.RECORDING_DEVICE_CHANGED,t=>{x.info("microphone device changed",JSON.stringify(t)),Ni.onMicrophoneChanged&&Ni.onMicrophoneChanged(t),Ni.safeEmit(Ih.MICROPHONE_CHANGED,t)}),el.on($_.PLAYOUT_DEVICE_CHANGED,t=>{x.debug("playout device changed",JSON.stringify(t)),Ni.onPlaybackDeviceChanged&&Ni.onPlaybackDeviceChanged(t),Ni.safeEmit(Ih.PLAYBACK_DEVICE_CHANGED,t)}),fa.onAutoplayFailed=()=>{x.info("detect audio element autoplay failed"),tl.onAudioAutoplayFailed&&tl.onAudioAutoplayFailed()},ir.on("autoplay-failed",()=>{x.info("detect webaudio autoplay failed"),tl.onAudioAutoplayFailed&&tl.onAudioAutoplayFailed(),Ni.safeEmit(Ih.AUTOPLAY_FAILED)}),ir.on(gs.STATE_CHANGE,(t,r)=>{x.info("audio context state changed: ".concat(r," => ").concat(t)),Ni.onAudioContextStateChanged&&Ni.onAudioContextStateChanged(t,r),Ni.safeEmit(Ih.AUDIO_CONTEXT_STATE_CHANGED,t,r)}),vi.on(Wv.NETWORK_STATE_CHANGE,(t,r)=>{x.info("[network-indicator] network state changed, ".concat(r," => ").concat(t))}),window&&(window.__ARTC__=Ni),Ni})}(Mk)),Mk.exports}var sze=ize();const ZC=Bg(sze),oze="a2a7f4eb05284449b1063eb71d8301dc",aze=ZC.createClient({mode:"rtc",codec:"vp8"});let Uw=null;const hae=N.createContext(null),fae=({children:n,appId:e=oze,channel:i=null,token:o=null,uid:l=null,enabled:d=!0,startMuted:p=!0,onClientReady:_=()=>{}})=>{const[E,b]=N.useState(!1),[C,I]=N.useState(!1),[O,L]=N.useState([]),[U,B]=N.useState(null),[W,J]=N.useState(null),[$,ie]=N.useState(null),[ce,ne]=N.useState(!1),[de,Q]=N.useState(!1),[Z,X]=N.useState(!1),[re,pe]=N.useState(null),[he,ue]=N.useState(!1),xe=Ic(),We=N.useRef(aze),$e=N.useRef({appId:e,channel:i,uid:l,enabled:d}),ve=N.useRef(!1),_e=N.useRef(null);N.useRef(null),N.useEffect(()=>{$e.current={appId:e,channel:i,uid:l,enabled:d}},[e,i,l,d]),N.useEffect(()=>{J(i)},[i]),N.useEffect(()=>{if(!We.current)return;const et=ut=>{q.log(`Connection state changed to: ${ut}`),ut==="DISCONNECTED"?(b(!1),q.log("Disconnected from Agora")):ut==="CONNECTED"&&(b(!0),B(null))};return We.current.on("connection-state-change",et),()=>{We.current.off("connection-state-change",et)}},[]),N.useEffect(()=>{if(!i||!d)return;const et=async(Ft,an)=>{q.log(`User published: ${Ft.uid}, mediaType: ${an}`);try{await We.current.subscribe(Ft,an),an==="audio"&&Ft.audioTrack.play(),L(en=>en.some(Xt=>Xt.uid===Ft.uid)?en:[...en,Ft])}catch(en){q.error("Error subscribing to user:",en)}},ut=(Ft,an)=>{q.log(`User unpublished: ${Ft.uid}, mediaType: ${an}`),an==="audio"&&Ft.audioTrack&&Ft.audioTrack.stop()},rt=Ft=>{q.log(`User joined: ${Ft.uid}`),L(an=>an.some(en=>en.uid===Ft.uid)?an:[...an,Ft])},It=Ft=>{q.log(`User left: ${Ft.uid}`),L(an=>an.filter(en=>en.uid!==Ft.uid))};return We.current.on("user-published",et),We.current.on("user-unpublished",ut),We.current.on("user-joined",rt),We.current.on("user-left",It),(async()=>{if(ve.current){q.log("Already initializing, skipping duplicate initialization");return}ve.current=!0;try{if(E&&_e.current===i){q.log(`Already joined to channel ${i}`),ne(!0),_(We.current);return}if(We.current.connectionState==="CONNECTING"||We.current.connectionState==="CONNECTED")if(_e.current&&_e.current!==i){q.log("Connected to different channel, leaving first");try{await Te()}catch(Ft){q.error("Error leaving channel:",Ft)}}else{b(!0),ne(!0),_e.current=i,Uw=i,_(We.current);return}q.log(`Joining channel ${i}`),await ke(),q.log("Join channel completed")}catch(Ft){q.error("Error during initialization:",Ft)}finally{ve.current=!1}})(),()=>{q.log("Cleaning up event listeners"),We.current.off("user-published",et),We.current.off("user-unpublished",ut),We.current.off("user-joined",rt),We.current.off("user-left",It)}},[i,d,l,_,E]);const Ee=async()=>{if(!d||$)return $;q.log("Initializing microphone");try{const et=await ZC.createMicrophoneAudioTrack();return await et.setMuted(p),ie(et),q.log("Microphone initialized successfully"),et}catch(et){return q.error("Error initializing microphone:",et),B("Failed to initialize microphone. Please check your permissions."),null}};N.useEffect(()=>{(async()=>{if(i)try{const It=await Bp(i);It&&It.voiceDisabled?(q.log("Voice is disabled for this space"),ue(!0),E&&await Te()):ue(!1)}catch(rt){q.error("Error checking if voice is disabled:",rt)}})();const ut=rt=>{rt.detail&&typeof rt.detail.voiceDisabled=="boolean"&&(q.log("Voice setting changed:",rt.detail.voiceDisabled),ue(rt.detail.voiceDisabled),rt.detail.voiceDisabled&&E?Te():!rt.detail.voiceDisabled&&!E&&d&&i&&ke())};return window.addEventListener("SpaceVoiceSettingChanged",ut),()=>{window.removeEventListener("SpaceVoiceSettingChanged",ut)}},[i,E,d]);const ke=async()=>{if(!d)return q.log("Agora is disabled, not joining channel"),!1;if(he)return q.log("Voice is disabled for this space, not joining channel"),B("Voice chat is disabled for this space"),!1;if(!i)return q.error("AgoraProvider: No channel specified"),B("No channel specified"),!1;if(q.log(`joinChannel called for channel ${i} with UID ${l}`),q.log("Current state:",{isJoined:E,isJoining:de,connectionState:We.current.connectionState,joinedChannel:_e.current}),E&&_e.current===i)return q.log(`Already joined to channel: ${i}`),!0;if(de)return q.log("AgoraProvider: Already in the process of joining"),!1;if(We.current.connectionState==="CONNECTED")if(_e.current&&_e.current!==i){q.log("Connected to different channel, leaving first");try{await Te()}catch(et){q.error("Error leaving channel:",et)}}else return q.log("Client already connected, setting joined state to true"),b(!0),ne(!0),_e.current=i,Uw=i,_(We.current),!0;if(We.current.connectionState==="CONNECTING")return q.log("Client already connecting, waiting for connection"),Q(!0),new Promise(et=>{const ut=setInterval(()=>{We.current.connectionState==="CONNECTED"&&(clearInterval(ut),b(!0),Q(!1),ne(!0),_e.current=i,Uw=i,_(We.current),et(!0))},500);setTimeout(()=>{clearInterval(ut),q.log("AgoraProvider: Connection timeout, considering join failed"),Q(!1),et(!1)},1e4)});try{if(q.log(`Joining channel: ${i} with UID: ${l||"random"}`),q.log(`Using appId: ${e}, Type: ${typeof e}, Length: ${e.length}`),!e||e.trim()===""){const ut="AgoraProvider: App ID is empty or invalid";return q.error(ut),B(ut),Q(!1),!1}Q(!0);const et=l||Math.floor(Math.random()*1e6);return await We.current.join(e,i,o,et),q.log(`Joined channel successfully with UID: ${We.current.uid}`),b(!0),Q(!1),ne(!0),_e.current=i,Uw=i,_(We.current),!0}catch(et){return q.error("Error joining channel:",et),B(`Error joining channel: ${et.toString()}`),Q(!1),!1}},Te=async()=>{if(E)try{$&&await We.current.unpublish($),await We.current.leave(),Uw=null,_e.current=null,q.log("Left channel successfully"),b(!1),L([])}catch(et){q.error("Error leaving channel:",et),B(et.message||"Failed to leave channel")}};N.useEffect(()=>()=>{$&&$.close()},[]),N.useEffect(()=>{d&&i&&(!E||_e.current!==i)&&ke()},[d,i,E]);const be=()=>{if(!$)return!1;try{return $.isActive&&!$.muted}catch(et){return q.error("Error checking microphone status:",et),!1}};N.useEffect(()=>{const et=()=>{const rt=be();rt!==C&&(q.log("Syncing microphone state:",{actualStatus:rt,currentState:C}),I(rt),window.dispatchEvent(new CustomEvent("VoiceToggled",{detail:{enabled:rt}})),window.agoraClient&&(window.agoraClient.isVoiceEnabled=rt,window.agoraClient.microphoneTrack=$))};$&&et();const ut=setInterval(et,1e3);return()=>{clearInterval(ut)}},[$,C]);const Pe=async()=>{var et;if(he)return q.log("Voice is disabled for this space, cannot toggle"),xe({title:"Voice Chat Disabled",description:"Voice chat has been disabled for this space by the owner.",status:"info",duration:3e3,isClosable:!0}),!1;try{const ut=C!==void 0?C:$?!$.muted:!1;if(q.log("AgoraProvider: Toggling voice, current state:",{isVoiceEnabled:C,currentState:ut,hasMicTrack:!!$,trackMuted:$==null?void 0:$.muted}),!$&&(q.log("AgoraProvider: No microphone track, initializing..."),!await Ee()))return q.error("AgoraProvider: Failed to initialize microphone"),ut;const rt=!ut;if(q.log("AgoraProvider: New voice state will be:",rt),ut){if($)try{q.log("AgoraProvider: Muting microphone track"),await $.setMuted(!0),$.muted||(q.warn("AgoraProvider: Track not muted after setMuted(true), trying again"),await $.setEnabled(!1)),q.log("AgoraProvider: Microphone track muted successfully, muted state:",$.muted)}catch(It){return q.error("Error muting track:",It),ut}}else if($)try{We.current&&E&&!((et=We.current.localTracks)!=null&&et.includes($))&&(q.log("AgoraProvider: Publishing microphone track"),await We.current.publish($),q.log("AgoraProvider: Microphone track published successfully")),q.log("AgoraProvider: Unmuting microphone track"),await $.setMuted(!1),$.muted&&(q.warn("AgoraProvider: Track still muted after setMuted(false), trying again"),await $.setEnabled(!0)),q.log("AgoraProvider: Microphone track unmuted successfully, muted state:",$.muted)}catch(It){return q.error("Error unmuting track:",It),ut}return I(rt),rt}catch(ut){return q.error("Error toggling voice:",ut),C}},Le=async et=>{try{ie(et),q.log("Microphone track updated successfully")}catch(ut){throw q.error("Error updating microphone track:",ut),ut}},ze=async()=>{if(!We.current||!i)return q.error("AgoraProvider: Voice chat not connected"),!1;try{if(Z)return q.log("AgoraProvider: Stopping screen share"),re&&(Array.isArray(re)?(await We.current.unpublish(re),re.forEach(et=>et.close())):(await We.current.unpublish(re),re.close()),pe(null)),X(!1),q.log("AgoraProvider: Screen sharing stopped"),typeof window<"u"&&(window.agoraClient||(window.agoraClient={}),window.agoraClient.isScreenSharing=!1,window.agoraClient.screenTrack=null,window.dispatchEvent(new CustomEvent("ScreenShareToggled",{detail:{enabled:!1}}))),!1;q.log("AgoraProvider: Starting screen share");try{const et=await ZC.createScreenVideoTrack({encoderConfig:"1080p_1",optimizationMode:"detail"});return q.log("AgoraProvider: Screen track created:",et),et.on("track-ended",()=>{q.log("AgoraProvider: Screen sharing ended by browser UI"),We.current.unpublish(et),et.close(),pe(null),X(!1),typeof window<"u"&&(window.agoraClient||(window.agoraClient={}),window.agoraClient.isScreenSharing=!1,window.agoraClient.screenTrack=null,window.dispatchEvent(new CustomEvent("ScreenShareToggled",{detail:{enabled:!1}})))}),await We.current.publish(et),pe(et),X(!0),q.log("AgoraProvider: Screen sharing started"),typeof window<"u"&&(window.agoraClient||(window.agoraClient={}),window.agoraClient.isScreenSharing=!0,window.agoraClient.screenTrack=et,window.dispatchEvent(new CustomEvent("ScreenShareToggled",{detail:{enabled:!0}}))),!0}catch(et){return q.error("AgoraProvider: Error creating screen track:",et),X(!1),pe(null),!1}}catch(et){return q.error("AgoraProvider: Error toggling screen share:",et),X(!1),pe(null),!1}};N.useEffect(()=>{if(q.log("AgoraProvider: Initializing window.agoraClient"),typeof window<"u"){window.agoraClient={isVoiceEnabled:!1,isJoined:!1,client:We.current,isScreenSharing:!1,screenTrack:null};const et=rt=>{q.log("AgoraProvider: Received ToggleScreenShare event"),ze().then(It=>{rt.detail&&rt.detail.callback&&rt.detail.callback(!0,It)}).catch(It=>{q.error("AgoraProvider: Error handling ToggleScreenShare event:",It),rt.detail&&rt.detail.callback&&rt.detail.callback(!1,Z)})},ut=rt=>{q.log("AgoraProvider: Received JoinVoiceChat event"),ke().then(It=>{rt.detail&&rt.detail.callback&&rt.detail.callback(It)}).catch(It=>{q.error("AgoraProvider: Error handling JoinVoiceChat event:",It),rt.detail&&rt.detail.callback&&rt.detail.callback(!1)})};return window.addEventListener("ToggleScreenShare",et),window.addEventListener("JoinVoiceChat",ut),()=>{window.removeEventListener("ToggleScreenShare",et),window.removeEventListener("JoinVoiceChat",ut),typeof window<"u"&&window.agoraClient&&(q.log("AgoraProvider: Cleaning up window.agoraClient"),window.agoraClient=null)}}return()=>{typeof window<"u"&&window.agoraClient&&(q.log("AgoraProvider: Cleaning up window.agoraClient"),window.agoraClient=null)}},[]),N.useEffect(()=>{q.log("AgoraProvider: Voice enabled state changed:",C),typeof window<"u"&&(window.agoraClient||(window.agoraClient={}),window.agoraClient.isVoiceEnabled=C,window.agoraClient.microphoneTrack=$,window.agoraClient.client=We.current,window.dispatchEvent(new CustomEvent("VoiceToggled",{detail:{enabled:C}})),q.log("AgoraProvider: Updated window.agoraClient and dispatched event:",{isVoiceEnabled:C}))},[C,$]);const Je={client:We.current,isJoined:E,isVoiceEnabled:C,users:O,error:U,channel:W,appId:e,toggleVoice:Pe,leaveChannel:Te,joinChannel:ke,microphoneTrack:$,isReady:ce,createMicrophoneTrack:Le,isScreenSharing:Z,screenTrack:re,toggleScreenShare:ze,voiceDisabled:he};return w.jsx(hae.Provider,{value:Je,children:n})},pae=()=>{const n=N.useContext(hae);if(!n)throw new Error("useAgoraContext must be used within an AgoraProvider");return n};fae.propTypes={children:_n.node.isRequired,appId:_n.string.isRequired,channel:_n.string.isRequired,token:_n.string,uid:_n.oneOfType([_n.string,_n.number])};const cze=()=>{var ve,_e;const{client:n,isVoiceEnabled:e,isJoined:i,users:o,error:l,microphoneTrack:d,isReady:p,channel:_,appId:E,toggleVoice:b,joinChannel:C,leaveChannel:I,createMicrophoneTrack:O,isScreenSharing:L,screenTrack:U,toggleScreenShare:B,voiceDisabled:W}=pae(),[J,$]=N.useState(e!==void 0?e:((ve=window.agoraClient)==null?void 0:ve.isVoiceEnabled)||!1),[ie,ce]=N.useState(L!==void 0?L:((_e=window.agoraClient)==null?void 0:_e.isScreenSharing)||!1),[ne,de]=N.useState(W!==void 0?W:!1),[Q,Z]=N.useState(!0);N.useEffect(()=>{var Ee;e!==void 0?$(e):((Ee=window.agoraClient)==null?void 0:Ee.isVoiceEnabled)!==void 0?$(window.agoraClient.isVoiceEnabled):d&&$(!d.muted)},[e,d]),N.useEffect(()=>{var Ee;L!==void 0?ce(L):((Ee=window.agoraClient)==null?void 0:Ee.isScreenSharing)!==void 0&&ce(window.agoraClient.isScreenSharing)},[L]),N.useEffect(()=>{W!==void 0&&de(W)},[W]);const X=N.useRef({isVoiceEnabled:J,isScreenSharing:ie,isJoined:i,users:o,error:l,isReady:p,channel:_,appId:E,voiceDisabled:ne});N.useEffect(()=>{X.current={isVoiceEnabled:J,isScreenSharing:ie,isJoined:i,users:o,error:l,isReady:p,channel:_,appId:E,voiceDisabled:ne}},[J,ie,i,o,l,p,_,E,ne]),N.useEffect(()=>{const Ee=setTimeout(()=>{Z(!1)},5e3);return()=>clearTimeout(Ee)},[]),N.useEffect(()=>{p&&Z(!1)},[p]),N.useEffect(()=>{console.log("useVoiceChat context:",{contextIsVoiceEnabled:e,localVoiceEnabled:J,contextIsScreenSharing:L,localScreenSharing:ie,isJoined:i,users:o.length,error:l,isReady:p,channel:_,appId:E,hasMicrophoneTrack:!!d,trackMuted:d==null?void 0:d.muted,hasScreenTrack:!!U})},[e,J,L,ie,i,o,l,p,_,E,d,U]);const re=async()=>{try{console.log("useVoiceChat: Toggling voice from:",J);const Ee=await b();if(console.log("useVoiceChat: Toggle result:",Ee),Ee!==void 0)$(Ee);else{const ke=!J;$(ke),window.agoraClient&&(window.agoraClient.isVoiceEnabled=ke)}return Ee!==void 0?Ee:!J}catch(Ee){return console.error("useVoiceChat: Error toggling voice:",Ee),J}},pe=async()=>{try{console.log("useVoiceChat: Toggling screen share from:",ie);const Ee=await B();if(console.log("useVoiceChat: Screen share toggle result:",Ee),Ee!==void 0)ce(Ee);else{const ke=!ie;ce(ke),window.agoraClient&&(window.agoraClient.isScreenSharing=ke)}return Ee!==void 0?Ee:!ie}catch(Ee){return console.error("useVoiceChat: Error toggling screen share:",Ee),ie}},he=async()=>{J&&d&&await re()},ue=async()=>{!J&&d&&await re()},xe=Ee=>o.some(ke=>{var Te;return ke.uid===Ee&&((Te=ke.audioTrack)==null?void 0:Te.isPlaying)}),We=N.useCallback(()=>{if(!d||!J)return 0;try{return d.getVolumeLevel()}catch(Ee){return console.error("Error getting volume level:",Ee),0}},[d,J]);return{isVoiceEnabled:J,isScreenSharing:ie,isJoined:i,users:o,error:l,toggleVoice:re,toggleScreenShare:pe,mute:he,unmute:ue,isUserSpeaking:xe,getVolumeLevel:We,microphoneTrack:d,screenTrack:U,isLoading:Q,channel:_,appId:E,joinChannel:C,leaveChannel:I,client:n,setMicrophoneDevice:async Ee=>{try{if(!Ee){console.error("No device ID provided");return}if(!n||!i){console.error("Client not initialized or not joined to a channel");return}d&&(J&&await n.unpublish(d),await d.close());const ke=await ZC.createMicrophoneAudioTrack({microphoneId:Ee,encoderConfig:"music_standard"});O&&await O(ke),J&&await n.publish(ke),console.log("Microphone device changed successfully")}catch(ke){throw console.error("Error changing microphone device:",ke),ke}},voiceDisabled:ne}},lze=({size:n="md",tooltipPlacement:e="top",defaultMuted:i=!0,joinOnClick:o=!0,className:l="voice-button"})=>{const{isVoiceEnabled:d,toggleVoice:p,isJoined:_,joinChannel:E,channel:b,client:C,voiceDisabled:I}=cze(),[O,L]=N.useState(!1),[U,B]=N.useState(!1);N.useEffect(()=>{const $=()=>{q.log("VoiceButton: Player instantiated, showing button"),B(!0)};return window.addEventListener("PlayerInstantiated",$),window.isPlayerInstantiated&&(q.log("VoiceButton: Player was already instantiated"),B(!0)),()=>{window.removeEventListener("PlayerInstantiated",$)}},[]),N.useEffect(()=>{console.log("VoiceButton: State:",{isVoiceEnabled:d,isJoined:_,channel:b,hasClient:!!C,clientState:C==null?void 0:C.connectionState,windowAgoraClient:window.agoraClient,isPlayerReady:U,voiceDisabled:I})},[d,_,b,C,U,I]);const W=async()=>{if(!(O||I)){L(!0),console.log("VoiceButton: Handling click, current state:",{isVoiceEnabled:d,isJoined:_});try{if(!_&&o)try{console.log("VoiceButton: Not joined, attempting to join channel"),await E(),console.log("VoiceButton: Joined channel successfully")}catch(ie){ie.message&&ie.message.includes("already in connecting/connected state")?console.log("VoiceButton: Already connected to channel"):console.error("VoiceButton: Error joining channel:",ie)}console.log("VoiceButton: Toggling voice state from:",d);const $=await p();console.log("VoiceButton: Voice toggled, new state:",$)}catch($){console.error("VoiceButton: Error toggling voice:",$)}finally{L(!1)}}},J=()=>I?"Voice chat is disabled for this space":U?O?"Processing...":_?d?"Turn microphone off":"Turn microphone on":"Connecting to voice chat...":"Waiting for player to be ready...";return!U||I?null:w.jsx(Vp,{label:J(),placement:e,hasArrow:!0,children:w.jsxs(lt,{position:"relative",cursor:"pointer",onClick:W,children:[w.jsx($l,{size:n,borderRadius:"full",bg:d?"green.500":"red.500",icon:d?w.jsx(kF,{color:"white"}):w.jsx(OF,{color:"white"}),borderWidth:"1px",borderColor:"whiteAlpha.300",className:l,"data-testid":"voice-button"}),O&&w.jsx(lt,{position:"absolute",top:"0",left:"0",right:"0",bottom:"0",display:"flex",alignItems:"center",justifyContent:"center",bg:"rgba(0, 0, 0, 0.6)",borderRadius:"full",children:w.jsx(zd,{size:"sm",color:"white"})})]})})},uze=mi.createContext({user:null}),dze=({userNickname:n})=>{const{client:e,channel:i,screenTrack:o,isScreenSharing:l,toggleScreenShare:d}=pae(),[p,_]=N.useState([]),[E,b]=N.useState(!1),[C,I]=N.useState(!0);N.useRef({});const O=N.useRef(null);N.useRef(null);const{user:L}=N.useContext(uze)||{user:null},[U,B]=N.useState({}),W=N.useRef(o),[J,$]=N.useState(null),{isOpen:ie,onOpen:ce,onClose:ne}=pf(),[de,Q]=N.useState(!1),Z=N.useRef(null),X=N.useRef(null);N.useEffect(()=>{W.current=o},[o]),N.useEffect(()=>{if(!e||!i){b(!1);return}const xe=setTimeout(()=>{I(!1)},5e3);console.log("Setting up screen share display with existing client:",e),console.log("Current channel:",i);const We=e.connectionState;if(console.log("Current connection state:",We),We==="CONNECTED")b(!0),I(!1);else{b(!1);const $e=ve=>{console.log("Connection state changed:",ve),ve==="CONNECTED"?(b(!0),I(!1)):b(!1)};return e.on("connection-state-change",$e),()=>{e.off("connection-state-change",$e),clearTimeout(xe)}}return()=>{clearTimeout(xe)}},[e,i]),N.useEffect(()=>{const xe=async()=>{const We={...U};let $e=!1;for(const ve of p){if(U[ve.uid])continue;let _e=null,Ee=ve.uid;if(typeof Ee=="string"&&(Ee.includes("-")?(_e=Ee.split("-")[0],Ee=Ee.split("-")[1]):Ee.includes("_")&&(_e=Ee.split("_")[0],Ee=Ee.split("_")[1])),Ee)try{console.log("Trying to fetch nickname for user ID:",Ee);const ke=await Hu(Ee);ke&&ke.Nickname?(console.log("Found nickname in Firebase for user ID:",Ee,"Nickname:",ke.Nickname),We[ve.uid]=ke.Nickname,$e=!0):_e?(console.log("Using extracted name for user ID:",Ee,"Name:",_e),We[ve.uid]=_e,$e=!0):(We[ve.uid]="User",$e=!0)}catch(ke){console.error("Error fetching user profile:",ke),_e?(We[ve.uid]=_e,$e=!0):(We[ve.uid]="User",$e=!0)}else _e?(We[ve.uid]=_e,$e=!0):(We[ve.uid]="User",$e=!0)}$e&&B(We)};p.length>0&&xe()},[p,U]),N.useEffect(()=>{if(!e||!i||!E)return;console.log("Setting up screen share event handlers");const xe=async(ve,_e)=>{if(console.log("User published:",ve.uid,_e,ve),_e==="video"){console.log("Remote video track detected:",ve.uid);try{await e.subscribe(ve,_e),console.log("Subscribed to remote video track:",ve.uid),_(Ee=>Ee.some(ke=>ke.uid===ve.uid)?Ee:[...Ee,ve])}catch(Ee){console.error("Error subscribing to remote video track:",Ee)}}},We=(ve,_e)=>{if(console.log("User unpublished:",ve.uid,_e),_e==="video"){if(console.log("Remote video track unpublished:",ve.uid),ve.videoTrack)try{ve.videoTrack.stop()}catch(Ee){console.error("Error stopping video track:",Ee)}if(_(Ee=>Ee.filter(ke=>ke.uid!==ve.uid)),l&&W.current&&O.current)try{console.log("Ensuring local screen track is still playing after remote user unpublished"),W.current.play(O.current)}catch(Ee){console.error("Error replaying local screen track:",Ee)}}},$e=ve=>{console.log("User left:",ve.uid);const _e=p.find(Ee=>Ee.uid===ve.uid);if(_e&&_e.videoTrack)try{_e.videoTrack.stop()}catch(Ee){console.error("Error stopping video track:",Ee)}if(_(Ee=>Ee.filter(ke=>ke.uid!==ve.uid)),l&&W.current&&O.current)try{console.log("Ensuring local screen track is still playing after remote user left"),W.current.play(O.current)}catch(Ee){console.error("Error replaying local screen track:",Ee)}};return e.on("user-published",xe),e.on("user-unpublished",We),e.on("user-left",$e),()=>{e.off("user-published",xe),e.off("user-unpublished",We),e.off("user-left",$e)}},[e,i,E,p,l]),N.useEffect(()=>{if(console.log("Remote screens changed:",p.length,p),p.forEach(xe=>{if(xe.videoTrack)try{console.log("Playing video track for:",xe.uid),xe.videoTrack.play(`video-container-${xe.uid}`)}catch(We){console.error("Error playing video track:",We)}}),l&&W.current&&O.current)try{console.log("Ensuring local screen track is still playing after remote screens changed"),W.current.play(O.current)}catch(xe){console.error("Error replaying local screen track:",xe)}},[p,l]),N.useEffect(()=>{if(console.log("Local screen sharing state changed:",l,o),l&&o&&O.current)try{console.log("Playing local screen track"),o.play(O.current)}catch(xe){console.error("Error playing local screen track:",xe)}},[l,o]),N.useEffect(()=>()=>{if(p.forEach(xe=>{if(xe.videoTrack)try{xe.videoTrack.stop()}catch(We){console.error("Error stopping video track on unmount:",We)}}),o)try{o.stop()}catch(xe){console.error("Error stopping local screen track on unmount:",xe)}},[p,o]);const re=()=>{console.log("Stopping local screen share"),d()},pe=xe=>(console.log("Getting display name for UID:",xe,"type:",typeof xe),l&&L&&(xe===L.uid||xe===(e==null?void 0:e.uid))?n||"You":U[xe]?U[xe]:typeof xe=="string"?xe.includes("-")?xe.split("-")[0]:xe.includes("_")?xe.split("_")[0]:xe:"User"),he=xe=>{console.log("Opening modal for remote screen",xe),$(xe),ce()},ue=()=>{console.log("Opening modal for local screen"),$({isLocal:!0}),ce()};return N.useEffect(()=>{ie&&J?(console.log("Modal opened, activeScreen:",J),setTimeout(()=>{if(J.isLocal&&W.current)try{console.log("Playing local screen in modal"),W.current.play("modal-screen-container"),Q(!0)}catch(xe){console.error("Error playing local screen in modal:",xe)}else if(J.videoTrack)try{console.log("Playing remote screen in modal"),J.videoTrack.play("modal-screen-container"),Q(!0)}catch(xe){console.error("Error playing remote screen in modal:",xe)}},500)):ie||(Q(!1),$(null),setTimeout(()=>{if(l&&W.current)try{W.current.play("local-screen-container")}catch(xe){console.error("Error playing local screen in small container:",xe)}p.forEach(xe=>{if(xe.videoTrack)try{xe.videoTrack.play(`video-container-${xe.uid}`)}catch(We){console.error(`Error playing remote screen ${xe.uid} in small container:`,We)}})},500))},[ie,J,l,p]),!E||C&&p.length===0&&!l||p.length===0&&!l?null:w.jsxs(w.Fragment,{children:[!ie&&w.jsxs(lt,{position:"fixed",top:"20px",left:"20px",zIndex:1e4,overflow:"visible",ref:Z,children:[l&&o&&w.jsxs(lt,{position:"relative",mb:4,borderRadius:"md",overflow:"hidden",boxShadow:"xl",bg:"black",width:"200px",height:"120px",cursor:"pointer",transition:"all 0.2s",_hover:{filter:"brightness(0.8)",transform:"scale(1.05)"},onClick:ue,children:[w.jsx(lt,{id:"local-screen-container",width:"100%",height:"100%",position:"relative"}),w.jsx(lt,{position:"absolute",bottom:2,left:2,color:"white",fontSize:"xs",bg:"rgba(0,0,0,0.5)",px:2,py:1,borderRadius:"md",zIndex:5,children:n?`${n}'s Screen`:"Your Screen"})]}),p.map(xe=>{const We=U[xe.uid]||pe(xe.uid);return w.jsxs(lt,{position:"relative",mb:4,borderRadius:"md",overflow:"hidden",boxShadow:"xl",bg:"black",width:"200px",height:"120px",cursor:"pointer",transition:"all 0.2s",_hover:{filter:"brightness(0.8)",transform:"scale(1.05)"},onClick:()=>he(xe),children:[w.jsx(lt,{id:`video-container-${xe.uid}`,width:"100%",height:"100%",position:"relative"}),w.jsx(lt,{position:"absolute",bottom:2,left:2,color:"white",fontSize:"xs",bg:"rgba(0,0,0,0.5)",px:2,py:1,borderRadius:"md",zIndex:5,children:`${We}'s Screen`})]},xe.uid)})]}),ie&&w.jsx(lt,{position:"fixed",top:"0",left:"0",width:"100vw",height:"100vh",bg:"rgba(0,0,0,0.8)",zIndex:1e4,display:"flex",justifyContent:"center",alignItems:"center",onClick:ne,children:w.jsxs(lt,{width:"80vw",height:"80vh",bg:"black",borderRadius:"md",overflow:"hidden",position:"relative",onClick:xe=>xe.stopPropagation(),children:[!de&&w.jsxs(lt,{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",color:"white",textAlign:"center",children:[w.jsx(zd,{size:"xl"}),w.jsx(Ze,{mt:4,children:"Loading screen share..."})]}),w.jsx(lt,{id:"modal-screen-container",width:"100%",height:"100%",position:"relative",ref:X}),w.jsx(lt,{position:"absolute",top:2,right:2,color:"white",bg:"rgba(0,0,0,0.5)",borderRadius:"full",width:"30px",height:"30px",display:"flex",justifyContent:"center",alignItems:"center",cursor:"pointer",onClick:ne,children:""}),w.jsx(lt,{position:"absolute",bottom:4,left:4,color:"white",fontSize:"sm",bg:"rgba(0,0,0,0.5)",px:3,py:2,borderRadius:"md",children:J!=null&&J.isLocal?n?`${n}'s Screen`:"Your Screen":`${U[J==null?void 0:J.uid]||pe(J==null?void 0:J.uid)}'s Screen`}),(J==null?void 0:J.isLocal)&&w.jsx(lt,{position:"absolute",bottom:4,right:4,children:w.jsx(ur,{colorScheme:"red",size:"sm",onClick:re,children:"Stop Sharing"})})]})})]})},hze=({onClose:n})=>{const e=Ic(),[i,o]=N.useState(!1),[l,d]=N.useState(!1);N.useEffect(()=>{const E=()=>{window.agoraClient&&d(!!window.agoraClient.isScreenSharing)};E();const b=setInterval(E,1e3),C=()=>{E()};return window.addEventListener("ScreenShareToggled",C),()=>{clearInterval(b),window.removeEventListener("ScreenShareToggled",C)}},[]);const p=async E=>{if(E.preventDefault(),E.stopPropagation(),n&&n(),!window.agoraClient||!window.agoraClient.client){e({title:"Screen sharing not available",description:"Voice chat must be connected to use screen sharing",status:"warning",duration:3e3,isClosable:!0});return}try{if(o(!0),window.agoraClient.isJoined)_();else{console.log("ScreenShareMenuOption: Not joined to voice chat, joining automatically");const b=new CustomEvent("JoinVoiceChat",{detail:{callback:C=>{if(!C){console.error("ScreenShareMenuOption: Failed to join voice chat"),e({title:"Connection failed",description:"Could not connect to voice chat",status:"error",duration:3e3,isClosable:!0}),o(!1);return}_()}}});window.dispatchEvent(b)}}catch(b){console.error("Error in screen share handler:",b),o(!1),e({title:"Screen sharing error",description:b.message||"Failed to toggle screen sharing",status:"error",duration:5e3,isClosable:!0})}},_=async()=>{try{const E=new CustomEvent("ToggleScreenShare",{detail:{callback:(b,C)=>{o(!1),b?(d(C),e(C?{title:"Screen sharing started",status:"success",duration:3e3,isClosable:!0}:{title:"Screen sharing stopped",status:"info",duration:3e3,isClosable:!0})):e({title:"Screen sharing error",description:"Failed to toggle screen sharing",status:"error",duration:5e3,isClosable:!0})}}});window.dispatchEvent(E)}catch(E){console.error("Error toggling screen share:",E),o(!1),e({title:"Screen sharing error",description:E.message||"Failed to toggle screen sharing",status:"error",duration:5e3,isClosable:!0})}};return w.jsx(Ze,{fontSize:"md",cursor:"pointer",_hover:{bg:"whiteAlpha.200"},p:2,borderRadius:"md",onClick:p,color:l?"red.300":"white",children:i?"Connecting...":l?"Stop Screen Sharing":"Share Screen"})};function fze({open:n,onClose:e}){const[i,o]=N.useState(0);return w.jsxs(oo,{isOpen:n,onClose:e,size:"md",isCentered:!0,children:[w.jsx(co,{backdropFilter:"blur(4px)"}),w.jsxs(ao,{bg:"rgba(23, 25, 35, 0.95)",color:"white",borderRadius:"md",boxShadow:"0 4px 20px rgba(0, 0, 0, 0.5)",maxW:"600px",h:"350px",overflow:"hidden",children:[w.jsx(tc,{borderBottom:"1px solid",borderColor:"whiteAlpha.200",py:2,fontSize:"md",fontWeight:"600",children:"Controls"}),w.jsx(Ko,{size:"sm",color:"whiteAlpha.700",_hover:{color:"white",bg:"whiteAlpha.100"}}),w.jsx(Ro,{p:0,display:"flex",children:w.jsxs(A0,{orientation:"vertical",variant:"unstyled",index:i,onChange:o,display:"flex",flexGrow:1,children:[w.jsxs(P0,{bg:"rgba(0, 0, 0, 0.2)",w:"80px",py:4,borderRight:"1px solid",borderColor:"whiteAlpha.200",children:[w.jsxs(Sa,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[w.jsx(En,{as:j8e,mb:1}),w.jsx(Ze,{fontSize:"xs",children:"Movement"})]}),w.jsxs(Sa,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[w.jsx(En,{as:B8e,mb:1}),w.jsx(Ze,{fontSize:"xs",children:"Camera"})]}),w.jsxs(Sa,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[w.jsx(En,{as:V8e,mb:1}),w.jsx(Ze,{fontSize:"xs",children:"Actions"})]}),w.jsxs(Sa,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[w.jsx(En,{as:F8e,mb:1}),w.jsx(Ze,{fontSize:"xs",children:"Tips"})]})]}),w.jsxs(BC,{flexGrow:1,display:"flex",flexDirection:"column",children:[w.jsxs(Tc,{p:4,display:"flex",flexDirection:"column",h:"100%",children:[w.jsx(Ze,{fontSize:"sm",fontWeight:"600",mb:3,color:"blue.300",children:"Movement Controls"}),w.jsxs(wr,{wrap:"wrap",gap:3,children:[w.jsx(Ul,{keyLabel:"W",description:"Move Forward"}),w.jsx(Ul,{keyLabel:"A",description:"Move Left"}),w.jsx(Ul,{keyLabel:"S",description:"Move Backward"}),w.jsx(Ul,{keyLabel:"D",description:"Move Right"}),w.jsx(Ul,{keyLabel:"Shift",description:"Run"}),w.jsx(Ul,{keyLabel:"Space",description:"Jump / Double Jump"})]})]}),w.jsxs(Tc,{p:4,display:"flex",flexDirection:"column",h:"100%",children:[w.jsx(Ze,{fontSize:"sm",fontWeight:"600",mb:3,color:"blue.300",children:"Camera Controls"}),w.jsxs(wr,{wrap:"wrap",gap:3,children:[w.jsx(Ul,{keyLabel:"Mouse",description:"Look Around"}),w.jsx(Ul,{keyLabel:"Click + Drag",description:"Rotate Camera"}),w.jsx(Ul,{keyLabel:"Scroll",description:"Zoom In/Out"})]})]}),w.jsxs(Tc,{p:4,display:"flex",flexDirection:"column",h:"100%",children:[w.jsx(Ze,{fontSize:"sm",fontWeight:"600",mb:3,color:"blue.300",children:"Action Controls"}),w.jsxs(wr,{wrap:"wrap",gap:3,children:[w.jsx(Ul,{keyLabel:"E",description:"Interact"}),w.jsx(Ul,{keyLabel:"F",description:"Emote Menu"}),w.jsx(Ul,{keyLabel:"T",description:"Chat"}),w.jsx(Ul,{keyLabel:"M",description:"Mute Mic"})]})]}),w.jsxs(Tc,{p:4,display:"flex",flexDirection:"column",h:"100%",children:[w.jsx(Ze,{fontSize:"sm",fontWeight:"600",mb:3,color:"blue.300",children:"Tips & Tricks"}),w.jsxs(Qr,{align:"stretch",spacing:2,children:[w.jsx(Ze,{fontSize:"xs",children:" Double-tap Shift to auto-run"}),w.jsx(Ze,{fontSize:"xs",children:" Press ESC to access settings"}),w.jsx(Ze,{fontSize:"xs",children:" Click on players to view their profile"}),w.jsx(Ze,{fontSize:"xs",children:" Use the minimap to navigate"})]})]})]})]})})]})]})}const Ul=({keyLabel:n,description:e})=>w.jsx(lt,{bg:"whiteAlpha.100",borderRadius:"md",p:2,minW:"120px",maxW:"180px",children:w.jsxs(pi,{spacing:2,children:[w.jsx(lt,{bg:"whiteAlpha.200",borderRadius:"md",px:2,py:1,fontSize:"xs",fontWeight:"bold",minW:"30px",textAlign:"center",children:n}),w.jsx(Ze,{fontSize:"xs",children:e})]})}),pze=()=>{const[n,e]=N.useState([]),[i,o]=N.useState(""),[l,d]=N.useState(0),[p,_]=N.useState(100),[E,b]=N.useState(100),[C,I]=N.useState(!0),[O,L]=N.useState(!0),[U,B]=N.useState(!1);N.useEffect(()=>{(async()=>{try{await navigator.mediaDevices.getUserMedia({audio:!0});const ne=await ZC.getMicrophones();e(ne),ne.length>0&&o(ne[0].deviceId)}catch(ne){console.error("Error getting audio devices:",ne)}})()},[]),N.useEffect(()=>{const ce=setInterval(()=>{d(U?Math.random()*50:0)},100);return()=>clearInterval(ce)},[U]);const W=ce=>{const ne=ce.target.value;o(ne),console.log("Microphone changed to:",ne)},J=ce=>{_(ce),console.log("Microphone volume set to:",ce)},$=ce=>{b(ce),console.log("Speaker volume set to:",ce)},ie=()=>{B(!U)};return w.jsxs(Qr,{spacing:6,align:"stretch",children:[w.jsxs(kr,{children:[w.jsxs($i,{children:["Microphone",w.jsx(Pp,{ml:2,colorScheme:U?"green":"red",children:U?"Enabled":"Muted"})]}),w.jsxs(Ore,{value:i,onChange:W,bg:"gray.700",borderColor:"gray.600",_hover:{borderColor:"gray.500"},children:[n.map(ce=>w.jsx("option",{value:ce.deviceId,children:ce.label||`Microphone ${ce.deviceId.slice(0,5)}...`},ce.deviceId)),n.length===0&&w.jsx("option",{value:"",children:"No microphones found"})]})]}),w.jsxs(lt,{children:[w.jsx(Ze,{mb:2,children:"Microphone Level"}),w.jsx(jy,{value:l,colorScheme:"green",size:"sm",borderRadius:"md",hasStripe:l>20,isAnimated:l>20})]}),w.jsxs(kr,{children:[w.jsxs($i,{children:["Microphone Volume: ",p,"%"]}),w.jsxs(BV,{value:p,onChange:J,min:0,max:100,step:1,colorScheme:"blue",children:[w.jsx(zV,{bg:"gray.700",children:w.jsx(GV,{})}),w.jsx(WV,{boxSize:6})]})]}),w.jsxs(kr,{children:[w.jsxs($i,{children:["Speaker Volume: ",E,"%"]}),w.jsxs(BV,{value:E,onChange:$,min:0,max:100,step:1,colorScheme:"blue",children:[w.jsx(zV,{bg:"gray.700",children:w.jsx(GV,{})}),w.jsx(WV,{boxSize:6})]})]}),w.jsxs(kr,{display:"flex",alignItems:"center",children:[w.jsx($i,{mb:"0",children:"Microphone Enabled"}),w.jsx(cf,{isChecked:U,onChange:ie,colorScheme:"green",size:"lg"})]}),w.jsxs(kr,{display:"flex",alignItems:"center",children:[w.jsx($i,{mb:"0",children:"Echo Cancellation"}),w.jsx(cf,{isChecked:C,onChange:()=>I(!C),colorScheme:"green",size:"lg"})]}),w.jsxs(kr,{display:"flex",alignItems:"center",children:[w.jsx($i,{mb:"0",children:"Noise Suppression"}),w.jsx(cf,{isChecked:O,onChange:()=>L(!O),colorScheme:"green",size:"lg"})]}),w.jsxs(Ip,{status:"info",borderRadius:"md",children:[w.jsx(Ap,{}),"Note: These settings will be applied when you join a voice chat."]})]})};function mze({open:n,onClose:e,containerRef:i}){return w.jsx(Yl,{containerRef:i,children:w.jsxs(oo,{isOpen:n,onClose:e,size:"lg",isCentered:!0,children:[w.jsx(co,{}),w.jsxs(ao,{bg:"gray.900",color:"white",borderRadius:"lg",children:[w.jsx(tc,{children:"Settings"}),w.jsx(Ko,{size:"lg",bg:"gray.700",color:"white",borderRadius:"full",_hover:{bg:"gray.600"},_focus:{boxShadow:"none"}}),w.jsx(Ro,{children:w.jsxs(A0,{variant:"enclosed",children:[w.jsxs(P0,{mb:4,children:[w.jsx(Sa,{_selected:{color:"white",borderBottom:"2px solid white"},children:"Audio"}),w.jsx(Sa,{_selected:{color:"white",borderBottom:"2px solid white"},children:"Graphics"})]}),w.jsxs(BC,{children:[w.jsx(Tc,{children:w.jsx(lt,{p:4,bg:"gray.800",borderRadius:"md",children:w.jsx(pze,{})})}),w.jsx(Tc,{children:w.jsx(lt,{p:4,bg:"gray.800",borderRadius:"md",children:"Graphics settings content goes here."})})]})]})})]})]})})}function gze(n){return Cr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"circle",attr:{cx:"12",cy:"8",r:"7"}},{tag:"polyline",attr:{points:"8.21 13.89 7 23 12 20 17 23 15.79 13.88"}}]})(n)}function _ze(n){return Cr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"}},{tag:"circle",attr:{cx:"12",cy:"13",r:"4"}}]})(n)}function HQ(n){return Cr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"rect",attr:{x:"2",y:"2",width:"20",height:"20",rx:"2.18",ry:"2.18"}},{tag:"line",attr:{x1:"7",y1:"2",x2:"7",y2:"22"}},{tag:"line",attr:{x1:"17",y1:"2",x2:"17",y2:"22"}},{tag:"line",attr:{x1:"2",y1:"12",x2:"22",y2:"12"}},{tag:"line",attr:{x1:"2",y1:"7",x2:"7",y2:"7"}},{tag:"line",attr:{x1:"2",y1:"17",x2:"7",y2:"17"}},{tag:"line",attr:{x1:"17",y1:"17",x2:"22",y2:"17"}},{tag:"line",attr:{x1:"17",y1:"7",x2:"22",y2:"7"}}]})(n)}function Py(n){return Cr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"rect",attr:{x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2"}},{tag:"circle",attr:{cx:"8.5",cy:"8.5",r:"1.5"}},{tag:"polyline",attr:{points:"21 15 16 10 5 21"}}]})(n)}function mae(n){return Cr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"circle",attr:{cx:"12",cy:"12",r:"10"}},{tag:"line",attr:{x1:"12",y1:"16",x2:"12",y2:"12"}},{tag:"line",attr:{x1:"12",y1:"8",x2:"12.01",y2:"8"}}]})(n)}function yze(n){return Cr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"}},{tag:"path",attr:{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"}}]})(n)}function Eze(n){return Cr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"circle",attr:{cx:"12",cy:"12",r:"3"}},{tag:"path",attr:{d:"M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"}}]})(n)}function vze(n){return Cr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polygon",attr:{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"}}]})(n)}function m0(n){return Cr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polyline",attr:{points:"3 6 5 6 21 6"}},{tag:"path",attr:{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"}},{tag:"line",attr:{x1:"10",y1:"11",x2:"10",y2:"17"}},{tag:"line",attr:{x1:"14",y1:"11",x2:"14",y2:"17"}}]})(n)}function Uk(n){return Cr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}},{tag:"polyline",attr:{points:"17 8 12 3 7 8"}},{tag:"line",attr:{x1:"12",y1:"3",x2:"12",y2:"15"}}]})(n)}function $Q(n){return Cr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"}},{tag:"circle",attr:{cx:"9",cy:"7",r:"4"}},{tag:"path",attr:{d:"M23 21v-2a4 4 0 0 0-3-3.87"}},{tag:"path",attr:{d:"M16 3.13a4 4 0 0 1 0 7.75"}}]})(n)}function ZS(n){return Cr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polygon",attr:{points:"23 7 16 12 23 17 23 7"}},{tag:"rect",attr:{x:"1",y:"5",width:"15",height:"14",rx:"2",ry:"2"}}]})(n)}function Sze(n){return Cr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polygon",attr:{points:"11 5 6 9 2 9 2 15 6 15 11 19 11 5"}},{tag:"path",attr:{d:"M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"}}]})(n)}const bze=async()=>{try{q.log("tagsFirestore: Fetching all tags");const n=Qp(dr,"tags"),e=await Zy(n),i=[];return e.forEach(o=>{i.push({id:o.id,...o.data()})}),i}catch(n){throw q.error("tagsFirestore: Error fetching tags:",n),n}},Tze=async n=>{try{q.log(`tagsFirestore: Fetching tag with ID: ${n}`);const e=Vr(dr,"tags",n),i=await $o(e);return i.exists()?{id:i.id,...i.data()}:(q.warn(`tagsFirestore: Tag with ID ${n} not found`),null)}catch(e){throw q.error(`tagsFirestore: Error fetching tag with ID ${n}:`,e),e}},wze=async({id:n,name:e,color:i,description:o})=>{try{q.log(`tagsFirestore: Creating new tag: ${e}`);const l={name:e,color:i||"#808080",description:o||"",createdAt:new Date,updatedAt:new Date};let d;if(n){const p=Vr(dr,"tags",n);await j0(p,l),d=n}else{const p=Qp(dr,"tags");d=(await ABe(p,l)).id}return{id:d,...l}}catch(l){throw q.error("tagsFirestore: Error creating tag:",l),l}},Cze=async(n,e)=>{try{q.log(`tagsFirestore: Adding tag ${e} to space ${n}`);const i=Vr(dr,"tags",e);if(!(await $o(i)).exists())throw new Error(`Tag with ID ${e} does not exist`);const l=Vr(dr,"spaces",n);return await Ys(l,{tags:PBe(e)}),!0}catch(i){throw q.error(`tagsFirestore: Error adding tag ${e} to space ${n}:`,i),i}},Rze=async(n,e)=>{try{q.log(`tagsFirestore: Removing tag ${e} from space ${n}`);const i=Vr(dr,"spaces",n);return await Ys(i,{tags:OBe(e)}),!0}catch(i){throw q.error(`tagsFirestore: Error removing tag ${e} from space ${n}:`,i),i}},Ize=async n=>{try{q.log(`tagsFirestore: Getting tags for space ${n}`);const e=Vr(dr,"spaces",n),i=await $o(e);if(!i.exists())throw new Error(`Space with ID ${n} not found`);const l=i.data().tags||[];if(l.length===0)return[];const d=[];for(const p of l){const _=await Tze(p);_&&d.push(_)}return d}catch(e){throw q.error(`tagsFirestore: Error getting tags for space ${n}:`,e),e}},Aze=async()=>{q.log("tagsFirestore: Initializing default tags");const n=[{id:"collaboration",name:"Collaboration",color:"#4287f5",description:"Spaces designed for team collaboration and meetings"},{id:"social",name:"Social",color:"#f54242",description:"Social gathering and networking spaces"},{id:"education",name:"Education",color:"#42f581",description:"Learning and educational environments"},{id:"events",name:"Events",color:"#f5a742",description:"Spaces optimized for hosting events"},{id:"showcase",name:"Showcase",color:"#9f42f5",description:"Spaces for exhibiting content and creations"},{id:"entertainment",name:"Entertainment",color:"#f542b3",description:"Entertainment and leisure spaces"},{id:"productivity",name:"Productivity",color:"#42dbf5",description:"Spaces focused on work and productivity"},{id:"featured",name:"Featured",color:"#f5f242",description:"Featured and highlighted spaces"}];try{let e=0,i=0;for(const o of n){q.log(`tagsFirestore: Processing tag: ${o.name}`);const l=Vr(dr,"tags",o.id);(await $o(l)).exists()?(q.log(`tagsFirestore: Tag ${o.id} already exists, skipping`),i++):(await wze(o),e++,q.log(`tagsFirestore: Created tag: ${o.name}`))}return q.log(`tagsFirestore: Tags initialization complete. Created: ${e}, Skipped: ${i}`),{created:e,skipped:i}}catch(e){throw q.error("tagsFirestore: Error initializing default tags:",e),e}},gae=({spaceID:n})=>{const[e,i]=N.useState([]),[o,l]=N.useState([]),[d,p]=N.useState(!0),[_,E]=N.useState(!1),[b,C]=N.useState(!1),[I,O]=N.useState(null),{isOpen:L,onOpen:U,onClose:B}=pf(),W=Ic(),{user:J}=N.useContext(Ao),$=(J==null?void 0:J.groups)&&(J.groups.includes("disruptiveAdmin")||J.groups.includes("admin"));N.useEffect(()=>{ie()},[n]);const ie=async()=>{p(!0);try{let X=[];try{X=await bze(),i(X)}catch(re){q.error("SpaceTagsManager: Error loading available tags:",re),i([]),W({title:"Error loading tags",description:"Failed to load available tags. Please try again later.",status:"error",duration:3e3,isClosable:!0})}if(n)try{const re=await Ize(n);l(re)}catch(re){q.error("SpaceTagsManager: Error loading space tags:",re),l([]),W({title:"Error loading space tags",description:"Failed to load this space's tags. Please try again later.",status:"error",duration:3e3,isClosable:!0})}}catch(X){q.error("SpaceTagsManager: Error in loadTags:",X),W({title:"Error loading tags",description:"Failed to load tags. Please try again later.",status:"error",duration:3e3,isClosable:!0})}finally{p(!1)}},ce=async()=>{C(!0),O(null);try{const X=await Aze();console.log("Tag initialization result:",X),O(X),W({title:"Tags initialized",description:`Successfully created ${X.created} tags. Skipped ${X.skipped} existing tags.`,status:"success",duration:4e3,isClosable:!0}),await ie()}catch(X){q.error("SpaceTagsManager: Error initializing tags:",X),O(!1),W({title:"Error initializing tags",description:"Failed to initialize tags. Please try again later.",status:"error",duration:4e3,isClosable:!0})}finally{C(!1)}},ne=async X=>{if(!(!n||!X)){E(!0);try{await Cze(n,X);const re=e.find(pe=>pe.id===X);re&&l(pe=>[...pe,re]),W({title:"Tag added",description:"Tag has been added to the space.",status:"success",duration:2e3,isClosable:!0})}catch(re){q.error(`SpaceTagsManager: Error adding tag ${X} to space:`,re),W({title:"Error adding tag",description:"Failed to add tag to the space.",status:"error",duration:3e3,isClosable:!0})}finally{E(!1)}}},de=async X=>{if(!(!n||!X)){E(!0);try{await Rze(n,X),l(re=>re.filter(pe=>pe.id!==X)),W({title:"Tag removed",description:"Tag has been removed from the space.",status:"info",duration:2e3,isClosable:!0})}catch(re){q.error(`SpaceTagsManager: Error removing tag ${X} from space:`,re),W({title:"Error removing tag",description:"Failed to remove tag from the space.",status:"error",duration:3e3,isClosable:!0})}finally{E(!1)}}},Q=()=>{const X=o.map(re=>re.id);return e.filter(re=>!X.includes(re.id))},Z=Q().length===0;return w.jsxs(lt,{children:[w.jsx(wr,{mb:3,justifyContent:"space-between",alignItems:"center",children:w.jsxs(pi,{spacing:2,ml:"auto",children:[$&&w.jsx(ur,{size:"xs",leftIcon:w.jsx(mWe,{}),onClick:U,variant:"outline",colorScheme:"purple",children:"Admin"}),w.jsxs(mR,{children:[w.jsx(gR,{as:ur,size:"xs",leftIcon:w.jsx(pWe,{}),rightIcon:w.jsx(Voe,{}),isDisabled:d||_||Z,children:Z?"No Available Tags":"Add Tag"}),w.jsx(_R,{zIndex:1e3,bg:"gray.800",borderColor:"gray.700",color:"white",children:Q().length>0?Q().map(X=>w.jsx(Md,{onClick:()=>ne(X.id),icon:w.jsx(lt,{width:"12px",height:"12px",borderRadius:"full",bg:X.color||"#888"}),_hover:{bg:"gray.700"},_focus:{bg:"gray.700"},_active:{bg:"gray.700"},_focusVisible:{bg:"gray.700"},bg:"gray.800",color:"white",children:X.name},X.id)):w.jsx(Md,{isDisabled:!0,bg:"gray.800",color:"gray.400",children:"No available tags to add"})})]})]})}),d?w.jsx(wr,{justify:"center",py:4,children:w.jsx(zd,{size:"sm",color:"blue.300"})}):e.length===0?w.jsx(lt,{children:w.jsxs(Ze,{fontSize:"sm",color:"red.400",mb:2,children:["No tags have been created in the system yet.",$?" Use the Admin button to initialize tags.":" Ask an admin to initialize tags."]})}):o.length===0?w.jsx(Ze,{fontSize:"sm",color:"gray.400",fontStyle:"italic",children:"No tags assigned to this space."}):w.jsx(Bre,{spacing:2,children:o.map(X=>w.jsx(f4,{children:w.jsxs(Mre,{size:"md",borderRadius:"full",variant:"subtle",colorScheme:"gray",boxShadow:`0 0 0 1px ${X.color||"#888"}`,children:[w.jsx(lt,{width:"8px",height:"8px",borderRadius:"full",bg:X.color||"#888",mr:1}),w.jsx(Ure,{children:X.name}),w.jsx(Fre,{onClick:()=>de(X.id),isDisabled:_})]})},X.id))}),w.jsxs(oo,{isOpen:L,onClose:B,size:"md",children:[w.jsx(co,{backdropFilter:"blur(4px)"}),w.jsxs(ao,{bg:"gray.800",color:"white",children:[w.jsx(tc,{fontSize:"md",children:"Tag System Administration"}),w.jsx(Ko,{}),w.jsxs(Ro,{children:[w.jsx(Ze,{fontSize:"sm",mb:4,children:"Initialize the default tags in your Firestore database. This will create a set of predefined tags if they don't already exist."}),I&&w.jsxs(Ip,{status:"success",mb:4,borderRadius:"md",size:"sm",children:[w.jsx(Ap,{}),w.jsxs(Ze,{fontSize:"sm",children:["Tags initialized. Created: ",w.jsx("b",{children:I.created}),", Skipped: ",w.jsx("b",{children:I.skipped})]})]}),w.jsx(ur,{colorScheme:"blue",onClick:ce,isLoading:b,loadingText:"Initializing...",size:"sm",width:"full",children:"Initialize Default Tags"})]}),w.jsx($p,{children:w.jsx(ur,{variant:"ghost",size:"sm",onClick:B,children:"Close"})})]})]})]})};gae.propTypes={spaceID:_n.string.isRequired};const Pze=({isOpen:n,onClose:e})=>{const{spaceID:i}=Ra(),[o,l]=N.useState(0),[d,p]=N.useState(""),[_,E]=N.useState(""),[b,C]=N.useState(!1),[I,O]=N.useState(null),[L,U]=N.useState(null),[B,W]=N.useState(!1),[J,$]=N.useState(0),[ie,ce]=N.useState(null),ne=N.useRef(null),[de,Q]=N.useState(null),[Z,X]=N.useState(null),[re,pe]=N.useState(!1),[he,ue]=N.useState(0),[xe,We]=N.useState(null),$e=N.useRef(null),[ve,_e]=N.useState(null),[Ee,ke]=N.useState(null),[Te,be]=N.useState(!1),[Pe,Le]=N.useState(0),[ze,Je]=N.useState(null),et=N.useRef(null),[ut,rt]=N.useState([]),[It,pn]=N.useState([]),[Ft,an]=N.useState(!1),[en,Xt]=N.useState(!1),[Vn,Kt]=N.useState(!0),[Re,Ve]=N.useState(!1),[Ge,ft]=N.useState(!1),[gt,St]=N.useState(""),[Wt,mn]=N.useState(""),[vn,tn]=N.useState(""),[vt,nr]=N.useState(!1),{setHLSStreamUrl:Dt,savedStreamData:Ut}=tae(),gn=Ic();N.useEffect(()=>{n&&i&&Li()},[n,i]);const Li=async()=>{try{const _t=await Bp(i);_t.logoUrl&&ce(_t.logoUrl),_t.backgroundUrl&&We(_t.backgroundUrl),_t.videoBackgroundUrl&&Je(_t.videoBackgroundUrl),_t.voiceDisabled!==void 0&&Xt(_t.voiceDisabled),_t.accessibleToAllUsers!==void 0&&Kt(_t.accessibleToAllUsers),p(_t.name||""),E(_t.description||"");try{const hn=await Loe(i);if(hn){St(hn.streamUrl||""),mn(hn.rtmpUrl||""),tn(hn.streamKey||"");const yr=hn.enabled===!0;ft(yr),q.log("SpaceManageModal: Directly loaded streaming enabled state from Firebase:",{enabled:yr,rawValue:hn.enabled})}else ft(!1),q.log("SpaceManageModal: No stream data found in Firebase, defaulting enabled to false")}catch(hn){if(q.error("Error fetching stream data directly:",hn),Ut){St(Ut.streamUrl||""),mn(Ut.rtmpUrl||""),tn(Ut.streamKey||"");const yr=Ut.enabled===!0;ft(yr),q.log("SpaceManageModal: Loaded streaming enabled state from savedStreamData:",{enabled:yr,rawValue:Ut.enabled})}else ft(!1),q.log("SpaceManageModal: No savedStreamData available, defaulting enabled to false")}Es(_t)}catch(_t){q.error("Error fetching space data:",_t),gn({title:"Error",description:"Failed to load space data",status:"error",duration:3e3,isClosable:!0})}};N.useEffect(()=>{if(Ut){if(!vt){St(Ut.streamUrl||""),mn(Ut.rtmpUrl||""),tn(Ut.streamKey||"");const _t=Ut.enabled===!0;ft(_t),q.log("SpaceManageModal: Updated streaming enabled state from savedStreamData:",{enabled:_t,rawValue:Ut.enabled})}}else n&&!vt&&q.log("SpaceManageModal: No savedStreamData available but NOT defaulting enabled to false (preserving current state)")},[Ut,vt,n]);const Es=async _t=>{if(i&&n){an(!0);try{const hn=gF(),yr=`space_${i}_owners`,_i=S1(Qp(hn,"users"),sQ("groups","array-contains",yr)),Oo=await Zy(_i),uo=[];for(const Ri of Oo.docs){const ho=Ri.data(),zi=await Hu(Ri.id);uo.push({uid:Ri.id,email:ho.email,displayName:ho.displayName||zi.Nickname||"Unknown User",photoURL:ho.photoURL||zi.photoURL,firstName:zi.firstName,lastName:zi.lastName})}rt(uo);const Xl=`space_${i}_hosts`,Tf=S1(Qp(hn,"users"),sQ("groups","array-contains",Xl)),gl=await Zy(Tf),Jl=[];for(const Ri of gl.docs){const ho=Ri.data(),zi=await Hu(Ri.id);Jl.push({uid:Ri.id,email:ho.email,displayName:ho.displayName||zi.Nickname||"Unknown User",photoURL:ho.photoURL||zi.photoURL,firstName:zi.firstName,lastName:zi.lastName})}pn(Jl)}catch(hn){q.error("Error fetching space users:",hn),gn({title:"Error",description:"Failed to load space users",status:"error",duration:3e3,isClosable:!0})}finally{an(!1)}}};N.useEffect(()=>{i&&n&&o===4&&Es()},[i,n,o]);const ci=_t=>{const hn=_t.target.files[0];if(hn){if(!hn.type.startsWith("image/")){gn({title:"Invalid file type",description:"Please select an image file",status:"error",duration:5e3,isClosable:!0});return}O(hn);const yr=new FileReader;yr.onloadend=()=>{U(yr.result)},yr.readAsDataURL(hn)}},qo=_t=>{const hn=_t.target.files[0];if(hn){if(!hn.type.startsWith("image/")){gn({title:"Invalid file type",description:"Please select an image file",status:"error",duration:5e3,isClosable:!0});return}Q(hn);const yr=new FileReader;yr.onloadend=()=>{X(yr.result)},yr.readAsDataURL(hn)}},ic=_t=>{const hn=_t.target.files[0];if(hn){if(!hn.type.startsWith("video/")){gn({title:"Invalid file type",description:"Please select a video file",status:"error",duration:5e3,isClosable:!0});return}const yr=5*1024*1024;if(hn.size>yr){gn({title:"File too large",description:"Video file must be smaller than 5MB",status:"error",duration:5e3,isClosable:!0});return}_e(hn);const _i=new FileReader;_i.onloadend=()=>{ke(_i.result)},_i.readAsDataURL(hn)}},Xs=async()=>{if(!I){gn({title:"No file selected",description:"Please select a file to upload",status:"warning",duration:5e3,isClosable:!0});return}try{W(!0);const _t=setInterval(()=>{$(yr=>{const _i=yr+10;return _i>=90?90:_i})},300),hn=await sWe(i,I);clearInterval(_t),$(100),ce(hn),gn({title:"Upload successful",description:"Space logo has been updated",status:"success",duration:5e3,isClosable:!0}),setTimeout(()=>{O(null),U(null),$(0),W(!1)},1e3),window.dispatchEvent(new CustomEvent("SpaceLogoUpdated",{detail:{logoUrl:hn}}))}catch(_t){console.error("Error uploading logo:",_t),gn({title:"Upload failed",description:_t.message||"An error occurred during upload",status:"error",duration:5e3,isClosable:!0}),W(!1),$(0)}},Js=async()=>{if(!de){gn({title:"No file selected",description:"Please select a file to upload",status:"warning",duration:5e3,isClosable:!0});return}try{pe(!0);const _t=setInterval(()=>{ue(yr=>{const _i=yr+10;return _i>=90?90:_i})},300),hn=await aWe(i,de);clearInterval(_t),ue(100),We(hn),gn({title:"Upload successful",description:"Space background has been updated",status:"success",duration:5e3,isClosable:!0}),setTimeout(()=>{Q(null),X(null),ue(0),pe(!1)},1e3),window.dispatchEvent(new CustomEvent("SpaceBackgroundUpdated",{detail:{backgroundUrl:hn}}))}catch(_t){console.error("Error uploading background:",_t),gn({title:"Upload failed",description:_t.message||"An error occurred during upload",status:"error",duration:5e3,isClosable:!0}),pe(!1),ue(0)}},Ac=async()=>{if(ie)try{W(!0),await oWe(i),ce(null),gn({title:"Logo removed",description:"Space logo has been removed",status:"info",duration:5e3,isClosable:!0}),W(!1),window.dispatchEvent(new CustomEvent("SpaceLogoUpdated",{detail:{logoUrl:null}}))}catch(_t){console.error("Error deleting logo:",_t),gn({title:"Deletion failed",description:_t.message||"An error occurred during deletion",status:"error",duration:5e3,isClosable:!0}),W(!1)}},vs=async()=>{if(xe)try{pe(!0),await cWe(i),We(null),gn({title:"Background removed",description:"Space background has been removed",status:"info",duration:5e3,isClosable:!0}),pe(!1),window.dispatchEvent(new CustomEvent("SpaceBackgroundUpdated",{detail:{backgroundUrl:null}}))}catch(_t){console.error("Error deleting background:",_t),gn({title:"Deletion failed",description:_t.message||"An error occurred during deletion",status:"error",duration:5e3,isClosable:!0}),pe(!1)}},Ia=async()=>{if(!ve){gn({title:"No file selected",description:"Please select a file to upload",status:"warning",duration:5e3,isClosable:!0});return}try{be(!0);const _t=setInterval(()=>{Le(yr=>{const _i=yr+10;return _i>=90?90:_i})},300),hn=await dWe(i,ve);clearInterval(_t),Le(100),Je(hn),gn({title:"Upload successful",description:"Space video background has been updated",status:"success",duration:5e3,isClosable:!0}),setTimeout(()=>{_e(null),ke(null),Le(0),be(!1)},1e3),window.dispatchEvent(new CustomEvent("SpaceVideoBackgroundUpdated",{detail:{videoBackgroundUrl:hn}}))}catch(_t){console.error("Error uploading video background:",_t),gn({title:"Upload failed",description:_t.message||"An error occurred during upload",status:"error",duration:5e3,isClosable:!0}),be(!1),Le(0)}},Po=async()=>{if(ze)try{be(!0),await hWe(i),Je(null),gn({title:"Video background removed",description:"Space video background has been removed",status:"info",duration:5e3,isClosable:!0}),be(!1),window.dispatchEvent(new CustomEvent("SpaceVideoBackgroundUpdated",{detail:{videoBackgroundUrl:null}}))}catch(_t){console.error("Error deleting video background:",_t),gn({title:"Deletion failed",description:_t.message||"An error occurred during deletion",status:"error",duration:5e3,isClosable:!0}),be(!1)}},Aa=()=>{ne.current&&ne.current.click()},sc=()=>{$e.current&&$e.current.click()},ml=()=>{et.current&&et.current.click()},Pa=async()=>{Ve(!0);try{await lWe(i,{voiceDisabled:!en}),Xt(!en),gn({title:"Settings Updated",description:`Voice chat has been ${en?"enabled":"disabled"} for this space.`,status:"success",duration:3e3,isClosable:!0})}catch(_t){q.error("Error updating voice settings:",_t),gn({title:"Error",description:"Failed to update voice settings",status:"error",duration:3e3,isClosable:!0})}finally{Ve(!1)}},oc=async()=>{Ve(!0);try{await uWe(i,!Vn),Kt(!Vn),gn({title:"Settings Updated",description:`Space is now ${Vn?"not accessible":"accessible"} to all users.`,status:"success",duration:3e3,isClosable:!0})}catch(_t){q.error("Error updating accessibility settings:",_t),gn({title:"Error",description:"Failed to update accessibility settings",status:"error",duration:3e3,isClosable:!0})}finally{Ve(!1)}},lo=async()=>{if(i){C(!0);try{const _t=gF(),hn=Vr(_t,"spaces",i);await Ys(hn,{name:d,description:_}),gn({title:"Success",description:"Space details updated successfully",status:"success",duration:3e3,isClosable:!0}),window.dispatchEvent(new CustomEvent("SpaceDetailsUpdated",{detail:{name:d,description:_}}))}catch(_t){q.error("Error updating space details:",_t),gn({title:"Error",description:"Failed to update space details",status:"error",duration:3e3,isClosable:!0})}finally{C(!1)}}},Mi=async()=>{if(i){nr(!0);try{const _t={enabled:Ge,streamUrl:gt,rtmpUrl:Wt,streamKey:vn,playerIndex:"0",updatedAt:new Date().toISOString()};q.log("SpaceManageModal: Saving stream settings to Firebase:",{enabled:Ge,url:gt,hasRtmp:!!Wt,hasKey:!!vn});try{await vF(i,_t),q.log("SpaceManageModal: Successfully updated stream settings in Firebase directly")}catch(hn){throw q.error("SpaceManageModal: Error updating stream settings directly in Firebase:",hn),hn}await Dt(gt,0,{enabled:Ge,rtmpUrl:Wt,streamKey:vn}),window.dispatchEvent(new CustomEvent("StreamSettingsChanged",{detail:{enabled:Ge,spaceId:i}})),gn({title:"Success",description:`Stream settings updated successfully. Streaming is now ${Ge?"enabled":"disabled"}.`,status:"success",duration:3e3,isClosable:!0}),setTimeout(()=>{Li()},500)}catch(_t){q.error("Error updating stream settings:",_t),gn({title:"Error",description:"Failed to update stream settings",status:"error",duration:3e3,isClosable:!0})}finally{nr(!1)}}};return w.jsxs(oo,{isOpen:n,onClose:e,size:"lg",isCentered:!0,children:[w.jsx(co,{backdropFilter:"blur(4px)"}),w.jsxs(ao,{bg:"rgba(23, 25, 35, 0.95)",color:"white",borderRadius:"md",boxShadow:"0 4px 20px rgba(0, 0, 0, 0.5)",maxW:"800px",maxH:"90vh",overflow:"hidden",children:[w.jsx(tc,{borderBottom:"1px solid",borderColor:"whiteAlpha.200",py:2,fontSize:"md",fontWeight:"600",children:"Manage Space"}),w.jsx(Ko,{size:"sm",color:"whiteAlpha.700",_hover:{color:"white",bg:"whiteAlpha.100"}}),w.jsx(Ro,{p:0,display:"flex",overflow:"hidden",children:w.jsxs(A0,{orientation:"vertical",variant:"unstyled",index:o,onChange:l,display:"flex",width:"100%",height:"100%",children:[w.jsxs(P0,{bg:"rgba(0, 0, 0, 0.2)",w:"80px",py:4,borderRight:"1px solid",borderColor:"whiteAlpha.200",flexShrink:0,children:[w.jsxs(Sa,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[w.jsx(En,{as:mae,mb:1}),w.jsx(Ze,{fontSize:"xs",children:"Details"})]}),w.jsxs(Sa,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[w.jsx(En,{as:Py,mb:1}),w.jsx(Ze,{fontSize:"xs",children:"Logo"})]}),w.jsxs(Sa,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[w.jsx(En,{as:_ze,mb:1}),w.jsx(Ze,{fontSize:"xs",children:"Background"})]}),w.jsxs(Sa,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[w.jsx(En,{as:Eze,mb:1}),w.jsx(Ze,{fontSize:"xs",children:"Settings"})]}),w.jsxs(Sa,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[w.jsx(En,{as:$Q,mb:1}),w.jsx(Ze,{fontSize:"xs",children:"Users"})]}),w.jsxs(Sa,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[w.jsx(En,{as:ZS,mb:1}),w.jsx(Ze,{fontSize:"xs",children:"Stream"})]})]}),w.jsxs(BC,{flexGrow:1,display:"flex",flexDirection:"column",overflowY:"auto",css:{"&::-webkit-scrollbar":{width:"8px"},"&::-webkit-scrollbar-track":{background:"rgba(0,0,0,0.1)"},"&::-webkit-scrollbar-thumb":{background:"rgba(255,255,255,0.3)",borderRadius:"4px"}},children:[w.jsxs(Tc,{p:4,display:"flex",flexDirection:"column",children:[w.jsx(Ze,{fontSize:"sm",fontWeight:"600",mb:3,color:"blue.300",children:"Space Details"}),w.jsxs(Qr,{spacing:4,align:"stretch",children:[w.jsxs(kr,{children:[w.jsx($i,{fontSize:"xs",children:"Space Name"}),w.jsx(oi,{value:d,onChange:_t=>p(_t.target.value),placeholder:"Enter space name",size:"sm",bg:"whiteAlpha.100",borderColor:"whiteAlpha.200",_hover:{borderColor:"whiteAlpha.300"},_focus:{borderColor:"blue.300",boxShadow:"0 0 0 1px #63B3ED"},color:"white",maxLength:100})]}),w.jsxs(kr,{children:[w.jsx($i,{fontSize:"xs",children:"Description"}),w.jsx(jre,{value:_,onChange:_t=>E(_t.target.value),placeholder:"Enter space description",size:"sm",bg:"whiteAlpha.100",borderColor:"whiteAlpha.200",_hover:{borderColor:"whiteAlpha.300"},_focus:{borderColor:"blue.300",boxShadow:"0 0 0 1px #63B3ED"},rows:4,resize:"vertical",maxLength:500})]}),w.jsxs(kr,{children:[w.jsx($i,{fontSize:"xs",children:"Space Tags"}),w.jsx(lt,{p:3,bg:"whiteAlpha.50",borderWidth:"1px",borderColor:"whiteAlpha.200",borderRadius:"md",children:i?w.jsx(gae,{spaceID:i}):w.jsxs(Ip,{status:"warning",variant:"subtle",borderRadius:"md",children:[w.jsx(Ap,{}),w.jsx(XS,{fontSize:"sm",children:"Space ID missing"}),w.jsx(JS,{fontSize:"xs",children:"Unable to load tags without a valid space ID."})]})})]}),w.jsx(ur,{colorScheme:"blue",size:"sm",onClick:lo,isLoading:b,loadingText:"Saving...",alignSelf:"flex-start",mt:2,children:"Save Details"})]})]}),w.jsxs(Tc,{p:4,display:"flex",flexDirection:"column",children:[w.jsx(Ze,{fontSize:"sm",fontWeight:"600",mb:3,color:"blue.300",children:"Space Logo"}),w.jsx(Ze,{fontSize:"xs",mb:4,children:"Upload a logo for your space. This will be displayed during loading."}),(ie||L)&&w.jsxs(wr,{direction:{base:"column",md:"row"},gap:4,mb:4,children:[ie&&w.jsxs(lt,{borderWidth:"1px",borderRadius:"md",p:3,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",flex:"1",children:[w.jsx(Ze,{fontSize:"xs",fontWeight:"medium",mb:2,children:"Current Logo"}),w.jsx(Jh,{src:ie,alt:"Space Logo",maxH:"120px",mx:"auto",objectFit:"contain"}),w.jsx(ur,{mt:3,colorScheme:"red",leftIcon:w.jsx(En,{as:m0}),onClick:Ac,isLoading:B,loadingText:"Removing...",size:"xs",variant:"ghost",children:"Remove Logo"})]}),L&&w.jsxs(lt,{borderWidth:"1px",borderRadius:"md",p:3,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",flex:"1",children:[w.jsx(Ze,{fontSize:"xs",fontWeight:"medium",mb:2,children:"Preview"}),w.jsx(Jh,{src:L,alt:"Preview",maxH:"120px",mx:"auto",objectFit:"contain"})]})]}),w.jsxs(kr,{children:[w.jsx($i,{fontSize:"xs",children:"Upload New Logo"}),w.jsx(oi,{type:"file",accept:"image/*",onChange:ci,ref:ne,display:"none"}),B&&w.jsxs(lt,{mt:3,mb:3,children:[w.jsxs(Ze,{fontSize:"xs",mb:1,children:["Uploading... ",J,"%"]}),w.jsx(jy,{value:J,size:"xs",colorScheme:"blue",borderRadius:"full"})]}),w.jsxs(pi,{mt:3,spacing:3,children:[w.jsx(ur,{colorScheme:"blue",leftIcon:w.jsx(En,{as:Py}),onClick:Aa,isDisabled:B,size:"sm",variant:"outline",children:"Browse"}),w.jsx(ur,{colorScheme:"green",leftIcon:w.jsx(En,{as:Uk}),onClick:Xs,isLoading:B,loadingText:"Uploading...",isDisabled:!I||B,size:"sm",children:"Upload"})]}),w.jsx(Uy,{fontSize:"xs",color:"whiteAlpha.700",mt:2,children:"Recommended: PNG format with transparent background. Max height: 400px."})]})]}),w.jsxs(Tc,{p:4,display:"flex",flexDirection:"column",children:[w.jsx(Ze,{fontSize:"sm",fontWeight:"600",mb:3,color:"blue.300",children:"Background"}),w.jsx(Ze,{fontSize:"xs",mb:4,children:"Upload a background for your space. This will be displayed during loading."}),w.jsxs(A0,{variant:"enclosed",colorScheme:"blue",size:"md",mb:4,borderColor:"blue.300",children:[w.jsxs(P0,{children:[w.jsxs(Sa,{fontSize:"sm",fontWeight:"medium",_selected:{color:"blue.300",bg:"whiteAlpha.200"},p:3,children:[w.jsx(En,{as:Py,mr:2}),"Image"]}),w.jsxs(Sa,{fontSize:"sm",fontWeight:"medium",_selected:{color:"blue.300",bg:"whiteAlpha.200"},p:3,children:[w.jsx(En,{as:HQ,mr:2}),"Video (max 5MB)"]})]}),w.jsxs(BC,{mt:4,children:[w.jsxs(Tc,{p:0,children:[(xe||Z)&&w.jsxs(wr,{direction:{base:"column",md:"row"},gap:4,mb:4,children:[xe&&w.jsxs(lt,{borderWidth:"1px",borderRadius:"md",p:3,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",flex:"1",children:[w.jsx(Ze,{fontSize:"xs",fontWeight:"medium",mb:2,children:"Current Background"}),w.jsx(Jh,{src:xe,alt:"Space Background",maxH:"120px",mx:"auto",objectFit:"contain"}),w.jsx(ur,{mt:3,colorScheme:"red",leftIcon:w.jsx(En,{as:m0}),onClick:vs,isLoading:re,loadingText:"Removing...",size:"xs",variant:"ghost",children:"Remove Background"})]}),Z&&w.jsxs(lt,{borderWidth:"1px",borderRadius:"md",p:3,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",flex:"1",children:[w.jsx(Ze,{fontSize:"xs",fontWeight:"medium",mb:2,children:"Preview"}),w.jsx(Jh,{src:Z,alt:"Preview",maxH:"120px",mx:"auto",objectFit:"contain"})]})]}),w.jsxs(kr,{children:[w.jsx($i,{fontSize:"xs",children:"Upload New Background Image"}),w.jsx(oi,{type:"file",accept:"image/*",onChange:qo,ref:$e,display:"none"}),re&&w.jsxs(lt,{mt:3,mb:3,children:[w.jsxs(Ze,{fontSize:"xs",mb:1,children:["Uploading... ",he,"%"]}),w.jsx(jy,{value:he,size:"xs",colorScheme:"blue",borderRadius:"full"})]}),w.jsxs(pi,{mt:3,spacing:3,children:[w.jsx(ur,{colorScheme:"blue",leftIcon:w.jsx(En,{as:Py}),onClick:sc,isDisabled:re,size:"sm",variant:"outline",children:"Browse"}),w.jsx(ur,{colorScheme:"green",leftIcon:w.jsx(En,{as:Uk}),onClick:Js,isLoading:re,loadingText:"Uploading...",isDisabled:!de||re,size:"sm",children:"Upload"})]}),w.jsx(Uy,{fontSize:"xs",color:"whiteAlpha.700",mt:2,children:"Recommended: High-quality image (1920x1080 or higher) that works well with the frosted glass overlay."})]})]}),w.jsxs(Tc,{p:0,children:[(ze||Ee)&&w.jsxs(wr,{direction:{base:"column",md:"row"},gap:4,mb:4,children:[ze&&w.jsxs(lt,{borderWidth:"1px",borderRadius:"md",p:3,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",flex:"1",children:[w.jsx(Ze,{fontSize:"xs",fontWeight:"medium",mb:2,children:"Current Video Background"}),w.jsx(lt,{maxH:"160px",overflow:"hidden",position:"relative",children:w.jsx("video",{src:ze,controls:!0,muted:!0,style:{width:"100%",maxHeight:"120px",objectFit:"contain"}})}),w.jsx(ur,{mt:3,colorScheme:"red",leftIcon:w.jsx(En,{as:m0}),onClick:Po,isLoading:Te,loadingText:"Removing...",size:"xs",variant:"ghost",children:"Remove Video"})]}),Ee&&w.jsxs(lt,{borderWidth:"1px",borderRadius:"md",p:3,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",flex:"1",children:[w.jsx(Ze,{fontSize:"xs",fontWeight:"medium",mb:2,children:"Preview"}),w.jsx(lt,{maxH:"160px",overflow:"hidden",children:w.jsx("video",{src:Ee,controls:!0,muted:!0,style:{width:"100%",maxHeight:"120px",objectFit:"contain"}})})]})]}),w.jsxs(kr,{children:[w.jsx($i,{fontSize:"xs",children:"Upload New Video Background"}),w.jsx(oi,{type:"file",accept:"video/*",onChange:ic,ref:et,display:"none"}),Te&&w.jsxs(lt,{mt:3,mb:3,children:[w.jsxs(Ze,{fontSize:"xs",mb:1,children:["Uploading... ",Pe,"%"]}),w.jsx(jy,{value:Pe,size:"xs",colorScheme:"blue",borderRadius:"full"})]}),w.jsxs(pi,{mt:3,spacing:3,children:[w.jsx(ur,{colorScheme:"blue",leftIcon:w.jsx(En,{as:HQ}),onClick:ml,isDisabled:Te,size:"sm",variant:"outline",children:"Browse"}),w.jsx(ur,{colorScheme:"green",leftIcon:w.jsx(En,{as:Uk}),onClick:Ia,isLoading:Te,loadingText:"Uploading...",isDisabled:!ve||Te,size:"sm",children:"Upload"})]}),w.jsx(Uy,{fontSize:"xs",color:"whiteAlpha.700",mt:2,children:"Recommended: MP4 format. Maximum file size: 5MB. Short looping videos work best."})]})]})]})]})]}),w.jsxs(Tc,{p:4,display:"flex",flexDirection:"column",children:[w.jsx(Ze,{fontSize:"sm",fontWeight:"600",mb:3,color:"blue.300",children:"Space Settings"}),w.jsx(Ze,{fontSize:"xs",mb:4,children:"Configure settings for your space."}),w.jsxs(Qr,{spacing:4,align:"stretch",children:[w.jsx(lt,{borderWidth:"1px",borderRadius:"md",p:3,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",children:w.jsxs(pi,{justify:"space-between",align:"center",children:[w.jsxs(lt,{children:[w.jsxs(pi,{mb:1,spacing:2,children:[w.jsxs(lt,{position:"relative",w:"16px",h:"16px",children:[w.jsx(En,{as:Sze,color:en?"red.400":"green.400"}),en&&w.jsx(lt,{position:"absolute",top:"50%",left:"0",right:"0",height:"2px",bg:"red.400",transform:"rotate(45deg)",transformOrigin:"center"})]}),w.jsx(Ze,{fontSize:"sm",fontWeight:"600",children:"Voice Chat"})]}),w.jsx(Ze,{fontSize:"xs",color:"whiteAlpha.800",children:en?"Voice chat is currently disabled for all users in this space.":"Voice chat is currently enabled for all users in this space."})]}),w.jsx(cf,{isChecked:!en,onChange:Pa,colorScheme:"green",size:"md",isDisabled:Re})]})}),w.jsx(lt,{borderWidth:"1px",borderRadius:"md",p:3,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",children:w.jsxs(pi,{justify:"space-between",align:"center",children:[w.jsxs(lt,{children:[w.jsxs(pi,{mb:1,spacing:2,children:[w.jsx(lt,{position:"relative",w:"16px",h:"16px",children:w.jsx(En,{as:$Q,color:Vn?"green.400":"red.400"})}),w.jsx(Ze,{fontSize:"sm",fontWeight:"600",children:"Public Access"})]}),w.jsx(Ze,{fontSize:"xs",color:"whiteAlpha.800",children:Vn?"This space is accessible to all users in the 'users' group.":"This space is only accessible to specific users."}),w.jsx(Ze,{fontSize:"xs",color:"blue.300",mt:1,children:"Note: Space owners and hosts will always have access regardless of this setting."})]}),w.jsx(cf,{isChecked:Vn,onChange:oc,colorScheme:"green",size:"md",isDisabled:Re})]})}),w.jsxs(Ip,{status:"info",variant:"subtle",bg:"whiteAlpha.100",borderRadius:"md",borderWidth:"1px",borderColor:"blue.800",children:[w.jsx(Ap,{color:"blue.300"}),w.jsxs(lt,{children:[w.jsx(XS,{fontSize:"xs",fontWeight:"medium",children:"Coming Soon"}),w.jsx(JS,{fontSize:"xs",children:"Additional space configuration options will be available in a future update."})]})]})]})]}),w.jsxs(Tc,{p:4,display:"flex",flexDirection:"column",children:[w.jsx(Ze,{fontSize:"sm",fontWeight:"600",mb:3,color:"blue.300",children:"Manage Users"}),w.jsx(Ze,{fontSize:"xs",mb:4,children:"View and manage the owners and hosts of this space."}),Ft?w.jsx(wr,{justify:"center",align:"center",h:"200px",children:w.jsx(zd,{color:"blue.300"})}):w.jsxs(Qr,{spacing:4,align:"stretch",children:[w.jsxs(lt,{children:[w.jsxs(pi,{mb:2,children:[w.jsx(En,{as:gze,color:"green.400"}),w.jsx(Ze,{fontSize:"sm",fontWeight:"600",children:"Owners"}),w.jsx(Pp,{colorScheme:"green",ml:2,children:ut.length})]}),w.jsx(lt,{borderWidth:"1px",borderRadius:"md",p:2,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",maxH:"120px",overflowY:"auto",css:{"&::-webkit-scrollbar":{width:"4px"},"&::-webkit-scrollbar-track":{background:"rgba(0,0,0,0.1)"},"&::-webkit-scrollbar-thumb":{background:"rgba(255,255,255,0.3)",borderRadius:"2px"}},children:ut.length===0?w.jsx(Ze,{fontSize:"xs",color:"whiteAlpha.600",children:"No owners found"}):w.jsx(Qr,{spacing:1,align:"stretch",children:ut.map(_t=>w.jsxs(pi,{spacing:2,p:1,borderRadius:"md",_hover:{bg:"whiteAlpha.100"},children:[w.jsx($l,{size:"xs",src:_t.photoURL,name:_t.displayName}),w.jsxs(lt,{children:[w.jsx(Ze,{fontSize:"xs",children:_t.displayName}),w.jsx(Ze,{fontSize:"xs",color:"whiteAlpha.600",children:_t.firstName&&_t.lastName?`${_t.firstName} ${_t.lastName}`:"Full name not available"})]}),w.jsx(Zk,{}),w.jsx(Pp,{colorScheme:"green",variant:"solid",fontSize:"2xs",children:"Owner"})]},_t.uid))})})]}),w.jsxs(lt,{children:[w.jsxs(pi,{mb:2,children:[w.jsx(En,{as:vze,color:"purple.400"}),w.jsx(Ze,{fontSize:"sm",fontWeight:"600",children:"Hosts"}),w.jsx(Pp,{colorScheme:"purple",ml:2,children:It.length})]}),w.jsx(lt,{borderWidth:"1px",borderRadius:"md",p:2,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",maxH:"120px",overflowY:"auto",css:{"&::-webkit-scrollbar":{width:"4px"},"&::-webkit-scrollbar-track":{background:"rgba(0,0,0,0.1)"},"&::-webkit-scrollbar-thumb":{background:"rgba(255,255,255,0.3)",borderRadius:"2px"}},children:It.length===0?w.jsx(Ze,{fontSize:"xs",color:"whiteAlpha.600",children:"No hosts found"}):w.jsx(Qr,{spacing:1,align:"stretch",children:It.map(_t=>w.jsxs(pi,{spacing:2,p:1,borderRadius:"md",_hover:{bg:"whiteAlpha.100"},children:[w.jsx($l,{size:"xs",src:_t.photoURL,name:_t.displayName}),w.jsxs(lt,{children:[w.jsx(Ze,{fontSize:"xs",children:_t.displayName}),w.jsx(Ze,{fontSize:"xs",color:"whiteAlpha.600",children:_t.firstName&&_t.lastName?`${_t.firstName} ${_t.lastName}`:"Full name not available"})]}),w.jsx(Zk,{}),w.jsx(Pp,{colorScheme:"purple",variant:"solid",fontSize:"2xs",children:"Host"})]},_t.uid))})})]}),w.jsx(of,{borderColor:"whiteAlpha.200"}),w.jsxs(Ip,{status:"info",variant:"subtle",bg:"whiteAlpha.100",borderRadius:"md",borderWidth:"1px",borderColor:"blue.800",py:2,fontSize:"xs",children:[w.jsx(Ap,{color:"blue.300",boxSize:4}),w.jsxs(lt,{children:[w.jsx(XS,{fontSize:"xs",fontWeight:"medium",children:"Coming Soon"}),w.jsx(JS,{fontSize:"xs",children:"User management features like adding/removing hosts and owners will be available in a future update."})]})]})]})]}),w.jsxs(Tc,{p:4,display:"flex",flexDirection:"column",children:[w.jsx(Ze,{fontSize:"sm",fontWeight:"600",mb:3,color:"blue.300",children:"Stream Settings"}),w.jsxs(Qr,{spacing:4,align:"stretch",children:[w.jsx(lt,{borderWidth:"1px",borderRadius:"md",p:3,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",children:w.jsxs(pi,{justify:"space-between",align:"center",children:[w.jsx(lt,{children:w.jsxs(pi,{mb:1,spacing:2,children:[w.jsx(lt,{position:"relative",w:"16px",h:"16px",children:w.jsx(En,{as:ZS,color:Ge?"green.400":"red.400"})}),w.jsx(Ze,{fontSize:"sm",fontWeight:"600",children:"Streaming Enabled"})]})}),w.jsx(cf,{isChecked:Ge,onChange:async()=>{const _t=!Ge;ft(_t),nr(!0);try{q.log("SpaceManageModal: Auto-saving streaming enabled state:",_t);const hn={enabled:_t,streamUrl:gt||"",rtmpUrl:Wt||"",streamKey:vn||"",playerIndex:"0",updatedAt:new Date().toISOString()};try{await vF(i,hn),q.log("SpaceManageModal: Successfully updated streaming enabled state in Firebase directly")}catch(yr){throw q.error("SpaceManageModal: Error updating streaming state directly in Firebase:",yr),yr}await Dt(gt,0,{enabled:_t,rtmpUrl:Wt,streamKey:vn}),window.dispatchEvent(new CustomEvent("StreamSettingsChanged",{detail:{enabled:_t,spaceId:i}})),gn({title:"Streaming "+(_t?"Enabled":"Disabled"),description:`Streaming is now ${_t?"enabled":"disabled"}.`,status:"success",duration:2e3,isClosable:!0})}catch(hn){q.error("Error auto-saving streaming state:",hn),ft(!_t),gn({title:"Error",description:"Failed to update streaming status",status:"error",duration:3e3,isClosable:!0})}finally{nr(!1),setTimeout(()=>{Li()},500)}},colorScheme:"green",size:"md",isDisabled:vt})]})}),w.jsxs(lt,{borderWidth:"1px",borderRadius:"md",p:4,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",children:[w.jsx(Ze,{fontSize:"sm",fontWeight:"600",mb:3,children:"Stream Configuration"}),w.jsxs(kr,{mb:4,children:[w.jsx($i,{fontSize:"xs",children:"Stream URL"}),w.jsx(oi,{value:gt,onChange:_t=>St(_t.target.value),placeholder:"https://example.com/stream.m3u8",size:"sm",bg:"whiteAlpha.100",borderColor:"whiteAlpha.200",_hover:{borderColor:"whiteAlpha.300"},_focus:{borderColor:"blue.300",boxShadow:"0 0 0 1px #63B3ED"},color:"white",isDisabled:vt})]}),w.jsx(of,{my:3,borderColor:"whiteAlpha.200"}),w.jsx(Ze,{fontSize:"sm",fontWeight:"600",mb:3,children:"RTMP Configuration"}),w.jsxs(kr,{mb:3,children:[w.jsx($i,{fontSize:"xs",children:"RTMP URL"}),w.jsx(oi,{value:Wt,onChange:_t=>mn(_t.target.value),placeholder:"rtmp://example.com/live",size:"sm",bg:"whiteAlpha.100",borderColor:"whiteAlpha.200",_hover:{borderColor:"whiteAlpha.300"},_focus:{borderColor:"blue.300",boxShadow:"0 0 0 1px #63B3ED"},color:"white",isDisabled:vt})]}),w.jsxs(kr,{mb:3,children:[w.jsx($i,{fontSize:"xs",children:"Stream Key"}),w.jsx(oi,{value:vn,onChange:_t=>tn(_t.target.value),placeholder:"xxxxxxxxxxxxxxxxxxxxxxxx",size:"sm",bg:"whiteAlpha.100",borderColor:"whiteAlpha.200",_hover:{borderColor:"whiteAlpha.300"},_focus:{borderColor:"blue.300",boxShadow:"0 0 0 1px #63B3ED"},color:"white",isDisabled:vt,type:"password"})]})]}),w.jsx(ur,{colorScheme:"blue",size:"sm",onClick:Mi,isLoading:vt,loadingText:"Saving...",alignSelf:"flex-start",mt:2,display:Ge?"inline-flex":"none",children:"Save Stream Settings"}),w.jsxs(Ip,{status:"info",variant:"subtle",bg:"whiteAlpha.100",borderRadius:"md",borderWidth:"1px",borderColor:"blue.800",mt:2,mb:8,children:[w.jsx(Ap,{color:"blue.300"}),w.jsxs(lt,{children:[w.jsx(XS,{fontSize:"xs",fontWeight:"medium",children:"HLS Streaming"}),w.jsx(JS,{fontSize:"xs",children:"After saving, the stream will be available on all screens. Player index: 0"})]})]})]})]})]})]})})]})]})},Oze=({onTogglePlayerList:n,spaceID:e})=>{const{fullscreenRef:i}=Gd(),[o,l]=N.useState(!0),[d,p]=N.useState(!1),[_,E]=N.useState(!1),[b,C]=N.useState(!1),[I,O]=N.useState(!1),[L,U]=N.useState(!1),[B,W]=N.useState(null),[J,$]=N.useState(!1),[ie,ce]=N.useState(!1),[ne,de]=N.useState(!1),[Q,Z]=N.useState(!1),X=Ic(),{user:re}=N.useContext(Ao),pe=(re==null?void 0:re.Nickname)||"Unknown",[he,ue]=N.useState(!1),xe=async()=>{if(re!=null&&re.uid&&e)try{const be=await Hu(re.uid);let Pe=!1,Le=!1;if(be.groups){const Je=`space_${e}_owners`,et=`space_${e}_hosts`;Pe=be.groups.includes(Je),Le=be.groups.includes(et)}const ze=await p3(re.uid,"disruptiveAdmin");if(Z(ze),W({rpmURL:be.rpmURL?be.rpmURL.replace(".glb",".png?scene=fullbody-portrait-closeupfront&w=640&q=75"):null}),ce(Pe||ze),de(Le),!Pe&&!ze&&J){$(!1);const Je=new CustomEvent("editModeChanged",{detail:{enabled:!1}});window.dispatchEvent(Je),X({title:"Edit Mode Disabled",description:"You don't have permission to edit this space.",status:"warning",duration:5e3,isClosable:!0,position:"top"})}}catch(be){console.error("Error fetching profile data:",be),ce(!1),de(!1),Z(!1)}else ce(!1),de(!1),Z(!1)};N.useEffect(()=>{xe()},[re==null?void 0:re.uid,e,J]),N.useEffect(()=>{const be=()=>{l(!0)};return window.addEventListener("PlayerInstantiated",be),()=>{window.removeEventListener("PlayerInstantiated",be)}},[]),N.useEffect(()=>{(async()=>{try{window.agoraClient&&typeof window.agoraClient.voiceDisabled=="boolean"&&ue(window.agoraClient.voiceDisabled)}catch(Le){console.error("Error checking if voice is disabled:",Le)}})();const Pe=Le=>{Le.detail&&typeof Le.detail.voiceDisabled=="boolean"&&(console.log("Voice setting changed:",Le.detail.voiceDisabled),ue(Le.detail.voiceDisabled))};return window.addEventListener("SpaceVoiceSettingChanged",Pe),()=>{window.removeEventListener("SpaceVoiceSettingChanged",Pe)}},[]);const We=()=>E(!_),$e=()=>C(!b),ve=()=>{U(!L),ke()},_e=()=>{O(!1),xe()},Ee=be=>{be.stopPropagation(),typeof n=="function"&&(q.log("CanvasMainMenu: Toggling player list"),n())},ke=()=>{p(!1)},Te=be=>{if(be.stopPropagation(),!ie){X({title:"Permission Denied",description:"You don't have permission to edit this space. Only space owners can use Edit Mode.",status:"error",duration:5e3,isClosable:!0,position:"top"});return}const Pe=!J;$(Pe);const Le=new CustomEvent("editModeChanged",{detail:{enabled:Pe}});window.dispatchEvent(Le),X({title:Pe?"Edit Mode Enabled":"Edit Mode Disabled",description:Pe?"You can now make changes to the scene.":"Scene editing is now disabled.",status:Pe?"info":"success",duration:3e3,isClosable:!0,position:"top"})};return w.jsxs(w.Fragment,{children:[w.jsxs(mR,{isOpen:d,onClose:()=>p(!1),children:[w.jsx(gR,{as:Ho,icon:w.jsx(EWe,{}),"aria-label":"Main menu",variant:"ghost",color:"white",bg:d?"whiteAlpha.400":"whiteAlpha.200",_hover:{bg:d?"whiteAlpha.500":"whiteAlpha.300"},size:"md",onClick:()=>p(!d)}),w.jsx(Yl,{containerRef:i,children:w.jsx(_R,{bg:"rgba(0,0,0,0.4)",backdropFilter:"blur(10px)",border:"none",boxShadow:"lg",color:"white",width:"300px",p:4,borderRadius:"xl",zIndex:9999,transform:"none !important",children:w.jsxs(Qr,{align:"stretch",spacing:4,children:[w.jsxs(pi,{children:[w.jsx($l,{size:"md",src:B==null?void 0:B.rpmURL,bg:"white",name:" ",borderWidth:"1px",borderColor:"whiteAlpha.300"}),w.jsxs(Qr,{align:"start",spacing:0,children:[w.jsxs(pi,{children:[w.jsx(Ze,{fontWeight:"bold",children:pe}),ie&&!Q&&w.jsx(Vp,{label:"Owner",placement:"top",hasArrow:!0,zIndex:1e4,openDelay:300,gutter:8,portalProps:{containerRef:i},children:w.jsx(lt,{display:"inline-block",children:w.jsx(En,{as:PF,color:"green.400",boxSize:3})})}),!ie&&ne&&!Q&&w.jsx(Vp,{label:"Host",placement:"top",hasArrow:!0,zIndex:1e4,openDelay:300,gutter:8,portalProps:{containerRef:i},children:w.jsx(lt,{display:"inline-block",children:w.jsx(En,{as:NF,color:"purple.400",boxSize:3})})}),Q&&w.jsx(Vp,{label:"Admin",placement:"top",hasArrow:!0,zIndex:1e4,openDelay:300,gutter:8,portalProps:{containerRef:i},children:w.jsx(lt,{display:"inline-block",children:w.jsx(En,{as:z8e,color:"blue.400",boxSize:3})})})]}),w.jsx(Ze,{fontSize:"sm",color:"whiteAlpha.800",children:"Spaces Metaverse"})]})]}),w.jsxs(pi,{spacing:4,justify:"center",children:[w.jsx(Ho,{icon:w.jsx(H8e,{}),variant:"ghost",colorScheme:"whiteAlpha",size:"sm","aria-label":"People",_hover:{bg:"whiteAlpha.200"},onClick:Ee}),ie&&w.jsx(Ho,{icon:w.jsx(M8e,{}),variant:"ghost",colorScheme:J?"green":"whiteAlpha",size:"sm","aria-label":"Edit Mode",_hover:{bg:"whiteAlpha.200"},onClick:Te}),w.jsx(Ho,{icon:w.jsx(lt,{w:"4",h:"4"}),variant:"ghost",colorScheme:"whiteAlpha",size:"sm","aria-label":"Action 3",_hover:{bg:"whiteAlpha.200"}}),w.jsx(Ho,{icon:w.jsx(lt,{w:"4",h:"4"}),variant:"ghost",colorScheme:"whiteAlpha",size:"sm","aria-label":"Action 4",_hover:{bg:"whiteAlpha.200"}})]}),w.jsx(of,{borderColor:"whiteAlpha.300"}),w.jsxs(Qr,{align:"stretch",spacing:2,children:[ie&&w.jsxs(pi,{p:2,borderRadius:"md",_hover:{bg:"whiteAlpha.200"},onClick:be=>be.stopPropagation(),justify:"space-between",children:[w.jsx(Ze,{fontSize:"md",children:"Edit Mode"}),w.jsx(cf,{id:"edit-mode-toggle",isChecked:J,onChange:Te,colorScheme:"green",sx:{"& .chakra-switch__track":{bg:J?"green.500":"black"}}})]}),ie&&w.jsx(Ze,{fontSize:"md",cursor:"pointer",_hover:{bg:"whiteAlpha.200"},p:2,borderRadius:"md",onClick:ve,children:"Manage Space"}),re&&e&&!he&&w.jsx(hze,{onClose:ke}),w.jsx(Ze,{fontSize:"md",cursor:"pointer",_hover:{bg:"whiteAlpha.200"},p:2,borderRadius:"md",onClick:We,children:"Settings"}),w.jsx(Ze,{fontSize:"md",cursor:"pointer",_hover:{bg:"whiteAlpha.200"},p:2,borderRadius:"md",onClick:$e,children:"Controls"}),w.jsx(Ze,{fontSize:"md",cursor:"pointer",_hover:{bg:"whiteAlpha.200"},p:2,borderRadius:"md",onClick:()=>window.open("https://support.spacesmetaverse.com/","_blank"),children:"Support"}),w.jsx(Ze,{fontSize:"md",cursor:"pointer",_hover:{bg:"whiteAlpha.200"},p:2,borderRadius:"md",color:"red.300",children:"Leave"})]})]})})})]}),b&&w.jsx(fze,{open:b,onClose:$e}),_&&w.jsx(mze,{open:_,onClose:We}),I&&w.jsx(lae,{open:I,onClose:_e}),w.jsx(Pze,{isOpen:L,onClose:ve})]})},kze=({isOpen:n,onClose:e,mediaScreenId:i,onImageChange:o})=>{const{spaceID:l}=Ra(),d=Sf(),p=Ic(),_=N.useRef(null),E=N.useRef(null),b=N.useRef(),[C,I]=N.useState(null),[O,L]=N.useState(""),[U,B]=N.useState(!1),[W,J]=N.useState(0),[$,ie]=N.useState(null),[ce,ne]=N.useState(!0),[de,Q]=N.useState(!1),[Z,X]=N.useState(!1),[re,pe]=N.useState(0),[he,ue]=N.useState("image"),[xe,We]=N.useState(""),[$e,ve]=N.useState(!1);N.useEffect(()=>{(async()=>{if(n&&i&&l){ne(!0);try{const It=await Dp(l,i);if(It&&(It.imageUrl||It.videoUrl)){ie(It);const pn=It.mediaType==="video";ue(pn?"video":"image"),ve(It.displayAsVideo||!1),pn&&It.videoUrl&&(We(It.videoUrl),pe(1))}else ie(null)}catch(It){q.error("Error fetching existing image:",It),ie(null)}finally{ne(!1)}}})()},[n,i,l]),N.useEffect(()=>{n||(I(null),L(""),J(0),We(""))},[n]);const _e=N.useCallback(rt=>{rt.preventDefault(),rt.stopPropagation(),X(!0)},[]),Ee=N.useCallback(rt=>{rt.preventDefault(),rt.stopPropagation(),X(!1)},[]),ke=N.useCallback(rt=>{rt.preventDefault(),rt.stopPropagation()},[]),Te=N.useCallback(rt=>{if(rt.preventDefault(),rt.stopPropagation(),X(!1),rt.dataTransfer.files&&rt.dataTransfer.files.length>0){const It=rt.dataTransfer.files[0];be(It)}},[]);N.useEffect(()=>{const rt=E.current;if(rt)return rt.addEventListener("dragenter",_e),rt.addEventListener("dragleave",Ee),rt.addEventListener("dragover",ke),rt.addEventListener("drop",Te),()=>{rt.removeEventListener("dragenter",_e),rt.removeEventListener("dragleave",Ee),rt.removeEventListener("dragover",ke),rt.removeEventListener("drop",Te)}},[_e,Ee,ke,Te]);const be=rt=>{if(!rt)return;if(!rt.type.startsWith("image/")){p({title:"Invalid file type",description:"Please select an image file (PNG, JPEG, etc.)",status:"error",duration:5e3,isClosable:!0});return}I(rt);const It=new FileReader;It.onloadend=()=>{L(It.result)},It.readAsDataURL(rt)},Pe=rt=>{const It=rt.target.files[0];be(It)},Le=async rt=>{const It=rt.target.checked;if(ve(It),$)try{await g8e(l,i,It),It?d("SetMediaScreenImage",{mediaScreenId:i,imageUrl:null,videoUrl:$.videoUrl||null,mediaType:$.mediaType||"image",displayAsVideo:!0}):d("SetMediaScreenImage",{mediaScreenId:i,imageUrl:$.imageUrl||null,videoUrl:$.videoUrl||null,mediaType:$.mediaType||"image",displayAsVideo:!1}),ie({...$,displayAsVideo:It}),p({title:"Display mode updated",description:`The media screen will now be displayed as ${It?"video":"image"}`,status:"success",duration:3e3,isClosable:!0}),q.log(`Updated display mode for media screen ${i} to ${It?"video":"image"}`),o&&o({type:"update",mediaScreenId:i,displayAsVideo:It})}catch(pn){q.error("Error updating display mode:",pn),p({title:"Update failed",description:pn.message||"An error occurred while updating the display mode",status:"error",duration:5e3,isClosable:!0}),ve(!It)}},ze=async()=>{if(he==="image"&&!C){p({title:"No file selected",description:"Please select an image to upload",status:"warning",duration:5e3,isClosable:!0});return}if(he==="video"&&!xe){p({title:"No video URL",description:"Please enter a video URL",status:"warning",duration:5e3,isClosable:!0});return}try{B(!0);const rt=setInterval(()=>{J(an=>{const en=an+10;return en>=90?90:en})},300);let It;he==="image"?It=await UQ(l,i,C,{mediaType:he,displayAsVideo:$e}):(It=xe,await UQ(l,i,null,{mediaType:"video",directUrl:xe,displayAsVideo:$e})),clearInterval(rt),J(100);let pn=null,Ft=null;he==="image"?(pn=$e?null:It,Ft=($==null?void 0:$.videoUrl)||null):(pn=!$e&&($!=null&&$.imageUrl)?$.imageUrl:null,Ft=It),d("SetMediaScreenImage",{mediaScreenId:i,imageUrl:pn,videoUrl:Ft,mediaType:he,displayAsVideo:$e}),q.log(`Uploaded and sent ${he} for media screen ${i} (display as video: ${$e})`),o&&o({type:"upload",mediaScreenId:i,imageUrl:he==="image"?It:$==null?void 0:$.imageUrl,videoUrl:he==="video"?It:$==null?void 0:$.videoUrl,mediaType:he,displayAsVideo:$e}),p({title:"Upload successful",description:`The ${he} has been uploaded and applied to the media screen`,status:"success",duration:5e3,isClosable:!0}),setTimeout(()=>{I(null),L(""),B(!1),J(0),e()},1e3)}catch(rt){q.error(`Error uploading ${he}:`,rt),p({title:"Upload failed",description:rt.message||`An error occurred while uploading the ${he}`,status:"error",duration:5e3,isClosable:!0}),B(!1),J(0)}},Je=async()=>{Q(!1);try{B(!0),await m8e(l,i),d("SetMediaScreenImage",{mediaScreenId:i,imageUrl:he==="image"?null:($==null?void 0:$.imageUrl)||null,videoUrl:he==="video"?null:($==null?void 0:$.videoUrl)||null,mediaType:null,displayAsVideo:!1}),q.log(`Deleted ${he} for media screen ${i}`),o&&o({type:"delete",mediaScreenId:i}),p({title:`${he==="image"?"Image":"Video"} deleted`,description:`The ${he} has been removed from the media screen`,status:"success",duration:5e3,isClosable:!0}),ie(null),B(!1),We(""),ve(!1),setTimeout(()=>{e()},500)}catch(rt){q.error(`Error deleting ${he}:`,rt),p({title:"Deletion failed",description:rt.message||`An error occurred while deleting the ${he}`,status:"error",duration:5e3,isClosable:!0}),B(!1)}},et=()=>{U||(I(null),L(""),J(0),e())},ut=rt=>{pe(rt),ue(rt===0?"image":"video")};return w.jsxs(w.Fragment,{children:[w.jsxs(oo,{isOpen:n,onClose:et,size:"xl",children:[w.jsx(co,{backdropFilter:"blur(10px)"}),w.jsxs(ao,{bg:"gray.800",color:"white",maxW:"900px",children:[w.jsx(tc,{children:"Media Screen Content"}),w.jsx(Ko,{isDisabled:U}),w.jsxs(lt,{px:6,pb:2,children:[w.jsxs(wr,{justify:"space-between",align:"center",bg:"gray.700",p:4,borderRadius:"md",mb:4,children:[w.jsxs(pi,{spacing:4,children:[w.jsx(Ze,{fontWeight:"medium",children:"Display as:"}),w.jsxs(pi,{spacing:2,children:[w.jsx(En,{as:Py,color:$e?"gray.400":"green.300"}),w.jsx(cf,{colorScheme:"purple",size:"md",isChecked:$e,onChange:Le}),w.jsx(En,{as:ZS,color:$e?"purple.300":"gray.400"})]})]}),w.jsx(Pp,{colorScheme:$e?"purple":"green",fontSize:"sm",px:2,py:1,borderRadius:"md",children:$e?"Video Output":"Image Output"})]}),w.jsxs(Ze,{fontSize:"sm",color:"gray.400",mb:1,children:["Media Screen ID: ",w.jsx("strong",{children:i})]}),w.jsx(Ze,{fontSize:"xs",color:"gray.500",mb:2,children:"The toggle above controls how the content will be displayed in the 3D space, regardless of the content type you upload."}),w.jsx(of,{mb:4})]}),w.jsx(Ro,{children:w.jsxs(wr,{children:[w.jsx(A0,{orientation:"vertical",variant:"solid-rounded",colorScheme:"blue",index:re,onChange:ut,h:"100%",minW:"120px",mr:4,children:w.jsxs(P0,{children:[w.jsxs(Sa,{_selected:{color:"white",bg:"blue.500"},mb:2,py:6,justifyContent:"flex-start",children:[w.jsx(En,{as:Py,mr:2})," Image"]}),w.jsxs(Sa,{_selected:{color:"white",bg:"blue.500"},py:6,justifyContent:"flex-start",children:[w.jsx(En,{as:ZS,mr:2})," Video"]})]})}),w.jsx(lt,{flex:"1",children:ce?w.jsx(wr,{justify:"center",align:"center",h:"150px",children:w.jsx(zd,{size:"xl",color:"blue.400"})}):w.jsxs(w.Fragment,{children:[w.jsx(lt,{children:re===0?w.jsxs(Qr,{spacing:4,align:"stretch",children:[$&&$.imageUrl&&he==="image"&&w.jsxs(lt,{children:[w.jsx(Ze,{fontWeight:"semibold",mb:2,children:"Current Image:"}),w.jsxs(wr,{children:[w.jsx(lt,{borderWidth:"1px",borderRadius:"md",overflow:"hidden",mb:2,maxW:"200px",mr:4,children:w.jsx(Jh,{src:$.imageUrl,alt:"Current image",maxHeight:"150px",width:"100%",objectFit:"contain"})}),w.jsxs(Qr,{align:"flex-start",spacing:2,children:[w.jsxs(Ze,{fontSize:"xs",color:"gray.400",children:["Uploaded: ",new Date($.uploadedAt).toLocaleString()]}),w.jsxs(Ze,{fontSize:"xs",color:"gray.400",children:["Display Mode: ",$.displayAsVideo?"Video":"Image"]}),w.jsx(ur,{size:"sm",colorScheme:"red",variant:"outline",leftIcon:w.jsx(En,{as:m0}),onClick:()=>Q(!0),isDisabled:U,children:"Delete"})]})]}),w.jsx(of,{my:4})]}),w.jsx(Ze,{fontWeight:"semibold",mb:2,children:$&&$.imageUrl&&he==="image"?"Replace with new image:":"Upload new image:"}),w.jsxs(lt,{ref:E,borderWidth:"2px",borderRadius:"md",borderStyle:"dashed",borderColor:Z?"blue.400":"gray.500",bg:Z?"blue.900":"gray.700",p:6,textAlign:"center",transition:"all 0.2s",_hover:{borderColor:"blue.400",bg:"gray.600"},cursor:"pointer",onClick:()=>_.current.click(),children:[O?w.jsx(lt,{borderRadius:"md",overflow:"hidden",maxH:"200px",children:w.jsx(Jh,{src:O,alt:"Preview",maxHeight:"200px",width:"100%",objectFit:"contain"})}):w.jsxs(Qr,{spacing:2,children:[w.jsx(En,{as:Uk,boxSize:"24px",color:"gray.400"}),w.jsx(Ze,{children:"Drag and drop an image here, or click to browse"}),w.jsx(Ze,{fontSize:"xs",color:"gray.400",children:"Supports PNG, JPG, JPEG, GIF"})]}),w.jsx(oi,{type:"file",accept:"image/*",onChange:Pe,ref:_,display:"none"})]}),C&&w.jsxs(Ze,{fontSize:"sm",children:["Selected file: ",C.name," (",Math.round(C.size/1024)," KB)"]})]}):w.jsxs(Qr,{spacing:4,align:"stretch",children:[$&&$.videoUrl&&he==="video"&&w.jsxs(lt,{children:[w.jsx(Ze,{fontWeight:"semibold",mb:2,children:"Current Video URL:"}),w.jsxs(wr,{children:[w.jsx(lt,{borderWidth:"1px",borderRadius:"md",p:3,mb:2,flex:"1",mr:4,bg:"gray.700",children:w.jsx(Ze,{fontSize:"sm",wordBreak:"break-all",children:$.videoUrl})}),w.jsxs(Qr,{align:"flex-start",spacing:2,children:[w.jsxs(Ze,{fontSize:"xs",color:"gray.400",children:["Added: ",new Date($.uploadedAt).toLocaleString()]}),w.jsxs(Ze,{fontSize:"xs",color:"gray.400",children:["Display Mode: ",$.displayAsVideo?"Video":"Image"]}),w.jsx(ur,{size:"sm",colorScheme:"red",variant:"outline",leftIcon:w.jsx(En,{as:m0}),onClick:()=>Q(!0),isDisabled:U,children:"Delete"})]})]}),w.jsx(of,{my:4})]}),w.jsx(Ze,{fontWeight:"semibold",mb:2,children:$&&$.videoUrl&&he==="video"?"Replace with new video:":"Add video URL:"}),w.jsx(lt,{p:3,bg:"blue.900",borderRadius:"md",mb:4,borderLeftWidth:"4px",borderLeftColor:"blue.400",children:w.jsxs(pi,{children:[w.jsx(En,{as:mae,color:"blue.300"}),w.jsx(Ze,{fontSize:"sm",fontWeight:"medium",children:'After entering a URL, click the "Save Video URL" button at the bottom to save your changes.'})]})}),w.jsxs(kr,{children:[w.jsx($i,{fontSize:"sm",children:"Video URL"}),w.jsx(oi,{placeholder:"Enter video URL (YouTube, Vimeo, etc.)",value:xe,onChange:rt=>We(rt.target.value),bg:"gray.700",borderColor:"gray.600",_hover:{borderColor:"blue.400"},_focus:{borderColor:"blue.400",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},size:"lg"}),w.jsx(Ze,{fontSize:"xs",color:"gray.400",mt:1,children:"Enter a URL from YouTube, Vimeo, or other video hosting services"})]}),w.jsxs(lt,{mt:4,p:4,bg:"gray.700",borderRadius:"md",children:[w.jsxs(pi,{children:[w.jsx(En,{as:ZS,color:"blue.300"}),w.jsx(Ze,{fontWeight:"medium",children:"Video Support"})]}),w.jsx(Ze,{fontSize:"sm",mt:2,color:"gray.300",children:"Video playback will be implemented in a future update. For now, you can add the URL which will be stored with the media screen."}),w.jsx(Ze,{fontSize:"sm",mt:2,color:"yellow.300",fontWeight:"medium",children:'Important: Click the "Upload" button at the bottom to save your video URL.'})]}),xe&&w.jsxs(lt,{mt:4,p:4,bg:"gray.900",borderRadius:"md",borderWidth:"1px",borderColor:"blue.500",children:[w.jsxs(pi,{mb:2,children:[w.jsx(En,{as:yze,color:"blue.300"}),w.jsx(Ze,{fontWeight:"medium",children:"URL Preview"})]}),w.jsx(Ze,{fontSize:"sm",wordBreak:"break-all",color:"gray.300",children:xe}),w.jsx(Ze,{fontSize:"xs",color:"gray.400",mt:2,children:"This URL will be saved when you click the Upload button below"})]})]})}),U&&w.jsxs(lt,{mt:4,children:[w.jsxs(Ze,{mb:2,children:["Uploading: ",W,"%"]}),w.jsx(jy,{value:W,colorScheme:"blue",size:"sm",borderRadius:"md"})]})]})})]})}),w.jsxs($p,{children:[w.jsx(ur,{variant:"ghost",mr:3,onClick:et,isDisabled:U,children:"Cancel"}),w.jsx(ur,{colorScheme:"blue",onClick:ze,isLoading:U,loadingText:"Uploading",isDisabled:he==="image"&&!C||he==="video"&&!xe||U||ce,leftIcon:w.jsx(En,{as:he==="image"?Py:ZS}),size:"lg",px:6,children:he==="image"?"Upload Image":"Save Video URL"})]})]})]}),w.jsx(_Me,{isOpen:de,leastDestructiveRef:b,onClose:()=>Q(!1),children:w.jsx(co,{children:w.jsxs(yMe,{bg:"gray.800",color:"white",children:[w.jsxs(tc,{fontSize:"lg",fontWeight:"bold",children:["Delete ",he==="video"?"Video":"Image"]}),w.jsxs(Ro,{children:["Are you sure you want to delete this ",he,"? This will revert the media screen to its blank state."]}),w.jsxs($p,{children:[w.jsx(ur,{ref:b,onClick:()=>Q(!1),children:"Cancel"}),w.jsx(ur,{colorScheme:"red",onClick:Je,ml:3,leftIcon:w.jsx(En,{as:m0}),children:"Delete"})]})]})})})]})},Nze=n=>{const[e,i]=N.useState(null),[o,l]=N.useState(""),[d,p]=N.useState(null),[_,E]=N.useState(!1),b=bf(),{spaceID:C}=Ra(),I=N.useCallback(U=>{var B,W;try{if(!U)return null;if(U.includes("youtube.com")||U.includes("youtu.be")){let J="";return U.includes("youtube.com/watch")?J=new URLSearchParams(new URL(U).search).get("v"):U.includes("youtu.be/")&&(J=U.split("youtu.be/")[1].split("?")[0]),J?`https://www.youtube.com/embed/${J}?autoplay=1`:U}if(U.includes("vimeo.com")){if(U.includes("player.vimeo.com/video"))return U;const J=(W=(B=U.split("vimeo.com/")[1])==null?void 0:B.split("?")[0])==null?void 0:W.split("/")[0];return J?`https://player.vimeo.com/video/${J}?autoplay=1`:U}return U}catch(J){return q.error("Error converting to embed URL:",J),U}},[]),O=N.useCallback(()=>{setTimeout(()=>{E(!1),q.log("Video processing state reset")},100)},[]);N.useEffect(()=>{let U=!0,B=null;const J=b("PlayMediaScreenVideo",async $=>{try{console.log("[DEBUG] PlayMediaScreenVideo event received:",$,"isEditMode:",n),console.log("PlayMediaScreenVideo event received:",$);const{mediaScreenId:ie,videoUrl:ce}=$||{};if(!ie){q.error("Media screen ID is missing in Unity event data."),O();return}if(n){console.log(`[DEBUG] Edit mode is active for screen ${ie}, setting ID but not playing video`),q.log("Edit mode is active, setting media screen ID but not playing video"),p(ie);return}if(E(!0),B=setTimeout(()=>{U&&(q.warn("Video processing timeout reached, resetting state"),E(!1))},5e3),ce){if(console.log(`Using direct video URL from event: ${ce}`),U)try{const ne=I(ce);console.log(`Setting video URL to: ${ne} (original: ${ce})`),i(ne),l(`Media Screen ${ie}`),p(ie),q.log("Media screen video URL set directly from event:",ne)}catch(ne){q.error("Error setting video URL from direct URL:",ne)}finally{O(),clearTimeout(B)}return}console.log(`Fetching media screen data for ID: ${ie}`);try{const ne=await Dp(C,ie);if(console.log("Media screen data from Firestore:",ne),!ne||!ne.videoUrl){q.error("No video URL found for media screen:",ie),O(),clearTimeout(B);return}if(!ne.displayAsVideo){q.log("Media screen is not set to display as video:",ie),console.log("displayAsVideo flag is false for this media screen"),O(),clearTimeout(B);return}if(U)try{const de=I(ne.videoUrl);console.log(`Setting video URL to: ${de} (original: ${ne.videoUrl})`),i(de),l(ne.title||`Media Screen ${ie}`),p(ie),q.log("Media screen video URL set to:",de)}catch(de){q.error("Error setting video URL from Firestore:",de)}finally{O(),clearTimeout(B)}}catch(ne){q.error(`Error fetching media screen data for ${ie}:`,ne),O(),clearTimeout(B)}}catch(ie){q.error("Error handling media screen video play:",ie),console.error("Error handling media screen video play:",ie),O(),clearTimeout(B)}});return()=>{U=!1,B&&clearTimeout(B),J()}},[b,C,n,I,O]);const L=N.useCallback(()=>{i(null),l(""),p(null),E(!1),q.log("Video player state reset")},[]);return[e,o,d,L,_]},Dze=()=>{const{spaceID:n}=Ra(),e=Sf(),i=bf(),[o,l]=N.useState(!1);N.useEffect(()=>{if(window.isPlayerInstantiated){q.log("useMediaScreenThumbnails: Unity already ready (via window flag)"),l(!0);return}const b=()=>{q.log("useMediaScreenThumbnails: Unity is now ready (PlayerInstantiated event)"),l(!0)};return window.addEventListener("PlayerInstantiated",b),()=>{window.removeEventListener("PlayerInstantiated",b)}},[]);const d=N.useCallback(async b=>{try{return b.includes("vimeo.com")?await p(b):b.includes("youtube.com")||b.includes("youtu.be")?await _(b):"https://via.placeholder.com/640x360?text=Video"}catch(C){return q.error(`Error fetching thumbnail for ${b}:`,C),"https://via.placeholder.com/640x360?text=Error"}},[]),p=async b=>{try{const C=`https://vimeo.com/api/oembed.json?url=${encodeURIComponent(b)}`,I=await fetch(C);if(!I.ok)throw new Error(`Failed to fetch Vimeo thumbnail: ${I.statusText}`);const O=await I.json(),L=O.thumbnail_url.replace(/_\d+x\d+/,""),U=["640x360","295x166"];let B=null;for(let W of U){const J=`https://i.vimeocdn.com/filter/overlay?src0=${encodeURIComponent(`${L}_${W}`)}&src1=http://f.vimeocdn.com/p/images/crawler_play.png`;try{if((await fetch(J,{method:"HEAD"})).ok){B=J;break}}catch($){q.warn(`Failed to validate thumbnail URL: ${J}`,$)}}return B||O.thumbnail_url}catch(C){return q.error(`Error fetching Vimeo thumbnail: ${C.message}`),"https://via.placeholder.com/640x360?text=Vimeo+Video"}},_=async b=>{let C="";if(b.includes("youtube.com/watch")?C=new URLSearchParams(new URL(b).search).get("v"):b.includes("youtu.be/")&&(C=b.split("youtu.be/")[1].split("?")[0]),!C)throw new Error("Could not extract YouTube video ID");const I=`https://img.youtube.com/vi/${C}/maxresdefault.jpg`;try{if((await fetch(I,{method:"HEAD"})).ok)return I}catch(O){q.warn(`Failed to validate maxresdefault thumbnail for YouTube video ${C}`,O)}return`https://img.youtube.com/vi/${C}/hqdefault.jpg`},E=N.useCallback(async b=>{try{if(!n||!b)return;q.log(`Refreshing thumbnail for media screen ${b}`);const C=await Dp(n,b);if(!C){q.log(`No media screen found with ID ${b}`);return}if(q.log("Media screen data:",C),!C.displayAsVideo||!C.videoUrl){q.log(`Media screen ${b} is not set to display as video or has no video URL`);return}const I=await d(C.videoUrl);e("SetMediaScreenThumbnail",{mediaScreenId:b,thumbnailUrl:I}),q.log(`Sent refreshed thumbnail for media screen ${b}: ${I}`)}catch(C){q.error(`Error refreshing thumbnail for media screen ${b}:`,C)}},[n,d,e]);N.useEffect(()=>{if(!o){q.log("useMediaScreenThumbnails: Waiting for Unity to be ready before setting up thumbnail listeners");return}q.log("useMediaScreenThumbnails: Unity is ready, now setting up thumbnail listeners");const C=i("SetMediaScreenThumbnail",async I=>{try{const{mediaScreenId:O,thumbnailUrl:L}=I;L==="refresh"&&O&&(console.log(`Received request to refresh thumbnail for media screen ${O}`),await E(O))}catch(O){console.error("Error handling SetMediaScreenThumbnail event:",O)}});return()=>{C()}},[i,E,o]),N.useEffect(()=>{if(!o){q.log("useMediaScreenThumbnails: Waiting for Unity to be ready before fetching thumbnails");return}q.log("useMediaScreenThumbnails: Unity is ready, now fetching thumbnails");const b=async()=>{try{if(!n)throw new Error("spaceID is not defined.");q.log("Fetching media screens for thumbnails...");const I=await P3(n);q.log("All media screens:",I);const O=I.filter(B=>B.displayAsVideo&&B.videoUrl);if(q.log("Media screens set to display as videos:",O),O.length===0){q.log("No media screens set to display as videos found.");return}q.log(`Found ${O.length} media screens set to display as videos.`);const L=O.map(async B=>{try{const W=await d(B.videoUrl);return q.log(`Fetched thumbnail for ${B.id}: ${W}`),{mediaScreenId:B.id,thumbnailUrl:W}}catch(W){return q.error(`Error processing thumbnail for media screen ${B.id}:`,W),{mediaScreenId:B.id,thumbnailUrl:"https://via.placeholder.com/640x360?text=Error"}}}),U=await Promise.all(L);q.log("Fetched Media Screen Thumbnails",U),U.forEach(({mediaScreenId:B,thumbnailUrl:W})=>{e("SetMediaScreenThumbnail",{mediaScreenId:B,thumbnailUrl:W}),q.log(`Sent thumbnail to Unity for media screen ${B}: ${W}`)})}catch(I){q.error("Error fetching media screen thumbnails:",I)}};b();const C=setInterval(b,5*60*1e3);return()=>{clearInterval(C)}},[e,n,d,o])},KQ={iframeContainer:{position:"relative",paddingBottom:"56.25%",height:0,overflow:"hidden",width:"100%",pointerEvents:"auto !important"},iframe:{position:"absolute",top:0,left:0,width:"100%",height:"100%",border:"none",pointerEvents:"auto !important",zIndex:1e4}},xze=()=>w.jsx("style",{dangerouslySetInnerHTML:{__html:`
        /* Disable pointer events on Unity elements when modal is open */
        body.unity-input-disabled #unity-container,
        body.unity-input-disabled #unity-canvas {
          pointer-events: none !important;
        }
        
        /* Make sure the modal is above Unity */
        .chakra-modal__overlay {
          z-index: 1001 !important;
          pointer-events: auto !important;
        }
        
        .chakra-modal__content {
          z-index: 1002 !important;
          pointer-events: auto !important;
        }
        
        /* Make sure the iframe is visible and interactive */
        .video-iframe {
          z-index: 1003 !important;
          pointer-events: auto !important;
        }
        
        /* Make sure the close button is accessible */
        .chakra-modal__close-btn {
          z-index: 1004 !important;
        }
        
        /* Ensure the iframe container allows clicks */
        .iframe-container {
          pointer-events: auto !important;
        }
        
        /* Remove the full-screen blocker */
      `}}),Lze=({videoUrl:n,videoTitle:e,mediaScreenId:i,isOpen:o,onClose:l})=>{const{fullscreenRef:d}=Gd();return FN(o,`video-modal-${i}`),N.useEffect(()=>{if(o){const p=b=>{b.target.classList&&b.target.classList.contains("chakra-modal__overlay")&&(b.stopPropagation(),b.preventDefault())};document.addEventListener("mousemove",p,!0),document.addEventListener("mousedown",p,!0),document.addEventListener("mouseup",p,!0),document.addEventListener("click",p,!0),document.addEventListener("wheel",p,!0);const _=document.getElementById("unity-canvas"),E=document.getElementById("unity-container");if(_&&(_.style.pointerEvents="none"),E&&(E.style.pointerEvents="none"),document.body.classList.add("unity-input-disabled"),window.unityInstance)try{window.unityInstance.SendMessage("WebGLInputManager","Disable"),window.unityInstance.SendMessage("CameraController","DisableInput","VideoModal")}catch(b){console.error("Error disabling Unity input:",b)}return()=>{if(document.removeEventListener("mousemove",p,!0),document.removeEventListener("mousedown",p,!0),document.removeEventListener("mouseup",p,!0),document.removeEventListener("click",p,!0),document.removeEventListener("wheel",p,!0),_&&(_.style.pointerEvents="auto"),E&&(E.style.pointerEvents="auto"),document.body.classList.remove("unity-input-disabled"),window.unityInstance)try{window.unityInstance.SendMessage("WebGLInputManager","Enable"),window.unityInstance.SendMessage("CameraController","EnableInput","VideoModal")}catch(b){console.error("Error re-enabling Unity input:",b)}}}},[o]),w.jsxs(w.Fragment,{children:[w.jsx(xze,{}),w.jsxs(oo,{isOpen:o,onClose:l,size:"xl",isCentered:!0,portalProps:{containerRef:d},closeOnOverlayClick:!0,closeOnEsc:!0,id:`video-modal-${i}`,children:[w.jsx(co,{bg:"rgba(0, 0, 0, 0.8)",onClick:p=>{p.target===p.currentTarget&&(l(),p.stopPropagation(),p.preventDefault())},onMouseMove:p=>{p.target===p.currentTarget&&(p.stopPropagation(),p.preventDefault())},onMouseDown:p=>{p.target===p.currentTarget&&(p.stopPropagation(),p.preventDefault())},onMouseUp:p=>{p.target===p.currentTarget&&(p.stopPropagation(),p.preventDefault())},onWheel:p=>{p.target===p.currentTarget&&(p.stopPropagation(),p.preventDefault())},style:{pointerEvents:"auto"}}),w.jsxs(ao,{bg:"gray.900",color:"white",borderRadius:"lg",overflow:"hidden",maxWidth:"80vw",maxHeight:"80vh",className:"video-modal-content",children:[w.jsx(Ko,{size:"lg",bg:"gray.700",color:"white",borderRadius:"full",zIndex:"10004",_hover:{bg:"gray.600"},position:"absolute",top:"10px",right:"10px"}),w.jsx(Ro,{p:0,width:"100%",children:n?w.jsx(lt,{className:"iframe-container",style:KQ.iframeContainer,children:w.jsx("iframe",{className:"video-iframe",src:n,style:KQ.iframe,allow:"autoplay; fullscreen",allowFullScreen:!0,title:e||"Video Player"})}):w.jsxs(wr,{direction:"column",align:"center",justify:"center",h:"400px",children:[w.jsx(zd,{size:"xl",mb:4}),w.jsx(Ze,{children:"Unable to load video"}),w.jsx(Ze,{fontSize:"sm",color:"gray.400",mt:2,children:"No video URL provided"})]})})]})]})]})},zs=(...n)=>{},Mze=()=>{const{isOpen:n,onOpen:e,onClose:i}=pf(),[o,l]=N.useState(null),[d,p]=N.useState("image"),_=N.useRef(null);FN(n,"image-viewer-modal");const E=N.useCallback(I=>{I.stopPropagation()},[]);return N.useEffect(()=>{if(n&&_.current){const I=_.current;I.addEventListener("mousemove",E),I.addEventListener("mousedown",E),I.addEventListener("mouseup",E),I.addEventListener("wheel",E);const O=document.getElementById("unity-canvas");return O&&(O.style.pointerEvents="none"),()=>{I.removeEventListener("mousemove",E),I.removeEventListener("mousedown",E),I.removeEventListener("mouseup",E),I.removeEventListener("wheel",E),O&&(O.style.pointerEvents="auto")}}},[n,E]),{isOpen:n,currentImageUrl:o,currentMediaType:d,openImageViewer:(I,O="image")=>{console.log(`[DEBUG] Opening image viewer with URL: ${I} and original media type: ${O}`);const L=typeof I=="string"&&(I.match(/\.(jpeg|jpg|gif|png|webp)($|\?)/i)||I.includes("firebasestorage")&&!I.includes("video")),U=L?"image":O;console.log(`[DEBUG] Detected URL as ${L?"image":"non-image"}, using media type: ${U}`),l(I),p(U),e()},closeImageViewer:()=>{i(),setTimeout(()=>{l(null),p("image")},300)},modalContentRef:_,preventPropagation:E}},Uze=()=>w.jsx("style",{dangerouslySetInnerHTML:{__html:`
        body.unity-input-disabled #unity-container,
        body.unity-input-disabled #unity-canvas {
          pointer-events: none !important;
        }
        
        .image-viewer-modal-content {
          pointer-events: auto !important;
        }
        
        .chakra-modal__overlay {
          pointer-events: auto !important;
        }
      `}}),zU=n=>{if(!n)return null;try{if(n.includes("firebasestorage.googleapis.com")){const e=new URL(n),i=e.searchParams.get("alt"),o=e.searchParams.get("token");return e.search="",i&&e.searchParams.set("alt",i),o&&e.searchParams.set("token",o),zs(`Cleaned Firebase URL from ${n} to ${e.toString()}`),e.toString()}return n}catch(e){return console.error("Error cleaning Firebase URL:",e),n}},Vze=()=>{const{spaceID:n}=Ra(),[e,i]=N.useState(!1),[o,l]=N.useState([]),[d,p]=N.useState(null),{isOpen:_,onOpen:E,onClose:b}=pf(),[C,I]=N.useState({}),[O,L]=N.useState(0);N.useRef(null);const U=Sf(),{fullscreenRef:B}=Gd(),W=bf(),[J,$]=N.useState(!1),{isOpen:ie,currentImageUrl:ce,currentMediaType:ne,openImageViewer:de,closeImageViewer:Q,modalContentRef:Z,preventPropagation:X}=Mze(),[re,pe,he,ue,xe]=Nze(e),{isOpen:We,onOpen:$e,onClose:ve}=pf();Dze(),nae(),N.useEffect(()=>{if(window.isPlayerInstantiated){$(!0);return}const be=()=>{$(!0)};return window.addEventListener("PlayerInstantiated",be),()=>{window.removeEventListener("PlayerInstantiated",be)}},[]);const _e=N.useCallback(be=>{if(Array.isArray(o)&&o.length>0){const Pe=o.find(Le=>Le.mediaScreenId===be);if(Pe){const Le=Pe.imageUrl,ze=Pe.videoUrl;return{screen:Pe,imageUrl:Le,videoUrl:ze,mediaType:Pe.mediaType||"image",displayAsVideo:Pe.displayAsVideo||!1}}}else console.warn("mediaScreens is not an array or is empty:",o);if(ce){let Pe=null;return Array.isArray(o)&&(Pe=o.find(Le=>Le.mediaScreenId===be)),{screen:Pe||{mediaScreenId:be},imageUrl:ce,videoUrl:null,mediaType:(Pe==null?void 0:Pe.mediaType)||"image",displayAsVideo:(Pe==null?void 0:Pe.displayAsVideo)||!1}}return n&&be&&Dp(n,be).then(Pe=>{Pe&&l(Le=>Array.isArray(Le)&&Le.some(Je=>Je.mediaScreenId===be)?Le.map(Je=>Je.mediaScreenId===be?{...Je,imageUrl:Pe.imageUrl,videoUrl:Pe.videoUrl,mediaType:Pe.mediaType||"image",displayAsVideo:Pe.displayAsVideo||!1,hasImage:!!Pe.imageUrl,source:"firestore-fetch",lastUpdated:new Date().toISOString()}:Je):[...Array.isArray(Le)?Le:[],{mediaScreenId:be,imageUrl:Pe.imageUrl,videoUrl:Pe.videoUrl,mediaType:Pe.mediaType||"image",displayAsVideo:Pe.displayAsVideo||!1,hasImage:!!Pe.imageUrl,source:"firestore-fetch",firstDetected:new Date().toISOString(),lastUpdated:new Date().toISOString()}])}).catch(Pe=>{console.error(`Error fetching media screen data for ${be}:`,Pe)}),console.warn("No screen data found for:",be),null},[o,ce,n,l]),Ee=N.useCallback(be=>{if(console.log(`[DEBUG] Processing click on screen: ${be}, isEditMode: ${e}`),p(be),e)console.log(`[DEBUG] Opening upload modal for screen: ${be} in edit mode`),E();else{const Pe=_e(be);if(Pe){if(console.log(`[DEBUG] Screen data for ${be}:`,Pe),zs("Screen data details:",{mediaScreenId:be,imageUrl:Pe.imageUrl,videoUrl:Pe.videoUrl,mediaType:Pe.mediaType,displayAsVideo:Pe.displayAsVideo}),We&&he===be)return;if(Pe.displayAsVideo&&Pe.videoUrl)zs(`Opening video player for: ${Pe.videoUrl}`),U("PlayMediaScreenVideo",{mediaScreenId:be,videoUrl:Pe.videoUrl});else if(Pe.imageUrl){zs(`Opening viewer modal with ${Pe.mediaType}: ${Pe.imageUrl}`);const ze=zU(Pe.imageUrl);de(ze,Pe.mediaType||"image")}else n&&Dp(n,be).then(ze=>{if(ze){if(ze.displayAsVideo&&ze.videoUrl)zs(`Opening video player for: ${ze.videoUrl}`),U("PlayMediaScreenVideo",{mediaScreenId:be,videoUrl:ze.videoUrl});else if(ze.imageUrl){zs(`Opening viewer modal with image: ${ze.imageUrl}`);const Je=zU(ze.imageUrl);de(Je,ze.mediaType||"image")}l(Je=>Array.isArray(Je)&&Je.some(ut=>ut.mediaScreenId===be)?Je.map(ut=>ut.mediaScreenId===be?{...ut,...ze,mediaScreenId:be,source:"firestore-click",lastUpdated:new Date().toISOString()}:ut):[...Array.isArray(Je)?Je:[],{...ze,mediaScreenId:be,source:"firestore-click",firstDetected:new Date().toISOString(),lastUpdated:new Date().toISOString()}])}}).catch(ze=>{console.error(`Error fetching media screen data for ${be}:`,ze)})}else n&&Dp(n,be).then(Le=>{if(Le){if(Le.displayAsVideo&&Le.videoUrl)zs(`Opening video player for: ${Le.videoUrl}`),U("PlayMediaScreenVideo",{mediaScreenId:be,videoUrl:Le.videoUrl});else if(Le.imageUrl){zs(`Opening viewer modal with image: ${Le.imageUrl}`);const ze=zU(Le.imageUrl);de(ze,Le.mediaType||"image")}l(ze=>Array.isArray(ze)&&ze.some(et=>et.mediaScreenId===be)?ze.map(et=>et.mediaScreenId===be?{...et,...Le,mediaScreenId:be,source:"firestore-click",lastUpdated:new Date().toISOString()}:et):[...Array.isArray(ze)?ze:[],{...Le,mediaScreenId:be,source:"firestore-click",firstDetected:new Date().toISOString(),lastUpdated:new Date().toISOString()}])}}).catch(Le=>{console.error(`Error fetching media screen data for ${be}:`,Le)})}},[e,E,_e,We,he,U,de,n]);N.useEffect(()=>{if(!J)return;const be=async()=>{if(n)try{const Le=await P3(n),ze={};Le.forEach(Je=>{Je.id&&Je.imageUrl&&(ze[Je.id]=Je.imageUrl)}),l(Je=>Je.map(et=>{const ut=!!ze[et.mediaScreenId],rt=ze[et.mediaScreenId],It=et.mediaType||"image";return{...et,hasImage:ut,imageUrl:rt,mediaType:It}}))}catch(Le){console.error("Error fetching media screen images:",Le)}};be();let Pe=null;return e&&(Pe=setInterval(be,5e3)),()=>{Pe&&clearInterval(Pe)}},[n,e,O,J]);const ke=be=>{l(Pe=>Pe.map(Le=>{if(Le.mediaScreenId===be.mediaScreenId){if(be.type==="upload")return{...Le,hasImage:!0,imageUrl:be.imageUrl,mediaType:be.mediaType||"image"};if(be.type==="delete")return{...Le,hasImage:!1,imageUrl:null,mediaType:null}}return Le})),be.type==="delete"?(setTimeout(()=>{l(Pe=>Pe.filter(Le=>Le.mediaScreenId!==be.mediaScreenId))},100),setTimeout(()=>{l(Pe=>Pe.filter(Le=>Le.mediaScreenId!==be.mediaScreenId))},1500)):setTimeout(()=>{l(Pe=>Pe.some(ze=>ze.mediaScreenId===be.mediaScreenId)?Pe.map(ze=>ze.mediaScreenId===be.mediaScreenId?{...ze,imageUrl:be.imageUrl,hasImage:!0,mediaType:be.mediaType||"image"}:ze):[...Pe,{mediaScreenId:be.mediaScreenId,imageUrl:be.imageUrl,hasImage:!0,mediaType:be.mediaType||"image",source:"delayed-update",firstDetected:new Date().toISOString(),lastUpdated:new Date().toISOString()}])},1e3)};N.useEffect(()=>{const be=Pe=>{const Le=Pe.detail.enabled;i(Le),Le?U("SetMediaScreenEditMode",{enabled:!0,showUploadIcon:!0}):U("SetMediaScreenEditMode",{enabled:!1,showUploadIcon:!1})};return window.addEventListener("editModeChanged",be),()=>{window.removeEventListener("editModeChanged",be)}},[U]),N.useEffect(()=>(window.JsSendMediaScreenClick=function(be){console.log("Unity: MediaScreenClick received with data:",be);try{const Pe=JSON.parse(be),Le=new CustomEvent("MediaScreenClick",{detail:JSON.stringify(Pe)});window.dispatchEvent(Le)}catch(Pe){console.error("Error processing MediaScreenClick data:",Pe)}},window.handleMediaScreenClick=function(be){console.log("Direct call to handleMediaScreenClick with ID:",be),Ee(be)},window.TestJavaScriptFromUnity=function(be){console.log("Unity called TestJavaScriptFromUnity with:",be),alert("Unity called JavaScript: "+be)},()=>{delete window.JsSendMediaScreenClick,delete window.handleMediaScreenClick,delete window.TestJavaScriptFromUnity}),[Ee]),N.useEffect(()=>{const be=ze=>{try{const Je=JSON.parse(ze.detail);q.log(`MediaScreen registered: ${Je.mediaScreenId}`),zs("MediaScreen registered from Unity:",Je),l(ut=>ut.some(It=>It.mediaScreenId===Je.mediaScreenId)?ut.map(It=>It.mediaScreenId===Je.mediaScreenId?{...It,...Je,source:"event",lastUpdated:new Date().toISOString()}:It):[...ut,{...Je,source:"event",firstDetected:new Date().toISOString(),lastUpdated:new Date().toISOString()}]),e&&U("SetMediaScreenEditMode",{mediaScreenId:Je.mediaScreenId,enabled:!0,showUploadIcon:!0});const et=Je.mediaScreenId;et&&Dp(n,et).then(ut=>{ut&&(zs(`Media screen data for ${et}:`,ut),ut.displayAsVideo&&ut.videoUrl&&(zs(`Media screen ${et} should display as video, sending null imageUrl`),U("SetMediaScreenImage",{mediaScreenId:et,imageUrl:null,displayAsVideo:!0})))}).catch(ut=>{console.error(`Error fetching media screen data for ${et}:`,ut)})}catch(Je){console.error("Error handling MediaScreen registration:",Je)}},Pe=ze=>{try{zs("MediaScreenClick event received:",ze);let Je;if(typeof ze=="string")Je=ze,zs("MediaScreenClick: Direct call with ID:",Je);else{zs("MediaScreenClick: Event from Unity:",ze),zs("MediaScreenClick: Event detail:",ze.detail);try{Je=JSON.parse(ze.detail).mediaScreenId,zs("MediaScreenClick: Parsed mediaScreenId:",Je)}catch(et){if(console.error("MediaScreenClick: Error parsing event detail:",et),ze.detail&&ze.detail.mediaScreenId)Je=ze.detail.mediaScreenId,zs("MediaScreenClick: Using direct mediaScreenId from detail:",Je);else throw new Error("Could not extract mediaScreenId from event")}}q.log(`MediaScreen clicked: ${Je}`),zs("MediaScreen clicked:",Je),Ee(Je)}catch(Je){console.error("Error handling MediaScreen click:",Je)}},Le=ze=>{if(ze.detail&&ze.detail.eventName==="RegisterMediaScreen")be({detail:ze.detail.eventData});else if(ze.detail&&ze.detail.eventName==="MediaScreenClick")Pe({detail:ze.detail.eventData});else if(ze.detail&&ze.detail.eventName==="SetMediaScreenImage")try{const Je=JSON.parse(ze.detail.eventData);Je.mediaScreenId&&(zs("SetMediaScreenImage event received:",Je),l(et=>Array.isArray(et)&&et.some(rt=>rt.mediaScreenId===Je.mediaScreenId)?et.map(rt=>rt.mediaScreenId===Je.mediaScreenId?{...rt,imageUrl:Je.imageUrl,hasImage:!!Je.imageUrl,displayAsVideo:Je.displayAsVideo||!1,lastUpdated:new Date().toISOString()}:rt):[...Array.isArray(et)?et:[],{mediaScreenId:Je.mediaScreenId,imageUrl:Je.imageUrl,hasImage:!!Je.imageUrl,displayAsVideo:Je.displayAsVideo||!1,source:"set-media-screen-image",firstDetected:new Date().toISOString(),lastUpdated:new Date().toISOString()}]))}catch(Je){console.error("Error handling SetMediaScreenImage event:",Je)}};return window.addEventListener("RegisterMediaScreen",be),window.addEventListener("MediaScreenClick",Pe),window.addEventListener("reactUnityEvent",Le),()=>{window.removeEventListener("RegisterMediaScreen",be),window.removeEventListener("MediaScreenClick",Pe),window.removeEventListener("reactUnityEvent",Le)}},[e,E,U,o,ie,We,de,Ee,n]),N.useEffect(()=>{const be=Pe=>{try{zs("Direct MediaScreenClick event received:",Pe);let Le;if(Pe.detail)try{Le=JSON.parse(Pe.detail).mediaScreenId}catch(ze){console.error("Error parsing MediaScreenClick event detail:",ze);return}if(!Le){console.error("No mediaScreenId found in MediaScreenClick event");return}zs(`Direct handler: Processing click for media screen ${Le}`),Ee(Le)}catch(Le){console.error("Error in direct MediaScreenClick handler:",Le)}};return window.addEventListener("MediaScreenClick",be),()=>{window.removeEventListener("MediaScreenClick",be)}},[Ee]),N.useEffect(()=>{re&&$e()},[re,$e]);const Te=()=>{ue(),ve()};return N.useEffect(()=>{const Pe=W("RegisterMediaScreen",Le=>{try{if(q.log("Direct RegisterMediaScreen event received with data:",Le),!Le||!Le.mediaScreenId){q.warn("RegisterMediaScreen event received with invalid data");return}const ze=Le.mediaScreenId;q.log(`Media screen registered directly: ${ze}`),l(Je=>Je.some(ut=>ut.mediaScreenId===ze)?Je.map(ut=>ut.mediaScreenId===ze?{...ut,...Le,source:"direct-event",lastUpdated:new Date().toISOString()}:ut):[...Je,{...Le,source:"direct-event",firstDetected:new Date().toISOString(),lastUpdated:new Date().toISOString()}]),e&&U("SetMediaScreenEditMode",{mediaScreenId:ze,enabled:!0,showUploadIcon:!0})}catch(ze){console.error("Error handling direct RegisterMediaScreen event:",ze)}});return()=>{Pe()}},[W,e,U]),N.useEffect(()=>{const Pe=W("MediaScreenClick",Le=>{try{if(q.log("Direct MediaScreenClick event received with data:",Le),!Le||!Le.mediaScreenId){q.warn("MediaScreenClick event received with invalid data");return}const ze=Le.mediaScreenId;q.log(`Media screen clicked directly: ${ze}`),Ee(ze)}catch(ze){console.error("Error handling direct MediaScreenClick event:",ze)}});return()=>{Pe()}},[W,Ee]),N.useEffect(()=>{e&&he&&(console.log(`[DEBUG] Detected currentVideoMediaScreenId change in edit mode: ${he}`),p(he),E(),ue())},[e,he,E,ue]),w.jsxs(w.Fragment,{children:[w.jsx(kze,{isOpen:_,onClose:b,mediaScreenId:d,onImageChange:ke}),w.jsx(Uze,{}),w.jsx(Yl,{containerRef:B,children:w.jsxs(oo,{isOpen:ie,onClose:Q,size:"lg",isCentered:!0,portalProps:{containerRef:B},id:"image-viewer-modal",blockScrollOnMount:!0,children:[w.jsx(co,{bg:"rgba(0, 0, 0, 0.8)",onClick:X,onMouseMove:X,onMouseDown:X,onMouseUp:X,onWheel:X}),w.jsxs(ao,{ref:Z,bg:"gray.900",color:"white",borderRadius:"lg",overflow:"hidden",maxWidth:"80vw",maxHeight:"80vh",display:"flex",justifyContent:"center",alignItems:"center",position:"relative",zIndex:"10000",className:"image-viewer-modal-content",onClick:X,onMouseMove:X,onMouseDown:X,onMouseUp:X,onWheel:X,children:[w.jsx(Ko,{size:"lg",bg:"gray.700",color:"white",borderRadius:"full",zIndex:"modal",_hover:{bg:"gray.600"},_focus:{boxShadow:"none"},position:"absolute",top:"10px",right:"10px"}),w.jsx(Ro,{p:0,width:"100%",onClick:X,onMouseMove:X,onMouseDown:X,onMouseUp:X,onWheel:X,children:ce?w.jsx(lt,{position:"relative",width:"100%",height:"100%",display:"flex",justifyContent:"center",alignItems:"center",onClick:X,onMouseMove:X,onMouseDown:X,onMouseUp:X,onWheel:X,children:ne==="image"?w.jsx(Jh,{src:ce,maxWidth:"100%",maxHeight:"80vh",objectFit:"contain",alt:"Media Screen Image",onLoad:()=>console.log("Image loaded successfully:",ce),onError:be=>console.error("Error loading image:",be,ce),onClick:X}):w.jsxs(lt,{width:"100%",textAlign:"center",onClick:X,onMouseMove:X,onMouseDown:X,onMouseUp:X,onWheel:X,children:[w.jsx(Ze,{mb:4,fontSize:"lg",children:"Video URL:"}),w.jsx(Ze,{p:3,bg:"gray.800",borderRadius:"md",fontSize:"sm",wordBreak:"break-all",maxWidth:"100%",children:ce}),w.jsx(Ze,{mt:4,fontSize:"sm",color:"gray.400",children:"Video playback will be implemented in a future update"})]})}):w.jsx(wr,{direction:"column",align:"center",justify:"center",h:"400px",onClick:X,onMouseMove:X,onMouseDown:X,onMouseUp:X,onWheel:X,children:w.jsx(Ze,{children:"No image available"})})})]})]})}),w.jsx(Lze,{videoUrl:re,videoTitle:pe,mediaScreenId:he,isOpen:We,onClose:Te})]})},_ae=({backgroundUrl:n=null,videoBackgroundUrl:e=null,containerRef:i})=>{const[o,l]=N.useState(!1),[d,p]=N.useState(n),[_,E]=N.useState(e),b=N.useRef(null),C=N.useRef(null),I=N.useRef(null),O=N.useRef(!1),L=N.useRef(!1);N.useEffect(()=>{if(!(O.current||L.current)){if(L.current=!0,console.log(` PersistentBackground: Initializing with props - videoUrl: ${e}, imageUrl: ${n}`),e){console.log(` PersistentBackground: Using provided video URL: ${e}`),B(e),O.current=!0;return}if(n){console.log(` PersistentBackground: No video available, using image: ${n}`),W(n),O.current=!0;return}U()}},[n,e]),N.useEffect(()=>{const ie=ce=>{const{videoBackgroundUrl:ne}=ce.detail;console.log(` PersistentBackground: Received video background update event: ${ne}`),ne&&!O.current&&(B(ne),O.current=!0)};return window.addEventListener("SpaceVideoBackgroundUpdated",ie),()=>{window.removeEventListener("SpaceVideoBackgroundUpdated",ie)}},[]);const U=()=>{const ce=window.location.pathname.match(/\/space\/([^\/]+)/);if(!ce||!ce[1]){console.warn(" PersistentBackground: Couldn't extract space ID from URL");return}const ne=ce[1];console.log(` PersistentBackground: Found space ID: ${ne}`),Bp(ne).then(de=>{if(console.log(` PersistentBackground: Retrieved space data for ${ne}:`,de?"success":"null"),de&&de.videoBackgroundUrl)console.log(` PersistentBackground: VIDEO FOUND: ${de.videoBackgroundUrl}`),B(de.videoBackgroundUrl),O.current=!0;else if(de&&(de.backgroundUrl||de.backgroundGsUrl)){const Q=de.backgroundUrl||de.backgroundGsUrl;console.log(` PersistentBackground: No video available, using image backdrop: ${Q}`),W(Q),O.current=!0}}).catch(de=>{console.error(" PersistentBackground: Error fetching space data:",de)})},B=ie=>{if(!i||!i.current)return;console.log(` PersistentBackground: Setting up video background: ${ie}`),$();const ce=document.createElement("video");I.current=ce,ce.autoplay=!0,ce.loop=!0,ce.muted=!0,ce.playsInline=!0,ce.setAttribute("playsinline",""),ce.setAttribute("webkit-playsinline",""),ce.setAttribute("preload","auto"),ce.src=ie,Object.assign(ce.style,{position:"absolute",top:"0",left:"0",width:"100%",height:"100%",objectFit:"cover",zIndex:"20",transition:"opacity 1.5s ease-in-out",pointerEvents:"none"}),i.current.appendChild(ce),J(),ce.load();try{ce.play().then(()=>console.log(" VIDEO PLAYING SUCCESSFULLY")).catch(ne=>{console.warn(" First video play attempt failed:",ne);const de=()=>{ce.play().then(()=>console.log(" Video started after user interaction")).catch(Q=>console.error(" Video still failed to play:",Q))};window.addEventListener("click",de,{once:!0}),window.addEventListener("touchstart",de,{once:!0}),setTimeout(()=>{ce.play().then(()=>console.log(" Video started after timeout")).catch(Q=>console.error(" Video still failed to play after timeout:",Q))},1e3)})}catch(ne){console.error(" Error attempting to play video:",ne)}},W=ie=>{if(!i||!i.current||!ie)return;console.log(` PersistentBackground: Setting up image background: ${ie}`);const ce=document.createElement("div");b.current=ce,Object.assign(ce.style,{position:"absolute",top:"0",left:"0",width:"100%",height:"100%",backgroundImage:`url('${ie}')`,backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat",zIndex:"19",transition:"opacity 1.5s ease-in-out",pointerEvents:"none"}),i.current.appendChild(ce),J()},J=()=>{if(!i||!i.current)return;const ie=document.createElement("div");C.current=ie,Object.assign(ie.style,{position:"absolute",top:"0",left:"0",width:"100%",height:"100%",backdropFilter:"blur(5px)",WebkitBackdropFilter:"blur(5px)",backgroundColor:"rgba(255, 255, 255, 0.08)",zIndex:"21",transition:"opacity 1.5s ease-in-out",pointerEvents:"none"}),i.current.appendChild(ie)},$=()=>{!i||!i.current||(b.current&&i.current.contains(b.current)&&(i.current.removeChild(b.current),b.current=null),I.current&&i.current.contains(I.current)&&(I.current.pause(),I.current.src="",I.current.load(),i.current.removeChild(I.current),I.current=null),C.current&&i.current.contains(C.current)&&(i.current.removeChild(C.current),C.current=null))};return N.useEffect(()=>{if(!i||!i.current)return;const ie=()=>{console.log(" PersistentBackground: Player instantiated, removing background"),l(!0),b.current&&(b.current.style.opacity="0"),I.current&&(I.current.style.opacity="0"),C.current&&(C.current.style.opacity="0"),setTimeout(()=>{$()},1500)};if(window.isPlayerInstantiated){console.log(" PersistentBackground: Player was already instantiated"),ie();return}jd.subscribe(Fd.playerInstantiated,ie),window.addEventListener("PlayerInstantiated",ie);const ce=setTimeout(()=>{console.log(" PersistentBackground: Timeout reached, removing background"),ie()},3e4);return()=>{jd.unsubscribe(Fd.playerInstantiated,ie),window.removeEventListener("PlayerInstantiated",ie),clearTimeout(ce),$()}},[i]),null};_ae.propTypes={backgroundUrl:_n.string,videoBackgroundUrl:_n.string,containerRef:_n.shape({current:_n.instanceOf(Element)})};const qQ="https://www.spacesmetaverse.com/assets/images/SpacesLogo_Loader.png",yae=({containerRef:n})=>{const{spaceID:e}=Ra(),[i,o]=N.useState(!1),[l,d]=N.useState(!1),[p,_]=N.useState(0),[E,b]=N.useState("Initialising World"),[C,I]=N.useState(null),O=N.useRef(null),L=N.useRef(null),U=N.useRef(null),B=N.useRef(null),W=N.useRef(null),J=N.useRef(null);N.useEffect(()=>(q.log("PersistentLoader: Component mounted with spaceID:",e),q.log("PersistentLoader: Container ref:",n),()=>{q.log("PersistentLoader: Component unmounting")}),[]);const{error:$}=Ra(),[ie,ce]=N.useState(!1);return N.useEffect(()=>{$&&(q.error("PersistentLoader: Unity error detected:",$),ce(!0),setTimeout(()=>{if(O.current){const ne=O.current.querySelector("div:first-child");ne&&(ne.textContent="Reconnecting...")}},3e3))},[$]),N.useEffect(()=>{(async()=>{if(e){q.log(`PersistentLoader: Fetching logo for space ${e}`);try{const de=await Bp(e);de&&de.logoUrl?(q.log(`PersistentLoader: Found logo URL: ${de.logoUrl}`),I(de.logoUrl)):q.log(`PersistentLoader: No logo URL found for space ${e}`)}catch(de){q.error("PersistentLoader: Error fetching space logo:",de)}}else q.warn("PersistentLoader: No spaceID provided, cannot fetch logo")})()},[e]),N.useEffect(()=>{const ne=de=>{const{logoUrl:Q}=de.detail;q.log(`PersistentLoader: Logo update event received with URL: ${Q}`),I(Q),L.current?Q?(q.log("PersistentLoader: Updating logo element with new URL"),L.current.src=Q,U.current.style.display="flex"):(q.log("PersistentLoader: Hiding logo element (no URL)"),U.current.style.display="none"):q.warn("PersistentLoader: Logo ref is null during update")};return q.log("PersistentLoader: Adding SpaceLogoUpdated event listener"),window.addEventListener("SpaceLogoUpdated",ne),()=>{q.log("PersistentLoader: Removing SpaceLogoUpdated event listener"),window.removeEventListener("SpaceLogoUpdated",ne)}},[]),N.useEffect(()=>{if(!n||!n.current){q.error("PersistentLoader: Container ref is null or has no current property");return}q.log("PersistentLoader: Creating loader elements");const ne=document.createElement("div");if(O.current=ne,Object.assign(ne.style,{position:"absolute",top:"60%",left:"50%",transform:"translate(-50%, -50%)",width:"300px",padding:"16px",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",zIndex:"50",transition:"opacity 0.8s ease-in-out",pointerEvents:"none",color:"white",fontFamily:"Arial, sans-serif",backgroundColor:"rgba(0, 0, 0, 0.4)",backdropFilter:"blur(10px)",WebkitBackdropFilter:"blur(10px)",borderRadius:"12px",boxShadow:"0 0 20px rgba(0, 0, 0, 0.3), inset 0 0 1px rgba(255, 255, 255, 0.3)",border:"1px solid rgba(255, 255, 255, 0.1)",opacity:"0"}),C){q.log(`PersistentLoader: Creating logo element with URL: ${C}`);const ve=document.createElement("div");U.current=ve,Object.assign(ve.style,{position:"absolute",top:"37.5%",left:"50%",transform:"translate(-50%, -50%)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:"50",transition:"opacity 0.8s ease-in-out",pointerEvents:"none",padding:"8px",width:"280px",opacity:"0"});const _e=document.createElement("img");L.current=_e,_e.src=C,_e.alt="Space Logo",_e.style.maxHeight="100px",_e.style.maxWidth="100%",_e.style.objectFit="contain",_e.style.filter="drop-shadow(0 0 8px rgba(0, 0, 0, 0.7))",ve.appendChild(_e),n.current.appendChild(ve),q.log("PersistentLoader: Logo container added to main container")}else q.log("PersistentLoader: No logo URL available, skipping logo creation");const de=document.createElement("style");de.textContent=`
      @keyframes progress-glow {
        0% { background-position: 0% 50%; }
        50% { background-position: 100% 50%; }
        100% { background-position: 0% 50%; }
      }
    `,document.head.appendChild(de),q.log("PersistentLoader: Animation styles added to document head");const Q=document.createElement("div");Q.style.fontSize="16px",Q.style.fontWeight="bold",Q.style.textAlign="center",Q.style.marginBottom="16px",Q.style.color="#ffffff",Q.textContent="Initialising World";const Z=document.createElement("div");Z.style.width="240px",Z.style.height="100px",Z.style.position="relative",Z.style.marginBottom="15px",Z.style.padding="0px",Z.style.overflow="hidden",Z.style.boxSizing="border-box",Z.style.transition="opacity 0.8s ease-in-out",Z.style.opacity="0";const X=document.createElement("div");X.style.width="100%",X.style.height="100%",X.style.position="absolute",X.style.top="0",X.style.left="0",X.style.maskImage=`url(${qQ})`,X.style.maskSize="contain",X.style.maskPosition="center",X.style.maskRepeat="no-repeat",X.style.webkitMaskImage=`url(${qQ})`,X.style.webkitMaskSize="contain",X.style.webkitMaskPosition="center",X.style.webkitMaskRepeat="no-repeat",X.style.background="linear-gradient(to right, #4facfe 0%, #00f2fe 15%, white 15%, white 100%)",X.style.backgroundSize="100% 100%",X.style.transition="background 0.5s ease-out",B.current=X,W.current=null,Z.appendChild(X);const re=document.createElement("div");re.style.marginTop="8px",re.style.fontSize="14px",re.style.fontWeight="bold",re.style.color="#ffffff",re.textContent="0%",ne.appendChild(Q),ne.appendChild(Z),ne.appendChild(re),n.current.appendChild(ne),q.log("PersistentLoader: Loader element added to container"),setTimeout(()=>{U.current&&(U.current.style.opacity="1"),ne.style.opacity="1",Z.style.opacity="1"},500);const pe=ve=>{_(ve);const _e=Math.round(ve*100),Ee=`linear-gradient(to right, #4facfe 0%, #00f2fe ${_e}%, white ${_e}%, white 100%)`;X.style.background=Ee,re.textContent=`${_e}%`,q.log(`PersistentLoader: Progress updated to ${_e}%`)},he=ve=>{b(ve),Q.textContent=ve,q.log(`PersistentLoader: Loading stage updated to "${ve}"`)},ue=[{stage:"Initialising World",progress:.33},{stage:"Loading Assets",progress:.66},{stage:"Loading User",progress:1}];ie&&(ue[0].stage="Connecting to Space",ue[1].stage="Reconnecting...",ue[2].stage="Please Wait"),he(ue[0].stage),pe(.25);const xe=ve=>{const _e=ve.detail.progress;q.log(`PersistentLoader: Progress event received with value: ${_e}`),pe(_e),_e<.33?he(ue[0].stage):_e<.66?he(ue[1].stage):he(ue[2].stage)},We=()=>{q.log("PersistentLoader: First scene loaded event received"),o(!0),he(ue[1].stage),pe(.66)},$e=()=>{if(q.log("PersistentLoader: Player instantiated event received"),J.current&&(clearInterval(J.current),q.log("PersistentLoader: Progress interval cleared")),d(!0),he(ue[2].stage),pe(1),ie){q.log("PersistentLoader: Keeping loader visible due to Unity error");return}ne.style.transition="all 0.5s ease-in-out",Z.style.transition="opacity 1.2s ease-in-out",Q.style.transition="opacity 0.4s ease-in-out",re.style.transition="opacity 0.4s ease-in-out",U.current&&(U.current.style.transition="opacity 0.5s ease-in-out"),ne.style.backgroundColor="rgba(0, 0, 0, 0)",ne.style.backdropFilter="blur(0px)",ne.style.WebkitBackdropFilter="blur(0px)",ne.style.boxShadow="0 0 0 rgba(0, 0, 0, 0)",ne.style.border="1px solid rgba(255, 255, 255, 0)",Q.style.opacity="0",re.style.opacity="0",U.current&&(U.current.style.opacity="0"),setTimeout(()=>{Z.style.opacity="0",setTimeout(()=>{n.current&&n.current.contains(ne)?(n.current.removeChild(ne),q.log("PersistentLoader: Loader element removed after fade")):q.warn("PersistentLoader: Could not remove loader element (not found in container)"),U.current&&n.current&&n.current.contains(U.current)?(n.current.removeChild(U.current),q.log("PersistentLoader: Logo container removed after fade")):U.current&&q.warn("PersistentLoader: Could not remove logo container (not found in container)")},1300)},400)};if(window.isPlayerInstantiated)q.log("PersistentLoader: Player was already instantiated"),$e();else{q.log("PersistentLoader: Subscribing to playerInstantiated event"),jd.subscribe(Fd.playerInstantiated,$e);const ve=()=>$e();q.log("PersistentLoader: Adding PlayerInstantiated event listener"),window.addEventListener("PlayerInstantiated",ve),q.log("PersistentLoader: Adding firstSceneLoaded event listener"),jd.subscribe(Fd.firstSceneLoaded,We),q.log("PersistentLoader: Adding UnityProgress event listener"),window.addEventListener("UnityProgress",xe),J.current=setInterval(()=>{l||_(Ee=>{const ke=Math.min(Ee+.02,.95);return pe(ke),ke<.33&&E!==ue[0].stage?he(ue[0].stage):ke>=.33&&ke<.66&&E!==ue[1].stage?he(ue[1].stage):ke>=.66&&E!==ue[2].stage&&he(ue[2].stage),ke})},300);const _e=setTimeout(()=>{q.log("PersistentLoader: Forcing loader removal after timeout"),$e()},6e4);return()=>{q.log("PersistentLoader: Cleaning up event listeners"),jd.unsubscribe(Fd.playerInstantiated,$e),window.removeEventListener("PlayerInstantiated",ve),jd.unsubscribe(Fd.firstSceneLoaded,We),window.removeEventListener("UnityProgress",xe),clearInterval(J.current),clearTimeout(_e),n.current&&n.current.contains(ne)&&(n.current.removeChild(ne),q.log("PersistentLoader: Loader element removed during cleanup")),U.current&&n.current&&n.current.contains(U.current)&&(n.current.removeChild(U.current),q.log("PersistentLoader: Logo container removed during cleanup"))}}},[C,n]),null};yae.propTypes={containerRef:_n.shape({current:_n.instanceOf(Element)})};const Fze=({size:n="md",tooltipPlacement:e="top",className:i="livestream-button"})=>{const[o,l]=N.useState(!1),[d,p]=N.useState(!1),{savedStreamData:_,reloadStreamData:E}=tae(),{spaceID:b}=Ra(),{user:C}=N.useContext(Ao),I=Ic(),[O,L]=N.useState(!1),U=GK((_==null?void 0:_.rtmpUrl)||""),B=GK((_==null?void 0:_.streamKey)||"");N.useEffect(()=>{if(b){q.log("LiveStreamButton: Forcing reload of stream data"),E();const $=()=>{q.log("LiveStreamButton: Stream settings changed, reloading data"),E()};return window.addEventListener("StreamSettingsChanged",$),()=>{window.removeEventListener("StreamSettingsChanged",$)}}},[b,E]),N.useEffect(()=>{(async()=>{if(!(C!=null&&C.uid)||!b){L(!1);return}try{const ie=await VBe(C.uid,"disruptiveAdmin"),ce=await zBe(C,b);L(ie||ce)}catch(ie){q.error("Error checking user permissions:",ie),L(!1)}})()},[C==null?void 0:C.uid,b]),N.useEffect(()=>{q.log("LiveStreamButton: Current streaming data:",{enabled:_==null?void 0:_.enabled,hasRtmpUrl:!!(_!=null&&_.rtmpUrl),hasStreamKey:!!(_!=null&&_.streamKey),hasPermission:O,isPlayerReady:d})},[_,O,d]),N.useEffect(()=>{const $=()=>{q.log("LiveStreamButton: Player instantiated, showing button"),p(!0)};return window.addEventListener("PlayerInstantiated",$),window.isPlayerInstantiated&&(q.log("LiveStreamButton: Player was already instantiated"),p(!0)),()=>{window.removeEventListener("PlayerInstantiated",$)}},[]);const W=()=>{window.dispatchEvent(new Event("modal-opened")),l(!0)},J=()=>{window.dispatchEvent(new Event("modal-closed")),l(!1)};return!d||!O||(_==null?void 0:_.enabled)!==!0?(q.log("LiveStreamButton: Not rendering button because:",{playerNotReady:!d,noPermission:!O,streamingDisabled:(_==null?void 0:_.enabled)!==!0,enabledValue:_==null?void 0:_.enabled}),null):w.jsxs(w.Fragment,{children:[w.jsx(Vp,{label:"Live Stream Info",placement:e,hasArrow:!0,children:w.jsx($l,{size:n,borderRadius:"full",bg:"black",icon:w.jsx(q8e,{color:"white"}),borderWidth:"1px",borderColor:"whiteAlpha.300",className:i,"data-testid":"livestream-button",cursor:"pointer",onClick:W})}),w.jsxs(oo,{isOpen:o,onClose:J,isCentered:!0,size:"md",children:[w.jsx(co,{backdropFilter:"blur(4px)"}),w.jsxs(ao,{bg:"rgba(23, 25, 35, 0.95)",color:"white",borderRadius:"md",boxShadow:"0 4px 20px rgba(0, 0, 0, 0.5)",children:[w.jsx(tc,{borderBottom:"1px solid",borderColor:"whiteAlpha.200",py:2,fontSize:"md",fontWeight:"600",children:"Live Stream Info"}),w.jsx(Ko,{size:"sm",color:"whiteAlpha.700",_hover:{color:"white",bg:"whiteAlpha.100"}}),w.jsx(Ro,{p:4,children:_!=null&&_.rtmpUrl&&(_!=null&&_.streamKey)?w.jsxs(lt,{children:[w.jsx(Ze,{fontSize:"sm",mb:4,color:"white",children:"Copy these details to your streaming software (OBS, Streamlabs, etc.)"}),w.jsxs(lt,{mb:4,children:[w.jsx(Ze,{fontSize:"xs",fontWeight:"600",mb:1,color:"white",children:"RTMP URL"}),w.jsx(wr,{children:w.jsxs(Rg,{size:"sm",children:[w.jsx(oi,{value:_.rtmpUrl,isReadOnly:!0,bg:"whiteAlpha.100",borderColor:"whiteAlpha.200",_hover:{borderColor:"whiteAlpha.300"},pr:"2.5rem",color:"white"}),w.jsx(Jk,{children:w.jsx(Ho,{"aria-label":"Copy RTMP URL",icon:U.hasCopied?w.jsx(BQ,{}):w.jsx(WQ,{}),size:"xs",colorScheme:U.hasCopied?"green":"blue",onClick:()=>{U.onCopy(),I({title:"RTMP URL copied",status:"success",duration:2e3,isClosable:!0,position:"top"})}})})]})})]}),w.jsxs(lt,{mb:4,children:[w.jsx(Ze,{fontSize:"xs",fontWeight:"600",mb:1,color:"white",children:"Stream Key"}),w.jsx(wr,{children:w.jsxs(Rg,{size:"sm",children:[w.jsx(oi,{value:_.streamKey,isReadOnly:!0,bg:"whiteAlpha.100",borderColor:"whiteAlpha.200",_hover:{borderColor:"whiteAlpha.300"},pr:"2.5rem",type:"password",color:"white"}),w.jsx(Jk,{children:w.jsx(Ho,{"aria-label":"Copy Stream Key",icon:B.hasCopied?w.jsx(BQ,{}):w.jsx(WQ,{}),size:"xs",colorScheme:B.hasCopied?"green":"blue",onClick:()=>{B.onCopy(),I({title:"Stream Key copied",status:"success",duration:2e3,isClosable:!0,position:"top"})}})})]})})]}),w.jsx(Ze,{fontSize:"xs",color:"whiteAlpha.800",mt:4,children:"Stream to this RTMP server using the Stream Key above. View and manage stream settings in the Space Manager."})]}):w.jsxs(lt,{textAlign:"center",p:4,children:[w.jsx(Ze,{color:"white",children:"No stream configuration found for this space."}),w.jsx(Ze,{fontSize:"xs",mt:2,color:"whiteAlpha.800",children:"Configure streaming in the Space Manager under Stream tab."})]})})]})]})]})},Eae=({settings:n})=>{const{placePrefab:e,directPlacePrefab:i,isUnityLoaded:o}=iae(),l=Ic(),[d,p]=N.useState({x:0,y:1,z:0}),[_,E]=N.useState({x:0,y:0,z:0}),[b,C]=N.useState({x:1,y:1,z:1}),[I,O]=N.useState("TestPrefab"),[L,U]=N.useState(!1),[B,W]=N.useState(!1),[J,$]=N.useState(!1),{user:ie}=N.useContext(Ao),ce=n==null?void 0:n.spaceID,{saveObject:ne,isLoading:de}=A8e(ce);N.useEffect(()=>{(async()=>{if(ie!=null&&ie.uid)try{const pe=await p3(ie.uid,"disruptiveAdmin");$(pe)}catch(pe){console.error("Error checking admin status:",pe),$(!1)}})()},[ie==null?void 0:ie.uid]),N.useEffect(()=>{const re=pe=>{W(pe.detail.enabled)};return window.addEventListener("editModeChanged",re),()=>{window.removeEventListener("editModeChanged",re)}},[]);const Q=(re,pe)=>{p(he=>({...he,[re]:parseFloat(pe)}))},Z=async()=>{q.log("Placing prefab with values:",{prefabName:I,position:d,rotation:_,scale:b,useDirect:L,spaceId:ce});let re;if(L?(re=i(I,d,_,b),q.log("Used direct method to place prefab")):(re=e(I,d,_,b),q.log("Used hook method to place prefab")),re)if(ce&&B){const pe=await ne(I,d,_,b);l(pe?{title:"Success",description:"Prefab placed and saved to space",status:"success",duration:3e3,isClosable:!0}:{title:"Warning",description:"Prefab placed but failed to save to space",status:"warning",duration:3e3,isClosable:!0})}else l({title:"Success",description:"Prefab placed",status:"success",duration:3e3,isClosable:!0});else l({title:"Error",description:"Failed to place prefab",status:"error",duration:3e3,isClosable:!0})},X=()=>{const re={x:(Math.random()*10-5).toFixed(2),y:(Math.random()*2).toFixed(2),z:(Math.random()*10-5).toFixed(2)};p({x:parseFloat(re.x),y:parseFloat(re.y),z:parseFloat(re.z)}),q.log("Set random position:",re)};return!B||!J?null:w.jsxs(lt,{className:"prefab-placer",bg:"rgba(0, 0, 0, 0.7)",color:"white",p:4,borderRadius:"md",maxW:"300px",boxShadow:"0 4px 6px rgba(0, 0, 0, 0.1)",children:[w.jsx(Ze,{fontWeight:"bold",mb:2,children:"Place Prefab in Unity"}),w.jsxs(lt,{mb:3,children:[w.jsx(Ze,{fontSize:"sm",children:"Prefab Name:"}),w.jsx("input",{type:"text",value:I,onChange:re=>O(re.target.value),style:{width:"100%",padding:"8px",marginTop:"4px",background:"rgba(255, 255, 255, 0.1)",border:"1px solid rgba(255, 255, 255, 0.3)",borderRadius:"4px",color:"white"}})]}),w.jsxs(wr,{direction:"column",gap:2,mb:3,children:[w.jsx(Ze,{fontSize:"sm",children:"Position:"}),w.jsxs(wr,{gap:2,children:[w.jsxs(lt,{children:[w.jsx(Ze,{fontSize:"xs",children:"X"}),w.jsxs(_k,{value:d.x,onChange:re=>Q("x",re),step:.5,precision:2,size:"sm",children:[w.jsx(Ek,{bg:"rgba(255, 255, 255, 0.1)",borderColor:"rgba(255, 255, 255, 0.3)"}),w.jsxs(yk,{children:[w.jsx(Sk,{}),w.jsx(vk,{})]})]})]}),w.jsxs(lt,{children:[w.jsx(Ze,{fontSize:"xs",children:"Y"}),w.jsxs(_k,{value:d.y,onChange:re=>Q("y",re),step:.5,precision:2,size:"sm",children:[w.jsx(Ek,{bg:"rgba(255, 255, 255, 0.1)",borderColor:"rgba(255, 255, 255, 0.3)"}),w.jsxs(yk,{children:[w.jsx(Sk,{}),w.jsx(vk,{})]})]})]}),w.jsxs(lt,{children:[w.jsx(Ze,{fontSize:"xs",children:"Z"}),w.jsxs(_k,{value:d.z,onChange:re=>Q("z",re),step:.5,precision:2,size:"sm",children:[w.jsx(Ek,{bg:"rgba(255, 255, 255, 0.1)",borderColor:"rgba(255, 255, 255, 0.3)"}),w.jsxs(yk,{children:[w.jsx(Sk,{}),w.jsx(vk,{})]})]})]})]}),w.jsx(ur,{onClick:X,size:"xs",colorScheme:"blue",variant:"outline",mt:1,children:"Random Position"})]}),w.jsxs(kr,{display:"flex",alignItems:"center",mb:3,children:[w.jsx($i,{htmlFor:"use-direct",mb:"0",fontSize:"sm",children:"Use Direct Method"}),w.jsx(cf,{id:"use-direct",colorScheme:"green",isChecked:L,onChange:re=>U(re.target.checked)})]}),w.jsx(ur,{onClick:Z,colorScheme:"green",width:"100%",isDisabled:!o||de,children:de?"Loading...":"Place Prefab"}),!o&&w.jsx(Ze,{fontSize:"xs",color:"red.300",mt:1,children:"Waiting for Unity to load..."}),!ce&&w.jsx(Ze,{fontSize:"xs",color:"yellow.300",mt:1,children:"No space ID available - prefabs won't be saved"})]})};Eae.propTypes={settings:_n.shape({spaceID:_n.string})};const jze="a2a7f4eb05284449b1063eb71d8301dc",GU=()=>document.querySelector("canvas")||document.getElementById("unity-canvas"),O3=N.forwardRef(({settings:n},e)=>{const{unityProvider:i,isLoaded:o,error:l}=Ra(),d=h8e();p8e();const p=Sf(),_=P8e(d),{user:E}=N.useContext(Ao),[b,C]=N.useState(!1),[I,O]=N.useState(window.devicePixelRatio),[L,U]=f8e();rae().find(ke=>ke.isLocalPlayer);const[W,J]=N.useState(!0),[$,ie]=N.useState(!0),[ce,ne]=N.useState(!1),[de,Q]=N.useState(!1),[Z,X]=N.useState(!1);N.useEffect(()=>{Z?(console.log("WebGLRenderer: Modal opened, disabling Unity keyboard capture"),Vd(!0)):(console.log("WebGLRenderer: Modal closed, enabling Unity keyboard capture"),o&&!de&&Vd(!1).then(()=>{setTimeout(()=>{Ty(!0)},100)}))},[Z,o,de]);const re=n.spaceID||"default",pe=N.useMemo(()=>{const be=new URLSearchParams(window.location.search).get("sessionId")||re;return console.log("WebGLRenderer: Using session ID:",be),be},[re]),[he,ue]=N.useState(null);N.useEffect(()=>{E!=null&&E.uid&&Hu(E.uid).then(ke=>{ue(ke),console.log("WebGLRenderer: User profile loaded:",(ke==null?void 0:ke.Nickname)||"Unknown")}).catch(ke=>{console.error("Error fetching user profile:",ke)})},[E==null?void 0:E.uid]),N.useEffect(()=>{if(l||!E){q.log("WebGLRenderer: User not logged in or Unity error, showing sign-in modal");const ke=setTimeout(()=>{Q(!0),X(!0)},1e3);return()=>clearTimeout(ke)}else Q(!1)},[l,E]),N.useEffect(()=>{console.log("WebGLRenderer: Setting up player instantiation listener");const ke=()=>{console.log("WebGLRenderer: Player instantiated event received"),ie(!0),window.dispatchEvent(new CustomEvent("PlayerInstantiated")),window.isPlayerInstantiated=!0};window.isPlayerInstantiated&&(console.log("WebGLRenderer: Player was already instantiated from previous mount"),ie(!0)),jd.subscribe(Fd.playerInstantiated,ke);const Te=setTimeout(()=>{$||(console.log("WebGLRenderer: Forcing player instantiation after timeout"),ie(!0),window.isPlayerInstantiated=!0,window.dispatchEvent(new CustomEvent("PlayerInstantiated")))},5e3);return()=>{jd.unsubscribe(Fd.playerInstantiated,ke),clearTimeout(Te)}},[$]),N.useEffect(()=>{const ke=()=>{console.log("WebGLRenderer: Modal opened"),X(!0)},Te=()=>{console.log("WebGLRenderer: Modal closed"),X(!1)};return window.addEventListener("modal-opened",ke),window.addEventListener("modal-closed",Te),()=>{window.removeEventListener("modal-opened",ke),window.removeEventListener("modal-closed",Te)}},[]),N.useEffect(()=>{X(L!==null)},[L]),N.useEffect(()=>{o||d?setTimeout(()=>{C(!0),q.log("WebGLRenderer: Unity is ready to receive messages.")},5e3):q.warn("WebGLRenderer: Unity is NOT ready yet.")},[o,d]),N.useEffect(()=>{o&&i&&setTimeout(()=>{if(window.unityInstance)try{console.log("WebGLRenderer: Disabling Unity keyboard capture on initialization"),window.unityInstance.SendMessage("WebGLInput","SetCaptureAllKeyboardInput",!1)}catch(ke){console.error("WebGLRenderer: Error disabling Unity keyboard capture:",ke)}},1e3)},[o,i]),N.useEffect(()=>{const ke=document.getElementById("webgl-root");return ke?(console.log("WebGLRenderer: Found webgl-root element, ensuring it is visible"),ke.style.display="block",ke.getAttribute("data-space-id")!==re&&(ke.setAttribute("data-space-id",re),console.log(`WebGLRenderer: Set data-space-id attribute to ${re}`))):console.error("WebGLRenderer: Could not find webgl-root element"),()=>{}},[re]),N.useEffect(()=>{const ke=()=>{const Pe=GU();Pe?(console.log("WebGLRenderer: Configuring Unity canvas for keyboard input"),Pe.tabIndex=1,Pe.style.outline="none",Pe.addEventListener("click",()=>{console.log("WebGLRenderer: Unity canvas clicked, enabling keyboard capture"),Z||Ty(!0)}),console.log("WebGLRenderer: Unity canvas configured with tabIndex=1")):console.warn("WebGLRenderer: Could not find Unity canvas to configure")};ke();const Te=setTimeout(ke,1e3),be=()=>{console.log("WebGLRenderer: Received unityReady event, configuring canvas"),ke()};return window.addEventListener("unityReady",be),()=>{clearTimeout(Te),window.removeEventListener("unityReady",be)}},[o,Z]);const xe=N.useCallback(()=>{console.log("WebGLRenderer: Unity canvas clicked, enabling keyboard capture"),Z||Ty(!0)},[Z]);N.useEffect(()=>{if(o&&i){const ke=GU();if(ke)return console.log("WebGLRenderer: Adding click handler to Unity canvas"),ke.addEventListener("click",xe),()=>{ke.removeEventListener("click",xe)}}},[o,i,xe]),N.useEffect(()=>{if(o&&i){console.log("WebGLRenderer: Setting up global click handler for focus management");const ke=Te=>{if(Z){console.log("WebGLRenderer: Modal is open, not refocusing Unity on click");return}if(Te.target.tagName==="INPUT"||Te.target.tagName==="TEXTAREA"||Te.target.tagName==="SELECT"||Te.target.tagName==="BUTTON"){console.log("WebGLRenderer: Clicked on form element, not refocusing Unity");return}if(Te.target.closest(".chakra-modal__content")||Te.target.closest('[role="dialog"]')||Te.target.closest('[role="menu"]')||Te.target.closest(".chakra-popover__content")||Te.target.closest('[role="tooltip"]')){console.log("WebGLRenderer: Clicked inside modal/dialog content, not refocusing Unity");return}const be=GU();if(be&&(Te.target===be||be.contains(Te.target)))return;if(Te.target.closest(".webgl-overlay")||Te.target.closest(".game-ui")||Te.target.closest(".player-list")||Te.target.closest(".unity-ui-overlay")){console.log("WebGLRenderer: Clicked on UI overlay that should allow keyboard events"),setTimeout(()=>{Z||Ty(!0)},50);return}console.log("WebGLRenderer: Clicked outside forms/modals/special UI, refocusing Unity canvas"),setTimeout(()=>{be&&!Z&&((be.tabIndex===void 0||be.tabIndex<0)&&(be.tabIndex=1),be.focus(),Ty(!0))},50)};return document.addEventListener("click",ke,!0),()=>{document.removeEventListener("click",ke,!0)}}},[o,i,Z]),N.useEffect(()=>{const ke=Te=>{q.log("WebGLRenderer: Received 'sendUserToUnity' event"),p("FirebaseUserFromReact",Te)};return jd.subscribe(Fd.sendUserToUnity,ke),()=>jd.unsubscribe(Fd.sendUserToUnity,ke)},[p]);const{setFullscreenRef:We,fullscreenRef:$e}=Gd();N.useEffect(()=>{We(e.current)},[e,We]);const ve=()=>{J(!W)},_e=E&&n.enableVoiceChat;console.log("WebGLRenderer: Render with state:",{user:!!E,userId:E==null?void 0:E.uid,isPlayerInstantiated:$,showVoiceChat:_e,sessionId:pe}),N.useEffect(()=>{const ke=Te=>{ne(Te.detail.enabled)};return window.addEventListener("editModeChanged",ke),()=>{window.removeEventListener("editModeChanged",ke)}},[]),nae(),y8e();const Ee=N.useRef(null);return w.jsxs(lt,{className:"webgl-renderer",children:[n.urlLoadingBackground&&w.jsx(_ae,{backgroundUrl:n.urlLoadingBackground,videoBackgroundUrl:n.videoBackgroundUrl,containerRef:Ee}),!de&&w.jsx(yae,{containerRef:Ee}),de&&w.jsx(lt,{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",zIndex:"100",width:"100%",height:"100%",display:"flex",justifyContent:"center",alignItems:"center",children:w.jsx(BN,{mode:"button",label:"Sign In",initialIsOpen:!0,buttonProps:{size:"lg",colorScheme:"blue"}})}),w.jsx(ZF,{containerRef:$e.current?$e:document.body,children:w.jsxs("div",{ref:e,style:{width:"100%",height:"100%",aspectRatio:"auto",position:"absolute"},children:[w.jsxs(lt,{position:"absolute",zIndex:"10",top:4,right:4,display:"flex",alignItems:"center",gap:2,children:[n.showAuthButton&&w.jsx(k8e,{}),E&&w.jsx(Fze,{size:"md"}),_e&&w.jsxs(fae,{appId:jze,channel:pe,uid:E==null?void 0:E.uid,enabled:!0,children:[w.jsx(lze,{size:"md",defaultMuted:!0,joinOnClick:!0}),w.jsx(dze,{userNickname:he==null?void 0:he.Nickname})]}),w.jsx(X8e,{}),w.jsx(lt,{position:"relative",zIndex:"9999",children:w.jsx(Oze,{onTogglePlayerList:ve,spaceID:re})})]}),w.jsxs(lt,{ref:Ee,position:"relative",overflow:"hidden",width:"100%",height:"100%",bgRepeat:"no-repeat",bgSize:"cover",bgPosition:"center",bgColor:"#666666",children:[w.jsx(lt,{position:"absolute",top:"0",left:"0",width:"100%",height:"100%",backdropFilter:"blur(8px)",backgroundColor:"rgba(255, 255, 255, 0.1)",zIndex:"0"}),w.jsx(lt,{..._,width:"100%",height:"100%",position:"absolute",zIndex:"1",children:i?w.jsx(eae.Unity,{unityProvider:i,style:{width:"100%",height:"100%"},devicePixelRatio:I,tabIndex:1}):w.jsx(lt,{width:"100%",height:"100%"})}),w.jsx(lt,{position:"absolute",zIndex:"6",width:"100%",height:"100%",style:{display:"none"},children:w.jsx(O8e,{})})]}),w.jsx(lt,{..._,position:"absolute",zIndex:"2",top:4,left:4,display:"flex",alignItems:"flex-start",gap:3,height:"50px",children:n.showDisruptiveLogo&&w.jsx(Jh,{src:n.urlDisruptiveLogo,width:"100px",alt:"Disruptive Logo"})}),w.jsx(lt,{..._,position:"absolute",zIndex:"2",bottom:4,left:4,display:"flex",alignItems:"flex-start",gap:3,children:E&&w.jsx(Eae,{settings:n})}),w.jsxs(lt,{..._,position:"absolute",zIndex:"2",bottom:4,right:4,display:"flex",alignItems:"flex-start",gap:3,children:[n.showHelpButton&&w.jsx(N8e,{}),w.jsx(Z8e,{})]}),w.jsx(eze,{}),w.jsx(tze,{isOpen:L!==null,onClose:()=>{console.log(" Closing nameplate modal"),U()},playerName:(L==null?void 0:L.playerName)||"Unknown Player",playerId:(L==null?void 0:L.playerId)||"Unknown ID"}),w.jsx(nze,{isVisible:W,onToggleVisibility:J,spaceID:re}),w.jsx(Vze,{})]})})]})});O3.displayName="WebGLRenderer";O3.propTypes={settings:_n.shape({urlLoadingBackground:_n.string,videoBackgroundUrl:_n.string,showAuthButton:_n.bool,showDisruptiveLogo:_n.bool,urlDisruptiveLogo:_n.string,showHelpButton:_n.bool,enableVoiceChat:_n.bool,spaceID:_n.string})};typeof window<"u"&&!window.MultipleView&&(console.log("Defining fallback MultipleView class - scripts may not be loaded yet"),window.MultipleView=class{constructor(){console.log("HISPlayer: Fallback MultipleView constructor called"),this.multiView={getPlayer:()=>(console.log("HISPlayer: getPlayer called from fallback"),{isPlaying:!1,play:()=>(console.log("HISPlayer: play called"),!0),pause:()=>(console.log("HISPlayer: pause called"),!0),mute:e=>(console.log("HISPlayer: mute called with state:",e),!0),isMuted:!1,seek:e=>(console.log("HISPlayer: seek called with time:",e),!0),setVolume:e=>(console.log("HISPlayer: setVolume called with volume:",e),!0),getVolume:()=>(console.log("HISPlayer: getVolume called"),1),getCurrentTime:()=>(console.log("HISPlayer: getCurrentTime called"),0),getDuration:()=>(console.log("HISPlayer: getDuration called"),100)}),initialize:()=>(console.log("HISPlayer: initialize called"),!0),setUnityContext:e=>(console.log("HISPlayer: setUnityContext called with:",e),window.hisPlayerContextId=e,!0),release:()=>(console.log("HISPlayer: release called"),!0),setProperties:e=>(console.log("HISPlayer: setProperties called with:",e),!0),setMultiPaths:e=>(console.log("HISPlayer: setMultiPaths called with:",e),window._hisplayer_paths=e,!0)}}});if(typeof window<"u"&&!window._hisPlayerInitialized){if(q.log("WebGLLoader: Initializing HISPlayer functions"),window._hisPlayerInitialized=!0,window._hisplayer_event_queue=window._hisplayer_event_queue||[],window._hisplayer_error_queue=window._hisplayer_error_queue||[],!document.getElementById("hisplayer-error")){const n=document.createElement("div");n.id="hisplayer-error",n.style.position="absolute",n.style.top="10px",n.style.left="50%",n.style.transform="translateX(-50%)",n.style.color="red",n.style.zIndex="9999",document.body.appendChild(n),q.log("WebGLLoader: Created hisplayer-error div")}window.isErrorQueueEmpty=window.isErrorQueueEmpty||function(){return window._hisplayer_error_queue.length===0},window.getNextError=window.getNextError||function(){return window._hisplayer_error_queue.length>0?window._hisplayer_error_queue.shift():""},window.isEventQueueEmpty=window.isEventQueueEmpty||function(){return window._hisplayer_event_queue.length===0},window.getNextEvent=window.getNextEvent||function(){return window._hisplayer_event_queue.length>0?window._hisplayer_event_queue.shift():""},window.setUpContext=window.setUpContext||function(n){console.log("HISPlayer: setUpContext called with contextId:",n),window.hisPlayerContextId=n;try{if(window.MultipleView){console.log("HISPlayer: Creating MultipleView instance");const e=new window.MultipleView;if(e&&e.multiView&&typeof e.multiView.setUnityContext=="function")return e.multiView.setUnityContext(n),window._hisplayer_instance=e,console.log("HISPlayer: Successfully set Unity context ID"),!0;console.error("HISPlayer: Player initialization failed - missing expected methods")}else{console.error("HISPlayer: MultipleView class not found"),window.MultipleView=class{constructor(){console.log("HISPlayer: Backup MultipleView constructor called"),this.multiView={getPlayer:()=>(console.log("HISPlayer: getPlayer called from backup"),{isPlaying:!1,play:()=>!0,pause:()=>!0,mute:()=>!0,isMuted:!1,seek:()=>!0,setVolume:()=>!0,getVolume:()=>1,getCurrentTime:()=>0,getDuration:()=>100}),initialize:()=>!0,setUnityContext:o=>(window.hisPlayerContextId=o,!0),release:()=>!0,setProperties:()=>!0,setMultiPaths:()=>!0}}},console.log("HISPlayer: Trying again with backup MultipleView");const e=new window.MultipleView;return e.multiView.setUnityContext(n),window._hisplayer_instance=e,!0}}catch(e){console.error("HISPlayer: Error in setUpContext:",e);const i=document.getElementById("hisplayer-error");i&&(i.innerHTML="Error: "+e.message)}return!1}}const k3=({spaceID:n,overrideSettings:e})=>{const i=N.useRef(null),[o,l]=N.useState(!0),[d,p]=N.useState({spaceID:n,loaderUrl:"",dataUrl:"",frameworkUrl:"",codeUrl:""}),[_,E]=N.useState({urlDisruptiveLogo:"gs://disruptive-metaverse.appspot.com/common/images/Disruptive-logo-white-p-500.png",urlLoadingBackground:"",videoBackgroundUrl:"",showDisruptiveLogo:null,showAuthButton:null,showHelpButton:null,enableVoiceChat:!0,spaceID:n});return N.useEffect(()=>{(async()=>{try{const C=await Bp(n);if(C){console.log("Space data: ",C),p(U=>({...U,spaceID:n,loaderUrl:C.loaderUrl,dataUrl:C.dataUrl,frameworkUrl:C.frameworkUrl,codeUrl:C.codeUrl}));const I=await Dk(_.urlDisruptiveLogo);let O="";if(C.backgroundUrl)O=C.backgroundUrl;else if(C.backgroundGsUrl)try{O=await Dk(C.backgroundGsUrl)}catch(U){q.warn("WebGLLoader: Error fetching background from GS URL:",U)}else if(C.gsUrlLoadingBackground)try{O=await Dk(C.gsUrlLoadingBackground)}catch(U){q.warn("WebGLLoader: Error fetching background from legacy GS URL:",U)}let L="";C.videoBackgroundUrl&&(L=C.videoBackgroundUrl,console.log("WebGLLoader: Found video background URL:",L)),E(U=>({...U,urlLoadingBackground:O,videoBackgroundUrl:L,showAuthButton:C.showAuthButton!==void 0?C.showAuthButton:!0,showDisruptiveLogo:C.showDisruptiveLogo!==void 0?C.showDisruptiveLogo:!0,showHelpButton:C.showHelpButton!==void 0?C.showHelpButton:!0,enableVoiceChat:C.enableVoiceChat!==void 0?C.enableVoiceChat:!0,urlDisruptiveLogo:I,spaceID:n,...e||{}})),L&&(console.log("WebGLLoader: Dispatching video background event with URL:",L),window.dispatchEvent(new CustomEvent("SpaceVideoBackgroundUpdated",{detail:{videoBackgroundUrl:L}}))),l(!1)}else q.error(`WebGLLoader: No configuration found for spaceID: ${n}`)}catch(C){q.error("WebGLLoader: Error fetching space data:",C)}finally{l(!1)}})()},[n,_.urlDisruptiveLogo,e]),N.useEffect(()=>{o||(q.log("WebGLLoader: Unity config from Firebase",d),q.log("WebGLLoader: Space settings from Firebase",_))},[o]),w.jsx(w.Fragment,{children:o?w.jsx("div",{className:"flex justify-center items-center h-full mt-12",children:"Getting space data..."}):w.jsx(d8e,{...d,children:w.jsx(O3,{ref:i,settings:_})})})};k3.propTypes={spaceID:_n.string.isRequired,overrideSettings:_n.object};function YQ(){const n=document.getElementById("webgl-root");if(n){const e=n.getAttribute("data-space-id"),i=n.getAttribute("data-theme")||"default",o=()=>{const[l,d]=N.useState(null);return N.useEffect(()=>{zC(i).then(d)},[]),l?w.jsx(K1,{theme:l,children:w.jsx(MN,{children:w.jsx(S3,{children:w.jsx(k3,{spaceID:e})})})}):w.jsx("div",{children:"Loading theme..."})};try{A1.createRoot(n).render(w.jsx(o,{}))}catch(l){console.warn("Error initializing WebGL:",l)}}}typeof window<"u"&&(document.readyState==="loading"?document.addEventListener("DOMContentLoaded",YQ):YQ());const Bze=(n,e)=>{try{const i=Qp(dr,`spaces/${n}/chatMessages`),o=new Date,l=S1(i,SBe("timestamp","asc"),TBe(o));return moe(l,d=>{const p=[];d.docChanges().forEach(_=>{if(_.type==="added"){const E=_.doc.data();console.log("Firestore document data:",E),p.push({id:_.doc.id,...E})}}),p.length>0&&e(p)})}catch(i){throw q.error("Error subscribing to space chat messages:",i),i}};function Hd(n){const e=Object.prototype.toString.call(n);return n instanceof Date||typeof n=="object"&&e==="[object Date]"?new n.constructor(+n):typeof n=="number"||e==="[object Number]"||typeof n=="string"||e==="[object String]"?new Date(n):new Date(NaN)}function nE(n,e){return n instanceof Date?new n.constructor(e):new Date(e)}const vae=6048e5,Wze=864e5;let zze={};function GN(){return zze}function eR(n,e){var _,E,b,C;const i=GN(),o=(e==null?void 0:e.weekStartsOn)??((E=(_=e==null?void 0:e.locale)==null?void 0:_.options)==null?void 0:E.weekStartsOn)??i.weekStartsOn??((C=(b=i.locale)==null?void 0:b.options)==null?void 0:C.weekStartsOn)??0,l=Hd(n),d=l.getDay(),p=(d<o?7:0)+d-o;return l.setDate(l.getDate()-p),l.setHours(0,0,0,0),l}function I1(n){return eR(n,{weekStartsOn:1})}function Sae(n){const e=Hd(n),i=e.getFullYear(),o=nE(n,0);o.setFullYear(i+1,0,4),o.setHours(0,0,0,0);const l=I1(o),d=nE(n,0);d.setFullYear(i,0,4),d.setHours(0,0,0,0);const p=I1(d);return e.getTime()>=l.getTime()?i+1:e.getTime()>=p.getTime()?i:i-1}function XQ(n){const e=Hd(n);return e.setHours(0,0,0,0),e}function JQ(n){const e=Hd(n),i=new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds()));return i.setUTCFullYear(e.getFullYear()),+n-+i}function Gze(n,e){const i=XQ(n),o=XQ(e),l=+i-JQ(i),d=+o-JQ(o);return Math.round((l-d)/Wze)}function Hze(n){const e=Sae(n),i=nE(n,0);return i.setFullYear(e,0,4),i.setHours(0,0,0,0),I1(i)}function $ze(n){return n instanceof Date||typeof n=="object"&&Object.prototype.toString.call(n)==="[object Date]"}function Kze(n){if(!$ze(n)&&typeof n!="number")return!1;const e=Hd(n);return!isNaN(Number(e))}function qze(n){const e=Hd(n),i=nE(n,0);return i.setFullYear(e.getFullYear(),0,1),i.setHours(0,0,0,0),i}const Yze={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},Xze=(n,e,i)=>{let o;const l=Yze[n];return typeof l=="string"?o=l:e===1?o=l.one:o=l.other.replace("{{count}}",e.toString()),i!=null&&i.addSuffix?i.comparison&&i.comparison>0?"in "+o:o+" ago":o};function HU(n){return(e={})=>{const i=e.width?String(e.width):n.defaultWidth;return n.formats[i]||n.formats[n.defaultWidth]}}const Jze={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},Qze={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},Zze={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},eGe={date:HU({formats:Jze,defaultWidth:"full"}),time:HU({formats:Qze,defaultWidth:"full"}),dateTime:HU({formats:Zze,defaultWidth:"full"})},tGe={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},nGe=(n,e,i,o)=>tGe[n];function Vw(n){return(e,i)=>{const o=i!=null&&i.context?String(i.context):"standalone";let l;if(o==="formatting"&&n.formattingValues){const p=n.defaultFormattingWidth||n.defaultWidth,_=i!=null&&i.width?String(i.width):p;l=n.formattingValues[_]||n.formattingValues[p]}else{const p=n.defaultWidth,_=i!=null&&i.width?String(i.width):n.defaultWidth;l=n.values[_]||n.values[p]}const d=n.argumentCallback?n.argumentCallback(e):e;return l[d]}}const rGe={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},iGe={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},sGe={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},oGe={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},aGe={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},cGe={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},lGe=(n,e)=>{const i=Number(n),o=i%100;if(o>20||o<10)switch(o%10){case 1:return i+"st";case 2:return i+"nd";case 3:return i+"rd"}return i+"th"},uGe={ordinalNumber:lGe,era:Vw({values:rGe,defaultWidth:"wide"}),quarter:Vw({values:iGe,defaultWidth:"wide",argumentCallback:n=>n-1}),month:Vw({values:sGe,defaultWidth:"wide"}),day:Vw({values:oGe,defaultWidth:"wide"}),dayPeriod:Vw({values:aGe,defaultWidth:"wide",formattingValues:cGe,defaultFormattingWidth:"wide"})};function Fw(n){return(e,i={})=>{const o=i.width,l=o&&n.matchPatterns[o]||n.matchPatterns[n.defaultMatchWidth],d=e.match(l);if(!d)return null;const p=d[0],_=o&&n.parsePatterns[o]||n.parsePatterns[n.defaultParseWidth],E=Array.isArray(_)?hGe(_,I=>I.test(p)):dGe(_,I=>I.test(p));let b;b=n.valueCallback?n.valueCallback(E):E,b=i.valueCallback?i.valueCallback(b):b;const C=e.slice(p.length);return{value:b,rest:C}}}function dGe(n,e){for(const i in n)if(Object.prototype.hasOwnProperty.call(n,i)&&e(n[i]))return i}function hGe(n,e){for(let i=0;i<n.length;i++)if(e(n[i]))return i}function fGe(n){return(e,i={})=>{const o=e.match(n.matchPattern);if(!o)return null;const l=o[0],d=e.match(n.parsePattern);if(!d)return null;let p=n.valueCallback?n.valueCallback(d[0]):d[0];p=i.valueCallback?i.valueCallback(p):p;const _=e.slice(l.length);return{value:p,rest:_}}}const pGe=/^(\d+)(th|st|nd|rd)?/i,mGe=/\d+/i,gGe={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},_Ge={any:[/^b/i,/^(a|c)/i]},yGe={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},EGe={any:[/1/i,/2/i,/3/i,/4/i]},vGe={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},SGe={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},bGe={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},TGe={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},wGe={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},CGe={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},RGe={ordinalNumber:fGe({matchPattern:pGe,parsePattern:mGe,valueCallback:n=>parseInt(n,10)}),era:Fw({matchPatterns:gGe,defaultMatchWidth:"wide",parsePatterns:_Ge,defaultParseWidth:"any"}),quarter:Fw({matchPatterns:yGe,defaultMatchWidth:"wide",parsePatterns:EGe,defaultParseWidth:"any",valueCallback:n=>n+1}),month:Fw({matchPatterns:vGe,defaultMatchWidth:"wide",parsePatterns:SGe,defaultParseWidth:"any"}),day:Fw({matchPatterns:bGe,defaultMatchWidth:"wide",parsePatterns:TGe,defaultParseWidth:"any"}),dayPeriod:Fw({matchPatterns:wGe,defaultMatchWidth:"any",parsePatterns:CGe,defaultParseWidth:"any"})},IGe={code:"en-US",formatDistance:Xze,formatLong:eGe,formatRelative:nGe,localize:uGe,match:RGe,options:{weekStartsOn:0,firstWeekContainsDate:1}};function AGe(n){const e=Hd(n);return Gze(e,qze(e))+1}function PGe(n){const e=Hd(n),i=+I1(e)-+Hze(e);return Math.round(i/vae)+1}function bae(n,e){var C,I,O,L;const i=Hd(n),o=i.getFullYear(),l=GN(),d=(e==null?void 0:e.firstWeekContainsDate)??((I=(C=e==null?void 0:e.locale)==null?void 0:C.options)==null?void 0:I.firstWeekContainsDate)??l.firstWeekContainsDate??((L=(O=l.locale)==null?void 0:O.options)==null?void 0:L.firstWeekContainsDate)??1,p=nE(n,0);p.setFullYear(o+1,0,d),p.setHours(0,0,0,0);const _=eR(p,e),E=nE(n,0);E.setFullYear(o,0,d),E.setHours(0,0,0,0);const b=eR(E,e);return i.getTime()>=_.getTime()?o+1:i.getTime()>=b.getTime()?o:o-1}function OGe(n,e){var _,E,b,C;const i=GN(),o=(e==null?void 0:e.firstWeekContainsDate)??((E=(_=e==null?void 0:e.locale)==null?void 0:_.options)==null?void 0:E.firstWeekContainsDate)??i.firstWeekContainsDate??((C=(b=i.locale)==null?void 0:b.options)==null?void 0:C.firstWeekContainsDate)??1,l=bae(n,e),d=nE(n,0);return d.setFullYear(l,0,o),d.setHours(0,0,0,0),eR(d,e)}function kGe(n,e){const i=Hd(n),o=+eR(i,e)-+OGe(i,e);return Math.round(o/vae)+1}function Ci(n,e){const i=n<0?"-":"",o=Math.abs(n).toString().padStart(e,"0");return i+o}const pg={y(n,e){const i=n.getFullYear(),o=i>0?i:1-i;return Ci(e==="yy"?o%100:o,e.length)},M(n,e){const i=n.getMonth();return e==="M"?String(i+1):Ci(i+1,2)},d(n,e){return Ci(n.getDate(),e.length)},a(n,e){const i=n.getHours()/12>=1?"pm":"am";switch(e){case"a":case"aa":return i.toUpperCase();case"aaa":return i;case"aaaaa":return i[0];case"aaaa":default:return i==="am"?"a.m.":"p.m."}},h(n,e){return Ci(n.getHours()%12||12,e.length)},H(n,e){return Ci(n.getHours(),e.length)},m(n,e){return Ci(n.getMinutes(),e.length)},s(n,e){return Ci(n.getSeconds(),e.length)},S(n,e){const i=e.length,o=n.getMilliseconds(),l=Math.trunc(o*Math.pow(10,i-3));return Ci(l,e.length)}},DS={midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},QQ={G:function(n,e,i){const o=n.getFullYear()>0?1:0;switch(e){case"G":case"GG":case"GGG":return i.era(o,{width:"abbreviated"});case"GGGGG":return i.era(o,{width:"narrow"});case"GGGG":default:return i.era(o,{width:"wide"})}},y:function(n,e,i){if(e==="yo"){const o=n.getFullYear(),l=o>0?o:1-o;return i.ordinalNumber(l,{unit:"year"})}return pg.y(n,e)},Y:function(n,e,i,o){const l=bae(n,o),d=l>0?l:1-l;if(e==="YY"){const p=d%100;return Ci(p,2)}return e==="Yo"?i.ordinalNumber(d,{unit:"year"}):Ci(d,e.length)},R:function(n,e){const i=Sae(n);return Ci(i,e.length)},u:function(n,e){const i=n.getFullYear();return Ci(i,e.length)},Q:function(n,e,i){const o=Math.ceil((n.getMonth()+1)/3);switch(e){case"Q":return String(o);case"QQ":return Ci(o,2);case"Qo":return i.ordinalNumber(o,{unit:"quarter"});case"QQQ":return i.quarter(o,{width:"abbreviated",context:"formatting"});case"QQQQQ":return i.quarter(o,{width:"narrow",context:"formatting"});case"QQQQ":default:return i.quarter(o,{width:"wide",context:"formatting"})}},q:function(n,e,i){const o=Math.ceil((n.getMonth()+1)/3);switch(e){case"q":return String(o);case"qq":return Ci(o,2);case"qo":return i.ordinalNumber(o,{unit:"quarter"});case"qqq":return i.quarter(o,{width:"abbreviated",context:"standalone"});case"qqqqq":return i.quarter(o,{width:"narrow",context:"standalone"});case"qqqq":default:return i.quarter(o,{width:"wide",context:"standalone"})}},M:function(n,e,i){const o=n.getMonth();switch(e){case"M":case"MM":return pg.M(n,e);case"Mo":return i.ordinalNumber(o+1,{unit:"month"});case"MMM":return i.month(o,{width:"abbreviated",context:"formatting"});case"MMMMM":return i.month(o,{width:"narrow",context:"formatting"});case"MMMM":default:return i.month(o,{width:"wide",context:"formatting"})}},L:function(n,e,i){const o=n.getMonth();switch(e){case"L":return String(o+1);case"LL":return Ci(o+1,2);case"Lo":return i.ordinalNumber(o+1,{unit:"month"});case"LLL":return i.month(o,{width:"abbreviated",context:"standalone"});case"LLLLL":return i.month(o,{width:"narrow",context:"standalone"});case"LLLL":default:return i.month(o,{width:"wide",context:"standalone"})}},w:function(n,e,i,o){const l=kGe(n,o);return e==="wo"?i.ordinalNumber(l,{unit:"week"}):Ci(l,e.length)},I:function(n,e,i){const o=PGe(n);return e==="Io"?i.ordinalNumber(o,{unit:"week"}):Ci(o,e.length)},d:function(n,e,i){return e==="do"?i.ordinalNumber(n.getDate(),{unit:"date"}):pg.d(n,e)},D:function(n,e,i){const o=AGe(n);return e==="Do"?i.ordinalNumber(o,{unit:"dayOfYear"}):Ci(o,e.length)},E:function(n,e,i){const o=n.getDay();switch(e){case"E":case"EE":case"EEE":return i.day(o,{width:"abbreviated",context:"formatting"});case"EEEEE":return i.day(o,{width:"narrow",context:"formatting"});case"EEEEEE":return i.day(o,{width:"short",context:"formatting"});case"EEEE":default:return i.day(o,{width:"wide",context:"formatting"})}},e:function(n,e,i,o){const l=n.getDay(),d=(l-o.weekStartsOn+8)%7||7;switch(e){case"e":return String(d);case"ee":return Ci(d,2);case"eo":return i.ordinalNumber(d,{unit:"day"});case"eee":return i.day(l,{width:"abbreviated",context:"formatting"});case"eeeee":return i.day(l,{width:"narrow",context:"formatting"});case"eeeeee":return i.day(l,{width:"short",context:"formatting"});case"eeee":default:return i.day(l,{width:"wide",context:"formatting"})}},c:function(n,e,i,o){const l=n.getDay(),d=(l-o.weekStartsOn+8)%7||7;switch(e){case"c":return String(d);case"cc":return Ci(d,e.length);case"co":return i.ordinalNumber(d,{unit:"day"});case"ccc":return i.day(l,{width:"abbreviated",context:"standalone"});case"ccccc":return i.day(l,{width:"narrow",context:"standalone"});case"cccccc":return i.day(l,{width:"short",context:"standalone"});case"cccc":default:return i.day(l,{width:"wide",context:"standalone"})}},i:function(n,e,i){const o=n.getDay(),l=o===0?7:o;switch(e){case"i":return String(l);case"ii":return Ci(l,e.length);case"io":return i.ordinalNumber(l,{unit:"day"});case"iii":return i.day(o,{width:"abbreviated",context:"formatting"});case"iiiii":return i.day(o,{width:"narrow",context:"formatting"});case"iiiiii":return i.day(o,{width:"short",context:"formatting"});case"iiii":default:return i.day(o,{width:"wide",context:"formatting"})}},a:function(n,e,i){const l=n.getHours()/12>=1?"pm":"am";switch(e){case"a":case"aa":return i.dayPeriod(l,{width:"abbreviated",context:"formatting"});case"aaa":return i.dayPeriod(l,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return i.dayPeriod(l,{width:"narrow",context:"formatting"});case"aaaa":default:return i.dayPeriod(l,{width:"wide",context:"formatting"})}},b:function(n,e,i){const o=n.getHours();let l;switch(o===12?l=DS.noon:o===0?l=DS.midnight:l=o/12>=1?"pm":"am",e){case"b":case"bb":return i.dayPeriod(l,{width:"abbreviated",context:"formatting"});case"bbb":return i.dayPeriod(l,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return i.dayPeriod(l,{width:"narrow",context:"formatting"});case"bbbb":default:return i.dayPeriod(l,{width:"wide",context:"formatting"})}},B:function(n,e,i){const o=n.getHours();let l;switch(o>=17?l=DS.evening:o>=12?l=DS.afternoon:o>=4?l=DS.morning:l=DS.night,e){case"B":case"BB":case"BBB":return i.dayPeriod(l,{width:"abbreviated",context:"formatting"});case"BBBBB":return i.dayPeriod(l,{width:"narrow",context:"formatting"});case"BBBB":default:return i.dayPeriod(l,{width:"wide",context:"formatting"})}},h:function(n,e,i){if(e==="ho"){let o=n.getHours()%12;return o===0&&(o=12),i.ordinalNumber(o,{unit:"hour"})}return pg.h(n,e)},H:function(n,e,i){return e==="Ho"?i.ordinalNumber(n.getHours(),{unit:"hour"}):pg.H(n,e)},K:function(n,e,i){const o=n.getHours()%12;return e==="Ko"?i.ordinalNumber(o,{unit:"hour"}):Ci(o,e.length)},k:function(n,e,i){let o=n.getHours();return o===0&&(o=24),e==="ko"?i.ordinalNumber(o,{unit:"hour"}):Ci(o,e.length)},m:function(n,e,i){return e==="mo"?i.ordinalNumber(n.getMinutes(),{unit:"minute"}):pg.m(n,e)},s:function(n,e,i){return e==="so"?i.ordinalNumber(n.getSeconds(),{unit:"second"}):pg.s(n,e)},S:function(n,e){return pg.S(n,e)},X:function(n,e,i){const o=n.getTimezoneOffset();if(o===0)return"Z";switch(e){case"X":return eZ(o);case"XXXX":case"XX":return Sy(o);case"XXXXX":case"XXX":default:return Sy(o,":")}},x:function(n,e,i){const o=n.getTimezoneOffset();switch(e){case"x":return eZ(o);case"xxxx":case"xx":return Sy(o);case"xxxxx":case"xxx":default:return Sy(o,":")}},O:function(n,e,i){const o=n.getTimezoneOffset();switch(e){case"O":case"OO":case"OOO":return"GMT"+ZQ(o,":");case"OOOO":default:return"GMT"+Sy(o,":")}},z:function(n,e,i){const o=n.getTimezoneOffset();switch(e){case"z":case"zz":case"zzz":return"GMT"+ZQ(o,":");case"zzzz":default:return"GMT"+Sy(o,":")}},t:function(n,e,i){const o=Math.trunc(n.getTime()/1e3);return Ci(o,e.length)},T:function(n,e,i){const o=n.getTime();return Ci(o,e.length)}};function ZQ(n,e=""){const i=n>0?"-":"+",o=Math.abs(n),l=Math.trunc(o/60),d=o%60;return d===0?i+String(l):i+String(l)+e+Ci(d,2)}function eZ(n,e){return n%60===0?(n>0?"-":"+")+Ci(Math.abs(n)/60,2):Sy(n,e)}function Sy(n,e=""){const i=n>0?"-":"+",o=Math.abs(n),l=Ci(Math.trunc(o/60),2),d=Ci(o%60,2);return i+l+e+d}const tZ=(n,e)=>{switch(n){case"P":return e.date({width:"short"});case"PP":return e.date({width:"medium"});case"PPP":return e.date({width:"long"});case"PPPP":default:return e.date({width:"full"})}},Tae=(n,e)=>{switch(n){case"p":return e.time({width:"short"});case"pp":return e.time({width:"medium"});case"ppp":return e.time({width:"long"});case"pppp":default:return e.time({width:"full"})}},NGe=(n,e)=>{const i=n.match(/(P+)(p+)?/)||[],o=i[1],l=i[2];if(!l)return tZ(n,e);let d;switch(o){case"P":d=e.dateTime({width:"short"});break;case"PP":d=e.dateTime({width:"medium"});break;case"PPP":d=e.dateTime({width:"long"});break;case"PPPP":default:d=e.dateTime({width:"full"});break}return d.replace("{{date}}",tZ(o,e)).replace("{{time}}",Tae(l,e))},DGe={p:Tae,P:NGe},xGe=/^D+$/,LGe=/^Y+$/,MGe=["D","DD","YY","YYYY"];function UGe(n){return xGe.test(n)}function VGe(n){return LGe.test(n)}function FGe(n,e,i){const o=jGe(n,e,i);if(console.warn(o),MGe.includes(n))throw new RangeError(o)}function jGe(n,e,i){const o=n[0]==="Y"?"years":"days of the month";return`Use \`${n.toLowerCase()}\` instead of \`${n}\` (in \`${e}\`) for formatting ${o} to the input \`${i}\`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md`}const BGe=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,WGe=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,zGe=/^'([^]*?)'?$/,GGe=/''/g,HGe=/[a-zA-Z]/;function $Ge(n,e,i){var C,I,O,L;const o=GN(),l=o.locale??IGe,d=o.firstWeekContainsDate??((I=(C=o.locale)==null?void 0:C.options)==null?void 0:I.firstWeekContainsDate)??1,p=o.weekStartsOn??((L=(O=o.locale)==null?void 0:O.options)==null?void 0:L.weekStartsOn)??0,_=Hd(n);if(!Kze(_))throw new RangeError("Invalid time value");let E=e.match(WGe).map(U=>{const B=U[0];if(B==="p"||B==="P"){const W=DGe[B];return W(U,l.formatLong)}return U}).join("").match(BGe).map(U=>{if(U==="''")return{isToken:!1,value:"'"};const B=U[0];if(B==="'")return{isToken:!1,value:KGe(U)};if(QQ[B])return{isToken:!0,value:U};if(B.match(HGe))throw new RangeError("Format string contains an unescaped latin alphabet character `"+B+"`");return{isToken:!1,value:U}});l.localize.preprocessor&&(E=l.localize.preprocessor(_,E));const b={firstWeekContainsDate:d,weekStartsOn:p,locale:l};return E.map(U=>{if(!U.isToken)return U.value;const B=U.value;(VGe(B)||UGe(B))&&FGe(B,e,String(n));const W=QQ[B[0]];return W(_,B,l.localize,b)}).join("")}function KGe(n){const e=n.match(zGe);return e?e[1].replace(GGe,"'"):n}const qGe=_f(lt),wae=({name:n,timestamp:e,text:i,isCurrentUser:o})=>{console.log("Message props:",{name:n,timestamp:e,text:i,isCurrentUser:o});const l=e&&e.toDate?$Ge(e.toDate(),"HH:mm"):"Invalid date";return w.jsxs(qGe,{display:"flex",flexDirection:"column",alignItems:o?"flex-end":"flex-start",initial:{opacity:0},animate:{opacity:1},transition:{duration:.5},children:[w.jsxs(lt,{w:"auto",maxW:"80%",bg:o?"secondary.500":"primary.200",color:o?"white":"black",p:"10px",borderRadius:"10px",alignSelf:o?"flex-end":"flex-start",wordBreak:"break-word",children:[w.jsx(Ze,{fontWeight:"bold",children:n}),w.jsx(Ze,{children:i})]}),w.jsx(Ze,{color:"copy.light",fontSize:"xs",mt:"4px",mx:"6px",mb:"10px",textAlign:o?"right":"left",children:l})]})};wae.propTypes={name:_n.string.isRequired,timestamp:_n.object,text:_n.string.isRequired,isCurrentUser:_n.bool.isRequired};const YGe=({spaceID:n})=>{const[e,i]=N.useState([]),{user:o}=N.useContext(Ao),l=N.useRef(null);return N.useEffect(()=>{const d=Bze(n,p=>{console.log("New messages received:",p),i(_=>[..._,...p]),q.log("Messages updated:",p)});return()=>d()},[n]),N.useEffect(()=>{l.current&&l.current.scrollIntoView({behavior:"smooth"})},[e]),w.jsxs(lt,{className:"messages-container",display:"flex",flexDirection:"column",my:"10px",overflowY:"auto",maxHeight:"80vh",children:[e.map(d=>{const p=d.uid===(o==null?void 0:o.uid);return w.jsx(wae,{name:d.user,timestamp:d.timestamp,text:d.text,isCurrentUser:p},d.id)}),w.jsx("div",{ref:l})]})},XGe=({spaceID:n})=>{},Cae=({spaceID:n})=>{const{user:e}=N.useContext(Ao);return e?w.jsxs(lt,{children:[w.jsx(lt,{height:"400px",overflowY:"auto",border:"1px solid #ccc",backgroundColor:"tertiaryAlpha.600",padding:"10px",children:w.jsx(YGe,{spaceID:n})}),w.jsx(lt,{mt:"8px",children:w.jsx(XGe,{spaceID:n})})]}):(console.log("No user found, returning login message"),w.jsx(lt,{children:w.jsx(Ze,{children:"Please log in to view the chat."})}))},YO=document.getElementById("chat-root");if(YO){const n=YO.getAttribute("data-space-id"),e=YO.getAttribute("data-theme")||"default",i=()=>{const[o,l]=N.useState(null);return N.useEffect(()=>{zC(e).then(l)},[]),o?w.jsx(K1,{theme:o,children:w.jsx(MN,{children:w.jsx(Cae,{spaceID:n})})}):w.jsx("div",{children:"Loading theme..."})};A1.createRoot(YO).render(w.jsx(i,{}))}else console.error("Root element 'chat-root' not found.");class JGe extends N.Component{constructor(e){super(e),this.state={hasError:!1}}static getDerivedStateFromError(e){return{hasError:!0}}componentDidCatch(e,i){console.error("WebGL Error:",e,i)}render(){return this.state.hasError?w.jsx(lt,{p:4,bg:"red.100",color:"red.900",borderRadius:"md",children:w.jsx(Ze,{children:"WebGL component error. Please refresh the page."})}):this.props.children}}const XO=document.getElementById("root");if(XO){const n=XO.getAttribute("data-space-id"),e=XO.getAttribute("data-theme")||"default",i=()=>{const[o,l]=N.useState(null);return N.useEffect(()=>{zC(e).then(l);const d=()=>{document.hidden||zC(e).then(l)};return document.addEventListener("visibilitychange",d),()=>{document.removeEventListener("visibilitychange",d)}},[]),o?w.jsx(K1,{theme:o,children:w.jsx(MN,{children:w.jsx(S3,{children:w.jsxs(Qr,{spacing:4,align:"stretch",children:[w.jsxs(wr,{justify:"space-between",align:"center",p:4,bg:"gray.700",m:0,position:"relative",zIndex:"100",children:[w.jsx(Ze,{fontSize:"xl",fontWeight:"bold",color:"white",children:"LOGO"}),w.jsx(lt,{zIndex:"100",position:"relative",children:w.jsx(Joe,{})})]}),w.jsx(AV,{maxW:"container.xl",p:0,zIndex:"1",children:w.jsx(one,{ratio:16/9,bg:"blue.100",m:0,children:w.jsx(lt,{id:"webgl-root","data-space-id":n,w:"100%",m:0,children:w.jsx(JGe,{children:w.jsx(k3,{spaceID:n})})})})}),w.jsx(AV,{maxW:"container.xl",p:0,children:w.jsx(Cae,{spaceID:n})})]})})})}):w.jsx("div",{children:"Loading theme..."})};A1.createRoot(XO).render(w.jsx(i,{}))}else console.error("Root element 'root' not found.");export{IEe as a,ZSe as b,Yi as c,XSe as d,ZGe as e,QGe as f,WSe as g,Fu as i,Xh as m,JRe as t};
